---
title: "TF5200_friction_comp_en"
product: "TF5200"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.06"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5200_friction_comp_en.pdf"
release_date: "2024-07-09"
---
Functional description | EN TF5200 | Twin CAT 3 CNC Friction compensation 7/9/2024 | Version: 1.06
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5200 | Twin CAT 3 CNC Version: 1.06 3 Friction compensation
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 5

Table of contents Table of contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Types of friction and compensation........................................................................................................ 9 2.1 Additive current dependent on velocity........................................................................................... 11 2.1.1 Reverse the motion direction........................................................................................... 12 2.2 Parameterisation............................................................................................................................. 14 2.3 Select and deselect compensation................................................................................................. 16 2.3.1 Programming.................................................................................................................... 17 2.4 Special features of drive parameters.............................................................................................. 18 3 Determine the parameters for the compensation value list................................................................ 19 3.1 Determine parameters manually..................................................................................................... 19 4 Effect of friction compensation............................................................................................................. 20 5 Parameter................................................................................................................................................. 21 5.1 Overview......................................................................................................................................... 21 5.1.1 Axis parameters............................................................................................................... 21 5.1.2 Compensation values....................................................................................................... 21 5.2 Description...................................................................................................................................... 22 5.2.1 Axis parameters............................................................................................................... 22 5.2.2 Compensation values....................................................................................................... 22 6 Support and Service............................................................................................................................... 25 Index......................................................................................................................................................... 26 TF5200 | Twin CAT 3 CNC Version: 1.06 5 Friction compensation
## Page 6

Table of contents 6 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 7

List of figures List of figures Fig. 1 Theoretical friction curve.............................................................................................................. 9 Fig. 2 Measured friction curve................................................................................................................ 10 Fig. 3 Principle of friction compensation................................................................................................ 11 Fig. 4 Add friction compensation to the control loop of an axis.............................................................. 12 Fig. 5 Weight friction model before/after zero crossing, on reversal from negative to positive velocity. 12 Fig. 6 Add friction compensation to the control loop of an axis.............................................................. 13 Fig. 7 Constant velocity (green) and associated current (black)............................................................ 19 Fig. 8 Circular transition test with and without friction compensation..................................................... 20 TF5200 | Twin CAT 3 CNC Version: 1.06 7 Friction compensation
## Page 8

Overview 1 Overview Task Friction effects in the drive train may cause marks or dimensional variations on the workpiece surface at points in the machining process where a change in axis direction occurs (reversing). The purpose of friction compensation is to minimise these effects and enhance machining results. Characteristics Friction compensation reduces position lag and improves surface quality. At the same time, it relieves pressure on the speed controller and when activated, it permits the greater use of dynamic parameters and this reduces machining time. Friction compensation can be activated for SERCOS and CANopen drives. This requires the install- ation of an additive torque interface (additive current) which requires [} 18] configuration. Parameterisation The data required for friction compensation is parameterised in the compensation value list [COMP]. Friction compensation is configured by setting the parameter P-AXIS-00522 in the axis parameter list and is active after controller start-up. Programming Friction compensation can also be activated/deactivated by the axis-specific NC command <Axis>[COMP ...] In the NC program. Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. 8 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 9

Types of friction and compensation 2 Types of friction and compensation Friction Friction basically occurs at points of contact between bodies moving relative to one another. It manifests itself as the force that counteracts the motion. According to Stribeck, the following friction curves result at different velocities: • Phase 1: Adhesive friction for standstill (boundary friction) • Phase 2: Mixed friction, Stribeck friction • Phase 3: Elastohydrodynamic friction The constant component of friction at velocity v = 0 results in a surge in frictional force at speed reversal resulting in backlash. Friction force Stribeck Viscous friction F friction brk Coulomb friction 0 Velocity Fig. 1: Theoretical friction curve TF5200 | Twin CAT 3 CNC Version: 1.06 9 Friction compensation
## Page 10

Types of friction and compensation Fig. 2: Measured friction curve 10 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 11

Types of friction and compensation 2.1 Additive current dependent on velocity Additive current The purpose of friction compensation is to compensate actually existing friction torque by way of an additional torque. It acts in the form of speed-dependent feedforward control of the motor current. Compensation HMI START parameter Axis FRICTION parameter %example P-COMP-00<i> N15 X[COMP ON FRICT] N25 P-AXIS-00522 ... M30 INIT ON / OFF CNC ENABLE / ACTIVATION Friction compensation Actual Additive current current Drive Fig. 3: Principle of friction compensation It is basically sufficient to command a additive current to the drive on the setpoint side for friction compensation. However, to determine the characteristic curve for the current and verify compensation, it is also ne- cessary to read the actual current. Effect The algorithm compensates for friction during path motions (v≠0) by an additional motor current. TF5200 | Twin CAT 3 CNC Version: 1.06 11 Friction compensation
## Page 12

Types of friction and compensation Control loop The effect of friction compensation on closed-loop control is shown in the figure below. friction compensation v additive d/dt I=f(v) current system pos pos cmd + + v + + act s-control v-control I-control motor mechanic - - current d/dt Fig. 4: Add friction compensation to the control loop of an axis 2.1.1 Reverse the motion direction Reverse and weight the friction curve In the Stribeck curve model, a jump in feedforward control current occurs in the axis reversal process (velocity zero crossing). To prevent this discontinuity, the CNC monitors axis reversal. In this case, the friction model may be weighted before and after zero crossing. • Before zero crossing: time [number of CNC cycles] • After zero crossing: Path distance covered [0.1 µm] friction force stribeck viscous F friction friction brk coulomb friction 0 velocity pre weighting 1 0 time post weighting distance Fig. 5: Weight friction model before/after zero crossing, on reversal from negative to positive velocity If no reversal takes place, i.e. the axis is only decelerated and continues in the same direction, the friction model is not weighted. 12 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 13

Types of friction and compensation Friction compensation Reverting pre/post - detection weighting model d/dt I=f(v) v Additive cmd current control System s cmd n*T a s cmd + s e s-control + v e v-control I + + I-control s act - - - d/dt d/dt Fig. 6: Add friction compensation to the control loop of an axis TF5200 | Twin CAT 3 CNC Version: 1.06 13 Friction compensation
## Page 14

Types of friction and compensation 2.2 Parameterisation Parameterise compensation values The table for friction compensation must be programmed with ascending velocity and the velocity must be ≥ 0. This is checked when the list is downloaded list and, if applicable, the error message P-ERR-110591 is output. As of CNC Build V3.1.3079.06, use P-COMP-00062 [} 24] to define a maximum number of table entries in the compensation value list. The entries actually used are defined in P-COMP-00042. Friction compensation parameters are defined in the compensation value list: • Maximum number of table entries P-COMP-00062 [} 24] as of Build V3.1.3079.06 • Friction compensation mode P-COMP-00041 • Number of table elements P-COMP-00042 • Current build-up after direction reversal P-COMP-00043 • Current decay before direction reversal P-COMP-00044 • Scaling factor for compensation values P-COMP-00045 • Table entries for velocity P-COMP-00046 • Table entries for current P-COMP-00047 Friction compensation is only active when the mode (P-COMP-00041) is assigned a value unequal to 0 and P-AXIS-00522 is set. Only value 3 is permitted for P-COMP-00041 Parameterise friction compensation frict_comp.mode 3 frict_comp.table_entries 3 frict_comp.position_delay 30 frict_comp.reversal_lookahead 4 frict_comp.scaling_factor 10 frict_comp.delay_cycles 9 frict_comp.table[0].in 0 frict_comp.table[0].out 0 frict_comp.table[1].in 316 frict_comp.table[1].out 3722 frict_comp.table[2].in 333 frict_comp.table[2].out 3884 14 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 15

Types of friction and compensation Parameter verification A consistency check takes place when compensation parameters are adopted. If the parameters are not coherent, a related error message is output. P-ERR-110591 Negative or non-ascending input values P-ERR-110592 Unknown mode or no values specified TF5200 | Twin CAT 3 CNC Version: 1.06 15 Friction compensation
## Page 16

Types of friction and compensation 2.3 Select and deselect compensation Activate/deactivate By analogy to other compensations, compensation can be activated by a parameter in the axis list or additionally by an NC command. Enable use/activate Compensation can only be applied if the parameter P-AXIS-00522 is set (TRUE) in the parameter list and the compensation value list is parameterised. Behaviour after start-up When friction compensation is selected, it is active directly after controller start-up regardless of whether homing was executed. Programming In every case, compensation can also be activated or deactivated explicitly by the axis-specific COMP command in the NC program. NOTICE The COMP command is valid after program end. After activating or deactivating compensation, the oper- ator must also explicitly deactivate or activate it at program end. 16 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 17

Types of friction and compensation 2.3.1 Programming <axis_name>[COMP ON | OFF FRICT] <axis_name> Name of the axis COMP Identifier to select/deselect axis-specific compensation. Must always be programmed as first keyword. ON Activates programmed compensation(s) OFF Deactivates programmed compensation(s) FRICT Keyword for friction compensation Activates and deactivates friction compensation N15 X[COMP ON FRICT] ;Activates X axis N25 Y[COMP OFF FRICT] ;Deactivates Y axis N35 X22 Y33 Z44 N45 X[COMP OFF FRICT] ;Deactivates X axis N55 M30 ;Program end Error message If friction compensation must be activated with the COMP command but it was not activated by the parameter P-AXIS-00522, the error message P-ERR-70495 is output. TF5200 | Twin CAT 3 CNC Version: 1.06 17 Friction compensation
## Page 18

Types of friction and compensation 2.4 Special features of drive parameters Drive telegram The drive must be fitted with a torque interface to be able to use friction compensation. SERCOS The additive torque setpoint must be configured in the cyclic log. • S-0-0084 Torque feedback value • S-0-0081 Additive torque command value CANopen The related PDOs (process data objects) are similarly configured with CANopen. • 6077 Torque actual value • 60B2 Torque offset 18 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 19

Determine the parameters for the compensation value list 3 Determine the parameters for the compensation value list 3.1 Determine parameters manually Manual determination Each of the compensation value list parameters can be determined “manually”. To this end, the associated current (dig_drv.act_torque), e.g. in the scope, must be read off during a motion at constant speed. The motor current during a motion at constant speed is mapped in the figure below. It can be seen that the current is in the opposite direction to the speed. Fig. 7: Constant velocity (green) and associated current (black) TF5200 | Twin CAT 3 CNC Version: 1.06 19 Friction compensation
## Page 20

Effect of friction compensation 4 Effect of friction compensation Friction compensation reduces position lag and axis backlash. This boosts accuracy. Furthermore, the speed controllers are relieved, as a result of which the dynamic parameters can be used to a greater extent without impairing the machining result. The figure below shows the result of a circular transition test with compensation activated and deactivated. Without compensation (blue), clear peaks are visible at the quadrant transitions, which are reduced by compensation (red). Fig. 8: Circular transition test with and without friction compensation 20 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 21

Parameter 5 Parameter 5.1 Overview 5.1.1 Axis parameters ID Parameter Description P-AXIS-00522 lr_param.frict_comp Activates and deactivates friction compensation 5.1.2 Compensation values ID Parameter Description P-COMP-00041 Index of the incorrect Friction compensation mode interpolation point P-COMP-00042 frict_comp.table_entries Number of elements in the compensation value table. Maximum of 20 P-COMP-00043 frict_comp.position_delay Distance over which the motor current is built up during start-up. P-COMP-00044 frict_comp.reversal_lookahea Number of cycles during which the motor current is d dissipated before a motion reversal. P-COMP-00045 frict_comp.scaling_factor Scaling factor for the entries in the compensation list P-COMP-00046 frict_comp.table[i].in Velocity P-COMP-00047 frict_comp.table[i].out Measured friction (motor current) P-COMP-00058 frict_comp.delay_cycles Delay in compensation values after reversal point in cycles P-COMP-00062 frict_comp.max_points Max. number of possible table entries TF5200 | Twin CAT 3 CNC Version: 1.06 21 Friction compensation
## Page 22

Parameter 5.2 Description 5.2.1 Axis parameters P-AXIS-00522 Activation of friction compensation Description This parameter activates the friction compensation. Parameter lr_param.frict_comp Data type BOOLEAN Data range 0/1 Axis types T, R Dimension T: ---- R: ---- Default value 0 Drive types SERCOS, CANopen Remarks If friction compensation must be activated with the COMP command but it was not activated by the parameter P-AXIS-00522, the error message P-ERR-70495 is output. 5.2.2 Compensation values P-COMP-00041 Friction compensation mode Description The parameter defines the operation mode for friction compensation. If the parameter is assigned the value 0, friction compensation is deactivated. Parameter frict_comp.mode Data type UNS16 Data range 0: Deactivate friction compensation 3: Compensation with additive current taking into account the commanded speed Axis types T, R, S Dimension T: ---- R,S: ---- Default value 0 Remarks To activate friction compensation, the mode must and P-AXIS-00522 must be set. P-COMP-00042 Number of elements in the compensation value table Description This parameter defines the number of entries in the compensation table. Parameter frict_comp.table_entries Data type UNS16 Data range 0 ≤ table_entries ≤ P-COMP-00062 [} 24] Axis types T, R, S Dimension T: ---- R,S: ---- Default value 0 Remarks P-COMP-00062 [} 24] is available as of Build V3.1.3079.06. The default upper limit is 20. P-COMP-00043 Delay value for current build-up Description This parameter defines the delay value for current built-up at start-up. Its purpose is to prevent abrupt changes. Current build-up is linear. Parameter frict_comp.position_delay Data type SGN32 Data range 0 ≤ position_delay ≤ 10 Axis types T, R, S 22 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 23

Parameter Dimension T: 0.1µm R,S: 0.0001° Default value 0 Remarks P-COMP-00044 Reversal look ahead Description This parameter defines the number of cycles over which the motor current decays before motion reversal. Parameter frict_comp.reversal_lookahead Data type UNS16 Data range 0 ≤ reversal_lookahead ≤ 4 Axis types T, R, S Dimension T: Cycles R,S: Cycles Default value 0 Remarks P-COMP-00045 Scaling factor for compensation values Description This parameter defines the scaling of all compensation values in the list. Parameter frict_comp.scaling_factor Data type SGN16 Data range MIN(SGN16) < scaling_factor < MAX(SGN16) Axis types T, R, S Dimension T: 0.1% R,S: 0.1% Default value 1000 Remarks P-COMP-00046 Velocity input variable Description This parameter defines the velocities for which the additional motor currents specified in P-COMP-00047 are to be output to the additive current interface. The values must be entered in ascending order. Parameter frict_comp.table[i].in where i= P-COMP-00042 Data type SGN32 Data range 0 < table[i].in < MAX(SGN32) Axis types T, R, S Dimension T: R,S: [0.001°/s] Default value 0 Remarks P-COMP-00047 Measured friction (motor current) – output variable Description This parameter defines the current which is to be additionally output at the additive current interface. Parameter frict_comp.table[i].out where i= P-COMP-00042 Data type SGN32 Data range MIN(SGN32) < table[i].out < MAX(SGN32) Axis types T, R, S Dimension T: * R,S: * Default value 0 Remarks * The dimension of the motor current depends on the internal data of the related drive. In CANopen and SERCOS, this value corresponds to the contents of the CNC object dig_drv.act_torque. P-COMP-00058 Delay time for compensation values TF5200 | Twin CAT 3 CNC Version: 1.06 23 Friction compensation
## Page 24

Parameter Description This parameter defines the delay time of all compensation values. Parameter frict_comp.delay_cycles Data type SGN16 Data range 0 ≤ delay_cycles < 249 Axis types T, R, S Dimension T: Cycles R,S: Cycles Default value 0 Remarks P-COMP-00062 Maximum number of table entries for friction compensation Description This friction compensation parameter (FCT-C25 [} 8]) saves the memory space required for a particular number of table entries. The size of the actually used compensation table is defined by `table_entries` (P- COMP-00042) and `table_entries` must be smaller than `max_points`. Parameter frict_comp.max_points Data type UNS32 Data range 0 <= P-COMP-00062 Axis types T, R, S Dimension T: ---- R,S: ---- Default value 20 Remarks The parameter value can no longer be changed after start-up or after lists are reloaded. Otherwise error ID 110641 is output. If P-COMP-00062 is not specified (or assigned the value 0), the default value is assigned to P-COMP-00062 for downward compatibility reasons. To avoid the default assignment, memory can be saved for an axis that does not use friction compensation [} 8] by assigning the value 1 to P-COMP-00062. This parameter is available as of CNC Build V3.3079.06 24 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 25

Support and Service 6 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF5200 | Twin CAT 3 CNC Version: 1.06 25 Friction compensation
## Page 26

Index Index P P-AXIS-00522 22 P-COMP-00041 22 P-COMP-00042 22 P-COMP-00043 22 P-COMP-00044 23 P-COMP-00045 23 P-COMP-00046 23 P-COMP-00047 23 P-COMP-00058 23 P-COMP-00062 24 26 Version: 1.06 TF5200 | Twin CAT 3 CNC Friction compensation
## Page 28

More Information: www.beckhoff.com/TF5200 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
