---
title: "TwinCAT_ADS_NET_Samples_EN"
product: "TwinCAT"
category: "Communication"
tags: ["ADS", "CAT", "NET", "SAMPLES", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.2"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_ADS_NET_Samples_EN.pdf"
release_date: "2022-08-31"
---
Manual | EN ADS-DLL . NET Samples Twin CAT 3 2022-08-31 | Version: 1.2
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 Safety instructions............................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Integration.................................................................................................................................................. 8 2.1 Linking into Twin CAT 3..................................................................................................................... 8 3 Samples ADS . NET.................................................................................................................................. 10 3.1 Accessing an array in the PLC........................................................................................................ 10 3.2 Transmitting structures to the PLC.................................................................................................. 13 3.3 Event driven reading....................................................................................................................... 16 3.4 Reading and writing of string variables........................................................................................... 19 3.5 Reading and writing of TIME/DATE variables................................................................................. 22 3.6 Read PLC variable declaration....................................................................................................... 24 3.7 Reading and writing of PLC variables of any type (Read Any, Write Any)........................................ 30 3.8 Detect state changes in Twin CAT router and PLC......................................................................... 37 3.9 ADS-Sum Command: Reading or writing several variables............................................................ 39 3.10 Free Sample.................................................................................................................................... 43 3.11 Delete a handle of a PLC variable.................................................................................................. 43 3.12 Read flag synchronously from the PLC........................................................................................... 43 3.13 Write flag synchronously into the PLC............................................................................................ 44 3.14 Start/stop PLC................................................................................................................................. 45 3.15 Access by variable name................................................................................................................ 46 3.16 PLC method call.............................................................................................................................. 47 ADS-DLL . NET Samples Version: 1.2 3
## Page 4

Table of contents 4 Version: 1.2 ADS-DLL . NET Samples
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilization of this document as well as the communication of its contents to others without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. ADS-DLL . NET Samples Version: 1.2 5
## Page 6

Foreword 1.2 Safety instructions Safety regulations Please note the following safety instructions and explanations! Product-specific safety instructions can be found on following pages or in the areas mounting, wiring, commissioning etc. Exclusion of liability All the components are supplied in particular hardware and software configurations appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation and drive engineering who are familiar with the applicable national standards. Description of symbols In this documentation the following symbols are used with an accompanying safety instruction or note. The safety instructions must be read carefully and followed without fail! DANGER Serious risk of injury! Failure to follow the safety instructions associated with this symbol directly endangers the life and health of persons. WARNING Risk of injury! Failure to follow the safety instructions associated with this symbol endangers the life and health of per- sons. CAUTION Personal injuries! Failure to follow the safety instructions associated with this symbol can lead to injuries to persons. NOTE Damage to the environment or devices Failure to follow the instructions associated with this symbol can lead to damage to the environment or equipment. Tip or pointer This symbol indicates information that contributes to better understanding. 6 Version: 1.2 ADS-DLL . NET Samples
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. ADS-DLL . NET Samples Version: 1.2 7
## Page 8

Integration 2 Integration 2.1 Linking into Twin CAT 3 Creating new project Start Microsoft Visual Studio and create new project (Windows Forms Application). Adding reference In order to select the Twin CAT. Ads class library you must choose the command Add Reference... under the Project menu . You will find the . Net Libraries per default in following Twin CAT folder: C:\Twin CAT\Ads Api\. NET\ This opens the Add Reference dialog: In this dialog you have to press the Browse button and select the file Twin CAT. Ads.dll for your used . NET Framework runtime. In the Solution Explorer you can check, if the component has been added to the list of references: 8 Version: 1.2 ADS-DLL . NET Samples
## Page 9

Integration All accessible types (classes,structures ...) belong to the namespace Twin CAT. Ads. Therefore one has to insert the following line at the beginning of the source : using System. IO; using Twin CAT. Ads; This enables access to the types defined in Twin CAT. Ads without including the name of the namespace. The class Tc Ads Client is the core of the Twin CAT. Ads class library and enables the user to communicate with an ads device. To begin with an instance of the class must be created. Then a connection to the ADS device is established by means of the Connect method. ADS-DLL . NET Samples Version: 1.2 9
## Page 10

Samples ADS . NET 3 Samples ADS . NET Table 1: Twin CAT ADS . NET Descripion Linking into Microsoft Visual Studio [} 8] Description Minimun Twin CAT 3 Build Visual C# Sample 1: Accessing an array in the Twin CAT 3.0 Build 3100 Sample01.zip PLC [} 10] Sample 2: Transmitting a structure Twin CAT 3.0 Build 3100 Sample02.zip to the PLC [} 13] Sample 3: Event driven reading Twin CAT 3.0 Build 3100 Sample03.zip [} 16] Sample 4: Reading and writing of Twin CAT 3.0 Build 3100 Sample04.zip string variables [} 19] Sample 5: Reading and writing of Twin CAT 3.0 Build 3100 Sample05.zip DATE/TIME variables [} 22] Sample 6: Read PLC variable Twin CAT 3.0 Build 3100 Sample06.zip declaration [} 24] Sample 7: Reading and writing of Twin CAT 3.0 Build 3100 Sample07.zip PLC variables of any type [} 30] Sample 8: Detect state changes of Twin CAT 3.0 Build 3100 Sample08.zip Twin CAT router and PLC [} 37] Sample 9: ADS-Sum Command: Twin CAT 3.0 Build 3100 Sample09.zip Reading or writing several variables [} 39] Sample 10: Reserved Sample 11: Delete a handle of a Twin CAT 3.0 Build 3100 Sample11.zip PLC variable [} 43] Sample 12: Read flag Twin CAT 3.0 Build 3100 Sample12.zip synchronously from the PLC [} 43] Sample 13: Write flag Twin CAT 3.0 Build 3100 Sample13.zip synchronously into the PLC [} 44] Sample 14: Start/stop PLC [} 45] Twin CAT 3.0 Build 3100 Sample14.zip Sample 15: Access by variable Twin CAT 3.0 Build 3100 Sample15.zip name [} 46] 3.1 Accessing an array in the PLC Download Requirements Language / IDE Unpack the example program C# / Visual Studio Sample01.zip Task The PLC contains an array that is to be read by the . Net application using a read command. 10 Version: 1.2 ADS-DLL . NET Samples
## Page 11

Samples ADS . NET Description The PLC contains an array of 100 elements of type integer (2 bytes). The array in the PLC is to be filled with the values from 3500 to 3599. In the Form1_Load event method a new instance of the class Tc Ads Client is created. Then the method Tc Ads Client. Connect of the Tc Ads Client object is called to establish a connection to the port 851. Finally the method Tc Ads Client. Create Variable Handle is used to fetch the handle of the PLC variable. When the program finishes, this handle is released in the Form1_Closing event method and the Dispose method of the Tc Ads Client object is called. When the user clicks the button on the form, the entire array is read from the PLC into the Ads Stream data Stream by means of the Tc Ads Client. Read method. The stream should be of the same size as the data in the SPS. Because we want to read 100 INTs (each 2 Bytes), the stream must be able to hold at least 2 * 100 Bytes. The class System. IO. Binary Reader is necessary to read the individual fields of the array. First the position of the stream has to be set to 0. Then the individual fields of the array can be read by calling the method Binary Reader. Read Int16 in a for loop. The position pointer of the stream is incremented automatically by the bytes ( in this case 2) that have been read. C# program using System; using System. Drawing; using System. Collections; using System. Component Model; using System. Windows. Forms; using System. Data; using Twin CAT. Ads; using System. IO; namespace Sample01 { public class Form1 : System. Windows. Forms. Form { private System. Windows. Forms. Button btn Read; private System. Component Model. Container components = null; private System. Windows. Forms. List Box lb Array; private int h Var; private Tc Ads Client tc Client; public Form1() { Initialize Component(); ADS-DLL . NET Samples Version: 1.2 11
## Page 12

Samples ADS . NET } protected override void Dispose( bool disposing ) ... private void Initialize Component() ... [STAThread] static void Main() { Application. Run(new Form1()); } private void Form1_Load(object sender, System. Event Args e) { // Create instance of class Tc Ads Client tc Client = new Tc Ads Client(); // Connect to local PLC - Runtime 1 Twin CAT 3 Port=851 tc Client. Connect(851); try { h Var = tc Client. Create Variable Handle("MAIN. PLCVar"); } catch(Exception err) { Message Box. Show(err. Message); } } private void btn Read_Click(object sender, System. Event Args e) { try { // Ads Stream which gets the data Ads Stream data Stream = new Ads Stream(100 * 2); Binary Reader bin Read = new Binary Reader(data Stream); //read comlpete Array tc Client. Read(h Var,data Stream); lb Array. Items. Clear(); data Stream. Position = 0; for(int i=0; i<100; i++) { lb Array. Items. Add(bin Read. Read Int16(). To String()); } } catch(Exception err) { Message Box. Show(err. Message); } } private void Form1_Closing(object sender, System. Component Model. Cancel Event Args e) { //enable resources try { tc Client. Delete Variable Handle(h Var); } catch(Exception err) { Message Box. Show(err. Message); } tc Client. Dispose(); } } } PLC program PROGRAM MAIN VAR PLCVar : ARRAY [0..99] OF INT; Index: BYTE; 12 Version: 1.2 ADS-DLL . NET Samples
## Page 13

Samples ADS . NET END_VAR FOR Index := 0 TO 99 DO PLCVar[Index] := 3500 + INDEX; END_FOR 3.2 Transmitting structures to the PLC Download Requirements Language / IDE Unpack the example program C# / Visual Studio Sample02.zip Task A structure is to be written into the PLC by the . NET application. The elements in the structure have different data types. Description The structure we want to write into the PLC: TYPE PLCStruct STRUCT int Val : INT; (*Offset 0*) dint Val : DINT; (*Offset 2*) byte Val : SINT; (*Offset 6*) lreal Val : LREAL;(*Offset 7*) real Val : REAL; (*Offset 15 --> Total size 19 Bytes*) END_STRUCT END_TYPE In c# the structure would look like this: public struct PLCStruct { public short int Val; public int dint Val; public byte byte Val; public double lreal Val; public float real Val; } This structure will not be created directly. Instead we will use a Ads Stream as in Sample01. This object is initialized with a size of 19 bytes in the write event method. This is equivalent to the size of the data type PLCStruct in the SPS. A Binary Writer is used to write the data from the textboxes to the stream. After setting the stream position to 0 the individual fields are written to the stream. Finally the total stream is written into the SPS with the help of Tc Ads Client. Write. ADS-DLL . NET Samples Version: 1.2 13
## Page 14

Samples ADS . NET C# Program using System; using System. Drawing; using System. Collections; using System. Component Model; using System. Windows. Forms; using System. Data; using System. IO; using Twin CAT. Ads; namespace Sample02 { /// /// Summary description for Form1. /// public class Form1 : System. Windows. Forms. Form { private System. Windows. Forms. Group Box group Box1; private System. Windows. Forms. Label label1; private System. Windows. Forms. Label label2; private System. Windows. Forms. Label label3; private System. Windows. Forms. Label label4; private System. Windows. Forms. Label label5; private System. Windows. Forms. Button btn Write; private System. Windows. Forms. Text Box tb Int; private System. Windows. Forms. Text Box tb Dint; private System. Windows. Forms. Text Box tb Byte; private System. Windows. Forms. Text Box tb LReal; private System. Windows. Forms. Text Box tb Real; private System. Component Model. Container components = null; private int h Var;private Tc Ads Client tc Client; public Form1() { Initialize Component(); } protected override void Dispose( bool disposing )... private void Initialize Component()... [STAThread] static void Main() { Application. Run(new Form1()); } private void Form1_Load(object sender, System. Event Args e) { 14 Version: 1.2 ADS-DLL . NET Samples
## Page 15

Samples ADS . NET // Create instance of class Tc Ads Client tc Client = new Tc Ads Client(); // Connect to local PLC - Runtime 1 - Twin CAT 3 Port=851 tc Client. Connect(851); try { h Var = tc Client. Create Variable Handle("MAIN. PLCVar"); } catch(Exception err) { Message Box. Show(err. Message); } } private void btn Write_Click(object sender, System. Event Args e) { Ads Stream data Stream = new Ads Stream(19); Binary Writer bin Write = new Binary Writer(data Stream); data Stream. Position = 0; try { //Fill stream according to the order with data from the text boxes bin Write. Write(short. Parse(tb Int. Text)); bin Write. Write(int. Parse(tb Dint. Text)); bin Write. Write(byte. Parse(tb Byte. Text)); bin Write. Write(double. Parse(tb LReal. Text)); bin Write. Write(float. Parse(tb Real. Text)); //Write complete stream in the PLC tc Client. Write(h Var,data Stream); } catch( Exception err) { Message Box. Show(err. Message); } } private void Form1_Closing(object sender, System. Component Model. Cancel Event Args e) { //Enable resources try { tc Client. Delete Variable Handle(h Var); } catch(Exception err) { Message Box. Show(err. Message); } tc Client. Dispose(); } } } PLC program TYPE PLCStruct STRUCT int Val : INT; dint Val : DINT; byte Val : SINT; lreal Val : LREAL; real Val : REAL; END_STRUCT END_TYPE PROGRAM MAIN VAR PLCVar : PLCStruct; END_VAR ADS-DLL . NET Samples Version: 1.2 15
## Page 16

Samples ADS . NET 3.3 Event driven reading Download Requirements Language / IDE Unpack the example program C# / Visual Studio Sample03.zip Task There are 7 global variables in the PLC. Each of these PLC variables is of a different data type. The values of the variables should be read in the most effective manner, and the value with its timestamp is to be displayed on a form. Description In the form's load event, a connection to each of the PLC variables is created with the Tc Ads Client. Add Device Notification() method. The handle for this connection is stored in a array. The parameter Trans Mode specifies the type of data exchange. Ads Trans Mode. On Change has been selected here. This means that the value of the PLC variable is only transmitted if its value within the PLC has changed (see the Ads Trans Mode data type). The parameter cycle Time indicates that the PLC is to check whether the corresponding variable has changed every 100 ms. Max Delay allows to collect notification for a specified interval. If the max Delay elapse, all notifications will be send at once. When the PLC variable changes, the Tc Ads Client. Ads Notification() event is called. The parameter e of the event handling method is of the type Ads Notification Event Args and contains the time stamp, the handle, the value and the control in which the value is to be displayed. The connections are released again in the closing event by means of the Tc Ads Client. Delete Device Notification() method. It is essential that you do this, since every connection established by Tc Ads Client. Add Device Notification() uses resources. You should also choose appropriate values for the cycle time, since too many write / read operations load the system so heavily that the user interface becomes much slower. Advice: Don't use time intensive executions in callbacks (On Notification()). 16 Version: 1.2 ADS-DLL . NET Samples
## Page 17

Samples ADS . NET C# program using System; using System. Drawing; using System. Collections; using System. Component Model; using System. Windows. Forms; using System. Data; using System. IO; using Twin CAT. Ads; namespace Sample03 { public class Form1 : System. Windows. Forms. Form { private System. Windows. Forms. Label label1; private System. Windows. Forms. Label label2; private System. Windows. Forms. Label label3; private System. Windows. Forms. Label label4; private System. Windows. Forms. Label label5; private System. Windows. Forms. Label label6; private System. Windows. Forms. Label label7; private System. Windows. Forms. Label label8; private System. Windows. Forms. Label label9; private System. Windows. Forms. Label label10; private System. Windows. Forms. Text Box tb Int; private System. Windows. Forms. Text Box tb Dint; ADS-DLL . NET Samples Version: 1.2 17
## Page 18

Samples ADS . NET private System. Windows. Forms. Text Box tb Sint; private System. Windows. Forms. Text Box tb Lreal; private System. Windows. Forms. Text Box tb Real; private System. Windows. Forms. Text Box tb String; private System. Windows. Forms. Label label11; private System. Windows. Forms. Text Box tb Bool; private System. Component Model. Container components = null; private Tc Ads Client tc Client; private int[] h Connect; private Ads Stream data Stream; private Binary Reader bin Read; public Form1() { Initialize Component(); } protected override void Dispose( bool disposing ) ... private void Initialize Component() ... [STAThread] static void Main() { Application. Run(new Form1()); } private void Form1_Load(object sender, System. Event Args e) { data Stream = new Ads Stream(31); //Encoding is set to ASCII, to read strings bin Read = new Binary Reader(data Stream, System. Text. Encoding. ASCII); // Creaste instance of class Tc Ads Client tc Client = new Tc Ads Client(); // PLC1 Port - Twin CAT 3=851 tc Client. Connect(851); h Connect = new int[7]; try { h Connect[0] = tc Client. Add Device Notification("MAIN.bool Val",data Stream,0,1, Ads Trans Mode. On Change,100,0,tb Bool); h Connect[1] = tc Client. Add Device Notification("MAIN.int Val",data Stream,1,2, Ads Trans Mode. On Change,100,0,tb Int); h Connect[2] = tc Client. Add Device Notification("MAIN.dint Val",data Stream,3,4, Ads Trans Mode. On Change,100,0,tb Dint); h Connect[3] = tc Client. Add Device Notification("MAIN.sint Val",data Stream,7,1, Ads Trans Mode. On Change,100,0,tb Sint); h Connect[4] = tc Client. Add Device Notification("MAIN.lreal Val",data Stream,8,8, Ads Trans Mode. On Change,100,0,tb Lreal); h Connect[5] = tc Client. Add Device Notification("MAIN.real Val",data Stream,16,4, Ads Trans Mode. On Change,100,0,tb Real); h Connect[6] = tc Client. Add Device Notification("MAIN.string Val",data Stream,20,11, Ads Trans Mode. On Change,100,0,tb String); tc Client. Ads Notification += new Ads Notification Event Handler(On Notification); } catch(Exception err) { Message Box. Show(err. Message); } } private void On Notification(object sender, Ads Notification Event Args e) { Date Time time = Date Time. From File Time(e. Time Stamp); e. Data Stream. Position = e. Offset; string str Value = ""; if( e. Notification Handle == h Connect[0]) str Value = bin Read. Read Boolean(). To String(); else if( e. Notification Handle == h Connect[1] ) str Value = bin Read. Read Int16(). To String(); else if( e. Notification Handle == h Connect[2] ) str Value = bin Read. Read Int32(). To String(); else if( e. Notification Handle == h Connect[3] ) str Value = bin Read. Read SByte(). To String(); 18 Version: 1.2 ADS-DLL . NET Samples
## Page 19

Samples ADS . NET else if( e. Notification Handle == h Connect[4] ) str Value = bin Read. Read Double(). To String(); else if( e. Notification Handle == h Connect[5] ) str Value = bin Read. Read Single(). To String(); else if( e. Notification Handle == h Connect[6] ) { str Value = new String(bin Read. Read Chars(11)); } ((Text Box)e. User Data). Text = String. Format("Date Time: {0},{1}ms; {2}",time,time. Millisecond,str Value); } private void Form1_Closing(object sender, System. Component Model. Cancel Event Args e) { try { for(int i=0; i<7; i++) { tc Client. Delete Device Notification(h Connect[i]); } } catch(Exception err) { Message Box. Show(err. Message); } tc Client. Dispose(); } } } PLC program PROGRAM MAIN VAR bool Val : BOOL; int Val : INT; dint Val : DINT; sint Val : SINT; lreal Val : LREAL; real Val : REAL; string Val : STRING(10); END_VAR PROGRAM MAIN VAR ; END_VAR 3.4 Reading and writing of string variables Download Requirements Language / IDE Unpack the sample program C# / Visual Studio Sample04.zip Task A . Net application should read a string from the PLC and write a string to the PLC. ADS-DLL . NET Samples Version: 1.2 19
## Page 20

Samples ADS . NET Description The PLC contains the string MAIN.text. In the Form1_Load event method a new instance of the class Tc Ads Client is created. Then the method Tc Ads Client. Connect of the Tc Ads Client object is called to establish a connection to the port 851. Finally the method Tc Ads Client. Create Variable Handle is used to fetch the handle of the PLC variable . When the program finishes, the Dispose method of the Tc Ads Client object is called. When the user clicks the "Read" button on the form, the string is read by means of the Tc Ads Client. Read method and is displayed in the text box. When the user clicks the "Write" button ont the form, the string is wirtten to PLC and is displayed in the text box. Twin CAT. Ads. NET version >= 1.0.0.10: The classes Ads Binary Reader and Ads Binary Writer can be used to read and write strings ( see commented section in sample program ). These classes derive from the Binary Reader/Writer classes. To read a string from the stream one has to call the method Ads Binary Reader. Read Plc String. To write a string to the stream one has to call the method Ads Binary Writer. Write PLCString. The length of the Ads Stream must be equal to size of the string in the PLC (without terminating zero character). The length is passed to these method and have to be equal to the length of the string in the PLC (without the terminating zero character). C# program using System; using System. Drawing; using System. Collections; using System. Component Model; using System. Windows. Forms; using System. Data; using Twin CAT. Ads; using System. IO; namespace Sample04 { public class Form1 : System. Windows. Forms. Form { private System. Component Model. Container components = null; private System. Windows. Forms. Text Box text Box1; private System. Windows. Forms. Button btn Read; private System. Windows. Forms. Button btn Write; private System. Windows. Forms. Label label1; private Tc Ads Client ads Client; private int var Handle; public Form1() { Initialize Component(); } protected override void Dispose( bool disposing ) { ... } private void Initialize Component() { ... } 20 Version: 1.2 ADS-DLL . NET Samples
## Page 21

Samples ADS . NET [STAThread] static void Main() { Application. Run(new Form1()); } private void Form1_Load(object sender, System. Event Args e) { try { ads Client = new Tc Ads Client(); // PLC1 Port - Twin CAT 3=851 tc Client. Connect(851); var Handle = ads Client. Create Variable Handle("MAIN.text"); } catch( Exception err) { Message Box. Show(err. Message); } } private void Form1_Closing(object sender, System. Component Model. Cancel Event Args e) { ads Client. Dispose(); } private void btn Read_Click(object sender, System. Event Args e) { try { //length of the stream = length of string in sps + 1 Ads Stream ads Stream = new Ads Stream(31); Binary Reader reader = new Binary Reader(ads Stream,System. Text. Encoding. ASCII); int length = ads Client. Read(var Handle, ads Stream); string text = new string(reader. Read Chars(length)); //necessary if you want to compare the string to other strings //text = text. Substring(0,text. Index Of('\0')); text Box1. Text = text; } catch(Exception err) { Message Box. Show(err. Message) } } private void btn Write_Click(object sender, System. Event Args e) { try { //length of the stream = length of string + 1 Ads Stream ads Stream = new Ads Stream(text Box1. Text. Length+1); Binary Writer writer = new Binary Writer(ads Stream, System. Text. Encoding. ASCII); writer. Write(text Box1. Text. To Char Array()); //add terminating zero writer. Write('\0'); ads Client. Write(var Handle,ads Stream); } catch(Exception err) { Message Box. Show(err. Message); } } /*From version 1.0.0.10 and higher the classes Ads Binary Reader and Ads Binary Writer can be used to read and write strings private void btn Read_Click(object sender, System. Event Args e) { try { Ads Stream ads Stream = new Ads Stream(30); Ads Binary Reader reader = new Ads Binary Reader(ads Stream); ads Client. Read(var Handle, ads Stream); text Box1. Text = reader. Read Plc String(30); } catch(Exception err) ADS-DLL . NET Samples Version: 1.2 21
## Page 22

Samples ADS . NET { Message Box. Show(err. Message); } } private void btn Write_Click(object sender, System. Event Args e) { try { Ads Stream ads Stream = new Ads Stream(30); Ads Binary Writer writer = new Ads Binary Writer(ads Stream); writer. Write Plc String(text Box1. Text, 30); ads Client. Write(var Handle, ads Stream); } catch(Exception err) { Message Box. Show(err. Message); } } */ } } PLC program PROGRAM MAIN VAR text : STRING[30] := 'hello'; END_VAR 3.5 Reading and writing of TIME/DATE variables Download Requirements Language / IDE Unpack the example program C# / Visual Studio Sample05.zip Task A . Net application should read and write a date and a time. Description The PLC contains the TIME variable MAIN. Time1 and the DT variable MAIN. Date1. In the Form1_Load event method a new instance of the class Tc Ads Client is created. Then the method Tc Ads Client. Connect of the Tc Ads Client object is called to establish a connection to the port 851. Finally the method Tc Ads Client. Create Variable Handle is used to fetch the handle of the PLC variables . When the program finishes, the Dispose method of the Tc Ads Client object is called. When the user clicks the "Read" button on the form, the variables MAIN. Time1 and MAIN. Date1 are read by means of the Tc Ads Client. Read method. The class Ads Binary Reader, that derives from Binary Reader, is used to read the time and date from the PLC. The method Ads Binary Reader. Read Plc TIME reads the time from the Ads Stream and converts it to the . NET type Time Span. The method Ads Binary Reader. Read Plc DATE reads the date from the Ads Stream and converts it to the . NET type Date Time. 22 Version: 1.2 ADS-DLL . NET Samples
## Page 23

Samples ADS . NET When the user clicks the "Write" button ont the form, the variables MAIN. Time1 and MAIN. Date1 are wirtten to the PLC. The class Ads Binary Writer, that derives from Binary Writer, is used to write the time and date to the PLC. The method Ads Binary Writer. Write Plc Type writes the . NET types Time Span and Date Time in the PLC format for time and date types to the Ads Stream. C# program using System; using System. Drawing; using System. Collections; using System. Component Model; using System. Windows. Forms; using System. Data; using Twin CAT. Ads; using System. IO; namespace Sample04 { public class Form1 : System. Windows. Forms. Form { private System. Component Model. Container components = null; private System. Windows. Forms. Text Box text Box1; private System. Windows. Forms. Button btn Read; private System. Windows. Forms. Button btn Write; private System. Windows. Forms. Label label1; private Tc Ads Client ads Client; private int[] var Handles; public Form1() { Initialize Component(); } protected override void Dispose( bool disposing ) { ... } private void Initialize Component() { ... } [STAThread] static void Main() { Application. Run(new Form1()); } private void Form1_Load(object sender, System. Event Args e) { try { ads Client = new Tc Ads Client(); // PLC1 Port - Twin CAT 3 = 851 ads Client. Connect(851); var Handles = new int[2]; var Handles[0] = ads Client. Create Variable Handle("MAIN. Time1"); var Handles[1] = ads Client. Create Variable Handle("MAIN. Date1"); } catch( Exception err) { Message Box. Show(err. Message); } } private void Form1_Closing(object sender, System. Component Model. Cancel Event Args e) { ADS-DLL . NET Samples Version: 1.2 23
## Page 24

Samples ADS . NET ads Client. Dispose(); } private void btn Read_Click(object sender, System. Event Args e) { try { Ads Stream ads Stream = new Ads Stream(4); Ads Binary Reader reader = new Ads Binary Reader(ads Stream); ads Client. Read(var Handles[0], ads Stream); text Box1. Text = reader. Read Plc TIME(). To String(); ads Stream. Position = 0; ads Client. Read(var Handles[1], ads Stream); text Box2. Text = reader. Read Plc DATE(). To String(); } catch(Exception err) { Message Box. Show(err. Message) } } private void btn Write_Click(object sender, System. Event Args e) { try { Ads Stream ads Stream = new Ads Stream(4); Ads Binary Writer writer = new Ads Binary Writer(ads Stream); writer. Write Plc Type(Time Span. Parse(text Box1. Text)); ads Client. Write(var Handles[0], ads Stream); ads Stream. Position = 0; writer. Write Plc Type(Date Time. Parse(text Box2. Text)); ads Client. Write(var Handles[1], ads Stream) } catch(Exception err) { Message Box. Show(err. Message); } } } } PLC program PROGRAM MAIN VAR Time1:TIME := T#21h33m23s231ms; Date1:DT:=DT#1993-06-12-15:36:55.40; END_VAR 3.6 Read PLC variable declaration Download Requirements Language / IDE Unpack the example program C# / Visual Studio Sample06.zip Task All variables that are declared in the PLC should be displayed in a tree view. 24 Version: 1.2 ADS-DLL . NET Samples
## Page 25

Samples ADS . NET Description In the Form1_Load method an instance of the Tc Ads Symbol Info Loader is created with a call to Tc Ads Client. Create Symbol Info Loader. This class is responsible for loading the symbol information from the PLC. By clicking the Load Symbols button the symbols are loaded by means of the Tc Ads Symbol Info Loader. Get First Symbol method. This method returns the first loaded symbol as a Tc Ads Symbol Info object. The methods Tc Ads Symbol Info. Next Symbol und Tc Ads Symbol Info. First Sub Symbol are used to iterate over the symbols and to display the symbols hierarchically in the tree view. If the check box flat is checked, the symbols are displayed in a flat list. In this case foreach is used to enumerate over the symbols loaded by the Tc Ads Symbol Info Loader object. This includes the sub symbols. By selecting a tree view item the edit boxes are filled with the symbol information. Additionally the value of the variable is read with the help of Tc Ad Client. Read Symbol and is displayed in the value edit box. To write a value to a variable one has to click the Write Value button, which leads to a call of Tc Ads Cient. Write Symbol. To read the symbol information for a specific variable, one can either click the Read Symbol Info or the Find Symbol button. In the first case the method Tc Ads Client. Read Symbol Info is called. This leads to an ADS call, to load the information for this symbol from the PLC. In the second case the method Tc Ads Symbol Info Loader. Find Symbol is called, to search for the symbol in the list of the previous loaded symbols. If no symbols have been loaded before, all symbols are loaded from the PLC. ADS-DLL . NET Samples Version: 1.2 25
## Page 26

Samples ADS . NET C# Programm using System; using System. Drawing; using System. Collections; using System. Component Model; using System. Windows. Forms; using System. Data; using System. IO; using Twin CAT. Ads; namespace Sample06 { /// <summary> /// Summary description for Form1. /// </summary> public class Form1 : System. Windows. Forms. Form 26 Version: 1.2 ADS-DLL . NET Samples
## Page 27

Samples ADS . NET { private System. Windows. Forms. Tree View tree View Symbols; private System. Windows. Forms. Group Box group Box1; private System. Windows. Forms. Button btn Load; private System. Windows. Forms. Label label3; private System. Windows. Forms. Text Box tb Datatype; private System. Windows. Forms. Label label2; private System. Windows. Forms. Text Box tb Index Group; private System. Windows. Forms. Label label1; private System. Windows. Forms. Text Box tb Index Offset; private System. Windows. Forms. Button btn Find Symbol; private System. Windows. Forms. Button btn Read Symbol Info; private System. Windows. Forms. Group Box group Box2; private System. Windows. Forms. Label label4; private System. Windows. Forms. Label label5; private System. Windows. Forms. Text Box tb Datatype Id; private System. Windows. Forms. Label label6; private System. Windows. Forms. Text Box tb Value; /// <summary> /// Required designer variable. /// </summary> private System. Component Model. Container components = null; private Tc Ads Client ads Client; private System. Windows. Forms. Text Box tb Symbolname; private System. Windows. Forms. Label label9; private System. Windows. Forms. Text Box tb Size; private System. Windows. Forms. Button btn Write; private Tc Ads Symbol Info Loader symbol Loader; private System. Windows. Forms. Text Box tb Name; private System. Windows. Forms. Label label7; private System. Windows. Forms. Check Box cb Flat; private ITc Ads Symbol current Symbol = null; public Form1() { Initialize Component(); } /// <summary> /// Clean up any resources being used. /// </summary> protected override void Dispose( bool disposing ) { if( disposing ) { if (components != null) { components. Dispose(); } } base. Dispose( disposing ); } #region Windows Form Designer generated code ... #endregion /// <summary> /// The main entry point for the application. /// </summary> [STAThread] static void Main() { Application. Run(new Form1()); } private void Form1_Load(object sender, System. Event Args e) { try { ads Client = new Tc Ads Client(); // Connect to local PLC - Runtime 1 - Twin CAT 3 Port=851 ads Client. Connect(851); symbol Loader = ads Client. Create Symbol Info Loader(); } catch(Exception err) { Message Box. Show(err. Message); ADS-DLL . NET Samples Version: 1.2 27
## Page 28

Samples ADS . NET } } private void btn Load_Click(object sender, System. Event Args e) { tree View Symbols. Nodes. Clear(); if( !cb Flat. Checked ) { Tc Ads Symbol Info symbol = symbol Loader. Get First Symbol(true); while( symbol != null ) { tree View Symbols. Nodes. Add(Create New Node(symbol)); symbol = symbol. Next Symbol; } } else { foreach( Tc Ads Symbol Info symbol in symbol Loader ) { Tree Node node = new Tree Node(symbol. Name); node. Tag = symbol; tree View Symbols. Nodes. Add(node); } } } private void btn Read Symbol Info_Click(object sender, System. Event Args e) { try { ITc Ads Symbol symbol = ads Client. Read Symbol Info(tb Symbolname. Text); if( symbol == null) { Message Box. Show("Symbol " + tb Symbolname. Text + " not found"); return; } Set Symbol Info(symbol); } catch( Exception err ) { Message Box. Show(err. Message); } } private void btn Find Symbol_Click(object sender, System. Event Args e) { try { ITc Ads Symbol symbol = symbol Loader. Find Symbol(tb Symbolname. Text); if( symbol == null) { Message Box. Show("Symbol " + tb Symbolname. Text + " not found"); return; } Set Symbol Info(symbol); } catch( Exception err ) { Message Box. Show(err. Message); } } private void btn Write_Click(object sender, System. Event Args e) { try { if( current Symbol != null ) ads Client. Write Symbol(current Symbol, tb Value. Text); } catch(Exception err) { Message Box. Show("Unable to write Value. " + err. Message); } } private void tree View Symbols_After Select(object sender, System. Windows. Forms. Tree View Event Args e) { if( e. Node. Text. Length > 0 ) { 28 Version: 1.2 ADS-DLL . NET Samples
## Page 29

Samples ADS . NET if( e. Node. Tag is Tc Ads Symbol Info ) { Set Symbol Info((ITc Ads Symbol)e. Node. Tag); } } } private Tree Node Create New Node(Tc Ads Symbol Info symbol) { Tree Node node = new Tree Node(symbol. Name); node. Tag = symbol; Tc Ads Symbol Info sub Symbol = symbol. First Sub Symbol; while( sub Symbol != null ) { node. Nodes. Add(Create New Node(sub Symbol)); sub Symbol = sub Symbol. Next Symbol; } return node; } private void Set Symbol Info(ITc Ads Symbol symbol) { current Symbol = symbol; tb Name. Text = symbol. Name. To String(); tb Index Group. Text = symbol. Index Group. To String(); tb Index Offset. Text = symbol. Index Offset. To String(); tb Size. Text = symbol. Size. To String(); tb Datatype. Text = symbol. Type; tb Datatype Id. Text = symbol. Datatype. To String(); try { tb Value. Text = ads Client. Read Symbol(symbol). To String(); } catch( Ads Datatype Not Supported Exception err ) { tb Value. Text = err. Message; } catch(Exception err) { Message Box. Show("Unable to read Symbol Info. " + err. Message); } } } } PLC program PROGRAM MAIN VAR REAL32_1 AT %MB0 : REAL; (* 1 *) REAL32_2 AT %MB4 : REAL; (* 2 *) REAL32_3 AT %MB8 : REAL; (* 3 *) REAL32_4 AT %MB12: REAL; (* 4 *) REAL32_5 AT %MB16: REAL; (* 5 *) REAL64_1 AT %MB20 : LREAL; (* 6 *) REAL64_2 AT %MB28 : LREAL; (* 7 *) REAL64_3 AT %MB36 : LREAL; (* 8 *) REAL64_4 AT %MB44 : LREAL; (* 9 *) REAL64_5 AT %MB52 : LREAL; (* 10 *) INT32_1 AT %MB60 : DINT; (* 11 *) INT32_2 AT %MB64 : DINT; (* 12 *) INT32_3 AT %MB68 : DINT; (* 13 *) INT32_4 AT %MB72 : DINT; (* 14 *) INT32_5 AT %MB76 : DINT; (* 15 *) UINT32_1 AT %MB80 : UDINT; (* 16 *) UINT32_2 AT %MB84 : UDINT; (* 17 *) UINT32_3 AT %MB88 : UDINT; (* 18 *) UINT32_4 AT %MB92 : UDINT; (* 19 *) UINT32_5 AT %MB96 : UDINT; (* 20 *) INT16_1 AT %MB100 : INT; (* 21 *) INT16_2 AT %MB102 : INT; (* 22 *) ADS-DLL . NET Samples Version: 1.2 29
## Page 30

Samples ADS . NET INT16_3 AT %MB104 : INT; (* 23 *) INT16_4 AT %MB106 : INT; (* 24 *) INT16_5 AT %MB108 : INT; (* 25 *) UINT16_1 AT %MB110 : UINT; (* 26 *) UINT16_2 AT %MB112 : UINT; (* 27 *) UINT16_3 AT %MB114 : UINT; (* 28 *) UINT16_4 AT %MB116 : UINT; (* 29 *) UINT16_5 AT %MB118 : UINT; (* 30 *) INT8_1 AT %MB120 : SINT; (* 31 *) INT8_2 AT %MB121 : SINT; (* 32 *) INT8_3 AT %MB122 : SINT; (* 33 *) INT8_4 AT %MB123 : SINT; (* 34 *) INT8_5 AT %MB124 : SINT; (* 35 *) UINT8_1 AT %MB125 : USINT; (* 36 *) UINT8_2 AT %MB126 : USINT; (* 37 *) UINT8_3 AT %MB128 : USINT; (* 38 *) UINT8_4 AT %MB129 : USINT; (* 39 *) UINT8_5 AT %MB130 : USINT; (* 40 *) BOOL_1 AT %MX131.0 : BOOL; (* 41 *) BOOL_2 AT %MX131.1 : BOOL; (* 42 *) BOOL_3 AT %MX131.2 : BOOL; (* 43 *) BOOL_4 AT %MX131.3 : BOOL; (* 44 *) BOOL_5 AT %MX131.4 : BOOL; (* 45 *) ARRAY_1 : ARRAY[1 .. 10] OF SINT; (* 46 *) ARRAY_2 : ARRAY[1 .. 10] OF INT; (* 47 *) ARRAY_3 : ARRAY[1 .. 10] OF DINT; (* 48 *) ARRAY_4 : ARRAY[1 .. 10] OF LREAL;(* 49 *) ARRAY_5 : ARRAY[1 .. 10] OF BOOL; (* 50 *) STRING_1 : STRING(20); END_VAR 3.7 Reading and writing of PLC variables of any type (Read Any, Write Any) Download Requirements Language / IDE Unpack the example program C# / Visual Studio Sample07.zip Task Read and Write variables of any type with the help of the Read Any and Write Any methods. Description Read Any In the event method btn Read_Click the method Tc Ads Client. Read Any is used to read a variable by handle: public object Read Any(int variable Handle, Type type) public object Read Any(int variable Handle, Type type, int[] args) Read Any Read Any 30 Version: 1.2 ADS-DLL . NET Samples
## Page 31

Samples ADS . NET The type of the variable is passed to the method in the parameter type. In case the method was successfull, the read data will be returned as a object. The type of the object is equal to the type passed in the parameter type. Because some data types(arrays and strings) need additional information, an overload of the method Read Any exists, that takes an additional parameter args. E.g. with strings one has to pass an integer array of the length 1. Full list of supported types can be found in the documentation of the overloaded method. Example: A PLC variable of the type ARRAY[0..3] OF DINT should be read: int h Arr; int[] arr; h Arr = ads Client. Create Variable Handle(".arr") arr = (int[]) ads Client. Read Any(h Arr, typeof(int[]), new int[] {4}) ... ads Client. Delete Variable Handle(h Arr) Write Any In the event method btn Write_Click the method Tc Ads Client. Write Any is used to write to a variable by handle: public void Write Any(int variable Handle, object value) public void Write Any(int variable Handle, object value, int[] args) Write Any Write Any The parameter value is a reference to the object, that should be written to the PLC variable. Full list of supported types of the object value can be found in the documentation of the overloaded method. Example: A PLC variable of the type ARRAY[0..3] OF DINT should be written: int h Arr; int[] arr = new int[]{1,2,3,4} h Arr = ads Client. Create Variable Handle(".arr") ads Client. Write Any(h Arr, arr) ... ads Client. Delete Variable Handle(h Arr) Reading and writing of structures: (not possible with the Compact Framework(CE) ) To be able to read or write PLC structures the memory layout of the structure or class in . NET must be the same as in the PLC. The layout of a structure or class can be specified with the attribute Struct Layout Attribute. The Layout Kind must be set to Layout Kind. Sequential and the pack must be set to 1. Therefore the class Simple Struct is defined as followed: [Struct Layout(Layout Kind. Sequential, Pack=1)] public class Simple Struct { public double lreal Val; public int dint Val1; } If arrays, strings or boolean values are define the class, one has to specify how these fields should be marshalled. This is accomplished with help of the Marshal As attribute. Because arrays and strings do not have a fixed length in . NET, the property Size Const is necessary for arrays and strings. It is not possible to marshal multidimensional arrays or arrays of structures with the :NET Framework 1.1. Multidimensional arrays in the PLC must be mapped to one dimensional arrays in . NET. ADS-DLL . NET Samples Version: 1.2 31
## Page 32

Samples ADS . NET In the example the Marshal As Attribute is used in the class Complex Struct: [Struct Layout(Layout Kind. Sequential, Pack=1)] public class Complex Struct { public short int Val; //specifies how . NET should marshal the array //Size Const specifies the number of elements the array has. [Marshal As(Unmanaged Type. By Val Array, Size Const=4)] public int[] dint Arr = new int[4]; [Marshal As(Unmanaged Type. I1)] public bool bool Val; public byte byte Val; //specifies how . NET should marshal the string //Size Const specifies the number of characters the string has. //'(inclusive the terminating null ). [Marshal As(Unmanaged Type. By Val TStr, Size Const=6)] public string string Val = ""; public Simple Struct simple Struct1 =new Simple Struct(); } Register ADS notifcations In the event method btn Add Notifications_Click the method Add Device Notification Ex is used to register notifications for a PLC variable. If the value of a variable changes the event Ads Notification Ex is fired. The difference to the event Ads Notification, is that the value of the variable is stored in an object instead of in an Ads Stream. Therefore one has to pass the type of the object to the method Add Device Notification Ex: notification Handles. Add(ads Client. Add Device Notification Ex("MAIN.dint1", Ads Trans Mode. On Change, 100, 0, tb Dint1, typeof(int))); As user object the textbox that should display the value is passed. If the event is fired, the event method ads Client_Ads Notification Ex is called. For this the event must be registered in the Form_Load method. ads Client. Ads Notification Ex+=new Ads Notification Ex Event Handler(ads Client_Ads Notification Ex); 32 Version: 1.2 ADS-DLL . NET Samples
## Page 33

Samples ADS . NET C# program using System; using System. Drawing; using System. Collections; using System. Component Model; using System. Windows. Forms; using System. Data; using System. Runtime. Interop Services; using Twin CAT. Ads; namespace Sample07 { /// <summary> /// Summary description for Form1. /// </summary> public class Form1 : System. Windows. Forms. Form { internal System. Windows. Forms. Button btn Delete Notifications; internal System. Windows. Forms. Button btn Add Notifications; internal System. Windows. Forms. Button btn Write; internal System. Windows. Forms. Button btn Read; internal System. Windows. Forms. Group Box Group Box3; internal System. Windows. Forms. Text Box tb Complex Struct_dint Arr; internal System. Windows. Forms. Label Label14; internal System. Windows. Forms. Text Box tb Complex Struct_Byte Val; internal System. Windows. Forms. Label Label13; internal System. Windows. Forms. Text Box tb Complex Struct_Simple Struct1_lreal Val; internal System. Windows. Forms. Label Label12; internal System. Windows. Forms. Text Box tb Complex Struct_Simple Struct_dint Val; internal System. Windows. Forms. Label Label11; internal System. Windows. Forms. Label Label5; internal System. Windows. Forms. Text Box tb Complex Struct_string Val; internal System. Windows. Forms. Label Label3; internal System. Windows. Forms. Text Box tb Complex Struct_bool Val; internal System. Windows. Forms. Label Label9; internal System. Windows. Forms. Text Box tb Complex Struct_Int Val; internal System. Windows. Forms. Label Label10; internal System. Windows. Forms. Group Box Group Box2; internal System. Windows. Forms. Text Box tb Str2; internal System. Windows. Forms. Label Label7; internal System. Windows. Forms. Text Box tb Str1; internal System. Windows. Forms. Label Label8; internal System. Windows. Forms. Group Box Group Box1; internal System. Windows. Forms. Text Box tblreal1; internal System. Windows. Forms. Label Label6; internal System. Windows. Forms. Text Box tb Usint1; internal System. Windows. Forms. Label Label4; internal System. Windows. Forms. Text Box tb Dint1; internal System. Windows. Forms. Label Label2; internal System. Windows. Forms. Text Box tb Bool1; internal System. Windows. Forms. Label Label1; /// <summary> /// Required designer variable. /// </summary> private System. Component Model. Container components = null; //PLC variable handles private int hdint1; private int hbool1; private int husint1; private int hlreal1; private int hstr1; private int hstr2; private int hcomplex Struct; private Array List notification Handles; private Tc Ads Client ads Client; public Form1() { // // Required for Windows Form Designer support // Initialize Component(); } ADS-DLL . NET Samples Version: 1.2 33
## Page 34

Samples ADS . NET /// <summary> /// Clean up any resources being used. /// </summary> protected override void Dispose( bool disposing ) { if( disposing ) { if (components != null) { components. Dispose(); } } base. Dispose( disposing ); } #region Windows Form Designer generated code .. #endregion /// <summary> /// The main entry point for the application. /// </summary> [STAThread] static void Main() { Application. Run(new Form1()); } private void Form1_Load(object sender, System. Event Args e) { ads Client = new Tc Ads Client(); notification Handles = new Array List(); try { // Connect to local PLC - Runtime 1 - Twin CAT 3 Port=851 ads Client. Connect(851); ads Client. Ads Notification Ex+=new Ads Notification Ex Event Handler(ads Client_Ads Notification Ex); btn Delete Notifications. Enabled = false; //create handles for the PLC variables; hbool1 = ads Client. Create Variable Handle("MAIN.bool1"); hdint1 = ads Client. Create Variable Handle("MAIN.dint1"); husint1 = ads Client. Create Variable Handle("MAIN.usint1"); hlreal1 = ads Client. Create Variable Handle("MAIN.lreal1"); hstr1 = ads Client. Create Variable Handle("MAIN.str1"); hstr2 = ads Client. Create Variable Handle("MAIN.str2"); hcomplex Struct = ads Client. Create Variable Handle("MAIN. Complex Struct1"); } catch(Exception ex) { Message Box. Show(ex. Message); } } private void Form1_Closing(object sender, System. Component Model. Cancel Event Args e) { ads Client. Dispose(); } private void btn Read_Click(object sender, System. Event Args e) { try { //read by handle //the second parameter specifies the type of the variable tb Dint1. Text = ads Client. Read Any(hdint1, typeof(int)). To String(); tb Usint1. Text = ads Client. Read Any(husint1, typeof(Byte)). To String(); tb Bool1. Text = ads Client. Read Any(hbool1, typeof(Boolean)). To String(); tblreal1. Text = ads Client. Read Any(hlreal1, typeof(Double)). To String(); //with strings one has to additionally pass the number of characters //specified in the PLC project(default 80). //This value is passed is an int array. tb Str1. Text = ads Client. Read Any(hstr1, typeof(String), new int[] {80}). To String(); tb Str2. Text = ads Client. Read Any(hstr2, typeof(String), new int[] {5}). To String(); Fill Struct Controls((Complex Struct)ads Client. Read Any(hcomplex Struct, typeof(Complex Struct))); } catch(Exception ex) { Message Box. Show(ex. Message); } } 34 Version: 1.2 ADS-DLL . NET Samples
## Page 35

Samples ADS . NET private void btn Write_Click(object sender, System. Event Args e) { try { //write by handle //the second parameter is the object to be written to the PLC variable ads Client. Write Any(hdint1, int. Parse(tb Dint1. Text)); ads Client. Write Any(husint1, Byte. Parse(tb Usint1. Text)); ads Client. Write Any(hbool1, Boolean. Parse(tb Bool1. Text)); ads Client. Write Any(hlreal1, Double. Parse(tblreal1. Text)); //with strings one has to additionally pass the number of characters //the variable has in the PLC(default 80). ads Client. Write Any(hstr1, tb Str1. Text, new int[] {80}); ads Client. Write Any(hstr2, tb Str2. Text, new int[] {5}); ads Client. Write Any(hcomplex Struct, Get Struct From Controls()) ; } catch(Exception ex) { Message Box. Show(ex. Message); } } private void btn Add Notifications_Click(object sender, System. Event Args e) { notification Handles. Clear(); try { //register notification notification Handles. Add(ads Client. Add Device Notification Ex("MAIN.dint1", Ads Trans Mode. On Change, 100, 0, tb Dint1, typeof(int))); notification Handles. Add(ads Client. Add Device Notification Ex("MAIN.usint1", Ads Trans Mode. On Change, 100, 0, tb Usint1, typeof(Byte))); notification Handles. Add(ads Client. Add Device Notification Ex("MAIN.bool1", Ads Trans Mode. On Change, 100, 0, tb Bool1, typeof(Boolean))); notification Handles. Add(ads Client. Add Device Notification Ex("MAIN.lreal1", Ads Trans Mode. On Change, 100, 0, tblreal1, typeof(Double))); notification Handles. Add(ads Client. Add Device Notification Ex("MAIN.str1", Ads Trans Mode. On Change, 100, 0, tb Str1, typeof(String), new int[] {80})); notification Handles. Add(ads Client. Add Device Notification Ex("MAIN.str2", Ads Trans Mode. On Change, 100, 0, tb Str2, typeof(String), new int[] {5})); notification Handles. Add(ads Client. Add Device Notification Ex("MAIN.complex Struct1", Ads Trans Mode. On Change, 100, 0, tb Dint1, typeof(Complex Struct))); } catch(Exception ex) { Message Box. Show(ex. Message); } btn Delete Notifications. Enabled = true; btn Add Notifications. Enabled = false; } private void btn Delete Notifications_Click(object sender, System. Event Args e) { //delete registered notifications. try { foreach(int handle in notification Handles) ads Client. Delete Device Notification(handle); } catch(Exception ex) { Message Box. Show(ex. Message); } notification Handles. Clear(); btn Add Notifications. Enabled = true; btn Delete Notifications. Enabled = false; } private void ads Client_Ads Notification Ex(object sender, Ads Notification Ex Event Args e) { Text Box text Box = (Text Box)e. User Data; Type type = e. Value. Get Type(); if(type == typeof(string) || type. Is Primitive) text Box. Text = e. Value. To String(); else if(type == typeof(Complex Struct)) Fill Struct Controls((Complex Struct)e. Value); } private void Fill Struct Controls(Complex Struct structure) ADS-DLL . NET Samples Version: 1.2 35
## Page 36

Samples ADS . NET { tb Complex Struct_Int Val. Text = structure.int Val. To String(); tb Complex Struct_dint Arr. Text = String. Format("{0:d}, {1:d}, {2:d}, {3:d}", structure.dint Arr[0], structure.dint Arr[1], structure.dint Arr[2], structure.dint Arr[3]); tb Complex Struct_bool Val. Text = structure.bool Val. To String(); tb Complex Struct_Byte Val. Text = structure.byte Val. To String(); tb Complex Struct_string Val. Text = structure.string Val; tb Complex Struct_Simple Struct1_lreal Val. Text = structure.simple Struct1.lreal Val. To String(); tb Complex Struct_Simple Struct_dint Val. Text = structure.simple Struct1.dint Val1. To String(); } private Complex Struct Get Struct From Controls() { Complex Struct structure = new Complex Struct(); String[] string Arr = tb Complex Struct_dint Arr. Text. Split(new char[] {','}); structure.int Val = short. Parse(tb Complex Struct_Int Val. Text); for(int i=0; i<string Arr. Length; i++) structure.dint Arr[i] = int. Parse(string Arr[i]); structure.bool Val = Boolean. Parse(tb Complex Struct_bool Val. Text); structure.byte Val = Byte. Parse(tb Complex Struct_Byte Val. Text); structure.string Val = tb Complex Struct_string Val. Text; structure.simple Struct1.dint Val1 = int. Parse(tb Complex Struct_Simple Struct_dint Val. Text); structure.simple Struct1.lreal Val = double. Parse(tb Complex Struct_Simple Struct1_lreal Val. Text); return structure; } } // Twin CAT2 Pack = 1, Twin CAT 3 Pack = 0 [Struct Layout(Layout Kind. Sequential, Pack=0)] public class Simple Struct { public double lreal Val; public int dint Val1; } // Twin CAT2 Pack = 1, Twin CAT3 Pack = 0 [Struct Layout(Layout Kind. Sequential, Pack=0)] public class Complex Struct { public short int Val; //specifies how . NET should marshal the array //Size Const specifies the number of elements the array has. [Marshal As(Unmanaged Type. By Val Array, Size Const=4)] public int[] dint Arr = new int[4]; [Marshal As(Unmanaged Type. I1)] public bool bool Val; public byte byte Val; //specifies how . NET should marshal the string //Size Const specifies the number of characters the string has. //'(inclusive the terminating null ). [Marshal As(Unmanaged Type. By Val TStr, Size Const=6)] public string string Val = ""; public Simple Struct simple Struct1 =new Simple Struct(); } } PLC program TYPE TSimple Struct : STRUCT lreal Val: LREAL := 1.23; dint Val1: DINT := 120000; END_STRUCT END_TYPE TYPE TComplex Struct : STRUCT int Val : INT:=1200; dint Arr: ARRAY[0..3] OF DINT:= 1,2,3,4; bool Val: BOOL := FALSE; byte Val: BYTE:=10; string Val : STRING(5) := 'hallo'; simple Struct1: TSimple Struct; END_STRUCT END_TYPE 36 Version: 1.2 ADS-DLL . NET Samples
## Page 37

Samples ADS . NET PROGRAM MAIN VAR (*primitive Types*) Bool1:BOOL := FALSE; int1:INT := 30000; dint1:DINT:=125000; usint1:USINT:=200; real1:REAL:= 1.2; lreal1:LREAL:=3.5; (*string Types*) str1:STRING := 'this is a test string'; str2:STRING(5) := 'hallo'; (*struct Types*) complex Struct1 : TComplex Struct; END_VAR 3.8 Detect state changes in Twin CAT router and PLC Download Requirements Language / IDE Extract the sample program C# / Visual Studio Sample08.zip Task Detect state changes in Twin CAT router and PLC. Description State changes in ADS devices can be detected effectivly by registering callback functions to the devices. These function are called on state changes of the ADS devices. State changes in the Twin CAT router can be detected via the Tc Ads Client. Ams Router Notification in the Tc Ads Client class . In order to detect state changes in the PLC an ADS Notification to the ADS status word has to be registered. Callback functions can be registered for both. These are called on state changes of the devices. The following program monitors the state of the Twin CAT router and the PLC using the above techniques. C# Program using System; using System. Collections. Generic; using System. Component Model; using System. Data; using System. Drawing; using System. Text; using System. Windows. Forms; using System. IO; using Twin CAT. Ads; namespace Twin CATAds_Sample08 { public partial class Form1 : Form { private Tc Ads Client _tc Client = null; private Ads Stream _ads Stream = null; private Binary Reader _bin Read = null; private int _notification Handle = 0; public Form1() { Initialize Component(); ADS-DLL . NET Samples Version: 1.2 37
## Page 38

Samples ADS . NET } private void Form1_Load(object sender, Event Args e) { try { _tc Client = new Tc Ads Client(); // Connect to local PLC - Runtime 1 - Twin CAT3 Port=851 _tc Client. Connect(851); _ads Stream = new Ads Stream(2); /* stream for storing the ADS state of the PLC */ _bin Read = new Binary Reader(_ads Stream); /* reader for reading the state */ /* register callback function to detect state changes in the router */ _tc Client. Ams Router Notification += new Ams Router Notification Event Handler(Ams Router Notification Callback); /* register an ADS notification an the ADS status word of the PLC */ _notification Handle = _tc Client. Add Device Notification( (int)Ads Reserved Index Groups. Device Data, /* index group of the device state*/ (int)Ads Reserved Index Offsets. Device Data Ads State, /*index offset of the device state */ _ads Stream, /* stream to store the state */ Ads Trans Mode. On Change, /* transfer mode: transmit ste on change */ 0, /* transmit changes immediately */ 0, null); /* register callback function to react on notifications */ _tc Client. Ads Notification += new Ads Notification Event Handler(On Ads Notification); } catch (Ads Error Exception ex) { Message Box. Show(ex. Message); } } /* callback function called on state changes of the router */ void On Ads Notification(object sender, Ads Notification Event Args e) { if (e. Notification Handle == _notification Handle) { Ads State plc State = (Ads State)_bin Read. Read Int16(); /* state was written to the stream */ _plc Label Value. Text = plc State. To String(); } } /* Ccallback function called on state changes of the PLC */ void Ams Router Notification Callback(object sender, Ams Router Notification Event Args e) { _router Label Value. Text = e. State. To String(); } private void _exit Button_Click(object sender, Event Args e) { this. Close(); } private void Form1_Form Closing(object sender, Form Closing Event Args e) { try { _tc Client. Delete Device Notification(_notification Handle); _tc Client. Dispose(); } catch(Ads Error Exception ex) { Message Box. Show(ex. Message); } } } } 38 Version: 1.2 ADS-DLL . NET Samples
## Page 39

Samples ADS . NET 3.9 ADS-Sum Command: Reading or writing several variables Download Requirements Language / IDE Extract the sample program C# / Visual Studio Sample09.zip Using the ADS Sum Command it is possible to read or write several variables in one command. Designed as Tc Ads Client. Read Write it is used as a container, which transports all sub-commands in one ADS stream. Fig. 1: Twin CAT. Ads_Sample8 In the beginning it's important, binding 'Twin CAT. Ads.dll' to your project! To do so, open 'Solution Explorer' and choose 'Add References...' via'References'. 'Browse' for the DLL in the folder 'Twin CAT -> ADS API -> . NET' . C# program 1. Read variables First, define two structures: namespace Ads Block Read { // Structure declaration for values internal struct My Struct { public ushort uint Value; public int dint Value; public bool bool Value; } // Structure declaration for handles internal struct Variable Info { public int index Group; public int index Offset; public int length; } and declare some global variables. public class Form1 : System. Windows. Forms. Form { [...] ADS-DLL . NET Samples Version: 1.2 39
## Page 40

Samples ADS . NET private Tc Ads Client ads Client; private string[] variable Names; private int[] variable Lengths; Variable Info[] variables; On applications start an ADS connection to PLC is established and Handle parameters are written into the structure. private void Form1_Load(object sender, System. Event Args e) { try { // Connect to PLC ads Client = new Tc Ads Client(); ads Client. Connect(851); // Fill structures with name and size of PLC variables variable Names = new string[] { "MAIN.uint Value", "MAIN.dint Value", "MAIN.bool Value" }; variable Lengths = new int[] { 2, 4, 1 }; // Write handle parameter into structure variables = new Variable Info[variable Names. Length]; for (int i = 0; i < variables. Length; i++) { variables[i].index Group = (int)Ads Reserved Index Groups. Symbol Value By Handle; variables[i].index Offset = ads Client. Create Variable Handle(variable Names[i]); variables[i].length = variable Lengths[i]; } } catch (Exception err) { Message Box. Show(err. Message); ads Client = null; } } After clicking 'Read' Button, 'Block Read' method returns an ADS Stream. Check for ADS return codes (Err) for error handling, before data is read out of the stream und stored in the text boxes. private void button1_Click(object sender, System. Event Args e) { if (ads Client == null) return; try { // Get the ADS return codes and examine for errors Binary Reader reader = new Binary Reader(Block Read(variables)); for (int i = 0; i < variables. Length; i++) { int error = reader. Read Int32(); if (error != (int)Ads Error Code. No Error) System. Diagnostics. Debug. Write Line( String. Format("Unable to read variable {0} (Error = {1})", i, error)); } // Read the data from the ADS stream My Struct my Struct; my Struct.uint Value = reader. Read UInt16(); my Struct.dint Value = reader. Read Int32(); my Struct.bool Value = reader. Read Boolean(); // Write data from the structure into the text boxes tb Uint. Text = my Struct.uint Value. To String(); tb Dint. Text = my Struct.dint Value. To String(); tb Bool. Text = my Struct.bool Value. To String(); } catch (Exception err) { Message Box. Show(err. Message); } } 40 Version: 1.2 ADS-DLL . NET Samples
## Page 41

Samples ADS . NET 'Block Read' methode takes an object of type 'Variable Info[]', where the handle parameters are strored. After reserving memory for the values to be read an write, an ADS stream is written with the parameters delivered by 'Variable Info[]'. At the end the sum command transfers the commands and an ADS stream is returned. private Ads Stream Block Read(Variable Info[] variables) { // Allocate memoryint rd Length = variables. Length * 4; int wr Length = variables. Length * 12; // Write data for handles into the ADS Stream Binary Writer writer = new Binary Writer(new Ads Stream(wr Length)); for (int i = 0; i < variables. Length; i++) { writer. Write(variables[i].index Group); writer. Write(variables[i].index Offset); writer. Write(variables[i].length); rd Length += variables[i].length; } // Sum command to read variables from the PLCAds Stream rd Stream = new Ads Stream(rd Length); ads Client. Read Write(0x F080, variables. Length, rd Stream, (Ads Stream)writer. Base Stream); // Return the ADS error codesreturn rd Stream; } Sum Command's Parameters consists of Index Group (0x F080) - sum command call, Index Offset (variables. Length) - number of sub commands, rd Data Stream (rd Stream) - memory, taking the read values, wr Data Stream (writer. Base Stream) - memory, containing values to be written. sub commands in wr Data Stream Fig. 2: Twin CAT. Ads_Sample9 response in rd Data Stream Fig. 3: Twin CAT. Ads_Sample10 2. writing variables After clicking 'Write' button, 'Block Read2' methode returns an ADS stream. Following is a check of ADS return codes (Err) for error handlings. private void button2_Click(object sender, Event Args e) { if (ads Client == null) return; try { // Get the ADS return codes and examine for errors Binary Reader reader = new Binary Reader(Block Read2(variables)); for (int i = 0; i < variables. Length; i++) { int error = reader. Read Int32(); if (error != (int)Ads Error Code. No Error) System. Diagnostics. Debug. Write Line( String. Format("Unable to read variable {0} (Error = {1})", i, error)); } } catch (Exception err) ADS-DLL . NET Samples Version: 1.2 41
## Page 42

Samples ADS . NET { Message Box. Show(err. Message); } } 'Block Read2' methode takes an object of type 'Variable Info[]', where handle parameters are stored. After reserving memory for the values to be read an write, 'My Struct' object is filled with the values stored in the textboxes. Next, an ADS stream containing parameters from 'Variable Info[]' objects an the values of 'My Struct' object is written. At the end sum command transfers the commands and an ADS Stream is returned. private Ads Stream Block Read2(Variable Info[] variables) { // Allocate memoryint rd Length = variables. Length * 4; int wr Length = variables. Length * 12 + 7; Binary Writer writer = new Binary Writer(new Ads Stream(wr Length)); My Struct my Struct; my Struct.uint Value = ushort. Parse(tb Uint2. Text); my Struct.dint Value = int. Parse(tb Dint2. Text); my Struct.bool Value = bool. Parse(tb Bool2. Text); // Write data for handles into the ADS streamfor (int i = 0; i < variables. Length; i++) { writer. Write(variables[i].index Group); writer. Write(variables[i].index Offset); writer. Write(variables[i].length); } // Write data to send to PLC behind the structure writer. Write(my Struct.uint Value); writer. Write(my Struct.dint Value); writer. Write(my Struct.bool Value); // Sum command to write the data into the PLCAds Stream rd Stream = new Ads Stream(rd Length); ads Client. Read Write(0x F081, variables. Length, rd Stream, (Ads Stream)writer. Base Stream); // Return the ADS error codesreturn rd Stream; } Sum Command's Parameters consists of Index Group (0x F081) - sum command call, Index Offset (variables. Length) - number of sub commands, rd Data Stream (rd Stream) - memory, taking the read values, wr Data Stream (writer. Base Stream) - memory, containing values to be written. sub commands in wr Data Stream Fig. 4: Twin CAT. Ads_Sample11 response in rd Data Stream Fig. 5: Twin CAT. Ads_Sample12 42 Version: 1.2 ADS-DLL . NET Samples
## Page 43

Samples ADS . NET 3.10 Free Sample Download Language / IDE Extract the sample program Visual C# - 3.11 Delete a handle of a PLC variable Download Requirements Language / IDE Extract the sample program C# / Visual Studio Sample11.zip Description This Sample shows how to delete a handle of a PLC variable: C# program static void Main(string[] args) { //Create a new instance of class Tc Ads Client Tc Ads Client tc Client = new Tc Ads Client(); int i Handle = 0; try { // Connect to local PLC - Runtime 1 - Twin CAT 3 Port=851 tc Client. Connect(851); //Get the handle of the PLC variable "PLCVar" i Handle = tc Client. Create Variable Handle("MAIN. PLCVar"); //Release the specific handle of "PLCVar" tc Client. Delete Variable Handle(i Handle); } catch (Exception ex) { Console. Write Line(ex. Message); Console. Read Key(); } finally { tc Client. Dispose(); } } 3.12 Read flag synchronously from the PLC Download Requirements Language / IDE Extract the sample program C# / Visual Studio Sample12.zip ADS-DLL . NET Samples Version: 1.2 43
## Page 44

Samples ADS . NET Description In this example program the value in flag double word 0 in the PLC is read and displayed on the screen: C# program static void Main(string[] args) { //Create a new instance of class Tc Ads Client Tc Ads Client tc Client = new Tc Ads Client(); try { // Connect to local PLC - Runtime 1 - Twin CAT 2 Port=801, Twin CAT 3 Port=851 tc Client. Connect(801); //Specify Index Group, Index Offset and read SPSVar int i Flag = (int)tc Client. Read Any(0x4020, 0x0, typeof(Int32)); Console. Write Line("" + i Flag); Console. Read Key(); } catch (Exception ex) { Console. Write Line(ex. Message); Console. Read Key(); } finally { tc Client. Dispose(); } } 3.13 Write flag synchronously into the PLC Download Requirements Language / IDE Extract the sample program C# / Visual Studio Sample13.zip Description In this example program, the value that the user has entered is written into flag double word 0: C# program static void Main(string[] args) { //Create a new instance of class Tc Ads Client Tc Ads Client tc Client = new Tc Ads Client(); try { // Connect to local PLC - Runtime 1 - Twin CAT 3 Port=851 tc Client. Connect(851); //Specify Index Group, Index Offset and write SPSVar int i New Value = 0; tc Client. Write Any(0x4020, 0x0, i New Value); } catch (Exception ex) { Console. Write Line(ex. Message); Console. Read Key(); } finally 44 Version: 1.2 ADS-DLL . NET Samples
## Page 45

Samples ADS . NET { tc Client. Dispose(); } } 3.14 Start/stop PLC Download Requirements Language / IDE Extract the sample program C# / Visual Studio Sample14.zip Description The following program starts or stops run-time system 1 in the PLC: C# program static void Main(string[] args) { //Create a new instance of class Tc Ads Client Tc Ads Client tc Client = new Tc Ads Client(); try { // Connect to local PLC - Runtime 1 - Twin CAT 3 Port=851 tc Client. Connect(851); Console. Write Line(" PLC Run\t[R]"); Console. Write Line(" PLC Stop\t[S]"); Console. Write Line("\r\n Please choose \"Run\" or \"Stop\" and confirm with enter.."); string s Input = Console. Read Line(). To Lower(); //Process user input and apply chosen state do{ switch (s Input) { case "r": tc Client. Write Control(new State Info(Ads State. Run, tc Client. Read State(). Device State)); break; case "s": tc Client. Write Control(new State Info(Ads State. Stop, tc Client. Read State(). Device State)); break; default: Console. Write Line("Please choose \"Run\" or \"Stop\" and confirm with enter.."); s Input = Console. Read Line(). To Lower(); break; } } while (s Input != "r" && s Input != "s"); } catch (Exception ex) { Console. Write Line(ex. Message); Console. Read Key(); } finally { tc Client. Dispose(); } } ADS-DLL . NET Samples Version: 1.2 45
## Page 46

Samples ADS . NET 3.15 Access by variable name Download Requirements Language / IDE Extract the sample program C# / Visual Studio Sample15.zip Description The following program accesses a PLC variable that does not have an address. Access must therefore be made by the variable name. Once the PLC variable in the example program exceeds 10 it is reset to 0: C# program static void Main(string[] args) { //Create a new instance of class Tc Ads Client Tc Ads Client tc Client = new Tc Ads Client(); Ads Stream data Stream = new Ads Stream(4); Ads Binary Reader bin Reader = new Ads Binary Reader(data Stream); int i Handle = 0; int i Value = 0; try { // Connect to local PLC - Runtime 1 - Twin CAT 3 Port=851 tc Client. Connect(851); //Get the handle of the PLC variable "PLCVar" i Handle = tc Client. Create Variable Handle("MAIN. PLCVar"); Console. Write Line("Press enter to continue and any other key to abort.."); do { //Use the handle to read PLCVar tc Client. Read(i Handle, data Stream); i Value = bin Reader. Read Int32(); data Stream. Position = 0; Console. Write Line("Current value is: " + i Value); if (i Value >= 10) { //Reset PLC variable to zero tc Client. Write Any(i Handle, 0); } } while (Console. Read Key(). Key. Equals(Console Key. Enter)); } catch (Exception ex) { Console. Write Line(ex. Message); Console. Read Key(); } finally { //Delete variable handle tc Client. Delete Variable Handle(i Handle); tc Client. Dispose(); } } 46 Version: 1.2 ADS-DLL . NET Samples
## Page 47

Samples ADS . NET 3.16 PLC method call Download: https://infosys.beckhoff.com/content/1033/tc3_adssamples_net/Resources/7860265995/.zip The following program shows how a PLC method can be called from a . NET program via ADS. The following ficure shows that the method parameters ("params") can be transferred directly via ADS and the result ("result") is returned after execution. The methods are called after the execution of the PLC. The remaining computing time of the cycle is available. Procedure The following steps must be observed if you want to offer and call a method in the PLC: 1. Add a method for a block. 2. the method for the ADS access is offered via the following attribute: {attribute 'Tc Rpc Enable'} 1. Create a handle for the method for the following symbol with the syntax: Function block_Name#Methods_Name The method can then be called using the following ADS Read/Write command: ADS Read/Write Parameter: Index group: ADSIGRP_SYM_VALBYHND (0x F005) Offset: Methods Handle (h Method) Read Data: ADS data with the return value of the method Write Data: ADS data with the transfer Constraints If you call methods using ADS, you must note the following points: • CPU time: If the methods require more processing time than is available, real-time overruns can occur. • Breakpoints: Are not supported within the methods and can generate exceptions. • Pointer: If a pointer points to an array of elements, the attribute Tc Rpc Length Is can be used to specify the length. ADS-DLL . NET Samples Version: 1.2 47
## Page 48

Samples ADS . NET len : INT; {attribute 'Tc Rpc Length Is' := 'len'} ptr : POINTER TO BYTE; Requirements Runtime Environment Target System Twin CAT v3.1.0 Build 4016 PC or CX (x86, ARM) 48 Version: 1.2 ADS-DLL . NET Samples
## Page 50

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
