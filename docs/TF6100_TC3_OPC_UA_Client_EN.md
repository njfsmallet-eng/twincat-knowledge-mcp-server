---
title: "TF6100 Twin CAT 3"
product: "TF6100"
category: "Communication"
tags: ["CAT", "OPC", "OPC_UA", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.2.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6100_TC3_OPC_UA_Client_EN.pdf"
release_date: "2025-03-17"
---
Manual | EN TF6100 Twin CAT 3 | OPC UA Client 2025-03-17 | Version: 1.2.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 1.4 Documentation issue status.............................................................................................................. 7 2 Overview.................................................................................................................................................... 8 3 Installation............................................................................................................................................... 10 3.1 System Requirements..................................................................................................................... 10 3.2 Installation....................................................................................................................................... 10 3.3 Licensing......................................................................................................................................... 13 4 Technical introduction............................................................................................................................ 16 4.1 Quick start....................................................................................................................................... 16 4.2 Quick Start (Twin CAT 2)................................................................................................................. 19 4.3 Software architecture...................................................................................................................... 23 4.4 Supported functions........................................................................................................................ 24 4.5 Application directories..................................................................................................................... 25 4.6 Reading variables........................................................................................................................... 25 4.7 Writing variables.............................................................................................................................. 27 4.8 Method calls.................................................................................................................................... 29 4.9 Timestamp and Status Code............................................................................................................ 32 4.10 Structures........................................................................................................................................ 32 4.11 Code generation.............................................................................................................................. 35 4.12 PLCopen function blocks................................................................................................................ 39 4.13 Security........................................................................................................................................... 50 4.13.1 Overview.......................................................................................................................... 50 4.13.2 Certificate exchange........................................................................................................ 51 4.13.3 Authentication.................................................................................................................. 52 4.14 Logging........................................................................................................................................... 53 5 PLC API.................................................................................................................................................... 55 5.1 Tc2_Opc Ua..................................................................................................................................... 55 5.1.1 Data types........................................................................................................................ 55 5.1.2 Function blocks................................................................................................................ 56 5.2 Tc3_PLCopen_Opc Ua.................................................................................................................... 58 5.2.1 Data types........................................................................................................................ 58 5.2.2 Function blocks................................................................................................................ 72 5.2.3 Parameter list................................................................................................................... 92 6 Samples................................................................................................................................................... 94 7 Tutorials................................................................................................................................................... 95 8 Appendix.................................................................................................................................................. 96 8.1 Error diagnosis................................................................................................................................ 96 8.2 Status codes................................................................................................................................... 96 8.2.1 ADS Return Codes........................................................................................................... 96 TF6100 Version: 1.2.0 3
## Page 4

Table of contents 8.2.2 Client I/O........................................................................................................................ 100 8.2.3 Client PLCopen.............................................................................................................. 101 8.3 Support and Service...................................................................................................................... 104 4 Version: 1.2.0 TF6100
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS®, and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. TF6100 Version: 1.2.0 5
## Page 6

Foreword 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.2.0 TF6100
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. 1.4 Documentation issue status Version Change 1.2.x New: TS6100_Installation Licensing under Twin CAT 2 [} 13] Technical introduction/logging [} 53] Parameter list [} 92] 1.1.x New: Supported functions [} 24] Quick Start (Twin CAT 2) [} 19] Security [} 50] Tutorials [} 95] Also see about this 2 Installation [} 10] TF6100 Version: 1.2.0 7
## Page 8

Overview 2 Overview OPC Unified Architecture (OPC UA) is the next generation of the familiar OPC standard. This is a globally standardized communication protocol via which machine data can be exchanged irrespective of the manufacturer and platform. OPC UA already integrates common security standards directly in the protocol. Another major advantage of OPC UA over the conventional OPC standard is its independence from the COM/DCOM system. Detailed information on OPC UA can be found on the web pages of the OPC Foundation. The Twin CAT 3 Function TF6100 OPC UA consists of several software components that enable data exchange with Twin CAT based on OPC UA. The following table provides an overview of the individual product components. Software component Description Twin CAT OPC UA Server Provides an OPC UA Server interface so that UA clients can access the Twin CAT runtime. Twin CAT OPC UA Client Provides OPC UA Client functionality to enable communication with other OPC UA Servers based on PLCopen-standardized function blocks and an easy- to-configure I/O device. Twin CAT OPC UA Configurator Graphical user interface for configuring the Twin CAT OPC UA Server. Twin CAT OPC UA Sample Client Graphical sample implementation of an OPC UA Client in order to carry out a first connection test with the Twin CAT OPC UA Server. Twin CAT OPC UA Gateway Wrapper technology that provides both an OPC COM DA Server interface and OPC UA Server aggregation capabilities. This documentation describes the Twin CAT 3 OPC UA Client, which is a software component that provides an OPC UA Client interface for the Twin CAT Runtime environment. The Twin CAT 3 OPC UA Client can therefore be used to initiate connections with OPC UA servers in order to exchange data with them. 8 Version: 1.2.0 TF6100
## Page 9

Overview The technical use cases range from TCP-based (and therefore non-real-time capable) machine-to-machine communication to machine-to-cloud communication if the OPC UA server to be connected is located in the cloud. The Twin CAT OPC UA Client is technically available in two different variants: 1. As a Twin CAT I/O device 2. As PLC function blocks Further information • For an overview of any functional differences, we recommend our article Supported functions [} 24]. • Please note the System Requirements [} 10] for this product. • For a quick introduction to the product, we recommend our articles Installation [} 10] and Quick start [} 16]. TF6100 Version: 1.2.0 9
## Page 10

Installation 3 Installation 3.1 System Requirements The following system requirements apply for the installation and operation of this product. Client Technical data Description Operating system Windows 10 Windows CE 6/7 Windows Server 2022 Target platforms PC architecture (x86, x64, Arm®) . NET Framework --- Minimum Twin CAT version Twin CAT 3 Minimum Twin CAT installation level Twin CAT 3 XAE, XAR Required Twin CAT license TF6100 TC3 OPC UA Sample Server Technical data Description Operating system Windows 10 Windows Server 2022 Target platforms PC architecture (x86, x64) . NET Framework 4.7.2 Minimum Twin CAT version --- Minimum Twin CAT installation level --- Required Twin CAT license --- 3.2 Installation Depending on the Twin CAT version and operating system used, this Twin CAT 3 Function can be installed in different ways, which are described in more detail below. NOTICE Update installation An update installation always uninstalls the previous installation. Please make sure that you have backed up your configuration files beforehand. Twin CAT 2 Setup If you are using Twin CAT 2, you can install this supplement via a setup package, which you can download from the Beckhoff website at https://www.beckhoff.com/download. The installation can be done on either the engineering or runtime side, depending on the system you need the supplement for. Please note that under Twin CAT 2, the supplement is licensed directly during installation. A separate dialog prompts you to enter the license key. If you would like to install a 30-day trial version of the supplement, please enter DEMO as the license key. 10 Version: 1.2.0 TF6100
## Page 11

Installation There is a separate setup download for Twin CAT 2 on Windows CE with the name TS6100-0030 OPC UA. This setup installs the CAB files, which you can then transfer to a Windows CE device and install them there. Twin CAT 3 Package Manager If you are using Twin CAT 3.1 Build 4026 (and higher) on the Microsoft Windows operating system, you can install this function via the Twin CAT Package Manager, see Installation documentation. Normally you install the function via the corresponding workload; however, you can also install the packages contained in the workload individually. This documentation briefly describes the installation process via the workload. NOTICE Unprepared Twin CAT restart can cause data loss The installation of this function may result in a Twin CAT restart. Make sure that no critical Twin CAT applications are running on the system or shut them down in an orderly manner first. Command line program Tc Pkg You can use the Tc Pkg Command Line Interface (CLI) to display the available workloads on the system and to install a specific workload. tcpkg list -t workload tcpkg install TF610x. Opc Ua Client Pub Sub. XAE tcpkg install TF610x. Opc Ua Client Pub Sub. XAR Twin CAT Package Manager UI You can use the User Interface (UI) to display all available workloads and install them if required. To do this, follow the corresponding instructions in the interface. Twin CAT 3 Setup If you are using Twin CAT 3.1 Build 4024 on the Microsoft Windows operating system, you can install this function via a setup package, which you can download from the Beckhoff website at https:// www.beckhoff.com/download. Depending on the system on which you need the function, the installation can be done on either the engineering or runtime side. The following screenshot shows an example of the setup interface using the TF6100 Twin CAT OPC UA Client setup. TF6100 Version: 1.2.0 11
## Page 12

Installation To complete the installation process, follow the instructions in the Setup dialog. NOTICE Unprepared Twin CAT restart can cause data loss The installation of this function may result in a Twin CAT restart. Make sure that no critical Twin CAT applications are running on the system or shut them down in an orderly manner first. Windows CE If you are using Microsoft Windows CE as your operating system, you can install this function via the respective CAB files, which are delivered with the setup or Tc Pkg workload. The CAB files are usually stored in the subdirectory CE-ARMC4I and CE-X86 relative to the installation directory of the function. 12 Version: 1.2.0 TF6100
## Page 13

Installation From there they can be transferred to the Windows CE device via file transfer and executed there. The CAB files then install and register the function on the respective system. Always use the appropriate CAB file for your system. Specifically, this means • CE-ARMV4I: Arm®-based devices, e.g. CX8190, CX9020 • CE-X86: x86-based devices, e.g. CX51xx, CX52xx, CX20xx The CAB file can be transferred to the device either via the CF/SD card or the FTP server integrated in Windows CE. Device restart After installing this function, a device restart is required so that the function can be used. 3.3 Licensing This Twin CAT product requires a license for full operation. In addition, a trial license can be activated in order to evaluate the product. For more information about licensing the product, see the following sections: • Licensing under Twin CAT 2 • Licensing of a 7-day trial version under Twin CAT 3 • Licensing of a full version under Twin CAT 3 Further information on Twin CAT 3 licensing can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing"). Licensing under Twin CAT 2 The product is licensed under Twin CAT 2 during installation; a corresponding text field allows you to enter a license key. To evaluate this product, you can activate it for a period of 30 days. To do this, enter "Demo" as the license key. TF6100 Version: 1.2.0 13
## Page 14

Installation Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 14 Version: 1.2.0 TF6100
## Page 15

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Also see about this 2 Licensing [} 14] 2 Licensing [} 15] TF6100 Version: 1.2.0 15
## Page 16

Technical introduction 4 Technical introduction 4.1 Quick start The following chapter provides a quick start to the Twin CAT OPC UA I/O Client. In these instructions, the connection to a Sample OPC UA Server is set up, which offers some variables in its namespace. These variables are added to the process image of the Twin CAT OPC UA I/O Client and then linked to PLC variables. Sample OPC UA Server The Sample OPC UA Server is delivered together with the TF6100 OPC UA Client setup and is located in the installation directory [} 25] of the client. Alternatively, you can also use the Twin CAT OPC UA Server instead of the Sample OPC UA Server to provide a few variables via OPC UA. The steps are described below in the order in which they are performed: • Starting the Sample OPC UA Server • Creating a Twin CAT project • Reading the OPC UA variables • Starting the code generation Starting the Sample OPC UA Server 1. In Windows Explorer, navigate to the installation directory of the TF6100 Function Sample and then to the subdirectory "Sample Server". 2. Start the file Tc Opc Ua Sample Server.exe as administrator. ð The server is started in a console window and can then be accessed at the following OPC UA URL: opc.tcp://localhost:48030 You can confirm the message regarding the limited runtime. Creating a Twin CAT project 1. Open the Twin CAT XAE Shell. 2. In the File menu, select the command New > Project. 3. Add a PLC project to the project. ð A new Twin CAT project including PLC project was created. Reading the OPC UA variables ü In this step, the Twin CAT OPC UA Client is used to establish a connection to the server and read in the variables available there. 1. Add a new I/O device to the Twin CAT project. Use "OPC UA Virtual Device" as the device type 16 Version: 1.2.0 TF6100
## Page 17

Technical introduction 2. Add an OPC UA Client to the device 3. Open the settings of the OPC UA Client by double-clicking on the client. 4. Navigate to the Settings tab. Enter the server URL of the OPC UA Server. In this sample this is "opc.tcp://localhost:48030". TF6100 Version: 1.2.0 17
## Page 18

Technical introduction 5. Click Add Nodes. A connection to the server is established and the address space of the server is displayed in a separate dialog. 6. Select the nodes shown above and click the Ok button. ð The variables and the method for the process image of the client have been added. Starting the code generation ü Automatic code generation should be used to generate PLC variables to match the added OPC UA nodes. The generated PLC variables are automatically linked to the nodes. Alternatively, you can perform the mapping manually. 1. Double-click the OPC UA client. 2. In the Settings tab, select the Data Type Settings section. 3. Click the Create Plc Code button, which starts the code generation. ð The code generator creates a GVL in the existing PLC project whose name is derived from the OPC UA Client device name. PLC variables have now been automatically created within the GVL and linked to the corresponding nodes in the process image of the I/O device via the "Tc Link To" pragma. 18 Version: 1.2.0 TF6100
## Page 19

Technical introduction 4. Activate the configuration. ð The values of the OPC UA nodes are read from the server and written to the PLC variables via the mapping. Further information on calling the method Further PLC logic is required to call the method. For this purpose, a suitable function block has already been created by the code generation and provided with the corresponding input/output parameters, see chapter Method calls [} 29]. 4.2 Quick Start (Twin CAT 2) The following chapter provides a quick start to the Twin CAT OPC UA Client. In these instructions, the PLC [} 94] sample is used to establish a connection to an OPC UA server and read out a variable. Any server can be used as an OPC UA server, e.g. the Twin CAT OPC UA Sample Server [} 16], which can also be started as an executable file on a Twin CAT 2 system. Alternatively, you can also use the OPC Foundation's . NET Standard Sample Server, which can be obtained from the OPC Foundation's Git Hub repository. The following sample is based on the Twin CAT OPC UA Sample Server. The server does not necessarily have to be started in order to follow the individual steps. The aim of this quick start is to familiarize you with the PLC sample and learn which parts of the sample you need to adapt to your operating environment. The action steps are described in more detail below in the order in which they are performed: • Address space of the Sample OPC UA server • Identify the OPC UA node to be read • Adjusting the PLC sample for the Twin CAT OPC UA Client Twin CAT OPC UA I/O Client The Twin CAT OPC UA I/O Client is only available under Twin CAT 3. Under Twin CAT 2, we enable communication exclusively via the PLC library Tc2_PLCopen_Opc Ua. This article has been written accordingly for the use of this library. Address space of the Sample OPC UA server After starting the server, its address space contains a number of nodes that can be read by a client. An OPC UA client requires the following information to establish a connection: TF6100 Version: 1.2.0 19
## Page 20

Technical introduction • Server URL • Endpoint • Information on the Identity Token used In this sample, the server can be reached under the following server URL and the endpoint "None/None". Anonymous" is used as the Identity Token. The following screenshots were created based on the "UA Expert" software. After the connection has been established, the address space of the server used here is as follows: Identify the OPC UA node to be read To read out a node, you need the specific address information, which you will find in the form of the so-called "attributes". The following attributes are required for reading a node: • Node ID (consisting of Namespace Index or Namespace Name, as well as Identifier Type and Identifier) • Data Type of the node In this sample, we want to read the "My Int16" node. The attributes mentioned above are as follows: 20 Version: 1.2.0 TF6100
## Page 21

Technical introduction The PLCopen mapping specifies that an OPC UA node must be mapped from the data type "Int16" to the PLC data type "INT". We must take this into account in the following step. You can use the Namespace Index for communication. However, best practice is to use the associated Namespace Name, as the Namespace Index can change dynamically. The Namespace Name, on the other hand, is static and enables a resolution in the Namespace Index at runtime. You will find the Namespace Name below the "Server" object and there in the so-called "Namespace Array". The Namespace Name is then the xth entry in the array, i.e. the second entry here. TF6100 Version: 1.2.0 21
## Page 22

Technical introduction Adjusting the PLC sample for the Twin CAT OPC UA Client Open the PLC sample in Twin CAT PLC Control and open the PRG_Read_INT program. This program already contains a ready-made State Machine that uses the function blocks from the Tc2_PLCopen_Opc Ua library to connect to an OPC UA server and read a node. Establishing the connection The following variable values may now need to be adjusted to establish the connection: • s Opc UA_URL: Set the variable value to the Server URL of the server, in this case 'opc.tcp:// localhost:48030' • Session Connect Info.e Security Mode: In this case, the server used by us uses the Security Mode 'None'. The variable value must therefore be set to 'e UASecurity Msg Mode_None'. • Session Connect Info.e Security Policy Uri: In this case, the server used by us uses the Security Policy 'None'. The variable value must therefore be set to 'e UASecurity Policy_None'. • As the server used uses 'Anonymous' as the Identity Token, you do not need to specify any values for the Session Connect Info.st User Ident Token Type variable. This part of the PLC program therefore looks as follows: Resolve the Namespace Name In the next step, we have to resolve the Namespace Name into the corresponding Namespace Index. We use the function block UA_Get Namespace Index for this. This function block receives the Namespace Name determined by us as input. In the PLC sample, set the value of the s Namespace Name variable to 'http:// yourorganisation.org/Tc Opc Ua Sample Server/'. Adjusting the address information Now we can adjust the other address information (Identifier Type and Identifier) of the node in the PLC sample. To do this, we set the variables s Node Name and Node ID.e Identifier Type to the previously determined values. The declaration part of the program therefore looks as follows: And the implementation part: 22 Version: 1.2.0 TF6100
## Page 23

Technical introduction After these adjustments, you can activate the program. The variable value of the OPC UA node is then read by the server and stored in the PLC variable i Read Data. 4.3 Software architecture You do not need to know the internal software architecture of this product to use it, but it may be of interest in some cases. We will therefore briefly present it to you below. The Twin CAT OPC UA Client essentially consists of the following components: • The process in the operating system • The communication driver in real-time • The Twin CAT XAE extension • The PLC library The interaction of the individual components is described in more detail in the following diagram: Process in the operating system The process in the operating system (Tc Opc Ua Client.exe) takes care of the OPC UA protocol functions and makes them available via an ADS server so that the Twin CAT real-time components (e.g. the driver or the PLC library) can access them. TF6100 Version: 1.2.0 23
## Page 24

Technical introduction Communication driver in real-time The driver in real-time is responsible for the communication of the I/O device with the process in the operating system. It converts the configured process data into ADS telegrams, which are exchanged with the process in order to be converted into OPC UA commands. There is an engineering component in Twin CAT XAE for the configuration of the communication connection and the choice of data points. Twin CAT XAE Extension The engineering component in Twin CAT XAE provides a graphical configuration interface for the I/O device. This means that variables can be read from OPC UA servers and added to the process image so that they can be processed later at runtime. PLC library The PLC library provides the OPC UA functions of the process in the operating system for the PLC logic. Similar to the driver, the PLC library communicates with the process via ADS in order to access the OPC UA functions. 4.4 Supported functions The Twin CAT OPC UA Client enables access to the OPC UA server directly from the real-time logic. General functionality OPC UA defines a wide range of functions that may not be able to be mapped 1:1 to a PLC real-time environment. The following table provides an overview of the current functionality of the Twin CAT OPC UA Client. Missing features will be delivered in the future - as usual - in the form of updates. Feature PLCopen function blocks I/O Client Polling x x Subscriptions - x Method calls x x Basic data types according to IEC61131 x x Structures - x Arrays of basic data types according to x x IEC61131 Arrays of structures - x Arrays with fixed length x x Arrays with dynamic length - - Security at transport layer with X.509 x x certificates (self-signed + CA) Security at application layer with user x x name/password Security at application layer with X.509 x x certificates Communication with None/None x x endpoint Communication with Basic128 endpoint x x Communication with Basic128Rsa15 x x endpoint Communication with Basic256 endpoint x x Communication with Basic256Sha256 x x endpoint 24 Version: 1.2.0 TF6100
## Page 25

Technical introduction Basic data types according to IEC61131 For the reading and writing of data, the data type of the OPC UA Node must be assigned to the Twin CAT data type (mapping). The assignment of basic data types is described in the standardized information model "PLCopen OPC UA Information Model for IEC 61131-3" and is listed below. You can apply this mapping both to the PLCopen function blocks and to the Twin CAT OPC UA I/O Client. PLC data type OPC UA data type BOOL Boolean SINT SByte USINT Byte INT Int16 DINT Int32 STRING String BYTE USint REAL Float LREAL Double UINT UInt16 UDINT UInt32 LINT Int64 ULINT UInt64 DT Date Time TIME Int64 LTIME Int64 4.5 Application directories This application uses various directories to store relevant information, such as configuration or certificate files. Installation directory The base installation directory of the application is relative to the Twin CAT installation directory. %Tc Install Dir%\Functions\TF6100-OPC-UA The application is then installed in the following directory below this directory: %Tc Install Dir%\Functions\TF6100-OPC-UA\Win32\Client Certificate directory Certificate files, which are used to establish a secure communication connection, are stored in the following directory: %Program Data%\Beckhoff\TF6100-OPC-UA\Tc Opc Ua Client\PKI Log files Log files are stored in the following directory: %Program Data%\Beckhoff\TF6100-OPC-UA\Tc Opc Ua Client\Logs 4.6 Reading variables Variable values can be read from an OPC UA server via the Twin CAT OPC UA I/O Client. The values can be sampled using various mechanisms, which are described in more detail below. TF6100 Version: 1.2.0 25
## Page 26

Technical introduction The various settings in this context are made in the configuration pages of the I/O device. The Process Data Configuration area shows various parameters for setting the different modes of data collection from a server. The Twin CAT OPC UA I/O Client offers three different modes for data collection: • Polling (cyclic reading/writing) • Subscriptions • On Trigger Polling (cyclic reading/writing) One of the possible types of data collection is cyclic reading and writing. Time intervals are defined for both reading and writing. You can also specify how many variables are to be read in one read command. Writing variables in polling and subscription mode When writing, please note that writing only takes place when the value changes. If no value change has taken place in the configured variables at the end of a cycle, no new value is written. Parameter Description Read Cycle Time Specifies how fast variables are cyclically read. Write Cycle Time Defines how often a write command is triggered on the OPC UA channel. If a variable value changes several times within a specific cycle time, only the last value is written to the OPC UA channel. If no configured value has changed in the cycle time, no write command is triggered. Read List Read commands on the OPC UA channel are bundled to save bandwidth. This parameter specifies how many variables are collected in a single read command on the OPC UA channel. The labeling behind it indicates how many read commands arise from the current configuration. Array Single Write If a value in an array is changed, a write operation is only carried out for this value on the OPC UA channel when activated. If not activated, the entire array is always written. On Trigger In addition, there is an option to trigger reading and writing via trigger variables. For each OPC UA Client device there is a trigger variable (it can be found under Outputs/Control/Execute) that can be connected to a variable from the PLC and set if required. This option is suitable, for example, if data is only to be read from an OPC UA Server when a certain event occurs in the PLC. If the trigger variable remains permanently set, the data collection type behaves in the same way as the cyclic configuration. When writing, on the other hand, a value is written in each cycle if the trigger variable is set. No change in value is considered here. 26 Version: 1.2.0 TF6100
## Page 27

Technical introduction Subscriptions The third and last way of data collection is to use subscriptions. The I/O client registers a subscription with the connected OPC UA Server. The parameters described below can be specified for Publish Interval, Lifetime Count and Keepalive Count. Subscription mode is primarily intended for reading variables. If you write values in this mode, the same behavior applies as for cyclical writing (see above). Parameter Description Publish Interval After the specified time the connected OPC UA Server checks where there are new notification packets for the Client. If several value changes occur in a publishing interval, only the last value is transferred. Lifetime Count The OPC UA Client is responsible for sending a Publish Request to the server. In the Publish Response, the server returns the respective notification packages. The Lifetime Count indicates after how many failed Publish Requests from the client the server deletes the subscription. The calculated duration is shown in brackets (in the sample 1200 multiplied by 1000 ms = 20 minutes). Keepalive Count If the server does not have new notification packets for the client, it will not return any data. The Keepalive Count indicates after how many missed messages the server would send an empty message to the client to indicate that it is still active and the subscription is still in place. 4.7 Writing variables To enable the writing of variables, several conditions must be met: 1. The flag "Enable Write" must be set for the variable. This can be done either during the adding process via the button Add Nodes or afterwards in the parameter settings of the variable. 2. Before a write command, the "Write Enable" output for the I/O client must be enabled globally. Only then are the write commands generated. 3. In the "Polling" and "Subscriptions" modes, writing only takes place after a value change within the I/O client. This is particularly important for server restarts. After a server restart, values written once in these modes are not automatically written again, as another OPC UA Client could have written a new value in the meantime and this would then be overwritten by an "old" value. Setting Enable Write for a variable In order to add not only an input (Read) element but also an output (Write) element for a variable in the process image, it must be enabled explicitly. This can be done by using the Add Nodes dialog while adding the variables, for example: TF6100 Version: 1.2.0 27
## Page 28

Technical introduction Alternatively, this setting can be enabled/disabled at a later stage via the configuration parameters of the variables in the process image. Enabling write access globally Before write commands can be sent, they must be enabled globally. This is done by setting the output variable "Write Enable" for the I/O client: 28 Version: 1.2.0 TF6100
## Page 29

Technical introduction 4.8 Method calls The Twin CAT OPC UA I/O Client supports the calling of server methods. You can add a method to the process image like any other variable. The "input arguments" of the method are then available as output variables in the process image, whereas the "output arguments" are added as input variables. Additional input and output variables, e.g. b Execute, b Busy, b Error, are added to the process image so that the method can be called. Example: Method on server Example: Method after addition to the process image TF6100 Version: 1.2.0 29
## Page 30

Technical introduction You can then create a mapping between the input/output variables and the PLC variables. 30 Version: 1.2.0 TF6100
## Page 31

Technical introduction Calling of a method To call a method, set the output variable b Execute to TRUE. You can check whether the method call has been completed and whether it was successful via the input variables n Error ID, b Done, b Busy and b Error. TF6100 Version: 1.2.0 31
## Page 32

Technical introduction 4.9 Timestamp and Status Code If you double-click on a node in the process image, you will see the UA attributes with their current values as they were at the time of opening the window. Further variables that can be used for diagnostic purposes are added to the process image using the check box Provide timestamp and status code variables. 4.10 Structures The OPC UA I/O Client supports read/write procedures with structured data types (Structured Types). You can also add Structured Types to the process image like any other variable. When adding a Structured Type to the process image, the type to be parsed is added to the Twin CAT type system so that, for example, it can simply be used by a PLC application. Example: Structured Type on the server 32 Version: 1.2.0 TF6100
## Page 33

Technical introduction In this example the server contains a node of the structured data type "Person", which contains various member variables (Name, Height, Weight, Gender). Example: Structured Types in the process image After you have added a node to the process image, the process image contains the node and also the structural information of the type, e.g. whether individual member variables of the node should be read or written. Structured Types in the Twin CAT type system The data type is added to the type system of Twin CAT. The "Value" tree items then have this data type. TF6100 Version: 1.2.0 33
## Page 34

Technical introduction You can also view the data type in the Twin CAT type system under SYSTEM > Type System. To distinguish the data type from other data types you can add a prefix in the settings of the OPC UA Client. Mapping a Structured Type Since every Structured Type is added to the Twin CAT type system, the mapping of the variables is simple. Create an input/output variable of this data type and subsequently a mapping. 34 Version: 1.2.0 TF6100
## Page 35

Technical introduction 4.11 Code generation With the help of the automatic code generation, PLC variables for the OPC UA nodes configured in the I/O process image can be generated quickly and easily and linked to them automatically. This function is available in the configuration dialog of the I/O client via the button Create Plc Code. This function requires an existing PLC project in the current solution. TF6100 Version: 1.2.0 35
## Page 36

Technical introduction After calling this function, a new Global Variable List (GVL) with the name of the I/O client is created in the PLC project. Subsequently, all OPC UA nodes are read and corresponding variables are created in the GVL. Each variable receives the Tc Link To attribute for an automatic linking with the corresponding variable from the I/O process image. Example: In the I/O part of Twin CAT XAE a Twin CAT OPC UA I/O client with the name "Client 1" was created, to which various OPC UA nodes from a server were added. After calling the code generation, a new GVL with the name "Client_1" was now created in the (already existing) PLC project. This then contains corresponding PLC variables for the individual nodes, which were then automatically linked via the Tc Link To attribute. 36 Version: 1.2.0 TF6100
## Page 37

Technical introduction In addition, the control variables from the respective I/O client are also created and linked as variables in the GVL (not shown in the screenshot above). Code generation for structures An OPC UA node, which represents a so-called Structured Data Type, is also considered by the code generation and a corresponding variable is created in the GVL. Since the Structured Data Type was created as a native data type in the Twin CAT type system, it can be handled like a normal structure. Example: Two Structured Data Types from a server were added to the process image of the I/O client. The data types of the Structured Data Types on the server are ST_Complex1 and ST_Complex2 (not visible in the screenshot below). The code generation has now created a corresponding GVL with two variables from the respective automatically generated Twin CAT data type, which corresponds to the respective Structured Data Type. Code generation for methods An OPC UA method has input and output parameters which are passed to or returned from the method accordingly. Furthermore, a method is a self-contained call; it must be explicitly started by the client. This methodology is mapped accordingly in the process image of the I/O client at the method and is also taken into account during code generation. For a method, unlike normal variables or structures, a separate function block is created, which is then referenced in the GVL. Example: Two methods from a server have been added to the process image of the I/O client. TF6100 Version: 1.2.0 37
## Page 38

Technical introduction The code generation has now created a corresponding GVL, as well as two function blocks, which represent the input/output and control variables of the respective method. 38 Version: 1.2.0 TF6100
## Page 39

Technical introduction 4.12 PLCopen function blocks The Twin CAT OPC UA Client offers several options for communicating directly with one or more OPC UA servers from the control logic. On the one hand, there is a Twin CAT I/O device, which offers a simple, mapping-based interface. On the other hand, PLCopen provides standardized function blocks that can be used to initiate a connection with an OPC UA server directly from the PLC logic. The handling of these function blocks is described in more detail below. This article consists of the following sections: • Workflow • Determination of the communication parameters • Establishing a connection • Reading variables • Writing variables • Calling methods Workflow The general workflow when using the PLCopen function blocks can be schematically represented as follows: In the preparation phase, the communication parameters are set up and a connection to the server is established. The desired function is then executed (read, write, method calls), followed by disconnection of the communication connection. Determination of the communication parameters In general a graphic OPC UA Client is used to determine the attributes of a node or methods that have to be used together with the PLC function blocks, e.g.: • Node ID • Namespace Index and corresponding Namespace URI • Data Type • Method Node ID and Object Node ID The following documentation uses the generic OPC UA Client UA Expert as an example. This client can be purchased via the Unified Automation web pages: www.unified-automation.com. Nodes are characterized by the following three attributes, which form the so-called Node ID: • Namespace Index: The namespace in which the node is located, such as the PLC runtime • Identifier: Unique identifier of the node within its namespace • Identifier Type: Type of node: String, Guid and Numeric These attributes represent the so-called Node ID - the representation of a node on an OPC UA server - and are required by many subsequent function blocks. With the help of the UA Expert software you can simply determine the attributes of a node by establishing a connection to the OPC UA server and browsing to the desired node. The attributes are then visible in the Attributes panel, e.g. TF6100 Version: 1.2.0 39
## Page 40

Technical introduction According to the OPC UA specification, the Namespace Index can be a dynamically generated value. Therefore, OPC UA Clients must always use the corresponding namespace URI to resolve the Namespace Index before a node handle is detected. Use the function block UA_Get Namespace Index [} 77] to obtain the Namespace Index for a Namespace URI. The Namespace URI required for this can be determined with the help of UA Expert by establishing a connection to the OPC UA server and browsing to the Namespace Array node. This node contains information about all namespaces registered on the OPC UA Server. The corresponding namespace URIs are visible in the Attributes panel, for example: The section above shows an example of a Node ID in which the namespace index is 5. According to the Namespace Array shown in the figure, the corresponding Namespace URI is urn://SVENG-NB04/ Beckhoff Automation/Ua/PLC1. This URI can now be used for the function block UA_Get Namespace Index. The OPC UA Server ensures that the URI always remains the same, even after a restart. Observe the correct Namespace Index As the Namespace Index shown can change, the Namespace URI should always be used in combination with the function block UA_Get Namespace Index for later use with other function blocks, e.g. UA_Read [} 89], UA_Write [} 91], to resolve the correct Namespace Index. Data Type 40 Version: 1.2.0 TF6100
## Page 41

Technical introduction The data type of a node is required in order to see which PLC data type needs to be used in order to assign a read value or write it to a node. With the help of UA Expert you can simply determine the data type of a node by establishing a connection to the OPC UA Server and browsing to the desired node. The data type is then visible in the Attributes panel, for example: In this case the data type (Data Type) is "Int16". This must be assigned to an equivalent data type in the PLC, e.g. "INT". Method Node ID and Object Node ID When calling methods from the OPC UA namespace, two identifiers are required if the method handle is get using the function block UA_Method Get Handle [} 83]: • Object Node ID: Identifies the UA object that contains the method. • Method Node ID: Identifies the method itself. With the help of UA Expert you can simply determine both Node IDs by establishing a connection to the OPC UA server and browsing to the desired method or the desired UA object that contains the method. Sample Method M_Mul: The method identifier is then visible in the Attributes panel. Sample Object fb Mathematics: The object identifier is then visible in the Attributes panel. TF6100 Version: 1.2.0 41
## Page 42

Technical introduction Establishing a connection The following section describes how you use the function block Tc X_PLCopen_Opc Ua to establish a connection to a local or remote OPC UA server. This connection can then be used to call other functions, such as read or write nodes, or call methods. The following function blocks are required to establish a connection to an OPC UA server and subsequently interrupt the session: UA_Connect [} 74], UA_Disconnect [} 76]. First read the section How to determine communication parameters to better understand certain UA functionalities (e.g. how to determine Node Identifiers). The function block UA_Connect requires the following information in order to be able to establish a connection to a local or remote OPC UA server: • Server URL • Session Connect Information The Server URL basically consists of a prefix, a host name and a port. The prefix describes the OPC UA transport protocol that should be used for the connection, e.g. "opc.tcp://" for a binary TCP connection (default). The host name or IP address part describes the address information of the OPC UA target server, e.g. "192.168.1.1" or "CX-12345". The port number is the target port of the OPC UA Server, e.g. "4840". The Server URL can then look like this: opc.tcp://CX-12345:4840. Declaration: (* Declarations for UA_Connect *) fb UA_Connect : UA_Connect; Session Connect Info : ST_UASession Connect Info; n Connection Hdl : DWORD; (* Declarations for UA_Disconnect *) fb UA_Disconnect : UA_Disconnect; (* Declarations for state machine and output handling *) i State : INT; b Done : BOOL; b Busy : BOOL; b Error : BOOL; n Error ID : DWORD; Implementation: CASE i State OF 0: b Error := FALSE; n Error ID := 0; Session Connect Info.t Connect Timeout := T#1M; Session Connect Info.t Session Timeout := T#1M; Session Connect Info.s Application Name := ""; Session Connect Info.s Application Uri := ""; Session Connect Info.e Security Mode := e UASecurity Msg Mode_None; Session Connect Info.e Security Policy Uri := e UASecurity Policy_None; Session Connect Info.e Transport Profile Uri := e UATransport Profile Uri_UATcp; st Node Add Info.n Index Range Count := n Index Range Count; st Node Add Info.st Index Range := st Index Range; i State := i State + 1; 1: fb UA_Connect( Execute := TRUE, Server URL := "opc.tcp://192.168.1.1:4840", Session Connect Info := Session Connect Info, Timeout := T#5S, 42 Version: 1.2.0 TF6100
## Page 43

Technical introduction Connection Hdl => n Connection Hdl); IF NOT fb UA_Connect. Busy THEN fb UA_Connect(Execute := FALSE); IF NOT fb UA_Connect. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Connect. Error ID; n Connection Hdl := 0; i State := 0; END_IF END_IF 2: fb UA_Disconnect( Execute := TRUE, Connection Hdl := n Connection Hdl); IF NOT fb UA_Disconnect. Busy THEN fb UA_Disconnect(Execute := FALSE); IF NOT fb UA_Disconnect. Error THEN i State := 0; ELSE b Error := TRUE; n Error ID := fb UA_Disconnect. Error ID; i State := 0; n Connection Hdl := 0; END_IF END_IF END_CASE Reading variables The following section describes how to use the function blocks Tc X_PLCopen_Opc Ua to read an OPC UA node from a local or remote OPC UA server. The following function blocks are required to establish a connection to an OPC UA server, read UA nodes and later interrupt the session: UA_Connect [} 74], UA_Get Namespace Index [} 77], UA_Node Get Handle [} 85], UA_Read [} 89], UA_Node Release Handle [} 87], UA_Disconnect [} 76]. The schematic workflow of each Twin CAT OPC UA Client can be categorized into three different phases: Preparation, Work and Cleanup. The use case described in this section can be visualized as follows: • The function block UA_Connect requires the following information to establish a connection to a local or remote OPC UA Server (see also How to establish a connection): ◦ Server URL ◦ Session Connect Information • The function block UA_Get Namespace Index requires a Connection Handle (from UA_Connect) and a Namespace URI for resolution to a Namespace Index, which is later used by UA_Node Get Handle to capture a node handle (see also How to determine communication parameters). TF6100 Version: 1.2.0 43
## Page 44

Technical introduction • The function block UA_Node Get Handle requires a Connection Handle (from UA_Connect) and Node ID (from ST_UANode ID) to capture a node handle (see also How to determine communication parameters). • The function block UA_Read requires a connection handle (from UA_Connect), a node handle (from UA_Node Get Handle) and a pointer to the target variable (where the read value is to be saved). Make sure that the target variable has the correct data type (see also How to determine communication parameters). • The function block UA_Node Release Handle requires a connection handle (from UA_Connect) and a node handle (from UA_Node Get Handle). Declaration: (* Declarations for UA_Get Namespace Index *) fb UA_Get Namespace Index : UA_Get Namespace Index; n Namespace Index : UINT; (* Declarations for UA_Node Get Handle *) fb UA_Node Get Handle : UA_Node Get Handle; Node ID : ST_UANode ID; n Node Hdl : DWORD; (* Declarations for UA_Read *) fb UA_Read : UA_Read; st Index Range : ARRAY [1..n Max Index Range] OF ST_UAIndex Range; n Index Range Count : UINT; st Node Add Info : ST_UANode Additional Info; s Node Identifier : STRING(MAX_STRING_LENGTH) := 'MAIN.n Counter'; n Read Data : INT; cb Data Read : UDINT; (* Declarations for UA_Node Release Handle *) fb UA_Node Release Handle : UA_Node Release Handle; Implementation: CASE i State OF 0: [...] 2: (* Get NS Index *) fb UA_Get Namespace Index( Execute := TRUE, Connection Hdl := n Connection Hdl, Namespace Uri := s Namespace Uri, Namespace Index => n Namespace Index ); IF NOT fb UA_Get Namespace Index. Busy THEN fb UA_Get Namespace Index(Execute := FALSE); IF NOT fb UA_Get Namespace Index. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Get Namespace Index. Error ID; i State := 6; END_IF END_IF 3: (* UA_Node Get Handle *) Node ID.e Identifier Type := e UAIdentifier Type_String; Node ID.n Namespace Index := n Namespace Index; Node ID.s Identifier := s Node Identifier; fb UA_Node Get Handle( Execute := TRUE, Connection Hdl := n Connection Hdl, Node ID := Node ID, Node Hdl => n Node Hdl); IF NOT fb UA_Node Get Handle. Busy THEN fb UA_Node Get Handle(Execute := FALSE); IF NOT fb UA_Node Get Handle. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Node Get Handle. Error ID; i State := 6; END_IF END_IF 44 Version: 1.2.0 TF6100
## Page 45

Technical introduction 4: (* UA_Read *) fb UA_Read( Execute := TRUE, Connection Hdl := n Connection Hdl, Node Hdl := n Node Hdl, cb Data := SIZEOF(n Read Data), st Node Add Info := st Node Add Info, p Variable := ADR(n Read Data)); IF NOT fb UA_Read. Busy THEN fb UA_Read( Execute := FALSE, cb Data_R => cb Data Read); IF NOT fb UA_Read. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Read. Error ID; i State := 6; END_IF END_IF 5: (* Release Node Handle *) fb UA_Node Release Handle( Execute := TRUE, Connection Hdl := n Connection Hdl, Node Hdl := n Node Hdl); IF NOT fb UA_Node Release Handle. Busy THEN fb UA_Node Release Handle(Execute := FALSE); IF NOT fb UA_Node Release Handle. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Node Release Handle. Error ID; i State := 6; END_IF END_IF 6: [...] END_CASE Writing variables The following section describes how you use the function block Tc X_PLCopen_Opc Ua to write values in an OPC UA node from a local or remote OPC UA server. The following function blocks are required to establish a connection to an OPC UA server, write UA nodes and subsequently interrupt the session: UA_Connect [} 74], UA_Get Namespace Index [} 77], UA_Node Get Handle [} 85], UA_Write [} 91], UA_Node Release Handle [} 87], UA_Disconnect [} 76]. The schematic workflow of each Twin CAT OPC UA Client can be categorized into three different phases: Preparation, Work and Cleanup. The use case described in this section can be visualized as follows: • The function block UA_Connect requires the following information in order to be able to establish a connection to a local or remote OPC UA server (see also How to establish a connection): ◦ Server URL TF6100 Version: 1.2.0 45
## Page 46

Technical introduction ◦ Session Connect Information • The function block UA_Get Namespace Index requires a Connection Handle (from UA_Connect) and a Namespace URI for resolution to a Namespace Index, which is later used by UA_Node Get Handle to capture a node handle (see also How to determine communication parameters). • The function block UA_Node Get Handle requires a Connection Handle (from UA_Connect) and Node ID (from ST_UANode ID) to capture a node handle (see also How to determine communication parameters). • The function block UA_Write requires a connection handle (from UA_Connect), a node handle (from UA_Node Get Handle) and a pointer to a variable containing the value that is to be written. Make sure that the target variable has the correct data type (see also How to determine communication parameters). • The function block UA_Node Release Handle requires a connection handle (from UA_Connect) and a node handle (from UA_Node Get Handle). Declaration: (* Declarations for UA_Get Namespace Index *) fb UA_Get Namespace Index : UA_Get Namespace Index; n Namespace Index : UINT; (* Declarations for UA_Node Get Handle *) fb UA_Node Get Handle : UA_Node Get Handle; Node ID : ST_UANode ID; n Node Hdl : DWORD; (* Declarations for UA_Write *) fb UA_Write : UA_Write; st Index Range : ARRAY [1..n Max Index Range] OF ST_UAIndex Range; n Index Range Count : UINT; st Node Add Info : ST_UANode Additional Info; s Node Identifier: STRING(MAX_STRING_LENGTH) := 'MAIN.n Number'; n Write Data: INT := 42; (* Declarations for UA_Node Release Handle *) fb UA_Node Release Handle : UA_Node Release Handle; Implementation: CASE i State OF 0: [...] 2: (* Get NS Index *) fb UA_Get Namespace Index( Execute := TRUE, Connection Hdl := n Connection Hdl, Namespace Uri := s Namespace Uri, Namespace Index => n Namespace Index ); IF NOT fb UA_Get Namespace Index. Busy THEN fb UA_Get Namespace Index(Execute := FALSE); IF NOT fb UA_Get Namespace Index. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Get Namespace Index. Error ID; i State := 6; END_IF END_IF 3: (* UA_Node Get Handle *) Node ID.e Identifier Type := e UAIdentifier Type_String; Node ID.n Namespace Index := n Namespace Index; Node ID.s Identifier := s Node Identifier; fb UA_Node Get Handle( Execute := TRUE, Connection Hdl := n Connection Hdl, Node ID := Node ID, Node Hdl => n Node Hdl); IF NOT fb UA_Node Get Handle. Busy THEN fb UA_Node Get Handle(Execute := FALSE); IF NOT fb UA_Node Get Handle. Error THEN i State := i State + 1; ELSE b Error := TRUE; 46 Version: 1.2.0 TF6100
## Page 47

Technical introduction n Error ID := fb UA_Node Get Handle. Error ID; i State := 6; END_IF END_IF 4: (* UA_Write *) fb UA_Write( Execute := TRUE, Connection Hdl := n Connection Hdl, Node Hdl := n Node Hdl, st Node Add Info := st Node Add Info, cb Data := SIZEOF(n Write Data), p Variable := ADR(n Write Data)); IF NOT fb UA_Write. Busy THEN fb UA_Write( Execute := FALSE, p Variable := ADR(n Write Data)); IF NOT fb UA_Write. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Write. Error ID; i State := 6; END_IF END_IF 5: (* Release Node Handle *) fb UA_Node Release Handle( Execute := TRUE, Connection Hdl := n Connection Hdl, Node Hdl := n Node Hdl); IF NOT fb UA_Node Release Handle. Busy THEN fb UA_Node Release Handle(Execute := FALSE); IF NOT fb UA_Node Release Handle. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Node Release Handle. Error ID; i State := 6; END_IF END_IF 6: [...] END_CASE Calling methods The following section describes how you use the function block Tc X_PLCopen_Opc Ua to call methods on a local or remote OPC UA server. The following function blocks are required to connect to an OPC UA server, call UA methods, and subsequently interrupt the session: UA_Connect [} 74], UA_Get Namespace Index [} 77], UA_Method Get Handle [} 83], UA_Method Call [} 80], UA_Method Release Handle [} 84], UA_Disconnect [} 76]. The schematic workflow of each Twin CAT OPC UA Client can be categorized into three different phases: Preparation, Work and Cleanup. The use case described in this section can be visualized as follows: TF6100 Version: 1.2.0 47
## Page 48

Technical introduction • The function block UA_Connect requires the following information in order to be able to establish a connection to a local or remote OPC UA server (see also How to establish a connection): ◦ Server URL ◦ Session Connect Information • The function block UA_Get Namespace Index requires a Connection Handle (from UA_Connect) and a Namespace URI for resolution to a Namespace Index, which is later used by UA_Node Get Handle to capture a node handle (see also How to determine communication parameters). • The function block UA_Method Get Handle requires a connection handle (from UA_Connect), an Object Node ID and a Method Node ID to capture a method handle (see also How to determine communication parameters). • The function block UA_Method Call requires a connection handle (from UA_Connect), a method handle (from UA_Method Get Handle) and information about the input and output arguments of the method that is to be called. Information about the input arguments is represented by the input parameters p Input Arg Info and p Input Arg Data of UA_Method Call. Information about the output parameters is represented by the p Output Arg Info and p Output Arg Data input parameters of UA_Method Call. The input parameter p Output Arg Info And Data then represents a pointer to a structure containing the results of the method call, including all output parameters. The following code snippet calculates and creates the p Input Arg Info and p Input Arg Data parameters in the M_Init method. • The function block UA_Node Release Handle requires a connection handle (from UA_Connect) and a method handle (from UA_Method Get Handle). M_Init initialization method of the function block containing the UA method call: MEMSET(ADR(n Input Data),0,SIZEOF(n Input Data)); n Arg := 1; (********** Input parameter 1 **********) Input Arguments[n Arg]. Data Type := e UAType_Int16; Input Arguments[n Arg]. Value Rank := -1; (* Scalar = -1 or Array *) Input Arguments[n Arg]. Array Dimensions[1] := 0; (* Number of Dimension in case its an array *) Input Arguments[n Arg].n Len Data := SIZEOF(number In1); (* Length if its a STRING *) IF n Offset + SIZEOF(number In1) > n Input Arg Size THEN b Input Data Error := TRUE; RETURN; ELSE MEMCPY(ADR(n Input Data)+n Offset,ADR(number In1),SIZEOF(number In1)); (* VALUE in BYTES FORM *) n Offset := n Offset + SIZEOF(number In1); END_IF n Arg := n Arg + 1; (********** Input parameter 2 **********) Input Arguments[n Arg]. Data Type := e UAType_Int16; Input Arguments[n Arg]. Value Rank := -1; (* Scalar = -1 or Array *) Input Arguments[n Arg]. Array Dimensions[1] := 0; (* Number of Dimension in case its an array *) Input Arguments[n Arg].n Len Data := SIZEOF(number In2); (* Length if its a STRING *) IF n Offset + SIZEOF(number In2) > n Input Arg Size THEN b Input Data Error := TRUE; RETURN; ELSE MEMCPY(ADR(n Input Data)+n Offset,ADR(number In2),SIZEOF(number In2));(* VALUE in BYTES FORM *) n Offset := n Offset + SIZEOF(number In2); END_IF cb Write Data := n Offset; 48 Version: 1.2.0 TF6100
## Page 49

Technical introduction Declaration: (* Declarations for UA_Get Namespace Index *) fb UA_Get Namespace Index : UA_Get Namespace Index; n Namespace Index : UINT; (* Declarations for UA_Method Get Handle *) fb UA_Method Get Handle: UA_Method Get Handle; Object Node ID: ST_UANode ID; Method Node ID: ST_UANode ID; n Method Hdl: DWORD; (* Declarations for UA_Method Call *) fb UA_Method Call: UA_Method Call; s Object Node Id Identifier : STRING(MAX_STRING_LENGTH) := 'MAIN.fb Mathematics'; s Method Node Id Identifier : STRING(MAX_STRING_LENGTH) := 'MAIN.fb Mathematics#M_Mul'; n Adr Write Data: PVOID; number In1: INT := 42; // change according to input value and data type number In2: INT := 42; // change according to input value and data type number Out Pro: DINT; // result (output parameter of M_Mul()) cb Write Data: UDINT; // calculated automatically by M_Init() Input Arguments: ARRAY[1..2] OF ST_UAMethod Arg Info; // change according to input parameters st Output Arg Info: ARRAY[1..1] OF ST_UAMethod Arg Info; // change according to output parameters st Output Arg Info And Data: ST_Output Arg Info And Data; n Input Data: ARRAY[1..4] OF BYTE; // number In1(INT16)(2) + number In2(INT16)(2) n Offset: UDINT; // calculated by M_Init() n Arg: INT; // used by M_Init() (* Declarations for UA_Method Release Handle *) fb UA_Method Release Handle: UA_Method Release Handle; Implementation: CASE i State OF 0: [...] 2: (* Get NS Index *) fb UA_Get Namespace Index( Execute := TRUE, Connection Hdl := n Connection Hdl, Namespace Uri := s Namespace Uri, Namespace Index => n Namespace Index); IF NOT fb UA_Get Namespace Index. Busy THEN fb UA_Get Namespace Index(Execute := FALSE); IF NOT fb UA_Get Namespace Index. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Get Namespace Index. Error ID; i State := 7; END_IF END_IF 3: (* Get Method Handle *) Object Node ID.e Identifier Type := e UAIdentifier Type_String; Object Node ID.n Namespace Index := n Namespace Index; Object Node ID.s Identifier := s Object Node Id Identifier; Method Node ID.e Identifier Type := e UAIdentifier Type_String; Method Node ID.n Namespace Index := n Namespace Index; Method Node ID.s Identifier := s Method Node Id Identifier; M_Init(); IF b Input Data Error = FALSE THEN i State := i State + 1; ELSE b Busy := FALSE; b Error := TRUE; n Error ID := 16#70A; //out of memory END_IF 4: (* Method Get Handle *) fb UA_Method Get Handle( Execute := TRUE, Connection Hdl := n Connection Hdl, Object Node ID := Object Node ID, Method Node ID := Method Node ID, Method Hdl => n Method Hdl); IF NOT fb UA_Method Get Handle. Busy THEN TF6100 Version: 1.2.0 49
## Page 50

Technical introduction fb UA_Method Get Handle(Execute := FALSE); IF NOT fb UA_Method Get Handle. Error THEN i State := i State + 1; ELSE b Error := TRUE; n Error ID := fb UA_Method Get Handle. Error ID; i State := 6; END_IF END_IF 5: (* Method Call *) st Output Arg Info[1].n Len Data := SIZEOF(st Output Arg Info And Data.pro); fb UA_Method Call( Execute := TRUE, Connection Hdl := n Connection Hdl, Method Hdl := n Method Hdl, n Number Of Input Arguments := n Number Of Input Arguments, p Input Arg Info := ADR(Input Arguments), cb Input Arg Info := SIZEOF(Input Arguments), p Input Arg Data := ADR(n Input Data), cb Input Arg Data := cb Write Data, p Input Write Data := 0, cb Input Write Data := 0, n Number Of Output Arguments := n Number Of Output Arguments, p Output Arg Info := ADR(st Output Arg Info), cb Output Arg Info := SIZEOF(st Output Arg Info), p Output Arg Info And Data := ADR(st Output Arg Info And Data), cb Output Arg Info And Data := SIZEOF(st Output Arg Info And Data)); IF NOT fb UA_Method Call. Busy THEN fb UA_Method Call(Execute := FALSE); IF NOT fb UA_Method Call. Error THEN i State := i State + 1; number Out Pro := st Output Arg Info And Data.pro; ELSE b Error := TRUE; n Error ID := fb UA_Method Call. Error ID; i State := 6; END_IF END_IF 6: (* Release Method Handle *) fb UA_Method Release Handle( Execute := TRUE, Connection Hdl := n Connection Hdl, Method Hdl := n Method Hdl); IF NOT fb UA_Method Release Handle. Busy THEN fb UA_Method Release Handle(Execute := FALSE); b Busy := FALSE; IF NOT fb UA_Method Release Handle. Error THEN i State := 7; ELSE b Error := TRUE; n Error ID := fb UA_Method Release Handle. Error ID; i State := 7; END_IF END_IF 7: [...] END_CASE 4.13 Security 4.13.1 Overview One of the reasons OPC UA has been so successful as a communication technology is because of its integrated security mechanisms. Data communication based on OPC UA can be secured on two layers: transport and application layer. When connecting to the server, the client first selects an endpoint, which specifies the security functions to be used. 50 Version: 1.2.0 TF6100
## Page 51

Technical introduction Endpoints A server offers the client a list of different endpoints to which the client can connect. An endpoint describes, among other things, which security functions (e.g. Message Security mode, Security Policy and available Identity Tokens) the communication connection via this endpoint should fulfill. For example, an endpoint may require signing and encryption of data packets (transport layer), as well as additional authentication of the client based on username/password (application layer). Transport layer A communication connection based on OPC UA can be secured at the transport layer. This is done through the use of client/server certificates and a mutual trust relationship between client and server application. Here, the client must trust the server certificate and vice versa in order for a communication connection to be established. This requires a mutual certificate exchange [} 51]. Application layer In addition to the transport layer, a communication connection can also be secured at the application layer. For this purpose, various authentication mechanisms [} 52] are available, which are offered by the server endpoint. 4.13.2 Certificate exchange To secure the communication connection at transport layer via a secure endpoint, it is necessary to establish a mutual trust between client and server. By default, both the Twin CAT OPC UA Server and the Twin CAT OPC UA Client generate a machine-specific, self-signed key pair consisting of a public and a private key when they are started for the first time. However, you can also use any certificate authority or technology for integration into your IT infrastructure, e.g. Active Directory or Open SSL. For simple administration and secure access to certificates, it makes sense to set up a Global Discovery Server. To establish a trust relationship between an OPC UA server and the Twin CAT OPC UA Client, you need the public key of the server certificate. The client must trust this accordingly. The client manages the trust settings for server certificates in a subdirectory of the application directory [} 25]. The following diagram illustrates the relationship between the client and server certificate when establishing a secure communication connection: The client transmits its public key with the Create Session Request. The server then has the option of checking the trust relationship. If the server trusts the client, it transmits its own public key in its response. The client therefore also has the option of checking the trust relationship with the server. TF6100 Version: 1.2.0 51
## Page 52

Technical introduction If mutual trust is ensured, the communication connection is initiated. The server's public key is used to encrypt a request from the client to the server. The response from the server to the client is then encrypted with the client's public key. Both communication participants have the option of decrypting the received message with their private key. Messages are signed in reverse: a message is signed with the sender's private key. Since the recipient recognizes the sender's public key, the signature can be verified. Configure trust relationship via file system By moving server certificates between the trusted/rejected directories, the trust settings can be adjusted accordingly. The public key of a server certificate is automatically stored in the directory for rejected certificates the first time the server attempts to connect to a secure endpoint. By subsequently moving the public key to the directory for trusted certificates, the server is trusted at the next connection attempt and can connect. 4.13.3 Authentication The Twin CAT OPC UA Client supports the use of different Identity Tokens to authenticate to an OPC UA Server. • Anonymous • Username/Password • User certificate The following screenshots are taken with the Twin CAT OPC UA I/O Client. All of the functions described are also supported when using the PLCOpen function blocks [} 39]. Anonymous This type of authentication enables the Twin CAT OPC UA Client to establish a connection to the server application without specifying a user identity. Below you will find an example screenshot from the Twin CAT OPC UA I/O Client. Username/Password This type of authentication uses a username/password combination to authenticate the Twin CAT OPC UA Client to the server application. Below you will find an example screenshot from the Twin CAT OPC UA I/O Client. 52 Version: 1.2.0 TF6100
## Page 53

Technical introduction User certificate With this type of authentication, the Twin CAT OPC UA Client uses a certificate to authenticate itself to the server application. The handling of user certificates on the server side is identical to the use of certificates on the transport layer, i.e. the server must trust the (user) certificate before the client can successfully authenticate itself to the server with the certificate. Below you will find an example screenshot from the Twin CAT OPC UA I/O Client. NOTICE Authentication and server certificate When using the unencrypted endpoint in combination with authentication, the Twin CAT OPC UA Client still requires the public key from the OPC UA Server certificate in order to encrypt the password during transmission. To this end the certificate must be trusted in the Twin CAT OPC UA Client (see certificate exchange [} 51]). 4.14 Logging Both a Stack Trace and an App Trace can be enabled in the Twin CAT OPC UA Client. The Stack Trace provides diagnostic information on the OPC UA stack, whereas the App Trace is limited to the pure client application and is also sufficient in most cases. All settings listed in the following table are created under the following registry key: TF6100 Version: 1.2.0 53
## Page 54

Technical introduction HKLM\SOFTWARE\WOW6432Node\Beckhoff\Twin CAT OPC UA Client Type Name Data type Data App Trace logfile REG_SZ Name of the logfile App Trace logmode REG_DWORD 0 = disabled 1 = minimum logging 2 = maximum logging Stack Trace tracelogfile REG_SZ Name of the logfile Stack Trace tracelogmode REG_DWORD 0 = disabled 1 = enabled 54 Version: 1.2.0 TF6100
## Page 55

PLC API 5 PLC API 5.1 Tc2_Opc Ua 5.1.1 Data types 5.1.1.1 ST_Opc UAServer Info ST_Opc UAServer Info contains session information of a Twin CAT OPC UA Server. Syntax TYPE ST_Opc UAServer Info : STRUCT n Reserved : UDINT; n Cummulated Session Count : UDINT; n Current Session Count : UDINT; n Rejected Session Count : UDINT; n Security Rejected Session Count : UDINT; n Session Timeout Count : UDINT; n Current Subscription Count : UDINT; n Rejected Request Count : UDINT; n Security Rejected Request Count : UDINT; END_STRUCT END_TYPE Parameter Name Type Description n Reserved UDINT Placeholder. n Cummulated Session Count UDINT Total number of client sessions since the server was started. n Current Session Count UDINT Total number of current client sessions. n Rejected Session Count UDINT Total number of sessions rejected by the server. n Security Rejected Session Count UDINT Total number of sessions rejected by the server for security reasons (example: incorrect combination of user name and password). n Session Timeout Count UDINT Total number of sessions that had a timeout. n Current Subscription Count UDINT Total number of current subscriptions in the server. n Rejected Request Count UDINT Total number of failed requests. n Security Rejected Request Count UDINT Total number of failed requests for security reasons. 5.1.1.2 E_Opc UAServer Option E_Opc UAServer Option determines which command is to be sent to the Twin CAT OPC UA Server. Syntax TYPE E_Opc UAServer Option ( e OPCUAServer Option_None, e OPCUAServer Option_Restart, e OPCUAServer Option_Shutdown, e OPCUAServer Option_Refresh Cfg, e OPCUAServer Option_Server Info ); END_TYPE TF6100 Version: 1.2.0 55
## Page 56

PLC API Parameter Name Description e OPCUAServer Option_Non Initial state of the enumeration. e e OPCUAServer Option_Res This option triggers a restart of the OPC UA interface of the server. tart e OPCUAServer Option_Shu This option triggers the shutdown of the OPC UA interface of the server. As the tdown restart option above works via OPC UA, it is no longer available after using this option until a complete server restart. e OPCUAServer Option_Refr This option currently has no function. esh Cfg e OPCUAServer Option_Ser This option queries the server information contained in ST_Opc UAServer Info ver Info [} 55]. 5.1.1.3 E_Opc UAServer Status E_Opc UAServer Status represents the runtime status of a Twin CAT OPC UA Server. Syntax TYPE E_Opc UAServer Status ( e OPCUAServer Status_None, e OPCUAServer Status_Alive, e OPCUAServer Status_Not Responding ); END_TYPE Parameter Name Description e OPCUAServer Status_None Initial state of the enumeration. e OPCUAServer Status_Alive The ADS interface of the Twin CAT OPC UA Server is accessible. e OPCUAServer Status_Not Responding The ADS interface of the Twin CAT OPC UA Server is not accessible. 5.1.2 Function blocks 5.1.2.1 FB_Opc UAServer The function block enables status information to be read out and a Twin CAT OPC UA Server to be restarted. Syntax Definition: FUNCTION_BLOCK FB_Opc UAServer VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; e Opc UAServer Option : E_Opc UAServer Option; t Timeout : TIME; END_VAR 56 Version: 1.2.0 TF6100
## Page 57

PLC API VAR_OUTPUT st Opc UAServer Info : ST_Opc UAServer Info; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Inputs Name Type Description s Net Id T_Ams Net Id Ams Net Id of the system on which the Twin CAT OPC UA Server runs. b Execute BOOL A rising edge activates processing of the function block. e Opc UAServer Option E_Opc UAServer Option Specifies the operation to be performed. [} 55] t Timeout TIME ADS Timeout Outputs Name Type Description st Opc UAServer Info ST_Opc UAServer Info Contains status information from the server when Server Info is selected at the e Opc UAServer Option input. [} 55] b Busy BOOL TRUE as long as processing of the function block is in progress. b Error BOOL Becomes TRUE as soon as an error situation occurs. n Error Id UDINT Contains the error code when an error (b Error) occurs. 5.1.2.2 FB_Opc UAServer Get Status The function block enables the current status (Running, Not Responding) of a Twin CAT OPC UA Server to be read. It should be noted at this point that this function block deals with the ADS interface of the OPC UA Server. If the OPC UA Server is restarted or shut down, the ADS interface of the server remains accessible. The ADS interface can only be closed by terminating the server process. Syntax Definition: FUNCTION_BLOCK FB_Opc UAServer Get Status VAR_INPUT s Net Id : T_Ams Net Id; b Get Status : BOOL; t Timeout : TIME; END_VAR VAR_OUTPUT e OPCUAServer Status : E_OPCUAServer Status; b Done : BOOL; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR TF6100 Version: 1.2.0 57
## Page 58

PLC API Inputs Name Type Description s Net Id T_Ams Net Id Ams Net Id of the system on which the Twin CAT OPC UA Server runs. b Get Status BOOL A rising edge activates processing of the function block. t Timeout TIME ADS Timeout Outputs Name Type Description e OPCUAServer Statu E_Opc UAServer Status Contains status information about the server. s [} 56] b Done BOOL TRUE when processing of the function block is complete. b Busy BOOL TRUE as long as processing of the function block is in progress. b Error BOOL Becomes TRUE as soon as an error situation occurs. n Error Id UDINT Contains the error code when an error (b Error) occurs. 5.2 Tc3_PLCopen_Opc Ua 5.2.1 Data types 5.2.1.1 E_UAAttribute ID Syntax TYPE E_UAAttribute ID: ( e UAAI_Node ID := 1, e UAAI_Node Class := 2, e UAAI_Browse Name := 3, e UAAI_Display Name := 4, e UAAI_Description := 5, e UAAI_Write Mask := 6, e UAAI_User Write Mask := 7, e UAAI_Is Abstract := 8, e UAAI_Symmetric := 9, e UAAI_Inverse Name := 10, e UAAI_Contains No Loops := 11, e UAAI_Event Notifier := 12, e UAAI_Value := 13, e UAAI_Data Type := 14, e UAAI_Value Rank := 15, e UAAI_Array Dimensions := 16 )DINT; END_TYPE 58 Version: 1.2.0 TF6100
## Page 59

PLC API Values Name Description Node ID OPC UA Node ID Node Class OPC UA Node Class Browse Name OPC UA Browse Name Display Name OPC UA Display Name Description OPC UA Description Write Mask OPC UA Write Mask User Write Mask OPC UA User Write Mask Is Abstract OPC UA Is Abstract Symmetric OPC UA Symmetric Inverse Name OPC UA Inverse Name Contains No Loops OPC UA Contains No Loops Event Notifier OPC UA Event Notifier Value OPC UA Value Data Type OPC UA Data Type Value Rank OPC UA Value Rank Array Dimensions OPC UA Array Dimensions Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.2 E_UABrowse Direction Syntax TYPE E_UABrowse Direction: ( e UABD_Forward := 0, e UABD_Inverse := 1, e UABD_Both := 2 )DINT; END_TYPE Values Name Description e UABD_Forward Forward references e UABD_Inverse Inverse references e UABD_Both Forward and inverse references Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.3 E_UABrowse Result Mask Syntax TYPE E_UABrowse Result Mask: ( e UABRM_Reference Type Id := 1, e UABRM_Is Forward := 2, e UABRM_Reference Type Info := 3, TF6100 Version: 1.2.0 59
## Page 60

PLC API e UABRM_Node Class := 4, e UABRM_Browse Name := 8, e UABRM_Display Name := 16, e UABRM_Type Definition := 32, e UABRM_Target Info := 60, e UABRM_All := 63 )DINT; END_TYPE Values Name Description e UABRM_Reference Type Id Reference Type Id e UABRM_Is Forward Is Forward e UABRM_Reference Type Info Reference Type Info e UABRM_Node Class Node Class e UABRM_Browse Name Browse Name e UABRM_Display Name Display Name e UABRM_Type Definition Type Definition e UABRM_Target Info Target Info e UABRM_All All Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.4 E_UAConnection Status Syntax TYPE E_UAConnection Status: ( Connected := 0 Connection Error := 1, Shutdown := 2 )DINT; END_TYPE Values Name Description Connected The connection has been established. Connection Error An error occurred while establishing the connection. Shutdown The connection was disconnected. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua PLC library Required version Tc3_PLCopen_Opc Ua >= 3.2.11.0 5.2.1.5 E_UAData Type Syntax TYPE E_UAData Type: ( e UAType_Undefinied := -1, 60 Version: 1.2.0 TF6100
## Page 61

PLC API e UAType_Null := 0, e UAType_Boolean := 1, e UAType_SByte := 2, e UAType_Byte := 3, e UAType_Int16 := 4, e UAType_UInt16 := 5, e UAType_Int32 := 6, e UAType_UInt32 := 7, e UAType_Int64 := 8, e UAType_UInt64 := 9, e UAType_Float := 10, e UAType_Double := 11, e UAType_String := 12, e UAType_Date Time := 13, e UAType_Guid := 14, e UAType_Byte String := 15, e UAType_Xml Element := 16, e UAType_Node Id := 17, e UAType_Expanded Node Id := 18, e UAType_Status Code := 19, e UAType_Qualified Name := 20, e UAType_Localized Text := 21, e UAType_Extension Object := 22, e UAType_Data Value := 23, e UAType_Variant := 24, e UAType_Diagnostic Info := 25 )DINT; END_TYPE Values Name Description e UAType_Undefinied Undefinied e UAType_Null Zero e UAType_Boolean Boolean e UAType_SByte SByte e UAType_Byte Byte e UAType_Int16 Int16 e UAType_UInt16 UInt16 e UAType_Int32 Int32 e UAType_UInt32 UInt32 e UAType_Int64 Int64 e UAType_UInt64 UInt64 e UAType_Float Float e UAType_Double Double e UAType_String String e UAType_Date Time Date Time e UAType_Guid Guid e UAType_Byte String Byte String e UAType_Xml Element Xml Element e UAType_Node Id Node Id e UAType_Expanded Node Id Expanded Node Id e UAType_Status Code Status Code e UAType_Qualified Name Qualified Name e UAType_Localized Text Localized Text e UAType_Extension Object Extension Object e UAType_Data Value Data Value e UAType_Variant Variant e UAType_Diagnostic Info Diagnostic Info TF6100 Version: 1.2.0 61
## Page 62

PLC API Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.6 E_UAIdentifier Type Syntax TYPE E_UAIdentifier Type: ( e UAIdentifier Type_String := 1, e UAIdentifier Type_Numeric := 2, e UAIdentifier Type_GUID := 3, e UAIdentifier Type_Opaque := 4 )DINT; END_TYPE Values Name Description e UAIdentifier Type_String String e UAIdentifier Type_Numeric Numeric e UAIdentifier Type_GUID GUID e UAIdentifier Type_Opaque Opaque Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.7 E_UANode Class Mask Syntax TYPE E_UANode Class Mask: ( e UANCM_Unspecified := 0, e UANCM_Object := 1, e UANCM_Variable := 2, e UANCM_Method := 4, e UANCM_Object Type := 8, e UANCM_Variable Type := 16, e UANCM_Reference Type := 32, e UANCM_Data Type := 64, e UANCM_View := 128, e UANCM_All := 255 )DINT; END_TYPE 62 Version: 1.2.0 TF6100
## Page 63

PLC API Values Name Description e UANCM_Unspecified Unspecified e UANCM_Object Object e UANCM_Variable Variable e UANCM_Method Method e UANCM_Object Type Object Type e UANCM_Variable Type Variable Type e UANCM_Reference Type Reference Type e UANCM_Data Type Data Type e UANCM_View View e UANCM_All All Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.8 E_UASecurity Msg Mode Syntax TYPE E_UASecurity Msg Mode: ( e UASecurity Msg Mode_Best Available := 0, e UASecurity Msg Mode_None := 1, e UASecurity Msg Mode_Sign := 2, e UASecurity Msg Mode_Sign_Encrypt := 3 )DINT; END_TYPE Values Name Description e UASecurity Msg Mode_Best Available Highest available security e UASecurity Msg Mode_None No security e UASecurity Msg Mode_Sign Signing e UASecurity Msg Mode_Sign_Encrypt Signing and encryption Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.9 E_UASecurity Policy Syntax TYPE E_UASecurity Policy: ( e UASecurity Policy_Best Available := 0 e UASecurity Policy_None := 1, e UASecurity Policy_Basic128 := 2, e UASecurity Policy_Basic128Rsa15 := 3, e UASecurity Policy_Basic256 := 4 )DINT; END_TYPE TF6100 Version: 1.2.0 63
## Page 64

PLC API Values Name Description Best Available Highest available security. None Guideline for configurations with minimal security requirements. Basic128 Guideline for configurations with low to medium security requirements. Basic128Rsa15 Defines a security guideline for configurations with moderate to high security requirements. Basic256 Defines a security policy for configurations with high security requirements. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.10 E_UAServer State Syntax TYPE E_UAServer State: ( Running := 0 Failed := 1, No Configuration := 2, Suspended := 3, Shutdown := 4, Test := 5, Communication Fault := 6, Unknown := 7 )DINT; END_TYPE Values Name Description Running Running Failed Failed No Configuration No Configuration Suspended Suspended Shutdown Shutdown Test Test Communication Fault Communication Fault Unknown Unknown Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua PLC library Required version Tc3_PLCopen_Opc Ua >= 3.2.11.0 5.2.1.11 E_UATransport Profile Syntax TYPE E_UATransport Profile: ( e UATransport Profile Uri_UATcp := 1, e UATransport Profile Uri_WSHttp Binary := 2, e UATransport Profile Uri_WSHttp Xml Or Binary := 3, 64 Version: 1.2.0 TF6100
## Page 65

PLC API e UATransport Profile Uri_WSHttp Xml := 4 )DINT; END_TYPE Values Name Description e UATransport Profile Uri_UATcp UATcp e UATransport Profile Uri_WSHttp Binary WSHttp Binary e UATransport Profile Uri_WSHttp Xml Or Binary WSHttp Xml Or Binary e UATransport Profile Uri_WSHttp Xml WSHttp Xml Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.12 E_UAUser Identity Token Type Syntax TYPE E_UAUser Identity Token Type: ( e UAUITT_Anonymous := 0, e UAUITT_Username := 1, e UAUITT_x509 := 2, e UAUITT_Issued Toeken := 3 )DINT; END_TYPE Values Name Description e UAUITT_Anonymous Anonymous user. e UAUITT_Username Log in by user name. e UAUITT_x509 Certificate file for logging in. e UAUITT_Issued Toeken Log in via token. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.13 ST_UABrowse Description Syntax TYPE ST_UABrowse Description: STRUCT st Starting Node Id : ST_UANode Id; e Direction : E_UABrowse Direction; st Reference Type Id : ST_UANode Id; b Include Subtypes : BOOL; e Node Class : E_UANode Class Mask; e Result Mask : E_UABrowse Result Mask; END_STRUCT END_TYPE TF6100 Version: 1.2.0 65
## Page 66

PLC API Values Name Description st Starting Node Id Default Starting Node: Object Root e Direction Default Browse Direction: Forward st Reference Type Id Default Reference Type: Hierarchical b Include Subtypes Default Include Subtypes: TRUE e Node Class Default Node Class Mask: All e Result Mask Default Browse Result Mask: All Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.14 ST_UAExpanded Node ID Syntax TYPE ST_UAExpanded Node ID: STRUCT n Server Index : UDINT; s Namespace URI : STRING(MAX_STRING_LENGTH); st Node ID : ST_UANode ID; END_STRUCT END_TYPE Values Name Description n Server Index Server Index s Namespace URI Namespace Name st Node ID Node ID (ST_UANode ID [} 68]) Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.15 ST_UASession Connect Info Syntax TYPE ST_UASession Connect Info: STRUCT s Application Name : STRING(MAX_STRING_LENGTH); e Security Mode : E_UASecurity Msg Mode; e Security Policy Uri : E_UASecurity Policy; e Transport Profile Uri : E_UATransport Profile; t Session Timeout : TIME; t Connect Timeout : TIME; END_STRUCT END_TYPE 66 Version: 1.2.0 TF6100
## Page 67

PLC API Values Name Description s Application Uri (obsolete) Application Uri maximum string length 255. From Tc UAClient 2.0.0.14 or higher this is automatically specified by the certificate, as defined in the PLCOpen specification. Therefore no longer used in current library versions. s Application Name Application name with a maximum string length of 255. e Security Mode Security message mode. For available modes see E_UASecurity Msg Mode [} 63]. e Security Policy Uri Security policy Uri. For available security policy Uri see E_UASecurity Policy [} 63]. e Transport Profile Uri Transport profile Uri. For available transport profile Uri see E_UATransport Profile [} 64]; st User Ident Token Type Structure with authentication data for logging on to the OPC UA Server. Full description under ST_UAUser Identity Token Type [} 70]. t Session Timeout Session timeout value. t Connect Timeout Value for the connection timeout. This must be set at the UA_Connect function block to match the ADS timeout. The rule of thumb is: ADS Timeout > 2 * Connection Timeout. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.16 ST_UAIndex Range Syntax TYPE ST_UAIndex Range: STRUCT n Start Index : UDINT; n End Index : UDINT; END_STRUCT END_TYPE Values Name Description n Start Index Start index of the data. n End Index End index of the data. For all dimensions: • Start Index and End Index must be assigned. • Start Index must be smaller than End Index. • To be able to access all elements in a dimension, Start Index and End Index must be assigned in the dimension depending on the total number of elements. • Individual elements of a dimension can be selected by specifying the same Start Index and End Index. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua TF6100 Version: 1.2.0 67
## Page 68

PLC API 5.2.1.17 ST_UALocalized Text Syntax TYPE ST_UALocalized Text: STRUCT s Locale : STRING(6); s Text : STRING(MAX_STRING_LENGTH); END_STRUCT END_TYPE Values Name Description s Locale Language identifier of the Localized Text s Text Text Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.18 ST_UAMethod Arg Info Syntax TYPE ST_UAMethod Arg Info: STRUCT Data Type : E_UAData Type := -1; Value Rank : DINT := 2147483647; Array Dimensions : ARRAY[1..3] OF UDINT := [0,0,0]; n Len Data : DINT; END_STRUCT END_TYPE Values Name Description Data Type Defines the UA data type for the method parameter. (Type: E_UAData Type [} 60]) Value Rank Determines whether the parameter is scalar (-1) or array. Array Dimensions If the parameter is an array, it specifies the dimensions of the array. Each element determines the length per dimension. n Len Data Specifies the length of the argument. For output information STRUCT only requests this element. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.19 ST_UANode ID Syntax TYPE ST_UANode ID: STRUCT n Namespace Index : UINT; n Reserved : ARRAY [1..2] OF BYTE; //fill bytes s Identifier : STRING(MAX_STRING_LENGTH); e Identifier Type : E_UAIdentifier Type; END_STRUCT END_TYPE 68 Version: 1.2.0 TF6100
## Page 69

PLC API Values Name Description n Namespace Index Namespace index under which the node is available. Can be determined with the function block UA_Get Namespace Index [} 77]. n Reserved Placeholder s Identifier Identifier as shown in the UA namespace (attribute 'Identifier'). e Identifier Type Variable type, described by E_UAIdentifier Type [} 62]. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.20 ST_UANode Additional Info Syntax TYPE ST_UANode Additional Info: STRUCT e Attribute ID : E_UAAttribute ID; n Index Range Count : UINT; n Reserved : ARRAY[1..2] OF BYTE; // fill bytes st Index Range : ARRAY[1..n Max Index Range] OF ST_UAIndex Range; END_STRUCT END_TYPE Values Name Description e Attribute ID Specifies the ID of the OPC UA attribute. e UAAI_Value is used by default. (Type: E_UAAttribute ID [} 58]). n Index Range Count Determines how many index ranges are used in st Index Range. n Reserved Placeholder st Index Range Specifies an index range for reading values from an array. (Type: ST_UAIndex Range [} 67]). Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.21 ST_UAReference Description Syntax TYPE ST_UAReference Description: STRUCT st Reference Type Id : ST_UANode Id; b Is Forward : BOOL; st Node Id : ST_UAExpanded Node Id; st Browse Name : STRING(MAX_STRING_LENGTH); st Display Name : ST_UALocalized Text; e Node Class : E_UANode Class Mask; st Type Definition : ST_UAExpanded Node Id; END_STRUCT END_TYPE TF6100 Version: 1.2.0 69
## Page 70

PLC API Values Name Description st Reference Type Id Node Id of the reference type (e.g. Organizes, Has Child, Has Type Definition, ...) as data type ST_UANode Id [} 68]. b Is Forward Indicates whether the reference is a forward or backward reference. st Node Id Node Id as data type ST_UAExpanded Node Id [} 66]. st Browse Name Browse Name of the reference. st Display Name Display Name of the reference (ST_UALocalized Text [} 68]). e Node Class Node Class of the reference (E_UANode Class Mask [} 62]). st Type Definition Type definition (Has Type Definition) (ST_UAExpanded Node Id [} 66]). Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.22 ST_UAUser Identity Token Type Syntax TYPE ST_UAUser Identity Token Type: STRUCT e User Ident Token Type : E_UAUser Identity Token Type; s Token Param1 : STRING(MAX_STRING_LENGTH); s Token Param2 : STRING(MAX_STRING_LENGTH); END_STRUCT END_TYPE Values Name Description e User Ident Token Type Type of user, described using E_UAUser Identity Token Type [} 65].. s Token Param1 User name for logging on to the OPC UA Server. s Token Param2 Password for logging on to the OPC UA Server. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.1.23 UAHAData Value This function block acts as a data object. An instance represents a value for the OPC UA Historical Access function. A whole field of these values is transferred to the UA_History Update [} 78] function block on calling. Syntax a Data Values : ARRAY [1..50] OF UAHAData Value(Value Size:=SIZEOF(LREAL)); Each data object is initialized with the expected size (in bytes) of the value. 70 Version: 1.2.0 TF6100
## Page 71

PLC API Properties Name Type Access Initial value Description Value PVOID Set - Specifies the address of a variable containing the desired value. This is usually assigned with the help of the operator ADR(). The value itself is hereby assigned at the same time and copied into the data object. Status Code UAHAUpdate St Get, Set UAHAUpdate Stat Indicates the status code of us Code. Historian the value. atus Code Raw [} 71] Source Time Stamp ULINT Get, Set 0 Indicates the timestamp of the source in UTC format. This can be determined with the help of the function F_Get System Time (Tc2_System PLC library). Server Time Stamp ULINT Get, Set 0 Indicates the timestamp of the OPC UA Server in UTC format. This function is not currently supported. Data type size of the value The size of the data type used is already indicated and thus defined in the declaration of the data object. This size is taken as the basis when assigning a value later. Values of the type STRING are accordingly also saved and transmitted with a fixed initialized size. An indication of the current text length cannot be made. Sample {attribute 'OPC. UA. DA' := '1'} f My Value : LREAL; // Variable for Historcal Access a Data Values : ARRAY [1..50] OF UAHAData Value(Value Size:=SIZEOF(LREAL)); f My Value := 27.75; a Data Values[1]. Value := ADR(f My Value); a Data Values[1]. Status Code := UAHAUpdate Status Code. Historian Raw; a Data Values[1]. Source Time Stamp := F_Get System Time(); In this sample a field of 50 values is defined, of which each is represented by a data object. The current content of the variable f My Value (= 27.75) is assigned to the first value. The field can now be filled by means of further assignments in subsequent PLC cycles. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 >= 4024.1 Win32, Win64, Win CE-x86 Tc3_PLCopen_Opc Ua >= v3.1.9.0 5.2.1.24 UAHAUpdate Status Code A status code is assigned to each data value transferred using the OPC UA Historical Access function. This is a property of the object UAHAData Value [} 70]. TF6100 Version: 1.2.0 71
## Page 72

PLC API Syntax {attribute 'qualified_only'} TYPE UAHAUpdate Status Code : ( Historian Raw := 0, // A raw data value. Historian Calculated := 1, // A data value which was calculated. Historian Interpolated := 2, // A data value which was interpolated. Reserved := 3, // Undefined. Historian Partial := 4, // A data value which was calculated with an incomplete interva l. Historian Extra Data := 8, // A raw data value that hides other data at the same timestamp. Historian Multi Value := 16 // Multiple values match the Aggregate criteria (i.e. multiple min imum values at different timestamps within the same interval). ) UDINT; END_TYPE Values Name Description Historian Raw Historian Raw Historian Calculated Historian Calculated Historian Interpolated Historian Interpolated Reserved Reserved Historian Partial Historian Partial Historian Extra Data Historian Extra Data Historian Multi Value Historian Multi Value Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 >= 4024.1 Win32, Win64, Win CE-x86 Tc3_PLCopen_Opc Ua >= v3.1.9.0 5.2.2 Function blocks 5.2.2.1 UA_Browse This function block allows browsing through the namespace of a server. Starting from a start node, its references are read and returned accordingly. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Browse Description : ST_UABrowse Description; Continuation Point In : DWORD; Timeout : TIME; END_VAR 72 Version: 1.2.0 TF6100
## Page 73

PLC API Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Browse Description ST_UABrowse Description [} 65] The address information for the node to be read is specified here. Continuation Point In DWORD If a previous call of the function block returned a value as Continuation Point Out, this value can be created here to get further data from the server. Timeout TIME Time until the function is aborted. Inputs/outputs VAR_IN_OUT Reference Descriptions : POINTER TO ST_UAReference Descriptions; END_VAR Name Type Description Reference Descript POINTER Contains the list of Reference Descriptions returned by the server, i.e. the ions TO result of the UA_Browse call. The contained Reference Descriptions can ST_UARef then be used for further UA_Browse calls in the Browse Description, e.g. to erence Des navigate deeper into the namespace. criptions Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; Continuation Point Out : DWORD; cb Browse Result Cnt : UDINT; END_VAR Name Type Description Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command-specific error code is included in Error ID. Error ID DWORD Contains the command-specific error code of the most recently executed command. Continuation Point DWORD If the server returns data batch-wise (Continuation Point Out != 0), the value Out of Continuation Point Out can be used as Continuation Point In at the next call of the function block to get the further data. cb Browse Result C UDINT Number of Reference Descriptions. nt Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua TF6100 Version: 1.2.0 73
## Page 74

PLC API 5.2.2.2 UA_Connect This function block establishes an OPC UA Remote connection to another OPC UA Server, which is specified via Server Url and Session Connect Info. The function block returns a connection handle that can be used for other function blocks, such as UA_Read. Inputs VAR_INPUT Execute : BOOL; Server Url : STRING(MAX_STRING_LENGTH); Session Connect Info : ST_UASession Connect Info; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Server Url STRING(MAX_STRING_LENGTH) OPC UA Server URL, i.e. 'opc.tcp:// 172.16.3.207:4840' or 'opc.tcp:// CX_0193BF:4840'. Session Connect Info ST_UASession Connect Info Connection information (see ST_UASession Connect Info [} 66]) Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. The value must be set to match the ST_UASession Connect Info.t Connecti on Timeout. The rule of thumb is: ADS Timeout > 2 * Connection Timeout. Outputs VAR_OUTPUT Connection Hdl : DWORD; Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; END_VAR Name Type Description Connection Hdl DWORD OPC UA connection handle. Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command-specific error code is included in Error ID. Error ID DWORD Contains the command-specific error code of the most recently executed command. 74 Version: 1.2.0 TF6100
## Page 75

PLC API Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.3 UA_Connect Get Status This function block checks the connection status of an existing connection to another OPC UA Server. The connection is referenced via the respective connection handle. The status is then returned as E_UAConnection Status [} 60]. The connection status is determined based on the internal session info or the OPC UA heartbeat, no additional communication (read or similar) is performed. The service level of the OPC UA Server can be read out via the additional input parameter Get Service Level. For this purpose, a read command is sent to the server in the background to determine this information. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Get Service Level : BOOL; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle of an existing communication link. Get Service Level BOOL Reads out the Service Level of the OPC UA Server. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. The value must be set to match the ST_UASession Connect Info.t Connection Timeout. The rule of thumb is: ADS Timeout > 2 * Connection Timeout. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; Connection Status : E_UAConnection Status; Server State : E_UAServer State; Service Level : BYTE; END_VAR TF6100 Version: 1.2.0 75
## Page 76

PLC API Name Type Description Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command-specific error code is included in Error ID. Error ID DWORD Contains the command-specific error code of the most recently executed command. Connection Status E_UAConnection Status Connection status (see E_UAConnection Status [} 60]). Server State E_UAServer State Server state (see E_UAServer State [} 64]). Server State BYTE Service Level of the OPC UA Server. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua PLC library Required version Tc3_PLCopen_Opc Ua >= 3.2.11.0 5.2.2.4 UA_Disconnect This function block closes an OPC UA Remote connection to another OPC UA Server. The connection is specified via its connection handle. Disconnect all connections If the UA-Disconnect method is called and a connection handle of 0 is passed, the OPC UA client disconnects all existing connections. This also applies to connections established via an OPC UA I/ O client configuration. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. 76 Version: 1.2.0 TF6100
## Page 77

PLC API Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; END_VAR Name Type Description Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command- specific error code is contained in n Err ID. Error ID DWORD Contains the command-specific error code of the most recently executed command. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.5 UA_Get Namespace Index This function block collects the namespace index for a namespace URI. The namespace index is required for identifying symbols, for example, if the function blocks UA_Read [} 89]or UA_Write [} 91]are used. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Namespace Uri : STRING(MAX_STRING_LENGTH); Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Namespace Uri STRING Namespace URI to be resolved. For the Twin CAT OPC UA Server, this is "urn:Beckhoff Automation:Ua:PLC1“" for the first PLC runtime. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Outputs VAR_OUTPUT Namespace Index : UINT; Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; END_VAR TF6100 Version: 1.2.0 77
## Page 78

PLC API Name Type Description Namespace Index UINT Namespace Index of the given namespace URI. This can be used in other function blocks, e.g. UA_Node Get Handle or UA_Method Get Handle. Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command-specific error code is included in Error ID. Error ID DWORD Contains the command-specific error code of the most recently executed command. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.6 UA_History Update This function block sends historical data via OPC UA to a server that supports the OPC UA History Update function, e.g. the Twin CAT OPC UA Server. With one call you can transfer a large number of values including time stamps to the server for a node handle. The server ensures that the values transmitted are saved in a data memory and are available via Historical Access. The function block can be instanced several times if values of several node handles (different variables) are to be transmitted. 78 Version: 1.2.0 TF6100
## Page 79

PLC API Operation with Twin CAT OPC UA Server The function block is well suited if you use Historical Access in the Twin CAT OPC UA Server and want to make data available from a certain time interval in which, for example, a special machine state prevailed. Values for the desired period can be purposefully transmitted. If on the other hand values are sent cyclically and are to be made available in the server via Historical Access, then the Historical Access function on the server side is better suited, as in this case you only have to configure the recording node in the configurator and set the desired sampling rate. See also: Program sample TF6100_OPCUA_HASample Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Node Hdl : DWORD; Perform Insert : BOOL; Perform Replace : BOOL; Data Value Count : UINT; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Node Hdl DWORD Node handle that was previously output by the function block UA_Node Get Handle. Perform Insert BOOL The default is TRUE. Perform Replace BOOL The default is FALSE. If a value for the given timestamp already exists in the history, it should be replaced if the Perform Replace option is set (= TRUE). Currently this option can only be selected for SQL adapters. Other adapters do not support the option. Data Value Count UINT Defines the number of values transferred. A maximum number of 1000 values is supported. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Inputs/outputs VAR_IN_OUT Data Values : ARRAY[*] OF UAHAData Value; Value Error IDs : ARRAY[*] OF DWORD; END_VAR Name Type Description Data Values (read-only) ARRAY All collected values are transferred in the form of a field of the type UAHAData Value. The length of the field is not prescribed, but it must correspond at least to the specification of Data Value Count. Internally the values are accessed only for reading. Value Error IDs (write-only) ARRAY After execution of the command this field contains an error code for each value. The length of the field must correspond at least to the specification of Data Value Count. If one or more values report an error, it is also signaled via the outputs Error and Error ID of the function block. With the help of this field you can then determine which error has occurred for which value. The error code 16#80000000, for example, signalizes a failed operation, meaning that the value could not be written. TF6100 Version: 1.2.0 79
## Page 80

PLC API Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; END_VAR Name Type Description Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command- specific error code is included in Error ID. Error ID DWORD Contains the command-specific ADS error code of the most recently executed command. Number of values transferred The larger the number, the greater the required computing effort and thus the longer the PLC execution time when executing the command. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 >= 4024.1 Win32, Win64, Win CE-x86 Tc3_PLCopen_Opc Ua >= v3.1.9.0 5.2.2.7 UA_Method Call This function block calls a method on a remote UA Server. The method is determined by a connection and a method handle. The former can be queried by UA_Connect [} 74], the latter by UA_Method Get Handle [} 83]. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Method Hdl : DWORD; 80 Version: 1.2.0 TF6100
## Page 81

PLC API n Number Of Input Arguments : UDINT; p Input Arg Info : POINTER TO ST_UAMethod Arg Info; cb Input Arg Info : UDINT; p Input Arg Data : PVOID; cb Input Arg Data : UDINT; p Input Write Data : PVOID; cb Input Write Data : UDINT; n Number Of Output Arguments : UDINT; p Output Arg Info : POINTER TO ST_UAMethod Arg Info; cb Output Arg Info : UDINT; p Output Arg Info And Data : PVOID; cb Output Arg Info And Data : UDINT; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TF6100 Version: 1.2.0 81
## Page 82

PLC API Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Method Hdl DWORD Method handle, previously output by the function block UA_Method Get Handle. n Number Of Input Ar UDINT Number of input parameters. guments p Input Arg Info POINTER TO ST_UAMethod Arg Info Points to the buffer address where input parameter information is stored in the form of an array ST_UAMethod Arg Info. cb Input Arg Info UDINT Size of the buffer where the input parameter information is stored. p Input Arg Data PVOID Points to the buffer address where input parameters (constant length) are stored. cb Input Arg Data UDINT Size of the input buffer where input parameters (with constant length) are stored. p Input Write Data PVOID Pointer to buffer address where input parameters (dynamic length) are stored. cb Input Write Data UDINT Size of the input buffer where input parameters (with dynamic length) are stored. n Number Of Output UDINT Number of output parameters. Arguments p Output Arg Info POINTER TO ST_UAMethod Arg Info Points to the buffer address where output parameter information is stored as array ST_UAMethod Arg Info. n Len Data is required to determine the target memory of the individual output parameters. The other elements can be set in such a way that a type check of the returned parameters takes place or remains undefined. cb Output Arg Info UDINT Size of the buffer where the output parameter information is stored. p Output Arg Info An PVOID Points to the buffer address where the d Data output parameters are to be saved as a BYTE array. The BYTE array contains the number of output parameters as DINT, four reserved bytes and parameter information as ARRAY OF ST_UAMethod Arg Info [} 68] (with the length of the output parameters), followed by pure data. Note that the data is packed as 1-byte alignment. cb Output Arg Info A UDINT Size of the buffer in which the output nd Data parameters are to be saved as a BYTE array. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Outputs VAR_OUTPUT cb Read_R : UDINT; Done : BOOL; 82 Version: 1.2.0 TF6100
## Page 83

PLC API Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description cb Read_R UDINT Counts all the bytes received. Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command- specific error code is contained in n Err ID. Error ID UDINT Contains the command-specific error code of the most recently executed command. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.8 UA_Method Get Handle This function block collects a handle for a UA method, which can then be used to call a method using UA_Method Call [} 80]. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Object Node ID : ST_UANode ID; Method Node ID : ST_UANode ID; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Object Node ID ST_UANode ID Object node ID of the method to be called. (Type: ST_UANode ID [} 68]). Method Node ID ST_UANode ID Method node ID of the method to be called. Corresponds to the ID attribute in the UA namespace. (Type: UA_Connect [} 74]). Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. TF6100 Version: 1.2.0 83
## Page 84

PLC API Outputs VAR_OUTPUT Method Hdl : DWORD; Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Method Hdl DWORD Returns a method handle that can be used to call a method via UA_Method Call [} 80]. Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command-specific error code is contained in n Err ID. Error ID UDINT Contains the command-specific error code of the most recently executed command. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.9 UA_Method Release Handle This function block releases the specified method handle. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Method Hdl : DWORD; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Method Hdl DWORD Method handle previously output by the function block UA_Method Get Handle. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; 84 Version: 1.2.0 TF6100
## Page 85

PLC API Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command- specific error code is contained in n Err ID. Error ID UDINT Contains the command-specific ADS error code of the most recently executed command. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.10 UA_Node Get Handle This function block queries a node handle for a given symbol in the UA namespace. The symbol is specified by a connection handle and its node ID. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Node ID : ST_UANode ID; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Node ID ST_UANode ID Unique addressing of the UA node, consisting of Identifier, Identifier Type and Namespace Index, which are resolved from a Namespace Name, e.g. by means of the method UA_Get Namespace Index [} 77]. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Outputs VAR_OUTPUT Node Hdl : DWORD; Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; END_VAR TF6100 Version: 1.2.0 85
## Page 86

PLC API Name Type Description Node Hdl DWORD Node handle that can be used for other function blocks, such as UA_Read or UA_Write. Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs do not accept new commands as long as Busy is TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command- specific error code is included in Error ID. Error ID DWORD Contains the command-specific ADS error code of the most recently executed command. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.11 UA_Node Get Handle List This function block queries node handles for nodes in the UA namespace. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Node IDCount : UINT; Node IDs : ARRAY[1..n Max Node IDs In List] OF ST_UANode ID; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Node IDCount UINT Number of nodes for which a node handle is required. Node IDs ARRAY Array of Node IDs created with struct ST_UANode ID [} 68]. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Outputs VAR_OUTPUT Node Hdls : ARRAY[1..n Max Node IDs In List] OF DWORD; Node Error IDs : ARRAY[1..n Max Node IDs In List] OF DWORD; cb Data_R : UDINT; Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; END_VAR 86 Version: 1.2.0 TF6100
## Page 87

PLC API Name Type Description Node Hdls ARRAY Array of requested node handles. Node Error IDs ARRAY Array of error IDs if no node handles are available. cb Data_R UDINT Size of the data read. Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command-specific error code is in n Err ID. Error ID DWORD Contains the error ID if an error occurs. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.12 UA_Node Release Handle This function block releases a node handle. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Node Hdl : DWORD; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Node Hdl DWORD Node handle to be released. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; END_VAR TF6100 Version: 1.2.0 87
## Page 88

PLC API Name Type Description Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command- specific error code is included in Error ID. Error ID DWORD Contains the command-specific ADS error code of the most recently executed command. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.13 UA_Node Release Handle List This function block releases several node handles. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Node Hdl Count : UINT; Node Hdls : ARRAY[1..n Max Node IDs In List] OF DWORD; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect. Node Hdl Count UINT Number of node handles. Node Hdls ARRAY Array of node handles to be released. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Outputs VAR_OUTPUT Node Error IDs : ARRAY[1..n Max Node IDs In List] OF DWORD; Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; END_VAR 88 Version: 1.2.0 TF6100
## Page 89

PLC API Name Type Description Node Error IDs ARRAY Array of error IDs if a node handle could not be released. Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command-specific error code is in n Err ID. Error ID DWORD Contains the error ID if an error occurs. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.14 UA_Read This function block reads values from a given node and connection handle. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Node Hdl : DWORD; st Node Add Info : ST_UANode Additional Info; p Variable : PVOID; cb Data : UDINT; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection DWORD Connection handle previously output by the function block Hdl UA_Connect. Node Hdl DWORD Node handle that was previously output by the function block UA_Node Get Handle. st Node Add I ST_UANode Additional Info Defines additional information, such as which attribute is nfo read from the UA namespace (default: 'Value' attribute) or which Index Range is to be used. Specified by STRUCT ST_UANode Additional Info [} 69]. p Variable PVOID Pointer to data memory where the read data is to be stored. cb Data UDINT Determines the size of the data to be read. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. TF6100 Version: 1.2.0 89
## Page 90

PLC API Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; cb Data_R : UDINT; END_VAR Name Type Description Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command- specific error code is contained in n Err ID. Error ID UDINT Contains the command-specific ADS error code of the most recently executed command. cb Data_R UDINT Number of bytes to be read. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.15 UA_Read List This function block reads values from several given node and connection handles. Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Node Hdl Count : UINT; Node Hdls : ARRAY[1..n Max Node IDs In List] OF DWORD; st Node Add Info : ARRAY[1..n Max Node IDs In List] OF ST_UANode Additional Info; p Variable : PVOID; cb Data : ARRAY[1..n Max Node IDs In List] UDINT; cb Data Total : UDINT; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR 90 Version: 1.2.0 TF6100
## Page 91

PLC API Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect [} 74]. Node Hdl Count UINT Number of node handles stored in the input variable Node Hdls. Node Hdls ARRAY Array of node handles previously received by the function block UA_Node Get Handle [} 85] or UA_Node Get Handle List [} 86]. st Node Add Info ARRAY Defines additional information, such as which attribute is read from the UA namespace (default: 'Value' attribute) or which Index Range is to be used. Specified by STRUCT ST_UANode Additional Info [} 69]. p Variable PVOID Pointer to data memory where the read data is to be stored. cb Data ARRAY Determines the size of the data to be read. cb Data Total UDINT Total size of the data to be received. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; cb Data_R : UDINT; END_VAR Name Type Description Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command- specific error code is in n Err ID. Error ID UDINT Contains the command-specific ADS error code of the most recently executed command. cb Data_R UDINT Number of bytes read. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.2.16 UA_Write This function block writes values to a given node and connection handle. TF6100 Version: 1.2.0 91
## Page 92

PLC API Inputs VAR_INPUT Execute : BOOL; Connection Hdl : DWORD; Node Hdl : DWORD; st Node Add Info : ST_UANode Additional Info; p Variable : PVOID; cb Data : UDINT; Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Connection Hdl DWORD Connection handle previously output by the function block UA_Connect [} 74]. Node Hdl DWORD Node handle that was previously output by the function block UA_Node Get Handle [} 85]. st Node Add Info ST_UANode Additional Info Defines additional information, e.g. which Index Range or which attribute is to be written (by default, the' Value' attribute is used). Specified by STRUCT ST_UANode Additional Info [} 69]. p Variable PVOID Pointer to data to be written. cb Data UDINT Sets the size of the values to be written. Timeout TIME Time until the function is aborted. DEFAULT_ADS_TIMEOUT is a global constant, set to 5 seconds. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : DWORD; END_VAR Name Type Description Done BOOL Switches to TRUE if the function block was executed successfully. Busy BOOL TRUE until the function block has executed a command, at the most for the duration of the "Timeout" at the input. The inputs accept no new command as long as Busy = TRUE. It is not the connection time that is monitored but the reception time. Error BOOL Switches to TRUE if an error occurs while executing a command. The command- specific error code is included in Error ID. Error ID DWORD Contains the command-specific ADS error code of the most recently executed command. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1 Win32, Win64, CE-X86, CE-Arm® Tc3_PLCopen_Opc Ua 5.2.3 Parameter list The following parameters from the Tc3_PLCopen_Opc Ua library influence how the communication works. 92 Version: 1.2.0 TF6100
## Page 93

PLC API Name Type Default value Description n Max Node IDs In List UINT 10 Specifies the maximum number of nodes in a list, for example for the function blocks UA_Node Get Handle List [} 86], UA_Read List [} 90] and UA_Node Release Handle List [} 88]. s Net Id T_Ams N 127.0.0.1.1.1 Specifies the AMS Net ID of the device on et ID which the Twin CAT OPC UA Client is running. Normally, PLC and client run on the same system. TF6100 Version: 1.2.0 93
## Page 94

Samples 6 Samples Sample code and configurations for this product can be obtained from the corresponding repository on Git Hub: https://github.com/Beckhoff/TF6100_Samples. There you have the possibility to clone the repository or download a ZIP file with the sample. The following samples exist: Name Twin CAT Ver- Description sion TF6100_Opc Ua_Client_Sample Twin CAT 3 This sample contains sample code for various functions of the Twin CAT OPC UA Client (PLCOpen function blocks). These include Browse, Connect, History Update, Method Call, Read and Write. The server sample for access is also included. TF6100_Opc Ua_Server_Sample Twin CAT 3 This sample contains a PLC with extensive provision of PLC data for the Twin CAT OPC UA Server (OPC UA Data Access). TS6100_Opc Ua_Client_Sample Twin CAT 2 This sample contains sample code for various functions of the Twin CAT OPC UA Client (PLCOpen function blocks). These include Method Call, Read and Write. TS6100_Opc Ua_Server_Sample Twin CAT 2 This sample demonstrates the use of PLC comments to release variables via the Twin CAT OPC UA Server. 94 Version: 1.2.0 TF6100
## Page 95

Tutorials 7 Tutorials Video tutorials for this product can be found on our website at https://www.beckhoff.com/tutorials. The video tutorials offer a quick start to the product and the individual product facets. TF6100 Version: 1.2.0 95
## Page 96

Appendix 8 Appendix 8.1 Error diagnosis In the following sections, possible errors for all components of the OPC UA setup are shown in the form of a table. In addition, helpful troubleshooting hints are provided for the respective errors. Behavior Remedy The attempt to read or write a Structured Data Type Structured Data Types are not supported by the from a server using the PLCopen function blocks PLCopen-based client. Please use the I/O client for fails. this purpose. When the PLCopen function blocks are executed, the This is an indication of insufficient ADS router Busy output remains TRUE, but no error is output memory. Please increase your router memory in the and the timeout is not triggered. corresponding settings of the Twin CAT ADS router. When creating a new I/O client by specifying the Please check if name resolution is operational in your Server URL with the host name of the server, no network. Alternatively try again via the IP address of connection can be established subsequently via the the server. Add Nodes dialog. Some configuration items from the I/O client are not In this case, the System Manager description file present, although they should be according to the (TMC) was probably not updated after a TF6100 documentation. update. Please execute the command "Reload TMC" from the context menu of the I/O client to reload the description file. Write commands to a variable are not executed by Please check whether the "Write Enable" output has the I/O client or do not reach the server. been enabled on the I/O client. 8.2 Status codes 8.2.1 ADS Return Codes Grouping of error codes: Global error codes: 0x000 [} 96]... (0x9811_0000 ...) Router error codes: 0x500 [} 97]... (0x9811_0500 ...) General ADS errors: 0x700 [} 97]... (0x9811_0700 ...) RTime error codes: 0x1000 [} 99]... (0x9811_1000 ...) Global error codes 96 Version: 1.2.0 TF6100
## Page 97

Appendix Hex Dec HRESULT Name Description 0x0 0 0x98110000 ERR_NOERROR No error. 0x1 1 0x98110001 ERR_INTERNAL Internal error. 0x2 2 0x98110002 ERR_NORTIME No real time. 0x3 3 0x98110003 ERR_ALLOCLOCKEDMEM Allocation locked – memory error. 0x4 4 0x98110004 ERR_INSERTMAILBOX Mailbox full – the ADS message could not be sent. Reducing the number of ADS messages per cycle will help. 0x5 5 0x98110005 ERR_WRONGRECEIVEHMSG Wrong HMSG. 0x6 6 0x98110006 ERR_TARGETPORTNOTFOUND Target port not found – ADS server is not started, not reachable or not installed. 0x7 7 0x98110007 ERR_TARGETMACHINENOTFOUND Target computer not found – AMS route was not found. 0x8 8 0x98110008 ERR_UNKNOWNCMDID Unknown command ID. 0x9 9 0x98110009 ERR_BADTASKID Invalid task ID. 0x A 10 0x9811000A ERR_NOIO No IO. 0x B 11 0x9811000B ERR_UNKNOWNAMSCMD Unknown AMS command. 0x C 12 0x9811000C ERR_WIN32ERROR Win32 error. 0x D 13 0x9811000D ERR_PORTNOTCONNECTED Port not connected. 0x E 14 0x9811000E ERR_INVALIDAMSLENGTH Invalid AMS length. 0x F 15 0x9811000F ERR_INVALIDAMSNETID Invalid AMS Net ID. 0x10 16 0x98110010 ERR_LOWINSTLEVEL Installation level is too low –Twin CAT 2 license error. 0x11 17 0x98110011 ERR_NODEBUGINTAVAILABLE No debugging available. 0x12 18 0x98110012 ERR_PORTDISABLED Port disabled – Twin CAT system service not started. 0x13 19 0x98110013 ERR_PORTALREADYCONNECTED Port already connected. 0x14 20 0x98110014 ERR_AMSSYNC_W32ERROR AMS Sync Win32 error. 0x15 21 0x98110015 ERR_AMSSYNC_TIMEOUT AMS Sync Timeout. 0x16 22 0x98110016 ERR_AMSSYNC_AMSERROR AMS Sync error. 0x17 23 0x98110017 ERR_AMSSYNC_NOINDEXINMAP No index map for AMS Sync available. 0x18 24 0x98110018 ERR_INVALIDAMSPORT Invalid AMS port. 0x19 25 0x98110019 ERR_NOMEMORY No memory. 0x1A 26 0x9811001A ERR_TCPSEND TCP send error. 0x1B 27 0x9811001B ERR_HOSTUNREACHABLE Host unreachable. 0x1C 28 0x9811001C ERR_INVALIDAMSFRAGMENT Invalid AMS fragment. 0x1D 29 0x9811001D ERR_TLSSEND TLS send error – secure ADS connection failed. 0x1E 30 0x9811001E ERR_ACCESSDENIED Access denied – secure ADS access denied. Router error codes Hex Dec HRESULT Name Description 0x500 1280 0x98110500 ROUTERERR_NOLOCKEDMEMORY Locked memory cannot be allocated. 0x501 1281 0x98110501 ROUTERERR_RESIZEMEMORY The router memory size could not be changed. 0x502 1282 0x98110502 ROUTERERR_MAILBOXFULL The mailbox has reached the maximum number of possible messages. 0x503 1283 0x98110503 ROUTERERR_DEBUGBOXFULL The Debug mailbox has reached the maximum number of possible messages. 0x504 1284 0x98110504 ROUTERERR_UNKNOWNPORTTYPE The port type is unknown. 0x505 1285 0x98110505 ROUTERERR_NOTINITIALIZED The router is not initialized. 0x506 1286 0x98110506 ROUTERERR_PORTALREADYINUSE The port number is already assigned. 0x507 1287 0x98110507 ROUTERERR_NOTREGISTERED The port is not registered. 0x508 1288 0x98110508 ROUTERERR_NOMOREQUEUES The maximum number of ports has been reached. 0x509 1289 0x98110509 ROUTERERR_INVALIDPORT The port is invalid. 0x50A 1290 0x9811050A ROUTERERR_NOTACTIVATED The router is not active. 0x50B 1291 0x9811050B ROUTERERR_FRAGMENTBOXFULL The mailbox has reached the maximum number for fragmented messages. 0x50C 1292 0x9811050C ROUTERERR_FRAGMENTTIMEOUT A fragment timeout has occurred. 0x50D 1293 0x9811050D ROUTERERR_TOBEREMOVED The port is removed. General ADS error codes TF6100 Version: 1.2.0 97
## Page 98

Appendix Hex Dec HRESULT Name Description 0x700 1792 0x98110700 ADSERR_DEVICE_ERROR General device error. 0x701 1793 0x98110701 ADSERR_DEVICE_SRVNOTSUPP Service is not supported by the server. 0x702 1794 0x98110702 ADSERR_DEVICE_INVALIDGRP Invalid index group. 0x703 1795 0x98110703 ADSERR_DEVICE_INVALIDOFFSET Invalid index offset. 0x704 1796 0x98110704 ADSERR_DEVICE_INVALIDACCESS Reading or writing not permitted. Several causes are possible. For example, an incorrect password was entered when creating routes. 0x705 1797 0x98110705 ADSERR_DEVICE_INVALIDSIZE Parameter size not correct. 0x706 1798 0x98110706 ADSERR_DEVICE_INVALIDDATA Invalid data values. 0x707 1799 0x98110707 ADSERR_DEVICE_NOTREADY Device is not ready to operate. 0x708 1800 0x98110708 ADSERR_DEVICE_BUSY Device is busy. 0x709 1801 0x98110709 ADSERR_DEVICE_INVALIDCONTEXT Invalid operating system context. This can result from use of ADS blocks in different tasks. It may be possible to resolve this through multitasking synchronization in the PLC. 0x70A 1802 0x9811070A ADSERR_DEVICE_NOMEMORY Insufficient memory. 0x70B 1803 0x9811070B ADSERR_DEVICE_INVALIDPARM Invalid parameter values. 0x70C 1804 0x9811070C ADSERR_DEVICE_NOTFOUND Not found (files, ...). 0x70D 1805 0x9811070D ADSERR_DEVICE_SYNTAX Syntax error in file or command. 0x70E 1806 0x9811070E ADSERR_DEVICE_INCOMPATIBLE Objects do not match. 0x70F 1807 0x9811070F ADSERR_DEVICE_EXISTS Object already exists. 0x710 1808 0x98110710 ADSERR_DEVICE_SYMBOLNOTFOUND Symbol not found. 0x711 1809 0x98110711 ADSERR_DEVICE_SYMBOLVERSIONINVALID Invalid symbol version. This can occur due to an online change. Create a new handle. 0x712 1810 0x98110712 ADSERR_DEVICE_INVALIDSTATE Device (server) is in invalid state. 0x713 1811 0x98110713 ADSERR_DEVICE_TRANSMODENOTSUPP Ads Trans Mode not supported. 0x714 1812 0x98110714 ADSERR_DEVICE_NOTIFYHNDINVALID Notification handle is invalid. 0x715 1813 0x98110715 ADSERR_DEVICE_CLIENTUNKNOWN Notification client not registered. 0x716 1814 0x98110716 ADSERR_DEVICE_NOMOREHDLS No further handle available. 0x717 1815 0x98110717 ADSERR_DEVICE_INVALIDWATCHSIZE Notification size too large. 0x718 1816 0x98110718 ADSERR_DEVICE_NOTINIT Device not initialized. 0x719 1817 0x98110719 ADSERR_DEVICE_TIMEOUT Device has a timeout. 0x71A 1818 0x9811071A ADSERR_DEVICE_NOINTERFACE Interface query failed. 0x71B 1819 0x9811071B ADSERR_DEVICE_INVALIDINTERFACE Wrong interface requested. 0x71C 1820 0x9811071C ADSERR_DEVICE_INVALIDCLSID Class ID is invalid. 0x71D 1821 0x9811071D ADSERR_DEVICE_INVALIDOBJID Object ID is invalid. 0x71E 1822 0x9811071E ADSERR_DEVICE_PENDING Request pending. 0x71F 1823 0x9811071F ADSERR_DEVICE_ABORTED Request is aborted. 0x720 1824 0x98110720 ADSERR_DEVICE_WARNING Signal warning. 0x721 1825 0x98110721 ADSERR_DEVICE_INVALIDARRAYIDX Invalid array index. 0x722 1826 0x98110722 ADSERR_DEVICE_SYMBOLNOTACTIVE Symbol not active. 0x723 1827 0x98110723 ADSERR_DEVICE_ACCESSDENIED Access denied. Several causes are possible. For example, a unidirectional ADS route is used in the opposite direction. 0x724 1828 0x98110724 ADSERR_DEVICE_LICENSENOTFOUND Missing license. 0x725 1829 0x98110725 ADSERR_DEVICE_LICENSEEXPIRED License expired. 0x726 1830 0x98110726 ADSERR_DEVICE_LICENSEEXCEEDED License exceeded. 0x727 1831 0x98110727 ADSERR_DEVICE_LICENSEINVALID Invalid license. 0x728 1832 0x98110728 ADSERR_DEVICE_LICENSESYSTEMID License problem: System ID is invalid. 0x729 1833 0x98110729 ADSERR_DEVICE_LICENSENOTIMELIMIT License not limited in time. 0x72A 1834 0x9811072A ADSERR_DEVICE_LICENSEFUTUREISSUE Licensing problem: time in the future. 0x72B 1835 0x9811072B ADSERR_DEVICE_LICENSETIMETOLONG License period too long. 0x72C 1836 0x9811072C ADSERR_DEVICE_EXCEPTION Exception at system startup. 0x72D 1837 0x9811072D ADSERR_DEVICE_LICENSEDUPLICATED License file read twice. 0x72E 1838 0x9811072E ADSERR_DEVICE_SIGNATUREINVALID Invalid signature. 0x72F 1839 0x9811072F ADSERR_DEVICE_CERTIFICATEINVALID Invalid certificate. 0x730 1840 0x98110730 ADSERR_DEVICE_LICENSEOEMNOTFOUND Public key not known from OEM. 0x731 1841 0x98110731 ADSERR_DEVICE_LICENSERESTRICTED License not valid for this system ID. 98 Version: 1.2.0 TF6100
## Page 99

Appendix Hex Dec HRESULT Name Description 0x732 1842 0x98110732 ADSERR_DEVICE_LICENSEDEMODENIED Demo license prohibited. 0x733 1843 0x98110733 ADSERR_DEVICE_INVALIDFNCID Invalid function ID. 0x734 1844 0x98110734 ADSERR_DEVICE_OUTOFRANGE Outside the valid range. 0x735 1845 0x98110735 ADSERR_DEVICE_INVALIDALIGNMENT Invalid alignment. 0x736 1846 0x98110736 ADSERR_DEVICE_LICENSEPLATFORM Invalid platform level. 0x737 1847 0x98110737 ADSERR_DEVICE_FORWARD_PL Context – forward to passive level. 0x738 1848 0x98110738 ADSERR_DEVICE_FORWARD_DL Context – forward to dispatch level. 0x739 1849 0x98110739 ADSERR_DEVICE_FORWARD_RT Context – forward to real-time. 0x740 1856 0x98110740 ADSERR_CLIENT_ERROR Client error. 0x741 1857 0x98110741 ADSERR_CLIENT_INVALIDPARM Service contains an invalid parameter. 0x742 1858 0x98110742 ADSERR_CLIENT_LISTEMPTY Polling list is empty. 0x743 1859 0x98110743 ADSERR_CLIENT_VARUSED Var connection already in use. 0x744 1860 0x98110744 ADSERR_CLIENT_DUPLINVOKEID The called ID is already in use. 0x745 1861 0x98110745 ADSERR_CLIENT_SYNCTIMEOUT Timeout has occurred – the remote terminal is not responding in the specified ADS timeout. The route setting of the remote terminal may be configured incorrectly. 0x746 1862 0x98110746 ADSERR_CLIENT_W32ERROR Error in Win32 subsystem. 0x747 1863 0x98110747 ADSERR_CLIENT_TIMEOUTINVALID Invalid client timeout value. 0x748 1864 0x98110748 ADSERR_CLIENT_PORTNOTOPEN Port not open. 0x749 1865 0x98110749 ADSERR_CLIENT_NOAMSADDR No AMS address. 0x750 1872 0x98110750 ADSERR_CLIENT_SYNCINTERNAL Internal error in Ads sync. 0x751 1873 0x98110751 ADSERR_CLIENT_ADDHASH Hash table overflow. 0x752 1874 0x98110752 ADSERR_CLIENT_REMOVEHASH Key not found in the table. 0x753 1875 0x98110753 ADSERR_CLIENT_NOMORESYM No symbols in the cache. 0x754 1876 0x98110754 ADSERR_CLIENT_SYNCRESINVALID Invalid response received. 0x755 1877 0x98110755 ADSERR_CLIENT_SYNCPORTLOCKED Sync Port is locked. 0x756 1878 0x98110756 ADSERR_CLIENT_REQUESTCANCELLED The request was canceled. RTime error codes Hex Dec HRESULT Name Description 0x1000 4096 0x98111000 RTERR_INTERNAL Internal error in the real-time system. 0x1001 4097 0x98111001 RTERR_BADTIMERPERIODS Timer value is not valid. 0x1002 4098 0x98111002 RTERR_INVALIDTASKPTR Task pointer has the invalid value 0 (zero). 0x1003 4099 0x98111003 RTERR_INVALIDSTACKPTR Stack pointer has the invalid value 0 (zero). 0x1004 4100 0x98111004 RTERR_PRIOEXISTS The request task priority is already assigned. 0x1005 4101 0x98111005 RTERR_NOMORETCB No free TCB (Task Control Block) available. The maximum number of TCBs is 64. 0x1006 4102 0x98111006 RTERR_NOMORESEMAS No free semaphores available. The maximum number of semaphores is 64. 0x1007 4103 0x98111007 RTERR_NOMOREQUEUES No free space available in the queue. The maximum number of positions in the queue is 64. 0x100D 4109 0x9811100D RTERR_EXTIRQALREADYDEF An external synchronization interrupt is already applied. 0x100E 4110 0x9811100E RTERR_EXTIRQNOTDEF No external sync interrupt applied. 0x100F 4111 0x9811100F RTERR_EXTIRQINSTALLFAILED Application of the external synchronization interrupt has failed. 0x1010 4112 0x98111010 RTERR_IRQLNOTLESSOREQUAL Call of a service function in the wrong context 0x1017 4119 0x98111017 RTERR_VMXNOTSUPPORTED Intel VT-x extension is not supported. 0x1018 4120 0x98111018 RTERR_VMXDISABLED Intel VT-x extension is not enabled in the BIOS. 0x1019 4121 0x98111019 RTERR_VMXCONTROLSMISSING Missing function in Intel VT-x extension. 0x101A 4122 0x9811101A RTERR_VMXENABLEFAILS Activation of Intel VT-x fails. Specific positive HRESULT Return Codes: TF6100 Version: 1.2.0 99
## Page 100

Appendix HRESULT Name Description 0x0000_0000 S_OK No error. 0x0000_0001 S_FALSE No error. Example: successful processing, but with a negative or incomplete result. 0x0000_0203 S_PENDING No error. Example: successful processing, but no result is available yet. 0x0000_0256 S_WATCHDOG_TIMEOUT No error. Example: successful processing, but a timeout occurred. TCP Winsock error codes Hex Dec Name Description 0x274C 10060 WSAETIMEDOUT A connection timeout has occurred - error while establishing the connection, because the remote terminal did not respond properly after a certain period of time, or the established connection could not be maintained because the connected host did not respond. 0x274D 10061 WSAECONNREFUSED Connection refused - no connection could be established because the target computer has explicitly rejected it. This error usually results from an attempt to connect to a service that is inactive on the external host, that is, a service for which no server application is running. 0x2751 10065 WSAEHOSTUNREACH No route to host - a socket operation referred to an unavailable host. More Winsock error codes: Win32 error codes 8.2.2 Client I/O The OPC UA Client modules that belong to a virtual OPC UA device offer different status variables as well as control variables. These variables are explained below. Reading the status codes Please note that the status code of the state machine is listed here in hexadecimal notation. If the code is displayed as a decimal number in Twin CAT, it must be converted for interpretation. Fig. 1: OPCUAClient Modules Status Codes 100 Version: 1.2.0 TF6100
## Page 101

Appendix Variable Schema 0 1- State machine state 2- Keep alive 3- Connection state count if using (&read busy) subscriptions 0x0123 - 0 = Initialize (init) 0 = false(&off) Status 1 = Connect 1 = true(&off) 2 = Resolve namespace 2 = false(&on) 3 = Get node handles 3 = true(&on) 4 = Continuous read/write 5 = Triggered read/write 6 = Awaiting data change notifications (subscriptions )) 7 = Disconnect 8 = Reset 0x0123 - - - 0 = Standard (default) Control 1 = Reset state machine 2 = Execute (in triggered read mode) Variable Data type Description BIT 1 TRUE | 0= FALSE. Connected BIT 1 TRUE | 0= FALSE. This function Read Busy is only active when reading and writing via trigger variables. BIT4 Shows the number of Keep Alive Keep Alives messages counted. Only active when reading and writing using subscriptions. BYTE Can be read in the table above. Stm State BIT The client is reset when this bit is Reset Stm set to 1. BIT 1 TRUE | 0= FALSE. Reading/ Execute writing takes place if this bit is set to 1 during reading and writing via trigger variables. If this bit remains set, there is no difference to cyclic reading/ writing. 8.2.3 Client PLCopen The function blocks of the Twin CAT OPC UA Client have their own error codes, which indicate the occurrence of an error and use an Error ID to display further information about the problem that has occurred. Twin CAT ADS error messages (ADS Return Codes [} 96]) with the High Word 0x0000 and custom error messages from the client or the PLC library with the High Word 0x E4DD can occur. Possible Twin CAT ADS errors include the following: Hex Name Description 0x 0000 0705 DEVICE_INVALIDSIZE Parameter size not correct 0x 0000 0706 DEVICE_INVALIDDATA Invalid parameter values 0x 0000 070A DEVICE_NOMEMORY Not enough memory TF6100 Version: 1.2.0 101
## Page 102

Appendix This error code list shows the possible custom error values: 102 Version: 1.2.0 TF6100
## Page 103

Appendix Hex Name Description 0x E4DD 0001 UAC_E_FAIL UA service call failed 0x E4DD 0100 UAC_E_CONNECTED Server already connected 0x E4DD 0101 UAC_E_CONNECT General error when establishing a connection 0x E4DD 0102 UAC_E_UASECURITY UA security could not be set up 0x E4DD 0103 UAC_E_ITEMEXISTS Element ID already exists 0x E4DD 0104 UAC_E_ITEMNOTFOUND Element does not exist 0x E4DD 0105 UAC_E_ITEMTYPE Invalid or unsupported item type 0x E4DD 0106 UAC_E_CONVERSION Variable types cannot be converted 0x E4DD 0107 UAC_E_SUSPENDED Device hangs. Please try again later... 0x E4DD 0108 UAC_E_TYPE_NOT_SUPPORTED Conversion variable type is not supported. 0x E4DD 0109 UAC_E_NSNAME_NOTFOUND No namespace with the specified name found. 0x E4DD 0110 UAC_E_CONNECT_NOTFOUND Connection failed: Target host could not be found. 0x E4DD 0111 UAC_E_TIMEOUT Timeout: i.e. target host does not respond 0x E4DD 0112 UAC_E_INVALIDHDL Session handle invalid 0x E4DD 0113 UAC_E_INVALIDNODEID UA node ID unknown 0x E4DD 0114 UAC_E_INVAL_IDENTIFIER_TYPE Identifier type of Ua Node Id invalid 0x E4DD 0115 UAC_E_IDENTIFIER_NOTSUPP Identifier type Ua Node Id is not supported 0x E4DD 0116 UAC_E_INVAL_NODE_HDL Invalid node handle 0x E4DD 0117 UAC_E_UAREADFAILED UA read failed for unknown reasons 0x E4DD 0118 UAC_E_UAWRITEFAILED UA write failed for unknown reasons 0x E4DD 0119 UAC_E_INVAL_NODEMETHOD_HDL Invalid method handle 0x E4DD 011A UAC_E_CALL_FAILED Call failed, cause unknown 0x E4DD 011B UAC_E_CALLDECODE_FAILED Successful call, decoding return value failed 0x E4DD 011C UAC_E_NOTMAPPEDTYPE Unassigned data type in return value 0x E4DD 011D UAC_E_CALL_FAILED_BADINTERNAL Call failed with UA_Bad Internal 0x E4DD 011E UAC_E_METHODIDINVALID Unknown Method ID (returned on call, even if provided by Get Method Hdl) 0x E4DD 011F UAC_E_TOOMUCHDIM Method call has returned parameters with more than 3 dimensions; not supported. 0x E4DD 0120 UAC_E_CALL_FAILED_INVALIDARG Call failed with Opc Ua_Bad Invalid Argument 0x E4DD 0121 UAC_E_CALL_FAILED_TYPEMISMATC Call failed with H UAC_E_CALL_FAILED_TYPEMISMATCH 0x E4DD 0122 UAC_E_CALL_FAILED_OUTOFRANGE Call failed with UAC_E_CALL_FAILED_OUTOFRANGE 0x E4DD 0123 UAC_E_CALL_FAILED_BADSTRUCTU Call failed with RE Opc Ua_Bad Structure Missing 0x E4DD 0124 UAC_E_CALL_TYPEMISMATCH_OUTP Call successful, but type of output information ARAM provided does not match 0x E4DD 0125 UAC_E_NONVALIDTYPEINFO Node has insufficient type information 0x E4DD 0126 UAC_E_INVALIDATTRIBID Access to invalid node attribute 0x E4DD 0128 UAC_E_NOTSUPPORTED The command is not supported by the connected Ua Server, e.g. when calling UA_History Update. 0x E4DE 0100 UAC_E_INVALID_ARRAY_LENGTH An invalid array length not matching Data Value Count was assigned to UA_History Update. 0x E4DE 0101 UAC_E_INVALID_DATASIZE A data value with an invalid data type size was assigned to UA_History Update. All assigned Data Values must be of the same data type. TF6100 Version: 1.2.0 103
## Page 104

Appendix Hex Name Description 0x E4DE 0102 UAC_E_SUBERROR A lower-level error was output for at least one of the transferred data values. See Value Error IDs at UA_History Update. 8.3 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany 104 Version: 1.2.0 TF6100
## Page 105

Appendix Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF6100 Version: 1.2.0 105
## Page 106

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Third-party trademark statements Arm, Arm9 and Cortex are trademarks or registered trademarks of Arm Limited (or its subsidiaries or affiliates) in the US and/or elsewhere. Intel, the Intel logo, Intel Core, Xeon, Intel Atom, Celeron and Pentium are trademarks of Intel Corporation or its subsidiaries. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 107

More Information: www.beckhoff.com/tf6100 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
