---
title: "Twin CAT 3 Basics 2025-10-22"
product: "TwinCAT"
category: "Fundamentals"
tags: ["BASICS", "CAT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.3.1"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_Grundlagen_EN.pdf"
release_date: "2025-10-22"
---
Manual | EN Twin CAT 3 Basics 2025-10-22 | Version: 1.3.1
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Real-Time................................................................................................................................................... 8 2.1 Tasks............................................................................................................................................... 12 2.1.1 Twin CAT Task.................................................................................................................. 12 2.1.2 Twin CAT Task with Image............................................................................................... 13 2.1.3 Twin CAT Job Task (Worker Task)................................................................................... 13 2.1.4 I/O Idle Task..................................................................................................................... 14 2.1.5 PLC-Aux Task................................................................................................................... 14 2.2 Core Boost...................................................................................................................................... 15 2.3 Core Memory.................................................................................................................................. 16 3 Target systems........................................................................................................................................ 18 3.1 Boot directory.................................................................................................................................. 18 3.2 Routing............................................................................................................................................ 18 3.2.1 ADS.................................................................................................................................. 19 3.2.2 Ams NAT......................................................................................................................... 175 3.2.3 ADS-over-MQTT............................................................................................................ 179 3.2.4 Secure ADS................................................................................................................... 191 3.3 Folder and file types...................................................................................................................... 203 3.3.1 Twin CAT PLC project files............................................................................................. 203 3.3.2 Twin CAT C++ project files............................................................................................. 209 3.3.3 Twin CAT project files..................................................................................................... 212 3.3.4 PLC HMI files................................................................................................................. 212 3.3.5 PLC HMI files (Target Visualization).............................................................................. 213 3.3.6 PLC HMI Web files......................................................................................................... 213 3.4 Machine update at file level........................................................................................................... 214 3.4.1 Overview........................................................................................................................ 214 3.4.2 Performing a PLC update............................................................................................... 215 3.4.3 Performing a C++ Update.............................................................................................. 215 3.4.4 Performing an update of the complete machine............................................................ 216 3.4.5 Cloning a machine......................................................................................................... 216 3.5 Starting the program automatically............................................................................................... 216 3.6 Corrected time stamps.................................................................................................................. 217 3.6.1 Overview........................................................................................................................ 217 3.6.2 System requirements..................................................................................................... 218 3.6.3 Limitations...................................................................................................................... 218 3.6.4 Technical introduction.................................................................................................... 219 3.6.5 Real-time API................................................................................................................. 227 3.6.6 ADS API......................................................................................................................... 231 3.6.7 Samples......................................................................................................................... 232 3.6.8 FAQ................................................................................................................................ 235 3.7 Tc RTe Install.................................................................................................................................. 236 Twin CAT 3 Version: 1.3.1 3
## Page 4

Table of contents 4 Type system.......................................................................................................................................... 241 4.1 Project-based type system............................................................................................................ 241 4.2 Data types..................................................................................................................................... 241 4.3 Handling of data types.................................................................................................................. 242 4.4 Management and identification of data types................................................................................ 244 4.5 Alignment of data types................................................................................................................. 245 4.6 Files in connection with the type system....................................................................................... 246 5 Tc Com modules.................................................................................................................................... 248 5.1 The Twin CAT Component Object Model (Tc COM) concept......................................................... 248 5.1.1 Twin CAT module properties........................................................................................... 250 5.1.2 Twin CAT module state machine.................................................................................... 257 5.2 Handling Tc Com modules............................................................................................................. 259 5.2.1 Object tab....................................................................................................................... 259 5.2.2 Context tab..................................................................................................................... 260 5.2.3 Parameter (Init) tab........................................................................................................ 261 5.2.4 Parameter (Online) tab................................................................................................... 261 5.2.5 Data Area tab................................................................................................................. 262 5.2.6 Interfaces tab................................................................................................................. 263 6 Support and Service............................................................................................................................. 264 4 Version: 1.3.1 Twin CAT 3
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Twin CAT 3 Version: 1.3.1 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.3.1 Twin CAT 3
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. Twin CAT 3 Version: 1.3.1 7
## Page 8

Real-Time 2 Real-Time According to the DIN 44300 standard, real-time, or rather real-time operation, is defined as follows: "Real-time operation is an operating mode of a computing system in which programs for processing data are continuously operational in such a way that the processing results are available within a specified period of time." In other words, the output values of an application program (calculated based on the inner state and input values) are made available within a defined and guaranteed time. This defined time is also referred to as cycle time. The application program itself can consist of several program blocks, which in turn call other programs or function blocks etc. (see also IEC 61131-3 standard). The program blocks can be assigned to real-time tasks, which are called by the scheduler with a cycle time to be defined and a defined priority. Twin CAT 3 Real-Time is a real-time extension that can be used in the current Twin CAT 3.1 version under Microsoft Windows operating systems from Windows 7 as well as under Twin CAT/BSD and Beckhoff RT Linux®. In order to meet the requirements described above for the control of industrial processes, Twin CAT 3 real-time supports the following features: • Real-time capable scheduling • Parallel execution of processes • Multi-core support • Direct hardware access Twin CAT 3 multi-core support allows the available cores to be used either exclusively for Twin CAT or shared with the corresponding operating system. In the following sections, the cores are therefore referred to as "isolated" or "shared". Real-time capable scheduling Twin CAT 3 Real-Time works with the double-tick method. This means that both switching to real-time mode and switching back is triggered by an interrupt. The interrupt when switching to the real-time mode also starts the scheduling at the same time. After an adjustable period of time, at the latest after 90% of the set cycle time, Twin CAT switches back to "shared" cores in non-real-time mode, so that the guest operating system has sufficient computing time available to comply with the response times required for hardware functions etc. The isolated cores are an exception. Scheduling refers to the (system) process that determines the processing order and the processing time of the individual tasks, based on the defined cycle time and the defined priority. Strict adherence to the processing time ensures that the real-time compliance described above is guaranteed. Triggered by a synchronous basic tick on all real-time kernels, the scheduling for each real-time kernel is calculated independently in Twin CAT 3 Real-Time. This guarantees that real-time tasks running on different cores do not interfere with each other. Unless this has been explicitly programmed in the user program by using interlocks. Scheduling in which the priority of a task is derived from its cycle time is also known as rate-monotonic scheduling. The Twin CAT 3 Real-Time automatically activates the "Automatic Priority Management" option. Since this is not always the best solution for every application, the priorities can be adjusted manually. 8 Version: 1.3.1 Twin CAT 3
## Page 9

Real-Time Exemplary representation of the call of a PLC task The figure shows the call of a PLC task. After the real-time tick has occurred, the PLC task is called by the scheduler. This makes the current input values available to the PLC application (input update), followed by processing of the application program (cycle update). Finally the results are written to the outputs (output update). Once this has been completed, the device switches to non-real-time mode (double-tick). As shown in the figure, the execution time of the user program may vary depending on which code is executed based on the internal state of the program. Thus the time when the outputs are written also varies. Depending on which task a bus system is driven, this can cause the sending of the bus telegrams to vary to the same extent. Sample call of a task with "I/O at task start“ By using the "I/O at task start" option, the processing order within a task can be changed so that after reading the inputs, the outputs (of the previous cycle) are written directly before the application program is executed. Although the outputs are not written until the next cycle, this setting has the advantage that the time at which the outputs are written to the process/bus is exactly the same in each cycle. Preemptive multitasking Preemptive multitasking means that the current state of a process (the CPU and floating-point registers) is saved in the event of an interrupt (e.g. by higher-priority processes), and the current process is paused. If this happens, the scheduler determines the (new) process to be executed, based on the task priorities. Once the process to be interrupted is complete, the process context is restored and the "old" process continues. Twin CAT 3 Version: 1.3.1 9
## Page 10

Real-Time Direct hardware access In order to achieve deterministic (reproducible) real-time behavior, Twin CAT 3 Real-Time requires direct hardware access. For this to be possible, Twin CAT 3 Real-Time must be executed in Windows or Twin CAT/ BSD kernel mode. This makes it possible, among other things, for Twin CAT Real-Time to access the network ports directly and send and receive real-time Ethernet telegrams (e.g. Ether CAT). Under Beckhoff RT Linux®, the real-time works with the real-time extension in user mode. Direct hardware access is made possible via special network drivers. Schematic representation of the Twin CAT 3 runtime environment The following figure illustrates the structure of the Twin CAT 3.1 runtime environment in relation to scheduling. The Twin CAT 3 runtime environment enables user modules to be executed in real-time. An essential part of the Twin CAT 3 runtime environment therefore is the real-time driver, which is executed on the cores that are activated for Twin CAT and handles the scheduling there. The latter takes place independently on the individual cores. Isolated cores As described under real-time scheduling [} 8], Twin CAT uses a double-tick procedure to switch back to non- real-time mode at a specified point in time. When switching between real-time mode and non-real-time mode, the preceding process state is restored, as described under Preemptive multitasking [} 9]. The restoration takes some time, depending on how intensively the real-time and non-real-time programs use the memory and in particular the cache. In order to eliminate these temporal effects, Twin CAT 3.1 Real-Time allows cores to be isolated from the guest operating system. This eliminates the need to switch back, resulting in more computing time for the real-time user program and better real-time quality (less jitter) by avoiding the time effects associated with restoring the "old" process state. 10 Version: 1.3.1 Twin CAT 3
## Page 11

Real-Time Behavior when the cycle time is exceeded If the defined cycle time of a task is exceeded, processing of the "old" cycle continues in the next cycle. In addition, the task exceed counter is incremented. Once processing of the old / previous cycle is complete, the system immediately tries to start processing the tasks of the current cycle. If this is completed within the current cycle, further processing is carried out as shown above. If the second cycle that follows directly is also exceeded (in this case it is irrelevant whether the system is still processing the first cycle or whether the second cycle has commenced), the current processing task is completed, and processing of the next task does not commence until the next possible scheduled cycle start. This means that several cycles may be lost. The exceed counter is incremented accordingly. Differences in execution between PLC and "Tc Com" runtime modules Processing of a Twin CAT task, in relation to the execution of runtime modules, is based on the following sequence: Twin CAT 3 Version: 1.3.1 11
## Page 12

Real-Time 1. Copying of the inputs to the process images of the runtime modules called by the task. 2. Executing the modules according to the sort order (in ascending order). 3. Output update, which makes the outputs available accordingly. If this task drives an Ether CAT fieldbus, the frame is provided and sent during the output process image. 4. Post-cycle update: This is used, among other things, to trigger a cycle update when the "I/O at task start" option is active. If runtime modules are added to a task, they "log on" to the respective calls of the task. The only exceptions are PLC runtime modules. For reasons of compatibility with Twin CAT 2, the PLC runtime modules directly update the inputs and outputs. The difference between the two behaviors is shown in the following figure: Four runtime modules can be seen in each case. Standard Twin CAT 3 runtime modules log on to the corresponding method calls of the task. This means that all input updates (yellow) and output updates (red) are triggered by the task and take place one after the other directly at the start or end of task processing. If two of these modules communicate with each other via a mapping, they do not receive the current values until the next cycle. The PLC runtime modules independently perform an input and output update. If two PLC runtimes communicate with each other, the runtime module that is executed second directly receives the current values from the first runtime module. Thus, there is no cycle offset in the communication direction from first runtime module to second runtime module, but there such an offset does exist in the other direction. 2.1 Tasks A task is a runtime object that can be scheduled and triggered by a scheduler. Functions or runtime objects that are to be executed in the context of this object log on to this object. The tasks are assigned a cycle time and a priority, which the scheduler uses to schedule the execution of the tasks (see Real-time scheduling [} 8]). Furthermore, each task is assigned a shared memory/address space, which all tasks can access together, and an additional stack memory. This stack memory is required to allow the nested execution of functions and sub-functions. The stack also serves as a memory for local variables. The state of a task is defined by this stack and the current content of the machine registers (calculation registers). If there is a context change or a task is interrupted by a higher priority, this state is saved and restored when the task is executed again. The size of the task stack can be defined in Twin CAT (see chapter Settings tab of the real- time settings). For sequence control of several tasks, a (real-time) system offers functions for communication and synchronization (see chapter Multi-task data access synchronization in the PLC). The corresponding task types are described in the following chapters. 2.1.1 Twin CAT Task Twin CAT standard tasks to which Twin CAT runtime modules can log on. To use the tasks in a PLC, this is done by assigning a task to a task reference (see Creating a referenced task). For Tc Com modules in general, the Tc Com module is assigned to tasks via the Context tab of the Tc Com module. (See Context tab [} 260] in the chapter Tc COM module handling). 12 Version: 1.3.1 Twin CAT 3
## Page 13

Real-Time The settings of a task are described in the subchapter Twin CAT Task in "The Twin CAT project" documentation. 2.1.2 Twin CAT Task with Image In contrast to a standard task (see chapter Twin CAT Task [} 12]), the Twin CAT Task with Image also has its own process image. Variables can be created in this process image that are linked to other process images (e.g. from Ether CAT devices). Depending on the set cycle time and priority, the task triggers the mapping accordingly. It is therefore possible, for example, to operate cyclic bus communication without the need for a PLC or another runtime module. The variables of the process image can be accessed via ADS from the Twin CAT Scope or a non-real-time application, for example. 2.1.3 Twin CAT Job Task (Worker Task) A Job Task is a task that is executed on demand. It is called from an application and is NOT executed cyclically. A Job Task can be created directly under Tasks or in a Job Pool. If you create the Job Task directly under Tasks, tasks (jobs) can be passed to it directly from a client application. However, if you create the Job Task under a Job Pool, the tasks are transferred to the Job Pool from the application. This then assigns the task to the next Job Task in its pool that is next available. Twin CAT 3 Version: 1.3.1 13
## Page 14

Real-Time Name Name of the Job Task Object Id Object ID of the Job Task Priority Priority of the Job Task Floating point exception Specifies whether or not Twin CAT checks for floating point exceptions. Comment Optional comment on the Job Task Select the setting Floating point exception for the calling task and for the Job Task. 2.1.4 I/O Idle Task The I/O Idle Task handles acyclic communication for fieldbuses, so it is responsible for: • the State Machine of the Ether CAT Devices • Co E and So E communication • Reading or setting parameters via AOE • Mailbox communication • Acyclic diagnostics from Ether CAT (e.g. status queries) The I/O Idle Task is a cyclic task, but is not used for cyclic I/O communication (process data exchange). It therefore makes sense in most cases to select the priority so that it is executed after the PLC and motion tasks. As this is also acyclic communication, cycle timeouts of these tasks are generally not significant. Since Twin CAT version 3.1.4026, it has been possible to use multiple I/O Idle Tasks (one per Ether CAT master). The choice of I/O Idle Task is made via the adapter settings of the Ether CAT master. 2.1.5 PLC-Aux Task The PLC-Aux Task is used for communication between the PLC editors and the PLC runtime modules. This includes the download and Online Change of PLC control code as well as debugging (monitoring of values, setting of breakpoints, etc.). In addition, the PLC-Aux Task also processes the ADS messages that are sent to the runtime system independently of the development environment (Tc Xae Shell) (e.g. from an HMI). 14 Version: 1.3.1 Twin CAT 3
## Page 15

Real-Time The PLC-Aux Task is not a cyclic task and you should set its priority lower than this. This ensures that the cyclic tasks can interrupt the PLC-Aux Task. In the event of an online change, the new code is transferred to the target system via the PLC-Aux Task and the symbols are generated accordingly, etc. Only the “critical phase” of an online change, in which the code to be executed is exchanged, is protected in such a way that this process cannot be interrupted by the cyclical tasks. If several PLC runtime modules use the same PLC tasks, they can influence each other through an online change. 2.2 Core Boost Twin CAT Core Boost Prerequisite: Both the engineering environment and the runtime environment must use at least Twin CAT version 3.1.4026.6. If the Twin CAT feature Core Boost is supported for a given target system and is active, this is displayed in the Twin CAT Core Boost selection box after pressing the Read from Target button. To activate or deactivate the function, these settings must be activated on the target system using the Set on Target button. You must restart the computer after changing this setting. If the Twin CAT Core Boost function is not supported by a given target system, the following message appears after pressing the button Set on Target: If the Twin CAT Core Boost setting is activated, a clock frequency can be defined for each real-time core. If no clock frequency is defined for a real-time core, the Base Frequency is automatically selected. Twin CAT 3 Version: 1.3.1 15
## Page 16

Real-Time Correct selection of the core frequency Twin CAT automatically monitors the clock frequencies of the individual cores based on the limits stored in the system for the temperature of the individual cores or the power consumption of the individual packages. If these limits are exceeded, Twin CAT reduces the clock frequencies of the individual cores accordingly (see also chapter Core Boost tab). If Twin CAT is forced to reduce the clock frequencies of individual real-time cores, this may have an influence on the real-time behavior set in Twin CAT. The tasks executed on this real-time core then have longer execution times, which may lead to cycle timeouts. You therefore share the responsibility for selecting the clock frequencies of the real-time cores in such a way that Twin CAT is not permanently operated in throttle mode. If the temperature limit is permanently exceeded, the system may shut down. Selecting the clock frequency for non-real-time cores Non-real-time cores are computer cores on which Twin CAT is not activated and which are not used in real-time, so that only processes triggered by the operating system are executed there. For the non-real-time cores, the clock frequency is automatically selected by the operating system as required. The maximum clock frequency up to which non-real-time cores can clock up is the base frequency. Starting with the 12th and 13th generations of Intel® processors, non-real-time cores can overclock up to the core boost frequency if necessary. The level of the core boost frequency is stored in the system and differs depending on the processor type. Configurable clock frequencies: Processor Processor generation Base clock Configurable Core Boost clock Core Intel® Core™ of the 11th generation 2.40 GHz 4.00 GHz i3-11100HE Core Intel® Core™ of the 11th generation 2.60 GHz 4.10 GHz i5-11500HE Core Intel® Core™ of the 11th generation 2.60 GHz 4.20 GHz i7-11850HE Core Intel® Core™ of the 13th generation 3.30 GHz 4.20 GHz i3-13100E Core Intel® Core™ of the 13th generation 2.40 GHz 4.10 GHz i5-13400E Core Intel® Core™ of the 13th generation 1.90 GHz 4.00 GHz i7-13700E Core Intel® Core™ of the 13th generation 1.80 GHz 3.90 GHz i9-13900E 2.3 Core Memory Twin CAT (3.1.4026 and 3.1.4024) enables real-time tasks to dynamically allocate memory within the real- time context. Since real-time tasks cannot allocate memory blocks directly from the operating system, Twin CAT offers various memory pools. These pools are memory blocks allocated in advance by the operating system. These memory blocks are pinned to the physical memory to avoid paging when accessing within the real-time context. As already described in the chapter Settings tab, there are several memory pools for Twin CAT. These are: 16 Version: 1.3.1 Twin CAT 3
## Page 17

Real-Time Executable RT Memory Executable real-time memory, this is required by the Twin CAT system and is not directly available to the user Global RT Memory Global real-time memory for memory allocations of Twin CAT modules (PLC and C++) in real-time context Core Memory <n> Real-time memory for memory allocations of the <n>th real-time core Global ADS Memory Data memory for ADS communication. Allocations for ADS messages between the Twin CAT components are allocated from this memory. Tc/OS Memory Memory pool of the Usermode runtime: allocation takes place when a Usermode runtime is started. When using a Usermode runtime, the other memory pools are served from this memory pool. The size of the Global RT Memory can be set for each project via the Router Memory option in the Twin CAT 3 engineering environment. Since Twin CAT version 3.1.4026, the data memory for ADS messages has been separated from the "router memory" and is available as an independent global ADS memory. The size of the global ADS memory is determined from the size of the global RT memory and corresponds to 25% of its size, up to a maximum of 32 MB. Twin CAT version 3.1.4026 also introduced another memory pool, the Core Memory. The Core Memory provides a dedicated pool for real-time for each individual real-time core. If the Core Memory is configured for a real-time core, an attempt is first made to provide the requested memory from this memory pool. If this is not sufficient, the memory from the global real-time memory is used. The Core Memory thus allows parallel memory allocations from different cores to be processed in parallel and independently of each other. To access the global real-time memory, parallel memory allocations from different cores must be processed sequentially. This can lead to waiting times for many memory allocations within a real-time cycle and is therefore a performance bottleneck, e.g. in Vision applications. See also: • Core Management Twin CAT 3 Version: 1.3.1 17
## Page 18

Target systems 3 Target systems The controller that is currently being programmed with a Twin CAT development environment (Twin CAT XAE) is referred to as the target system. In this chapter, important basics for handling target systems will be explained. These are also needed to understand the documentation based on them in the chapter TE1000 XAE. First, a connection between the development environment and the controller must be created in order to be able to program a controller. Various channels can be used for this purpose. The individual options are explained in more detail in the chapter Routing [} 18]. If a controller is already programmed and in the field and you want to update the machine without using the programming environment, it is necessary to know which files and folders exist, what they are needed for and how you can best exchange them. The chapters Folder and file types [} 203] and Machine update at file level [} 214] are devoted to these topics. Additional programs may also need to be started automatically when Twin CAT is restarted (e.g. an external HMi). This is explained in the chapter Starting the program automatically [} 216]. If several controllers in a network are working on the same process, it is necessary to correct the timestamps of the individual controllers when collecting and evaluating data so that the collected data adheres to the exact time sequence. To achieve this, you can correct the timestamps of the individual controllers accordingly. This is described in the chapter Corrected time stamps [} 217]. 3.1 Boot directory The standard storage paths of the boot directory are documented below depending on the operating system of the target system. Windows 10, Windows 11: Kernel Mode Runtime: • < TC3.1.4026.0: C:\Twin CAT\3.1\Boot • >=TC3.1.4026.0: C:\Program Data\Beckhoff\Twin CAT\3.1\Boot User mode runtime: C:\Program Data\Beckhoff\Twin CAT\3.1\Runtimes\Um RT_Default\3.1\Boot Twin CAT/BSD: /usr/local/etc/Twin CAT/3.1/Boot Beckhoff RT Linux®: /etc/Twin CAT/3.1/Boot 3.2 Routing As already described in the Philosophy chapter, Twin CAT 3 consists of an engineering environment (XAE) and a runtime environment (XAR). The engineering environment is used to configure and program the runtime environments in the field. The runtime environments (target systems) then execute the control programs in hard real time. The connection between the two environments that do not necessarily run on the same PC/IPC is established via the ADS protocol (see ADS [} 19] chapter). A route must be entered so that an engineering environment can communicate with a target system. This means that the other participant is entered as known on both sides (engineering environment and runtime environment). In order to take current technical trends and requirements in terms of security and connectivity into account, you can secure the ADS connection accordingly or tunnel via current transport protocols. See Secure ADS [} 191] or ADS-over-MQTT [} 179] chapters. 18 Version: 1.3.1 Twin CAT 3
## Page 19

Target systems 3.2.1 ADS 3.2.1.1 ADS introduction ADS Definition The Automation Device Specification describes a device-independent and fieldbus-independent interface governing the type of access to ADS devices. The ADS interface permits: • communication with other ADS devices • implementation of an ADS device Communicating ADS Devices In order to allow participation in ADS communication (as an ADS client or, possibly, as an ADS server) the following software objects are made available: • ADS-DLL for use under e.g. C/C++ • ADS. NET [} 5] component for use under e.g. VB. NET, Visual C# 3.2.1.2 ADS device concept The Twin CAT system architecture allows the individual modules of the software (e.g. Twin CAT PLC, User HMI, ...) to be treated as independent devices: For every task there is a software module ("Server" or "Client"). The servers in the system are the executing working "devices" in the form of software, whose operating behaviour is exactly like that of a hardware device. For this reason we can speak of "virtual" devices implemented in the software. The "clients" are programs which request the services of the "servers", e.g. a visualisation, or even a "programming device" in the form of a program. It is thus possible for Twin CAT to grow, since there can always be new servers and clients for tasks such as camshaft controllers, oscilloscopes, PID controllers etc.. The messages between these objects are exchanged through a consistent ADS (Automation Device Specification) interface by the "message router". This manages and distributes all the messages in the system and over the TCP/IP connections. Twin CAT message routers exist on every Twin CAT device. This allows all Twin CAT server and client programs to exchange commands and data, to send messages, transfer status information, etc.. The following picture shows the Twin CAT device concept, based on ADS: Twin CAT 3 Version: 1.3.1 19
## Page 20

Target systems 3.2.1.3 ADS device identification The unique identification of ADS devices is implemented with the aid of two identifiers: • Port Nr • Net Id AMS ports ADS devices in a Twin CAT message router are uniquely identified by a number, called the ADS port no. This is specified and fixed for ADS devices, whereas pure ADS client applications (e.g. a HMI system) are allocated a variable port number when they first access the message router. The following AMS port numbers are already assigned: 20 Version: 1.3.1 Twin CAT 3
## Page 21

Target systems AMS port Device 1 ADS router 2 AMS debugger 10 TCom server 11 TCom server task, RT context 12 TCom server, passive level 20 Twin CAT debugger 21 Twin CAT debugger task 30 License server 100 Logger 110 Event logger 120 Application for Ether CAT devices 130 Event logger user mode (V2) 131 Event logger real-time (V2) 132 Event logger publisher (V2) 200 Ring 0 real-time 290 Ring 0 trace 300 Ring 0 IO 400 Ring 0 PLC (legacy) 500 Ring 0 NC 501 Ring 0 NC SEC 511 Ring 0 NC SPP 520 NC instance 550 Ring ISG 600 Ring 0 CNC 700 Ring 0 line 800 Ring 0 TC2 PLC 801 TC2 PLC runtime system 1 811 TC2 PLC runtime system 2 821 TC2 PLC runtime system 3 831 TC2 PLC runtime system 4 850 Ring 0 TC3 PLC 851 TC3 PLC runtime system 1 852 TC3 PLC runtime system 2 853 TC3 PLC runtime system 3 854 - … TC3 PLC runtime system 4 - … 900 Cam controller 950 CAM tool 1000–1199 Ring 0 IO ports 2000 Ring 0 user 2500 Crestron server 10000 System service 10201 TCP/IP server 10300 System Manager 10400 SMS server 10500 Modbus server 10502 AMS logger 10600 XML data server 10700 Automatic configuration Twin CAT 3 Version: 1.3.1 21
## Page 22

Target systems AMS port Device 10800 PLC control 10900 FTP client 11000 NC control system 11500 NC interpreter 11600 GST interpreter 12000 Track control 13000 CAM control 14000 Scope server 14100 Condition monitoring 15000 Sine CH1 16000 CONTROL NET 17000 OPC server 17500 OPC client 18000 Mail server 19000 Virtual COM EL60xx 19100 Management server 19200 Miele@home server 19300 CP-Link 3 19310 Touch lock 19500 Vision service 19800 HMI server 21372 Database server 25000–25999 Reserved port range for ADS servers 25013 FIAS server 25014 Bang&Olufsen server 26000–26999 Private port range for customers 32768–65535 Reserved port range for ADS clients AMS Net Id Each Twin CAT device in the network is identified by the AMS Net Id. The AMS Net Id consists of six octets. The first four octets can be freely selected. The last two octets (usually .1.1) serve as subnet mask for fieldbuses or further devices. The AMS Net Id must be unique for all communication partners. Configuration: The AMS Net Id of a local or remote Twin CAT device can be set in SYSTEM\Routes\Net Id Management of a TC3 project. Alternatively, the AMS Net Id can be configured locally via the Router category in the Twin CAT Sys Tray menu. The device must be restarted after changing the AMS Net Id. 22 Version: 1.3.1 Twin CAT 3
## Page 23

Target systems 3.2.1.4 AMS/TCP Packet 3.2.1.4.1 Structure AMS/TCP Packet Data array Size Description AMS/TCP Header 6 bytes Contains the length of the data packet. AMS Header 32 bytes The AMS/TCP-Header contains the addresses of the transmitter and receiver. In addition the AMS error code , the ADS command Id and some other information. ADS Data n bytes The ADS data range contains the parameter of the single ADS commands. The structure of the data array depends on the ADS command. Some ADS commands require no additional data. 3.2.1.4.2 AMS/TCP Header Data array Size Description reserved 2 bytes These bytes must be set to 0. Length 4 bytes This array contains the length of the data packet. It consists of the AMS-Header and the enclosed ADS data. The unit is bytes. Twin CAT 3 Version: 1.3.1 23
## Page 24

Target systems 3.2.1.4.3 AMS Header Data array Size Description AMSNet Id Target 6 bytes This is the AMSNet Id of the station, for which the packet is intended. Remarks see below [} 24]. AMSPort Target 2 bytes This is the AMSPort of the station, for which the packet is intended. AMSNet Id Source 6 bytes This contains the AMSNet Id of the station, from which the packet was sent. AMSPort Source 2 bytes This contains the AMSPort of the station, from which the packet was sent. Command Id 2 bytes see below [} 25]. State Flags 2 bytes see below [} 25]. Data Length 4 bytes Size of the data range. The unit is byte. Error Code 4 bytes AMS error number. See ADS Return Codes. Invoke Id 4 bytes Free usable 32 bit array. Usually this array serves to send an Id. This Id makes is possible to assign a received response to a request, which was sent before. Data n bytes Data range. The data range contains the parameter of the considering ADS commands. AMS Net Id The AMSNet Id consists of 6 bytes and addresses the transmitter or receiver. One possible AMSNet Id would be e.g.. 172.16.17.10.1.1. The storage arrangement in this example is as follows: The AMSNet Id is purely logical and has usually no relation to the IP address. The AMSNet Id is configurated at the target system. At the PC for this the Twin CAT System Control is used. If you use other hardware, see the considering documentation for notes about settings of the AMS Net Id. 24 Version: 1.3.1 Twin CAT 3
## Page 25

Target systems Command Id Cmd Description 0x0000 Invalid 0x0001 ADS Read Device Info [} 26] 0x0002 ADS Read [} 26] 0x0003 ADS Write [} 27] 0x0004 ADS Read State [} 27] 0x0005 ADS Write Control [} 28] 0x0006 ADS Add Device Notification [} 28] 0x0007 ADS Delete Device Notification [} 29] 0x0008 ADS Device Notification [} 30] 0x0009 ADS Read Write [} 31] Other commands are not defined or are used internally. Therefore the Command Id is only allowed to contain the above enumerated values! State Flags Flag Description 0x0001 0: Request / 1: Response 0x0004 ADS command The first bit marks, whether it´s a request or response. The third bit must be set to 1, to exchange data with ADS commands. The other bits are not defined or were used for other internal purposes. Therefore the other bits must be set to 0! Flag Description 0x000x TCP Protocol 0x004x UDP Protocol Bit number 7 marks, if it should be transferred with TCP or UDP. 3.2.1.4.4 ADS Commands 3.2.1.4.4.1 Command Overview Command Description ADS Read Device Info [} 26] Reads the name and the version number of the ADS device. ADS Read [} 26] With ADS Read data can be read from an ADS device ADS Write [} 27] With ADS Write data can be written to an ADS device. ADS Read State [} 27] Reads the ADS status and the device status of an ADS device. ADS Write Control [} 28] Changes the ADS status and the device status of an ADS device. ADS Add Device Notification [} 28] A notification is created in an ADS device. ADS Delete Device Notification [} 29] One before defined notification is deleted in an ADS device. ADS Device Notification [} 30] Data will carry forward independently from an ADS device to a Client ADS Read Write [} 31] With ADS Read Write data will be written to an ADS device. Additionally, data can be read from the ADS device. Twin CAT 3 Version: 1.3.1 25
## Page 26

Target systems 3.2.1.4.4.2 ADS Read Device Info Reads the name and the version number of the ADS device. Request No additional data required Response Data array Size Description Result 4 bytes ADS error number. Major Version 1 byte Major version number Minor Version 1 byte Minor version number Version Build 2 bytes Build number Device Name 16 bytes Name of ADS device 3.2.1.4.4.3 ADS Read With ADS Read data can be read from an ADS device. The data are addressed by the Index Group and the Index Offset Request Data array Size Description Index Group 4 bytes Index Group of the data which should be read. Index Offset 4 bytes Index Offset of the data which should be read. Length 4 bytes Length of the data (in bytes) which should be read. Response 26 Version: 1.3.1 Twin CAT 3
## Page 27

Target systems Data array Size Description Result 4 bytes ADS error number Length 4 bytes Length of data which are supplied back. Data n bytes Data which are supplied back. 3.2.1.4.4.4 ADS Write With ADS Write data can be written to an ADS device. The data are addressed by the Index Group and the Index Offset Request Data array Size Description Index Group 4 bytes Index Group in which the data should be written Index Offset 4 bytes Index Offset, in which the data should be written Length 4 bytes Length of data in bytes which are written Data n bytes Data which are written in the ADS device. Response Data array Size Description Result 4 bytes ADS error number 3.2.1.4.4.5 ADS Read State Reads the ADS status and the device status of an ADS device. Request No additional data required Response Twin CAT 3 Version: 1.3.1 27
## Page 28

Target systems Data array Size Description Result 4 bytes ADS error number. ADS State 2 bytes ADS status (see data type ADSSTATE of the ADS-DLL). Device State 2 bytes Device status 3.2.1.4.4.6 ADS Write Control Changes the ADS status and the device status of an ADS device. Additionally it is possible to send data to the ADS device to transfer further information. These data were not analyzed from the current ADS devices (PLC, NC, ...) Request Data array Size Description ADS State 2 bytes New ADS status (see data type ADSSTATE of the ADS-DLL). Device State 2 bytes New device status. Length 4 bytes Length of data in byte. Data n bytes Additional data which are sent to the ADS device Response Data array Size Description Result 4 bytes ADS error number. 3.2.1.4.4.7 ADS Add Device Notification A notification is created in an ADS device. Note: We recommend to announce not more than 550 notifications per device. Otherwise increase the payload by working with structures or use sum commands. 28 Version: 1.3.1 Twin CAT 3
## Page 29

Target systems Request Data array Size Description Index Group 4 bytes Index Group of the data, which should be sent per notification. Index Offset 4 bytes Index Offset of the data, which should be sent per notification. Length 4 bytes Length of data in bytes, which should be sent per notification. Transmission Mode 4 bytes See description of the structure ADSTRANSMODE at the ADS- DLL. Max Delay 4 bytes At the latest after this time, the ADS Device Notification is called. The unit is 1ms. Cycle Time 4 bytes The ADS server checks if the value changes in this time slice. The unit is 1ms reserved 16bytes Must be set to 0 Response Data array Size Description Result 4 bytes ADS error number Notification Handle 4 bytes Handle of notification 3.2.1.4.4.8 ADS Delete Device Notification One before defined notification is deleted in an ADS device. Request Data array Size Description Notification Handle 4 bytes Handle of notification. The handle is created by the ADS command Add Device Notification Twin CAT 3 Version: 1.3.1 29
## Page 30

Target systems Response Data array Size Description Result 4 bytes ADS error number 3.2.1.4.4.9 ADS Device Notification Data will carry forward independently from an ADS device to a Client. Request The data which are transferred at the Device Notification are multiple nested into one another. The Notification Stream contains an array with elements of type Ads Stamp Header. This array again contains elements of type Ads Notification Sample. Ads Notification Stream Data array Size Description Length 4 bytes Size of data in byte. Stamps 4 bytes Number of elements of type Ads Stamp Header [} 30] Ads Stamp Header n bytes Array with elements of type Ads Stamp Header [} 30] Ads Stamp Header Data array Size Description Time Stamp 8 bytes The timestamp is coded after the Windows FILETIME format. I.e. the value contains the number of the 100-nanosecond intervals, which passed since 1.1.1601. In addition, the local time change is not considered. Thus the time stamp is present as universal Coordinated time (UTC). Samples 4 bytes Number of elements of type Ads Notification Sample [} 31] Ads Notification Sample n bytes Array with elements of type Ads Notification Sample [} 31] 30 Version: 1.3.1 Twin CAT 3
## Page 31

Target systems Ads Notification Sample Data array Size Description Notification Handle 4 Bytes Handle of notification. Sample Size 4 Bytes Size of data range in bytes. Data n Bytes Data If your handle becomes invalid, one notification without data will be send once as advice. 3.2.1.4.4.10 ADS Read Write With ADS Read Write data will be written to an ADS device. Additionally, data can be read from the ADS device. The data which can be read are addressed by the Index Group and the Index Offset Request Data array Size Description Index Group 4 bytes Index Group, in which the data should be written. Index Offset 4 bytes Index Offset, in which the data should be written Read Length 4 bytes Length of data in bytes, which should be read. Write Length 4 bytes Length of data in bytes, which should be written Data n bytes Data which are written in the ADS device. Response Data array Size Description Result 4 bytes ADS error number Length 4 bytes Length of data which are supplied back. Data n bytes Data which are supplied back. Twin CAT 3 Version: 1.3.1 31
## Page 32

Target systems 3.2.1.5 Specification for ADS devices 3.2.1.5.1 General The PLC software can be described as a virtual field unit (Automation Device), since it is a pure software PLC. It therefore provides a Beckhoff ADS (Automation Device Specification) interface for other communication partners (e.g. other virtual field units or Windows programs), via which it can be parameterised or interrogated. Use of the ADS standardises access to the PLC and incorporates it into the range of available virtual field units. The READ and WRITE operations take place on the PLC interface (as defined by ADS) via two numbers: the index group (16 bit) and the index offset (32 bit). The ADS interface of the PLC will be described in more detail in the following pages with regard to the group and offset indices. Specification "Index-Group" of the PLC The four global ranges of an ADS unit are shown as follows for the PLC as four sections in the index groups: Index-Group (0x = hex) Index Group description 0x00000000 0x00000FFF reserved 0x00001000 PLC ADS parameter range 0x00002000 PLC ADS status range 0x00003000 PLC ADS unit function range 0x00004000 PLC ADS services ( includes services to access PLC memory range (%M field) ) [} 32] 0x00006000 0x0000EFFF reserved for PLC ADS extension 0x0000F000 0x0000FFFF general Twin CAT ADS system services ( includes services to access PLC process diagram of the physical inputs and outputs ) [} 33] 3.2.1.5.2 Specification of the PLC services This section includes services to access the PLC memory range (%M field). Index Group Index Offset Access Data type Description Remarks 0x00004020 0x00000000- R/W UINT8[n] READ_M - WRITE_M PLC memory 0x0000FFFF range(%M field). Offset is byte offset. 0x00004021 0x00000000- R/W UINT8 READ_MX - WRITE_MX PLC 0x FFFFFFFF memory range (%MX field). The low word of the index offset is the byte offset. The index offset contains the bit address calculated from the byte number *8 + bit number 0x00004025 0x00000000 R ULONG PLCADS_IGR_RMSIZE Byte length of the process diagram of the memory range 0x00004030 0x00000000- R/W UINT8 PLCADS_IGR_RWRB 0x FFFFFFFF Retain data range. The index offset is byte offset 0x00004035 0x00000000 R ULONG PLCADS_IGR_RRSIZE Byte length of the retain range 0x00004040 0x00000000- R/W UINT8 PLCADS_IGR_RWDB 0x FFFFFFFF Data range. The index offset is byte offset. 0x00004045 0x00000000 R ULONG PLCADS_IGR_RDSIZE Byte length of the data range 32 Version: 1.3.1 Twin CAT 3
## Page 33

Target systems 3.2.1.5.3 Specification of the ADS system services This section covers those ADS services which have identical meanings and effects with every Twin CAT ADS unit. In this section are also included services to access the PLC process diagram of the physical inputs and outputs. Twin CAT 3 Version: 1.3.1 33
## Page 34

Target systems Index Index Access Data type Description Group Offset 0x0000F003 0x00000000 R&W W: UINT8[n] R: UINT32 GET_SYMHANDLE_BYNAME A handle (code word) is assigned to the name contained in the write data and is returned to the caller as a result. 0x0000F004 0x00000000 Reserved. 0x0000F005 0x00000000- R/W UINT8[n] READ_/ 0x FFFFFFFF=sym WRITE_SYMVAL_BYHANDL Handle E Reads the value of the variable identified by ‚sym Hdl' or assigns a value to the variable. The ‚sym Hdl' must first have been determined by the GET_SYMHANDLE_BYNAME services. 0x0000F006 0x00000000 W UINT32 RELEASE_SYMHANDLE The code (handle) contained in the write data for an interrogated, named PLC variable is released. 0x0000F020 0x0001F400- R/W UINT8[n] READ_I - WRITE_I PLC 0x FFFFFFFF process diagram of the physical inputs (%I field). Offset is byte offset. 0x0000F021 0x000FA000- R/W UINT8 READ_IX - WRITE_IX PLC 0x FFFFFFFF process diagram of the physical inputs (%IX field). The index offset contains the bit address which is calculated from base offset (0x FA000) + byte number +8 + bit number 0x0000F025 0x00000000 R ULONG ADSIGRP_IOIMAGE_RISIZEB yte length of the PLC process diagram of the physical inputs. 0x0000F030 0x0003E800- R/W UINT8[n] READ_Q - WRITE_Q PLC 0x FFFFFFFF process diagram of the physical outputs (%Q field). Offset is byte offset. 0x0000F031 0x001F4000- R/W UINT8 READ_QX - WRITE_QX PLC 0x FFFFFFFF process diagram of the physical outputs(%QX field). The index offset contains the bit address which is calculated from the base offset (0x1F4000) + byte number *8 + bit number. 0x0000F035 0x00000000 R ULONG ADSIGRP_IOIMAGE_ROSIZE Byte length of the PLC process diagram of the physical outputs. 34 Version: 1.3.1 Twin CAT 3
## Page 35

Target systems Index Index Access Data type Description Group Offset 0x0000F080 0x00000000- R&W W: ADSIGRP_SUMUP_READ 0x FFFFFFFF= n n * ULONG[3] := The write-data contains a list of (number of internal IG1, IO1, Len1, multiple, separate sub- IG2, IO2, Len2, Ads Read Req(IG, IO, Len, commands)n(max) ..., Data) sub-commands. The = 500 IG(n), IO(n), Len(n) read-data contains a list of return codes followed by the R: requested data. n * ULONG + UINT8[Len1] + UINT8[Len2] + ..., + UINT8[Len(n)] := Result1, Result2, ..., Result(n), Data1, Data2, ..., Data(n) 0x0000F081 0x00000000- R&W W: ADSIGRP_SUMUP_WRITE 0x FFFFFFFF= n (n * ULONG[3]) The write-data contains a list of (number of internal + UINT8[Len1] multiple, separate sub- + UINT8[Len2] Ads Write Req(IG, IO, Len, commands)n(max) + ..., Data) sub-commands. = 500 + UINT8[Len(n)] := The read-data contains a list of IG1, IO1, Len1, return codes. IG2, IO2, Len2, ..., IG(n), IO(n), Len(n), Data1, Data2, ..., Data(n) R: n * ULONG := Result1, Result2, ..., Result(n) Twin CAT 3 Version: 1.3.1 35
## Page 36

Target systems Index Index Access Data type Description Group Offset 0x0000F082 0x00000000- R&W W: ADSIGRP_SUMUP_READWR 0x FFFFFFFF= n (n * ULONG[4]) ITE The write-data contains a (number of internal + UINT8[Write Len1] list of multiple, separate sub- + UINT8[Write Len2] Ads Read Write Req(IG, IO, commands)n(max) + ..., read Len, write Len, Data) sub- = 500 + UINT8[Write Len(n)] := commands. IG1, IO1, Read Len1, The read-data contains a list of Write Len1, return codes and return data IG2, IO2, Read Len2, length followed by the Write Len2, requested data. ..., IG(n), IO(n), Read Len(n), ..., Write Len(n), Write Data1, Write Data2, ..., Write Data(n) R: (n * ULONG[2]) + UINT8[Return Len1] + UINT8[Return Len2] + ..., + UINT8[Return Len(n)] := Result1, Return Len1, Result2, Return Len2, ..., Result(n), Return Len(n), Read Data1, Read Data2, ..., Read Data(n) 0x0000F083 0x00000000- R&W W: ADSIGRP_SUMUP_READEX 0x FFFFFFFF= n n * ULONG[3] := The write-data contains a list of (number of internal IG1, IO1, Len1, multiple, separate sub- IG2, IO2, Len2, Ads Read Req(IG, IO, Len, commands)n(max) ..., Data) sub-commands. The = 500 IG(n), IO(n), Len(n) read-data contains a list of return codes followed by the R: requested data. n * ULONG + UINT8[Len1] + UINT8[Len2] + ..., + UINT8[Len(n)] := Result1, Result2, ..., Result(n), Data1, Data2, ..., Data(n) 36 Version: 1.3.1 Twin CAT 3
## Page 37

Target systems Index Index Access Data type Description Group Offset 0x0000F084 0x00000000- R&W W: ADSIGRP_SUMUP_READEX 0x FFFFFFFF= n n * ULONG[3] := 2 The write-data contains a list (number of internal IG1, IO1, Len1, of multiple, separate sub- IG2, IO2, Len2, Ads Read Req(IG, IO, Len, commands)n(max) ..., Data) sub-commands. The = 500 IG(n), IO(n), Len(n) read-data contains a list of return codes followed by the R: requested data. n * ULONG + UINT8[Len1] + UINT8[Len2] + ..., + UINT8[Len(n)] := Result1, Result2, ..., Result(n), Data1, Data2, ..., Data(n) 0x0000F085 0x00000000- R&W W: ADSIGRP_SUMUP_ADDDEV 0x FFFFFFFF= n (n * ULONG[3]) := NOTE The write-data contains (number of internal IG1, IO1, Len1, a list of multiple, separate sub- IG2, IO2, Len2, Ads Add Device Notifications(IG, commands)n(max) ..., IO, Len, Data) sub- = 500 IG(n), IO(n), Len(n) commands. The read-data contains a list of return codes followed by the requested R: notification handles. (n * ULONG) + UINT8[Len1] + UINT8[Len2] + ..., + UINT8[Len(n)] := Result1, Result2, ..., Result(n), Handle1, Handle2,..., Handle(n) 0x0000F086 0x00000000- R&W W: ADSIGRP_SUMUP_DELDEV 0x FFFFFFFF= n Handle1, Handle2,..., NOTE The write-data contains (number of internal Handle(n) a list of multiple handles. The sub- read-data contains a list of commands)n(max) return codes. = 500 R: (n * ULONG) + UINT8[Len1] + UINT8[Len2] + ..., + UINT8[Len(n)] := Result1, Result2, ..., Result(n) 3.2.1.5.4 Specification of the NC This documentation contains all Twin CAT 3 specific modifications and new features. Twin CAT 3 Version: 1.3.1 37
## Page 38

Target systems Index-Group Description Remarks (Hex) 0x1000 Ring-0-Manager: Parameter [} 40] Optional! 0x1100 Ring-0-Manager: State [} 41] Optional! 0x1200 Ring-0-Manager: Functions [} 41] Optional! 0x1300 Ring-0-Manager: Cyclic process data Not implemented! 0x2000 + ID Channel with corresponding ID: parameters [} 42] 0x2100 + ID Channel with corresponding ID: state [} 45] 0x2200 + ID Channel with corresponding ID: functions [} 48] 0x2300 + ID Channel with corresponding ID: cyclic process data [} 51] 0x3000 + ID Group with corresponding ID: parameters [} 52] Optional! 0x3100 + ID Group with corresponding ID: state [} 57] Optional! 0x3200 + ID Group with corresponding ID: functions [} 63] Optional! 0x3300 + ID Group with corresponding ID: cyclic process data Not implemented! 0x4000 + ID Axis with corresponding ID: parameters [} 69] 0x4100 + ID Axis with corresponding ID: state [} 82] 0x4200 + ID Axis with corresponding ID: functions [} 92] 0x4300 + ID Axis with corresponding ID: cyclic process data [} 114] 0x5000 + ID Encoder with corresponding ID: parameters [} 119] Optional! 0x5100 + ID Encoder with corresponding ID: state [} 124] Optional! 0x5200 + ID Encoder with corresponding ID: functions [} 129] Optional! 0x5300 + ID Encoder with corresponding ID: cyclic process data [} 132] Optional! 0x6000 + ID Controller with corresponding ID: Parameter [} 136] Optional! 0x6100 + ID Controller with corresponding ID: State [} 140] Optional! 0x6200 + ID Controller with corresponding ID: Functions [} 143] Optional! 0x6300 + ID Controller with corresponding ID: cyclic process data Not implemented! 0x7000 + ID Drive with corr. ID: parameters [} 144] Optional! 0x7100 + ID Drive with corr. ID: state [} 148] Optional! 0x7200 + ID Drive with corr. ID: functions [} 150] Optional! 0x7300 + ID Drive with corr. ID: cyclic process data [} 151] Optional! 0x0A000 + ID Tables (n x m) with corresponding ID: parameters [} 154] Maximum number of 0x0A000+ID for table ID [1..255] tables extended to 4095 0x1A000+ID for table ID [256..4095] (from TC3.1 B4021) . . . 0x FA000+ID for table ID [3840..4095] 0x0A100 + ID Tables (n x m) with corresponding ID: state [} 159] 0x0000A100+IDLow Byte for table ID [1..255] 0x0001A100+Id Low Byte for table ID [256..4095] … 0x000FA100+Id Low Byte for table ID [3840..4095] 0x000n A100+Id Low Byte for table ID [1..4095] (Tab ID = n * 256 + Id Low Byte) 38 Version: 1.3.1 Twin CAT 3
## Page 39

Target systems Index-Group Description Remarks (Hex) 0x0A200 + ID Tables (n x m) with corresponding ID: functions [} 160] 0x0000A100+IDLow Byte for table ID [1..255] 0x0001A100+Id Low Byte for table ID [256..4095] … 0x000FA100+Id Low Byte for table ID [3840..4095] 0x000n A100+Id Low Byte for table ID [1..4095] (Tab ID = n * 256 + Id Low Byte) 0x0A300 + ID Tables (n x m) with corresponding ID: cyclic process data Not implemented! 0x0000A100+IDLow Byte for table ID [1..255] 0x0001A100+Id Low Byte for table ID [256..4095] … 0x000FA100+Id Low Byte for table ID [3840..4095] 0x000n A100+Id Low Byte for table ID [1..4095] (Tab ID = n * 256 + Id Low Byte) 0x F000 ... reserved area (Twin CAT system area) 0x FFFF Index Group: Index Offset: 0x F081 0x00000000 ... ADSIGRP_SUMUP_WRITE 0x FFFFFFFF The Read-Write-command contains a list in (n elements) the Write-data of multiple separate ADS- Write-commands (like a group request). Structure of the Write-Data: [ Idx Grp(1), Idx Off(1), Write Len(1), ..., Idx Grp(n), Idx Off(n), Write Len(n), Write Data(1), ..., Write Data(n) ] Structure of the Read-Data: [ Error(1), ..., Error(n) ] 0x F082 0x00000000 ... ADSIGRP_SUMUP_READWRITE 0x FFFFFFFF The Read-Write-command contains a list in (n elements) the Write-data of multiple separate ADS- Read-Write-commands (like a group request). Structure of the Write-Data: [ Idx Grp(1), Idx Off(1),Read Len(1), Write Len(1), ..., Idx Grp(n), Idx Grp(n), Read Len(n), Write Len(n), Write Data(1), ..., Write Data(n) ] Structure of the Read-Data: [ Error(1), Read Len(1), ..., Error(n), Read Len(n), Read Data(1), ..., Read Data(n) ] 0x F084 0x00000000 ... ADSIGRP_SUMUP_READ (READEX2) 0x FFFFFFFF The Read-Write-command contains a list in (n elements) the Write-data of multiple separate ADS- Read-commands (like a group request). Structure of the Write-Data: [ Idx Grp(1), Idx Off(1), Read Len(1), ..., Idx Grp(n), Idx Grp(n), Read Len(n) ] Structure of the Read-Data: [ Error(1), Read Len(1), ..., Error(n), Read Len(n), Read Data(1), ..., Read Data(n) ] Twin CAT 3 Version: 1.3.1 39
## Page 40

Target systems 3.2.1.5.4.1 Specification Ring-0-Manager 3.2.1.5.4.1.1 "Index offset" specification for Ring-0 parameter (Index group 0x1000) Index offset Access Ring-0-Man- Data type Phys. Definition Description Remarks (Hex) ager unit range 0x00000010 Read every UINT32 100 ns Cycle time SAF task 0x00000012 Read every UINT32 100 ns Cycle time SVB task 0x00000014 Read every INT32 ns Global Time Compensation Shift (for SAF Task) 0x00000020 Read/Write every UINT16 1 0/1 Cyclic data consistence check and correction of the NC setpoint values 40 Version: 1.3.1 Twin CAT 3
## Page 41

Target systems 3.2.1.5.4.1.2 "Index offset" specification for Ring-0 state (Index group 0x1100) Index offset Access Ring-0-Man- Data type Phys. Definition Description Remarks (Hex) ager unit range 0x00000001 Read every UINT32 1 0, 1...255 Quantity of Channel 0x00000002 Read every UINT32 1 0, 1...255 Quantity of group 0x00000003 Read every UINT32 1 0, 1...255 Quantity of Axis 0x00000004 Read every UINT32 1 0, 1...255 Quantity of Encoder 0x00000005 Read every UINT32 1 0, 1...255 Quantity of controller 0x00000006 Read every UINT32 1 0, 1...255 Quantity of Drives 0x0000000A Read every UINT32 1 0, 1...255 Quantity of table (n x m) 0x00000010 Read every UINT32 1 Cycle time error counter Reserved! SAF task (not scopeable) 0x00000014 Read every UINT32 1 IO-cycle time error Reserved! counter SAF task (not scopeable) 0x00000020 Read every UINT32 s Computing time SAF task Reserved! (not scopeable) 0x00000031 Read every UINT32[n] 1 0, 1...255 Supplies the channel IDs for all channels in the system 0x00000032 Read every UINT32[n] 1 0, 1...255 Supplies the group IDs for all groups in the system 0x00000033 Read every UINT32[n] 1 0, 1...255 Supplies the axis IDs for all axes in the system 0x00000034 Read every UINT32[n] 1 0, 1...255 Supplies the encoder IDs for all encoders in the system 0x00000035 Read every UINT32[n] 1 0, 1...255 Supplies the controller IDs for all controllers in the system 0x00000036 Read every UINT32[n] 1 0, 1...255 Supplies the drive IDs for all drives in the system 0x0000003A Read every UINT32[n] 1 0, 1...255 Supplies the table IDs for all tables in the system 0x000001nn Read every UINT32 1 0, 1...255 Supplies for the encoder Reserved! ID the appropriate axis IDnn = Encoder ID 0x000002nn Read every UINT32 1 0, 1...255 Supplies for the controller Reserved! ID the appropriate axis IDnn = Controller ID 0x000003nn Read every UINT32 1 0, 1...255 Supplies for the drive ID Reserved! the appropriate axis IDnn = Drive ID 3.2.1.5.4.1.3 "Index offset" specification for Ring-0 functions (Index group 0x1200) Index offset Access Ring-0-Man- Data type Phys. Definition Description Remarks (Hex) ager unit range 0x00000020 Write every VOID 1 Clear cycle time error Reserved! counter SAF & SVB Twin CAT 3 Version: 1.3.1 41
## Page 42

Target systems 3.2.1.5.4.2 Specification Channels 3.2.1.5.4.2.1 "Index offset" specification for channel parameter (Index group 0x2000 + ID) 42 Version: 1.3.1 Twin CAT 3
## Page 43

Target systems Index-Offset Access Channel type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000001 Read every UINT32 1 Channel ID 0x00000002 Read every UINT8[30+1] 1 Channel name 0x00000003 Read every UINT32 1 ENUM Channel type [} 160] 0x00000004 Read every UINT32 1 ENUM Interpreter type [} 160] 0x00000005 Read every UINT32 1 Program load buffer size in bytes 0x00000006 Read every UINT32 1 Program no. according to job list 0x00000007 Read/Write every UINT32 1 ENUM Set load log mode [} 161] 0x00000008 Read/Write every UINT32 1 ENUM Set trace mode [} 161] 0x00000009 Read/Write every UINT32 1 RESERVED 0x0000000A Read/Write every UINT32 1 0/1 Records all feeder entries in a log file named "Tc Nci.log" 0x0000000B Read/Write every UINT32 1 0/1 Channel specific level for NC logger messages 0: errors only 1: all NC messages 0x00000010 Read Write every Write { UINT32 1 0..159 Start index of M function UINT32 1 1..160 Number of M functions to be read } Read [n] { UINT8 1 0..159 Rule bit mask of the M function INT32[10] 1 -1..159 Number of M functions to be cleared } 0x00000011 Write Interpolation Write M function Only used description internally! 0x00000012 Read/Write Interpolation LREAL64 1 Factor for G70 0x00000013 Read/Write Interpolation LREAL64 1 Factor for G71 0x00000014 Write Interpolation { Axes user symbols not yet released char[32] User symbol (null- terminated) char[10] System symbol (null- terminated) } 0x00000015 Read/Write Interpolation UINT16 resp. 1 0/1 default: Activation of default G- NEW from UINT32 FALSE code TC3.1 B4014 0x00000021 Read every UINT32 1 Group ID (only explicit for 3D and FIFO channel) 0x00000031 Read/Write Interpolation UINT16 1 Standard output port Reserved of the interpreter function, no standard! 0x00000032 Read/Write Interpolation UINT16 1 0/1 Cartesian tool offset Reserved entry function, no standard! Twin CAT 3 Version: 1.3.1 43
## Page 44

Target systems Index-Offset Access Channel type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000040 Read/Write Interpolation { Target address of Reserved interpreter hooks function, no standard! char[6] Ams Net ID UINT16 Port UINT32 Index group UINT32 Index offset } 0x00000050 Read/Write Interpolation UINT32 1 ENUM Reaction if at the radius compensation a bottle neck is recognized 0: Error and abort 1: Note & trouble shooting 2: Only note, without outline modulation 0x00000051 Read/Write Interpolation UINT32 1 1..24 Look ahead for bottleneck detection 0x00000052 Read/Write Interpolation UINT32 1 0/1 Chamfer on/off reserved function, no standard! 0x00000053 Read/Write Interpolation UINT32 1 Activation for reading the currently effective interpolation rules, zero shifts and rotation 0: off 1: on 0x00000054 Read/Write Interpolation UINT32 1 0/1 Retrace on/off Reserved function, no standard! 0x00000055 Read/Write Interpolation UINT32[4] 1 Configuration of the cyclic channel interface for UINT32; up to 4 index offsets can be configured. 0x00000056 Read/Write Interpolation UINT32[4] 1 Configuration of the cyclic channel interface for LREAL; up to 4 index offsets can be configured. 0x00010K0L Read/Write every REAL64 e.g. mm ±MAX REAL64 Value for zero shift (NPV) [1..3] Axis index K=1 → X K=2 → Y K=3 → Z [1..0x A] L=1 → G54F L=2 → G54G L=3 → G55F ... 0x0002ww00 Read/Write every UINT16 Tool number: values for tool compensation 0x0003ww00 Read/Write every UINT16 [1...50] Tool type: ww = tool 1...50 0x0004wwnn Read/Write every REAL64 [1...14] Parameter: nn = Index 1...14 0x000500gg Read/Write every REAL64 e.g. mm ≥ 0 (value) Radius of the [1...9] (g) tolerance sphere gg = channel group (default: 1) 44 Version: 1.3.1 Twin CAT 3
## Page 45

Target systems 3.2.1.5.4.2.2 "Index offset" specification for channel state (Index group 0x2100 + ID) Twin CAT 3 Version: 1.3.1 45
## Page 46

Target systems Index-Offset Access Channel type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000001 Read every INT32 1 ENUM Error code Channel 0x00000002 Read every UINT32 1 Number of groups in the Channel 0x00000003 Read every UINT32 1 ENUM Interpreter status Cannot be [} 161] traced by oscilloscope! 0x00000004 Read every UINT32 1 ENUM Interpreter/channel operation mode [} 161] 0x00000005 Read every UINT32 1 Currently loaded program 0x00000007 Read every UINT8[...] 1 Program name of Max. 100 currently loaded characters, null- program terminated (100 characters, null- terminated) 0x00000008 Read Interpreter UINT32 1 [0,1] Interpreter simulation Cannot be mode traced by oscilloscope! 0: off (default) 1: on 0x00000010 Read Interpreter UINT32 1 Text index Cannot be traced by If the interpreter is in oscilloscope! the aborted state, the current text index can be read out here 0x00000011 Read Write Interpreter Write Cannot be traced by UINT32 1 Text index oscilloscope! Read UINT8[..] 1 Line of the NC part program from the text index 0x00000012 Read Interpreter { UINT32 1 Current display for 1: SAF 2: Interpreter 3: Error offset UINT32 1 File offset UINT8[260] 1 Path + program name } 0x00000013 Read Interpreter UINT32[18] Display for currently The technology effective G-code data must first be activated. 0x00000014 Read Interpreter { Determines the The technology currently effective zero data must first shift be activated. UINT32 1 Block counter UINT32 Dummy LREAL[3] 1 Zero shift G54.. G57 LREAL[3] 1 Zero shift G58 LREAL[3] 1 Zero shift G59 } 0x00000015 Read Interpreter { Determines the The technology currently effective data must first rotation be activated. UINT32 1 Block counter UINT32 1 Dummy LREAL[3] 1 Rotation of X, Y & Z in degrees } 0x00000016 Read Interpreter UINT32 1 [0,1] Feeder Info Only used internally! Not standard 46 Version: 1.3.1 Twin CAT 3
## Page 47

Target systems Index-Offset Access Channel type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000100 Read every UINT32 [n] 1 [0, 1...255] Returns the respective Cannot be axis IDs in the channel traced by number: [1...255] axis oscilloscope! ID's: [0, 1...255] Twin CAT 3 Version: 1.3.1 47
## Page 48

Target systems 3.2.1.5.4.2.3 "Index offset" specification for channel functions (Index group 0x2200 + ID) 48 Version: 1.3.1 Twin CAT 3
## Page 49

Target systems Index offset Access Channel type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000001 Write every UINT32 1 Load NC program with program number 0x00000002 Write every VOID Start Interpreter 0x00000003 Write every VOID RESERVED 0x00000004 Write every UINT8[...] Load NC program by name. The standard NC path does not have to be given although it may. Other paths are also permitted. 0x00000005 Write every UINT16 ENUM cf. appendix Set the interpreter/ interpreter channel operation mode operation mode [} 161] 0x00000006 Write Interpreter UINT8[...] Set path for subroutines 0x00000008 Write Interpreter UINT32 1 Interpreter simulation Not yet mode: released 0: off (default) 1: on 0x0000000F Write every VOID RESERVED 0x00000010 Write every VOID "Reset" Channel 0x00000011 Write every VOID "Stop" Channel 0x00000012 Write every VOID "Retry" Channel (restart Channel ) 0x00000013 Write every VOID "Skip" Channel (skip task/ block) 0x00000014/0 Write every { "Enable Reserved x00000015 Retrace" /"Disable function, Retrace" no standard! UINT32 1 >0 Feeder directiion: 1: forward 2: backward UINT32 1 ≥ 0 Entry index REAL64[3] mm ±∞ Pos. of the main axes X, Y, Z REAL64[5] mm ±∞ Pos. of the auxiliary axes Q1, ..., Q5 } 0x00000020 Write every VOID "Save" zero offset shift (NPV) 0x00000021 Write every VOID "Load" zero offset shift (NPV) 0x00000022 Write every VOID "Save" tool compensations 0x00000023 Write every VOID "Load" tool compensations 0x00000024 Write Interpolation { Saves snapshot of the interpreter in a given file char[32] Filename in Twin CAT\CNC-folder UINT32 1 0..1 Mask: 0x1: R-Parameters 0x2: Zeroshifts 0x4: Tool Desc } Twin CAT 3 Version: 1.3.1 49
## Page 50

Target systems Index offset Access Channel type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000025 Write Interpolation { Reads snapshot of a given file to the interpreter char[32] Filename in Twin CAT\CNC-folder UINT32 1 0..1 Mask: 0x1: R-Parameters 0x2: Zeroshifts 0x4: Tool Desc } 0x00000026 Write Interpolation VOID Set all tool parameters (incl. type & number) to null 0x00000027 Write Interpolation VOID Set all zero offset shifts to null 0x00000030 Write every VOID Restart (Go Ahead) of the Interpreter after programmed Interpreter stop 0x00000040 Write every VOID Triggerevent for deletion of any remaining travel in the NCI 0x00000041 Write every RESERVED for fair events 0x00000050 Write Interpolation VOID 1 Set Exec Idle Infoin the Reserved interpreter function, no standard! 0x00000051 Write Interpolation UINT32 1 Set block skip mask in Reserved the interpreter parameter: function, Skipping Mask no standard! 0x00000052 Write Intepolation UINT32 1 Set Itp Operation Mode in Reserved the interpreter parameter: function, Operation Mode mask no standard! 0x00000053 Write Interpolation VOID Set Scanning Flag in the Reserved NC device function, no standard! 0x00000054 Write Interpolation Scan position Reserved function, double[8] position no standard! 0x00000055 Write Interpolation Reserved 0x00000056 Write Interpolation VOID Set Interpreter in the Reserved Aborted state function, no standard! 0x00000060 Write Interppolation UINT16 1 0..159 Manual reset of a fast M Function 50 Version: 1.3.1 Twin CAT 3
## Page 51

Target systems 3.2.1.5.4.2.4 "Index offset" specification for cyclic channel process data (Index group 0x2300 + ID) Index offset Access Channel type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000000 Read every {128 Byte} STRUCT s. CHANNEL STRUCTURE Current PLC (PLC→NC) Channel (PLC→NC) structure: interface Remark: Size and Nci Channel Fro alignment changed. m Plc PLCTONC_NCI CHANNEL_RE F 0x00000001 Read every UINT8[...] 1 Interpreter program Cannot be min. 30 Byte display traced by oscilloscope! 0x00000002 Read/Write every UINT32 % [0...1000000] Speed override channel 1000000 = (PLC→NC) (Axis in the Channel ) 100% 0x00000003 Read/Write every UINT32 % [0...1000000] Speed override spindle 1000000 = (PLC→NC) 100% 0x00000080 Read every {160 Byte} STRUCT s. CHANNEL STRUCTURE Current PLC (NC→PLC) Channel (NC→PLC) structure: interface Remark: Size and Nci Channel To P alignment changed. lc NCTOPLC_NCI CHANNEL_RE F 0x10000000 Read/Write every REAL64 1 [0...999] R parameter of the Cannot be +Reg Index Interpreter traced by oscilloscope! 0x20000001 Read every UINT8[...] 1 [1...9] Program display of group Cannot be min. 30 Byte attention handling (SAF) traced by oscilloscope! Twin CAT 3 Version: 1.3.1 51
## Page 52

Target systems 3.2.1.5.4.3 Specification Groups 3.2.1.5.4.3.1 "Index offset" specification for group parameter (Index group 0x3000 + ID) 52 Version: 1.3.1 Twin CAT 3
## Page 53

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000001 Read every UINT32 1 Group ID 0x00000002 Read every UINT8[30+1] 1 Group name 0x00000003 Read every UINT32 1 ENUM Group type [} 161] 0x00000004 Read every UINT32 µs SAF cycle time group 0x00000005 Read every UINT32 µs SVB cycle time group 0x00000006 Read/Write every UINT16 1 0/1 Single block operation mode? 0x0000000B Read every UINT32 1 Size of the SVB table (max. number of SVB entries 0x0000000C Read every UINT32 1 Size of the SAF table (max. number of SAF entries 0x00000010 Read/Write every UINT32 1 [1,2...32] Internal SAF cycle e.g. for DXD time divisor (divides group Default: 1 the internal SAF cycle time by this factor) 0x00000021 Read Channel: every UINT32 1 Channel ID 0x00000022 Read Channel: every UINT8[30+1] 1 Channel name 0x00000023 Read Channel: every UINT32 1 ENUM Channel type [} 160] 0x00000024 Read Channel: every UINT32 1 >0 Number in the Channel 0x00000500 Read/Write DXD group INT32 ENUM [0, 1] Cornering velocity reduction method [} 161] 0: Coulomb-Scattering 1: Cosinus law 2: Velo Jump 0x00000501 Read/Write DXD group REAL64 1 [0.0...1.0] Velocity reduction factor C0 transition (continuous, but neither once nor twice continuously differentiable) 0x00000502 Read/Write DXD group REAL64 1 [0.0...1.0] Velocity reduction factor C1 transition (continuous and continuously differentiable once) 0x00000503 Read/Write DXD group REAL64 degree [0.0...180.0] Critical angle at segment transition "Low" (must be strictly less than or equal to the velocity reduction angle C0) 0x00000504 Read/Write DXD group REAL64 degree [0.0...180.0] Critical angle at segment transition "High" (must be strictly less than or equal to the velocity reduction angle C0) 0x00000505 Read/Write DXD group REAL64 mm/s ≥ 0 Minimum velocity, Attention: which must not be Parameter is undershot at segment not saved in the transitions, despite solution and is possible velocity not transferred reduction. as NC boot parameter! 0x00000506 Read/Write DXD group REAL64 e.g. mm [0.0...1000.0] Radius of the Not tolerance sphere for implemented! blending 0x00000507 Read/Write DXD group REAL64 1 Velocity reduction factor C2 transition Twin CAT 3 Version: 1.3.1 53
## Page 54

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000508 Read/Write DXD group UINT16 1 0/1 Enables calculation of NEW from the total remaining TC3.1 path length B4020.40 0x00000509 Read/Write DXD group UINT16 1 0/1 General activation of the software limit Default: 1 position monitoring for the main axes (X, Y, Z) (see encoder parameters) 0x0000050A Read/Write DXD group UINT32 1 0/1 NCI Overridetype 0: related to internal reduced velocity (without iteration) 1: related to original external (programmed) velocity 2: Relative to the internally reduced velocity (0 ... >100%) 0x0000050C Read DXD group UINT32 1 [128 ... 1024] User-defined NEW from maximum number of TC3.1 B4014 Default: 128 the NCI SAF tables boot entries parameters 0x00000510 Read/Write DXD group REAL64 1 ≥ 0 For reduction method Not Velo Jump implemented! Reductionfactor for C0 transitions: X axis 0x00000511 Read/Write DXD group REAL64 1 ≥ 0 For reduction method Not Velo Jump implemented! Reductionfactor for C0 transitions: Y axis 0x00000512 Read/Write DXD group REAL64 1 ≥ 0 For reduction method Not Velo Jump implemented! Reductionfactor for C0 transitions: Z axis 0x00000513 Read/Write DXD group LREAL64 1 ]0.0..1.0[ Blending for auxiliary Not yet axes: If the effective released path velo is smaller than the programmed one multiplied with this factor, then an accurate stop is inserted and the tolerance ball is deleted 0x00000514 Read/Write DXD group UINT32 1 [1 … 20] Maximum number of NEW from transferred jobs per TC3.1 Default: 1 NC cycle (from SVB to B4020.40 SAF) 0x00000604 Read/Write Encoder group REAL64 e.g. mm/ [0.0...1000.0] Velocity window resp. Base Unit / s s standstill window 0x00000605 Read/Write Encoder group REAL64 s [0.0...60.0] Filter time for standstill window in seconds 0x00000606 Read/Write Encoder group REAL64 s [0.0...60.0] Dead time compensation master/ slave coupling ("angle pre-control") 0x00000701 Read FIFO group UINT32 1 [1...16] FIFO dimension (m = (n x m) FIFO number of axes) boot data Note: The FIFO dimension was increased to 16. 54 Version: 1.3.1 Twin CAT 3
## Page 55

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000702 Read FIFO group UINT32 1 [1...10000] FIFO size (length) (n = (n x m) FIFO number of FIFO boot data entries) 0x00000703 Read FIFO group UINT32 1 [0, 1, 4] Interpolation type for NEW from FIFO setpoint TC3.1 B4020 generator 0: INTERPOLATIONTYP E_LINEAR (default) 1: INTERPOLATIONTYP E_4POINT 4: INTERPOLATIONTYP E_CUBICSPLINE (with 6 points) 0x00000704 Read/Write FIFO group UINT32 1 [1, 2] Override type for FIFO setpoint generator Type 1: OVERRIDETYPE_INS TANTANEOUS (default) Type 2: OVERRIDETYPE_PT 2 0x00000705 Read/Write FIFO group REAL64 s > 0.0 P-T2 time for override change (T1=T2=T0) 0x00000706 Read/Write FIFO group REAL64 s ≥ 0.0 Time delta for two sequenced FIFO entries (FIFO entry timebase) 0x00000801 Read Write Kinematic Write Calculation of the group kinematic forward transformation for the positions (ACS -> MCS) { REAL64[8] e.g. ±∞ ACS (Axis Coordinate degree System) axis positions, max. dimension: 8 UINT32 1 ≥ 0 Reserve UINT32 1 ≥ 0 Reserve } Read { REAL64[8] e.g. mm ±∞ MCS (Machine Coordinate System) axis positions, max. dimension: 8 UINT32 1 ≥ 0 Reserve UINT32 1 ≥ 0 Reserve } Twin CAT 3 Version: 1.3.1 55
## Page 56

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000802 Read Write Kinematic Write Calculation of the group kinematic inverse transformation for the positions (MCS -> ACS) { REAL64[8] e.g. mm ±∞ MCS (Machine Coordinate System) axis positions, max. dimension: 8 UINT32 1 ≥ 0 Reserve UINT32 1 ≥ 0 Reserve } Read { REAL64[8] e.g. ±∞ ACS (Axis Coordinate degree System) axis positions, max. dimension: 8 UINT32 1 ≥ 0 Reserve UINT32 1 ≥ 0 Reserve } 56 Version: 1.3.1 Twin CAT 3
## Page 57

Target systems 3.2.1.5.4.3.2 "Index offset" specification for group state (Index group 0x3100 + ID) Twin CAT 3 Version: 1.3.1 57
## Page 58

Target systems Index offset Access Group type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000001 Read every INT32 1 ENUM Error code group 0x00000002 Read every UINT32 1 Number of master axes 0x00000003 Read every UINT32 1 Number of slave axes 0x00000004 Read every UINT32 1 s. ENUM SVB group state (state) 0x00000005 Read every UINT32 1 s. ENUM SAF group state (main state) 0x00000006 Read every UINT32 1 s. ENUM Moving state (state) 0x00000007 Read every UINT32 1 s. ENUM SAF sub-group state (sub state) 0x00000008 Read every UINT32 1 s. ENUM Referencing state (state) 0x00000009 Read every UINT32 1 s. ENUM Coupling state (state) Cannot be traced by oscilloscope! 0x0000000A Read every UINT32 1 ≥0 Coupling table index Cannot be traced by oscilloscope! 0x0000000B Read every UINT32 1 ≥0 current number of Symbolic SVB entries/tasks access: 'Svb Entries' (DXD) 0x0000000C Read every UINT32 1 ≥0 Current number of Symbolic SAF entries/tasks access: 'Saf Entries' (DXD) 0x0000000D Read every UINT32 1 Current block number Symbolic (only active for access: interpolation group) 'Block Number' (DXD) 0x0000000E Read every UINT32 1 ≥0 current number of free Cannot be SVB entries/tasks traced by oscilloscope! 0x0000000F Read every UINT32 1 ≥0 Current number of free Cannot be SAF entries/tasks traced by oscilloscope! 0x00000011 Read every UINT16 1 0/1 Emergency Stop (E- Cannot be Stop) active? traced by oscilloscope! 58 Version: 1.3.1 Twin CAT 3
## Page 59

Target systems Index offset Access Group type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000110 Read PTP group { Internal NC Reserved! information (resolutions) REAL64 e.g. mm ± ∞ External End Position REAL64 e.g. mm/ >0 External Target Velocity s REAL64 e.g. mm/ >0 External Acceleration s^2 REAL64 e.g. mm/ >0 External Deceleration s^2 REAL64 e.g. mm/ >0 External Jerk s^3 UINT32 1 >0 External Override Type REAL64 e.g. mm ± ∞ Internal End Position REAL64 e.g. mm/ >0 Internal Target Velocity s (refers to 100 %) REAL64 % [0 ... 100] Internal Actual Override REAL64 e.g. mm/ >0 Internal Acceleration s^2 REAL64 e.g. mm/ >0 Internal Deceleration s^2 REAL64 e.g. mm/ >0 Internal Jerk s^3 REAL64 e.g. mm >0 Position Resolution REAL64 e.g. mm/ ≥0 Velocity Resolution s REAL64 e.g. mm/ ≥0 Acceleration Resolutio s^2 n REAL64 e.g. mm/ ≥0 Velocity Resolution At A s cceleration Zero } 0x00000500 Read DXD group REAL64 e.g. mm ≥ 0 Path rest way Symbolic (remaining arc length) access: on the current path 'Set Path Rem Le segment ngth' 0x00000501 Read DXD group REAL64 e.g. mm ≥ 0 Racked out arc length Symbolic on the current path access: segment 'Set Path Length' 0x00000502 Read DXD group REAL64 e.g. mm/ ≥ 0 Current path set Symbolic s velocity access: 'Set Path Velo' 0x00000503 Read DXD group REAL64 e.g. mm/ ± ∞ Current path set Symbolic s^2 acceleration access: 'Set Path Acc' 0x00000504 Read DXD group REAL64 e.g. mm/ ≥ 0 Amount of the current Symbolic s^2 vectorial set access: acceleration 'Set Path Abs Acc ' 0x00000505 Read DXD group REAL64 e.g. mm/ ≥ 0 Maximum segment Symbolic s end path set velocity access: 'Set Path Velo En d' 0x00000506 Read DXD group REAL64 e.g. mm/ ≥ 0 Segment maximum Symbolic s path set velocity access: 'Set Path Velo Ma x' 0x00000507 Read DXD group REAL64 e.g. mm ≥ 0 Current relative Symbolic braking distance access: based on the current 'Set Path Stop Di arc length st' 0x00000508 Read DXD group REAL64 e.g. mm ± ∞ Safety distance = Symbolic segment arc length - access: current arc length - 'Set Path Securit relative braking y Dist' distance Twin CAT 3 Version: 1.3.1 59
## Page 60

Target systems Index offset Access Group type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000509 Read DXD group REAL64 1 0/1 Segment transition Symbolic access: 'Set Path Segme nt Change' 0x0000050A Read DXD group REAL64 % [0 ... 100] Path velocity override Symbolic access: 'Set Path Overrid e' 0x00000511 Read DXD group REAL64 e.g. mm/ ≥ 0 Component of the Symbolic s actual path velocity access: 'Act Path Abs Vel o' 0x00000512 Read DXD group REAL64 e.g. mm/ ± ∞ Actual path Symbolic s^2 acceleration on the access: current segment 'Act Path Acc' 0x00000513 Read DXD group REAL64 e.g. mm/ ≥ 0 Component of the Symbolic s^2 actual path access: acceleration on the 'Act Path Abs Acc current segment ' 0x00000514 Read DXD group REAL64 e.g. mm ± ∞ Position error on the Symbolic path in tangential access: direction (signed to 'Path Diff Tangen indicate leading and tial' lagging) 0x00000515 Read DXD group REAL64 e.g. mm ≥ 0 Position error on the Symbolic path in orthogonal access:'Path Diff direction Orthogonal' 0x00000520 Read DXD group REAL64 1 ≥ 0 Covered arc length of the current segment, normalized to 1.0 0x00000521 Read DXD group REAL64 1 0/1 Change of partial segment (radius of tolerance ball) 0x00000522 Read DXD group REAL64 1 ≥ 0 Total remaining path length to the last geometry entry or the next accurate stop. Refers to group parameter 0x508. 0x00000523 Read DXD group REAL64 1 ≥ 0 Programmed velocity of the current segment 0x00000524 Read DXD group REAL64 e.g. mm ≥ 0 Path distance (arc from TC 3.1 length) travelled since B4022.31 the program start from TC 3.1 B4024.0 0x00000530 Read DXD group { Current or last MCS- target position of the main axes X, Y and Z REAL64 e.g. mm ± ∞ Target position X-axis REAL64 e.g. mm ± ∞ Target position Y-axis REAL64 e.g. mm ± ∞ Target position Z-axis } 0x00000531 Read DXD group { Current or last MCS- target position of the auxiliary axes Q1 to Q5 REAL64[5] e.g. mm ± ∞ Target position of axis Q1 to Q5 } 60 Version: 1.3.1 Twin CAT 3
## Page 61

Target systems Index offset Access Group type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000532 Read DXD group { Reads path length, H not generally parameter and Entry released ID of the next 11 segments in relation to the current DC time UINT32 DC Time UINT32 Reserved Pre View Tab[11] 11*24 Bytes } Pre View Tab { REAL64 e.g. mm Segment length UINT32 1 block number UINT32 1 H-Parmeter UINT32 1 Entry ID UINT32 1 Reserved } 0x0000054n Read DXD group REAL64 1 0/1 Within the tolerance ball of the auxiliary axis n = 1..5 Number of the auxiliary axis (not axis ID) 0x00000546 Read DXD group REAL64[8] e.g. mm ± ∞ Set position array of from TC3.1 the (3+5) axes of the B4022.17 3D group 0x00000547 Read DXD group REAL64[8] e.g. mm ± ∞ Actual position array from TC3.1 of the (3+5) axes of B4022.17 the 3D group 0x00000548 Read DXD group REAL64[8] e.g. mm ± ∞ Position difference from TC3.1 (set/actual) or lag error B4022.17 as array of the (3+5) axes of the 3D group 0x00000550 Read DXD group { Reads the axis IDs within a 3D group: UINT32 1 [0, 1...255] X axis ID UINT32 1 [0, 1...255] Y axis ID UINT32 1 [0, 1...255] Z axis ID } 0x00000552 Read DXD group { UINT32[m] 1 [0, 1...255] Axis allocation of the FIFO group } group: Kinematic 1st axis ID – mth axis group ID m: Dimension of the 3D group with main and auxiliary axes (X, Y, Z, Q1, Q2, Q3, Q4, Q5) or the FIFO group or the ACS axes of the kinematic group 0x00000553 Read Kinematic { Reading the axis group allocation (ID's) inside the kinematic group: UINT32[8] 1 [0, 1...255] MCS axis IDs (machine coordinate system) UINT32[8] 1 [0, 1...255] ACS axis IDs (axis coordinate system) UINT32 1 ≥ 0 Reserve UINT32 1 ≥ 0 Reserve (NEW) } Twin CAT 3 Version: 1.3.1 61
## Page 62

Target systems Index offset Access Group type Data type Phys. Definition Description Note ( Hex ) unit range 0x0000056n Read DXD group REAL64 1 ± ∞ Current position error of the auxiliary axis within the tolerance ball (set value side only) Only for auxiliary axes n = 1..5 Number of the auxiliary axis (not axis ID) 62 Version: 1.3.1 Twin CAT 3
## Page 63

Target systems 3.2.1.5.4.3.3 "Index offset" specification for group functions (Index group 0x3200 + ID) Twin CAT 3 Version: 1.3.1 63
## Page 64

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000001 Write every VOID Reset group 0x00000002 Write every VOID Stop group 0x00000003 Write every VOID Clear group (buffer/ task) 0x00000004 Write PTP group, 3D { Emergency stop (E- group stop) (emergency stop with controlled ramp) REAL64 e.g. mm/ ≥ 0.0 Deceleration (must be s^2 greater than or equal to the original deceleration) REAL64 e.g. mm/ ≥ 0.0 Jerk (must greater s^3 than or equal to the original jerk) } 0x00000005 Write PTP group { Parameterizable stop Reserved (with controlled ramp) function, no standard! REAL64 e.g. mm/ ≥ 0.0 Deceleration s^2 REAL64 e.g. mm/ ≥ 0.0 Jerk s^3 } 0x00000006 Write PTP group, 3D VOID "Step on" after group Emergency Stop (E- Stop) 0x00000050 Write PTP group, 3D { Axis allocation of the group group: UINT32 1 [0, 1...255] X axis ID UINT32 1 [0, 1...255] Y axis ID UINT32 1 [0, 1...255] Z axis ID } 0x00000051 Write PTP group, 3D { axis allocation of the group group: FIFO group UINT32 1 [1...255] Axis ID UINT32 1 [0 ... (m-1)] Place index of the axis in the group m: group dimension (PTP: 1;DXD: 3, FIFO: 16) } 0x00000052 Write 3D group FIFO { UINT32[m] 1 [0, 1...255] Axis allocation of the group } group: First axis ID, ... , m. axis ID m: dimension of the 3D group (X, Y, Z, Q1, Q2, Q3, Q4, Q5) resp. FIFO group 0x00000053 Write 3D group VOID Delete the 3D axis FIFO group allocation, FIFO axis Kinematic allocation or Kinematic group axis allocation and return of the axes to their own PTP groups 0x00000054 Write Kinematic { Axis allocation of the group kinematic group: UINT32[8] 1 [0, 1...255] MCS axis IDs (Machine Coordinate System) UINT32[8] 1 [0, 1...255] ACS axis IDs (Axis Coordinate System) UINT32 1 ≥ 0 Reserved UINT32 1 ≥ 0 Reserved (NEW) } 64 Version: 1.3.1 Twin CAT 3
## Page 65

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000060 Read Write 3D group 1 Internal "feed group" Execute command ("Feeder") command! 0x00000061 Read Write 3D group 1 Internal "feed group" Execute command ("Feeder") command! 0x00000110 Write 1D group VOID Reference 1D group ("calibration") 0x00000111 Write 1D group { New end position 1D group UINT32 ENUM s. appendix End position type [} 163] (s. appendix) REAL64 e.g. mm ±∞ New end position (target position) } 0x0000011A Write 1D group { Set actual position 1D Caution by group using! Always to SAF Port UINT32 ENUM s. appendix Actual position type 501! [} 163] (s. appendix) REAL64 e.g. mm ±∞ Actual position for axis } 0x0000011B Write 1D group UINT32 1 0/1 Set reference flag Caution by ("calibrate flag") using! 0x00000120 Write 1D group { Start 1D group (standard start): UINT32 ENUM s. appendix Start type [} 162] (s. appendix) REAL64 e.g. mm ±∞ End position (target position) REAL64 mm/s ≥ 0.0 Required velocity } 0x00000121 Write 1D group { Start 1D group (SERVO) (extended start): UINT32 ENUM s. appendix Start type [} 162] (s. appendix) REAL64 e.g.mm ±∞ End position (target position) REAL64 mm/s ≥0.0 Required velocity UINT32 1 0/1 Standard acceleration? REAL64 mm/s^2 ≥ 0.0 Acceleration UINT32 1 0/1 Standard deceleration? REAL64 mm/s^2 ≥ 0.0 Deceleration UINT32 1 0/1 Standard jerk? REAL64 mm/s^3 ≥ 0.0 Jerk } Twin CAT 3 Version: 1.3.1 65
## Page 66

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000122 Write 1D group (MW { Start 1D group Reserved start servo) (special start): function, no standard! UINT32 ENUM s. appendix Start type [} 162] (s. appendix) REAL64 e.g. mm ±∞ End position (target position) REAL64 mm/s ≥0.0 required start velocity REAL64 e.g. mm ±∞ Position for a new velocity level REAL64 mm/s ≥0.0 new end velocity level UINT32 1 0/1 Standard acceleration? REAL64 mm/s^2 ≥0.0 Acceleration UINT32 1 0/1 Standard deceleration? REAL64 mm/s^2 ≥0.0 deceleration UINT32 1 0/1 Standard jerk? REAL64 mm/s^3 ≥0.0 Jerk } 0x00000126 Write 1D group { Start drive output: UINT32 ENUM s. appendix Output type [} 170] (s. appendix) REAL64 e.g. % ±∞ Required output value (e.g. %) } 0x00000127 Write 1D group VOID Stop drive output 0x00000128 Write 1D group { Change the drive output: UINT32 ENUM s. appendix Output type [} 170] (s. appendix) REAL64 e.g. % ±∞ Required output value (e.g. %) } 0x00000130 Write 1D group { 1D section (SERVO) compensation (SERVO): UINT32 ENUM s. appendix Compensation type [} 163] (s. appendix) REAL64 mm/s/s ≥ 0.0 Max. acceleration increase REAL64 mm/s/s ≥ 0.0 Max. deceleration increase REAL64 mm/s ≥ 0.0 Max. increase velocity REAL64 mm/s ≥ 0.0 Base velocity for the process REAL64 e.g. mm ±∞ Path difference to be compensated REAL64 e.g. mm ≥ 0.0 Path distance for compensation } 0x00000131 Write 1D group VOID Stop section SERVO compensation (SERVO) 66 Version: 1.3.1 Twin CAT 3
## Page 67

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000140 Write Master/Slave { Master/slave coupling Extension for (0x00n00140) coupling: 1D (SERVO): "flying saw"! group(SERVO) angle >0.0 and UINT32 ENUM s. appendix Slave type/coupling <= 90.0 type [} 164] (s. degrees(paralle appendix) l saw: 90.0 UINT32 1 [1...255] Axis ID of the master degrees) axis/group UINT32 1 [0...8] Subindex n of the master axis (default value: 0) UINT32 1 [0...8] Subindex n of the slave axis (default value: 0) REAL64 1 [±1000000.0] Parameter 1: linear: Gearing factor Fly Saw Velo: Reserve Fly Saw: Abs. synchronous position master [mm] REAL64 1 [±1000000.0] Parameter 2: linear: Reserve Fly Saw Velo: Reserve Fly Saw Pos: Abs. synchronous position slave [mm] REAL64 1 [±1000000.0] Parameter 3: linear: Reserve Fly Saw Velo: Angle of inclination in [DEGREE] Fly Saw Pos: angle of inclination in [DEGREE] REAL64 1 [±1000000.0] Parameter 4: linear: Reserve Fly Saw Velo: Gearing factor Fly Saw Pos: Gearing factor } 0x00000141 Write Master/Slave VOID Master/slave decoupling: 1D decoupling (SERVO) group(SERVO) 0x00000142 Write Master / slave { Change of the parameter 1D coupling parameters group(servo) (SERVO): REAL64 1 [±1000000.0] Parameter 1: linear: Gearing factor REAL64 1 [±1000000.0] Parameter 2: Linear: Reserve REAL64 1 [±1000000.0] Parameter 3: Linear: Reserve REAL64 1 [±1000000.0] Parameter 4: Linear: Reserve } 0x00000144 Write Slave stop 1D VOID Stop the "flying saw" Only for "flying group (SERVO) (SERVO) saw" 0x00000149 Write Slave tables 1D REAL64 1 ±∞ set the slave table Only for Solo group (SERVO) scaling of a solo table table slave coupling (SERVO) 0x00000150 Write 1D group VOID Deactivate complete 1D group/axis (disable) Twin CAT 3 Version: 1.3.1 67
## Page 68

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000151 Write 1D group VOID Activate complete 1D group / axis (enable) 0x00000160 Write 1D group VOID Deactivate drive output of the 1D group (disable) 0x00000161 Write 1D group VOID Activate drive output of the 1D group (enable) 0x00000362 Write High/low speed UINT16 1 0/1 Release parking group brake? 0: automatic activation (default) 1: mandatorily always released! 0x00000701 Write FIFO group VOID Start FIFO group (n*m)-FIFO (FIFO table must have been filled in advance) 0x00000710 Write FIFO group { REAL64[x*m]} e.g. mm ±∞ Write x FIFO entries Only possible (lines): on a line-by-line basis! (integer (x*m)-values (one or multiple) more lines) n: FIFO length (number of lines) m: FIFO dimension (number of columns) range of values x: [1 ... n] 0x00000711 Write FIFO group { REAL64[x*m]} e.g. mm ±∞ Overwrite the last x Only possible FIFO entries (lines): on a line-by-line basis! (integer (x*m)-values (one or multiple) more lines) n: FIFO length (number of lines) m: FIFO dimension (number of columns) range of values x: [1 ... n] 0x00000801 Write Kinematic VOID Start kinematic group Reserved group function, no standard! 68 Version: 1.3.1 Twin CAT 3
## Page 69

Target systems 3.2.1.5.4.4 Specification Axes 3.2.1.5.4.4.1 "Index offset" specification for axis parameter (Index group 0x4000 + ID) Twin CAT 3 Version: 1.3.1 69
## Page 70

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n00000 Read every { General AXIS Modified from (Structure for all PARAMETER TC3 axis STRUCTURE (NC/ parameters) CNC), also contains the sub- elements such as encoder, controller and drive (s. MC_Read Parameter S et in Tc Mc2.lib) Note: Size and alignment changed. UINT32 1 Axis ID STRING[30+1] 1 Axis name UINT32 1 ENUM Axis type [} 161] . . . . . . . . . . . . } 1024 bytes (instead of 512 bytes) 0x00000001 Read every UINT32 1 Axis ID 0x00000002 Read every STRING[30+1] 1 Axis name Any number of characters from UINT8[. . .] TC3.1 Build 4022.32 or 4024.6 0x00000003 Read every UINT32 1 ENUM Axis type [} 161] 0x00000004 Read every UINT32 µs Cycle time axis (SEC) 0x00000005 Read every STRING[10+1] 1 Physical unit 0x00000006 Read/Write every REAL64 e.g. mm/ Ref. velocity in cam s direction 0x00000007 Read/Write every REAL64 e.g. mm/ Ref. velocity in sync s direction 0x00000008 Read/Write every REAL64 e.g. mm/ Velocity hand slow s 0x00000009 Read/Write every REAL64 e.g. mm/ Velocity hand fast s 0x0000000A Read/Write every REAL64 e.g. mm/ [0.0...1.0E20] Velocity rapid traverse s 0x0000000F Read/Write every UINT16 1 0/1 Position range monitoring? 0x00000010 Read/Write every REAL64 e.g. mm [0.0...1.0E6] Position range window 0x00000011 Read/Write every UINT16 1 0/1 Motion monitoring? 0x00000012 Read/Write every REAL64 s [0.0...600] Motion monitoring time 0x00000013 Read/Write every UINT16 1 0/1 Loop? 0x00000014 Read/Write every REAL64 e.g. mm Looping distance (±) 0x00000015 Read/Write every UINT16 1 0/1 Target position monitoring? 0x00000016 Read/Write every REAL64 e.g. mm [0.0...1.0E6] Target position window 0x00000017 Read/Write every REAL64 s [0.0...600] Target position monitoring time 0x00000018 Read/Write every REAL64 e.g. mm Pulse way in pos. direction 0x00000019 Read/Write every REAL64 e.g. mm Pulse way in neg. direction 0x0000001A Read/Write every UINT32 1 ENUM (≥0) Error reaction mode: 0: instantaneous (default) 1: delayed (e.g. for Master/Slave- coupling) 0x0000001B Read/Write every REAL64 s [0...1000] Error delay time (if delayed error reaction is selected) 70 Version: 1.3.1 Twin CAT 3
## Page 71

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x0000001C Read/Write every UINT16 1 0/1 Couple slaves via actual values if not ready to operate? 0x0000001D Read/Write every REAL64 e.g. mm/ [0, Acceleration for fading s^2 0.01...1.0E10] profile when switching from set to actual values: Default: 0 (in this case the minimum from the axis acceleration is used, i.e. MIN(Acc, Dec)) 0x0000001E Read/Write every UINT32 1 ENUM (≥0) Fast Axis Stop Signal Type: Selection of the signal type that triggers a fast axis stop (see bit 7 in Drive->n Status4) "0 (Signal Type_OFF)", "1 (Signal Type_Rising Ed ge)","2 (Signal Type_Falling Ed ge)","3 (Signal Type_Both Edg es)","4 (Signal Type_High Activ e)","5 (Signal Type_Low Activ e)" 0x00000020 Read/Write every UINT16 1 0/1 Allow motion commands for slave axis? Default: FALSE 0x00000021 Read/Write every UINT16 1 0/1 Allow motion commands for axes with active external setpoint generator? Default: FALSE 0x00000026 Read/Write every UINT32 1 Interpretation of the See encoder! units (position, Bit array velocity, time) Bit 0: Velocity in x/min instead of x/s Bit 1: Position in thousandths of the base unit Bit 2: Modulo position display 0x00000027 Read/Write every REAL64 e.g. mm/ [>0...1.0E20] Max. allowed velocity s 0x00000028 Read/Write every REAL64 e.g. mm [0.0...1.0E6] Motion monitoring window 0x00000029 Read/Write every UINT16 1 0/1 PEH time monitoring? Position end and accurate stop 0x0000002A Read/Write every REAL64 s [0.0...600] PEH monitoring time 0x0000002C Read/Write every REAL64 e.g. mm [-1000.0 Backlash ...1000.0] 0x00000030 Read every UINT16 1 [0,1] Persistent data e.g. for Boot actual position and parameters, reference state of the cannot be encoder? changed online. Twin CAT 3 Version: 1.3.1 71
## Page 72

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00000031 Read every { Read the hardware AMS address UINT8[6] Ams Net Id (AMS Net ID UINT16 Ams Port No and AMS Port UINT16 Channel No No) and the Ether CAT } 10 bytes channel number (communication channel 0,1,2,3…) 0x00000031 Read every { Read the hardware AMS address UINT8[6] Ams Net Id (AMS Net ID UINT16 Ams Port No and devices UINT16 Channel No AMS Port No) and the Ether CAT UINT16 reserved channel UINT32 1 [0, 1...255] NC Drive ID number (communication UINT32 1 NC Drive index channel UINT32 1 Enum NC Drive type [} 170] 0,1,2,3…) UINT32 1 [0, 1...255] NC Encoder ID Supplemented UINT32 1 NC Encoder index by additional NC information UINT32 1 Enum NC Encoder type such as NC [} 166] Drive ID, NC UINT32 1 [0, 1...255] NC Axis ID Drive type, etc.. UINT32 1 Enum NC Axis type [} 161] UINT32 1 Twin CAT Drive NEW from TC3 Object Id Drive Object Id UINT32 1 Twin CAT Encoder and Encoder Object Id Object Id from UINT32[3] reserved NC build 4437 } 64 bytes 0x00000033 Read every { General APPLICATION REQUEST STRUCTURE UINT16 1 0/1 Appl Request Bit (NC/NCI), UINT16 1 0: NONE Appl Request Type e.g. for (IDLE) Application Hom 1: HOMING ing request (see UINT32 Appl Cmd No MC_Read Appli (not implemented) cation Request UINT32 1 ≥0 Appl Cmd Version in Tc Mc2.lib) … Changed in } 1024 bytes TC3 0x00000051 Read Channel: every UINT32 Channel ID 0x00000052 Read Channel: every STRING[30+1] Channel name 0x00000053 Read Channel: every UINT32 1 ENUM Channel type [} 160] 0x00000054 Read Group: every UINT32 Group ID 0x00000055 Read Group: every STRING[30+1] Group name 0x00000056 Read Group: every UINT32 1 ENUM Group type [} 161] 0x00000057 Read every UINT32 Number of encoders 0x00000058 Read every UINT32 Number of controllers 0x00000059 Read every UINT32 Number of drives 72 Version: 1.3.1 Twin CAT 3
## Page 73

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x0000005A Read every { Read all sub-elements of an axis: UINT32[ 9 ] 1 [0, 1...255] Axis encoder IDs UINT32[ 9 ] 1 [0, 1...255] Axis controller IDs UINT32[ 9 ] 1 [0, 1...255] Axis drive IDs } 108 bytes 0x000000F1 Read/Write every REAL64 e.g. mm/ Default: 1.0E5 Maximum permitted NEW from TC s^2 acceleration 3.2 0x000000F2 Read/Write every REAL64 e.g. mm/ Default: 1.0E6 Maximum permitted NEW from TC s^2 deceleration 3.2 0x00000101 Read/Write Servo REAL64 e.g. mm/ [0.01...1.0E20] Acceleration (default s^2 data set) 0x00000102 Read/Write Servo REAL64 e.g. mm/ [0.01...1.0E20] Deceleration (default s^2 data set) 0x00000103 Read/Write Servo REAL64 e.g. mm/ [0.1...1.0E30] Jerk (default data set) s^3 0x00000104 Read/Write Servo REAL64 s [0.0 ... 1.0] Deceleration time Default: 0.0 s between velocity and position values of the setpoint generator in seconds 0x00000105 Read/Write Servo UINT32 1 ENUM Override type [} 162] Default: type 1 for velocity: 1: Related to internal reduced velocity (without iteration) 2: Related to original external start velocity (without iteration) 3: Related to internal reduced velocity (optimization by means of iteration) 4: Related to original external start velocity (optimization by means of iteration) 0x00000106 Read/Write Servo REAL64 1 [0.0 ... 1.0E6] Maximum permitted Default: 0.0 step change in velocity for dynamic reduction DV = factor *min(A+, A-) * DT 0x00000107 Read/Write Servo UINT16 1 [0.1] Activates acceleration Default: 1 and jerk limitation for the auxiliary axis (Q1 to Q5) Read/Write Servo REAL64 e.g. mm [0.0..1000.0] Radius of the tolerance sphere for the auxiliary axes Read/Write Servo REAL64 e.g. mm [0.0..10000.0] Maximum allowed position deviation if the tolerance sphere is reduced Only for auxiliary axes 0x0000010A Read/Write Servo REAL64 e.g. mm/ [0.01 ... 1.0E20] Fast Axis Stop: s^2 Acceleration (s.a. Fast Axis Stop Signal Type) 0x0000010B Read/Write Servo REAL64 e.g. mm/ [0.01 ... 1.0E20] Fast Axis Stop: s^2 Deceleration (s.a. Fast Axis Stop Signal Type) Twin CAT 3 Version: 1.3.1 73
## Page 74

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x0000010C Read/Write Servo REAL64 e.g. mm/ [0.1 ... 1.0E30] Fast Axis Stop: Jerk s^3 (s.a. Fast Axis Stop Signal Type) 0x0000010D Read/Write Servo UINT32 1 Index offset of the axis state that is passed in the cyclic interface as "User Data". 0x00000000: deactivated 0x00010012: Encoder position with position bias voltage (without position correction and without dead time compensation) 0x00010014: Drive Act Velo 0x00010017: MC_Set Position offsets 0x00000201 Read/Write Stepper motor UINT32 1 ENUM Operation mode stepper motor 0x00000202 Read/Write Stepper motor REAL64 e.g. mm/ [1.0E-6 ... Distance scaling of a STEP 1000.0] motor step 0x00000203 Read/Write Stepper motor REAL64 e.g. mm/ [0.0 ... 1000.0] Minimum velocity for s velocity profile 0x00000204 Read/Write Stepper motor UINT32 1 [0 ... 100] Number of steps per frequency/velocity step 0x00000205 Read/Write Stepper motor UINT32 1 Motor mask as sync Not pulse implemented! 0x00000301 Read/Write high/low REAL64 e.g. mm [0.0 ... Creep distance in pos. 100000.0] direction 0x00000302 Read/Write high/low REAL64 e.g. mm [0.0 ... Creep distance in neg. 100000.0] direction 0x00000303 Read/Write high/low REAL64 e.g. mm [0.0 ... Braking distance in 100000.0] pos. direction 0x00000304 Read/Write high/low REAL64 e.g. mm [0.0 ... Braking distance in 100000.0] neg. direction 0x00000305 Read/Write high/low REAL64 s [0.0 ... 60.0] Braking deceleration in pos. direction 0x00000306 Read/Write high/low REAL64 s [0.0 ... 60.0] Braking deceleration in neg. direction 0x00000307 Read/Write high/low REAL64 s [0.0 ... 60.0] Switching time from high to low velocity 0x00000308 Read/Write high/low REAL64 e.g. mm [0.0 ... Creep distance stop 100000.0] 0x00000309 Read/Write high/low REAL64 s [0.0 ... 60.0] Delay time to release brake 0x0000030A Read/Write high/low REAL64 s [0.0 ... 60.0] Pulse time in pos. direction 0x0000030B Read/Write high/low REAL64 s [0.0 ... 60.0] Pulse time in neg. direction ENCODER 0x00n10001 Read Encoder: every UINT32 1 [1 ... 255] Encoder ID n = 0: standard encoder of the axes > 0: nth encoder of the axis (optional) 0x00n10002 Read Encoder: every STRING[30+1] 1 30 characters Encoder name 0x00n10003 Read Encoder: every UINT32 1 ENUM (>0) Encoder type [} 166] 0x00n10004 Read/Write Encoder: every UINT32 1 Byteoffset Input address offset (I/ Change I/O O-Input-Image) address 74 Version: 1.3.1 Twin CAT 3
## Page 75

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n10005 Read/Write Encoder: every UINT32 1 Byteoffset Output address offset Change I/O (I/O-Output-Image) address 0x00n10006 Read/Write Encoder: every REAL64 e.g. mm/ [1.0E-12 ... Resulting scaling Writing is not INC 1.0E+30] factor (numerator / allowed if the denominator) controller enable has Note: from TC3 the been issued. scaling factor consists of two components – numerator and denominator (default: 1.0). 0x00n10007 Read/Write Encoder: every REAL64 e.g. mm [±1.0E+9] Position offset Writing is not allowed if the controller enable has been issued. 0x00n10008 Read/Write Encoder: every UINT16 1 [0,1] Encoder count Writing is not direction allowed if the controller enable has been issued. 0x00n10009 Read/Write Encoder: every REAL64 e.g. mm [0.001 ... Modulo factor 1.0E+9] 0x00n1000A Read/Write Encoder: every UINT32 1 s. ENUM (>0) Encoder mode [} 167] 0x00n1000B Read/Write Encoder: every UINT16 1 0/1 Soft end min. monitoring? 0x00n1000C Read/Write Encoder: every UINT16 1 0/1 Soft end max. monitoring? 0x00n1000D Read/Write Encoder: every REAL64 mm Soft end position min. 0x00n1000E Read/Write Encoder: every REAL64 mm Soft end position max. 0x00n1000F Read/Write Encoder: every UINT32 1 s. ENUM (≥0) Encoder evaluation in the appendix direction [} 167] (enable for log. counting direction) 0x00n10010 Read/Write Encoder: every REAL64 s [0.0...60.0] Filter time for actual position value in seconds (P-T1) 0x00n10011 Read/Write Encoder: every REAL64 s [0.0...60.0] Filter time for actual velocity value in seconds (P-T1) 0x00n10012 Read/Write Encoder: every REAL64 s [0.0...60.0] Filter time for actual acceleration value in seconds (P-T1) 0x00n10013 Read/Write Encoder: every STRING[10+1] 1 Physical unit Not implemented! 0x00n10014 Read/Write Encoder: every UINT32 1 Interpretation of the Not units (position, implemented! velocity, time) Bit array Bit 0: Velocity in x/min instead of x/s Bit 1: Position in thousandths of the base unit 0x00n10015 Read Encoder: every UINT32 INC [0x0... Encoder mask Read-only 0x FFFFFFFF] (maximum value of the parameter encoder actual value see also in increments "Encoder Sub Note: The encoder Mask" mask may be any parameter numerical value (e.g. 3600000). Unlike in the past, it no longer has to correspond to a continuous series off binary one's (2n-1). Twin CAT 3 Version: 1.3.1 75
## Page 76

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n10016 Read/Write Encoder: every UINT16 1 0/1 Actual position correction (measurement system error correction)? 0x00n10017 Read/Write Encoder: every REAL64 s [0.0...60.0] Filter time for actual position correction in seconds (P-T1) 0x00n10019 Read/Write Encoder: every UINT32 1 ENUM (>0) Encoder absolute Writing is not dimensioning system allowed if the controller [} 167] enable has been issued. 0x00n1001A Read Encoder: every UINT32 1 ENUM (>0) Encoder position Not initialization implemented! 0x00n1001B Read/Write Encoder: every REAL64 e.g. mm [≥0, modulo Tolerance window for factor/2] modulo-start 0x00n1001C Read Encoder: every UINT32 1 ENUM (>0) Encoder sign interpretation [} 167] (data type) 0x00n1001D Read Encoder: every UINT16 1 0/1 Incremental or absolute encoder ? 0: Incremental encoder type 1: Absolute encoder type 0x00n10023 Read/Write Encoder: every REAL64 e.g. mm/ [1.0E-12 ... Component of the NEW from TC3 INC 1.0E+30] scaling factor: Writing is not numerator allowed if the (=> scaling factor controller numerator / scaling enable has factor denominator) been issued. 0x00n10024 Read/Write Encoder: every REAL64 1 [1.0E-12 ... Component of the NEW from TC3 1.0E+30] scaling factor: Writing is not denominator allowed if the (=> scaling factor controller numerator / scaling enable has factor denominator) been issued. Default: 1.0 0x00n10025 Read/Write Encoder: every { e.g. mm/ [1.0E-12 ... Component of the NEW from TC3 REAL64 INC 1.0E+30] scaling factor: REAL64 1 [1.0E-12 ... numerator } 1.0E+30] Component of the scaling factor: denominator (=> scaling factor numerator / scaling factor denominator) 0x00n10030 Read/Write Encoder: every UINT32 1 Internal encoder NEW from TC3 control double word for specifying the operation modes and properties 0x00n10101 Read/Write E: INC UINT16 1 [0,1] Inverse search direction for ref.cam? 0x00n10102 Read/Write E: INC UINT16 1 [0,1] inverse search direction for sync pulse? 0x00n10103 Read/Write E: INC REAL64 e.g. mm [±1000000.0] Reference position 0x00n10104 Read/Write E: INC UINT16 1 [0,1] Distance monitoring Not between Ref. cams implemented! and sync pulse active? 0x00n10105 Read/Write E: INC UINT32 INC [0 ... 65536] Minimum gap between Not Ref. cams and sync implemented! pulse in increments 0x00n10106 Read/Write E: INC UINT16 1 [0,1] External sync pulse? 76 Version: 1.3.1 Twin CAT 3
## Page 77

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n10107 Read/Write E: INC UINT32 1 s. ENUM (>0) Reference mode [} 168] 0x00n10108 Read/Write E: INC UINT32 1 [0x0000000F... Encoder Sub Mask see also 0x FFFFFFFF]bi (maximum value of the "Encoder Mask" nary mask: (2n - absolute range of the parameter 1) encoder actual value in increments) Used, for example, as a reference mark for the referencing mode "Software Sync" and for the NC Retain Data "ABSOLUTE (MODULO)", "INCREMENTAL (SINGLETURN ABSOLUTE)". Note 1: The Encoder Sub Mask must be smaller than or equal to the Encoder Mask. Note 2: The Encoder Mask must be an integer multiple of the Encoder Sub Mask. Note 3: The Encoder Sub Mask must be a continuous sequence of binary ones (2n-1), e.g. 0x000FFFFF. 0x00n10110 Read/Write E: INC REAL64 1 [0.0 ... Scaling/weight of the (encoder 1000000.0] noise part for the simulation) simulation encoder CONTROLLER 0x00n20001 Read Controller: UINT32 1 [1 ... 255] Controller ID every n = 0: standard controller of the axes > 0: nth controller of the axis (optional) 0x00n20002 Read Controller: STRING[30+1] 1 30 characters Controller name every 0x00n20003 Read Controller: UINT32 1 ENUM (>0) Controller type [} 165] every 0x00n2000A Read/Write Controller: 1 ENUM (>0) Controller mode every 0x00n2000B Read/Write Controller: REAL64 % [0.0 ... 1.0] Weighting of the every velocity pre-control (default value: 1.0 = 100 %) 0x00n20010 Read/Write Controller: UINT16 1 0/1 Position lag monitoring every Pos.? 0x00n20011 Read/Write Controller: UINT16 1 0/1 Position lag monitoring every Velocity? 0x00n20012 Read/Write Controller: REAL64 e.g. mm Max. lag error position every 0x00n20013 Read/Write Controller: REAL64 s Max. lag error filter every time position 0x00n20014 Read/Write Controller: REAL64 e.g. mm/ Max. lag error velocity every s 0x00n20015 Read/Write Controller: REAL64 s Max. lag error filter every time velocity Twin CAT 3 Version: 1.3.1 77
## Page 78

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n20100 Read/Write P/PID (pos., REAL64 1 [0.0...1.0] Maximum output (default value: (veloc.) limitation (±) for 0.5 == 50%) controller total output 0x00n20102 Read/Write P/PID (pos.) REAL64 e.g. mm/ [0.0...1000.0] Proportional gain kp or Position control s/ mm kv Unit: Base Unit / s / Base Unit 0x00n20103 Read/Write PID (pos.) REAL64 s [0.0 ... 60.0] Integral action time Tn Position control 0x00n20104 Read/Write PID (pos.) REAL64 s [0.0 ... 60.0] Derivative action time Position control Tv 0x00n20105 Read/Write PID (pos.) REAL64 s [0.0 ... 60.0] Damping time Td Position control 0x00n20106 Read/Write PP (Pos.) REAL64 e.g. mm/ [0.0...1000.0] Additional proportional Position control s/ mm gain, kp or kv respectively, that applies above a limiting velocity in percent. Unit: Base Unit / s / Base Unit 0x00n20107 Read/Write PP (Pos.) REAL64 % [0.0...1.0] Threshold velocity in percent above which the additional proportional gain, kp or kv respectively, applies 0x00n20108 Read/Write P/PID (Acc.) REAL64 s [0.0 ... 100.0] Proportional gain ka Acceleration pre-control 0x00n2010D Read/Write P/PID REAL64 mm [0.0 ... 10000.0] "Dead band" for Reserved position error (control function deviation) (for P/PID controllers with velocity or torque interface) 0x00n2010F Read/Write P/PP/PID (pos.) REAL64 (mm/s) / [0.0...1000.0] Slave coupling Slave coupling Slave control mm difference control: difference control Proportional gain k cp 0x00n20110 Read/Write P (Pos.) UINT16 1 0/1 Automatic offset calibration: active/ passive 0x00n20111 Read/Write P (Pos.) UINT16 1 0/1 Automatic offset calibration: hold mode 0x00n20112 Read/Write P (Pos.) UINT16 1 0/1 Automatic offset calibration: Fading mode 0x00n20114 Read/Write P (Pos.) REAL64 % [0.0 ... 1.0] Automatic offset calibration: Pre-control limit 0x00n20115 Read/Write P (Pos.) REAL64 s [0.1 ... 60.0] Automatic offset calibration: Time constant 0x00n20116 Read/Write PID (pos.) REAL64 % [0.0...1.0] Maximum output limitation (±) for I part in percent (default setting: 0.1 = 10%) 0x00n20117 Read/Write PID (pos.) REAL64 % [0.0...1.0] Maximum output limitation (±) for D part in percent (default setting: 0.1 = 10%) 0x00n20118 Read/Write PID (pos.) UINT16 1 0/1 Deactivation of the I part during an active positioning process (assuming I part active)? (Default setting: 0 = FALSE) 0x00n20120 Read/Write P/PID (pos.) REAL64 s ≥0 PT-1 filter value for Reserved position error (pos. function, control deviation) no standard! 78 Version: 1.3.1 Twin CAT 3
## Page 79

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n20202 Read/Write P/PID (velocity) REAL64 1 [0.0...1000.0] Proportional gain kp or Velocity control kv 0x00n20203 Read/Write PID (velocity) REAL64 s [0.0 ... 60.0] Integral action time Tn Velocity control 0x00n20204 Read/Write PID (velocity) REAL64 s [0.0 ... 60.0] Derivative action time Velocity control Tv 0x00n20205 Read/Write PID (velocity) REAL64 s [0.0 ... 60.0] Damping time Td Velocity control 0x00n20206 Read/Write PID (velocity) REAL64 % [0.0...1.0] Maximum output Velocity limitation (±) for I-part control in percent (default setting: 0.1 = 10%) 0x00n20207 Read/Write PID (velocity) REAL64 % [0.0...1.0] Maximum output Velocity control limitation (±) for D-part in percent (default setting: 0.1 = 10%) 0x00n2020D Read/Write P/PID (velocity) REAL64 mm/s [0.0 ... 10000.0] "Dead band" for Reserved velocity error (control function deviation) (for P/PID controllers with velocity or torque interface) 0x00n20220 Read/Write P/PID (velocity) REAL64 s ≥0 PT-2 filter value for Velocity control, velocity error (vel. not standard! control deviation) 0x00n20221 Read/Write P/PID (velocity) REAL64 s ≥0 PT-1 filter value for Reserved velocity error (vel. function, control deviation) no standard! 0x00n20250 Read/Write P/PI (observer) UINT32 1 ENUM (>0) Observer mode [} 165] for control in the torque interface 0: OFF (default) 1: LUENBERGER 0x00n20251 Read/Write P/PI (observer) REAL64 Nm / A >0.0 Motor: Torque constant K T 0x00n20252 Read/Write P/PI (observer) REAL64 kg m2 >0.0 Motor: Moment of inertia J M 0x00n20253 Read/Write P/PI (observer) REAL64 Hz [100.0 ... Bandwidth f 0 2000.0] Default: 500 0x00n20254 Read/Write P/PI (observer) REAL64 1 [0.0 ... 2.0] Correction factor k c Default: 1.0 0x00n20255 Read/Write P/PI (observer) REAL64 s [0.0 ... 0.01] Velocity filter (1st Default: 0.001 order): Time constant T 0x00n20A03 Read/Write P/PID (MW) REAL64 cm^2 [0.0 ... Cylinder area A of the Reserved A 1000000] A side in cm^2 parameters! 0x00n20A04 Read/Write P/PID (MW) REAL64 cm^2 [0.0 ... Cylinder area A of the Reserved B 1000000] B side in cm^2 parameters! 0x00n20A05 Read/Write P/PID (MW) REAL64 cm^3/s [0.0 ... Nominal volume flow Reserved 1000000] Q in cm^3/s parameters! nom 0x00n20A06 Read/Write P/PID (MW) REAL64 bar [0.0 ... Nominal pressure or Reserved 1000000] valve pressure drop, parameters! P in bar nom 0x00n20A07 Read/Write P/PID (MW) UINT32 1 [1 ... 255] Axis ID for the system Reserved pressure Po parameters! DRIVE: 0x00n30001 Read Drive: every UINT32 1 [1 ... 255] Drive ID 0x00n30002 Read Drive: every STRING[30+1] 1 30 characters Drive name 0x00n30003 Read Drive: every UINT32 1 ENUM (>0) Drive type [} 170] Twin CAT 3 Version: 1.3.1 79
## Page 80

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n30004 Read/Write Drive: every UINT32 1 Byteoffset Input address offset (I/ Change I/O O-Input-Image) address 0x00n30005 Read/Write Drive: every UINT32 1 Byteoffset Output address offset Change I/O (I/O-Output-Image) address 0x00n30006 Read/Write Drive: every UINT16 1 [0,1] Motor polarity Writing is not allowed if the controller enable has been issued. 0x00n3000A Read/Write Drive: every UINT32 1 ENUM (≥0) Drive mode 0x00n3000B Read/Write Drive: every REAL64 % [-1.0 ... 1.0] Minimum output limit (output limitation) (default setting: -1.0 = -100%) 0x00n3000C Read/Write Drive: every REAL64 % [-1.0 ... 1.0] Maximum output limit (output limitation) (default setting: 1.0 = 100%) 0x00n3000D Read Drive: every UINT32 INC Maximum number of output increments (output mask) 0x00n30010 Read/Write Drive: every UINT32 1 Internal Drive Control Reserved! double word to determine the drive operation modes 0x00n30011 Read/Write every UINT32 1 ≥ 5 Internal drive reset Reserved! counter (time in NC cycles for enable and reset) 0x00n30101 Read/Write D: Servo REAL64 e.g. mm/ >0.0 Reference velocity at s reference output (velocity pre-control) 0x00n30102 Read/Write D: Servo REAL64 % [0.0 ... 5.0] Reference output in percent (default setting: 1.0 = 100%) 0x00n30103 Read D: Servo REAL64 e.g. mm/ >0.0 Resulting velocity at s 100% output 0x00n30104 Read/Write D: Servo REAL64 e.g. mm/ ±∞ Velocity offset (DAC s offset) for drift calibration (offset calibration) of the axis 0x00n30105 Read/Write D: Servo REAL64 1 [0.0 ... Velocity scaling For (Sercos, Profi 100000000.0] (scaling factor to Sercos, Profi Drive, AX200x, respond to the weight Drive, AX200x, CANopen) in the drive) CANopen 0x00n30106 Read/Write D: Profi Drive UINT32 0.001 * ≥ 0 Profibus/Profi Drive Only for Profi DSC 1/s DSC: Position control Drive DSC gain Kpc 0x00n30107 Read/Write D: Profi Drive REAL64 1 ≥ 0.0 Profibus/Profi Drive Only for Profi DSC DSC: Scaling for Drive DSC calculation of 'XERR' (default: 1.0) 0x00n30109 Read/Write D: Servo REAL64 1 [0.0 ... Position scaling For Sercos, (Sercos, 100000000.0] (scaling factor to CANopen CANopen) respond to the weight in the drive) 0x00n3010A Read/Write D: Servo REAL64 1 [0.0 ... Acceleration scaling For (Sercos, Profi 100000000.0] (scaling factor to Sercos, Profi Drive, AX200x, respond to the weight Drive, AX200x, CANopen) in the drive) CANopen 0x00n3010B Read/Write D: Servo REAL64 1 [0.0 ... Torque scaling (rotary For (Sercos, Profi 100000000.0] motor) or force scaling Sercos, Profi Drive, AX200x, (linear motor) (scaling Drive, AX200x, CANopen) factor for reacting to CANopen weighting in the drive) for "Torque Offset" (additive moment as pre-control) 80 Version: 1.3.1 Twin CAT 3
## Page 81

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n3010C Read/Write D: Servo REAL64 1 [0.0 ... Torque scaling (rotary For (Sercos, Profi 100000000.0] motor) or force scaling Sercos, Profi Drive, AX200x, (linear motor) (scaling Drive, AX200x, CANopen) factor for reacting to CANopen weighting in the drive) From TC3.1 for "Set Torque" B4024.2 (e.g. MC_Torque Control) with Drive Op Mode CST) 0x00n30120 Read/Write D: servo/ UINT32 1 ≥ 0 Table ID Only for hydraulics/ KL4xxx, (0: no table) M2400, Universal 0x00n30121 Read/Write D: servo/ UINT32 1 ≥ 0 Interpolation type Only for hydraulics KL4xxx, 0: linear M2400, 2: spline Universal 0x00n30122 Read/Write Servo/ REAL64 % [-1.0 ... 1.0] Output offset in Only for hydraulics percent KL4xxx, M2400, Note: Acts according Universal to the characteristic evaluation! 0x00n30151 Read/Write D: servo / non- REAL64 1 [0.0 ... 100.0] Quadrant linear compensation factor (relationship between quadrant I and III) 0x00n30152 Read/Write D: servo / non- REAL64 1 [0.01 ... 1.0] Velocity reference linear point in percent (1.0 = 100 %) 0x00n30153 Read/Write D: servo / non- REAL64 1 [0.01 ... 1.0] Output reference point linear in percent (1.0 = 100 %) 0x00030301 Read/Write D: Stepper UINT8 1 Bit mask: Cycle 1 motor 0x00030302 Read/Write D: Stepper UINT8 1 Bit mask: Cycle 2 motor 0x00030303 Read/Write D: Stepper UINT8 1 Bit mask: Cycle 3 motor 0x00030304 Read/Write D: Stepper UINT8 1 Bit mask: Cycle 4 motor 0x00030305 Read/Write D: Stepper UINT8 1 Bit mask: Cycle 5 motor 0x00030306 Read/Write D: Stepper UINT8 1 Bit mask: Cycle 6 motor 0x00030307 Read/Write D: Stepper UINT8 1 Bit mask: Cycle 7 motor 0x00030308 Read/Write D: Stepper UINT8 1 Bit mask: Cycle 8 motor 0x00030310 Read/Write D: Stepper UINT8 1 Bit mask: Holding motor current Twin CAT 3 Version: 1.3.1 81
## Page 82

Target systems 3.2.1.5.4.4.2 "Index offset" specification for axis state (Index group 0x4100 + ID) 82 Version: 1.3.1 Twin CAT 3
## Page 83

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n00000 Read every (online { AXIS ONLINE Changed from structure for STRUCTURE (NC/ Twin CAT 3, not axis data) CNC) oscilloscopeabl e! INT32 1 Error state (NCAXISSTAT INT32 Reserved E_ REAL64 e.g. mm Actual position ONLINESTRU CT) REAL64 e.g. Modulo actual position degrees REAL64 e.g. mm Set position REAL64 e.g. Modulo set position degrees REAL64 e.g. mm/ Optional: Actual s velocity REAL64 e.g. mm/ Set velocity s UINT32 % 0...1000000 Velocity override (1000000 == 100%) UINT32 Reserved REAL64 e.g. mm Lag error position REAL64 e.g. mm Peak Hold value for max. neg. position lag (pos.) REAL64 e.g. mm Peak hold value for max. pos. position lag (pos.) REAL64 % Controller output in percent REAL64 % Total output in percent UINT32 1 ≥ 0 Axis state double word UINT32 1 ≥ 0 Axis control double word UINT32 1 ≥ 0 Slave coupling state (state) UINT32 1 0; 1,2,3... Axis control loop index REAL64 e.g. mm/ Actual acceleration s^2 REAL64 e.g. mm/ Set acceleration s^2 REAL64 e.g. mm/ Set jerk (new from s^3 Twin CAT 3.1 B4013) REAL64 e.g. Set torque or set force 100% = ("Set Torque") 1000 REAL64 e.g. Actual torque or actual 100% = force (new from 1000 Twin CAT 3.1 B4013) REAL64 e.g. %/s Set torque change or set force change (time derivative of the set torque or set force) (from Twin CAT 3.1 B4024.2) REAL64 e.g. Additive set torque or 100% = additive set force 1000 ("Torque Offset") (from Twin CAT 3.1 B4024.2) . . . } 256 bytes 0x00000001 Read every UINT32 1 Axis state error code Symbolic access: "Err State'' 0x00n00009 Read every UINT32 1 ≥ 0 Set cycle counter (SAF timestamp) Twin CAT 3 Version: 1.3.1 83
## Page 84

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n0000A Read every REAL64 e.g. mm Set position Symbolic access: "Set Pos'' 0x00n0000B Read every REAL64 e.g. Modulo set position Symbolic DEGRE access: ES "Set Pos Modulo' ' 0x00n0000C Read every INT32 1 Modulo set rotation 0x00n0000D Read every REAL64 1 [-1.0, 0.0, 1.0] Set travel direction 0x00n0000E Read every REAL64 e.g. mm/ Set velocity Symbolic s access: "Set Velo'' 0x00n0000F Read every REAL64 e.g. mm/ Set acceleration Symbolic s^2 access: "Set Acc'' 0x00n00010 Read every REAL64 e.g. mm/ Set jerk (time Symbolic s^3 derivative of the set access: acceleration) "Set Jerk'' 0x00n00011 Read every REAL64 e.g. Nm Set torque (rot. motor) NEW from or N or Twin CAT 3.1 respectiv set force (linear motor) B4022 ely, ("Set Torque") Symbolic e.g. access: 100% = "Set Torque'' 1000 0x00n00012 Read every REAL64 1 Set coupling factor (set gear ratio) 0x00n00013 Read every REAL64 e.g. mm Expected target position 0x00n00014 Read Servo { Remaining travel time Always to SEC and distance Port 501! (SERVO): REAL64 s ≥ 0 Remaining travel time REAL64 e.g. mm ≥ 0 Remaining distance } 0x00n00015 Read every UINT32 1 ≥ 0 Set command number Symbolic access: "Cmd No'' 0x00n00016 Read Servo REAL64 s ≥ 0 Positioning time of the last motion command (start → target position window) 0x00n00017 Read Servo REAL64 % [0.0…1.0] Set override value for NEW from velocity Twin CAT 3.1 1.0=100% B4020 Note: initially only implemented for FIFO group 0x00000018 Read Write Servo Write Reading the "Stop Always to SEC information" (stop Port 501! distance, stop time) REAL64 e.g. mm/ ≥ 0 Deceleration for axis s^2 stop REAL64 e.g. mm/ ≥ 0 Jerk for axis stop s^3 Read REAL64 e.g. mm ≥ 0 Stop distance REAL64 s ≥ 0 Stop time 0x00n0001A Read every REAL64 e.g. mm Uncorrected set position 0x00n0001D Read every REAL64 1 [-1.0, 0.0, 1.0] Uncorrected set travel direction 0x00n0001E Read every REAL64 e.g. mm/ Uncorrected s set velocity 0x00n0001F Read every REAL64 e.g. mm/ Uncorrected s^2 set acceleration 84 Version: 1.3.1 Twin CAT 3
## Page 85

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00000020 Read every UINT32 1 s. ENUM Coupling state (state) 0x00000021 Read every UINT32 1 ≥ 0 Coupling table index 0x00000022 Read Servo master/ { Reading the coupling slave coupling parameters (SERVO): Type: LINEAR, REAL64 1 [±1000000.0] Parameter 1: Linear: (&SPECIAL) Gear ratio REAL64 1 [±1000000.0] Parameter 2: Linear: Reserve REAL64 1 [±1000000.0] Parameter 3: Linear: Reserve REAL64 1 [±1000000.0] Parameter 4: Linear: Reserve } 0x00000023 Read Servo master/ REAL64 1 [±1000000.0] Reading the gear ratio slave coupling (SERVO) Type: LINEAR, Type: LINEAR (&SPECIAL) 0x00000024 Read Servo UINT32 1 ≥ 0 Number / index of the active axis control circuit (triple of encoder, controller and axis interface) 0x00000025 Read Servo UINT16 1 0/1 External setpoint specification via axis interface PCLto NC active? 0x00000026 Read Servo master/ REAL64 [64] 1 ±∞ Reading of the Modified from slave coupling characteristic values of Twin CAT 3 the slave Type: synchronization profile SYNCHRONIZI NG Type: SYNCHRONIZING 0x00000027 Read Write Servo master/ Write Reading the "table Only port 500! slave coupling coupling information" Modified from Type: VOID e.g. mm ±∞ - No data for the Twin CAT 3 TABULAR, MF "current information" or - optional for a certain REAL64 "master axis position" or - for a certain table ID DWORD, and optional “master DWORD, axis position” (TC 3.1 REAL64 B4017) Read REAL64 [32] ±∞ Reading the structure for the table coupling information [} 173] 0x00000028 Read Write Servo master/ Write Reading the "multi- Only port 500! slave coupling table coupling information" Type: (Cam Addition) MULTICAM (Cam Addition) UINT32 1 ≥ 0 Table ID to which the query relates Read 96 bytes Reading the structure for the multi-table coupling information [} 173] 0x00000029 Read Servo UINT32 1 Delayed error code (error pre-warning) in case of a delayed error reaction (see bit Error Propagation Delay ed) Twin CAT 3 Version: 1.3.1 85
## Page 86

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x0000002A Read Servo REAL64 e.g. mm ±∞ Position difference while fading from set position to actual position (fading part) 0x0000002B Read Servo REAL64 e.g. mm/ ±∞ Relative velocity while s fading from set position to actual position (fading part) 0x0000002C Read Servo REAL64 e.g. mm/ ±∞ Relative acceleration s ^2 while fading from set position to actual position (fading part) 0x0000002D Read Servo UINT32 1 ≥ 0 Counter for NEW initialization command (Initialize Command Co unter) 0x0000002E Read Servo UINT32 1 ≥ 0 Counter for reset NEW command (Reset Command Coun ter) 0x00000030 Read Servo REAL64 e.g. Nm/ ±∞ Set torque change NEW from s or N/s (rot. motor) or Twin CAT 3.1 set force change B4024 (linear motor) (time derivative of the set torque or set force) 0x00000031 Read/Write Servo REAL64 e.g. Nm Additive set torque From or N (rot. motor) or Twin CAT 3.1 respectiv additive set force B4024.2 ely, (linear motor) for pre- Symbolic control. e.g. access: 100% = ("Torque Offset") "Torque Offset'' 1000 0x00000040 Read Servo UINT32 1 ≥ 0 Counter for correction NEW from of the NC setpoints in Twin CAT 3.1 case of data B4020 inconsistency (activation with Idx- Group 0x1000 and Idx-Offset 0x0020) 0x00000050 Read every UINT32 1 Set travel phase Cannot be (SWGenerator) traced by oscilloscope! 0x00000051 Read every UINT16 1 Is the axis disabled? Cannot be traced by oscilloscope! 0x00n00060 Read/Write every (online { Simple AXIS Cannot be setpoint SETPOINT traced by structure) STRUCTURE (NC/ oscilloscope! CNC) 40 bytes REAL64 e.g. mm Set position from TC 3.1 REAL64 e.g. mm/ Set velocity B4022.30 s REAL64 e.g. mm/ Set acceleration / s^2 deceleration REAL64 1 [-1.0, 0.0, 1.0] Set travel direction REAL64 e.g. mm/ Set jerk s^3 } 86 Version: 1.3.1 Twin CAT 3
## Page 87

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n00060 Read/Write every (online { Extended AXIS Cannot be setpoint SETPOINT traced by structure) STRUCTURE (NC/ oscilloscope! CNC) 56 bytes REAL64 e.g. mm Set position from TC 3.1 REAL64 e.g. mm/ Set velocity B4022.29 s REAL64 e.g. mm/ Set acceleration / s^2 deceleration REAL64 1 [-1.0, 0.0, 1.0] Set travel direction REAL64 e.g. mm/ Set jerk s^3 REAL64 Nm or N Set torque or set force or % REAL64 Nm/s or time derivative of the N/s or set torque or set force %/s (ramp) } 0x00n00061 Read/Write every (online { AXIS DYNAMIC from TC 3.1 dynamics SETPOINT B4022.30 setpoint STRUCTURE (NC/ structure) CNC) 32 bytes REAL64 e.g. mm/ Set velocity s REAL64 e.g. mm/ Set acceleration / s^2 deceleration REAL64 1 [-1.0, 0.0, 1.0] Set travel direction REAL64 e.g. mm/ Set jerk s^3 } 0x00n00061 Read/Write every (online { AXIS DYNAMIC from TC 3.1 dynamics SETPOINT B4022.29 setpoint STRUCTURE (NC/ structure) CNC) 48 bytes REAL64 e.g. mm/ Set velocity s REAL64 e.g. mm/ Set acceleration / s^2 deceleration REAL64 1 [-1.0, 0.0, 1.0] Set travel direction REAL64 e.g. mm/ Set jerk s^3 REAL64 Nm or N Set torque or set force or % REAL64 Nm/s or time derivative of the N/s or set torque or set force %/s (ramp) } 0x00n00062 Read/Write every (online { TORQUE SETPOINT from TC 3.1 TORQUE STRUCTURE (NC/ B4022.30 setpoint CNC) structure) REAL64 Nm or N Set torque or set force 16 bytes or % REAL64 Nm/s or time derivative of the N/s or set torque or set force %/s (ramp) } Twin CAT 3 Version: 1.3.1 87
## Page 88

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00000063 Read Write only for Write Read active "Drive NEW from TC SERCOS/So E Operation Mode" 3.1 B4022 (NC and CANopen/ 4443) UINT32 1 Reserve Co E UINT32 1 Reserve Always to SEC Port 501! Read INT32 ENUM [0; 1, 2, 3, …] Currently active "Drive [} 171] Special cases: Operation Mode" (generic modes) (see ≥ 100: So E appendi <0: Co E x) UINT32 1 Reserve 0x00n10002 Read every (Encoder) REAL64 e.g. mm Actual position (charge Symbolic with actual position access: compensation value) "Act Pos'' n = 0: standard encoder of the axes > 0: nth encoder of the axis (optional) 0x00n10003 Read every (Encoder) REAL64 e.g. Modulo actual position Symbolic DEGRE access: ES "Act Pos Modulo' ' 0x00n10004 Read every (Encoder) INT32 1 Modulo actual rotation 0x00n10005 Read every (Encoder) REAL64 e.g. mm/ Optional: Actual Symbolic s velocity access: "Act Velo'' 0x00n10006 Read every (Encoder) REAL64 e.g. mm/ Optional: Actual Symbolic s^2 acceleration access: "Act Acc'' 0x00n10007 Read every (Encoder) INT32 INC Encoder actual increments 0x00n10008 Read every (Encoder) INT64 INC Software - actual increment counter 0x00n10009 Read every (Encoder) UINT16 1 0/1 Reference flag ("calibrate flag") 0x00n1000A Read every (Encoder) REAL64 e.g. mm Actual position correction value (measurement system error correction) 0x00n1000B Read every (Encoder) REAL64 e.g. mm Actual position without Cannot be actual position traced by compensation value oscilloscope! 0x00n10010 Read every (Encoder) REAL64 e.g. mm/ Actual velocity without s actual position compensation value 0x00n10012 Read every (Encoder) REAL64 e.g. mm Unfiltered actual position (charge with actual position compensation value) 0x00n10014 Read Encoder: So E, REAL64 e.g. mm/ Optional: actual drive NEW from Co E, MDP 742 s velocity (transferred Twin CAT 3.1 directly from So E, Co E B4020.30 or MDP 742 drive) 0x00n10015 Read every (Encoder) REAL64 e.g. mm/ Optional: Unfiltered s actual velocity 0x00n10017 Read REAL64 e.g. mm Reading out the MC_Set Position offset 88 Version: 1.3.1 Twin CAT 3
## Page 89

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n10018 Read PTP axis UINT32 0/1 0/1 Returns the status of Port501 Encoder axis reinitialization after NC encoder reinitialization has been started (Index Group 0x4200+ID; Index Offset 0x00n0003B). n = 0: Standard encoder of the axis n > 0: n-th encoder of the axis (optional) 0x00n10101 Read INC (Encoder) REAL64 e.g. mm Read back of the Cannot be position difference traced by between activation of oscilloscope! the internal hardware latch and the time when it becomes valid 0x00n20001 Read R: every INT32 1 Error state of the controller n = 0: standard controller of the axes > 0: nth controller of the axis (optional) 0x00n20002 Read R: every REAL64 e.g. mm/ Controller output in Symbolic s absolute units access: "Ctrl Output'' 0x00n20003 Read R: every REAL64 % Controller output in Cannot be percent traced by oscilloscope! 0x00n20004 Read R: every REAL64 V Controller output in Cannot be volts traced by oscilloscope! 0x00n2000D Read R: every REAL64 e.g. mm Lag error position Base Unit (without dead time compensation) 0x00n2000F Read R: every REAL64 e.g. mm Lag error position (with Symbolic dead time access: compensation) "Pos Diff'' 0x00n20010 Read R: every REAL64 e.g. mm Peak hold value for maximum negative lag error of the position 0x00n20011 Read R: every REAL64 e.g. mm Peak hold value for minimum positive lag error of the position 0x00n20012 Read R: every REAL64 e.g. mm/ Lag error velocity Not s implemented! 0x00n20021 Read R: every REAL64 e.g. mm Difference (deviation) Symbolic between the lag error access: position of the master "Pos Diff Couple'' axis and that of the slave axis (master lag error minus slave lag error) 0x00n20022 Read R: every REAL64 e.g. mm Peak Hold value for the Base Unit maximum negative difference between master and slave axis lag error of the position 0x00n20023 Read R: every REAL64 e.g. mm Peak Hold value for the Base Unit maximum positive difference between master and slave axis lag error of the position Twin CAT 3 Version: 1.3.1 89
## Page 90

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n20101 Read R: P/PID (Pos.) REAL64 e.g. mm/ P part of the controller s in absolute units 0x00n20102 Read R: PID (Pos.) REAL64 e.g. mm/ I part of the controller s in absolute units 0x00n20103 Read R: PID (Pos.) REAL64 e.g. mm/ D part of the controller s in absolute units 0x00n20104 Read R: PID (Pos.) UINT16 1 0/1 Limitation of the I part active? 0x00n20105 Read R: PID (Pos.) UINT16 1 0/1 Limitation of the D part active? 0x00n20106 Read R: PID (Pos.) UINT16 1 0/1 ARW measures of the Not I-part active? ARW: implemented! Anti Reset Windup 0x00n20110 Read R: PID (Pos.) REAL64 e.g. mm/ Acceleration pre- Acceleration s control Yacc of the pre-control controller in absolute units Note: function depends on controller type! 0x00n20111 Read R: PP (Pos.) REAL64 mm/s/ ≥0 Internal interpolated PP controller mm proportional gain kp or kv 0x00n20201 Read R: P,PID REAL64 e.g. mm/ Velocity part of the (velocity) s controller 0x00n20202 Read R: P,PID REAL64 % Velocity part of the Cannot be (velocity) controller in percent traced by oscilloscope! 0x00n20203 Read R: P,PID REAL64 V Velocity part of the Cannot be (velocity) controller in volts traced by oscilloscope! 0x00n20201 Read R: P/PID REAL64 e.g. mm/ P part of the controller (velocity) s in absolute units 0x00n20202 Read R: P/ PID REAL64 e.g. mm/ I part of the controller (veloc.) s in absolute units 0x00n20203 Read R: P/ PID REAL64 e.g. mm/ D part of the controller (veloc.) s in absolute units 0x00n20204 Read R: P/ PID UINT16 1 0/1 Limitation of the I part (veloc.) active? 0x00n20205 Read R: P/ PID UINT16 1 0/1 Limitation of the D part (veloc.) active? 0x00n20206 Read R: P/ PID UINT16 1 0/1 ARW measures for the (veloc.) I part active? (ARW: Anti Reset Windup) 0x00n2020A Read R: P/ PID REAL64 e.g. mm/ Total input size of the (veloc.) s velocity controller 0x00n20A00 Read R: PID (MW) REAL64 % [-1.0...1.0] Offsetting of the set Reserved velocity (pre-control) parameters! 0x00n20A01 Read R: PID (MW) REAL64 e.g. mm/ P part of the controller Reserved s in absolute units or parameters! percent (according to output weight) 0x00n20A02 Read R: PID (MW) REAL64 e.g. mm/ I part of the controller Reserved s in absolute units or parameters! percent (according to output weight) 0x00n20A03 Read R: PID (MW) REAL64 e.g. mm/ D part of the controller Reserved s in absolute units or parameters! percent (according to output weight) 0x00n20A04 Read R: PID (MW) UINT16 1 0/1 Limitation of the I part Reserved active? parameters! 90 Version: 1.3.1 Twin CAT 3
## Page 91

Target systems Index offset Access Axis type Data type Phys. Definition Description Note (Hex) unit range 0x00n20A05 Read R: PID (MW) UINT16 1 0/1 Limitation of the D part Reserved active? parameters! 0x00n20A06 Read R: PID (MW) UINT16 1 0/1 ARW measures for the Reserved I part active? parameters! ARW: Anti Reset Windup 0x00n20A10 Read R: PID (MW) REAL64 e.g. mm/ Acceleration pre- Reserved s control Yacc of the parameters! controller in absolute units 0x00n30001 Read D: every INT32 1 Error state of the drive 0x00n30002 Read D: every REAL64 e.g. mm/ Total output in Symbolic s absolute units access: "Drive Output''" 0x00n30003 Read D: every REAL64 % Total output in percent 0x00n30004 Read D: every REAL64 V Total output in volts Cannot be traced by oscilloscope! 0x00n30005 Read D: every REAL64 e.g. mm/ Peak Hold value for s maximum negative total output 0x00n30006 Read D: every REAL64 e.g. mm/ Peak Hold value for s maximum positive total output 0x00n30007 Read D: every REAL64 e.g. Actual torque or actual from 100% = force respectively Twin CAT 3.1 1000, (typically 100% = B4022 e.g. Nm 1000) Symbolic or N access: "Act Torque'' 0x00n30008 Read D: every REAL64 e.g. Nm/ ±∞ Actual torque change from s or N/s or actual force change Twin CAT 3.1 respectively B4024 (time derivative of the actual torque or actual force respectively) 0x00n30013 Read D: every REAL64 % Total output in percent (based on non-linear characteristic curve!) 0x00n30014 Read D: every REAL64 V Total output in volt Cannot be (based on non-linear traced by characteristic curve!) oscilloscope! 0x00n3011A Read D: Servo REAL64 e.g. mm Optional output NEW (Sercos, filtering: For Sercos, CANopen) Filtered set position CANopen 0x00n3011E Read D: Servo REAL64 e.g. mm/ Optional output NEW (Sercos, s filtering: For Sercos, CANopen) Filtered set velocity CANopen 0x00n3011F Read D: Servo REAL64 e.g. mm/ Optional output NEW (Sercos, s^2 filtering: For Sercos, CANopen) Filtered set CANopen acceleration / set deceleration Twin CAT 3 Version: 1.3.1 91
## Page 92

Target systems 3.2.1.5.4.4.3 "Index offset" specification for axis functions (Index group 0x4200 + ID) 92 Version: 1.3.1 Twin CAT 3
## Page 93

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000001 Write every VOID Reset axis For FIFO axes too! 0x00000002 Write every VOID Stop axis For FIFO axes too! 0x00000003 Write every VOID Clear axis (task) For FIFO axes too! 0x00000004 Write every { Emergency stop (with Only for PTP controlled ramp) axes! REAL64 e.g. mm/ > 0.0 Deceleration (must be s^2 greater than or equal to the original deceleration) REAL64 e.g. mm/ > 0.0 Jerk (must greater s^3 than or equal to the original jerk) } 0x00000005 Write PTP axis { Parameterizable stop Only for PTP (with controlled ramp) axes! REAL64 e.g. mm/ > 0.0 Deceleration Reserved s^2 function, REAL64 e.g. mm/ > 0.0 Jerk no standard! s^3 } 0x00000009 Write PTP axis { Oriented stop Only for PTP (oriented end position) axes! REAL64 e.g. ≥ 0.0 Modulo end position degrees (modulo target position) REAL64 e.g. mm/ > 0.0 Deceleration (currently s^2 not active) REAL64 e.g. mm/ > 0.0 Jerk (not yet s^3 implemented) } 0x00000010 Write every VOID Reference axis ("calibration") 0x00000011 Write every { New end position axis Modified from Twin CAT 3 UINT32 ENUM s. appendix End position type [} 163] (see appendix) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ New end position (target position) } 0x00000012 Write every { New end position and new velocity axis UINT32 ENUM s. appendix Command type [} 163] (s. appendix) UINT32 ENUM s. appendix End position type [} 163] (see appendix) REAL64 e.g. mm ±∞ New end position (target position) REAL64 e.g. mm/s ≥ 0.0 New final velocity (requested travel velocity) REAL64 e.g. mm ±∞ Optional: Switchover position from which the new travel profile is activated } Twin CAT 3 Version: 1.3.1 93
## Page 94

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000015 Write every { New dynamic parameters for active positioning REAL64 e.g. mm/ > 0.0 Acceleration s^2 REAL64 e.g. mm/ > 0.0 Deceleration s^2 REAL64 e.g. mm/ > 0.0 Optional: Jerk (not yet s^3 implemented) } 0x00000016 Read Write every SERVO Write(80 bytes) Universal Axis Start Always to SEC (UAS): Port 501! Merge of single Modified from commands, such as Twin CAT 3 axis start, and online changes in combination with "Buffer Mode" (see Tc Mc2.lib) { UINT32 ENUM s. appendix Start type [} 162] (s. appendix) UINT32 1 ≥ 0 Bit mask for checks and operation modes (Default value: 0) REAL64 e.g. mm ±∞ End position (target position) REAL64 e.g. mm/s ≥ 0.0 Required velocity Vrequ REAL64 e.g. mm/ ≥ 0.0 Optional: Acceleration s^2 REAL64 e.g. mm/ ≥ 0.0 Optional: Deceleration s^2 REAL64 e.g. mm/ ≥ 0.0 Optional: Jerk s^3 UINT32 ENUM s. appendix Buffer mode [} 162] (command buffer) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ Optional: Blending position (command blending position) REAL64 e.g. mm/s ≥ 0.0 Optional: Initial segment velocity Vi (0 ≤ Vi ≤ Vrequ) REAL64 e.g. mm/s ≥ 0.0 Optional: Segment end velocity Vf (0 ≤ Vf ≤ Vrequ) } Read { UINT16 1 ≥ 0 Command number (job number) UINT16 1 ≥ 0 Command status } 94 Version: 1.3.1 Twin CAT 3
## Page 95

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000017 Read Write SERVO Write(80 bytes) "Master/slave Not yet decoupling" and released! "Universal axis start (UAS)": Merge of decoupling command of a slave axis (Idx Offset: 0x00000041) and the subsequent universal axis start (UAS) (Idx Offset: 0x00000016) { UINT32 ENUM s. appendix Start type [} 162] (s. appendix) UINT32 1 ≥ 0 Bit mask for checks and operation modes (Default value: 0) REAL64 e.g. mm ±∞ End position (target position) REAL64 e.g. mm/s ≥ 0.0 Required velocity Vrequ REAL64 e.g. mm/ ≥ 0.0 Acceleration s^2 REAL64 e.g. mm/ ≥ 0.0 Deceleration s^2 REAL64 e.g. mm/ ≥ 0.0 Jerk s^3 UINT32 ENUM s. appendix Buffer mode [} 162] (command buffer) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ Optional: Blending position (command blending position) REAL64 e.g. mm/s ≥ 0.0 Optional: Initial segment velocity Vi (0 ≤ Vi ≤ Vrequ) REAL64 e.g. mm/s ≥ 0.0 Optional: Segment end velocity Vf (0 ≤ Vf ≤ Vrequ) } Read { UINT16 1 ≥ 0 Command number (job number) UINT16 1 ≥ 0 Command status } 0x00000018 Write every VOID Release axis lock for motion commands (Tc Mc2) 0x00000019 Write every UINT32 1 > 0 Set external axis error Caution when (runtime error) using! 0x00n0001A Write every { Set actual axis Caution when position using! UINT32 ENUM s. appendix Actual position type For FIFO axes [} 163] (see appendix) too! UINT32 Reserve (Twin CAT 3) Always to SEC Port 501! REAL64 e.g. mm ±∞ Actual position for axes n = 0: standard Modified from encoder of the axis Twin CAT 3 n > 0: n-th encoder for the axis (optional) } Twin CAT 3 Version: 1.3.1 95
## Page 96

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00n0001B Write every UINT32 1 0/1 Set reference flag Caution when ("calibrate flag") using! n = 0: Standard For FIFO axes encoder for the axis too! n > 0: n-th encoder for the axis (optional) 0x00n0001C Write SERVO { Set only actual axis Caution when position without using! manipulating the set position (also for slave and with active process) UINT32 ENUM s. appendix Actual position type [} 163] (see appendix) REAL64 e.g. mm ±∞ Actual position for axes n = 0: standard encoder of the axes > 0: nth encoder of the axis (optional) Caution when using! } 0x00n0001D Write every { Actual value setting of Caution when the axis on the drive using! side Only for (position interface and CANopen! encoder offset of zero assumed!) n = 0: Standard encoder for the axis n > 0: n-th encoder for the axis (optional) UINT32 ENUM s. appendix Actual position type [} 163] (see appendix) REAL64 e.g. mm ±∞ Actual position for axis } 0x00n0001E Write every { Set a new encoder Caution when scaling factor on the using! fly (in motion of the Always to SEC axis) Port 501! UINT16 ENUM 1 Encoder scaling factor Modified from type Twin CAT 3 1: Absolute 2: Relative UINT16 Control Word UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ [1.0E-8 ... New encoder scaling INC 100.0] factor n = 0: Standard encoder for the axis n > 0: n-th encoder for the axis (optional) } 96 Version: 1.3.1 Twin CAT 3
## Page 97

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00n0001F Write every { Set actual axis Caution when position on the fly (in using! motion of the axis) Always to SEC UINT32 ENUM Position type for Port 501! setting actual value on the fly 1: Absolute 2: Relative UINT32 1 Control double word, e.g. for "clearing the lag error" REAL64 Reserve REAL64 e.g. mm ±∞ New actual axis position UINT32 Reserve UINT32 Reserve } 0x00000020 Write every 1D start { Standard axis start: Modified from Twin CAT 3 UINT32 ENUM s. appendix Start type [} 162] (s. appendix) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ End position (target position) REAL64 e.g. mm/s ≥0.0 Required velocity } 0x00000021 Write every 1D start { Extended axis start Modified from (SERVO): Twin CAT 3 UINT32 ENUM s. appendix Start type [} 162] (s. appendix) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ End position (target position) REAL64 e.g. mm/s ≥ 0.0 Required velocity UINT32 0/1 0/1 Standard acceleration? UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ ≥ 0.0 Acceleration s^2 UINT32 0/1 0/1 Standard deceleration? UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ ≥ 0.0 Deceleration s^2 UINT32 0/1 0/1 Standard jerk? UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ ≥ 0.0 Jerk s^3 } Twin CAT 3 Version: 1.3.1 97
## Page 98

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000022 Write SERVO(MW) { Special axis start Reserved start (SERVO): function, no standard! UINT32 ENUM s. appendix Start type [} 162] (s. appendix) Modified from Twin CAT 3 UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ End position (target position) REAL64 mm/s ≥ 0.0 Required start velocity REAL64 e.g. mm ±∞ Position for a new velocity level REAL64 e.g. mm/s ≥ 0.0 New end velocity level UINT32 0/1 0/1 Standard acceleration? UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ ≥ 0.0 Acceleration s^2 UINT32 0/1 0/1 Standard deceleration? UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ ≥ 0.0 Deceleration s^2 UINT32 0/1 0/1 Standard jerk? UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ ≥ 0.0 Jerk s^3 } 0x00000023 Write SERVO { Start external setpoint Modified from specification (setting Twin CAT 3 by cyclic axis interface PLCto NC) UINT32 ENUM 1: Absolute Start type [} 162] 2: Relative UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ New end position (target position) optional! REAL64 Reserve (Twin CAT 3) } 0x00000024 Write SERVO VOID Stop/disable external setpoint specification (cycl. axis interface PLCto NC) 0x00000025 Write SERVO { Start reversing Modified from operation for Twin CAT 3 positioning (SERVO): UINT32 ENUM 1 Start type [} 162] (default: 1) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ End position 1 (target position) REAL64 e.g. mm ±∞ End position 2 (target position) REAL64 0/1 0/1 Required velocity REAL64 s ≥ 0.0 Idle time } 0x00000026 Write every { Start drive output Modified from Twin CAT 3 UINT32 ENUM s. appendix Output type [} 170] (s. appendix) UINT32 Reserve (Twin CAT 3) REAL64 e.g. % ±∞ Required output value (e.g. %) } 0x00000027 Write every VOID Stop drive output 98 Version: 1.3.1 Twin CAT 3
## Page 99

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000028 Write every { Change the drive output: UINT32 ENUM s. appendix Output type [} 170] (s. appendix) REAL64 e.g. % ±∞ Required output value (e.g. %) } 0x00000029 Write every VOID Instantaneously adopt Reserved current override value function, no and freeze until next standard! override change! 0x0000002A Write every { Calculate and set Reserved 32 bytes encoder offset function, no } standard! 0x0000002B Read Write every Write Data: s. Stop external setpoint Reserved 'UAS' generator and function, no Read Data: s. continuous endless standard! 'UAS' motion ('UAS': Universal axis start) 0x0000002C Write every UINT32 ≥ 0 Set "homing state" (for New from internal use) Twin CAT 3 Twin CAT 3 Version: 1.3.1 99
## Page 100

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x0000002D Read Write Servo Write Switches an NC- Danger during controlled axis to use! "Cyclic Synchronous (* see end of Torque Mode" (CST) table) and sets a torque setpoint for it. { UINT32 Torque-axis start type: 0x3001: Absolute 0x3002: Relative UINT32 1 (bit array) Internal control mask (bit array): 00000000_00000001 (bit 0): Use manual torque for initialization. 10000000_000000000 (bit 31): Update/ refresh parameter for current command in 'Continuous Update' mode (f Torque Ramp, f Velocity Limit High, f Velocity Limit Low), do not increase cmd no. UINT32 0/1 0/1 Mode: 0: Default (discrete) 1: Continuous Update UINT32 ENUM see appendix Buffer mode [} 162] only ABORTING possible REAL64 Nm or % [0.0 … 1.0E10] Torque target value (signed value) REAL64 Nm/s or %/ [0.0 … 1.0E10] Torque change s velocity REAL64 e.g. mm/s [0.0 ... 1.0E10] Velocity limit high 'Velocity Limit Hi gh' must be greater than or equal to 'Velocity Limit Lo w' (both values can be negative). REAL64 e.g. mm/s [0.0 … 1.0E10] Velocity limit low REAL64 e.g. mm/ [0.0 … 1.0E10] Acceleration s^2 REAL64 e.g. mm/ [0.0 … 1.0E10] Deceleration s^2 REAL64 Nm or % [0.0 … 1.0E10] Optional: Manual torque start value (sync value) } Read { UINT16 1 >=0 Command number (job number) UINT16 1 >=0 Command status } 0x0000002E Reserved 0x0000002F Reserved 100 Version: 1.3.1 Twin CAT 3
## Page 101

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000030 Write SERVO { Start section Only affects compensation older Twin CAT (SERVO) 2 systems UINT32 ENUM s. appendix Compensation type [} 163] (see appendix) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ ≥ 0.0 Max. acceleration s^2 increase REAL64 e.g. mm/ ≥ 0.0 Max. deceleration s^2 increase REAL64 e.g. mm/s > 0.0 Max. increase velocity REAL64 e.g. mm/s > 0.0 Base velocity for the process REAL64 e.g. mm ±∞ Path difference to be compensated REAL64 e.g. mm > 0.0 Path distance for compensation } 0x00000030 Read Write SERVO returns { Start section Changed from the actually READ+WRITE: compensation Twin CAT 2 implemented (SERVO) 211R3 parameters as Note: only contained in return values 'Tc Mc2.lib' or 'Tc2_MC2.library' Twin CAT 3 UINT32 ENUM s. appendix Compensation type [} 163] (see appendix) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ ≥ 0.0 => Max. acceleration s^2 increase <= Returns the implemented acceleration increase (new in 'Tc Mc2.lib' or 'Tc2_MC2.library') REAL64 e.g. mm/ ≥ 0.0 => Max. deceleration s^2 increase <= Returns the implemented deceleration increase (new in 'Tc Mc2.lib' or 'Tc2_MC2.library') REAL64 e.g. mm/s > 0.0 => Requested max. increase velocity <= Returns the implemented increase velocity REAL64 e.g. mm/s > 0.0 Base velocity for the process REAL64 e.g. mm ±∞ => Requested path difference to be compensated <= Returns the implemented path difference REAL64 e.g. mm > 0.0 => Requested max. distance for compensation <= Returns implemented distance UINT32 1 ≥ 0 <= Returns Warning ID (e.g. 0x4243) UINT32 Reserve (Twin CAT 3) } 0x00000031 Write SERVO VOID Stop section compensation (SERVO) Twin CAT 3 Version: 1.3.1 101
## Page 102

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000032 Write SERVO { Start reversing Modified from operation with velocity Twin CAT 3 jumps (SERVO): (can be used to determine the velocity step response) UINT32 ENUM 1 Start type [} 162] (default: 1) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/s ±∞ Required velocity 1 (negative values also permitted) REAL64 e.g. mm/s ±∞ Required velocity 2 (negative values also permitted) REAL64 s > 0.0 Travel time for velocity 1 and 2 REAL64 s ≥ 0.0 Idle time UINT32 1 0, 1,2,3... Optional: Number of repetitions, Default "0": unlimited in time UINT32 Reserve (Twin CAT 3) } 0x00000033 Write SERVO { Sine oscillation Modified from sequence Twin CAT 3 - used as single sinus oscillation (sinus generator) - used as sinus oscillation sequence (e.g. for bode plot) UINT32 ENUM 1 Start type [} 162] (fixed to start type 1 yet) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/s > 0.0 Base amplitude (e.g. 2.5 mm/s) REAL64 Hz [0.0 .... 10.0] Base frequency (e.g. 1.953125 Hz) REAL64 e.g. mm/s ≥ 0.0 Start amplitude at begin (e.g. 0.0 mm/s) REAL64 e.g. mm/ > 0.0 Feed constant motor REV (per motor turn) (e.g. 10.0 mm/REV) REAL64 Hz ≥ 1.0 Frequency range: start frequency (e.g. 20.0 Hz) REAL64 Hz ≤ 1/(2*d T) Frequency range: stop frequency (e.g. 500.0 Hz) REAL64 s > 0.0 Step duration (e.g. 2,048s) UINT32 1 [1 ... 200] Number of measurements (step cycles) (e.g. 20) UINT32 1 Number of parallel measurements (e.g. 1) not used yet! } 102 Version: 1.3.1 Twin CAT 3
## Page 103

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000034 Write SERVO { Phasing - Start Phasing - Stop Phasing UINT32 ENUM 1 Phasing Type: 1: ABSOLUTE 2: RELATIVE 4096: STOP UINT32 1 ≥ 0 Control Mask Bit 0: Continuous Update UINT32 1 ≥ 0 Master axis ID (for multi master) UINT32 Reserve REAL64 e.g. mm ±∞ Phase shift REAL64 e.g. mm/s > 0.0 Velocity REAL64 e.g. mm/ ≥ 0.0 Acceleration s^2 REAL64 e.g. mm/ ≥ 0.0 Deceleration s^2 REAL64 e.g. mm/ ≥ 0.0 Jerk s^3 REAL64[4] Reserve UINT32 Reserve UINT32 1 ENUM Buffer mode (NOT IMPLEMENTED) REAL64 e.g. mm ±∞ Blending position (NOT IMPLEMENTED) } 0x00n0003B Write PTP axis VOID Triggers NC encoder Danger during Encoder axis reinitilization to valid use! IO values There must be no controller n = 0: Standard enable (position encoder of the axis jump) n > 0: n-th encoder of The axis status the axis (optional) index offset 0x00n10018 can be used to read out whether NC encoder reinitilization has been completed. Port 501 Twin CAT 3 Version: 1.3.1 103
## Page 104

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000040 Write Master/Slave { Master/Slave coupling Extension for (0x00n00040) coupling (SERVO): "flying saw"! (SERVO) UINT32 ENUM s. appendix Slave type [} 164]/ Angle >0.0 and coupling type (see £ 90.0 degrees appendix) (parallel saw: 90.0 degrees) UINT32 1 [1...255] Axis ID of the master axis/group UINT32 1 [0...8] Subindex n of the master axis (default: value: 0) UINT32 1 [0...8] Subindex n of the slave axis (default: value: 0) REAL64 1 [±1000000.0] Parameter 1: Linear: Gear ratio Fly Saw Velo: Reserve Fly Saw: Abs. synchron position master [mm] REAL64 1 [±1000000.0] Parameter 2:Linear: Reserve Fly Saw Velo: Reserve Fly Saw Pos: Abs. synchron position slave [mm] REAL64 1 [±1000000.0] Parameter 3: Linear: Reserve Fly Saw Velo: Angle of inclination in [DEGREES] Fly Saw Pos: Angle of inclination in [DEGREES] REAL64 1 [±1000000.0] Parameter 4:Linear: Reserve Fly Saw Velo: Gear ratio Fly Saw Pos: Gear ratio } 104 Version: 1.3.1 Twin CAT 3
## Page 105

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000040 Write Master/Slave { Master/Slave coupling Multi master (0x00n00040) coupling (SERVO): coupling (SERVO) (MC_Gear In Mul UINT32 ENUM s. appendix Slave type [} 164]/ ti Master) coupling type (see appendix) Version V1 and V2 UINT32 1 [1...255] Axis ID of the master axis/group Modified from UINT32 1 [1...8] Subindex n of the Twin CAT 3 master axis (default: value: 0) UINT32 1 [1...8] Subindex n of the slave axis (default: value: 0) UINT32 1 [0...255] Axis ID master 2 UINT32 1 [0...255] Axis ID master 3 UINT32 1 [0...255] Axis ID master 4 UINT32 1 [0...255] Reserve (axis ID master 5) UINT32 1 [0...255] Reserve (axis ID master 6) UINT32 1 [0...255] Reserve (axis ID master 7) UINT32 1 [0...255] Reserve (axis ID master 8) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm/ Maximum s^2 acceleration/ deceleration of the slave axis UINT32 1 ≥ 0 Control mask, not previously used (check and operation mode for profile) UINT32 Reserve (Twin CAT 3) Extension V2 (Optional): REAL64 e.g. mm/ ≥ 0.0 Maximum deceleration s^2 of the slave axis REAL64 e.g. mm/ ≥ 0.0 Maximum jerk of the s^3 slave axis REAL64 e.g. mm/s ≥ 0.0 Maximum velocity of the slave axis REAL64 Reserve REAL64 Reserve } 64 or 104 bytes 0x00000041 Write Master/slave VOID Master/slave decoupling decoupling (SERVO) (SERVO) Twin CAT 3 Version: 1.3.1 105
## Page 106

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000041 Write Master/Slave { Master/slave Not yet decoupling with decoupling with released! configurable configurable follow-up Modified from follow-up function (e.g. new end TC3 function position, new velocity, (SERVO) stop, E-stop) (SERVO) UINT32 ENUM s. appendix Decoupling type [} 164] (see appendix) UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ Optional: New end position REAL64 e.g. mm/s > 0.0 Optional: New requested velocity REAL64 e.g. mm/ ≥ 0.0 Optional: Acceleration s^2 (0: Default) for new end position, new velocity and emergency stop (E- stop) REAL64 e.g. mm/ ≥ 0.0 Optional: Deceleration s^2 (0: Default) for new end position, new velocity and emergency stop (E- stop) REAL64 e.g. mm/ ≥ 0.0 Optional: Jerk for new s^3 (0: Default) end position, new velocity and emergency stop (E- stop) } 0x00000042 Write Master/Slave { Change of the coupling coupling parameters (SERVO): Type: LINEAR (&SPECIAL) REAL64 1 [±1000000.0] Parameter 1: Linear: Gear ratio REAL64 1 [±1000000.0] Parameter 2: Linear: Reserve REAL64 1 [±1000000.0] Parameter 3: Linear: Reserve REAL64 1 [±1000000.0] Parameter 4: Linear: Reserve } 0x00000043 Write Master/slave { Change of the table table coupling coupling parameters (SERVO): Type: TABULAR REAL64 mm ±∞ Slave position offset REAL64 mm ±∞ Master position offset } 0x00000043 Write Master/slave { Change of the table Also for "Motion table coupling coupling parameters Function" (SERVO): Type: TABULAR REAL64 mm ±∞ Slave position offset and REAL64 mm ±∞ Master position offset "Motion REAL64 1 ±∞ (<> 0.0) Slave position scaling Function" REAL64 1 ±∞ (<> 0.0) Master position scaling } 106 Version: 1.3.1 Twin CAT 3
## Page 107

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000043 Write Master/slave { Change of the table table coupling coupling parameters (SERVO): Type: TABULAR REAL64 mm ±∞ Slave position offset REAL64 mm ±∞ Master position offset REAL64 1 ±∞ (<> 0.0) Slave position scaling REAL64 1 ±∞ (<> 0.0) Master position scaling REAL64 e.g. mm ±∞ Absolute master activation position } 0x00000044 Write Slave-Stop VOID Stop the "flying saw" Only for "flying (SERVO) (SERVO) saw" 0x00000045 Write Master/slave { Master/slave table (0x00n00045) table coupling coupling (SERVO): (SERVO) UINT32 ENUM s. appendix Slave type/coupling type [} 164] (see appendix) UINT32 1 [1...255] Axis ID of the master axis UINT32 1 [0...8] Subindex n of the master axis (default: value: 0) UINT32 1 [0...8] Subindex n of the slave axis (default value: 0) SOLO TABLE SECTION REAL64 mm ±∞ Slave position offset (type: TABULAR) REAL64 mm ±∞ Master position offset (type: TABULAR) UINT32 1 [0,1] Slave positions absolute (type: TABULAR) UINT32 1 [0,1] Master positions absolute (type: TABULAR) UINT32 1 [1...255] Table ID of the coupling table (type: TABULAR) MULTI TABLE SECTION UINT16 1 [0...8] Number of tables (type: MULTITAB) Note: Misused as interpolation type for solo tables UNIT16 1 [0...8] Number of profile tables (type: MULTITAB) UNIT32[8] 1 [1...255] Tables IDs of the coupling tables (type: MULTITAB) } 0x00000046 Write Master/slave UINT32 1 [1...255] Correction table multi-tables activation, correction table ID 0x00000046 Write Master/slave { Activation of correction Modified from multi-tables table Twin CAT 3 UINT32 1 [1...255] Correction table ID UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ Absolute master activation position } Twin CAT 3 Version: 1.3.1 107
## Page 108

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000047 Write Master/slave UINT32 1 [1..255] Deactivation of profile multi-tables table at the end of the cycle, table ID of the current monocyclic profile table 0x00000048 Read Write Master/slave Write: UINT32 1 [1..255] Reading the last multi-tables correction offset: Table ID of the correction table Read: REAL32 e.g. mm ±∞ Offset by departing the correction table with the according table ID 0x00000049 Write Master/slave REAL64 1 ±∞ Change the slave table coupling table scaling factor for the slave table column Type: (Default value: 1.0) TABULAR 108 Version: 1.3.1 Twin CAT 3
## Page 109

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x0000004A(0x Write Master/Slave { Master/Slave Solo Modified from 00n0004A) Universal Table Table Coupling Twin CAT 3 Coupling (SERVO): (SERVO) UINT32 ENUM s. appendix Slave type/coupling type [} 164] (see appendix) UINT32 1 [1...255] Axis ID of the master axis UINT32 1 [0...8] Subindex n of the master axis (default: value: 0) UINT32 1 [0...8] Subindex n of the slave axis (default: value: 0) UINT32 1 1...255] Table ID of the coupling table (type: TABULAR) UINT32 1 Table interpolation type REAL64 mm ±∞ Slave position offset (type: TABULAR) REAL64 mm ±∞ Master position offset (type: TABULAR) REAL64 mm ±∞ Slave position scaling (type: TABULAR) REAL64 mm ±∞ Master position scaling (type: TABULAR) UINT32 1 [0,1] Slave position absolute ? (Type: TABULAR) UINT32 1 [0,1] Master positions absolute ? (Type: TABULAR) UINT32 ENUM s. appendix Activation type of the change: 0: 'instantaneous' (default) 1: 'at master cam position' 2: 'at master axis position' 3: 'next cycle' UINT32 Reserve (Twin CAT 3) REAL64 mm ±∞ Activation position UINT32 ENUM s. appendix Master scaling type: 0: user defined (default) 1: scaling with auto offset 2: off UINT32 ENUM s. appendix Slave scaling type: 0: user defined (default) 1: scaling with auto offset 2: off } Twin CAT 3 Version: 1.3.1 109
## Page 110

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x0000004A(0x Write Master/Slave { Master/Slave Solo Modified from 00n0004A) Universal Table Table Coupling Twin CAT 3 Coupling (SERVO): (SERVO) UINT32 ENUM s. appendix Slave type/coupling type [} 164] (see appendix) UINT32 1 [1...255] Axis ID of the master axis UINT32 1 [0...8] Subindex n of the master axis (default: value: 0) UINT32 1 [0...8] Subindex n of the slave axis (default: value: 0) UINT32 1 1...255] Table ID of the coupling table (type: TABULAR) UINT32 1 Table interpolation type REAL64 mm ±∞ Slave position offset (type: TABULAR) REAL64 mm ±∞ Master position offset (type: TABULAR) REAL64 mm ±∞ Slave position scaling (type: TABULAR) REAL64 mm ±∞ Master position scaling (type: TABULAR) UINT32 1 [0,1] Slave position absolute ? (Type: TABULAR) UINT32 1 [0,1] Master positions absolute ? (Type: TABULAR) UINT32 ENUM s. appendix Activation type of the change: 0: 'instantaneous' (default) 1: 'at master cam position' 2: 'at master axis position' 3: 'next cycle' UINT32 Reserve (Twin CAT 3) REAL64 mm ±∞ Activation position UINT32 ENUM s. appendix Master scaling type: 0: user defined (default) 1: scaling with auto offset 2: off UINT32 ENUM s. appendix Slave scaling type: 0: user defined (default) 1: scaling with auto offset 2: off Extension for Multi Cam: UINT32 ENUM s. appendix Cam Operation Mode UINT32 1 [1…255] Reference table ID BYTE[104] Reserve (Twin CAT 3) } 110 Version: 1.3.1 Twin CAT 3
## Page 111

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x0000004B(0x Write Master/slave { Master/slave Modified from 00n0004B) universal flying synchronization Twin CAT 3 saw (SERVO) coupling (SERVO): UINT32 ENUM s. appendix Slave type/coupling type (see appendix) UINT32 1 [1...255] Axis ID of the master axis UINT32 1 [0...8] Subindex n of the master axis (default: value: 0) UINT32 1 [0...8] Subindex n of the slave axis (default: value: 0) REAL64 1 ±∞ (<> 0.0) Gear ratio REAL64 mm ±∞ Master synchron position REAL64 mm ±∞ Slave synchron position REAL64 mm/s ≥ 0.0 Slave velocity (optional) REAL64 mm/s^2 ≥ 0.0 Slave acceleration (optional) REAL64 mm/s^2 ≥ 0.0 Slave deceleration (optional) REAL64 mm/s^3 ≥ 0.0 Slave jerk (optional) UINT32 1 ≥ 0 Bit mask (default value: 0) UINT32 Reserve (Twin CAT 3) } Twin CAT 3 Version: 1.3.1 111
## Page 112

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x0000004D(0x Write Master/slave { Change in table Modified from 00n0004D) table coupling scaling (SERVO): Twin CAT 3 Type: UINT32 ENUM s. appendix Activation type of the TABULAR change and MF 0: 'instantaneous' (default) 1: 'at master cam position' 2: 'at master axis position' 3: 'next cycle' UINT32 Reserve (Twin CAT 3) REAL64 e.g. mm ±∞ Activation position UINT32 ENUM s. appendix Master scaling type 0: user defined (default) 1: scaling with auto offset 2: off UINT32 ENUM s. appendix Slave scaling type 0: user defined (default) 1: scaling with auto offset 2: off REAL64 e.g. mm ±∞ Master position offset REAL64 e.g. mm ±∞ Slave position offset REAL64 1 ±∞ (<> 0.0) Master position scaling REAL64 1 ±∞ Slave position scaling Optional extension for Multi Cam: UINT32 1 ≥ 0 Cam Table ID UINT32 Reserve (Twin CAT 3) } 0x00000050 Write every VOID Deactivate complete axis (disable) 0x00000051 Write every VOID Activate complete axis (enable) 0x00000052 Write SERVO { Change of the active Modified from axis control loop (triple Twin CAT 3 from encoder, controller and axis interfaces) with/without external setpoint specification: UINT32 1 ≥ 0 Number/index of the axis control loop (Default value: 0) UINT32 ENUM s. appendix Switching type for (>0) synchronization behavior [} 174] 1: 'Standard' REAL64 1 ±∞ Synchronization value for switching (optional) UINT32 0/ 1 0/1 External setpoint specification by means of axis interface ? Note: Not used so far! UINT32 Reserve (Twin CAT 3) } 112 Version: 1.3.1 Twin CAT 3
## Page 113

Target systems Index offset Access Axis type Data type Phys. unit Definition Description Note (Hex) range 0x00000060 Write every VOID Deactivate drive output (disable) 0x00000061 Write every VOID Activate drive output (enable) 0x00000062 Write high/low UINT16 1 0/1 Release parking brake? 0: automatic activation (default) 1: mandatorily always released Note: Reset to '0' when resetting the axis! 0x00000063 Write only for { Activate "Drive NEW from TC SERCOS/So E Operation Mode" (e.g. 3.1 B4022 (NC and CANopen/ Position Velo, Torque, 4443) Co E etc.) Always to SEC INT32 ENUM [0; 1, 2, 3, …] New "Drive Operation Port 501! [} 171] Special cases: Mode" (generic (see modes) ≥ 100: So E appendix) < 0: Co E UINT32 1 0 Reserve UINT32 1 0 Reserve UINT32 1 0 Reserve } 0x00000070 Write every VOID Return of the axis from, e.g. a 3D group to its own PTP group * The following warning relates to index offset 0x0000002D: DANGER Danger to life or risk of serious injury or damage to property due to unintentional movements of the axis When using the function block, the axis is switched to CST mode. After using the function block (especially after error situations), the axis may still be in CST mode. This can lead to sudden and unplanned movements (especially with lifting axes) when the axis is released. • Ensure that there is no hazard as defined by the risk assessment. • Check the current operation mode via the function block MC_Read Drive Operation Mode. • If the axis is not in a position-related operation mode (CSV/CSP), transfer it before an enable: – directly with MC_Write Drive Operation Mode into the desired position-related operation mode (CSV/ CSP) or – indirectly with MC_Halt / MC_Stop into the desired position-related operation mode (CSV/CSP) (from Twin CAT 3.1.4024.40) Other function blocks that switch the axis indirectly into a position-related operation mode can only do this to a limited extent and are therefore not to be used for a deliberate operation mode change. ð Subsequently, it is necessary to check again whether the axis is really in a position-related operation mode (CSV/CSP), if not, an abort with error handling is required. Twin CAT 3 Version: 1.3.1 113
## Page 114

Target systems 3.2.1.5.4.4.4 "Index offset" specification for cyclic axis process data (Index group 0x4300 + ID) 114 Version: 1.3.1 Twin CAT 3
## Page 115

Target systems Index offset Access Axis type Data type Phys. Definition Description Note ( Hex ) unit range 0x00n00000 Read/Write every { 128 bytes} STRUCT see AXIS STRUCTURE Write command (PLC→NC) axis interface (PLC→NC) only optional! n = 0: standard axis Consider safety interface aspects! n > 0: n-th axis PLCTONC_AXI interface (optional) S_REF 0x00n00001 Read/Write every UINT32 1 >0 Control double word Write command (PLC→NC) only optional! Symbolic access possible! "Control DWord" 0x00n00002 Read/Write every UINT16 1 0/1 Controller enable Cannot be (PLC→NC) traced by oscilloscope! 0x00n00003 Read/Write every UINT16 1 0/1 Feed enable plus Cannot be (PLC→NC) traced by oscilloscope! 0x00n00004 Read/Write every UINT16 1 0/1 Feed enable minus Cannot be (PLC→NC) traced by oscilloscope! 0x00n00007 Read/Write every UINT16 1 0/1 Referencing cam Cannot be (PLC→NC) traced by oscilloscope! 0x00n00021 Read/Write every UINT32 % 0...1000000 Velocity override Write command (PLC→NC) (1000000 == 100%) only optional! Symbolic access possible! "Override V" 0x00n00022 Read/Write every UINT32 1 ENUM Operation mode axis Write command (PLC→NC) only optional! 0x00n00025 Read/Write every REAL64 e.g. mm Actual position Write command (PLC→NC) correction value only optional! (measurement system error correction) 0x00n00026 Read/Write every REAL64 e.g. mm/ External controller Write command (PLC→NC) s component (position only optional! controller component) 0x00n00027 Read/Write every { External setpoint Write command (PLC→NC) generation only optional! REAL64 e.g. mm ±∞ External set position REAL64 e.g. mm/ ±∞ External set velocity Modified from s TC3 REAL64 e.g. mm/ ±∞ External set s^2 acceleration INT32 1 +1, 0, -1 External set travel direction UINT32 Reserve (TC3) REAL64 Reserve (TC3) } 0x00n00080 Read every { 256 bytes} STRUCT see AXIS STRUCTURE Changed from (PLC→NC) axis interface (NC→PLC) TC3. NCTOPLC _AXIS_REF Note: size and alignment changed n = 0: standard axis interface n > 0: n-th axis interface (optional) Twin CAT 3 Version: 1.3.1 115
## Page 116

Target systems Index offset Access Axis type Data type Phys. Definition Description Note ( Hex ) unit range 0x00n00071 Read every UINT8 1 >0 State double word: (PLC→NC) byte 1 0x00n00072 Read every UINT8 1 >0 State double word: (PLC→NC) byte 2 0x00n00073 Read every UINT8 1 >0 State double word: (PLC→NC) byte 3 0x00n00074 Read every UINT8 1 >0 State double word: (PLC→NC) byte 4 0x00n00081 Read every UINT32 1 >0 State double word Symbolic (PLC→NC) (complete) access possible! "State DWord" 0x00n00082 Read every UINT16 1 0/1 Axis is ready for Cannot be (PLC→NC) operation traced by oscilloscope! 0x00n00083 Read every UINT16 1 0/1 Axis has been Cannot be (PLC→NC) referenced traced by oscilloscope! 0x00n00084 Read every UINT16 1 0/1 Axis in protected Cannot be (PLC→NC) operation mode (e.g. traced by slave axis) oscilloscope! 0x00n00085 Read every UINT16 1 0/1 Axis is in rapid mode Cannot be (PLC→NC) traced by oscilloscope! 0x00n00088 Read every UINT16 1 0/1 Axis has invalid I/O Cannot be (PLC→NC) data traced by oscilloscope! 0x00n00089 Read every UINT16 1 0/1 Axis is in an error state Cannot be (PLC→NC) traced by oscilloscope! 0x00n0008A Read every UINT16 1 0/1 Axis moving to larger Cannot be (PLC→NC) values traced by oscilloscope! 0x00n0008B Read every UINT16 1 0/1 Axis moving to smaller Cannot be (PLC→NC) values traced by oscilloscope! 0x00n0008C Read every UINT16 1 0/1 Axis is at a logical Cannot be (PLC→NC) standstill traced by (only setpoints are oscilloscope! considered) (position controller?) 0x00n0008D Read every UINT16 1 0/1 Axis is being Cannot be (PLC→NC) referenced traced by oscilloscope! 0x00n0008E Read every UINT16 1 0/1 Axis is in position Cannot be (PLC→NC) window traced by oscilloscope! 0x00n0008F Read every UINT16 1 0/1 Axis is at target Cannot be (PLC→NC) position (target traced by position reached) oscilloscope! 0x00n00090 Read every UINT16 1 0/1 Axis has constant Cannot be (PLC→NC) velocity or rotary traced by speed oscilloscope! 0x00n0009A Read every UINT16 1 0/1 Operation mode not Cannot be (PLC→NC) executed (busy) traced by oscilloscope! 0x00n0009B Read every UINT16 1 0/1 Axis has instructions, Cannot be (PLC→NC) is carrying instructions traced by out oscilloscope! 0x00n000B1 Read every UINT32 1 ≥0 Axis error code (PLC→NC) 0x00n000B2 Read every UINT32 1 ENUM Motion state of the Symbolic (PLC→NC) axis (master state access [} 171] / slave state possible! [} 171]) "Axis State" 116 Version: 1.3.1 Twin CAT 3
## Page 117

Target systems Index offset Access Axis type Data type Phys. Definition Description Note ( Hex ) unit range 0x00n000B3 Read every UINT32 1 ENUM Operation mode of the (PLC→NC) axis (rev. NC) 0x00n000B4 Read every UINT32 1 ENUM Axis referencing status Symbolic (PLC→NC) access possible! "Homing State" 0x00n000B5 Read every UINT32 1 ENUM Axis coupling state Symbolic (PLC→NC) access possible! "Couple State" 0x00n000B6 Read every UINT32 1 ≥0 SVB entries/tasks of (PLC→NC) the axis (PRE table) 0x00n000B7 Read every UINT32 1 ≥0 SAF entries/tasks of (PLC→NC) the axis (EXE table) 0x00n000B8 Read every UINT32 1 ≥0 Axis ID (PLC→NC) 0x00n000B9 Read every UINT32 1 ≥0 Operation modes state (PLC→NC) double word:Bit 0: Position range monitoring active? Bit 1: target position window monitoring active? Bit 2: looping distance active? Bit 3: physical motion monitoring active? Bit 4: PEH time monitoring active? Bit 5: backlash compensation active? Bit 6: delayed error reaction mode active? Bit 7: modulo operation mode active (modulo axis)? Bit 16: following error monitoring position active? Bit 17: following error monitoring vel. active? Bit 18: end position monitoring min. active? Bit 19: end position monitoring max. active? Bit 20: actual position correction active? 0x00n000BA Read every REAL64 e.g. mm Actual position (PLC→NC) (calculated absolute value) 0x00n000BB Read every REAL64 e.g. mm Modulo actual position (PLC→NC) 0x00n000BC Read every INT32 1 Modulo rotations (PLC→NC) 0x00n000BD Read every REAL64 e.g. mm/ Actual velocity (PLC→NC) s (optional) 0x00n000BE Read every REAL64 e.g. mm Following error (PLC→NC) position 0x00n000BF Read every REAL64 e.g. mm Set position (PLC→NC) 0x00n000C0 Read every REAL64 e.g. mm/ Set velocity (PLC→NC) s Twin CAT 3 Version: 1.3.1 117
## Page 118

Target systems Index offset Access Axis type Data type Phys. Definition Description Note ( Hex ) unit range 0x00n000C1 Read every REAL64 e.g. mm/ Set acceleration (PLC→NC) s^2 0x00n10000 Read/Write Encoder: every { 40 bytes STRUCT see ENCODER OUTPUT Write command (NC→IO) } encoder IO STRUCTURE only optional! interface (NC→IO, 40 Consider safety bytes)NCENCODERS aspects! TRUCT_OUT2 0x00n10080 Read Encoder: every { 40 bytes STRUCT see ENCODER-INPUT- (IO→NC) } encoder IO STRUCTURE interface (IO→NC, 40 bytes)NCENCODERS TRUCT_IN2 0x00n30000 Read/Write Drive: every { 40 bytes STRUCT see DRIVE-OUTPUT- Write command (NC→IO) } drive IO STRUCTURE only optional! interface (NC→IO, 40 Consider safety bytes)NCDRIVESTRU aspects! CT_OUT2 0x00n30080 Read Drive: every { 40 bytes STRUCT see DRIVE-INPUT- (IO→NC) } drive IO STRUCTURE interface (NC→IO, 40 bytes)NCDRIVESTRU CT_IN2 118 Version: 1.3.1 Twin CAT 3
## Page 119

Target systems 3.2.1.5.4.5 Specification Encoder 3.2.1.5.4.5.1 "Index offset" specification for encoder parameter (Index group 0x5000 + ID) Twin CAT 3 Version: 1.3.1 119
## Page 120

Target systems Index offset Access Group type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000001 Read every UINT32 1 [1 ... 255] Encoder ID 0x00000002 Read every UINT8[30+1] 1 30 characters Encoder name 0x00000003 Read every UINT32 1 s. ENUM (>0) Encoder type [} 166] 0x00000004 Read/Write every UINT32 1 Byteoffset Input address offset change I/O (IO-Input-Image) address 0x00000005 Read/Write every UINT32 1 Byteoffset Output address offset change I/O (IO-Output-Image) address 0x00000006 Read/Write every REAL64 e.g. mm/ [1.0E-12 ... resulting scaling factor Writing is not INC 1.0E+30] (numerator / allowed if the denominator) controller enable has Note: from TC3 the been issued. scaling factor consists of two components – numerator and denominator (default: 1.0). 0x00000007 Read/Write every REAL64 e.g. mm [±1.0E+9] Position offset Writing is not allowed if the controller enable has been issued. 0x00000008 Read/Write every UINT16 1 [0,1] encoder count Writing is not direction allowed if the controller enable has been issued. 0x00000009 Read/Write every REAL64 e.g. mm [0.001 ... modulo factor 1.0E+9] 0x0000000A Read/Write every UINT32 1 s. ENUM (>0) Encoder mode [} 167] in the appendix 0x0000000B Read/Write every UINT16 1 0/1 soft end min. monitoring? 0x0000000C Read/Write every UINT16 1 0/1 soft end max. monitoring? 0x0000000D Read/Write every REAL64 mm Soft end position min. 0x0000000E Read/Write every REAL64 mm Soft end position max. 0x0000000F Read/Write every UINT32 1 s. ENUM (≥0) Encoder evaluation in the appendix direction [} 167] (enable for log. counting direction) 0x00000010 Read/Write every REAL64 s [0.0...60.0] Filter time for actual position value in seconds (P-T1) 0x00000011 Read/Write every REAL64 s [0.0...60.0] Filter time for actual velocity value in seconds (P-T1) 0x00000012 Read/Write every REAL64 s [0.0...60.0] filter time for actual acceleration value in seconds (P-T1) 0x00000013 Read/Write every UINT8[10+1] 1 physical unit Not implemented! 0x00000014 Read/Write every UINT32 1 interpretation of the Not units (position, implemented! velocity, time) bit array Bit 0: velocity in x/min instead of x/s Bit 1: position in thousandths of the base unit 120 Version: 1.3.1 Twin CAT 3
## Page 121

Target systems Index offset Access Group type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000015 Read/Write every UINT32 INC [0x0... Encoder mask Axis has to be 0x FFFFFFFF] (maximum value of the disabled for encoder actual value write access. in increments) see also Note: The encoder "Encoder Sub mask may be any Mask" numerical value (e.g. parameter 3600000). Unlike in the past, it no longer has to correspond to a continuous series off binary one's (2n-1). 0x00000016 Read/Write every UINT16 1 0/1 Actual position correction (measurement system error correction)? 0x00000017 Read/Write every REAL64 s [0.0...60.0] Filter time for actual position correction in seconds (P-T1) 0x00000018 Read/Write every UINT32 1 [0x0... Filter mask for raw 0x FFFFFFFF] incremental value (0x0: full pass) 0x00000019 Read/Write every UINT32 1 s. ENUM (≥0) Encoder absolute Writing is not in the appendix dimensioning system allowed if the controller [} 167] enable has been issued. 0x0000001A Read/Write every UINT32 1 s. ENUM (≥0) Encoder position Not initialization implemented! 0x0000001B Read/Write every REAL64 e.g. mm [≥0, modulo Tolerance window for factor/2] modulo-start 0x0000001C Read every UINT32 1 s. ENUM (≥0) Encoder sign interpretation [} 167] (data type) 0x0000001D Read every UINT16 1 0/1 Incremental or absolute encoder ? 0: incremental encoder type 1: absolute encoder type 0x00000020 Read/Write every UINT32 1 s. ENUM (≥0) Encoder dead time compensation mode 0: off (Default) 1: on (with velocity) 2: on (with velocity and acceleration) 0x00000021 Read/Write every UINT32 1 Control double word (32 bits) for the encoder dead time compensation: Bit 0 = 0: relative I/O times (default) Bit 0 = 1: absolute I/O times 0x00000022 Read/Write every INT32 ns [±1.0E+9] Sum of the parameterized time shifts for the encoder dead time compensation (typically positive numerical values) 0x00000023 Read/Write every REAL64 e.g. mm/ [1.0E-12 ... Component of the NEW from TC3 INC 1.0E+30] scaling factor: Writing is not numerator allowed if the (=> scaling factor controller numerator / scaling enable has factor denominator) been issued. Twin CAT 3 Version: 1.3.1 121
## Page 122

Target systems Index offset Access Group type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000024 Read/Write every REAL64 1 [1.0E-12 ... Component of the NEW from TC3 1.0E+30] scaling factor: Writing is not denominator allowed if the (=> scaling factor controller numerator / scaling enable has factor denominator) been issued. Default: 1.0 0x00000025 Read/Write every { e.g. mm/ [1.0E-12 ... Component of the NEW from TC3 REAL64 INC 1.0E+30] scaling factor: REAL64 1 [1.0E-12 ... numerator } 16 bytes 1.0E+30] Component of the scaling factor: denominator (=> scaling factor numerator / scaling factor denominator) 0x00000030 Read/Write every UINT32 1 Internal encoder NEW from TC3 control double word for specifying the operation modes and properties 0x00000101 Read/Write INC UINT16 1 [0,1] inverse search direction for ref.cam? 0x00000102 Read/Write INC 1 [0,1] inverse search direction for sync pulse? 0x00000103 Read/Write INC REAL64 e.g. mm [±1.0E+9] Reference position 0x00000104 Read/Write INC UINT16 1 [0,1] distance monitoring Not between Ref. cams implemented! and sync pulse active? 0x00000105 Read/Write INC UINT32 INC [0 ...65536] minimum distance Not between Ref. cams implemented! and sync pulse in increments 0x00000106 Read/Write INC UINT16 1 [0,1] external sync pulse? 0x00000107 Read/Write INC UINT32 1 s. ENUM (>0) Referencing mode (Sync Condition) [} 168] 0x00000108 Read/Write INC UINT32 1 [0x0000000F... Encoder Sub Mask NEW 0x FFFFFFFF]bi (maximum value of the see also param. nary mask: (2n - absolute range of the "Encoder Mask" 1) encoder actual value in increments) Used, for example, as a reference mark for the referencing mode "Software Sync" and for the NC Retain Data "ABSOLUTE (MODULO)", "INCREMENTAL (SINGLETURN ABSOLUTE)". Note 1: The Encoder Sub Mask must be smaller than or equal to the Encoder Mask. Note 2: The Encoder Mask must be an integer multiple of the Encoder Sub Mask. Note 3: The Encoder Sub Mask must be a continuous sequence of binary ones (2n-1), e.g. 0x000FFFFF. 122 Version: 1.3.1 Twin CAT 3
## Page 123

Target systems Index offset Access Group type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000109 Read/Write INC UINT32 1 s. ENUM (≥0) Homing Sensor Source [} 168] Sets the source of the digital input of the referencing cam. 0x00000110 Read/Write INC (encoder REAL64 1 [0.0 ... scaling/weight of the simulation) 1000000.0] noise part for the simulation encoder Twin CAT 3 Version: 1.3.1 123
## Page 124

Target systems 3.2.1.5.4.5.2 "Index offset" specification for encoder state (Index group 0x5100 + ID) 124 Version: 1.3.1 Twin CAT 3
## Page 125

Target systems Index offset Access Group type Data type Phys. Definition Description Note (Hex) unit range 0x00000001 Read every INT32 Error state encoder 0x00000002 Read every REAL64 Actual position (charge Symbolic with actual position access compensation value) possible! 'Act Pos' 0x00000003 Read every REAL64 Modulo actual position Symbolic access possible! 'Act Pos Modulo' 0x00000004 Read every INT32 Modulo actual rotation 0x00000005 Read every REAL64 Optional: Actual Base unit / s velocity Symbolic access possible! 'Act Velo‘ 0x00000006 Read every REAL64 Optional: Actual Base unit / s^2 acceleration Symbolic access possible! 'Act Acc‘ 0x00000007 Read every INT32 Encoder actual increments 0x00000008 Read every INT64 Software - actual increment counter 0x00000009 Read/Write every UINT16 Reference flag ("calibrate flag") 0x0000000A Read every REAL64 Actual position correction value (measuring system error correction) 0x0000000B Read every REAL64 Actual position without actual position compensation value 0x0000000C Read every REAL64 e.g. mm Actual position compensation value due to the dead time compensation 0x0000000D Read every REAL64 s Sum of time shift for encoder dead time compensation (parameterized and variable dead time)Note: A dead time is specified in the system as a positive value. 0x0000000E Read every REAL64 e.g. mm Internal position offset as a correction value for a value reduction to the base period (modulo range) 0x00000010 Read every REAL64 e.g. mm/ Actual velocity without s actual position compensation value 0x00000012 Read every REAL64 e.g. mm Unfiltered actual position (charge with actual position compensation value) 0x00000013 Read every REAL64 e.g. mm Filtered actual position (offset with actual position correction value, without dead time compensation) 0x00000014 Read Type: So E, REAL64 e.g. mm/ Optional: actual drive Base Unit / s Co E, MDP 742 s velocity (transferred NEW from directly from So E, Co E TC3.1 or MDP 742 drive) B4020.30 0x00000015 Read every REAL64 e.g. mm/ Optional: Unfiltered Base Unit / s s actual velocity Twin CAT 3 Version: 1.3.1 125
## Page 126

Target systems Index offset Access Group type Data type Phys. Definition Description Note (Hex) unit range 0x00000016 Read every READ(16 bytes Read the actual * N) position buffer { UINT32 ns ≥0 Dc Time Stamp with 32 bits UINT32 Reserve REAL64 e.g. mm ±∞ Actual position for the associated timestamp } [N] 0x00000017 Read REAL64 e.g. mm Reading out the MC_Set Position offset 0x00000101 Read INC REAL64 e.g. mm Read back the position Cannot be difference between the traced by hardware latch being oscilloscope! activated and becoming valid 0x00000200 Read Write Function WRITE(24 Read "Touch Probe" Only for SAF- group bytes) state (state of external port 501 "Touch Probe V latch) 2": - SERCOS/ { So E UINT32 1 [1,2,3,4] Probe unit (probe 1, 2, - Ether CAT/ 3, 4) Co E UINT32[5] Reserved (CANopen DS402) } - Soft Drive READ(64 (TCom), bytes) - MDP 511 { (EL5101, EL5151, UINT32 1 [0/1] Touch probe rising EL5021, edge active? EL7041, UINT32 1 [0/1] Touch probe rising EL7342) edge became valid? REAL64 e.g. mm Touch probe rising edge position value UINT32 1 ≥0 Touch probe rising edge counter (continuous mode) UINT32 Reserved UINT32 1 [0/1] Touch probe falling edge active? UINT32 1 [0/1] Touch probe falling edge became valid? REAL64 e.g. mm Touch probe falling edge position value UINT32 1 ≥0 Touch probe falling edge counter (continuous mode) UINT32[5] Reserved } 0x00000201 Read KL5101, UINT16 1 [0,1] "External latch Cannot be SERCOS, function" active? traced by AX2xxx, or oscilloscope! Provi Drive "Touch probe function" active ? (edge- independent) 0x00000201 Read CANopen UINT32[4] 1 [0,1] "External latch Cannot be functions 1 to 4" traced by active? oscilloscope! or "Touch probe functions 1 to 4" active? 126 Version: 1.3.1 Twin CAT 3
## Page 127

Target systems Index offset Access Group type Data type Phys. Definition Description Note (Hex) unit range 0x00000202 Read KL5101, UINT16 1 [0,1] External latch value see also Axis SERCOS, became valid? interface AX2xxx, Nc To Plc (state or Provi Drive double word) touch probe latched? (edge-independent) 0x00000202 Read CANopen UINT32[4] 1 [0,1] External latch values 1 see also Axis to 4 became valid? interface Nc To Plc (state or double word) touch probes 1 to 4 latched? 0x00000203 Read KL5101, UINT32 INC External / touch probe SERCOS, hardware incremental AX2xxx, latch value Provi Drive 0x00000204 Read KL5101, UINT64 INC External / touch probe SERCOS, Software incremental AX2xxx, latch value Provi Drive 0x00000205 Read KL5101, REAL64 e.g. mm External / touch probe Base Unit SERCOS, position latch value AX2xxx, Provi Drive 0x00000205 Read CANopen REAL64[4] e.g. mm External touch probe Base Unit values / position latch values 0x00000206 Read KL5101, UINT32 INC Difference hardware Cannot be SERCOS, incremental latch traced by AX2xxx, values (New Latch - oscilloscope! Provi Drive Last Latch) 0x00000207 Read KL5101, UINT64 INC Difference software Cannot be SERCOS, incremental latch traced by AX2xxx, values (New Latch - oscilloscope! Provi Drive Last Latch) 0x00000208 Read KL5101, REAL64 e.g. mm Difference position Cannot be SERCOS, latch values traced by AX2xxx, (New Latch - oscilloscope! Provi Drive Last Latch) Base Unit 0x00000210 Read KL5101, UINT16 1 [0,1] "External latch Cannot be AX2xxx, function" for rising traced by Provi Drive edge active? oscilloscope! or "Touch probe function" for rising edge active? 0x00000210 Read CANopen UINT16[4] 1 [0,1] "External latch Cannot be function" for rising traced by edge active? oscilloscope! or "Touch probe function" for rising edge active? 0x00000211 Read KL5101, UINT16 1 [0,1] "External latch Cannot be AX2xxx, function" for falling traced by Provi Drive edge active? oscilloscope! or "Touch probe function" for falling edge active? 0x00000211 Read CANopen UINT16[4] 1 [0,1] "External latch Cannot be function" for falling traced by edge active? oscilloscope! or "Touch probe function" for falling edge active? Twin CAT 3 Version: 1.3.1 127
## Page 128

Target systems Index offset Access Group type Data type Phys. Definition Description Note (Hex) unit range 0x00000212 Read CANopen UINT16 1 [0,1] Status of "Touch Cannot be Probe 1" input signal traced by oscilloscope! From TC3.1 B4024.11 0x00000213 Read CANopen UINT16 1 [0,1] Status of "Touch Cannot be Probe 2" input signal traced by oscilloscope! From TC3.1 B4024.11 128 Version: 1.3.1 Twin CAT 3
## Page 129

Target systems 3.2.1.5.4.5.3 "Index offset" specification for encoder functions (Index group 0x5200 + ID) Twin CAT 3 Version: 1.3.1 129
## Page 130

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x0000001A Write every { Set actual position Base Unit encoder/axis UINT32 ENUM s. appendix Actual position type [} 163] (s. appendix) REAL64 mm ±∞ Actual position for encoder/axis Caution when using! } 0x0000001B Write every VOID Re-initialization of the NEW from TC3 actual encoder position Note: Takes effect for reference system „ABSOLUTE MULTITURN RANGE (with single overflow)“ and „ABSOLUTE SINGLETURN RANGE (with single overflow)“. 0x00000200 Write Function group { Activate "Touch Only for SAF- "Touch Probe V2 Probe" (external latch) port 501 ": UINT32 1 [1,2,3,4] Probe unit (probe 1, 2, - SERCOS/ 3, 4) So E, UINT32 1 [0,1] Signal edge (0=rising - Ether CAT/ edge, 1=falling edge) Co E (CANopen UINT32 1 [1,2] Probe mode (1=single, DS402) 2=continuous, ...) - Soft Drive (TCom), UINT32 1 [1,2,3,4; Signal source (1=input - MDP 511 128,129] 1, 2=input 2, ...) (EL5101, UINT32 Reserved EL5151, UINT32 Reserved EL5021, EL7041, } 24 bytes EL7342) 0x00000201 Write KL5101,SERC VOID Activate "External OS,AX2xxx,PR Latch" or activate OFIDrive "measuring probe function" (typically rising edge) 0x00000201 Write CANopen UINT32[4] Activate "External Latch" 1 to 4 or activate "measuring probe function" 1 to 4 (typically rising edge) 0x00000202 Write KL5101,SERC VOID Activate "external OSAX2xxx,PR latch" or activate OFIDrive "measuring probe function" (falling edge) 0x00000202 Write CANopen UINT32[4] Activate "external latch" 1 to 4 or activate "measuring probe function" 1 to 4 (falling edge) 130 Version: 1.3.1 Twin CAT 3
## Page 131

Target systems Index-Offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000205 Write Function group { Deactivate "touch Only for SAF- "Touch Probe V2 probe" (external latch) port 501 ": UINT32 1 [1,2,3,4] Probe unit (probe 1, 2, - SERCOS/ 3, 4) So E, UINT32 1 [0,1] Signal edge (0=rising - Ether CAT/ edge, 1=falling edge) Co E (CANopen UINT32 Reserved DS402) - Soft Drive UINT32 Reserved (TCom), UINT32 Reserved - MDP 511 UINT32 Reserved (EL5101, EL5151, } 24 bytes EL5021, EL7041, EL7342) 0x00000205 Write KL5101,SERC VOID Deactivate "external OS,AX2xxx,PR latch" or deactivate OFIDrive "measuring probe function" 0x00000205 Write CANopen UINT32[4] Deactivate "external latch" or deactivate "measuring probe function" 0x00000210 Write KL5101,SERC REAL64 e.g. mm ±∞ Set "External latch Only for OS,AX2xxx,PR event" and "External Ether CAT: OFIDrive latch position" Twin CAT 3 Version: 1.3.1 131
## Page 132

Target systems 3.2.1.5.4.5.4 "Index offset" specification for cyclic encoder process data (Index group 0x5300 + ID) 132 Version: 1.3.1 Twin CAT 3
## Page 133

Target systems Index offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000000 Read/Write every (NC→IO) { STRUCT s. ENCODER-OUTPUT- Write command encoder STRUCTURE (NC→IO, only optional! interface 40 Byte) Consider safety NCENCODERSTRUCT_ aspects! OUT2 INT32 INC ≥ 0 n Data Out1 INT32 INC ≥ 0 n Data Out2 UINT8 1 ≥ 0 n Ctrl1 UINT8 1 ≥ 0 n Ctrl2 UINT8 1 ≥ 0 n Ctrl3 UINT8 1 ≥ 0 n Ctrl4 INT32 INC ≥ 0 n Data Out3 INT32 INC ≥ 0 n Data Out4 INT32 INC ≥ 0 n Data Out5 INT32 INC ≥ 0 n Data Out6 UINT8 1 ≥ 0 n Ctrl5 UINT8 1 ≥ 0 n Ctrl6 UINT8 1 ≥ 0 n Ctrl7 UINT8 1 ≥ 0 n Ctrl8 INT32 1 ≥ 0 Reserved INT32 1 ≥ 0 Reserved } 40 bytes 0x00000000 Read/Write every { STRUCT Optional ENCODER- Write command (NC→IO), OUTPUT-STRUCTURE only optional! s. encoder optional 64 bit (NC→IO, 80 Byte) interface Consider safety encoder NCENCODERSTRUCT_ aspects! interface OUT3 (e.g. MDP513 NEW from TC3 with 64Bit) UINT64 INC ≥ 0 n Data Out1 UINT64 INC ≥ 0 n Data Out2 UINT64 INC ≥ 0 n Data Out3 UINT64 INC ≥ 0 n Data Out4 UINT64 INC ≥ 0 n Data Out5 UINT64 INC ≥ 0 n Data Out6 UINT64 INC ≥ 0 n Data Out7 UINT64 INC ≥ 0 n Data Out8 UINT16 1 ≥ 0 n Ctrl1 UINT16 1 ≥ 0 n Ctrl2 UINT16 1 ≥ 0 n Ctrl3 UINT16 1 ≥ 0 n Ctrl4 UINT16 1 ≥ 0 n Ctrl5 UINT16 1 ≥ 0 n Com Ctrl INT32 1 ≥ 0 reserved } 80 bytes Twin CAT 3 Version: 1.3.1 133
## Page 134

Target systems Index offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000001 Write Every { STRUCT s. Bitwise access to Write command (NC→IO) encoder only optional! ENCODER-OUTPUT- interface STRUCTURE (NC→IO, Consider safety 40 Byte) aspects! NCENCODERSTRUCT_ OUT2 UINT32 1 [0 … 39] Byte Offset Relative address offset [0..39] in output structure. E. G.: To write “n Control1” the Byte Offset must be 8. UINT32 1 [0x00000000… Bit Select Mask (BSM) 0x FFFFFFFF] The mask defines write enabled bits in a DWORD. Zero bits are protected and remain unaffected. UINT32 1 [0x00000000… Value 0x FFFFFFFF] Only those bits in value are overwritten where BSM equals 1. } 0x00000080 Read every (IO→NC) { STRUCT s. ENCODER-INPUT- encoder STRUCTURE (IO→NC, interface 40 Byte) NCENCODERSTRUCT_I N2 INT32 INC ≥ 0 n Data In1 INT32 INC ≥ 0 n Data In2 UINT8 1 ≥ 0 n State1 UINT8 1 ≥ 0 n State2 UINT8 1 ≥ 0 n State3 UINT8 1 ≥ 0 n State4 (Bit0: Wc State, Bit1: Input Toggle) INT32 INC ≥ 0 n Data In3 INT32 INC ≥ 0 n Data In4 INT32 INC ≥ 0 n Data In5 INT32 INC ≥ 0 n Data In6 UINT8 1 ≥ 0 n State5 UINT8 1 ≥ 0 n State6 UINT8 1 ≥ 0 n State7 UINT8 1 ≥ 0 n State8 INT32 [ns] ≥ 0 n Dc Input Time (absolute/ relative Dc Input Shift for deadtime compensation) INT32 1 ≥ 0 Reserved } 40 bytes 134 Version: 1.3.1 Twin CAT 3
## Page 135

Target systems Index offset Access Group type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000080 Read every { STRUCT s. optional ENCODER- NEW from TC3 (NC→IO), encoder INPUT-STRUCTURE optional 64 bit interface (IO→NC, 80 Byte) encoder NCENCODERSTRUCT_I interface N3 (e.g. MDP513 UINT64 INC ≥ 0 n Data In1 with 64Bit) UINT64 INC ≥ 0 n Data In2 UINT64 INC ≥ 0 n Data In3 UINT64 INC ≥ 0 n Data In4 UINT64 INC ≥ 0 n Data In5 UINT64 INC ≥ 0 n Data In6 UINT64 INC ≥ 0 n Data In7 UINT64 INC ≥ 0 n Data In8 UINT16 1 ≥ 0 n State1 UINT16 1 ≥ 0 n State2 UINT16 1 ≥ 0 n State3 UINT16 1 ≥ 0 n State4 UINT16 1 ≥ 0 n State5 UINT16 1 ≥ 0 n Com State (Bit0: Wc State, Bit1: Input Toggle) INT32 [ns] ≥ 0 n Dc Input Time (absolute/ relative Dc Input Shift for deadtime compensation) } 80 bytes Twin CAT 3 Version: 1.3.1 135
## Page 136

Target systems 3.2.1.5.4.6 Specification Controller 3.2.1.5.4.6.1 "Index offset" specification for controller parameter (Index group 0x6000 + ID) 136 Version: 1.3.1 Twin CAT 3
## Page 137

Target systems Index offset Access Controller type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000001 Read every UINT32 1 [1 ... 255] Controller ID 0x00000002 Read every UINT8[30+1] 1 30 symbol Controller name 0x00000003 Read every UINT32 1 s. ENUM (>0) Controller type [} 165] 0x0000000A Read/Write every UINT32 1 s. ENUM (>0) Controller mode DEFAULT: 1=STANDARD 0x0000000B Read/Write every REAL64 % [0.0 ... 1.0] Weight of the velocity pre control (standard value: 1.0 = 100 %) 0x00000010 Read/Write every UINT16 1 0/1 Following error monitoring positon? 0x00000011 Read/Write every UINT16 1 0/1 Following error monitoring velocity? 0x00000012 Read/Write every REAL64 mm [0.0…1.0E.6] Max. following error position 0x00000013 Read/Write every REAL64 s [0.0...600] Max. following error time position 0x00000014 Read/Write every REAL64 mm/s [0.0…1.0E.6] Max. following error velocity 0x00000015 Read/Write every REAL64 s [0.0…1.0E.6] Max. following error time velocity 0x00000021 Read/Write every REAL64 1 [0.0...1000000. Scaling factor (multiplier) Reserved 0] for position differences function, between master and no standard! slave axis (conversion in the same coordinate system) 0x00000100 Read/Write P/PID (Pos., REAL64 1 [0.0...1.0] Maximum output (Standard (velocity) limitation ( ) for controller value: 0.5 == total output 50%) 0x00000102 Read/Write P/PID (Pos.) REAL64 mm/s/ [0.0...1000.0] Proportional amplification Base unit / s / mm factor k resp. k base unit p v position control 0x00000103 Read/Write PID (Pos.) REAL64 s [0.0 ... 60.0] Integral action time Tn Position control 0x00000104 Read/Write PID (Pos.) REAL64 s [0.0 ... 60.0] Derivative action time Tv position control 0x00000105 Read/Write PID (Pos.) REAL64 s [0.0 ... 60.0] Damping time Td Position control 0x00000106 Read/Write PP (Pos.) REAL64 mm/s/ [0.0...1000.0] Add proportional Base unit / s / mm amplification factor kp base unit resp. kv that applies position control above a limit velocity in percent. 0x00000107 Read/Write PP (Pos.) REAL64 % [0.0...1.0] Threshold level velocity (Standard in percent, above which value: 0.01 == the additional 1%) proportional amplification factor kp resp. kv applies. 0x00000108 Read/Write P/PID (Acc.) REAL64 s [0.0 ... 100.0] proportional amplification Acceleration factor ka pre control 0x0000010A Read/Write every UINT32 1 ENUM Filter for maximum slope Reserved of the nominal velocity function, (acceleration restricted): no standard! 0: Off, 1: Velo, 2: Pos+Velo 0x0000010B Read/Write every REAL64 mm/s^2 Filter value for the Reserved maximum slope of the function, nominal velocity (max. no standard! acceleration) 0x0000010D Read/Write P/PID REAL64 mm [0.0 ... 10000.0] 'dead band' for position Reserved error (position deviation) function (for P/PID-controller with velocity or torque interface) Twin CAT 3 Version: 1.3.1 137
## Page 138

Target systems Index offset Access Controller type Data type Phys. Definition Description Remarks (Hex) unit range 0x0000010F Read/Write P/PP/PID REAL64 (mm/s) / [0.0...1000.0] Slave coupling control: Slave coupling (Pos.) mm control Proportional gain k for slave-control cp position deviation between master and slave 0x00000110 Read/Write P (Pos.) UINT16 1 0/1 Automatic offset calibration: active/passive 0x00000111 Read/Write P (Pos.) UINT16 1 0/1 Automatic offset calibration: hold mode 0x00000112 Read/Write P (Pos.) UINT16 1 0/1 Automatic offset calibration: fading mode 0x00000114 Read/Write P (Pos.) REAL64 % [0.0 ... 1.0] Automatic offset (Standard calibration: value: 0.05 == 5%) pre control limit 0x00000115 Read/Write P (Pos.) REAL64 s [0.1 ... 60.0] automatic offset calibration: time constant 0x00000116 Read/Write PID (Pos.) REAL64 % [0.0...1.0] Maximum output limitation ( ) for I- part in percent (default setting: 0.1 == 10 %) 0x00000117 Read/Write PID (Pos.) REAL64 % [0.0...1.0] Maximum output limitation ( ) for D- part in percent (default setting: 0.1 == 10 %) 0x00000118 Read/Write PID (Pos.) UINT16 1 0/1 Switch off the I-part during an active positioning process (as far as I-part active)? (default setting: 0 = FALSE) 0x00000120 Read/Write P/PID (Pos.) REAL64 s ≥0 PT-1 filter time for Reserved position error (position- function, difference) no standard! 0x00000202 Read/Write P/PID (velocity) REAL64 1 [0.0...1000.0] Proportional amplification Velocity control factor k resp. k p v 0x00000203 Read/Write PID (velocity) REAL64 s [0.0 ... 60.0] Integral-action time T Velocity control n 0x00000204 Read/Write PID (velocity) REAL64 s [0.0 ... 60.0] Derivative action time T Velocity control v 0x00000205 Read/Write PID (velocity) REAL64 s [0.0 ... 60.0] Damping time T Velocity control d 0x00000206 Read/Write PID (velocity) REAL64 % [0.0...1.0] Maximum output Velocity control limitation ( ) for I-part in percent (default setting: 0.1 == 10 %) 0x00000207 Read/Write PID (velocity) REAL64 % [0.0...1.0] Maximum output Velocity control limitation ( ) for D-part in percent (default setting: 0.1 = 10 %) 0x0000020D Read/Write P/PID (velocity) REAL64 mm/s [0.0 ... 10000.0] 'dead band' for velocity Reserved error (velocity deviation) function (for P/PID-controller with velocity or torque interface) 0x00000220 Read/Write P/PID (velocity) REAL64 s ≥0 PT-2 filter time for Velocity control, velocity error (velocity- no standard! difference) 0x00000221 Read/Write P/PID (velocity) REAL64 s ≥0 PT-1 filter time for Reserved velocity error (velocity- function, difference) no standard! 138 Version: 1.3.1 Twin CAT 3
## Page 139

Target systems Index offset Access Controller type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000250 Read/Write P/PI (observer) UINT32 1 s. ENUM (≥0) OBSERVER mode [} 165] for controller with torque interface 0: OFF (default) 1: LUENBERGER 0x00000251 Read/Write P/PI (observer) REAL64 Nm / A >0.0 Motor: torque constant K T 0x00000252 Read/Write P/PI (observer) REAL64 kg m2 >0.0 Motor: moment of inertia J M 0x00000253 Read/Write P/PI (observer) REAL64 Hz [100.0 ... Bandwidth f 0 2000.0] Default: 500 0x00000254 Read/Write P/PI (observer) REAL64 1 [0.0 ... 2.0] Correction factor k c Default: 1.0 0x00000255 Read/Write P/PI (observer) REAL64 s [0.0 ... 0.01] Velocity filter (1. order): Default: 0.001 filter time constant T 0x00000A03 Read/Write PID (MW) REAL64 cm^2 [0.0 ...1000000] Cylinder area A of side A A in cm^2 0x00000A04 Read/Write PID (MW) REAL64 cm^2 [0.0 ...1000000] Cylinder area A of side B B in cm^2 0x00000A05 Read/Write PID (MW) REAL64 cm^3/s [0.0 ...1000000] Nominal volume flow Q in cm^3/s nenn 0x00000A06 Read/Write PID (MW) REAL64 bar [0.0 ...1000000] nominal pressure resp. valve pressure reduction P in bar nenn 0x00000A07 Read/Write PID (MW) UINT32 1 [1 ... 255] Axis ID for the system pressure P o Twin CAT 3 Version: 1.3.1 139
## Page 140

Target systems 3.2.1.5.4.6.2 "Index offset" specification for controller state (Index group 0x6100 + ID) 140 Version: 1.3.1 Twin CAT 3
## Page 141

Target systems Index offset Access Controller type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000001 Read every INT32 Error state controller 0x00000002 Read every REAL64 e.g. mm/ Controller output in Base Unit / s s absolute units Symbolic access possible! "Ctrl Output" 0x00000003 Read every REAL64 % Controller output in Cannot be percent traced by oscilloscope! 0x00000004 Read every REAL64 V Controller output in Cannot be volts traced by oscilloscope! 0x0000000D Read every REAL64 mm Following error Base Unit position (without dead time compensation) 0x0000000E Read every REAL64 mm Following error Base Unit position (without set position correction) 0x0000000F Read every REAL64 mm Following error Base Unit position (with set Symbolic position correction and access dead time possible! compensation) "Pos Diff" 0x00000010 Read every REAL64 mm Peak hold value for Base Unit maximum negative following error of the position 0x00000011 Read every REAL64 mm Peak hold value for Base Unit minimum positive following error of the position 0x00000012 Read every REAL64 mm/s Following error Base Unit / s velocity 0x00000021 Read every REAL64 mm Difference (deviation) Base Unit between the following Symbolic error from master and access possible slave axis (master via axis! error minus slave error) "Pos Diff Couple" 0x00000022 Read every REAL64 mm Peak Hold value for the Base Unit maximum negative difference between master and slave axis following error of the position 0x00000023 Read every REAL64 mm Peak Hold value for the Base Unit maximum positive difference between master and slave axis following error of the position 0x00000101 Read P/PID (pos.) REAL64 e.g. mm/ P-part of the controller s in absolute units 0x00000102 Read PID (pos.) REAL64 e.g. mm/ I-part of the controller s in absolute units 0x00000103 Read PID (pos.) REAL64 e.g. mm/ D-part of the controller s in absolute units 0x00000104 Read PID (pos.) UINT16 1 0/1 Limitation of the I-part active? 0x00000105 Read PID (pos.) UINT16 1 0/1 Limitation of the D-part active? 0x00000106 Read PID (pos.) UINT16 1 0/1 ARW measures for the ARW: Anti I-part active? Reset Windup Twin CAT 3 Version: 1.3.1 141
## Page 142

Target systems Index offset Access Controller type Data type Phys. Definition Description Note ( Hex ) unit range 0x0000010F Read P/PP/PID REAL64 e.g. mm/ Proportion of NEW (veloc.) s automatic offset compensation in absolute units 0x00000110 Read PID (pos.) REAL64 e.g. mm/ Acceleration pre- Acceleration s control Y of the pre-control acc controller in absolute units Note: function depends on controller type! 0x00000111 Read PP (Pos.) REAL64 mm/s/ ≥0 Internal interpolated PP controller mm proportional gain kp or kv 0x0000011A Read P (Pos.) UINT32 1 Set velocity filter: List! Reserved 0x0000011B REAL64 mm function, Internal Phase 0x0000011C REAL64 mm/s no standard! Internal Pos Soll Error! 0x0000011D REAL64 mm/s Test Velo Soll 0x0000011E REAL64 mm/s^2 Internal Limited Velo Sol 0x0000011F REAL64 mm l 0x00000120 REAL64 mm Internal Acc Soll Rel 0x00000121 REAL64 mm/s Internal Pos Soll Rel 0x00000122 REAL64 mm/s^2 Pos Soll Corrected! 0x00000123 REAL64 mm/s Velo Soll Corrected! 0x00000124 REAL64 mm/s^2 Acc Soll Corrected! Test Velo Soll Corrected Test Acc Soll Corrected 0x00000201 Read P,PID (velocity) REAL64 e.g. mm/ Velocity part of the Base Unit / s s controller 0x00000202 Read P,PID (velocity) REAL64 % Velocity part of the Cannot be controller in percent traced by oscilloscope! 0x00000203 Read P,PID (velocity) REAL64 V Velocity part of the Cannot be controller in volts traced by oscilloscope! 0x00000201 Read P/PID (velocity) REAL64 e.g. mm/ P-part of the controller s in absolute units 0x00000202 Read P/PID (velocity) REAL64 e.g. mm/ I-part of the controller s in absolute units 0x00000203 Read P/PID (velocity) REAL64 e.g. mm/ D-part of the controller s in absolute units 0x00000204 Read P/PID (velocity) UINT16 1 0/1 Limitation of the I-part active? 0x00000205 Read P/PID (velocity) UINT16 1 0/1 Limitation of the D-part active? 0x00000206 Read P/PID (velocity) UINT16 1 0/1 ARW measures for the ARW: Anti I-part active? Reset Windup 0x0000020A Read P/PID (velocity) REAL64 e.g. mm/ Total input size of the s velocity controller 0x00000250 Read P/PI (observer) REAL64 e.g. mm Observer: position difference (actual position - observer position 0x00000251 Read P/PI (observer) REAL64 e.g. mm Observer: position 0x00000252 Read P/PI (observer) REAL64 e.g. mm/ Observer: velocity 2 s (for P-part) 0x00000253 Read P/PI (observer) REAL64 e.g. mm/ Observer: velocity 1 s (for I-part) 0x00000254 Read P/PI (observer) REAL64 e.g. mm/ Observer: acceleration s^2 142 Version: 1.3.1 Twin CAT 3
## Page 143

Target systems Index offset Access Controller type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000255 Read P/PI (observer) REAL64 A Observer: motor actual current 0x00000256 Read P/PI (observer) UINT16 1 0/1 Observer: limitation of the I-part active? 0x00000A00 Read PID (MW) REAL64 % [-1.0...1.0] Calculation of the set velocity (pre-control) in percent 0x00000A01 Read PID (MW) REAL64 e.g. mm/ P-part of the controller s in absolute units or percent (according to output weight) 0x00000A02 Read PID (MW) REAL64 e.g. mm/ I-part of the controller s in absolute units or percent (according to output weight) 0x00000A03 Read PID (MW) REAL64 e.g. mm/ D-part of the controller s in absolute units or percent (according to output weight) 0x00000A04 Read PID (MW) UINT16 1 0/1 Limitation of the I-part active? 0x00000A05 Read PID (MW) UINT16 1 0/1 Limitation of the D-part active? 0x00000A10 Read PID (pos.) REAL64 e.g. mm/ Acceleration pre- Acceleration s control Y of the pre-control acc controller in absolute units 3.2.1.5.4.6.3 "Index offset" specification for controller functions (Index group 0x6200 + ID) Index offset Access controller type Data type Phys. Definition Description Remarks (Hex) unit range Twin CAT 3 Version: 1.3.1 143
## Page 144

Target systems 3.2.1.5.4.7 Specification Drive 3.2.1.5.4.7.1 "Index offset" specification for drive parameter (Index group 0x7000 + ID) 144 Version: 1.3.1 Twin CAT 3
## Page 145

Target systems Index offset Access Drive type Data type Phys. Definition Description Note ( Hex ) Unit range 0x00000001 Read every UINT32 1 [1 ... 255] Drive ID 0x00000002 Read every UINT8[30+1] 1 30 characters Drive name 0x00000003 Read every UINT32 1 s. ENUM (>0) Drive type [} 170] 0x00000004 Read/Write every UINT32 1 Byteoffset Input address offset change I/O (IO-Input-Image) address 0x00000005 Read/Write every UINT32 1 Byteoffset Output address offset change I/O (IO-Output-Image) address 0x00000006 Read/Write every UINT16 1 [0,1] motor polarity Writing is not allowed if the controller enable has been issued. 0x0000000A Read/Write every UINT32 1 s. ENUM (>0) drive mode Default: 1 = STANDARD 0x0000000B Read/Write every REAL64 % [-1.0 ... 1.0] Minimum output limit (output limitation) (default setting: -1.0 == -100%) 0x0000000C Read/Write every REAL64 % [-1.0 ... 1.0] Maximum output limit (output limitation) (default setting: 1.0 == 100%) 0x0000000D Read every UINT32 INC Maximum number of output increments (output mask) 0x00000010 Read/Write every UINT32 1 Internal Drive Control Reserved! double word to determine the drive operation modes 0x00000011 Read/Write every UINT32 1 ≥ 5 Internal drive reset Reserved! counter (time in NC cycles for enable and reset) 0x00000020 Read/Write every UINT32 1 see ENUM (≥0) Drive dead time see appendix compensation mode 0: Off (default) 1: On (with velocity) 2: On (with velocity and acceleration) 0x00000021 Read/Write every UINT32 1 Control double word (32 bits) for the drive dead time compensation: Bit 0 = 0: relative IO times (default) Bit 0 = 1: absolute IO times 0x00000022 Read/Write every INT32 ns [±1.0E+9] Sum of the parameterized time shifts for the drive dead time compensation (typically positive numerical values) 0x00000031 Read/Write every REAL64 e.g. %/ [-1.0E+30 ... Scaling factor for NEW from INC 1.0E+30] actual torque value of TC3.1 drive (or actual value of force or current respectively) e.g. AX5xxx: 0.1 => ±100% Twin CAT 3 Version: 1.3.1 145
## Page 146

Target systems Index offset Access Drive type Data type Phys. Definition Description Note ( Hex ) Unit range 0x00000032 Read/Write every REAL64 s [0.0 ... 60.0] P-T1 filter time for NEW from actual torque value TC3.1 (or actual value of force or current respectively) 0x00000033 Read/Write every REAL64 s [0.0 ... 60.0] P-T1 filter time for NEW from temporal derivation of TC3.1 the actual torque value (or actual value of force or current respectively) 0x00000101 Read/Write Servo REAL64 e.g. mm/ >0.0 Reference velocity at Base Unit / s s reference output (velocity pre-control) 0x00000102 Read/Write Servo REAL64 % [0.0 ... 5.0] reference output in percent 0x00000103 Read Servo REAL64 e.g. mm/ >0.0 resulting velocity at Base Unit / s s 100% output 0x00000104 Read/Write Servo REAL64 e.g. mm/ ±∞ velocity offset (DAC Base Unit / s s offset) for drift calibration (offset calibration) of the axis 0x00000105 Read/Write Servo (Sercos, REAL64 1 [0.0 ... velocity scaling For Profi Drive, 100000000.0] (scaling factor to react Sercos, Profi AX200x, to the weight in the Drive, AX200x, CANopen) drive) CANopen 0x00000106 Read/Write Profi Drive UINT32 0.001 * ≥ 0 Profibus/Profi Drive Only for Profi DSC 1/s DSC: position control Drive DSC gain Kpc 0x00000107 Read/Write Profi Drive REAL64 1 ≥ 0.0 Profibus/Profi Drive Only for Profi DSC DSC: scaling for Drive DSC calculating 'XERR' (Default: 1.0) 0x00000109 Read/Write Servo REAL64 1 [0.0 ... Position scaling For Sercos, 100000000.0] (scaling factor to react CANopen to the weight in the drive) 0x0000010A Read/Write Servo REAL64 1 [0.0 ... Acceleration scaling For 100000000.0] (scaling factor to react Sercos, Profi to the weight in the Drive, AX200x, drive) CANopen 0x0000010B Read/Write Servo REAL64 1 [0.0 ... Torque scaling (rotary For 100000000.0] motor) or force scaling Sercos, Profi (linear motor) (scaling Drive, AX200x, factor for reacting to CANopen weighting in the drive) for "Torque Offset" (additive moment as pre-control) 0x0000010C Read/Write Servo REAL64 1 [0.0 ... Torque scaling (rotary For 100000000.0] motor) or force scaling Sercos, Profi (linear motor) (scaling Drive, AX200x, factor for reacting to CANopen weighting in the drive) From TC 3.1 for "Set Torque" B4024.2 (e.g. MC_Torque Control) with Drive Op Mode CST) 0x0000010D Read/Write Servo (Sercos, REAL64 s [0.0 ... 1.0] Damping time for drive For Sercos, CANopen) velocity output CANopen 0x0000010E Read/Write Servo (Sercos, REAL64 s [0.0 ... 1.0] Damping time for drive For Sercos, CANopen) acceleration output CANopen 0x0000010F Read/Write Servo (Sercos, REAL64 s [0.0 ... 1.0] Damping time for drive For Sercos, CANopen) torque output or force CANopen output 146 Version: 1.3.1 Twin CAT 3
## Page 147

Target systems Index offset Access Drive type Data type Phys. Definition Description Note ( Hex ) Unit range 0x00000120 Read/Write Servo/ UINT32 1 ≥ 0 Table ID Only for hydraulics/ KL4xxx, (0: no table) M2400, Universal 0x00000121 Read/Write Servo/ UINT32 1 ≥ 0 Interpolation type 0: Only for hydraulics Linear KL4xxx, 2: Spline M2400, Universal 0x00000122 Read/Write Servo/ REAL64 % [-1.0 ... 1.0] Output offset in Only for hydraulics percent KL4xxx, M2400, Note: Universal Acts according to the characteristic evaluation! 0x00000151 Read/Write Servo / non- REAL64 1 [0.0 ... 100.0] Quadrant linear compensation factor (relationship between quadrant I and III) 0x00000152 Read/Write Servo / non- REAL64 1 [0.01 ... 1.0] Velocity reference linear point in percent (1.0 == 100 %) 0x00000153 Read/Write Servo / non- REAL64 1 [0.01 ... 1.0] Output reference point linear in percent (1.0 == 100%) 0x00000301 Read/Write Stepper motor UINT8 Bit mask: cycle 1 0x00000302 Read/Write Stepper motor UINT8 Bit mask: cycle 2 0x00000303 Read/Write Stepper motor UINT8 Bit mask: cycle 3 0x00000304 Read/Write Stepper motor UINT8 Bit mask: cycle 4 0x00000305 Read/Write Stepper motor UINT8 Bit mask: cycle 5 0x00000306 Read/Write Stepper motor UINT8 Bit mask: cycle 6 0x00000307 Read/Write Stepper motor UINT8 Bit mask: cycle 7 0x00000308 Read/Write Stepper motor UINT8 Bit mask: cycle 8 0x00000310 Read/Write Stepper motor UINT8 Bit mask: holding current Twin CAT 3 Version: 1.3.1 147
## Page 148

Target systems 3.2.1.5.4.7.2 "Index offset" specification for drive state (Index group 0x7100 + ID) 148 Version: 1.3.1 Twin CAT 3
## Page 149

Target systems Index offset Access Drive type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000001 Read every INT32 Error state drive 0x00000002 Read every REAL64 e.g. mm/ Total output in Base unit / s s absolute units Symbolic access possible! "Drive Output" 0x00000003 Read every REAL64 % Total output in percent 0x00000004 Read every REAL64 V Total output in volts Cannot be traced by oscilloscope! 0x00000005 Read every REAL64 e.g. mm/ Peak Hold value for Base Unit / s s maximum negative total output 0x00000006 Read every REAL64 e.g. mm/ Peak Hold value for Base Unit / s s maximum positive total output 0x00000007 Read every REAL64 e.g. Actual torque or actual from TC3.1 100% = force respectively B4022 1000, (typically 100% = Symbolic e.g. Nm 1000) access or N possible! "Act Torque" 0x00000008 Read every REAL64 e.g. Nm/ ±∞ Actual torque change from TC3.1 s or N/s or actual force change B4024 respectively (time derivative of the actual torque or actual force respectively) 0x0000000C Read every REAL64 e.g. mm Set position correction value for drive output on account of dead time compensation 0x0000000D Read every REAL64 s Sum of the time shifts for drive dead time compensation (parameterized and variable dead time) Note: a dead time is specified in the system as a positive value. 0x00000013 Read every REAL64 % Total output in percent (based on non-linear characteristic curve!) 0x00000014 Read every REAL64 V Total output in volt Cannot be (based on non-linear traced by characteristic curve!) oscilloscope! 0x0000011A Read Servo (Sercos, REAL64 e.g. mm Optional output NEW CANopen) filtering: For Sercos, Filtered set position CANopen 0x0000011E Read Servo (Sercos, REAL64 e.g. mm/ Optional output NEW CANopen) s filtering: For Sercos, Filtered set velocity CANopen 0x0000011F Read Servo (Sercos, REAL64 e.g. mm/ Optional output NEW CANopen) s^2 filtering: For Sercos, Filtered set CANopen acceleration / set deceleration Twin CAT 3 Version: 1.3.1 149
## Page 150

Target systems Index offset Access Drive type Data type Phys. Definition Description Note ( Hex ) unit range 0x00000200 Read Write READ: Reading the state of from TC3.1 the digital inputs 1 to 8 B4024.12 UINT32 1 0/1 State of the selected Only for SAF- input Port 501! WRITE: UINT32 1 [1…8] Selection of input 1 to 8 3.2.1.5.4.7.3 "Index offset" specification for drive functions (Index group 0x7200 + ID) Index offset Access Drive type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000102 Write SERVO { Remove and delete the Only for SAF- characteristic drive table port 501! ULONG 1 >0 Table-ID s.a. axis function with index offset 0x00000012 } 150 Version: 1.3.1 Twin CAT 3
## Page 151

Target systems 3.2.1.5.4.7.4 "Index offset" specification for cyclic drive process data (Index group 0x7300 + ID) Twin CAT 3 Version: 1.3.1 151
## Page 152

Target systems Index offset Access Drive type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000000 Read/Write every (NC→IO) { STRUCT s. DRIVE-OUTPUT- Write command drive interface STRUCTURE (NC→IO, only optional! 40 Byte) Consider safety NCDRIVESTRUCT_OUT aspects! 2 INT32 INC ≥ 0 n Out Data1 INT32 INC 2^31 n Out Data2 UINT8 1 ≥ 0 n Control1 UINT8 1 ≥ 0 n Control2 UINT8 1 ≥ 0 n Control3 UINT8 1 ≥ 0 n Control4 INT32 INC ≥ 0 n Out Data3 INT32 INC ≥ 0 n Out Data4 INT32 INC ≥ 0 n Out Data5 INT32 INC ≥ 0 n Out Data6 UINT8 1 ≥ 0 n Control5 UINT8 1 ≥ 0 n Control6 UINT8 1 ≥ 0 n Control7 UINT8 1 ≥ 0 n Control8 INT32 1 ≥ 0 Reserved INT32 1 ≥ 0 Reserved } 0x00000001 Write every (NC→IO) { STRUCT s. Bitwise access to DRIVE- Write command drive interface OUTPUT-STRUCTURE only optional! (NC→IO, 40 Byte) Consider safety NCDRIVESTRUCT_OUT aspects 2 UINT32 1 [0 … 39] Byte Offset Relative address offset [0..39] in output structure. E. G.: To write “n Control1” the Byte Offset must be 8. UINT32 1 [0x00000000… Bit Select Mask (BSM) 0x FFFFFFFF] The mask defines write enabled bits in a DWORD. Zero bits are protected and remain unaffected. UINT32 1 [0x00000000… Value 0x FFFFFFFF] Only those bits in value are overwritten where BSM equals 1. } 152 Version: 1.3.1 Twin CAT 3
## Page 153

Target systems Index offset Access Drive type Data type Phys. Definition Description Remarks (Hex) unit range 0x00000080 Read every (IO→NC) { STRUCT s. DRIVE-INPUT- drive interface STRUCTURE (IO→NC, 40 Byte) NCDRIVESTRUCT_IN2 INT32 INC ≥ 0 n In Data1 INT32 INC ≥ 0 n In Data2 UINT8 1 ≥ 0 n Status1 UINT8 1 ≥ 0 n Status2 UINT8 1 ≥ 0 n Status3 UINT8 1 ≥ 0 n Status4 INT32 INC ≥ 0 n In Data3 INT32 INC ≥ 0 n In Data4 INT32 INC ≥ 0 n In Data5 INT32 INC ≥ 0 n In Data6 UINT8 1 ≥ 0 n Status5 UINT8 1 ≥ 0 n Status6 UINT8 1 ≥ 0 n Status7 UINT8 1 ≥ 0 n Status8 INT32 1 ≥ 0 Reserved INT32 1 ≥ 0 Reserved } Twin CAT 3 Version: 1.3.1 153
## Page 154

Target systems 3.2.1.5.4.8 Specification Tables 3.2.1.5.4.8.1 "Index offset" specification for table parameter (Index group 0x A000 + ID) 154 Version: 1.3.1 Twin CAT 3
## Page 155

Target systems Index offset Access Table type Data type Phys. Definition Description Note (Hex) unit range 0x00000001 Read every UINT32 1 [1 ... 255] Table ID 0x00000002 Read every UINT8[30+1] 1 30 characters Table name 0x00000003 Read every UINT32 1 s. ENUM (>0) Table sub types [} 172] 0x00000004 Read every UINT32 1 s. ENUM (>0) Table main types [} 172] 0x00000010 Read every UINT32 1 [0... 16777216] Number of lines (n) 0x00000011 Read every UINT32 1 [0... 16777216] Number of columns (m) 0x00000012 Read every UINT32 1 ≥0 Number of total elements (n*m) 0x00000013 Read equidistant REAL64 e.g. mm ≥0.0 Step size (position Base Unit table delta) (equidistant tables) 0x00000014 Read cyclical table REAL64 e.g. ≥0.0 Master period (cyclical Base Unit degrees tables) 0x00000015 Read cyclical table REAL64 e.g. ≥0.0 Slave difference per Base Unit degrees master period (cyclic tables) 0x0000001A Read/Write "Motion { Activation type for Modified from Function" (laws online changes of TC3 of motion) table data (MF only) UINT32 ENUM s. appendix Activation mode 0: 'instantaneous' (default) 1: 'master cam pos.' 2: 'master' axis pos.' 3: 'next cycle' 4: 'next cycle once' 5: 'as soon as possible' 6: 'off' 7: 'delete queued data' UINT32 Reserve (TC3) REAL64 e.g. mm ± ∞ Activation position UINT32 ENUM s. appendix Master scaling type 0: user defined (default) 1: scaling with auto offset 2: off UINT32 ENUM s. appendix Slave scaling type 0: user defined (default) 1: scaling with auto offset 2: off } 0x00000020 Read/Write every { Write single value [n,m]: UINT32 1 [0 ... 16777216] n-th line UINT32 1 [0 ... 16777216] m-th column REAL64 e.g. mm ± ∞ Single value } 0x00000021 Read Write every *REAL64 e.g. mm ± ∞ Read slave position for the specified master position (related to the "raw values" in the table) Twin CAT 3 Version: 1.3.1 155
## Page 156

Target systems Index offset Access Table type Data type Phys. Definition Description Note (Hex) unit range 0x00000022 Read Write "Motion Write Read the "Motion Only possible Function" (laws Function" as a "point on a line-by-line of motion) cloud" basis! (integer { multiple) UINT 16 1 0 /1 Prompt consistent data adoption? Changed in TC3 UINT16 1 Bit mask (≥0) Select bit mask (number of columns m is master position plus number of bits): Bit 0: Pos (Slave) Bit 1: Velo (Slave) Bit 2: Acc (Slave) Bit 3: Jerk (Slave) UINT32 Reserve (TC3) REAL64 e.g. mm ± ∞ Startposition (Master) REAL64 e.g. mm > 0.0 Step size } Read { REAL64[x*m] e.g. mm ± ∞ Read from x lines from the master start position: (x*m) values (one or more lines) } 0x00000023 Read Write every Write Read slave values for the specified master position (related to the "raw values" in the table) REAL64 e.g. mm ± ∞ Master position Read { REAL64 e.g. mm ± ∞ Slave position REAL64 mm/s ± ∞ Slave velocity REAL64 mm/s^2 ± ∞ Slave acceleration } 156 Version: 1.3.1 Twin CAT 3
## Page 157

Target systems Index offset Access Table type Data type Phys. Definition Description Note (Hex) unit range 0x00000024 Read Write every Write Calculation of the master position for a given slave position REAL64 e.g. mm ± ∞ Slave position REAL64 e.g. mm Start position of the master REAL64 e.g. mm Offset to the slave position of the cam plate REAL64 1 Scaling of the slave position of the cam plate REAL64 e.g. mm Offset to the master position of the cam plate REAL64 1 Scaling of the master position of the cam plate REAL64 Position accuracy of the master (default: 1.0E-3) REAL64[5] Reserved (40 bytes) Read { UINT32 Lower master position valid UINT32 Upper master position valid REAL64 e.g. mm Lower absolute master axis position REAL64 e.g. mm Upper absolute master axis position REAL64 e.g. mm Lower master cam plate position REAL64 e.g. mm Upper master cam plate position REAL64 e.g. mm Lower slave position offset REAL64 e.g. mm Upper slave position offset REAL64[5] Reserved (40 bytes) } 0x00000050 Read/Write every REAL64 [64] 1 ± ∞ Characteristic values in the table [} 174] 0x00000050 Read Write every Write Read the Modified from characteristic values in TC3 a table in relation to the nominal master velocity REAL64 [64] ... ± ∞ Optional nominal master reference velocity "f Master Velo Nom" (standardized => 1.0 mm/s), the remaining elements are not evaluated Read REAL64 [64] ... ± ∞ Read the characteristic values in a table [} 174] Twin CAT 3 Version: 1.3.1 157
## Page 158

Target systems Index offset Access Table type Data type Phys. Definition Description Note (Hex) unit range 0x00000115 Write monotonic { Set/change the table linear, scaling: monotonic REAL64 1 [ ± 1000000.0] Original weighting of cyclic, the table REAL64 e.g. mm [ ± 1000000.0] Master column position offset REAL64 1 [ ± 1000000.0] Scaling of the master column REAL64 e.g. mm [ ± 1000000.0] Position offset of the slave column REAL64 1 [ ± 1000000.0] Scaling of the slave column REAL64 e.g. mm [ ± 1000000.0] Lower range limit (starting position) REAL64 e.g. mm [ ± 1000000.0] Upper range limit (end position) } 0x01000000 Read/ every { ± ∞ Read/write from x lines Only possible +n-th start line Write[<=167772 REAL64[x*m] } e.g. mm from the nth line: (x*m) on a line-by-line 16] values (one or more basis! (integer lines) Value range n: multiple) [0 ... 16777216] 0x02000000 Read/ every { ± ∞ Read/write x columns Only possible +m-th start Write[<=167772 REAL64[x*n] } e.g. mm from the mth column: on a column- column 16] (x*n) values (one or by-column more columns)Value basis! (integer range m: [0 ... multiple) 16777216] 0x05000000 Read/ "Motion { Read/write x lines from Only possible +n-th start line Write[<=167772 Function" the nth line: (x*m) on a line-by-line 16] (motion laws) structures (one or basis! Data:STRUCT more lines) Value (integer [x*m] range n: [0 ... multiple) 16777216] Modified from UINT32 1 Abs. point index TC3 (not evaluated) UINT16 ENUM Function type 1: Polynomial 1 15: Polynomial 5 UINT16 ENUM Point type 0: default 1: ignore INT32 1 Rel. address index at end point (Default: 1) UINT32 Reserve (TC3) REAL64 mm Master position REAL64 mm Slave position REAL64 mm/s Slave speed REAL64 mm/s^2 Slave acceleration REAL64 mm/s^3 Slave jerk } 158 Version: 1.3.1 Twin CAT 3
## Page 159

Target systems Index offset Access Table type Data type Phys. Definition Description Note (Hex) unit range 0x06000000 Read/ "Motion { Read/write x columns Only possible +m-th start Write[<=167772 Function" from the mth column: on a column- column 16] (motion laws) (x*n) structures (one by-column Data:STRUCT or more columns) basis! [x* n ] Value range m: [0 ... (integer 16777216] multiple) UINT32 1 Abs. point index Modified from (not evaluated) TC3 UINT16 ENUM Function type 1: Polynomial 1 15: Polynomial 5 UINT16 ENUM Point type 0: default 1: ignore INT32 1 Rel. address index at end point (Default: 1) UINT32 Reserve (TC3) REAL64 mm Master position REAL64 mm Slave position REAL64 mm/s Slave speed REAL64 mm/s^2 Slave acceleration REAL64 mm/s^3 Slave jerk } 3.2.1.5.4.8.2 "Index offset" specification for table state (Index group 0x A100 + ID) Index offset Access Table type Data type Phys. Definition Description Remarks (Hex) unit range 0x0000000A Read every INT32 1 ≥ 0 'User Counter' Cannot be (number of table user) traced by oscilloscope! Twin CAT 3 Version: 1.3.1 159
## Page 160

Target systems 3.2.1.5.4.8.3 "Index offset" specification for table functions (Index group 0x A200 + ID) Index offset Access Table type Data type Phys. Definition Description Remarks (Hex) unit range 0x00010000 Write every { Generates table with Table types: dimension (n*m): 1,2,3,4 Dimension: at UINT32 1 s. ENUM (>0) Table type [} 172] (s. least 2x1 appendix) UINT32 1 [2...16777216] Quantity of lines UINT32 1 [1...16777216] Quantity of columns } 0x00010001 Write valve diagram { Generates valve diagram Table types: 1,3 table with dimension Dimension: at (n*m): least 2x1 UINT32 1 s. ENUM (>0) Table type [} 172] (s. appendix) UINT32 1 [2...16777216] Quantitiy of lines UINT32 1 [1...16777216] Quantitiy of columns } 0x00010010 Write "Motion { Generates "Motion Table types: 3,4 Function" Function" table with Dimension: at (law of motion) dimension (n*m): least 2x1 UINT32 1 s. ENUM (>0) Table type (s. appendix) UINT32 1 [2...16777216] Quantity of lines UINT32 1 [1...16777216] Quantity of columns } 0x00020000 Write every VOID Deletes table with Table types: dimension (n*m) 1,2,3,4 0x00030000 Write every VOID Initialized table Initialization is no longer needed, because now it happens automatically in the following casesa) by coupling with table b) by selecting the slave position (s. table para.) 3.2.1.5.4.9 Appendix Enum Channel types Define Channel types 1 Standard 2 Interpreter 3 FIFO 4 Kinematic transformation Enum Interpreter types Define Interpreter types 0 NOT DEFINED 1 NC Interpreter DIN 66025 (GST) 2 NC Interpreter DIN 66025 (Classic Dialect) 160 Version: 1.3.1 Twin CAT 3
## Page 161

Target systems Enum Interpreter Operation modes Define interpreter/channel operation mode 0x0 Default (deactivates the other modes) 0x1 Single block mode in the NC core (Block execution task/SAF) 0x1000 reserved 0x2000 reserved 0x4000 Single block mode in the interpreter Enum Interpolation load log mode Define Load log mode 0 Loader log off 1 Source only 2 Source & Compiled Enum Interpolation Trace mode Define Trace mode 0 Trace off 1 Trace line numbers 2 Trace Source Enum Interpreter state moved to: System Manager interface for the interpreter - interpreter element Enum Group types Define Group types 0 NOT DEFINED 1 PTP-Group + x Slave 2 1D-Group + x Slave 3 2D-Group + x Slave 4 3D-Group + x Slave 5 High/low speed + x Slave 6 Low cost stepper motor (dig. IO) + x Slave 7 Table Group + x Slave 9 Encoder Group + x Slave 11 FIFO Group + x Slave 12 Kinematic Transformation Group + x Slave Enum Curve velocity reduction method moved to: System Manager interface for the interpreter - group element Enum Axis types Define Axis types 0 NOT DEFINED 1 Continuous axis (Servo) 2 Discrete axis (high/low speed) 3 Continuous axis (stepper motor) 5 Encoder axis 6 Continuous axis (with operation mode switch for position/pressure control) 7 Time Base Generator 100 Twin CAT 3 Version: 1.3.1 161
## Page 162

Target systems Enum Stepper motor operation mode Define Stepper motor operation mode 0 NOT DEFINED 1 2-phase excitation (4 cycles) 2 1-2-phase excitation (6 cycles) 3 Power section Enum Override types for PTP axes (velocity override) Define Override types 1 Reduced Old variant, replaced by "(3) Reduced (iterated)" 2 Original Old variant, replaced by "(4) Original (iterated)" 3 Reduced (iterated) Default value: the override value is related to the velocity which is internally reduced in a special case. This results in a directly proportional velocity (=> linear relationship) for the entire override range from 0 to 100%. 4 Original (iterated) The override value is always referred to the velocity programmed by the user. If this velocity cannot be driven, however, then a maximum override value results from which no higher velocity can be reached (=> limitation). Enum Group/axis start types Define Group/axis start types 0 NOT DEFINED 1 Absolute start 2 Relative start 3 Continuous start positive 4 Continuous start negative 5 Modulo start (OLD) 261 Modulo start on the shortest distance 517 Modulo start in positive direction (with modulo tolerance window) 773 Modulo start in negative direction (with modulo tolerance window) 4096 Stop and lock (axis locked for motion commands) 8192 Halt (without motion lock) Enum Command buffer types (buffer mode) for universal axis start (UAS) Define Buffer mode 0 ABORTING (default) (instantaneous, aborts current movement and deletes any buffered commands) 1 BUFFERED (stored in command buffer to be executed after an active movement) 18 BLENDING LOW (buffered, no stop, runs through intermediate target position at the lowest velocity of two commands) 19 BLENDING PREVIOUS (buffered, no stop, runs through intermediate target position at the velocity of the active command) 20 BLENDING NEXT (buffered, no stop, runs through intermediate target position at the velocity of the buffered command) 21 BLENDING HIGH (buffered, no stop, runs through intermediate target position at the highest velocity of two commands) 162 Version: 1.3.1 Twin CAT 3
## Page 163

Target systems Enum End position types (new end position) Define End position types 0 NOT DEFINED 1 Absolute position 2 Relative position 3 Continuous position positive 4 Continuous position negative 5 Modulo position Enum Command types for new end position with new velocity (new end position and/or new velocity) Define Command types for new end position with new velocity 0 NOT DEFINED 1 Position (instantaneous) 2 Velocity (instantaneous) 3 Position and velocity (instantaneous) 9 Position (switching position) 10 Velocity (switching position) 11 Position and velocity (switching position) Enum Actual position types (set actual position) Define Actual position types 0 NOT DEFINED 1 Absolute position 2 Relative position 5 Modulo position Enum Compensation types (section compensation or superimposed) Define Compensation types 0 NOT DEFINED 1 VELOREDUCTION_ADDITIVEMOTION The max. velocity Velocity Diff is reduced. The path over which the compensation trip is effective consists of length + distance. 2 VELOREDUCTION_LIMITEDMOTION The max. velocity Velocity Diff is reduced. The path over which the compensation trip is effective is defined by the Length parameter. 3 LENGTHREDUCTION_ADDITIVEMOTION The max. available path is reduced and consists of length + distance. The system tries to utilize the max. veloc. Velocity Diff. 4 LENGTHREDUCTION_LIMITEDMOTION The max. available path is reduced and is limited by the Length parameter. The system tries to utilize the max. veloc. Velocity Diff. Twin CAT 3 Version: 1.3.1 163
## Page 164

Target systems Enum Slave types Define Slave types 0 NOT DEFINED 1 Linear 2 Flying saw (velocity, jerk restricted profile) 3 Flying saw (position and velocity, jerk restricted profile) 5 Synchronization generator (velocity, jerk restricted profile) 6 Synchronization generator (position and velocity, jerk restricted profile) 10 Tabular 11 Multi-tabular 13 'Motion Function' (MF) 15 Linear with cyclic gearing factor change (ramp filter for acceleration limits) 100 Specific Enum Slave decoupling types (for subsequent axis command) Define Slave decoupling types (for subsequent axis command) 0 Stop, E-stop or P-stop (default) (STOP) 1 Oriented stop (O-stop) (ORIENTEDSTOP) 2 Reduce any acceleration to 0 (force-free) and continue to endless target position (ENDLESS) 3 Continue to endless target position at new requested velocity (ENDLESS_NEWVELO) 4 New end position (NEWPOS) 5 New end position and new requested velocity (NEWPOSANDVELO) 6 Logical decoupling and stopping of axis immediately without velocity ramp (INSTANTANEOUSSTOP) 164 Version: 1.3.1 Twin CAT 3
## Page 165

Target systems Enum Controller types Define Controller types 0 NOT DEFINED 1 P-controller (standard) (Position) 2 PP-controller (with ka) (Position) 3 PID-controller (with ka) (Position) 5 P-controller (Velocity) 6 PI controller (Velocity) 7 High/low speed controller (Position) 8 Stepper motor controller (Position) 9 SERCOS controller (Position in the drive) 10 RESERVED 11 RESERVED 12 RESERVED 13 RESERVED 14 TCom Controller (Soft Drive) (Position in the drive) Enum Controller Observer mode Define Controller observer mode 0 No observer active (default) 1 "Luenberger" observer (classic observer design) Twin CAT 3 Version: 1.3.1 165
## Page 166

Target systems Enum Encoder types Define Encoder types 0 NOT DEFINED 1 Simulation Encoder (Incremental) 2 M3000 Encoder (Multi/Single-Turn) (Absolute) 3 M31x0 / M2000 Encoder (Incremental) 4 MDP 511 Encoder: EL7041, EL7342, EL5101, EL5151, EL2521, EL5021, IP5101 (Incremental) 5 MDP 500/501 Enc.: EL5001, IP5009, KL5001 (SSI) (Absolute) 6 MDP 510 Encoder: KL5051, KL2502-30K Encoder (Bi SSI) (Incremental) 7 KL30xx Encoder (Analog) (Absolute) 8 SERCOS and Ether CAT So E (Position) (Incremental) 9 SERCOS and Ether CAT So E (Position and velocity) (Incremental) 10 Binary encoder (0/1) (Incremental) 11 M2510 Encoder (Absolut) 12 FOX50 Encoder (Absolute) 14 AX2000 (Lightbus) (Incremental) 15 Provi-Drive MC (Simodrive 611U) (Incremental) 16 Universal encoder (variable bit mask) (Incremental) 17 NC rear panel (Incremental) 18 Special CANopen type (e.g. Lenze Drive 9300) (Incremental) 19 MDP 513 (DS402): CANopen and Ether CAT Co E (AX2xx-B1x0/ B510, EL7201) (Incremental) 20 AX2xx-B900 (Ethernet) (Incremental) 21 KL5151 Encoder (Incremental) 24 IP5209 Encoder (Incremental) 25 KL2531/KL2541 Encoder (Stepper Motor) (Incremental) 26 KL2532/KL2542 Encoder (DC motor), KL2535/KL2545 (PWM current terminal) (Incremental) 27 Time base encoder (Time Base Generator) (Incremental) 28 TCom Encoder (Soft Drive) (Incremental) 166 Version: 1.3.1 Twin CAT 3
## Page 167

Target systems Enum Encoder mode Define Encoder mode 0 NOT DEFINED 1 Determination of position 2 Determination of position and velocity 3 Determination of position, velocity and acceleration Enum Encoder evaluation direction (log. counting direction) Define Encoder evaluation direction (log. counting direction) 0 Evaluation in positive and negative counting direction (default configuration, i.e. compatible with the previous state) 1 Evaluation only in positive counting direction 2 Evaluation only in negative counting direction 3 Evaluation neither in positive nor in negative counting direction (evaluation blocked) Not for all encoder types; only for KL5101, KL5151, KL2531, KL2541, IP5209, Universal encoder, etc. Encoder types Encoder evaluation direction KL5101, ... Universal Encoder other types (log. counting direction) 0: positive and negative √ √ — 1: only positive √ √ — 2: only negative √ √ — 3: blocked √ √ — Enum Encoder sign interpretation (data type) Define Sign interpretation (data type) of the encoder actual incre- ments 0 NOT DEFINED (default configuration, i.e. compatible with the previous state) 1 UNSIGNED: unsigned interpretation of the encoder actual increments 2 SIGNED: signed interpretation of the encoder actual increments For KL30xx/KL31xx only for the time being Enum Encoder absolute dimensioning system Define Encoder absolute dimensioning system 0 INC: Incremental absolute dimension system with underflow and overflow offset (default, i.e. compatible with the previous state) 1 ABS: Absolute dimension system without underflow and overflow offset (no underflow or overflow of the encoder allowed) 2 ABS MODULO: Conditionally absolute dimension system, since it has underflow and overflow offset (absolute value that modulo (endless) continues) Not for all encoder types; only for Profi Drive MC, M3000, KL5001/EL5001, IP5009, SERCOS, UNIVERSAL, etc. Twin CAT 3 Version: 1.3.1 167
## Page 168

Target systems Enum referencing mode for incremental encoder Define Parameter text Referencing mode for incremental encoder 0 Default NOT DEFINED (default assignment, i.e. compatible with the previous status) 1 Homing Sensor Only (PLC cam or digital input) Latch event: shutdown of the PLC cam (negative edge) 2 Hardware Sync (feedback reference pulse) Latch event: hardware sync pulse (zero track) 3 Hardware Latch 1 (pos. Edge) Latch event: external hardware latch with positive edge (measuring probe or, respectively, measurement on the fly with positive edge) 4 Hardware Latch 1 (neg. Edge) Latch event: external hardware latch with negative edge (measuring probe or, respectively, measurement on the fly with negative edge) 5 Software Sync Latch event: synthetically emulated software sync pulse (software zero track); PREREQUISITE: absolute per motor revolution, e.g. resolver! 6 Hardware Latch 1 (pos. Edge), Drive defined Latch event: hardware latch event defined in the drive with positive edge (e.g. for Soft Drive) 7 Hardware Latch 1 (neg. edge), Drive defined Latch event: hardware latch event defined in the drive with negative edge (e.g. for Soft Drive) 20 Application (PLC code) User-specific implementation of referencing (PLC code): user request is signaled to the PLC by means of the Application Request bit : latch event Encoder types 0: not defined 1: PLC cam (neg. 2: hardware sync 3: external hard- 4: external hard- 5: software sync edge) pulse (zero/C- ware latch with ware latch with pulse (software track) pos. edge neg. edge zero track) AX2xxx-B200 — √ √ √ √ √ (resolver only) (Lightbus) AX2xxx-B510 — √ — — — √ (CANopen) (resolver only) (see "Reference mask" parameter) AX2xxx-B1x0 — √ √ √ √ √ (Ether CAT) (resolver only) (fixed 20-bit) AX2xxx-B900 — √ √ √ √ √ (resolver only) (Ethernet) Sercos — √ √ √ √ √ (see "Reference (AX5xxx specific mask" parameter) implemented) Profi Drive — √ √ √ √ √ KL5101 — √ √ √ √ √ IP5109 KL5111 — √ √ — — √ KL5151 — √ √ √ √ √ (not meaningful) IP5209 — √ √ — — √ (not meaningful) CANopen (e.g. — √ — √ (input E1) √ (input E2) √ (resolver only) Lenze) (fixed 16-bit) other types — — — — — — Enum Homing Sensor Source The parameter sets the source of the digital input of the referencing cam (homing sensor). At the same time it is determined whether the signal is Active High or Active Low. 168 Version: 1.3.1 Twin CAT 3
## Page 169

Target systems Define Parameter text Homing Sensor Source 0 Default: PLC cam (MC_Home) Referencing cam is provided by the PLC. Input b Calibration Cam of the MC_Home function block. 1 Digital Input 1 (Active High), device Drive->Inputs->n State8.bit0 dependent mapping or E1 of MDP703/733 device e.g. 7031,7041,7201,7411 2 Digital Input 2 (Active High), device Drive->Inputs->n State8.bit1 dependent mapping or E2 of MDP703/733 device e.g. L7031,7041,7201,7411 3 Digital Input 3 (Active High) Drive->Inputs->n State8.bit2 4 Digital Input 4 (Active High) Drive->Inputs->n State8.bit3 5 Digital Input 5 (Active High) Drive->Inputs->n State8.bit4 6 Digital Input 6 (Active High) Drive->Inputs->n State8.bit5 7 Digital Input 7 (Active High) Drive->Inputs->n State8.bit6 8 Digital Input 8 (Active High) Drive->Inputs->n State8.bit7 9 Digital Input 1 (Active Low), device Drive->Inputs->n State8.bit2 dependent mapping 10 Digital Input 2 (Active Low), device Drive->Inputs->n State8.bit0 dependent mapping or E1 of MDP703/733 device e.g. L7031,7041,7201,7411 11 Digital Input 3 (Active Low) Drive->Inputs->n State8.bit1 or E2 of MDP703/733 device e.g. L7031,7041,7201,7411 12 Digital Input 4 (Active Low) Drive->Inputs->n State8.bit2 13 Digital Input 5 (Active Low) Drive->Inputs->n State8.bit3 14 Digital Input 6 (Active Low) Drive->Inputs->n State8.bit4 15 Digital Input 7 (Active Low) Drive->Inputs->n State8.bit5 16 Digital Input 8 (Active Low) Drive->Inputs->n State8.bit6 Digital Input [1-8] A digital input linked to the NC process is used. For this purpose, a general Drive Status Byte with 8 digital inputs is defined in the process image (Drive->Inputs->n State8), which can serve as a signal source for the homing sensor. A digital input to be used must therefore be mapped manually to the desired position in this byte. The digital inputs 1 and 2 may differ depending on the hardware used. For the MDP703/733 hardware (e.g. EL7031, EL7041, EL7201, EL7411) the direct digital inputs E1 and E2 of the terminal are used instead, which are located in the Drive.n State2 byte of the terminal at bit position 3 (E1) and 4 (E2). The lower two bits of Drive.n State8 are not assigned in this case. Twin CAT 3 Version: 1.3.1 169
## Page 170

Target systems Enum Drive types Define Drive types 0 NOT DEFINED 1 Analog Servo Drive: M2400 DAC 1 (Analog) 2 Analog Servo Drive: M2400 DAC 2 (Analog) 3 Analog Servo Drive: M2400 DAC 3 (Analog) 4 Analog Servo Drive: M2400 DAC 4 (Analog) 5 MDP 252 Drive: Analog Servo Drive: KL4xxx, KL2502-30K (Analog) 6 MDP 252 Drive: Analog Servo Drive (non-linear): KL4xxx, KL2502-30K (Analog) 7 High/low speed drive (Digital) 8 Stepper motor drive (Digital) 9 SERCOS-Drive (Digital) 10 MDP 510 Drive: KL5051 (Bi SSI-Interface) (Digital) 11 AX2000 (Lightbus) (Digital) 12 Provi-Drive MC (Simodrive 611U) (Digital) 13 Universal Drive (Analog) 14 NC rear panel (Analog) 15 Special CANopen type (e.g. Lenze Drive 9300) (Digital) 16 MDP 742 (DS402): CANopen and Ether CAT Co E (AX2xx-B1x0/ B510) (Digital) 17 AX2xx-B900 Drive (Ethernet) (Digital) 20 KL2531/KL2541 Encoder (Stepper Motor) (Digital) 21 KL2532/KL2542 Encoder (DC motor), KL2535/KL2545 Encoder (PWM current terminal) (Digital) 22 TCom Drive (Soft Drive) (Digital) 23 MDP 733 Drive: Profile MDP 733 (EL7332, EL7342, EP7342) (Digital) 24 MDP 703 Drive: Profile MDP 703 (EL7031, EL7041, EP7041) (Digital) Enum Drive-Output-Start types Define Enum Drive-Output-Start types 0 NOT DEFINED 1 Output value in percent 2 Output as velocity, e.g. m/min 170 Version: 1.3.1 Twin CAT 3
## Page 171

Target systems Enum Drive Operation Mode Define Drive Operation Mode (generic operation modes independent from drive) 0 DEFAULT Mode (reactivates the NC default operation mode if mode is known) 1 (standard type) torque control 2 (standard type) velocity control with feedback 1 3 (standard type) velocity control with feedback 2 4 (standard type) position control with feedback 1 (lag less) 5 (standard type) position control with feedback 2 (lag less) 6 (CANopen/Co E specific) torque control with commutation angle 17 (oversampling type) torque control using dynamic container 18 (oversampling type) velocity control with feedback 1 using dynamic container 19 (oversampling type) velocity control with feedback 2 using dynamic container 20 (oversampling type) position control with feedback 1 (lag less) using dynamic container 21 (oversampling type) position control with feedback 2 (lag less) using dynamic container 38 (CANopen/Co E specific) IO drive controlled homing mode (for third party devices) 100 (Sercos/So E specific) Sercos/So E primary operation mode 0 (s. S-0-0032) 101 (Sercos/So E specific) Sercos/So E secondary operation mode 1 (s. S-0-0033) 102 (Sercos/So E specific) Sercos/So E secondary operation mode 2 (s. S-0-0034) 103 (Sercos/So E specific) Sercos/So E secondary operation mode 3 (s. S-0-0035) 104 (Sercos/So E specific) Sercos/So E secondary operation mode 4 (s. S-0-0284) 105 (Sercos/So E specific) Sercos/So E secondary operation mode 5 (s. S-0-0285) 106 (Sercos/So E specific) Sercos/So E secondary operation mode 6 (s. S-0-0286) 107 (Sercos/So E specific) Sercos/So E secondary operation mode 7 (s. S-0-0287) Enum Moving phases / Movement state for master axes Define Moving phases / Movement state (distinction between internal and external setpoint generation) Internal setpoint generation 0 Setpoint generator not active (INACTIVE) 1 Setpoint generator active (RUNNING) 2 Velocity override is zero (OVERRIDE_ZERO) 3 Constant velocity (PHASE_VELOCONST) 4 Acceleration phase (PHASE_ACCPOS) 5 Deceleration phase (PHASE_ACCNEG) External setpoint generation: 41 External setpoint generation active (EXTSETGEN_MODE1) 42 Internal and external setpoint generation active (EXTSETGEN_MODE2) Enum Moving phases / Movement state for slave axes Define Moving phases / Movement state 0 Slave generator not active (INACTIVE) 11 Slave is in a movement pre-phase (PRE-PHASE) 12 Slave is synchronizing (SYNCHRONIZING) 13 Slave is synchronized and moves synchronously (SYNCHRON) Only for slaves of the type synchronization generator for the time being Twin CAT 3 Version: 1.3.1 171
## Page 172

Target systems Enum Table main types Define Table main types 1 (n*m) Cam plate tables (Camming) 10 (n*m) Characteristic curves tables (Characteristics) (e.g. hydraulic valve characteristic curves) Only non-cyclic table sub-types (1, 3) are supported! 16 (n*m) "Motion Function" tables (MF) Only non-equidistant table sub-types (3, 4) are supported! Enum Table sub-types Define Table sub types 1 (n*m) Table with equidistant master positions and no cyclic continuation of the master profile (equidistant linear) 2 (n*m) Table with equidistant master positions and cyclic continuation of the master profile (equidistant cyclic) 3 (n*m) Table with non-equidistant, but strictly monotonously increasing master positions and a non-cyclic continuation of the master profile (monotonously linear) 4 (n*m) Table with non-equidistant, but strictly monotonously increasing master positions and a cyclic continuation of the master profile (monotonously cyclic) Enum Table interpolation types Define Table interpolation types between the reference points 0 Linear interpolation (NC_INTERPOLATIONTYPE_LINEAR) (Standard) 1 4-point interpolation (NC_INTERPOLATIONTYPE_4POINT) (for equidistant table types only) 2 Cubic spline interpolation of all reference points ("global spline") (NC_INTERPOLATIONTYPE_SPLINE 3 Sliding cubic spline interpolation via n interpolation points ("local spline") (NC_INTERPOLATIONTYPE_SLIDINGSPLINE) Enum table operation mode Define Table operation mode for adding, exchange and removal of ta- bles 0 (default) 1 Additive – addition of a further table 2 Exchange – replacement of an existing table with a new table 3 Remove – removal of an existing table 172 Version: 1.3.1 Twin CAT 3
## Page 173

Target systems Structure of tabular (cam) coupling informationen Tables (CAM) Coupling information n Table ID; 1. cam table ID n Table Main Type; 2. e.g. CAMMING, CHARACTERISTIC, MOTIONFUNCTION n Table Sub Type; 3. e.g. EQUIDIST_LINEAR, EQUIDIST_CYCLE, NONEQUIDIST_LINEAR, NONEQUIDIST_CYCLE n Interpolation Type; 4. e.g. LINEAR, 4POINT, SPLINE n Number Of Rows; 5. number of rows/elements n Number Of Columns; 6. number of columns f Master Cam Start Pos 7. master camming start position (first point in tabular) f Slave Cam Start Pos 8. slave camming start position (first point in tabular) f Raw Master Period; 9. master period/cycle (raw value, not scaled) f Raw Slave Stroke; 10. slave difference per master period/cycle (raw value, not scaled) f Master Axis Coupling Pos 11. total absolute master offset of cam origin when slave has been coupled f Slave Axis Coupling Pos 12. total absolute slave offset of cam origin when slave has been coupled n Master Absolute 13. master absolute position (0/1) n Slave Absolute 14. slave absolute position (0/1) f Master Offset; 15. total master offset f Slave Offset; 16. total slave offset f Master Scaling; 17. total master scaling f Slave Scaling; 18. total slave scaling f Sum Of Slave Strokes 19. sum of the slave srokes up to “f Actual Master Axis Pos” f Sum Of Superposition Distance 20. sum of superposition distance (position compensation offset) f Actual Master Axis Pos; 21. actual master axis setpos (absolute) f Actual Slave Axis Pos; 22. actual slave axis setpos (absolute) f Actual Master Cam Pos; 23. actual master cam setpos f Actual Slave Cam Pos; 24. actual master cam setpos n Slave State DWord 25. slave state DWORD (s. Axis Ref) . . . . . . . . . Twin CAT 3 Version: 1.3.1 173
## Page 174

Target systems Structure of the characteristic values Characteristic values f Master Velo Nom; 1. master nominal velocity (standardized: => 1.0) f Master Pos Start; 2. master start position f Slave Pos Start; 3. slave start position f Slave Velo Start; 4. slave start velocity f Slave Acc Start; 5. slave start acceleration f Slave Jerk Start; 6. slave start jerk f Master Pos End; 7. master end position f Slave Pos End; 8. slave end position f Slave Velo End; 9. slave end velocity f Slave Acc End; 10. slave end acceleration f Slave Jerk End; 11. slave end jerk f MPos At SPos Min; 12. master pos. at slave min. position f Slave Pos Min; 13. slave minimum position f MPos At SVelo Min; 14. master pos. at slave min. velocity f Slave Velo Min; 15. slave minimum velocity f MPos At SAcc Min; 16. master pos. at slave min. acceleration f Slave Acc Min; 17. slave minimum acceleration f SVelo At SAcc Min; 18. slave velocity at slave min. acceleration f Slave Jerk Min; 19. slave minimum jerk f Slave Dyn Mom Min; 20. slave minimum dynamic momentum (NOT SUPPORTED YET!) f MPos At SPos Max; 21. master pos. at slave max. position f Slave Pos Max; 22. slave maximum position f MPos At SVelo Max; 23. master pos. at slave max. velocity f Slave Velo Max; 24. slave maximum velocity f MPos At SAcc Max; 25. master pos. at slave max. acceleration f Slave Acc Max; 26. slave maximum acceleration f SVelo At SAcc Max; 27. slave velocity at slave max. acceleration f Slave Jerk Max; 28. slave maximum jerk f Slave Dyn Mom Max; 29. slave minimum dynamic momentum (NOT SUPPORTED YET!) f Slave Velo Mean; 30. slave mean absolute velocity f Slave Acc Eff; 31. slave effective acceleration n Cam Table ID; 32. Cam table ID n Number Of Rows; 33. Number of rows/entries e.g. number of points n Number Of Colums; 34. Number of columns (typically1 or 2) n Cam Table Type; 35. cam table type (10=EQUIDIST, 11=NONEQUIDIST, 22=MOTIONFUNC, 23=CHARACTERISTIC) n Periodic; 36. linear or cyclic/periodic n Reserved 37. reserved Enum Axis control loop switch types Define Axis control loop switch types 0 NOT DEFINED 1 Simple switching (similar to an axis reset) (STANDARD) 2 Switching/synchronization by means of I/D-part of the controller to an internal initial value (jerk-free/smooth) 3 Switching/synchronization by means of I/D-part of the controller to a parameterizable initial value 174 Version: 1.3.1 Twin CAT 3
## Page 175

Target systems 3.2.2 Ams NAT 3.2.2.1 Introduction For a better understanding of the Ams NAT function it is important to know the difference between ADS and AMS and to know what an ADS route is. ADS (Automation Device Specification) is the Twin CAT communication protocol that specifies the interaction between two ADS devices. For example, it defines what operations can be executed on another ADS device, what parameters are necessary for that and what return value is sent after execution. AMS (Automation Message Specification) specifies the exchange of the ADS data. A major component of the communication protocol is the Ams Net Id. This is specified in the AMS/ADS package for the source and target device. An ADS device can be explicitly addressed using the Ams Net Id. A route between two devices must be setup in Twin CAT so that they can communicate. This route is configured on both sides and typically contains the route name, the Ams Net Id and the address of the communication partner as well as the type of connection. The configuration of new routes and an overview of existing routes in a Twin CAT system are shown in the following figure. If the hardware should be scanned on the target, relative Net IDs have to be used: Twin CAT 3 Version: 1.3.1 175
## Page 176

Target systems 3.2.2.2 General description The Ams NAT function enables XAE systems to establish routes to two or more controllers having the same Ams Net Id (Figure 2). Beyond that, Ams NAT offers a solution with which different ADS devices with the same Ams Net Id can communicate with one another via ADS. Virtual Ams Net Ids are used with Ams NAT. A virtual Ams Net Id is a unique address for a connected ADS device that is replaced by the real Ams Net Id of the target system during communication. This means that the Ams NAT function ensures, in all communication that takes place via ADS, that the Ams Net Id of the target system is replaced. 176 Version: 1.3.1 Twin CAT 3
## Page 177

Target systems Fig. 1: Communication with/between Twin CAT systems with the same Net Id 3.2.2.3 Motivation A frequently occurring application in series mechanical engineering is the cloning (i.e. the making of a 1:1 copy) of a controller. When using Twin CAT, the result of this is that all cloned instances possess the same Ams Net Id. This is not a problem at first. However, if the cloned instances are to be connected in parallel with the same engineering system or are to communicate with one another by ADS, this is initially impossible because the Ams Net Id is not unique. The Ams NAT function removes precisely this restriction by virtue of the fact that the systems work with virtual Ams Net Ids. These can be configured with very little effort. The Ams NAT function can be used for any route to an ADS device. This provides a high degree of flexibility and the Ams Net Ids no longer have to be adapted to the machine computers, which leads to a significant reduction in time and effort for configuration. 3.2.2.4 Functioning The way Ams NAT functions will now be explained on the bases of a typical application. In the application case, a Twin CAT engineering system and two Twin CAT runtimes exist with the same Amd Net Id and IP address. The configuration is illustrated in Figure 3. The engineering system is to send an Ads Read command to PLC 1, from which a corresponding response is expected. Since both runtimes possess an Twin CAT 3 Version: 1.3.1 177
## Page 178

Target systems identical IP address, two IP NATs are additionally used. Their task is to implement unambiguous addressing. In order to do so, the first three positions of the local IP address are replaced by the first three positions of the global IP address or vice versa, depending on the direction of communication. In the first step of the application example, the engineering system sends an Ads Read command to PLC 1. Since this Amd Net Id is a virtual one, the Twin CAT system service replaces it by the remote Ams Net Id 5.19.8.122.1.1 with the help of its routing table. This is the real Ams Net Id existing on the system. It is entered in the field "Ams Net Id Target" of the AMS packet. Fig. 2: Sequence for sending an Ads Read command using Ams NAT The Twin CAT system service of PLC 1 relays the AMS packet unchanged. PLC 1 executes the Ads Read command and then sends the corresponding response to the engineering system. Figure 4 shows the communication sequence for the response. Fig. 3: Sequence for sending the response to an Ads Read command 178 Version: 1.3.1 Twin CAT 3
## Page 179

Target systems For the response, the Twin CAT system service of PLC 1 initially relays the AMS packet unchanged. It subsequently reaches the Twin CAT system service of the engineering system. Since the real Ams Net Id of PLC 1 is entered in the field "Ams Net Id Source" of the AMS packet, it must be replaced by the virtual Ams Net Id on the basis of the routing table. The engineering system can then clearly assign and process the response. When using the Ams NAT function the transmitted data are not changed, only the AMS header. Therefore it should be noted that if configuration data contain the Ams Net Id this can lead to the virtual Ams Net Id being used. One possibility for the engineering of I/O devices is the use of relative Ams Net Ids. In this case the last two characters of the Ams Net Id are taken into account and the first four characters are ignored. 3.2.2.5 Configuration To configure Ams NAT, open the file Static Routes.xml, which is located in the Twin CAT installation directory under the path Twin CAT\3.1\Target. In this file, define the attribute "Remote Net Id" for each route as shown subsequent. <?xml version="1.0" encoding="UTF-8"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:no Namespace Schema Location="http://www.beckhoff.com/schemas/2015/12/Tc Config"> <Remote Connections> <Route> <Name>CX-111111</Name> <Address>10.0.10.8</Address> <Net Id Remote Net Id="5.19.8.122.1.1">10.0.10.8.1.1</Net Id> <Type>TCP_IP</Type> </Route> <Route> <Name>CX-222222</Name> <Address>10.0.20.8</Address> <Net Id Remote Net Id="5.19.8.122.1.1">10.0.20.8.1.1</Net Id> <Type>TCP_IP</Type> </Route> </Remote Connections> </Tc Config> The actual Ams Net Id assigned to the remote ADS device is specified with the attribute "Remote Net Id". It does not have to be unique. Only the Ams Net Id of the target system defined in the field <Net Id> is known in the Twin CAT system with configured Ams NAT function. Restart the Twin CAT system service in order to activate the preset configuration of the Ams NAT function. To do this, switch the Twin CAT system from Run mode to Config mode. If Twin CAT is already in Config mode, reopen this in order to load the settings made. 3.2.3 ADS-over-MQTT 3.2.3.1 Overview Beckhoff ADS (Automation Device Specification) is a communication protocol developed by Beckhoff for efficient data exchange in industrial automation systems. It serves as the backbone for the integration of devices and software into the PC-based control technology from Beckhoff. From the perspective of the ADS protocol, ADS-over-MQTT is an additional transport channel over which ADS can be transported. Decoupling communication via an MQTT message broker results in a number of advantages, particularly in terms of scalability and flexibility when integrating additional ADS applications. Security mechanisms such as TLS can be used at the transport layer to secure the communication connection. With ADS-over-MQTT, the entire data exchange is transparent for the ADS applications, because only the ADS router needs to know and hold the corresponding information on the MQTT transport channel. In particular, this also enables easy retrofitting for existing applications. The main use case for ADS-over-MQTT is a classic remote maintenance and remote diagnostics scenario, where the Twin CAT engineering environment (Twin CAT XAE) needs to connect to one or more controllers for remote debugging. The following diagram illustrates the architecture being created here. Twin CAT 3 Version: 1.3.1 179
## Page 180

Target systems However, there are many other use cases for ADS-over-MQTT, especially when it comes to the aggregation of multiple distributed PLC systems. This document provides an overview of the usage possibilities as well as a technical description of how a "virtual ADS network" can be configured over an MQTT message broker. Benefits of an MQTT-based ADS network • Subnets, NAT-based networks and firewalls: Incoming TCP/IP connections are used in both directions in a classic ADS setup. This makes it necessary for the devices to be located in the same network in the normal case. In distributed systems with different subnets this leads to complex configurations in order to make the ADS routes available. In the case of MQTT-based ADS networks, only an outgoing TCP/IP connection is used by the devices. This allows the broker in the higher-level network to broker between all devices. Due to the outgoing connections, a typical firewall can be used and no incoming ports need to be registered. 180 Version: 1.3.1 Twin CAT 3
## Page 181

Target systems • Access control: After creating the appropriate routes, bidirectional communication can be executed in a classic ADS setup. An access by device A, which accesses B, also allows device B to access A. The MQTT-based ADS network can be configured so that device A can access B, but not the other way around. • Security / encryption: The communication from Twin CAT to the broker can be encrypted by TLS (with certificates or Pre Shared Key (PSK)). In this case, the transporting MQTT protocol is encrypted, so the ADS protocol can be transmitted unencrypted in the payload. • Retrofitting: ADS-over-MQTT is transparent for the ADS applications, which means that they do not need to be changed. NOTICE ADS access means full access As described in Security Advisory 2017-01, ADS offers full access to a device. Secure ADS offers authorization as well as encryption for the communication; therefore, it represents a transport encryption. Hence, if an ADS route exists, then full access exists. Dedicated, role-related access to individual files is offered by solutions such as OPC UA. 3.2.3.2 Installation 3.2.3.2.1 System Requirements The following system requirements apply for the installation and operation of this product. Technical data Description Operating system Windows 10 Windows Server 2022 Twin CAT/BSD Twin CAT/Linux® Target platforms PC architecture (x86, x64, Arm®) Twin CAT version Twin CAT 3 (from Build 4022.0) Twin CAT installation level Twin CAT 3 XAE, XAR, ADS Required Twin CAT license --- Supports Twin CAT 3 Usermode Yes, see also Configuration file [} 186] Runtime MQTT Message Broker To use this product, an MQTT message broker is required via which the communication connection is established. Any MQTT message broker can be used, e.g. Mosquitto or Hive MQ. The use of managed cloud services, such as AWS Io T Core, is also possible. Plugin for Mosquitto Message Broker The supplied plugin for the Mosquitto Message Broker is currently only available for the Windows operating system. 3.2.3.2.2 Installation The ADS-over-MQTT feature is a fixed part of the basic Twin CAT installation, both on XAE, XAR and ADS installations, and no further installations are required on the Twin CAT side. To install the MQTT message broker, please consult the documentation for your message broker software. Twin CAT 3 Version: 1.3.1 181
## Page 182

Target systems 3.2.3.3 Technical introduction 3.2.3.3.1 Quick Start This documentation article is intended to allow you an initial, quick start in how to use this product. Carry out the following steps to establish an ADS-over-MQTT connection to an MQTT message broker and to send and receive ADS messages. Message Broker installation This document assumes that you have a locally installed and working MQTT message broker. As an example we use the Mosquitto Message Broker here, but you can use any message broker. Overview For demonstration purposes, two Twin CAT devices are to establish an ADS-over-MQTT connection with the message broker. We then use Twin CAT XAE (Engineering) on the first device to establish a connection to the second system via the ADS-over-MQTT route. To keep the installation scenario as simple as possible, both devices should be on the same network. Device 1: • Mosquitto Message Broker • Twin CAT 3 XAE Device 2: • Twin CAT 3 XAE or XAR Note the IP address or the host name of Device 1. In the latter case, make sure that the name resolution works in your network. Message Broker setup The Mosquitto Message Broker has been delivered since version 2.x with a configuration that requires security measures to be set up to ensure secure operation of the message broker. In the following, we will show you how to modify the Mosquitto Message Broker configuration so that an unsecured communication connection can be established with the broker. However, this should be done exclusively for testing purposes in a trusted operating environment. For productive operation, we recommend using a secure broker configuration. 1. Install the Mosquitto Message Broker on your system. 2. Make a backup of the mosquitto.conf file from the Mosquitto installation directory. This is typically located at C:\Program Files\mosquitto. 3. Open the mosquitto.conf file with a text editor of your choice and remove the existing content. Add the following content and save the file. listener 1883 allow_anonymous true 4. Restart the Mosquitto Message Broker, either via the corresponding Windows service or manually via the console or mosquitto.exe. ð You have now configured the Mosquitto Message Broker to listen for incoming client connections on port 1883 and it does not require any security (neither user authentication nor client certificates). Windows firewall on Device 1 Please enable the standard MQTT port 1883/tcp as an incoming port in the Windows firewall of Device 1 so that Device 2 can establish a connection to the message broker. You can now start configuring Twin CAT. Configuration of the first Twin CAT device The Twin CAT ADS router on this device should now establish a route to the local message broker. Create a new XML file, e.g. with Notepad, and insert the following content. 182 Version: 1.3.1 Twin CAT 3
## Page 183

Target systems <?xml version="1.0" encoding="ISO-8859-1"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:no Namespace Schema Location="http://www.beckhoff.com/schemas/2015/12/Tc Config"> <Remote Connections> <Mqtt> <Address Port="1883">127.0.0.1</Address> <Topic>Virtual Ams Network1</Topic> </Mqtt> </Remote Connections> </Tc Config> Save this XML file under any name in the following directory and restart Twin CAT for the changes to take effect. \Twin CAT\3.1\Target\Routes Configuration of the second Twin CAT device The Twin CAT ADS router on this device should establish a route to the message broker on device 1. Create a new XML file, e.g. with Notepad, and insert the following content. <?xml version="1.0" encoding="ISO-8859-1"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:no Namespace Schema Location="http://www.beckhoff.com/schemas/2015/12/Tc Config"> <Remote Connections> <Mqtt> <Address Port="1883">%IPAddress%</Address> <Topic>Virtual Ams Network1</Topic> </Mqtt> </Remote Connections> </Tc Config> Replace the entry %IPAddress% with the IP address or the host name of device 1. Save this XML file under any name in the following directory and restart Twin CAT for the changes to take effect. \Twin CAT\3.1\Target\Routes Connecting the engineering Now start Twin CAT XAE on Device 1 and create a new Twin CAT project. Alternatively, you can also open an existing project. For this tutorial, we only need the toolbar to establish a connection to a remote ADS device. You will now find Twin CAT Device 2 in the toolbar and can establish a connection to it. Next steps After you have successfully established an ADS-over-MQTT connection to the message broker, we recommend that you reset the Mosquitto Message Broker to its default settings. For this, please take the backup file of mosquitto.conf that you created in the previous steps. This file, together with the broker documentation, is a good basis for further steps, e.g. to set up a secure message broker operating environment considering client/server certificates and user authentication. 3.2.3.3.2 Virtual networks When configuring ADS-over-MQTT, so-called "virtual networks" can be defined. This allows ADS devices to be distributed into independent networks. Only the devices within a network can communicate with each other. At MQTT level, this distribution takes place on the basis of a common basic topic. Twin CAT 3 Version: 1.3.1 183
## Page 184

Target systems These virtual networks can be defined at client level using the ADS-over-MQTT configuration file [} 186] and, if required, access rights can be assigned using the Tc Mqtt Plugin [} 189] for the Mosquitto Message Broker. 3.2.3.3.3 Communication flow To enable data exchange and Device Discovery via ADS-over-MQTT, all ADS devices use a uniform topic structure on the message broker. The topic structure depends on the name of the configured virtual network [} 183] and the AMS Net ID of the respective device. Type Topic Discovery <Network Name>/<Ams Net Id>/info Communication <Network Name>/<Ams Net Id>/ams <Network Name>/<Ams Net Id>/ams/res Each ADS device therefore has its own "topic area" on the message broker. The following figure illustrates this relationship. 184 Version: 1.3.1 Twin CAT 3
## Page 185

Target systems Discovery A connecting Twin CAT ADS router sends a retain message with device information to its discovery topic, at the same time it subscribes to the topic <Network Name>/+/info, so that it is informed about all other connected routers. The messages to the discovery topic contain an XML structure with device information, for example the host name and the Twin CAT version used: <info> <online name="EC2AMAZ-2RRSQS6" os Version="10.0.20348" os Platform="2" tc Version="3.1.4026.10">true</online> </info> If the message broker does not support retain messages, this can be taken into account in the ADS-over- MQTT configuration file [} 186]. In this case, a communication handshake would take place instead of a retain message: a newly connecting device logs on to its discovery topic and all other connected devices respond with another message on their discovery topic. This ensures that devices can find each other even with message brokers that do not support retain messages. The disadvantage is an increased volume of messages in larger operating environments with frequent reconnects. Twin CAT 3 Version: 1.3.1 185
## Page 186

Target systems Communication A Twin CAT ADS router subscribes to its communication topic (<Network Name>/<Ams Net Id>/ams/#) immediately after the connection is established. The ADS commands to this router are then sent to <Network Name>/<Ams Net Id>/ams, while the responses are received via the <Network Name>/<Ams Net Id>/ ams/res topic. 3.2.3.3.4 Configuration file The Twin CAT ADS router is configured by an XML file to establish an ADS-over-MQTT connection with a message broker. This configuration file is stored under any name in the following directory: \Twin CAT\3.1\Target\Routes In the Examples [} 191] chapter, you will find example configuration files for all the use cases described below. Activating a new ADS-over-MQTT configuration New or changed ADS-over-MQTT configurations are only adopted when the Twin CAT ADS router is initialized. This takes place, for example, in the Twin CAT transitions from RUN to CONFIG or CONFIG to CONFIG. Path information Please ensure that you use the correct spelling for your operating system for any path details in the configuration file. Twin CAT 3 Usermode Runtime You can operate ADS-over-MQTT in the Twin CAT 3 Usermode Runtime. Only the basic paths of the Usermode Runtime need to be taken into account. In the delivery state, for example, the base directory for the router configuration files is defined as follows: %Program Data%\Beckhoff\Twin CAT\3.1\Runtimes\Um RT_Default\3.1\Target\Routes\ Other path details for ADS-over-MQTT specific topics (see Technical introduction [} 182]) are otherwise retained. Basic configuration The basic configuration always contains the following elements: Address of the message broker, its TCP port and the name of the virtual network [} 183]. The address of the broker and the TCP port at which it can be reached are specified via the <Address> node. The virtual network is defined via the <Topic> node. In the following example, a connection is established to a locally (127.0.0.1) installed message broker and TCP port 1883. “Virtual Ams Network1” is defined as the virtual network. <?xml version="1.0" encoding="ISO-8859-1"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:no Namespace Schema Location="http://www.beckhoff.com/schemas/2015/12/Tc Config"> <Remote Connections> <Mqtt> <Address Port="1883">127.0.0.1</Address> <Topic>Virtual Ams Network1</Topic> </Mqtt> </Remote Connections> </Tc Config> No Retain The communication flow [} 184] for device discovery can be customized via the No Retain attribute. When setting No Retain = true, the device search function is no longer based on retain messages. Instead, a handshake mechanism is used to identify all connected ADS devices. 186 Version: 1.3.1 Twin CAT 3
## Page 187

Target systems Unidirectional Incoming ADS messages can be blocked for this system via the unidirectional attribute. A typical use case could be an engineering system, for example, which should be able to reach the runtime systems via ADS, but not vice versa. TLS The <TLS> node can be used to define settings for securing the transport channel via TLS. Various connection options are available, e.g. the configuration of client certificates or PSK. Our examples [} 191] show all possible configuration variants. TLS Ignore Cn The Ignore Cn attribute can be used to disable the verification of the Common Name (CN) from the server certificate. TLS PSK When using TLS with a pre-shared key (PSK), you can either specify the PSK as a hex-coded, 64-character string, or leave the conversion to Twin CAT internally using Sha256(Identity + Pwd). In the latter case, the Identity Case Sensitive attribute can be used to specify that Twin CAT should use the identity as the Upper Case for the calculation. Our examples [} 191] show both possible configuration variants. User <?xml version="1.0" encoding="ISO-8859-1"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:no Namespace Schema Location="http://www.beckhoff.com/schemas/2015/12/Tc Config"> <Remote Connections> <Mqtt> <Address Port="1883">127.0.0.1</Address> <Topic>Virtual Ams Network1</Topic> <User>CX-12345</User> </Mqtt> </Remote Connections> </Tc Config> The <User> element specifies an identity that can be used in the Tc Mqtt Plugin [} 189] to configure access rights between ADS devices. However, the identity is usually defined by other means, e.g. the Common Name (CN) of a client certificate. Optionally, the <Mqtt> element can contain a Client Id attribute to specify the MQTT Client ID. This is otherwise formed from the <User> and an arbitrary string. Twin CAT 3 Version: 1.3.1 187
## Page 188

Target systems 3.2.3.3.5 Enabling/disabling You can enable or disable an ADS-over-MQTT route at runtime without having to restart the Twin CAT system. This allows you, for example, to enable the route only in the case of service and to assign this function to a key switch or link it to user inputs via the HMI. Enabling/disabling is performed via an ADS interface in the Twin CAT System Service. You can use a special attribute in the route configuration file to define a default status that the route should have after a Twin CAT start. Route configuration file In the configuration file of an ADS-over-MQTT route, you can specify a default status that the route should have after a Twin CAT start. This attribute (“Disabled”) is specified at the <Mqtt> node. If assigned the value “true”, the ADS-over-MQTT route is not established automatically after Twin CAT is started and must be established via the ADS interface. <?xml version="1.0"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema- instance" xsi:no Namespace Schema Location="http://www.beckhoff.com/schemas/2015/12/Tc Config"> <Remote Connections> <Mqtt Disabled="true"> <Name>My Broker</Name> <Address Port="1883">my Message Broker Address</Address> <Topic>Virtual Ams Network1</Topic> </Mqtt> </Remote Connections> </Tc Config> ADS interface The ADS interface is defined as follows. ADS-Kommando: Ads Write Request ADS-Port: 10000 Index Group: 808 Index Offset: siehe unten Data: Identifizierung der Route, siehe unten The Index Offset indicates whether you want to enable/disable a route permanently or temporarily. In this case, “permanent” means that the enabled/disabled state is retained even after a Twin CAT restart. The following options are available: Index Offset Name Description 1 ADS_ROUTE_DISABLE Disables the route permanently. 2 ADS_ROUTE_ENABLE Enables the route permanently. 3 ADS_ROUTE_DISABLE_TMP Disables the route temporarily. 4 ADS_ROUTE_ENABLE_TMP Enables the route temporarily. The data area of the Ads Write Request specifies which ADS-over-MQTT route is to be addressed. This is done via definition in a string. The format is as follows and corresponds to a composition of the <Address> and <Topic> nodes of the configuration file. The keyword “MQTT” is fixed here. MQTT:<Address>:<Topic> Alternatively, you can also add a <name> node to the configuration file, which you can then use for referencing. The name used here must be unique across all ADS routes. In the example above, you would then use the following string in the data area of the Ads Write Request: MQTT:My Broker PLC example A corresponding example [} 191] is available for download. 188 Version: 1.3.1 Twin CAT 3
## Page 189

Target systems 3.2.3.3.6 Security There are options for securing the communication. A TLS connection on the basis of X.509 certificates or a Pre-Shared Key (PSK) can be used for this. It is recommended that communication be secured with TLS especially when communicating over non-trustworthy networks (e.g. the Internet). In the chapters Configuration file [} 186] and Samples [} 191] you will find explanations and sample configuration files for operating ADS-over-MQTT via TLS. The broker itself must be operated in a trustworthy environment, as all messages on the broker are unsecured. Compromising of the virtual ADS network Even when communication between the devices and the broker takes place in encrypted form via TLS, the devices are not secured among one another. The ADS commands are present on the broker in unencrypted form. If a device is compromised, the attacker can execute all ADS commands via the rights gained. These commands also include file reading operations or operations for starting processes. Two methods can be used to configure access rights between individual ADS devices: • Configuration of access rights via Access Control Lists [} 190] (using Mosquitto as an example) • Configuration of access rights via a plugin [} 189] (only for Mosquitto) 3.2.3.3.6.1 Mosquitto plugin A plugin was developed especially for the Mosquitto Message Broker to enable the definition of access rights between the individual Twin CAT ADS routers. Please also note the system requirements [} 181] for operating this plugin. The plugin is delivered with the Twin CAT installation under Twin CAT 3.1 Build 4024. Build 4026 requires the installation of the corresponding package (Twin CAT. XAE. Mqtt Plugin). The plugin is installed in the following directory and can be referenced from there in the Mosquitto configuration. \Twin CAT\Ads Api\Tc Mqtt Plugin The plugin is available in a 32-bit and a 64-bit version, depending on which version you use of the Mosquitto Message Broker. The plugin is then integrated into the configuration of the Mosquitto Message Broker as follows: auth_plugin <Path>Tc Mqtt Plugin.dll auth_opt_xml_file <Path>My ACL.xml The My ACL.xml file contains the access configuration to the broker itself, as well as the configuration of the communication between the connected Twin CAT ADS routers. This configuration is explained in more detail in the following section. Configuration The plugin offers the option of configuring virtual AMS networks. To do this, specify which device can access which other device for each target device. In contrast to the classic ADS routes, these connections are directional: A target therefore does not also have the right to access the source. <Tc Mqtt Acl Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:no Namespace Schema Location="C:\Twin CAT\3.1\Config\Modules\Tc Mqtt Acl Config.xsd"> <Ams> <Topic>Virtual Ams Network1</Topic> <User> <Name>Engineering Station</Name> </User> <User> <Name>CX-12345</Name> <Access>Engineering Station</Access> </User> <User> <Name>CX-56789</Name> <Access>Engineering Station</Access> Twin CAT 3 Version: 1.3.1 189
## Page 190

Target systems </User> </Ams> </Tc Mqtt Acl Config> The name of the Ams network is defined within an <Ams> node. It is used in the MQTT topics employed for the identification of the networks. Individual <User> elements describe the devices. These elements have a <Name> attribute that describes the MQTT identity with which the connection was established. The identity can be transferred via various TLS mechanisms, e.g. via the TLS-PSK Identity or the Common Name (CN) of a client certificate. Our samples [} 191] here show possible configuration variants. Access-authorized devices are defined via the <Access> element. In the sample above, the "Engineering Station" identity has access to two CX devices, but the CX devices do not have access to the "Engineering Station" or to each other. The configuration file is reloaded cyclically so that a restart of the broker is not necessary. Restrictions with regard to the Ams Net Id to be registered With this configuration each validly connected device can assume an arbitrary Ams Net Id and thus an identity from the point of view of ADS. This can be further restricted as required: <User> <Name>CX-56789</Name> <Access>Engineering Station</Access> <Net Id>192.168.56.1.1.1</Net Id> </User> As soon as at least one Net Id is specified, only one Net Id can be registered from this list. An alternative solution would be to enter the Net Id in the Common Name (CN) of the client certificate. 3.2.3.3.6.2 Mosquitto ACL Many message brokers allow the configuration of Access Control Lists (ACLs) to restrict client interactions to certain topics. The following chapter shows this configuration using the Mosquitto Message Broker as an example. The procedure for granting access rights described here differs from that of the Tc Mqtt Plugin [} 189]. This specifies which other ADS devices have access to an ADS device. With the (Mosquitto) ACL it is exactly the other way around, because here it is specified for an ADS device which other ADS devices it is allowed to access. Overview The Mosquitto Message Broker allows the configuration of an Access Control List, which is defined as a separate configuration file and referenced in the main configuration of the broker. This configuration entry is shown below as an example: acl_file C:\Program Files\mosquitto\mosquitto.acl You can also find a complete configuration file in our samples [} 191] for download. In the ACL file, you can define authorizations for publishing and subscribing to certain topics and specify them separately for each user. The access rights for a user are always introduced by the following line: user <username> Subsequently the reading and writing rights are defined according to the following scheme: topic [read|write|readwrite] <topic Name> Configuration for ADS-over-MQTT For ADS-over-MQTT, two things must be ensured according to the communication flow [} 184]: access of all ADS devices to the discovery topics and sending/receiving via the communication topics. The ADS device must always have read/write access to its own topic. The device receives read rights for the discovery topic of other ADS devices. To exchange ADS messages, an ADS device must have read/write access to the communication topic of the 190 Version: 1.3.1 Twin CAT 3
## Page 191

Target systems devices. The ADS device is identified by its own identity on the message broker. This identity can, for example, originate from a PSK or correspond to the Common Name (CN) of a client certificate. The following configuration illustrates these relationships. user <identity> topic readwrite <Virtual Ams Network Name>/<Own Ams Net Id>/# topic read <Virtual Ams Network Name>/+/info topic readwrite <Virtual Ams Network Name>/+/ams/# If an ADS device is to be denied access to another device, it must be ensured that there are no write permissions for the topic with the target Ams Net Id. The familiar Tc Mqtt Plugin option that an ADS device may register only one Ams Net Id is also possible with the Mosquitto ACL. To do this, the entry <Own Ams Net Id> must be replaced by precisely one foreseen Ams Net Id. If it is to be possible for the ADS device to register with an arbitrary Ams Net Id, then the wildcard (#) has to be set for <Own Ams Net Id>. The following is an example of the access rights entries for communication between two ADS devices: user Engineering Station topic readwrite Virtual Ams Network1/18.153.78.19.1.1/# topic read Virtual Ams Network1/+/info topic readwrite Virtual Ams Network1/+/ams/# user CX-12345 topic readwrite Virtual Ams Network1/3.120.15.8.1.1/# topic read Virtual Ams Network1/+/info topic readwrite Virtual Ams Network1/+/ams/# 3.2.3.4 Samples Sample code and configurations for this product can be obtained from the corresponding repository on Git Hub: https://github.com/Beckhoff/ADS-over-MQTT_Samples. There you have the possibility to clone the repository or download a ZIP file with the sample. 3.2.4 Secure ADS 3.2.4.1 General description From Twin CAT 3.1 Build 4024.0 The functionality described here is available from Twin CAT 3.1. 4024.0. Secure ADS is an additional transport channel from the point of view of the ADS protocol. Precisely the same ADS commands are transmitted via a secure connection as via other communication protocols. Twin CAT 3 Version: 1.3.1 191
## Page 192

Target systems To this end a connection encrypted by means of TLSv1.2 is established from one Twin CAT router to another. Due to the implementation inside the Twin CAT router, existing applications do not need to be modified. They can be made to use the encrypted connection by simply parameterizing the used route. This documentation illustrates the different options of Secure ADS, in particular with regard to the provision of the keys. Detection of a Secure ADS route Twin CAT displays a Secure ADS route with a lock icon. It is displayed at the appropriate points: • Route overview of a system • When selecting the target system in the XAE engineering environment: • 3.2.4.2 Limitations From Twin CAT 3.1 Build 4024.0 The functionality described here is available from Twin CAT 3.1. 4024.0. • Secure ADS is available only between ADS routers. 192 Version: 1.3.1 Twin CAT 3
## Page 193

Target systems • Like all other ADS connections, Secure SDS connections represent full access for the connected systems as is also described in the Security Advisory 2017-01. This access is configurable per system through unidirectional [} 194] ADS routes. 3.2.4.3 Requirements From Twin CAT 3.1 Build 4024.0 The functionality described here is available from Twin CAT 3.1. 4024.0. • Secure ADS is a component of TC1000 and can be used without license costs. • The devices used require network communication. Incoming Secure ADS is communicated via the TCP port 8016. • Appropriate certificates may need to be generated and signed for TLS encryption. 3.2.4.4 Technical introduction In this section the basic mode of operation is described, irrespective of the specific configuration. Secure ADS introduced an additional communication channel for the familiar ADS protocol. This can be used by programs without them having to be adapted for the new communication channel. From the point of view of security, therefore, it is a transport encryption, but not an end-to-end encryption between the components, because all applications running locally on a device can use this encrypted connection together – exactly as with ADS routes also. Local realization Secure ADS is part of the ADS router and is also configured here. The ADS router establishes an encrypted connection to another Twin CAT router and makes it available to the applications. Care must therefore be taken that the ADS devices do not themselves communicate applications in encrypted form, but that this takes place between the routers. Twin CAT 3 Version: 1.3.1 193
## Page 194

Target systems Transparent retrofitting The realization of Secure ADS inside the Twin CAT router makes the retrofitting of applications possible. None of the ADS applications (client and server) – this also includes applications written by the customer – need to be recompiled. The ADS applications use ADS routes to identify the communication partner. This ADS route is independent of the transport channel and is described in the Twin CAT router. If the used route is switched to a Secure ADS connection, the ADS traffic is transported in encrypted form. 3.2.4.4.1 Directed ADS communication One of the properties of ADS routes is that they can be directed. This property was supplemented within the scope of Secure ADS, but is generally available for routes. Once they have been opened at network level, ADS routes are used for communication on both sides by the respective ADS applications. This behavior is very efficient, but may be undesirable. For example, an engineering computer (XAE) is supposed to have access to a runtime (XAR) system in the normal case, but it is not necessary for an XAR system to access the XAE system via ADS. Therefore, this direction can be limited in that a corresponding system (the XAE in the example) does not accept any ADS request commands via the route. The chapter Configuration [} 196] describes the procedure for limiting the properties. 194 Version: 1.3.1 Twin CAT 3
## Page 195

Target systems 3.2.4.4.2 Server A normal ADS route is established by both devices as soon as it is required. Once a route has been established it is used in both directions. A server configuration is offered as an extension for Secure ADS. Such a configuration represents the basis for setting up specific routes. <Tc Config> <Remote Connections> <Server> … </Server> </Remote Connections> </Tc Config> For PSK [} 199] and certificates provided by the customer [} 200] this is used to store the initial configuration on one side. When setting up the specific route, the server entries are then checked to see if rights exist. If this is the case, a normal route will be set up. 3.2.4.4.3 Key exchange Secure ADS offers three ways of providing the keys required for encryption; these are described here with their advantages and disadvantages. What they all have in common is that the respective device has to be isolated with respect to access to the secrets (Pre-Shared Keys, certificates). If these secrets are compromised, the system has to be set up again in order to restore the integrity of the complete system. Self-Signed Certificates (SSC) When starting for the first time (e.g. after the installation), Twin CAT generates a self-signed certificate. The use of such certificates has the advantage that they are generated and are available locally. In order to establish a basis for trust, however, a check of the certificates must be performed among all communication devices. These certificates are thus suitable for the initial commissioning or also for static machines that can make do without dynamics in the system structure or the entity authorized to access. From Twin CAT 4024.0 these certificates will be provided as standard when used. The chapter Configuration [} 197] describes how they are used to establish an ADS route. Validity periods of the certificates Twin CAT 3 Version: 1.3.1 195
## Page 196

Target systems The certificates generated have a fixed validity period from 1/1/2000 to 1/1/2061. From the point of view of security this is too long, meaning that organizational measures have to be taken to meet the security demands. With this excessively long validity period, Beckhoff ensures that communication does not fail, even if, for example, incorrect times are set in the local system. If this behavior is not desired, you can generate and use your own certificates (see Certificates provided by the customer). Pre-Shared Keys (PSK) Pre-Shared Keys can be stored in a Twin CAT system. These are used to authorize the incoming ADS routes when establishing the connection. As the Pre-Shared Keys have to be configured they are particularly suitable for granting access, for example, to maintenance staff. The Pre-Shared Keys can be bound to a specific person. Pre-Shared Keys do not have a validity period like that foreseen for certificates. They are also stored directly in files so that they are not stored as a hash value (as is usually the case with passwords). They are therefore not protected against direct viewing. The chapter Configuration [} 199] describes how Pre-Shared Keys are used on both sides of the communication. Certificates provided by the customer (CA with certificates) Secure ADS also provides customers with the option of generating and managing their own certificates. As a result, dynamic constellations in particular are easily mappable, because there can be a common Certificate Authority (CA). All devices that trust this CA can communicate in encrypted form with one another with no further configuration, even if they have never encountered one another before. The chapter Configuration [} 200] describes how these certificates can be integrated into Twin CAT. NOTICE Expiry of the certificates Certificates have an expiry date. Organizational measures must be taken to replace certificates before their expiry. 3.2.4.5 Configuration Secure ADS offers three ways of providing the keys required for the encryption. At this point the configurations will be described separately from one another. While the Server vs. Route configuration is described within the three ways, directed ADS connections [} 196] are illustrated independently. 3.2.4.5.1 Directed ADS communication The configuration of a directed ADS communication takes place using the checkbox Unidirectional when creating the route. If this checkbox is set, Twin CAT will not accept any ADS command calls from the opposite target system via the associated route. Twin CAT itself sends ADS command calls (requests) and receives responses. 196 Version: 1.3.1 Twin CAT 3
## Page 197

Target systems In the XML configuration this setting is made via the attribute Unidirectional="true": <Remote Connections> <Route Unidirectional="true"> <Name>CX-123456</Name> <Address>CX-123456</Address> <Net Id>5.36.69.176.1.1</Net Id> <Type>TCP_IP</Type> <Flags>128</Flags> <Tls> … </Tls> </Route> </Remote Connections> 3.2.4.5.2 Self-Signed Certificates (SSC) When setting up the connection, Self-Signed Certificates require the checking of the communication device, as no trust basis automatically exists. This check is made possible in Twin CAT by the fingerprint of the opposite system. Displaying the SSC fingerprint on a system The fingerprint of your own system is displayed in the About Twin CAT dialog: Twin CAT 3 Version: 1.3.1 197
## Page 198

Target systems The button Self Signed Certificate - Fingerprint: copies the fingerprint listed on the right to the clipboard. This dialog does not exist for CE systems. The fingerprint can be displayed here in the file \Hard Disk\Twin CAT\3.1\Target\Tc Self Signed.xml. Establishment of the connection The fingerprint is displayed purely for information and cryptographically unsecured following the discovery: The final checking of the fingerprint takes place when setting up the route: 198 Version: 1.3.1 Twin CAT 3
## Page 199

Target systems The Compare with field can be used, for example, with copy & paste for checking: If the same fingerprint is entered there the field appears green, otherwise it is red. Thus, an RDP connection, for example, can be used to copy the fingerprint of a system to the clipboard via the Self Signed Certificate - Fingerprint button and to enter it here. So that the target system will accept the route establishment, a system login with corresponding administrator rights that is valid there is used. These login data are already transmitted in encrypted form. With CE systems the host name is always entered with Twin CAT 3.1 4024.5, even if IP address was selected when creating the route. Therefore, if a network without a functioning host name lookup is to be used, the host name must be changed manually by the IP address in the file \Hard Disk\Twin CAT\3.1\Target\Static Routes.xml. 3.2.4.5.3 Pre-Shared Keys (PSK) Pre-Shared Keys are set up on one side as a server and on the other side for authentication and authorization. Setting up Pre-Shared Keys as a server Pre-Shared Keys are normally used with server connections. The configuration takes place via an entry in the route configuration. To do this, the following entries can be made in the file C:\Twin CAT\3.x\Target\Static Routes.xml : <?xml version="1.0"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <Remote Connections> <Server> <Tls> <Psk> <Identity>MY_IDENTITY</Identity> <Pwd>My Secret</Pwd> </Psk> <Psk> <Identity>MY_IDENTITY2</Identity> <Pwd>My Other Secret</Pwd> </Psk> </Tls> </Server> </Remote Connections> </Tc Config> Twin CAT 3 Version: 1.3.1 199
## Page 200

Target systems Saved changes are accepted when the Twin CAT router is initialized, which takes place, for example, during the transition RUN->CONFIG or CONFIG->CONFIG. Use of a Pre-Shared Key server When adding a route, the entry Pre-Shared Key (PSK) is selected and the corresponding credentials are entered. If this is successful, a specific route is stored in the target system and is used for the future establishment of connections. 3.2.4.5.4 Certificates provided by the customer (CA with certificates) The configuration of certificates provided by the customer takes place via an entry in the route configuration. To do this, the following entries can be made in the file C:\Twin CAT\3.x\Target\Static Routes.xml : <?xml version="1.0"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <Remote Connections> <Server> <Tls Ignore Cn="true"> <!--see below--> <Ca>C:\Twin CAT\3.1\Target\CACerts\root CA.pem</Ca> <Cert>C:\Twin CAT\3.1\Target\CACerts\ipc.crt</Cert> <Key>C:\Twin CAT\3.1\Target\CACerts\ipc.key</Key> </Tls> </Server> </Remote Connections> </Tc Config> Saved changes are accepted when the Twin CAT router is initialized, which takes place, for example, during the transition RUN->CONFIG or CONFIG->CONFIG. The certificates are X.509 certificates, which can be generated, for example, with Open SSL. If the key (XML- Element <Key>) is to be protected by a password, this can be specified via the XML element <Key Pwd>. The .der and .pem formats are supported. The "Common Name" of the certificate must correspond to the name used when establishing the connection (XML-Element <Name>). This behavior can be deactivated with the option Ignore Cn=" true". If both sides have suitable certificates of a common CA, the route can be created without further information using this dialog: 200 Version: 1.3.1 Twin CAT 3
## Page 201

Target systems As described under Server [} 195], a specific route is created on both sides as a result of this. 3.2.4.5.5 Deactivating ADS • The unencrypted ADS is transmitted via the TCP port 48898 (0x BF02) • The discovery ("Broadcast Search") is transmitted via the UDP Port 48899 (0x BF03) Both ports can be blocked in the firewall. The target system can be configured with respect to the ports to be used. The following keys are available below KEY_LOCAL_MACHINE\SOFTWARE\ [WOW6432Node\]Beckhoff\Twin CAT3\System: ADS Ports Disable Ads Tcp Listening REG_DWORD 1 = prevents the opening of the TCP port 0x BF02 for unencrypted ADS. Disable Ads Tls Listening REG_DWORD 1 = prevents the opening of the TCP port 8016 for Secure ADS Disable Ads Discovery REG_DWORD 1 = prevents the opening of the UDP port 0x BF03 for the ADS discovery ("Broadcast Search") The attribute Secure Only="True" can additionally be used via the Static Routes.xml file. The ADS port 0x BF02 is thereby kept open, but no further ADS communication is allowed via the port. <Remote Connections Secure Only="True"> 3.2.4.5.6 Logging Secure ADS writes information about failed connection establishments in the Windows Event Log, which is available via the Twin CAT System Tray icon. Twin CAT 3 Version: 1.3.1 201
## Page 202

Target systems The messages can be found under the category Windows Logs > Application: 3.2.4.6 Sample 3.2.4.6.1 Certificates provided by the customer (CA with certificates) At this point certificates are generated by means of Open SSL and can be used for the Secure ADS connection. These instructions do not represent comprehensive advice on the creation and handling of certificates. In particular the validity periods must be observed, which necessitates organizational measures in order to ensure replacement before the expiry of the validities (in this case: 3600 days for CA and 360 days for the respective certificates). In this example a Certificate Authority (CA) is generated that signs a certificate for both sides (called IPC and CX here) of the communication. The meaning of the call parameters can be viewed in detail via openssl help. ü Open SSL is installed and is available from the command line. 1. Generate a key for the Certificate Authority that will be trusted later. openssl genrsa -out root CA.key 2048 2. Generate the certificate with a validity period of 3600 days. Owner information is added via the parameter "-subj". openssl req -x509 -new -nodes -key root CA.key -sha256 -subj "/C=DE/ST=NRW/ L=Verl/O=Bk/OU=TCPM/CN=Root CA" -days 3600 -out root CA.pem 3. Generate a key for the IPC openssl genrsa -out ipc.key 2048 202 Version: 1.3.1 Twin CAT 3
## Page 203

Target systems 4. Generate a Certificate Signing Request (CSR) for this key: Please note: The address specified as CN (IP address in this case) must be used as the name when establishing the connection. Alternatively, the route must be parameterized with Ignore CN. openssl req -out ipc.csr -key ipc.key -subj "/C=DE/ST=NRW/L=Verl/O=Bk/ OU=TCPM/CN=192.168.2.1" -new 5. Sign the CSR of the IPC with the CA with a validity of 360 days openssl x509 -req -in ipc.csr -CA root CA.pem -CAkey root CA.key -CAcreateserial -out ipc.crt -days 360 -sha256 ð The route can now be set up on the IPC using these files: root CA.pem, ipc.key and ipc.pem 6. Generate a key for the CX openssl genrsa -out cx.key 2048 7. Generate a Certificate Signing Request (CSR) for this key: Please note: The address specified as CN (IP address in this case) must be used as the name when establishing the connection. Alternatively, the route must be parameterized with Ignore CN. openssl req -out cx.csr -key cx.key -subj "/C=DE/ST=NRW/L=Verl/O=Bk/OU=TCPM/ CN=192.168.2.2" -new 8. Sign the CSR of the IPC with the CA with a validity of 360 days openssl x509 -req -in cx.csr -CA root CA.pem -CAkey root CA.key -CAcreateserial -out cx.crt -days 360 -sha256 ð The route can now be set up on the CX using these files: root CA.pem, cx.key and cx.pem ð The route can be used. 3.3 Folder and file types 3.3.1 Twin CAT PLC project files 3.3.1.1 Port_xxx.app Binary file of the PLC project Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\Plc\ \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Activate boot project. • PLC login with boot project update Requirement - - 3.3.1.2 Port_xxx.autostart Empty file that activates the Autostart option Storage location Twin CAT 3 Version: 1.3.1 203
## Page 204

Target systems Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\Plc\ \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate Autostart option (project- independent system setting). • Recreating a PLC project. Requirement - 3.3.1.3 Port_xxx.cid File containing the Compileinfo_IDs Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\Plc\ \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Activate boot project. • PLC login with boot project update Requirement - - 3.3.1.4 Port_xxx.crc File containing the checksum of the PLC project Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\Plc\ \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Activate boot project. • PLC login with boot project update Requirement - - 3.3.1.5 Port_xxx.occ Symbolics of the PLC project • The file contains the changes of the symbolics of the PLC project for an online change. • If the Symbolic Mapping option is not activated, this file also contains the changes of the mapping configuration for an activate/update boot project. • On activating the configuration the occ file is reset in both directories. Storage location 204 Version: 1.3.1 Twin CAT 3
## Page 205

Target systems Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\Plc\ \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Activate boot project. • PLC login with boot project update Requirement - - 3.3.1.6 Port_xxx.oce The file contains the changes of the event classes at the time of an Online Change, which are used in a PLC project. Storage location Project directory Twin CAT boot directory Path - • < TC3.1.4026.0: C: \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation - When changing the event classes used and Online Change. Requirement - - 3.3.1.7 Port_xxx.ocm Description file of the mapping configuration • If the Symbolic Mapping option is activated, this file contains the changes of the mapping configuration of the PLC project for an activate/update boot project. • On activating the configuration the ocm file is reset in both directories. Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\Plc\ \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a Twin CAT project. • Activate configuration. • Recreating a Twin CAT project. • Activate boot project. • PLC login with boot project update Requirement - - 3.3.1.8 Port_xxx_boot.tizip Archive folder containing the COMPILEINFO file of the boot project The COMPILEINFO file contains the compilation information and the login information of the PLC project. Storage location Twin CAT 3 Version: 1.3.1 205
## Page 206

Target systems Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\Plc\ \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Activate boot project. • PLC login with boot project update Requirement - - 3.3.1.9 Port_xxx_act.tizip Archive folder containing the COMPILEINFO file of the currently running PLC project Storage location Project Directory Twin CAT boot directory Path - • < TC3.1.4026.0: C: \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation - • PLC login with change Requirement - - 3.3.1.10 Port_xxx.bootdata Boot file that saves the persistent data Once the Twin CAT system has started and the PLC has been loaded, the file extension .bootdata is renamed .bootdata-old. Storage location Project Directory Twin CAT boot directory Path - • < TC3.1.4026.0: C: \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation - • Stop the Twin CAT system. • Use of FB_Write Persistent Data. Requirement - - 3.3.1.11 Port_xxx.bootdata-old Backup file for the persistent data The file is deleted once the new boot file has been completely written. Storage location 206 Version: 1.3.1 Twin CAT 3
## Page 207

Target systems Project Directory Twin CAT boot directory Path - • < TC3.1.4026.0: C: \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation - • Activate configuration. • Restarting the Twin CAT system. Requirement - - 3.3.1.12 PLC_Name.tpzip Archive folder of the PLC project The scope of the content is configurable in the project properties. Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\Current Config \Twin CAT\3.1\Boot\Plc \ • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Activate boot project. • PLC login with boot project update Requirement - - 3.3.1.13 PLC_Name.tmc TC3 module description file Storage location Project Directory Twin CAT boot directory Path A)..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\<PLC name>\ \Twin CAT\3.1\Boot\Plc B)..\<Solution name>\<Project • >=TC3.1.4026.0: C: name>\_Boot\<Platform>\Plc\ \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Activate boot project. • PLC login with boot project update Requirement A) - • TMC activated as target file B) TMC activated as target file 3.3.1.14 PLC_Name.tpy TC2 PLC description file Storage location Twin CAT 3 Version: 1.3.1 207
## Page 208

Target systems Project Directory Twin CAT boot directory Path A)..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\<PLC name>\ \Twin CAT\3.1\Boot\Plc B)..\<Solution name>\<Project • >=TC3.1.4026.0: C: name>\_Boot\<Platform>\Plc\ \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Activate boot project. • PLC login with boot project update Requirement A) - • TPY activated as target file B) TPY activated as target file 208 Version: 1.3.1 Twin CAT 3
## Page 209

Target systems 3.3.2 Twin CAT C++ project files Twin CAT 3 Version: 1.3.1 209
## Page 210

Target systems File Description Further information Engineering / XAE *.sln Visual Studio Solution file, hosts Twin CAT and non-Twin CAT projects *.tsproj Twin CAT project, collection of all nested Twin CAT projects, such as Twin CAT C++ or Twin CAT PLC project _Config/ Folder contains further configuration files (*.xti) See menu Tools| Options| that belong to the Twin CAT project. Twin CAT| XAE- Environment| File Settings _Deployment/ Folder for compiled Twin CAT C++ drivers *.tmc Twin CAT Module Class file (XML-based) See Twin CAT Module Class Editor (TMC) *.rc Resource file See Set version/vendor information *.vcxproj.* Visual Studio C++ project files *Class Factory.cpp/.h Class Factory for this Twin CAT driver *Ctrl.cpp/.h Upload and remove drivers for Twin CAT UM platform *Driver.cpp/.h Upload and remove drivers for Twin CAT RT platform *Interfaces.cpp/.h Declaration of the Twin CAT COM interface classes *W32.cpp./.def/.idl *.cpp/.h One C++/Header file per Twin CAT module in the driver. Insert user code here. Resource.h Required by *.rc file Tc Pch.cpp/.h Used for creating precompiled headers %TC_INSTALLPATH% Compiled driver that is loaded via the See Versioned C++ \Repository\<Vendor>\<Prj Nam Tc Loader. Projects e>\<Version>\<Platform>\*.tmx Twin CAT 3.1.4024.x: C:\Twin CAT\3.1\Repository\C++ Module Vendor\Untitled1\0.0.0.1\Twin CAT RT *\Unititled1.tmx From Twin CAT 3.1.4026.x: C: \Program Data\Beckhoff\Twin CAT\3.1\Repositor y\C++ Module Vendor\Untitled1\0.0.0.1\Twin CAT RT *\Unititled1.tmx %TC_INSTALLPATH% Published Twin CAT C++ project normally See Export modules \Custom Config\Modules\* Twin CAT 3.1.4024.x: C:\Twin CAT\3.1\Custom Config\Modules\* From Twin CAT 3.1.4026.x: C:\Program Files (x86)\Beckhoff \Twin CAT\3.1\Config\Modules\* Runtime / XAR %TC_BOOTPRJPATH% Current configuration setup \Current Config\* Windows: Twin CAT 3.1.4024.x: C:\Twin CAT\3.1\Boot From Twin CAT 3.1.4026.x: 210 Version: 1.3.1 Twin CAT 3
## Page 211

Target systems File Description Further information Windows: C:\Program Data\Beckhoff \Twin CAT\3.1\Boot Twin CAT/BSD: /usr/local/etc/Twin CAT/3.1/Boot %TC_DRIVERAUTOINSTALLP Compiled, platform-specific driver that is loaded ATH% \*.sys/pdb via the operating system. Windows: Twin CAT 3.1.4024.x: C:\Twin CAT\3.1\Driver\Auto Install (loaded by the system) From Twin CAT 3.1.4026.x: <not available> Please migrate to TMX based C++ projects Twin CAT/BSD®: <not available> %TC_INSTALLPATH% Compiled platform-specific driver that is loaded \Boot\Repository\<Vendor>\<Prj via the Tc Loader. Name>\<Version>\*.tmx Windows: Twin CAT 3.1.4024.x: C:\Twin CAT\3.1\Boot\Repository\C++ Module Vendor\Untitled1\0.0.0.1\Untitled1.tmx From Twin CAT 3.1.4026.x: C:\Program Data\Beckhoff \Twin CAT\3.1\Boot\Repository\C++ Module Vendor\Untitled1\0.0.0.1\Untitled1.tmx Twin CAT/BSD: /usr/local/etc/Twin CAT/3.1/ Boot\/Repository\C++ Module Vendor\Untitled1/0.0.0.1/Untitled1.tmx %TC_BOOTPRJPATH% Twin CAT Module Instance file \TM\OBJECTID.tmi Describes variables of the driver File name is Object ID.tmi Windows: Twin CAT 3.1.4024.x: C:\Twin CAT\3.1\Boot\TMI\OTCID.tmi From Twin CAT 3.1.4026.x: Windows: C:\Program Data\Beckhoff \Twin CAT\3.1\Boot\TMI\OTCID.tmi Twin CAT/BSD: /usr/local/etc/Twin CAT/3.1/Boot/TMI/OTCID.tmi Temporary files *.sdf Intelli Sense Database *.suo / *.v12.suo User-specific and Visual Studio-specific files *.tsproj.bak Automatically generated backup file from tsproj ipch/ Intermediate directory created for precompiled headers Twin CAT 3 Version: 1.3.1 211
## Page 212

Target systems 3.3.3 Twin CAT project files 3.3.3.1 Current Config.xml Description file of the current configuration. Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\ \Twin CAT\3.1\Boot • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot Time of creation • Creating a Twin CAT project. • Activate configuration. • Recreating a Twin CAT project. Requirement - - 3.3.3.2 Current Config.tszip Archive folder containing the tsproj file and all referenced xti files. Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\ \Twin CAT\3.1\Boot • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot Time of creation • Creating a Twin CAT project. • Activate configuration. • Recreating a Twin CAT project. Requirement • Auto Save <Twin CAT project name> to Target as Archive is active 3.3.4 PLC HMI files 3.3.4.1 Port_xxx.textlistname.txt For each text list existing in the project, a file is created containing all the entries in this text list. Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\ \Twin CAT\3.1\Boot\Plc\Port_xxx\Visu Plc\Port_xxx\Visu • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc\Port_xxx\Visu Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Online Change / Download Requirement • Target and/or web visualization object added. 212 Version: 1.3.1 Twin CAT 3
## Page 213

Target systems 3.3.4.2 Port_xxx Folder In this folder a further folder "Visu" is automatically created in which the files and the images of the PLC HMI are saved in turn. Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\ Plc\ \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. Requirement • Target and/or web visualization object added. 3.3.5 PLC HMI files (Target Visualization) 3.3.5.1 tc3plchmi.ini Configuration file containing the settings of the target visualization client Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\ Plc \Twin CAT\3.1\Boot\Plc • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Online Change / Download Requirement • Target visualization object added. 3.3.6 PLC HMI Web files 3.3.6.1 port_xxx.imagepoolcollection.csv File containing a list of the entries of all image pools available in the PLC project Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\ \Twin CAT\3.1\Boot\Plc\Port_xxx\Visu Plc\Port_xxx\Visu • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc\Port_xxx\Visu Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Online Change / Download Requirement • Web visualization object added. Twin CAT 3 Version: 1.3.1 213
## Page 214

Target systems 3.3.6.2 webvisu.cfg.json Configuration file containing the settings of the web visualization object Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\ \Twin CAT\3.1\Boot\Plc\Port_xxx\Visu Plc\Port_xxx\Visu • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc\Port_xxx\Visu Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Online Change / Download Requirement • Web visualization object added. 3.3.6.3 webvisu.htm HTML page used to display the visualization in the internet browser Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\ \Twin CAT\3.1\Boot\Plc\Port_xxx\Visu Plc\Port_xxx\Visu • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc\Port_xxx\Visu Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Online Change / Download Requirement • Web visualization object added. 3.3.6.4 webvisu.js File containing the Java Script logic that is used in the visualization Storage location Project Directory Twin CAT boot directory Path ..\<Solution name>\<Project • < TC3.1.4026.0: C: name>\_Boot\<Platform>\ \Twin CAT\3.1\Boot\Plc\Port_xxx\Visu Plc\Port_xxx\Visu • >=TC3.1.4026.0: C: \Program Data\Beckhoff\Twin CAT\3.1 \Boot\Plc\Port_xxx\Visu Time of creation • Creating a PLC project. • Activate configuration. • Recreating a PLC project. • Online Change / Download Requirement • Web visualization object added. 3.4 Machine update at file level 3.4.1 Overview If no Twin CAT 3 development environment (XAE) is available, you can update the boot data of a Twin CAT PLC system or a complete Twin CAT system by means of a file copy. • Performing a PLC update [} 215] 214 Version: 1.3.1 Twin CAT 3
## Page 215

Target systems • Performing a C++ update [} 215] • Performing an update of the complete machine [} 216] • Cloning a machine [} 216] A description of the various files as well as information on their storage location within the associated project (project directory) and on the machine (Twin CAT boot directory) can be found in the section Folder and file types [} 203]. 3.4.2 Performing a PLC update ü Twin CAT version TC3.1.4022.0 or higher ü Boot data has been generated for the machine platform by creating (or recreating) the PLC project. A connection to the target system is not required when creating (or recreating) the project. ü The process image and the hardware configuration have not changed since the last update. ü The Symbolic Mapping option is activated in the PLC project settings. 1. Copy the boot data of the PLC project, i.e. all files and folders, from the folder ..\<Solution name>\<Project name>\_Boot\<Platform>\Plc\. 2. Replace the boot data in the machine’s Twin CAT PLC boot directory with the copied boot data. ð < TC3.1.4026.0: C:\Twin CAT\3.1\Boot\Plc ð >=TC3.1.4026.0: C:\Program Data\Beckhoff\Twin CAT\3.1\Boot\Plc 3. Restart the machine’s Twin CAT system. ð The boot data of the Twin CAT PLC system and thus the PLC runtime itself are updated. Source code update If you store the source code of the PLC project on the runtime system in addition to the boot data, you can also copy the archive folder from the folder ..\<Solution name>\<Project name>\_Boot\<Platform>\ Current Config\ to the folder Current Config of the boot directory on the runtime system during a file level update. < TC3.1.4026.0: C:\Twin CAT\3.1\Boot\Current Config >=TC3.1.4026.0: C:\Program Data\Beckhoff\Twin CAT\3.1\Boot\Current Config 3.4.3 Performing a C++ Update Runtime data can be transferred from one machine to another via file copy if both machines are from the same platform and are connected with equivalent hardware equipment. The following steps describe a simple procedure for transferring a binary configuration from one machine (“source”) to another (“target”). 1. Purge the boot folder on the source machine. ð < TC3.1.4026.0: C:\Twin CAT\3.1\Boot ð >=TC3.1.4026.0: C:\Program Data\Beckhoff\Twin CAT\3.1\Boot 2. Create (or enable) the module on the source machine. 3. Transfer the boot folder from the source to the target machine. This folder also contains the repository which contains the required TMX files. The folder is located at the following location on both the source and target machines. ð < TC3.1.4026.0: C:\Twin CAT\3.1\Boot ð >=TC3.1.4026.0: C:\Program Data\Beckhoff\Twin CAT\3.1\Boot 4. For Twin CAT driver projects (.sys): Transfer the driver MYDRIVER.sys and if necessary also the PDB file. ð < TC3.1.4026.0: C:\Twin CAT\3.1\Driver\Auto Install\MYDRIVER.sys ð >=TC3.1.4026.0: C:\Program Data\Beckhoff\Twin CAT\3.1\Driver\Auto Install\MYDRIVER.sys Twin CAT 3 Version: 1.3.1 215
## Page 216

Target systems 5. For Twin CAT driver projects (.sys) and if the drivers are new on a machine: Twin CAT must perform a registration once. Switch Twin CAT to Run mode via Sys Tray (right click -> System -> Start/Restart). Alternatively, this call can be used (replace “%1” as driver name): ð < TC3.1.4026.0: sc create %1 bin Path= c:\Twin CAT\3.1\Driver\Auto Install\%1.sys type= kernel start= auto group= "file system" Display Name= %1 error= normal ð >=TC3.1.4026.0: sc create %1 bin Path= C: \Program Data\Beckhoff\Twin CAT\3.1\Driver\Auto Install\%1.sys type= kernel start= auto group= "file system" Display Name= %1 error= normal ð You can now start the target machine. Handling licenses Note that licenses cannot be transferred in this way. Please use preinstalled licenses, volume licenses, or other methods for providing licenses. 3.4.4 Performing an update of the complete machine ü Boot data has been generated for the machine platform by creating (or recreating) the Twin CAT project. A connection to the target system is not required when creating (or recreating) the project. ü The real hardware configuration corresponds to the project configuration. ü If the machine update is to be performed on multiple machines rather than on a specific machine, the following options are enabled: Use Relative Net Ids in the routes settings (System > Routes, Net Id Management tab) and Virtual Device Names in the adapter settings of all network and USB devices (e.g. I/O > Devices > Ether CAT Master, Adapter tab) The network adapter names of the machine must match the adapter name in the configuration. 1. Copy the boot data of the Twin CAT project, i.e. all files and folders, from the folder ..\<Solution name>\<Project name>\_Boot\<Platform>\. 2. Replace the boot data in the machine’s Twin CAT boot directory with the copied boot data. ð < TC3.1.4026.0: C:\Twin CAT\3.1\Boot ð >=TC3.1.4026.0: C:\Program Data\Beckhoff\Twin CAT\3.1\Boot 3. If you use C++ modules, copy the C++ drivers (see chapter Performing a C++ update [} 215]). 4. Restart the machine’s Twin CAT system. ð The boot data of the Twin CAT system and thus the Twin CAT system itself are updated. 3.4.5 Cloning a machine To transfer the boot data of a Twin CAT or PLC project from one machine to another, copy the boot data from the boot directory of the first machine and replace the boot data in the boot directory of the other machine. If the Twin CAT system whose boot data is to be copied is in Run mode and persistent data is also to be exchanged, the Twin CAT system should first be switched from Run to Config mode so that the persistent data is saved in the .bootdata file and is available for copying in the boot directory. (See Port_xxx.bootdata [} 206]) 3.5 Starting the program automatically Twin CAT 3 offers the option to start selected programs automatically after startup. This is especially useful for programs where Twin CAT must be started before execution, e.g. visualization software. To start a program automatically after Twin CAT startup, a shortcut of the program must be created in a special startup folder in the Twin CAT directory. The program itself must be installed locally on the same PC as Twin CAT. After the first activation of the Run Mode after starting the Twin CAT runtime system, the shortcuts in the Startup folder are executed. 216 Version: 1.3.1 Twin CAT 3
## Page 217

Target systems The path <Twin CAT>\3.x\Target\Start Up leads to the startup folder. The designation results as follows: <Twin CAT> Twin CAT installation folder • < TC3.1.4026.0: C:\Twin CAT\ • >=TC3.1.4026.0: C:\Program Files (x86)\Beckhoff\Twin CAT\ 3.x Twin CAT version (all versions of Twin CAT are stored in separate folders in the Twin CAT installation folder). x Placeholder for the build of Twin CAT, e.g. "3.1". 1. Save a shortcut to the program in the folder <Twin CAT>\3.x\Target\Start Up. 2. Make sure that Twin CAT starts in Run Mode. 3. In the Twin CAT project tree, double-click on SYSTEM and select the Settings tab. 4. Enable the options Run Mode (Enable) and Auto Logon. 5. Click Apply. 3.6 Corrected time stamps 3.6.1 Overview Controllers generate data to be collected and linked in modern, distributed systems. Since controllers start off as stand-alone devices, they have independent time bases. In a common database, it would not be possible to correlate data with respect to time. In order to counter this problem, it has been possible for quite some time to synchronize controllers with each other, for example using the network protocol IEEE1588 or PTP. However, in many scenarios it is sufficient to provide the data with a uniform timestamp. The controllers can be operated independently of each other, so that on the one hand the hardware costs associated with the Twin CAT 3 Version: 1.3.1 217
## Page 218

Target systems protocols mentioned above are reduced, while on the other hand there is no technical dependency between the controllers. This chapter describes the Twin CAT components for adapting timestamps for storing time-synchronous data. The figure illustrates the basic idea: independent controllers obtain the local timestamp and adjust it using an offset, which is then used to store the common data. A central component, the external time interface, is available in Twin CAT real-time for this purpose. This component • receives the offset to the corrected time from a configured source (external time provider). • provides the external time consumer with a corrected time, depending on the current local time. This corrected time can then be used by different components inside and outside the real-time. The source is typically either an NTP server or a DC time signal based on Ether CAT, which is synchronized via EL6688 through PTP (IEEE1588), for example. However, a source can also be implemented by the customer, so that other time signals can be realized as a source. In addition to the central component in the Twin CAT real-time described above, the concept thus comprises two types of components: 1. External time providers: provide an offset for adjusting timestamps of the central component. For example, a provider obtains a timestamp via NTP (Network Time Protocol, see RFC 4330), from which it calculates an offset to the local system time and makes this available. 2. External time consumers: use an offset that they obtain from the central component. Thus a timestamp can be used in the components that leads to comparable data on remote devices. All Twin CAT components that use timestamps can be consumers, and also customer applications. 3.6.2 System requirements Technical data Requirement Operating system Windows 10 Target platform PC architecture (x86, x64) Twin CAT version Twin CAT 3.1 build 4024.0 or higher Required Twin CAT setup level Twin CAT 3 XAE, XAR Required Twin CAT license Any runtime license (PLC, C++) 3.6.3 Limitations Some important limitations have to be taken into account: • The Twin CAT system time is not changed by the external time interface described here • The external time offsets are made available to the consumers as provided by the provider. It follows that ◦ the offset must be calculated correctly by the provider. 218 Version: 1.3.1 Twin CAT 3
## Page 219

Target systems ◦ no monotony can be guaranteed in the timestamps. • The external time offsets are not saved and subsequently made available for retrieval. This means that only the current offsets are managed in the Twin CAT system. 3.6.4 Technical introduction Twin CAT offers different interfaces for the external time provider and the external time consumer in order to utilize the concept of corrected timestamps. On the external time consumer side, different Twin CAT components are able to use the external timestamp. In addition, there are different access options for applications. On the external time provider side, modules are provided that can calculate and provide an offset via NTP. In addition, there is a module that can use the offset via DC. The corresponding interface for providing the offset is also offered for Twin CAT C++, so that customers can create their own external time providers. Timestamps for different use cases It should be noted that Twin CAT differentiates between four types of timestamps in this concept: 1. None: Local system time and no correction 2. Soft: Recommended use e.g. for NTP 3. Medium: Recommended use e.g. for IEEE1588 4. Hard: Recommended use e.g. for hardware synchronization where no drift should occur An external time provider provides one of the possible offsets; only one provider can be defined for each type. An external time consumer can then use any offset; all four offset types can be used as required. Thus it is possible to use different timestamps in different ensembles or operation modes. For example, a local diagnosis can take place with the local system time, while at the same time aggregated data from different systems can be corrected with the offset type Soft and stored in a common database. The interfaces of the corrected timestamps use data types with a length of 8 bytes and are counted from 1.1.1601 in 100 ns steps. 3.6.4.1 Consumers External time consumers are components that can correct the local system time with an offset. For this purpose, the components must select or configure an offset of type Soft, Medium or Hard and query it accordingly. 3.6.4.1.1 Twin CAT components as offset consumers The following Twin CAT components support the approach of corrected timestamps – the respective documentation describes how this functionality can be enabled: • Twin CAT 3 Event Logger • Twin CAT Scope This list will be extended. 3.6.4.1.2 Application implementation Applications can use the external time offsets in different components: • Real-time PLC: The PLC can query an offset or have a local timestamp corrected accordingly. • Real-time – C++: C++ Tc COM modules are able to query the offset and act accordingly. • User mode – ADS device notifications: The timestamps sent with the ADS device notifications can be corrected. Twin CAT 3 Version: 1.3.1 219
## Page 220

Target systems • User mode – ADS Read: The corrected timestamp can be retrieved by an ADS Read. This can be used in ADS Sum commands to retrieve a timestamp along with data. The interfaces are documented in the corresponding API chapters. 3.6.4.2 Provider External time providers are components that determine an external time offset in relation to the local system time through an external information source and make it available in Twin CAT. This allows external time consumers to receive a corrected time, independent of the provider. Twin CAT also supplies providers with: • NTP providers: an implementation that queries and provides a time signal from an NTP server via (S)NTP. • DC providers: An implementation that passes on the DC time from the Ether CAT master to Twin CAT as an offset (e.g. via IEEE1588 or PTP) • In addition, the customer is able to provide his own providers. 3.6.4.2.1 NTP provider The NTP provider is an (S)NTP client that cyclically receives a time signal from an NTP server. This allows it to calculate an offset of the system time from the time signal of the NTP server and make it available accordingly. Configuration The NTP provider is implemented as Tc COM module Tc Ntp External Time Provider. This module is commissioned as a Tc COM module as follows: ü Twin CAT project 1. Insert a Tc COM module under System->Tc COM Objects and select type Tc Ntp External Time Provider in the category External Time Provider. 220 Version: 1.3.1 Twin CAT 3
## Page 221

Target systems 2. The module requires a task from which it is called. This is parameterized via the Context tab of the module: ð The Tc COM module can be parameterized: The configuration takes place in the Parameter (Init) tab. The parameters have the following meanings: • Time Type: The type of offset for which this module is to determine an offset. Client Para: • b Enable: The module can be disabled to prevent NTP communication. • s Server Name: The name of the NTP server to be used as the source. • n Server Address: IP address of an NTP server (used if s Server Name is empty). • n Server Port: The UDP port of the NTP server to be used (default: 123). • t Poll Intervall: The interval in which the NTP queries are to be started. The maximum specified by the server is taken into account, which may slow down requests. This module passes a determined offset to Twin CAT via the ITc Set External Time [} 227] interface. In addition, outputs are available for mapping. Twin CAT 3 Version: 1.3.1 221
## Page 222

Target systems NTP provider as NTP server Optionally, the same module can also act as an NTP server. Thus, a time signal can be obtained from an external NTP server (as a client) and simultaneously provided to lower-level systems. For the external server, the NTP protocol typically requires a minimum query time of 8 seconds or more. The NTP provider as NTP server, on the other hand, allows more frequent query intervals. Server function The server functionality is normally hidden. It can be displayed and configured via Show Hidden Parameters: • b Enable: Enable NTP server functionality for this module. To do this, open the udp/123 port in the Windows firewall. • n Port: The UDP port that is used to offer the server (default: 123). The following parameters are used to adjust the NTP information provided. By default, the parameters are set as specified in the protocol; they can be overwritten here: • n Leap: Manual configuration of the Leap Indicator. • n Stratum: Manual configuration of the stratum. • n Root: Manual configuration of the root server information, as defined depending on the stratum. 222 Version: 1.3.1 Twin CAT 3
## Page 223

Target systems Filter function If offsets are determined by the NTP server query, the module can independently perform a transition from the old offset to the new offset. This functionality is normally hidden. It can be displayed and configured via Show Hidden Parameters: • e Mode: A selection of modes. Currently, either no adjustment or a linear adjustment is made (default). The following parameters apply if "Linear" is selected as e Mode: • n Filter: Number of values for which the average is taken, i.e. number of NTP responses. With a poll interval of 1 s, n Filter = 60 would effect a filter for one minute. (Default: 60). • n Limiter: The offset is changed by this value at the most per cycle. If the difference between the local and external clocks were to be 100 ms and the cycle time 1 ms, it would thus take 100,000 cycles or 1.6 minutes at n Limiter = 10 until the offset has settled. (Default: 1 µs). • n Modulo: Rounding of the offset. Usually this should be chosen depending on the cycle time. The offset is adjusted via this modulo so that no "un-round" times are created. The DC Time will return the modulo of the cycle time; corrected with the offset, the timestamp thus remains "round". The offset/ timestamp changes as a result, but also with small jumps if an adjustment takes place. As described under n Limiter and with n Modulo = 1000, the offset and thus the relative timestamp would increment every 100th cycle by 0.1 ms. Diagnostics Diagnostic information can be viewed under the Parameters (Online) tab. Twin CAT 3 Version: 1.3.1 223
## Page 224

Target systems For each line there is a corresponding description in the Comment column. In addition, corresponding symbols are available for programmatic evaluation: • b Is Connected: At least 8 successful responses were received from the server (TRUE) or at least 8 requests were not answered (FALSE). • b Is Synchronized: The determined time of the client has been determined in the last 8 responses with a deviation smaller than the cycle time of the server. • n Last Update: The time of the last evaluated response from the server. 3.6.4.2.2 DC provider The DC provider obtains an offset through mapping from an Ether CAT master. It can be used to use time values from the I/O range as offset, such as those provided by the Ether CAT master (DC time) or an EL6695. Configuration The DC provider is implemented as Tc COM module Tc Dc External Time Provider. This module is commissioned as a Tc COM module as follows: ü Twin CAT project 224 Version: 1.3.1 Twin CAT 3
## Page 225

Target systems 1. Insert a Tc COM module under System->Tc COM Objects and select type Tc Dc External Time Provider in the category External Time Provider. 2. The module requires a task from which it is called. This is parameterized via the context tab of the module: ð The module can be parameterized: The configuration takes place in the Parameters (Init) tab. The parameters have the following meanings: • Time Type: The type of offset for which this module is to determine an offset. Twin CAT 3 Version: 1.3.1 225
## Page 226

Target systems • This module obtains the offset itself through mapping: This module passes a determined offset to Twin CAT via the ITc Set External Time [} 227] interface. In addition, outputs are available for mapping. 3.6.4.2.3 Application implementation An application can provide its own Time Offset provider by using the ITc Set External Time interface in Twin CAT C++. This module provides a cyclic value for the respective offsets, if necessary. Sequence A module implements the following sequence ü A Tc COM module was instantiated 1. The module registers itself as provider of a certain type of offset (Soft/Medium/Hard) via Register External Time Provider 226 Version: 1.3.1 Twin CAT 3
## Page 227

Target systems 2. Set External Time Offset can be used to provide an offset cyclically, if necessary 3. The module logs off using Unregister External Time Provider Registration ensures that an offset of only one module can be used at a time. A more detailed description of the ITc Set External Time interface can be found in chapter ITc Set External Time interface [} 227]. 3.6.5 Real-time API At this point, interfaces and structures are documented to deal with the corrected timestamps from the real- time. 3.6.5.1 Structures 3.6.5.1.1 Enum Time Type Twin CAT provides four different timestamps. The Enum Time Type is used to distinguish between them. Syntax enum Time Type { System Time = 0, External Time Hard = 1, External Time Medium = 2, External Time Soft = 3, // e.g. NTP }; Values How the three external timestamp types are used in practice depends on application. The example below is merely a suggestion. Name Description External Time Hard Suggested use for hard offsets that have no drift External Time Medium Suggested use for accurate offsets such as IEE1588 External Time Soft Suggested use for general offsets, such as NTP 3.6.5.2 Interfaces At this point the interfaces are described which are used for the corrected time stamps. For the different time formats and representations there is a corresponding list in the C++ SDK. See: Infosys C/C++ 3.6.5.2.1 ITc Set External Time interface The ITc Set External Time interface is implemented by the Tc COM object server. It can be used to provide an externally determined offset. Syntax TCOM_DECL_INTERFACE("00000067-0000-0000-e000-000000000064", ITc Set External Time) struct __declspec(novtable) ITc Set External Time : public ITc External Time Twin CAT 3 Version: 1.3.1 227
## Page 228

Target systems Methods Name Description Register External Time Provider [} 228] Registering a provider for an offset related to Time Type Unregister External Time Provider [} 228] Logging off a provider for an offset related to Time Type Set External Time Offset [} 228] Provide a new offset for the registered Time Type Comments This interface is not available for the PLC. 3.6.5.2.1.1 Register External Time Provider method Registering a provider for an offset related to Time Type Syntax HRESULT TCOMAPI Register External Time Provider(OTCID oid Provider, Time Type type) = 0; Parameter oid Provider: (type: OTCID) The object ID of the provider; normally the object ID of the calling party type: (type: Time Type [} 227]) The Time Offset type to be registered. Return value Type: HRESULT Notifies the success of registration Description 3.6.5.2.1.2 Unregister External Time Provider method Logging off a provider for an offset related to Time Type Syntax HRESULT TCOMAPI Unregister External Time Provider(OTCID oid Provider, Time Type type) = 0; Parameter oid Provider: (type: OTCID) The object ID of the provider; normally the object ID of the calling party type: (type: Time Type [} 227]) The Time Offset type to be logged off. Return value Type: HRESULT Notifies the success of the deregistration Description 3.6.5.2.1.3 Set External Time Offset method Provide a new offset for the registered Time Type 228 Version: 1.3.1 Twin CAT 3
## Page 229

Target systems Syntax HRESULT TCOMAPI Set External Time Offset(OTCID oid Provider, Time Type type, __int64 offset) = 0; Parameter oid Provider: (type: OTCID) The object ID of the provider; normally the object ID of the calling party type: (type: Time Type [} 227]) The Time Offset type offset: (type: __int64) The new offset value. Return value Type: HRESULT Notifies the success. Description It is valid for the offset External Time = Internal Time + Offset. I.e. if the time in Twin CAT is in the past, the offset must be greater than 0. 3.6.5.2.2 ITc External Time interface The ITc External Time interface is implemented by the Tc COM object server. This can be used to retrieve and use an externally determined offset. Syntax TCOM_DECL_INTERFACE("00000066-0000-0000-e000-000000000064", ITc External Time) struct __declspec(novtable) ITc External Time : public ITc Unknown Methods Name Description System Time To External Time [} 229] Calculation of a corrected timestamp in relation to the system time External Time To System Time [} 230] Calculation of the system time in relation to a corrected timestamp Get External Time Offset [} 230] Retrieving an offset in relation to the Time Type Get External Time Provider [} 230] Queries the Object ID of the current provider 3.6.5.2.2.1 System Time To External Time method Calculation of a corrected timestamp in relation to the system time Syntax HRESULT TCOMAPI System Time To External Time(Time Type type, __int64& time) = 0; Parameter type: (type: Time Type [} 227]) The Time Offset type to be used for the calculation time: (type: __int64&) The timestamp to be corrected by offset Return value Type: HRESULT Notifies the success. Twin CAT 3 Version: 1.3.1 229
## Page 230

Target systems Description 3.6.5.2.2.2 External Time To System Time method Calculation of the system time in relation to a corrected timestamp Syntax HRESULT TCOMAPI External Time To System Time(Time Type type, __int64& time) = 0; Parameter Type: (type: Time Type [} 227]) The Time Offset type to be used for the calculation time: (type: __int64&) The corrected timestamp, adjusted by the offset. Return value Type: HRESULT Notifies the success. Description The offset valid at the time of the call is used to determine the local system time. 3.6.5.2.2.3 Get External Time Offset method Retrieving an offset in relation to the Time Type Syntax HRESULT TCOMAPI Get External Time Offset(Time Type type, __int64& offset) = 0; Parameter type: (type: Time Type [} 227]) The Time Offset type to be retrieved offset: (type: __int64&) The value set to the offset. Return value Type: HRESULT Notifies the success. Description 3.6.5.2.2.4 Get External Time Provider method Queries the Object ID of the current provider Syntax HRESULT TCOMAPI Get External Time Provider(Time Type type, OTCID& oid Provider) = 0; Parameter type: (type: Time Type [} 227]) The Time Offset type whose provider is to be queried. oid Provider: (type: OTCID&) The Object ID that is set to the Object ID of the provider. 230 Version: 1.3.1 Twin CAT 3
## Page 231

Target systems Return value Type: HRESULT Notifies the success. Description 3.6.6 ADS API The Time Offsets can also be queried via ADS. There are two ways to do this 1. ADS Notification: ADS notifications contain a time stamp that contains the time at which the data was changed. An ADS client sends an ADS command before the Add Device Notification. This causes the target system to register which type of corrected time stamp is required from this ADS client. 2. ADS Read: A corrected time stamp can be read out via ADS Read. This can be used to obtain a corrected time stamp in an ADS Sum command at the time when the ADS commands were executed. Twin CAT 3 Version: 1.3.1 231
## Page 232

Target systems Index group Index offset Access Data type Description Note ADSIGRP_EXT ERNALTIME 0x F088 ADSIOFFS_EX R LONG Read the currently configured offset The return TERNALTIME_ type for the respective ADS client value is type 0 SET (Ams Net Addr incl. client port). = None, 1 = Hard, 2 = Medium, 3 = 0x0000 Soft ADSIOFFS_EX W Set the offset type for the __ is type 0 = TERNALTIME_ ADSDevice notifications of the None, 1 = SET respective ADS client (Ams Net Addr Hard, 2 = incl. client port). Medium, 3 = Soft 0x00__ ADSIOFFS_EX R LONGLON Reading the current offset for a type. __ is type: TERNALTIME_ G 0 = None, 1 = OFFSET Hard, 2 = Medium, 3 = 0x01__ Soft ADSIOFFS_EX W LONGLON Setting the current offset for a type. __ is type: TERNALTIME_ G 0 = None, 1 = OFFSET Hard, 2 = Medium, 3 = 0x01__ Soft ADSIOFFS_EX R LONGLON Reading the corrected time stamp. __ is type: TERNALTIME_ G 0 = None, 1 = ABSOLUTE Hard, 2 = Medium, 3 = 0x02__ Soft ADSIOFFS_EX R ULONG Reading the object ID from the __ is type: TERNALTIME_ Time Offset provider. 0 = None, 1 = PROVIDER Hard, 2 = Medium, 3 = 0x03__ Soft ADSIOFFS_EX R LONG Reads the type that is used if no The return TERNALTIME_ other type is set. value is type 0 SETALL = None, 1 = 0x0400 Hard, 2 = Medium, 3 = Soft ADSIOFFS_EX W Sets the type that is used if no other __ is type 0 = TERNALTIME_ type is set. None, 1 = SETALL Hard, 2 = Medium, 3 = 0x04__ Soft The Defines can be found in the file "Ads.h". The ADS consumer sample [} 233] illustrates the application. 3.6.7 Samples Various samples illustrating the use of the corrected timestamps are provided for the benefit of the user: • PLC Consumer [} 233]: A PLC program accesses corrected timestamps. • C++ Consumer [} 234]: A C++ Tc COM module accesses corrected timestamps. • ADS Consumer [} 233]: An ADS client in user mode accesses the corrected timestamps. 232 Version: 1.3.1 Twin CAT 3
## Page 233

Target systems • C++ Provider [} 234]: A C++ Tc COM module determines an offset and provides it. The corrected timestamps are also used by other components of the Twin CAT system. A required configuration can be found with the respective components. 3.6.7.1 ADS consumer The ADS Consumer sample retrieves corrected timestamps as described in the ADS API [} 231]. Download Here you can access the https://infosys.beckhoff.com/content/1033/tc3_Grundlagen/Resources/ 7705550603.zip for this sample. ü Start the Twin CAT target system with which the ADS Consumer sample is to communicate. The PLC Consumer [} 233] sample can be used. 1. Unpack the downloaded ZIP file. 2. Open the included vcxproj file in Visual Studio. 3. Adjust the target Ams Net ID. (Tc External Time Ads Client.cpp, line 119) ð The sample is ready for operation. Description The sample code can be found in the CPP file Tc External Time Ads Client.cpp Different Use Cases for receiving corrected timestamps are illustrated in the Main() method: • Reading of the provider, the offset and the corrected timestamp from the system service for the different offsets: uncorrected(0), soft(1), medium(2), hard(3), plus an invalid value (4) to illustrate the error behavior. • Reading the corrected timestamps from a PLC program for the different offsets. • Reading the provider used and all providers. • Subscribing to a variable in the PLC; the time provided via notification has a corrected timestamp. The output takes place in the Ads Notification Callback() method. 3.6.7.2 PLC Consumer The PLC Consumer sample retrieves a corrected timestamp from the Twin CAT system and uses it. Download Here you can access the https://infosys.beckhoff.com/content/1033/tc3_Grundlagen/Resources/ 7705583115.zip for this sample. 1. Open the tszip file that it contains in Twin CAT 3 by clicking on Open Project …. 2. Select your target system. 3. Build the sample on your local machine (e.g. Build->Build Solution). 4. Activate the configuration by clicking on . ð The sample is ready for operation. Description The Tc Ntp External Time Provider is configured under System > Tc COMObjects. Here you can parameterize your own NTP server under Parameter (Init), if the default pool.ntp.org cannot be reached. Twin CAT 3 Version: 1.3.1 233
## Page 234

Target systems The PLC program essentially consists of the function block FB_Tc External Time. It provides functions for reading a corrected timestamp from the Twin CAT system. The variable _e Time Type represents the type (soft, medium, hard) and can be parameterized. In MAIN, this function block is used for the e Time Type "Soft" to ensure that the corrected time set by NTP is used. 3.6.7.3 C++ consumer The C++ Consumer sample retrieves a corrected timestamp from the Twin CAT system and uses it. Download Here you can access the https://infosys.beckhoff.com/content/1033/tc3_Grundlagen/Resources/ 7705552907.zip for this sample. 1. Open the zip file that it contains in Twin CAT 3 by clicking on Open Project …. 2. Select your target system. 3. Build the sample on your local machine (e.g. Build->Build Solution). 4. Activate the configuration by clicking on . ð The sample is ready for operation. Description The Tc Ntp External Time Provider is configured under System > Tc COMObjects. Here you can parameterize your own NTP server under Parameter (Init), if the default pool.ntp.org cannot be reached. The C++ module cyclically determines a local timestamp in the Cycle Update() method and corrects it. It can be traced in the respective steps using the debugger. The corrected timestamp is provided as a parameter (online). The type required for this can be configured as parameter "Time Type" in the Tc COM object. 3.6.7.4 C++ provider The C++ provider sample determines an offset and stores it in the Twin CAT system so that it can be used by the consumers. Download Here you can access the https://infosys.beckhoff.com/content/1033/tc3_Grundlagen/Resources/ 7705555211.zip for this sample. 1. Unpack the downloaded .zip file. 2. Open the .zip file that it contains in Twin CAT 3 by clicking on Open Project …. 3. Select your target system. 4. Build the sample on your local machine (e.g. Build->Build Solution). 5. Activate the configuration by clicking on . ð The sample is ready for operation. Description The offset provider receives the offset to be provided as Data Area "External Time.n Offset“. This is transferred to the Twin CAT system as a Time Type medium, which can also be configured at runtime under Parameter (Init). 234 Version: 1.3.1 Twin CAT 3
## Page 235

Target systems In the Cycle Update() method, the Set External Time Offset method is used for this after a corresponding register has been created using Register External Time Provider for a Time Type. 3.6.8 FAQ 3.6.8.1 Windows as NTP client Windows itself offers an NTP client for the system time. In addition, an NTP time can be retrieved using the following script, which is useful for debugging purposes: @echo off set /p Server=Server: w32tm /stripchart /computer:%Server% /packetinfo /samples:10 pause 3.6.8.2 Windows as NTP server Windows itself offers an NTP server to provide timestamps. Please note that only one component can use the port for NTP (udp/123). This means that either the Twin CAT NTP server functionality [} 220] or the Windows NTP server can be used. The Windows NTP server is disabled by default and can be activated later: ü Windows 10 1. The registry key is set: HKLM\System\Current Control Set\Services\W32Time\Time Providers\Ntp Server Enabled = 1 2. The Windows Time system service is started and set to Autostart, if appropriate. Twin CAT 3 Version: 1.3.1 235
## Page 236

Target systems 3.7 Tc RTe Install The Tc RTe Install tool manages real-time Ethernet compatible devices of the control system. This involves installing a real-time capable driver for the standard Ethernet connection of a control system. Twin CAT 3 installation required The Tc RTe Install application can only be used in combination with a complete installation of Twin CAT 3 (XAE, runtime environment, XAR). Administrator rights required To run the Tc RTe Install application, you need administrator rights on the control system. 236 Version: 1.3.1 Twin CAT 3
## Page 237

Target systems Call in Twin CAT 3 XAE Call the driver via the menu TWINCAT → Show Realtime Ethernet Compatible Devices... . Alternatively you can install the driver by adding a network capable device to the I/O configuration (e.g. Ether CAT). In the adapter dialog of the network capable device, call the Tc RTe Install application with the button Compatible Devices...: Call in Twin CAT runtime environments You can directly call the installation application for the Twin CAT RT Ethernet adapter on a Twin CAT 3 runtime system. Location: up to and including Twin CAT 3.1.4024: c:\Twin CAT3.1\System\Tc Rte Install.exe as of Twin CAT 3.1.4026: c:\Program Files (x86)\Beckhoff\Twin CAT\3.1\System\Tc Rte Install.exe Manage network connections Tc Rte Install displays the real-time capable (Compatible devices) and non-real-time capable (Incompatible devices) network interface cards. Twin CAT 3 Version: 1.3.1 237
## Page 238

Target systems 1. Select a real-time capable network interface card from the list of "compatible devices". 2. Click on the Install button. ð The Twin CAT driver for real-time Ethernet and the Twin CAT Ethernet protocol are installed for the selected device. 238 Version: 1.3.1 Twin CAT 3
## Page 239

Target systems The option Show Bindings shows the connected protocol of the installed RT Ethernet device. Twin CAT 3 Version: 1.3.1 239
## Page 240

Target systems 240 Version: 1.3.1 Twin CAT 3
## Page 241

Type system 4 Type system Twin CAT 3 provides a type system for the management of data types. The type system consists of system basic types and can be extended by custom data types through the customer project. This documentation describes the Twin CAT 3 type system and the management of data types. The TMC editor, with which the data types are created and described, is described in the documentation entitled “C++” in the Twin CAT Module Class Editor (TMC) section. 4.1 Project-based type system The Twin CAT 3 type system is project-specific; i.e. it is a fixed component of a Twin CAT 3 project in a Visual Studio solution. Data types can be defined at various points and transferred if necessary to the Twin CAT 3 type system. Thus, local data types can also exist that don't exist in the Twin CAT 3 type system. You will find the type system in the Twin CAT 3 project tree as an object in the SYSTEM subtree. 4.2 Data types The Twin CAT 3 type system displays the data types in an editor on four different tabs. The editor is opened by double-clicking on the "Type System" object in the Twin CAT 3 project tree. Twin CAT 3 Version: 1.3.1 241
## Page 242

Type system The following data types (TMC editor: "Specifications") are displayed on the Data Types tab: • Alias: these data types are simply synonyms for other data types. For example, a time range (duration) can be defined in a specific project as UINT. • Struct: these data types are structures of other data types, which in turn can also be structures. • Enum: these data types describe enumerations. • Array: these data types are arrays with a defined number of dimensions as well as the respective length. The interfaces are displayed on the Interfaces tab. This data type describes an interface that can be provided or used by different components such as function blocks or Tc COM modules. An interface consists of methods that have a respective signature. The Functions tab shows PLC functions and PLC function blocks whose definition was read from in a TMC/ TML file. The Event Classes tab defines event classes that are used for the Twin CAT 3 Event Logger. 4.3 Handling of data types In order to create or modify a data type via the Twin CAT 3 type system, select the New or Edit command from the context menu of the first table column on the appropriate tab of the type system editor. Both commands open the TMC editor in which you can edit the data type. Data types from PLC projects Data types (DUTs) can be created and saved in a PLC project. These data types initially exist locally in the PLC project and are not usable from the point of view of Twin CAT 3. If the data types are used in the input/ output memory map (%I* / %Q*), they are imported into the Twin CAT 3 type system so that they can also be linked through the mapping. With the Convert to Global Type command in the context menu of a DUT in the PLC project tree you can transfer the DUT to the type system of the higher-level Twin CAT project. Thereafter the data type is usable in the PLC via the external types and is managed in the Twin CAT 3 type system. To transfer a data type from the Twin CAT 3 type system to a PLC project, you can use the source code in the “Data Types” dialog. 242 Version: 1.3.1 Twin CAT 3
## Page 243

Type system Data types from C++ projects In C++ projects the data types are defined in the TMC editor in parallel with the modules. Like the internal DUTs in the PLC project, these data types are local and thus invisible in the Twin CAT 3 type system. Through the use of the data types in a C++/Matlab module, which has also been instanced, the data types are inserted into the Twin CAT 3 type system. You can also insert a data type into the Twin CAT 3 type system without using the data type in an instanced C++ module by activating the Persistent (even if unused) check box. Use of data types in several projects In some cases it may be useful to use data types in several projects. In particular for EAP/network variables it can be useful to use the same data type on both the publisher and subscriber side. You can create individual TMC files for this under the "Type System" node. A check box appears in front of every data type in the editor window of the TMC files. Using the check box you can specify which data type is to be deposited in the respective TMC file. Twin CAT 3 Version: 1.3.1 243
## Page 244

Type system The data types are additionally deposited in the TMC files. You can use these files on different computers and in different projects, for example, by means of file exchange or version control. However, the file itself must not be used by different projects at the same time, so that these are normally stored in the project directory and this project is then available as a copy on different computers, e.g. via version control. Since the GUID is used to identify the data type, the type system recognizes this double deposition automatically. When using data types after they have been integrated in several projects, make sure that changes to the data types are made as far as possible only in one place. Otherwise the different variants can no longer be merged to a common version. See also: Management and identification of data types [} 244] 4.4 Management and identification of data types Data types in the Twin CAT 3 type system are fundamentally identified on the basis of their GUID. Thus, several data types can exist with the same name. The same applies to different versions of a data type. Each version of a data type is assigned a new GUID. At the same time, each data type has a list of data types that it keeps hidden ("Datatype Hides"). 244 Version: 1.3.1 Twin CAT 3
## Page 245

Type system This makes it possible to use different versions of a data type in the project at the same time. The Update Instances... command in the context menu of a data type in the type system editor (Data Types tab) employs the respectively latest version for selected uses of a data type. Twin CAT has a so-called reference counter for each data type. This counter can be seen in the Ref Count column in the editor of the type system. Each use of the data type in a project, and also in an editor and so on, increments the counter. If a counter is at 0, the data type is no longer used and is discarded. If the Persistent (even if unused) setting in the context menu of a data type is activated, the data type description will be saved in the Twin CAT project file (*.tsproj) even if the data type is not used in the Twin CAT project. The setting is activated by default with data types that are newly created directly via the type system editor. This ensures that the data types are not directly deleted if the Twin CAT project is saved before the new data types are used. If a Shared TMC is used underneath the Type System object in the Twin CAT project tree, the setting should not be activated for data types in this file as the data types are saved both in the project and in the Shared TMC. The setting is deactivated by default with data types that are newly created directly via a Shared TMC editor. The Auto Delete (if unused) setting should not be manually changed, but is shown for the sake of completeness. Data types for which this setting is activated are hidden for PLC projects and cannot be used there. The setting should not be used, for example, to automatically clean the type system. Unused data types are not automatically saved in the Twin CAT project and are then no longer in the type system after reloading the Twin CAT project. 4.5 Alignment of data types The memory layout of a data type is determined by the alignment. Further information on the alignment can be found in the “Alignment” section in the documentation entitled “PLC”. Twin CAT 3 Version: 1.3.1 245
## Page 246

Type system With the default alignment of 8 bytes it can be ensured that the access to data types functions optimally in terms of runtime and access on different platforms. Deviation from this should only take place in exceptional cases. The Twin CAT 3 type system marks data types in color. • Yellow if the length of the data type is not a multiple of the largest internal field (max. 8 bytes). As a result, the alignment no longer obeys the rules in the case of an array of such a data type. • Red if the alignment within the data type no longer obeys the rules. The TMC editor offers the possibility to specify the memory layout of a data type for a selected alignment. Alternatively, the layout can be manually specified using offsets. If the size of a data type that is used in another data type is changed, then this data type must also be adjusted. The TMC editor offers an appropriate recursive function for this at the data type overview level. 4.6 Files in connection with the type system The Twin CAT 3 type system is formulated entirely in XML. Depending on the field of application there are different files that contain the data types: • .tsproj file – Twin CAT project This file contains the entire Twin CAT project, including the complete Twin CAT 3 type system. 246 Version: 1.3.1 Twin CAT 3
## Page 247

Type system • .tmc files – Twin CAT Module Class files These files are used to describe the Tc COM modules themselves. They include module class descriptions and the data types used. At the same time, these files are used to realize the exchange of data types between projects, as described above. • .tmi files – Twin CAT Module Instance files These files describe the instance of a class. They are deposited on the destination by the Twin CAT 3 Engineering in order to describe an instance of a class. In addition, instance information can also be transferred from one project to another using a .tmi file. Twin CAT 3 Version: 1.3.1 247
## Page 248

Tc Com modules 5 Tc Com modules The Twin CAT Component Object Model defines the properties and behavior of the Twin CAT 3 Runtime modules and describes how different software components that have been developed and compiled independently of each other can work together. The following chapters explain the concept behind and handling of Tc COM modules. 5.1 The Twin CAT Component Object Model (Tc COM) concept The Twin CAT Component Object Model defines the characteristics and the behavior of the modules. The model derived from the "Component Object Model" COM from Microsoft Windows describes the way in which various independently developed and compiled software components can co-operate with one another. To make that possible, a precisely defined mode of behavior and the observation of interfaces of the module must be defined, so that they can interact. Such an interface is also ideal for facilitating interaction between modules from different manufacturers, for example. To some degree Tc COM is based on COM (Component Object Model of the Microsoft Windows world), although only a subset of COM is used. In comparison with COM, however, Tc COM contains additional definitions that go beyond COM, for example the state machine module. Overview and application of Tc COM modules This introductory overview is intended to make the individual topics easier to understand. One or several Tc COM modules are consolidated in a driver. This driver is created by Twin CAT Engineering using the MSVC compiler. The modules and interfaces are described in a TMC (Twin CAT Module Class) file. The drivers and their TMC file can now be exchanged and combined between the engineering systems. Instances of these modules are now created using the engineering facility. They are associated with a TMI file. The instances can be parameterized and linked with each other and with other modules to form the I/O. A corresponding configuration is transferred to the target system, where it is executed. Corresponding modules are started, which register with the Twin CAT Object Server. The Twin CAT XAR also provides the process images. Modules can query the Twin CAT Object Server for a reference to another object with regard to a particular interface. If such a reference is available, the interface methods can be called on the module instance. The following sections substantiate the individual topics. ID Management Different types of ID are used for the interaction of the modules with each other and also within the modules. Tc COM uses GUIDs (128-bit) and 32-bit long integers. Tc COM uses 248 Version: 1.3.1 Twin CAT 3
## Page 249

Tc Com modules • GUIDs for: Modul IDs, Class IDs and Interface IDs. • 32-bit long integers are used for: Parameter IDs, Object IDs, Context IDs, Category ID. Interfaces An important component of COM, and therefore of Tc COM too, are interfaces. Interfaces define a set of methods that are combined to perform a certain task. An interface is referenced with a unique ID (Interface ID), which must never be modified as long as the interface does not change. This ID enables modules to determine whether they can cooperate with other modules. At the same time the development process can take place independently, if the interfaces are clearly defined. Modifications of interfaces therefore lead to different IDs. The Tc COM concept is designed such that Interface IDs can superpose other (older) Interface IDs ( "Hides" in the TMC description / TMC editor). In this way, both versions of the interface are available, while on the other hand it is always clear which is the latest Interface ID. The same concept also exists for the data types. Tc COM itself already defines a whole series of interfaces that are prescribed in some cases (e.g. ITCom Object), but are optional in most. Many interfaces only make sense in certain application areas. Other interfaces are so general that they can often be re-used. Provision is made for customer-defined interfaces, so that two third-party modules can interact with each other, for example. • All interfaces are derived from the basic interface Itc Unknown which, like the corresponding interface of COM, provides the basic services for querying other interfaces of the module (Tc Query Interface) and for controlling the service life of the module (Tc Add Ref and Tc Release). • The ITCom Object interface, which must be implemented by each module, contains methods for accessing the name, Object ID, Object ID of the parent, parameters and state machine of the module. Several general interfaces are used by many modules: • ITc Cyclic is implemented by modules, which are called cyclically ("Cycle Update"). The module can register via the ITc Cyclic Caller interface of a Twin CAT task to obtain cyclic calls. • The ITc ADI interface can be used to access data areas of a module. • ITc Watch Source is implemented by default; it facilitates ADS Device Notifications and other features. • The ITc Task interface, which is implemented by the tasks of the real-time system, provides information about the cycle time, the priority and other task information. • The ITCom Object Server interface is implemented by the Object Server and referenced by all modules. A whole series of general interfaces has already been defined. General interfaces have the advantage that their use supports the exchange and recycling of modules. Only if no suitable general interfaces exist should you define your own interfaces. Class Factories "Class Factories" are used for creating modules in C++. All modules contained in a driver have a common Class Factory. The Class Factory registers once with the Object Server and offers its services for the creation of certain module classes. The module classes are identified by the unique Class ID of the module. When the Object Server requests a new module (based on the initialization data of the configurator or through other modules at runtime), the module selects the right Class Factory based on the Class ID and triggers creation of the module via its ITc Class Factory interface. Module service life Similar to COM, the service life of a module is determined via a reference counter (Ref Counter). The reference counter is incremented whenever a module interface is queried. The counter is decremented when the interface is released. An interface is also queried when a module logs into the Object Server (the ITCom Object interface), so that the reference counter is at least 1. The counter is decremented on logout. When the counter reaches 0, the module deletes itself automatically, usually after logout from the Object Server. If another module already maintains a reference (has an interface pointer), the module continues to exist, and the interface pointer remains valid, until this pointer is released. Twin CAT 3 Version: 1.3.1 249
## Page 250

Tc Com modules 5.1.1 Twin CAT module properties A Tc COM module has a number of formally defined, prescribed and optional properties. The properties are sufficiently formalized to enable interchangeable application. Each module has a module description, which describes the module properties. They are used for configuring the modules and their relationships with each other. If a module is instantiated in the Twin CAT runtime, it registers itself with a central system instance, the Object Server. This makes it reachable and parameterizable for other modules and also for general tools. Modules can be compiled independently and can therefore also be developed, tested and updated independently. Modules can be very simple, e.g. they may only contain a basic function such as low-pass filter. Or they may be very complex internally and contain the whole control system for a machine subassembly. There are a great many applications for modules; all tasks of an automation system can be specified in modules. Accordingly, no distinction is made between modules, which primarily represent the basic functions of an automation system, such as real-time tasks, fieldbus drivers or a PLC runtime system, and user- or application-specific algorithms for controlling a machine unit. The diagram below shows a common Twin CAT module with his main properties. The dark blue blocks define prescribed properties, the light blue blocks optional properties. 250 Version: 1.3.1 Twin CAT 3
## Page 251

Tc Com modules Module description Each Tc COM module has some general description parameters. These include a Class ID, which unambiguously references the module class. It is instantiated by the corresponding Class Factory. Each module instance has an Object ID, which is unique in the Twin CAT runtime. In addition there is a parent Object ID, which refers to a possible logical parent. The description, state machine and parameters of the module described below can be reached via the ITCom Object interface (see "Interfaces"). Class description files (*.tmc) The module classes are described in class description files (Twin CAT Module Class; *.tmc). These files are used by developers to describe the module properties and interfaces, so that others can use and embed the module. In addition to general information (vendor data, module class ID etc.), optional module properties are described. Twin CAT 3 Version: 1.3.1 251
## Page 252

Tc Com modules • Supported categories • Implemented interfaces • Data areas with corresponding symbols • Parameter • Interface pointers • Data pointers, which can be set The system configurator uses the class description files mainly as a basis for the integration of a module instance in the configuration, for specifying the parameters and for configuring the links with other modules. They also include the description of all data types in the modules, which are then adopted by the configurator in its general data type system. In this way, all interfaces of the TMC descriptions present in the system can be used by all modules. More complex configurations involving several modules can also be described in the class description files, which are preconfigured and linked for a specific application. Accordingly, a module for a complex machine unit, which internally consists of a number of submodules, can be defined and preconfigured as an entity during the development phase. Instance description files (*.tmi) An instance of a certain module is described in the instance description file (Twin CAT Module Instance; *.tmi). The instance descriptions are based on a similar format, although in contrast to the class description files they already contain concrete specifications for the parameters, interface pointers etc. for the special module instance within a project. The instance description files are created by Twin CAT Engineering (XAE), when an instance of a class description is created for a specific project. They are mainly used for the exchange of data between all tools involved in the configuration. However, the instance descriptions can also be used cross-project, for example if a specially parameterized module is to be used again in a new project. State machine Each module contains a state machine, which describes the initialization state of the module and the means with which this state can be modified from outside. The state machine describes the states, which occur during starting and stopping of the module. This relates to module creation, parameterization and production in conjunction with the other modules. Application-specific states (e.g. of the fieldbus or driver) can be described in their own state machines. The state machine of the Tc COM modules defines the states INIT, PREOP, SAFEOP and OP. Although the state designations are the same as under Ether CAT fieldbus, the actual states differ. When the Tc COM module implements a fieldbus driver for Ether CAT, it has two state machines (module and fieldbus state machine), which are passed through sequentially. The module state machine must have reached the operating state (OP) before the fieldbus state machine can start. The state machine is described [} 257] in detail separately. 252 Version: 1.3.1 Twin CAT 3
## Page 253

Tc Com modules Parameter Modules can have parameters, which can be read or written during initialization or later at runtime (OP state). Each parameter is designated by a parameter ID. The uniqueness of the parameter ID can be global, limited global or module-specific. Further details can be found in the "ID Management" section. In addition to the parameter ID, the parameter contains the current data; the data type depends on the parameter and is defined unambiguously for the respective parameter ID. Interfaces Twin CAT 3 Version: 1.3.1 253
## Page 254

Tc Com modules Interfaces consist of a defined set of methods (functions), which offer modules through which they can be contacted by other modules. Interfaces are characterized by a unique ID, as described above. A module must support at least the ITCom Object interface and may in addition contain as many interfaces as required. An interface reference can be queried by calling the method "Tc Query Interface" with specification of the corresponding interface ID. Interface pointers Interface pointers behave like the counterpart of interfaces. If a module wants to use an interface of another module, it must have an interface pointer of the corresponding interface type and ensure that it points to the other module. The methods of the other module can then be used. Interface pointers are usually set on startup of the state machine. During the transition from INIT to PREOP (IP), the module receives the object ID of the other modules with the corresponding interface; during the transition from PREOP to SAFEOP (PS) or SAFEOP to OP (SO), the instance of the other modules is searched with the Object Server, and the corresponding interface is set with the Method Query interface. During the state transition in the opposite direction, i.e. from SAFEOP to PREOP (SP) or OP to SAFEOP (OS), the interface must be enabled again. Data areas Modules can contain data areas, which can be used by the environment (e.g. by other modules or the IO area of Twin CAT). These data areas can contain any data. They are often used for process image data (inputs and outputs). The structure of the data areas is defined in the device description of the module. If a module has data areas, which it wants to make accessible for other modules, it implements the ITc ADI interface to enable access to the data. Data areas can contain symbol information, which describes the structure of the respective data area in more detail. 254 Version: 1.3.1 Twin CAT 3
## Page 255

Tc Com modules Data area pointer If a module wants to access the data area of other modules, it can contain data area pointers. These are normally set during initialization of the state machine to data areas or data area sections of other modules. The access is directly to the memory area, so that corresponding protection mechanisms for competing access operations have to be implemented, if necessary. In many cases it is preferable to use a corresponding interface. Context The context should be regarded as real-time task context. Context is required for the configuration of the modules, for example. Simple modules usually operate in a single time context, which therefore requires no detailed specification. Other modules may partly be active in several contexts (e.g. an Ether CAT master can support several independent real-time tasks, or a control loop can process control loops of the layer below in another cycle time). If a module has more than one time-dependent context, this must be specified the in the module description. Twin CAT 3 Version: 1.3.1 255
## Page 256

Tc Com modules Categories Modules can offer categories by implementing the interface ITCom Object Category. Categories are enumerated by the Object Server, and objects, which use this to associated themselves with categories, can be queried by the Object Server (ITCom Object Enum Ptr). ADS Each module that is entered in the Object Server can be reached via ADS. The Object Server uses the ITCom Object interface of the modules in order to read or write parameters or to access the state machine, for example. In addition, a dedicated ADS port can be implemented, through which dedicated ADS commands can be received. 256 Version: 1.3.1 Twin CAT 3
## Page 257

Tc Com modules System module In addition, the Twin CAT runtime provides a number of system modules, which make the basic runtime services available for other modules. These system modules have a fixed, constant Object ID, through which the other modules can access it. An example for such a system module is the real-time system, which makes the basic real-time system services, i.e. generation of real-time tasks, available via the ITc RTime interface. The ADS router is also implemented as a system module, so that other modules can register their ADS port here. Creation of modules Modules can be created both in C++ and in IEC 61131-3. The object-oriented extensions of the Twin CAT PLC are used for this purpose. Modules from both worlds can interact via interfaces in the same way as pure C++ modules. The object-oriented extension makes the same interfaces available as in C++. The PLC modules also register via the Object Server and can therefore be reached through it. PLC modules vary in terms of complexity. It makes no difference whether only a small filter module is generated or a complete PLC program is packed into a module. Due to the automation, each PLC program is a module within the meaning of Twin CAT modules. Each conventional PLC program is automatically packed into a module and registers itself with the Object Server and one or several task modules. Access to the process data of a PLC module (e.g. mapping with regard to a fieldbus driver) is also controlled via the defined data areas and ITc ADI. This behavior remains transparent and invisible for PLC programmers, as long as they decide to explicitly define parts of the PLC program as Twin CAT modules, so that they can be used with suitable flexibility. 5.1.2 Twin CAT module state machine In addition to the states (INIT, PREOP, SAFEOP and OP), there are corresponding state transitions, within which general or module-specific actions have to be executed or can be executed. The design of the state machine is very simple. In any case, there are only transitions to the next or previous step. This results in the state transitions: INIT to PREOP (IP), PREOP to SAFEOP (PS) and SAFEOP to OP (SO). In the opposite direction, the following state transitions exist: OP to SAFEOP (OS), SAFEOP to PREOP (SP) and PREOP to INIT (PI). Up to and including the SAFEOP state, all states and state transitions take place within the non-real-time context. Only the transition from SAFEOP to OP, the OP state and the transition from OP to SAFEOP take place in the real-time context. This differentiation is relevant when resources are allocated or enabled, or when modules register or deregister with other modules. Twin CAT 3 Version: 1.3.1 257
## Page 258

Tc Com modules State: INIT The INIT state is only a virtual state. Immediately after creation of a module, the module changes from INIT to PREOP, i.e. the IP state transition is executed. The instantiation and the IP state transition always take place together, so that the module never remains in INIT state. Only when the module is removed does it remain in INIT state for a short time. Transition: INIT to PREOP (IP) During the IP state transition, the module registers with the Object Server with its unique Object ID. The initialization parameters, which are also allocated during object creation, are transferred to the module. During this transition the module cannot establish connections to other modules, because it is not clear whether the other modules already exist and are registered with the Object Server. When the module requires system resources (e.g. memory), these can be allocated during the state transition. All allocated resources have to be released again during the transition from PREOP to INIT (PI). State: PREOP In PREOP state, module creation is complete and the module is usually fully parameterized, even if further parameters may be added during the transition from PREOP to SAFEOP. The module is registered in the Object Server, although no connections with other modules have been created yet. Transition: PREOP to SAFEOP (PS) In this state transition the module can establish connections with other modules. To this end it has usually received, among other things, Object IDs of other modules with the initialization data, which are now converted to actual connections with these modules via the Object Server. The transition can generally be triggered by the system according to the configurator, or by another module (e.g. the parent module). During this state transition further parameters can be transferred. For example, the parent module can transfer its own parameters to the child module. State: SAFEOP The module is still in the non-real-time context and is waiting to be switched to OP state by the system or by other modules. 258 Version: 1.3.1 Twin CAT 3
## Page 259

Tc Com modules Transition: SAFEOP to OP (SO) The state transition from SAFEOP to OP, the state OP, and the transition from OP to SAFEOP take place in the real-time context. System resources may no longer be allocated. On the other hand, resources can now be requested by other modules, and modules can register with other modules, e.g. in order to obtain a cyclic call during tasks. This transition should not be used for long-running tasks. For example, file operations should be executed during PS. State: OP In OP state the module starts working and is fully active in the meaning of the Twin CAT system. Transition: OP to SAFEOP (OS) This state transition takes place in the real-time context. All actions from the SO transition are reversed, and all resources requested during the SO transition are released again. Transition: SAFEOP to PREOP (SP) All actions from the PS transition are reversed, and all resources requested during the PS transition are released again. Transition: PREOP to INIT (PI) All actions from the IP transition are reversed, and all resources requested during the IP transition are released again. The module signs off from the Object Server and usually deletes itself (see "Service life"). 5.2 Handling Tc Com modules The following chapter deals with the handling of Tc Com modules. For this purpose, both the mapping of the properties defined in the chapter Twin CAT module properties [} 250] in the various tabs of a Tc Com module and the storage or use of the modules in a Twin CAT project are described. 5.2.1 Object tab Twin CAT 3 Version: 1.3.1 259
## Page 260

Tc Com modules Object Id Internal Id of the Tc Com object instance in a Twin CAT project Object Name Name of the Tc Com object instance Type Name Name of the Tc Com object type GUID GUID of the module class Class Id GUID of the class that implements the module class. Class Factory Name of the Twin CAT driver TMI/TMC Path to the TMI/TMC file Parent Id Internal Id of the parent object in a Twin CAT project Init Sequence Init sequence up to which state the Tc Com object should start. Copy TMI to Target Setting as to whether the instance information of the Tc Com object should also be written to the target system. Share TMC Description Setting whether the TMC description should be shared for several module instances of the same class. Auto Reload TMI/TMC Automatically reloads the linked TMI/TMC file when it is rewritten to the hard disk. Keep Unrestored Link Info Setting as to whether link information that cannot be restored when reloading is saved for the module. 5.2.2 Context tab 260 Version: 1.3.1 Twin CAT 3
## Page 261

Tc Com modules Context Choice of context for the settings to be changed (using the ID from the table below). Depend On Setting how this context is called up. (Manual setting, based on the parent object, based on the data areas, based on the task settings) Data Areas Choice of which data area is to be updated from the selected context. ID ID of the context Task ID of the tasks assigned to the context Name Name of the assigned tasks Priority Priority of the assigned tasks Cycle Time Cycle time of the assigned tasks Task Port Tasks port of the assigned tasks Symbol Port ADS symbol port of the selected tasks Sort Order Sort order with which the module logs on to the task. (The smaller the number, the more likely it is to be called up in the list of registered modules.) 5.2.3 Parameter (Init) tab The initial parameters of the Tc Com module are listed in this controller card. Name Name of the parameter Value Value of the parameter CS If the check mark is set, an ADS symbol is generated for the respective parameter. Type Data type of the parameter PTCID Parameter ID Comment Comment 5.2.4 Parameter (Online) tab The online values of the current Tc Com module are displayed in this tab. Twin CAT 3 Version: 1.3.1 261
## Page 262

Tc Com modules Name Name of the parameter Value Value of the parameter CS If the check mark is set, an ADS symbol is generated for the respective parameter. Type Data type of the parameter PTCID Parameter ID 5.2.5 Data Area tab 262 Version: 1.3.1 Twin CAT 3
## Page 263

Tc Com modules Area No ID of the data area Name Name of the data area Type Type of the data area or variable Size Size of the data area or variable CS Option to create the ADS symbols for the data area CD / Elements Option to create the data types on the runtime system so that they are available for the symbols. 5.2.6 Interfaces tab IID Interface ID Name Interface name Twin CAT 3 Version: 1.3.1 263
## Page 264

Support and Service 6 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 264 Version: 1.3.1 Twin CAT 3
## Page 265

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Arm, Arm9 and Cortex are trademarks or registered trademarks of Arm Limited (or its subsidiaries or affiliates) in the US and/or elsewhere. Bi SS is a trademark of IC Haus Gmb H. Intel, the Intel logo, Intel Core, Xeon, Intel Atom, Celeron and Pentium are trademarks of Intel Corporation or its subsidiaries. The registered trademark Linux® is used pursuant to a sublicense from the Linux Foundation, the exclusive licensee of Linus Torvalds, owner of the mark on a worldwide basis. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 266

More Information: www.beckhoff.com/automation Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
