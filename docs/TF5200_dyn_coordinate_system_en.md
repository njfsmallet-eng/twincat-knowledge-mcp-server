---
title: "TF5200_dyn_coordinate_system_en"
product: "TF5200"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.04"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5200_dyn_coordinate_system_en.pdf"
release_date: "2025-06-10"
---
Functional description | EN TF5200 | Twin CAT 3 CNC Dynamic coordinate system 6/10/2025 | Version: 1.04
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5200 | Twin CAT 3 CNC Version: 1.04 3 Dynamic coordinate system
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 5

Table of contents Table of contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Description................................................................................................................................................ 9 2.1 Dynamic coordinate system............................................................................................................ 10 2.2 Specify the coordinate system by master....................................................................................... 13 2.2.1 CNC channel as master (#CHANNEL INTERFACE)....................................................... 13 2.2.2 PLC as Master................................................................................................................. 14 2.3 Tracking slave................................................................................................................................. 17 2.3.1 Switch via NC command.................................................................................................. 17 2.3.2 Switch via PLC command................................................................................................ 24 2.3.3 Display on the HLI............................................................................................................ 25 2.3.4 Diagnosis......................................................................................................................... 26 2.4 Applications..................................................................................................................................... 27 2.4.1 Example 1: Slave tracks master axis-specific.................................................................. 27 2.4.2 Example 2: Fluctuations in a kinematics base................................................................. 29 2.4.3 Example 3: Slave tracks the moved workpiece................................................................ 32 2.4.4 Example 4: Slave tracks workpiece on rotary table......................................................... 35 3 Parameter................................................................................................................................................. 40 3.1 Channel parameters........................................................................................................................ 40 3.2 Start-up parameters........................................................................................................................ 41 4 Support and Service............................................................................................................................... 42 Index......................................................................................................................................................... 43 TF5200 | Twin CAT 3 CNC Version: 5 Dynamic coordinate system
## Page 6

Table of contents 6 Version: TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 7

List of figures List of figures Fig. 1 Depiction of the two application fields of a Dynamic Coordinate System.................................... 9 Fig. 2 Manufacture a moved workpiece................................................................................................. 10 Fig. 3 Compensate the moved machine................................................................................................ 11 Fig. 4 Structure for coupling by a dynamic coordinate system............................................................... 12 Fig. 5 Dynamic coordinate system by master CNC channel.................................................................. 13 Fig. 6 Dynamic coordinate system by PLC............................................................................................ 14 Fig. 7 Dynamic coordinate system by PLC............................................................................................ 18 Fig. 8 Dynamic Coordinate System offsets............................................................................................ 19 Fig. 9 Two robots machine a moved workpiece..................................................................................... 20 Fig. 10 Schematic of #TRACK CS command.......................................................................................... 20 Fig. 11 Dynamic coordinate system by PLC............................................................................................ 24 Fig. 12 Display of coordinate system positions to the PLC...................................................................... 25 Fig. 13 Fluctuations in a kinematics base................................................................................................ 29 Fig. 14 Fluctuations in a kinematics base................................................................................................ 29 Fig. 15 Determine fluctuations................................................................................................................. 30 Fig. 16 Static offset between master and slave....................................................................................... 32 Fig. 17 Process two slave robots on a workpiece moved by the master robot........................................ 33 Fig. 18 Machined workpiece (left) during a rotation; the trace view on the right...................................... 35 Fig. 19 Kin_Base offset from the master’s perspective (rotary table)...................................................... 36 TF5200 | Twin CAT 3 CNC Version: 1.04 7 Dynamic coordinate system
## Page 8

Overview 1 Overview Task The dynamic coordinate system compensates for and executes a superimposed motion. If a machine or a workpiece is additionally moved by an external source (master) during the machining process, this can be compensated by the processing NC channel (slave). The additional movement is signalled to the processing NC channel (slave) as dynamic coordinate system (online offset and rotation). This function is available as of CNC Build V3.1.3054. Possible applications A distinction is made between 2 basic applications: 1. Manufacture a moved workpiece. 2. Move the machine during machining (e.g. compensation for fluctuations in the kinematic base). Programming and parameterisation The TRACK CS ON/OFF command enables and disables the compensation function. The #TRACK CS ABS command is provided for implicit axis-specific calculation; the variable V. G. TRACK_CS. X is provided for explicit calculation. The command #CHANNEL INTERFACE ON/OFF [DYN_CS] is used to define a CNC channel as master. The PLC can also define the coordinate system. Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. 8 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 9

Description 2 Description A distinction is made between 2 application scenarios: 1. Manufacture a moved workpiece. 2. Move the machine during machining (e.g. compensating for fluctuations in the kinematics base). Fig. 1: Depiction of the two application fields of a Dynamic Coordinate System TF5200 | Twin CAT 3 CNC Version: 1.04 9 Dynamic coordinate system
## Page 10

Description 2.1 Dynamic coordinate system NOTICE The processing slave channel attempts to follow the movements (offset, rotation) of the dynamic coordinate system. This additional movement is superimposed on the processing of the programmed channel. The additional movement may lead to unplanned dynamic forces of the axes. This may give rise in particu- lar to unplanned positions (kinematic singularities) being approached. Application 1: Manufacture a moved workpiece. The moving coordinate system informs the processing NC channel (slave) when a moved workpiece is tracked and activates the compensation function. #TRACK CS ON/OFF [ ID<id> ] The workpiece can be moved by an NC channel (Masters, ID > 0) or by the PLC (ID = 0). • NC channel: #CHANNEL INTERFACE ON/OFF [ DYN_CS ] • PLC: Enable the control units on the HLI Fig. 2: Manufacture a moved workpiece. 10 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 11

Description Application 2: Compensate the moved machine (kinematics base) The controller compensates for fluctuations (offset, rotation) in a kinematics base. In this mode the programmed position is approached as if there was no base fluctuation. Fluctuations are detected by an external measuring system and signalled to the CNC channel by the dynamic coordinate system. Fig. 3: Compensate the moved machine TF5200 | Twin CAT 3 CNC Version: 1.04 11 Dynamic coordinate system
## Page 12

Description Architecture and interfaces The subsequent NC channel (slave) can be supplied by another NC channel (master) or by the PLC. %master N10 X100 Z20 N20 #CHANNEL %tracking INTERFACE ON N10 X1 A10 [DYN_CS] N20 #TRACK CS ... ON [ ID=1 ] M30 ... M30 master tracking channel channel 1 HLI static static cartesian cartesian enable transformation transformation ON/OFF #TRACK channel dynamic kinematic channel cartesian PLC interface transformation transformation channel interface dynamic interface dyna Cm Sic kinematic CS dynamic transformation CS translation X/Y/Z rotation A/B/C physical axes physical axes Fig. 4: Structure for coupling by a dynamic coordinate system Slave channel tracking can be controlled by the NC program command or by PLC commands. 12 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 13

Description 2.2 Specify the coordinate system by master 2.2.1 CNC channel as master (#CHANNEL INTERFACE) %master N10 X100 Z20 N20 #CHANNEL %tracking INTERFACE ON N10 X1 A10 [DYN_CS] N20 #TRACK CS ... ON [ ID=1 ] M30 ... M30 master tracking channel channel 1 HLI static static cartesian cartesian enable transformation transformation ON/OFF #TRACK channel dynamic kinematic channel cartesian PLC interface transformation transformation channel interface dynamic interface dyna Cm Sic kinematic CS dynamic transformation CS translation X/Y/Z rotation A/B/C physical axes physical axes Fig. 5: Dynamic coordinate system by master CNC channel Programmed enable The master indicates a coordinate system at the channel interface. The coordinate is then defined by kinematic transformation (currently kinematic = 45 / 201). In other words, position and orientation are handled for each specific kinematic. The command consists of the following syntax elements: #CHANNEL INTERFACE ON | OFF [ DYN_CS ] DYN_CS / TRACK_CS There is no current option to activate the output of a dynamic coordinate system at the channel interface. The master indicates whether it updates the dynamic coordinate system and whether the values are valid. When the interface is enabled or the when tracking is executed for the first time, the tracking slave is itself responsible for adopting the values “softly”. The master can interrupt supply to the interface for a short time (FREEZE). When the function is continued, the slave must also adopt the values “softly”: TF5200 | Twin CAT 3 CNC Version: 1.04 13 Dynamic coordinate system
## Page 14

Description Automatic enable Alternatively, dyn CS channel interfaces can be automatically enabled by setting the channel parameter P- CHAN-00399 at program start. 2.2.2 PLC as Master A dynamic coordinate system can be defined by a CNC channel or by the PLC. The HLI has a control unit for this. %master N10 X100 Z20 N20 #CHANNEL %tracking INTERFACE ON N10 X1 A10 [DYN_CS] N20 #TRACK CS ... ON [ ID=0 ] M30 ... M30 master tracking channel channel 1 HLI static static cartesian cartesian enable transformation transformation ON/OFF #TRACK channel dynamic kinematic channel cartesian interface transformation transformation channel PLC interface dynamic interface dyna Cm Sic kinematic CS dynamic transformation CS translation X/Y/Z rotation A/B/C physical axes physical axes Fig. 6: Dynamic coordinate system by PLC States of the tracking slave INACTIVE The slave does not track the dynamic coordinate system. ACTIVATING The first time the tracking function is activated, the salve adopts the changes “softly” via a filter. ACTIVE The slave tracks the dynamic coordinate system. DEACTIVATING The slave “softly” decouples dynamic coordinate system tracking. ERROR An error occurred in the slave. The slave is unable to track the dynamic coordinate system. 14 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 15

Description 2.2.2.1 Control unit Dynamic CS Description Control unit to switch over dynamic CS tracking. Data type MC_CONTROL_DYN_CS_UNIT [} 15] ST path gp Ch[channel_idx]^.channel_mc_control.dyn_cs Commanded, requested data ST element .command_w .request_r Data type HLI_COORDINATE_SYSTEM_INT translation: ARRAY [0.. HLI_CS_AXES_MAXIDX] OF DINT; X/Y/Z translation in [0.1 µm] rotation : ARRAY [0.. HLI_CS_AXES_MAXIDX] OF DINT; A/B/C rotation in [0.0001 degree] Access PLC writes command and reads request Return data ST element .state_r Data type HLI_DYN_CS_STATE actual_state : DINT; HLI_DYN_CS_INACTIVE = 0 HLI_DYN_CS_ACTIVATING = 1, HLI_DYN_CS_ACTIVE = 2, HLI_DYN_CS_DEACTIVATING = 3, HLI_DYN_CS_ERROR = -1 Access PLC is reading Flow control of commanded value ST element .command_semaphor_rw Data type BOOL Value range [TRUE, FALSE] Special features Consumption data item Access CNC accepts the commanded data if this element has the value TRUE and sets this element to the value FALSE after complete acceptance of the data. PLC can write data for commanding if this element has the value FALSE. The PLC sets this element to the value TRUE if all data to be commanded is written. Flow control of requested data ST element .request_semaphor_rw Data type BOOL Value range [TRUE, FALSE] Special features Consumption data item Access CNC writes the data requested by the GUI if this element is FALSE and then sets this element to TRUE. PLC reads the data requested by the GUI if this value is TRUE. After the PLC fully accepts the data, the PLC sets this element to FALSE. Redirection ST path gp Ch[channel_idx]^.channel_mc_control.dyn_cs.enable_w Transition ST path gp Ch[channel_idx]^.channel_mc_control.dyn_cs.transition_w Data type HLI_DYN_CS_TRANSITION command : DINT; (* -1:DEACTIVATE, 1:ACTIVATE *) TF5200 | Twin CAT 3 CNC Version: 1.04 15 Dynamic coordinate system
## Page 16

Description filter_max_ticks : UDINT; (* filter for turning ON/OFF, compare #TRACK CS ON [ID=<i> ... FILTER... *) option : UDINT; (* additional option, compare #TRACK CS ON [ID=<i> ... OPTION... *) f_wait : BOOL; (* #TRACK CS ON [ ... WAIT... *) f_set_zero : BOOL; (*#TRACK CS ON [ ... SET_ZERO... *) f_kin_base : BOOL; (* #TRACK CS ON [ ... KIN_BASE... *) f_rot_trans : BOOL; (* #TRACK CS ON [ ... ROT_TRANS... *) kinematic_base_cs : HLI_COORDINATE_SYSTEM_INT; (* add. shift between error and kinematic base, #TRACK CS ON [ID=<i> X=. Y=. *) Access PLC writes the transition in analogy to the NC command #TRACK CS [ID=0 …] and CNC reads the transition. Correct NC/PLC handshake: First assign all parameters and then set command to +/-1. 16 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 17

Description Control unit TYPE HLI_COORDINATE_SYSTEM_INT : STRUCT translation : ARRAY [0.. HLI_CS_AXES_MAXIDX] OF DINT; fill_up_2 : DINT; rotation : ARRAY [0.. HLI_CS_AXES_MAXIDX] OF DINT; fill_up_1 : DINT; END_STRUCT END_TYPE TYPE HLI_DYN_CS_STATE : STRUCT actual_state : UDINT; fill_up_1 : DINT; END_STRUCT END_TYPE TYPE HLI_DYN_CS_TRANSITION : STRUCT command : DINT; filter_max_ticks : UDINT; option : UDINT; f_wait : BOOL; f_set_zero : BOOL; f_kin_base : BOOL; f_rot_trans : BOOL; kinematic_base_cs : HLI_COORDINATE_SYSTEM_INT; END_STRUCT END_TYPE TYPE MC_CONTROL_DYN_CS_UNIT : STRUCT enable_w : BOOL; (* MC <-- PLC takes care *) request_semaphor_rw : BOOL; (* Valid semaphore *) command_semaphor_rw : BOOL; (* Valid semaphore *) fill_up_1 : BOOL; fill_up_2 : DINT; request_r : HLI_COORDINATE_SYSTEM_INT; command_w : HLI_COORDINATE_SYSTEM_INT; transition_w : HLI_DYN_CS_TRANSITION; state_r : HLI_DYN_CS_STATE; END_STRUCT END_TYPE 2.3 Tracking slave 2.3.1 Switch via NC command The slave can track the dynamic coordinate system of any master. It can be controlled by an NC command. TF5200 | Twin CAT 3 CNC Version: 1.04 17 Dynamic coordinate system
## Page 18

Description %master N10 X100 Z20 N20 #CHANNEL %tracking INTERFACE ON N10 X1 A10 [DYN_CS] N20 #TRACK CS ... ON [ ID=1 ] M30 ... M30 Master Tracking channel channel 1 HLI static static cartesian cartesian enable transformation transformation ON/OFF #TRACK channel dynamic kinematic channel cartesian interface transformation transformation channel PLC interface dynamic interface dyna Cm Sic kinematic CS dynamic transformation CS translation X/Y/Z rotation A/B/C physical axes physical axes Fig. 7: Dynamic coordinate system by PLC The enable command has the following syntax: #TRACK CS ON [ CH=.. | ID=.. [SET_ZERO | ABSOLUTE ] [OPTION=..] [KIN_BASE] [FILTER=..] [WAIT] [ROT_TRANS] [RELATIVE] [X=.. ] [Y=.. ] [Z=.. ] [A=.. ] [B=.. ] [C=.. ] ] [SIMU] [LOG_FILE=..] ] CH=.. Source of the dynamic coordinate system which is to be tracked. [1;12]: CNC channel number which the dyn CS indicates. ID=.. Source of the dynamic coordinate system which is to be tracked. 0: PLC Interface [1;12]: CNC master channel number which the dynamic CS indicates. SET_ZERO / The current positions of the master are signalled to the decoder and can be ABSOLUTE calculated in the NC program as follows. This can occur implicitly by #TRACK CS ABS or explicitly by the channel variable V. G. TRACK_CS. X/Y/Z/A/B/C. OPTION=.. Options which must be tracked: 0: translation and rotation are considered. (default) 1: only translation is tracked. KIN_BASE Fluctuations (red in the figure) in the kinematic based are compensated so that the slave TCP can be maintained at a stationary position. First specify the erroneous X/Y/Z offset and then the rotation C-B-A of the kinematic base. 18 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 19

Description P total,error P P comp error P P total Prog kinematic base Fig. 8: Dynamic Coordinate System offsets FILTER=.. If the input parameters are not 0 when the function is activated/deactivated, this would lead of a position jump in the programmed path contour. To prevent this, the specified translation/rotation can be coupled/decoupled softly by a filter and smoothed over the specified cycles. == 0, Filter is off. > 1, Filter is activated with explicitly specified filter time. If not specified, the filter is activated at default filter time = 200. WAIT When the filter is active, the program waits until the coupling is completely activated to execute the next NC row. If this mode is not specified (default), coupling is executed “on the fly”. X | Y | Z | A | B | C Additional static offset / rotation of error coupling point referred to kinematic base (KIN_BASE=1). Regarding the rotation, the default rotation sequence of the CNC applies: rotation about Z, rotation about Y, rotation about X. The rotation sequence cannot be changed even with the parameter settings of P-CHAN-00394. Static offset between master and slave (KIN_BASE=0). ROT_TRANS The error is specified by an offset and a rotation. First measure the offset and then the rotation. If the offset is measured in the coordinate system which is already rotated, this can be specified by the following setting. Offset / rotation X | Y | Z | A | B | C Specify an additional offset / rotation has different meanings depending on the application: Application: Moved workpiece This parameter specifies the static position offset of the slave to the master. In the example below this would be: #TRACK CS […X=400 Y=700 C= - 90…] TF5200 | Twin CAT 3 CNC Version: 1.04 19 Dynamic coordinate system
## Page 20

Description Fig. 9: Two robots machine a moved workpiece Application: Fluctuations in kinematics base These parameters specify additional static offsets / rotations (blue in the figure) between the error angle of attack and the kinematic base. #TRACK CS […KIN_BASE …X=200 …] P total,error P P comp error P error P total Prog error offset kinematic base base Fig. 10: Schematic of #TRACK CS command 20 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 21

Description The disable command has the following syntax elements: #TRACK CS OFF [ WAIT ] WAIT When the filter is active, the program waits until the coupling is completely deactivated to execute the next NC row. If this mode is not specified (default), coupling is executed “on the fly”. Switch via NC command %Track CS ; Dynamic CS received by PLC N6076 #TRACK CS ON [ID=0 OPTION=1 FILTER=1000] N6085 G01 X0 C0 N6080 X0 Y0 Z0 A0 B0 C0 N6077 #TRACK CS OFF [WAIT]; Wait until coupling is fully off M30 TF5200 | Twin CAT 3 CNC Version: 1.04 21 Dynamic coordinate system
## Page 22

Description 2.3.1.1 Consider the master position in the slave Calculate the current master position at activation The current position of the master can be considered in the tracking function in the slave. When the tracking function is activated, you can specify whether the current master position is transferred to the slave channel decoder (option SET_ZERO). If this option is selected, the master positions are saved in channel-specific variables. This can only be done when the slave channel is at standstill, i.e. not on the fly. V. G. TRACK_CS. X/Y/Z/A/B/C The master position in the slave can then be calculated individually by various NC commands (#TRACK CS ABS, G92, #CS, etc.). 2.3.1.1.1 Implicit axis-specific calculation (#TRACK CS ABS) #TRACK CS ABS The zero point of the tracking channel is placed at the centre of the dynamic coordinated system. In other words, if X0 Y0 Z0 are then programmed in the tracking channel, this channel executes a movement towards the centre of the dynamic coordinate system. If the slave is not in the master TCP, a position offset is not considered when the master is rotated. Implicit axis-specific calculation %Track CS N6000 #TRACK CS ON[ ID=2 SET_ZERO FILTER=1000 ] N7000 #TRACK CS ABS ;Implicit calculation ;Equivalent explicit calculation by G92 N7010 G92 X=V. G. TRACK_CS. X Y=V. G. TRACK_CS. Y \ Z=V. G. TRACK_CS. Z A=V. G. TRACK_CS. A \ B=V. G. TRACK_CS. B C=V. G. TRACK_CS. C N8000 X0 Y0 Z0 A0 B0 C0 ;Move slave to master centre … M30 22 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 23

Description 2.3.1.1.2 Explicit calculation V. G. TRACK_CS. X, etc. These channel-specific variables can be used to calculate the current master position. For example, if this position is defined as 0 by an offset, the zero point of the tracking channel is located at the centre of the dynamic coordinate system. Position and orientation are considered. This means that if the master is rotated tracked, the slave tracks the rotation about the TCP of the master. Explicit calculation %Track CS N6000 #TRACK CS ON[ ID=2 SET_ZERO FILTER=1000 ] ; Yaw-Pitch-Roll : negative B axis N7000 #CS ON[TRCK_CS] [V. G. TRACK_CS. X, V. G. TRACK_CS. Y, V. G. TRACK_CS. Z, V. G. TRACK_CS. A, -V. G. TRACK_CS. B, V. G. TRACK_CS. C] N8000 X0 Y0 Z0 A0 B0 C0 ; Move slave to master centre ;… M30 TF5200 | Twin CAT 3 CNC Version: 1.04 23 Dynamic coordinate system
## Page 24

Description 2.3.2 Switch via PLC command Besides control of the tracking slave by an NC command, the equivalent command can also be sent by the PLC. %master N10 X100 Z20 N20 #CHANNEL %tracking INTERFACE ON N10 X1 A10 [DYN_CS] N20 #TRACK CS ... ON [ CH=1 ] M30 ... M30 master tracking channel channel 1 HLI static static cartesian cartesian enable transformation transformation ON/OFF #TRACK channel dynamic PLC kinemartic channel cartesian interface transformation transformation channel interface dynamic interface dyna Cm Sic kinematic CS dynamic transformation CS translation X/Y/Z rotation A/B/C physical axes physical axes Fig. 11: Dynamic coordinate system by PLC PLC switching options (cf. #TRACK CS ON/OFF) ON / OFF Required filter time (see FILTER…) Reference to kinematic (see …KIN_BASE…) base Rotation sequence (see.…ROT_TRANS…) other options (see …OPTION…) Offset dimensions (see …X/YZ… A/B/C…) Relative as of activate/ (see …RELATIVE…) deactivate. The PLC can explicitly control a wait to continue until slave tracking has been completely activated or terminated. In other words, the PLC only releases feed in the master channel after an activate/ deactivate command, and after the status = INACTIVE / ACTIVE. 24 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 25

Description 2.3.3 Display on the HLI The input and output values of the dynamic coordinate system can be displayed on the HLI. tracking channel PCS static cartesian transformation MCS (W0) dynamic cartesian transformation MCS' = dyn CS kinematic transformation ACS physical axes Fig. 12: Display of coordinate system positions to the PLC Tool centre point position (MCS) Description Command position of tool centre point in machine coordinate system MCS. The value is refreshed in each interpolation cycle. Signal flow CNC → PLC Unit 0.1 µm ST path gp Ch[channel_idx]^.bahn_state.coord_r[axis_idx].w0_position_r Data type DINT Access PLC is reading For the purpose of compatibility, display of the w0_position_r must be activated in the channel list by P-CHAN-00145 (kin_trafo_display = 1). Dynamic CS position (MCS) Description Command position of tool centre point in machine coordinate system MCS. The value is refreshed in each interpolation cycle. Signal flow CNC → PLC Unit 0.1 µm ST path gp Ch[channel_idx]^.bahn_state.coord_r[axis_idx].position_dyncs_r Data type DINT Access PLC is reading TF5200 | Twin CAT 3 CNC Version: 1.04 25 Dynamic coordinate system
## Page 26

Description 2.3.4 Diagnosis Activate logging When the dynamic coordinate system is calculated, the input and output values and the current dyn CS can also be logged for diagnostic purposes. Logged data is loaded from the controller when diagnostic data is uploaded and written to a file. Logging is activated in the start-up list by P-STUP-00074: Example: configuration.channel[0].interpolator.dyn_cs_history_max 1000 Diagnosis PATH : DYNAMIC CS, CHANNEL NO.: 1 ======================================================================= dyn Cs : max entries per PDU 15 TIME STATE POSITION_IN CS_TRANSLATION CS_ROTATION POSITION_OUT 288943 1) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 944 2) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 945 3) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 946 4) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 947 5) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 948 6) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 949 7) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 950 8) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 951 9) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 952 10) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 953 11) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 954 12) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 955 13) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 956 14) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 957 15) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) 958 16) 2 (3200,0,0,0,0,0) (1000,-1000,0) (0,0,0) (4200,-1000,0,0,0,0) PATH LOGGING CHANNEL NO.: 1 ======================================================================= BF 8 logging : 16/40, level ffffffff, index 16 time level message ----------------------------------------------------------------------- 260482 00000001 BAHN restart... start 260486 00000001 BAHN restart...finished 279043 00000010 dyn CS: cmd=ON PLC=1 N0 FILTER=1000 WAIT=1 279044 00000010 dyn CS: ON, axis positions 279044 00000010 a[0..2](3200, 0, 0) 279044 00000010 a[3..5](0, 0, 0) 279044 00000010 dyn CS: ON, VALUE 279044 00000010 T(0, 0, 0) 279044 00000010 R(0, 0, 0) 280043 00000010 dyn CS: is on = DYN_CS_SYNC_ACTIVE 288777 00000010 dyn CS: cmd=OFF PLC=1 N0 FILTER=1000 288777 00000010 a[0..2](3200, 0, 0) 288777 00000010 a[3..5](0, 0, 0) 288777 00000010 dyn CS: VALUE 288777 00000010 T(1000, -1000, 0) 288777 00000010 R(0, 0, 0) 26 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 27

Description 2.4 Applications 2.4.1 Example 1: Slave tracks master axis-specific Slave tracks master axis-specific %Track CS-Master #TRAFO ON G1 G90 AB=90 F200 ;Approach magazine position AB=30 N20 #CHANNEL INTERFACE ON [TRACK_CS] $WHILE 1 #SIGNAL SYN [ID3 COUNT1] #WAIT SYN [ID1] N20 #CHANNEL INTERFACE ON [TRACK_CS] M0 ;Wait for bending robot in magazine position AB=127.7213 F200 ;Working position #SIGNAL SYN [ID2 COUNT1] ;Set pipe in working position N20 #CHANNEL INTERFACE OFF [TRACK_CS] AB=30 ;Magazine $ENDWHILE TF5200 | Twin CAT 3 CNC Version: 1.04 27 Dynamic coordinate system
## Page 28

Description Slave tracks master axis-specific 2 %Track CS-Slave $WHILE 1 #FLUSH WAIT ;Ensure that master and slave are at position N20 #SIGNAL SYN [ID1 COUNT1] #WAIT SYN [ID3] ;Query interface & allow master to lead N10 #TRACK CS ON [ID=2 SET_ZERO] #TRACK CS ABS AM=0 AH=0 AA=25.44 ;Approach transfer gripper #PSET AA=0 N30 #FLUSH CONTINUE N40 #WAIT SYN [ID2] ;Wait for pipe in working position #TRACK CS OFF [ID=2] N00860 ;Execute initial movement to pipe N00940 ;Vary angle of attack N00950 AA=60 N00950 AA=-60 N00950 AA=60 N00950 AA=-60 N00950 AA=0 $ENDWHILE 28 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 29

Description 2.4.2 Example 2: Fluctuations in a kinematics base Pure offsets in the base can also be compensated in the PCK tool centre point by an inverse offset. However, if rotations are added, compensation is no longer possible. The CNC can compensate this by correcting the target position (green). In this case, the programmed target point is approached as if there were no errors in the base. P total,error P P comp error P P total Prog kinematic base Fig. 13: Fluctuations in a kinematics base Fig. 14: Fluctuations in a kinematics base TF5200 | Twin CAT 3 CNC Version: 1.04 29 Dynamic coordinate system
## Page 30

Description Structure with error compensation The deviation of a kinematic base is measured. This is then considered by the dynamic coordinate system when the kinematic TCP is positioned to compensate for errors. %kinematic2 N10 X1 A10 position #TRACK CS ON measurement ... M30 kin displacement Dkin TCP channel static cartesian transformation dynamic translation X/Y/Z PLC-task cartesian rotation a,b,c transformation kinematic transformation physical axes Fig. 15: Determine fluctuations 30 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 31

Description Fluctuations in a kinematics base %dyn CS-agilus … ;Move to safe position to deselect compensation N1000 Z200 ;Compensate for error in base; error compensation by PLC N1010 #TRACK CS ON [ID=0 KIN_BASE OPTION=0 FILTER=1000] N2000 Z100 ;Move with error compensation N2010 G01 X100 F100 … ;Move to safe position to deselect compensation N9000 Z200 N9010 #TRACK CS OFF [WAIT] ;Move without error compensation N2000 G01 X100 F100 … M30 TF5200 | Twin CAT 3 CNC Version: 1.04 31 Dynamic coordinate system
## Page 32

Description 2.4.3 Example 3: Slave tracks the moved workpiece In this example, the slave tracks the master with position and orientation. The master signals its position to the interface of the dynamic coordinate system. The static offset between slave and master is also specified when the tracking function is activated. Y X 400 Master 700 Slave Fig. 16: Static offset between master and slave 32 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 33

Description Fig. 17: Process two slave robots on a workpiece moved by the master robot Master = channel 1 %dyn CS-Master ;… N100 G01 X100 Y-45 Z45 A0 B0 C0 F5000 N200 G01 X0 Y-45 Z45 A0 B0 C0 F5000 N1000 #TRAFO[45] N1010 X720 Y0 Z450 A0 B0 C45 F1500 N2000 #CHANNEL INTERFACE ON [DYN_CS] ;… N2020 B0 … N9000 #CHANNEL INTERFACE OFF [DYN_CS] N9010 #TRAFO OFF N9020 M30 TF5200 | Twin CAT 3 CNC Version: 1.04 33 Dynamic coordinate system
## Page 34

Description Slave tracks the moved workpiece %dyn CS-Slave ;… N3000 G01 X0 Y-45 Z45 A0 B0 C0 F5000 ;Slave ACS N3010 #TRAFO [45] N3020 X720 Y0 Z450 F5000 ;Slave MCS ;Slave offset to master MCS N3030 #CS ON [OFFS] [400,700,0,0,0,-90] N3040 X620 Y0 Z450 A0 B15 C0 F5000 ; Moved slave in master MCS ; offset is transferred SLAVE to MASTER N2010 #TRACK CS ON [ID=1 SET_ZERO X=400 Y=700 C=-90 FILTER=0 WAIT] ; Set slave zero point in master centre ; Yaw-Pitch-Roll: Negative B axis N2020 #CS ON [V. G. TRACK_CS. X, V. G. TRACK_CS. Y, V. G. TRACK_CS. Z, V. G. TRACK_CS. A, -V. G. TRACK_CS. B, V. G. TRACK_CS. C] ; Move slave to master centre N2200 X0 Y0 Z0 A0 B0 C0 F500 ;… N2900 #TRACK CS OFF [FILTER=0] N2910 #CS OFF ;… N3000 M30 34 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 35

Description 2.4.4 Example 4: Slave tracks workpiece on rotary table In the examples below, the PLC acts as master. Here, the start parameters are transferred by the NC program as described in the section “Hybrid implementation from PLC and NC program” [} 37]. The section “Implementation by PLC” [} 37] only describes working with the PLC. The aim is to machine a workpiece on a rotary table while it is rotating. The rotary table is modelled here as a seventh axis (X1) in the system. Fig. 18: Machined workpiece (left) during a rotation; the trace view on the right TF5200 | Twin CAT 3 CNC Version: 1.04 35 Dynamic coordinate system
## Page 36

Description Fig. 19: Kin_Base offset from the master’s perspective (rotary table) 36 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 37

Description 2.4.4.1 Hybrid implementation from PLC and NC program The configuration parameters are transferred in the NC code by #TRACK CS ON [ID=0 …] Whereas the PLC only defines the correction and passed it on. Slave … N200 X1305.92 Y0 N210 #TRACK CS ON [ID=0 OPTION=1 FILTER=0 WAIT KIN_BASE X=-1305.92] N230 G92 X1305.92 N240 Z90 ; robot on rotary axis positioned by jumps ; to prevent ; rotary table (X1) is rotated independently of robot N250 X0 Y0 X1[INDP_ASYN POS=-90 G01 F500 G90] N260 Z80 N270 X-60 N280 X60 N290 X0 N300 Y-60 N310 Y60 N320 Z90 … N480 #WAIT INDP ALL ; robot to rotary table centre point by jumps ; to prevent N490 G01 X0 Y0 N500 #TRACK CS OFF [FILTER=0 WAIT] … PLC PROGRAM Dyn Cs PLC_Activate VAR p Dyn Cs : POINTER TO MC_CONTROL_DYN_CS_UNIT; END_VAR (*Enable Dyn CS*) p Dyn Cs := ADR(gp Ch[0]^.channel_mc_control.dyn_cs); p Dyn Cs[0]^.enable_w := TRUE; IF p Dyn Cs^.state_r.actual_state = UDINT#2 AND p Dyn Cs^.command_semaphor_rw = FALSE THEN p Dyn Cs^.command_w.rotation[2]:= -p Ax[6]^.lr_state.current_position_acs_r; p Dyn Cs^.command_semaphor_rw := TRUE; END_IF; 2.4.4.2 Implementation via PLC The Dynamic Coordinate System (dyn CS) is activated in the PLC as soon as transition_w.command := 1 is set. Here, the state of the dyn CS changes from 0 to 1 and then to 2 (see Fig. “State of the dynamic coordinate system” in the section “PLC as Master [} 14]“). Accordingly, the required parameters must be set beforehand. NOTICE To activate the dyn CS, an M function (M100) can be used here since activation by #TRACK CS ON activ- ates the dyn CS a second time and may lead to abnormal behaviour. TF5200 | Twin CAT 3 CNC Version: 1.04 37 Dynamic coordinate system
## Page 38

Description PLC PROGRAM Dyn Cs PLC_M VAR Init : BOOL; Kb Cs : HLI_COORDINATE_SYSTEM_INT; p Dyn Cs : POINTER TO MC_CONTROL_DYN_CS_UNIT; END_VAR … IF NOT Init THEN p Dyn Cs^.enable_w := TRUE; (*Offset to rotary table centre point*) kb_cs.translation[0] := DINT#-13059200; kb_cs.translation[1] := DINT#0; kb_cs.translation[2] := DINT#800000; kb_cs.rotation[0] := DINT#0; kb_cs.rotation[1] := DINT#0; kb_cs.rotation[2] := DINT#0; (*Set the config. parameters*) p Dyn Cs^.transition_w.f_kin_base := TRUE; p Dyn Cs^.transition_w.f_set_zero := FALSE; p Dyn Cs^.transition_w.f_rot_trans := FALSE; p Dyn Cs^.transition_w.filter_max_ticks := UDINT#0; p Dyn Cs^.transition_w.option := UDINT#1; p Dyn Cs^.transition_w.kinematic_base_cs := kb_cs; p Dyn Cs^.transition_w.f_wait := TRUE; Init := TRUE; END_IF; (* If DK was enabled by M100*) (*IF M100. ACTIVE THEN *) p Dyn Cs^.transition_w.command := DINT#1; (*M100. ACTIVE := FALSE Reset trigger *) (* END_IF *) (* If DK was disabled by M101*) (*IF M101. ACTIVE THEN *) p Dyn Cs^.transition_w.command := DINT#-1; (*M101. ACTIVE := FALSE Reset trigger *) (* END_IF *) (* Rotation about zero point set Kb Cs, *) (* about Z axis at angle of rotary axis of table*) IF p Dyn Cs^.state_r.actual_state = UDINT#2 AND p Dyn Cs^.command_semaphor_rw = FALSE THEN p Dyn Cs^.command_w.rotation[2]:= gp Ax[6]^.lr_state.current_position_acs_r; p Dyn Cs^.command_semaphor_rw := TRUE; END_IF; Slave … N200 X1305.92 Y0 N210 M100 N230 G92 X1305.92 N240 Z90 ; robot on rotary axis positioned by jumps ; to prevent ; rotary table (X1) is rotated independently of robot N250 X0 Y0 X1[INDP_ASYN POS=-90 G01 F500 G90] N260 Z80 N270 X-60 N280 X60 N290 X0 N300 Y-60 N310 Y60 N320 Z90 … N480 #WAIT INDP ALL ; robot to rotary table centre point by jumps ; to prevent N490 G01 X0 Y0 N500 M101 … 38 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 39

Description SDA … m_synch[100] MVS_SVS ( Activate dynamic CS) m_synch[101] MVS_SVS ( Deactivate dynamic CS) … TF5200 | Twin CAT 3 CNC Version: 1.04 39 Dynamic coordinate system
## Page 40

Parameter 3 Parameter ID Parameter Description P-CHAN-00145 kin_trafo_display Activation of TCP display data P-CHAN-00399 provide_channel_interf Automatic enable of channel interface for synchronous dynamic ace.track_cs CS operations P-STUP-00074 configuration.channel[i] Number of logged input and output values of the dynamic CS .interpolator.dyn_cs_hi story_max 3.1 Channel parameters P-CHAN-00145 Activation of TCP display data Description This parameter is used to activate W0 display data (TCP position referred to the Cartesian basic coordinate system of the machine - MCS). The TCP position is calculated dependent on the active kinematic ID based on the current command axis coordinates, the selected tool (length) and the kinematic offset parameters. The calculation also takes place when transformation is inactive. All axes in the kinematic structure must exist in the channel. Parameter kin_trafo_display Data type UNS16 Data range 0: MCS display function inactive (default) 1: MCS display function active 2: MCS display function active (only for multistep transformation, see Addendum) Dimension ---- Default value 0 Remarks The axes must be homed to obtain the correct display. Programmed tool offsets (V. G. WZ_AKT. V.*) are only considered if they are followed by the programming of #KIN ID[<kinematic-ID>]. Note: As of CNC Build V3.1.3105 the data type of the parameter changed from BOOLEAN to UNS16. P-CHAN-00399 Automatic enable of channel interface for synchronous dynamic CS operations Description This parameter automatically activates the supply of data to the dyn CS channel interface at program start. This corresponds to programming the command #CHANNEL INTERFACE ON/OFF [DYN_CS] see [FCT-C30 [} 8]] in the NC program. Parameter provide_channel_interface.track_cs 40 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 41

Parameter Data type BOOLEAN Data range 0/1 Dimension ---- Default value 0 Remarks 3.2 Start-up parameters P-STUP-00074 Number of logged input and output values of the dynamic CS Description When the dynamic coordinate system is calculated, the input and output values and the current dyn CS can also be logged for diagnostic purposes. Logged data is loaded from the controller when diagnostic data is uploaded and written to a file. Parameter configuration.channel[i].interpolator.dyn_cs_history_max Data type UNS32 Data range 0 ... MAX(UNS32) Dimension ---- Default value 20 Remarks TF5200 | Twin CAT 3 CNC Version: 1.04 41 Dynamic coordinate system
## Page 42

Support and Service 4 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 42 Version: 1.04 TF5200 | Twin CAT 3 CNC Dynamic coordinate system
## Page 43

Index Index C control unit dynamic CS 15 D Dynamic CS control unit 15 P P-CHAN-00145 40 P-CHAN-00399 40 P-STUP-00074 41 TF5200 | Twin CAT 3 CNC Version: 1.04 43 Dynamic coordinate system
## Page 45

More Information: www.beckhoff.com/TF5200 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
