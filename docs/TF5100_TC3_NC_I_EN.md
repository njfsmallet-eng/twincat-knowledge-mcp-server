---
title: "TF5100 Twin CAT 3"
product: "TF5100"
category: "Motion_Control"
tags: ["CAT", "NC", "TWIN"]
language: "EN"
document_type: "Manual"
version: "2.14.3"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5100_TC3_NC_I_EN.pdf"
release_date: "2025-10-21"
---
Manual | EN TF5100 Twin CAT 3 | NC I 2025-10-21 | Version: 2.14.3
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 7 1.1 Notes on the documentation............................................................................................................. 7 1.2 For your safety.................................................................................................................................. 7 1.3 Notes on information security............................................................................................................ 9 2 Introduction............................................................................................................................................. 10 3 Usermode Runtime................................................................................................................................. 11 4 User interface in the Twin CAT 3 Engineering environment................................................................ 12 4.1 Outline............................................................................................................................................. 12 4.2 Interpolation Channel...................................................................................................................... 13 4.3 Interpreter element.......................................................................................................................... 15 4.3.1 Interpreter online window................................................................................................. 16 4.3.2 "Interpreter" tab................................................................................................................ 18 4.3.3 "M-Functions" tab............................................................................................................. 19 4.3.4 "R parameters" tab........................................................................................................... 20 4.3.5 "Zero point" tab................................................................................................................ 21 4.3.6 "Tools" tab........................................................................................................................ 22 4.3.7 "Editor" tab....................................................................................................................... 22 4.3.8 "MDI" tab.......................................................................................................................... 23 4.4 Group element................................................................................................................................ 24 4.4.1 "General" tab.................................................................................................................... 24 4.4.2 "DXD" tab......................................................................................................................... 25 4.4.3 “Settings” tab.................................................................................................................... 29 4.4.4 "Online" tab...................................................................................................................... 30 4.4.5 "3D-Online" tab................................................................................................................ 31 5 GST Reference Manual........................................................................................................................... 32 5.1 General Notes................................................................................................................................. 32 5.2 Preprocessor................................................................................................................................... 32 5.3 Combining G-Code and ST............................................................................................................. 34 5.4 G-Code (DIN 66025)....................................................................................................................... 36 5.4.1 Comments........................................................................................................................ 36 5.4.2 Execution Order............................................................................................................... 37 5.4.3 Mutual Exclusive G-Codes............................................................................................... 37 5.4.4 Rapid Traverse (G00)...................................................................................................... 38 5.4.5 Linear Interpolation (G01)................................................................................................ 38 5.4.6 Circular Interpolation (G02, G03, IJK, U)......................................................................... 39 5.4.7 Dwell Time (G04)............................................................................................................. 41 5.4.8 Accurate Stop (G09,G60)................................................................................................. 42 5.4.9 Delete Distance to go (G31)............................................................................................. 42 5.4.10 Tool Radius Compensation (D, G40, G41, G42)............................................................. 42 5.4.11 Zero Offest Shifts (G53,G54...59).................................................................................... 44 5.4.12 Working Plane and Feed Direction (G17, G18, G19, P).................................................. 46 5.4.13 Inch/metric dimensions (G70, G71, G700, G710)............................................................ 47 5.4.14 Dimensional Notation (G90, G91).................................................................................... 49 TF5100 Version: 2.14.3 3
## Page 4

Table of contents 5.4.15 M-Functions (M)............................................................................................................... 50 5.4.16 R-Parameters................................................................................................................... 51 5.4.17 H, S, and T parameters.................................................................................................... 52 5.4.18 General Codes (F, N, Q, X, Y, Z, A, B, C)........................................................................ 53 5.5 ST - Structured Text (IEC 61131-3)................................................................................................ 54 5.5.1 Comments........................................................................................................................ 54 5.5.2 Literals.............................................................................................................................. 55 5.5.3 Native Data Types............................................................................................................ 58 5.5.4 Userdefined Types........................................................................................................... 59 5.5.5 Control Structures............................................................................................................ 60 5.5.6 Jump statement................................................................................................................ 61 5.5.7 Userdefined Functions..................................................................................................... 62 5.5.8 Standard Functions.......................................................................................................... 63 5.6 CNC Functions................................................................................................................................ 70 5.6.1 Strings and Messages...................................................................................................... 70 5.6.2 Transformations............................................................................................................... 71 5.6.3 Circular Movement........................................................................................................... 77 5.6.4 Centerpoint Correction..................................................................................................... 78 5.6.5 Tools................................................................................................................................ 78 5.6.6 Synchronization................................................................................................................ 80 5.6.7 Query of Axes.................................................................................................................. 81 5.6.8 Current Point.................................................................................................................... 82 5.6.9 Tool Radius Compensation.............................................................................................. 82 5.6.10 Suppression of G-Code Blocks........................................................................................ 83 5.6.11 Zero Offset Shift............................................................................................................... 84 5.6.12 Units................................................................................................................................. 85 5.6.13 Trigonometric (Unit Aware).............................................................................................. 86 5.6.14 Feed Mode....................................................................................................................... 87 5.6.15 Feed Interpolation............................................................................................................ 88 5.6.16 Streaming of Large G-Code Files.................................................................................... 88 5.6.17 Vertex Smoothing............................................................................................................. 89 5.6.18 Automatic Accurate Stop.................................................................................................. 91 5.6.19 Spline Interpolation.......................................................................................................... 92 5.6.20 Dynamic Override............................................................................................................ 95 5.6.21 Programming reference................................................................................................... 96 5.6.22 Center Point Reference of Circles.................................................................................... 97 5.6.23 Change in axis dynamics................................................................................................. 97 5.6.24 Change in path dynamics................................................................................................. 98 5.7 Transformations.............................................................................................................................. 98 5.7.1 Modification of the Effective Transformation T and its Effect........................................... 99 5.7.2 Components of the Effective Transformation T.............................................................. 100 5.7.3 Applying Transformations.............................................................................................. 100 5.7.4 Revoking Transformations............................................................................................. 100 5.7.5 Restoration of Stack....................................................................................................... 101 5.8 Error Reporting.............................................................................................................................. 101 5.8.1 Error Messages.............................................................................................................. 102 4 Version: 2.14.3 TF5100
## Page 5

Table of contents 5.8.2 Compile-Time Errors and Runtime Errors...................................................................... 102 5.8.3 Errors in G-Code............................................................................................................ 103 5.8.4 Preprocessing................................................................................................................ 104 5.9 General Command Overview........................................................................................................ 104 5.10 Comparative Command Overview................................................................................................ 115 6 Classic Dialect Reference Manual....................................................................................................... 126 6.1 Basic Principles of NC Programming............................................................................................ 126 6.1.1 Structure of an NC Program........................................................................................... 126 6.1.2 Block Skipping................................................................................................................ 127 6.1.3 Look-Ahead.................................................................................................................... 127 6.1.4 Smoothing of Segment Transitions................................................................................ 129 6.1.5 Co-ordinate System....................................................................................................... 129 6.1.6 Dimensional Notation..................................................................................................... 129 6.1.7 Working Plane and Feed Direction................................................................................ 130 6.1.8 Inch/metric dimensions.................................................................................................. 131 6.1.9 Single Block Operation................................................................................................... 133 6.1.10 Arithmetic Parameters.................................................................................................... 134 6.2 Programming Movement Statements............................................................................................ 136 6.2.1 Referencing.................................................................................................................... 136 6.2.2 Rapid Traverse............................................................................................................... 136 6.2.3 Linear Interpolation........................................................................................................ 137 6.2.4 Circular Interpolation...................................................................................................... 138 6.2.5 Helix............................................................................................................................... 140 6.2.6 Dwell Time..................................................................................................................... 141 6.2.7 Accurate Stop................................................................................................................. 141 6.2.8 Feed interpolation.......................................................................................................... 141 6.2.9 Zero Offset Shifts........................................................................................................... 142 6.2.10 Target Position Monitoring............................................................................................. 145 6.2.11 Contour definitions......................................................................................................... 147 6.2.12 Rotation.......................................................................................................................... 148 6.2.13 Mirror.............................................................................................................................. 151 6.2.14 Smoothing of segment transitions.................................................................................. 152 6.2.15 Circular Smoothing......................................................................................................... 157 6.2.16 Automatic Accurate Stop................................................................................................ 158 6.2.17 Delete Distance to Go.................................................................................................... 159 6.2.18 Modulo Movements........................................................................................................ 159 6.2.19 Auxiliary axes................................................................................................................. 161 6.3 Supplementary Functions............................................................................................................. 164 6.3.1 M-Functions................................................................................................................... 164 6.3.2 H, T and S Parameters.................................................................................................. 168 6.3.3 Decoder stop.................................................................................................................. 169 6.3.4 Jumps............................................................................................................................. 170 6.3.5 Loops............................................................................................................................. 172 6.3.6 Subroutine techniques................................................................................................... 173 6.3.7 Dynamic Override.......................................................................................................... 175 6.3.8 Altering the Motion Dynamics........................................................................................ 175 TF5100 Version: 2.14.3 5
## Page 6

Table of contents 6.3.9 Change of the Reduction Parameters............................................................................ 176 6.3.10 Change of the Minimum Velocity................................................................................... 178 6.3.11 Read Actual Axis Value.................................................................................................. 178 6.3.12 Skip virtual movements.................................................................................................. 179 6.3.13 Messages from NC program.......................................................................................... 180 6.4 Tool Compensation....................................................................................................................... 180 6.4.1 Tool Data........................................................................................................................ 180 6.4.2 Selecting and Deselecting the Length Compensation................................................... 183 6.4.3 Cartesian Tool Translation............................................................................................. 183 6.4.4 Cutter Radius Compensation......................................................................................... 186 6.4.5 Orthogonal Contour Approach/Departure...................................................................... 191 6.4.6 Path Velocity in Arcs...................................................................................................... 191 6.4.7 Bottle Neck Detection..................................................................................................... 192 6.5 Command overview...................................................................................................................... 193 6.5.1 General command overview.......................................................................................... 193 6.5.2 @-Command Overview.................................................................................................. 196 7 PLC NCI Libraries.................................................................................................................................. 198 7.1 PLC Library: Tc2_NCI................................................................................................................... 198 7.1.1 Configuration.................................................................................................................. 198 7.1.2 NCI POUs...................................................................................................................... 206 7.1.3 Parts program generator................................................................................................ 273 7.1.4 Function blocks for compatibility with existing programs............................................... 282 7.1.5 Obsolete......................................................................................................................... 310 7.2 PLC Library: Tc2_Plc Interpolation................................................................................................ 312 7.2.1 FB_Nci Feed Table Preparation........................................................................................ 314 7.2.2 FB_Nci Feed Table.......................................................................................................... 315 7.2.3 Types and Enums.......................................................................................................... 317 8 Samples................................................................................................................................................. 329 9 Support and Service............................................................................................................................. 330 10 Appendix................................................................................................................................................ 331 10.1 Display of the parts program......................................................................................................... 331 10.2 Display of technology data............................................................................................................ 333 10.3 Displaying the remaining path length............................................................................................ 338 10.4 Parameterisation........................................................................................................................... 338 10.4.1 Path override (interpreter override types)...................................................................... 341 10.5 Cyclic Channel Interface............................................................................................................... 343 6 Version: 2.14.3 TF5100
## Page 7

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF5100 Version: 2.14.3 7
## Page 8

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 8 Version: 2.14.3 TF5100
## Page 9

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF5100 Version: 2.14.3 9
## Page 10

Introduction 2 Introduction The Twin CAT NCI stands for 'numerical control interpolation' and is the NC system for interpolated path movements. Twin CAT NCI offers 3D interpolation (interpreter, setpoint generation, position controller), an integrated PLC with an NC interface and an I/O connection for axes via the fieldbus. NCI can be used to drive 3 path axes and up to 5 auxiliary axes per channel. In addition, master/slave couplings can be formed. In combination with Twin CAT Kinematic Transformation (TF511x), complex kinematic systems can be controlled via NCI. Programming is done with a dedicated NC program, based on DIN 66025, with its own language extensions (cf. Classic Dialect Reference Manual [} 126]) or directly from the PLC with the PLC Library: Tc2_Plc Interpolation [} 312]. Installation preconditions As of Twin CAT 3.1 Build 4026, Twin CAT products are installed via the Twin CAT Package Manager. Detailed instructions on installing products can be found in the chapter Installing workloads in the Twin CAT 3.1 Build 4026 installation instructions. You can obtain a basic Twin CAT installation via the following workloads: • Twin CAT. Standard. XAE (Engineering) • Twin CAT. Standard. XAR (Runtime) For TF5100 | Twin CAT 3 NCI please install the workloads: • TF5100. NCI. XAE (Engineering) • TF5100. NCI. XAR (Runtime) TF5100 Twin CAT NCI is installed up to and including Twin CAT 3.1 Build 4024 with the Twin CAT Setup. Further details on installation can be found in the instructions Installation up to Twin CAT 3.1 Build 4024. Target system Windows 10, Windows CE (only Classic Interpreter) Minimum Plattform-Level: 40 Overview Chapter Contents XAE user interface [} 12] Description of the parameters and functionalities for the interpreter in the Twin CAT 3 Engineering environment (XAE) Interpreter [} 126] Interpreter programming instructions. PLC NCI Libraries [} 198] Description of the special NCI libraries Samples [} 329] Samples for using Twin CAT NCI with PLC and parts program, and for direct motion control from the PLC with the Tc2_Plc Interpolation library Appendix [} 338] Parameterization, cyclic channel interface Further information • ADS Return Codes • ADS Specification of the NC 10 Version: 2.14.3 TF5100
## Page 11

Usermode Runtime 3 Usermode Runtime The TF5100 Twin CAT 3 NCI function is partially supported (GST interpreter, PLC interpolation) by the Twin CAT 3 Usermode Runtime. The Classic interpreter is not supported. GST interpreter In addition to the general user mode runtime installation, the following packages must also be installed on the Usermode Runtime system in order to use the GST interpreter: • Twin CAT. XARUM. NCPTP • Twin CAT. XAR. NCI. GST Each Usermode Runtime instance has its own registry: Tc Registry.xml. This defines the default directories for the GST interpreter. If the Tc Registry.xml file needs to be edited, the associated Usermode Runtime instance must not be started. <Tc Registry> <Key Name="HKLM"> <Key Name="Software"> <Key Name="Beckhoff"> <Key Name="Twin CAT3"> <Key Name="Nc"> <Key Name="Tc Mc Gst"> <Value Name="searchpath" Type="SZ">C:\Program Data\Beckhoff\Twin CAT\Mc\Nci\</ Value> <Value Name="workingdirectory" Type="SZ">C: \Program Data\Beckhoff\Twin CAT\Mc\Nci\Um RT_Default\</Value> </Key> </Key> </Key> </Key> </Key> </Key> </Tc Registry> GST interpreter and Fast As Possible mode The GST interpreter is an ADS server outside the runtime in the Windows context. This means that the state of the GST interpreter is not taken into account when the cycle tick is presented in the Fast As Possible modes of the Usermode Runtime. This can result in the NC executing the Motion commands faster than the interpreter sends the commands to the NC. This results in unrealistic dynamic progressions and a lack of smoothing. To prevent this, when using the Fast As Possible mode in conjunction with the GST interpreter, the lookahead of the NC should be monitored and switched to cyclic mode if the value falls below a threshold so that the interpreter has the chance to fill the lookahead again. IF fb Set Rt Mode.b Execute = FALSE THEN IF io_X. Nc To Plc. Saf Entries > n Saf Entries Threshold THEN IF fb Set Rt Mode.rt Mode <> E_Rt Mode. Rt Mode_Fast As Possible THEN fb Set Rt Mode.rt Mode := E_Rt Mode. Rt Mode_Fast As Possible; fb Set Rt Mode.b Execute := TRUE; END_IF ELSIF fb Set Rt Mode.rt Mode <> E_Rt Mode. Rt Mode_Cyclic THEN fb Set Rt Mode.rt Mode := E_Rt Mode. Rt Mode_Cyclic; fb Set Rt Mode.b Execute := TRUE; END_IF ELSIF NOT fb Set Rt Mode.b Busy THEN fb Set Rt Mode.b Execute := FALSE; END_IF fb Set Rt Mode(); TF5100 Version: 2.14.3 11
## Page 12

User interface in the Twin CAT 3 Engineering environment 4 User interface in the Twin CAT 3 Engineering environment 4.1 Outline In order to be able to use the interpolation, add an interpolation channel in the XAE . This applies to the interpreter and the PLC Library: Tc2_Plc Interpolation [} 312]. 1. Create an NC channel. 2. In the selection box select the NC channel for the interpolation. 3. Assign PTP axes to it from the PLC via a function block. The created channel consists of the following elements: Interpolation Channel [} 13] Description of the properties pages embedded in the 'interpolation' element. Interpreter Element [} 15] Description of the properties pages embedded in the 'Interpreter' element Group element [} 24] Description of the properties pages embedded in the 'group' element 12 Version: 2.14.3 TF5100
## Page 13

User interface in the Twin CAT 3 Engineering environment Notice Axis-specific parameters for NCI can be found in the axis parameterization under subitem 'NCI parameters'. 4.2 Interpolation Channel Click on the interpolation channel to display the following dialogs: ”Online" tab All the axes in the current Interpolation Group [} 24] will be listed. Currently shown: • Actual positions • Set positions • Following errors • Set velocities and • Error Codes TF5100 Version: 2.14.3 13
## Page 14

User interface in the Twin CAT 3 Engineering environment "Override" tab The channel override for the axes can be read and set on the 'Override' page. If PLC is running and the cyclical channel interface [} 343] is being written, the override set here will be overwritten by the PLC. Further information on the override principle can be found under Path override (interpreter override types) [} 341]. The spindle override is described by the cyclic channel interface, although it is currently not supported. 14 Version: 2.14.3 TF5100
## Page 15

User interface in the Twin CAT 3 Engineering environment 4.3 Interpreter element Click on “Interpreter” to show the following property pages and the online window: TF5100 Version: 2.14.3 15
## Page 16

User interface in the Twin CAT 3 Engineering environment 4.3.1 Interpreter online window Axes As on the "Online" properties page in the interpolation channel, this window lists all axes currently included in the interpolation group. Values for the following parameters are displayed: • Actual positions • Set positions • Following errors • Set velocities and • Current error codes . Actual Program Line The Actual Program Line shows the current NC block to be processed in the block execution. The last row in the window is the current block. Unlike this, the current block is in the middle row in the case of GST. As for nearly all the parameters, the program display can be read off via ADS. This can be used to display the current NC blocks in a Visual Basic application, for example (see ADS device documentation - ADS Interface NC). Program name Displays the name of the currently loaded program. This does not necessarily have to be the program displayed in Editor. Interpreter status The interpreter status indicates the current status of the interpreter state machine. The complete list is given below. As PLC evaluation does not require all status information, only the most important parameters are explained. Status Description ITP_STATE_IDLE The interpreter is in idle state when there is no NC program loaded as yet or when a group reset is being executed. The interpreter also goes into idle state when a current program is stopped. In the case a 16 Version: 2.14.3 TF5100
## Page 17

User interface in the Twin CAT 3 Engineering environment Status Description group reset must be executed in order to prevent error 0x42C5. It is therefore recommended to execute a group reset after stopping via the PLC. ITP_STATE_READY After successful loading of an NC program, the interpreter is in ready state. After a program has been successfully processed and exited, the interpreter goes into ready state. In the meantime, however, other states are accepted. ITP_STATE_ABORTED If a runtime error occurs during the processing of an NC program, the interpreter goes into aborted state. The actual error code is given in the channel status. ITP_STATE_SINGLESTOP This status is only accepted in Single Block Mode [} 133]. As soon as the entry has been sent from the interpreter to the NC core, the interpreter goes into this mode. Querying the interpreter status during program execution Since the interpreter status may change between different states during program execution, we recommend querying it with a negative logic. During program execution the interpreter state is not necessarily ITP_STATE_RUNNING. If the program was executed successfully, the interpreter is subsequently always in Ready state (see also Samples [} 329]). End of program The end of the program is characterized by an M function. Therefore either M2 or M30 are being used. If the M function is missing at the end of the program, the status of the interpreter could return wrong values. Interpreter status return values 0 ITP_STATE_INITFAILED 1 ITP_STATE_IDLE 2 ITP_STATE_READY 3 ITP_STATE_STARTED 4 ITP_STATE_SCANNING 5 ITP_STATE_RUNNING 6 ITP_STATE_STAY_RUNNING 7 ITP_STATE_WRITETABLE 8 ITP_STATE_SEARCHLINE 9 ITP_STATE_END 10 ITP_STATE_SINGLESTOP 11 ITP_STATE_ABORTING 12 ITP_STATE_ABORTED 13 ITP_STATE_FAULT 14 ITP_STATE_RESET 15 ITP_STATE_STOP 16 ITP_STATE_WAITFUNC 17 ITP_STATE_FLUSHBUFFERS Channel status The channel status indicates the current error state of the channel. If an error occurs during NC program loading or runtime, the corresponding error code is displayed here. If, for example, an axis following error occurs during processing, the NC program is stopped and the channel status will have a value unequal 0. The channel status should therefore always be checked in the PLC, in order to be able to respond to errors. The channel status is always 0 during normal operation. Loading buffer The current size of the loading buffer for the interpreter is displayed here. Select the "Interpreter" tab to change the value. TF5100 Version: 2.14.3 17
## Page 18

User interface in the Twin CAT 3 Engineering environment 4.3.2 "Interpreter" tab Type The interpreter type can be selected in the Type selection box. Available are • the GST-interpreter [} 32]. GST combines native DIN 66025 based G-code with programming extensions of Structured Text as a higher level language. • The DIN 66025 based NC-interpreter [} 126] (Classic Dialect) with @-command register function extensions. • The selection of none if the Plc Interpolation [} 312] library is used. As default setting the GST-interpreter is set. To employ the NC-interpreter with register function extensions you have to select it explicitly. Loading Buffer Size The loading buffer for the interpreter can be edited here. Note that the memory required in the interpreter is substantially greater than the size of the NC-file. The maximum permitted loading buffer size is limited to 64 MB. Changing the Loading Buffer Size If the size of the loading buffer is changed, it is absolutely necessary to execute a Twin CAT restart. G70/G71 Factor If a switch from G71 [} 131] (millimeters - default) to G70 takes place in the parts program, the conversion factor is stored here. This conversion factor only has to be edited if the base reference system is not millimeters. If for example the machine was calibrated based on inches and G70 is activated in the parts program, the G70 factor should be set to 1 and the G71 factor should be set to 1/25.4. 18 Version: 2.14.3 TF5100
## Page 19

User interface in the Twin CAT 3 Engineering environment Save/Restore At runtime the Save function can be used to save a “snapshot” of the current parameters. The checkboxes can be used to specify the parameters to be saved. The Save function generates the file ‘Snap Shot.bin’ in the Twin CAT\CNC directory. The Restore function loads the file saved with the Save function. This function is solely intended for debugging purposes. 4.3.3 "M-Functions" tab Use only with interpreter This tab is irrelevant for operation with the library Tc2_Plc Interpolation. Shows the currently parameterized M-functions. On this page new M-functions can be added, or existing ones modified. A more detailed description of the available parameters can be found in the interpreter description under M- functions [} 164]. Parameterization of M-functions If M-functions are re-parameterized, subsequent activation of the configuration and a Twin CAT restart is required. TF5100 Version: 2.14.3 19
## Page 20

User interface in the Twin CAT 3 Engineering environment 4.3.4 "R parameters" tab The currently applicable R parameters are displayed on the 'R parameters' properties page. During the test phase it is possible to, for example, initialize or change R parameters here. R parameters are generally edited, however, from the NC program or if necessary, from the PLC. You can find further information about R parameters in the interpreter description under R Parameters [} 134]. 20 Version: 2.14.3 TF5100
## Page 21

User interface in the Twin CAT 3 Engineering environment 4.3.5 "Zero point" tab The current zero shift values for the axes within the interpolation group are displayed here. The parameters P54.. P59 represent for the corresponding G code. As for the R parameters, the zero shift values can be edited from here. Notice Columns F & G (e.g. P54 F & P54 G) exist for historical reasons and are added for each parameter. You can find further details of the effects in the interpreter description under zero shifts [} 142]. TF5100 Version: 2.14.3 21
## Page 22

User interface in the Twin CAT 3 Engineering environment 4.3.6 "Tools" tab You can edit the data for the tool compensation on the "Tools" property page. More detailed parameter descriptions can be found in the interpreter description under tool compensations [} 180]. 4.3.7 "Editor" tab 22 Version: 2.14.3 TF5100
## Page 23

User interface in the Twin CAT 3 Engineering environment The editor is used to display and edit the NC programs. Browse... Opens a dialog with which existing NC programs can be selected and displayed. Remote Connection: Load NC-File from Target System If the target system is connected via a remote connection, the NC-file has to be selected from the target system and cannot be loaded from the local machine. F5 Starts the currently loaded NC program. The NC program displayed in the editor does not necessarily have to be the currently loaded program. F6 Stops the currently running NC program. F7 Loads the NC program displayed in the editor. File coding Ensure that the text file containing the NC program is encoded in ANSI or UTF-8 format. Other text encodings (e.g. UTF-8 BOM) may contain hidden special characters that lead to syntax errors when loading. F8 Executes a group reset. F9 Saves the NC program currently displayed in the editor under the same name. Editor... Opens a larger window in which the NC program is displayed. 4.3.8 "MDI" tab MDI stands for “Manual Data Interface”. It can be used to enter individual NC blocks directly from the Twin CAT 3 Engineering environment (XAE). Processing is started and stopped via F5 and F6 respectively. TF5100 Version: 2.14.3 23
## Page 24

User interface in the Twin CAT 3 Engineering environment 4.4 Group element General [} 24] DXD [} 25] Settings [} 29] Online [} 30] 3D-Online [} 31] 4.4.1 "General" tab group ID The group ID is shown on the "General" page. This is required for group-specific ADS commands. Create symbols In order to be able to access path variables symbolically, select symbol generation for the group here. 24 Version: 2.14.3 TF5100
## Page 25

User interface in the Twin CAT 3 Engineering environment 4.4.2 "DXD" tab The NCI group parameters are written on the "DXD" properties page. Curve velocity reduction method The curve velocity reduction method is only effective for C0 transition (see Classification of Segment Transitions [} 338]) Defines of the curve velocity reduction method 0 Coulomb 1 Cosinus 2 Velo Jump 3 Deviation Angle (not yet released) TF5100 Version: 2.14.3 25
## Page 26

User interface in the Twin CAT 3 Engineering environment Method Description Coulomb The coulomb reduction method is a dynamic process analogous to the Coulomb scattering. The deflection angle φ in the transition point is the angle between the tangents of the path at the end of the segment S1 and the tangent of the path at the start of segment S2. The velocity is set to the velocity at infinity, in analogy to Coulomb scattering, V ∝ ( tan(0.5(π-φ)) )1/2 k and then reduced via the C0 factor. V ← C0 V. k k In the case of a motion reversal (φ=180) the reduction is always V = C0. As k the reduction in the case of small deflection angles is drastic, there is an angle φ ∈ [0,180] from which full reduction takes effect. To avoid reduction, low set φ = 180. For full reduction (down to φ = 0), set C0 = 0.0 and φ = 0. low low 26 Version: 2.14.3 TF5100
## Page 27

User interface in the Twin CAT 3 Engineering environment Method Description Cosine The cosine reduction method is a purely geometrical process. It involves: • the C0 factor ∈ [0,1], • an angle φ ∈ [0,180], low • an angle φ [0,180] with φ < φhigh high∈ low Reduction scheme: • low: no reduction: V←V φ < φ k k, • high < φ: reduction by the C0 factor: V← C0 V φ k k • φ < φ <φ : partial reduction continuously interpolating between cases 1 low high and 2, proportional to the cos function in the range [0,π/2]. For full reduction (down to φ = 0), set C0 = 0.0 and φ = 0 and φ very low high small but not equal to 0 (e.g. 1.0E-10) Velo Jump It is a geometrical procedure for determining the segment transition velocity at a C0 transition. The procedure reduces the path velocity as required, so that the step change in velocity does not exceed the specified limit value. It is calculated based on the following formula: Velo Jump factor * cycle time * min (acceleration; deceleration) Further information: [} 338] Velocity reduction factor C0 transition Reduction factor for C0 transitions. The effect depends upon the reduction method. C0 ∈ [0.0, 1] Velocity reduction factor C1 transition First, V_link is set to the lower of the two segment target velocities: V_link = min(V_in,V_out). The geometrically induced absolute step change in acceleration Acc Jump in the segment transition is calculated depending on the geometry types G_in and G_out, and the plane selection G_in and G_out of the segments to be connected, at velocity V_link. If this is greater than C1 times the path acceleration/(absolute) deceleration Acc Path Reduced permissible for the geometries and planes, the velocity V_link is reduced until the resulting step change in acceleration is equal to Acc Path Reduced. TF5100 Version: 2.14.3 27
## Page 28

User interface in the Twin CAT 3 Engineering environment If this value is less than V_min, then V_min takes priority. Notice When changing the dynamic parameters, the permissible path acceleration for the geometries and planes and thereby the reaction of the reduction changes automatically. Reduction factor for C1 transitions: C1 ≥ 0.0 Critical angle, segment transition 'low' Parameters for φ (see curve velocity reduction method [} 25]). low Critical angle, segment transition 'high' Parameters for φ (see curve velocity reduction method [} 25]). high Minimum velocity at segment transitions Each NCI group has a minimum path velocity V_min ≥ 0.0. The actual velocity should always exceed this value. User-specified exceptions are: programmed stop at segment transition, path end and override requests which lead to a velocity below the minimum value. A systemic exception is a motion reversal. With the reduction method DEVIATIONANGLE the deflection angle is φ ≥ φ_h, in which case the minimum velocity is ignored. V_min must be less than the set value for the path velocity (F word) of each segment. The minimum velocity can be set to a new value V_min ≥ 0.0 in the NC program at any time. The unit is mm/ sec. Global soft position limits (for x,y,z-axes) Parameters for enabling the software end positions of the path (see: Parameterization [} 340]). Interpreter override type Parameter for selecting the path override type (see Path override (interpreter override types) [} 341]). Enable calculation of the total remaining chord length Activates the calculation of the remaining path length. When the calculation of the remaining path length has been activated, it can be extracted via ADS afterwards. See also within the Appendix: Displaying the Remaining Path Length [} 338]. Maximum number of transferred jobs per nc cycle [1 … 20] Maximum number of commands to be transferred per NC cycle. With this parameter it is possible that the SVB task still runs slower than the SAF task and nevertheless sufficiently enough jobs are transposed so that the SAF table does not run out of jobs. SAF cycle time divisor The cycle time reduction ensures that the set value in the SAF is not calculated with the SAF cycle time, but with a time that is divided by the value specified here. For highly dynamic motions it may make sense to set the parameter to a value greater than 1, in order to minimize discretization inaccuracies. Increasing the SAF cycle time divisor results in the set value generator being called more frequently internally. User-defined SAF table length Parameter that defines the size of the SAF table and therefore the maximum number of cached SAF entries (look-ahead). If an NC program involves sequential movement of many very short segments, increasing this value can help to avoid an unintentional velocity reduction at the segment transitions. 28 Version: 2.14.3 TF5100
## Page 29

User interface in the Twin CAT 3 Engineering environment 4.4.3 “Settings” tab Under the "Settings" tab you can set the cycle time for the interpolation. The cycle time set here is a multiple of the cycle time of the SAF task. Using the cycle time in the "Settings" tab The cycle time setting can be used if you have to select a cycle time for the interpolation that differs from the SAF task. Generally, the cycle time of the SAF task should be adjusted to set the cycle time. TF5100 Version: 2.14.3 29
## Page 30

User interface in the Twin CAT 3 Engineering environment 4.4.4 "Online" tab Error code The current error code for the channel is displayed here. The value is the same as the value displayed in the online window of the interpreter under 'channel status [} 15]' SVB status SVB status displays the current block preparation status (SVB = Satzvorbereitung). Possible SVB states are: ERROR IDLE READY START DRIVEOUT CALIBRATE MFUNC SYNCREC DELAY MFUNCWAIT SPINDLEWAIT PLC evaluation of the SVB status is normally not necessary. SAF status SAF status displays the current block execution status (SAF = Satzausführung). Possible SAF states are: ERROR IDLE CONTROL RUN RUN_DRIVEOUT WAIT PLC evaluation of the SAF status is normally not necessary. 30 Version: 2.14.3 TF5100
## Page 31

User interface in the Twin CAT 3 Engineering environment SVB entries Number of current SVB entries. SAF entries Number of current SAF entries. 4.4.5 "3D-Online" tab Target assignment At this point the interpolation group is formed. The movement of the PTP axes, which are assigned to the path axes X, Y and Z, can then be based on interpolation. Any PTP axes can be selected with the aid of the selection lists for the path axes X, Y and Z. Press the 'Apply' button to form the 3D group. A comparably PLC function block is available in the PLC Library: Tc2_NCI [} 198]. (See Cfg Build Ext3DGroup [} 200]) Actual assignment The current path axis configurations are displayed here. Use 'Delete' to remove individual axes from the 3D group. Delete whole configuration Resolves the complete 3D group. Here, too, a corresponding PLC function block is available in the PLC Library: Tc2_NCI [} 198]. (See Cfg Reconfig Group [} 202]) TF5100 Version: 2.14.3 31
## Page 32

GST Reference Manual 5 GST Reference Manual 5.1 General Notes All GST-examples in this documentation presuppose the following assumptions: • Initially, the tool is located at X0, Y0, Z0. • All state-variables of the interpreter are set to their default values, except that the velocity is set to a nonzero value. 5.2 Preprocessor Include Directive #include "<path>" #include < <path> > The #include directive inserts the contents of another file. The included file is referenced by its path. Typically, it is used to “import” commonly used code like e.g. libraries. Its behavior is similar to the C- Preprocessor. Example: In the following example file a.nc includes file b.nc. On execution of a.nc the interpreter internally replaces the include-line by the text of b.nc. Therefore, executing the program a.nc has the same effect as executing the program c.nc. FILE a.nc: G01 X0 Y0 F6000 #include "b.nc" G01 X0 Y100 FILE b.nc: G01 Z-2 G01 X100 G01 Z2 FILE c.nc: G01 X0 Y0 F6000 G01 Z-2 G01 X100 G01 Z2 G01 X0 Y100 • If path is absolute, it is directly used to locate the included file. An absolute path must be surrounded by quotation marks. • If path is relative and surrounded by quotation marks, it is appended to the directory of the including file to form the path of the included file. • If path is enclosed in angle brackets, it is regarded to be relative to the paths in the searchpath list. The first entry in this list that leads to an existing file is used for inclusion. The searchpath list is supplied by the interpreter environment of the interpreter. Example: The following example assumes that the searchpath is set to the directories c:\jjj and c:\kkk. The file aaa.nc consists of a sequence of #include-directives that are explained in the following. 32 Version: 2.14.3 TF5100
## Page 33

GST Reference Manual • The file bbb.nc is included using an absolute path. Therefore, its location is independent of the location of aaa.nc. Absolute referencing is useful for files that always reside at a fixed location on the filesystem. • The file ccc.nc is referenced relative. It must reside in the directory of aaa.nc (the including file), which is c:\mmm\. • The file ddd.nc is also referenced relative. It is expected to reside at c:\mmm\ooo\ddd.nc. • The relative reference of eee.nc uses the sequence '..', which refers to the parent directory. Therefore, the file eee.nc is expected in c:\ppp\qqq\eee.nc. • The relative path of fff.nc is denoted in angle brackets. Therefore, the directories in the searchpath are considered, rather than the directory of aaa.nc. The file is expected in c: \jjj\fff.nc or c:\kkk\fff.nc. The first path that leads to an existing file is considered. If there is no file fff.nc in any directory of the searchpath, an error is reported. • Finally, the file ggg.nc is expected in c:\rrr\ggg.nc. Both entries in the searchpath lead to this location. FILE c:\mmm\aaa.nc: #include "c:\nnn\bbb.nc" #include "ccc.nc" #include "ooo\ddd.nc" #include "..\ppp\qqq\eee.nc" #include <fff.nc> #include <../rrr/ggg.nc> • Each include-directive must be denoted on a dedicated line. Then, this entire line is replaced by the contents of the included file. An additional ‘newline’ character is appended. • The include-directive may be used multiple times at arbitrary locations of the including file. • If an included file does not exist, an error is reported. • If the include directive is not placed at the first position of a line, an error is reported. • Include directives in included files are also subject to replacement. • An infinite loop due to recursive inclusion (e.g. A includes B, B includes C and C includes A) is detected and reported as an error. • The same file may be included multiple times. It is typically bad practice to include a file multiple times. Especially, if this feature is misused to factor out code. Instead, a function should be preferred to define code that is reused multiple times (see section Userdefined Functions [} 62]). Example: In the following example file a.nc includes file b.nc twice. The second inclusion is always expanded, independently of the enclosing condition by the IF-THEN expression. The included file b.nc itself includes file c.nc. FILE a.nc: G01 X100 F6000 #include "b.nc" G01 Y100 ! IF st Variable=47 THEN #include "b.nc" ! END_IF; FILE b.nc: #include "c.nc" G01 X0 Y0 FILE c.nc: G01 Z0 TF5100 Version: 2.14.3 33
## Page 34

GST Reference Manual Example: File x.nc demonstrates a series of invalid include directives. The first three lines violate the rule that each include directive must be denoted on a dedicated line. In lines 4 and 5 the filename is not properly enclosed in quotation marks or angle brackets. In line 6 a nonexisting file is included. Line 7 violates the rule that the include directive always has to be placed at the first position of a line. Line 8 includes the file y.nc, which itself includes file x.nc. This loop is reported as an error. FILE x.nc: #include "a.nc" G01 X100 ! #include "a.nc" #include "a.nc" #include "b.nc" #include a.nc #include "a.nc> #include "non_existing_file.nc" #include "a.nc" #include y.nc FILE y.nc: #include "x.nc" 5.3 Combining G-Code and ST A GST-Program <g-code> <g-code> ! <st-code> <g-code> <g-code> { <st-code> <st-code> ! <g-code> <st-code> <st-code> } <g-code> <g-code> A GST-file consists of sequences of G-code and sequences of ST-code that can be interleaved as shown above. Each program starts in G-code mode. The mode can be switched to ST for one line using an exclamation mark (‘!’). The ST-mode ends at the end of line automatically. As an alternative a block of ST-code can be defined using curly braces (‘{‘…’}’). This notation is more practical to define a long sequence of ST-code in a GST-program. Within the ST-block the G-code mode can be entered for one line using the exclamation mark. Thereby, the G-code mode ends at the end of line automatically. G-Code Block <address><value> <address>=<G-Expression> <address>{<ST-Expression>} A line of G-code is called a block. It consists of a sequence of words. A word is a combination of an address (e.g. G or X) and a value. A value can be defined by a literal (e.g. 2.54), by a G-expression (e.g. 2*foo+1) or by an ST-expression (e.g. sin(foo**2)-1). G-Code Expression <address>=a+b-c*d/e 34 Version: 2.14.3 TF5100
## Page 35

GST Reference Manual The result of the expression is used as the value of the word. The four basic arithmetic operations (‘+’, ‘-’, ‘*’, ‘/’) can be used in a G-expression. They are evaluated as expected, i.e. all operations are left-associative and ‘*’, ‘/’ have a higher precedence than ‘+’, ‘-’. Variables that have been declared in ST can also be used in a G-expression (with respect to their scope). All computations are performed using type LReal (64-bit floating point according to IEEE 754). The value of an ST-variable is implicitly converted to type LReal according to the conversion rules of ST. If a type (e.g. STRING) cannot be converted, an error is reported. RESTRICTION: ST-variables that contain a number in their name (e.g. x0) cannot be used in a G-expression to avoid confusion with a G-Code like X0. This limitation does not apply to ST-expressions. RESTRICTION: Array variables, struct variables and objects cannot be used in a G-expression. This limitation does not apply to ST-expressions. RESTRICTION: Parentheses are not allowed in a G-expression as they are used to denote comments in G-Code. For the same reason function calls are not available. These limitations do not apply to ST- expressions. Embedded ST-Expression <address>{<ST-Expression>} The result of the ST-expression is used as the value of the word. It must be convertible to LReal. Basically, an ST-expression is ST-Code that could be placed on the right hand side of an assignment. Other ST-Code (e.g. an ST-statement) is not allowed. However, extensive computations can be encapsulated in an ST- function that is then called in the ST-expression. An ST-expression should not have side effects, since the evaluation order of ST-expressions is generally undefined and may change in the future. Besides, this style of programming employing side effects is a bad programming style. For instance, an ST-expression should not call a function that contains G-Code. Example: • The following GST-program starts with a line of G-code that moves the tool rapidly to the origin. • The line is followed by a line of ST-code that declares variable ‘i’. The ST-mode is entered by the prefixed exclamation mark (‘!’). After this line G-code mode resumes. • The G-code in line 3 moves the tool down. • Lines 4 to 8 define a block of ST-code that contains a FOR-loop. The code in this block is interpreted as ST-code, except for the G-code line in line 6. This line of G-code uses a G-expression to set the X-axis to 10*i. The value of the Y-axis is defined using an ST-expression that is enclosed in curly braces. This expression evaluates to 0 if ‘i’ is even and to 10 otherwise. • The programmed path of the program is shown in Figure “Example Expressions”. G00 X0 Y0 Z0 ! VAR i : INT; END_VAR G01 Z-1 F6000 { FOR i := 1 TO 5 DO ! G01 X=i*10 Y{ (i MOD 2) *10 } END_FOR; } TF5100 Version: 2.14.3 35
## Page 36

GST Reference Manual Y 20 10 0 -10 X -10 0 10 20 30 40 50 60 Figure “Example Expressions”. Suppression of G-Code Blocks /<n> <G-Code block> The execution of a G-Code block can be suppressed conditionally. If ‘/<n>’ is prefixed and the n-th bit in an internal disable mask is set, the block is suppressed (not executed). The disable mask can be set by the PLC and by the ST-function disable Mask Set. If n is omitted, it has 0 value by default. [See section Suppression of G-Code Blocks [} 83].] 5.4 G-Code (DIN 66025) 5.4.1 Comments DIN 66025 Comment <g-code> ( <comment> ) <g-code> Text that is enclosed in round parentheses is treated as comment in G-Code (according to DIN 66025). The comment must not include further parentheses. A comment within round parentheses can extend for multiple blocks or lines and therefore may skip a carriage return, too. Example: The following example demonstrates the notation of comments in G-Code. N10 G01 X0 Y-10 F3000 N20 G01 (activate linear interpolation) X10 (set X-coordinate to 10) Y0 F6000 (the next block results in a semicircle with center point X10 Y10) N30 G02 (activate clockwise interpolation) Y20 U10 (radius is 10) M02 Line Comment <g-code> // <comment> Text between ‘//’ and the end of line is treated as a comment in G-Code. Example: The following example demonstrates the notation of line comments in G-Code. N10 G01 X10 F6000 // perform a linear movement to X10 Y0 // the next block results in a semicircle with center point X10 Y10 N20 G02 Y20 U10 M02 36 Version: 2.14.3 TF5100
## Page 37

GST Reference Manual 5.4.2 Execution Order A block (line of G-code) consists of a sequence of words. The programmed order of words is not considered by the GST interpreter. Instead, the following execution order is obeyed that consists of 7 sequential and dependent steps. 1. Reference System N* Set block number. G17.. G19 Selection of a workingplane [} 46]. G70, G71, G700, G710 Selection of a unit [} 47]. G90, G91 Selection of absolute/ incremental programming [} 49]. D*, P* Selection of a tool and its orientation. 2. Configuration G40.. G42 (De-)activation of Tool Radius Compensation [} 42]. G53.. G59 Selection and programming of zero offset shift [} 44]. F* Set velocity. 3. M-Function Pre M* M-functions [} 50] that are configured as “before”. 4. Parameter to PLC H*, S*, T* H, S, and T parameters [} 52] 5. Movement Q*, G00.. G03 Movement to a point. G09, G60 Activation of accurate stop [} 42]. 6. Wait G04 Wait for a given duration [} 41]. 7. M-Function Post M* M-functions [} 50] that are configured as “after”. The first step sets up the reference system. The second step configures following movements. Note that the second step may depend on the first one. E.g. the programmed velocity (F) considers a velocity unit (G700) that is programmed in the same block. Step three and the following steps perform actions like a movement. 5.4.3 Mutual Exclusive G-Codes Certain combinations of G-Codes must not be programmed in the same block (line of G-Code). Such conflicting G-Codes typically set state variables to contradictory values (e.g. set length unit to mm and to inch). There are also combinations that use the same parameters and therefore must not be programmed in the same block (e.g. G58 and G59). Below is a list of groups of G-Codes. G-Codes that belong to the same group are in conflict. TF5100 Version: 2.14.3 37
## Page 38

GST Reference Manual • G00, G01, G02, G03, G04, G58, G59 Interpolations and programmed zero-offset-shift. • G70, G71, G700, G710 Set unit for length and speed. • G90, G91 Set absolute/ relative programming. • G53, G54, G55, G56, G57 Deactivate/ select zero-offset-shift. • G40, G41, G42 Deactivate/ activate Tool Radius Compensation. • G17, G18, G19 Select workingplane. 5.4.4 Rapid Traverse (G00) Command G0 or G00 Cancellation G01 [} 38], G02 oder G03 [} 39] Set the interpolation mode to “rapid, linear”. The interpolation mode applies to this block and all succeeding blocks until it is reset by G01, G02 or G03. G00 is the default interpolation mode. If G00 is active, programming of a point (see X) will result in a linear geometry segment that is processed with maximum velocity. The programmed velocity is not considered. G00 is typically used to position the tool. For machining G01 should be used, which considers the programmed velocity. G01, G02, G03, G04, G58 and G59 are mutually exclusive. They must not be programmed in a common block. Example: The resulting path of the following example is shown in Figure “Example G00”. The first block N10 rapidly moves the tool to position X20, Y10, Z30. The resulting geometry segment is a line in space. The orientation remains unchanged. The second block N20 performs a rapid movement to X50, Y10, Z30. There is no need to denote G00 in this line, since interpolation is modal. N10 G00 X20 Y10 Z30 N20 X50 M02 Y 20 Z=30 rapid Z=30 rapid 10 Z=0 0 -10 X -10 0 10 20 30 40 50 60 Figure “Example G00”. 5.4.5 Linear Interpolation (G01) Command G1 or G01 (default setting) Cancellation G00, G02 oder G03 38 Version: 2.14.3 TF5100
## Page 39

GST Reference Manual Set the interpolation mode to “linear”. This interpolation mode is like G00, except that the path is machined with the programmed velocity. (See F.) The interpolation mode applies to this block and all succeeding blocks until it is reset by G00, G02 or G03. N20 G01 X100.1 Y200 F6000 N30 X150 M02 5.4.6 Circular Interpolation (G02, G03, IJK, U) G02 clockwise circular interpolation Command G2 or G02 Cancellation G00 [} 38], G01 [} 38] or G03 Set the interpolation mode to “circular/helical, clockwise”. The interpolation mode applies to this block and all succeeding blocks until it is reset by G00, G01 or G03. If G02 is active, programming of a point will result in a circular (or helical) arc that is machined with the current velocity. (See General Codes (F, N, Q, X, Y, Z, A, B, C) [} 53].) In the following, a circular arc is regarded. The helical arc is covered later. A circular arc starts at the current point and ends at the programmed point. It rotates around the working- plane normal (PCS, i.e. program coordinate system) in the center point. The center point can be defined using Centerpoint Programming or using Radius Programming. Centerpoint Programming I, J, K For Centerpoint Programming the center is standardly defined relative to the starting-point using the I,J,K parameters. The center point is the sum of the starting-point and the vector [I,J,K]. Alternatively, the center point can also be specified as absolute. For this the reference type must be set to absolute in advance with the ST command circle Center Reference Set [} 97]. The I,J,K parameters are optional and have 0 value by default. If the starting-point and the endpoint are equal with respect to the workingplane, a full circle will be emitted. CONSTRAINTS: • The radius at the starting-point and at the endpoint must be equal. However, small deviations are allowed and corrected automatically, see Centerpoint Correction [} 78]. • The center point must not be equal to the starting-point or endpoint. Radius Programming U For Radius Programming the center point is derived from the radius that is given by the U parameter. Typically, there are two arcs of a given radius that lead from the starting-point to the endpoint. If the radius is positive, the shorter one is used, otherwise the longer one is chosen. Apart from that, the absolute value of the radius is regarded by the interpreter. CONSTRAINTS: • Radius Programming can by its nature not be used to program a full circle. This curvature can be programmed by Centerpoint Programming. • The radius must not be zero. • The radius must not be smaller than half of the distance between starting-point and endpoint with respect to the workingplane. Helical If the starting-point and endpoint do not lie in a plane that is parallel to the workingplane, a helical movement is performed. TIP: move Circle3D The ST-function move Circle3D is a more powerful way to define a circle or helix. It covers 3D-arcs and multiturn circles. TF5100 Version: 2.14.3 39
## Page 40

GST Reference Manual Example: The following example results in the path that is shown in Figure “Example G00G02”. The block N10 uses Radius Programming to define a clockwise arc from X0 Y0 to X10 Y10 with radius 10. Because the radius is positive, the center point c1 of the shorter arc is chosen. In block N30 the center point c2 of the longer arc is used because the radius is negative. The block N50 uses Centerpoint Programming, where the center c3=[60,0,0] is the sum of the starting-point [50,0,0] and [I,J,K]=[10,0,0]. The block N70 defines a full circle with center point C04 because the starting-point and endpoint are equal. The block N90 defines a helical arc with center point C05 and height 30 (in Z-direction). N01 G00 X0 Y0 N10 G02 X10 Y10 U10 F6000 N20 G00 X30 Y0 N30 G02 X40 Y10 U-10 N40 G00 X50 Y0 N50 G02 X60 Y10 I10 N60 G00 X80 Y0 N70 G02 J10 N80 G00 X110 Y0 N90 G02 J10 X120 Y10 Z30 M30 Z=20 Y 20 Z=10 10 c2 c4 c5 Z=30 0 c1 c3 Z=0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 110 120 130 Figure “Example G00G02”. G03 anticlockwise circular interpolation Command G3 or G03 Cancellation G00 [} 38], G01 [} 38] or G02 Set the interpolation mode to “circular/ helical, counterclockwise”. This interpolation behaves similar to G02. The interpolation mode applies to this block and all succeeding blocks until it is reset by G00, G01 or G02. Centerpoint Programming I<vx> J<vy> K<vz> Defines the center point for circular movements. See G2, G3 for details. The center point is defined as current Point + [vx,vy,vz]. The current length unit is used for vx, vy, vz. The parameters I, J, K are optional and have a 0 default value. Radius Programming U<v> In the context of G2 or G3 the radius is set to |v|. The current length unit is used for v. If v is positive, the shorter arc is used to interpolate between the current and the next point. If v is negative, the longer one is used. See G2, G3 for details. G303 With G303 an circular arc (a CIP circle) can be programmed, that can be freely located in space. The CIP circle can also be used to program a circle anywhere in space. For this purpose, it is necessary to program not only an end point but also some other point on the path. So that the circle can be described unambiguously, it is necessary, that the three points (the starting point is given implicitly) must not be collinear. It is thus not possible to program a full circle in this way. 40 Version: 2.14.3 TF5100
## Page 41

GST Reference Manual I, J and K are available as path point parameters. By default, their values are relative to the starting point of a circular path. G90 N10 G01 F2000 X0 Y0 Z0 // P1 (start point): X, Y, Z, N20 G303 I30 J-15 K15 X60 Y0 Z30 // P2 (path point): I, J, K // P3 (end point): X, Y, Z N30 M02 Requirements G303 Twin CAT GST Twin CAT V3.1.4024.40 GST 3.1.8.62 5.4.7 Dwell Time (G04) Command G4 or G04 Cancellation End of block Parameter F or X Suspend machining for a given duration. The duration is defined by either X or F in the current time unit. (See unit for details.) TF5100 Version: 2.14.3 41
## Page 42

GST Reference Manual Example: The following example assumes that the current time unit is set to seconds. On one execution of the program the machine moves to X10, waits for 1.5 seconds and then moves to X20. N10 G01 X10 F6000 N20 G04 F1.5 N30 G01 X20 M02 5.4.8 Accurate Stop (G09,G60) The accurate stop instruction is used, for example, when sharp contour corners must be manufactured. At the contour transition the set path velocity is reduced to zero and then increased again. This ensures that the programmed position is approached precisely. G09 blockwise Accurate Stop - Nonmodal Command G9 or G09 Cancellation End of block G09 acts only on the set value side. G60 Accurate Stop - Modal Command G60 Cancellation G00 [} 38] 5.4.9 Delete Distance to go (G31) Command G31 Cancellation End of block G31 (“delete distance to go”) is activated block by block via the NC program. This command enables deleting of the residual distance of the current geometry from the PLC with the function block Itp Del Dtg Ex [} 209]. In other words, if the command is issued while the block is processed, the motion is stopped with the usual deceleration ramps. The NC program then processes the next block. An error message is generated if the PLC command is not issued during the execution of a block with "delete distance to go" selected. G31 always effects an implicit decoding stop, i.e. an exact positioning always occurs at the end of the block. Example: N10 G01 X0 Y0 F6000 N20 G31 G01 X2000 N30 G01 X0 N40 M02 Requirements Development Environment Target System Twin CAT V3.1.4024.20 PC or CX (x86 or x64) 5.4.10 Tool Radius Compensation (D, G40, G41, G42) D D<v> Select tool v. The new tool applies to its own block and all succeeding blocks until a new tool is selected. Tool 0 is special. Its selection deactivates any tool compensation. Tool 0 can be regarded as tool where all tool parameters are set to zero. It is selected by default. 42 Version: 2.14.3 TF5100
## Page 43

GST Reference Manual Example: In the following example tool 1 is defined to have a Y-offset of 10 and tool 2 to have an Y-offset of 20. Block N10 and block N50 use tool 0. Tool 1 applies to block N20 and to block N30. In block N40 tool 2 is active. Figure “Example D” shows the resulting programmed path (dotted line) and the resulting tool center point path (solid line). !tool Set(index:=1, nr:=1, offset Y:=10); !tool Set(index:=2, nr:=2, offset Y:=20); N10 G01 X10 Y0 F6000 N20 G01 X20 Y0 D1 N30 G01 X30 Y0 N40 G01 X40 Y0 D2 N50 G01 X50 Y0 D0 M02 Y 20 10 0 -10 X -10 0 10 20 30 40 50 60 Figure “Example D”. G40 Command G40 (default setting) Cancellation G41 or G42 Deactivate Tool Radius Compensation (TRC). G41 Command G41 Cancellation G40 or G42 Activate tool radius compensation (TRC). After activation the programmed path is shifted left by the radius of the currently selected tool. (See D.) On activation, a tool with a nonzero index must be selected. Example: The following example demonstrates the activation and deactivation of tool radius compensation. The programmed path (dotted line) and the compensated path (solid/ dashed line) are shown in Figure “Example G40G41”. • The first line of the GST program sets the offset parameter to 5 mm. Therefore, the adjacent segments of a gap are extended by 5 mm. The remaining gap is closed by a circular arc. • The second line defines the approach and depart behavior to use a circular arc with a radius of 5 mm and an angle of 90 degree. • The third line defines tool 1 to have a radius of 10. • Block N10 describes a linear movement to [10,0,0]. TF5100 Version: 2.14.3 43
## Page 44

GST Reference Manual • The next block N20 selects tool 1 and activates tool radius compensation, where D1 comes into effect before G40 is processed and G40 is active before X20 is processed. Therefore, the end of segment N20 is subject to TRC (tool radius compensation). The linear movement from the end of segment N10 to the end of segment N20 in the programmed path is substituted by an approach-segment (dotted line) from the end of N10 to the end of N20' in the compensated path. • In the next three lines a linear movement along N30, N40 and N50 is programmed. Since segment N40 would result in a collision, it is eliminated from the compensated path. • In the next line a circular arc along N60 is programmed. The gap between the end of N50' and the beginning of N60' is closed as described earlier. • The line along N70 is the last segment that is subject to TRC (tool radius compensation), since its deactivation becomes active before the end of N80. The line along N80 is replaced by the depart- segment N80', similarly to the approach-segment. !trc Offset Set(offset:=5); !trc Approach Depart Set(approach Radius:=5, approach Angle:=90, depart Radius:=5, depart Angle:=90); !tool Set(index:=1, tooltype:=tooltype Mill, radius:=10); N10 G01 X10 F6000 N20 X20 G41 D1 N30 X35 N40 X40 N50 Y20 N60 G02 X50 Y10 U10 N70 G01 X70 N80 X80 Y0 G40 N90 X90 M02 Y gap 30 N50'' N60' N80' 20 approach N70' depart N50' N60 10 N70 N50 N20' N30' 0 N20 G40 N80 N10 N30 N40 N90 G41 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example G40G41”. G42 Command G41 Cancellation G40 or G41 This function is the same as G41, except that the path is shifted to the right. See G41 for details. 5.4.11 Zero Offest Shifts (G53,G54...59) G53 zero shift suppression Command G53 (default setting) Cancellation G54.. G57 Deactivate any zero offset shift translation. This adjustment is the default. The deactivation becomes active also for the current block. See sections Zero Offset Shift [} 84] and G58/ G59 for details. 44 Version: 2.14.3 TF5100
## Page 45

GST Reference Manual G54.. G57 adjustable zero shift Command G54 G55 G56 G57 Cancellation G53 or selection of another configurable zero shift Activates the translation that is associated with the given G-Code (TZ54…TZ57). Also activates the translations of G58 and G59. The translations apply to the current block and all succeeding blocks until changed. See section Zero Offset Shift [} 84] for details. G58, G59 programmable zero shift Command G58 or G59 Cancellation G53 Set the translation that is associated with the given G-Code. The new translation value is given by the parameters X,Y,Z, which are mandatory. By default, the associated translations are zero. See section Zero Offset Shift [} 84] for details. Example: The resulting MCS (machine coordinate system) path and the applied translations of this example are shown in Figure “Example G54G58G59”. • The first line sets the translation that is associated with G54 to [0,5,0]. • The next line sets the programmed translation of G58 to [0,10,0]. Since zero-offset-shifts are still disabled (default G53), the PCS (program coordinate system) and MCS (machine coordinate system) match. • Accordingly, the block N20 results in a linear movement from MCS (machine coordinate system) coordinate [0,0,0] to [20,0,0]. • The next line activates G54 and programs a linear movement along N30, whereby G54 becomes active before the movement. The programmed PCS (program coordinate system) coordinate [40,0,0] is mapped to the MCS (machine coordinate system) coordinate [40,15,0]. • The next line sets the programmed transformation G59 to [0,5,0]. Thereby, the effective translation changes from [0,15,0] to [0,20,0]. Since the current MCS (machine coordinate system) coordinate must not be affected by this change, the current PCS (program coordinate system) coordinate is set to [40,-5,0], implicitly. • The succeeding ST-function frame Get stores these coordinates in [pcs X,pcs Y,pcs Z]. • The next line merely programs the X-coordinate of the end of segment N50. Therefore, the PCS (program coordinate system) coordinate of the end of segment N50 is [60,-5,0], which is mapped to the MCS (machine coordinate system) coordinate [60,15,0]. In other words: The translation G59 is active, but does not become apparent due to the adaption of the current PCS (program coordinate system) coordinate. (See section Applying Transformations [} 100] for details.) • It becomes apparent by the last line, which sets the PCS (program coordinate system) coordinate of the end of segment N60 to [80,0,0]. This coordinate is mapped to the MCS (machine coordinate system) coordinate [80,20,0]. !zero Offset Shift Set(g:=54, x:=0, y:=5, z:=0); N10 G58 X0 Y10 Z0 N20 G01 X20 Y0 F6000 N30 G54 X40 Y0 N40 G59 X0 Y5 Z0 ! VAR pcs X, pcs Y, pcs Z : LREAL; END_VAR !frame Get(x=>pcs X, y=>pcs Y, z=>pcs Z); N50 X60 N60 X80 Y0 M02 TF5100 Version: 2.14.3 45
## Page 46

GST Reference Manual Y 30 20 N60 N50 G59 G59 10 N30 G58 G58 G54 G58 G54 0 N20 G54 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example G54G58G59”. 5.4.12 Working Plane and Feed Direction (G17, G18, G19, P) G17 working plane XY Command G17 (default setting) Cancellation G18 or G19 Select XY-plane as workingplane, i.e. the workingplane normal is set to [0,0,1]. This workingplane is the default workingplane. G18 working plane ZX Command G18 Cancellation G17 or G19 Select ZX-plane as workingplane, i.e. the workingplane normal is set to [0,1,0]. G19 working plane YZ Command G19 Cancellation G17 or G18 Select YZ-plane as workingplane, i.e. the workingplane normal is set to [1,0,0]. P Specification of the feed direction P<v> Switch tool orientation. The value of v must be 1 or -1. If v is negative, the tool points in the direction of the working plane normal. Otherwise, it points into the opposite direction. Example: The resulting MCS-path (MCS: machine coordinate system) of the following example is shown in Figure “Example P”. The first line of the program defines Tool 1 to have a length of 10. G18 activates the XZ- workingplane. N10: The end of segment N10 is not subject to any tool compensation as D0 is active. N20: For segment N20 tool 1 is active with a positive tool orientation. To compensate the tool length the translation [0,10,0] is applied. (See section Transformations [} 98] for details.) Thereby, the PCS (program coordinate system) endpoint [20,10,0] of 46 Version: 2.14.3 TF5100
## Page 47

GST Reference Manual N20 is mapped to the MCS (machine coordinate system) endpoint [20,20,0]. The MCS (machine coordinate system) point and the applied transformation are shown in Figure “Example P”. N30: In block N30 the tool orientation is switched, which sets the translation to [0,-10,0]. This translation is applied to the PCS (program coordinate system) endpoint of N30 resulting in the MCS (machine coordinate system) endpoint [30,0,0]. N20.. N90: The blocks N60.. N90 are similar to N20.. N50, except that the Y-coordinate is not programmed. Therefore, the tool length compensation does not become apparent, although it is active. That behavior happens because the current PCS (program coordinate system) point is always adapted on a changed transformation. (See section Applying Transformations [} 100] for details.) !tool Set(index:=1, tooltype:=tooltype Drill, length:=10); G18 N10 X10 Y10 D0 F6000 N20 X20 Y10 D1 N30 X30 Y10 P-1 N40 X40 Y10 P1 N50 X50 Y10 D0 N60 X60 D1 N70 X70 P-1 N80 X80 P1 N90 X90 D0 M02 Y 30 20 N20 N30 N50 10 N10 N60 N70 N80 N90 N40 0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example P”. 5.4.13 Inch/metric dimensions (G70, G71, G700, G710) G70 dimensions in inches Command G70 Cancellation G71, G700 or G710 Set the unit for lengths to inch. The new unit also applies to the current block. G70 is equivalent to the call unit Length Set(unit Length Inch). The unit for velocity is not affected. See Unit Length [} 85] and G71 for details. G71 dimensions in millimeters Command G71 Cancellation G70, G700 or G710 TF5100 Version: 2.14.3 47
## Page 48

GST Reference Manual Set the unit for lengths to millimeter. The new unit also applies to the current block. G71 is equivalent to the call unit Length Set(unit Length Millimeter). The unit for velocity is not affected. See Unit Length [} 85] for details. Example: In Figure “Example G70G71” the path of the following example is shown, which uses the unit millimeter. • The first line of the program sets the unit for lengths to inch. This unit is used in the same line to interprete X2 in inch. Thus, the path N10 ends at position [50.8 mm, 0 mm, 0 mm]. • Accordingly, the next line moves the tool along N20 towards [50.8 mm, 25.4 mm, 0 mm]. • The last line sets the unit to millimeter. Therefore, the path N30 ends at position [80 mm, 25.4 mm, 0 mm]. Accordingly, the segment N30 is a horizontal line. N10 G01 X2 G70 F6000 N20 G01 Y1 N30 G01 X80 Y25.4 G71 M02 Y [mm] 30 N30 20 N20 10 0 N10 -10 X [mm] -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example G70G71”. G700 dimensions in inches with calculation of the feed Command G700 Cancellation G70, G71 or G700 Like G70, but also applies to the interpretation of velocity. The new unit comes into effect in the current block. G700 is equivalent to the calls unit Length Set(unit Length Inch) and unit Velocity Set(unit Length Inch,unit Time Minute). G710 dimensions in millimeters with calculation of the feed Command G710 Cancellation G70, G71 or G700 Like G71, but also applies to the interpretation of velocity. The new unit comes into effect in the current block. G710 is equivalent to the calls unit Length Set(unit Length Millimeter) and unit Velocity Set(unit Length Millimeter,unit Time Minute). Example: The path of the following example is shown in Figure “Example G700G710”. • The first line defines a linear movement to [1 in, 1 in, 0 in] with a velocity of 100 in/min. • The second line sets the length unit to mm, but does not affect the velocity unit. It defines a movement to [30 mm, 10 mm, 0 mm] with a velocity of 50 in/min. 48 Version: 2.14.3 TF5100
## Page 49

GST Reference Manual • The last line also sets the velocity unit to mm/min. Therefore, there is a movement to [40 mm, 20 mm, 0 mm] with a velocity of 1000 mm/min. N10 G700 G01 X1 Y1 F100 N20 G71 G01 X50 Y10 F50 N30 G710 G01 X80 Y20 F1000 Y [mm] 30 F=50 in/min 20 N10 N20 N30 10 F=100 in/min F=1000 mm/min 0 -10 X [mm] -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example G700G710”. 5.4.14 Dimensional Notation (G90, G91) G90 absolute dimensions Command G90 (default setting) Cancellation G91 Switches to absolute coordinates. X, Y, Z are interpreted as absolute PCS (program coordinate system) coordinates. This adjustment is the default. The switch becomes active in its own block. G91 relative dimensions Command G91 Cancellation G90 Switches to relative coordinates. X, Y, Z are interpreted to be relative to the current point, i.e. the next point is computed as the sum of [X,Y,Z] and the current point. The switch has an effect for its own block. Implement Offsets Manually Using G91 and in this way switching to relative coordinates any Tool Offsets and Zero Shifts that have been defined earlier are not evaluated within these coordinates and therefore have to be defined and implemented manually within the framework of the G91-Code. Example: The path of the following example is shown in Figure “Example G90G91”. The switch to G90/ G91 takes effect immediately. N10 G90 G01 X10 Y20 F6000 N20 X20 Y10 N30 G91 X10 Y10 N40 X10 Y-10 N50 G90 X50 Y20 M02 TF5100 Version: 2.14.3 49
## Page 50

GST Reference Manual Y 20 10 G91 G90 G90 0 -10 X -10 0 10 20 30 40 50 60 Figure “Example G90G91”. 5.4.15 M-Functions (M) M M<v> Triggers the M-function v. The timing and behavior depends on the definition of v in the development environment of Twin CAT. M2 and M30 are internally defined. Both functions trigger a synchronization with the NC-channel. (See wait()- function, chapter Synchronization [} 80].) Both functions stop the execution of the GST-program. Due to this order the interpreter waits for the completion of the NC-channel before it stops. In addition, M30 also resets all fast M-functions and H, S, T. There must not be more than one M-function of type handshake in a block. The M-functions M2 and M30 do not have to be defined by the user in the development environment of Twin CAT. Example: This example assumes the following definitions of M-functions: M10: Fast before move. M11: Fast after move. M12: Fast before move, auto-reset, reset M10, M11. M20: Handshake before move. M21: Handshake after move. M02: Program end. Figure “Example M10M11M12M20M21” visualizes the programmed path and the activation of M-functions. The fast M-functions M10, M11 are reset by M12, which itself is reset automatically. N10 G01 X10 F6000 N20 X30 M10 M20 N30 X50 M11 M21 50 Version: 2.14.3 TF5100
## Page 51

GST Reference Manual N40 X70 N50 X90 M12 M02 M10 M11 M12 M20 M21 Y10 0 M10,M20 M11,M21 M12 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example M10M11M12M20M21”. 5.4.16 R-Parameters Arithmetic Parameters The arithmetic parameters, for short known as R-parameters, are interpreter variables that are named by an expression of the form “R<n>”. Since ‘n’ is an integer in the range 0..999, a total of 1000 R-parameters are available. The first 900 values R0.. R899 of these are local variables for the NC channel. They can only be accessed by the interpreter of the channel. The R-parameters R900.. R999 are declared globally. They exist only once for each NC, and all channels access the same storage. This kind of accessibility organization makes it possible to exchange data (e.g. for part tracing, collision avoidance etc.) beyond channel boundaries. Assigning a Value to an R-Parameter Assigning a value to an R-parameter is merely possible within Structured Text. There are two ways of assigning a value to an R-parameter. The value can be assigned directly or the r Set function can be employed. The function r Set is suitable to use when the index of the R-parameter to be assigned should not be determined until runtime. Structured Text: Assigning an R-Parameter Value Directly R<n> := LReal; Example ! R1 := 7; Structured Text: Assigning an R-Parameter Value with the “r Set” Function r Set(index := LINT, value := LREAL) Example !r Set(1, 7); Reading an R-Parameter Value There are two ways of reading an R-parameter. An R-parameter can be used in G-Code directly or it can be extracted within Structured Text using the r Get function. The function r Get extracts an R-parameter value according to its index. Structured Text: Reading an R-Parameter Value with the “r Get” Function TF5100 Version: 2.14.3 51
## Page 52

GST Reference Manual r Get(index := LINT) : LREAL G-Code Example: Extracting an R-Parameter Value Directly ! R1 := 7; N10 G01 X=R1 F6000 G-Code Example: Extracting an R-Parameter Value with the “r Get” Function ! R1 := 7; N10 G01 X={r Get(1)} F6000 Example: Assigning and Extracting { VAR value R1 : LREAL; END_VAR r Set(1, 7); value R1 := r Get(1); R2 := 10; R3 := R1 + R2; ! N10 G01 X=R1 Y0 Z=R2 F6000 ! N20 G01 X={r Get(3)} MSG(to String('R1 = ', value R1, ',R2 = ', r Get(2), ', R3 = ', R3)); } M02 Output: R1 = 7.000000, R2 = 10.000000, R3 = 17.000000 R-Parameters in Subroutines (Functions) Within a subroutine (function) an R-parameter has to be declared via a VAR_EXTERNAL declaration. Example: { FUNCTION my Function : LREAL VAR_EXTERNAL R45: LREAL; END_VAR } N10 G01 X=R45 F6000 ! END_FUNCTION Requirements Development Environment Target System Twin CAT V3.1.4024.4 or 4022.32 PC or CX (x86 or x64) 5.4.17 H, S, and T parameters The H, S, and T parameters are used to transfer parameters to the PLC during block execution. Parameter Data type Use Example H parameter DINT (32Bit signed) Help parameter N1 G1 X10 Y20 H=1020 S parameter WORD Spindle N2 G1 X20 Y30 S=30 T parameter WORD Tool N3 G1 X30 Y40 T4 52 Version: 2.14.3 TF5100
## Page 53

GST Reference Manual • In contrast to the classic interpreter, the H parameter also acts before the movement in the GST interpreter, see Execution Order [} 37] of a block. • No R parameter can be assigned to the T parameter. • For the T parameter, assignment is performed without an assignment operator ('='). 5.4.18 General Codes (F, N, Q, X, Y, Z, A, B, C) F F<v> Set velocity to v. Applies to the current block and all succeeding blocks until a new velocity is programmed. The unit for velocity selected currently is used. (See section unit Velocity Set [} 85] for details.) The default velocity is 0. The velocity must be set to a nonzero value before a movement is programmed. Otherwise, an error is issued. Example: The first two segments N10 and N20 are processed with a velocity of 6000 mm/min, and the last segment N30 is processed with a velocity of 3000 mm/min. N10 G01 X100 F6000 N20 G01 X200 N30 G01 X300 F3000 M02 N N<v> Set the block number to v. Typically, the block number is used to monitor the progress of the NC-program. Q Q<i>=<v> Set the value of axis Q<i> to v where i must lie in the range 1 to 5. The Q-axes use linear interpolation. The address letters Q and R are handled in a special way for historical reasons. The address Q<i> has to be followed by a G-expression or by an ST-expression. The G-word Q1100 is invalid. Use Q1=100, instead. Example: The path of the following example is shown in Figure “Example Q”. The Q-axes are interpolated linear with the interpolation of a movement. The last block (N40) results in a linear interpolation of a Q-axis without a concurrent movement. N10 G01 X30 Y0 Q1=100 F6000 N20 G02 X50 Y20 I20 Q2=200 N30 G01 X60 Q1=300 Q2=300 N40 Q1=0 M02 TF5100 Version: 2.14.3 53
## Page 54

GST Reference Manual Y 30 _Q1=100, _Q2=200 _Q1=300, _Q2=300 20 N30 N40 N20 _Q1=100, _Q2=100 _Q1=0, _Q2=300 10 _Q1=0, _Q2=0 _Q1=100, _Q2=0 N10 0 _Q1=50, _Q2=0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Q”. X X<v> Sets the X-coordinate of the next point to v. The current length unit is used for v. Y Y<v> Sets the Y-coordinate of the next point to v. The current length unit is used for v. Z Z<v> Sets the Z-coordinate of the next point to v. The current length unit is used for v. A A<v> Sets the A-angle of the next orientation to v. The current angle unit is used for v. B B<v> Sets the B-angle of the next orientation to v. For v the current angle unit is used. C C<v> Sets the C-angle of the next orientation to v. For v the current angle unit is used. 5.5 ST - Structured Text (IEC 61131-3) 5.5.1 Comments Line Comment <st-code> // <comment> Text between ‘//’ and the end of line is treated as comment in ST-Code. 54 Version: 2.14.3 TF5100
## Page 55

GST Reference Manual Example: { VAR i : INT; // this variable is primarily used in FOR-loops for counting END_VAR } /* */ Comment <st-code> /* <comment> <comment> */ <st-code> Text between ‘/*’ and ‘*/’ is treated as comment in ST. This type of comment may be nested up to a depth of 3. The ‘/*…*/’-style comment may appear anywhere between literals, keywords, identifiers and special symbols. It may also contain G-Code lines. Example: The following example demonstrates the notation of comments in ST-Code. The first comment is placed within a variable declaration. The second comment encloses an entire ST-loop. The comment contains further comments and a G-Code line, which itself contains a G-Code comment. { VAR i /* used for counting */ : INT; END_VAR /* The following loop is commented out. FOR i := 0 TO 10 DO /* zigzag pattern */ ! G01 (linear interpolation) X=i Y{i MOD 2} F6000 // end of loop END_FOR; */ } (* *) Comment <st-code> (* <comment> <comment> *) <st-code> Text between ‘(*’ and ‘*)’ is treated as comment in ST. This type of comment may be nested up to a depth of 3. It is similar to the /*…*/-style comment. 5.5.2 Literals Integer Literals Decimal 18 Binary 2#10010 Octal 8#22 Hexadecimal 16#12 The same integer value in decimal, binary, octal and hexadecimal notation. Real Literals Notation of real values 1.0 TF5100 Version: 2.14.3 55
## Page 56

GST Reference Manual 1.602E-19 Boolean Literals Notation of Boolean values 0 1 TRUE FALSE Typed Literals <typename>#<literal> Typed literals where typename is a native type (e.g. Word or LReal) or an enumeration type (to avoid ambiguities). Typing of literals is typically not necessary in GST, since the interpreter implements a decent typesystem that handles untyped literals properly. There are a few exceptions where the type of a literal is significant for semantics, like in the following example. Example: The first assignment assigns the value 16#80 to w, whereas the second one assigns the value 16#8000 to w. { VAR w: word; END_VAR w := ror(BYTE#1,1); w := ror(WORD#1,1); } String Literals "abc" 'abc' Notation of a 2-byte and a 1-byte string, respectively. Note that there is no implicit conversion between both types. The following escape-sequences can be used within both types of literals: $L line feed $N newline $P form feed $R carriage return $t tab $' or $" quotes $<2 or 4 hexadecimal digits> character of given code . 56 Version: 2.14.3 TF5100
## Page 57

GST Reference Manual Duration Literals T#[+/-]<value><unit>[…]<value><unit> TIME#[+/-] <value><unit>[…]<value><unit> LT#[+/-]<value><unit>[…]<value><unit> LTIME#[+/-]<value><unit>[…]<value><unit> Time literals of type TIME or LTIME. The literal consists of an optional sign (+/-) and a sequence of value/ unit pairs. Value must be an integer, except for the last one that may also be a floating point number. Values must not be negative and may be arbitraryly large. Units must appear in the following order. d day h hour m minute s second ms millisecond us microsecond ns nanosecond An arbitrary subset of units may be used in a literal. For instance, the literal T#1d15ms1500.01us is valid. Date Literals DATE#<yyyy>-<mm>-<dd> D#<yyyy>-<mm>-<dd> LDATE#<yyyy>-<mm>-<dd> LD#<yyyy>-<mm>-<dd> Date literal of type DATE or LDATE. The literal is interpreted as UTC, i.e. timezone, daylight saving time and leap seconds are not considered. The year must not be smaller than 1970. The values yyyy, mm and dd have to be integer values, i.e. D#1980-20-10 is a valid date literal, for example. Time-of-Day Literals TIME_OF_DAY#<hh>:<mm>:<ss> TOD#<hh>:<mm>:<ss> LTIME_OF_DAY#<hh>:<mm>:<ss> LTOD#<hh>:<mm>:<ss> Time-of-day literal of type TOD or LTOD. The literal is interpreted as UTC, i.e. timezone, daylight saving time and leap seconds are not considered. hh and mm must be integer values. ss may be an integer or a floatingpoint number, i.e. TOD#7:30:3.1415 is a valid literal, for example. TF5100 Version: 2.14.3 57
## Page 58

GST Reference Manual Date-and-Time Literals DATE_AND_TIME#<yyyy>-<mm>-<dd>-<hh>:<mm>:<ss> DT#<yyyy>-<mm>-<dd>-<hh>:<mm>:<ss> LDATE_AND_TIME#<yyyy>-<mm>-<dd>-<hh>:<mm>:<ss> LDT#<yyyy>-<mm>-<dd>-<hh>:<mm>:<ss> Date-and-time literal of type DT or LDT. The literal is interpreted as UTC, i.e. timezone, daylight saving time and leap seconds are not considered. This literal is a combination of the date literal and the time-of-day literal. Analogously, the corresponding rules for these two parts apply. 5.5.3 Native Data Types Bitstring Types BOOL, BYTE, WORD, DWORD, LWORD Bitstring types of 1, 8, 16, 32 and 64 bit. Implicit conversion from left to right using zero extension. Unsigned Integer Types USINT, UINT, UDINT, ULINT Unsigned integer types of 8, 16, 32 and 64 bit. Implicit conversion from left to right preserving the value. Signed Integer Types SINT, INT, DINT, LINT Signed integer types of 8, 16, 32 and 64 bit. Implicit conversion from left to right preserving the value. An unsigned type of n bit is also implicitly converted to a signed type of m bit where the relation m > n must hold. There is no implicit conversion between bitstring types and integer types. Floating Point Types REAL, LREAL Floating point data types of 32 and 64 bit. Implicit conversion from left to right preserving the value. String Types string[<length>] wstring[<length>] 1-byte and 2-byte strings of given length. If length is omitted, it has 255 as default value. Character Types char wchar Single 1-byte and 2-byte character of a string. It can be implicitly converted to a string. Time-Related Types TIME, LTIME DATE, LDATE TIME_OF_DAY, TOD, LTIME_OF_DAY, LTOD 58 Version: 2.14.3 TF5100
## Page 59

GST Reference Manual DATE_AND_TIME, DT, LDATE_AND_TIME, LDT Datatypes for duration, date and time. Internally, all values of these types are represented with a granularity of 1 nanosecond. Values of date-related types represent the number of nanoseconds since 1.1.1970 (UTC). Leapseconds are ignored. Implicit conversion is allowed from a non-L type to an L type, e.g. from TIME to LTIME. 5.5.4 Userdefined Types Derived Types TYPE <type Name>: <type Name> := <default Value>; END_TYPE Definition of a new type as an alias to an existing type. The default value is optional. Enumeration Types TYPE <type Name> : (<enum Value>, …, <enum Value>) := <default Value>; END_TYPE Definition of an enumeration type. The default value is optional. Enumeration Types with Defined Values TYPE <type Name> : (<enum Value>:=<integer value>, …, <enum Value>:=<integer value>) := <default Value>; END_TYPE Definition of an enumeration type with user-defined values for each element. The default value is optional. Array Types TYPE <type Name>: ARRAY [<from>..<to>,<from>..<to>] OF <type Name> := [<default Value>, <repetition>(<default Value>), …]; END_TYPE Definition of an array type. The array may be multi-dimensional. The index range is defined for each dimension. At runtime the boundaries of the array are checked. A boundary violation leads to a runtime- error. The default values are defined in ascending order starting with the last dimension. A value can be repeated by placing it into parentheses prefixed with the number of repetitions. If the number of defined default values does not match the array size, initialization is truncated or padded with the default value of the element type. In either cases a compile-time warning is issued. Structure Types TYPE <type Name>: STRUCT <member Name>: member Type; TF5100 Version: 2.14.3 59
## Page 60

GST Reference Manual … END_STRUCT := (<member Name> := <default Value>, …); END_TYPE Defines a structure type of the given members. Currently, the default value is placed after the type definition. This positional style is a difference to the ST-standard. Pointer Types TYPE <type Name>: REF_TO <basetype Name>; END_TYPE Defines a pointer type of the given base type. 5.5.5 Control Structures IF-THEN-ELSIF-ELSE IF <condition> THEN <statements> ELSIF <condition> THEN <statements> ELSE <statements> END_IF; Conditional statement. The ELSIF-branch and ELSE-branch are optional. ELSIF can be repeated arbitrarily. CASE OF CASE <expression> OF <value>, <value>, …, <value>: <statements> ELSE <statements> END_CASE; The case-list consists of a comma-separated sequence of values or ranges. Only the first matching case is executed. The optional ELSE-branch is executed if no case matches. FOR FOR <variable> := <expression> TO <expression> BY <expression> DO <statements> END_FOR; Iterates over the given variable in the defined range (including) using the supplied step-size. If the latter is omitted, it has 1 as default value. 60 Version: 2.14.3 TF5100
## Page 61

GST Reference Manual WHILE WHILE <condition> DO <statements> END_WHILE; Pre-checked loop. REPEAT REPEAT <statement> UNTIL <condition> END_REPEAT; Post-checked loop. The break condition is evaluated after performing the <statements> the loop includes. EXIT EXIT; EXIT can be used within loops to leave the loop. If loops are nested, only the innermost loop is left. If there is no loop surrounding the EXIT keyword, a compile-time error is issued. 5.5.6 Jump statement LABEL <label_name>; <statements> GOTO <label_name>; The LABEL- and GOTO statements allow jumps in the G-code. LABEL <label_name>; A jump destination with the specified name is included at the specified position using LABEL. <label_name> must be a valid identifier, like the name of a variable or a function. A LABEL statement can be used where a statement is expected, except in the context of a CASE statement. If a LABEL statement is defined in a function, its scope is limited to the function. If the label statement is in the global code, it is valid only in the global scope. It is an error if two LABEL statements with the same name are defined in the same scope. GOTO <label_name>; Causes the execution of the g-code to continue at the point where the specified LABEL is included. It is an error if the specified <label_name> is not defined in the scope of the GOTO statement. In addition, it is not allowed to use GOTO statements within a CASE statement. Sample N10 G00 X0 Y0 Z0 N20 G01 X10 F1000 ! R1 := 0; ! LABEL jump Pos; ! R2 := R1; ! R1 := R2 + 1; N30 G01 Y=10*R1 ! IF R1 = 1 THEN ! GOTO jump Pos; ! END_IF TF5100 Version: 2.14.3 61
## Page 62

GST Reference Manual N40 G01 Z =10*r1 ! IF R1 = 2 THEN !goto jump Pos; ! END_IF M30 Requirements Twin CAT GST Interpreter Twin CAT 3.1.4024.47 GST 3.1.8.67 5.5.7 Userdefined Functions Function Definition FUNCTION <name> : <returntype> VAR_INPUT <variable declarations> END_VAR VAR_OUTPUT <variable declarations> END_VAR VAR_IN_OUT <variable declarations> END_VAR VAR <variable declarations> END_VAR VAR_EXTERNAL <variable declarations> END_VAR <statements> END_FUNCTION Declares a function. Thereafter, it is callable by its name. The declaration of the return type is optional. If it is supplied, the function returns a value of the given type. The return value is defined within the function body by an assignment to the function name. The function may have input, output and in-out parameters. The order of declaration is significant. It is used for nonformal calls. Declared variables are only used within the function body. External variables are imported from global scope. Variables and parameters are not persistent, i.e. they do not retain their value between two calls. Nonformal Function Call <functionname>(<expression>, …, <expression>) 62 Version: 2.14.3 TF5100
## Page 63

GST Reference Manual Nonformal function call. The order of expressions must match the number and order of declared parameters. Formal Function Call <functionname>( <input Param Name> := <expression>, <output Param Name> => <variable Name>, <input Param Name> := <variable Name>) Formal function call. Parameters are identified by their name. If a declared parameter is not listed, it is implicitly set to its default value. Do not Mix Formal with Nonformal Mixing formal with nonformal function calls leads to invalid GST-syntax. 5.5.8 Standard Functions 5.5.8.1 Type Conversion Type Conversion (*_TO_*) <native Type>_to_<native Type>(x) to_<native Type>(x) Explicit conversion between the given native types. The second alternative is overloaded for any applicable type. For conversion from floatingpoint to integer x is rounded. 5.5.8.2 Arithmetic and Trigonometric ABS ABS(x) Returns the absolute value of x. The function is overloaded for any integer type and floatingpoint type. The type of x is used as return type. SQRT SQRT(x) Returns the square root of x. The function is overloaded for any floatingpoint type. The type of x is used as return type. RESTRICTION: Variable x must not be negative. LN LN(x) Returns the natural logarithm of x, i.e. the logarithm to the base e. TF5100 Version: 2.14.3 63
## Page 64

GST Reference Manual The function is overloaded for any floatingpoint type. The type of x is used as return type. RESTRICTION: Variable x must be larger than 0. LOG LOG(x) Returns the logarithm of x to the base 10. The function is overloaded for any floatingpoint type. The type of x is used as return type. RESTRICTION: Variable x must be larger than 0. EXP EXP(x) Returns e raised to the power of x. The function is overloaded for any floatingpoint type. The type of x is used as return type. SIN SIN(x) Returns the sine of x where x is expected to be in radians. The function is overloaded for any floatingpoint type. The type of x is used as return type. See also: The g Sin function (chapter Trigonometric [} 86]). COS COS(x) Returns the cosine of x where x is expected to be in radians. The function is overloaded for any floatingpoint type. The type of x is used as return type. See also: The g Cos function (chapter Trigonometric [} 86]). TAN TAN(x) Returns the tangent of x where x is expected to be in radians. The function is overloaded for any floatingpoint type. The type of x is used as return type. See also: The g Tan function (chapter Trigonometric [} 86]). ASIN ASIN(x) Returns the arc sine of x within the interval [-PI/2,PI/2] radians. The function is overloaded for any floatingpoint type. The type of x is used as return type. 64 Version: 2.14.3 TF5100
## Page 65

GST Reference Manual See also: The g ASin function (chapter Trigonometric [} 86]). RESTRICTION: Variable x must lie within the interval [-1,1]. ACOS ACOS(x) Returns the arc cosine of x within the interval [0,PI] radians. The function is overloaded for any floatingpoint type. The type of x is used as return type. See also: The g ACos function (chapter Trigonometric [} 86]).. RESTRICTION: Variable x must lie within the interval [-1,1]. ATAN ATAN(x) Returns the arc tangent of x within the interval [-PI/2,PI/2] radians. The function is overloaded for any floatingpoint type. The type of x is used as return type. See also: The g ATan function (chapter Trigonometric [} 86]).. ATAN2 ATAN2(y,x) Returns the arc tangent of y/x within the interval [-PI,PI] radians. The function is overloaded for any floatingpoint type. The smallest common type of x and y is used as return type. See also: The g ATan2 function (chapter Trigonometric [} 86]).. ADD ADD(x1, x2, …) Returns the sum of all parameters. The ADD-function can have an arbitrary number of parameters, but has to have at least one. The function is overloaded for any integer and floatingpoint type. The smallest common type of all parameters is used as return type. MUL MUL(x1, x2, …) Returns the product of all parameters. The MUL-function can have an arbitrary number of parameters, but has to have at least one. The infix-operator ‘*’ can be used as an alternative. The function is overloaded for any integer and floatingpoint type. The smallest common type of all parameters is used as return type. SUB SUB(x,y) TF5100 Version: 2.14.3 65
## Page 66

GST Reference Manual Returns the difference x-y. The infix-operator ‘-’ can be used as an alternative. The function is overloaded for any integer and floatingpoint type. The smallest common type of x and y is used as return type. DIV DIV(x,y) Returns the quotient x/y. The infix-operator '/' can be used as an alternative. The function is overloaded for any integer and floatingpoint type. The smallest common type of x and y is used as return type. If the return type is an integer type, the result is truncated towards zero. RESTRICTION: Variable y must not be zero. MOD MOD(x,y) Returns the remainder of the integer division x/y. The infix-operator ‘MOD’ can be used as an alternative. The function is overloaded for any integer type. The smallest common type of x and y is used as return type. The result may also be negative. The equation x = MUL(DIV(x,y),y) + MOD(x,y) holds. RESTRICTION: Variable y must not be zero. EXPT EXPT(x,y) Returns x raised to the power of y. The function is overloaded such that x has a floatingpoint type and y has a floatingpoint type or integer type. The type of x is used as return type, i.e. returned is a Real or an LReal floating point type. The infix- operator ‘**’ can be used as an alternative. RESTRICTION: If x is negative, then y must be an integer. RESTRICTION: If x is zero, then y must be larger than zero. 5.5.8.3 Shift and Rotation SHL SHL(x,y) Returns the bitstring x shifted left by y bits. Zero-bits are inserted at the right side. The least significant bit is assumed to be rightmost. The function is overloaded for any bitstring type for x and any integer type for y. The type of x is used as return type. 66 Version: 2.14.3 TF5100
## Page 67

GST Reference Manual CONSTRAINT: Variable y must not be negative. SHR SHR(x,y) Returns the bitstring x shifted right by y bits. Zero-bits are inserted at the left side. The least significant bit is assumed to be rightmost. The function is overloaded for any bitstring type for x and for any integer type for y. The type of x is used as return type. CONSTRAINT: Variable y must not be negative. ROL ROL(x,y) Returns the bitstring x rotated left by y bits. Bits that are shifted out at the left side are inserted at the right side. The least significant bit is assumed to be rightmost. The function is overloaded for any bitstring type for x and for any integer type for y. The type of x is used as return type. CONSTRAINT: Variable y must not be negative. ROR ROR(x,y) Returns the bitstring x rotated right by y bits. Bits that are shifted out at the right side are inserted at the left side. The least significant bit is assumed to be rightmost. The function is overloaded for any bitstring type for x and for any integer type for y. The type of x is used as return type. CONSTRAINT: Variable y must not be negative. 5.5.8.4 Logical Operations AND AND(x1, x2, …) Returns the bitwise Logical And of all parameters. Bit i is set in the result if bit i is set in all parameters. The AND function can have an arbitrary number of parameters, but has to have at least one. The function is overloaded for any bitstring type. The smallest common bitstring type is used as return type. OR OR(x1, x2, …) TF5100 Version: 2.14.3 67
## Page 68

GST Reference Manual Returns the bitwise Logical Or of all parameters. Bit i is set in the result if bit i is set in at least one of all parameters. The OR function can have an arbitrary number of parameters, but has to have at least one. The function is overloaded for any bitstring type. The smallest common bitstring type is used as return type. XOR XOR(x1, x2, …) Returns the bitwise Logical Exclusive Or of all parameters. Bit i is set in the result if bit i is set in an uneven number of all parameters. The XOR function can have an arbitrary number of parameters, but has to have at least one. The function is overloaded for any bitstring type. The smallest common bitstring type is used as return type. NOT NOT(x) Returns the bitwise complement of x. Bit i is set in the result if bit i is not set in x. The function is overloaded for any bitstring type. The type of x is used as return type. 5.5.8.5 Selection (Conditional Expressions) SEL SEL(cond,x1,x2) Returns x1 if cond is false, and x2 otherwise. MUX MUX(select, x0, x1, …, x N) Returns x<select>. If select is 0, x0 is returned. If select is 1, x1 is returned and so forth. The MUX function can have an arbitrary number of parameters, but has to have at least two. The function is overloaded for any type for x<i> and for any integer for select. The smallest common type of x<i> is used as return type. RESTRICTION: The variable select must lie within the interval [0,N]. Otherwise, an out-of-bounds error is issued at runtime. 5.5.8.6 Min, Max and Limit MAX MAX(x1, x2, …) Returns the maximum of all parameters. The function is overloaded for any integer and floatingpoint type. The smallest common type of all parameters is used as return type. MIN MIN(x1, x2, …) Returns the minimum of all parameters. 68 Version: 2.14.3 TF5100
## Page 69

GST Reference Manual The function is overloaded for any integer and floatingpoint type. The smallest common type of all parameters is used as return type. LIMIT LIMIT(min,in,max) Returns in if it lies in the interval [min,max]. Otherwise, the violated bound (min or max) is returned. The function is overloaded for any integer and floatingpoint type. The smallest common type of all parameters is used as return type. CONSTRAINT: The min boundary must be smaller than the max boundary. 5.5.8.7 Comparison GT GT(x,y) Returns TRUE if x is larger than y. The smallest common type of x and y is used to perform the comparison. The function is overloaded for all integer and floatingpoint types. The returntype is BOOL. GE GE(x,y) Returns TRUE if x is not smaller than y. The smallest common type of x and y is used to perform the comparison. The function is overloaded for all integer and floatingpoint types. The returntype is BOOL. EQ EQ(x,y) Returns TRUE if x and y are equal. The smallest common type of x and y is used to perform the comparison. The function is overloaded for all integer and floatingpoint types. The returntype is BOOL. LE LE(x,y) Returns TRUE if x is not larger than y. The smallest common type of x and y is used to perform the comparison. The function is overloaded for all integer and floatingpoint types. The returntype is BOOL. LT LT(x,y) Returns TRUE if x is smaller than y. The smallest common type of x and y is used to perform the comparison. The function is overloaded for all integer and floatingpoint types. The returntype is BOOL. NE NE(x,y) TF5100 Version: 2.14.3 69
## Page 70

GST Reference Manual Returns TRUE if x and y are not equal. The smallest common type of x and y is used to perform the comparison. The function is overloaded for all integer and floatingpoint types. The returntype is BOOL. 5.6 CNC Functions 5.6.1 Strings and Messages to String to String(<arg0>, …, <arg N>): STRING Converts and concatenates the given arguments to one string. This string is limited to 255 characters, which is the default string length. The to String-function behaves like the print function, except that it yields a formatted string instead of printing. The to String-function is especially useful to format a string for the msg(…)-function. msg msg(str:= String[81]) Send the given message to the message list of Twin CAT. The message is processed by the NC-channel synchronously. It appears in the user-interface when all preceeding NC-commands are completed. To send formatted strings this function can be combined with the to String-function. The message is restricted to 81 characters. Text exceeding this restriction will be truncated. Example: The path of the following example is shown in Figure “Example Msg”. It is annotated with the emitted messages. { VAR x,y,z: LREAL; start: LDT; END_VAR ! N10 G00 X0 Y0 F300 start := current Ldt(); ! N20 G01 X30 msg('N20 completed'); ! N30 X60 Y10 frame Get(x=>x,y=>y,z=>z); msg(to String('Current position: [',x,',',y,',',z,']')); ! N40 X90 sync(); msg(to String('Machining time: ', current Ldt()-start)); } M02 70 Version: 2.14.3 TF5100
## Page 71

GST Reference Manual Y 30 Machining time: +18.00 20 Current position: [60.00,10.00,0.00] 10 N20 completed N40 N30 0 N20 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Msg”. 5.6.2 Transformations trans Rot X/Y/Z trans Rot X(angle := LREAL) trans Rot Y(angle := LREAL) trans Rot Z(angle := LREAL) Rotation around the respective axis by the given angle in the user-defined angle unit. The rotation is pushed onto the stack of transformations. The angle value is interpreted using the current angle-unit. See section Transformations [} 98] for details. Example: The resulting path of the following example is shown in Figure “Example Trans Rot Z”. • N10 is programmed with the PCS (program coordinate system) and the MCS (machine coordinate system) being equal. • N20 is programmed after a 45-degree rotation around the Z-axis in [0,0,0] has been pushed onto the stack of transformations. Another rotation of 45 degrees is pushed onto the transformation stack such that the rotations add up to 90 degree. • Therefore, the MCS (machine coordinate system) coordinate of the end of segment N30 is [0,30,0]. N10 G01 X30 Y0 F6000 !trans Rot Z(45); N20 G01 X30 Y0 !trans Rot Z(45); N30 G01 X30 Y0 !trans Pop(); !trans Pop(); M02 TF5100 Version: 2.14.3 71
## Page 72

GST Reference Manual Y 30 N30 20 10 N20 0 N10 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Trans Rot Z”. trans Rot A trans Rot A(x:=LReal, y:=LReal, z:=LReal, angle:=LReal) Rotate around vector [x,y,z] by the given angle. The rotation is pushed onto the stack of transformations. The angle value is interpreted using the current angle-unit. See section Transformations [} 98] for details. The vector [x,y,z] must not be the zero vector. Example: The resulting path of the following example is shown in Figure “Example Trans Rot A”. The first invocation of trans Rot A rotates the PCS (program coordinate system) around the positive Z-axis (right-hand rule) by 45 degree. The second invocation rotates around the negative Z-axis by the same angle, i.e. into the opposite direction. The combination of both rotations is the identity transformation. !trans Rot A(0,0,1,45); N10 G01 X30 Y0 F6000 !trans Rot A(0,0,-1,45); N20 G01 X30 Y0 !trans Pop(); !trans Pop(); M02 Y 30 20 N10 10 N20 0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Trans Rot A”. trans Mirror X/Y/Z trans Mirror X() 72 Version: 2.14.3 TF5100
## Page 73

GST Reference Manual trans Mirror Y() trans Mirror Z() Mirror with respect to the X-direction, Y-direction or Z-direction relative to the origin of the current PCS (program coordinate system). The transformation is pushed onto the stack of transformations. The invocation of a mirror function switches the orientation of the coordinate system from right- handed to left-handed or vice versa. Most notably, this behavior switches the rotation direction of circles and the compensation direction of tool radius compensation. By default, the coordinate system is right-handed. Example: The resulting path of the following example is shown in Figure “Example Trans Mirror X”. The PCS (program coordinate system) is mirrored along the X-dimension. Thereby, the coordinate system becomes a left- handed system, within which the rotation direction of G2 is (intentionally) swapped. N10 G02 X20 Y20 U20 F6000 !trans Mirror X(); N20 G02 X-40 Y0 U20 !trans Pop(); M02 Y 30 20 N10 10 N20 0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Trans Mirror X”. trans Scale trans Scale(factor:= LReal) Scales the coordinate system by the factor in the X-dimension, Y-dimension and Z-dimension. The transformation is pushed onto the stack of transformations. The factor must be nonzero. If the factor is negative, the coordinate system is effectively mirrored in the X-dimension, Y- dimension and Z-dimension. Thus, the orientation of the coordinate system is swapped. Example: The resulting path of the following example is shown in Figure “Example Trans Scale”. After scaling by a factor of 2, the endpoint of segment N20 is mapped to [60,20,0]. N10 G01 X30 Y10 F6000 !trans Scale(2); N20 G01 X30 Y10 !trans Pop(); M02 TF5100 Version: 2.14.3 73
## Page 74

GST Reference Manual Y 30 20 N20 10 N10 0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Trans Scale”. trans Scale Axis trans Scale Axis(axis No := axis Index, factor := value); Scales the selected path axis (axis No) by the factor. The supported axis and indexes are: • X: 0 • Y: 1 • Z: 2 Q-axes are not supported. A different axes scaling is only allowed for linear movements, not for circular movements. Example 1 N10 G01 X30 Y10 F6000 !trans Scale Axis(axis No:= 0, factor:=2.0); !trans Scale Axis(axis No:= 1, factor:=2.0); !trans Scale Axis(axis No:= 2, factor:=3.0); N20 G01 X30 Y10 N30 G03 X40 Y10 I5 J0 M02 Y 30 20 N20 10 N30 N10 0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example 1 Trans Scale Axis”. Example 2 N10 G01 X20 Y5 F6000 !trans Scale Axis(axis No:= 0, factor:=2.0); !trans Scale Axis(axis No:= 1, factor:=2.0); !trans Scale Axis(axis No:= 2, factor:=3.0); N20 G01 X20 Y5 !trans Scale Axis(axis No:= 0, factor:=2.0); 74 Version: 2.14.3 TF5100
## Page 75

GST Reference Manual !trans Scale Axis(axis No:= 1, factor:=3.0); N30 G01 X20 Y5 M02 Y 30 20 N30 10 N10 N20 0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example 2 Trans Scale Axis”. Requirements Development Environment Target System Twin CAT V3.1.4024.20 PC or CX (x86 or x64) trans Translate trans Translate(x:=LReal, y:=LReal, z:=LReal) Translate by vector [x,y,z]. The translation is pushed onto the stack of transformations. Example: The resulting path of the following example is shown in Figure “Example Trans Translate”. After translating by [40,20,0] the endpoint of segment N20 is mapped to [80,20,0]. N10 G01 X20 Y0 F6000 !trans Translate(40,20,0); N20 G01 X40 Y0 !trans Pop(); M02 Y 30 20 N20 10 0 N10 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Trans Translate”. trans Pop trans Pop() Pops a transformation from the stack of transformations. Example: TF5100 Version: 2.14.3 75
## Page 76

GST Reference Manual The resulting path of the following example is shown in Figure “Example Trans Pop”. This example pushes the translation [0,20,0] onto the stack, followed by the translation [0,10,0]. Thereby, the effective translation for N30 is [0,30,0]. The invocation of trans Pop removes the translation [0,10,0] from the stack. Thus, the endpoint of segment N40 is translated by [0,20,0]. After removing the last translation from the stack the endpoint of segment N50 is not translated at all. N10 G01 X10 Y0 F6000 !trans Translate(0,20,0); N20 G01 X30 Y0 !trans Translate(0,10,0); N30 G01 X50 Y0 !trans Pop(); N40 G01 X70 Y0 !trans Pop(); N50 G01 X90 Y0 M02 Y 30 N30 N40 20 10 N20 N50 0 N10 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Trans Pop”. trans Depth trans Depth(): UInt Yields the depth of the stack of transformations, i.e. the number of active transformations. See trans Restore(…), chapter transformations [} 98], for more details. trans Restore trans Restore(depth:= UInt) Reduces the stack of transformations to the given depth. This command is typically used in conjunction with trans Depth() to restore an earlier state of the stack. The current depth of the stack must not be smaller than the given depth. Example: The resulting path of the following example is shown in Figure “Example Trans Depth Trans Restore”. A translation to [40,10,0] is initially pushed onto the transformation stack. The resulting depth is stored in variable saved Depth. The following code repeatedly performs a linear move to X20 Y0 and a rotation by 45 degree. This resulting path is one half of an octagon, composed of segments N10 to N50. When N50 is processed, the transformation stack contains the initial translation and 4 rotations by 45 degree. The invocation of trans Restore(saved Depth) restores the stack depth of 1 by removing all rotations. Hence, only the translation is applied to N60. ! VAR saved Depth : UINT; END_VAR !trans Translate(40,10,0); !saved Depth := trans Depth(); N10 G01 X20 Y0 F6000 76 Version: 2.14.3 TF5100
## Page 77

GST Reference Manual !trans Rot Z(45); N20 G01 X20 Y0 !trans Rot Z(45); N30 G01 X20 Y0 !trans Rot Z(45); N40 G01 X20 Y0 !trans Rot Z(45); N50 G01 X20 Y0 !trans Restore(saved Depth); N60 G01 X10 Y0 M02 Y 30 N40 N30 20 N50 N20 10 N60 N10 0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Trans Depth Trans Restore”. 5.6.3 Circular Movement move Circle3d move Circle3d(cx:=LREAL, cy:=LREAL, cz:=LREAL, nx:=LREAL, ny:=LREAL, nz:=LREAL, a ngle:=LREAL, height:=LREAL) Move circular by rotating around the center cx,cy,cz and the normal vector nx,ny,nz by the given angle. If height is nonzero, a helix is described. If angle is greater than a full circle, a multiturn circle or a multiturn helix is described. The rotation is performed according to the right hand rule. Using a negative angle or flipping the normal will reverse the direction of rotation. The angle value is interpreted using the current angle unit. The parameters x, y, z, cx, cy, cz are interpreted using the current length unit. The radius must be nonzero. Example: The resulting path of the following example is shown in Figure “Example Move Circle3D”. The invocation of move Circle3D describes a helical movement. It starts at the current point that is [40,10,0]. The center axis of the helix is defined by the point [30,10,0] and direction [g Sin(22.5),0,g Cos(22.5)]. Compared to the workingplane normal [0,0,1] the axis is tilted by 22.5 degree in X-direction. The angle of 720+90 degree describes a multiturn helix. It exhibits a height of 30 with respect to the center axis. The endpoint of the helix is not explicitly programmed to avoid redundancy. If the user requires these coordinates, they can be retrieved by the frame Get(…) function, as demonstrated. The approximate coordinates are shown in Figure “Example Move Circle3D”. { VAR x,y,z: LREAL; END_VAR ! N10 G01 X40 Y10 F6000 move Circle3D(cx:=30, cy:=10, cz:=0, nx:=g Sin(22.5), ny:=0, nz:=g Cos(22.5), angle:=720+90, height:=30 ); frame Get(x=>x,y=>y,z=>z); TF5100 Version: 2.14.3 77
## Page 78

GST Reference Manual } M02 Y 30 X=42.94... Y=19.23... 20 Z=31.25... 10 0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Move Circle3D”. 5.6.4 Centerpoint Correction centerpoint Correction Set centerpoint Correction Set(on:= bool) Activates the centerpoint correction for circles. The centerpoint correction will be used for circles that are defined using centerpoint programming, see G2 and G3 [} 39]. Due to inaccuracies (e.g. rounding errors by the CAD program), the radius of the starting-point and endpoint with respect to the centerpoint may differ. If centerpoint correction is active, the center will be moved in such a way that the starting-radius and endradius are equal to their former average. A limit for centerpoint correction can be configured with centerpoint Correction Limit Set(…). If this limit is exceeded, a runtime error will be reported. centerpoint Correction Limit Set centerpoint Correction Limit Set(limit:= LREAL) Sets the precision limit for the centerpoint of circles. If the given limit is exceeded, a runtime error is reported. The default limit value is 0.1 mm. 5.6.5 Tools Using tool displacement and rotation If the Cartesian tool displacement is used in combination with rotation [} 71], then the compensation will only be correct, if the aggregate (the tool carrier) is also rotated through the same angle. tool Param Set tool Param Set(tidx:= USINT, col:= USINT, val:= LREAL) Set a parameter of the tool tidx (1..255) to val. The parameter is identified by col (0..15). COL DESCRIPTION 0 tool number For giving the tool a number. Written to the T-parameter in the cyclic channel interface. 78 Version: 2.14.3 TF5100
## Page 79

GST Reference Manual 1 tool type (10: drill, 20: miller) The drill is type 10. The miller is type 20. 2 length Describes the length of e.g. the drill. 3 - 4 radius 5 length (added to the length value of column 2) Describes the wear on e.g. the drill. The wear has to be given as a negative value as it is added to the length. 6 - 7 radius (added to the radius value of column 4) 8 x-shift Cartesian tool displacement in x-direction. 9 y-shift Cartesian tool displacement in y-direction. 10 z-shift Cartesian tool displacement in z-direction. 11 - 12 - 13 Tool type 20 (miller): for free use by the user 14 Tool type 20 (miller): for free use by the user 15 Tool type 20 (miller): for free use by the user tool Param tool Param(tidx:= USINT, col:= USINT): LREAL Yields the given tool parameter. tool Set tool Set(index:= USINT, nr:= INT, tooltype:= Tool Type, length:= LREAL, radius:= LREAL, length Add:= LREAL, radius Add:= LREAL, offset X:= LREAL, offset Y:= LREAL, offset Z:= LREAL) Set all parameters of a tool. The index is used in D-words [} 42] to refer to the tool. It must lie in the range 1 to 255. The parameter nr has only informational purpose. Typically, it is a company internal number to identify a certain tool. The parameter tooltype identifies the kind of tool, like a drill for instance. The remaining parameters are dimensions, which are visualized in Figure “Tool Set Dimensions”. If the tool orientation is changed towards the negative (see P-word [} 46]), the value length+length Add is implicitly negated. The parameters length, radius, length Add, radius Add, offset X, offset Y and offset Z are interpreted using the current length unit. TF5100 Version: 2.14.3 79
## Page 80

GST Reference Manual Y offset Z offset Y offset X X length+length Add Tool Z radius+radius Add Figure “Tool Set Dimensions”. Example: The example defines tool 1 as a drill of total length 48.5 and tool 2 as a mill with a length of 30 and a diameter of 5. !tool Set(index:=1, nr:=4711, tooltype:=tooltype Drill, length:=50, length Add:=-1.5); !tool Set(index:=2, nr:=10783, tooltype:=tooltype Mill, length:=30, radius:=2.5); tool Type Enumeration of tool types. tooltype Drill tooltype Mill tooltype Drill: Selects a drill as a tool. tooltype Mill: Selects a mill as a tool. 5.6.6 Synchronization sync sync() Synchronizes the interpreter with the associated NC-channel. The sync()-command blocks until all pending NC-commands are completed, i.e. until the job-queue of the NC-channel is empty. This command replaces the former @714-command. Oftentimes, the sync()-command is combined with a preceeding M-function of type handshake. Then, the sync()-command will block until the M-function is acknowledged by the PLC. wait wait() Waits for a Go Ahead-signal from the PLC. The wait()-command blocks until this signal is received. This command replaces the former @717-command. Compared to a combination of an M-function and sync(), this kind of synchronization does not result in an empty job queue. Notably, an empty job queue forces the machine to halt. The Go Ahead-signal may be send from the PLC before the associated wait()-function is called. In this case the wait()-function does not block. 80 Version: 2.14.3 TF5100
## Page 81

GST Reference Manual 5.6.7 Query of Axes query Axes query Axes() Set the MCS (machine coordinate system) coordinates of the interpreter to the actual coordinates of the physical axes. The MCS (machine coordinate system) coordinates are automatically translated to PCS (path coordinate system) coordinates, which are exposed to the programmer. They may also be retrieved by frame Get(…). A combination of sync() and query Axes() replaces the former @716-command. • The query Axes()-command considers the path axes (X, Y, Z), as well as the auxiliary axes (Q1.. Q5). The query Axes()-command should be preceeded by sync() to avoid unexpected behavior. Example: The resulting path of the following example is shown in Figure “Example Query Axes”. The example assumes M20 to be an M-function of type “handshake after”. The PLC is assumed to • wait for M20, • move the Y-axis to 20, • wait for completion of the movement, • acknowledge M20. The interpreter sends the line segment N10 to the NC-channel followed by the M-function M20. Then the invocation of sync() blocks. The NC-channel signals the M-function to the PLC after the line segment N10 has been processed. Then the PLC moves the tool from the end of segment N10 to the beginning of segment N20 and acknowledges M20. The interpreter resumes operation and invokes query Axes(), which sets the internal “current point” to the endpoint of segment N10'. Therefore, the final block sends the line segment N20 to the NC-channel. N00 N10 G01 X40 M20 F6000 !sync(); !query Axes(); N20 G01 X80 M02 Y 30 N20 20 M20 acknowledged; axes queried 10 N10' Performed by PLC 0 N10 M20 signaled to PLC -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Query Axes”. TF5100 Version: 2.14.3 81
## Page 82

GST Reference Manual 5.6.8 Current Point frame Get frame Get(x:=LREAL, y:=LREAL, z:=LREAL, a:=LREAL, b:=LREAL, c:=LREAL) Store the current frame of the PCS (program coordinate system) in x, y, z and a, b, c. Example: The output of the following example is shown below. The G-Code in the example performs a linear movement to the PCS (program coordinate system) point [10,20,30]. Then these coordinates are stored in cur X, cur Y, cur Z by frame Get(…). The translation [1,2,3] that is pushed onto the transformation- stack leads to an adaption of the current PCS (program coordinate system) point such that the MCS (machine coordinate system) point [10,20,30] remains unchanged. Therefore, the subsequent call of frame Get(…) retrieves the PCS (program coordinate system) point [9,18,27]. { VAR cur X, cur Y, cur Z : LREAL; END_VAR ! G01 X10 Y20 Z30 F65000 frame Get(x=>cur X, y=>cur Y, z=>cur Z); MSG(to String(cur X,' ',cur Y,' ',cur Z,'')); trans Translate(1,2,3); frame Get(x=>cur X, y=>cur Y, z=>cur Z); MSG(to String(cur X,' ',cur Y,' ',cur Z,'')); } M02 Output: 10.000000 20.000000 30.000000 9.000000 18.000000 27.000000 q Axis Get q Axis Get(q1:=LREAL, q2:=LREAL, q3:=LREAL, q4:=LREAL, q5:=LREAL) Store the current values of Q-axes in q1 to q5. The Q-axes are the auxiliary axes. 5.6.9 Tool Radius Compensation trc Approach Depart Set trc Approach Depart Set(approach Radius:= LREAL, approach Angle:= LREAL, depart Radius := LREAL, depart Angle:= LREAL) Configures the approach and depart behavior to use an arc of given radius and angle. If the product of radius and angle are zero, no approach or depart segment will be inserted. The resulting configuration is used by G41/G42. trc Offset Set trc Offset Set(offset:= LREAL) Configures the amount of segment extension that is used to close gaps. If offset is zero, no extension will be performed. The resulting configuration is used by G41/G42. 82 Version: 2.14.3 TF5100
## Page 83

GST Reference Manual trc Limit Set trc Limit Set(limit:= ULINT) Configures the lookahead that is used for collision elimination. The resulting configuration is used by G41/G42. trc Param trc Param(): Trc Param Type Returns the current configuration as a structure value. trc Param Set trc Param Set(param:= Trc Param Type) Configures the tool radius compensation. This function is an alternative that summarizes trc Approach Depart Set, trc Offset Set and trc Limit Set. It can be used in combination with trc Param to load, save and restore different TRC (tool radius compensation) configurations efficiently. Trc Param Type Trc Param Type This structure contains all configuration parameters of the tool radius compensation. It consists of the following parameters. approach Radius: LREAL; approach Angle: LREAL; depart Radius: LREAL; depart Angle: LREAL; offset: LREAL; limit: ULINT; See trc Approach Depart Set, trc Offset Set, trc Limit Set for a comprehensive description of the listed parameters. collision Elimination collision Elimination(nx:= LREAL, ny:= LREAL, nz:= LREAL, limit:= ULINT) Activates collision elimination with respect to the plane of the normal vector nx, ny, nz. Collisions within the projection of the path onto the plane are eliminated. Supplying a zero vector deactivates collision elimination. The limit parameter can be used to restrict elimination to the last n segments. By default, elimination is unlimited. collision Elimination Flush collision Elimination Flush() This function can be called during active collision elimination to ignore any conflicts between the path preceding the call and the path succeeding the call. 5.6.10 Suppression of G-Code Blocks disable Mask disable Mask(): LWORD Yields the current value of the disable mask. Note that the mask may also be set by the PLC. TF5100 Version: 2.14.3 83
## Page 84

GST Reference Manual disable Mask Set disable Mask Set(mask:= LWORD) Sets the internal disable mask to the given value. The mask is used to suppress execution of G-Code blocks. The disable mask has 0 default value, i.e. no suppression is active by default. The mask consists of 64 bits. In a binary notation like 2#1101 bits are numbered from right to left, starting with bit 0. For the value 2#1101 the bits 0, 2 and 3 are set by value one. The remaining bits are not set by exhibiting zero value. Example: The resulting path of the following example is shown in Figure “Example Disable Mask Set”. The disable mask is initially set to the binary value 2#1101, which is equal to the decimal value 13. The first G-Code, which is N10 in the given example, is always executed, independently of the current disable mask because there is no ‘/’-operator in the N10-line. N20 is only executed if bit 0 is not set. In the case bit 0 is set N20 is supressed, which is true in the given example. The same holds for N30, since ‘/’ is only a shorthand for ‘/0’. N40 is not supressed, since bit 1 is not set. The G-Codes N50 and N60 after disable Mask Set(0) are executed, since no bit in the disable mask is set. In contrast, the call disable Mask Set(-1) sets all bits of the mask. Consequently, the succeeding G-Codes that are prefixed with a ‘/’, N80 and N90, are disabled. !disable Mask Set(2#1101); N10 G01 X10 Y10 F6000 /0 N20 G01 X20 Y0 / N30 G01 X30 Y0 /1 N40 G01 X40 Y10 !disable Mask Set(0); / N50 G01 X50 Y0 /1 N60 G01 X60 Y10 !disable Mask Set(-1); N70 G01 X70 Y0 /1 N80 G01 X80 Y10 /2 N90 G01 X90 Y20 M02 Y 30 disabled disabled 20 10 N40 N10 N70 N50 N60 0 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Disable Mask Set”. 5.6.11 Zero Offset Shift zero Offset Shift Set zero Offset Shift Set(g:= USINT, x:= LREAL, y:= LREAL, z:= LREAL) Sets the translation for G-Code g where g must be one of the numbers 54, 55, 56 or 57. Alternatively, the Zero Offset Shift can be set with the PLC Function Block Itp Write Zero Shift Ex [} 259]. 84 Version: 2.14.3 TF5100
## Page 85

GST Reference Manual Example: The resulting path of the following example is shown in Figure “Example Zero Offset Shift Set”. The zero offset shift of G54 is first set to the translation [0,10,0]. It gets active for N20 and any later segment endpoints until a novel translation is applied. The second invocation of zero Offset Shift Set has an immediate effect. It applies to N30 and any later segment endpoints until a novel translation is applied. The same holds for the last invocation. However, the block N40 does not program the Y-coordinate. Therefore, the change does not become apparent for N40. (See section Transformations [} 98] for details.) Because the block N50 programs the Y-coordinate, it applies the recent [0,30,0]-translation. !zero Offset Shift Set(g:=54, x:=0, y:=10, z:=0); N10 G01 X20 Y0 F6000 N20 G01 G54 X40 Y0 !zero Offset Shift Set(g:=54, x:=0, y:=20, z:=0); N30 G01 X60 Y0 !zero Offset Shift Set(g:=54, x:=0, y:=30, z:=0); N40 G01 X80 N50 G01 X100 Y0 M02 Y 30 N50 N40 20 N30 10 N20 G54 G54 G54 G54 0 N10 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Zero Offset Shift Set”. 5.6.12 Units unit Angle Set unit Angle Set(unit Angle:= Unit Angle) Set the unit for angles to unit Angle. The default is unit Angle Degree. The unit for angles applies to all NC-related functions like trans Rot X. It does not apply to ST-standard functions like sin. For this reason the interpreter offers a set of NC-specific counterparts like g Sin that consider the angle unit. Unit Angle Enumeration of the following values: unit Angle Radian: 0…2pi unit Angle Degree: 0…360 unit Angle Gon: 0…400 unit Angle Turn: 0…1 . unit Length Set unit Length Set(unit Length:= Unit Length) Set the unit for lengths to unit Length. The default is unit Length Millimeter. The unit for length applies to all NC-related functions like G01 or zero Offset Shift Set(…). TF5100 Version: 2.14.3 85
## Page 86

GST Reference Manual Unit Length Enumeration of the following values: unit Length Meter unit Length Centimeter unit Length Millimeter unit Length Micrometer unit Length Nanometer unit Length Inch unit Length Foot . unit Time Set unit Time Set(unit Time:= Unit Time) Set the unit for time to unit Time. The default is unit Time Second. The unit for time applies to all NC- related functions like G04. It does not apply to ST-standard functions like current Ldt(). Unit Time Enumeration of the following values: unit Time Second unit Time Millisecond unit Time Microsecond unit Time Minute unit Time Hour . unit Velocity Set unit Velocity Set(unit Length:= Unit Length, unit Time:= Unit Time) Set the unit for velocity to unit Length/unit Time. The default is unit Length Millimeter/ unit Time Minute. The unit for velocity applies to all NC-related functions. It is used by the F-parameter for instance. 5.6.13 Trigonometric (Unit Aware) g Sin g Sin(angle:= LREAL) • Returns the sine of the given angle where the current angle unit [} 85] is used to interpret the angle. • The return type is LREAL. This function is not overloaded. g Cos g Cos(angle:= LREAL) • Returns the cosine of the given angle where the current angle unit [} 85] is used to interpret the angle. • The return type is LREAL. This function is not overloaded. g Tan g Tan(angle:= LREAL) • Returns the tangent of the given angle where the current angle unit [} 85] is used to interpret the angle. 86 Version: 2.14.3 TF5100
## Page 87

GST Reference Manual • The return type is LREAL. This function is not overloaded. g ASin g ASin(val:= LREAL) • Returns the arcsine of val in the current angle unit [} 85]. • The return type is LREAL. This function is not overloaded. • The result lies within the interval [-c/4,c/4] where c is the angle of a full circle in the current angle unit. CONSTRAINT: The variable val must reside within the interval [-1,1]. g ACos g ACos(val:= LREAL) • Returns the arccosine of val in the current angle unit [} 85]. • The return type is LREAL. This function is not overloaded. • The result lies within the interval [0,c/2] where c is the angle of a full circle in the current angle unit. CONSTRAINT: The variable val must reside within the interval [-1,1]. g ATan g ATan(val:= LREAL) • Returns the arctangent of val in the current angle unit [} 85]. • The return type is LREAL. This function is not overloaded. • The result lies within the interval [-c/4,c/4] where c is the angle of a full circle in the current angle unit. g ATan2 g ATan2(y:= LREAL, x:= LREAL) • Returns the arctangent of y/x in the current angle unit [} 85]. • The return type is LREAL. This function is not overloaded. • The result lies within the interval [-c/2,c/2] where c is the angle of a full circle in the current angle unit. 5.6.14 Feed Mode feed Mode Set feed Mode Set(feed Mode:= Feed Mode Type) Feed Mode Type Enumeration of the following values: fm Contour fm Internal Radius fm Tool Center Point TF5100 Version: 2.14.3 87
## Page 88

GST Reference Manual fm Contour: Holds the feedrate at the contour constant. fm Internal Radius: Reduces the feedrate at internal radii. This results in a constant velocity at the contour. The velocity at external radii is not increased. fm Tool Center Point: Keeps the feedrate of the tool’s center point constant. This means that at internal radii the velocity at the contour is increased, and that it is correspondingly reduced at external radii. 5.6.15 Feed Interpolation feed Interpolation Set feed Interpolation Set(feed Interpolation:= Feed Interpolation Type) Feed Interpolation Type Feed Interpolation Type Enumeration of the following values: fi Constant fi Linear fi Constant: The programmed velocity is applied as fast as possible with the constant feed interpolation (default). fi Linear: The linear feed interpolation transfers the velocity linearly over the path from v_start to v_end. 5.6.16 Streaming of Large G-Code Files run File run File(path:= string) The size of files that can be executed employing the GST-interpreter is limited. However, sometimes it is required to execute large files that may have been created e.g. by a CAD-program. Therefore, the user has the possibility to execute filestreams of native G-Code. Executes the plain G-Code that is contained in the G-Code file given by path. The function call returns after all lines in the supplied file have been processed. The function is intended for streaming large G-Code files to the NC-kernel efficiently. Native G-Code: No Structured Text Allowed Note that the supplied G-Code file must not contain any ST-elements, but only plain G-Code. A G-Code filestream from file 'my Native GCode File.nc' can be called from a GST-program with the following syntax if the file is in the default directory of the GST interpreter: !runfile('my Native GCode File.nc'); If the file 'my Native GCode File.nc' is located elsewhere, the file path must also be specified, e.g: !runfile('C:\my Gcode Folder\machine1\my Native GCode File.nc'); run File with R parameters and simple arithmetic expressions From the Twin CAT V3.1.4024.40 R parameters and simple arithmetic expressions are allowed with runfile. call Runfile With RParams And Expressions.nc N0 G0 X0 Y0 Z0 N1 G1 X10 F5000 ! R3:=3; ! R5:=5; ! R10:=15; 88 Version: 2.14.3 TF5100
## Page 89

GST Reference Manual !r100:=-1.234; ! R888:=98.123; N2 G1 y={r100} !runfile(Runfile With RParams And Expressions.nc'); M30 Runfile With RParams And Expressions.nc G1 X200 G1 Y150 G1 Z234 M123 G1 z = R888 - r100 - r100 / R10 G1 y=100-r888 G1 x=-R10/r5-r3 q1=20-r3*R5 5.6.17 Vertex Smoothing smoothing Set smoothing Set(main Type:= Smoothing Main Type, sub Type:= Smoothing Sub Type, value:= L Real) Sets the vertex smoothing behavior according to the given parameters. Smoothing Main Type Enumeration of the following values: smoothing None smoothing Parabola smoothing Biquadratic smoothing Bezier3 smoothing Bezier5 smoothing Twin Bezier smoothing None: No smoothing. smoothing Parabola: For parabola smoothing a parabola is inserted geometrically into the segment transition. This ensures a steady velocity transition within the tolerance radius. smoothing Biquadratic: With biquadratic smoothing there is no step change in acceleration in the axis components. With the same radius, a smaller input velocity may therefore be required than for parabolic smoothing. smoothing Bezier3: In case of the 3rd order Bezier curve a step change in acceleration appears in the axis components when the tolerance sphere is entered. The max. size is limited by the acceleration of the axis components and the C1 factor. smoothing Bezier5: With 5th order Bezier blending, no step change in acceleration occurs in the axis components on entry into the tolerance sphere. In other words, the path axis acceleration is always constant if blending is selected. smoothing Twin Bezier: With the aid of smoothing, it is possible to insert a Bezier spline automatically between two geometrical entries. It is only necessary to program the radius of the tolerance sphere. This describes the maximum permissible deviation from the programmed contour in the segment transition. The advantage of this type of smoothing as opposed to rounding with an arc is that there are no step changes in acceleration at the segment transitions. Acute angles at the segment transition The Bezier splines are generated by default, even at very acute angles. In order to avoid the dynamic values being exceeded, a considerable reduction velocity is required in this case. However, since the dynamics are held constant in the spline, the movement across the spline can be quite slow. In this case it is often practical to start the segment transition with an accurate stop. The command Auto Accurate Stop [} 158] can be used to avoid having to calculate the angles manually. TF5100 Version: 2.14.3 89
## Page 90

GST Reference Manual Smoothing Sub Type Enumeration of the following values: smoothing Radius smoothing Distance smoothing Adaptive Example The example visualizes the effect of using a smoothing parabola. In the first two corners smoothing value 10 and in the third corner smoothing value 50 have been used. Finally, the fourth corner exhibits smoothing value 0. N10 G01 X0 Y0 F60000 !smoothing Set(main Type:=smoothing Parabola, sub Type:=smoothing Radius, value:=10); N20 G01 X100 N30 Y200 !smoothing Set(main Type:=smoothing Parabola, sub Type:=smoothing Radius, value:=50); N40 X-100 !smoothing Set(main Type:=smoothing Parabola, sub Type:=smoothing Radius, value:=0); N50 Y0 N60 X0 M02 5.6.17.1 Subtypes Smoothing Radius (subtype 1) If subtype 1 is selected, the maximum tolerance radius (R ) is used for blending. R is reduced if and only if TB TB the input or output segment is less than 3*R . TB 90 Version: 2.14.3 TF5100
## Page 91

GST Reference Manual Smoothing Distance (subtype 2) The distance between the programmed segment transition and the vertex of the parabola is specified with the subtype 2. The tolerance radius (R ) results from this. If a segment is too short, then the distance is TB shortened so that the tolerance radius is a max. of 1/3. Smoothing Adaptive (subtype 3) Within the tolerance radius (including constant tolerance radius) the system ensures that the maximum permissible acceleration is not exceeded. Depending on the deflection angle and the velocity, the maximum axis acceleration within the smoothing segment may be different. The aim of an adaptive tolerance radius is maximum acceleration during smoothing. In order to achieve this, the smoothing radius is reduced based on the programmed velocity and dynamics. In other words, if the programmed velocity is changed, the tolerance radius can also change. The override has no influence on the radius. 5.6.18 Automatic Accurate Stop auto Accurate Stop Set auto Accurate Stop Set(angle:= LREAL); The command auto Accurate Stop Set is used in conjunction with blending (see smoothing Set) and allows driving to acute angles with active blending. A limit angle, up to which an accurate stop between 2 segments must take place, is defined for this in the command auto Accurate Stop Set. !auto Accurate Stop Set(angle:= 30.0); For circle segments, the angle is calculated from the tangents at the points of entry and leaving. Sample N10 G0 X0 Y0 Z0 N20 G01 X10 F20000 N30 G01 X15 Y30 N40 G01 X20 Y0 !smoothing Set(main Type:=smoothing Parabola, sub Type:=smoothing Radius, value:=50); N50 G01 X30 N60 G01 X35 Y30 N70 G01 X40 Y0 TF5100 Version: 2.14.3 91
## Page 92

GST Reference Manual !auto Accurate Stop Set(angle:= 46.0); N80 G01 X50 N90 G01 X55 Y30 N100 G01 X60 Y0 N110 G01 X80 N110 M30 Requirements Development environment Target system Twin CAT V3.1.4024.15 PC or CX (x86 or x64) 5.6.19 Spline Interpolation trans BSpline trans BSpline(Break Angle:=LREAL, Break Length:=LREAL, Merge Diff:=LREAL, Line Break Angle:=LREAL, Line Break Length:=LREAL, Line Merge Diff:=LREAL) trans BSpline generates a continuous curve from a piecewise linear polyline. The curve is bounded by the input polyline, the start and end points are interpolated, interior points are the control points (De Boor points) of the curve. At least three points are required. A BSpline curve exhibits local control and is thereby amenable to control point manipulation. //Enable trans BSpline(Break Angle := 70, Break Length := 1000); //Disable trans BSpline(); Example: !//BSpline N10 G00 X18.498 Y0 !trans BSpline(Break Angle:=70.0, Break Length:=1000.0); N20 G01 X18.498 Y0 Z0 F6000 N30 X16.572 Y6.543 Z1 N40 X15.616 Y9.715 Z2 N50 X15.121 Y11.275 Z3 92 Version: 2.14.3 TF5100
## Page 93

GST Reference Manual N60 X14.838 Y13.196 Z4 N70 X14.982 Y15.085 Z5 N80 X15.595 Y16.485 Z6 N90 X16.396 Y17.490 Z7 N100 X18.653 Y19.243 Z8 N110 X25.07 Y22.526 Z9 N120 X22.228 Y22.997 Z8 N130 X19.569 Y23.174 Z7 N140 X16.488 Y22.884 Z6 N150 X13.634 Y22.228 Z5 N160 X9.533 Y20.793 Z4 N170 X6.668 Y19.009 Z3 N180 X4.224 Y16.877 Z2 N190 X2.376 Y14.61 Z1 N200 X1.068 Y11.959 Z0 ! trans BSpline(); M02 Parameters Break Angle (mandatory): Allows preservation of sharp angle features in the path. The spline will break when the path deviates more than Break Angle. The spline will terminate and interpolate the point. Break Length (mandatory): Allows preservation of long features in the path. The spline will break for segments longer than Break Length. The spline will terminate and interpolate the start and end points of the long segment. Merge Diff (optional): The BSpline is comprised of Bezier segments. To potentially improve processing speed the spline may be compressed by merging. Adjacent segments will be merged together when the difference in control points is less than Merge Diff. Below adjacent segments are merged into one. Excessive curvature Overly aggressive merging can result in excessive contortion and a segment of excessive curvature will be rejected with a run time error. Acceptable curvature is derived from path velocity and acceleration. The BSpline is constructed from a control point polyline formed by G01 segments, eg: CADCAM. To improve processing speed the control point polyline may be compressed or simplified by merging adjacent segments. TF5100 Version: 2.14.3 93
## Page 94

GST Reference Manual Line Break Angle (optional): Merging of adjacent control points will break if the deviation angle exceeds Line Break Angle. Line Break Length (optional): Merging of adjacent control points will break if the length exceeds Line Break Length. Line Merge Diff (optional): Adjacent control points will be merged if the difference (perpendicular distance) is less than Line Merge Diff. In the example N30 may be eliminated, simplifying the control polygon. If the optional parameters aren’t parameterized or if they are 0, no merging will take place. Excessive curvature Overly aggressive merging can result in excessive contortion and a segment of excessive curvature will be rejected with a run time error. Acceptable curvature is derived from path velocity and acceleration. Processing order: If the Break Angle or Break Length are 0. No further processing will take place. Line Break Angle, Line Break Length and Line Merge Diff are processed firstly to simplify the control point polyline. Break Angle Break Length and Merge Diff are processed finally to generate the BSpline curve. Decoder Stops and Handshake M functions: The BSpline should be terminated with !trans BSpline(); prior to either a decoder stop or a M-function type handshake. !//BSpline N10 G00 X18.498 Y0 !trans BSpline(Break Angle:=70.0, Break Length:=1000.0); N20 G01 X18.498 Y0 Z0 F6000 N30 X16.572 Y6.543 Z1 N40 X15.616 Y9.715 Z2 N50 X15.121 Y11.275 Z3 N60 X14.838 Y13.196 Z4 N70 X14.982 Y15.085 Z5 N80 X15.595 Y16.485 Z6 N90 X16.396 Y17.490 Z7 N100 X18.653 Y19.243 Z8 94 Version: 2.14.3 TF5100
## Page 95

GST Reference Manual N110 X25.07 Y22.526 Z9 !trans BSpline(); !sync(); !trans BSpline(Break Angle:=70.0, Break Length:=1000.0); N120 X22.228 Y22.997 Z8 N130 X19.569 Y23.174 Z7 N140 X16.488 Y22.884 Z6 N150 X13.634 Y22.228 Z5 N160 X9.533 Y20.793 Z4 N170 X6.668 Y19.009 Z3 N180 X4.224 Y16.877 Z2 N190 X2.376 Y14.61 Z1 N200 X1.068 Y11.959 Z0 ! trans BSpline(); M02 Compatible G-Codes and functions G-Codes other than G01 are supported. G00 G02, G03 (Circle and Helix): The BSpline will terminate before and continue afterwards. G04 G09, G60 G54 and other transformations disable Mask() run File(path:= ) smoothing Set(main Type:=smoothing Twin Bezier,sub Type:=smoothing Radius,value:= ) Tool Radius Compensation is not supported. Requirements Development Environment Target System Twin CAT V3.1.4024.4 PC or CX (x86 or x64) 5.6.20 Dynamic Override dyn Override Set dyn Override Set(value:= LREAL) Set the dynamic override of axes to the given value. The dynamic override function can be used to implement and evoke percentage changes to the dynamic axis parameters in the axis group while the NC program is running. Thus, these changes result in new values for motion dynamics. Without any stop the new dynamic values become valid when the line is executed. Range of Values The factor value for dyn Override Set has to reside within the range 0 < value ≤ 1.0. Example Within the example the new dynamic values become valid without any stop. In block N010 the previously set values are used for deceleration, while the changed values are used for acceleration in block N020. N010 G01 X100 Y200 F6000 !dyn Override Set(value:= 0.4); N020 G01 X500 M02 Example The command dyn Override Set can be used to reduce acceleration and jerk e.g. only for one movement. In the example acceleration and jerk are reduced by 50 percent merely in block N020. TF5100 Version: 2.14.3 95
## Page 96

GST Reference Manual N010 G01 X100 Y100 F6000 !dyn Override Set(value:= 0.5); N020 X0 !dyn Override Set(value:= 1); N030 X100 M02 5.6.21 Programming reference programming Reference Set programming Reference Set(value:= Reference Type) As an alternative to G90/G91 [} 49], programming Reference Set can be used to set the dimensions of the subsequent movement commands to absolute or relative. programming Reference Get Reference Type := programming Reference Get() The currently active dimension for the movement commands can be read out with programming Reference Get. Reference Type Enumeration of the following values: reference Absolute reference Relative Example programming Ref Get/Set is particularly recommended for functions. At the start of a function, the currently set dimension can be read out with programming Ref Get before it is set to the dimension of the function with G90/G91 or programming Ref Set. At the end of the function, programming Ref Set is used to ensure that the dimension is reset. { FUNCTION Test Function VAR programming Ref : Reference Type; END_VAR programming Ref := programming Reference Get(); programming Reference Set(value:= reference Relative); ! N21 G01 X10 Y-10 ! N22 G01 X10 Y-10 programming Reference Set(value:= programming Ref); END_FUNCTION } N10 G00 X0 Y0 Z0 N20 G01 G90 X100 Y20 F6000 ! Test Function(); N30 G01 X100 Y30 M30 Requirement Twin CAT Twin CAT V3.1.4024.54 96 Version: 2.14.3 TF5100
## Page 97

GST Reference Manual 5.6.22 Center Point Reference of Circles circle Center Reference Set circle Center Reference Set(value:= Reference Type) • Sets the center reference type for circles that are programmed by G02/G03 using a center point, whose definition involves the i,j,k-parameters. • For reference Absolute the center point of the circle is defined by the supplied i,j,k-vector. • For reference Relative the center point is defined by the sum of the circle starting-point and the supplied i,j,k-vector. This is the default and usual behavior of G-Code. circle Center Reference Get Reference Type := circle Center Reference Get() Returns the currently active center point reference for circles. circle Center Reference Get prerequisite Twin CAT Twin CAT V3.1.4024.54 Reference Type Enumeration of the following values: reference Absolute reference Relative . 5.6.23 Change in axis dynamics axis Dynamics Set axis Dynamics Set(axis No:= UDINT, acc:= LREAL, dec:= LREAL, jerk:= LREAL); axis Dynamics Set can be used to change the axis dynamics at runtime. Function axis Dynamics Set Parameter <axis No> Axis in the interpolation group: X: 0 Y: 1 Z: 2 Q1: 3 ... Q5: 7 Parameter <acc> Value of the maximum permitted acceleration in mm/s^2. Parameter <dec> Value of the maximum permitted deceleration in mm/s^2. Parameter <jerk> Value of the maximum permitted jerk in mm/s^3. Example: N10 G01 X100 Y200 F6000 ! R4:=10000; !axis Dynamics Set(axis No:= 0, acc:= 2250, dec:= 2250, jerk:= R4); N30 G01 X500 N40 M02 TF5100 Version: 2.14.3 97
## Page 98

GST Reference Manual Requirements Development Environment Target System Twin CAT V3.1.4024.4 PC or CX (x86 or x64) 5.6.24 Change in path dynamics path Dynamics Set path Dynamics Set(acc:= LREAL, dec:= LREAL, jerk:= LREAL); path Dynamics Set can be used to change the path dynamics at runtime. Function path Dynamics Set Parameter <acc> Value of the maximum permitted acceleration in mm/s^2. Must be set >= 1. If set to 0, the default value is used. Parameter <dec> Value of the maximum permitted deceleration in mm/s^2. Must be set >= 1. If set to 0, the default value is used. Parameter <jerk> Value of the maximum permitted jerk in mm/s^3. Must be set >= 1. If set to 0, the default value is used. Example: N10 G01 X100 Y200 F60000 ! R4:=10000; //Set path dynamics !path Dynamics Set(acc:=200, dec := 200, jerk := R4); N30 G01 X500 Y0 //Set path dynamics back to default values and jerk to 12000 !path Dynamics Set(acc:=0, dec := 0, jerk := 12000); N50 G01 X100 Y200 //Set path dynamics to default values !path Dynamics Set(acc:=0, dec := 0, jerk := 0); N70 G01 X500 Y0 N80 M02 Requirements Development Environment Target System Twin CAT V3.1.4024.12 PC or CX (x86 or x64) 5.7 Transformations Speaking of GST-Transformations we refer e.g. to rotations or to zero-point-shifts. The relation between the MCS (machine coordinate system) and the PCS (program coordinate system) is defined by the effective transformation T. T is the concatenation of the transformations T , T and Z U T (T = T * T * T ). Note that the order of concatenation is significant for the transformations do not T Z U T commute in general. The transformation T represents a (historical) zero offset shift, the transformation T Z U represents a user defined transformation and the transformation T represents a tool transformation. They T are described in detail later. Figure “Transformations Tz Tu Tt” visualizes the relation between the MCS (machine coordinate system) and the PCS (program coordinate system): • T is defined to be a translation by [20,20,0], Z • T is a combination of the translation [30,-10,0], followed by a rotation by 45 degree around the Z- U axis, • T is a translation by [0,-10,0]. T 98 Version: 2.14.3 TF5100
## Page 99

GST Reference Manual Y 30 20 10 T Z T U S C P T MCS T 0 T -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Transformations Tz Tu Tt”. 5.7.1 Modification of the Effective Transformation T and its Effect Most G-Codes define only the destination point of a movement. Therefore, the interpreter maintains the current position of the tool. This point can be represented in MCS (machine coordinate system) coordinates and PCS (program coordinate system) coordinates while the equation Current Point MCS = T * Current Point PCS holds. In contrast to the previous implementation, this transformation equation also holds after a modification of T. This behavior is accomplished by adapting the Current Point PCS. The MCS (machine coordinate system) point is not adapted, as this would affect the machine. This behavior may be summarized roughly as: When the active transformation is changed, the current PCS (program coordinate system) point is adapted in a way that the modification shows no effect. Example: After N10 the coordinates of the current PCS (program coordinate system) and MCS (machine coordinate system) point are [20,10,80], since no transformation is active. The translation changes the current PCS (program coordinate system) point to [28,7,84]. Applying the translation on this point yields the unchanged MCS (machine coordinate system) point [20,10,80]. Hence, the translation shows no effect, although it is active. The block N20 programs a movement to the PCS (program coordinate system) point [25,7,10], which is mapped to the MCS (machine coordinate system) coordinate [17,10,6]. After the invocation of trans Pop() the current PCS (program coordinate system) point is set to the current MCS (machine coordinate system) point. N10 G01 X20 Y10 Z80 F6000 !trans Translate(-8,3,-4); N20 G01 X25 Z10 !trans Pop(); M02 Example: If the user wants the PCS (program coordinate system) point to remain unchanged, he has to retrieve and program it, as shown in the following code. However, the desire for an unchanged PCS (program coordinate system) point typically indicates a bad programming style. Actually, there should be no need for the following code. { VAR pcs X, pcs Y, pcs Z : LREAL; END_VAR // … G-Code … frame Get(x=>pcs X,y=>pcs Y,z=>pcs Z); // … modify transformations … ! G01 x=pcs X y=pcs Y z=pcs Z F6000 } TF5100 Version: 2.14.3 99
## Page 100

GST Reference Manual 5.7.2 Components of the Effective Transformation T Zero Offset Shift T Z The T -transformation is affected by certain G-Codes. It has no effect if G53 is active. Otherwise, T is the Z Z combination of the three translations T , T and one of {T , …, T }. The former two translations are set Z58 Z59 Z54 Z57 via the G-Codes G58 and G59. The latter translation is selected by the G-Codes G54 to G57. One translation is associated with each of these 4 G-Codes. It can be set by the PLC or using the ST-function zero Offset Shift Set. Tool Transformation T T T is defined by the currently selected tool. It has no effect if tool 0 (D0) is selected. Otherwise, it is a T translation by [offset X, offset Y, offset Z] + (length+length Add) * D where D is the normal of the current workingplane. Userdefined Transformation T U T is defined by a stack of transformations. The stack of depth N contains elementary transformations U T , T , …, T where T is the topmost transformation. Initially, the stack is empty. The userdefined U1 U2 U<N> U<N> transformation is the concatenation of these elementary transformations T = T * T * … * T . Note that U U1 U2 U<N> the order is significant for the transformations do not commute in general. If the stack is empty, T is the U identity transformation, which has no transformation effect. 5.7.3 Applying Transformations A transformation is pushed onto the stack by the following ST-functions. The transformation pushed recently will be the topmost transformation on the transformation stack. When a transformation is pushed onto the transformation stack, the stack depth is increased by one and T is adapted accordingly. U trans Translate(x:= LREAL, y:= LREAL, z:= LREAL); (* A rotation pushed onto the stack of transformations is interpreted around the respective axis using the current angle-unit, e.g. degree or radian. *) trans Rot X(angle:= LREAL); trans Rot Y(angle:= LREAL); trans Rot Z(angle:= LREAL); trans Mirror X(); trans Mirror Y(); trans Mirror Z(); trans Scale(factor:= LREAL); 5.7.4 Revoking Transformations The function trans Pop() removes the topmost transformation from the transformation stack. When trans Pop() removes a transformation from the transformation stack, the stack depth is reduced by one and T is adapted accordingly. Commonly, the trans Pop()-function is used to revoke a temporary U transformation. Example: In the following example the translation is applied to N10, N20 and N30. The rotation is only applied to N20 as it is revoked by trans Pop(). Figure “Example Revoking Transformations” shows the resulting MCS (machine coordinate system) path. Note that the rotation center is [20,0,0] in MCS (machine coordinate system), which is the origin in PCS (program coordinate system) after the preceeding translation. !trans Translate(20,0,0); N10 X10 Y0 F6000 !trans Rot Z(90); N20 X20 Y0 !trans Pop(); N30 X30 Y0 !trans Pop(); M02 100 Version: 2.14.3 TF5100
## Page 101

GST Reference Manual Y 30 20 N30 10 N20 0 N10 -10 X -10 0 10 20 30 40 50 60 70 80 90 100 Figure “Example Revoking Transformations”. 5.7.5 Restoration of Stack The function trans Depth() yields the current depth of the stack. The function trans Restore(depth) removes transformations from the stack until the given depth is reached. Typically, the two functions are combined to save and restore the state of the transformation stack. It is good programming style to do this saving and restoring in the context of userdefined ST-functions. Example: Initially, within the following function the depth of the stack is stored in the variable depth. At the end of the function the initial state is restored by trans Restore. Note that restoration only works properly if the stack depth does not fall below depth within the function. Instead of using trans Depth() and trans Restore() the stack depth could also be restored using trans Pop(). However, it may become cumbersome to keep pushing and popping of transformations synchronous, especially if transformations are pushed conditionally. { FUNCTION draw VAR depth : UINT; END_VAR depth := trans Depth(); trans Translate(10,0,0); // … G-Code … trans Rot Z(45); // … G-Code … trans Mirror X(); // … G-Code … trans Restore(depth); END_FUNCTION } 5.8 Error Reporting Efficient development of CNC-programs requires decent support by development tools. This support includes proper reporting of programming errors for both, compile-time errors and runtime errors. An error message should point directly to the source code the error originates from and give a precise description of the circumstances under that the error occured (dynamic data). Such individual error messages help a developer substantially to fix errors in short time. The GST-interpreter yields such error messages, as described in the following texts. TF5100 Version: 2.14.3 101
## Page 102

GST Reference Manual 5.8.1 Error Messages In case of an error the interpreter produces a descriptive error message. An error message consists of a source code coordinate and a description. The source code coordinate links the error to its origin in the GST- program. It defines a range of source code stretching from the first character of the code range to the last character of the code range. Both, first and last character, are defined by their file, line and column. Note that the last character actually points to the first character behind the range, which is a common technical convention. Example: In the following example an integer variable i is declared and initialized. The initialization uses a floatingpoint literal. Since an implicit conversion from floatingpoint to integer is not allowed in ST, the interpreter produces the descriptive error message given below when the program is loaded. The error message does not only report that a type-error has occured, it also gives the precise position: File aaa.nc, line 3, column 14 to 17. This code range displays the literal ‘1.5’. In addition, the programmed type (real) and the expected type (int) are reported. With such a detailed error message bugs can be fixed by the developer easily. { VAR i : int := 1.5; END_VAR } M02 Error message: aaa.nc: 3.14-3.17: Invalid implicit conversion from type '<real literal>' to 'int'. 5.8.2 Compile-Time Errors and Runtime Errors Errors may occur during program loading (so called compile-time errors) or during program execution (so called runtime errors). Fortunately, most errors are detected at compile-time. This detection includes missing files, syntax errors, type errors and unexpected identifiers. The developer gets feedback immediately when he tries to load the program. Thus, a part of unexpected failures during machining is avoided. However, there are also errors that, by their nature, cannot be detected at compile-time. For instance, this circumstance includes a division by zero, since the divisor may be computed dynamically. If a runtime error occurs, the interpreter is stopped safely and an error message is produced. A runtime error message is similar to a compile-time error message. It even includes a reference to the pertinent source code. Example: In the following example the FOR-loop contains a division of 10 by the loop variable i. Since the variable i is iterated from -3 to 3, this program leads to an error during the 4th iteration, when i has the value 0. This error is detected at runtime and stops the interpreter. The error message shown below is reported. It points precisely to the code ‘10/i’ in the example. FILE aaa.nc: { VAR i, j : int; END_VAR FOR i := -3 TO 3 DO j := j + 10/i; END_FOR; } M02 Error message: aaa.nc: 7.12-7.16: Division by zero 102 Version: 2.14.3 TF5100
## Page 103

GST Reference Manual Example: At runtime the interpreter also performs checking of array bounds. Consequently, invalid indices do not result in unpredictable and typically fatal crashes. The runtime error message precisely defines location and origin of the error at ‘idx’, reports the erroneously supplied index (20) and the valid index range (10..19). FILE aaa.nc: { VAR idx : INT; a : ARRAY [10..19] OF INT; END_VAR FOR idx := 10 TO 20 DO a[idx] := i; END_FOR; } M02 Error message: aaa.nc: 8.5-8.8: Out of bounds. 20 exceeds range 10..19. 5.8.3 Errors in G-Code Error reporting is also performed for G-Code. This reporting includes compile-time errors and runtime errors. Runtime error reporting includes invalid use of G-Code, e.g. like a bad definition for a circle. Example: In the following example the value of a string variable str is assigned to the address letter X of the G-Code block. As before the position of the error is precisely identified at ‘=str’ in the code. In addition, the programmed type and the expected type are reported. FILE aaa.nc: { VAR str : string := 'Hello World'; END_VAR } G01 X=str F6000 G01 Y100 M02 Error message: 7.5-7.9: Invalid implicit conversion from type 'string[255]' to 'lreal' Example: In the following example a sequence of circular arcs is processed by a FOR-loop. The radius of the arc is 4. The distance between the starting-point and endpoint of the arc is successively increased within each iteration. During the 9th iteration the distance exceeds the circle diameter of 8. The reported error message identifies the origin G2 X=i*10+i U4 and gives information about the diameter and distance between starting-point and endpoint. FILE aaa.nc: { VAR i : INT; END_VAR ! G00 X0 Y0 Z0 FOR i := 1 TO 10 DO TF5100 Version: 2.14.3 103
## Page 104

GST Reference Manual ! G01 X=i*10 F6000 ! G02 X=i*10+i U4 END_FOR; } M02 Error Message: aaa.nc: 9.4-10.1: Invalid definition of circle. Distance between start-point and end-point (=9.000000) is larger than diameter (=8.000000). 5.8.4 Preprocessing During preprocessing #include-directives are replaced by the contents of the referenced files. Care has been taken to maintain information about the origin of source code properly. Therefore, an error that is caused by code in an included file will refer to that included file and not to the result of preprocessing, as a simple implementation would do. Example: In the following example the file aaa.nc includes the file bbb.nc. In the latter file the variables i and j are used in G-Codes. Variable i is declared at the beginning of aaa.nc, but j is not. Therefore, the error message below is issued. As you can see it references the use of variable j in file bbb.nc properly. FILE aaa.nc: { VAR i : INT; END_VAR } G00 X0 Y0 Z0 #include "bbb.nc" G00 X100 M02 FILE bbb.nc: G01 X=i F6000 G01 Y=j G01 Z100 Error message: bbb.nc: 2.6-2.7: Undeclared variable or enumeration value 'j' 5.9 General Command Overview Preprocessor Com- Description mand #include The #include directive inserts the contents of another file. The included file is referenced by its path. Typically, it is used to “import” commonly used code like e.g. libraries. Its behavior is similar [} 32] to the C-Preprocessor. 104 Version: 2.14.3 TF5100
## Page 105

GST Reference Manual Interpolations Com- Description Modal or Non- Default mand modal G00 Interpolation mode: Linear. Modal. Default. Applying maximum velocity ignoring programmed velocity. [} 38] Reset by G01, G02, G03. G01 Interpolation mode: Linear. Modal. No. Applying programmed velocity. [} 38] Reset by G00, G02, G03. G02 Clockwise interpolation mode: Circular or helical. Modal. No. Applying current velocity. [} 39] Reset by G00, G01, G03. G03 Counterclockwise interpolation mode: Circular or helical. Modal. No. Applying current velocity. [} 39] Reset by G00, G01, G02. G303 With G303 an circular arc (CIP circle) can be programmed, that No can be freely located in space. [} 40] G04 Defines a dwell time, i.e. suspends machining for a given Nonmodal. No. duration. [} 41] Workingplane Selection Com- Description Modal or Non- Default mand modal G17 Selects XY-plane as workingplane. Modal. Default. [} 46] G18 Selects ZX-plane as workingplane. Modal. No. [} 46] G19 Selects YZ-plane as workingplane. Modal. No. [} 46] Delete Distance to go Com- Description Modal or Non- Default mand modal G31 Delete distance to go. Nonmodal. No. [} 42] Deactivation and Activation of Tool Radius Compensation Com- Description Modal or Non- Default mand modal G40 Deactivates Tool Radius Compensation (TRC). With/After a G40 Modal. Default. command it is mandatory to program at least one geometry [} 42] element. G41 Activates Tool Radius Compensation (TRC). Modal. No. Left. [} 42] G42 Activates Tool Radius Compensation (TRC). Modal. No. Right. [} 42] TF5100 Version: 2.14.3 105
## Page 106

GST Reference Manual Set, Deactivate and Activate Zero-Offset-Shift Translations Com- Description Modal or Non- Default mand modal G53 Deactivates any zero-offset-shift translation. Modal. Default. [} 44] G54.. G57 Activates the zero-offset-shift associated with the given G-Code. Modal. No. [} 44] Activates the translation G58 and G59. G58, G59 Sets the translation associated with the given G-Code. Modal. No. [} 44] Command Description zero Offset Shift Sets the translation for G-Code g where g must be one of the numbers 54, 55, 56 or 57. Set(g:= USInt, [} 84] x:= LReal, [} 84] y:= LReal [} 84], z:= LReal) [} 84] Accurate Stop Com- Description Modal or Non- Default mand modal G09 Accurate stop. Nonmodal. No. [} 42] G60 Accurate stop. Modal. No. [} 42] Set Unit for Length and Speed Com- Description Modal or Non- Default mand modal G70 Sets the unit for lengths to inch. Modal. No. Does not affect the unit for velocity. [} 47] G71 Sets the unit for lengths to millimeter. Modal. Default. Does not affect the unit for velocity. [} 47] G700 Sets the unit for lengths to inch. Modal. No. Also applies to the interpretation of velocity. [} 47] G710 Sets the unit for lengths to millimeter. Modal. Default. Also applies to the interpretation of velocity. [} 47] Switch to Absolute or Relative Coordinates Com- Description Modal or Non- Default mand modal G90 Switches to absolute programming. Modal. Default. [} 49] G91 Switches to incremental programming. Modal. No. [} 49] 106 Version: 2.14.3 TF5100
## Page 107

GST Reference Manual IJK Com- Description Modal or Non- Default mand modal I<vx> Center point is current Point + [vx,vy,vz]. Modal. Default: Center J<vy> Current length unit is used for vx,vy,vz. point is I used by G4 defines a duration. current Poin K<vz> t + [0,0,0]. [} 39] The IJK- parameters are optional. M-Functions Com- Description mand M<v> Triggers the M-function v. [} 50] The timing behavior depends on the definition of v in the development environment of Twin CAT. There must not be more than one M-function of type handshake in a block. M2 Predefined M-function. Signals program end. M30 Predefined M-function. Signals program end. Tool Orientation Com- Description Modal or Non- Default mand modal P<v> Switches tool orientation. Modal. No. [} 46] Set Block Number Com- Description mand N<v> Block number. [} 53] Set Radius Com- Description Modal or Non- Default mand modal U<v> Sets the radius within the context of G02 or G03 to |v|. Modal. No. [} 39] Set Cartesian Coordinate Com- Description mand X<v> Sets the X-coordinate of the next point to v. [} 53] Uses current length unit for v. Y<v> Sets the Y-coordinate of the next point to v. [} 53] Uses current length unit for v. Z<v> Sets the Z-coordinate of the next point to v. [} 53] Uses current length unit for v. TF5100 Version: 2.14.3 107
## Page 108

GST Reference Manual Auxiliary Axes Com- Description Modal or Non- Default mand modal Q<i>=<v Sets label for auxiliary axis. Modal. No. > [} 53] Set Orientation Angle Com- Description Modal or Non- Default mand modal A<v> Sets the A-angle of the next orientation to v. Nonmodal, but No. [} 53] Uses current length unit for v. may influence succeeding blocks. B<v> Sets the B-angle of the next orientation to v. Nonmodal, but No. [} 53] Uses current length unit for v. may influence succeeding blocks. C<v> Sets the C-angle of the next orientation to v. Nonmodal, but No. [} 53] Uses current length unit for v. may influence succeeding blocks. Control Structures Command Description IF-THEN-ELSIF-ELSE Conditional statement. [} 60] CASE OF [} 60] Conditional statement. FOR [} 60] Counter-controlled loop. WHILE [} 60] Head-controlled loop. REPEAT [} 60] Foot-controlled loop. EXIT [} 60] Leaving a loop. Jump statement Command Description LABEL-GOTO [} 61] Jump statement. Trigonometric Command Description SIN(x) [} 63] Returns the sine of x; x in radians. COS(x) [} 63] Returns the cosine of x; x in radians. TAN(x) [} 63] Returns the tangent of x; x in radians. ASIN(x) [} 63] Returns the arc sine of x; x in radians. ACOS(x) [} 63] Returns the arc cosine of x; x in radians. ATAN(x) [} 63] Returns the arc tangent of x; x in radians. ATAN2(y, x) [} 63] Returns the arc tangent of y/x; y/x in radians. 108 Version: 2.14.3 TF5100
## Page 109

GST Reference Manual Arithmetic Command Description ABS(x) [} 63] Returns the absolute value of x. SQRT(x) [} 63] Returns the square root of x. LN(x) [} 63] Returns the natural logarithm of x. LOG(x) [} 63] Returns the decimal logarithm of x. EXP(x) [} 63] Returns e raised to the power of x. ADD(x1, x2, …) [} 63] Returns the sum of all parameters. MUL(x1, x2, …) [} 63] Returns the product of all parameters. SUB(x, y) [} 63] Returns the difference x-y. DIV(x, y) [} 63] Returns the quotient x/y. MOD(x, y) [} 63] Returns the remainder of the integer division x/y. EXPT(x, y) [} 63] Returns x raised to the power of y. Arithmetic Parameters Command Description r Set(index := LINT, Assigns an R-parameter value. value := LREAL) [} 51] r Get(index := LINT) Extracts an R-parameter value. [} 51] Bit Shift and Bit Rotation Command Description SHL(x, y) [} 66] Returns the bitstring x shifted left by y bits. SHR(x, y) [} 66] Returns the bitstring x shifted right by y bits. ROL(x, y) [} 66] Returns the bitstring x rotated left by y bits. ROR(x, y) [} 66] Returns the bitstring x rotated right by y bits. Logical Operations Command Description AND(x1, x2, …) [} 67] Returns the bitwise Logical And of all parameters. OR(x1, y2, …) [} 67] Returns the bitwise Logical Or of all parameters. XOR(x1, x2, …) [} 67] Returns the bitwise Logical Exclusive Or of all parameters. NOT(x) [} 67] Returns the bitwise complement of x. Selection (Conditional Expressions) Command Description SEL(cond, x1, x2) Returns x1 if cond is FALSE, and x2 otherwise. [} 68] MUX(select, x0, x1, … Returns x<select>. , x N) [} 68] TF5100 Version: 2.14.3 109
## Page 110

GST Reference Manual Min, Max and Limit Command Description MAX(x1, x2, …) [} 68] Returns the maximum of all parameters. MIN(x1, x2, …) [} 68] Returns the minimum of all parameters. LIMIT(min, in, max) Returns in if it lies in the interval [min,max]. Otherwise, the violated bound (min or [} 68] max) is returned. Comparison Command Description GT(x, y) [} 69] Returns TRUE if x is larger than y. GE(x, y) [} 69] Returns TRUE if x is not smaller than y. EQ(x, y) [} 69] Returns TRUE if x and y are equal. LE(x, y) [} 69] Returns TRUE if x is not larger than y. LT(x, y) [} 69] Returns TRUE if x is smaller than y. NE(x, y) [} 69] Returns TRUE if x and y are not equal. Strings and Messages Command Description to String(<arg0>, …, <arg N>): S Converts and concatenates the given arguments to one string. TRING [} 70] msg(str:= String[81]) [} 70] Sends the given message to the message list of Twin CAT. Transformations Command Description trans Rot X(angle:= LReal) [} 71] Rotation around the respective axis by the given angle in the user-defined angle unit. trans Rot Y(angle:= LReal) [} 71] trans Rot Z(angle:= LReal) [} 71] trans Rot A(x:= LReal [} 71], Rotate around vector [x,y,z] by the given angle. y:= LReal, [} 71] z:= LReal [} 71], angle:= LReal) [} 71] trans Mirror X() [} 71] Mirror with respect to the X-direction, Y-direction or Z-direction relative to trans Mirror Y() [} 71] the origin of the current PCS. trans Mirror Z() [} 71] trans Scale(factor:= LReal) [} 71] Scales the coordinate system by the factor in the X-dimension, Y- dimension and Z-dimension. trans Scale Axis(axis No := Scales the selected path axis (axis No) by the factor. axis Index, factor := value) [} 71] trans Translate(x:= LReal, [} 71] Translate by vector [x,y,z]. y:= LReal, [} 71] z:= LReal) [} 71] trans Pop() [} 71] Pops a transformation from the stack of transformations. trans Depth(): UInt [} 71] Yields the depth of the stack of transformations, i.e. the number of active transformations. trans Restore(depth:= UInt) Reduces the stack of transformations to the given depth. [} 71] 110 Version: 2.14.3 TF5100
## Page 111

GST Reference Manual Movement Command Description move Circle3d(cx:= LReal, [} 77] Move circular by rotating around the center cx,cy,cz and the normal cy:= LReal, [} 77] vector nx,ny,nz by the given angle. If height is nonzero, a helix is described. The rotation is performed according to the right hand rule. cz:= LReal, [} 77] nx:= LReal [} 77], ny:= LReal [} 77], nz:= LReal [} 77], angle:= LReal [} 77], height:= LReal) [} 77] Centerpoint Correction Command Description centerpoint Correction Set(on:= Activates the centerpoint correction for circles. Used for circles that are defined by centerpoint programming. bool) [} 78] centerpoint Correction Limit Set(li Sets the precision limit for the centerpoint of circles. mit:= LReal) [} 78] Tools Command Description tool Param Set(tidx:= USInt, Set a parameter of the tool tidx (1..255) to val. The parameter is [} 78] identified by col (0..15). col:= USInt [} 78], val:= LReal) [} 78] tool Param(tidx:= USInt [} 78], Yields the given tool parameter. col:= USInt): LReal [} 78] tool Set(index:= USInt [} 78], Set all parameters of a tool. nr:= Int [} 78], tooltype:= Tool Type, [} 78] length:= LReal [} 78], radius:= LReal, [} 78] length Add:= LReal, [} 78] radius Add:= LReal [} 78], offset X:= LReal [} 78], offset Y:= LReal [} 78], offset Z:= LReal) [} 78] Tool Type [} 78] Enumeration of tool types. Tool Radius Compensation Command Description trc Approach Depart Set(approac Configures the approach and depart behavior to use an arc of given radius and angle. h Radius:= LReal [} 82], approach Angle:= LReal [} 82], depart Radius:= LReal, [} 82] depart Angle:= LReal) [} 82] trc Offset Set(offset:= LReal) Configures the amount of segment extension that is used to close gaps. [} 82] trc Limit Set(offset:= LReal) [} 82] Configures the lookahead that is used for collision elimination. trc Param(): Trc Param Type [} 82] Returns the current configuration as a structure value. TF5100 Version: 2.14.3 111
## Page 112

GST Reference Manual Command Description trc Param Set(param:= Trc Param Configures the tool radius compensation. Summarizes trc Approach Depart Set, trc Offset Set and trc Limit Set. Type) [} 82] Trc Param Type [} 82] Structure containing all configuration parameters of the tool radius compensation. collision Elimination(nx:= LReal Activates collision elimination with respect to the plane of the normal vector nx, ny, nz. [} 82], ny:= LReal, [} 82] nz:= LReal [} 82], limit:= ULInt) [} 82] collision Elimination Flush() To ignore conflicts between the path preceding the call and the path succeeding the call. [} 82] Com- Description Modal or Non- Default mand modal G40 Deactivates Tool Radius Compensation (TRC). Modal. Default. [} 42] G41 Activates Tool Radius Compensation (TRC). Left. Modal. No. [} 42] G42 Activates Tool Radius Compensation (TRC). Right. Modal. No. [} 42] Synchronization Command Description sync() [} 80] Synchronizes the interpreter with the associated NC-channel. wait() [} 80] Waits for a Go Ahead-signal from the PLC. Query of Axes Command Description query Axes() [} 81] Set the MCS coordinates of the interpreter to the actual coordinates of the physical axes. Current Point Command Description frame Get(x:= LReal [} 82], Store the current frame of the PCS in x, y, z and a, b, c. y:= LReal [} 82], z:= LReal [} 82], a:= LReal [} 82], b:= LReal [} 82], c:= LReal) [} 82] q Axis Get(q1:= LReal, [} 82] Store the current values of Q-axes q1 to q5. q2:= LReal [} 82], q3:= LReal, [} 82] q4:= LReal, [} 82] q5:= LReal) [} 82] Suppression of G-Code Blocks Command Description disable Mask():= LWord [} 83] Yields the current value of the disable mask. 112 Version: 2.14.3 TF5100
## Page 113

GST Reference Manual Command Description disable Mask Set(mask:= LWord) Sets the internal disable mask to the given value. [} 83] Units Command Description unit Angle Set(unit Angle:= Unit A Set the unit for angles to unit Angle. ngle) [} 85] Unit Angle [} 85] Enumeration of unit angles. unit Length Set(unit Length:= Uni Set the unit for lengths to unit Length. t Length) [} 85] Unit Length [} 85] Enumeration of unit lengths. unit Time Set(unit Time:= Unit Tim Set the unit for time to unit Time. e) [} 85] Unit Time [} 85] Enumeration of unit times. unit Velocity Set(unit Length:= Un Set the unit for velocity to unit Length/unit Time. it Length, [} 85] unit Time:= Unit Time) [} 85] Trigonometric (Unit Aware) Command Description g Sin(angle:= LReal) [} 86] Returns the sine of the given angle where the current angle unit is used to interpret the angle. g Cos(angle:= LReal) [} 86] Returns the cosine of the given angle where the current angle unit is used to interpret the angle. g Tan(angle:= LReal) [} 86] Returns the tangent of the given angle where the current angle unit is used to interpret the angle. g ASin(val:= LReal) [} 86] Returns the arc sine of val in the current angle unit. g ACos(val:= LReal) [} 86] Returns the arc cosine of val in the current angle unit. g ATan(val:= LReal) [} 86] Returns the arc tangent of val in the current angle unit. g ATan2(y:= LReal, x:= LReal) Returns the arc tangent of y/x in the current angle unit. [} 86] Feed Mode Command Description feed Mode Set(feed Mode:= Feed Set the feed mode. Mode Type) [} 87] Feed Mode Type [} 87] Enumeration of feed mode types. Feed Interpolation Command Description feed Interpolation Set(feed Interp Set feed interpolation. olation:= Feed Interpolation Typ e) [} 88] Feed Interpolation Type [} 88] Enumeration of feed interpolation types. TF5100 Version: 2.14.3 113
## Page 114

GST Reference Manual Streaming of Large G-Code Files Command Description run File(path:= string) [} 88] Executes the plain G-Code that is contained in the G-Code file given by path. Vertex Smoothing Command Description smoothing Set [} 89] Set the vertex smoothing behavior. (main Type:= Smoothing Main Ty pe [} 89], sub Type:= Smoothing Sub Type [} 89], value:= LReal) [} 89] Smoothing Main Type [} 89] Enumeration of smoothing main types. Smoothing Sub Type [} 89] Enumeration of smoothing sub types. auto Accurate Stop Set [} 91] Automatic accurate stop. Dynamic Override Command Description dyn Override Set(value:= LReal) Set the dynamic override of axes to the given value. [} 95] Programming reference Command Description programming Reference Set As an alternative to G90/G91, programming Reference Set can be used [} 96] to set the dimensions of the subsequent movement commands to absolute or relative. programming Reference Get The currently active dimension for the movement commands can be read out with programming Reference Get. [} 96] Reference Type [} 96] Enumeration of reference types. Center Point Reference of Circles Command Description circle Center Reference Set(value: Sets the center reference type for circles that are programmed by G02/ = Reference Type) [} 97] G03. Reference Type [} 97] Enumeration of reference types. Dynamics Set Command Description axis Dynamics Set [} 97] Change in axis dynamics. path Dynamics Set [} 98] Change in path dynamics. Spline Interpolation Command Description trans BSpline [} 92] Spline interpolation. 114 Version: 2.14.3 TF5100
## Page 115

GST Reference Manual 5.10 Comparative Command Overview Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter ANG [} 147] Nonmodal. Contour line programming (angle). Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter Calc Inv Rot Nonmodal. Calculates the inverse rotation of a vector. [} 148] Calc Rot [} 148] Nonmodal. Calculates the rotation of a vector. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter CDOF [} 192] collision Elimina Modal. Bottleneck detection off. tion [} 82] Supplying a zero vector. CDON [} 192] collision Elimina Modal. Bottleneck detection on. tion [} 82] Supplying a nonzero vector. collision Elimina This function can be called during active collision elimination to ignore any conflicts between the path tion Flush [} 82] preceding the call and the path succeeding the call. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter CFC [} 191] feed Mode Set(f Modal. Constant velocity at the contour. eed Mode:= Fe ed Mode Type) [} 87] CFIN [} 191] feed Mode Set(f Modal. Constant velocity in the interior circle. eed Mode:= Fe ed Mode Type) [} 87] CFTCP [} 191] feed Mode Set(f Modal. Constant velocity of the tool center point. eed Mode:= Fe ed Mode Type) [} 87] Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter CIP [} 138] G303 [} 40] An circular arc (CIP circle) can be programmed, that can be freely located in space. move Circle3D Nonmodal. Circular interpolation. Move circular by rotating around the center cx,cy,cz and the normal vector nx,ny,nz by the [} 77] given angle. TF5100 Version: 2.14.3 115
## Page 116

GST Reference Manual Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter CPCOF [} 138] centerpoint Cor Modal. Center point correction off. rection Set [} 77] CPCON [} 138] centerpoint Cor Modal. Center point correction on. rection Set [} 77] Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter Del DTG [} 159] G31 [} 42] Nonmodal. Delete distance to go. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter DYNOVR dyn Override Set Modal. Dynamic override. [} 175] [} 95] Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter FCONST feed Interpolati Modal. Constant feed programming. [} 141] on Set(feed Inter polation:= fi Co nstant) [} 88] FLIN [} 141] feed Interpolati Modal. Linear feed programming. on Set(feed Inter polation:= fi Lin ear) [} 88] Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter G00 [} 136] G00 [} 38] Modal. Rapid traverse. G01 [} 137] G01 [} 38] Modal. Straight line interpolation. G02 [} 138] G02 [} 39] Modal. Clockwise circular interpolation. G03 [} 138] G03 [} 39] Modal. Counterclockwise circular interpolation. G04 [} 141] G04 [} 41] Nonmodal. Dwell time. G09 [} 141] G09 [} 42] Nonmodal. Accurate stop. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter G17 [} 130] G17 [} 46] Modal. Plane selection XY. G18 [} 130] G18 [} 46] Modal. Plane selection ZX. G19 [} 130] G19 [} 46] Modal. Plane selection YZ. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter G40 [} 186] G40 [} 42] Modal. No miller/ cutter radius compensation. 116 Version: 2.14.3 TF5100
## Page 117

GST Reference Manual Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter G41 [} 186] G41 [} 42] Modal. Miller/ cutter radius compensation left. G42 [} 186] G42 [} 42] Modal. Miller/ cutter radius compensation right. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter G53 [} 142] G53 [} 44] Modal. Zero shift suppression. G54 [} 142] G54 [} 44] Modal. 1st adjustable zero offset shift. G55 [} 142] G55 [} 44] Modal. 2nd adjustable zero offset shift. G56 [} 142] G56 [} 44] Modal. 3rd adjustable zero offset shift. G57 [} 142] G57 [} 44] Modal. 4th adjustable zero offset shift. G58 [} 142] G58 [} 44] Modal. 1st programmable zero offset shift. G59 [} 142] G59 [} 44] Modal. 2nd programmable zero offset shift. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter G60 [} 141] G60 [} 42] Modal. Accurate stop. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter G70 [} 131] G70 [} 47] Modal. Dimensions in inch. G71 [} 131] G71 [} 47] Modal. Dimensions metric. G74 [} 136] Nonmodal. Programmed traverse to reference point. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter G90 [} 129] G90 [} 49] Modal. Reference dimension notation. G91 [} 129] G91 [} 49] Modal. Incremental dimension notation. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter G700 [} 131] G700 [} 47] Modal. Dimensions in inches with calculation of the feed. G710 [} 131] G710 [} 47] Modal. Dimensions metric with calculation of the feed. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter MOD [} 159] Nonmodal. Modulo movement. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter MSG [} 180] msg [} 70] Nonmodal. Message from the NC program. TF5100 Version: 2.14.3 117
## Page 118

GST Reference Manual Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter NORM [} 191] Nonmodal. Orthogonal approach off the contour and orthogonal departure from the contour. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter P+ [} 130] P<1> [} 53] Modal. Feed direction positive. P- [} 130] P<-1> [} 53] Modal. Feed direction negative. param Auto Acc auto Accurate St Modal. Automatic accurate stop. urate Stop op Set [} 91] param Axis Dyna axis Dynamics S Modal. Parameterization of the axis dynamics. mics [} 175] et [} 97] param C1Reduc Modal. C1 reduction factor. tion Factor [} 176] param C2Reduc Modal. C2 reduction factor. tion Factor [} 176] param Circular S Modal. Circular smoothing. moothing [} 157] param Dev Angl Modal. C0 reduction - deflection angle. e [} 176] param Group Ve Modal. Circular smoothing (old). rtex [} 157] param Group Dy Modal. Path dynamics (old). namic [} 175] param Path Dyn path Dynamics S Modal. Path dynamics. amics [} 175] et [} 98] param Radius Pr Modal. Circular accuracy. ec [} 139] param Spline S smoothing Set Modal. Vertex smoothing. NC: Smoothing with Bezier Splines. moothing [} 89] [} 155] param Vertex S smoothing Set Modal. Smoothing of segment transitions. moothing [} 89] [} 152] trans BSpline Modal. Spline interpolation. [} 92] param Velo Jum Modal. C0 reduction - maximum step change in velocity. p [} 176] param Velo Min Modal. Minimum velocity. [} 178] param Zero Shift zero Offset Shift Modal. Parameterization of the configurable zero shift. [} 142] Set [} 84] Path Axes Pos frame Get, Nonmodal. Reads the actual position. [} 178] [} 82] q Axis Get [} 82] 118 Version: 2.14.3 TF5100
## Page 119

GST Reference Manual Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter Zero Shift Inc Off Modal. Zero shift is not applied under G91. [} 142] Zero Shift Inc On Modal. Zero shift is applied under G91. [} 142] Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter AROT [} 148] trans Rot A Modal. Rotation additive. [} 71] ROT [} 148] trans Rot X, Modal. Absolute rotation. trans Rot Y, trans Rot Z [} 71] Rot Ex Off Modal. Extended rotation function off. [} 148] Rot Ex On Modal. Extended rotation function on. [} 148] Rot Vec [} 148] Nonmodal. Calculation routine for rotating a vector. RTo Dword Get B Modal. Converts an R-parameter to DWord and checks whether a it [} 134] defined bit is set. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter Mirror [} 151] trans Mirror X, Modal. Mirroring the coordinate system. trans Mirror Y, trans Mirror Z [} 71] trans Scale Modal. Scales the coordinate system by the factor in the X- [} 71] dimension, Y-dimension and Z-dimension. trans Scale Axis Modal. Scales the selected path axis (axis No) by the factor. [} 71] trans Depth Nonmodal. Yields the depth of the stack of transformations. [} 71] trans Restore Modal. Reduces the stack of transformations to the given depth. [} 71] trans Pop [} 71] Modal. Pops a transformation from the stack of transformations. Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter r Param [} 134] r Set(index := Nonmodal. Assigning a Value to an R-Parameter. LINT, value := LREAL [} 51]) r Param [} 134] r Get(index := Nonmodal. Reading an R-Parameter Value. LINT) [} 51] TF5100 Version: 2.14.3 119
## Page 120

GST Reference Manual Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter SEG [} 147] Nonmodal. Contour line programming (segment length). skip Modal. Skip virtual movements. Virtual Moveme nts [} 179] Command Command Modal or Non- Description Classic In- GST Inter- modal terpreter preter Tool Offset Inc O Modal. Cartesian tool displacement and length compensation is not applied under G91. ff [} 183] Tool Offset Inc O Modal. Cartesian tool displacement and length compensation is applied under G91. n [} 183] Tool Param tool Param Set Modal. Set a tool parameter. NC: Writing and reading of tool [} 180] [} 78] parameters. Tool Param tool Param Modal. Yields the given tool parameter. NC: Writing and reading of [} 180] [} 78] tool parameters. Tool Param tool Set [} 78] Modal. Set all parameters of a tool. NC: Writing and reading of tool [} 180] parameters. TPM [} 145] Nonmodal. Target position monitoring. Command Clas- Command GST In- Description sic Interpreter terpreter trc Approach Depart S Configures the approach and depart behavior to use an arc of given radius and angle. et [} 82] trc Offset Set [} 82] Configures the amount of segment extension that is used to close gaps. trc Limit Set [} 82] Configures the lookahead that is used for collision avoidance. trc Param [} 82] Returns the current configuration as a structure value. trc Param Set [} 82] Configures the tool radius compensation. trc Param Type [} 82] This structure contains all configuration parameters of the tool radius compensation. Command Clas- Command GST In- Description sic Interpreter terpreter query Axes [} 81] Set the MCS (machine coordinate system) coordinates of the interpreter to the actual coordinates of the physical axes. Command Clas- Command GST In- Description sic Interpreter terpreter disable Mask [} 83] Yields the current value of the disable mask. Block Skipping disable Mask Set Sets the internal disable mask to the given value. [} 127] [} 83] / Command Clas- Command GST In- Description sic Interpreter terpreter L [} 173] Userdefined Call of a subroutine. Functions [} 62] #include [} 32] Directive inserts the contents of another file. Typically, it is used to “import” commonly used code like e.g. libraries. 120 Version: 2.14.3 TF5100
## Page 121

GST Reference Manual Command Clas- Command GST In- Description sic Interpreter terpreter run File [} 88] Streaming of large G-Code files. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @40 [} 134] @40 Kn Rn Rm … Save register on the stack. @41 [} 134] @41 Rn Rm Save register on the stack. @42 [} 134] @42 Kn … Rm Rn Restore register from stack. @43 [} 134] @43 Rm Rn Restore register from stack. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @100 [} 170] @100 K±n @100 Rm Jump statement Unconditional jump. [} 61] Command Clas- Versions Command GST In- Description sic Interpreter terpreter @111 [} 170] @111 Rn K/Rn Km … CASE OF Case block. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @121 [} 170] @121 Rn K/Rn Kn IF-THEN-ELSIF- Jump if unequal. ELSE;CASE OF [} 60]; GOTO [} 61] @122 [} 170] @122 Rn K/Rn Kn IF-THEN-ELSIF- Jump if equal. ELSE;CASE OF [} 60]; GOTO [} 61] @123 [} 170] @123 Rn K/Rn Kn IF-THEN-ELSIF- Jump if less or equal. ELSE;CASE OF [} 60]; GOTO [} 61] @124 [} 170] @124 Rn K/Rn Kn IF-THEN-ELSIF- Jump if less. ELSE;CASE OF [} 60]; GOTO [} 61] @125 [} 170] @125 Rn K/Rn Kn IF-THEN-ELSIF- Jump if greater or equal. ELSE;CASE OF [} 60]; GOTO [} 61] @126 [} 170] @126 Rn K/Rn Kn IF-THEN-ELSIF- Jump if greater. ELSE;CASE OF [} 60]; GOTO [} 61] Command Clas- Versions Command GST In- Description sic Interpreter terpreter @131 [} 172] @131 Rn K/Rn Kn WHILE [} 60] Loop while equal. @132 [} 172] @132 Rn K/Rn Kn WHILE [} 60] Loop while unequal. @133 [} 172] @133 Rn K/Rn Kn WHILE [} 60] Loop while greater. @134 [} 172] @134 Rn K/Rn Kn WHILE [} 60] Loop while greater or equal. @135 [} 172] @135 Rn K/Rn Kn WHILE [} 60] Loop while less. @136 [} 172] @136 Rn K/Rn Kn WHILE [} 60] Loop while less or equal. TF5100 Version: 2.14.3 121
## Page 122

GST Reference Manual Command Clas- Versions Command GST In- Description sic Interpreter terpreter @141 [} 172] @141 Rn K/Rn Kn REPEAT [} 60] Repeat until equal. @142 [} 172] @142 Rn K/Rn Kn REPEAT [} 60] Repeat until unequal. @143 [} 172] @143 Rn K/Rn Kn REPEAT [} 60] Repeat until greater. @144 [} 172] @144 Rn K/Rn Kn REPEAT [} 60] Repeat until greater or equal. @145 [} 172] @145 Rn K/Rn Kn REPEAT [} 60] Repeat until less. @146 [} 172] @146 Rn K/Rn Kn REPEAT [} 60] Repeat until less or equal. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @151 [} 172] @151 Rn K/Rn Kn FOR [} 60] FOR_TO loop. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @161 [} 172] @161 Rn K/Rn Kn FOR [} 60] FOR_DOWNTO loop. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @200 @200 Rn Delete a variable. @202 @202 Rn Rm Swap two variables. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @302 @302 K/R/Pn K/R/Pn R/Pn Read machine data bit. @361 [} 178] @361 Rn Km Read machine-related actual axis value. @372 @372 Rn Extract the NC-Channel-ID and store it in a variable. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @402 [} 138] @402 K/R/Pn K/R/Pn K/R/ circle Center Referenc Write machine data bit. Pn e Set [} 97] circle Center Referenc Returns the current center point reference for circles. e Get [} 97] Command Clas- Versions Command GST In- Description sic Interpreter terpreter @610 @610 Rn Rn ABS [} 63] Find the absolute value of a variable. @613 @613 Rn Rn SQRT [} 63] Find the square root of a variable. @614 @614 Rn Rm Rm SQRT(a^2 + b^2) Find the square root of the sum of the squares of two variables ! x := sqrt(a^2 + b^2);. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @620 [} 172] @620 Rn !var := var+1; Increment variable. @621 @621 Rn !var := var-1; Decrement variable. @622 @622 Rn Find integer part of a variable. 122 Version: 2.14.3 TF5100
## Page 123

GST Reference Manual Command Clas- Versions Command GST In- Description sic Interpreter terpreter @630 [} 134] @630 Rn Rm SIN [} 63] Find the sine of a variable. @630 [} 134] @630 Rn Rm g Sin [} 86] Find the sine of a variable. @631 [} 134] @631 Rn Rm COS [} 63] Find the cosine of a variable. @631 [} 134] @631 Rn Rm g Cos [} 86] Find the cosine of a variable. @632 [} 134] @632 Rn Rm TAN [} 63] Find the tangent of a variable. @632 [} 134] @632 Rn Rm g Tan [} 86] Find the tangent of a variable. @633 [} 134] @633 Rn Rm Find the cotangent of a variable. @634 [} 134] @634 Rn Rm ASIN [} 63] Find the arc sine of a variable. @634 [} 134] @634 Rn Rm g ASin [} 86] Find the arc sine of a variable. @635 [} 134] @635 Rn Rm ACOS [} 63] Find the arc cosine of a variable. @635 [} 134] @635 Rn Rm g ACos [} 86] Find the arc cosine of a variable. @636 [} 134] @636 Rn Rm g ATan [} 86] Find the arc tangent of a variable. g ATan2 [} 86] Returns the arc tangent of y/x. Command Clas- Versions Command GST In- Description sic Interpreter terpreter @714 [} 169] @714 sync() [} 80] Decoder stop. @716 [} 169] @716 A combination Decoder stop with rescan of the of sync() axis positions. [} 80]and query Axes( ) [} 81] replaces the former @716- command. @717 [} 169] @717 wait() [} 80] Decoder stop with external trigger event. Command Clas- Command GST In- Description sic Interpreter terpreter LN(x) [} 63] Returns the natural logarithm of x. LOG(x) [} 63] Returns the decimal logarithm of x. EXP(x) [} 63] Returns e raised to the power of x. ADD(x1, x2, …) [} 63] Returns the sum of all parameters. MUL(x1, x2, …) [} 63] Returns the product of all parameters. SUB(x, y) [} 63] Returns the difference x-y. DIV(x, y) [} 63] Returns the quotient x/y. MOD(x, y) [} 63] Returns the remainder of the integer division x/y. EXPT(x, y) [} 63] Returns x raised to the power of y. Command Clas- Command GST In- Description sic Interpreter terpreter GT(x, y) [} 69] Returns TRUE if x is larger than y. GE(x, y) [} 69] Returns TRUE if x is not smaller than y. EQ(x, y) [} 69] Returns TRUE if x and y are equal. LE(x, y) [} 69] Returns TRUE if x is not larger than y. LT(x, y) [} 69] Returns TRUE if x is smaller than y. TF5100 Version: 2.14.3 123
## Page 124

GST Reference Manual Command Clas- Command GST In- Description sic Interpreter terpreter NE(x, y) [} 69] Returns TRUE if x and y are not equal. Command Clas- Command GST In- Description sic Interpreter terpreter <native Type>_to_<n Explicit conversion between the given native types. ative Type>(x), [} 63] to_<native Type>(x) [} 63] Logical Operations Command Clas- Command GST In- Description sic Interpreter terpreter AND(x1, x2, …) [} 67] Returns the bitwise Logical And of all parameters. OR(x1, y2, …) [} 67] Returns the bitwise Logical Or of all parameters. XOR(x1, x2, …) [} 67] Returns the bitwise Logical Exclusive Or of all parameters. NOT(x) [} 67] Returns the bitwise complement of x. Min, Max and Limit Command Clas- Command GST In- Description sic Interpreter terpreter MAX(x1, x2, …) [} 68] Returns the maximum of all parameters. MIN(x1, x2, …) [} 68] Returns the minimum of all parameters. LIMIT(min, in, max Returns in if it lies in the interval [min,max]. Otherwise, the [} 68]) violated bound (min or max) is returned. Rotation Command Clas- Command GST In- Description sic Interpreter terpreter ROL(x, y) [} 66] Returns the bitstring x rotated left by y bits. ROR(x, y) [} 66] Returns the bitstring x rotated right by y bits. Selection (Conditional Expressions) Command Clas- Command GST In- Description sic Interpreter terpreter SEL(cond, x1, x2) Returns x1 if cond is FALSE, and x2 otherwise. [} 68] MUX(select, x0, x1, … Returns x<select>. , x N) [} 68] Shift Command Clas- Command GST In- Description sic Interpreter terpreter SHL(x, y) [} 66] Returns the bitstring x shifted left by y bits. SHR(x, y) [} 66] Returns the bitstring x shifted right by y bits. 124 Version: 2.14.3 TF5100
## Page 125

GST Reference Manual Units Command Clas- Command GST In- Description sic Interpreter terpreter unit Angle Set(unit An Set the unit for angles to unit Angle. gle:= Unit Angle [} 85]) Unit Angle [} 85] Enumeration of unit angles. unit Length Set(unit Le Set the unit for lengths to unit Length. ngth:= Unit Length) [} 85] Unit Length [} 85] Enumeration of unit lengths. unit Time Set(unit Tim Set the unit for time to unit Time. e:= Unit Time) [} 85] Unit Time [} 85] Enumeration of unit times. unit Velocity Set(unit L Set the unit for velocity to unit Length/unit Time. ength:= Unit Length, unit Time:= Unit Time ) [} 85] TF5100 Version: 2.14.3 125
## Page 126

Classic Dialect Reference Manual 6 Classic Dialect Reference Manual 6.1 Basic Principles of NC Programming 6.1.1 Structure of an NC Program An NC program is a text that is normally stored as a sequence of ASCII codes in a file on the hard disk. It consists of a sequence of NC blocks separated by line breaks (Return). Usually it is executed by being interpreted and worked through, character by character and line by line. Program structure The NC program is thus composed of three parts • Program start (optional) • Number of blocks • Program end Program start At the beginning of an NC program the character "%" can represent the start of the program. The name of the program is then found following this character. The block for the program start does not necessarily have to be programmed. Sample: % Test1 (program start) N10 G0 X100 Y100 Z0 M30 (program end) NC block Each NC block consists of one or several NC words, or even of none (an empty line), separated by spaces or tab characters. It is therefore not possible to use a space within a word. Sample: N10 G0 X100 Y100 Z0 NC word The first character of an NC word specifies its meaning. It is either a letter or a special character. Upper/lower case has, in general, no significance. Uniform use of upper case is, however, recommended for the sake of better readability. The optional following characters specify the meaning more precisely, or supply parameters for the execution. In order to manage with such a limited supply of characters, an expression is not available for every variation of every function. It is rather the case that the significance and effect of many NC words is determined partly by the context. This can be a matter of the foregoing words in the block, but it can also depend on previous NC blocks. In a few cases the effect of NC words even depends on the machine data. Program end The end of the program is indicated by an M-function. Either M2 or M30 is used for this. Effective Duration of Words Commands such as G0 [} 136] or G17 [} 130], that have effects beyond the end of the block, are known, according to DIN 66025, as modal. These commands are effective as long as they are neither cancelled nor altered by another command. 126 Version: 2.14.3 TF5100
## Page 127

Classic Dialect Reference Manual Comments If either parts of an NC block, or the whole of it, is not to be interpreted, the region concerned is to be placed within curved brackets. Sample: N10 G0 X100 (comment) Notice A comment ends with the closing bracket, or, at the latest, at the end of the block. This means that a comment can’t continue over a number of lines. Nested comments are also not possible. Block numbers Each block can be identified by a block number. The block number is accompanied by "N" for subordinate blocks and ":" for main blocks. Notice The block number is not essential. A block not identified by a block number can not, however, be used as the target of a jump command. An error message, moreover, can only approximately report the location of the error (the last block number). 6.1.2 Block Skipping It is often useful if not all blocks of a program are always executed. This makes it possible to implement similar processes with a single program. In such cases, the blocks that belong to one variant are given a block skipping identifier. This must be written at the start of the block, and consists of a slash "/". If several variants are required, the slash is extended with line information (0..15), for instance "/12". The line information (where "/" is equivalent to "/0") selects a bit from a word in the channel interface from the PLC to the NC. If this bit is set, the block is not interpreted. In the NC the variable 'm Skip Line' is evaluated for this purpose, which can be found among the inputs in the cyclic channel interface. The counterpart in the PLC can be found in the outputs under 'n Skip Line' [} 343] (previously: n Skip Block) (see Twin CAT PLC library: NCI Interpreter). If one of a number of variants is to be active, all the other suppressions must be set. Then only those blocks remain active that have either no identifier, or that have the desired identifier. Active time of block skipping The interpreter works an indeterminate number of blocks in advance of the execution. Block skipping can only operate correctly if it is set early enough (perhaps before the program starts), or if the interpreter is synchronized with the execution at a suitable location in the program (decoder stop [} 169]). 6.1.3 Look-Ahead The actual velocity at the segment transition depends on a range of parameters. These include residual path length, dynamic parameters for the current segment, and (indirectly) the geometric angle at the segment transition. Dynamic look-ahead (referred to as look-ahead below) ensures that the velocity can remain as high as possible at segment transitions. In the standard configuration 128 geometry entries are considered. Without look-ahead the velocity is reduced to 0 at each segment transition (G60). The number of geometry entries taken into account can be set in the DXD parameters [} 28]. Segments with different target velocity If the target velocity changes from a high velocity level to a lower level (N10 -> N20), the lower velocity will already have been reached at the start of the segment. TF5100 Version: 2.14.3 127
## Page 128

Classic Dialect Reference Manual If the target velocity changes from a low velocity level to a higher level (N20 -> N30), the higher velocity is initiated with the segment transition. The system therefore always ensures that even at the segment boundary the current velocity does not exceed the programmed velocity. green: Path velocity blue: Position orange: Block numbers N10 G01 X600 F30000 N20 G01 X700 F15000 N30 G01 X900 F30000 M30 green: Path velocity blue: Position orange: Block numbers N40 G01 X200 F15000 N50 G01 X800 F30000 N60 G01 X900 F15000 M30 128 Version: 2.14.3 TF5100
## Page 129

Classic Dialect Reference Manual 6.1.4 Smoothing of Segment Transitions Overview Segment transitions with no continuous second differential cause instability in the dynamics unless the path velocity is reduced to 0 at those points. For dynamically stable segment transition at a finite speed it is possible to smooth segment transitions with Bezier splines which alter the local geometry and ensure that the complete path has a continuous second differential. Tolerance spheres A tolerance sphere is laid around every segment transition within which the path may deviate from its pre-set geometry for smoothing purposes. The radius of the tolerance sphere (parameterization [} 338]) is predetermined by the user and applied modally for all segment transitions that imply no exact positioning or stop in the segment transitions. The radii of the tolerance spheres are automatically reset adaptively, thus preventing tolerance spheres from overlapping in the case of small segments. Dynamic parameters The smoothing enables faster dynamics. The system-determined maximum segment transition velocity Velo Link can be influenced by the user insofar as the system parameter C2 velocity reduction C2 (parameterization [} 338]) sets the segment transition velocity to C2x Velo Link. The factor can be changed online. General characteristics at segment transitions When entering the tolerance sphere, the path acceleration is 0 and the path velocity equals the segment transition velocity. This is maintained within the tolerance sphere. The override is inactive within the tolerance sphere, i.e. the change of the velocity level caused by the override is interrupted within the tolerance sphere and continues after the exit from the tolerance sphere. 6.1.5 Co-ordinate System The names of the axes of a machine tool are specified by DIN 66217. The letters X, Y and Z are allocated to the axes. These create a right-handed right-angle (Cartesian) coordinate system. In many machines, not all three axes are present at every location. In these cases individual letters are allocated in some meaningful way, and the axes that are not present are ignored. 6.1.6 Dimensional Notation Dimensional data can optionally be referred to an absolute origin or to the current set value. TF5100 Version: 2.14.3 129
## Page 130

Classic Dialect Reference Manual Absolute dimensions Command G90 (standard setting) Cancellation G91 All positional data in absolute dimensions are always given with reference to the currently valid origin. In terms of tool movement, this means that, under absolute dimensioning, it is the position to which the tool should move that is described. Incremental Dimensions Command G91 Cancellation G90 When dimensions are incremental, positional data is related to the immediately preceding point. In addition to the path axes, the auxiliary axes (Q1.. Q5) are also taken into account. For the tool movement this means that the incremental dimension describes by how much the tool is moved. Units The units for length, angle etc. are described in the following table: Unit Positions and lengths mm Angle degree Times sec Feed mm/min 6.1.7 Working Plane and Feed Direction In order to describe circles (except CIP [} 138]), and for the compensation of cutter radius [} 186] and tool length [} 183], it is necessary to specify the working plane. Working Plane XY Command G17 (standard setting) Cancellation G18 or G19 The function G17 specifies the XY plane as the working plane and the feed direction as the Z direction. The function acts as: • Plane for tool radius compensation [} 186] • Feed direction for tool length compensation [} 183] (offset) • Plane for circle interpolation Changing the working plane The working plane cannot be changed while tool compensation is active. Working Plane ZX Command G18 Cancellation G17 or G19 130 Version: 2.14.3 TF5100
## Page 131

Classic Dialect Reference Manual The function G18 specifies the ZX plane as the working plane and the feed direction as the Y direction. Working Plane YZ Command G19 Cancellation G17 or G18 The function G19 specifies the YZ plane as the working plane and the feed direction as the X direction. Specification of the feed direction Command P Parameter + feed direction positive (standard setting) - feed direction negative Parameterization of the feed direction is required for tool length compensation. It is used to specify whether the tool operates above or below the workpiece. Sample: N10 G0 X0 Y0 Z0 F6000 N20 D2 P- Z N30 G01 X100 N40 D0 Z N50 M30 In this sample the length compensation operates below the workpiece. 6.1.8 Inch/metric dimensions G70 Dimensions in inches G71 Dimensions in millimeters (standard setting) G700 Dimensions in inches with calculation of the feed G710 Dimensions in millimeters with calculation of the feed TF5100 Version: 2.14.3 131
## Page 132

Classic Dialect Reference Manual Dimensions in millimeters (G71) is active by default. Information on whether the coordinates have to be converted is stored in the machine parameters [} 15] (Interpreter tab). The basic dimension system in millimeters is also set there by default. The effects of the changeover If the basic dimension system is not the same as the current dimension system (set with G70 or G71), then certain parameters and co-ordinates must be converted. The conversion factor required here is stored in the machine parameters, like the basic dimension system. The changeover has effects on the following parameters: • Path information for the path axes (X, Y & Z) • Path information for the auxiliary axes (Q1.. Q5) • Intermediate point co-ordinates (I, J, K) • Circle radii (B or U) • Programmable zero shift • Rounding radius (circle and spline smoothing) There are also parameters that always remain in the basic dimension system, and are not converted. These include the • adjustable zero shift • Tool data • feeds (except under G700 or G710) Sample 1: Basic dimension system: inch ... N10 G71 (metric dimensions) N20 G01 X100 (conversion is carried out) N30 G70 (dimensions in inches) N40 G01 Y100 (conversion is not necessary, because) .... (the basic dimensions are also inches) Sample 2: Basic dimension system: millimeters ... N10 G71 (metric dimensions) N20 G01 X100 (conversion is not necessary, because) (the basic dimensions are also metric) N30 G70 (dimensions in inches) N40 G01 Y100 (conversion is carried out) Zero shifts (NPV) Adjustable zero shifts (G54-G57) always remain in the basic dimension system, and are not converted. In the case of the programmable zero shifts (G58 & G59) the effect depends on the current dimension system when the shift is selected. Sample 3: Basic dimension system: millimeters ... N10 G71 (mm - default) N20 G54 (activates adjustable zero offset shift) N30 G58 X100 (programmable zero offset shift) N40 G01 X0 F6000 (the axis travels to 100 in the machine co-ordinate system) N50 G70 (inch) N60 G01 X0 (zero offset shift is programmed under G71 => zero offset shift remains unchanged) (i.e. the axis does not move) N70 G58 X100 (new programmable zero offset shift - now in inches) N80 G01 X0 (axis moves out by zero offset shift - to 2540 in the machine co-ordinate system) 132 Version: 2.14.3 TF5100
## Page 133

Classic Dialect Reference Manual 6.1.9 Single Block Operation To test a new NC program, the NCI can be switched to single block mode with the function block Itp Single Block [} 252]. When single block mode is active, the NC program is stopped after each line. The user has to acknowledge execution of the next line. This can be done by pressing 'NC start (F5)' in the XAE under the Editor tab or by setting the input 'b Trigger Next' in the PLC function block Itp Single Block [} 252]. A distinction is made between two modes: • Interpreter single block mode • NC kernel single block mode The selection of the single block mode is not reset by an Itp Reset Ex2 [} 240]. This means that if, for example, the NC kernel single block mode is active, it still remains active after a reset. Interpreter single block mode If interpreter single block mode is active, the NC program is stopped after each line in the interpreter. This remains true even if the line only contains calculations, and no physical movement is programmed. This enables re-writing of R-parameters, for example. Interpreter single block mode should be activated before the NC program is started. If this is not possible, an M-function can be reserved for the activation and combined with a decoder stop. If interpreter single block mode is activated during processing of the NC program without M-function and decoder stop, it is impossible to predict when it will be active. Theoretically it is possible that the memories in the NC kernel (SVB & SAF) are filled and contain more than 100 geometry entries. The single block can only take effect once these memories have been fully processed. NC kernel single block mode Like in interpreter single block mode, in NC kernel single block mode the NC blocks are executed individually. The difference is that in NC kernel single block mode all entries (e.g., geometry entries) have already passed through the interpreter. It is therefore not possible to overwrite R-parameters retrospectively, for example. This operating mode has the advantage that single block mode can be enabled during processing of the NC program. If a geometry entry is executed (i.e. the axes are moved) during the activation, the system stops at the next possible end of segment. This is usually the current segment. For activation after program startup no M-function with decoder stop is required. However, an M-function with program end identifier (M02, M30) is required at the end of the program. If NC kernel single block mode is used in conjunction with blending, block relaying takes place in the blending sphere. The programmed blending continues to be executed (from Twin CAT V2.10 Build 1301). Alternatives to activation We recommend activating single block mode with Itp Single Block [} 252]. For reasons of compatibility with previous Twin CAT versions, single block mode can be activated via the cyclic channel interface. Single block mode can be selected or deselected in the cyclic channel interface of the PLC. To this end the variable 'n Itp Mode' has to be masked correctly in the PLC/NC channel interface. Set bit 14 (0x4000) to switch on interpreter single block mode. Resetting the bit turns single block mode off again. It is also possible to trigger the single block from the PLC by means of this interface. Bit 15 must be set for this. The effect is the same as activating NC start in the XAE. TF5100 Version: 2.14.3 133
## Page 134

Classic Dialect Reference Manual 6.1.10 Arithmetic Parameters The arithmetic parameters (known as R-parameters for short) are interpreter variables that are named by an expression of the form "R<n>". Since 'n' is an integer in the range 0..999, a total of 1000 R-parameters are available. Of these, the first 900 values (R0.. R899) are local variables for the NC channel. They can only be accessed by the channel’s interpreter. The R-parameters R900.. R999 are declared globally. They exist only once for each NC, and all channels access the same storage. This makes it possible to exchange data (e.g. for part tracing, collision avoidance etc.) over the channel boundaries. Mathematical Calculations The R-parameters (like the axis co-ordinates, feedrates etc.) are declared as variables of type 'double'. This makes full use of the computer’s arithmetic capacity. The number of places before and after the decimal point is not restricted by a format specification. The arithmetical resolution does, nevertheless, have a limit. In practice this is only visible in particularly critical cases. Examples of this include the differences of very large numbers that are almost equal, or trigonometrical functions in particular ranges of angles. Assignment of R-Parameters N100 R5=17.5 N110 R6=-4 N120 R7=2.5 R8=1 As can be seen in the third line, it is quite possible to make more than one assignment in one block. This speeds interpretation slightly, but it can be more difficult to localize an error in the line. Calculation formula A calculation formula is an extension of assignment. It consists of a target parameter, an assignment sign and a series of values (R-parameters and constants) separated by arithmetical instructions. N100 R1=R2+R3-17.5*R9/2.5 Such a formula, contrary to normal mathematical practice, is processed strictly from left to right. The illustrated formula is calculated as follows: 1. The contents of R2 is loaded into the arithmetic unit 2. The contents of R3 is loaded into the arithmetic unit 3. The arithmetic unit carries out the + instruction 4. The value 17.5 is loaded into the arithmetic unit 5. The arithmetic unit carries out the - instruction 6. The contents of R9 is loaded into the arithmetic unit 7. The arithmetic unit carries out the * instruction 8. The value 2.5 is loaded into the arithmetic unit 9. The arithmetic unit carries out the / instruction 10. The content of the arithmetic unit is stored in R-parameter R1 Mathematical functions The interpreter provides standard computing functions. DIN 66025 does not specify any syntax here. The computing functions are called via @6xx (see appendix - @-command overview [} 196]). The trigonometrical functions are always calculated in degrees. Sample: N10 R2=0 R3=45 N20 @630 R2 R3 In this sample the sine of R3 is calculated in degrees. The result is then written into R2. R-parameter access from the PLC 134 Version: 2.14.3 TF5100
## Page 135

Classic Dialect Reference Manual You can read the R-parameters into the PLC, or write the R-parameters from the PLC. Special PLC function blocks are provided for this purpose • Itp Read RParams [} 291] • Itp Write RParams [} 306] During writing of the R-parameters, ensure that the interpreter is ahead of the block execution. In other words, writing of the R-parameters from the PLC should take place before the NC program starts or be linked to a decoder stop [} 169]. For debugging purposes, all R-parameters can be written to a file at any time. This process can be triggered via ADS (see ADS interface - channel functions Index Offset 0x24 & 0x25). Other functions RTo Dword Get Bit This function converts an R-parameter to a DWord and then checks whether a particular bit is set. The result is again stored in an R-parameter. Command RTo Dword Get Bit[<dest>; <src>; <bit> ] Parameter <dest> R-parameter in which the result is entered Parameter <src> R-parameter containing the number that is to be converted and checked Parameter <bit> Bit to be checked (0..31) Sample: N10 R1=7 N20 RTo Dword Get Bit[R2;R1;0] R10=31 N30 RTo Dword Get Bit[R3;R1;R10] Enter 1 in R2 and 0 in R3. Initialization of R-parameters 'set RParam' is used to assign a value to a contiguous block of R-parameters. Command #set RParam(<start index>; <count>; <value> )# Parameter <start index> Describes the first R-parameter to be written Parameter <count> Number of R-parameters to be written Parameter <value> Assigned value Sample: N10 G01 X100 Y200 F6000 N15 R2=3000 N20 #set RParam( 1; 2; 0.0 )# (R2 is overwritten again here) N30 G01 X500 Saving R-Parameters If the content of R-parameters [} 134] is required for subsequent use, while in the meantime the R- parameters are used for a different purpose, it can temporarily be stored in the values stack of the arithmetic unit. Two possibilities exist for this: • enumeration of the R-parameters • giving the range of R-parameters Saving the values: Command @40 <number> R<n> R<m>... TF5100 Version: 2.14.3 135
## Page 136

Classic Dialect Reference Manual @41 <1st R-parameter> <last R-parameter> Restoring the values: Command @42 <number> R<n> R<m> @43 <last R-parameter> <1st R-parameter> When restoring the values, call the parameters in reverse order. Sample 1: (saving the data) N100 @40 K4 R800 R810 R823 R4 N110 R800=4711 N120 ... (restoring the data) N200 @42 K4 R4 R823 R810 R800 Sample 2: (saving the data) N100 @41 R800 R805 N110 R800=4711 N120 ... (restoring the data) N200 @43 R805 R800 Stack size The value stack of the arithmetic unit has limited capacity. If it overflows, the NC program is interrupted with an error message. That can occur as the value is saved, but can also occur in the course of subsequent formula evaluation. 6.2 Programming Movement Statements 6.2.1 Referencing By default, axis referencing (homing) should take place before the 3D-group is formed from the PTP channel. Or it can be done from the NC program. If axes are referenced in PTP mode, it can be done for several axes simultaneously. If axes are referenced from the NC program, it can only be done for one axis at a time. Command G74 Cancellation End of block Sample: N10 G74 X N20 G74 Y Referencing with own block Referencing must be carried out within its own block. G74 may only refer to one axis. This command is only applicable for the main axes (X,Y,Z). 6.2.2 Rapid Traverse Command G0 Cancellation G1 [} 137], G2 [} 138] or G3 [} 138] 136 Version: 2.14.3 TF5100
## Page 137

Classic Dialect Reference Manual Rapid traverse is used to position the tool quickly, and is not to be used for machining the workpiece. With G0 the axes are moved with linear interpolation as fast as possible. The velocity is calculated with MIN (Rapid Traverse Velocity (G0), Reference Velocity, Maximum Velocity). If a number of axes are to be driven in rapid traverse, the velocity is determined by that axis that requires the most time for its movement. An accurate stop (G60 [} 141]) is cancelled with G0. The rapid traverse velocity is set individually for each axis. This can be edited in the axis parameters in the XAE under NCI parameters. 6.2.3 Linear Interpolation Command G1 or G01 (standard setting) Cancellation G0 [} 136], G2 [} 138] or G3 [} 138] TF5100 Version: 2.14.3 137
## Page 138

Classic Dialect Reference Manual Under linear interpolation the tool moves, with feedrate F, along a straight line that can be freely located in space. The movement of the axes involved is completed at the same moment. The feedrate (short: feed), F, describes the rate of displacement in millimeters per minute. This value is effective globally, so that it is not necessary to program it again if the same feed is to be used later for other geometrical movements. Sample: N10 G90 N20 G01 X100.1 Y200 F6000 In this example the axes are moved linearly to the position described. The Z axis is not mentioned in this program, and therefore retains its old position. 6.2.4 Circular Interpolation Circular arcs can be programmed in a number of ways. Two types must be distinguished between. One of these is an arc in the working plane [} 130] (e.g. the XY plane), and the other is an arc that can be freely located in space (a CIP circle). Clockwise circular interpolation Command G2 or G02 Cancellation G0 [} 136], G1 [} 137] or G3 [} 139] Function G2 describes the path of a clockwise circular arc. This function requires the working plane [} 130] to have already been defined (G17 [} 130] by default). In order to describe the circle unambiguously, further parameters are required in addition to the end point. A choice is available between center point programming and radius programming. Radius Programming In radius programming, the radius of the circle is programmed as well as the end point. Either of the letters 'B' or 'U' may be used for the radius. Since the direction is prescribed with G2, the circle is also unambiguously described. The starting point is determined by the previous geometrical movements. Sample 1: N10 G01 G17 X100 Y100 F6000 N20 G02 X200 B200 Angle programming for >180° angles If an angle of more than 180° is to be traversed, the radius must be stated negatively. Full circle programming The start and the end points must be different so that the center can be calculated. Radius programming can therefore not be used for programming a full circle. Center point programming can be used for this purpose. Centerpoint Programming Center point programming represents an alternative to the method that has just been described. The advantage of center point programming is that full circles can also be described in this way. Under the standard settings, the center point is always given relative to the starting point of the arc. The parameters I, J, and K are used for this purpose. Here, • I represents the X-component • J represents the Y-component and • K represents the Z-component. 138 Version: 2.14.3 TF5100
## Page 139

Classic Dialect Reference Manual At least one of these parameters is 0 and therefore does not have to be included in the program. Sample 2: N10 G01 G17 X100 Y100 F6000 N20 G02 I50 J0 (J is optional) X200 N30 M30 (program end) Sample 3: N10 G01 G18 X100 Y100 Z100 F6000 N20 G02 I0 K50 X150 Z150 (quarter circle in ZX plane) N30 M30 By programming an item of machine data, it is also possible to enter the center point absolutely. The command @402 is required for write access to a machine data bit. In the following example, the circle from the first example is programmed using the absolute circle center. Sample 4: N10 G01 G17 X100 Y100 F6000 N20 @402 K5003 K5 K1 (center point programming absolute) N30 G02 I150 J100 X200 N40 @402 K5003 K5 K0 (center point programming relative) N50 M30 Anticlockwise Circular Interpolation Command G3 or G03 Cancellation G0 [} 136], G1 [} 137] or G2 [} 138] The function G3 describes a circular arc anticlockwise. The parameters and entry possibilities are the same as under G2. Circular accuracy Command #set param Radius Prec(<param>)# Parameter param: maximum allowed radius tolerance 0.001 < param < 1.0 (default 0.1) The 'set param Radius Prec' function is used to parameterize the required circular accuracy. This parameter affects circles programmed with G02 or G03. With center point programming, an error is generated if the difference in radius length is greater than <param>. Centre point correction Command CPCON (standard setting) Cancellation CPCOF In center point programming the circle is overdetermined. For data consistency, the center point is usually corrected. Normally only a marginal modification of the center point is required. After the center point correction, the magnitude of the input radius equals the output radius. It the start and end point are very close together, the center point offset may be large. This may lead to problems with automatically generated G-Code (postprocessor). For manually written G-Code, the CPCON setting (center point correction on) is recommended. CIP circle Command CIP Cancellation End of block TF5100 Version: 2.14.3 139
## Page 140

Classic Dialect Reference Manual The circles discussed so far can only be used in the principal planes. The CIP circle can also be used to program an arc anywhere in space. For this, it is necessary to program not only an end point but also some other point on the path. The 3 points (the starting point is given implicitly) may not be collinear. This is required in order to describe the circle unambiguously. It is thus not possible to program a full circle in this way. I, J and K are available as path point parameters. By default, their values are relative to the starting point of a circular path. Sample 5: N10 G01 X100 Y100 F6000 N20 CIP X200 Y200 I50 J50 K50 Notice In order to be able to follow a CIP circle, the cutter radius compensation [} 186] cannot be active. 6.2.5 Helix If a circular motion is superimposed onto a perpendicular linear movement, a helix is obtained. A helix can only be programmed in the principal planes. The same parameters as are used for a circle in the principal plane are used. At the same time the axis that is perpendicular to the plane is driven. The helix can be used together with the cutter radius compensation [} 186]. Sample: N10 G01 G17 X100 Y0 Z0 F6000 N20 G03 I-50 Z100 M30 140 Version: 2.14.3 TF5100
## Page 141

Classic Dialect Reference Manual 6.2.6 Dwell Time Command G4 or G04 Cancellation End of block Parameter F or X G4 is used to switch on a dwell time. It is used to interrupt workpiece machining between two NC blocks for a programmed time (in seconds). Sample: N10 G01 X100 F6000 N20 G04 X0.5 (pause in sec) N30 G02 X300 ... Notice The dwell time must be programmed in a dedicated set, and the parameters (X or F) must be programmed after G04. 6.2.7 Accurate Stop block-by-block Command G9 or G09 Cancellation End of block The accurate stop instruction is used, for example, when sharp contour corners must be manufactured. At the contour transition the set path velocity is reduced to zero and then increased again. This ensures that the programmed position is approached precisely. Notice G09 acts only on the set value side. The actual values can be checked with TPM (target position monitoring), for example. modal Command G60 Cancellation G0 [} 136] Description: see above see also target position monitoring [} 145] (TPM) 6.2.8 Feed interpolation Constant feed interpolation Command FCONST (standard setting) Cancellation FLIN The programmed velocity is applied as fast as possible with the constant feed interpolation (default). TF5100 Version: 2.14.3 141
## Page 142

Classic Dialect Reference Manual Sample 1: N05 FCONST N10 G01 X1000 F50000 N20 G01 X2500 F80000 N30 G01 X3500 F60000 ... Linear feed interpolation Command FLIN Cancellation FCONST The linear feed interpolation transfers the velocity linearly over the path from v_start to v_end. Sample 1: N05 FCONST N10 G01 X1000 F50000 N15 FLIN N20 G01 X2500 F80000 N30 G01 X3500 F60000 ... Notice If the velocity on the segment transition has to be reduced more drastically than the programmed segment velocity, due to the geometry or M function for example, then the linear velocity is maintained as long as possible. The reduced segment velocity will delayed, only if required dynamically. 6.2.9 Zero Offset Shifts A range of zero offset shifts are available in Twin CAT NC I. They describe the distance between the origins of the workpiece and of the machine. 142 Version: 2.14.3 TF5100
## Page 143

Classic Dialect Reference Manual Zero shift suppression Command G53 (standard setting) Cancellation G54 [} 143] to G59 [} 144] The zero shift is suppressed modally with G53. The suppression affects both the adjustable and the programmable zero shift. Adjustable zero shift Command G54 G55 G56 G57 Cancellation G53 [} 143] or selection of another configurable zero shift The commands G54 to G57 can be used within the NC program to switch back and forth between the zero shifts. Parameterization The configurable zero shift can be parameterized in different ways 1. PLC function block Itp Write Zero Shift Ex [} 259] (recommended standard) 2. XAE Interpreter element [} 15] 3. from the DIN-program The parameters are saved for each interpolation channel. This means that the adjustable zero shifts are channel dependent. Notice The selection of a zero shift must be made in its own block. In order for the movement corresponding to the shift to be actually made it is necessary that at least the axes involved are named in a following geometrical block. Sample 1: N10 G01 X100 Y0 Z0 F6000 N20 G54 (activates adjustable zero offset shift (NPV)) N30 G01 X Y Z N40 M30 In sample 1 all involved axes are named in line 30. The effect of this is that the zero shifts are applied to all the axes. Sample 2: N10 G01 X100 Y0 Z0 F6000 N20 G54 (activates adjustable zero offset shift (NPV)) N30 G01 X200 Y In line 30 of sample 2 the X axis is taken to position 200 + shift in the X direction. The Y axis only moves to accommodate the shift, and the Z axis is not moved. Parameterization from the DIN program Command #set param Zero Shift( G<n>; <value x>; <value y>; <value z> )# Parameter G<n> Zero shift to be parameterized (G54.. G59) Parameter <value> Coordinates of the zero shift '#set param Zero Shift(..)#' parameterizes the zero shift but does not activate it. This requires explicit programming of the G-Code. Sample 3: TF5100 Version: 2.14.3 143
## Page 144

Classic Dialect Reference Manual N10 G01 X100 Y0 Z0 F6000 N20 R12=200 N30 #set param Zero Shift( G54; 100.0; R12; -20)# N40 G54 (activates adjustable zero offset shift (NPV)) N50 G01 X200 Y Z Programmable zero shift Command G58 or G59 Cancellation G53 [} 143] Programmable zero shifts exist in addition to the adjustable ones. This type of zero shift is directly described from the NC program. Addition of zero shifts The programmable zero shift is only effective when the adjustable zero shift is active. This means that the total shift is the sum of • set zero shift (G54, G55, G56 or G57) • first programmable zero shift (G58) • second programmable zero shift (G59) Sample 4: N10 G01 X100 Y0 Z0 F6000 N20 G54 (activates adjustable zero offset shift (NPV)) N30 G58 X0.5 Y0.5 Z0.5 (1st prg. zero offset shift) N50 X Y Z (movements for the zero offset shift) ... M30 Behavior with incremental dimension notation Default behavior Changing the origin also affects the incremental dimension. Sample 5: N10 G01 X100 Y0 Z0 F6000 N20 G54 (activates adjustable zero offset shift (NPV)) N25 G58 X10 Y10 Z0 N30 G91 (Incr. dimensions) N40 G01 X200 Y0 N50 ... In N40 Y moves to 10 in the basic coordinate system. A shift in origin also shifts the point of reference for incremental dimension programming, resulting in a travel path for Y. In this way a contour, which is fully programmed based on the incremental dimension, can be positioned at any point through a zero shift. The behavior of G91 is parameterizable. Command Description Zero Shift Inc On The zero shifts are also applied under G91 once the axis is named. (standard setting) Zero Shift Inc Off The zero shift is not applied under G91. Sample 6: N10 G01 X100 Y0 Z0 F6000 N15 Zero Shift Inc Off N20 G54 (activates adjustable zero offset shift (NPV)) N25 G58 X10 Y10 Z0 N30 G91 (Incr. dimensions) N40 G01 X200 Y N50 ... Since 'Zero Shift Inc Off' is set in sample 6 , the X-axis in N40 is moved by 200 mm independently of the new zero shift. The Y-axis does not move as no target coordinate is programmed for it. 144 Version: 2.14.3 TF5100
## Page 145

Classic Dialect Reference Manual See also Tool Offset Inc On/Off [} 183] 6.2.10 Target Position Monitoring Command TPM Cancellation End of block The command 'TPM' is used to trigger target position monitoring from the NC program. At the end of the geometry this always leads to an accurate stop on the set value side and subsequent checking of the target position window. Block relaying takes place when the monitoring conditions are met for all axes in the group. Like for PTP, this function is enabled and parameterized individually for each axis. This means that different limits can be selected for auxiliary axes than for the path axes, for example. Sample 1: N10 G01 X100 Y100 F6000 N20 G01 X300 Y100 TPM ... At the end of the motion of N20, target position monitoring is performed both for the X axis and for Y axis (provided target position monitoring is enabled for both axes). Sample 2: N10 G01 X100 Y100 F6000 N20 G01 X300 Y100 N30 M61 (Type Handshake) N40 TPM ... TPM can also be programmed in a dedicated block. In this case the last positioning is checked (of N20 in this case). TF5100 Version: 2.14.3 145
## Page 146

Classic Dialect Reference Manual Notice If target position monitoring is enabled for an axis, the target position alarm (PEH) should also be active. Time monitoring results in a channel error after the timeout (or before), if the axis is not yet in the target position window. In order to avoid unnecessary channel errors, a sufficiently large timeout value should be selected (e.g. 5 - 10 s). If no PEH time monitoring is active and the axis is permanently outside the position window, no block relaying takes place and the NC remains stationary when viewed from outside. The SAF is in Waiting state (not to be confused with Interpreter state). See also accurate stop [} 141] (G09). 146 Version: 2.14.3 TF5100
## Page 147

Classic Dialect Reference Manual 6.2.11 Contour definitions Angle and segment length In this type of programming the angle and the magnitude (segment length) are always quoted, similarly to polar co-ordinates. Parameter Description ANG Angle in degrees with reference to the abscissa ( -360 ≤ ang ≤ 360 ) SEG Magnitude of the segment length Sample 1: N10 G01 ANG=45 SEG=424.264 F60000 N20 G01 ANG=0 SEG=400 N30 G01 ANG=-45 SEG=282.843 or N10 G01 ANG=45 SEG=424.264 F60000 N20 G01 X700 Y300 N30 G01 ANG=-45 SEG=282.843 Restrictions: • The programming may only be done in the chosen principal plane. • The length of the segment must be greater than zero, and refers to the projection in the principal plane. Notice It is additionally possible to program rounding or chamfering. The ANG and SEG parameters must be programmed in every block. The assignment may use R-parameters, but formulas cannot be programmed. Angle and one component in the plane As above, an angle is programmed, but the length of the segment is no longer specified directly. It is calculated from a component in the selected principal plane. Sample 2: TF5100 Version: 2.14.3 147
## Page 148

Classic Dialect Reference Manual N10 G01 ANG=45 X300 N20 G01 ANG=0 Z700 R10=100 N30 G01 ANG=315 X=R10 Runtime error If either two components in the plane are quoted or none at all, the result is a runtime error. A runtime error is also generated if the movement is parallel to the abscissa or to the ordinate, and there is therefore no intersection. 6.2.12 Rotation It is also possible to program a rotation as well as the zero shift [} 142]. A distinction is drawn between absolute and additive rotation. The rotation can turn the co-ordinate axes (X, Y and Z) in the workpiece coordinate system. This makes it possible to machine inclined surfaces (in the plane or in space). Absolute Rotation Command ROT X<value(x)> Y<value(y)> Z<value(z)> Cancellation ROT (without parameters) The rotation instructions must be programmed in their own block. Angles must always be stated in degrees. Direction of Rotation A positive angle describes rotation in the direction of the positive co-ordinate axis, the rotation being anti- clockwise. Carrying Out the Rotation The sequence of rotations is of critical importance when a coordinate system is being rotated. In Twin CAT NC I rotations are always carried out in the following sequence around the global coordinate system: 1. Rotation around the Z-axis, 2. Rotation around the Y-axis, 3. Rotation around the X-axis. This sequence is maintained even if the parameters are programmed in a different order. 148 Version: 2.14.3 TF5100
## Page 149

Classic Dialect Reference Manual The origin of the tool coordinate system is always used as the center point of the rotation. This means that the total zero offset shift currently active describes the rotation center. Additive Rotation In addition to absolute programming of rotation it is also possible to carry this out additively. The same conditions apply to this as do to absolute rotation. Command AROT X <Wert(x)> Y<Wert(y)> Z<Wert(z)> Cancellation ROT (without parameters) Sample: N10 G01 G17 X0 Y0 Z0 F60000 N20 G55 N30 G58 X200 Y0 N50 L47 N60 G58 X200 Y200 N65 ROT Z30 N70 L47 N80 G58 X0 Y200 N90 AROT Z15 N100 L47 N110 M30 L47 N47000 G01 X0 Y0 Z0 (movements for zero shift & rotation) N47010 G91 (incremental dimensions) N47020 G01 X100 N47030 G01 Y80 N47040 G03 X-20 Y20 I-20 J0 N47050 G01 X-40 N47060 G01 Y-40 N47070 G01 X-40 Y-30 N47080 G01 Y-30 N47090 G90 N47100 M17 In this example, the same contour is traversed under different rotations. Since the contour (L47) is programmed in incremental dimensions, and the starting point is described by means of the programmed zero shift, the rotation is clear to see. TF5100 Version: 2.14.3 149
## Page 150

Classic Dialect Reference Manual Note: Once the ROT or AROT command has been programmed, the complete path vector (X, Y & Z) must be assigned. Rotation extensions In the default configuration the whole path vector must be programmed after each ROT command. Since this is difficult to realize in some applications, this calculation can optionally be performed automatically in the interpreter. To use this option, 'Rot Ex On' should be included at the start of the NC program. Command Rot Ex On Cancellation Rot Ex Off Sample: N10 Rot Ex On ... N100 G54 (activate zero point & point of rotation) N110 ROT X90 N120 G0 Z3 (preposition the tool) N130 G01 Z-10 F6000 (lower to cutting depth) N140 G01 X100 N150 G01 Z3 (raise to preposition) ... N1000 Rot Ex Off N1010 M30 Calculate rotation Command Calc Rot[ R<s>; R<t>; R<u>] Calc Inv Rot[ R<s>; R<t>; R<u>] Parameter The 3 R-parameters describe the vector to be calculated. The calculation will write the result into this R-parameter, and the original value will therefore be overwritten. The function Calc Rot rotates a three-dimensional vector through the current rotation angle. The rotation angles had been determined by ROT or AROT. The sequence of the calculation is the same as is used for the rotation itself, that is Z, Y and X. The Calc Inv Rot function behaves in precisely the opposite way. The signs of the currently valid rotation angles are inverted, and the order of calculation is X, Y and Z. In other words, the vector is turned back, so to speak. Neither Calc Rot nor Calc Inv Rot generate any geometry, but merely carry out the calculation of the vector. Sample: N10 G01 X40 Y10 Z0 F6000 (the axes are moved without rotation) N20 R1=40 R2=10 R3=0 N30 ROT Z45 (What is the position to which X, Y, must be taken so that no movement is executed?) N40 Calc Inv Rot[R1; R2; R3] N50 G01 X=R1 Y=R2 Z=R3 (R1=35.35 R2=-21.21 R3=0) N60 ... Command Rot Vec[ R<x>; R<y>; R<z>; R<α>; R<β>; R<γ>] Parameter The 3 R-parameters (x..z) describe the vector to be rotated through. The calculation will write the result into this R-parameter, and the original value will therefore be overwritten. The last 3 R-parameters describe the angle. 150 Version: 2.14.3 TF5100
## Page 151

Classic Dialect Reference Manual The function Rot Vec rotates a three-dimensional vector through the specified angle. The order of the rotation is Z, Y and X, like for ROT. Rot Vec is a calculation routine solely for rotating a vector. It has no effect on ROT or AROT. 6.2.13 Mirror The mirror functionality changes the sign of named axes. This enables subroutines to be reused. Mirroring Command Mirror <opt. X> <opt. Y> <opt. Z> Cancellation Mirror (without parameters) The mirror instructions must be programmed in a dedicated block. Mirrored axes must be named without further parameters. Sample: N20 G54 N30 G58 X100 Y100 N40 L100 N50 G58 X-100 Y100 N60 Mirror X N70 L100 N80 G58 X-50 Y-50 N90 Mirror X Y N100 L100 N110 G58 X10 Y-10 N120 Mirror Y N130 L100 N140 Mirror (turn off mirror) N150 G0 X0 y0 M02 L100 N1000 G0 X200 Y0 Z10 F60000 (move to start pos) N1020 G01 Z0 N1030 G03 X200 Y100 J50 N1040 G01 X50 N1050 G01 Y400 N1060 G01 X0 N1070 G01 Y0 N1080 G01 X200 N1090 G01 Z10 M17 TF5100 Version: 2.14.3 151
## Page 152

Classic Dialect Reference Manual If a zero shift is present (G54... G59), the mirror functionality depends on the currently programmed coordinate system. 6.2.14 Smoothing of segment transitions 6.2.14.1 Overview Overview In general, at segment transitions polygon functions (G01 blocks) contain kinks within their contour. At these transitions polygon functions are not steadily differentiable with respect to their spatial coordinate, thus leading to dynamic-unsteadinesses, if at these transitions the path velocity is not reduced to zero value. To actually avoid to have to reduce path velocity to zero value segment transitions of polygon functions can be smoothed out by blending at those transitions. 152 Version: 2.14.3 TF5100
## Page 153

Classic Dialect Reference Manual Execution Supported Acceleration Max. Toler- Adaptive Command Segment of Axis Com- ance Tolerance Transitions ponents Radius Circular Interpreter Straight line/ Step change 1/2 of the No param Circu Smoothing straight line in input or lar Smoothi acceleration output ng(…) [} 157] (value segment parameteriza ble via the C1 factor) Parabolic NC kernel Straight line/ Step change 1/3 of the Can be param Verte Smoothing straight line in input or selected x Smoothing acceleration output (…) [} 154] to a constant segment <type>: 2 level (value parameteriza ble via the C1 factor) Biquadratic NC kernel Straight line/ Constant 1/3 of the Can be param Verte Smoothing straight line acceleration - input or selected x Smoothing the output (…) [} 154] acceleration segment <type>: 3 is 0 at the entry and exit - no intermediate point required Bézier Curve NC kernel All Step change 1/3 of the Can be param Verte of the 3rd in input or selected, has x Smoothing acceleration output an effect for (…) Order [} 154] to a linear segment straight-line <type>: 4 level (can be transitions parameterize d with the C1 factor) Bézier Curve NC kernel All Constant 1/3 of the Can be param Verte of the 5th acceleration - input or selected, has x Smoothing the output an effect for (…) Order [} 155] acceleration segment straight-line <type>: 5 is 0 at the transitions entry and exit - no intermediate point required ‘Old’ Bézier NC kernel All Constant 1/4 of the No param Splin Blending acceleration - input or e Smoothing the output (…) [} 155] acceleration segment param Verte <type>: 1 is 0 at the x Smoothing entry, the exit (…) and at the symmetric intermediate point Blending takes effect from the transition between the subsequent two segments. TF5100 Version: 2.14.3 153
## Page 154

Classic Dialect Reference Manual Principle of Blending The radius of the tolerance sphere can be altered at any time within the NC program and can be switched off again by setting the radius to 0. Blending remains active until the next reset of the interpreter or a Twin CAT runtime restart. 6.2.14.2 Parabolic smoothing Parabola smoothing Command #set param Vertex Smoothing(<type>; <subtype>; <radius> )# Parameter <type> For parabola smoothing: 2 Parameter <subtype> 1: Constant tolerance radius [} 157] 2: Distance between intersection and vertex [} 157] 3: Adaptive tolerance radius [} 157] Parameter <radius> Max. radius of the tolerance sphere For parabola smoothing a parabola is inserted geometrically into the segment transition. This ensures a steady velocity transition within the tolerance radius. The parabola is only inserted for straight line/straight line transitions. 6.2.14.3 Biquadratic smoothing Bi-quad smoothing Command #set param Vertex Smoothing(<type>; <subtype>; <radius> )# Parameter <type> For biquadratic smoothing: 3 Parameter <subtype> 1: Constant tolerance radius [} 157] 2: Distance between intersection and vertex [} 157] 3: Adaptive tolerance radius [} 157] Parameter <radius> Max. radius of the tolerance sphere With biquadratic smoothing there is no step change in acceleration in the axis components. With the same radius, a smaller input velocity may therefore be required than for parabolic smoothing. The operating principle of the subtypes is identical to that of the parabolic subtypes. 6.2.14.4 Bezier curve of the 3rd order Bezier curve of the 3th order Command #set param Vertex Smoothing(<type>; <subtype>; <radius> )# Parameter <type> for the Bezier curve of the 3th order: 4 Parameter <subtype> 1: Constant tolerance radius [} 157] 2: Distance between intersection and vertex [} 157] 3: Adaptive tolerance radius [} 157] Parameter <radius> Max. radius of the tolerance sphere In case of the 3rd order Bezier curve a step change in acceleration appears in the axis components when the tolerance sphere is entered. The max. size is limited by the acceleration of the axis components and the C1 factor. 154 Version: 2.14.3 TF5100
## Page 155

Classic Dialect Reference Manual This blending can be used for all segment transitions. The subtypes 2 and 3 only work for straight line / straight line transitions. Acute angles at the segment transition The Bezier splines are generated by default, even at very acute angles. In order to avoid the dynamic values being exceeded, a considerable reduction velocity is required in this case. However, since the dynamics are held constant in the spline, the movement across the spline can be quite slow. In this case it is often practical to start the segment transition with an accurate stop. The command Auto Accurate Stop [} 158] can be used to avoid having to calculate the angles manually. 6.2.14.5 Bezier curve of the 5th order Bezier curve of the 5th order Command #set param Vertex Smoothing(<type>; <subtype>; <radius> )# Parameter <type> for the Bezier curve of the 5th order: 5 Parameter <subtype> 1: Constant tolerance radius [} 157] 2: Distance between intersection and vertex [} 157] 3: Adaptive tolerance radius [} 157] Parameter <radius> Max. radius of the tolerance sphere With 5th order Bezier blending, no step change in acceleration occurs in the axis components on entry into the tolerance sphere. In other words, the path axis acceleration is always constant if blending is selected. This blending can be used for all segment transitions. The subtypes 2 and 3 only work for straight line / straight line transitions. Acute angles at the segment transition The Bezier splines are generated by default, even at very acute angles. In order to avoid the dynamic values being exceeded, a considerable reduction velocity is required in this case. However, since the dynamics are held constant in the spline, the movement across the spline can be quite slow. In this case it is often practical to start the segment transition with an accurate stop. The command Auto Accurate Stop [} 158] can be used to avoid having to calculate the angles manually. 6.2.14.6 Old Bezier blending type Functions for compatibility with existing projects These functions are provided for compatibility reasons. For new projects Bezier curve of the 3rd order [} 154] or Bezier curve of the 5th order [} 155] should be used. Old Bezier blending with param Vertex Smoothing Command #set param Vertex Smoothing(<type>; <subtype>; <radius> )# Parameter <type> For Bezier Spline smoothing: 1 Parameter <subtype> For Bezier Spline smoothing: 1 Parameter <radius> radius of the tolerance sphere Sample 1: N10 R57=100 #set param Vertex Smoothing(1; 1;R57)# TF5100 Version: 2.14.3 155
## Page 156

Classic Dialect Reference Manual Old Bezier blending with param Spline Smoothing With the aid of smoothing, it is possible to insert a Bezier spline automatically between two geometrical entries. It is only necessary to program the radius of the tolerance sphere. This describes the maximum permissible deviation from the programmed contour in the segment transition. The advantage of this type of smoothing as opposed to rounding with an arc is that there are no step changes in acceleration at the segment transitions. The radius of the tolerance sphere can be altered at any time within the NC program, and can be switched off again by setting the radius to 0. If the radius is not reset to 0, it remains active until the next interpreter reset or Twin CAT restart. Command #set param Spline Smoothing( <radius> )# Parameter <radius> Radius of the tolerance sphere or alternatively #set param Vertex Smoothing(...) Sample 1: N10 R57=100 #set param Spline Smoothing(R57)# Sample 2: N10 G01 X0 Y0 F6000 N20 X1000 #set param Spline Smoothing(100)# N30 X2000 Y1000 N40 X3000 Y0 M30 The new parameter is valid from the transition between the subsequent two segments. In example 2, the new value for the tolerance sphere is applicable at the segment transition from N30 to N40. The diagram below shows a contour with and without spline at the segment transition. The splines are generated even at very sharp angles by default. In order to avoid the dynamic values being exceeded, a considerable reduction velocity is required in this case. However, as the dynamics are held constant, the movement across the spline can be quite slow. In this case it is often practical to start the segment transition with an accurate stop. In order to avoid manual calculation of the angles, an 'Auto Accurate Stop [} 158]' command is available which can also be initiated via the NC program. 156 Version: 2.14.3 TF5100
## Page 157

Classic Dialect Reference Manual 6.2.14.7 Subtypes Constant tolerance radius (subtype 1) If subtype 1 is selected, the maximum tolerance radius (R ) is used for blending. R is reduced if and only if TB TB the input or output segment is less than 3*R . TB Distance between intersection and vertex ( subtype 2) The distance between the programmed segment transition and the vertex of the parabola is specified with the subtype 2. The tolerance radius (R ) results from this. If a segment is too short, then the distance is TB shortened so that the tolerance radius is a max. of 1/3. Adaptive tolerance radius (subtype 3) Within the tolerance radius (including constant tolerance radius) the system ensures that the maximum permissible acceleration is not exceeded. Depending on the deflection angle and the velocity, the maximum axis acceleration within the smoothing segment may be different. The aim of an adaptive tolerance radius is maximum acceleration during smoothing. In order to achieve this, the smoothing radius is reduced based on the programmed velocity and dynamics. In other words, if the programmed velocity is changed, the tolerance radius can also change. The override has no influence on the radius. 6.2.15 Circular Smoothing It is possible with the aid of circular smoothing to insert an arc automatically between two straight lines. It is only necessary to program the radius of the arc. TF5100 Version: 2.14.3 157
## Page 158

Classic Dialect Reference Manual The radius of the circular smoothing can be altered at any time within the NC program, and can be switched off again by setting the radius to 0. Rounding must be switched off before the end of the program or a decoder stop [} 169]. Command #set param Circular Smoothing( <radius> )# Parameter <radius> Radius of the circular smoothing arc Sample: N10 R57=4.5 #set param Circular Smoothing(R57)# … #set param Circular Smoothing(0)# N1000 M02 Notice When combined with cutter radius compensation, please note that first the radius compensation is calculated, then the circular smoothing is added. The smoothing radius thus refers to the TCP. Notice The old command param Group Vertex continues to be supported. However, it cannot be used to transfer R parameters. Syntax: #set param Group Vertex(<grp>,<radius>)# The first parameter describes the group to which the circular smoothing refers. This value is currently always 1. The second parameter is used to specify the circular smoothing radius. 6.2.16 Automatic Accurate Stop Command #set param Auto Accurate Stop(<angle>)# Parameter <angle> Limit angle (in degrees) after which an accurate stop is inserted Deselect #set param Auto Accurate Stop( 0 )# An accurate stop after a defined limit angle is inserted between two segments with the aid of the 'Auto Accurate Stop' command. For circle segments, the angle is calculated from the tangents at the points of entry and leaving. Sample: #set param Auto Accurate Stop(45)# (angle in degrees) N10 G01 X1000 Y0 Z0 F60000 (start position: X0 Y0 Z0) N20 X0 Y500 ... An accurate stop is inserted between segments A and B in this example. Application field: This command should be used in conjunction with Bezier blending, if acute angles are programmed in the NC program. See also: 158 Version: 2.14.3 TF5100
## Page 159

Classic Dialect Reference Manual • Bezier curve of the 3th order [} 154] • Bezier curve of the 5th order [} 155] • 'Old' Bezier curve [} 155] Notice This function has not yet been implemented for segment transitions with a helix. 6.2.17 Delete Distance to Go Command Del DTG Cancellation End of block The Del DTG (delete distance to go) command is activated block by block via the NC program. This command enables deleting of the residual distance of the current geometry from the PLC with the function block Itp Del Dtg Ex [} 209]. In other words, if the command is issued while the block is processed, the motion is stopped with the usual deceleration ramps. The NC program then processes the next block. An error message is generated if the PLC command is not issued during the execution of a block with "delete distance to go" selected. The "delete distance to go" command always effects an implicit decoding stop, i.e. an exact positioning always occurs at the end of the block. Sample: N10 G01 X0 Y0 F6000 N20 Del DTG G01 X2000 N30 G01 X0 Notice Del DTG must not be active when cutter radius compensation is active. 6.2.18 Modulo Movements Command MOD[<axis and target modulo position>] Cancellation End of block Parameter 1 Axis for modulo operation Parameter 2 Arithmetic sign for the direction of rotation (optional) Parameter 3 Modulo position The modulo position is programmed in the same way as normal positioning. The MOD command is effective for specific blocks, and must be explicitly programmed for every axis that is selected for modulo operation. The modulo position's arithmetic sign specifies the direction of rotation. • Positive sign: The axes moves in the 'larger' direction • Negative sign: The axes moves in the 'smaller' direction • Exception: The axis cannot move to modulo -0, since zero has no sign TF5100 Version: 2.14.3 159
## Page 160

Classic Dialect Reference Manual Sample 1: N10 G90 N20 G01 MOD[X200] Y30 F600 N30 G01 X200 N20 specifies a move in a positive direction for X to modulo position 200. Y moves to absolute position 30. In block N30, X is moved absolutely to position 200, i.e. not modulo. Modulo Operation Applicable to Q-Axes The Q-axes are the auxiliary axes. The MOD command can be applied to Q-axes. E.g. N20 G01 MOD[Q4=200] Y30 F600. Modulo movements of more than 360 degrees The MOD command also allows movements of more than a 360 degrees to be made. Modulo position = number of necessary rotations * 360 + modulo position Sample 2: N10 G90 N20 G01 X3610 F6000 N30 R1=360 N40 G01 MOD[X=R1+20] In this example, the X axis moves 360 degrees to modulo position 20. Restrictions and notes of for modulo movements: • No radius compensation may be active for the modulo axis. • No zero shift may be active for the modulo axis. • During relative programming (G91 [} 129]) the modulo command is not evaluated, so that the axis referred to in square brackets is treated as if the MOD command had not been given. Modulo factor The modulo factor is constant, and is 360. 160 Version: 2.14.3 TF5100
## Page 161

Classic Dialect Reference Manual 6.2.19 Auxiliary axes Auxiliary axes (also known as Q axes) can be added to an interpolation group in addition to the actual path axes (X, Y & Z). The auxiliary axis can be seen as a type of slave for the path, i.e. it has no direct influence on the path velocity. In addition to the 3 path axes, 5 auxiliary axes can also be interpolated for each channel. The function block 'Cfg Build Ext3DGroup [} 200] ' from the library Tc2_NCI, for example, may be used for adding to the interpolation group from the PLC. Syntax The auxiliary axes are addressed as Q1.. Q5 from the part program. The numerical value may be assigned directly, or an R-parameter. Sample 1: (start position X=Y=Z=Q1=0) N10 G01 X100 Q1=47.11 F6000 ... If an NC block is programmed with one or more path axes and an auxiliary axis, both axes start simultaneously and also reach the destination together. Swiveling of the auxiliary axes The term "swiveling of the auxiliary axes" is used if the path length within a motion set is zero. This is often the case during 'swiveling' of a tool, with the feed angle relative to the contour being changed. Since the path length is zero, there is no link to the path, and the movements of the auxiliary axes are calculated via a virtual path. However, this has no influence on the real path of X, Y and Z, but here too all auxiliary axes are started simultaneously and also arrive at the destination simultaneously. Here too, the velocity is specified via the F-parameter and now refers to the auxiliary axis with the greatest travel distance. Sample 1: (start position X=Y=Z=Q1=Q2=0) N10 G01 X100 F6000 N20 Q1=100 Q2=200 F3000 ... In N20, the velocity of Q2 is now 3000 and that of Q1 is 1500, since the travel distance is Q1=Q2/2. 6.2.19.1 Calculation of the velocity Initially, only the path axes (X, Y and Z) are considered for the calculation of the path velocity. The path and the travel distance of the individual auxiliary axes result in a fixed coupling ratio for each auxiliary axis within a segment. The target velocity of the auxiliary axis is thus also known. If this velocity is greater than the permitted maximum velocity for this auxiliary axis, the path velocity is reduced until the upper speed limit is adhered to. In other words, exceeding of the velocity limits of the auxiliary axes also has an indirect effect on the path velocity. 6.2.19.2 Path velocity at segment transitions The reduction of the path velocity is explained below by means of an example. The contour of a stadium is particularly suitable for this purpose. The aim is for the feed angle of a tool relative to the path tangent to remain constant. On the stadium straight, the orientation of the tool remains constant, i.e. the tool is not turned. In contrast, the orientation relative to the base coordinate system must be changed continuously within the circle. Assuming the path velocity in the transition between straight and circle is not reduced to zero, a step change in velocity is inevitably generated for the swiveling axis (but not for the path axes!). TF5100 Version: 2.14.3 161
## Page 162

Classic Dialect Reference Manual This step change in velocity of the auxiliary axis is freely parameterizable and depends on the machine. Extreme cases would be for the path velocity at such segment transitions to be reduced to zero, or for the velocity not to be reduced at all. The global axis parameter 'Velo Jump Factor', which can be set individually for each axis, is used for the parameterization. The resulting velocity and the calculation is described in more detail in the Twin CAT NCI appendix on page Parameterisation [} 338]. Smoothing of the velocity at segment transitions As has been described above, step changes in velocity can occur at the segment transitions. The size of these steps can be affected by the Velo Jump parameter. It is further possible for a tolerance sphere to be specified for every auxiliary axis. This sphere is symmetrical with the path at a segment transition. On entering this sphere, the velocity of the auxiliary axis is continuously modified to reach the set velocity at the exit of the sphere. The step changes in velocity are, in other words, eliminated. This does imply that the auxiliary axis is subject to a positional error when it is within the sphere. On entering the sphere the change to the new target velocity of the axis starts immediately. This avoids an overshoot in position, and the position is again precise at the borders of the sphere. If it happens that the specified sphere is larger than 1/3 of the path, its radius is automatically restricted to that value. 162 Version: 2.14.3 TF5100
## Page 163

Classic Dialect Reference Manual Selection and Deselection The tolerance sphere of the auxiliary axis is an axis parameter (IO: 0x108). It can be set in Twin CAT XAE axis interface Specification Axes. Parameterization of the axis parameters The parameters described here only take effect for axes that are in the interpolation group as auxiliary axes (Q1.. Q5). For path axes (x,y,z) the parameters 'Velo Jump Factor', 'Tolerance ball auxiliary axis' and 'Max. position deviation, aux. axis' have no influence. Diagnostics It is possible to record the tolerance sphere of each auxiliary axis and the position error that results from this for diagnostic purposes. It is also possible to access the variables via ADS. They are to be found in the "Index offset" specification for Group state (Index group 0x3100 + ID) (IO: 0x54n and 0x56n). Effect on Velo Jump, if the size of the tolerance sphere is reduced If the size of the tolerance sphere has to be reduced due to the given geometry, the Velo Jump parameter is automatically adjusted for this segment transition. I.e. the path velocity in the transition is reduced more strongly. So the dynamics of the auxiliary axis is not exceeded for smaller tolerance spheres. Positional deviation of the auxiliary axis if the tolerance sphere has to be reduced The parameter 'maximum permitted positional deviation of the auxiliary axis' only takes effect if the tolerance sphere would have to be reduced due to the geometry. The aim is to keep the path velocity high despite the smaller tolerance sphere, as long as the resulting position error does not exceed a threshold value. To this end the velocity of the auxiliary axis is kept constant and the position error is calculated. If the error is smaller than the maximum positional deviation the velocity is maintained for this segment transition, and the resulting position error is compensated in the next segment (the tolerance sphere then becomes unnecessary for this segment transition). In the event that the position error would exceed the maximum deviation, the reduced tolerance sphere takes effect, including the Velo Jump factor. And the path velocity is reduced if necessary. Example 1: TF5100 Version: 2.14.3 163
## Page 164

Classic Dialect Reference Manual Initial conditions: • Set tolerance sphere: 5 • Max. positional deviation: 1 • The given geometry results in an effective tolerance sphere of 0.2, for example • The potential positional deviation is 0.3 Resultant behavior: • The path velocity remains at a constant high level • The velocity of the auxiliary axis is kept constant • For this transition no tolerance sphere is required • The resulting positional deviation is compensated in the subsequent segment Example2: Initial conditions: • Set tolerance sphere: 5 • Max. positional deviation: 1 • The given geometry results in an effective tolerance sphere of 1.2, for example • The potential positional deviation is 1.1 Resultant behavior: • The tolerance sphere is adjusted • The Velo Jump parameter is adjusted • The path velocity is reduced at the segment transition • There is no positional deviation that has to be compensated Parameterization The parameterization of the maximum permitted positional deviation is an Specification Axes. By default this feature is switched off (deviation = 0.0) 6.3 Supplementary Functions 6.3.1 M-Functions Task: Signal exchange between NC and PLC A range of equipment, such as collet chucks, drill drives, transport equipment etc. is best not driven directly by the NC, but indirectly, using the PLC as an adapting and linking controller. This makes it easy to consider feedback or safety conditions, without having to adapt the NC program, or even the NC system. The NC’s M- functions involve digital signal exchange: functions are switched on or off, activated or deactivated. The transfer of numerical working parameters is not provided for here, but can be implemented in other ways (H- functions [} 168], T-numbers [} 168] etc.). 6.3.1.1 Available M-functions Number of M-functions A total of 160 M-functions are available per channel M function Meaning 0..159 Freely definable M-functions (except 2, 17, 30) 2 Program end 17 End of subprogram 164 Version: 2.14.3 TF5100
## Page 165

Classic Dialect Reference Manual M function Meaning 30 Program end with deletion of all fast M functions All M-functions (apart from the 3 pre-defined M-functions - M2, M17, M30) are freely definable. This means that, depending on the machine type, M8 can be used to switch on a cooling medium or indeed for any other functionality, for example. The machine manufacturer can select the function as required. Like any other rules, the rules for reserved M-functions are read when Twin CAT is started. Additionally, an internal code is generated for these functions in the interpreter, which is responsible for the behavior described. These 3 M-functions therefore do not have to be described in the table. It makes sense to parameterize M2 and M30, even if M-functions are used. Priority of M-Functions in the Twin CAT 3 development environment If M-functions are defined as well in the m_defs.t<xx> file as in the development environment, only those M-functions act that are defined in the development environment. Types of M-functions Basically, two signal exchange versions are available: fast signal bits, or transfer secured by handshake. Secured Handshakes M-functions that require feedback must be processed using bi-directional signal exchange between the NC and the PLC. If an M-function of type handshake is programmed, the velocity is reduced to 0 at this point. The PLC uses the Itp Is Hsk MFunc [} 232] function to check whether an M-function with handshake is present, in which case the number of the M-function is determined via Itp Get Hsk MFunc [} 224]. The NC is in a waiting state and will not process further NC commands until the PLC has acknowledged the M-function. Processing of the NC program continues once acknowledgement has been received from the PLC (Itp Confirm Hsk [} 208]). This procedure permits the operation of the equipment controlled by the NC to be securely coordinated with the equipment controlled by the PLC. It is therefore advisable to acknowledge the M-function for starting the spindle (e.g. M3) once a minimum speed has been reached. Since this kind of M-function involves synchronous functions, it is only ever possible for one M-function with handshake to be active in the NC program. Fast signal bits If no feedback is required from the PLC, fast signal bits can be used for activating M-functions. Since the NC does not have to wait for the PLC with these M-functions, look-ahead [} 127] can combine the segments. In this way it is possible to apply an M-function without velocity reduction. A fast M-function can be detected in the PLC via Itp Is Fast MFunc. This makes it possible to start any action from the PLC during a movement (laser on/off, cutter on/off, …). Afterwards the M-function has to be reset with Itp Reset Fast MFunc Ex. This makes it possible to use the M-function more than once. A combination of fast signal bits and handshake is also possible. Since a handshake always requires acknowledgement from the PLC, the velocity has to be reduced to 0 in this case. 6.3.1.2 Resetting of M-functions Resetting fast signal bits The signal bits are active until they are reset explicitly, or until an M30 (end of program) or channel reset is executed. Resetting with reset list Each M-function can reset up to 10 fast M-functions. If cooling medium is switched on with M8, for example, the cooling medium can be switched off again with M9. To this end simply enter M8 in the reset list for M9. TF5100 Version: 2.14.3 165
## Page 166

Classic Dialect Reference Manual Resetting a Fast M-Function Requires a Fast M-Function A fast M-function can be reset only by a fast M-function. There is no alternative possibility in this case to reset a fast M-function by a non-fast handshake M-function. Automatic reset During parameterization of the M-function an 'auto-reset flag' can be set. This means that the M-function is automatically reset at the end of the block. In order for the PLC to be able to see the signal, the duration of the motion block must be long enough, or this M-function is combined with a handshake. The handshake may come from the same or a different M- function. Reset from the PLC The fast M-functions can be reset from the PLC via the Itp Reset Fast MFunc [} 297] function block. For reasons of transparency, mixed resets using via PLC and NC should be avoided. Delete all pending M-functions A channel stop and a channel reset are used to reset all pending M-functions. This is true for the 'handshake' type M-functions, and also for the fast signal bits. If the NC program is terminated properly with M30, all M- functions are also cleared. 6.3.1.3 Parameterization of M-functions The M-functions are parameterized in Twin CAT XAE. A dedicated M-function table is used for each interpolation channel. Activation of the Twin CAT configuration is required to enable a configuration of M-functions. 166 Version: 2.14.3 TF5100
## Page 167

Classic Dialect Reference Manual No Number of M-function to be parameterized. The value must be between 0 and 159 HShake If a value other than 'None' is entered, the M-function is of type 'Handshake' • None: No handshake • BM (Before Move): If a movement is programmed in the same block, the handshake is completed before the movement • AM (After Move): If a movement is programmed in the same block, the handshake is completed after the movement Fast If a value other than 'None' is entered, a 'fast signal bit' type M-function is executed • None: No fast M-function is executed • BM (Before Move): If a movement is programmed in the same block, the output is completed before the movement. • AM (After Move): If a movement is programmed in the same block, the output is completed after the movement. • BMAuto Reset (Before Move & Automatic Reset): If a movement is programmed in the same block, the output is completed before the movement. In addition, the M-function is automatically canceled at the end of the block, i.e. the M-function is active on a per-block basis. In order to ensure that the PLC recognizes the M-function, the duration of the associated motion block must be long enough (at least 2 PLC cycles), or an additional M-function with handshake should be programmed. • AMAuto Reset (After Move & Automatic Reset): This parameterization is only meaningful if either an M- function of type handshake is programmed at the same time (or parameterized), or if the M-function is only used for resetting other M-functions. Without an additional handshake the PLC will usually not be able to detect this M-function. • All other combinations can be selected for compatibility reasons. Reset TF5100 Version: 2.14.3 167
## Page 168

Classic Dialect Reference Manual Up to 10 M-functions can be entered for cancellation when a reset is called. Notice In the event that no reset-signal-bit is in fact set, the bits to be cleared are reset immediately before setting the new signal bits. Import/Export The M-functions are parameterized individually for each channel. The parameterization can be transferred to other channels via the import/export function. 6.3.1.4 Combination of M functions • Within each line, only one 'handshake' type M function must be programmed! • Within a single line, up to 10 'signal bit' M functions may be programmed • A combination of the two options above is allowed Sample: N10 G01 X1000 F60000 N20 M10 M11 M12 X2000 (M10 & M11 are signal bits) (M12 is of type handshake) M30 Examples of meaningful and practically applicable rule combinations: • An M-function is to be active for the duration of a movement and then be automatically cleared. Select 'None' in the HShake column and 'BMAuto Reset' in the Fast column. The signal bit generated could, for instance, control a glue application valve. • An M-function starts a drill motor, and the subsequent movements may only be started after an appropriate run-up time, and then only when the drill is ready for operation. Select 'BM' in the HShake column. The PLC acknowledges the request after a certain delay time and only if the frequency converter is ready for operation. • A drill motor is started with an M-function. In order not to have to wait for the drive to run up, the M- function is programmed in the block before the one for the drill movement. In the following movement (the drill movement itself) it is however still essential to ensure that the drive has reached its full rotation speed. For this variant either two different M-functions have to be used (lead signal as signal bit, safety query as handshake) or a Fast 'BMAuto Reset' and HShake 'AM' M-function is used. 6.3.1.5 Behavior in case of an error If a runtime error occurs during the execution of an NC program (e.g. following error monitoring is activated), the NC program is interrupted. In this case the M functions, provided they are set, remain pending. This means that the PLC program may have to ensure that M functions are not executed. 6.3.2 H, T and S Parameters H-, T- and S-parameters are used to transfer parameters from the NC interpreter to the PLC. In this context the H-parameter stands for auxiliary parameter and is of type DINT (32 bit signed). The T and S parameters are of type WORD, and stand for Tool and Spindle. Sample: H=4711 R1=23 S=R1 T4711 Notice No R-parameter can be assigned for the T-parameter. Furthermore, the assignment is made without assignment operator ('='). T- and S-parameters take effect at the start of a block, H-parameters take effect at the end of the programmed block. 168 Version: 2.14.3 TF5100
## Page 169

Classic Dialect Reference Manual 6.3.3 Decoder stop Code Function @714 [} 169] Decoder stop @716 [} 169] Decoder stop with axis position rescan @717 [} 170] Decoder stop with trigger event, conditional decoder stop 6.3.3.1 Decoder stop (@714) The interpreter offers the option to execute a decoder stop in the NC program. In this case the interpreter waits until a certain external event occurs. Execution of the NC program does not continue until this event has taken place. A decoder stop can be used, for instance, to switch block skipping [} 127] on or off from the PLC, or to re- assign R parameters [} 134]. Two events are available for continuing processing: • Acknowledgement of an M-function [} 164] • SAF task is empty Acknowledgement of an M-function Decoding of the NC program is interrupted until the M-function [} 164], which is programmed immediately prior to the decoder stop, is acknowledged. In other words, the M-function must be of type "handshake". Sample 1: N10... N20 M43 (M-function with handshake) N30 @714 (decoder stop) N40 ... SAF task is empty The decoder stop does not necessarily have to be programmed in conjunction with an M-function. If the SAF task runs out of travel commands, an event is sent to the interpreter. This event causes the interpreter to start up again. Notice The decoder stop must not be programmed when the tool compensation or circle smoothing are active, because they wouldn`t work anymore. 6.3.3.2 Decoder Stop with Axis Position Rescan (@716) In addition to the common decoder stop (see Decoder stop (@714) [} 169]), there is a decoder stop at which the axis positions of the interpolation channel are read again. This stop is required, if, for example, axes are moved during a tool change via PTP and are subsequently not returned to the old position. Another possible application is a change in axis configuration via an M function (with handshake). If a decoder stop with rescan is programmed, it is essential to program an M-function with handshake immediately before it. Sample 2: N10... N20 M43 (M function with handshake carries out a tool change, for example) N30 @716 (Decoder stop with rescan) N40 ... Notice The decoder stop must not be programmed when the tool compensation or circle smoothing are active, because they wouldn`t work anymore. TF5100 Version: 2.14.3 169
## Page 170

Classic Dialect Reference Manual 6.3.3.3 Decoder Stop with external trigger event (@717) Sometimes the question of whether the NC part of the program must wait or can continue may depend, for instance, on events in the PLC. With the two types of M-functions [} 164] this can give rise to the following problems: • Handshake: Because of the M-function's handshake the path velocity must be brought to zero at the location where the M-function is programmed, after which confirmation is awaited from the PLC. • On The Fly (also known as a fast M-function): Because no confirmation from the PLC is waited for, there is also no way for the partial program to wait for the PLC. • Even a combination of the two types of M-function does not help here. Sample: During positioning with a flying M-function, a process A is initiated by the NC partial program. It is assumed here that the set of processes in the NC program is typically long enough for process A to be completed in the PLC. If A is ready, then the NC partial program should execute the next segment with look-ahead. In case A is not ready, however, then the NC should stop at the end of the segment and wait until process A has finished. It is exactly this scenario that can be implemented with the command @717. The PLC here sends the so-called 'Go Ahead [} 229]' command when process A has finished. N10 ... N20 G0 X0 Y0 Z0 N30 G01 X500 F6000 N40 M70 (flying M-function that triggers process A) N50 G01 X700 N60 @717 (decoder stop with external trigger event) N70 G01 X1000 N80 ... If the Go Ahead signal reaches the PLC early enough, then blocks N50 and N70 are linked by look-ahead, and the path velocity is not then reduced. If the signal arrives during the deceleration phase of N50, then the velocity is once more increased. Otherwise, the machine waits for the signal from the PLC. Notice The decoder stop must not be programmed when the tool compensation or circle smoothing are active, because they wouldn`t work anymore. The function block 'Itp Go Ahead Ex' returns the error code 0x410A, if no @717 is present in the interpreter at the time of the call. 6.3.4 Jumps Code Function @100 [} 170] Unconditional jump @121 [} 171] Jump if unequal @122 [} 171] Jump if equal @123 [} 171] Jump if less or equal @124 [} 171] Jump if less @125 [} 171] Jump if greater or equal @126 [} 171] Jump if greater @111 [} 171] Case block Unconditional jump Command @100 Parameter K or R The parameter describes the jump destination. This must have an indication of direction ('+' or '-'). Sample 1: 170 Version: 2.14.3 TF5100
## Page 171

Classic Dialect Reference Manual N10 .. ... N120 @100 K-10 In this example, execution continues from line 10 after line 110 has been interpreted. The sign indicates the direction in which the line to be searched can be found. Jump if unequal Command @121 Parameter 1 R<n> Comparison value Parameter 2 K or R<m> Comparison value Parameter 3 K Jump destination with direction indication Sample 2: N10 .. ... R1=14 N120 @121 R1 K9 K-10 N130 ... Jump if equal cf. Jump if not equal [} 171] Jump if less or equal cf. Jump if not equal [} 171] Jump if less cf. Jump if not equal [} 171] Jump if greater or equal cf. Jump if not equal [} 171] Jump if greater cf. Jump if not equal [} 171] Case block Command @111 Parameter 1 R<n> Comparison value Parameter 2 K or R<m> First comparison value Parameter 3 K First jump destination Parameter 4 K or R<m> Second comparison value ... Sample 3: N100 R2=12 (R2=13) (R2=14) N200 @111 R2 K12 K300 K13 K400 K14 K500 N300 R0=300 N310 @100 K5000 N400 R0=400 N410 @100 K5000 N500 R0=500 TF5100 Version: 2.14.3 171
## Page 172

Classic Dialect Reference Manual N510 @100 K5000 N5000 M30 A case block is made in line 200. If R2 = 12 a jump is made to line 300. If R2 = 13, the jump destination is line 400. If R2 = 14, the jump destination is line 500. In the event that none of the conditions is satisfied, execution simply continues with the next line (in this case, line 300). 6.3.5 Loops The various types of loop are described below. Code Loop type Aborting condition @131 While Loop [} 172] while equal @132 While Loop [} 172] while not equal @133 While Loop [} 172] while greater @134 While Loop [} 172] while greater or equal @135 While Loop [} 172] while less @136 While Loop [} 172] while less or equal @141 Repeat Loop [} 173] repeat until equal @142 Repeat Loop [} 173] repeat until not equal @143 Repeat Loop [} 173] repeat until greater @144 Repeat Loop [} 173] repeat until greater or equal @145 Repeat Loop [} 173] repeat until less @146 Repeat Loop [} 173] repeat until less or equal @151 For-To Loop [} 173] @161 For-Down To Loop [} 173] Loops can be nested. While loops Command @13<n> where 1<= n <= 6 Parameter 1 R<m> Comparison value Parameter 2 K or R<k> Comparison value Parameter 3 K Jump destination for the case that the condition is not met A while loop is executed for as long as the condition is satisfied. The test is made at the beginning of the loop. If the condition is not or no longer met, a jump to the specified line takes place (parameter 3). At the end of the While loop an unconditional jump (@100 [} 170]) must be programmed. The target of this jump is the line number of the while loop. The loop’s exit condition is specified with <n>. Sample 1: N100 R6=4 N200 @131 R6 K4 K600 (K600 is the target of the jump, when the condition is no longer satisfied) N210 ... N220 @100 K-200 N600 ... N5000 M30 172 Version: 2.14.3 TF5100
## Page 173

Classic Dialect Reference Manual The loop (lines 200 to 220) is repeated for as long as R6 = 4. Once the condition is no longer satisfied, execution jumps to line 600. Repeat loops Command @14<n> where 1<= n <= 6 Parameter 1 R<m> Comparison value Parameter 2 K or R<k> Comparison value Parameter 3 K Jump destination at the start of the loop In a repeat loop, the interrogation takes place at the end of the loop. This means that the loop is executed at least once. The loop is only ended, to continue with the rest of the program, when the condition is satisfied. Sample 2: N200 ... N210 ... N300 @141 R6 K25 K-200 The loop is repeated until R6 = 25. The second constant in line 300 gives the jump target (the start of the loop). For-To loops Command @151 <variable> <value> <constant> A for-to loop is a counting loop that is executed until the variable equals the value. The test is made at the beginning of the loop. If that condition is satisfied, execution jumps to the line specified by the constant. The variable must be incremented (@620) at the end of the loop, and there must be an unconditional jump to the start of the loop. Sample 3: N190 R6=0 N200 @151 R6 K20 K400 N210 ... N290 @620 R6 (increment R6) N300 @100 K-200 For-Downto Loops Command @161 <variable> <value> <constant> A for-downto loop is a counting loop. The behaviour is similar to that of a for-to loop. The difference is merely that the variable is decremented (@621) by 1 at the end of the loop. 6.3.6 Subroutine techniques As in other fields, it is also valuable in NC programming to organize frequently used command sequences as subroutines. This makes it possible to employ pre-prepared and tested functions in various workpiece programs. Subroutines are identified within a program by a number. This number must be unique: there must be only one subroutine with a particular number (1..>2.000.000.000). As interpretation proceeds, the calling program is suspended. The text of the subroutine is worked through, as often as necessary. Processing then returns to the calling program after the call location. It is of course possible for one subroutine to call another subroutine. This call is executed in a similar way. This causes a stack of return information to be created. For technical reasons this nesting of subroutines is presently limited to 20 levels. TF5100 Version: 2.14.3 173
## Page 174

Classic Dialect Reference Manual Definition of a Subroutine The code for a subroutine can be written to the same file as the calling program. In this case the subroutine is linked directly: it is automatically also loaded as the file is read. If it is to be made generally available then it must be written in its own file that must be located in the CNC directory. The name of the file begins with the letter 'L', and continues with a string of digits. This digit string must repeat the subroutine number, without any leading '0's. The code should contain a label to indicate the starting point of the subroutine. Like the file name, it consists of the letter 'L' and the digit sequence described above. The interpreter starts immediately after this label. Subroutine syntax: (Datei L2000. NC) L2000 N100... N110... ... N5000 M17 (return command) Calling a Subroutine The following syntax must be used to call a subroutine from some block within the NC program. It is important that the expression "L2000" does not stand at the start of the line, in order to avoid confusion with a subroutine label. (syntax of the subroutine call) N100 L2000 In the following sample the expression "P5" causes the subroutine to be repeated 5 times. (n-fold subroutine call (here: 5- fold)) N100 L2000 P5 Dynamic subroutine call In some cases the subroutine to be called is not known until runtime. In this case the subroutine can be called with an R-parameter, thereby avoiding the need for a CASE instruction. The value for R must be allocated or calculated in a dedicated line. (Dynamic call of a subroutine) N099 R47=R45+1 N100 L=R47 Parameter passing Parameters are passed to subroutines with the aid of R-parameters [} 134]. Note that R-parameters are not saved automatically (see Rescuing R-parameters [} 134]). Use of Parameters R-parameters can, in general, be freely used within subroutines. This has a number of consequences that can lead to errors if they are not borne in mind. On the other hand their careful use offers the NC- programmer a range of useful working techniques. Results of Subroutines If an R-parameter is changed without its contents being saved and restored, the change is effective after a return from the subroutine. If this was not intended, the result can be machine behavior that was not planned. This feature can however be deliberately used in order to make the continuation of the processing dependent on the results of a subroutine. No restriction need be considered here other than those on the R- parameters. Sample: 174 Version: 2.14.3 TF5100
## Page 175

Classic Dialect Reference Manual N100 L2000 N110 R2=R3+R4 ... N999 M30 L2000 N10 R3=17.5 N20 R4=1 N99 M17 Values are specified here in a subroutine. The values are then used in the calling program. Ending a Subroutine A subroutine is ended with M17. 6.3.7 Dynamic Override Command Dyn Ovr=<value> or Dyn Ovr = R<n> Cancellation Dyn Ovr=1 Sample: N10 G01 X100 Y200 F6000 N20 Dyn Ovr=0.4 N30 G01 X500 'Dyn Ovr' can be used to make percentage changes to the dynamic parameters of the axes in the group while the NC program is running. This also results in new values for the motion dynamics. The new dynamic values become valid, without any stop, when the line is executed. This means, for the example illustrated above, that in block 10 the old values will still be used for the deceleration, while the new values will be used for acceleration in block 20. Scope of Definition 0 < Dyn Ovr ≤ 1 See also change in path dynamics [} 175]. 6.3.8 Altering the Motion Dynamics Command #set param Path Dynamics Parameter <acc> Value of the maximum permitted path acceleration in mm/s^2. Parameter <dec> Value of the maximum permitted deceleration in mm/ s^2. Parameter <jerk> Value of the maximum permitted jerk in mm/s^3. Sample: N10 G01 X100 Y200 F6000 N15 R4=3000 N20 #set param Path Dynamics( 700; 700; R4 )# N30 G01 X500 The 'param Path Dynamics' command can be used to alter the motion dynamics as the NC program is running. The new dynamic values become effective as from the line in which they are programmed. For the example illustrated, this means that the whole of block 10 is still treated with the default values. The new parameters are used for block 30 from the start of the segment. This command limits all path axes to the parameterized dynamic values, although the path itself can have higher dynamics, depending on its orientation. The dynamics of auxiliary axes remains unchanged. See also dynamic override [} 175]. TF5100 Version: 2.14.3 175
## Page 176

Classic Dialect Reference Manual Notice The dynamic values changed via the NC program remain active until the interpreter is next reset and/or Twin CAT has been restarted. Notice The old command 'param Group Dynamics' continues to be valid. However, it cannot be used to transfer R parameters. Command #set param Group Dynamics(<grp>,<acc>,<dec>,<jerk>)# Parameter <grp> Group for which the alteration of the motion dynamics is to be effective. Presently always 1. Parameter <acc> Value of the maximum permitted path acceleration in mm/s^2. Parameter <dec> Value of the maximum permitted deceleration in mm/ s^2. Parameter <jerk> Value of the maximum permitted jerk in mm/s^3. Sample: N10 G01 X100 Y200 F6000 N20 #set param Group Dynamics( 1, 700, 700, 3000 )# N30 G01 X500 Change in axis dynamics Command #set param Axis Dynamics Parameter <axis> Axis in the interpolation group: X: 0 Y: 1 Z: 2 Q1: 3 ... Q5: 7 Parameter <acc> Value of the maximum permitted acceleration in mm/ s^2 Parameter <dec> Value of the maximum permitted deceleration in mm/ s^2. Parameter <jerk> Value of the maximum permitted jerk in mm/s^3. Sample: N10 G01 X100 Y200 F6000 N15 R4=30000 N20 #set param Axis Dynamics( 0; 1500; 1400; R4 )# N30 G01 X500 'param Axis Dynamics' can be used to change the axis dynamics at runtime. Generally the behavior is the same as for 'param Path Dynamics', except that here the dynamics can be specified individually for each axis. 6.3.9 Change of the Reduction Parameters C0 reduction [} 176] C1 reduction [} 177] C2 reduction [} 178] C0 reduction In some types of machine it is not absolutely necessary to reduce the path velocity to 0 at knee-points. 2 reduction methods are available • Velo Jump • Deviation Angle 176 Version: 2.14.3 TF5100
## Page 177

Classic Dialect Reference Manual Velo Jump Command #set param Velo Jump( <C0X>; <C0Y>; <C0Z> )# Parameter <C0X> Reduction factor for C0 transitions: X axis: C0X ≥ 0.0 Parameter <C0Y> Reduction factor for C0 transitions: Y axis: C0Y ≥ 0.0 Parameter <C0Z> Reduction factor for C0 transitions: Z axis: C0Z ≥ 0.0 The 'param Velo Jump' command can be used to alter the velocity step change factors as the NC program is running. The new values come into effect via the block execution in the programmed line. You can find further details of the means of operation in the appendix under Parameterization [} 338]. Sample: N10 G01 X100 Y200 F6000 N20 R2=4.5 N30 #set param Velo Jump( 1.45; R2; R2 )# N40 G01 X500 Resetting parameters The Velo Jump parameters changed via the NC program remain active until the interpreter is next reset and/or Twin CAT has been restarted. Deviation Angle (not yet released) Command #set param Dev Angle( <C0Factor>; <Angle Low>; <Angle Heigh> )# Parameter <C0Factor> Path reduction factor for C0 transitions: 1.0 ≥ C0 ≥ 0.0 Parameter <Angle Low> Angle in degrees from which reduction takes effect: 0 ≤ φ_l < φ_h ≤ π Parameter <Angle Heigh> Angle in degrees from which reduction to v_link = 0.0 takes effect: 0 ≤ φ_l < φ_h ≤ π The 'param Dev Angle' command is used to describe the parameters for the C0 reduction. In contrast to the Velo Jump reduction method, in which the velocity step change is influenced directly, in the Deviation Angle method the velocity step change depends upon the angle. You can find further details of the means of operation in the appendix under Parameterization [} 338]. Sample: N10 G01 X100 Y200 F6000 N20 #set param Dev Angle(0.15; 5; 160 )# N30 G01 X500 Resetting parameters The Deviation Angle parameters changed via the NC program remain active until the interpreter is next reset and/or Twin CAT has been restarted. C1 reduction factor Command #set param C1Reduction Factor( <C1Factor> )# Parameter <C1Factor> C1 reduction factor The 'param C1Reduction Factor' command is used to change the C1 reduction factor while the NC program is running. The new parameter comes into effect at the segment transition at which the reduction factor is programmed. In the example shown, the new value for the C1 reduction is therefore already effective in the segment transition from N10 to N30. A floating point value or an 'R parameter' can be provided as parameter. You can find further details of the means of operation in the appendix under Parameterization [} 338]. TF5100 Version: 2.14.3 177
## Page 178

Classic Dialect Reference Manual Sample: N10 G01 X100 Y200 F6000 N20 #set param C1Reduction Factor( 0.45 )# N30 G01 X500 Resetting parameters The C1 reduction factor changed via the NC program remains active until the interpreter is next reset and/or Twin CAT has been restarted. C2 reduction factor Command #set param C2Reduction Factor( <C2Factor> )# Parameter <C2Factor> C2 reduction factor The 'param C2Reduction Factor' command is used to change the C2 reduction factor while the NC program is running. The command takes effect in the segment transition for which the reduction factor is programmed. In the example shown, the new value for the C2 reduction is therefore already effective in the segment transition from N10 to N30. A floating point value or an 'R parameter' can be provided as parameter. Sample: N10 G01 X100 Y200 F6000 N20 #set param C2Reduction Factor( 1.45 )# N30 G01 X500 Resetting parameters The C2 reduction factor changed via the NC program remains active until the interpreter is next reset and/or Twin CAT has been restarted. 6.3.10 Change of the Minimum Velocity Command #set param Velo Min( <Velo Min> )# Parameter <Velo Min> Minimum path velocity The 'param Velo Min' command can be used to alter the minimum path velocity while the NC program is running. The new velocity comes into effect via the block execution in the programmed line. A floating point value or an 'R parameter' can be provided as parameter. Sample: N10 G01 X100 Y200 F6000 N20 #set param Velo Min( 2.45 )# N30 G01 X500 Resetting parameters The minimum velocity changed via the NC program remains active until the interpreter is next reset and/or Twin CAT has been restarted. Programming the velocity The unit of velocity is mm/sec and is therefore equivalent to the usual XAE units. 6.3.11 Read Actual Axis Value Command @361 Parameter 1 R<n> R parameter to which the actual axis value is assigned 178 Version: 2.14.3 TF5100
## Page 179

Classic Dialect Reference Manual Parameter 2 K<m> Constant for the axis coordinate that is to be read 0: X axis 1: Y axis 2: Z axis 3: Q1 axis 4: Q2 axis . . . 7: Q5 axis Sample 1: N10 G0 X0 Y0 Z0 F24000 N30 G01 X1000 N40 @361 R1 K0 (read position of x axis) N50 R0=X N60 G01 X=R0+R1 N70 M30 A decoder stop is implicitly executed by @361 command. This ensures that, in this example, the position is read when block N30 has been processed. A possible application would be in combination with the deletion of any remaining travel. Read actual axes value without decoder stop Command #get Path Axes Pos( R<a>; R<b>; R<c> )# Parameter 1 R<a> R parameter to which the actual axes value of the X axis is assigned Parameter 2 R<b> R parameter to which the actual axes value of the Y axis is assigned Parameter 3 R<c> R parameter to which the actual axes value of the Z axis is assigned The command #get Path Axes Pos( )# reads the current actual positions of the path axes (X, Y & Z). It behaves similarly to @361, with the difference that this command does not trigger an implicit decoder stop. This means that the programmer must himself ensure that at the time when the command is being processed in the interpreter the axes have not yet moved, or else a decoder stop (@714) must be programmed in the block before this command. #get Path Axes Pos( )# is an alternative to @361, but it is linked to certain specific conditions. Sample 2: @714(optional) N27 #get Path Axes Pos( R0; R1; R20 )# Notice If a path axis is not assigned (e.g. no axis is assigned to Z) the value 0 is passed to the associated R parameter. 6.3.12 Skip virtual movements Command #skip Virtual Movements(<parameter>)# Parameter 0 (default): virtual movements are “completed”. 1: Virtual movements are skipped Movements of unavailable but programmed main axes (X, Y & Z) can be skipped with the command 'skip Virtual Movements'. Sample: TF5100 Version: 2.14.3 179
## Page 180

Classic Dialect Reference Manual The interpolation group (Cfg Build Group) contains only assignments for the X and Y axis. The Z axis is not assigned, but programmed in the parts program. (Startposition X0 Y0 Z0) N10 #skip Virtual Movements(1)# N20 G01 X100 Y200 F6000 N30 G01 Z1000 (virtual movement, because z is not assigned) N40 G01 X500 Segment N30 is skipped during execution of this program. 6.3.13 Messages from NC program Command #MSG (<message level>; <mask>; "<text>" )# <message level> • ITP The message is issued from the interpreter. This means that the message generally appears well before the execution in the NC kernel. • NCK The message is issued from the NC kernel when the NC block is executed. This means it appears at the same time as the block execution (SAF) <mask> STRING <text> the text to be displayed N10 G0 X0 Y0 N20 G01 X100 Y0 F6000 N30 #MSG( NCK; STRING; "this is a text")# N40 G01 X200 Y-100 The text can not be used to transfer further parameters (e.g. R-parameters). Internally the message is handled like a note. 6.4 Tool Compensation 6.4.1 Tool Data The NC has 255 memory locations (D1.. D255) available for each channel for tool data. The parameters for the tool data can be written directly in the XAE. The data is saved as an ASCII file (<channel ID>.wz) which is kept in the Twin CAT\CNC directory. These files are automatically loaded when Twin CAT is started. 180 Version: 2.14.3 TF5100
## Page 181

Classic Dialect Reference Manual Currently two tool types are supported: • Drills • Shaft Cutters The relevant columns (parameters) for this type of tool are described below. Drills Parameter Meaning 0 Tool number When this D-word is called, a tool number that is specified here can be given at the same time. 1 Tool type The drill is type 10. 2 Geometry: Length Describes the length of the drill. 5 Wear: Length Describes the wear on the drill. The wear has to be given as a negative value, since it is added to the length. 8 Cartesian tool displacement [} 183] in X direction 9 Cartesian tool displacement in Y direction 10 Cartesian tool displacement in Z direction Shaft Cutters Parameter Meaning 0 Tool number When this D-word is called, a tool number that is specified here can be given at the same time. 1 Tool type The shaft cutter is type 20 TF5100 Version: 2.14.3 181
## Page 182

Classic Dialect Reference Manual Parameter Meaning 2 Geometry: Length Length of the shaft cutter. 4 Geometry: Radius 5 Wear: Length 7 Wear: Radius 8 Cartesian tool displacement [} 183] in X direction 9 Cartesian tool displacement in Y direction 10 Cartesian tool displacement in Z direction Writing of tool data Editing tool data with the XAE As already mentioned, the tool data can be written directly from the XAE. To do this, edit the window shown above. Parameterization of tool data via the PLC In addition, tool data can be read and written from the PLC with the function block Itp Write Tool Desc Ex [} 258]. Writing tool data from the parts program In some applications, it is more convenient to write the tool data directly from the part program. The tool set to be overwritten must not be active during the write process. This means, for example, if tool radius compensation with parameter set D10 is active, this cannot be overwritten, as long as D10 is still selected. Command #set Tool Param(<Zeile>; <Spalte>;<Wert>)# Parameter <line> Describes the tool parameter line (1..255) Corresponds to the D number Parameter <column> Column to be written (0..15) Parameter <value> Parameter value to be transmitted Sample: N10 G0 X0 Y0 Z0 N20 G01 X100 F60000 N30 R1=10 R2=4 R3=20.3 N40 #set Tool Param(10; 0; 5)# #set Tool Param(10;1;20)# N50 #set Tool Param(R1; R2; R3)# N60 G41 X200 Y D10 ... Notice No formulas may be transmitted as parameters. Writing of the tool data does not require a decoder stop. Reading tool data from the parts program This command can be used to assign tool data to an R-parameter. Command #get Tool Param(<line>; <column>;<R-Param>)# Parameter <line> Writes to the tool parameter line (1..255); this corresponds to the D number Parameter <column> Column to be written (0..15) Parameter <R-Param> R-parameter in which the date is entered Sample: N10 G0 X0 Y0 Z0 N20 G01 X100 F60000 N30 R1=10 R2=4 182 Version: 2.14.3 TF5100
## Page 183

Classic Dialect Reference Manual N40 #get Tool Param(10; 0; R5)# #get Tool Param(10;1;R20)# N50 #get Tool Param(R1; R2; R3)# N60 G41 X200 Y D10 ... Notes: Notice No formulas may be transmitted as parameters. Reading of the tool data does not require a decoder stop. 6.4.2 Selecting and Deselecting the Length Compensation Length compensation can only be selected when G0 [} 136] or G1 [} 137] are in effect. The working plane [} 130] must be selected to which the length compensation is perpendicular. The feed direction is specified with P (see working plane and feed direction [} 130]). To effect the movement corresponding to the length compensation, the axis concerned must at least be mentioned. Sample: N10 G17 G01 X0 Y0 Z0 F6000 N20 D1 X10 Y10 Z N30 ... N90 M30 Notice Length correction is automatically selected when cutter radius compensation [} 186] is selected. To deselect length correction, D0 has to be programmed. It is again here necessary to at least mention the axis concerned in order to move to the new position. 6.4.3 Cartesian Tool Translation Cartesian tool displacement refers to an offset between the reference point of the tool carrier and the reference point of the tool itself. In many cases, these reference points have the same location, so that a 0 can be entered for the tool displacement. Parameter The parameters for a translation are entered into the tool data [} 180] in the same way as the tool length etc. Parameters 8 to 10 are available for this purpose. Here • P8 always describes the X-component • P9 always describes the Y-component • P10 always describes the Z-component independently of the choice of level. TF5100 Version: 2.14.3 183
## Page 184

Classic Dialect Reference Manual Selecting and deselecting Cartesian tool displacement As in the case of length compensation, tool displacement is switched on with D<n> (n>0). In order to travel to the translated location, the axes must at least be named. This means that the displacement affects the positioning when the axis is called for the first time. It is also possible for a new final position to be entered for the axis. The function is switched off with D0. Here again, it is necessary for the axes at least to be named, if the axes are to travel to their new co-ordinates. Sample 1: N10 G17 G01 X0 Y0 Z0 F6000 N20 D1 X10 Y10 Z (Z-Axis is repositioned) N30 ... N90 M30 Sample 2: N10 G17 G01 X0 Y0 Z0 F6000 N20 D1 X10 Y10 (Z-Axis is not moved) N30 ... N90 M30 Using tool displacement and rotation If the Cartesian tool displacement is used in combination with rotation [} 148], then the compensation will only be correct if the aggregate (the tool carrier) is also rotated through the same angle. Application sample It often happens that a processing machine's tool carrier contains a number of tools. The appropriate tool is pneumatically activated according to the kind of machining required. Since, however, the tools are located at different positions, Cartesian tool displacement is required. 184 Version: 2.14.3 TF5100
## Page 185

Classic Dialect Reference Manual Tool parameters Parameter Value 0 0..65535 1 10 2 40 5 0 8 100.0 9 0.0 10 50 Behavior with incremental dimension notation Default behavior If a new tool offset (and also length compensation) is selected in incremental dimensions (G91), then the compensation is applied once the axis is named. Sample 3: (Tooloffset D1: X10 Y20 Z30) N10 G01 D1 X100 Y0 Z0 F6000 N20 G91 (incremental dimension) N30 D2 (Tooloffset D2: X100 Y200 Z300) N30 Z10 N40 ... Command Description Tool Offset Inc On The tool displacements and length compensations are also applied under G91 once the axis is named. (standard setting) Tool Offset Inc Off The tool displacement and length compensation are not applied under G91. Sample 4: (Tooloffset D1: X10 Y20 Z30) N05 Tool Offset Inc Off N10 G01 D1 X100 Y0 Z0 F6000 N20 G91 (incremental dimension) N30 D2 (Tooloffset D2: X100 Y200 Z300) N30 Z10 N40 ... In N10 the Tooloffset is applied to all 3 axes. I.e. the axes move in the machine coordinate system (MCS) to X110 Y10 Z30. In N30 the new Tooloffset of the Z-axis is not applied. This results in MCS X110 Y10 Z40. See also Zero Shift Inc On/Off [} 142] TF5100 Version: 2.14.3 185
## Page 186

Classic Dialect Reference Manual 6.4.4 Cutter Radius Compensation 6.4.4.1 Miller/Cutter Radius Compensation Off Miller/Cutter Radius Compensation Off Command G40 (standard setting) Cancellation G41 [} 186] or G42 [} 187] The G40 function switches the miller/cutter radius compensation off. The length radius compensation [} 183] will still remain active until it is switched off with D0. Between G40 and end of program it is madatory to program at least one geometry element. 6.4.4.2 Miller/cutter radius compensation left Miller/cutter radius compensation left Command G41 Cancellation G40 [} 186] The function G41 switches on the miller/cutter radius compensation. The tool is located to the left of the workpiece in the direction of movement. As has already been seen for the length compensation [} 183], the cutter radius compensation can only be activated when G0 [} 136] or G1 [} 137] is in effect. The axes of the plane must be driven when the cutter radius compensation is selected. Sample: N10 G17 G01 X0 Y0 Z0 F6000 N20 G41 X10 Y20 Z D1 N30 X30 N40 G40 X10 Y10 Z N50 M30 Cutter radius compensation does not apply to full circles The cutter radius compensation does not support full circles. Full circles have to be split into semicircles, for sample. Notes: • The cutter radius compensation should be deactivated before the end of the NC program, in order to close it properly. Between G40 and end of program it is mandatory to program at least one geometry element. • If a decoder stop [} 169] is programmed, cutter radius compensation has to be disabled first. • For arcs, radius compensation can lead to a change in the path velocity at the contour. See also 'Path velocity in arcs [} 191]'. • See Orthogonal contour approach/departure [} 191]. 186 Version: 2.14.3 TF5100
## Page 187

Classic Dialect Reference Manual 6.4.4.3 Miller/cutter radius compensation right Miller/cutter radius compensation right Command G42 Cancellation G40 [} 186] The function G42 switches on the miller/cutter radius compensation. The tool is located to the right of the workpiece in the direction of movement. Cutter radius compensation does not apply to full circles The cutter radius compensation does not support full circles. Full circles have to be split into semicircles, for sample. Notice If a change is to be made from G41 to G42, then a G40 should be programmed between the two movements. 6.4.4.4 Departure and approach behavior of the miller/cutter radius compensation This chapter describes the approach and departure behavior when the miller/cutter radius compensation is switched on or off. This behavior depends on the start position and cannot be influenced in any other way. After the radius compensation is switched on, it must be applied. This means the cutter is at one point P1 (without radius compensation) and travels to P2', with the cutter radius being compensated at point P2'. Point P2' depends on the start position P1 within the plain. A distinction is made between 3 basic cases. These cases are exemplified below during application of the radius compensation with a programmed G42 (right compensation). Similar rules apply for the deactivation of the compensation, except that the tangent t is determined at the end of the path segment, with similar conditions being derived. Case 1: P1 to the right of the path tangent t If the starting point P1 is to the right of the path tangent t, P2' is orthogonal to the tangent. This start-up behavior applies to the range hatched in green. TF5100 Version: 2.14.3 187
## Page 188

Classic Dialect Reference Manual Case 2: P1 the right of the normal n and to the left of the path tangent t If the start position P1 is to the right of the normal n and to the left of the path tangent t, P2' is moved. P2' results from the intersection of the parallel of P1P2 and the offset distance P2P3. Both straight lines are offset by radius R. This behavior applies to the range hatched in green. 188 Version: 2.14.3 TF5100
## Page 189

Classic Dialect Reference Manual Case 3: P1 to the left of the normal n and to the left of the path tangent t If the start position P1 is to the left of the normal n and also to the left of the path tangent t, an additional circle segment is inserted during approaching of P2'. In order to avoid free cutting at P2, P2' is not orthogonal to the start tangent of the section P2P3. The additional circle segment is inserted for all start positions within the hatched green region. TF5100 Version: 2.14.3 189
## Page 190

Classic Dialect Reference Manual A circle segment follows after the offset The radius compensation is invariably applied via a straight line. (This must be set in the part program, since otherwise a runtime error will be generated). The contour can then start with a circle. The rules for starting and stopping are the same as before, i.e. here too the path tangent of the contour for P2 is determined, and a distinction is made between the three cases described. If P2' is always to be approached orthogonal to the path tangent of P2, independent of the starting point, this can be realized with an additional command (see Orthogonal contour approach/departure [} 191]). 190 Version: 2.14.3 TF5100
## Page 191

Classic Dialect Reference Manual 6.4.5 Orthogonal Contour Approach/Departure Command NORM Cancellation End of block Programmable with G40 [} 186] G41 [} 186] G42 [} 186] The 'NORM' command has the effect that the contour is approached orthogonally when cutter radius compensation is switched on. The actual position of the cutter is irrelevant. When de-selecting, the last segment with active compensation is also left orthogonally. Sample: N10 G17 N20 G01 X0 Y0 Z0 F6000 N30 G42 NORM X100 Y0 D5 N40 X200 N50 G40 NORM X220 Y0 N60 M30 Notice The Norm command has hitherto only been implemented for straight line/straight line transitions. 6.4.6 Path Velocity in Arcs When the cutter radius compensation [} 186] is active, the programmed radius changes for arcs. This in turn alters the velocity. The following commands are used to specify whether the feed value refers to the contour or the tool center point. Constant Feed at the Contour Command CFC (standard setting) Cancellation CFIN or CFTCP With CFC (constant feed contour) the feedrate at the contour is held constant. Constant Feed at the Internal Radius Command CIN Cancellation CFC or CFTCP With CFIN (constant feed internal radius) the feedrate at internal radii is reduced. This results in a constant velocity at the contour. The velocity at external radii is not increased. Constant Feed of the Tool Centre Point Command CFTCP Cancellation CFC or CFIN With CFTCP (constant feed tool center point) the feedrate of the tool’s center point is kept constant. This means that at internal radii the velocity at the contour is increased, and that it is correspondingly reduced at external radii. TF5100 Version: 2.14.3 191
## Page 192

Classic Dialect Reference Manual 6.4.7 Bottle Neck Detection If the cutter radius is not considered when a part program is created, the cutter may inadvertently process the opposite side of the workpiece. This leads to a contour collision with the workpiece, or, in other words, a bottleneck was programmed. Command CDON Cancellation CDOF In this form, this behavior can only occur in combination with cutter radius compensation (G41/G42). In order to prevent such contour collisions, monitoring can be switched on from the part program via CDON. For it to be active, cutter radius compensation must also be selected. The response of the NCI when a bottleneck is detected can be parameterized via the PLC. 3 cases are distinguished: • Error and abort If a bottleneck is detected, Twin CAT generates a runtime error and aborts the program execution. • Notification and modification of the contour If a bottleneck is detected, the contour is modified such that a contour collision is avoided (see Figure 1: blue line). However, this also means that segments may be left out, depending on the program. Furthermore, a note is entered in the application viewer to say that a bottleneck was detected. • Notification and contour collision If a bottleneck is detected, the contour is not changed and no error is generated. Only a message is entered in the application viewer. Significant computing resources are required for contour collision monitoring. It should therefore only be selected if it is actually required. Furthermore, the amount of look-ahead for the bottleneck detection should be specified. This requires the number of future segments to be determined that are monitored relative to the n-th segment, in order to check for bottlenecks. The selected number of segments should not be too large, since this would put unnecessary strain on the system. The value for the look-ahead is also parameterized from the PLC. Function blocks for parameterizing the bottleneck detection: • Itp Set Bottle Neck Mode Ex [} 244] • Itp Get Bottle Neck Mode Ex [} 215] • Itp Set Bottle Neck Look Ahead Ex [} 242] 192 Version: 2.14.3 TF5100
## Page 193

Classic Dialect Reference Manual • Itp Get Bottle Neck Look Ahead Ex [} 213] Sample: N10 G0 X0 Y0 Z0 N20 CDON N30 G01 G41 D3 X100 F6000 (cutter radius 30mm) ... N40 G01 X200 N50 G02 X220 Y-74.641 I0 J-40 N60 G01 X300 Y-104 N70 G01 X230 Y120 N80 G40 D0 Y200 N90 CDOF ... M30 6.5 Command overview 6.5.1 General command overview Command Description block-by-block / Default modal ANG [} 147] Contour line programming s (angle) AROT [} 148] Rotation additive m Calc Inv Rot [} 148] Calculates the inverse s rotation of a vector Calc Rot [} 148] Calculates the rotation of s a vector CDOF [} 192] Bottleneck detection off m Default CDON [} 192] Bottleneck detection on m CFC [} 191] Constant velocity at the m Default contour CFIN [} 191] Constant velocity in the m interior circle CFTCP [} 191] Constant velocity of tool m center point CIP [} 138] Circular interpolation s CPCOF [} 138] Centre point correction off m CPCON [} 138] Centre point correction on m Default Del DTG [} 159] Delete Distance to Go s DYNOVR [} 175] Dynamic Override m FCONST [} 141] Constant feed m Default programming FLIN [} 141] Linear feed programming m G00 [} 136] Rapid traverse m G01 [} 137] Straight line interpolation m Default G02 [} 138] Clockwise circular m interpolation G03 [} 138] Anticlockwise circular m interpolation G04 [} 141] Dwell time s G09 [} 141] Accurate stop s G17 [} 130] Plane selection XY m Default TF5100 Version: 2.14.3 193
## Page 194

Classic Dialect Reference Manual Command Description block-by-block / Default modal G18 [} 130] Plane selection ZX m G19 [} 130] Plane selection YZ m G40 [} 186] No miller/cutter radius m Default compensation G41 [} 186] Miller/cutter radius m compensation left G42 [} 186] Miller/cutter radius m compensation right G53 [} 142] Zero shift suppression m Default G54 [} 142] 1st adjustable zero shift m G55 [} 142] 2nd adjustable zero shift m G56 [} 142] 3rd adjustable zero shift m G57 [} 142] 4th adjustable zero shift m G58 [} 142] 1st programmable zero m shift G59 [} 142] 2nd programmable zero m shift G60 [} 141] Accurate stop m G70 [} 131] Dimensions inch m G71 [} 131] Dimensions metric m Default G74 [} 136] Programmed traverse to s reference point G90 [} 129] Reference dimension m Default notation G91 [} 129] Incremental dimension m notation G700 [} 131] Dimensions in inches with m calculation of the feed G710 [} 131] Dimensions metric with m calculation of the feed Mirror [} 151] Mirroring coordinate m system MOD [} 159] Modulo movement s MSG [} 180] Messages from the NC s program NORM [} 191] orthogonal approach of s and departure from the contour P+ [} 130] Feed direction positive m Default P- [} 130] Feed direction negative m param Auto Accurate Stop Automatic Accurate Stop m [} 158] param Axis Dynamics Parameterization of the m axis dynamics [} 175] param C1Reduction Factor C1 reduction factor m [} 176] param C2Reduction Factor C2 reduction factor m [} 176] 194 Version: 2.14.3 TF5100
## Page 195

Classic Dialect Reference Manual Command Description block-by-block / Default modal param Circular Smoothing Circular smoothing m [} 157] param Dev Angle [} 176] C0 reduction - deflection m angle param Group Vertex [} 157] Circular smoothing (old) m param Group Dynamic Pathway dynamics (old) m [} 175] param Path Dynamics Pathway dynamics m [} 175] param Radius Prec [} 139] Circular accuracy m param Spline Smoothing Smoothing with Bezier m Splines [} 155] param Vertex Smoothing Smoothing of Segment m Transitions [} 152] param Velo Jump [} 176] C0 reduction - max. step m change in velocity param Velo Min [} 178] Minimum velocity m param Zero Shift [} 142] Parameterization of the m configurable zero shift Path Axes Pos [} 179] Reads the actual position s ROT [} 148] Absolute rotation m Rot Ex Off [} 148] Extended rotation function m Default off Rot Ex On [} 148] Extended rotation function m on Rot Vec [} 148] Calculation routine for s rotating a vector RParam [} 134] Initialization of R- s parameters RTo Dword Get Bit [} 134] Converts an R-parameter m to DWord and checks whether a defined bit is set SEG [} 147] Contour line programming s (segment length) skip Virtual Movements Skip virtual movements m [} 179] Tool Offset Inc Off [} 183] Cartesian tool m displacement and length compensation is not applied under G91 Tool Offset Inc On [} 183] Cartesian tool m Default displacement and length compensation is applied under G91 Tool Param [} 180] Writing and reading of tool m parameters TPM [} 145] Target position monitoring s Zero Shift Inc Off [} 142] Zero shift is not applied m under G91 TF5100 Version: 2.14.3 195
## Page 196

Classic Dialect Reference Manual Command Description block-by-block / Default modal Zero Shift Inc On [} 142] Zero shift is applied under m Default G91 Address Description Q<n> [} 161] Axis label for auxiliary axis ( 1 <= n <= 5) 6.5.2 @-Command Overview Several variations of these commands are often possible, since K for a constant, R for an R-parameter or P for an R-parameter used as a pointer can be used for parameters. For example, the notation K/R/Pn should be understood to mean "either a number or an R-parameter or a pointer". The following @-commands are available: Command Versions Function @40 [} 134] @40 Kn Rn Rm .... Save register on the stack @41 [} 134] @41 Rn Rm Save register on the stack @42 [} 134] @42 Kn .... Rm Rn Restore register from stack @43 [} 134] @43 Rm Rn Restore register from stack @100 [} 170] @100 K±n @100 Rm Unconditional jump @111 [} 170] @111 Rn K/Rn Km ... Case block @121 [} 170] @121 Rn K/Rn Kn Jump if unequal @122 [} 170] @122 Rn K/Rn Kn Jump if equal @123 [} 170] @123 Rn K/Rn Kn Jump if less or equal @124 [} 170] @124 Rn K/Rn Kn Jump if less @125 [} 170] @125 Rn K/Rn Kn Jump if greater or equal @126 [} 170] @126 Rn K/Rn Kn Jump if greater @131 [} 172] @131 Rn K/Rn Kn Loop while equal @132 [} 172] @132 Rn K/Rn Kn Loop while unequal @133 [} 172] @133 Rn K/Rn Kn Loop while greater @134 [} 172] @134 Rn K/Rn Kn Loop while greater or equal @135 [} 172] @135 Rn K/Rn Kn Loop while less @136 [} 172] @136 Rn K/Rn Kn Loop while less or equal @141 [} 172] @141 Rn K/Rn Kn Repeat until equal @142 [} 172] @142 Rn K/Rn Kn Repeat until unequal @143 [} 172] @143 Rn K/Rn Kn Repeat until greater @144 [} 172] @144 Rn K/Rn Kn Repeat until greater or equal @145 [} 172] @145 Rn K/Rn Kn Repeat until less @146 [} 172] @146 Rn K/Rn Kn Repeat until less or equal @151 [} 172] @151 Rn K/Rn Kn FOR_TO loop @161 [} 172] @161 Rn K/Rn Kn FOR_DOWNTO loop @200 @200 Rn Delete a variable @202 @202 Rn Rm Swap two variables @302 @302 K/R/Pn K/R/Pn R/Pn Read machine data bit @361 [} 178] @361 Rn Km Read machine-related actual axis value 196 Version: 2.14.3 TF5100
## Page 197

Classic Dialect Reference Manual Command Versions Function @372 @372 Rn Extract the NC-Channel-ID and store it in a variable @402 [} 138] @402 K/R/Pn K/R/Pn K/R/Pn Write machine data bit @610 @610 Rn Rn Find absolute value of a variable @613 @613 Rn Rn Find square root of a variable @614 @614 Rn Rm Rm Find square root of the sum of the squares of two variables x = sqrt( a^2 + b^2) @620 [} 172] @620 Rn Increment variable @621 @621 Rn Decrement variable @622 @622 Rn Find integer part of a variable @630 [} 134] @630 Rn Rm Find sine of a variable @631 [} 134] @631 Rn Rm Find cosine of a variable @632 [} 134] @632 Rn Rm Find tangent of a variable @633 [} 134] @633 Rn Rm Find cotangent of a variable @634 [} 134] @634 Rn Rm Find arcsine of a variable @635 [} 134] @635 Rn Rm Find arccosine of a variable @636 [} 134] @636 Rn Rm Find arctangent of a variable @714 [} 169] @714 Decoder stop @716 [} 169] @716 Decoder stop with rescan of the axis positions @717 [} 169] @717 Decoder stop with external trigger event Machine data Access to the following machine data is supported: Byte Bit Action 5003 [} 138] 5 0: IJK words specify the distance between the center of the circle and the starting point. 1: IJK are absolute data giving the center of the circle. TF5100 Version: 2.14.3 197
## Page 198

PLC NCI Libraries 7 PLC NCI Libraries Requirements Overview of PLC NCI libraries Description PLC Library: Tc2_NCI [} 198] Function blocks for the configuration of the interpolation group (e.g. formation of the 3D group) and for operating the interpreter (G-Code (DIN 66025)) such as loading and starting the NC program. PLC Library: Tc2_Plc Interpolation [} 312] Programming of multi-dimensional movements from the PLC (alternative to using G-Code (DIN 66025)) 7.1 PLC Library: Tc2_NCI 7.1.1 Configuration The library Tc2_NCI provides function blocks for general NC axis configuration. This makes it possible to configure or to reconfigure axes in a simple way directly from the PLC. Function block Description Cfg Build3DGroup [} 198] Groups up to 3 PTP axes into a 3D group Cfg Build Ext3DGroup [} 200] Groups up to 3 PTP axes and 5 auxiliary axes into a 3D group Cfg Add Axis To Group [} 201] Configures a single axis at a particular location within a group (PTP, 3D, FIFO) Cfg Reconfig Group [} 202] Removes 3D (FIFO) axis allocations and returns the axes to their personal PTP group Cfg Reconfig Axis [} 203] Returns a single axis from, for example, a 3D group, to its personal PTP group Cfg Read3DAxis Ids [} 204] Reads the axis IDs (axis allocation) of a 3D group Cfg Read Ext3DAxis Ids [} 205] Reads the axis IDs (axis allocation) of a 3D group with auxiliary axes Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.1.1 Cfg Build3DGroup Cfg Build3DGroup b Execute BOOL BOOL b Busy n Group Id UDINT BOOL b Err n XAxis Id UDINT UDINT n Err Id n YAxis Id UDINT n ZAxis Id UDINT t Time Out TIME The function block Cfg Build3DGroup configures a 3D group with up to 3 PTP axes (X, Y and Z). 198 Version: 2.14.3 TF5100
## Page 199

PLC NCI Libraries Inputs VAR_INPUT b Execute : BOOL; n Group Id : UDINT; n XAxis Id : UDINT; n YAxis Id : UDINT; n ZAxis Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Group Id UDINT ID of the 3D group n XAxis Id UDINT ID of the PTP axes n YAxis Id UDINT ID of the PTP axes n ZAxis Id UDINT ID of the PTP axes t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI TF5100 Version: 2.14.3 199
## Page 200

PLC NCI Libraries 7.1.1.2 Cfg Build Ext3DGroup Cfg Build Ext3DGroup b Execute BOOL BOOL b Busy n Group Id UDINT BOOL b Err n XAxis Id UDINT UDINT n Err Id n YAxis Id UDINT n ZAxis Id UDINT n Q1Axis Id UDINT n Q2Axis Id UDINT n Q3Axis Id UDINT n Q4Axis Id UDINT n Q5Axis Id UDINT t Time Out TIME The function block Cfg Build Ext3DGroup configures a 3D group with up to 3 path axes (X, Y and Z). Additionally, up to 5 auxiliary axes (Q1.. Q5) can be configured. The axis IDs of the PTP axes that are to be included in the interpolation group are applied at the inputs n XAxis Id to n Q5Axis Id. NOTICE The assignment of the auxiliary axes must start with n Q1Axis Id. No gaps between auxiliary axes are permitted. This means that if, for example, n Q3Axis Id is to be assigned, then n Q2Axis Id must also be assigned a valid axis ID. Inputs VAR_INPUT b Execute : BOOL; n Group Id : UDINT; n XAxis Id : UDINT; n YAxis Id : UDINT; n ZAxis Id : UDINT; n Q1Axis Id : UDINT; n Q2Axis Id : UDINT; n Q3Axis Id : UDINT; n Q4Axis Id : UDINT; n Q5Axis Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is executed when a positive edge is encountered. n Group Id UDINT ID of the 3D group n XAxis Id UDINT Axis IDs of the PTP axes to be included in the interpolation group. n YAxis Id UDINT n ZAxis Id UDINT n Q1Axis Id UDINT n Q2Axis Id UDINT n Q3Axis Id UDINT n Q4Axis Id UDINT n Q5Axis Id UDINT t Time Out TIME ADS Timeout-Delay 200 Version: 2.14.3 TF5100
## Page 201

PLC NCI Libraries Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.1.3 Cfg Add Axis To Group Cfg Add Axis To Group b Execute BOOL BOOL b Busy n Group Id UDINT BOOL b Err n Axis Id UDINT UDINT n Err Id n Index UDINT t Time Out TIME The function block Cfg Add Axis To Group configures a single axis at a particular location within an existing group (PTP, 3D, FIFO). Inputs VAR_INPUT b Execute : BOOL; n Group Id : UDINT; n Axis Id : UDINT; n Index : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Group Id UDINT ID of the target group n Axis Id UDINT ID of the axis to be configured n Index UDINT Position of the axis within the group; can have values between 0 and n-1. Depending on the type of group, n has the following value: PTP: n = 1, 3D: n = 3, FIFO: n = 8 t Time Out TIME ADS Timeout-Delay TF5100 Version: 2.14.3 201
## Page 202

PLC NCI Libraries Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.1.4 Cfg Reconfig Group Cfg Reconfig Group b Execute BOOL BOOL b Busy n Group Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id The function block Cfg Reconfig Group removes the axis allocation of an existing group (NCI or FIFO), returning the axes to their personal PTP group. Inputs VAR_INPUT b Execute : BOOL; n Group Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Group Id UDINT ID of the group to be resolved t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR 202 Version: 2.14.3 TF5100
## Page 203

PLC NCI Libraries Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.1.5 Cfg Reconfig Axis Cfg Reconfig Axis b Execute BOOL BOOL b Busy n Axis Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id The function block Cfg Reconfig Axis returns a single axis from, for example, a 3D group, to its personal PTP group. Inputs VAR_INPUT b Execute : BOOL; n Axis Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Axis Id UDINT ID of the axis to be returned t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. TF5100 Version: 2.14.3 203
## Page 204

PLC NCI Libraries Name Type Description b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.1.6 Cfg Read3DAxis Ids Cfg Read3DAxis Ids b Execute BOOL BOOL b Busy n Group Id UDINT BOOL b Err p Addr PVOID UDINT n Err Id t Time Out TIME The function block Cfg Read3DAxis Ids reads the axis configuration of a 3D group. Inputs VAR_INPUT b Execute : BOOL; n Group Id : UDINT; p Addr : PVOID; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Group Id UDINT ID of the 3D group p Addr PVOID Address of the variable into which the function block writes the axis IDs of the group assignment (array with three elements of type UDINT). t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. 204 Version: 2.14.3 TF5100
## Page 205

PLC NCI Libraries Name Type Description b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Sample: VAR (* instance *) Read Ax Ids : Cfg Read3DAxis Ids; Ax Ids : ARRAY[1..3] OF UDINT; END_VAR Read Ax Ids( b Execute := TRUE, n Group Id := 4, p Addr := ADR( Ax Ids ), t Time Out := T#1s ); Ax Ids now contains the three axis IDs for the 3D group with the group ID 4. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.1.7 Cfg Read Ext3DAxis Ids Cfg Read Ext3DAxis Ids b Execute BOOL BOOL b Busy n Group Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id ↔ st Ext3d Group Reference To NCI_EXT3DGROUP The function block Cfg Read Ext3DAxis Ids reads the axis configuration of the extended 3D group. Inputs VAR_INPUT b Execute : BOOL; n Group Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Group Id UDINT ID of the 3D group t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT st Ext3d Group : NCI_EXT3DGROUP; END_VAR Name Type Description st Ext3d Group NCI_EXT3DGROUP Instance of the structure NCI_EXT3DGROUP (enter axis IDs of the current interpolation group here) TF5100 Version: 2.14.3 205
## Page 206

PLC NCI Libraries Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE NCI_EXT3DGROUP : STRUCT n XAxis Id : UDINT; n YAxis Id : UDINT; n ZAxis Id : UDINT; n Q1Axis Id : UDINT; n Q2Axis Id : UDINT; n Q3Axis Id : UDINT; n Q4Axis Id : UDINT; n Q5Axis Id : UDINT; END_STRUCT END_TYPE Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2 NCI POUs The Twin CAT library Tc2_NCI contains function blocks for operation of the NC interpreter from the PLC. The following function blocks are included in the library Tc2_NCI . Function block Description Itp Confirm Hsk [} 208] Acknowledges an M-function of type handshake Itp Del Dtg Ex [} 209] Triggers “Delete Distance to go” in the NC Itp Enable Default GCode [} 210] Executes a user-defined standard G-Code before the start of each NC program Itp EStop Ex [} 212] Triggers the NCI EStop Itp Get Block Number [} 213] Provides the block number of the NC program for the cyclic interface Itp Get Bottle Neck Look Ahead Ex [} 213] Provides the value of the look-ahead for bottleneck detection Itp Get Bottle Neck Mode Ex [} 215] Provides the response mode for bottleneck detection Itp Get Channel Id [} 216] Provides the channel ID Itp Get Channel Type [} 216] Provides the channel type of the cyclic interface 206 Version: 2.14.3 TF5100
## Page 207

PLC NCI Libraries Function block Description Itp Get Cyclic LReal Offsets [} 217] Provides the index offset of the LREAL variables used in the cyclic channel interface Itp Get Cyclic Udint Offsets [} 219] Provides the index offset of the UDINT variables used in the cyclic channel interface Itp Get Error [} 220] Provides the error number Itp Get Geo Info And HParam Ex [} 221] Reads information of the currently active segment and past and future segments. Itp Get Group Axis Ids [} 222] Provides the axis IDs that were configured for the group Itp Get Group Id [} 223] Provides the group ID Itp Get HParam [} 224] Provides the current H-parameter from the NC Itp Get Hsk MFunc [} 224] Provides the current M-function number of type handshake Itp Get Itf Version [} 225] Provides the current version of the cyclic interface Itp Get Override Percent [} 225] Provides the channel override in percent Itp Get Set Path Velocity [} 226] Returns the current path set velocity Itp Get SParam [} 227] Provides the current S-parameter from the NC Itp Get State Interpreter [} 227] Provides the current interpreter state Itp Get TParam [} 228] Provides the current T-parameter from the NC Itp Go Ahead Ex [} 229] Triggers the Go Ahead function (decoder stop with external trigger event) Itp Has Error [} 230] Determines whether an error is present Itp Is Fast MFunc [} 231] Determines whether the M-function number provided is present in the form of a fast M-function Itp Is EStop Ex [} 232] Determines whether an EStop is executed or pending Itp Is Hsk MFunc [} 232] Determines whether an M-function of type handshake is present Itp Load Prog Ex [} 233] Loads an NC program using program names Itp Read Cyclic LReal Param1 [} 235] Reads the first LReal parameter from the cyclic channel interface Itp Read Cyclic Udint Param1 [} 235] Reads the first UDINT parameter from the cyclic channel interface Itp Read RParams Ex [} 236] Reads arithmetic parameters Itp Read Tool Desc Ex [} 237] Reads the tool description from the NC Itp Read Zero Shift Ex [} 239] Reads the zero offset shift from the NC Itp Reset Ex2 [} 240] Carries out a reset of the interpreter or of the NC channel Itp Reset Fast MFunc Ex [} 241] Resets a fast signal bit Itp Set Bottle Neck Look Ahead Ex [} 242] Sets the value of the look-ahead for bottleneck detection Itp Set Bottle Neck Mode Ex [} 244] Sets the response mode when bottleneck detection is switched on Itp Set Cyclic LReal Offsets [} 245] Sets the index offsets of the LREAL variables used in the cyclic channel interface Itp Set Cyclic Udint Offsets [} 246] Sets the index offsets of the UDINT variables used in the cyclic channel interface Itp Set Override Percent [} 248] Sets the channel override in percent Itp Set Subroutine Path Ex [} 249] Optionally sets the search path for subroutines Itp Set Tool Desc Null Ex [} 250] Sets all tool parameters (including number and type) to null TF5100 Version: 2.14.3 207
## Page 208

PLC NCI Libraries Function block Description Itp Set Zero Shift Null Ex [} 251] Set all zero offset shifts to null Itp Single Block [} 252] Enables or disables the single block mode in the NCI. Itp Start Stop Ex [} 254] Starts or stops the interpreter (NC channel) Itp Step On After EStop Ex [} 255] Enables further processing of the parts program after an NCI EStop Itp Write RParams Ex [} 256] Writes arithmetic parameters Itp Write Tool Desc Ex [} 258] Writes the tool description into the NC Itp Write Zero Shift Ex [} 259] Writes the zero offset shift into the NC Block search (for description of the functionality see Blocksearch [} 261]) Itp Blocksearch [} 261] Sets the interpreter to a user-defined location, so that NC program execution continues from this point. Itp Get Blocksearch Data [} 264] Reads the current state after an NC program interruption. Itp Step On After Blocksearch [} 265] Starts the motion after a block search. Retrace Itp Enable Feeder Backup [} 266] Enables the backup list for retracing Itp Is Feeder Backup Enabled [} 268] Reads whether the backup list for retracing is active Itp Is First Segment Reached [} 269] Reads whether the start position is reached during retracing Itp Is Feed From Backup List [} 269] Reads whether feeder entries were sent from the backup list Itp Is Moving Backwards [} 270] Reads whether backward movement occurs on the current path Itp Retrace Move Backward [} 271] Performs a backward movement on the path Itp Retrace Move Forward [} 272] Performs a forward movement on the path. This is called to cancel retracing. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.1 Itp Confirm Hsk Itp Confirm Hsk b Execute BOOL BOOL b Busy ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF BOOL b Err ↔ s Plc To Nci Reference To PLCTONC_NCICHANNEL_REF UDINT n Err Id The function block Itp Confirm Hsk confirms the currently present M-function. If the channel override is set to 0 or an E-stop is active, no M-functions are acknowledged during this time. The busy signal of Itp Confirm Hsk therefore remains active and must continue to be called. Inputs VAR_INPUT b Execute : BOOL; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. 208 Version: 2.14.3 TF5100
## Page 209

PLC NCI Libraries / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; s Plc To Nci : PLCTONC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). s Plc To Nci PLCTONC_NCICHANN Structure of cyclic channel interface between PLC and NCI EL_REF (type: PLCTONC_NCICHANNEL_REF [} 344]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.2 Itp Del Dtg Ex Itp Del Dtg Ex b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id The function block Itp Del Dtg Ex triggers "Delete distance to go". There is a more detailed description in the Interpreter [} 159] documentation. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR TF5100 Version: 2.14.3 209
## Page 210

PLC NCI Libraries Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.3 Itp Enable Default GCode Itp Enable Default GCode b Execute BOOL BOOL b Busy b Use Default GCode BOOL BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Enable Default GCode enables execution of a user-defined G-Code before the start of each NC program from the PLC. The default program is executed before the loaded program when the actual NC program starts. This function block enables rotation of the coordinate system for all NC programs to be executed, for example. 210 Version: 2.14.3 TF5100
## Page 211

PLC NCI Libraries The standard G-Code must be stored as “Default GCode<Channel-Number>.def” in the Twin CAT\Mc\Nci directory. Inputs VAR_INPUT b Execute : BOOL; b Use Default GCode : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. b Use Default GCode BOOL If this variable is TRUE, the default G-Code is activated through a rising edge at b Execute. If the variable is FALSE, the default G-Code is disabled. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Not available for GST This function block is not available if the GST interpreter is used. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI TF5100 Version: 2.14.3 211
## Page 212

PLC NCI Libraries 7.1.2.4 Itp EStop Ex Itp EStop Ex b Execute BOOL BOOL b Busy f Dec LREAL BOOL b Err f Jerk LREAL UDINT n Err Id t Time Out TIME ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp EStop Ex triggers the NCI EStop and enables a controlled stop on the path. The limit values for the deceleration and the jerk are transferred as parameters. If these should be smaller than the currently active dynamic parameters, the transferring parameters are rejected. Inputs VAR_INPUT b Execute : BOOL; f Dec : LREAL; f Jerk : LREAL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. f Dec LREAL Max. deceleration during stopping. If f Dec is smaller than the currently active deceleration, f Dec is rejected. This ensures that the deceleration occurs at least with the standard ramp. f Jerk LREAL Max. jerk during stopping. If f Jerk is smaller than the currently active jerk, f Jerk is rejected. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. 212 Version: 2.14.3 TF5100
## Page 213

PLC NCI Libraries Name Type Description n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also Itp Step On After EStop Ex [} 255]. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.5 Itp Get Block Number The function Itp Get Block Number returns the block number of the NC program for the cyclic interface. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get Block Number UDINT Block number of the active geometry segment Sample VAR n Block Number : UDINT; s Nci To Plc AT%I* : NCTOPLC_NCICHANNEL_REF; END_VAR n Block Number := Itp Get Block Number(s Nci To Plc); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.6 Itp Get Bottle Neck Look Ahead Ex Itp Get Bottle Neck Look Ahead Ex b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id UDINT n Look Ahead TF5100 Version: 2.14.3 213
## Page 214

PLC NCI Libraries The function block Itp Get Bottle Neck Look Ahead Ex determines the maximum size of the look-ahead for the bottleneck detection (contour collision monitoring). A more detailed description can be found in the Interpreter [} 192] documentation. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; n Look Ahead : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. If the function block has a timeout error, 'Error' is TRUE and 'n Err Id' is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). n Look Ahead UDINT Value of the look-ahead for bottleneck detection Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 214 Version: 2.14.3 TF5100
## Page 215

PLC NCI Libraries 7.1.2.7 Itp Get Bottle Neck Mode Ex Itp Get Bottle Neck Mode Ex b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id E_Itp Bn Mode e Bottle Neck Mode The function block Itp Get Bottle Neck Mode Ex reads the behavior in the event of a contour collision (bottleneck). A more detailed description can be found in the Interpreter [} 192] documentation. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; e Bottle Neck Mode : E_Itp Bn Mode END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. If the function block has a timeout error, 'Error' is TRUE and 'n Err Id' is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TF5100 Version: 2.14.3 215
## Page 216

PLC NCI Libraries Name Type Description e Bottle Neck Mode E_Itp Bn Mode Enum for the behavior in the event of a contour collision TYPE E_Itp Bn Mode: ( Itp Bnm_Abort := 0, Itp Bnm_Adjust := 1, Itp Bnm_Leave := 2 ); END_TYPE Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.8 Itp Get Channel Id The function Itp Get Channel Id determines the channel ID from the cyclic interface. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get Channel Id UDINT Channel ID Sample VAR n Chn Id : UINT; s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; END_VAR n Chn Id := Itp Get Channel Id( s Nci To Plc ); see also: Itp Get Group Id [} 223] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.9 Itp Get Channel Type The function Itp Get Channel Type returns the channel type of the cyclic interface. 216 Version: 2.14.3 TF5100
## Page 217

PLC NCI Libraries / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get Channel Type E_Itp Channel Type Channel type TYPE E_Itp Channel Type : ( Itp Channel Type None, Itp Channel Type Interpreter, Itp Channel Type Kinematic, Itp Channel Type_Invalid Itf Ver := 16#4B14 (*Err Tc Nci Itp_Itf Version the cyclic channel interface do es not match to the requested function/fb *) ); END_TYPE Sample VAR n Channel Type : E_Itp Channel Type; s Nci To Plc AT%I* : NCTOPLC_NCICHANNEL_REF; END_VAR n Channel Type := Itp Get Channel Type( s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.10 Itp Get Cyclic Lreal Offsets Itp Get Cyclic LReal Offsets b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id UDINT n Index Offset Param1 UDINT n Index Offset Param2 UDINT n Index Offset Param3 UDINT n Index Offset Param4 The function block Itp Get Cyclic LReal Offsets is used to read the current configuration of the cyclic channel interface for LREAL variables. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay TF5100 Version: 2.14.3 217
## Page 218

PLC NCI Libraries / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; n Index Offset Param1 : UDINT; n Index Offset Param2 : UDINT; n Index Offset Param3 : UDINT; n Index Offset Param4 : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). n Index Offset Param UDINT Group state (Index Offset) for parameter 1 1 n Index Offset Param UDINT Group state (Index Offset) for parameter 2 2 n Index Offset Param UDINT Group state (Index Offset) for parameter 3 3 n Index Offset Param UDINT Group state (Index Offset) for parameter 4 4 See also: • Itp Read Cyclic LReal Param1 [} 235] • Itp Set Cyclic LReal Offsets [} 245] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 218 Version: 2.14.3 TF5100
## Page 219

PLC NCI Libraries 7.1.2.11 Itp Get Cyclic UDint Offsets Itp Get Cyclic Udint Offsets b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id UDINT n Index Offset Param1 UDINT n Index Offset Param2 UDINT n Index Offset Param3 UDINT n Index Offset Param4 The function block Itp Get Cyclic UDint Offsets is used to read the current configuration of the cyclic channel interface for UDINT variables. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; n Index Offset Param1 : UDINT; n Index Offset Param2 : UDINT; n Index Offset Param3 : UDINT; n Index Offset Param4 : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. TF5100 Version: 2.14.3 219
## Page 220

PLC NCI Libraries Name Type Description n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). n Index Offset Param UDINT Group state (Index Offset) for parameter 1 1 n Index Offset Param UDINT Group state (Index Offset) for parameter 2 2 n Index Offset Param UDINT Group state (Index Offset) for parameter 3 3 n Index Offset Param UDINT Group state (Index Offset) for parameter 4 4 See also: • Itp Read Cyclic UDint Param1 [} 235] • Itp Set Cyclic Udint Offsets [} 246] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.12 Itp Get Error The function Itp Get Error returns the error number, see description of NC error codes. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get Error UDINT Error number Itp Get Error evaluates the variable 'n Itp Err Code' from the cyclic interface. Example VAR b Itp Error : BOOL; n Err Id : UDINT; s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; END_VAR 220 Version: 2.14.3 TF5100
## Page 221

PLC NCI Libraries b Itp Error := Itp Has Error( s Nci To Plc ); IF b Itp Error THEN n Err Id := Itp Get Error( s Nci To Plc ); … END_IF Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.13 Itp Get Geo Info And HParam Ex Itp Get Geo Info And HParam Ex ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF ST_Itp Pre View Tab Ex st Tab UDINT n Err Id The function block Itp Get Geo Info And HParam Ex reads information of the currently active segment, as well as past and future segments. These include block number, H-parameter and residual path length on the segment. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT st Tab : ST_Itp Pre View Tab Ex; n Err Id : UDINT; END_VAR Name Type Description st Tab ST_Itp Pre View Tab Ex Structure containing the segment data. See ST_Itp Pre View Tab Ex [} 221]. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in n Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). ST_Itp Pre View Tab Ex TYPE ST_Itp Pre View Tab Ex : STRUCT n Dc Time : UDINT := 0; n Reserved : UDINT := 0; arr Lines : ARRAY[1.. NCI_MAX_PREVIEWTABLINES] OF ST_Itp Pre View Tab Line; END_STRUCT END_TYPE Name Type Description n Dc Time UDINT Current timestamp in ns. This timestamp can be used in synergy with the Tc2_Nci XFC library. n Reserved UDINT TF5100 Version: 2.14.3 221
## Page 222

PLC NCI Libraries Name Type Description arr Lines ARRAY[1.. NCI_MAX_P Array of segment-related information (size 20). The entry at REVIEWTABLINES] position 11 of the array corresponds to the currently active OF segment. Segments that have already been processed are ST_Itp Pre View Tab Line displayed at positions 1-10 of the array, future segments at positions 12-20. See ST_Itp Pre View Tab Line [} 222]. ST_Itp Pre View Tab Line TYPE ST_Itp Pre View Tab Line : STRUCT f Length : LREAL := 0.0; n Block No : UDINT := 0; n HParam : UDINT := 0; n Entry ID : UDINT := 0; n Reserved : UDINT := 0; END_STRUCT END_TYPE Name Type Description f Length LREAL Remaining segment length. For segments that are not yet active this corresponds to the total segment length. For past segments the distance moved since the end of the segment is specified. n Block No UDINT Block number programmed by the user n HParam UDINT Value of the H-parameter [} 168] that is active from the start of the next segment. n Entry ID UDINT Command ID generated by the system n Reserved UDINT Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.14 Itp Get Group Axis Ids Itp Get Group Axis Ids is a function that returns an array of axes IDs that were configured for the group. / Inputs/Outputs FUNCTION Itp Get Group Axis Ids VAR_IN_OUT s Nci To Plc AT%I* : NCTOPLC_NCICHANNEL_REF; n Nci Axis Ids : ARRAY[1..8] OF DWORD; END_VAR Name Type Description n Nci Axis Ids ARRAY[1..8] OF DWO Array of axis IDs RD s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is only accessed for reading. (Type NCTOPLC_NCICHANNEL_REF [} 343]) 222 Version: 2.14.3 TF5100
## Page 223

PLC NCI Libraries Return value Name Type Description Itp Get Group Axis Ids DWORD Error number Itp Get Group Axis Ids evaluates the information of the variable 'n Acs Axis IDs[8]' from the cyclic interface. Example VAR n Nci Axis Ids : ARRAY[1..8] OF DWORD; s Nci To Plc AT%I* : NCTOPLC_NCICHANNEL_REF; n Version Err : DWORD; END_VAR n Version Err := Itp Get Group Axis Ids(n Nci Axis Ids, s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.15 Itp Get Group Id The function Itp Get Group Id determines the group ID from the cyclic interface. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get Group Id UINT Group ID Example VAR n Grp Id : UINT; s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; END_VAR n Grp Id := Itp Get Group Id( s Nci To Plc ); See also: Itp Get Channel Id [} 216] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI TF5100 Version: 2.14.3 223
## Page 224

PLC NCI Libraries 7.1.2.16 Itp Get HParam The function Itp Get HParam returns the current H-parameter. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get HParam DINT H parameter Itp Get HParam evaluates the variable 'n HFunc Value' from the cyclic interface. Example VAR n HParam : DINT; s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; END_VAR n HParam := Itp Get HParam( s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.17 Itp Get Hsk MFunc The function Itp Get Hsk MFunc supplies the number of the M-function of type handshake. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). 224 Version: 2.14.3 TF5100
## Page 225

PLC NCI Libraries Return value Name Type Description Itp Get Hsk MFunc INT Number of the M-function Itp Get Hsk MFunc evaluates the variable 'n Hsk MFunc No' from the cyclic interface. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.18 Itp Get Itf Version The function Itp Get Itf Version determines the version number of the cyclic interface. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get Itf Version UINT Version number of the cyclic interface Example VAR n Itf Ver : UINT; s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; END_VAR n Itf Ver := Itp Get Itf Version( s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.19 Itp Get Override Percent TF5100 Version: 2.14.3 225
## Page 226

PLC NCI Libraries The Itp Get Override Percent function returns the axis channel override as a percentage. It is essential to remember that this is not a value from the NC. The value, which is transferred as set value to the NC, is evaluated. / Inputs/Outputs VAR_IN_OUT s Plc To Nci : PLCTONC_NCICHANNEL_REF; END_VAR Name Type Description s Plc To Nci PLCTONC_NCICHANN Structure of cyclic channel interface between PLC and NCI EL_REF (type: PLCTONC_NCICHANNEL_REF [} 344]) Return value Name Type Description Itp Get Override Percent LREAL Override in percent Example VAR s Plc To Nci AT%Q*: PLCTONC_NCICHANNEL_REF; f Override : LREAL; END_VAR f Override := Itp Get Override Percent( s Plc To Nci ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.20 Itp Get Set Path Velocity The function Itp Get Set Path Velocity reads the current path set velocity from the cyclic interface. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get Set Path Velocity LREAL Current bath set velocity 226 Version: 2.14.3 TF5100
## Page 227

PLC NCI Libraries Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.21 Itp Get SParam The function Itp Get SParam returns the current S-parameter. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get SParam UINT S parameter Itp Get SParam evaluates the variable 'n Spindle Rpm' from the cyclic interface. Example VAR n SParam : UINT; s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; END_VAR n SParam := Itp Get SParam( s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.22 Itp Get State Interpreter The function Itp Get State Interpreter returns the interpreter state. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR TF5100 Version: 2.14.3 227
## Page 228

PLC NCI Libraries Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get State Interpreter UDINT Current Interpreter state [} 16] Itp Get State Interrpreter evaluates the variable 'n Itp State' from the cyclic interface. Example VAR n Itp State : UDINT; s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; END_VAR n Itp State := Itp Get State Interpreter( s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.23 Itp Get TParam The function Itp Get TParam returns the current T-parameter. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Get TParam UINT T parameter Itp Get TParam evaluates the variable 'n Tool' from the cyclic interface. 228 Version: 2.14.3 TF5100
## Page 229

PLC NCI Libraries Example VAR n TParam : UINT; s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; END_VAR n TParam := Itp Get TParam( s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.24 Itp Go Ahead Ex Itp Go Ahead Ex b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id The function block Itp Go Ahead Ex may only be used in association with the decoder stop '@717' [} 169]. There is a more detailed description of this decoder stop in the interpreter documentation [} 126]. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. TF5100 Version: 2.14.3 229
## Page 230

PLC NCI Libraries Name Type Description b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.25 Itp Has Error The function Itp Has Error determines whether the interpreter is in an error state. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Has Error BOOL If there is an error, the function returns TRUE. Itp Has Error evaluates the variable 'n Itp Err Code' from the cyclic interface. If this value does not equal 0, TRUE is returned. Example VAR b Itp Error : BOOL; s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; END_VAR b Itp Error := Itp Has Error( s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 230 Version: 2.14.3 TF5100
## Page 231

PLC NCI Libraries 7.1.2.26 Itp Is Fast MFunc The function Itp Is Fast MFunc determines whether the fast M-function is set for the supplied M-function number. Inputs FUNCTION Itp Is Fast MFunc VAR_IN n Fast MFunc No : INT; END_VAR Name Type Description n Fast MFunc No BOOL Number of the M-function that is to be checked. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Is Fast MFunc BOOL The function returns TRUE if the fast bit of the M-function is set. Itp Is Fast MFunc evaluates the variable 'n Fast MFunc Mask' from the cyclic interface. Example (*this enum is defined by the user *) TYPE Fast MFuncs: ( M10_Cooling Fluid On := 10, (*fast M-Funktion M10*) M11_Cooling Fluid Off := 11, M12_Fan On := 12, M13_Fan Off := 13 ); END_TYPE VAR s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF en Fast MFuncs : Fast MFuncs; b Turn Fan On : BOOL; END_VAR b Turn Fan On := Itp Is Fast MFunc( M12_Fan On,s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI TF5100 Version: 2.14.3 231
## Page 232

PLC NCI Libraries 7.1.2.27 Itp Is EStop Ex The function Itp Is EStop Ex indicates whether an EStop command was triggered. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Is EStop Ex BOOL If the return value is TRUE, then an EStop was previously executed (e.g. Itp EStop Ex). The flag does not provide information as to whether the axes have already stopped or are still on the deceleration ramp. After execution of Itp Step On After EStop Ex, Itp Is EStop Ex returns FALSE again. Itp Is EStop Ex evaluates the cyclic interface. See also: Itp EStop Ex [} 212] Itp Step On After EStop Ex [} 255] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.28 Itp Is Hsk MFunc The function Itp Is Hsk MFunc determines whether an M-function of type handshake is present. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR 232 Version: 2.14.3 TF5100
## Page 233

PLC NCI Libraries Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Is Hsk MFunc BOOL The function returns TRUE if an M-function of type handshake is present. Itp Is Hsk Func evaluates the variable 'n Hsk MFunc Req' from the cyclic interface. Example VAR b MFunc Request : BOOL; s Nci To Plc AT%I* : NCTOPLC_NCICHANNEL_REF; END_VAR b MFunc Request := Itp Is Hsk MFunc( s Nci To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.29 Itp Load Prog Ex Itp Load Prog Ex b Execute BOOL BOOL b Busy s Prg STRING(255) BOOL b Err n Length UDINT UDINT n Err Id t Time Out TIME ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The Itp Load Progr Ex function block loads the desired NC program. The text file containing the NC program must be coded in ANSI or UTF-8 format. Other text encodings (e.g. UTF-8-BOM) may contain hidden special characters that lead to syntax errors. If no file path is specified, the NC program is searched for in the default directory. This is from Twin CAT 3.1 Build 4026: C:\Program Data\Beckhoff\Twin CAT\Mc\Nci and for previous versions: C:\Twin CAT\Mc\Nci. Inputs VAR_INPUT b Execute : BOOL; s Prg : STRING(255); n Length : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The function block reads the NC program when a rising edge is encountered. s Prg STRING(255) Name of the NC program that is loaded. TF5100 Version: 2.14.3 233
## Page 234

PLC NCI Libraries Name Type Description n Length UDINT String length of the program name t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Example VAR in_st Itp To Plc AT %I* : NCTOPLC_NCICHANNEL_REF; fb Load Prog : Itp Load Prog Ex; s Program Path : STRING (255):= 'Test It.nc'; END_VAR fb Load Prog( b Execute := TRUE, s Prg := s Program Path, n Length := LEN(s Program Path), t Time Out := t#200ms, s Nci To Plc := in_st Itp To Plc ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 234 Version: 2.14.3 TF5100
## Page 235

PLC NCI Libraries 7.1.2.30 Itp Read Cyclic LReal Param1 The function Itp Read Cyclic LReal Param1 reads the first LREAL parameter from the cyclic channel interface. This parameter is configured previously with Itp Set Cyclic LReal Offsets [} 245]. Parameter 2 to 4 are read via the same mechanism (e.g. Itp Read Cyclic LReal Param2). / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Read Cyclic LReal LREAL Return value Parameter 1 of type LREAL Param1 See also: • Itp Read Cyclic Udint Param1 [} 235] • Itp Set Cyclic LReal Offsets [} 245] • Itp Get Cyclic LReal Offsets [} 217] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.31 Itp Read Cyclic Udint Param1 The function Itp Read Cyclic Udint Param1 reads the first UDINT parameter from the cyclic channel interface. This parameter is configured previously with Itp Set Cyclic Udint Offsets [} 246]. Parameter 2 to 4 are read via the same mechanism (e.g. Itp Read Cyclic Udint Param2). / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). TF5100 Version: 2.14.3 235
## Page 236

PLC NCI Libraries Return value Name Type Description Itp Read Cyclic Udint UDINT Return value Parameter 1 of type UDINT Param1 See also: • Itp Read Cyclic LReal Param1 [} 235] • Itp Set Cyclic Udint Offsets [} 246] • Itp Get Cyclic Udint Offsets [} 219] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.32 Itp Read RParams Ex Itp Read RParams Ex b Execute BOOL BOOL b Busy p Addr PVOID BOOL b Err n Index DINT UDINT n Err Id n Count DINT t Time Out TIME ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Read RParams Ex reads arithmetic parameters, in short R-parameters, of the NC, see exact description of the arithmetic parameters [} 134]. A total of 1000 R-parameters are available, of which the first 900 (0..899) are local, so that they are only visible in the current NC channel. The other 100 (900..999) R-parameters are global, and are thus visible from anywhere in the NC. Inputs VAR_INPUT b Execute : BOOL; p Addr : PVOID; n Index : DINT; n Count : DINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge starts the read operation. p Addr PVOID Address of the target variables of the data to be read. Data are written directly from the specified address, i.e. n Index is not to be interpreted as offset from p Addr. The data are usually stored in an array of type LREAL, which has to be defined by the user. n Index DINT Describes the index of the R-parameter to be read from an NC perspective. n Count DINT Number of R-parameters to be read t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR 236 Version: 2.14.3 TF5100
## Page 237

PLC NCI Libraries Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.33 Itp Read Tool Desc Ex Itp Read Tool Desc Ex b Execute BOOL BOOL b Busy n DNo UDINT BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF ↔ s Tool Desc Reference To Tool Desc The function block Itp Read Tool Desc Ex reads the tool parameters for the supplied D-word. Inputs VAR_INPUT b Execute : BOOL; n DNo : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge starts the read operation. n DNo UDINT D-word for which the tool parameters are to be read. n DNo can have values between 1 and 255. t Time Out TIME ADS Timeout-Delay TF5100 Version: 2.14.3 237
## Page 238

PLC NCI Libraries / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; s Tool Desc : Tool Desc; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is only accessed for reading. s Tool Desc Tool Desc A structure into which the tool parameters of n DNo are written. The meaning of the parameters depends on the tool type, and can be found in the tool data [} 180] (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE Tool Desc: STRUCT n Tool Number : UDINT; (*valid range from 0 .. 65535*) n Tool Type : UDINT; f Param : ARRAY [2..15] OF LREAL; END_STRUCT END_TYPE See also: Itp Write Tool Desc Ex [} 258] Itp Set Tool Desc Null Ex [} 250] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 238 Version: 2.14.3 TF5100
## Page 239

PLC NCI Libraries 7.1.2.34 Itp Read Zero Shift Ex Itp Read Zero Shift Ex b Execute BOOL BOOL b Busy n Zs No UDINT BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF ↔ s Zero Shift Desc Reference To Zero Shift Desc The function block Itp Read Zero Shift Ex reads the shift components X, Y and Z for the given zero offset shift. Inputs VAR_INPUT b Execute : BOOL; n Zs No : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge starts the read operation. n Zs No UDINT Number of the zero offset shift. G54 to G59 are zero offset shifts at the NC. The valid range of values for 'n Zs No' is therefore from 54 to 59. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; s Zero Shift Desc : Zero Shift Desc; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). s Zero Shift Desc Zero Shift Desc The structure containing the components of the zero offset shift Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. TF5100 Version: 2.14.3 239
## Page 240

PLC NCI Libraries Name Type Description n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE Zero Shift Desc: STRUCT f Shift X : LREAL; f Shift Y : LREAL; f Shift Z : LREAL; END_STRUCT END_TYPE For reasons of compatibility, there are two entries (coarse and fine) for each axis in each zero offset shift (e.g. G54). These two entries must be added together. This function block evaluates both the entries and adds them together automatically. See also: Itp Write Zero Shift Ex [} 259] Itp Set Zero Shift Null Ex [} 251] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.35 Itp Reset Ex2 Itp Reset Ex2 b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id The function block 'Itp Reset Ex2' executes a channel reset, which deletes all existing tables of the NC channel. In contrast to the outdated function block Itp Reset, an active channel is stopped first, before the reset is executed. This simplifies programming in the PLC, since no explicit check is necessary to ascertain whether the axes are still in motion. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS timeout delay (the b Busy signal can be active for longer than t Time Out) / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR 240 Version: 2.14.3 TF5100
## Page 241

PLC NCI Libraries Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.36 Itp Reset Fast MFunc Ex Itp Reset Fast MFunc Ex b Execute BOOL BOOL b Busy n MFunc No UINT BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The fast M-function [} 164] n MFunc No is reset with a rising edge at input b Execute. In the event of the M- function not being available, no error is returned. The function block Itp Reset Fast MFunc Ex Itp Reset Fast MFunc Ex represents an alternative to Auto-reset or reset with another M-function (reset list during parameterization of the M-function). For reasons of transparency, mixed resets using an M-function and this function block should be avoided. Inputs VAR_INPUT b Execute : BOOL; n MFunc No : UINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. TF5100 Version: 2.14.3 241
## Page 242

PLC NCI Libraries Name Type Description n MFunc No UINT Flying M-function that is to be reset. t Time Out TIME ADS timeout delay (the b Busy signal can be active for longer than t Time Out) / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.37 Itp Set Bottle Neck Look Ahead Ex Itp Set Bottle Neck Look Ahead Ex b Execute BOOL BOOL b Busy n Look Ahead UDINT BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Set Bottle Neck Look Ahead Ex determines the maximum number of segments the system may look ahead for bottleneck detection (contour collision monitoring). Note that segments, which were added as a result of radius compensation (e.g. additional segments at acute angles) are taken into account. A more detailed description can be found in the Interpreter [} 192] documentation. 242 Version: 2.14.3 TF5100
## Page 243

PLC NCI Libraries Inputs VAR_INPUT b Execute : BOOL; n Look Ahead : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Look Ahead UDINT Specifies the look-ahead value t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Not available for GST This function block is not available if the GST interpreter is used. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI TF5100 Version: 2.14.3 243
## Page 244

PLC NCI Libraries 7.1.2.38 Itp Set Bottle Neck Mode Ex Itp Set Bottle Neck Mode Ex b Execute BOOL BOOL b Busy e Bottle Neck Mode E_Itp Bn Mode BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Set Bottle Neck Mode Ex reads the behavior in the event of a contour collision (bottleneck). A more detailed description can be found in the Interpreter [} 192] documentation. Inputs VAR_INPUT b Execute : BOOL; e Bottle Neck Mode: E_Itp Bn Mode; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. e Bottle Neck Mode E_Itp Bn Mode Enum for the behavior in the event of a contour collision t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). 244 Version: 2.14.3 TF5100
## Page 245

PLC NCI Libraries TYPE E_Itp Bn Mode: ( Itp Bnm_Abort := 0, Itp Bnm_Adjust := 1, Itp Bnm_Leave := 2 ); END_TYPE Not available for GST This function block is not available if the GST interpreter is used. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.39 Itp Set Cyclic Lreal Offsets Itp Set Cyclic LReal Offsets b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err n Index Offset Param1 UDINT UDINT n Err Id n Index Offset Param2 UDINT n Index Offset Param3 UDINT n Index Offset Param4 UDINT ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Set Cyclic Lreal Offsets is used to describe the cyclic channel interface for the 4 freely configurable LREAL variables. Variables (index offsets) can be selected from the group state. The functionality is only active if n Index Offset Param1 is not equal 0. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; n Index Offset Param1 : UDINT; n Index Offset Param2 : UDINT; n Index Offset Param3 : UDINT; n Index Offset Param4 : UDINT; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay n Index Offset Param UDINT Group state (Index Offset) for parameter 1 1 n Index Offset Param UDINT Group state (Index Offset) for parameter 2 2 n Index Offset Param UDINT Group state (Index Offset) for parameter 3 3 n Index Offset Param UDINT Group state (Index Offset) for parameter 4 4 / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR TF5100 Version: 2.14.3 245
## Page 246

PLC NCI Libraries Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: • Itp Read Cyclic LReal Param1 [} 235] • Itp Get Cyclic LReal Offsets [} 217] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.40 Itp Set Cyclic UDint Offsets Itp Set Cyclic Udint Offsets b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err n Index Offset Param1 UDINT UDINT n Err Id n Index Offset Param2 UDINT n Index Offset Param3 UDINT n Index Offset Param4 UDINT ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Set Cyclic UDint Offsets is used to describe the cyclic channel interface for the 4 freely configurable UDINT variables. Variables (index offsets) can be selected from the group state. The functionality is only active if n Index Offset Param1 is not equal 0. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; 246 Version: 2.14.3 TF5100
## Page 247

PLC NCI Libraries n Index Offset Param1 : UDINT; n Index Offset Param2 : UDINT; n Index Offset Param3 : UDINT; n Index Offset Param4 : UDINT; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay n Index Offset Param UDINT Group state (Index Offset) for parameter 1 1 n Index Offset Param UDINT Group state (Index Offset) for parameter 2 2 n Index Offset Param UDINT Group state (Index Offset) for parameter 3 3 n Index Offset Param UDINT Group state (Index Offset) for parameter 4 4 / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: • Itp Read Cyclic UDint Param1 [} 235] • Itp Get Cyclic Udint Offsets [} 219] TF5100 Version: 2.14.3 247
## Page 248

PLC NCI Libraries Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.41 Itp Set Override Percent The function Itp Set Override Percent writes the axes channel override into the cyclic interface of the NCI. The override is passed as a percentage. Inputs FUNCTION Itp Set Override Percent VAR_INPUT f Override Percent : LREAL; END_VAR Name Type Description f Override Percent LREAL Axis channel override as a percentage / Inputs/Outputs VAR_IN_OUT s Plc To Nci : PLCTONC_NCICHANNEL_REF; END_VAR Name Type Description s Plc To Nci PLCTONC_NCICHANN Structure of cyclic channel interface between PLC and NCI EL_REF (type: PLCTONC_NCICHANNEL_REF [} 344]) Return value Name Type Description Itp Set Override Percent BOOL always TRUE Example VAR s Plc To Nci AT%Q*: PLCTONC_NCICHANNEL_REF; f Override : LREAL; END_VAR f Override := 47.11; Itp Set Override Percent( f Override, s Plc To Nci ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 248 Version: 2.14.3 TF5100
## Page 249

PLC NCI Libraries 7.1.2.42 Itp Set Subroutine Path Ex Itp Set Subroutine Path Ex b Execute BOOL BOOL b Busy s Path STRING(80) BOOL b Err n Length UDINT UDINT n Err Id t Time Out TIME ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF With function block Itp Set Subroutine Path Ex, the search path for subroutines can be set optionally. If a subroutine still has to be integrated, the file is searched in the following order: 1. Optional search path (Itp Set Subroutine Path Ex) 2. Path that the main program was loaded from 3. Default directory Only one optional path can take effect, which remains active until it is overwritten with another path or an empty string. After a Twin CAT restart, the optional path has to be reassigned. Inputs VAR_INPUT b Execute : BOOL; s Path : STRING; n Length : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. s Path STRING Optional path for subroutines. Is disabled with an empty string. n Length UDINT String length t Time Out TIME ADS timeout delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new TF5100 Version: 2.14.3 249
## Page 250

PLC NCI Libraries Name Type Description command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Twin CAT and interpreter version PLC libraries to include Classic dialect interpreter: Tc2_NCI • Twin CAT V3.1.0 GST interpreter: • Twin CAT V3.1.4024.68 • Twin CAT V3.1.4026 ◦ Twin CAT. XAR. NCI. GST=3.2.18 7.1.2.43 Itp Set Tool Desc Null Ex The function block Itp Set Tool Desc Null Ex overwrites all tool parameters (incl. number & type) of the channel with zero. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge results in overwriting of all tool parameters of the NC channel with zero. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). 250 Version: 2.14.3 TF5100
## Page 251

PLC NCI Libraries Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: Itp Write Tool Desc Ex [} 258] Itp Read Tool Desc Ex [} 237] Not available for GST This function block is not available if the GST interpreter is used. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.44 Itp Set Zero Shift Null Ex Itp Set Zero Shift Null Ex b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id The function block Itp Set Zero Shift Null Ex overwrites all zero offset shifts of the channel with zero. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge results in overwriting of all zero offset shifts of the NC channel with zero. t Time Out TIME ADS Timeout-Delay TF5100 Version: 2.14.3 251
## Page 252

PLC NCI Libraries / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: • Itp Write Zero Shift Ex [} 259], • Itp Read Zero Shift Ex [} 239]. Not Available for GST This function block is not available if the GST interpreter is employed. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.45 Itp Single Block Itp Single Block b Execute Mode Change BOOL BOOL b Busy n Mode E_Itp Single Block Mode BOOL b Err b Trigger Next BOOL UDINT n Err Id t Time Out TIME ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF 252 Version: 2.14.3 TF5100
## Page 253

PLC NCI Libraries The function block Itp Single Block enables or disables single block mode in the NCI. Block relaying can be triggered directly from the PLC with the input 'b Trigger Next'. Alternatively the Start button of the interpreter (F5) can be used in the XAE. A more detailed description can be found in the Interpreter documentation [} 133]. Inputs VAR_INPUT b Execute Mode Change : BOOL; n Mode : E_Itp Single Block Mode; b Trigger Next : BOOL t Time Out : TIME; END_VAR Name Type Description b Execute Mode Cha BOOL Single block mode (n Mode) is activated through a rising edge nge at this input. n Mode E_Itp Single Block Mode Operation mode for single block (cf. single block mode): • Itp Single Block Off: Single block off • Itp Single Block Nck: Single block in NC kernel • Itp Single Block Intp: Single block in interpreter b Trigger Next BOOL Block relaying is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay Itp Single Block Intp is not available when using the GST interpreter. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). TYPE E_Itp Single Block Mode: ( Itp Single Block Off := 0, Itp Single Block Nck := 1, Itp Single Block Intp := 16#4000 ); END_TYPE Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. TF5100 Version: 2.14.3 253
## Page 254

PLC NCI Libraries Name Type Description b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.46 Itp Start Stop Ex Itp Start Stop Ex b Start BOOL BOOL b Busy b Stop BOOL BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Start Stop Ex starts or stops the NC channel. Inputs VAR_INPUT b Start : BOOL; b Stop : BOOL; t Time Out : TIME; END_VAR Name Type Description b Start BOOL A positive edge starts the NC channel. b Stop BOOL A positive edge stops the NC channel. A stop command deletes all the tables in the NC and brings the axes to a controlled halt. t Time Out TIME ADS Timeout-Delay The b Stop input has a higher priority than the b Start input, so that if both inputs receive a positive edge, a channel stop will be executed. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). 254 Version: 2.14.3 TF5100
## Page 255

PLC NCI Libraries Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.47 Itp Step On After EStop Ex Itp Step On After EStop Ex b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id The function block Itp Step On After EStop Ex enables further processing of the parts program after a programmed EStop Ex. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). TF5100 Version: 2.14.3 255
## Page 256

PLC NCI Libraries Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: Itp EStop Ex [} 212] Itp Is EStop Ex [} 232] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.48 Itp Write RParams Ex Itp Write RParams Ex b Execute BOOL BOOL b Busy p Addr PVOID BOOL b Err n Index DINT UDINT n Err Id n Count DINT t Time Out TIME ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Write RParams Ex writes R-parameters into the NC. Inputs VAR_INPUT b Execute : BOOL; p Addr : DWORD; n Index : DINT; n Count : DINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge starts the write operation. 256 Version: 2.14.3 TF5100
## Page 257

PLC NCI Libraries Name Type Description p Addr DWORD Address of the variables containing the data to be written. Data are used directly from the specified address, i.e. n Index is not to be interpreted as offset from p Addr. The data are usually read from an array of type LREAL, which has to be defined by the user. n Index DINT Describes the index of the R-parameter to be written from an NC perspective. n Count DINT Number of R-parameters to be written t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Example VAR arrf RParam90to99 : ARRAY[0..9] OF LREAL; fb Write RParam : Itp Write RParams Ex; n : INT := 0; b Write Param : BOOL := FALSE; s Nci To Plc AT%I* : NCTOPLC_NCICHANNEL_REF; END_VAR FOR n:=0 TO 9 DO arrf RParam90to99[n] := 90 + n; END_FOR fb Write RParam( b Execute := b Write Param, p Addr := ADR( arrf RParam90to99[0] ), n Index := 90, TF5100 Version: 2.14.3 257
## Page 258

PLC NCI Libraries n Count := 10, t Time Out := T#200ms, s Nci To Plc := s Nci To Plc ); In this example the parameters R90 to R99 are written from an NC perspective. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.49 Itp Write Tool Desc Ex Itp Write Tool Desc Ex b Execute BOOL BOOL b Busy n DNo UDINT BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF ↔ s Tool Desc Reference To Tool Desc The function block Itp Write Tool Desc Ex writes a block of tool parameters. Inputs VAR_INPUT b Execute : BOOL; n DNo : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n DNo UDINT D-word for which the tool parameters are to be read. n DNo can have values between 1 and 255. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; s Tool Desc : Tool Desc; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). s Tool Desc Tool Desc The structure that contains the new tool parameters. This structure is only accessed for reading. The meaning of the parameters depends on the tool type, and can be found in the tool data [} 180]. Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR 258 Version: 2.14.3 TF5100
## Page 259

PLC NCI Libraries Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE Tool Desc: STRUCT n Tool Number : UDINT; (*valid range from 0 .. 65535*) n Tool Type : UDINT; f Param : ARRAY [2..15] OF LREAL; END_STRUCT END_TYPE See also: Itp Read Tool Desc Ex [} 237] Itp Set Tool Desc Null Ex [} 250] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.50 Itp Write Zero Shift Ex Itp Write Zero Shift Ex b Execute BOOL BOOL b Busy n Zs No UDINT BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF ↔ s Zero Shift Desc Reference To Zero Shift Desc The function block Itp Write Zero Shift Ex writes the shift components X, Y and Z for the specified zero offset shift. Inputs VAR_INPUT b Execute : BOOL; n Zs No : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Zs No UDINT Number of the zero offset shift G54 to G59 are zero offset shifts at the NC. G58 and G59 can only be edited from the NC program. The valid range of values for 'n Zs No' is therefore from 54 to 57. TF5100 Version: 2.14.3 259
## Page 260

PLC NCI Libraries Name Type Description t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc AT%I*: NCTOPLC_NCICHANNEL_REF; s Zero Shift Desc : Zero Shift Desc; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). s Tool Desc Tool Desc The structure containing the components of the zero offset shift. This structure is only accessed for reading. Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE Zero Shift Desc: STRUCT f Shift X : LREAL; f Shift Y : LREAL; f Shift Z : LREAL; END_STRUCT END_TYPE For reasons of compatibility every zero offset shift that can be set has two parameters (coarse and fine) for each axis. When using this function block to write a new zero offset shift, the new value is written into the 'fine parameter'. A value of 0.0 is entered into the 'coarse parameter'. This makes it possible to use a function block such as Itp Read Zero Shift Ex [} 239] to read and modify a zero offset shift and to send it back to the NC. See also: • Itp Read Zero Shift Ex [} 239] • Itp Set Zero Shift Null Ex [} 251] 260 Version: 2.14.3 TF5100
## Page 261

PLC NCI Libraries Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.2.51 Blocksearch Blocksearch can be used to interrupt a program for a tool change or at the end of a shift. After the interruption the program can continue at the previous position. The diagram illustrates how the Blocksearch is used. 7.1.2.51.1 Itp Blocksearch Itp Block Search b Execute BOOL BOOL b Busy n Block Id UDINT BOOL b Err e Block Search Mode E_Itp Block Search Mode UDINT n Err Id e Dry Run Mode E_Itp Dry Run Mode BOOL b Done f Length LREAL ST_Itp Block Search Start Position s Start Position s Prg Name STRING(255) n Prg Length UDINT t Time Out TIME s Axes List ST_Itp Axes s Options ST_Itp Block Search Options ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Blocksearch sets the interpreter to the point defined at the inputs. If Blocksearch is executed during the first segment that contains a movement, the output s Start Position of the function block Itp Blocksearch may return wrong values. For this reason, Blocksearch should only be used from the second segment. The input values can be taken from function block Itp Get Blocksearch Data [} 264] or set manually. Once the interpreter has been set to the defined location with Itp Blocksearch, the motion can continue with Itp Step On After Blocksearch [} 265] at the position indicated at output s Start Position. Inputs VAR_INPUT b Execute : BOOL; n Block Id : UDINT; e Block Search Mode : E_Itp Block Search Mode; e Dry Run Mode : E_Itp Dry Run Mode; f Length : LREAL; s Prg Name : STRING(255); n Prg Length : UDINT; t Time Out : TIME; TF5100 Version: 2.14.3 261
## Page 262

PLC NCI Libraries s Axes List : ST_Itp Axes; s Options : ST_Itp Block Search Options; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Block Id UDINT Block number or Entry Counter of the segment in the NC program used as starting point. e Block Search Mode E_Itp Block Search Mode Defines whether the specified n Block Id is a block number (e.g. N4711) or continuous Entry Counter. A prerequisite for using the block number is that it is unique. See E_Itp Block Search Mode [} 263]. e Dry Run Mode E_Itp Dry Run Mode Defines which program lines are executed and which are skipped. See E_Itp Dry Run Mode [} 263]. f Length LREAL Entry point within the segment selected with n Block Id in percent. s Prg Name STRING(255) Name or path of the program to be executed. n Prg Length UDINT Indicates the length of string s Prg Name. t Time Out TIME ADS timeout delay s Axes List ST_Itp Axes Definition of the axes in the NCI group. See ST_Itp Axes [} 263]. s Options ST_Itp Block Search Opti ST_Itp Block Search Options ons / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; b Done : BOOL; s Start Position : ST_Itp Block Search Start Position; END_VAR Name Type Description b Busy BOOL Remains TRUE until the function block has executed a command request, but no longer than the time specified at the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. b Err BOOL Becomes TRUE if an error occurs during command execution. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). b Done BOOL The output becomes TRUE when the command was executed successfully. 262 Version: 2.14.3 TF5100
## Page 263

PLC NCI Libraries Name Type Description s Start Position ST_Itp Block Search Star Indicates the start position from which the NC program t Position continues. The individual axes should be moved to this position before Itp Step On After Blocksearch [} 265] is executed. See ST_Itp Block Search Start Position [} 264]. E_Itp Block Search Mode E_Itp Block Search Mode is used to define in which way the block search is executed. TYPE E_Itp Block Search Mode : ( Itp Block Search Mode_Disable := 0, Itp Block Search Mode_Block No := 1, Itp Block Search Mode_Entry Counter := 2 ); END_TYPE Itp Block Search Mode_Disable: Block search disabled (initial value). Itp Block Search Mode_Block No: The block search is executed via the block number (e.g. N4711) programmed by the user in the NC program. A prerequisite is that the user-defined block number is unique. Itp Block Search Mode_Entry Counter: The block search is executed via a unique Entry Counter. This Entry Counter is implicitly unique, but it is not visible to the user in the NC program. E_Itp Dry Run Mode The enumeration E_Itp Dry Run Mode enumerates those ways how the programmed blocks from the beginning of the program up to the place searched for shall be handled. TYPE E_Itp Dry Run Mode : ( Itp Dry Run Mode_Disable := 0, Itp Dry Run Mode_Skip All := 1, Itp Dry Run Mode_Skip Motion Only := 2, Itp Dry Run Mode_Skip Dwell And Motion := 3 ); END_TYPE Itp Dry Run Mode_Disable: Dry Run disabled (initial value). Itp Dry Run Mode_Skip All: All previous blocks are skipped. R-parameters are written. Itp Dry Run Mode_Skip Motion Only: Only movement blocks are skipped. R-parameters are written, and dwell times and M-functions are executed. Itp Dry Run Mode_Skip Dwell And Motion: Movement blocks and dwell times are skipped. R-parameters are written and M-functions are executed. ST_Itp Axes The structure ST_Itp Axes contains the axes that were in the NCI group during program execution. The interpolation group should not be built when blocksearch is executed. In order to still have a reference to the group axes, the structure ST_Itp Axes must be filled with the group axes. TYPE ST_Itp Axes : STRUCT n Axis Ids : ARRAY[1..8] OF UDINT; END_STRUCT END_TYPE n Axis Ids: Array of axes that were in the NCI group. The order is n Axis Ids[1]=X, n Axis Ids[2]=Y, n Axis Ids[3]=Z, n Axis Ids[4]=Q1, n Axis Ids[5]=Q2… The axis ID can be read from the cyclic axis interface. St_Itp Block Search Options The structure contains additional Blocksearch options. TF5100 Version: 2.14.3 263
## Page 264

PLC NCI Libraries TYPE ST_Itp Block Search Options : STRUCT b Is Retrace : BOOL:= FALSE; b Retrace Backward : BOOL:= FALSE; b Scan Start Pos : BOOL:= FALSE; END_STRUCT END_TYPE b Is Retrace: Indicates whether the retrace functionality is active. b Retrace Backward: Indicates whether backward movement took place on the path. b Scan Start Pos: b Scan Start Pos: Specifies whether or not the current axis positions should be read at the start of the program. In combination with ST_Itp Axes List, please set this input to TRUE. Setting this input to FALSE only makes sense for old projects (compatibility reasons). ST_Itp Block Search Start Position The structure indicates the position at which the NC program continues after a block search. The user is responsible for moving the axes to the corresponding positions. TYPE ST_Itp Block Search Start Position : STRUCT s Start Position : ARRAY[1..8] OF LREAL; END_STRUCT END_TYPE s Start Position: Array of axis positions at which the NC program continues. The order is s Start Position[1]=X, s Start Position [2]=Y, s Start Position [3]=Z, s Start Position [4]=Q1, s Start Position [5]=Q2… Voraussetzungen Entwicklungsumgebung Zielplattform Einzubindende SPS Biblio- theken Classic Dialect Interpreter: Twin CAT V3.1.0 PC oder CX (x86 oder x64) Tc2_NCI GST Interpreter: Twin CAT V3.1.4024.20 7.1.2.51.2 Itp Get Blocksearch Data Itp Get Block Search Data b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id ST_Itp Block Search Data s Block Search Data The function block Itp Get Blocksearch Data reads the current position on the path. Usually this command is called at standstill. Subsequently Itp Block Search [} 261] can be used to set the interpreter to the position stored in s Block Search Data. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay 264 Version: 2.14.3 TF5100
## Page 265

PLC NCI Libraries / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; s Block Search Data : ST_Itp Block Search Data; END_VAR Name Type Description b Busy BOOL Remains TRUE until the function block has executed a command request, but no longer than the time specified at the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. b Err BOOL Becomes TRUE if an error occurs during command execution. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). s Block Search Data ST_Itp Block Search Dat Contains information on the current position on the path. a TYPE ST_Itp Block Search Data : STRUCT f Length : LREAL;(* remaining distance of actual movement block in percent*) n Block No : UDINT;(* number of the actual block *) n Block Counter : UDINT;(* counter value of the actual block *) b Is Retrace : BOOL;(* indicates whether Retrace is active*) b Retrace Backward : BOOL;(* indicates whether backward movement took place on the path*) END_STRUCT END_TYPE 7.1.2.51.3 Itp Step On After Blocksearch Itp Step On After Block Search b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id The function block Itp Step On After Blocksearch starts the movement after a Blocksearch has been executed. The axes first have to be moved to the positions output by Itp Blocksearch [} 261]. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR TF5100 Version: 2.14.3 265
## Page 266

PLC NCI Libraries Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). 7.1.2.52 Retrace 7.1.2.52.1 Itp Enable Feeder Backup Itp Enable Feeder Backup b Enable BOOL BOOL b Busy b Execute BOOL BOOL b Err t Time Out TIME UDINT n Err Id ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF The function block Itp Enable Feeder Backup enables storing of the path for retracing. It has to be activated once before the NC program (G-Code) is started. If the functionality Blocksearch [} 261] is used, Itp Enable Feeder Backup has to be activated before Itp Blocksearch [} 261] is called. Feeder backup is executed as long as a Twin CAT restart or b Enable = FALSE is triggered with a rising edge at b Execute. If feeder backup is not enabled, retracing does not work. This can be verified via Itp Is Feeder Backup Enabled [} 268]. 266 Version: 2.14.3 TF5100
## Page 267

PLC NCI Libraries Inputs VAR_INPUT b Enable : BOOL; b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Enable BOOL TRUE: Enables feeder backup FALSE: Disables feeder backup b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Voraussetzungen Entwicklungsumgebung Zielplattform Einzubindende SPS-Biblio- theken Twin CAT V3.1.0 Classic Interpreter PC oder CX (x86 oder x64) Tc2_NCI Twin CAT V3.1.4024.40 GST Interpreter TF5100 Version: 2.14.3 267
## Page 268

PLC NCI Libraries 7.1.2.52.2 Itp Is Feeder Backup Enabled Itp Is Feeder Backup Enabled b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Enabled ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF BOOL b Err UDINT n Err Id The function block Itp Is Feeder Backup Enabled indicates whether feeder backup is enabled. Feeder backup must be enabled before reversing can take place. This activates storing of the path. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Enabled : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL The b Busy output remains TRUE until the function block has executed a command, with the maximum duration specified by the time associated with the ‘Timeout’ input. While b Busy = TRUE, no new instruction will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Enabled BOOL TRUE: Backup list for tracing is enabled. FALSE: Backup list for tracing is disabled. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in ‘n Err Id’. If the function block has a timeout error, ‘Error’ is TRUE and ‘n Err Id’ is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). 268 Version: 2.14.3 TF5100
## Page 269

PLC NCI Libraries Voraussetzungen Entwicklungsumgebung Zielplattform Einzubindende SPS-Biblio- theken Twin CAT V3.1.0 Classic Interpreter PC oder CX (x86 oder x64) Tc2_NCI Twin CAT V3.1.4024.40 GST Interpreter 7.1.2.52.3 Itp Is Feed From Backup List The function Itp Is Feed From Backup List becomes TRUE when the feed entries (SAF & SVB) were sent from the backup list. During backward movement all entries are sent from the backup list. If the program is executed in forward mode, the first entries usually also originate from the backup list. This is dependent of the number of retraced entries and the number of entries in the SVB and SAF tables at the time at which tracing was called. All further commands originate from the ‚original’ code. While the NCI is processing the backup list, not all functions are available or meaningful. Here are a few examples: • Decoder stops such as @714 are not evaluated • Modifications of R-parameters do not take effect as long as the motion takes place on the backup path (forward or backward). R-parameters modifications take effect again as soon as the path data no longer come from the backup list. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Voraussetzungen Entwicklungsumgebung Zielplattform Einzubindende SPS-Biblio- theken Twin CAT V3.1.0 Classic Interpreter PC oder CX (x86 oder x64) Tc2_NCI Twin CAT V3.1.4024.40 GST Interpreter 7.1.2.52.4 Itp Is First Segment Reached The function Itp Is First Segment Reached determines whether the program start position is reached during retracing, based on the cyclic channel interface. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR TF5100 Version: 2.14.3 269
## Page 270

PLC NCI Libraries Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Is First Segment R BOOL The function returns TRUE when the start position of the G- eached Code program is reached. If the version number of the cyclic channel interface is less than 6, the return value is always FALSE. Voraussetzungen Entwicklungsumgebung Zielplattform Einzubindende SPS-Biblio- theken Twin CAT V3.1.0 Classic Interpreter PC oder CX (x86 oder x64) Tc2_NCI Twin CAT V3.1.4024.40 GST Interpreter 7.1.2.52.5 Itp Is Moving Backwards The function Itp Is Moving Backwards determines whether backward movement takes place on the path of the current G-Code program, based on the cyclic channel interface. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Return value Name Type Description Itp Is Moving Backwar BOOL The function returns TRUE when backward movement takes ds place on the path. If the version number of the cyclic channel interface is less than 6, the return value is always FALSE. Voraussetzungen Entwicklungsumgebung Zielplattform Einzubindende SPS-Biblio- theken Twin CAT V3.1.0 Classic Interpreter PC oder CX (x86 oder x64) Tc2_NCI Twin CAT V3.1.4024.40 GST Interpreter 270 Version: 2.14.3 TF5100
## Page 271

PLC NCI Libraries 7.1.2.52.6 Itp Retrace Move Backward Itp Retrace Move Backward b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id The function block Itp Retrace Move Backward deals with the geometric entries at the actual position at the start of the part program (G-Code). Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Procedure 1. Enable feeder backup list (see Itp Enable Feeder Backup [} 266]). ð The NC program is stopped with Itp EStop Ex [} 212]. TF5100 Version: 2.14.3 271
## Page 272

PLC NCI Libraries 2. Wait and ensure that all axes in the group are at standstill. 3. Call Itp Retrace Move Backward. 4. Stop backward movement with Itp EStop, otherwise the program returns to the start. 5. Call Itp Retrace Move Forward [} 272] to move forward again. 6. Call Itp EStop Ex and Itp Retrace Move Backward etc., if required. NOTICE Do not use in conjunction with vertex blending. M-functions are suppressed during backward movement. Voraussetzungen Entwicklungsumgebung Zielplattform Einzubindende SPS-Biblio- theken Twin CAT V3.1.0 Classic Interpreter PC oder CX (x86 oder x64) Tc2_NCI Twin CAT V3.1.4024.40 GST Interpreter 7.1.2.52.7 Itp Retrace Move Forward Itp Retrace Move Forward b Execute BOOL BOOL b Busy t Time Out TIME BOOL b Err ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT n Err Id The function block Itp Retrace Move Forward transfers all entries from the current block (e.g. position) in forward travel direction to the NC kernel. It is called to reverse the direction after Itp Retrace Move Backward [} 271] was called. Inputs VAR_INPUT b Execute : BOOL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR 272 Version: 2.14.3 TF5100
## Page 273

PLC NCI Libraries Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: Itp Retrace Move Backward [} 271] Voraussetzungen Entwicklungsumgebung Zielplattform Einzubindende SPS-Biblio- theken Twin CAT V3.1.0 Classic Interpreter PC oder CX (x86 oder x64) Tc2_NCI Twin CAT V3.1.4024.40 GST Interpreter 7.1.3 Parts program generator The function blocks Itp Ppg* provide an option for creating a parts program (G-Code file) from the PLC. During program generation a distinction is made between a main program (Itp Ppg Create Main [} 280]) and a subroutine (Itp Ppg Create Subroutine [} 281]). Subsequently Itp Ppg Append* can be used to add various NC lines. The following function blocks are available: • Itp Ppg Append Geo Line [} 277] adds a linear motion. • Itp Ppg Append Geo Circle By Radius [} 275] adds a circle with radius specification. • Itp Ppg Append Generic Block [} 274] inserts a self-defined line, such as activation of rounding or M- functions. Once the parts program is complete, it is closed with the routines Itp Ppg Close Main [} 278] or Itp Ppg Close Subroutine [} 279]. TF5100 Version: 2.14.3 273
## Page 274

PLC NCI Libraries The following function blocks can be used: Function block Description Itp Ppg Append Generic Block [} 274] Appends a generic NC line to a specified parts program. Itp Ppg Append Geo Circle By Radius [} 275] Adds a circle to a specified parts program. Itp Ppg Append Geo Line [} 277] Adds a linear motion to a specified parts program. Itp Ppg Close Main [} 278] Closes a previously opened parts program. Itp Ppg Close Subroutine [} 279] Closes a previously opened subroutine. Itp Ppg Create Main [} 280] Opens or generates a parts program. Itp Ppg Create Subroutine [} 281] Opens or generates a subroutine. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.3.1 Itp Ppg Append Generic Block Itp Ppg Append Generic Block b Execute BOOL BOOL b Busy s Path Name STRING(80) BOOL b Err s Block STRING(80) UDINT n Err Id t Time Out TIME The function block Itp Ppg Append Generic Block adds a generic line to the parts program. It can be used to activate an M-function or rounding, for example. 274 Version: 2.14.3 TF5100
## Page 275

PLC NCI Libraries Before the actual call, call Itp Ppg Create Main [} 280] or Itp Ppg Create Subroutine [} 281]. Inputs VAR_INPUT b Execute : BOOL; s Path Name : STRING; s Block : STRING; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. s Path Name STRING Name of the parts program including path name s Block STRING Generic line to be added to the parts program. t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.3.2 Itp Ppg Append Geo Circle By Radius Itp Ppg Append Geo Circle By Radius b Execute BOOL BOOL b Busy s Path Name STRING(80) BOOL b Err b Clock Wise BOOL UDINT n Err Id f Target XPos LREAL f Target YPos LREAL f Target ZPos LREAL f Radius LREAL f Path Velo LREAL n Block No UDINT t Time Out TIME TF5100 Version: 2.14.3 275
## Page 276

PLC NCI Libraries The function block Itp Ppg Append Geo Circle By Radius adds a circular motion to the parts program. The circle is parameterized by the radius. Before the actual call, call Itp Ppg Create Main [} 280] or Itp Ppg Create Subroutine [} 281]. Inputs VAR_INPUT b Execute : BOOL; s Path Name : STRING; b Clock Wise : BOOL; f Target XPos : LREAL; f Target YPos : LREAL; f Target ZPos : LREAL; f Radius : LREAL; f Path Velo : LREAL; n Block No : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. s Path Name STRING Name of the parts program including path name b Clock Wise BOOL If TRUE, the movement along the circle is clockwise, otherwise counter-clockwise. f Target XPos LREAL Target position of the X axis f Target YPos LREAL Target position of the Y axis f Target ZPos LREAL Target position of the Z axis f Radius LREAL Circle radius f Path Velo LREAL Path velocity n Block No UDINT Line number in the parts program t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 276 Version: 2.14.3 TF5100
## Page 277

PLC NCI Libraries 7.1.3.3 Itp Ppg Append Geo Line Itp Ppg Append Geo Line b Execute BOOL BOOL b Busy s Path Name STRING(80) BOOL b Err f Target XPos LREAL UDINT n Err Id f Target YPos LREAL f Target ZPos LREAL f Path Velo LREAL n Block No UDINT t Time Out TIME The function block Itp Ppg Append Geo Line adds a linear motion to the parts program. In addition to the actual target position, the path velocity and the line number are transferred. Before the actual call, call Itp Ppg Create Main [} 280] or Itp Ppg Create Subroutine [} 281]. Inputs VAR_INPUT b Execute : BOOL; s Path Name : STRING; f Target XPos : LREAL; f Target YPos : LREAL; f Target ZPos : LREAL; f Path Velo : LREAL; n Block No : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. s Path Name STRING Name of the parts program including path name f Target XPos LREAL Target position of the X axis f Target YPos LREAL Target position of the Y axis f Target ZPos LREAL Target position of the Z axis f Path Velo LREAL Path velocity n Block No UDINT Line number in the parts program t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. TF5100 Version: 2.14.3 277
## Page 278

PLC NCI Libraries Name Type Description n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.3.4 Itp Ppg Close Main Itp Ppg Close Main b Execute BOOL BOOL b Busy s Path Name STRING(80) BOOL b Err t Time Out TIME UDINT n Err Id The function block Itp Ppg Close Main completes the main program with the corresponding code for the interpreter (M02). Before the actual call, call Itp Ppg Create Main [} 280]. Inputs VAR_INPUT b Execute : BOOL; s Path Name : STRING; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. s Path Name STRING Name of the parts program including path name t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. 278 Version: 2.14.3 TF5100
## Page 279

PLC NCI Libraries Name Type Description n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.3.5 Itp Ppg Close Subroutine Itp Ppg Close Subroutine b Execute BOOL BOOL b Busy s Path Name STRING(80) BOOL b Err t Time Out TIME UDINT n Err Id The function block Itp Ppg Close Subroutine completes the subroutine with the corresponding code for the interpreter (M17). Before the actual call, call Itp Ppg Create Subroutine [} 281]. Inputs VAR_INPUT b Execute : BOOL; s Path Name : STRING; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. s Path Name STRING Name of the parts program including path name t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. TF5100 Version: 2.14.3 279
## Page 280

PLC NCI Libraries Name Type Description n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.3.6 Itp Ppg Create Main Itp Ppg Create Main b Execute BOOL BOOL b Busy s Path Name STRING(80) BOOL b Err t Time Out TIME UDINT n Err Id The function block Itp Ppg Create Main generates a new file, which can later be processed as main program. If the file does not yet exist, it is created, otherwise it is overwritten. Inputs VAR_INPUT b Execute : BOOL; s Path Name : STRING; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. s Path Name STRING Name of the parts program including path name t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). 280 Version: 2.14.3 TF5100
## Page 281

PLC NCI Libraries Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.3.7 Itp Ppg Create Subroutine Itp Ppg Create Subroutine b Execute BOOL BOOL b Busy s Path Name STRING(80) BOOL b Err n Subroutine Id UDINT UDINT n Err Id t Time Out TIME The function block Itp Ppg Create Subroutine generates a new file, which can later be processed as subroutine. If the file does not yet exist, it is created, otherwise it is overwritten. Inputs VAR_INPUT b Execute : BOOL; s Path Name : STRING; n Subroutine Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. s Path Name STRING Name of the parts program including path name n Subroutine Id UDINT Number of the subroutine t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI TF5100 Version: 2.14.3 281
## Page 282

PLC NCI Libraries 7.1.4 Function blocks for compatibility with existing programs Function blocks for compatibility The purpose of the function blocks listed is to ensure compatibility with existing projects. For new projects it is recommended not to use these function blocks and to use the equivalent function blocks instead, see Overview of the library Tc2_NCI [} 206]. Function block Description Itp Del Dtg [} 282] Triggers "Delete Distance to go" in the NC. Itp EStop [} 283] Triggers the NCI EStop. Itp Get Bottle Neck Look Ahead [} 285] Provides the value of the look-ahead for bottleneck detection. Itp Get Bottle Neck Mode [} 286] Provides the response mode for bottleneck detection. Itp Get Geo Info And HParam [} 287] Reads information of the currently active segment and past and future segments. Itp Go Ahead [} 288] Triggers the Go Ahead function. Itp Is EStop [} 289] Determines whether an EStop is executed or pending. Itp Load Prog [} 290] Loads an NC program using program names. Itp Read RParams [} 291] Reads arithmetic parameters. Itp Read Tool Desc [} 292] Reads the tool description from the NC. Itp Read Zero Shift [} 294] Reads the zero offset shift from the NC. Itp Reset [} 295] Carries out a reset of the interpreter or of the NC channel. Itp Reset Ex [} 296] Carries out a reset of the interpreter or of the NC channel. Itp Reset Fast MFunc [} 297] Resets a fast signal bit. Itp Set Bottle Neck Look Ahead [} 298] Sets the value of the look-ahead for bottleneck detection. Itp Set Bottle Neck Mode [} 299] Sets the response mode when bottleneck detection is switched on. Itp Set Subroutine Path [} 300] Optionally sets the search path for subroutines. Itp Set Tool Desc Null [} 302] Sets all tool parameters (including number and type) to null. Itp Set Zero Shift Null [} 303] Sets all zero points to null. Itp Start Stop [} 304] Starts or stops the interpreter (NC channel). Itp Step On After EStop [} 305] Enables further processing of the parts program after an NCI Estop. Itp Write RParams [} 306] Writes arithmetic parameters. Itp Write Tool Desc [} 307] Writes the tool description into the NC. Itp Write Zero Shift [} 309] Writes the zero offset shift into the NC. 7.1.4.1 Itp Del Dtg Itp Del Dtg b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id The function block Itp Del Dtg triggers "Delete distance to go". There is a more detailed description in the Interpreter [} 159] documentation. 282 Version: 2.14.3 TF5100
## Page 283

PLC NCI Libraries Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Del Dtg Ex [} 209]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.2 Itp EStop Itp EStop b Execute BOOL BOOL b Busy n Grp Id UDINT BOOL b Err f Dec LREAL UDINT n Err Id f Jerk LREAL t Time Out TIME The function block Itp EStop triggers the NCI EStop and enables a controlled stop on the path. The limit values for the deceleration and the jerk are transferred as parameters. If these are smaller than the currently active dynamic parameters, the transferred parameters are rejected. TF5100 Version: 2.14.3 283
## Page 284

PLC NCI Libraries Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp EStop Ex [} 212]. Inputs VAR_INPUT b Execute : BOOL; n Grp Id : UDINT; f Dec : LREAL; f Jerk : LREAL; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Grp Id UDINT Group ID f Dec LREAL Max. deceleration during stopping. If f Dec is smaller than the currently active deceleration, f Dec is rejected. This ensures that the deceleration occurs with the standard ramp as a minimum. f Jerk LREAL Max. jerk during stopping. If f Jerk is smaller than the currently active jerk, f Jerk is rejected. t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: Itp Step On After EStop [} 305] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 284 Version: 2.14.3 TF5100
## Page 285

PLC NCI Libraries 7.1.4.3 Itp Get Bottle Neck Look Ahead Itp Get Bottle Neck Look Ahead b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id UDINT n Look Ahead The function block Itp Get Bottle Neck Look Ahead determines the maximum size of the Look Ahead for the bottleneck detection (contour collision monitoring). A more detailed description can be found in the Interpreter [} 192] documentation. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Get Bottle Neck Look Ahead Ex [} 213]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; n Look Ahead : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. If the function block has a timeout error, 'Error' is TRUE and 'n Err Id' is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). n Look Ahead UDINT Value of the look-ahead for bottleneck detection TF5100 Version: 2.14.3 285
## Page 286

PLC NCI Libraries Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.4 Itp Get Bottle Neck Mode Itp Get Bottle Neck Mode b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id E_Itp Bn Mode e Bottle Neck Mode The function block Itp Get Bottle Neck Mode reads the behavior in the event of a contour collision (bottleneck). A more detailed description can be found in the Interpreter [} 192] documentation. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Get Bottle Neck Mode Ex [} 215]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; e Bottle Neck Mode: E_Itp Bn Mode; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. If the function block has a timeout error, 'Error' is TRUE and 'n Err Id' is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). 286 Version: 2.14.3 TF5100
## Page 287

PLC NCI Libraries Name Type Description e Bottle Neck Mode E_Itp Bn Mode Enum for the behavior in the event of a contour collision TYPE E_Itp Bn Mode: ( Itp Bnm_Abort := 0, Itp Bnm_Adjust := 1, Itp Bnm_Leave := 2 ); END_TYPE Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.5 Itp Get Geo Info And HParam Itp Get Geo Info And HParam ↔ s Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF ST_Itp Pre View Tab st Tab UDINT n Err Id The function block Itp Get Geo Info And HParam reads information of the currently active segment and past and future segments. These include block number, H-parameter and residual path length on the segment. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Get Geo Info And HParam Ex [} 221]. / Inputs/Outputs VAR_IN_OUT s Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description s Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI to EL_REF the PLC. This structure is read-only (type: NCTOPLC_NCICHANNEL_REF [} 343]). Outputs VAR_OUTPUT st Tab : ST_Itp Pre View Tab Ex; n Err Id : UDINT; END_VAR Name Type Description st Tab ST_Itp Pre View Tab Ex Structure containing the segment data. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI TF5100 Version: 2.14.3 287
## Page 288

PLC NCI Libraries 7.1.4.6 Itp Go Ahead Itp Go Ahead b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id The function block Itp Go Ahead may only be used in association with the decoder stop '@717' [} 169]. There is a more detailed description of this decoder stop in the interpreter documentation [} 126]. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Go Ahead Ex [} 229]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 288 Version: 2.14.3 TF5100
## Page 289

PLC NCI Libraries 7.1.4.7 Itp Is EStop Itp Is EStop b Execute BOOL BOOL b Busy n Grp Id UDINT BOOL b EStop t Time Out TIME BOOL b Err UDINT n Err Id Via b EStop, the function block Itp Is EStop provides information as to whether an EStop command was triggered. If b EStop is TRUE, then an EStop was initiated (e.g. Itp EStop). The flag does not provide information as to whether the axes have already stopped or are still on the deceleration ramp. After the execution of Itp Step On After EStop, Itp Is EStop will once again return FALSE. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Is EStop Ex [} 232]. Inputs VAR_INPUT b Execute : BOOL; n Grp Id : UDINT t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Grp Id UDINT Group ID t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b EStop : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b EStop BOOL TRUE: EStop command was executed. FALSE: No EStop present. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: Itp EStop [} 283] TF5100 Version: 2.14.3 289
## Page 290

PLC NCI Libraries Itp Step On After EStop [} 305] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.8 Itp Load Prog Itp Load Prog b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err s Prg STRING(255) UDINT n Err Id n Length UDINT t Time Out TIME Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Load Prog Ex [} 233]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; s Prg : STRING; n Length : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge at this input triggers execution of the NC program. n Chn Id UDINT Channel ID s Prg STRING Name of the NC program that is executed. n Length UDINT String length of the program name t Time Out TIME ADS Timeout-Delay The NC program is looked up in directory Twin CAT\Mc\Nci, if no further information is available. It is however also possible to give an absolute path. Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. 290 Version: 2.14.3 TF5100
## Page 291

PLC NCI Libraries Name Type Description b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.9 Itp Read RParams Itp Read RParams b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err p Addr PVOID UDINT n Err Id n Index DINT n Count DINT t Time Out TIME Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Read RParams Ex [} 236]. The Itp Read RParams function block reads the NC’s arithmetic parameters, also known as R-parameters. A more detailed description of the arithmetic parameters can be found here [} 134]. A total of 1000 R- parameters are available, of which the first 900 (0..899) are local, so that they are only visible in the current NC channel. The other 100 (900..999) R-parameters are global, and are thus visible from anywhere in the NC. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; p Addr : PVOID; n Index : DINT; n Count : DINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge starts the read operation. n Chn Id UDINT ID of the NC channel whose R-parameters are to be read. p Addr PVOID Address of the target variables of the data to be read. The data are written by the NC directly from the specified address. i.e. n Index is not to be interpreted as offset from p Addr. The data are usually in an array of type LREAL, which has to be defined by the user. n Index DINT Describes the index of the R-parameter to be read from an NC perspective. n Count DINT Number of R-parameters to be read t Time Out TIME ADS Timeout-Delay TF5100 Version: 2.14.3 291
## Page 292

PLC NCI Libraries Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: Itp Write RParams [} 306] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.10 Itp Read Tool Desc Itp Read Tool Desc b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err n DNo UDINT UDINT n Err Id t Time Out TIME ↔ s Tool Desc Reference To Tool Desc The function block Itp Read Tool Desc reads the tool parameters for the supplied D-word. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Read Tool Desc Ex [} 237]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; n DNo : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge starts the read operation. n Chn Id UDINT Channel ID 292 Version: 2.14.3 TF5100
## Page 293

PLC NCI Libraries Name Type Description n DNo UDINT D-word for which the tool parameters are to be read. n Do No can have values between 1 and 255. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Tool Desc : Tool Desc; END_VAR Name Type Description s Tool Desc Tool Desc A structure into which the tool parameters of n DNo are written. The meaning of the parameters depends on the tool type, and can be found in the tool data [} 180]. Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE Tool Desc: STRUCT n Tool Number : UDINT; (*valid range from 0 .. 65535*) n Tool Type : UDINT; f Param : ARRAY [2..15] OF LREAL; END_STRUCT END_TYPE See also: Itp Write Tool Desc [} 307]; Itp Set Tool Desc Null [} 302] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI TF5100 Version: 2.14.3 293
## Page 294

PLC NCI Libraries 7.1.4.11 Itp Read Zero Shift Itp Read Zero Shift b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err n Zs No UDINT UDINT n Err Id t Time Out TIME ↔ s Zero Shift Desc Reference To Zero Shift Desc The Itp Read Zero Shift function block reads the offset shift components X, Y and Z for the given zero offset shift. For reasons of compatibility, there are two entries (coarse and fine) for each axis in each zero offset shift (e.g. G54). These two entries must be added together. This function block evaluates both the entries and adds them together automatically. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Read Zero Shift Ex [} 239]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; n Zs No : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge starts the read operation. n Chn Id UDINT Channel ID n Zs No UDINT Number of the zero offset shift; on the NC side G54 to G59 are zero offset shifts. The valid range of values for 'n Zs No' is therefore from 54 to 59. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Zero Shift Desc : Zero Shift Desc; END_VAR Name Type Description s Zero Shift Desc Zero Shift Desc The structure containing the components of the zero offset shift. Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new 294 Version: 2.14.3 TF5100
## Page 295

PLC NCI Libraries Name Type Description command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE Zero Shift Desc: STRUCT f Shift X : LREAL; f Shift Y : LREAL; f Shift Z : LREAL; END_STRUCT END_TYPE See also: Itp Write Zero Shift [} 309]; Itp Set Zero Shift Null [} 303] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.12 Itp Reset Itp Reset b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Reset Ex2 [} 240]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge starts the read operation. n Chn Id UDINT Channel ID t Time Out TIME ADS Timeout-Delay NOTICE A reset deletes all tables in the NC. The axes are halted immediately. For this reason a reset should only be carried out either in the event of an error or when the axes are stationary. TF5100 Version: 2.14.3 295
## Page 296

PLC NCI Libraries Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.13 Itp Reset Ex Itp Reset Ex b Execute BOOL BOOL b Busy n Grp Id UDINT BOOL b Err n Chn Id UDINT UDINT n Err Id t Time Out TIME The function block 'Itp Reset Ex' executes a channel reset, which deletes all existing tables of the NC channel. In contrast to the conventional Itp Reset [} 295], an active channel is stopped first, before the reset is executed. This simplifies programming in the PLC, since no explicit check is necessary to ascertain whether the axes are still in motion. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Reset Ex2 [} 240]. Inputs VAR_INPUT b Execute : BOOL; n Grp Id : UDINT; n Chn Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Grp Id UDINT Group ID n Chn Id UDINT Channel ID 296 Version: 2.14.3 TF5100
## Page 297

PLC NCI Libraries Name Type Description t Time Out TIME ADS timeout delay (the b Busy signal can be active for longer than t Time Out) Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: Itp Start Stop [} 304] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.14 Itp Reset Fast MFunc Itp Reset Fast MFunc b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err n MFunc No UINT UDINT n Err Id t Time Out TIME This function block represents an alternative to Auto-reset or reset with another M-function (reset list during parameterization of the M-function). For the sake of clarity, mixed operation involving resetting with an M- function and this function block should be avoided. The fast M-function [} 164] n MFunc No is reset with a rising edge at input b Execute. In the event of the M- function not being available, no error is returned. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Reset Fast MFunc Ex [} 241]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; TF5100 Version: 2.14.3 297
## Page 298

PLC NCI Libraries n MFunc No : UINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID n MFunc No UINT Flying M-function that is to be reset. t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.15 Itp Set Bottle Neck Look Ahead Itp Set Bottle Neck Look Ahead b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err n Look Ahead UDINT UDINT n Err Id t Time Out TIME The function block Itp Set Bottle Neck Look Ahead determines the maximum number of segments the system may look ahead for bottleneck detection (contour collision monitoring). Note that segments, which were added as a result of radius compensation (e.g. additional segments at acute angles) are taken into account. A more detailed description can be found in the Interpreter [} 192] documentation. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Set Bottle Neck Look Ahead Ex [} 242]. 298 Version: 2.14.3 TF5100
## Page 299

PLC NCI Libraries Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; n Look Ahead : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID n Look Ahead UDINT Specifies the look-ahead value. t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.16 Itp Set Bottle Neck Mode Itp Set Bottle Neck Mode b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err e Bottle Neck Mode E_Itp Bn Mode UDINT n Err Id t Time Out TIME The function block Itp Set Bottle Neck Mode reads the behavior in the event of a contour collision (bottleneck). A more detailed description can be found in the Interpreter [} 192] documentation. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Set Bottle Neck Mode Ex [} 244]. TF5100 Version: 2.14.3 299
## Page 300

PLC NCI Libraries Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; e Bottle Neck Mode: E_Itp Bn Mode; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID e Bottle Neck Mode E_Itp Bn Mode Enum for the behavior in the event of a contour collision t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE E_Itp Bn Mode: ( Itp Bnm_Abort := 0, Itp Bnm_Adjust := 1, Itp Bnm_Leave := 2 ); END_TYPE Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.17 Itp Set Subroutine Path Itp Set Subroutine Path b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err s Path STRING(80) UDINT n Err Id n Length UDINT t Time Out TIME With function block Itp Set Subroutine Path , the search path for subroutines can optionally be set. 300 Version: 2.14.3 TF5100
## Page 301

PLC NCI Libraries If a subroutine still has to be integrated, the file is searched in the following order: • Optional search path (Itp Set Subroutine Path) • Path from which the main program was loaded • Twin CAT\Mc\Nci directory Only one optional path can be active at a time and it will remain active until it is overwritten with: • another path or • with an empty string After a Twin CAT restart, the path has to be re-assigned. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Set Subroutine Path Ex [} 249]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; s Path : STRING; n Length : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID s Path STRING Optional path for subroutines; is disabled with an empty string. n Length UDINT String length t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TF5100 Version: 2.14.3 301
## Page 302

PLC NCI Libraries Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.18 Itp Set Tool Desc Null Itp Set Tool Desc Null b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id The function block Itp Set Tool Desc Null overwrites all tool parameters (incl. number & type) of the channel with null. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Set Tool Desc Null Ex [} 250]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge results in overwriting of all tool parameters of the NC channel with zero. n Chn Id UDINT ID of the NC channel t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: • Itp Write Tool Desc [} 307], 302 Version: 2.14.3 TF5100
## Page 303

PLC NCI Libraries • Itp Read Tool Desc [} 292] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.19 Itp Set Zero Shift Null Itp Set Zero Shift Null b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id The function block Itp Set Zero Shift Null overwrites all zero offset shifts of the channel with zero. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Set Zero Shift Null Ex. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL A rising edge results in overwriting of all zero offset shifts of the NC channel with zero. n Chn Id UDINT ID of the NC channel t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: TF5100 Version: 2.14.3 303
## Page 304

PLC NCI Libraries • Itp Write Zero Shift [} 309] • Itp Read Zero Shift [} 294] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.20 Itp Start Stop Itp Start Stop b Start BOOL BOOL b Busy b Stop BOOL BOOL b Err n Chn Id UDINT UDINT n Err Id t Time Out TIME Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Start Stop Ex [} 254]. Inputs VAR_INPUT b Start : BOOL; b Stop : BOOL; n Chn Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Start BOOL A positive edge starts the NC channel. b Stop BOOL A positive edge stops the NC channel. A stop command deletes all the tables in the NC and brings the axes to a controlled halt. n Chn Id UDINT Channel ID t Time Out TIME ADS Timeout-Delay The b Stop input has a higher priority than the b Start input, so that if both inputs receive a positive edge, a channel stop will be executed. Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. 304 Version: 2.14.3 TF5100
## Page 305

PLC NCI Libraries Name Type Description b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.21 Itp Step On After EStop Itp Step On After EStop b Execute BOOL BOOL b Busy n Grp Id UDINT BOOL b Err t Time Out TIME UDINT n Err Id The function block Itp Step On After EStop enables further processing of the parts program after a programmed EStop. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Step On After EStop Ex [} 255]. Inputs VAR_INPUT b Execute : BOOL; n Grp Id : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Grp Id UDINT Group ID t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. TF5100 Version: 2.14.3 305
## Page 306

PLC NCI Libraries Name Type Description b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). See also: • Itp EStop [} 283] • Itp Is EStop [} 289] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.22 Itp Write RParams Itp Write RParams b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err p Addr PVOID UDINT n Err Id n Index DINT n Count DINT t Time Out TIME The function block Itp Write RParams writes R-parameters into the NC. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Write RParams Ex [} 256]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; p Addr : PVOID; n Index : DINT; n Count : DINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT ID of the NC channel whose R-parameters are to be written. p Addr PVOID Address of the variables containing the data to be written. Data are used directly from the specified address, i.e. n Index is not to be interpreted as offset from p Addr. The data are usually in an array of type LREAL, which has to be defined by the user. n Index DINT Describes the index of the R-parameter to be written from an NC perspective. n Count DINT Number of R-parameters to be written 306 Version: 2.14.3 TF5100
## Page 307

PLC NCI Libraries Name Type Description t Time Out TIME ADS Timeout-Delay Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). Sample In this example the parameters R90 to R99 are written from an NC perspective. VAR arrf RParam90to99 : ARRAY[0..9] OF LREAL; fb Write RParam : Itp Write RParams; n : INT := 0; b Write Param : BOOL := FALSE; END_VAR FOR n:=0 TO 9 DO arrf RParam90to99[n] := 90 + n; END_FOR fb Write RParam( b Execute := b Write Param, n Chn Id := 2, p Addr := ADR( arrf RParam90to99[0] ), n Index := 90, n Count := 10, t Time Out := T#200ms ); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.23 Itp Write Tool Desc Itp Write Tool Desc b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err n DNo UDINT UDINT n Err Id t Time Out TIME ↔ s Tool Desc Reference To Tool Desc TF5100 Version: 2.14.3 307
## Page 308

PLC NCI Libraries The function block Itp Write Tool Desc writes a block of tool parameters. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Write Tool Desc Ex [} 258]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; n DNo : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID n DNo UDINT D-word for which the tool parameters are to be read. n Do No can have values between 1 and 255. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Tool Desc : Tool Desc; END_VAR Name Type Description s Tool Desc Tool Desc The structure that contains the new tool parameters. This structure is only accessed for reading. The meaning of the parameters depends on the tool type, and can be found in the tool data [} 180]. Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE Tool Desc: STRUCT n Tool Number : UDINT; (*valid range from 0 .. 65535*) n Tool Type : UDINT; 308 Version: 2.14.3 TF5100
## Page 309

PLC NCI Libraries f Param : ARRAY [2..15] OF LREAL; END_STRUCT END_TYPE See also: • Itp Read Tool Desc [} 292] • Itp Set Tool Desc Null [} 302] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.4.24 Itp Write Zero Shift Itp Write Zero Shift b Execute BOOL BOOL b Busy n Chn Id UDINT BOOL b Err n Zs No UDINT UDINT n Err Id t Time Out TIME ↔ s Zero Shift Desc Reference To Zero Shift Desc The function block Itp Write Zero Shift writes the shift components X, Y and Z for the specified zero offset shift. For reasons of compatibility every zero offset shift that can be set has two parameters (coarse and fine) for each axis. When using this function block to write a new zero offset shift, the new value is written into the 'fine parameter'. A value of 0.0 is entered into the 'coarse parameter'. This makes it possible to use a function block such as Itp Read Zero Shift [} 294] to read and modify a zero offset shift and to send it back to the NC. Outdated version The sole purpose of the function block is to ensure compatibility with existing projects. For new projects please use the function block Itp Write Zero Shift Ex [} 259]. Inputs VAR_INPUT b Execute : BOOL; n Chn Id : UDINT; n Zs No : UDINT; t Time Out : TIME; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. n Chn Id UDINT Channel ID n Zs No UDINT Number of the zero offset shift On the NC side G54 to G59 are zero offset shifts; G58 and G59 can only be edited from the NC program. The valid range of values for 'n Zs No' is therefore from 54 to 57. t Time Out TIME ADS Timeout-Delay / Inputs/Outputs VAR_IN_OUT s Zero Shift Desc : Zero Shift Desc; END_VAR TF5100 Version: 2.14.3 309
## Page 310

PLC NCI Libraries Name Type Description s Zero Shift Desc Zero Shift Desc s Zero Shift Desc: The structure containing the components of the zero offset shift. This structure is only accessed for reading. Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the 'Timeout' input. While Busy = TRUE, no new command will be accepted at the inputs. Please note that it is not the execution of the service but its acceptance whose time is monitored. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in 'n Err Id'. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). TYPE Zero Shift Desc: STRUCT f Shift X : LREAL; f Shift Y : LREAL; f Shift Z : LREAL; END_STRUCT END_TYPE See also: • Itp Read Zero Shift [} 294] • Itp Set Zero Shift Null [} 309] Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.5 Obsolete 7.1.5.1 F_Get Version Tc Nci Utilities This function returns a part of the three-part version number of the Tc Nci Utilities.lib Twin CAT 2 PLC library as UINT. 310 Version: 2.14.3 TF5100
## Page 311

PLC NCI Libraries Outdated version The sole purpose of this function is to assure compatibility with existing projects. For new projects, please use the st Lib Version_Tc2_NCI global structure. Interface FUNCTION F_Get Version Nci Utilities VAR_INPUT n Version Element : INT; END_VAR Name Type Description n Version Element INT Part of the version number to be read out (range: [1..3]). Return value Name Type Description F_Get Version Nci Uti UINT Version number lities Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.1.5.2 Get_Tc Nc Cfg_Version This function returns the version number of the Tc Nc Cfg.lib Twin CAT 2 PLC library as a string. Outdated version The sole purpose of this function is to assure compatibility with existing projects. For new projects, please use the st Lib Version_Tc2_NCI global structure. Interface Name Type Description b Get BOOL Signal to execute the command Return value Name Type Description Get_Tc Nc Cfg_Versi STRING(20) Version number on Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI TF5100 Version: 2.14.3 311
## Page 312

PLC NCI Libraries 7.1.5.3 Itp Get Version Itp Get Version is a function that returns the version number of the Tc NC.lib Twin CAT 2 PLC library as a string. Outdated version The sole purpose of this function is to assure compatibility with existing projects. For new projects, please use the st Lib Version_Tc2_NCI global structure. Interface FUNCTION Itp Get Version VAR_INPUT END_VAR Return value Name Type Description Itp Get Version String(20) Version number Sample VAR str Version: STRING(20); END_VAR str Version := Itp Get Version(); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_NCI 7.2 PLC Library: Tc2_Plc Interpolation The Tc2_Plc Interpolation library offers an alternative to the application of G-Code (DIN 66025). This library can be used to execute interpolated movement commands directly from the PLC, without using G-Code. Alternative for Pick-and-Place Applications TF5420 Twin CAT 3 Motion Pick-and-Place executes multi-dimensional motions. It was specially developed for the requirements of pick-and-place applications and is an alternative to the Tc2_Plc Interpolation library for this use case. The Tc3_Mc Coordinated Motion library contains all associated function blocks. In a first step a table of different movement commands and additional functions is written. To this end structures such as ST_Nci Geo Line are transferred to the FB Nci Feed Table Preparation. This appends the movement command to the table. Once the table is full or all required entries have been added, Nci Feed Table is called in order to transfer the table content to the NC kernel. The data transfer directly starts the execution. Nci Max Table Entries can be edited From library version 3.3.16.0 (included from TC3.1.4024.11) the maximum number of table entries can be edited in the range from 10 to 32767. The default value is 100 entries. 312 Version: 2.14.3 TF5100
## Page 313

PLC NCI Libraries Function blocks Function blocks that are required for grouping of axes (or for channel control (channel override) can be found in the PLC Library: Tc2_NCI [} 198]. Function Block Description FB_Nci Feed Table Preparation [} 314] Fills a table with NCI movements in the PLC FB_Nci Feed Table [} 315] Transfers a previously written table to the NC kernel and starts the motion Data structures The following structures can be used as input parameters for the function block Nci Feed Table Preparation: Structures Enum Description Organization E_Nci Entry Type None No function ST_Nci Geo Start [} 318] E_Nci Entry Type Geo Start Sets the start position for the first geometry entry ST_Nci End Of Tables [} 328] E_Nci Entry Type End Of Tables Indicates the end of the geometry table Movement commands ST_Nci Geo Line [} 318] E_Nci Entry Type Geo Line Describes a straight line ST_Nci Geo Circle Plane [} 319] E_Nci Entry Type Geo Circle Plane Describes a circle in the main plane (center point programming) ST_Nci Geo Circle CIP [} 320] E_Nci Entry Type Geo Circle CIP Describes a circle anywhere in the space ST_Nci Geo Bezier3 [} 321] E_Nci Entry Type Geo Bezier3 Describes a 3rd order Bezier with control points ST_Nci Geo Bezier5 [} 322] E_Nci Entry Type Geo Bezier5 Describes a 5th order Bezier with control points ST_Nci Dwell Time [} 327] E_Nci Entry Type Dwell Time Describes a dwell time Path parameters ST_Nci Base Frame [} 325] E_Nci Entry Type Base Frame Describes a zero shift and rotation ST_Nci Vertex Smoothing [} 325] E_Nci Entry Type Vertex Smoothing Activates blending at segment transitions ST_Nci Tangential Following Desc E_Nci Entry Type Tf Desc Activates tangential following of the tool [} 327] Dynamics ST_Nci Dyn Ovr [} 324] E_Nci Entry Type Dyn Ovr Modifies the dynamic override ST_Nci Axis Dynamics [} 326] E_Nci Entry Type Axis Dynamics Limits the axis dynamics ST_Nci Path Dynamics [} 326] E_Nci Entry Type Path Dynamics Limits the path dynamics ST_Nci Feedrate Ipol [} 327] E_Nci Entry Type Feedrate Ipol Sets the feed interpolation type Parameter commands ST_Nci HParam [} 324] E_Nci Entry Type HParam Sets an H-parameter (DINT) ST_Nci SParam [} 324] E_Nci Entry Type SParam Sets an S-parameter (WORD) TF5100 Version: 2.14.3 313
## Page 314

PLC NCI Libraries Structures Enum Description ST_Nci TParam [} 324] E_Nci Entry Type TParam Sets a T-parameter (WORD) ST_Nci MFunc Fast [} 323] E_Nci Entry Type MFunc Fast Parameterizes a fast M-function (no handshake) ST_Nci MFunc Hsk [} 323] E_Nci Entry Type MFunc Hsk Parameterizes an M-function with handshake ST_Nci MFunc Reset All Fast [} 324] E_Nci Entry Type Reset All Fast Resets all fast M-functions Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_Plc Interpolation 7.2.1 FB_Nci Feed Table Preparation The function block FB_Nci Feed Table Preparation appends an entry of a specific type to the feed table (st Feed Group Table). An appended entry can generate more than one row in the table. If the table has not enough free rows, an error is returned and no entry is added to the table. In this case the entry either has to be added to another table or to the same table, after FB_Nci Feed Table was executed. This function block deals with modal functions, such as tangential following. It is therefore important to always use the same instance of this function block. The function block can be called repeatedly in a PLC cycle. Inputs VAR_INPUT n Entry Type : E_Nci Entry Type; p Entry : POINTER TO ST_Nci Geo Line; b Reset Table : BOOL; b Reset All : BOOL; END_VAR Name Type Description n Entry Type E_Nci Entry Type Specifies the entry type, e.g. line, circle, tangential following. p Entry POINTER TO Pointer to entry structure – must match n Entry Type. ST_Nci Geo Line b Reset Table BOOL If b Reset Table is TRUE, the table 'st Feed Group Table' is set to zero and n Filled Rows is also set to zero. If n Error Id = Err Nci Feed Table Full, this error is reset. All modal flags (such as tangential following) remain constant. b Reset All BOOL Like b Reset Table. In addition, all modal flags are set to their default values, and all error IDs are reset. / Inputs/Outputs VAR_IN_OUT st Feed Group Table : ST_Nci Feed Group Table; END_VAR Name Type Description st Feed Group Table ST_Nci Feed Group Tabl Table containing the rows for the NC kernel. e 314 Version: 2.14.3 TF5100
## Page 315

PLC NCI Libraries Outputs VAR_OUTPUT n Filled Rows : INT; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Filled Rows INT Number of filled rows b Error BOOL Becomes TRUE as soon as an error has occurred. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation (error codes above 0x4000). • If b Reset Table, b Reset All, or b Error is true, no further entries are accepted. • The error code 0x4B72 indicates that the table is full and the last entry was not accepted. Sample: st Geo Line.n Display Index := 1; st Geo Line.f End Pos X := 0; st Geo Line.f End Pos Y := 400; st Geo Line.f End Pos Z := 100; st Geo Line.f End Pos Q1 :=-90; st Geo Line.f Velo := 1000; (*mm per sec*) fb Feed Table Prep( n Entry Type := E_Nci Entry Type Geo Line, p Entry := ADR(st Geo Line), b Reset Table:= FALSE, st Feed Group Table:= st Nci Feed Group Table, n Filled Rows=> n Filled Rows, b Error => b Error, n Error Id => n Error Id); Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_Plc Interpolation 7.2.2 FB_Nci Feed Table The function block FB_Nci Feed Table transfers a given table to the NC kernel. If the override is set and the approvals are enabled, execution is started immediately. b Feeding Done becomes TRUE when the transfer is complete. This signal can be used for overwriting the table with Nci Feed Table Preparation [} 314]. In Nci Feed Table Preparation the table first has to be reset. b Channel Done indicates complete execution of the tables in the NC kernel. The identifier ST_Nci End Of Tables [} 317] must therefore be placed at the end of the last table. TF5100 Version: 2.14.3 315
## Page 316

PLC NCI Libraries Inputs VAR_INPUT b Execute : BOOL; b Reset : BOOL; b Log Feeder Entries : BOOL; END_VAR Name Type Description b Execute BOOL The command is triggered by a rising edge at this input. b Reset BOOL Triggers a channel reset and also resets the function block. b Log Feeder Entries BOOL If TRUE, a log file 'Plc Itp Feed.log' is written in the Twin CAT\Mc\Nci folder. It contains all entries that are sent to the NC kernel via ADS. If b Log Feeder Entries = TRUE, more time is required until b Feeding Done becomes TRUE. / Inputs/Outputs VAR_IN_OUT st Feed Group Table : ST_Nci Feed Group Table; st Nci To Plc : NCTOPLC_NCICHANNEL_REF; END_VAR Name Type Description st Feed Group Table ST_Nci Feed Group Tabl Table containing the rows for the NC kernel. e st Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface between NCI and EL_REF PLC. Outputs VAR_OUTPUT b Feeding Done : BOOL; b Channel Done : BOOL; b Feed Busy: : BOOL; b Reset Busy: : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Feeding Done BOOL Becomes TRUE once all table rows have been sent to the NC kernel. b Channel Done BOOL Becomes TRUE once all entries of the table in the NC kernel were executed and ST_Nci End Of Tables was detected. b Feed Busy BOOL Becomes TRUE when the function block sends entries to the NC kernel. b Reset Busy BOOL Becomes TRUE when a reset is executed. b Error BOOL Becomes TRUE as soon as an error has occurred. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs. The error numbers in Err Id can be looked up in the ADS error documentation or in the NC error documentation. Requirements Development environment Target platform PLC libraries to be linked Twin CAT v3.1.0 PC or CX (x86 or x64) Tc2_Plc Interpolation 316 Version: 2.14.3 TF5100
## Page 317

PLC NCI Libraries 7.2.3 Types and Enums E_Nci Entry Type TYPE E_Nci Entry Type : ( E_Nci Entry Type None := 0, E_Nci Entry Type Geo Start := 1, E_Nci Entry Type Geo Line := 2, E_Nci Entry Type Geo Circle Plane := 3, E_Nci Entry Type Geo Circle CIP := 4, E_Nci Entry Type Geo Bezier3 := 10, E_Nci Entry Type Geo Bezier5 := 11, E_Nci Entry Type MFunc Hsk := 20, E_Nci Entry Type MFunc Fast := 21, E_Nci Entry Type MFunc Reset All Fast := 23, E_Nci Entry Type HParam := 24, E_Nci Entry Type SParam := 25, E_Nci Entry Type TParam := 26, E_Nci Entry Type Dyn Ovr := 50, E_Nci Entry Type Vertex Smoothing := 51, E_Nci Entry Type Base Frame := 52, E_Nci Entry Type Path Dynamics := 53, E_Nci Entry Type Axis Dynamics := 55, E_Nci Entry Type Dwell Time := 56, E_Nci Entry Type Feedrate Ipol := 57, E_Nci Entry Type Tf Desc := 100, E_Nci Entry Type End Of Tables := 1000 ); END_TYPE Structures Enum Description Organization E_Nci Entry Type None No function ST_Nci Geo Start [} 318] E_Nci Entry Type Geo Start Sets the start position for the first geometry entry ST_Nci End Of Tables [} 328] E_Nci Entry Type End Of Tables Indicates the end of the geometry table Movement commands ST_Nci Geo Line [} 318] E_Nci Entry Type Geo Line Describes a straight line ST_Nci Geo Circle Plane [} 319] E_Nci Entry Type Geo Circle Plane Describes a circle in the main plane (center point programming) ST_Nci Geo Circle CIP [} 320] E_Nci Entry Type Geo Circle CIP Describes a circle anywhere in the space ST_Nci Geo Bezier3 [} 321] E_Nci Entry Type Geo Bezier3 Describes a 3rd order Bezier with control points ST_Nci Geo Bezier5 [} 322] E_Nci Entry Type Geo Bezier5 Describes a 5th order Bezier with control points ST_Nci Dwell Time [} 327] E_Nci Entry Type Dwell Time Describes a dwell time Path parameters ST_Nci Base Frame [} 325] E_Nci Entry Type Base Frame Describes a zero shift and rotation ST_Nci Vertex Smoothing [} 325] E_Nci Entry Type Vertex Smoothing Activates blending at segment transitions ST_Nci Tangential Following Desc E_Nci Entry Type Tf Desc Activates tangential following of the tool [} 327] Dynamics ST_Nci Dyn Ovr [} 324] E_Nci Entry Type Dyn Ovr Modifies the dynamic override ST_Nci Axis Dynamics [} 326] E_Nci Entry Type Axis Dynamics Limits the axis dynamics ST_Nci Path Dynamics [} 326] E_Nci Entry Type Path Dynamics Limits the path dynamics ST_Nci Feedrate Ipol [} 327] E_Nci Entry Type Feedrate Ipol Sets the feed interpolation type Parameter commands TF5100 Version: 2.14.3 317
## Page 318

PLC NCI Libraries Structures Enum Description ST_Nci HParam [} 324] E_Nci Entry Type HParam Sets an H-parameter (DINT) ST_Nci SParam [} 324] E_Nci Entry Type SParam Sets an S-parameter (WORD) ST_Nci TParam [} 324] E_Nci Entry Type TParam Sets a T-parameter (WORD) ST_Nci MFunc Fast [} 323] E_Nci Entry Type MFunc Fast Parameterizes a fast M-function (no handshake) ST_Nci MFunc Hsk [} 323] E_Nci Entry Type MFunc Hsk Parameterizes an M-function with handshake ST_Nci MFunc Reset All Fast [} 324] E_Nci Entry Type Reset All Fast Resets all fast M-functions ST_Nci Geo Start Sets the start position for the first geometry entry. This is necessary, if the first geometry entry is a circle or if tangential following in the first segment is ON. This structure can optionally be written at each start of the first table. TYPE ST_Nci Geo Start : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Geo Start; (*do not override this parameter *) f Pos X: LREAL; f Pos Y: LREAL; f Pos Z: LREAL; f Pos Q1: LREAL; f Pos Q2: LREAL; f Pos Q3: LREAL; f Pos Q4: LREAL; f Pos Q5: LREAL; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) f Pos X: Start position X f Pos Y: Start position Y f Pos Z: Start position Z f Pos Q1: Start position Q1 f Pos Q2: Start position Q2 f Pos Q3: Start position Q3 f Pos Q4: Start position Q4 f Pos Q5: Start position Q5 ST_Nci Geo Line Describes a straight line with specified velocity. TYPE ST_Nci Geo Line : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Geo Line; (*do not override this parameter *) n Display Index: UDINT; f End Pos X: LREAL; f End Pos Y: LREAL; f End Pos Z: LREAL; f End Pos Q1: LREAL; f End Pos Q2: LREAL; f End Pos Q3: LREAL; f End Pos Q4: LREAL; f End Pos Q5: LREAL; f Velo: LREAL; b Rapid Traverse: BOOL; b Accurate Stop: BOOL; (* Velo End := 0 *) END_STRUCT END_TYPE 318 Version: 2.14.3 TF5100
## Page 319

PLC NCI Libraries n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code f End Pos X: Target position X f End Pos Y: Target position Y f End Pos Z: Target position Z f End Pos Q1: Target position Q1 f End Pos Q2: Target position Q2 f End Pos Q3: Target position Q3 f End Pos Q4: Target position Q4 f End Pos Q5: Target position Q5 f Velo: Target path velocity, like F in G-Code, but in basic units per second (e.g. mm/s) b Rapid Traverse: TRUE has the same effect as G0, FALSE treats this entry like G01 b Accurate Stop: Accurate stop (TRUE has the same effect as G09) ST_Nci Geo Circle Plane Describes a circle in the main plane. The center point is specified in absolute coordinates. The orthogonal component at the center is assigned internally. If a circle is programmed in the XY plane, for example, ,f Center Z‘ is assigned internally. If the user has assigned the value explicitly, the value is nevertheless overwritten by the function block. A helix can be described by programming the height. If helix is programmed in the XY plane, for example, the lifting height of the helix is specified absolutely with ‚f End Pos Z‘. TYPE ST_Nci Geo Circle Plane : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Geo Circle Plane; (*do not override this parameter *) n Display Index: UDINT; f End Pos X: LREAL; f End Pos Y: LREAL; f End Pos Z: LREAL; f Center X: LREAL; f Center Y: LREAL; f Center Z: LREAL; f End Pos Q1: LREAL; f End Pos Q2: LREAL; f End Pos Q3: LREAL; f End Pos Q4: LREAL; f End Pos Q5: LREAL; f Velo: LREAL; b Clockwise: BOOL; b Accurate Stop: BOOL; (* Velo End := 0 *) n Plane: E_Nci Geo Plane := E_Nci Geo Plane XY; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code f End Pos X: Target position X f End Pos Y: Target position Y f End Pos Z: Target position Z f Center X: Centre position X in absolute coordinates f Center Y: Centre position Y in absolute coordinates f Center Z: Centre position Z in absolute coordinates TF5100 Version: 2.14.3 319
## Page 320

PLC NCI Libraries f End Pos Q1: Target position Q1 f End Pos Q2: Target position Q2 f End Pos Q3: Target position Q3 f End Pos Q4: Target position Q4 f End Pos Q5: Target position Q5 f Velo: Target path velocity in basic units per second (e.g. mm/s), like F in G-Code b Clockwise: If TRUE, the circle is drawn clockwise, otherwise counter-clockwise (similar to G02, G03) b Accurate Stop: accurate stop [} 141] (TRUE has the same effect as G09) n Plane: Specifies the plane: XY, YZ, or ZX (similar to G17.. G19) (type: E_Nci Geo Plane [} 320]) Circle segment as start segment If the first geometry segment is a circle, the start position must set with ST_Nci Geo Start [} 318]. E_Nci Geo Plane TYPE E_Nci Geo Plane : ( E_Nci Geo Plane XY := 17, E_Nci Geo Plane ZX := 18, E_Nci Geo Plane YZ := 19 ); END_TYPE ST_Nci Geo Circle CIP The CIP circle can be used to describe a circle anywhere in space. It does not have to be in the main plane. In order for the circle to be described unambiguously, not all 3 points (the starting point is specified implicitly) may lie on straight line. It is thus not possible to program a full circle in this way. TYPE ST_Nci Geo Circle CIP : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Geo Circle CIP; (* do not overwrite this parameter *) n Display Index: UDINT; f End Pos X: LREAL; f End Pos Y: LREAL; f End Pos Z: LREAL; f CIPPos X: LREAL; f CIPPos Y: LREAL; f CIPPos Z: LREAL; f End Pos Q1: LREAL; f End Pos Q2: LREAL; f End Pos Q3: LREAL; f End Pos Q4: LREAL; f End Pos Q5: LREAL; f Velo: LREAL; b Accurate Stop: BOOL; (* Velo End := 0 *) END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code f CIPPos X: X position in absolute coordinates (point on circular path) f CIPPos Y: Y position in absolute coordinates (point on circular path) f CIPPos Z: Z position in absolute coordinates (point on circular path) f End Pos X: Target position X f End Pos Y: Target position Y 320 Version: 2.14.3 TF5100
## Page 321

PLC NCI Libraries f End Pos Z: Target position Z f End Pos Q1: Target position Q1 f End Pos Q2: Target position Q2 f End Pos Q3: Target position Q3 f End Pos Q4: Target position Q4 f End Pos Q5: Target position Q5 f Velo: Target path velocity in basic units per second (e.g. mm/s), like F in G-Code b Accurate Stop: accurate stop [} 141] (TRUE has the same effect as G09) Circle segment as start segment If the first geometry segment is a circle, the start position must set with ST_Nci Geo Start [} 318]. ST_Nci Geo Bezier3 Describes a third-order Bézier curve with the aid of control points. The start position results from the previous segment. The third control point is determined by the target position. TYPE ST_Nci Geo Bezier3: STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Geo Bezier3; (*do not override this parameter *) n Display Index: UDINT; f Control Point1X: LREAL; f Control Point1Y: LREAL; f Control Point1Z: LREAL; f Control Point2X: LREAL; f Control Point2Y: LREAL; f Control Point2Z: LREAL; f End Pos X: LREAL; f End Pos Y: LREAL; f End Pos Z: LREAL; f End Pos Q1: LREAL; f End Pos Q2: LREAL; f End Pos Q3: LREAL; f End Pos Q4: LREAL; f End Pos Q5: LREAL; f Velo: LREAL; b Accurate Stop: BOOL; (* Velo End := 0 *) END_STRUCT END_TYPE A Bezier3 curve is not compatible with the type ST_Nci Vertex Smoothing of the type 3rd and 5th order Bezier. In this case, a different type must be selected for Vertex Smoothing. n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code f Control Point1X: X component control point 1 f Control Point1Y: Y component control point 1 ... f Control Point2Z: Z component control point 2 f End Pos X: Target position X f End Pos Y: Target position Y f End Pos Z: Target position Z f End Pos Q1: Target position Q1 TF5100 Version: 2.14.3 321
## Page 322

PLC NCI Libraries f End Pos Q2: Target position Q2 f End Pos Q3: Target position Q3 f End Pos Q4: Target position Q4 f End Pos Q5: Target position Q5 f Velo: Target path velocity in basic units per second (e.g. mm/s), like F in G-Code b Accurate Stop: Accurate stop [} 141] (TRUE has the same effect as G09) ST_Nci Geo Bezier5 Describes a 5th-order Bézier curve with the aid of control points. The start position results from the previous segment. The fifth control point is determined by the target position. TYPE ST_Nci Geo Bezier5: STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Geo Bezier5; (*do not override this parameter *) n Display Index: UDINT; f Control Point1X: LREAL; f Control Point1Y: LREAL; f Control Point1Z: LREAL; f Control Point2X: LREAL; f Control Point2Y: LREAL; f Control Point2Z: LREAL; f Control Point3X: LREAL; f Control Point3Y: LREAL; f Control Point3Z: LREAL; f Control Point4X: LREAL; f Control Point4Y: LREAL; f Control Point4Z: LREAL; f End Pos X: LREAL; f End Pos Y: LREAL; f End Pos Z: LREAL; f End Pos Q1: LREAL; f End Pos Q2: LREAL; f End Pos Q3: LREAL; f End Pos Q4: LREAL; f End Pos Q5: LREAL; f Velo: LREAL; b Accurate Stop: BOOL; (* Velo End := 0 *) END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code f Control Point1X: X component control point 1 f Control Point1Y: Y component control point 1 ... f Control Point4Z: Z component control point 4 f End Pos X: Target position X f End Pos Y: Target position Y f End Pos Z: Target position Z f End Pos Q1: Target position Q1 f End Pos Q2: Target position Q2 f End Pos Q3: Target position Q3 f End Pos Q4: Target position Q4 f End Pos Q5: Target position Q5 322 Version: 2.14.3 TF5100
## Page 323

PLC NCI Libraries f Velo: Target path velocity in basic units per second (e.g. mm/s), like F in G-Code b Accurate Stop: accurate stop [} 141] (TRUE has the same effect as G09) ST_Nci MFunc Hsk Describes an M-function [} 164] of type handshake. The M-function number is between 0 and 159. TYPE ST_Nci MFunc Hsk : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type MFunc Hsk; (*do not override this parameter *) n Display Index: UDINT; n MFunc: INT; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code n MFunc: M-function number (0..159) M-functions in the Plc Interpolation library If M-functions are used in the Plc Interpolation library, they do not have to be entered in the user interface of the XAE. An M-function always takes effect at the programmed location. ST_Nci MFunc Fast Parameterizes up to 8 fast M-functions [} 164]. The first M-function must be assigned n MFunc In0, the second n MFunc In1 etc. -1 indicates the end of the assignments. TYPE ST_Nci MFunc Fast : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type MFunc Fast; (*do not override this parameter *) n Display Index: UDINT; n MFunc In0: INT; n MFunc In1: INT; n MFunc In2: INT; n MFunc In3: INT; n MFunc In4: INT; n MFunc In5: INT; n MFunc In6: INT; n MFunc In7: INT; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code n MFunc In0: fast M-function number (0..159) n MFunc In1: Fast M-function number (0..159); -1 indicates the end of the list. n MFunc In2: Fast M-function number (0..159); -1 indicates the end of the list. n MFunc In3: Fast M-function number (0..159); -1 indicates the end of the list. n MFunc In4: Fast M-function number (0..159); -1 indicates the end of the list. n MFunc In5: Fast M-function number (0..159); -1 indicates the end of the list. n MFunc In6: Fast M-function number (0..159); -1 indicates the end of the list. n MFunc In7: Fast M-function number (0..159); -1 indicates the end of the list. M-functions in the Plc Interpolation library If M-functions are used in the Plc Interpolation library, they do not have to be entered in the user interface of the XAE. An M-function always takes effect at the programmed location. TF5100 Version: 2.14.3 323
## Page 324

PLC NCI Libraries ST_Nci MFunc Reset All Fast Resets all fast M-functions [} 164]. TYPE ST_Nci MFunc Reset All Fast : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type MFunc Reset All Fast; (*do not override this parameter *) n Display Index: UDINT; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code ST_Nci HParam Sets an H-parameter [} 168] in the cyclic channel interface. TYPE ST_Nci HParam : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type HParam; (*do not override this parameter *) n Display Index: UDINT; n HParam: UDINT; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code n HParam: H-parameter from NC to PLC ST_Nci SParam Sets an S-parameter [} 168] in the cyclic channel interface. TYPE ST_Nci SParam : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type SParam; (*do not override this parameter *) n Display Index: UDINT; n SParam: UINT; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code n SParam: S-parameter from NC to PLC ST_Nci TParam Sets an T-parameter [} 168] in the cyclic channel interface. TYPE ST_Nci TParam : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type TParam; (*do not override this parameter *) n Display Index: UDINT; n TParam: UINT; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code n TParam: T-parameter from NC to PLC ST_Nci Dyn Ovr Modal functions for changing the path dynamics. 324 Version: 2.14.3 TF5100
## Page 325

PLC NCI Libraries See Dyn Ovr [} 175] in the interpreter documentation [} 126]. TYPE ST_Nci Dyn Ovr : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Dyn Ovr; (*do not override this parameter*) n Display Index: UDINT; f Dyn Ovr: LREAL; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code f Dyn Ovr: Value for dynamic override (1 < f Dyn Ovr <= 1) ST_Nci Vertex Smoothing Modal function for activating blending at the segment transition. Blending is active until it is cancelled by setting the radius to 0. A more detailed description of the parameter can be found in the interpreter documentation [} 126]. (param Vertex Smoothing [} 152]). TYPE ST_Nci Vertex Smoothing : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Vertex Smoothing; (*do not override this parameter *) n Display Index: UDINT; n Type: UDINT; (*type of smoothing, e.g. parabola, bi-quad *) n Subtype: UDINT; (*e.g. adaptive, constant radius *) f Radius: LREAL; (*max. radius for tolerance ball *) END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code n Type: Blending type: 2: parabola, 3: Bi-quadratic, 4: Bezier 3rd order, 5: 5th order Bezier n Subtype: 1: constant tolerance radius, 2: distance between intersection and vertex, 3: Adaptive tolerance radius f Radius: Radius of the blending sphere in basic units (e.g. mm) ST_Nci Base Frame The structure ST_Nci Base Frame describes a modal zero shift and rotation. The operating principle is the same as for zero shift and rotation in the interpreter, i.e. the point of rotation is the current origin (see rotation [} 148] in the interpreter documentation [} 126]). TYPE ST_Nci Base Frame: STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Base Frame; (*Do not override this parameter *) n Display Index: UDINT; f Shift X: LREAL; f Shift Y: LREAL; f Shift Z: LREAL; f Rot X: LREAL; f Rot Y: LREAL; f Rot Z: LREAL; f Shift Q1: LREAL; f Shift Q2: LREAL; f Shift Q3: LREAL; f Shift Q4: LREAL; f Shift Q5: LREAL; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code TF5100 Version: 2.14.3 325
## Page 326

PLC NCI Libraries f Shift X: Zero shift in X direction f Shift Y: Zero shift in Y direction f Shift Z: Zero shift in Z direction f Rot X: Rotation of the X axis f Rot Y: Rotation of the Y axis f Rot Z: Rotation of the Z axis f Shift Q1: Offset of the Q1 axis f Shfit Q2: Offset of the Q2-axis f Shift Q3: Offset of the Q3-axis f Shift Q4: Offset of the Q4-axis f Shift Q5: Offset of the Q5-axis ST_Nci Path Dynamics The structure ST_Nci Path Dynamics sets the path dynamics (acceleration, deceleration, jerk). The operating principle is the same as for param Path Dynamics in the interpreter (see param Path Dynamics [} 175] in the interpreter documentation [} 126]). TYPE ST_Nci Path Dynamics: STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Path Dynamics; (*do not override this parameter *) n Display Index: UDINT; f Acc: LREAL; f Dec: LREAL; f Jerk: LREAL; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code f Acc: Maximum permitted path acceleration f Dec: Maximum permitted path deceleration f Jerk: Maximum permitted path jerk ST_Nci Axis Dynamics The structure ST_Nci Axis Dynamics sets the path axis dynamics (acceleration, deceleration, jerk). The operating principle is the same as for param Axis Dynamics in the interpreter (see param Axis Dynamics [} 175] in the interpreter documentation [} 126]) TYPE ST_Nci Axis Dynamics: STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Axis Dynamics; (*Do not override this parameter*) n Display Index: UDINT; n Axis: UDINT; f Acc: LREAL; f Dec: LREAL; f Jerk: LREAL; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code n Axis: Axis in interpolation group X:0 Y:1 Z:2 Q1:3 ... Q5:7 f Acc: Maximum permitted axis acceleration 326 Version: 2.14.3 TF5100
## Page 327

PLC NCI Libraries f Dec: Maximum permitted axis deceleration f Jerk: Maximum permitted axis jerk ST_Nci Dwell Time The structure ST_Nci Dwell Time is used to activate a dwell time in seconds (see dwell time [} 141] in the interpreter documentation [} 126]) TYPE ST_Nci Dwell Time: STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Dwell Time; (*Do not override this parameter *) n Display Index: UDINT; f Dwell Time: LREAL; END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) n Display Index: For display purposes, such as block number in G-Code f Dwell Time: Dwell time in seconds ST_Nci Feedrate Ipol The structure ST_Nci Feedrate Ipol can be used to set the feed interpolation (see Feed interpolation [} 141]). TYPE ST_Nci Feedrate Ipol : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Feedrate Ipol;(*Do not overwrite this parameter*) n Display Index: UDINT; e Feedrate Ipol: E_Nci Feedrate Ipol;(*E_Nci Feedrate Ipol Constant = FCONST, E_Nci Feedrate Ipol Linear=FLIN *) END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) e Feedrate Ipol: specifies the feed interpolation. TYPE E_Nci Feed Rate Ipol :( E_Nci Feedrate Ipol Constant, E_Nci Feedrate Ipol Linear ) END_TYPE ST_Nci Tangential Following Desc This is a modal command for switching tangential following on or off. TYPE ST_Nci Tangential Following Desc : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type Tf Desc; (*do not override this parameter *) b Tang On: BOOL; n Tang Axis: E_Nci Axes In Group; (*axis used for tangential following *) n Path Axis1: E_Nci Axes In Group; (*describing the plane e.g. x*) n Path Axis2: E_Nci Axes In Group; (*e.g. y ==> g17, xy plane*) f Offset: LREAL; (*geo tangent is 0 degree, counting is mathmatical positive *) f Critical Angle1: LREAL; n Tf Behavior: E_Tangential Following Behavior; (*what to do if angle becomes bigger than critical angle 1 *) END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) b Tang On: If TRUE, tangential following is switched on. n Tang Axis: Axis (Q1.. Q5) that is used as tangential axis (type: E_Nci Axes In Group [} 328]). n Path Axis1: First path axis describing the plane and orientation for calculating the tangent. n Path Axis2: Second path axis describing the plane and orientation for calculating the tangent. TF5100 Version: 2.14.3 327
## Page 328

PLC NCI Libraries f Offset: Offset of the tangential axis f Critical Angle1: Critical angle 1. The response in cases where the angle between two segments is greater than f Critical Angle1 is specified with n Tf Behavior. n Tf Behavior: see f Critical Angle1 (type: E_Tangential Following Behavior [} 328]) E_Nci Axes In Group TYPE E_Nci Axes In Group : ( None Axis := 0, XAxis, YAxis, ZAxis, Q1Axis, Q2Axis, Q3Axis, Q4Axis, Q5Axis ); END_TYPE E_Tangential Following Behavior TYPE E_Tangential Following Behavior : ( E_Tf Ingore All, (*ignore critical angle *) E_Tf Error On Critical1 (*if angle becomes bigger than critical angle 1 ==> error *) ); END_TYPE E_Tf Ingore All: The critical angle is ignored. E_Tf Error On Critical1: An error is returned if the critical angle is exceeded. ST_Nci End Of Tables Indicates the last entry of the last table. Is used for signaling the b Channel Done flag in FB_Nci Feed Table [} 315]. TYPE ST_Nci End Of Tables : STRUCT n Entry Type: E_Nci Entry Type := E_Nci Entry Type End Of Tables; (*do not override this parameter *) END_STRUCT END_TYPE n Entry Type: Do not override this parameter (type: E_Nci Entry Type [} 317]) 328 Version: 2.14.3 TF5100
## Page 329

Samples 8 Samples NCI: NCISimple Sample Download: https://infosys.beckhoff.com/content/1033/TF5100_TC3_NC_I/Resources/3438746891.zip The example NCISimple Sample shows how an G-Code program is loaded from the PLC and processing is started. You need to copy the enclosed parts program first.nc into the Twin CAT\Mc\Nci directory. Otherwise the parts program will not be found during loading. Alternatively you can adjust the path in the PLC program. PLC interpolation: Plc Interpolation Simple Sample Download: https://infosys.beckhoff.com/content/1033/TF5100_TC3_NC_I/Resources/2944140171.zip The sample shows how a movement can be affected with the library Tc2_Plc Interpolation directly from the PLC. TF5100 Version: 2.14.3 329
## Page 330

Support and Service 9 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 330 Version: 2.14.3 TF5100
## Page 331

Appendix 10 Appendix 10.1 Display of the parts program Reading of the current NC line via ADS This ADS Read command returns a maximum of three lines of the current parts program, i.e. the current line of code and perhaps two previously processed lines. Function ADS-Read Port 500 (dec) Index Group 0x2300 + channel ID Index Offset 0x2000 0001 Data string (30 bytes min.) TF5100 Version: 2.14.3 331
## Page 332

Appendix Reading of the current program name This ADS Read command returns the program name of the current main NC program (in this case 1_1.nc). Function ADS-Read Port 500 (dec) Index Group 0x2100 + channel ID Index Offset 0x7 Data string, 100 characters max. 332 Version: 2.14.3 TF5100
## Page 333

Appendix Reading of the current file information In contrast to the 'Reading the current NC line' function, in this case not the line itself is read, but associated line information. The return value is the current program name (e.g. file name of the subroutine) and a file offset. Based on this information, the user interface can open the associated file and highlight the respective line. The display is no longer limited to 3 rows, i.e. any number of lines can be displayed. In the event of an NCI load or runtime error, information about the associated line of code can be obtained via this route. Function ADS-Read Port 500 (dec) Index Group 0x2100 + channel ID Index Offset 0x12 Data UINT32 Current display of 1: SAF- 2: Interpreter 3: Error offset UINT32 File offset char[260] path + program name 10.2 Display of technology data The currently active technology data such as G functions, zero shifts and rotation can be read via ADS. Activation for reading the technology data In order to read the above-mentioned parameters, activation via ADS is required first. The function must be activated before the start of the NC program, or earlier. It remains active until either a Twin CAT restart is performed or the function is reset explicitly. Function ADS-Write Port 500 (dec) Index Group 0x2000 + channel ID Index Offset 0x0053 Data DWORD 0: disable (default) 1: enable TF5100 Version: 2.14.3 333
## Page 334

Appendix Reading the currently active zero shift This command reads the active zero shift of the segment currently in block execution (SAF). If no zero shift is active (G53), the structure for the individual components contains a zero vector. These data can be used for switching the display between machine coordinates and programming coordinates, for example. The data, which are read with the function block 'Itp Read Zero Shift', for example, may differ from these values, since the interpreter data are read with the function block, which may already take into account new offsets. Function ADS-Read Port 500 (dec) Index Group 0x2100 + channel ID Index Offset 0x0014 Data { UINT32 block counter UINT32 dummy LREAL[3] zero shift G54.. G57 LREAL[3] zero shift G58 LREAL[3] zero shift G59 } Error 0x706 (1798) The reading of technology data was not activated. Reading the currently active rotation This command reads the active rotation of the segment currently in block execution (SAF). Function ADS-Read Port 500 (dec) Index Group 0x2100 + channel ID Index Offset 0x0015 Data { UINT32 block counter UINT32 dummy LREAL[3] rotation of X, Y & Z in degrees } Error 0x706 (1798) The reading of technology data was not activated. Reading the currently active G-Code The G-Code is subdivided into groups. For example, the geometries types with modal effect (G01, G02...) and the plane selection (G17.. G19) form separate groups. When the G-Code information is read, the enumerator for the groups is also read. These can then be displayed in an application-specific manner. Since the read command comes with a parameter to be read, not all groups have to be read. The memory provided is always filled by group 1. If, for example, the transferred memory size is 3x8 bytes, the data for the block counter, group 1 and 2 are returned. Function ADS-Read Port 500 (dec) Index Group 0x2100 + channel ID 334 Version: 2.14.3 TF5100
## Page 335

Appendix Index Offset 0x0013 Data { UINT32 block counter UINT32 Group 1: Modal Geo Types UINT32 Group 2: Blockwise Geo Types UINT32 Group 3: Modal Plane Selection UINT32 Group 4: Modal Tool Compensation UINT32 Group 5: Modal Tool Feed Direction UINT32 Group 6: Modal Zero Shift UINT32 Group 7: Modal Accurate Stop UINT32 Group 8: Blockwise Accurate Stop UINT32 Group 9: Modal Designation Abs Inc UINT32 Group 10: Modal Designation Inch Metric UINT32 Group 11: Modal Feed Rate In Curve UINT32 Group 12: Modal Centerpoint Corr UINT32 Group 13: Modal Circle Cp Abs Inc UINT32 Group 14: Modal Collision Detection UINT32 Group 15: Modal Rotation UINT32 Group 16: Modal Calc Ex Rot UINT32 Group 17: Modal Diam UINT32 Group 18: Modal Feedrate Ipol UINT32 Group 19: Modal Mirror } Error 0x706 (1798) The reading of technology data was not activated. #define GCode Offset 0x1000 #define Common Ident Offset 0x2000 // used for non-g-code commands, like rot, cfc... Group 1: Modal Geo Types enum GCode Group_Modal Geo Types { Modal Geo Type Undefined = 0, Modal Geo Type G0 = 0 + GCode Offset, // line - rapid traverse Modal Geo Type G01 = 1 + GCode Offset, // straight line Modal Geo Type G02 = 2 + GCode Offset, // circle clockwise Modal Geo Type G03 = 3 + GCode Offset // circle anticlockwise }; Group 2: Blockwise Geo Types enum GCode Group_Blockwise Geo Types { Blockwise Geo Type None = 0, Blockwise Geo Type G04 = 4 + GCode Offset, // dwell time Blockwise Geo Type G74 = 74 + GCode Offset, // homing Blockwise Geo Type Cip = 1 + Common Ident Offset // circle parametrized with 3 points }; Group 3: Modal Plane Selection enum GCode Group_Modal Plane Selection { Modal Plane Select Undefined = 0, Modal Plane Select G17 = 17 + GCode Offset, // xy-plane Modal Plane Select G18 = 18 + GCode Offset, // zx-plane Modal Plane Select G19 = 19 + GCode Offset // yz-plane }; Group 4: Modal Tool Compensation TF5100 Version: 2.14.3 335
## Page 336

Appendix enum GCode Group_Modal Tool Compensation { Modal Tool Comp Undefined = 0, Modal Tool Comp G40 = 40 + GCode Offset, // tool compensation off Modal Tool Comp G41 = 41 + GCode Offset, // tool compensation left Modal Tool Comp G42 = 42 + GCode Offset // tool compensation right }; Group 5: Modal Tool Feed Direction enum GCode Group_Modal Tool Feed Direction { Modal Tool Feed Dir Undefined = 0, Modal Tool Feed Dir Pos = 2 + Common Ident Offset, // tool feed direction positive Modal Tool Feed Dir Neg = 3 + Common Ident Offset // tool feed direction negative }; Group 6: Modal Zero Shift enum GCode Group_Modal Zero Shift { Modal Zero Shift Undefined = 0, Modal Zero Shift G53 = 53 + GCode Offset, // zero shift off Modal Zero Shift G54G58G59 = 54 + GCode Offset, // zero shift G54 + G58+ G59 Modal Zero Shift G55G58G59 = 55 + GCode Offset, // zero shift G55 + G58+ G59 Modal Zero Shift G56G58G59 = 56 + GCode Offset, // zero shift G56 + G58+ G59 Modal Zero Shift G57G58G59 = 57 + GCode Offset // zero shift G57 + G58+ G59 }; Group 7: Modal Accurate Stop enum GCode Group_Modal Accurate Stop { Modal Accurate Stop None = 0, Modal Accurate Stop G60 = 60 + GCode Offset // modal accurate stop }; Group 8: Blockwise Accurate Stop enum GCode Group_Blockwise Accurate Stop { Blockwise Accurate Stop None = 0, Blockwise Accurate Stop G09 = 9 + GCode Offset, // common accurate stop Blockwise Accurate Stop Tpm = 4 + Common Ident Offset // target position monitoring }; Group 9: Modal Designation Abs Inc enum GCode Group_Modal Designation Abs Inc { Modal Design Abs Inc Undefined = 0, Modal Design Abs Inc G90 = 90 + GCode Offset, // absolute designation Modal Design Abs Inc G91 = 91 + GCode Offset // incremental designation }; Group 10: Modal Designation Inch Metric enum GCode Group_Modal Designation Inch Metric { Modal Design Inch Metric Undefined = 0, Modal Design Inch Metric G70 = 70 + GCode Offset, // designation inch Modal Design Inch Metric G71 = 71 + GCode Offset, // designation metric Modal Design Inch Metric G700 = 700 + GCode Offset, // designation inch & feedrate recalculated Modal Design Inch Metric G710 = 710 + GCode Offset // designation metric & feedrate recalculated }; Group 11: Modal Feed Rate In Curve enum GCode Group_Modal Feed Rate In Curve { Modal Feed Rate In Curve Undefined = 0, Modal Feed Rate In Curve Cfc = 5 + Common Ident Offset, // constant feed contour Modal Feed Rate In Curve Cfin = 6 + Common Ident Offset, // constant feed inner contour Modal Feed Rate In Curve Cftcp = 7 + Common Ident Offset // constant feed tool center point }; Group 12: Modal Centerpoint Corr 336 Version: 2.14.3 TF5100
## Page 337

Appendix enum GCode Group_Modal Centerpoint Corr { Modal Centerpoint Corr Undefined = 0, Modal Centerpoint Corr On = 8 + Common Ident Offset, // circle centerpoint correction on Modal Centerpoint Corr Off = 9 + Common Ident Offset // circle centerpoint correction off }; Group 13: Modal Circle Cp Abs Inc enum GCode Group_Modal Circle Cp Abs Inc { Modal Circle Cp Undefined = 0, Modal Circle Cp Incremental = 10 + Common Ident Offset, // circle centerpoint incremental to start point Modal Circle Cp Absolute = 11 + Common Ident Offset // circle centerpoint absolute }; Group 14: Modal Collision Detection enum GCode Group_Modal Collision Detection { Modal Collision Detection Undefined = 0, Modal Collision Detection On = 12 + Common Ident Offset, //collision detection on Modal Collision Detection Off = 13 + Common Ident Offset //collision detection off }; Group 15: Modal Rotation enum GCode Group_Modal Rotation { Modal Rotation Undefined = 0, Modal Rotation On = 14 + Common Ident Offset, // rotation is turned on Modal Rotation Off = 15 + Common Ident Offset // rotation is turned off }; Group 16: Modal Calc Ex Rot enum GCode Group_Modal Calc Ex Rot { Modal Calc Ex Rot Undefined = 0, Modal Calc Ex Rot On = 16 + Common Ident Offset, // extended calculation for rotation turned on Modal Calc Ex Rot Off = 17 + Common Ident Offset // extended calculation for rotation turned off }; Group 17: Modal Diam enum GCode Group_Modal Diam { Modal Diam Undefined = 0, Modal Diam On = 18 + Common Ident Offset, // diameter programming on Modal Diam Off = 19 + Common Ident Offset // diameter programming off }; Group 18: Modal Feedrate Ipol enum GCode Group_Modal Feedrate Ipol { Modal Feedrate Ipol Undefined = 0, Modal Feedrate Ipol Const = 20 + Common Ident Offset, // federate interpolation constant (default) Modal Feedrate Ipol Linear = 21 + Common Ident Offset // federate interpoaltion linear to remaining path }; Group 19: Modal Mirror enum GCode Group_Modal Mirror { // value - (32+Common Ident Offset) shows the bitmask for mirrored axes // that's why the sequence seems to be strange... // Modal Mirror Undefined = 0, Modal Mirror Off = 32 + Common Ident Offset, Modal Mirror X = 33 + Common Ident Offset, Modal Mirror Y = 34 + Common Ident Offset, Modal Mirror XY = 35 + Common Ident Offset, Modal Mirror Z = 36 + Common Ident Offset, Modal Mirror ZX = 37 + Common Ident Offset, Modal Mirror YZ = 38 + Common Ident Offset, Modal Mirror XYZ = 39 + Common Ident Offset }; TF5100 Version: 2.14.3 337
## Page 338

Appendix 10.3 Displaying the remaining path length If calculation of the remaining path length is switched active, it is calculated up to as far as the next accurate stop, or as far as the last geometric segment in memory (block preparation). An accurate stop is, for instance, generated by G09 or by G60. However, M-functions of type handshake, decoder stops and G04 implicitly generate an accurate stop. Activation: Index Group: 0x3000 + Group ID Index Offset: 0x0508 see index offset specification for group parameters Reading the remaining path length: Reading is again implemented through ADS, and can also be recorded with Twin CAT Scope. Index Group: 0x3100 + Group ID Index Offset: 0x0522 The remaining path length can be transferred with the cyclic channel interface to the PLC via Itp Set Cyclic Lreal Offsets [} 245]. see index offset specification for group state 10.4 Parameterisation The parameterization of the NCI comprises the standard dynamic parameters (acceleration, deceleration, jerk) and their online changes, along with the minimum velocity and the parameters for the reduction of the path velocity including online change. General characteristics at segment transitions • Velocity: The segment set velocity VS changes at the segment transition from VS_in to VS_out. At the segment transition the velocity is always reduced to the lower of the two values. • Acceleration: The current path acceleration is always returned to a = 0 at segment transition. • Jerk: The jerk unit J changes according to the geometry at the segment transition. This can cause a significant step change in dynamics. • It is possible to smooth segment transitions [} 129]. Table 1: NCI group parameters Parameter Meaning and boundary conditions Curve velocity reduction mode [} 339] Coulomb, cosine or VELOJUMP Minimum velocity [} 339] Path velocity which may not be less than this value (except peaks with movement reversal): V_min ≥ 0.0 Reduction method for C1 transitions [} 339] Reduction factor for C1 transitions: C1 ≥ 0.0 VELOJUMP: C0 reduction factors C0X, C0Y, C0Z Reduction factors for C0 transitions for X, Y, Z axis: C0X ≥ 0.0, C0Y ≥ 0.0, C0Z ≥ 0.0 (axis parameters, online modification in interpreter [} 176] possible). DEVIATIONANGLE: Reduction factor C0 C0 Path reduction factor for C0 transitions: 1.0 ≥ C0 ≥ 0.0 DEVIATIONANGLE: Critical angle (low) φ_l Angle from which a velocity reduction is applied at the segment transition: 0 ≤ φ_l < φ_h ≤ π DEVIATIONANGLE: Critical angle (high) φ_h Angle from which the velocity at the segment transition (v_link) is reduced to 0.0: 0 ≤ φ_l < φ_h ≤ π Tolerance sphere radius [} 155] TBR Radius of the tolerance spheres: 1000.0 mm ≥TBR ≥ 0.1 mm C2 reduction factor [} 176] C2 Reduction factor for smoothed transitions: C2 ≥ 0.0 338 Version: 2.14.3 TF5100
## Page 339

Appendix Parameter Meaning and boundary conditions Global software limit positions for the path [} 340] Switches monitoring of the global software end positions for the path axes Minimum velocity Each NCI group has a minimum path velocity V_min ≥ 0.0. The actual velocity should always exceed this value. User-specified exceptions are: programmed stop at segment transition, path end and override requests which lead to a velocity below the minimum value. A systemic exception is a motion reversal. With the reduction method DEVIATIONANGLE the deflection angle is φ ≥ φ_h, in which case the minimum velocity is ignored. V_min must be less than the set value for the path velocity (F word) of each segment. The minimum velocity can be set to a new value V_min ≥ 0.0 in the NC program at any time. The unit is mm/ sec. Classification of the segment transitions In general, the transition from one segment to the next is not indefinitely smooth. Therefore, it is necessary to reduce the velocity at the transition point in order to avoid dynamic instability. For this purpose, the transitions are geometrically classified and the effective transition velocity - V_link - is determined in three categories. Segments - as geographical objects - are defined here as curves in terms of differential geometry and are parameterized by the arc length. A segment transition from a segment S_in to a segment S_out is classified in geometrical terms as type Ck, where k is a natural number (including 0), if each segment has k continuous arc length differentials and the kth derivatives at the transition point correspond. C0 transitions have a knee-point at the transition point. C1 transitions appear smooth, but are not smooth in dynamic terms. One example is the straight line-semi circle transition in the stadium: at the transition point there is a step change in acceleration. C2 transitions (and of course Ck transitions with k > 2) are dynamically smooth (jerk restricted). Reduction method for C2 transitions As at all transitions, at C2 transitions V_link is set to equal the minimum of both set segment velocities: V_link = min(V_in,V_out). There is no further reduction. Reduction method for C1 transitions First, V_link is set to the lower of the two segment target velocities: V_link = min(V_in,V_out). The geometrically induced absolute step change in acceleration Acc Jump in the segment transition is calculated depending on the geometry types G_in and G_out, and the plane selection G_in and G_out of the segments to be connected, at velocity V_link. If this is greater than C1 times the path acceleration/(absolute) deceleration Acc Path Reduced permissible for the geometries and planes, the velocity V_link is reduced until the resulting step change in acceleration is equal to Acc Path Reduced. If this value is less than V_min, then V_min takes priority. Notice When changing the dynamic parameters, the permissible path acceleration for the geometries and planes and thereby the reaction of the reduction changes automatically. Interface: XAE [} 24] and interpreter [} 176] Reduction modes for C0 transitions Several reduction methods are available for C0 transitions. The reduction method VELOJUMP reduces the velocity after permitted step changes in velocity for each axis. The reduction method DEVIATIONANGLE reduces the velocity depending on the deflection angle φ (angle between the normalized end tangent T_in of the incoming segment S_in and the normalized start tangent T_out of the outgoing segment S_out). The cosine reduction method is a purely geometrical method (see curve velocity reduction method [} 25]). TF5100 Version: 2.14.3 339
## Page 340

Appendix The VELOJUMP method is recommended for mechanically independent axes, while for mechanically coupled axes (the Y axis is attached to the X axis, for example) the DEVIATIONANGLE method is usually recommended. Reduction method for C0 transitions: VELOJUMP If V_link = min(V_in,V_out), and for each axis V_jump[i] = C0[i] * min(A+[i],-A-[i]) * T is the permitted absolute step change in velocity for the axis [i], wherein C0[i] is the reduction factor and A+[i], A-[i] are the acceleration/deceleration limits for the axis [i], and T is the cycle time. The VELOJUMP reduction method ensures that the path velocity is reduced at the segment transition V_link until the absolute step change in the set axis velocity of axis [i] is at most V_jump[i]. V_min nevertheless has priority: if V_link is less than V_min, V_link is set to V_min. In the case of movement reversal with no programmed stop, there will be a jump in axis velocity. Notice When changing the dynamic parameters, the maximum permissible step changes in axis velocity automatically change at the same time. Reduction method for C0 transitions: DEVIATIONANGLE Notice When changing the dynamic parameters, the reduction factors do not automatically change at the same time. Changing the parameters for C0 transitions: DEVIATIONANGLE Table 2: Parameter Parameter Meaning and boundary conditions DEVIATIONANGLE: Reduction factor C0C0 Path reduction factor for C0 transitions: 1.0 ≥ C0 ≥ 0.0 DEVIATIONANGLE: Critical angle (low) φ_l Angle from which reduction takes effect: 0 ≤ φ_l < φ_h ≤ π DEVIATIONANGLE: Critical angle (high) φ_h Angle from which reduction to v_link = 0.0 takes effect: 0 ≤ φ_l < φ_h ≤ π Interface: Interpreter [} 176] Cosine reduction method See here [} 25]. Tolerance sphere radius and C2 reduction factor These parameters are described under the heading Smoothing of segment transitions [} 129]. Global software limit positions for the path The 'Global software limit position monitoring for the path' offers two different ways of software position limit monitoring. Limit position monitoring by the SAF task This type of end position monitoring is always active if the limit position for the axis has been switched to active (axis parameter). The monitoring is carried out component for component by the SAF task. This means that if the end position is exceeded, the path velocity is instantly set to 0, and the entire interpolation group has an error. This type of monitoring is activated through the axes parameters, and not by means of the group parameters described here. Software limit positions on the path 340 Version: 2.14.3 TF5100
## Page 341

Appendix To prevent the path velocity being set to 0 immediately when a violation of the software end positions is encountered, the function 'Global software end position monitoring of the path' must be enabled. If this is active, the movement stops at the NC block in which the end positions were violated. The velocity is reduced via a ramp. • So that the monitoring is only executed for the desired path axes, the software limit positions for the axis components must be selected (axis parameters). • The monitoring is carried out for the standard geometry segments. These include Straight line Circle Helix • Curves with splines are not monitored. The set values associated with the splines are always within the tolerance sphere. Otherwise the limit position monitoring will make use of the SAF task. • Because meaningful and generally applicable monitoring of the end positions can only be carried out at the NC program's run-time (before lookahead) it is possible that the path axes will move as far as (but not including) the NC block in which the limit positions are exceeded. • If for some reason the axes are located outside the software limit positions it is possible to move back into the correct region in a straight line. Parameterization: XAE: Group parameters [} 24] 10.4.1 Path override (interpreter override types) The path override is a velocity override. This means that changing the override creates a new velocity, but does not affect the ramps (acceleration or jerk). The used override types only differ in terms of reference velocity. The parameterization takes place in the interpolation channel under the group parameters [} 25]. Option 'Reduced' - based on the reduced velocity (default) Because of the relevant dynamic parameters (braking distance, acceleration etc.) it is not possible for the programmed velocity (the blue line) be achieved in every segment. For this reason a velocity, possibly reduced, (the red line) is calculated for each geometric segment. In the standard case, the override is made with reference to this segment velocity. The advantage of this override type is that if override values are small the machine operates with an approximately linear reduction in velocity, and this is therefore the correct setting for most applications. v_res = v_max * Override TF5100 Version: 2.14.3 341
## Page 342

Appendix Option 'Original' - based on the programmed path velocity The override value is based on the velocity programmed by the user. The maximum segment velocity only has a limiting effect. Selection 'Reduced [0 ... >100%]' - based on internally reduced velocity with the option to specify a value greater than 100% 342 Version: 2.14.3 TF5100
## Page 343

Appendix The override type behaves like 'Reduced' [} 341]. With this override type it is possible to travel along the path more quickly than programmed in the G-Code. There is no limitation to 120%, for example. The maximum possible path velocity is limited by the maximum velocities of the axis components (G0 velocity) and their dynamics. If limitation to a particular value, e.g. 120%, is required, this can be set in the PLC project. 10.5 Cyclic Channel Interface The channel interface is responsible for the cyclic data exchange between the PLC and the NCI. From the NCI to the PLC (160 bytes) TYPE NCTOPLC_NCICHANNEL_REF : STRUCT Block No : UDINT; Fast MFunc Mask : ARRAY [1..5] OF DWORD; Hsk MFunc No : UINT; Hsk MFunc Req : WORD; HFunc Value : UDINT; Spindle Rpm : UINT; Tool : UINT; Chn State : NCTOPLC_NCICHANNEL_REF_CHN_STATE; Int Params : ARRAY [0..3] OF UDINT; Double Params : ARRAY [0..3] OF LREAL; Path Velo : LREAL; Loaded Prog : UDINT; Itp Mode : WORD; Itp State : UINT; Error Code : UDINT; Chn Id : UINT; Grp Id : UINT; Itf Version : UINT; _reserved1 : UINT; Chn Operation State : UDINT; Mcs Axis IDs : ARRAY [0..7] OF USINT; Acs Axis IDs : ARRAY [0..7] OF USINT; _reserved2 : ARRAY [1..24] OF USINT; END_STRUCT END_TYPE Variable name Data type Description Block No UDINT block number Fast MFunc Mask ARRAY OF DWORD Bit mask for evaluation of the fast M-functions [} 164] Hsk MFunc No UINT Number of synchronous M-function present (M-function with handshake) Hsk MFunc Req WORD Flag indicating that a synchronous M-function is present 0: no synchronous M-function is present 1: a synchronous M-function is present HFunc Value DINT Value of the auxiliary function Spindle Rpm WORD Spindle rotation speed Tool WORD Tool number Chn State NCTOPLC_NCICHANNEL_REF_C DWORD with status information for HN_STATE the channel (see status information for the channel (Chn State) [} 344] Int Params ARRAY [0..3] OF UDINT Data of the freely configurable channel interface (see Itp Set Cyclic UDint Offsets [} 246]) TF5100 Version: 2.14.3 343
## Page 344

Appendix Variable name Data type Description Double Params ARRAY [0..3] OF LREAL Data of the freely configurable channel interface (see Itp Set Cyclic Lreal Offsets [} 245]) Path Velo LREAL Current path set velocity Loaded Prog UDINT Name of the currently executed NC program. If the name is not a UDINT, this value is 0. Itp Mode WORD Bit mask that indicates execution in interpreter mode. Itp State UINT Status [} 16] of the interpreter Error Code UDINT Error code of the interpreter channel Chn Id UINT Channel ID Grp Id UINT group ID Itf Version UINT Version of this cyclic channel interface Chn Operation State UDINT Channel state for a channel of the kinematic transformation; has no purpose for an interpolation channel. Mcs Axis IDs ARRAY [0..7] OF USINT IDs of the MCS axes for a kinematic transformation channel; has no purpose for an interpolation channel. Acs Axis IDs ARRAY [0..7] OF USINT IDs of the ACS axes for a kinematic transformation channel; has no purpose for an interpolation channel. Channel status information (Chn State) In the XAE the channel status information can only be read with a plain text name, from the PLC only via the bit number. Name Bit number (zero based) Description b Is Interpolation Channel 0 Indicates that the linked channel is an interpolation channel. b Is Kinematic Channel 1 Indicates that the structure is linked to a channel for the kinematic transformation. b Is EStop Requested 8 Indicates that an Itp EStop was called, without checking whether the axes are already at standstill. b Is Feed From Backup List 10 For retracing the current entries from the interpreter backup list are sent. b Is Moving Backward 11 Indicates that the current motion is a reversing motion. b Retrace Start Pos Reached 12 Indicates that the program start was reached during reversing. From PLC to NCI (128 bytes) TYPE PLCTONC_NCICHANNEL_REF : STRUCT Skip Line : WORD; (* Mask to skip lines *) Itp Mode : WORD; MFunc Granted : WORD; (* granted signal of the M-function *) _reserved1 : UINT; 344 Version: 2.14.3 TF5100
## Page 345

Appendix Chn Axes Ovr : UDINT; (* Channel override in percent * 100 *) Chn Spindle Ovr : UDINT; _reserved2 : ARRAY [1..112] OF USINT; END_STRUCT END_TYPE Variable name Data type Description Skip Line WORD Bit mask with which block skipping [} 127] of the NCI is parameterized from the PLC Itp Mode WORD Bit mask with which the interpreter execution mode can be altered. This is, for instance, required if the interpreter is to operate in single block [} 133] mode. MFunc Granted WORD Flag with which an M-function of type 'Handshake' is confirmed. 0: Not acknowledged 1: Acknowledgement Chn Axes Ovr UDINT Channel override for the axes from 0...1000000 (corresponds to 0 - 100%) Chn Spindle Ovr UDINT Channel override for the spindle between 0 and 1000000 (corresponds to 0 - 100%); currently not supported. TF5100 Version: 2.14.3 345
## Page 346

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 347

More Information: www.beckhoff.com/tf5100 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
