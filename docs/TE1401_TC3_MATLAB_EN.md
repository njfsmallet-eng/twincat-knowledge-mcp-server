---
title: "TE1401 Twin CAT 3"
product: "TE1401"
category: "Engineering_Tools"
tags: ["CAT", "MATLAB", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.3.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TE1401_TC3_MATLAB_EN.pdf"
release_date: "2025-08-05"
---
Manual | EN TE1401 Twin CAT 3 | Target for MATLAB® 2025-08-05 | Version: 1.3.0

## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 1.4 Documentation issue status.............................................................................................................. 8 2 Overview.................................................................................................................................................... 9 3 Installation............................................................................................................................................... 10 3.1 Initial setup of the software............................................................................................................. 12 3.1.1 Set up default settings and set MATLAB® path................................................................ 12 3.1.2 Setting up driver signing................................................................................................... 15 4 Licenses................................................................................................................................................... 20 5 Quick start............................................................................................................................................... 21 6 Overview of automatically generated files........................................................................................... 33 7 Settings of the Twin CAT module generator......................................................................................... 35 7.1 Creating TMX archives.................................................................................................................... 39 8 Application of modules in Twin CAT...................................................................................................... 41 8.1 Working with the Tc COM module................................................................................................... 41 8.1.1 MATLAB code representation.......................................................................................... 43 8.2 Working with the PLC library........................................................................................................... 46 8.2.1 Online change of the PLC library..................................................................................... 50 8.2.2 Calling a Tc COM object from the PLC............................................................................. 51 8.3 Debugging....................................................................................................................................... 52 8.4 Exception handling.......................................................................................................................... 55 8.5 Using Realtime Monitor time stamps.............................................................................................. 62 9 FAQ........................................................................................................................................................... 63 9.1 Build of a sample fails..................................................................................................................... 63 9.2 Are there limitations with regard to executing modules in real-time?.............................................. 63 10 Samples................................................................................................................................................... 65 10.1 Twin CAT Automation Interface: use in MATLAB®........................................................................... 65 10.1.1 Sample: Tc3Automation Interface..................................................................................... 66 TE1401 Version: 1.3.0 3

## Page 4

Table of contents 4 Version: 1.3.0 TE1401

## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1401 Version: 1.3.0 5

## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.3.0 TE1401

## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1401 Version: 1.3.0 7

## Page 8

Foreword 1.4 Documentation issue status Version Changes 1.3.x Twin CAT 3.1 Build 4026 • Brief information on installation [} 10] • Updated system requirements 8 Version: 1.3.0 TE1401

## Page 9

Overview 2 Overview TE1401 Twin CAT Target for MATLAB® With the Twin CAT 3 Target for MATLAB®, it is possible to make use of the functions developed in the MATLAB® script language in Twin CAT 3. The functions are automatically transcoded in C/C++ code with the aid of the MATLAB® Coder™ and transformed into Twin CAT objects with the Twin CAT 3 Target for MATLAB®. These objects can be used seamlessly in the Twin CAT 3 Engineering, e.g. extended with PLC source code to make an overall project, debugged and linked with fieldbus devices. The automatically generated modules can be integrated in the Twin CAT solution as Tc COM objects on the one hand and as PLC function blocks on the other. The inserted modules are downloaded with the complete Twin CAT project into the Twin CAT 3 runtime, where they are executed within the real-time environment like all other objects. Twin CAT 3 Target for Simulink® supports targets with Windows 32-bit and 64-bit as well as Twin CAT/BSD. Further Information Technical short video • Twin CAT Target for MATLAB Product description • https://www.beckhoff.com/TE1401 Web page for MATLAB® and Simulink® with Twin CAT 3 • https://www.beckhoff.com/matlab TE1401 Version: 1.3.0 9

## Page 10

Installation 3 Installation System requirements In the following, a distinction is made between the engineering PC and the runtime PC. The following definition applies: on the engineering PC, MATLAB® functions are converted to Twin CAT objects by using the Target for MATLAB®. Similarly, a Twin CAT solution can be created on this PC, which uses the created objects, but it does not have to be. The Twin CAT solution created is then loaded from the engineering PC onto a runtime PC in the Twin CAT runtime environment for project execution. On the engineering PC • MATLAB® R2019a or higher ◦ MATLAB® and MATLAB® Coder™ Toolbox • Visual Studio 2017 or higher (Professional, Ultimate or equivalent edition) ◦ During installation, the option Desktop development with C++ must be selected manually. The option can also be installed later. • Twin CAT 3.1.4024.7 or higher ◦ Install Twin CAT 3 XAE or Full Setup only after Visual Studio has been installed with Desktop development with C++. • Twin CAT Tools for MATLAB® and Simulink® setup On the runtime PC • Supported operating systems ◦ Windows 11, Windows 10, Windows Server (32-bit and 64-bit) ◦ Twin CAT/BSD • Twin CAT XAR version 3.1.4024.7 or higher Built objects can be easily forwarded Twin CAT objects built on an engineering PC (or Build Server) can be easily forwarded to other people. They only need the Twin CAT XAE development environment in order to use the created objects (Tc COM or PLC function blocks) in a Twin CAT solution. Installation (Twin CAT 3.1 Build 4026) The TE1401 | Twin CAT 3 Target for MATLAB® workload installs all dependencies required to create Twin CAT objects. • Install one of the supported Visual Studio versions, if not already installed. Remember to install the Desktop development with C++ option. • Install the Twin CAT Package Manager. • Install the following workload via the Twin CAT Package Manager: Command line: tcpkg install TE1401. Target For MATLAB. XAE • Execute Integration in Visual Studio that you have installed with the Desktop development with C++ option. 10 Version: 1.3.0 TE1401

## Page 11

Installation • Start MATLAB® as administrator and execute C:\Program Files (x86)\Beckhoff\Twin CAT\Functions\TE14xx- Tools For Matlab And Simulink\Setup TE14xx.p in MATLAB®. If you want to create a Twin CAT project and use Twin CAT objects that have already been built, install the following workloads: • Twin CAT Standard tcpkg install Twin CAT. Standard. XAE • Twin CAT Block Diagram Classic tcpkg install Twin CAT. XAE. Block Diagram Classic • In some cases you will also need the following packages: tcpkg install Twin CAT. XAE. TMX. Mat Sim Utilities (for converting ITc Vn Image to ARRAY) Installation (Twin CAT 3.1 Build 4024) ü Install one of the supported Visual Studio versions, if not already installed. Remember to install the Desktop development with C++ option. 1. Start Twin CAT 3 XAE or Full Setup if these are not already installed. If Visual Studio and Twin CAT are already installed, but the Visual Studio version does not meet the above requirements (e.g. Twin CAT XAE Shell or Visual Studio without C++ option), you will need to install a suitable version of Visual Studio version first (install the C++ option, if necessary). Then run Twin CAT 3 setup to integrate Twin CAT 3 into the new (or modified) Visual Studio version. 2. If you have not yet installed MATLAB® on your system, install it. The order in which MATLAB® has been installed is irrelevant. 3. Start Twin CAT Tools for MATLAB® and Simulink® Setup to install the TE1401 Twin CAT Target for MATLAB®. ð The Twin CAT Target for MATLAB® is installed within the Twin CAT folder structure, i.e. it is separate from the MATLAB® installation. 4. Start MATLAB® as administrator and run %Twin CAT3Dir%.. \Functions\TE14xx-Tools For Matlab And Simulink\Setup TE14xx.p in MATLAB®. ð A setup window opens. See the following section. Setting up the software Version Setup TE14xx.p After executing the p-file, a dialog opens in which you can save general default settings that will then apply to the system. You can make the settings directly or make/change them at a later time. If you want to execute the p-file without this dialog, you can use the following command: Setup TE140x('Silent', true); Setting options in the dialog are: Vendor Name, Group Name (MATLAB®) and Group Name (Simulink®) TE1401 Version: 1.3.0 11

## Page 12

Installation These settings influence the hierarchy in which the generated Twin CAT objects are sorted. See diagram below. Here the entries Vendor Name "TE140x Module Vendor" and Group Name "TE140x|MATLAB Modules" are for MATLAB® and "TE140x|Simulink Modules" for Simulink®. To change the default settings, you can access the dialog with Twin CAT. Module Generator. Settings. Edit in the MATLAB® Console. Here you are also offered additional entries that you can store as default. 3.1 Initial setup of the software 3.1.1 Set up default settings and set MATLAB® path Initial setup of the software Setting MATLAB® paths As described under Installation, the files Setup TE14xx.p must be executed after the software installation. This script adds the necessary paths to your MATLAB® path. MATLAB® administrator rights are required to save MATLAB® paths. Run Setup TE14xx.p additionally after each product update To ensure that all paths are set in the MATLAB® path, please also run the p-file after updating the product. Set default settings The script also opens a dialog in which you can save general default settings for the Twin CAT target. These settings then apply system-wide, i.e. for all installed MATLAB® versions. If you want to execute the p-file without this dialog, you can use the following command: Setup TE14xx('Silent', true); The default values of the dialog are set. 12 Version: 1.3.0 TE1401

## Page 13

Installation You can make the settings at this time or make/change them at a later time. In the dialog under the Build tab, you can store a default certificate for driver signing. The setup options for driver signing are explained in full in the chapter Setting up driver signing [} 15]. The hierarchy of the generated Twin CAT objects can also be influenced in the dialog. The following setting options are available in the dialog: • Vendor Name • Group Name (MATLAB®) and • Group Name (Simulink®) The hierarchy is shown in Twin CAT using the following example: • Vendor Name “TE140x Module Vendor” • Group Name “TE140x” ◦ “MATLAB Modules” for MATLAB® and ◦ “Simulink Modules” for Simulink® TE1401 Version: 1.3.0 13

## Page 14

Installation Change the software setup To change the default settings of the Twin CAT target, you can access a dialog in the MATLAB® Console as follows: Twin CAT. Module Generator. Settings. Edit Here you are offered various entries that you can store as default values. 14 Version: 1.3.0 TE1401

## Page 15

Installation Accept changes 1. Enter the new default settings in the dialog box. 2. Confirm with the Save button. 3. Restart MATLAB®. ð The changes have been adopted. 3.1.2 Setting up driver signing Create an OEM certificate level 2 Twin CAT objects generated from MATLAB® or Simulink® are based on a tmx driver (Twin CAT Module Executable), as are Twin CAT C++ objects. These drivers must be signed with a OEM certificate level 2 so that the driver can be loaded on the runtime PC during the Twin CAT runtime. See the following links for detailed documentation on how to create an OEM certificate for driver signing: • General documentation on OEM certificates • Application-related documentation for tmx driver signing TE1401 Version: 1.3.0 15

## Page 16

Installation The most important facts in brief: • You can create your own certificate. To do this, go to Visual Studio at: Menu bar > Twin CAT > Software Protection... ◦ You need an OEM certificate Crypto Version 2 (option: Sign Twin CAT C++ executables (*.tmx)). ◦ You will be prompted to create a password for your certificate. • Drivers can also be created without signing and signed afterwards. • For testing purposes in the development phase, a non-countersigned certificate is sufficient. • Countersigned certificates can be ordered free of charge from Beckhoff (TC0008). Set up OEM certificate level 2 under Software Protection Twin CAT Build 4026: Requirement for the setup dialog The following information on Software Protection only applies to Twin CAT 3.1 Build 4026. At least the Twin CAT Standard 4026.14 workload is required. If you are working with older versions, please continue reading “Setting up OEM certificate level 2 for driver signing without the Software Protection dialog” in the section below. In the Software Protection interface (Menu bar > Twin CAT > Software Protection...) you can both create certificates (Create New...) and: • Set a certificate as the system-wide default certificate for signing tmx files (optional). • For each certificate, store the corresponding password for the logged-in Windows user (required). The overview above contains two certificates as examples. The first certificate "Test Sign123" is not countersigned by Beckhoff, therefore it is classified as invalid in the status. Certificates that are not countersigned can still be used for signing. The target system must then be set into the test mode - see section Behavior of the Twin CAT runtime [} 18]. The "Tmx Sign Cert Faxxx Bx" certificate, on the other hand, is countersigned and therefore classified as valid. Both certificates are suitable 16 Version: 1.3.0 TE1401

## Page 17

Installation for signing tmx files, as can be seen under Permissions. In the "TMX Signing" column, "Default" indicates whether a certificate is set as the system-wide default certificate. The note "PW Stored" indicates that the password of the certificate is available/stored for the Windows user logged in. Set certificate as system-wide default certificate (optional) You can set a default certificate on an engineering PC, which is always used for Twin CAT C++, Target for MATLAB®, Target for Simulink®, etc., unless you explicitly specify a different certificate. Select the certificate you want to use as the default certificate from the list in the Software Protection dialog and select the "Set as System Default" checkbox. An environment variable with the name Tc Sign Twin Cat Cert Name is then created. In Windows, environment variables are made known when a process is started. Therefore, restart MATLAB® if you are already running the process. Further options for using certificates can be found later in this chapter. Store password for a certificate (required) For security reasons, the password of a certificate must not be entered in the project or source code in the Simulink® model or in the MATLAB® code. With "Store Password for Current User" you store the corresponding passwords for your certificates on your system. The passwords are stored obfuscated in the registry of the Windows operating system. This means that the password for a specific certificate is known in the operating system (for the Current User) and is used automatically. Select the certificate for which you want to store the corresponding password in the Software Protection dialog. Select "Store Password for Current User". You will be asked to enter your password. If it has been successfully checked and entered, the note "PW Stored" appears under "TMX Signing". An alternative variant for storing a password is the command prompt with the Tc Sign Tool (C:\Program Files (x86)\Beckhoff\Twin CAT\3.1\SDK\Bin). The password is stored with the following call: tcsigntool grant /f "C:\Twin CAT\3.1\Custom Config\Certificates\My Certificate.tccert" /p My Password The obfuscated password is stored in the registry under: HKEY_CURRENT_USER\SOFTWARE\Beckhoff\Tc Sign Tool\ The password is deleted with the following call: tcsigntool grant /f "C:\Twin CAT\3.1\Custom Config\Certificates\My Certificate.tccert" /r Set up OEM certificate level 2 for driver signing without the Software Protection dialog To sign tmx files, you need a certificate and a password associated with the certificate. Available certificates can be found at: Build 4026: C:\Program Data\Beckhoff\Twin CAT\3.1\Custom Config\Certificates Build 4024: C:\Twin CAT\3.1\Custom Config\Certificates Handling of the certificate There are four possible variants for signing tmx drivers. Variant 1: System-wide default certificate for Twin CAT C++ and TE14xx This variant is identical to the path via "Software Protection" > "Set as System Default". Alternatively, you can also create a Windows environment variable manually for this variant. Create a new environment variable at User > Variables with: Variable: Tc Sign Twin Cat Cert Name TE1401 Version: 1.3.0 17

## Page 18

Installation Value: Full path of the certificate Variant 2: System-wide default certificate for MATLAB® You can set a default certificate in your MATLAB® environment, which is always used for Target for MATLAB® and Target for Simulink® (not Twin CAT C++), unless you explicitly specify a different certificate. Open the Common Settings dialog with Twin CAT. Module Generator. Settings. Edit (MATLAB® Command line) and enter the desired default certificate under Build > Certificate name for Twin CAT signing. This certificate is stored in your user directory as default and is used by all MATLAB® versions on your system as default. Variant 3: Certificate in the configuration of the Simulink® model You can explicitly name a certificate for each build operation. For Variant 3 you do not have to make any further settings in advance. Before each build process, you can define a certificate of your choice for precisely this build process. Target for Simulink®: TC Build > Certificate for Twin CAT signing Target for MATLAB®: Property Sign Twin Cat Cert Name Variant 4: Build without certificate and sign later with Tc Sign Tool You can build without a certificate and sign afterwards with the Tc Sign Tool. The Tc Sign Tool is a command line program. For example, open the command prompt and execute tcsigntool sign /? to display the help. The program can be found here: Build 4026: C:\Program Files (x86)\Beckhoff\Twin CAT\3.1\SDK\Bin Build 4024: C:\Twin CAT\3.1\SDK\Bin Operating Tc Sign Tool from MATLAB® From MATLAB®, the tool can be started with the command system() or with !. Sample call for signing a tmx driver for Twin CAT: Tc Sign Tool sign /f "C:\Twin CAT\3.1\Custom Config\Certificates\ My Certificate.tccert" /p My Password "C:\Twin CAT\3.1\Repository\TE140x Module Vendor\Modul Name\0.0.0.1\Twin CAT RT (x64)\My Driver.tmx" Behavior of the Twin CAT runtime If a Twin CAT object created from MATLAB® or Simulink® with a signed driver is used in a Twin CAT Solution and loaded onto a target system with Activate Configuration, the following must be observed: Test mode for non-countersigned certificates If you use a non-countersigned OEM certificate for signing, you must set your target system into test mode. To do this, run the following command as an administrator on the target system: bcdedit /set testsigning yes If you are using a countersigned OEM certificate, this step is not necessary. Whitelist for certificates on target systems Each Twin CAT runtime (XAR) has its own whitelist of trusted certificates. Behavior with Twin CAT Build 4026 The Twin CAT-XAE checks whether all certificates required to activate the configuration are in the whitelist on the runtime system. If this is not the case, a pop-up window appears. You can set the whitelist entries there. Behavior with Twin CAT Build 4024 If the certificate used for signing is not included in this whitelist, the driver will not be loaded. A corresponding error message is output in Twin CAT Engineering (XAE). 18 Version: 1.3.0 TE1401

## Page 19

Installation The error message contains the instruction to execute a registry file, which was automatically created on the target system, on the target system as administrator. This process adds the used certificate to the whitelist. Registry file is only dependent on the OEM certificate The registry file can also be used on other target systems. It only contains information about the OEM certificate used and is not target system dependent. TE1401 Version: 1.3.0 19

## Page 20

Licenses 4 Licenses Two licenses are required to use the full functionality of the TE1401 Twin CAT Target for MATLAB®. On the one hand, the TE1401 engineering license for creating Twin CAT objects from MATLAB® functions and, on the other hand, a runtime license for executing these objects during the Twin CAT runtime. Engineering license The license TE1401 Target for MATLAB® is required for the engineering system to create Tc COM and PLC function blocks from MATLAB®. For testing purposes, the product can be used in demo mode without a license as a demo version. A 7-day trial license with full functionality is not available for this product. Restrictions in the demo version Without a valid TE1401 license, the following restrictions must be observed: • All cpp and header files from MATLAB® Coder™ must not exceed 50 k B in total. • Function inputs and function outputs are limited to 5 variables. • You cannot merge multiple MATLAB® functions into one PLC library. Modules created with a demo license may only be used for non-commercial purposes! Runtime license The TC1320 or TC1220 licenses with included PLC license are required to start a Twin CAT configuration with a Twin CAT object generated from MATLAB®. Without activated license, the module and consequently the Twin CAT system cannot be started. TC1320 contains the license for executing Twin CAT C++ objects as well as objects created via the Target for Simulink® and via the Target for MATLAB®. TC1220 adds a PLC license to the above list of TC1320. It is possible to create a 7-day trial license for the runtime licenses, which allows initial tests without purchasing the license. 20 Version: 1.3.0 TE1401

## Page 21

Quick start 5 Quick start Starting with a simple MATLAB® function ü Feel free to use our built-in samples for first steps with the Twin CAT Target for MATLAB®. The MATLAB® Command Window provides a list of available samples via Twin CAT. Module Generator. Samples. List 1. First select simple samples, e.g. Base Statistics - can also be called directly with Twin CAT. Module Generator. Samples. Start('Base Statistics'). Beginner video The following video (only available in English) can also be used as an introduction: Twin CAT Target for MATLAB®. Getting started with the Base Statistics Sample ü Opening the Base Statistics Sample opens a MATLAB Live Script, which contains documentation parts as well as sections with code for execution. 1. Execute the Code Sections by clicking on the respective Run buttons. 2. Work your way through the sample step by step. ð The sample shows how you can use the Target for MATLAB® to convert two MATLAB® functions into two Tc COM objects and two function blocks, bundling the function blocks in a common PLC library. If you do not have a valid TE1401 license, you can activate the Trial License checkbox in the sample. This converts only one MATLAB® function into a Tc COM and a function block. The sample is then compliant with the demo terms [} 20] of the product. Selection of components and paths The General Preparation section of the sample states: What should be the name of the created Twin CAT driver (tmx-file)? Here Tc3_Base Statistics is selected. This name is then used in the following places: TE1401 Version: 1.3.0 21

## Page 22

Quick start • File path in the Engineering Repository: %Twin CATInstall Dir% \3.1\Repository\<TE140x Module Vendor>\Tc3_Base Statistics\<Version>\ • Name of the created files *.tmx, *.tml, *.tmc and *.library • Name of the created PLC library in Twin CAT, which then contains the two function blocks Where should all source files be stored? build Dir specifies where the MATLAB® Coder™ and also the Twin CAT Target for MATLAB® should store all source files, log files and other meta information files. This folder contains all the information required to create the Twin CAT objects from here. In this case, a new folder _ build Dir is created in the current MATLAB® path. Which MATLAB® functions should be made available in Twin CAT? The MATLAB® functions are named here with the variables module1 and module2; the two MATLAB® functions Base Statistics and Base Statistics Iteravtive (stored in subfolder M) are to be transferred to Twin CAT objects accordingly. Each of these modules gets its own subfolder in build Dir which is named cpp Dir1 and cpp Dir2. The C++ code is later generated into these subfolders by the MATLAB® Coder™. Creating a MATLAB® Coder™ configuration In the further course of the MATLAB® Live Script, a MATLAB® Coder™ configuration is created. This section does not contain any Twin CAT-specific components, i.e. only the MATLAB® Coder™ is used. For detailed MATLAB® Coder™ documentation, see the MATLAB® documentation. 22 Version: 1.3.0 TE1401

## Page 23

Quick start When creating the Coder configuration cfg, please note: • The Embedded Coder is not supported. • Only the generated code is needed. The codegen command then receives the Coder configuration and the corresponding MATLAB® function to be translated. The argument "-d", cpp Dir1 instructs the MATLAB® Coder™ to place the C++ code in the cpp Dir1 path. Accordingly, after this step the generated C++ code of the function Base Statistic.m and Base Statistic Iterarive.m are located in the folders _Build Dir/ Base Statistic and _Build Dir\ Base Statistic Iterative. Creating a Target for MATLAB® project export configuration The following code segments in the MATLAB® Live Script apply only to the Target for MATLAB® and are independent of the MATLAB® Coder™ in that only C++ code already created by the MATLAB® Coder™ will be used. Optionally, you can extract the MATLAB® code description from the m-file and display it later in Twin CAT XAE, see MATLAB Code in Tc COM [} 43]. Twin CAT. Module Generator. Matlab. Export MCode Representation('MFile',module1,'Build Dir',cpp Dir1); The m-file with the module1 function, i.e. Base Statistics, must be located in the MATLAB® workspace. The information is then extracted from the Base Statistics.m file and stored in the cpp Dir1 folder. In the next step, a project export configuration is created by the Twin CAT module generator with Twin CAT. Module Generator. Project Export Config('Full Path',Full Path To Vcxproj); TE1401 Version: 1.3.0 23

## Page 24

Quick start The full path to the new Visual Studio project to be created is specified as the argument. In this case, it is ... \_Build Dir\Tc3_Base Statistics.vcxproj. After building, the naming of the Visual Studio project also defines the naming of the created files *.tmx, *.tmc, *.tml and *.library. See General settings Base Statistics [} 21]. Fig. 1: For each MATLAB® function, an export configuration must be created with Twin CAT. Module Generator. Matlab. Function Export Config(). Add Class Export Config adds this export configuration to the project export configuration as a module. export Config. Add Class Export Config(Twin CAT. Module Generator. Matlab. Function Export Config('MFile',module 1,'Build Dir',cpp Dir1)); The path to the C++ code generated by MATLAB® Coder™ and the name of the m-file with the corresponding MATLAB® function are passed as arguments to Function Export Config(). For example, module1 is then used to set that the Tc COM object to be created and the function block in the PLC library are called Base Statistics or FB_Base Statistics. The project export configuration will be further adapted in the following. This defines the platforms for which a driver is to be built (here for Windows 32-bit, Windows 64-bit and Twin CAT/BSD 64-bit). A PLC library is also configured to be created and installed on the local Twin CAT XAE. For each module added to the project export configuration, properties can be set individually. It is explicitly set here that, for the first added module, both a PLC function block and a Tc COM are to be generated. You can use disp(export Configuration) to display an overview of the entire configuration. 24 Version: 1.3.0 TE1401

## Page 25

Quick start This provides an overview of the values set (Value), the data type used (Data Type), suggested values (Options), and a short description (Displayname). With Twin CAT. Module Generator. Project Exporter(export Config), the build process of the configured platforms is triggered. This creates a folder on the local file system in the repository and stores the created drivers and description files. The path description is: %Twin CATInstall Dir% \3.1\Repository\< Vendor Name >\<Project Name>\<Version>\ You can copy the folder to any number of Twin CAT XAE systems to make the modules available on those systems. Only the *.library must be installed in Twin CAT via the PLC library repository. Please note that the folder structure will not be changed during copying. Use PLC library in Twin CAT 3 ü Starting from a new Twin CAT solution, create a PLC project: 1. Perform the following menu steps. TE1401 Version: 1.3.0 25

## Page 26

Quick start 26 Version: 1.3.0 TE1401

## Page 27

Quick start 2. Then add the newly created (and already installed) PLC library: TE1401 Version: 1.3.0 27

## Page 28

Quick start 28 Version: 1.3.0 TE1401

## Page 29

Quick start 3. Get an overview of the data types and function blocks: TE1401 Version: 1.3.0 29

## Page 30

Quick start 4. Insert instances of the function blocks into your PLC and use them in your application: Using Tc COM objects in Twin CAT 3 1. Insert a new Tc COM object. 30 Version: 1.3.0 TE1401

## Page 31

Quick start 2. Select the corresponding Tc COM object: 3. Create a new cyclic task of type Twin CAT Task. TE1401 Version: 1.3.0 31

## Page 32

Quick start 4. Assign the newly created task to the newly created Tc COM object. To do this, go to the instance of the Tc COM object and select the Context tab. ð You can now activate the configuration. In order to connect the Tc COM object with other modules in your Twin CAT solution beforehand, you can use the process image to create mappings. You can view the MATLAB® code on the Block Diagram tab and observe and scope values on the fly. See MATLAB code representation [} 43]. 32 Version: 1.3.0 TE1401

## Page 33

Overview of automatically generated files 6 Overview of automatically generated files If a build process is triggered via the Twin CAT module generator, some files and folders are created automatically. Where the files are located, what can be done with them and what the files mean - this is described below. What are the categories of automatically generated files? • Source code is generated. • Log files are generated. • The Twin CAT objects, drivers (*.tmx) and description files (*.tmc, *.library, ...), are created. Generated source code All source files required for the build, i.e. for creating the Twin CAT objects, are stored in the folder specified during initialization of the Twin CAT module generator. The location and name of the Visual Studio project to be generated are specified precisely here. Twin CAT. Module Generator. Project Export Config('Full Path',Full Path To Vcxproj); For example, the following graphic shows the Full Path as ...\_Build Dir\Tc3_Base Statistics. The central file for the source code is <Project Name>.vcxproj. This file can be used to create all Twin CAT objects. From MATLAB® you can, for example, trigger code generation only without a build process and run the build process on another system such as a build server. To do this, set Project. Publish = false in the Twin CAT module generator. Generated log files The generated log files are also collected in the folder mentioned above. The log files created are the first place to look when debugging. If you request help from our support, please always send the following file with your request: <Model Name>_Module Generation Log.txt Created Twin CAT objects After a successful build, the binary files and description files created, which can be re-used in Twin CAT XAE, are stored in the so-called Engineering Repository, i.e. on the engineering PC at: TE1401 Version: 1.3.0 33

## Page 34

Overview of automatically generated files %Twin CATInstall Dir% \3.1\Repository\<Module Vendor>\<Project Name>\<Version>\ This folder contains the tmc description file, the PLC library and the tmx drivers for the configured platforms as well as other description files. If the order is copied to other PCs with Twin CAT XAE in the local engineering repositories, their users can use the created Twin CAT objects in their Twin CAT solutions. Please note Description of the generated C++ files and binary files Versioned C++ projects 34 Version: 1.3.0 TE1401

## Page 35

Settings of the Twin CAT module generator 7 Settings of the Twin CAT module generator Adds a project export configuration export Config = Twin CAT. Module Generator. Project Export Config('Full Path',Full Path To VSproj); The full path and name of the Visual Studio project to be created is passed to the 'Full Path' property. Returns an object of the class Twin CAT. Module Generator. Project Export Config. Sample call: Full Path To VSproj = 'C:\Build Dir\My MATLABFcn'; export Config = Twin CAT. Module Generator. Project Export Config('Full Path',Full Path To VSproj); Methods of the class Twin CAT. Module Generator. Project Export Config Add Class Export Config Adds an export configuration to the project. To create an export configuration, see section Creating an export configuration [} 39]. The export configuration is appended under Properties in the cell array Class Export Cfg. For an example call, see Module generator quick start [} 23]. Save This creates a mat file and stores the project export configuration in it. The transfer argument is a path where the mat file is to be stored. Example call: export Config. Save(pwd) This saves the project export configuration in the current path. Load This loads a saved project export configuration. The transfer argument specifies the path of the mat file containing the saved configuration. Example call: export Config. Load(pwd) Loads the project export configuration from the current path. Edit Opens a graphical configuration interface for setting up the project export configuration. disp Gives an overview of the current project export configuration in the MATLAB® Command Window. See Module generator quick start [} 23]. Example call: export Config.disp alternatively disp(export Config) TE1401 Version: 1.3.0 35

## Page 36

Settings of the Twin CAT module generator Properties of the class Twin CAT. Module Generator. Project Export Config Project Structure with entries for configuring the build properties, the PLC library and the possible callbacks. Project. Full Path Full Path to the Twin CAT C++ project to be created. Project. Vendor Name Name of the Vendor. The Vendor Name is used to structure the Twin CAT objects. The vendor is created as a folder within the repository’s path and becomes visible in the structure once the PLC library and the Tc COM object have been inserted. Project. Increment Version Possible values: “None”, “Revision”, “Build”, “Minor”, “Major” Default value: “Revision” This setting determines which of the four digits of the version number are incremented. The basis is the most recent version available on the engineering system (see Drv File Version). Project. Drv File Version Default: Search for the most recent version on the engineering system. If no existing version is found, it starts at 0.0.0.0. Direct setting of a version: Can be set directly as a string, e.g. “1.52.32.0”. Increment Version will then not be executed. Project. Publish If TRUE, the created Twin CAT C++ project is built for the configured platforms. Project. Publish Platformtoolset This configures the Visual Studio version to use. This can be specified precisely or set to Auto (default). Project. Publish Tc RTx86 If TRUE, XAR is built on a Windows 32-bit platform. Project. Publish Tc RTx64 If TRUE, XAR is built on a Windows 64-bit platform. 36 Version: 1.3.0 TE1401

## Page 37

Settings of the Twin CAT module generator Project. Publish Tc OSx64 If TRUE, XAR is built on a Twin CAT/BSD platform. Project. Sign Twin Cat Cert Name A Twin CAT OEM certificate for driver signing can be specified here (not mandatory). The password is to be entered into the Windows Registry of the user with the Tc Sign Tool. Detail see Initial setup of the software [} 12]. Project. Tmx Archive Enter a path and file name here as a string in order to create a TMX archive [} 39]. Example: Project. Tmx Archive = “c:\archives\[Date]-[Time]-[Lib Name][Lib Version].exe” creates a self-extracting TMX archive under c:\archies. The placeholders are resolved in the module generator before the file is written. Project. Generate Plc Library If TRUE, a PLC library (*.library) is created in the repository folder for the project. Project. Install Plc Library If TRUE, the created PLC library is installed on the local Twin CAT XAE. Project. Pre Code Generation Callback Fcn Here, a function can be called as a string to be called before code generation, i.e., before the Twin CAT C++ project is created. For example, an m-file My Callback.m can be created in the workspace with the following content: function My Callback(obj) … return The Pre Code Generation Callback Fcn property is then set to “My Callback”. By default, the Project Exporter object [} 39] is passed to the function, so that you have access to all data of the current project in the callback function. Project. Post Code Generation Callback Fcn Here, a function can be called as a string to be called after code generation, i.e., after the Twin CAT C++ project is created. For example, an m-file My Callback.m can be created in the workspace with the following content: function My Callback(obj) … return The Post Code Generation Callback Fcn property is then set to “My Callback”. By default, the Project Exporter object [} 39] is passed to the function, so that you have access to all data of the current project in the callback function. Project. Post Publish Callback Fcn Here, a function can be called as a string to be called after the compilation, i.e., after the Twin CAT objects are created. For example, an m-file My Callback.m can be created in the workspace with the following content: function My Callback(obj) … return The Post Publish Callback Fcn property is then set to “My Callback”. By default, the Project Exporter object [} 39] is passed to the function, so that you have access to all data of the current project in the callback function. Project. Oem Id and Project. Oem Licenses TE1401 Version: 1.3.0 37

## Page 38

Settings of the Twin CAT module generator Optionally, a generated Tc COM or a function block can be linked to an OEM license. This OEM license is checked when starting the object (in addition to the Beckhoff runtime license TC1220 or TC1320) in Twin CAT 3. If no valid license is available, the module does not start up and an error message appears. Instructions for creating and managing OEM certificates can be found under Twin CAT3 > TE1000 XAE > Technologies > Security Management. You can insert your OEM License Check by naming your OEM ID and your license ID or multiple license IDs to be queried. You can find your OEM ID in the Security Management Console (Extended Info activated). The license ID can be viewed by double-clicking on the corresponding license entry in Twin CAT under System > License. Both IDs are also included in the generated License Request File when a Request File is generated with your OEM license. Example entry: export Config. Project. Oem Id = '{ABBAABBA-AFFE-AFFE-AFFE-ABBABBAABBAA}'; export Config. Project. Oem Licenses = '{11111111-0000-FEFE-CCCC-BBBBBBBBBBBB}'; Class Export Cfg Cell array of the added export configurations. Each export configuration, i.e. each converted MATLAB® function or each converted Simulink® model, can be configured individually. Tc Com. Generate If TRUE, a Tc COM object is created that can be used in the Twin CAT XAE. Tc Com. Fp Exceptions For Init Options: Caller Exceptions, Throw Exceptions, Suppress Exceptions, Log Exceptions, Log And Hold, Log And Catch, Log And Dump, Log Hold And Dump, Log Catch And Dump More in Exception handling [} 55]. Tc Com. Fp Exceptions For Update Options: Caller Exceptions, Throw Exceptions, Suppress Exceptions, Log Exceptions, Log And Hold, Log And Catch, Log And Dump, Log Hold And Dump, Log Catch And Dump More in Exception handling [} 55]. Caller Exceptions: The settings of the caller are adopted, e.g. the task, another Tc COM, or the PLC. Tc Com. Execution Info Output If TRUE, another output is created at the Tc COM with information in case of occurring exceptions. More in Exception handling [} 55]. Tc Com. Online Change If TRUE, the Tc COM can be replaced by Online Change while Twin CAT XAR is in Run mode. See also Online Change for Target for Simulink®. Tc Com. Tc Com Wrapper Fb If TRUE, a Tc COM-Wrapper-FB is created in the generated PLC library. Tc Com. Tc Com Wrapper Fb Properties If TRUE, properties for module parameters are created at Tc COM-Wrapper-FB. Tc Com. Tc Com Wrapper Fb Property Monitoring Options: No Monitoring, Cyclic Update, Execution Update Specifies the monitoring attribute of the properties. In the default case, “No Monitoring” is set, i.e. no attribute is set. 38 Version: 1.3.0 TE1401

## Page 39

Settings of the Twin CAT module generator Setting in MATLAB Attribute on property Execution Update {attribute 'monitoring' := 'variable'} Cyclic Update {attribute 'monitoring' := 'call'} Plc Fb. Generate If TRUE, a function block is created in the PLC library that can be used in the Twin CAT XAE. Plc Fb. Fp Exceptions For Init Floating Point Exceptions within the function block during the init stage can be set. Options: Caller Exceptions, Throw Exceptions, Suppress Exceptions, Log Exceptions, Log And Hold, Log And Catch, Log And Dump, Log Hold And Dump, Log Catch And Dump More in Exception handling [} 55]. Plc Fb. Fp Exceptions For Update Floating Point Exceptions within the function block during the update stage can be set. Options: Caller Exceptions, Throw Exceptions, Suppress Exceptions, Log Exceptions, Log And Hold, Log And Catch, Log And Dump, Log Hold And Dump, Log Catch And Dump More in Exception handling [} 55]. Creating and loading an export configuration When using the Twin CAT Target for MATLAB®, the MATLAB® Coder™ is first used to generate C++ sources. These C++ sources can then be combined into an export configuration in the Twin CAT module generator by: Twin CAT. Module Generator. Matlab. Function Export Config('MFile',Name,'Build Dir',cpp Dir) The path to the C++ sources created by the MATLAB® Coder™ is passed as properties with 'Build Dir' and the name of the MATLAB® function is passed with 'MFile'. If, for example, Base Statistics is selected as the name, the Tc COM object will have this name and the function block in the PLC will be given the name FB_Base Statistics. If the Twin CAT Target for Simulink® is used, the approach is somewhat different. Start the build process from Simulink® with the "Run the publish step after project generation" option disabled. Then load the created <modelname>_tcgrt folder as follows in order to add the C++ sources of the Simulink® model to the project export configuration. Twin CAT. Module Generator. Project Export Config. Load(<modelname>_tcgrt); Creating Twin CAT objects with the Module Generator Twin CAT. Module Generator. Project Exporter() Twin CAT. Module Generator. Project Exporter() triggers the build process for the platforms set in the Project property. The object of the class Twin CAT. Module Generator. Project Export Config is passed as argument. This creates a folder on the local file system in the repository and stores the created drivers and description files. Example call: proj Exporter = Twin CAT. Module Generator. Project Exporter(export Config); 7.1 Creating TMX archives In order to be able to work with the created Twin CAT objects (Tc COM and PLC library) in Twin CAT XAE, they must be available in the repository folder on the local engineering PC and the PLC library must be installed in the local PLC Library Repository For example the Simple Temp Ctrl in version 0.0.0.2 is located here: TE1401 Version: 1.3.0 39

## Page 40

Settings of the Twin CAT module generator Manual copying to engineering PCs is error-prone. It is therefore easier to create a so-called TMX archive. The TMX archive is an archive of a newly created project, for example the Simple Temp Ctrl in version 0.0.0.2. Only the archive has to be copied to an engineering PC and executed. It is a self-extracting archive, which then automatically copies all files to the correct location. You can specify the path and name of the TMX archive under TC Build to have it created with the next build. To do this, use the Project property of the module generator: Project. Tmx Archive = "c:\archives\[Date]-[Time]-[Lib Name][Lib Version].exe" You can also use placeholders for the path and name as shown in the sample above. Result of this setting is e.g. a TMX archive 2021-11-04-172921-Simple Temp Ctrl0.0.0.3.exe (new build, therefore revision incremented). You can then copy the TMX archive to any path on an engineering PC and execute it. This will copy the files in the archive to the correct location in your repository. You can also use the Command prompt, for example, and use other options: For example, the <tmxarchive>.exe /plclib:install command creates (from the *.tml file) and installs the PLC library on your local engineering PC. 40 Version: 1.3.0 TE1401

## Page 41

Application of modules in Twin CAT 8 Application of modules in Twin CAT 8.1 Working with the Tc COM module Using Tc COM objects in Twin CAT 3 1. Insert a new Tc COM object. 2. Select the corresponding Tc COM object: 3. Create a new cyclic task of type Twin CAT Task. TE1401 Version: 1.3.0 41

## Page 42

Application of modules in Twin CAT 4. Assign the newly created task to the newly created Tc COM object. To do this, go to the instance of the Tc COM object and select the Context tab. ð You can now activate the configuration. In order to connect the Tc COM object with other modules in your Twin CAT solution beforehand, you can use the process image to create mappings. You can view the MATLAB® code on the Block Diagram tab and observe and scope values on the fly. See MATLAB code representation [} 43]. You can also call the Tc COM object from the PLC via the Tc COM wrapper FB or even instantiate it dynamically. For more, see: Calling a Tc COM object from the PLC [} 51]. Besides working with a Tc COM object, you can also use the functions created in MATLAB® directly as a PLC function block (PLC-FB) without having to worry about a Tc COM object. See: Working with the PLC library [} 46]. 42 Version: 1.3.0 TE1401

## Page 43

Application of modules in Twin CAT 8.1.1 MATLAB code representation 8.1.1.1 MATLAB®-Tc COM If a Twin CAT object was created with the Twin CAT Target for MATLAB® and the MATLAB® code export was executed, the MATLAB® code of the MATLAB® function can be displayed as a control in Twin CAT XAE. 8.1.1.1.1 Operation of the block diagram window The export of the MATLAB® code can be configured during generation of a Tc COM module from MATLAB®. If the export was enabled, the code can be found in the Twin CAT development environment under the Block Diagram tab of the module instance. On the top level you will find the created module in block representation. Select the gray arrow in the block to display the content. TE1401 Version: 1.3.0 43

## Page 44

Application of modules in Twin CAT Shortcut functions: Shortcut Function Space Zoom to current size of the block diagram tab Backspace Switch to the next higher hierarchical level ESC Switch to the next higher hierarchical level CTRL + "+" Zoom in CTRL + "-" Zoom out F5 Attach Debugger (System- > Real-Time -> C++ Debugger -> Enable C++ Debugger must be activated) Context menu functions: 8.1.1.1.2 Display of signal curves Selected variables can be retrieved in Twin CAT XAE via ADS. It is therefore possible to display them in a mini-scope within the block diagram, or with the Twin CAT Scope within a measurement project. Variables that can be displayed in scope have a trailing black frame in the code display. In this frame, the values are displayed in blue during operation. Drag&Drop a "blue variable" onto the block diagram window to open a Mini. Scope. 44 Version: 1.3.0 TE1401

## Page 45

Application of modules in Twin CAT By dragging and dropping a "blue variable" onto the Axis Group of a chart in the Twin CAT Measurement project, the variables are added to the Twin CAT Scope. Which variables are visible as "blue variables" in Twin CAT XAE? • The input variables • The output variables • Persistent variables (MATLAB definition persistent var1 … var N) TE1401 Version: 1.3.0 45

## Page 46

Application of modules in Twin CAT 8.2 Working with the PLC library Use PLC library in Twin CAT 3 ü Starting from a new Twin CAT solution, create a PLC project: 1. Perform the following menu steps. 46 Version: 1.3.0 TE1401

## Page 47

Application of modules in Twin CAT 2. Then add the newly created (and already installed) PLC library: TE1401 Version: 1.3.0 47

## Page 48

Application of modules in Twin CAT 48 Version: 1.3.0 TE1401

## Page 49

Application of modules in Twin CAT 3. Get an overview of the data types and function blocks: TE1401 Version: 1.3.0 49

## Page 50

Application of modules in Twin CAT 4. Insert instances of the function blocks into your PLC and use them in your application: 8.2.1 Online change of the PLC library While Twin CAT is in run mode, you can exchange the PLC library version in Twin CAT XAE and load it into the running application via Online Change. This means that all function blocks in a PLC library can be updated without a Twin CAT restart. Step-by-step procedure: 50 Version: 1.3.0 TE1401

## Page 51

Application of modules in Twin CAT 1. Create a first PLC library version with the Twin CAT Target for MATLAB®. 2. Include this PLC library version in a PLC project. 3. Activate your Twin CAT configuration with the first PLC library version (e.g. version 0.0.0.1). 4. Adapt your MATLAB function(s) and create a PLC library version (0.0.0.2) from it. 5. Select the newly created PLC library version in Twin CAT - PLC - References (you may have to install the new library on the XAE system). 6. Select Build > Build Solution to rebuild the project. 7. Select Login > Login with online change (more information in the PLC documentation). 8.2.2 Calling a Tc COM object from the PLC Creating a Tc COM wrapper FB Set in the export configuration: Tc Com. Tc Com Wrapper Fb = 'true'; Tc Com. Tc Com Wrapper Fb Properties = 'true'; % optional Create instance of the Tc COM Wrapper function block 1. Create a PLC project. 2. Add the desired library under References. ð Under Pous/Tc COM Wrapper you get a function block that you can instantiate in the PLC. In addition, necessary data types are created in the Duts folder. TE1401 Version: 1.3.0 51

## Page 52

Application of modules in Twin CAT Version 1: referencing a static module instance The function block can be used to access module instances previously created in the XAE, e.g. under System > Tc COM Objects. For this static case, the object ID of the corresponding module instance must be transferred during declaration of the function block instance. • The instance of the Tc COM object and the calling PLC must run in the same task. • On the instance of the Tc COM object, make sure that under Parameter (Init) the entry Module Caller is set to Module and not to Cyclic Task. • In this case, the required memory for the Tc COM is obtained from the non paged pool of the system. Declaration // link wrapper with a static instance Init Str Static : ST_FB_Temp Ctrl_Tc COM_Init Struct := (noid := 16#01010010); // OID from object1 in System > Tc COM Objects fb Temp Ctr Static : FB_Temp Ctrl_Tc COM_Init Struct(Init Str Static); Inputs : ST_Temp Ctrl_U_T; // data type defined in Temp Ctrl library Outputs : ST_Temp Ctrl_Y_T; Execution code fb Temp Ctr Static(st Temp Ctrl_U := Inputs, st Temp Ctrl_Y => Outputs); Version 2: dynamic instantiation and referencing from the PLC The function block can also be used in such a way that a Tc COM object is generated from the PLC and linked to the wrapper. • The Task Oid of the PLC task must be used to specify the real-time task in which the wrapper is called. • The Module Caller must also be set to Module here (via the Init structure). • In this case, the required memory for the Tc COM is obtained from the router memory. Declaration // dynamic instance: create Tc COM from PLC Init Str Dyn : ST_FB_Temp Ctrl_Tc COM_Init Struct := ( n Task Oid := 16#02010030, // take Task OID of Plc Task e Module Caller := E_Module Caller. Module ); // set module caller to "ca ll by module" fb Temp Ctr Dyn : FB_Temp Ctrl_Tc COM_Init Struct(Init Str Dyn); Outputs Dyn : ST_Temp Ctrl_Y_T; Execution code fb Temp Ctr Dyn(st Temp Ctrl_U := Inputs, st Temp Ctrl_Y => Outputs Dyn); The source code for the graph shown above is available in MATLAB® via the Command Window Twin CAT. Module Generator. Samples. Start("Tc COM Wrapper Function Blocks") 8.3 Debugging The following step-by-step instructions apply to the use of both Tc COM objects and function blocks created using the Target for MATLAB®. The following shows the debugging for a PLC function block. ü Step-by-step procedure: 1. Make sure that your Twin CAT application has been activated with the C++ debugger enabled. 52 Version: 1.3.0 TE1401

## Page 53

Application of modules in Twin CAT 2. Open the Twin CAT C++ project created during code generation that belongs to the module you want to debug. ð You specified the project location when initializing the project export configuration, see Generated Code TE1401 [} 33]. ð You can open the Visual Studio project directly or add it to your Twin CAT solution under C++ with “Add existing Item”. 3. In the MATLAB® folder in the Visual Studio solution, view the subfolders that bear the name of the MATLAB® function created. ð In the Sources sub-folder, you can find the executed code generated by MATLAB® Coder™. TE1401 Version: 1.3.0 53

## Page 54

Application of modules in Twin CAT 4. Select Debug > Attach to Process in the menu bar, select “Twin CAT XAE” as the Connection Type, and the desired target system under Connection target. Then select Attach. 54 Version: 1.3.0 TE1401

## Page 55

Application of modules in Twin CAT 5. Set breakpoints in your C++ code and step through your code as usual. 8.4 Exception handling When processing the C++ code autogenerated from MATLAB® or Simulink® in Twin CAT, floating point exceptions can occur at runtime, for example if an unexpected value is passed into a function during programming. The handling of such exceptions is described below. What is a floating point exception? A floating point exception occurs when an arithmetically not exactly executable operation is instructed in the floating point unit of the CPU. IEEE 754 defines these cases: inexact, underflow, overflow, divide-by-zero, invalid-operation. If one of these cases occurs, a status flag is set, which indicates that the arithmetic operation cannot be executed exactly. It is further defined that each arithmetic operation must return a result – one that in the majority of cases leads to the possibility of ignoring the exception. For example, a division by zero results in +inf or -inf. If a value is divided by inf in the further code, this results in zero, so that no consequential problems are to be expected. However, if inf is multiplied or other arithmetic operations are performed with inf, these are invalid operations, whose result is represented as a Not-a-Number (Na N). How does the Twin CAT Runtime react in case of exceptions? Twin CAT C++ Debugger not active The following explanations only apply if the C++ debugger is not activated on the Twin CAT runtime system. When the C++ debugger is enabled, exceptions are caught by the debugger and can be handled, see Debugging. Default behavior Default setting in Twin CAT is that at "divide-by-zero" and "invalid-operation" the execution of the program is stopped and Twin CAT issues an error message. TE1401 Version: 1.3.0 55

## Page 56

Application of modules in Twin CAT Task setting: Floating Point Exceptions This default setting can be changed on the level of each Twin CAT task. If the checkbox "Floating Point Exception" is unchecked, an exception does not lead to a Twin CAT stop and no error message is issued. This setting is then valid for all objects that are called by this task. As a consequence, care must be taken in the application that Na N and inf values are handled accordingly in the program code. Check for Na N and Inf If, for example, a Na N is passed on via mapping to a Twin CAT object that has activated floating point exceptions, an arithmetic operation with Na N naturally leads to an exception in this object and subsequently to a Twin CAT stop. Therefore, Na N or inf must be checked directly after mapping. In the PLC, corresponding functions are available in the Tc2_Utilities library, e.g. Lreal Is Na N. Try-Catch statement Another way to handle exceptions is to embed them in a try-catch statement. In the PLC the instructions __TRY, __CATCH, __FINALLY, __ENDTRY are available for this purpose. If floating point exceptions are enabled on the calling task and an exception occurs within the Try-Catch, it is caught in the Catch branch and can be handled. Accordingly, no variables are set to inf or Na N in this approach. However, it is also important to note that the code in the Try branch is run through only up to the point of the exception and then a jump is made to the Catch branch. In the application code, it should be noted that internal states in the Try branch may not be consistent. Dump Files From Twin CAT 3.1.4024.22 (XAR), dump files can be created at runtime in case of exceptions in the Tc COM object. Specification of the behavior in case of exceptions on object level In addition to the possibility of influencing the behavior in the event of exceptions at task level, the behavior can also be specified at the level of a Twin CAT object, i.e. the generated Tc COM or the generated PLC function block. On the object level, a wealth of possibilities can be realized with the Twin CAT Target for Simulink®. Basically, however, all the options presented below are based on the above principles. Optional Execution Info Output If exceptions are handled at object level, it makes sense to make corresponding information about occurred exceptions accessible at the object output. This output can be used to query whether an exception has occurred, what kind of exception it was, whether a dump file has been written, etc. For the Tc COM object you can activate an additional output "Execution Info [} 36]": export Config. Class Export Cfg{n Module Count}. Tc Com. Execution Info Output = true; Execution Info Output for PLC-FB Currently the Execution Info is only available for the Tc COM object. If you want to call the code from the PLC, use the Tc COM-Wrapper-FB. The Execution Info output is a structure with the following entries: Excecution Info structure Entry Data type Meaning Cycle Count ULINT Current cycle count (independent of an exception) Exception Count ULINT Number of exceptions that have occurred so far Act Exception Tc Mg Sdk. Exception Info More detailed explanation of the current exception (only first exception in the current cycle) 56 Version: 1.3.0 TE1401

## Page 57

Application of modules in Twin CAT Tc Mg Sdk. Exception Info Exception Code DINT Code of the exception, cf. Micro- soft Help Tmx Name STRING(127) Name of the tmx driver that threw the exception. Tmx Version ARRAY[0..3] OF UDINT Version of the tmx driver that threw the exception. Instruction Addr UDINT Relative address in memory; location where the exception occurred. Return Addr ARRAY[0..3] OF UDINT Return addresses Dump Created BOOLEAN TRUE if a dump file was created for the exception. With the Instruction Addr it is possible to judge if the exception with the given Exception Code always occurs at the same place in the source code. If the Instruction Addr is the same for repeating exceptions, it always occurs at the same point in the code. Via Return Addr you can see where the calls came from that led to the location of the exception. So you can judge if the call that leads to the exception always takes the same call path. If the code is called from outside the Tmx driver, there is a 0 in the Return Addr. Definition of the object behavior in case of occurring exceptions The behavior of a Tc COM object in case of exceptions can be set separately for the initialization phase and for the update phase under the properties of the class Twin CAT. Module Generator. Project Export Config: export Config. Class Export Cfg{ n Module Count }. Tc Com. Update Exception Handling = 'Caller Exceptions'; export Config. Class Export Cfg{ n Module Count }. Tc Com. Init Exception Handling = 'Caller Exceptions'; Options are: Caller Exceptions, Throw Exceptions, Suppress Exceptions, Log Exceptions, Log And Hold, Log And Catch, Log And Dump, Log Hold And Dump, Log Catch And Dump. If you are working with an already compiled Tc COM in Twin CAT, you can also change the settings on the object instance afterwards. To do this, use the tab Parameters (Init) and select Show hidden Parameters. The settings for the PLC-FB FB_<Model Name> in the PLC library are independent of the settings for the Tc COM object. export Config. Class Export Cfg{n Module Count}. Plc Fb. Update Exception Handling export Config. Class Export Cfg{n Module Count}. Plc Fb. Init Exception Handling Note that the other PLC function block (FB_<Model Name>_Tc COM) is a wrapper for a Tc COM object [} 51] and therefore the exception settings from the Tc COM section are valid when it is used. A total of 9 different settings are available. TE1401 Version: 1.3.0 57

## Page 58

Application of modules in Twin CAT A total of 9 different settings are available. • Caller Exceptions (default): Exceptions are thrown as configured at the calling task. • Throw Exceptions: Exceptions in the Twin CAT object are thrown in any case, regardless of how the task is configured. ◦ An exception causes a Twin CAT error message and a Twin CAT stop • Suppress Exceptions: Exceptions are not thrown, regardless of how the task is configured. ◦ An exception does not cause a Twin CAT stop. ◦ Outputs or internal states can be Na N or inf. • Log Exceptions: Exceptions are thrown, but do not lead to a Twin CAT stop. ◦ An exception does not cause a Twin CAT stop. ◦ Outputs or internal states can be Na N or inf. ◦ The Execution Info output is filled with information about an exception in the current cycle. If several exceptions occur in one cycle, only the first exception is displayed at the output. When the Twin CAT object is called again, the information is reset. • Log And Hold: Exceptions are thrown. The execution of the Twin CAT object is stopped. ◦ An exception does not cause a Twin CAT stop. ◦ Outputs or internal states can be Na N or inf. ◦ The Execution Info output is filled with information about an exception in the current cycle. If several exceptions occur in one cycle, only the first exception is displayed at the output. When the Twin CAT object is called again, the information is reset. ◦ The execution of the Twin CAT object is stopped after an exception occurs. Twin CAT itself remains in run mode. Restart execution: . • Log And Catch: Exceptions are caught with try-catch in the Twin CAT object. The execution of the Twin CAT object is stopped. ◦ An exception does not cause a Twin CAT stop. ◦ Outputs or internal states cannot contain Na N or inf. ◦ The Execution Info output is filled with information about an exception in the current cycle. ◦ The execution of the code ends at the point of the exception. From there, the program jumps to the catch junction, i.e. internal states can be inconsistent. ◦ The execution of the Twin CAT object is stopped after an exception occurs. Twin CAT itself remains in run mode. Restart execution: . • Log And Dump, Log Hold And Dump and Log Catch And Dump ◦ Behavior like Log Exceptions ◦ Additionally a dump file is stored on the runtime system in the Twin CAT folder Boot. For more on dump files, see here [} 61]. Handle execution stop of a Twin CAT object Log And Hold and Log Hold And Dump In the event of an exception, execution of the code in the Tc COM object concerned is stopped by setting the Execute parameter to FALSE. The parameter can be read or written from the XAE and via ADS. In the XAE, you can display and change the online values of the Tc COM object under Parameters (Init). 58 Version: 1.3.0 TE1401

## Page 59

Application of modules in Twin CAT In the block diagram the parameter is offered to you under Module parameters. TE1401 Version: 1.3.0 59

## Page 60

Application of modules in Twin CAT If you move the mouse over the Execute name in the change dialog, you will be shown the ADS address of the parameter, as with all other parameters. This allows you to set the parameter also by ADS. By right-clicking on the name Execute you can also save the ADS symbol information to the clipboard. This also applies to all other parameters. 60 Version: 1.3.0 TE1401

## Page 61

Application of modules in Twin CAT Log And Catch and Log Catch And Dump In addition to the parameter Execute, the online parameter Initialized also changes to FALSE in the case of Log And Catch and Log Catch And Dump. The module must be reinitialized before the module can perform a calculation again. This is necessary because internal states can no longer be consistent. Reinitialization can only be performed by returning the Tc COM object to the "Init" state and moving it to OP again. At runtime, only Tc COM objects that have no mappings can be shut down, otherwise active mappings would block the shutdown. A new initialization is only possible by restarting the entire Twin CAT Runtime. A more flexible alternative is to use the Tc COM-Wrapper-FB [} 51] in the PLC. This can be used to call the Tc COM from the PLC and does not require any mappings to access its inputs and outputs. Accordingly, the Tc COM object can also be reinitialized during runtime. PROGRAM MAIN VAR st Init Temp : ST_FB_Simple Temp Ctrl_Tc COM_Init Struct := (n Oid := 16#01010010); fb Temp Ctr : FB_Simple Temp Ctrl_Tc COM_Init Struct(st Init Temp); Inputs : ST_Ext U_Simple Temp Ctrl_T; Outputs : ST_Ext Y_Simple Temp Ctrl_T; Execution Out : ST_Execution Info2; END_VAR // check if Tc COM is in OP mode and all set IF fb Temp Ctr.b Execute = TRUE AND fb Temp Ctr.b Initialized = TRUE AND fb Temp Ctr.n Object State = TCOM_STA TE. TCOM_STATE_OP THEN // call the module fb Temp Ctr(st Simple Temp Ctrl_U := Inputs, st Simple Temp Ctrl_Y => Outputs, st Execution Info => Execut ion Out); // handle exceptions IF Execution Out. Act Exception. Exception Code <> 0 THEN // collect exception information (* ...... *) // reinit Tc COM fb Temp Ctr. Reinit(st Re Init := st Init Temp); END_IF END_IF Note that the Re Init method is executed synchronously, i.e. depending on the cycle time and the time required to reinitialize, cycle overruns may occur. Dump files Writing the dump file may take a few cycles. It is best to use a separate task for the Tc COM object or the PLC-FB in question that does not block any important tasks. Dump files are only written with a Twin CAT XAR version >= 3.1.4024.22, otherwise you get a corresponding warning. In the case of Log And Dump the execution of the code is continued cyclically after the occurrence of an exception, accordingly exceptions can occur cyclically which could lead to persistent cycle timeouts. Therefore, the online value of the parameter Update Exception Handling is set to Log Exceptions after the dump file has been written, i.e. the writing of dump files is deactivated, but can subsequently be switched on again, e.g. by ADS or intervention via the XAE under parameter (Init). TE1401 Version: 1.3.0 61

## Page 62

Application of modules in Twin CAT The created dump file is stored on the runtime PC in the boot folder and can be copied from there to another PC for analysis. If you use a Twin CAT version lower than 3.1.4024.x you can open the dump files with Win Dbg and start your analysis. 8.5 Using Realtime Monitor time stamps MATLAB® commands, such as tic and toc, are popular ways to analyze the performance of code sections in MATLAB®. These commands are not usable in this form during Twin CAT runtime. For this purpose, Twin CAT provides the Twin CAT Realtime Monitor, which evaluates time stamps in the source code and displays them for analysis. Setting Realtime Monitor time stamps is supported in MATLAB® code, i.e. the time stamps are set in MATLAB® and can be evaluated by the Realtime Monitor after code generation and instantiation in Twin CAT. Running time stamps in MATLAB® results in output to the MATLAB® console. Class: Twin CAT. Module Generator. Realtime. Log Mark Methods: Start, Stop and Mark MATLAB® documentation: doc("Twin CAT. Module Generator. Realtime. Log Mark") Example in MATLAB® Twin CAT. Module Generator. Samples. Start("Base Statistics Log Mark") 62 Version: 1.3.0 TE1401

## Page 63

FAQ 9 FAQ 9.1 Build of a sample fails All samples supplied (list by Twin CAT. Module Generator. Samples. List in the MATLAB® Command Window) have been checked by tests at Beckhoff Automation. If a build of a sample still does not run successfully, it is likely that something needs to be adjusted during setup on your engineering PC. ü To test the platform toolset without the influence of MATLAB® please create a Twin CAT Versioned C++ project in Twin CAT (open Twin CAT in Visual Studio) . 1. Right-click Add New Item on C++ Tree Item. 2. Then select Twin CAT Module Class with Cyclic Caller. ð A C++ project appears in the Twin CAT Tree under C++. 3. Build the C++ project and view the Output Window in Twin CAT. ð The output window should return "1 succeeded" for the build process. If this is not the case, check whether you have installed the Desktop development with C++ option in Visual Studio. 9.2 Are there limitations with regard to executing modules in real-time? Not all access operations possible in MATLAB® under non-real-time conditions can be performed in the Twin CAT real-time environment. Known limitations are described below. • Direct file access:: Access to the IPC file system is restricted within the Twin CAT runtime. To read and write files from Twin CAT, use: fopen, fclose, fread and fwrite. See the example: Twin CAT. Module Generator. Samples. Show('File Access'). • Direct hardware access: Direct access to devices/interfaces requires a corresponding driver, e.g. RS232, USB, network interface card, etc. It is not possible to access the device drivers of the operating system from the real-time context. However, Twin CAT offers a wide range of communication options for linking external devices, see Twin CAT 3 Connectivity TF6xxx. • Access to the operating system API: The operating system’s API cannot be used directly from within the Twin CAT runtime. An example is the integration of windows.h in C/C++ code. • Precompiled libraries: During code generation by the MATLAB® Coder™, it is possible that no platform-independent C/C++ code is generated, but precompiled libraries are included. Real-time execution in Twin CAT is not possible in these cases. The coder. Hardware Implementation setting helps determine if generic C/C++ code can be generated. For example TE1401 Version: 1.3.0 63

## Page 64

FAQ coder. Hardware Implementation. Prod HWDevice Type = 'Generic->32-bit x86 compatible'; and coder. Hardware Implementation. Target HWDevice Type = 'Generic- >32-bit x86 compatible'; 64 Version: 1.3.0 TE1401

## Page 65

Samples 10 Samples Samples provided by Beckhoff Automation are installed on your system with the Twin CAT Tools for MATLAB and Simulink setup. You can use the following command to display all available samples: Twin CAT. Module Generator. Samples. List You can access the samples by clicking on the blue Start link. To do this, the sample code is copied to your user directory so that you do not change the original sample. You can work with the copy of the sample accordingly and try it out. Also available are Twin CAT. Module Generator. Samples. Show(Sample Name) Twin CAT. Module Generator. Samples. Start(Sample Name) For displaying and starting individual samples. The argument Sample Name is to be passed as a string, e.g. Twin CAT. Module Generator. Samples. Start('Base Statistics') 10.1 Twin CAT Automation Interface: use in MATLAB® Short description of the Automation Interface Twin CAT XAE configurations can be automatically generated and edited via programming/script codes using the Twin CAT Automation Interface. The automation of a Twin CAT configuration is available thanks to so- called Automation Interfaces, which can be accessed via all COM-capable programming languages (e.g. C+ + or . NET) and also via dynamic script languages such as Windows Power Shell, Iron Python or even the (obsolete) Vbscript. Use from the MATLAB® environment is also possible. Detailed documentation of the product can be found here: Twin CAT Automation Interface Use in MATLAB® TE1401 Version: 1.3.0 65

## Page 66

Samples The Automation Interface can be made visible in MATLAB® through the command NET.add Assembly. This will enable you to use the interfaces (Automation Interface API) described in the product documentation. You can also find many programming samples for use from C# and Power Shell (Automation Interface Configuration). In order to simplify the entry from MATLAB® for you, you can find below a sample implementation for MATLAB® on the basis of a MATLAB® class, which you can use, modify and expand. 10.1.1 Sample: Tc3Automation Interface Overview The sample code consists of two m-files: • Tc3Automation Interface.m: MATLAB® class that implements several frequently used methods. • Tc3Automation Interface Guide.mlx: MATLAB live script that calls the MATLAB® class as an example. Call sample with MATLAB® The Twin CAT Tool for MATLAB® and Simulink® Setup installs the sample on your system. Call the sample with the MATLAB® Command Window: Twin CAT. Module Generator. Samples. Start('Automation Interface'). The MATLAB® script The MATLAB® script provides a sample of how you can generate a Twin CAT solution, scan the Ether CAT master for I/Os, instantiate two Tc COM modules, link them and activate the project on a target. In order to be able to run the script, the two Tc COMs used must be present in your publish directory %Twin CATDir%\\Custom Config\Modules\. For this, download the Temperature Controller sample from the TE1400 | Target for MATLAB®/Simulink®. Then copy the file folder from the directory . \TE1400Sample_Temperature Controller\_Precompiled Tc Com Modules\Actual Twin CAT versions\ into the publish directory. Run the m-file Tc3Automation Interface_Testbench.m. The latest Visual Studio instance available on your system is opened in the background and the Twin CAT solution is configured, saved and activated. The MATLAB® class The properties All variables and interfaces belonging to the instance of the class are contained in the properties of the Tc3Automation Interface class. Hence, several Twin CAT solutions can be built up in a MATLAB® script by generating an instance of the class for each solution. There are then no overlaps. The constructor function this = Tc3Automation Interface The constructor loads all necessary assemblies and, if successful, sets the Assemblies Loaded property to TRUE. The loaded assemblies are: • Env DTE and Env DTE80: libraries for the Visual Studio Core Automation. Necessary for the configuration of Visual Studio. • TCat Sys Manager Lib: Twin CAT Automation Interface library for the configuration of a Twin CAT solution in Visual Studio. • Twin CAT. Ads: ADS library, e.g. for reading and changing the XAR state. • System. Xml: library for parsing XML files. Selected methods of the class function Tc Com Object = Create Tc COM(this, Modelname) Use the MATLAB® help functions in order to view the function and the parameters of the method. 66 Version: 1.3.0 TE1401

## Page 67

Samples A link to the Beckhoff Infosys is also offered with some methods. These refer to documentation examples from the Twin CAT Automation Interface documentation, so that you can directly view a comparison of the implementation in MATLAB®, C# and Power Shell. You can also find a link to the Beckhoff Infosys in the comment in some sections, allowing you to view the source of the information. The Create Tc COM method initially begins with the parsing of the <modelname>.tmc file, from which the Class ID, the task cycle time and the task priority are extracted with System. Xml. A corresponding Tc COM is then instantiated and one (or more) associated tasks generated with the Automation Interface. Finally, the task is/tasks are assigned to the Tc COM. function Activate On Device(this, Ams Net Id) Twin CAT ADS is used in order to query or change the current status of a Twin CAT runtime, e.g. config or run. In the Activate On Device method the XAR is initially switched to the config mode with the specified Ams Net Id and the current Twin CAT configuration is then activated and the system started. Pauses are entered between the individual steps, as this procedure may need a little time. Static methods Static methods are also available even without an instance of the class. function vs Versions = Get Installed Visual Studios A function that detects and lists the Visual Studio installations available on the system via the Register Key entries is prepared here. The implementation is limited to VS 2010 to VS 2017. Documents about this 2 https://infosys.beckhoff.com/content/1033/te1401_tc3_target_Matlab/Resources/5776206091.zip TE1401 Version: 1.3.0 67

## Page 68

Trademark statements Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements DSP System Toolbox, Embedded Coder, MATLAB, MATLAB Coder, MATLAB Compiler, Math Works, Predictive Maintenance Toolbox, Simscape, Simscape™ Multibody™, Simulink, Simulink Coder, Stateflow and Thing Speak are registered trademarks of The Math Works, Inc. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.

## Page 69

More Information: www.beckhoff.com/te1401 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
