---
title: "TF6600_TC3_RFID_Reader_Communication_EN"
product: "TF6600"
category: "Communication"
tags: ["COMMUNICATION", "READER", "RFID"]
language: "EN"
document_type: "Manual"
version: "1.4.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6600_TC3_RFID_Reader_Communication_EN.pdf"
release_date: "2025-10-13"
---
Manual | EN TF6600 Twin CAT 3 | RFID Reader Communication 2025-10-13 | Version: 1.4.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation......................................................................................................................................... 9 3.3 Installation Twin CAT 3.1 Build 4026............................................................................................... 12 3.4 Licensing......................................................................................................................................... 12 4 Technical introduction............................................................................................................................ 15 4.1 RFID reader hardware.................................................................................................................... 15 4.2 RFID reader connection.................................................................................................................. 19 4.3 RFID command set......................................................................................................................... 21 5 Configuration........................................................................................................................................... 26 5.1 RFID reader settings and handling................................................................................................. 26 5.1.1 Balluff............................................................................................................................... 26 5.1.2 Baltech............................................................................................................................. 27 5.1.3 Deister electronic............................................................................................................. 29 5.1.4 Leuze electronic............................................................................................................... 30 5.1.5 Pepperl-Fuchs.................................................................................................................. 31 6 PLC API.................................................................................................................................................... 34 6.1 Function block................................................................................................................................. 34 6.1.1 FB_RFIDReader.............................................................................................................. 34 6.1.2 Handling instructions........................................................................................................ 38 6.1.3 Configuration.................................................................................................................... 39 6.1.4 Low level communication................................................................................................. 40 6.2 Data types....................................................................................................................................... 41 6.2.1 Structures......................................................................................................................... 41 6.2.2 Enumerations................................................................................................................... 62 6.2.3 T_RFID_Transp SRN........................................................................................................ 66 6.3 Global Constants............................................................................................................................. 66 6.3.1 Global_version................................................................................................................. 66 7 Examples................................................................................................................................................. 67 7.1 Tutorial............................................................................................................................................ 67 7.1.1 Glossary........................................................................................................................... 68 7.1.2 Installation/libraries.......................................................................................................... 68 7.1.3 Serial connection.............................................................................................................. 68 7.1.4 Function block declaration............................................................................................... 69 7.1.5 Using the function block................................................................................................... 69 7.1.6 Test.................................................................................................................................. 70 7.2 Sample 1......................................................................................................................................... 71 7.3 Sample 2......................................................................................................................................... 72 TF6600 Version: 1.4.0 3
## Page 4

Table of contents 7.4 Sample 3......................................................................................................................................... 73 8 Appendix.................................................................................................................................................. 75 8.1 RFID error codes............................................................................................................................. 75 9 Support and Service............................................................................................................................... 78 4 Version: 1.4.0 TF6600
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF6600 Version: 1.4.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.4.0 TF6600
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF6600 Version: 1.4.0 7
## Page 8

Overview 2 Overview The Twin CAT 3 RFID Reader Communication library makes communication with RFID readers from the PLC program possible. RFID readers can be read-only or read/write devices. The Twin CAT RFID library facilitates implementation of a wide range of applications using different RFID reader functions. The implementation expenditure is very low, because no manufacturer-specific interface protocol needs to be investigated in detail and implemented. The library automatically deals with frame configuration, telegram composition, command designation, telegram recognition and some other protocol characteristics. The following figure illustrates an RFID reader application. Handling of the library is the same for all supported RFID reader models. In the event of a change of manufacturer, only minor changes to the application are required. An overview of the supported RFID reader models can be found in the section Technical introduction > RFID reader hardware [} 15]. Supported models include devices from manufacturers such as Balluff, Baltech, Deister electronic, Leuze electronic and Pepperl+Fuchs. The Compact RFID reader is optionally available for Beckhoff multi-touch control panels. In contrast to the other RFID reader models, this one is not addressed from Twin CAT using the TF6600 RFID Reader Communication, but only using the TF6340 Serial Communication. A product description of the Compact RFID Reader and a PLC example showing communication with this device can be found in the Online Information System in the section Industrial PC > Compact RFID Reader. 8 Version: 1.4.0 TF6600
## Page 9

Installation 3 Installation 3.1 System requirements Technical data Description Operating system Win10, Win11 Target platform PC or CX (x86, x64, Arm®): WES, Win10, Win11 TC/BSD, Beckhoff RT Linux® Minimum platform level P 20 P 30 for connection via USB / Virtual Com Port Minimum Twin CAT version Twin CAT 3.1.4013 or higher Required Twin CAT setup level Twin CAT XAE Twin CAT 3 PLC Required Twin CAT license TF6600 |Twin CAT 3 RFID Reader Communication Twin CAT PLC library to be integrated Tc2_RFID Tc2_Serial Com Depending on the RFID reader model, you will need a manufacturer-specific tool (see RFID reader settings and handling [} 26]) for the basic configuration. Also note its system requirements. This presetting can also be performed from another PC. The use of proprietary test tools for the setup is also possible. 3.2 Installation Setup installation (Twin CAT 3.1 Build 4024) The following section describes how to install the Twin CAT 3 function for Windows-based operating systems. ü The Twin CAT 3 function setup file was downloaded from the Beckhoff website. 1. Run the setup file as administrator. To do this, select the Run As Admin command in the context menu of the file. ð The installation dialog opens. TF6600 Version: 1.4.0 9
## Page 10

Installation 2. Accept the end user licensing agreement and click Next. 3. Enter your user data. 10 Version: 1.4.0 TF6600
## Page 11

Installation 4. If you want to install the full version of the Twin CAT 3 function, select Complete as the installation type. If you want to install the Twin CAT 3 function components separately, select Custom. 5. Click Next, then Install to start the installation. ð A dialog box informs you that the Twin CAT system must be stopped to proceed with the installation. TF6600 Version: 1.4.0 11
## Page 12

Installation 6. Confirm the dialog with Yes. 7. Click Finish to exit the setup. ð The Twin CAT 3 function has been installed successfully. 3.3 Installation Twin CAT 3.1 Build 4026 Twin CAT Package Manager: Installation (Twin CAT 3.1 Build 4026) Detailed instructions on installing products can be found in the chapter Installing workloads in the Twin CAT 3.1 Build 4026 installation instructions. Install the following workload to be able to use the product: • TF6600 |Twin CAT 3 RFID Reader Communication 3.4 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). 12 Version: 1.4.0 TF6600
## Page 13

Installation Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. TF6600 Version: 1.4.0 13
## Page 14

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. 14 Version: 1.4.0 TF6600
## Page 15

Technical introduction 4 Technical introduction 4.1 RFID reader hardware General notes • Assembly instructions as well as information on transponder reader handling and reading speeds etc. can be found in the manufacturer's own product manuals. • RFID readers sometimes offer an external trigger or a switching output. This does not have to be used for the functionality of the Twin CAT RFID library. • The Twin CAT RFID library does not cover the complete scope of the manufacturer's own RFID communication protocols. Further information can be found in the description of the instruction set of the library function block (see RFID command set [} 21]). In addition, the integrated option to send and receive raw data can be used (see command e RFC_Send_Raw Data). RFID reader models The Twin CAT RFID library supports different RFID reader models. The following table shows which RFID reader models from which manufacturers are supported. The sample photos illustrate the various RFID reader models. They may differ from the actual models that are listed. Also, not every supported model is illustrated by a photo. In some cases, outdated reader firmware versions are not supported. TF6600 Version: 1.4.0 15
## Page 16

Technical introduction RFID reader manufac- RFID reader model Sample photo turer Balluff BIS M-400-007 (RS232) BIS M-401-007 (RS232) BIS L-6000-007 (2 read heads) (RS232) BIS L-6020-007 (2 read heads) (RS232) Picture credits: BALLUFF Baltech ID-engine SD-M1415-ANT1F (RS232 or USB) ID-engine SD-LP-ANT1F (RS232 or USB) ID-engine PAD M1415 (USB) ID-engine ZM-L2M-U2-A1 (RS232) Deister electronic RDL90 (de Bus) (RS232, RS485) UDL 500 (de Bus) (RS485) PRM5M/2V (de Bus) (RS232, RS485) 16 Version: 1.4.0 TF6600
## Page 17

Technical introduction RFID reader manufac- RFID reader model Sample photo turer Leuze electronic RFM12 (SL200) (RS232) RFM32 (SL200) (RS232) RFM32ex (SL200) (RS232) Pepperl+Fuchs IDENTControl Compact (2 read heads) [ IC- KP2-2HRX-2V1 ] (RS232) IDENTControl (4 read heads) [IC-KP-R2-V1] (RS232) The following table shows which RFID reader models are compatible according to the manufacturer's description and protocol. The compatibility of the listed models as well as other models is, however, not confirmed by Beckhoff. The devices are not officially supported. We recommend contacting Beckhoff Automation before using them. RFID reader manufac- Reader models turer Balluff BIS M-6000 Baltech ID-engine series (BRP) Deister electronic RDL30; RDL150; RDL160; UDL 50; UDL 100; UDL 120; UDL 150; UDL 160; PRM5 Leuze electronic RFM62 (SL200) Pepperl+Fuchs IDENTControl Compact (1 read head) Other models from the above-mentioned manufacturers, which Beckhoff Automation may not be aware of, may be supported implicitly. According to Deister electronic, the same protocol (de Bus) is implemented in other models. It may be the case that some of these models can only be used with limited functionality. Furthermore, some manufacturers offer their own software to make their devices accessible for Beckhoff Twin CAT systems. Twin CAT PLC library "Serial Communication" Further RFID readers are supported with the Twin CAT PLC library "Serial Communication". This library makes it possible to exchange data bytes with any serial device. This alternative to the Twin CAT RFID library can be useful with read-only RFID readers. It may enable unsupported devices to be used with Twin CAT on a Beckhoff controller. If only the serial number of the transponder is required and this is sent autonomously from the RFID device, the effort involved in evaluating the bytes received is manageable. TF6600 Version: 1.4.0 17
## Page 18

Technical introduction Use of the Beckhoff Compact RFID Reader (i DTRONIC) The Beckhoff Compact RFID Reader is a possibility to integrate an RFID device from the manufacturer i DTRONIC in a push button extension for Beckhoff Multitouch Control Panels. Contrary to the integration of Baltech devices in Beckhoff Panels, the PLC library Tc2_Serial Com (TF6340) is used instead of the PLC library Tc2_RFID (TF6600). Transponder types For a complete list of all supported transponder types, please refer to the manual for the respective RFID reader. If necessary, clarify with the manufacturer of the RFID reader or transponder which transponder type is appropriate for the application. The Twin CAT RFID library uses the data obtained from the serial interface. The manufacturer’s serial transmission protocol is therefore decisive for support by the library. The radio frequency used, for example, is irrelevant. The following table indicates which transponder types are supported for the respective RFID reader models according to the manufacturer. This list is not complete. For complete and more detailed information, please contact the manufacturer of the RFID reader model. Please note that some RFID readers only accept transponders with certain manufacturer IDs. Unfortunately, this restriction cannot be influenced. RFID reader model RFID transponder types Balluff M-401 [13.56 MHz] Fujitsu MB89R118; I-Code SLI; Infineon My-D SRF55(1024 Bytes); Mifare Classic (752 Bytes); TI Tag IT HFI (256 Bytes), ... Balluff L-6000 [125k Hz] Baltech ID-engine SD ANT1F (M1415, LP) [13.56 MHz] Infineon My-D, Legic Prime, Mifare Classic, ... Deister electronic RDL90 [13.56 MHz] I-Code SLI; Infineon My-D SRF55(1024 Bytes), ... Deister electronic UDL 500 [868 MHz] EPCclass1gen2 (12 Bytes), ... Deister electronic PRM5 [13.56 MHz] Mifare Classic (752 Bytes), ... Leuze electronic RFM12, RFM32, RFM32ex [13.56 MHz] I-Code SLI; Infineon My-D SRF55(1024 Bytes); TI Tag IT HFI (256 Bytes), ... Pepperl+Fuchs IDENTControl Compact [125 k Hz; 250 k Hz; 13.56 MHz; 2.45 GHz (depends on read head)] I-Code SLI; Fujitsu MB89R118; TI Tag IT HFI; Infineon My-D SRF55, ... These transponder types are additionally available with other memory capacities. Compatibility is hardware- dependent and is not guaranteed. A test is recommended. Special factory programming of the transponders is sometimes possible. This has no effect on the protocol and must therefore be decided on according to the application in consultation with the manufacturer. Specific transponder parameters used in the Twin CAT RFID library can be adapted by the user using a special transponder (see ST_RFID_Access Data [} 50]). The Twin CAT RFID library supports transponders up to a maximum size of 64 kilobytes. Frequency Transponder HF standards range metallic fluid in- data rate radio in- hardware tempera- Types influence fluence teraction position- ture influ- ing ence LF 125-135 k Hz ... ISO 11784/5, < 2m + + + - - + + ++ ISO 14223, ISO 18000-2 HF 13,56 MHz Fujitsu ISO 14443, < 1m + + + + + + + MB89R118, I- ISO 15693, Code SLI, Infineon ISO 18000-3 My-D, Legic, Mifare, TI Tag IT HFI, ... UHF 865-868 EPCclass1gen2, .. ISO 18000-6, < 10m - - + + + + MHz (EU), . EPC-Gen2 902-928 MHz (USA) MW 2.45 GHz ... < 12m - - + + + + - - [++ very good; + good; - bad] 18 Version: 1.4.0 TF6600
## Page 19

Technical introduction 4.2 RFID reader connection All RFID readers supported by this PLC library are connected to the controller via serial communication interfaces (RS 232, RS 422, RS 485 and virtual serial COM ports). The following Beckhoff products can be used for this: • Serial Ether CAT Terminals: EL6001, EL6002, EL6021, ... • Serial K-bus terminals: KL6001/KL6031, KL6021, ... • COM port of any IPC and Embedded PC with Twin CAT system A separate connection must be made to a separate terminal for each RFID reader. The Twin CAT RFID library does not support multiple RFID readers on the same RS485 network for the time being. Setting up serial communication in Twin CAT 3 XAE Serial data exchange is set up with the function blocks of the Twin CAT PLC library Tc2_Serial Com. Create a send buffer and a receive buffer of type "Com Buffer". This can take place globally, but does not have to. In addition, you should create two data structures as they are used for serial communication in the Twin CAT System Manager. If the COM port is used, it looks like this: g Pc Com Rx Buffer : Com Buffer; g Pc Com Tx Buffer : Com Buffer; Pc Com In Data AT %I* : Pc Com In Data; Pc Com Out Data AT %Q* : Pc Com Out Data; When using a serial terminal, EL6in Data22B/EL6out Data22B as well as KL6in Data5B/KL6out Data5B, other data types are possible in addition to Pc Com In Data/Pc Com Out Data. Link the structures in the Twin CAT System Manager to the channels of the serial interface. When using the Com Port, you must additionally activate the Sync Mode option on the IO device in the Twin CAT System Manager. The PLC variables must be assigned to the correct (fast) task in the Twin CAT System Manager and linked appropriately from there. For serial communication, create an instance of the Serial Line Control. This must be called cyclically in a fast task (<= 1 ms). The required task cycle time depends on the application, the data volume, the baud rate and the interface. Depending on the application and interface, it often makes sense to execute this in an additional task that is faster than the application's task. Example 1: When connecting an RFID device to a COM port and a baud rate of 115,200 baud, a cycle time of 1 ms is required. Example 2: When connecting an RFID device to an EL6001 and a baud rate of 9,600 baud, a cycle time of 6 ms max. is required. TF6600 Version: 1.4.0 19
## Page 20

Technical introduction Further information and explanations on the use of virtual COM ports can be found in the documentation for the PLC library "Serial Communication". Exemplary display of the COM port settings in the Twin CAT System Manager: The call of the Serial Line Control is represented by way of example below. Call as Structured Text in the case of use of the COM port: Line Control( Mode := SERIALLINEMODE_PC_COM_PORT, p Com In := ADR(Pc Com In Data), p Com Out := ADR(Pc Com Out Data), Size Com In := SIZEOF(Pc Com In Data), Tx Buffer := g Pc Com Tx Buffer, Rx Buffer := g Pc Com Rx Buffer ); Call as Structured Text in the case of use of an Ether CAT terminal: Line Control( Mode := SERIALLINEMODE_EL6_22B, p Com In := ADR(EL6Com In Data), p Com Out := ADR(EL6Com Out Data), Size Com In := SIZEOF(EL6Com In Data), Tx Buffer := g EL6Com Tx Buffer, Rx Buffer := g EL6Com Rx Buffer ); Call as Structured Text in the case of use of a K-bus terminal: KL6Config3( Execute := b Config3, Mode := SERIALLINEMODE_KL6_5B_STANDARD, Baudrate := 9600, No Databits := 8, Parity := 0, Stopbits := 1, Handshake := RS485_FULLDUPLEX, Continous Mode := FALSE, p Com In := ADR(Kl Com In Data3), p Com Out := ADR(Kl Com Out Data3), Size Com In := SIZEOF(Kl Com In Data3), Busy => b Config3Act, Done => b Config3Done, Error => b Config3Error ); IF NOT KL6Config3. Busy THEN b Config3 := FALSE; Line Control3( Mode := SERIALLINEMODE_KL6_5B_STANDARD, p Com In := ADR(Kl Com In Data3), p Com Out := ADR(Kl Com Out Data3), Size Com In := SIZEOF(Kl Com In Data3), Tx Buffer := g Kl Com Tx Buffer3, 20 Version: 1.4.0 TF6600
## Page 21

Technical introduction Rx Buffer := g Kl Com Rx Buffer3 ); END_IF 4.3 RFID command set The following matrix lists the available RFID instruction set. Because of the fundamental differences between the various RFID reader models, not all instructions can be made available with each model. The complexity of some proprietary protocols makes it necessary that not every command or every detailed parameterization option can be provided via the Twin CAT PLC library. In individual cases, therefore, recourse can be taken to the less convenient communication option by means of the offered low level interface. Information can be found in the description of the instruction Send Raw Data [} 25] and in the section low‑level communication [} 40]. Information on the features and characteristics of proprietary protocols can be obtained from the manufacturer for each model and is usually supplied with the device. The user should at least be in possession of these protocol specifications, in order to be able to investigate detailed questions and to read up on the peculiarities of the RFID reader. Reference is already made as far as possible to the peculiarities of the individual RFID readers at special places within this documentation. However, the manufacturer of the RFID devices remains responsible for describing its devices and for guaranteeing their behavior and characteristics. A detailed description of each command and the special behavior of the RFID reader is given in the proprietary protocol specifications. The manufacturer’s proprietary command corresponding to the command listed here is indicated below in each case in italics. Details can also be found in the output structure ST_RFID_Raw Data [} 43] of the function block FB_RFIDReader [} 34]. TF6600 Version: 1.4.0 21
## Page 22

Technical introduction Command Balluff Baltech Deister Deister Deister Leuze Pepperl+Fuchs BIS M-40x IDE SD electronic electronic electronic electronic IDENTControl BIS ANT1F RDL90 UDL 500 PRM5M/2V RFM12; Compact L-60x0 RFM32; RFM32ex Get Reader Version x x x x x x [} 22] Get Config [} 22] x x x x Set Config [} 23] x x x x Get Inventory x x x x x [} 23] Polling [} 23] x x x Trigger On [} 23] x x x Trigger Off [} 23] x x x Abort Command x x x [} 24] Reset Reader x x x x x x x [} 24] Read Block [} 24] x x x x x x Write Block [} 24] x x x x x x Output On [} 25] x x x Output Off [} 25] x x x Field On [} 25] x x x x Field Off [} 25] x x x x Send Raw Data x x x x x x x [} 25] Change DCType x [} 25] This list is analogous to the enumeration E_RFID_Command [} 62] in the Twin CAT RFID library. Successful processing of the requested command by the RFID reader is indicated by the status outputs of the function block and the respective response. A list of possible responses can be found in the description of the enumeration E_RFID_Response [} 63]. The commands are explained in detail below: Get Reader Version [16#01] Information on the RFID reader can be queried with this command. Depending upon availability, the model designation, the hardware and software version of the reader etc. are output from the function block in the structure ST_RFID_Reader Info [} 42]. Equivalent in proprietary protocol: Deister: 0x02 Leuze: 'V' Pepperl+Fuchs: 'VE' Baltech: System Get Info Get Config [16#02] The current configuration of the RFID reader is queried with this command. All relevant received parameters are explained in the description of structure ST_RFID_Config [} 49]. Further information is summarized in section Configuration [} 39]. 22 Version: 1.4.0 TF6600
## Page 23

Technical introduction Equivalent in proprietary protocol: Deister: 0x09 Leuze: 'G' Pepperl+Fuchs: 'GS' Set Config [16#03] Parameterized configuration settings can be transferred to the RFID reader. For more information about the possible configuration of the RFID reader, see the description of structure ST_RFID_Config In [} 48]. Following a configuration command it is recommended to query the current configuration of the reader once again using the Get Config [} 22] command. Further information is summarized in section Configuration [} 39]. Equivalent in proprietary protocol: Baltech: System Cfg Write TLVBlock Deister: 0x09 Leuze: 'C' Get Inventory [16#04] This command is used to query the type and serial number of a transponder currently present in the reading field. If no transponder is found, a corresponding response follows. Pepperl+Fuchs: The parameter i Head Number in the structure ST_RFID_Control [} 44] determines for which read head the command is to be executed. Equivalent in proprietary protocol: Balluff: 'U' Deister: 0x82 Leuze: 'I' Pepperl+Fuchs: 'SF' & 'EF' Baltech: VHLSelect + VHLGet Snr Polling [16#05] This command is used to retrieve information from the RFID reader stack. This may be, for example, the serial number of the last transponder. Note that different RFID readers have stacks of different sizes. In some cases only one message is stored. Presence detection: If this cannot be set via a configuration parameter, it is necessary to keep the reader ready for reading by means of a cyclic polling command so that a transponder within range is automatically detected. Equivalent in proprietary protocol: Deister: 0x0B Trigger On [16#06] If the trigger mode is active, then a software trigger instead of hardware trigger can be initiated with this command. The subsequent response telegram is received by the function block of the Twin CAT RFID library. There is no assignment of read transponder data in this case. The received raw data can be taken from the function block interface for further processing. Equivalent in proprietary protocol: Deister: 0x85 Leuze: '+' Trigger Off [16#07] See Trigger On [} 23]. TF6600 Version: 1.4.0 23
## Page 24

Technical introduction Equivalent in proprietary protocol: Deister: 0x85 Leuze: '-' Abort Command [16#08] If a command is being processed by the RFID reader, it is aborted with this command. Pepperl+Fuchs: The parameter i Head Number in the structure ST_RFID_Control [} 44] determines for which read head the command is to be executed. Equivalent in proprietary protocol: Leuze: 'H' Pepperl+Fuchs: 'QU' Reset Reader [16#09] This command causes the RFID reader to perform a reset. Equivalent in proprietary protocol: Balluff: 'Q' Deister: 0x01 Leuze: 'R' Pepperl+Fuchs: 'RS' Baltech: System Reset Read Block [16#0A] This command is used to read a certain number of data bytes from the transponder memory in the form of blocks of a defined size. The transfer of the input structure ST_RFID_Access Data [} 50] is necessary for this command. Before data is read from a transponder, it is usual to identify and select the transponder (see command Get Inventory [} 23]). Pepperl+Fuchs: The parameter i Head Number in the structure ST_RFID_Control [} 44] determines for which read head the command is to be executed. Equivalent in proprietary protocol: Balluff: 'L' Deister: 0x83 Leuze: 'N' Pepperl+Fuchs: 'SR' & 'ER' Baltech: VHLRead Write Block [16#0B] This command is used to write a certain number of data bytes to the transponder memory in the form of blocks of a defined size. The transfer of the input structure ST_RFID_Access Data [} 50] is necessary for this command. Before data is written to a transponder, it is usual to identify and select the transponder (see command Get Inventory [} 23]). Pepperl+Fuchs: The parameter i Head Number in the structure ST_RFID_Control [} 44] determines for which read head the command is to be executed. Equivalent in proprietary protocol: Balluff: 'P' Deister: 0x84 Leuze: 'W' Pepperl+Fuchs: 'SW' & 'EW' Baltech: VHLWrite 24 Version: 1.4.0 TF6600
## Page 25

Technical introduction Output On [16#0C] This command sets the switching output of the RFID reader permanently to TRUE. This is only possible if the switching output is not automatically addressed via the configuration. Equivalent in proprietary protocol: Deister: 0x0F Leuze: 'A0FF' Output Off [16#0D] This command sets the switching output of the RFID reader permanently to FALSE. This is only possible if the switching output is not automatically addressed via the configuration. Equivalent in proprietary protocol: Deister: 0x0F Leuze: 'A000' Field On [16#0E] The RFID field can be turned on with this command. Equivalent in proprietary protocol: Deister: 0x81 Leuze: 'F1' Baltech: System HFReset Field Off The RFID field can be turned off with this command. Depending on the RFID reader model, the field is reactivated in the case of a trigger or another command. Equivalent in proprietary protocol: Deister: 0x81 Leuze: 'F2' Baltech: System HFReset Send Raw Data [16#10] With this command, the RFID function block can be used as a low-level interface. The data to be transmitted are transferred in the control structure [} 44] as a pointer. A telegram is composed internally in the library and sent. Arbitrary data can be sent to the RFID reader in this way. The data received as a result is available at the output of the function block in the raw data structure [} 43] as an addressed data field. For more information on the process, see section Low-level communication [} 40]. When using the command Send Raw Data [} 25], an evaluation of the received response cannot be guaranteed. Example: If a read command is sent manually as a byte sequence by means of the Send Raw Data command, then received transponder data are not written at an address specified in ST_RFID_Access Data [} 50]. Evaluation/storage of the data should therefore also be done manually with the help of the raw data structure [} 43], which is always specified. Change DCType [16#11] This command can be used to set the transponder type on the read head. Use i DCType in ST_RFID_Control [} 44] to specify the type. Pepperl+Fuchs: The parameter i Head Number in the structure ST_RFID_Control [} 44] determines for which read head the command is to be executed. Equivalent in proprietary protocol: Pepperl+Fuchs: 'CT' TF6600 Version: 1.4.0 25
## Page 26

Configuration 5 Configuration 5.1 RFID reader settings and handling The following sections describe the individual RFID reader models based on information provided by the device manufacturers. The required settings and the handling are explained for each device. 5.1.1 Balluff RFID reader settings For smooth communication between controller and RFID readers, some settings need to be made before the system startup. These include, for example, the baud rate for the serial communication. A proprietary tool from the manufacturer of the RFID reader may be required in order to transfer these settings to the RFID. For all supported RFID reader models, the following standard data transmission settings have been tried and tested: Setting Value Baud rate (RS232 and RS485) 9600 baud Parity bit none Data bits 8 Stop bits 1 Depending on the hardware, other parameters can also be set, or the factory settings of the RFID reader can be used. These must then also be transferred to the software-based reader connection (see RFID reader connection [} 19]). Using the proprietary tools, the following special settings must be parameterized before starting the system. Setting Value Data transmission parameters (see above) Setting analogous to the values selected in the PLC program Type of protocol - telegram end identifier LF CR Data carrier type All types (or setting according to needs) Send CT data immediately disabled (or enabled – however, no evaluation takes place) Dynamic operation disabled Send power-on message disabled (or enabled – however, no evaluation takes place) CRC16 data check disabled Type and serial number with CT pres. disabled (or enabled, as required) If Type and serial number with CT pres. is enabled, the RFID reader automatically sends the transponder type and its serial number as soon as a transponder is detected. If a command is sent immediately after the detection of a transponder and receipt of this set message, then the correct attribution of the type of the following response and an associated evaluation cannot be guaranteed. It is advisable to manually query existing transponders using the Get Inventory [} 23] command. Otherwise at least a short waiting period should be adhered to before sending the command and the structure should be subjected to a test cycle. If the RFID reader is set up so that telegrams are sent automatically from the reader to the controller (for example, on detection of a transponder by Type and serial number with CT pres.), then the following must be observed: The end identifier (LF CR) is used in this case as a suffix for the recognition of telegrams. Previous data are combined into a telegram as soon as these 2 bytes are detected in the data stream. This may lead to an error and failure to evaluate the telegram. If it is possible for the end identifier to be present within the data in automatically sent telegrams, then a data query must be selected by means of a command call instead of the automatic transmission. The telegrams are recognized reliably as a result of this measure. 26 Version: 1.4.0 TF6600
## Page 27

Configuration RFID reader handling The function blocks of the library support communication from Balluff readers to transponders with 4-8 bytes serial number. If Balluff RFID readers are used, the serial number of 13.56 Mhz transponders is rotated byte-by-byte by the library function block. This takes place because the serial number read out from a transponder would otherwise not correspond to the serial number read out on another reader. This allows devices from different manufacturers to be operated together in the same network. When using a Balluff BIS-L60x0: • The variable i DCType = 0 must be set (see input structure st Ctrl [} 44]). • When the Get Inventory [} 23] command is called, information from both read heads is returned via the serial interface. However, only the information from the read head selected by st Ctrl.i Head Number is evaluated and output at the st Transp Info output. • If Type and serial number with CT pres. is enabled, the RFID reader automatically sends the transponder type and its serial number as soon as a transponder is detected. By default, this only affects the first read head. Switching to the second read head is not directly supported by the library. Furthermore, the number of the read head on which the tag was recognized cannot be assigned (i Head Number = 0). It must be pointed out here that not all peculiarities of every supported RFID reader model can be named here. For detailed information, please refer to the manufacturer's own documentation. 5.1.2 Baltech If a supported Baltech RFID stand-alone device is used, the Twin CAT RFID library can be used as an interface. Alternatively certain Beckhoff Control Panels or Panel PCs can be used. In these devices an RFID reader can be integrated as an option. In this case an SDK containing the proprietary documentation is provided. The functionality if the Twin CAT library is the same in both cases. RFID reader settings For smooth communication between controller and RFID readers, some settings need to be made before the system startup. These include, for example, the baud rate for the serial communication. The proprietary tool 'Baltech id-engine explorer' provided by the RFID reader manufacturer can be used to transfer these settings to the RFID reader. The tool can also be used to perform a function test to determine whether the RFID device and the transponder cards are recognized. The following standard data transmission settings have been tried and tested: Setting Value Baud rate 115200 baud Parity bit none Data bits 8 Stop bit 1 TF6600 Version: 1.4.0 27
## Page 28

Configuration This matches the factory setting of the supported Baltech RFID devices. Other parameters can be set, if required. These must then also be transferred to the software-based reader connection (see RFID reader connection [} 19]). The baud rate of the readers can be changed with the tool "Baltech id-engine explorer" (see Baltech documentation: Id Engine Explorer.pdf). The tool 'Baltech id-engine explorer' only runs under Windows XP. It is not available for Windows CE. The baud rate is therefore not configurable under Windows CE. In the PLC a fast task is required for processing the incoming data. When connecting an RFID device to a COM port and a baud rate of 115200 baud, a cycle time of 1 ms is required (see RFID reader connection [} 19]). In order to configure the baud rate from the PLC, the following byte sequence can be transferred as a raw data block [0x 1C 00 09 06 00 01 03 00 02 xx xx - with xx xx representing the baud rate, e.g. 9600 baud: 96 units at 100 baud → 0x 00 60]. Details are explained in section Low-level communication [} 40]. This is also possible under Windows CE, if a transfer with the currently set baud rate is possible. Using the virtual serial COM port (USB) If the device is connected via USB, the appropriate USB-to-Virtual-Com-Port driver must be installed. If it is a Beckhoff Panel PC, the driver is already pre-installed. The SDK of the RFID device also contains the driver. The virtual COM port is displayed in the Windows Device Manager. Communication to the driver takes place via Beckhoff Twin CAT serial communication. However, no corresponding device is created in the Twin CAT System Manager, and no link is established there. Further information can be found in the documentation for the PLC library "Serial Communication". RFID reader handling The library supports the default settings for the Baltech communication. 'Host Operation' mode is supported. Other modes are not supported. The BRP (Baltech Reader Protocol) is used for internal access in 'Communication Mode' 'Normal Mode'. If raw data is sent via the low-level communication option, make sure that the above settings are correctly specified within the frame. It must be pointed out here that not all peculiarities of every supported RFID reader model can be named here. Therefore you are referred to the manufacturer’s own documentation for more detailed information. Configuration If encrypted transponder cards are used, the same key must be available in the RFID device. The Baltech RFID reader is configured once, i.e. the key only has to be specified once. For security reasons the key cannot be read from the device configuration. A VHL file is stored in the device configuration to match the encryption of a transponder card. Multiple VHL files can be stored to access different cards without reconfiguration. There are three ways to transfer such a VHL file into the configuration of the RFID device: 28 Version: 1.4.0 TF6600
## Page 29

Configuration Configuration type Description Configuration card A configuration can be transferred via a configuration card. This is the preferred option. 'Baltech id-engine explorer' tool The tool can be used to transfer a configuration to the memory of the Baltech RFID device (see Baltech documentation: Id Engine Explorer.pdf). In simple cases the specific configuration can be created directly in the tool. Alternative Baltech offers technical support and can provide a file containing the configuration. The tool "Baltech id-engine explorer" runs on all Windows operating systems from Windows XP onwards. It is not available for Windows CE. from the PLC For Mifare Classic cards the transfer of a VHL file configuration can be programmed in the PLC program code. The Set Config [} 23] command transfers the configuration specified at the input in ST_RFID_Config In [} 48]. The structure of a Mifare card and the possible settings for key allocation are explained in ST_RFID_Cfg Struct_Baltech Mif VHLFile [} 51]. (Detailed information about Mifare cards can be found in the Baltech document Mifare.pdf in the Baltech SDK) Transponders Suitable transponder cards for Baltech RFID devices are available from several manufacturers. If cards with encryption are to be used, Baltech offers preconfigured cards for this purpose. Manufacturer contact http://www.baltech.de 5.1.3 Deister electronic RFID reader settings For smooth communication between controller and RFID readers, some settings need to be made before the system startup. These include, for example, the baud rate for the serial communication. A proprietary tool from the manufacturer of the RFID reader may be required in order to transfer these settings to the RFID. For all supported RFID reader models, the following standard data transmission settings have been tried and tested: Setting Value Baud rate (RS232 and RS485) 9600 baud Parity bit none Data bits 8 Stop bit 1 Depending on the hardware, other parameters can also be set, or the factory settings of the RFID reader can be used. These must then also be transferred to the software-based reader connection (see RFID reader connection [} 19]). Using the proprietary tools, the following special settings may have to be parameterized before the system is started: Setting Value Data transmission parameters (see above) Setting analogous to the values selected in the PLC program TF6600 Version: 1.4.0 29
## Page 30

Configuration RFID reader handling Here, too, the "Polling" function should be noted, which makes it useful to call the command multiple times if current transponder information is important (see command description [} 21]). In addition there is the peculiarity that, in the case of the prox Entry models, a polling command must be present in order to establish a connection to the transponder. In the case of UDL models, on the other hand, the configuration provides the automatic establishment of a connection to detected transponders, so that no polling command is absolutely necessary. The block size corresponding to the tag must be configured in the RFID reader configuration. Deister RDL devices support 4 bytes or 8 bytes block size. Example: if a block size of 8 bytes is specified for the transponder, then the reader must be configured with the parameter i Blocksize := 8 and the read or write access via the structure ST_RFID_Access Data [} 50] must take place with a block size of 8 bytes. Deister RDL: a write command can write up to 36 bytes of data at a time. If more data is to be written to the transponder, it must be divided into several commands. It must be pointed out here that not all peculiarities of every supported RFID reader model can be named here. Therefore you are referred to the manufacturer’s own documentation for more detailed information. Configuration Note the following when a new configuration is written to the RFID device (command Set Config [} 23]): Deister RDL devices: Not every combination of configuration parameters is allowed (see ST_RFID_Cfg Struct_Deister RDL [} 54]). Disregard of the required dependencies leads to an error (e RFERR_Invalid Cfg): Configuration parameters Required dependencies e Read Mode = e RFRD_Continuous Read e Trigger Mode = e RFTR_Immediate Read e Write Mode = e RFWR_Immediate Write e Write Mode = e RFWR_Write To Next Tag e Trigger Mode = e RFTR_Read With Trigger b Multi Transp Mode = TRUE b Serial Number Mode = TRUE e Write Mode = e RFWR_Immediate Write e Read Mode = e RFRD_Single Shot If the configuration is transmitted as a register, these dependencies also exist and the RFID device will return an error code if inadmissible. 5.1.4 Leuze electronic RFID reader settings For smooth communication between controller and RFID readers, some settings need to be made before the system startup. These include, for example, the baud rate for the serial communication. A proprietary tool from the manufacturer of the RFID reader may be required in order to transfer these settings to the RFID. For all supported RFID reader models, these standard data transmission settings have been tried and tested: Setting Value Baud rate (RS232 and RS485) 9600 baud Parity bit none Data bits 8 Stop bit 1 30 Version: 1.4.0 TF6600
## Page 31

Configuration Depending on the hardware, other parameters can also be set, or the factory settings of the RFID reader can be used. These must then also be transferred to the software-based reader connection (see RFID reader connection [} 19]). Using the proprietary tools, the following special settings may have to be parameterized before the system is started. Setting Value Data transmission parameters (see above) Setting analogous to the values selected in the PLC program If the RFID reader is triggered, the following answer telegram is received by the function block of the Twin CAT RFID library. There is no assignment of read transponder data in this case. The received raw data can be taken from the function block interface for further processing. RFID reader handling The block size corresponding to the tag must be configured in the RFID reader configuration. The Leuze devices support 4 bytes or 8 bytes block size. Example: if a block size of 8 bytes is specified for the transponder, then the reader must be configured with the parameter i Blocksize := 8 and the read or write access via the structure ST_RFID_Access Data [} 50] must take place with a block size of 8 bytes. A write command can write up to 36 bytes of data at a time. If more data is to be written to the transponder, it must be divided into several commands. It must be pointed out here that not all peculiarities of every supported RFID reader model can be named here. Therefore you are referred to the manufacturer’s own documentation for more detailed information. Configuration Note the following when a new configuration is written to the RFID device (command Set Config [} 23]): Not every combination of configuration parameters (structure ST_RFID_Cfg Struct_Leuze RFM [} 59]) is allowed. Disregard of the required dependencies leads to an error (e RFERR_Invalid Cfg): Configuration parameters Required dependencies e Read Mode = e RFRD_Continuous Read e Trigger Mode = e RFTR_Immediate Read e Write Mode = e RFWR_Immediate Write e Write Mode = e RFWR_Write To Next Tag e Trigger Mode = e RFTR_Read With Trigger b Multi Transp Mode = TRUE b Serial Number Mode = TRUE e Write Mode = e RFWR_Immediate Write e Read Mode = e RFRD_Single Shot If the configuration is transmitted as a register, these dependencies also exist and the RFID device will return an error code if inadmissible. 5.1.5 Pepperl-Fuchs RFID reader settings For smooth communication between controller and RFID readers, some settings need to be made before the system startup. These include, for example, the baud rate for the serial communication. A proprietary tool from the manufacturer of the RFID reader may be required in order to transfer these settings to the RFID. For all supported RFID reader models, the following standard data transmission settings have been tried and tested: TF6600 Version: 1.4.0 31
## Page 32

Configuration Setting Value Baud rate (RS232 and RS485) 38400 baud Parity bit none Data bits 8 Stop bit 1 If required, other parameters can be set, depending on the hardware. These must then also be transferred to the software-based reader connection (see RFID reader connection [} 19]). RFID reader handling The model information (Get Reader Version [} 22] command) and the current reader configuration (Get Config [} 22] command) must be evaluated at the system start. The received status of the device is displayed via output i Err Code Rcv of function block FB_RFIDReader and signaled in case of error by b Error = TRUE and i Error Id = e RFERR_Error Rcv. The read heads also have their own status. These can be checked with the configuration structure [} 61] read via Get Config. The set transponder types should be checked on restarting. If the configuration structure read via Get Config does not display the correct transponder types for each read head, they can be corrected with the Change DCType [} 25] command. It is recommended to set the value specified for the transponder in place of the default value (99). The read/write head additionally recognizes the data storage device more quickly as a result. When accessing the data memory of a transponder for writing and/or reading, a block size (see ST_RFID_Access Data [} 50]) suitable for the transponder must be used for all Pepperl+Fuchs RFID devices! Block sizes of possible transponders: 4 bytes (IQC21, IPC03, IQC22, IQC24) 8 bytes (IQC33) 16 bytes (IQC40, IQC41, IQC42 and IQC43) 32 bytes (IQC37) The use of a 4-byte block size only is supported up to version 3.3.3.0 of the library. It must be pointed out here that not all peculiarities of every supported RFID reader model can be named here. Therefore you are referred to the manufacturer’s own documentation for more detailed information. Buffered Command Using the b Buffered Cmd input variable in ST_RFID_Control [} 44], it is possible to transmit commands that can be buffered for continuous execution at a later time. This is possible with the e RFC_Get Inventory, e RFC_Read Block and e RFC_Write Block commands. A buffered command can be ended with the e RFC_Abort Command command. Buffered command If such a buffered command is active on a read head, the trigger mode may neither be active nor activated for this channel! Similarly, no raw data command may be transmitted that concerns this channel! Trigger mode It is recommended not to use any trigger or sensor channel. The trigger mode should also be deactivated for all channels. In the factory setting for the RFID device the trigger is deactivated for all channels. Alternatively, for example, the Get Inventory command can be called cyclically or Get Inventory can be called as a buffered command (b Buffered Cmd in ST_RFID_Control [} 44]). The Twin CAT library offers the following option for using a sensor channel as trigger for the RFID unit: The trigger sends a message to indicate whether it is triggered or the value is outside the trigger range. These messages are received and displayed as e Response = e RFR_Cmd Confirmation or e RFR_No Transponder. The application can respond accordingly and trigger the required command. 32 Version: 1.4.0 TF6600
## Page 33

Configuration To configure a channel as sensor channel/trigger, the corresponding Ident channel must be 0. The required raw data command is explained in the next paragraph. Trigger setting The trigger setting must not be accomplished from the manufacturer's proprietary tool. Otherwise the messages of the sensor channel received as a result cannot be read by the function block of the Twin CAT RFID library. The correct setting of the trigger mode should be checked with the command Get Config [} 22] and by evaluating the read configuration structure. If necessary the setting can be made up for on program startup. Sending the settings via raw data commands For details see Low-level communication [} 40] and the description of structures ST_RFID_Control [} 44] and ST_RFID_Raw Data [} 43]. Baud rate: To set the baud rate of the RFID device to 9600 baud send the following raw data: ASCII hex CI0,9600 43 49 30 2C 39 36 30 30 After changing the baud rate, a reset of the RFID device is necessary. Trigger mode: To disable a trigger sensor on channel 3 so that the channel can be used as read head, the following raw data should be sent: ASCII hex TM300 54 4D 33 30 30 To configure a sensor as trigger on channel 2, the following raw data should be sent: ASCII hex TM201 54 4D 32 30 31 Response: e Response = e RFR_Cmd Confirmation as soon as the sensor is triggered. Response: e Response = e RFR_No Transponder when the sensor is exited. The output st Transp Info.i Head Number indicates the sensor channel from which the response was sent. To configure a sensor as inverted trigger on channel 4, the following raw data should be sent: ASCII hex TM402 54 4D 34 30 32 Response: e Response = e RFR_No Transponder when the sensor is triggered. Response: e Response = e RFR_Cmd Confirmation when the sensor is exited. The output st Transp Info.i Head Number indicates the sensor channel from which the response was sent. Once such setting has been made, the device configuration must be re-read with the Get Config [} 22] command. It is advisable to check the settings by analyzing the read configuration structure. TF6600 Version: 1.4.0 33
## Page 34

PLC API 6 PLC API 6.1 Function block 6.1.1 FB_RFIDReader The Twin CAT RFID library only consists of one function block. This section explains the interface variables of the function block for a quick introduction to the handling of the library. See also the Tutorial [} 67] and the Samples [} 67]. The uniform handling of all RFID reader models and the associated prepared interface declarations are particularly user-friendly. However, it should be noted that the function block of the Twin CAT RFID library has a slight overheat due to the differences of some RFID reader models. This indispensable characteristic is, however, strongly outweighed by the advantages that the available flexibility offers. Syntax FUNCTION_BLOCK FB_RFIDREADER VAR_INPUT b Execute : BOOL; e Command : E_RFID_Command; st Access Data : ST_RFID_Access Data; st Ctrl : ST_RFID_Control; st Cfg : ST_RFID_Config In; e Manufacturer : E_RFID_Reader Manufacturer; t Time Out : TIME := T#5s; END_VAR VAR_IN_OUT Rx Buffer : Com Buffer; Tx Buffer : Com Buffer; END_VAR VAR_OUTPUT b Busy : BOOL; b Response Rcv : BOOL; e Response : E_RFID_Response; b Error : BOOL; i Error ID : UINT; (* general RFID error *) i Err Code Rcv : UINT; (* error received by reader *) st Reader Cfg : ST_RFID_Config; st Reader Info : ST_RFID_Reader Info; st Transp Info : ST_RFID_Transp Info; st Raw Data : ST_RFID_Raw Data; END_VAR 34 Version: 1.4.0 TF6600
## Page 35

PLC API Inputs Name Type Description b Execute BOOL In order to receive messages from the RFID reader, the function block is called with a FALSE on this input. The function block reacts to a rising edge on b Execute by executing the selected command e Command or querying it at the RFID reader. e Command E_RFID_Command The e Command input offers a choice of commands, such as reading from or writing to a transponder, in the form of an [} 62] enumeration. A command is executed by setting the b Execute input. st Access Data ST_RFID_Access Data If a write or read command is to be executed, then parameters must be transferred with this input structure. [} 50] st Ctrl ST_RFID_Control [} 44] Various control parameters can be transferred at the input with st Ctrl. This includes the possibility to specify delay times. st Cfg ST_RFID_Config In An RFID reader has an internal configuration. This can be read out and changed on some devices. Configuration parameters [} 48] to be transmitted to the RFID reader are transferred at the st Cfg input. See also: Configuration [} 39] e Manufacturer E_RFID_Reader Manufact The manufacturer of the RFID reader model in use is specified at this input. urer [} 65] t Time Out TIME Specifies a maximum length of time for the execution of the function block. The default value is 5 seconds. The condition t Time Out > t Pre Send Delay + t Post Send Delay applies. Otherwise an error is generated at the output. See details of the delay times in ST_RFID_Control [} 44]. / Inputs/outputs Name Type Description Rx Buffer Com Buffer Specifies the receive buffer that was declared as an input variable and linked to the serial terminal in the Twin CAT System Manager. See the description of the serial connection of an RFID reader in section RFID reader connection [} 19] Tx Buffer Com Buffer Specifies the output buffer that was declared as an output variable and linked to the serial terminal in the Twin CAT System Manager. See the description of the serial connection of an RFID reader in section RFID reader connection [} 19] TF6600 Version: 1.4.0 35
## Page 36

PLC API Outputs 36 Version: 1.4.0 TF6600
## Page 37

PLC API Name Type Description b Busy BOOL If the command call is valid, the b Busy output goes to TRUE for at least one cycle. The function block may only be called again for a new command with b Execute = TRUE if b Busy has changed to FALSE and the function block is thus no longer in the active transmission state. Thus, if b Busy = FALSE is detected, all other output variables b Response Rcv, e Response, b Error, i Err Code Rcv,... and st Raw Data can be evaluated. If a response to an executed command call is expected, then the function block remains at b Busy = TRUE until a telegram is received or until the timeout t Time Out is reached. If the delay times t Pre Send Delay and/or t Post Send Delay have been given to the function block, b Busy remains TRUE for at least as long as the sum of these times. See also: ST_RFID_Control [} 44]. b Response Rcv BOOL As soon as a response from the RFID reader has arrived at the controller, this flag is set for at least one cycle. The arrival of a telegram is generally signaled with a rising edge to b Response Rcv = TRUE. Thus, if this flag is detected, unexpected telegrams and the corresponding output variables e Response, b Err, i Err Code Rcv,... and st Raw Data can be evaluated. If a response is expected for an executed command call, the function block remains b Busy = TRUE until a telegram is received. Depending on the command call, more than one response can arrive before the action is completed and b Busy = FALSE. Depending on the configuration setting of the delay times in ST_RFID_Control [} 44], b Response Rcv can go to TRUE even before b Busy changes to FALSE. e Response E_RFID_Response As soon as b Response Rcv shows TRUE, this enumeration indicates the type of message received. The appropriate [} 63] evaluation can follow, for example, depending on the type. b Error BOOL The b Error output becomes TRUE as soon as an error occurs. This can be due to incorrect input parameters, transmission errors, errors on the part of the RFID reader or a timeout. The type of error that has occurred is indicated by the output variable i Error ID. Details about the error display can be found in the Error codes [} 75] section. i Error ID UNIT If an error occurs, the type of error at output i Error ID is displayed. Details of the possible error IDs are given in the Error codes [} 75] section. i Err Code Rcv UINT The error code indicated at the i Err Code Rcv output corresponds to the error code sent by the RFID reader to the controller. Details about the error display can be found in the Error codes [} 75] section. st Reader Cfg ST_RFID_Config [} 49] An RFID reader has an internal configuration. This can be read out and changed on some devices. These read-out configuration parameters are made available at the st Reader Cfg output. st Reader Info ST_RFID_Reader Info Each RFID reader has its own identification data such as designation, hardware version, etc. These values, which can [} 42] be queried with the command Get Reader Version [} 22] among others, are specified in the output structure st Reader Info. TF6600 Version: 1.4.0 37
## Page 38

PLC API Name Type Description st Transp Info ST_RFID_Transp Info The structure st Transp Info contains information on the last read transponder. Among other things, the serial number of the [} 41] transponder is output here. st Raw Data ST_RFID_Raw Data The output structure st Raw Data outputs both the sent and the received raw data. [} 43] Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.1.2 Handling instructions RFID library handling If you have included the library file Tc2_RFID, you have access to all functions. The library places a function block at your disposal for communication with an RFID reader. You can use the general function block FB_RFIDReader, which is usable for all RFID reader models, or one of the manufacturer-specific function blocks. These offer the same range of functions and almost the same interface and the same handling, and they are also optimized in terms of the code and the performance. The function block made available for RFID reader communication offers high level communication with a high level interface. A instruction set provides various commands (see RFID command set [} 21]). In addition, the integrated low-level communication allows sending and receiving of raw data (see Low level communication [} 40]). The Tc2_RFID library expects the RFID reader to respond immediately to a command and that the dialog is not interrupted by another telegram. Otherwise an evaluation may not be possible. General handling of the function block Depending on the RFID reader model, the device can send a telegram to the controller without a prior request. A cyclic call of the RFID function block with b Execute = FALSE is sufficient for reception. All possible active accesses to the RFID device are listed in the instruction set (see RFID command set [} 21]). The following procedure is common to all commands: The function block is called by a rising edge on the b Execute input. Afterwards, cyclic calling of the function block (b Execute = FALSE) returns the result of the query at the output as soon as the processing of the query has been completed (b Busy = FALSE). The function block must be called (b Execute = FALSE) for as long as it takes for the internal processing (b Busy = FALSE) to be completed. During that time, all inputs of the function block must remain unchanged. All received messages are additionally made available completely as raw data in unprocessed form at the output. Further handling instructions can be found in the description of the input and output variables of the function block and in the tutorial and examples in this documentation. Initialization of an RFID reader integrated via the Twin CAT library When the system is started, the following actions are required for initializing an RFID reader integrated via the Twin CAT library: Insofar as they are available according to the instruction set, the model information (Get Reader Version [} 22] command) and the current reader configuration (Get Config [} 22] command) must be evaluated. Because successful communication with the RFID reader is dependent on these data, it must be ensured that the current values are always available and queried if necessary. 38 Version: 1.4.0 TF6600
## Page 39

PLC API RFID reader handling The characteristics of the supported RFID reader models are listed in section RFID reader settings and handling [} 26]. The notes listed there are allocated to the special RFID reader manufacturers. 6.1.3 Configuration All supported RFID readers can be configured with the same command. This must be available according to the instruction set for the specific model (see RFID command set [} 21]). In addition to the reader version, the current configuration of the reader should also be requested at each program start. Since RFID readers from different manufacturers never have identical configuration options, in addition to the input configuration structure the Twin CAT RFID library offers a substructure for each manufacturer with the specific parameters (ST_RFID_Cfg Struct_Deister UDL, ST_RFID_Cfg Struct_Leuze RFM,...). The parameters listed there can be parameterized by the user as desired within the limits of the valid ranges of values. The meaning of the parameters is to be taken either from the structure declaration or the proprietary specifications. Reading the configuration The Get Config [} 22] command from the instruction set is used in order to read the current RFID reader configuration. After that, the configuration data can be taken from the output of the function block if the query was successful. They are available there in the structure ST_RFID_Config [} 49] both as a configuration structure and as a configuration register. Changing the configuration The Set Config [} 23] command from the instruction set is used in order to write an RFID reader configuration. After a Set Config command, the current configuration must be read once with the Get Config [} 22] command. If the user sets further reaching special configuration parameters via an external tool and wants to retain these, then the flag for "Default Values" b Use Cfg Default in the structure ST_RFID_Config In [} 48] should be deactivated. Invalid combination of configuration parameters Certain combinations of configuration parameters are sometimes impermissible. You can find out which parameter values are excluded in which combination from the proprietary protocol specifications of the RFID reader manufacturers. If the parameters are entered incorrectly, then either an error will be generated even before the configuration query, or the RFID reader signals by its response that the configuration data could not be adopted. Configuration data Each configuration can be seen as a register (byte array) or as a structure. This is not the parameterization of the Twin CAT RFID library but the proprietary configuration of the RFID reader. The Twin CAT RFID library contains various configuration structures, which process the raw data of the configuration registers of different RFID readers. If available, both variants are provided in ST_RFID_Config [} 49] at the output of the library function block. This takes place via pointers. Baltech The configuration data is used as a structure for Baltech RFID readers. • ST_RFID_Cfg Struct_Baltech Mif VHLFile [} 51] The structure is suitable for writing with the e RFC_Set Config command (see RFID command set [} 21]). Balluff TF6600 Version: 1.4.0 39
## Page 40

PLC API No configuration options are offered. Deister The configuration data can be used for Deister RFID readers both as a structure and as a register. If a register array (byte array) is used, it must always have the size of the complete configuration data. For the supported Deister RDL devices this is 88 bytes, for the UDL devices 117 bytes. • ST_RFID_Cfg Struct_Deister RDL [} 54] • ST_RFID_Cfg Struct_Deister UDL [} 56] The structures are suitable for writing with e RFC_Set Config and reading with e RFC_Get Config (see RFID command set [} 21]). Leuze For Leuze RFID readers the configuration data can be used as a structure and as a register. If a register array (byte array) is used, it must always have the size of the complete configuration data. For supported Leuze devices this is 88 bytes. • ST_RFID_Cfg Struct_Leuze RFM [} 59] The structure is suitable for writing with e RFC_Set Config and reading with e RFC_Get Config (see RFID command set [} 21]). Pepperl+Fuchs For Pepperl+Fuchs RFID readers the configuration data are used as a structure. • ST_RFID_Cfg Struct_Pepperl Fuchs IDENT [} 61] The structure is suitable for reading with e RFC_Get Config (see RFID command set [} 21]). 6.1.4 Low level communication In addition to the high-level instruction set, the Twin CAT RFID library also offers the possibility of low-level communication. This is solved implicitly. The same function block is used. Any telegrams up to a maximum size of 1024 bytes can be received and sent up to a size of 300 bytes. A complete telegram is composed as follows: | Prefix | Addressing | Raw data | CRC | Suffix | Depending upon the proprietary protocol specification, individual components may be missing. In general, however, the composition is the same. Sending The e RFC_Send Raw Data command from the instruction set is used for sending (see RFID command set [} 21]). The raw data to be sent is specified in the input structure ST_RFID_Control [} 44]. In order to send a low level telegram, only the raw data is specified. The other telegram components are automatically supplemented by the Twin CAT RFID library. Checking data such as CRC are likewise generated and added internally. If the protocol requires recoding of certain bytes within the raw data, this is also done automatically by the Twin CAT RFID library. If an RS485 interface is involved, the addressing must be specified separately. It may not be contained in the specified raw data. By default, the addressing is performed automatically by the library. However, it can be parameterized via the input variables in ST_RFID_Control [} 44]. The raw data last sent can be viewed at any time at the output of the function block by means of the structure ST_RFID_Raw Data [} 43]. This is independent of the command used. 40 Version: 1.4.0 TF6600
## Page 41

PLC API Receiving The raw data last received can be viewed at any time at the output of the function block by means of the structure ST_RFID_Raw Data [} 43]. The associated addressing is output in the structure ST_RFID_Reader Info [} 42]. When using the Send Raw Data [} 25] command, a direct evaluation of the received response cannot be guaranteed. Example: If a read command is sent manually as a byte sequence using the Send Raw Data command, the received transponder data is not written to an address specified in ST_RFID_Access Data [} 50]. Evaluation/ storage of the data should therefore also be done manually with the help of the raw data structure ST_RFID_Raw Data [} 43], which is always specified. The specified raw data consists of the received telegram, but without prefix, suffix, checksum, CRC or shift sequence coding. If the received telegram has not been regularly evaluated by the function block, this is additionally indicated by an error. In order to be able to use the received data, these must be copied, for example, to a byte array. Example of the assignment of received data with the aid of the MEMCPY() function: fb RFIDReader : FB_RFIDReader; arr Received Data : ARRAY [0..511] OF BYTE; MEMSET( ADR(arr Received Data), 0, SIZEOF(arr Received Data) ); MEMCPY( ADR(arr Received Data), fb RFIDReader.st Raw Data.p Received Rsp, MIN(fb RFIDReader.st Raw Data.i Received Rsp Len, SIZEOF(arr Received Data)) ); Balluff RFID reader: the end identifier (LF CR) is used as a suffix for the recognition of telegrams. Previous data are combined into a telegram as soon as these 2 bytes are detected in the data stream. 6.2 Data types 6.2.1 Structures 6.2.1.1 ST_RFID_Transp Info The structure ST_RFID_Transp Info indicates the type and the serial number of the last detected RFID transponder. The Get Inventory [} 23] command is used to query and update this information. TYPE ST_RFID_Transp Info : STRUCT s Serial Number : T_RFID_Transp SRN; (* serial number shown as hex coded string(ascii) *) e Type : E_RFID_Transp Type; i Head Number : USINT; (* read head where the last transponder was detected *) i DCType : USINT; (* data carrier type: the received transponder type code (see device specific type list) *) END_STRUCT END_TYPE All manufacturers Name Description s Serial Number The serial number of the transponder (frequently 8 bytes) is indicated in the hexadecimal string s Serial Number. The data type is T_RFID_Transp SRN [} 66]. If Balluff RFID readers are used, the serial number of 13.56 Mhz transponders is rotated byte-by-byte by the library function block. This takes place because the serial number read out from a transponder would otherwise not correspond to the serial number read out on another reader. This allows devices from different manufacturers to be operated together in the same network. e Type The type of transponder is indicated as an enumeration value of the enumeration E_RFID_Transp Type [} 65]. i DCType The type of transponder is specified as a numeric code. See the proprietary device-specific transponder type list. TF6600 Version: 1.4.0 41
## Page 42

PLC API Pepperl+Fuchs Name Description i Head Number If an RFID reader with several read heads is connected, i Head Number indicates by which head the RFID transponder was detected. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.2 ST_RFID_Reader Info Following the Get Reader Version [} 22] command from the command set, the received data are processed in this output structure. Not every variable is thereby served by every RFID reader model in the form of the version information. For example, one reader model indicates the production date while another RFID reader model transfers the hardware version. More detailed information on the entries can be found in the manufacturer’s own protocol specification and manuals. TYPE ST_RFID_Reader Info : STRUCT d Date : DATE; e Type : E_RFID_Reader Type; e Group : E_RFID_Reader Group; e Manufacturer : E_RFID_Reader Manufacturer; i Reserved : UINT; s SWVersion : STRING(31); s HWVersion : STRING(31); s Code : STRING(39); s Serial Number : STRING(39); i Src Addr Rcv : UDINT; (* RS485 address *) i Dst Addr Rcv : UDINT; (* RS485 address *) END_STRUCT END_TYPE All manufacturers Name Description e Type At this output, the type of RFID reader is specified as an enumeration. e Group The RFID reader group/series is specified at this output. The internal processing of all telegrams in the library is specified by this group allocation. e Manufacturer The manufacturer of the connected RFID reader is specified at this output. The enumeration provides the following choices: TYPE E_RFID_Reader Manufacturer : ( e RFRM_Unknown, e RFRM_Balluff, e RFRM_Deister, e RFRM_Leuze, e RFRM_Pepperl Fuchs, e RFRM_Baltech ); END_TYPE i Src Addr Rcv In case of the RS485 interface, the received source address is specified here. i Dst Addr Rcv In case of the RS485 interface, the received destination address is specified here. 42 Version: 1.4.0 TF6600
## Page 43

PLC API Baltech Name Description d Date The production date of the RFID reader is indicated at this output. The date 01/01/1970 means that no production date was transmitted. s SWVersion Indicates the software version as text. s Code The special type of the RFID reader is transmitted as numeric code. This is output at output s Code as a string. s Serial Number The serial number of the RFID reader is output as a hexadecimal string at the s Serial Number output. This is not to be confused with the transponder serial number. Deister Name Description s SWVersion Indicates the software version as text. s HWVersion Indicates the hardware version as text. s Code The special type of the RFID reader is transmitted as numeric code. This is output at output s Code as a string. s Serial Number The serial number of the RFID reader is output as a hexadecimal string at the s Serial Number output. This is not to be confused with the transponder serial number. Leuze Name Description d Date The production date of the RFID reader is indicated at this output. The date 01/01/1970 means that no production date was transmitted. s Code The special type of the RFID reader is transmitted as numeric code. This is output at output s Code as a string. Pepperl+Fuchs: Name Description d Date The production date of the RFID reader is indicated at this output. The date 01/01/1970 means that no production date was transmitted. s SWVersion Indicates the software version as text. s Code The special type of the RFID reader is transmitted as numeric code. This is output at output s Code as a string. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.3 ST_RFID_Raw Data This structure outputs the sent and received data as raw data. This always refers to the complete telegram, but without the prefix, suffix, checksum, CRC, or shift sequence coding. Low-level communication is described in detail in section Low-level communication [} 40]. The byte sequences can be viewed via the specified pointers. The MEMCPY() function can be used for evaluation. TYPE ST_RFID_Raw Data : STRUCT p Received Rsp :POINTER TO BYTE; p Sent Command :POINTER TO BYTE; TF6600 Version: 1.4.0 43
## Page 44

PLC API i Received Rsp Len :UINT; i Sent Command Len :UINT; END_STRUCT END_TYPE Name Description p Received Rsp A received telegram is stored as a byte sequence and the p Received Rsp pointer points to this byte sequence. p Sent Command A sent telegram is stored as a byte sequence and the p Sent Command pointer points to this byte sequence. i Received Rsp Len Specifies the length of the stored byte sequence in bytes. i Sent Command Len Specifies the length of the stored byte sequence in bytes. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.4 ST_RFID_Control The input structure st Ctrl contains variables with which the behavior of the function block can be parameterized. The two variables t Pre Send Delay and t Post Send Delay offer the option to parameterize delay times. TYPE ST_RFID_Control : STRUCT s Sel Transp SRN :T_RFID_Transp SRN; (* serial number shown as hex coded string(ascii) *) t Pre Send Delay :TIME; (* condition: t Time Out > t Pre Send Delay + t Post Send Delay *) t Post Send Delay :TIME; (* condition: t Time Out > t Pre Send Delay + t Post Send Delay *) i Src Addr Snd :UDINT; (* RS485 address *) i Dst Addr Snd :UDINT; (* RS485 address *) b Addr Auto Mode :BOOL := TRUE; (* if Auto Mode is activated the communication addresses are ha ndled automatically and set addresses are not used. *) b Logging :BOOL; i Head Number :USINT := 1; (* if multiple read heads are installed at the reader unit, on e can be selected *) i DCType :USINT := 1; p Raw Data Command :POINTER TO BYTE; (* data input for low level communication *) i Raw Data Command Len :UINT; b Buffered Cmd :BOOL; i VHLFile ID :USINT := 16#FF; (* selection of VHL file; default 0x FF (ad hoc VHL file of vhl Setup) *) i Card Type Mask :UINT := 16#FFFF; (* select which card type should be detected via Get Invento ry; default 0x FFFF (all types) *) b Reselect :BOOL := TRUE; (* with Reselect every Get Inventory gets the first item of the reader's detected card list *) b Accept Conf Card :BOOL := TRUE; (* a read command also accept configuration cards to config ure the RFID Reader *) END_STRUCT END_TYPE Multiple RFID readers on the same RS485 network Support for multiple RFID readers on an RS485 network is not currently available with the Twin CAT RFID library. Each RFID reader must have a separate connection to a separate terminal. In this stand-alone mode, individual addressing with i Src Addr Snd and i Dst Addr Snd is not necessary. Therefore, addressing can be handled automatically by the Twin CAT RFID library. For this, leave the input variable b Addr Auto Mode as TRUE. 44 Version: 1.4.0 TF6600
## Page 45

PLC API All manufacturers Name Description t Pre Send Delay Before sending a command to the RFID reader, the function block waits until the time specified by t Pre Send Delay has elapsed. t Post Send Delay After sending a command to the RFID reader, the function block waits until at least the time specified by t Post Send Delay has elapsed. If the expected response has not arrived yet, the function block continues to wait for the response until the specified timeout time t Time Out has elapsed at the latest. i Src Addr Snd Source address in the case of RS485 communication. This address is used if b Addr Auto Mode is not set. i Dst Addr Snd Destination address in the case of the RS485 communication. This address is used if b Addr Auto Mode is not set. b Addr Auto Mode Option in the case of RS485 communication. If b Addr Auto Mode is enabled [default: TRUE], the RS485 addresses are assigned automatically. The addresses given above are not used. If b Addr Auto Mode is disabled (FALSE), the addresses specified above are used. b Logging An additional output can be activated with b Logging. The serial communication can thus be reconstructed with the aid of Log View Messages. These messages can be viewed in the Windows Event Viewer as well as in the Twin CAT System Manager. This is useful for testing and analysis purposes. The format of the output is not specified, in order to facilitate extensions. The first time the function block is called with b Logging = TRUE, the output "Logging initialized" is generated. No communication data is monitored in this first cycle. p Raw Data Command The regular function block of the Twin CAT RFID library can also be used for low- level communication. In this case, raw data can be sent directly to the RFID reader. The raw data to be sent (e.g. as a byte array) must be specified in this input variable. This is a pointer to the raw data to be sent. The library function block accesses this address in read-only mode. Further information on the process of low-level communication is summarized in section Low-level communication [} 40]. Both the transmitted and the received raw data can be viewed at any time at the output by means of the structure ST_RFID_Raw Data [} 43]. i Raw Data Command Len The input variable i Raw Data Command Len specifies the length in bytes of the raw data specified by the pointer p Raw Data Command. Balluff Name Description i Head Number If an RFID reader with several read heads is addressed, the read head is specified in the input variable i Head Number. i DCType If Balluff readers are used via i DCType, the block size of the chip memory (0→64bytes, 1→32bytes) can be specified. TF6600 Version: 1.4.0 45
## Page 46

PLC API Baltech Name Description i VHLFile ID Write and read commands are executed with the VHL file selected here. This must be stored in the configuration of the RFID device. If i VHLFile ID has the value 0x FF [default], the RFID reader will not take a normal VHL file from its configuration, but a simple ad-hoc file, which can be selected so that non- configured/unencrypted blank cards can be used. i Card Type Mask The i Card Type Mask can be used to set specific transponder card families. Only the set card types are recognized with the command Get Inventory. All other card types are filtered out. If all card types are to be recognized, this value does not have to be changed [default: 0x FFFF]. For each accepted card family, the respective bit is set in the i Card Type Mask. b Reselect If b Reselect is set [default: TRUE], a transponder is specified at the output for each query with the Get Inventory [} 23] command, provided a transponder is in the HF field. If it is ensured that there is only one card before the RFID reader at a time, this setting should be retained. If there is more than one transponder card in the HF field, the RFID device contains a list of detected cards. To be able to select all transponders with the command Get Inventory, b Reselect should be switched off [FALSE]. The command Get Inventory then goes through this list through multiple sequential calls. After the last card has been selected, the feedback e RFR_No Transponder follows. The Get Inventory command does not return the transponder and its serial number to the output again until a card is removed from the HF field and inserted again. b Accept Conf Card If b Accept Conf Card is set [default: TRUE], configuration cards are also recognized with the command Get Inventory. An attempt is made automatically to transfer the configuration on these cards to the RFID reader. This parameter can be disabled to prevent influencing by other configuration cards. Leuze Name Description s Sel Transp SRN The serial number of the transponder to which the command (e.g. read/write) is to be applied can be specified as a string on the input variable s Sel Transp SRN. The data type is T_RFID_Transp SRN [} 66]. This is not necessary in most cases. If a certain reader configuration makes this necessary, details for this are to be found in the relevant description in the proprietary specification. 46 Version: 1.4.0 TF6600
## Page 47

PLC API Pepperl+Fuchs Name Description i Head Number If an RFID reader with several read heads is addressed, the read head is specified in the input variable i Head Number. i Head Number is also referred to as Ident Channel. i DCType With this variable and the command Change DCType [} 25] the transponder type can be set on the read head of Pepperl+Fuchs readers. Possible values for this are listed in the proprietary protocol under the Change Tag command. (They do not match the values of the enumeration E_RFID_Transp Type.) Extract of supported transponder types: b Buffered Cmd Most commands are processed once immediately after the call. Depending on the RFID reader, commands can be present continuously. This enables, among other things, a read process as soon as the RFID transponder enters the reading field, without sending an extra command. This can either be configured in the RFID reader configuration (Balluff, Deister, Leuze) or selected with this input variable (Pepperl+Fuchs). If such a buffered command is active on a read head, the trigger mode may neither be active nor activated for this channel! Similarly, no raw data command may be transmitted that concerns this channel! Delay times The two variables t Pre Send Delay and t Post Send Delay offer the option to parameterize delay times. Both variables ensure that there is a delay between two requests to the RFID reader. If the delay is specified as t Pre Send Delay, a delay between the last response telegram and the next request telegram is ensured. If the request telegram is to be sent as directly as possible, t Post Send Delay can be used. The condition t Time Out > t Pre Send Delay + t Post Send Delay applies. Otherwise an error is generated at the output. A minimum delay time of 300 ms between two commands is specified in the proprietary protocol of the Balluff RFID reader. A minimum delay time of 150 ms between reception and command is specified in the proprietary protocol of the Leuze electronic RFID reader. TF6600 Version: 1.4.0 47
## Page 48

PLC API Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.5 ST_RFID_Config In At the input of the RFID function block, this structure provides the possibility to transfer an arbitrary configuration to the RFID reader. The last RFID reader configuration read is specified at the output with the structure ST_RFID_Config [} 49]. Supplementary information about configurations can be found in its description. Configuration data can be available in the form of a specific configuration structure (ST_RFID_Cfg Struct_Deister UDL, ST_RFID_Cfg Struct_Leuze RFM,…) or also in the form of a configuration register (byte array). This selection can be made with the variable b Use Cfg Reg. (* defines the configuration input parameters. The data can be set via Config structure or Config register. Different RFID Reader in different Reader Groups can differ in their configuration data. *) TYPE ST_RFID_Config In : STRUCT p Cfg : POINTER TO BYTE; (* pointer to config structure or register *) i Cfg Size : UINT := 0; (* size in bytes of the structure or register *) b Use Cfg Reg : BOOL := FALSE; (* Set Config via Register instead of Cfg Structure *) b Use Cfg Default : BOOL := TRUE; (* Set Config using default parameters beside Cfg Structure *) (* An additional option to demand/ set a specific config parameter without transmission of the whole config register. Not possible at all reader models. Set a desired value before calling Get Config/ Set Config or keep the default for full register request. *) i Reg Idx : UINT := 0; i Reg Group : USINT := 0; (* 0:full register; 1:reg.00-0F; 2:single register *) b Reserved : BOOL; END_STRUCT END_TYPE Baltech Name Description p Cfg This pointer must contain the memory address of the configuration to be written. This is the configuration structure ST_RFID_Cfg Struct_Baltech Mif VHLFile. i Cfg Size This input variable indicates the length in bytes of the configuration data specified via the pointer. 48 Version: 1.4.0 TF6600
## Page 49

PLC API Deister Name Description p Cfg This pointer must contain the memory address of the configuration to be written. This can be both a configuration structure and a configuration register. i Cfg Size This input variable indicates the length in bytes of the configuration data specified via the pointer. b Use Cfg Reg If the input variable b Use Cfg Reg is set (TRUE), then a configuration register (byte array) can be addressed via the pointer p Cfg instead of a configuration structure. By default a specific configuration structure is specified. b Use Cfg Default This parameter is relevant only if the configuration data is present in the form of a specific configuration structure. A configuration structure is not specifically an overall representation of the configuration register. The structure contains only the most important configuration parameters. If the input variable b Use Cfg Default is set (TRUE), then default values are used for the unspecified configuration parameters. Otherwise the value of this configuration parameter is not changed, because the last read values are reused. Leuze Name Description p Cfg This pointer must contain the memory address of the configuration to be written. This can be both a configuration structure and a configuration register. i Cfg Size This input variable indicates the length in bytes of the configuration data specified via the pointer. b Use Cfg Reg If the input variable b Use Cfg Reg is set (TRUE), then a configuration register (byte array) can be addressed via the pointer p Cfg instead of a configuration structure. By default a specific configuration structure is specified. b Use Cfg Default This parameter is relevant only if the configuration data is present in the form of a specific configuration structure. A configuration structure is not specifically an overall representation of the configuration register. The structure contains only the most important configuration parameters. If the input variable b Use Cfg Default is set (TRUE), then default values are used for the unspecified configuration parameters. Otherwise the value of this configuration parameter is not changed, because the last read values are reused. i Reg Idx If a special index is specified on i Reg Idx, then exclusively this index of the configuration register is changed/read. To this end, i Reg Group must additionally be specified as "Single Register". This configuration variant is only available for Leuze electronic RFID readers. i Reg Group Three values are available: 0 to change/read the entire configuration register; 1 to change/read the indices 16#00-16#0F of the register; 2 to change/read an individual index of the register, whereby this must be specified with i Reg Idx. This configuration variant is only available for Leuze electronic RFID readers. Further information on RFID reader configuration is summarized in section Configuration [} 39]. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.6 ST_RFID_Config The structure indicates the RFID reader configuration that was last read. This is not the parameterization of the Twin CAT RFID library but the proprietary configuration of the RFID reader. This can be queried using the e RFC_Get Config command (see RFID command set [} 21]). TF6600 Version: 1.4.0 49
## Page 50

PLC API Each configuration can be seen as a register (byte array) or as a structure. Hence, there are various configuration structures in the Twin CAT RFID library (ST_RFID_Cfg Struct_Deister UDL, ST_RFID_Cfg Struct_Leuze RFM,…), which process the raw data from the configuration registers of different RFID readers. Both variants are made available at the output of the library function block. This takes place via pointers. For further evaluation, the MEMCPY() function can be used with the specified data length in bytes. (* defines the configuration as structure and register. Different RFID Reader in different Reader Groups can differ in their configuration data. *) TYPE ST_RFID_Config : STRUCT p Cfg Struct : POINTER TO BYTE; (* pointer to config structure *) p Cfg Reg : POINTER TO BYTE; (* pointer to config register *) i Cfg Struct Size : UINT := 0; (* size in bytes of the structure *) i Cfg Reg Size : UINT := 0; (* size in bytes of the register *) END_STRUCT END_TYPE Name Description p Cfg Struct This pointer indicates the memory address of the specific configuration structure. p Cfg Reg This pointer indicates the memory address of the specific configuration register. i Cfg Struct Size This output variable indicates the length in bytes of the specific configuration structure. i Cfg Reg Size This output variable indicates the length in bytes of the specific configuration register. If i Cfg Reg Size = 0, the configuration data is not available as a register (byte array). Further information on RFID reader configuration is summarized in section Configuration [} 39]. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.7 ST_RFID_Access Data If a read or write command is to be executed, it is necessary to specify the input structure st Access Data. This structure specifies how many and which data should be read and where these should be stored, or how many and which data are to be written. TYPE ST_RFID_Access Data : STRUCT (* access specific parameters *) p Data : POINTER TO BYTE; (* pointer to write data or free space for read data *) i Data Size : UINT; (* length of data buffer in Bytes *) i Start Block : UINT; (* attend that the User Data Start Block which is not obligatory 0 is added automatically. *) i Block Count : UINT; (* condition: Blockcount*Blocksize=Datasize *) i Block Size : UINT := 1; (* in Bytes *) i User Data Start Block : UINT := 0; (* depending on the transponder type its user data memory start s with block index 0 or higher *) (* The upper parameter i Start Block depends on the i User Data Start Block. The used Start Block is i S tart Block+i User Data Start Block. *) (* Different RFID Readers can differ in their interpretation of the first block. *) i Reserved : UINT; END_STRUCT END_TYPE 50 Version: 1.4.0 TF6600
## Page 51

PLC API Name Description p Data The pointer p Data points to the data to be written or to the free storage space for the data to be read. i Data Size Specifies the size of the data in bytes to be written/read. i Start Block Specifies the first block index from which data is to be read from or written to the transponder memory. However, different RFID reader models sometimes interpret this index differently. Example: upon a read command with start index 0, reader A returns the first block of user data and reader B the serial number. i Block Count Specifies the number of blocks that are to be read or written. i Block Size The block size of the user data (in bytes) can be specified by the variable i Block Size. Depending on the transponder and the RFID reader model, only certain settings are possible here (e.g. 8, 4 or 1 byte is common). This should be ascertained in advance from the transponder information and tested. The variable i Block Size is similarly to be selected in correspondence with the setting in the RFID reader configuration. Otherwise it is sometimes possible that access to the transponder or the evaluation of the received data cannot take place. i User Data Start Block With the variable i User Data Start Block the start block (as index of blocks) of the user data can optionally be specified on the transponder. Note the block size (i Block Size). Depending on the transponder, its first blocks can be reserved for system data, such as the serial number. The user data area can accordingly begin at index 0 or also at a higher value. If this is the case, the variable i User Data Start Block can be used to specify this additional parameter and to leave the actual index i Start Block as it is. Both values are added together internally. Access by different RFID readers to the same transponder If different RFID readers are to access the same transponder, then access to the transponder memory must be tested in advance. It is possible that one reader model stores the data blocks in a reversed byte sequence on the transponder compared to another reader model. Or a reader model sees the entire memory area in reverse order compared to another reader model. The readable memory size of the transponder can also vary slightly between different reader models. This depends additionally on the transponder type. The Twin CAT RFID library has no influence on this. The user must select the above input parameters accordingly. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.8 Configuration data 6.2.1.8.1 ST_RFID_Cfg Struct_Baltech Mif VHLFile The structure is suitable for the writing with the command e RFC_Set Config (see RFID command set [} 21]). This is not the parameterization of the Twin CAT RFID library but the proprietary configuration of the RFID reader. TYPE ST_RFID_Cfg Struct_Baltech Mif VHLFile : STRUCT i VHLFile : USINT := 1; (* nr. of VHL file to configure *) i Nr Of Keys : USINT(1..8) := 1; i Nr Of Sectors : USINT(1..56) := 16; (* default: 16 sectors - > 1024 bytes mifare card with 752 bytes user data *) i RC500EEPOffset : USINT := 16#FF; arr Key List : ARRAY [0..7] OF T_RFID_Mifare Key; (* up to 8 keys, 6 byte each *) arr Sector List : ARRAY [0..55] OF BYTE (* up to 56 sectors accessible *) := 0,1,2,3,4,5,6,7,8,9,10, (* default: 16 sectors - > 1024 bytes mifare card with 752 bytes user data *) 11,12,13,14,15,16,17,18,19,20, 21,22,23,24,25,26,27,28,29,30, 31,32,33,34,35,36,37,38,39,40, TF6600 Version: 1.4.0 51
## Page 52

PLC API 41,42,43,44,45,46,47,48,49,50, 51,52,53,54,55; arr Rd Key Assign : ARRAY [0..55] OF BYTE; (* Key index for each sector *) arr Wr Key Assign : ARRAY [0..55] OF BYTE; (* Key index for each sector *) b MAD_Mode : BOOL := FALSE; (* use MAD AID [default = FALSE] *) i MAD_AID : USINT; i Reserved : INT; END_STRUCT END_TYPE Structure of a Mifare card (up to 2 k B memory): A Mifare card with 1 k B memory has 16 sectors with 64 bytes each. Each sector has 4 blocks. Sector 0 consists of blocks 0-3, sector 1 consists of block 4-7, and the following sectors are formed accordingly. In the diagram each column represents a sector, while a box represents a 16-byte block. Only the blocks shown in white contain memory areas that can be used by the user. The maximum size of the user data is therefore 752 bytes (47 x 16 byte) for a 1024-byte Mifare card. 52 Version: 1.4.0 TF6600
## Page 53

PLC API Name Description i VHLFile i VHLFile is used to specify the number of the VHL file to be configured. The configuration of the RFID device can contain several VHL files side by side. i Nr Of Keys i Nr Of Keys is used to specify the required number of keys. 1 to 8 keys can be defined. i Nr Of Sectors i Nr Of Sectors is used to specify the number of sectors to be used for user data. A 1 k B Mifare card has 16 sectors [default: 16]. Example: If only sectors 4-6 are to be used, i Nr Of Sectors = 3 is specified. i RC500EEPOffset This parameter refers to the internal transfer of the keys within the hardware of the RFID device. The default setting [16#FF] guarantees enhanced security. It is recommended to leave this setting unchanged. arr Key List All keys are stored in the array arr Key List. A key is of type T_RFID_Mifare Key and consists of 6 bytes. Example: If two keys are to be used, they are stored in arr Key List[0] and arr Ley List[1]. TYPE T_RFID_Mifare Key : ARRAY[0..5] OF BYTE; END_TYPE arr Sector List In array arr Sector List all sectors are stored that are to be used for user data. Example: If only sectors 4-6 used, the following specification is used: arr Sector List[0]=4, arr Sector List[1]=5, arr Sector List[2]=6. The array is already initialized with consecutive numbering. In most cases no change is required. arr Rd Key Assign In the array arr Rd Key Assign the key index for each used sector is stored. Example: For a 1 k B Mifare card all sectors should be used (i Nr Of Sectors = 16). Two keys are used (i Nr Of Keys = 2) The first half of the sectors on this card should be read with the first key (arr Key List[0]), the second half with the second key (arr Key List[1]). In the array arr Rd Key Assign the indices st Cfg : ST_RFID_Cfg Struct_Baltech Mif VHLFile := (arr Rd Key Assign:=0,0,0,0,0,0,0,0,1, 1,1,1,1,1,1,1); should therefore be stored. If a single key is to be used for all sectors, the key index is 0 for all sectors. The array is already initialized with 0. In this case no change is required. arr Wr Key Assign In the array arr Wr Key Assign the key index for each used sector is stored. Example: For a 1 k B Mifare card all sectors should be used (i Nr Of Sectors = 16). Two keys are used (i Nr Of Keys = 2) The first half of the sectors on this card should be written with the first key (arr Key List[0]), the second half with the second key (arr Key List[1]). In the array arr Wr Key Assign the indices st Cfg:ST_RFID_Cfg Struct_Baltech Mif VHLFile:=(arr Wr Key Assign:=0,0,0,0,0,0,0,0,1,1, 1,1,1,1,1,1); should therefore be stored. If a single key is to be used for all sectors, the key index is 0 for all sectors. The array is already initialized with 0. In this case no change is required. b MAD_Mode If MAD (Mifare Application Directory) with AIDs (Application Identifiers) is to be used instead of the sector allocation, b MAD_Mode must be set (TRUE). The sector allocation is used as standard [default: FALSE]. i MAD_AID The input is only required if MAD (Mifare Application Directory) is used (b MAD_Mode = TRUE). At the configuration input i MAD_AID the MAD AID (Application Identifier) for the VHL file is specified. Further information on the RFID reader configuration process is summarized in section Configuration [} 39]. Detailed information on the VHL file and the configuration of Baltech RFID devices can also be found in the manufacturer's documentation Mifare.pdf and Configuration Values.pdf in the Baltech SDK. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID TF6600 Version: 1.4.0 53
## Page 54

PLC API 6.2.1.8.2 ST_RFID_Cfg Struct_Deister RDL The structure is suitable for writing with e RFC_Set Config and reading with e RFC_Get Config (see RFID command set [} 21]). This is not the parameterization of the Twin CAT RFID library but the proprietary configuration of the RFID reader. TYPE ST_RFID_Cfg Struct_Deister RDL : STRUCT e Op Mode : E_RFID_Op Mode := e RFOP_Read Data; e Trigger Mode : E_RFID_Trigger Mode := e RFTR_Immediate Read; e Read Mode : E_RFID_Read Mode := e RFRD_Single Shot; e Write Mode : E_RFID_Write Mode := e RFWR_Immediate Write; e Network Mode : E_RFID_Network Mode := e RFNM_Stand Alone; b AFI : BOOL := FALSE; (* not implemented; ready for future extention *) i AFI : BYTE; (* not implemented; ready for future extention *) b Serial Number Mode : BOOL := FALSE; b Multi Transp Mode : BOOL := FALSE; b Output Automatic : BOOL := TRUE; i Block Size : USINT := 8; t Output Pulse Time : TIME := T#300ms; e Transp Type : E_RFID_Transp Type := e RFTT_Tag It Hfi; i Count Blocks Read : USINT := 1; i Count Blocks Write : USINT := 1; i Start Block Read : UINT := 16#4000; i Start Block Write : UINT := 5; arr Write Data : ARRAY [0..71] OF BYTE; END_STRUCT END_TYPE 54 Version: 1.4.0 TF6600
## Page 55

PLC API Name Description e Op Mode This operation mode defines which function is triggered by a trigger pulse. The command e RFC_Trigger On or a pulse at the optional trigger input triggers the action set here. If e RFOP_Write Data is set, a write access is executed. If e RFOP_Read Data is set, a read access is executed [default]. The answer telegram that follows is received by the function block of the RFID library. There is no assignment of read transponder data in this case. The received raw data can be taken from the function block interface for further processing. TYPE E_RFID_Op Mode : ( e RFOP_Write Data, e RFOP_Read Data, e RFOP_Read Serial Number );END_TYPE e Trigger Mode If e RFTR_Immediate Read is set, the device is always ready to read. With this setting, the trigger condition is always considered met [default]. if e RFTR_Read With Trigger is set, the device only reads if the trigger condition is met. The e RFC_Trigger On command can be used for this purpose (see RFID command set [} 21]) The subsequent answer telegram is received by the function block of the Twin CAT RFID library. There is no assignment of read transponder data in this case. The received raw data can be taken from the function block interface for further processing. TYPE E_RFID_Trigger Mode : ( e RFTR_Immediate Read, e RFTR_Read With Trigger );END_TYPE e Read Mode If e RFRD_Continuous Read is set, the device reads continuously and continuously outputs read data. If e RFRD_Single Shot is set, the device reads precisely once [default]. TYPE E_RFID_Read Mode : ( e RFRD_Continuous Read, e RFRD_Single Shot );END_TYPE e Write Mode If e RFWR_Immediate Write is set, the transponder must be in the field in order to execute a write or read command correctly [default]. If e RFWR_Write To Next Tag is set, the data from a write command is written to the next transponder. ("Preload") TYPE E_RFID_Write Mode : ( e RFWR_Immediate Write, e RFWR_Write To Next Tag );END_TYPE e Network Mode If e RFNM_Network is set, several devices can be integrated in an RS485 network. If e RFNM_Stand Alone is set, the device is in stand-alone mode [default]. The library does not support the operation of several devices within an RS485 network. TYPE E_RFID_Network Mode :( e RFNM_Network, e RFNM_Stand Alone );END_TYPE b Serial Number Mode If b Serial Number Mode is TRUE, the serial number is transferred with write and read commands. By default, this corresponds to the last transponder serial number detected with the Get Inventory [} 23] command. Otherwise, the transponder serial number is specified in ST_RFID_Control [} 44]. b Multi Transp Mode If b Multi Transp Mode is TRUE, anti-collision is active when several transponders are in the field. b Output Automatic If b Output Automatic is TRUE, the switching output is switched automatically. TF6600 Version: 1.4.0 55
## Page 56

PLC API Name Description i Block Size The block size can be set to 4 or 8 bytes. It must match the block size set for reading and writing in ST_RFID_Access Data [} 50]. t Output Pulse Time t Output Pulse Time is used to configure the action time of the output. The pulse duration of the optional output signal can be set between 30 ms and 9000 ms. e Transp Type If the RFID device is to detect only transponders of a certain type, this can be set with e Transp Type. The value 16#FE is used for unlimited options. The following values are possible (E_RFID_Transp Type [} 65]): e RFTT_ICode e RFTT_STm LRI512 e RFTT_Tag It e RFTT_ICode Sli e RFTT_Infineon SRF55 e RFTT_Inside e RFTT_Tag It Hfi i Count Blocks Read i Count Blocks Read is used to configure the number of blocks that are to be read automatically. The product with i Block Size provides the number of bytes. The maximum number of blocks is between 4 and 9, depending on the block size and other settings. i Count Blocks Write i Count Blocks Write is used to configure the number of blocks to be written automatically. The product with i Block Size provides the number of bytes. The maximum number of blocks is between 4 and 9, depending on the block size and other settings. i Start Block Read i Start Block Read is used to configure the start address for automatic reading. i Start Block Write i Start Block Write is used to configure the start address for automatic writing. arr Write Data Write data are limited to a maximum of 72 bytes. Certain combinations of values are not permitted. The existing dependencies are defined in the proprietary manufacturer's specification. An attempt to write an invalid configuration will result in error e RFERR_Invalid Cfg, or the RFID device receives an error code. Further information on the RFID reader configuration process is summarized in section Configuration [} 39]. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.8.3 ST_RFID_Cfg Struct_Deister UDL The structure is suitable for writing with e RFC_Set Config and reading with e RFC_Get Config (see RFID command set [} 21]). This is not the parameterization of the Twin CAT RFID library but the proprietary configuration of the RFID reader. TYPE ST_RFID_Cfg Struct_Deister UDL : STRUCT e Polling Mode : E_RFID_Polling Mode := e RFPO_Polling Mode; (* CMD: 0x0A OR Byte 32, Bit 5 *) e Trigger Mode : E_RFID_Trigger Mode := e RFTR_Immediate Read; (* Byte 15, Bit 1 *) e Op Mode : E_RFID_Op Mode := e RFOP_Read Serial Number; (* Byte 15, Bit 6,7 *) e Transp Type : E_RFID_Transp Type := e RFTT_EPC1Gen2; (* Byte 33 *) t Output Pulse Time : TIME := T#300ms; (* Byte 38 and 39 *) b Output Level : BOOL; (* TRUE = high; FALSE = low *) i Reserved : USINT; i Count Blocks Read : USINT := 1; (* Byte 41 *) i Count Blocks Write : USINT := 1; (* Byte 43 *) i Start Block Read : UINT := 0; (* Byte 40 *) i Start Block Write : UINT := 0; (* Byte 42 *) 56 Version: 1.4.0 TF6600
## Page 57

PLC API arr Write Data : ARRAY [0..31] OF BYTE; (* Byte 44 - 75 *) END_STRUCT END_TYPE If applicable, the difference between polling and trigger must be taken into account. In addition it must be considered in this context that the Trigger Mode can nevertheless be present in addition to the Polling Mode. TF6600 Version: 1.4.0 57
## Page 58

PLC API Name Description e Polling Mode If e RFPO_Polling Mode is set, the RFID device sends data only on request [default]. If e RFPO_Report Mode is set, the RFID device can transfer data automatically at any time. TYPE E_RFID_Polling Mode :( e RFPO_Report Mode, e RFPO_Polling Mode );END_TYPE e Trigger Mode If e RFTR_Immediate Read is set, the device is always ready to read. With this setting, the trigger condition is always considered met [default]. if e RFTR_Read With Trigger is set, the device only reads if the trigger condition is met. The e RFC_Trigger On command can be used for this purpose (see RFID command set [} 21]). The subsequent answer telegram is received by the function block of the Twin CAT RFID library. There is no assignment of read transponder data in this case. The received raw data can be taken from the function block interface for further processing. TYPE E_RFID_Trigger Mode : ( e RFTR_Immediate Read, e RFTR_Read With Trigger );END_TYPE e Op Mode These operating modes are only available with certain transponder types. If e RFOP_Write Data is set, a write access is executed as soon as a transponder is detected. If e RFOP_Read Data is set, a read access is executed as soon as a transponder is detected. If e RFOP_Read Serial Number is set, no action is executed. The Polling command returns the serial number [default]. The subsequent answer telegram is received by the function block of the Twin CAT RFID library. There is no assignment of read transponder data in this case. The received raw data can be taken from the function block interface for further processing. TYPE E_RFID_Op Mode : ( e RFOP_Write Data, e RFOP_Read Data, e RFOP_Read Serial Number );END_TYPE e Transp Type If the RFID device is to detect only transponders of a certain type, this can be set with e Transp Type. The value 16#FE is used for unlimited options. The following values are possible (E_RFID_Transp Type [} 65]): e RFTT_EPC1Gen1 e RFTT_EPC1Gen2 t Output Pulse Time t Output Pulse Time is used to configure the action time of the output. The pulse duration of the optional output signal can be set between 30 ms and 9000 ms. b Output Level b Output Level is used to influence the control of the optional digital output. After a successful read operation the output can be set to High Level (b Output Level = TRUE) or Low Level (b Output Level = FALSE). i Count Blocks Read i Count Blocks Read is used to configure the number of blocks that are to be read automatically. The product with i Block Size provides the number of bytes. The maximum number of blocks is between 4 and 9, depending on the block size and other settings. The block size depends on the transponder type. i Count Blocks Write i Count Blocks Write is used to configure the number of blocks to be written automatically. The product with i Block Size provides the number of bytes. The maximum number of blocks is between 4 and 9, depending on the block size and other settings. The block size depends on the transponder type. i Start Block Read i Start Block Read is used to configure the start address for automatic reading. i Start Block Write i Start Block Write is used to configure the start address for automatic writing. 58 Version: 1.4.0 TF6600
## Page 59

PLC API Name Description arr Write Data Write data are limited to a maximum of 32 bytes. Further information on the RFID reader configuration process is summarized in section Configuration [} 39]. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.8.4 ST_RFID_Cfg Struct_Leuze RFM The structure is suitable for writing with e RFC_Set Config and reading with e RFC_Get Config (see RFID command set [} 21]). This is not the parameterization of the Twin CAT RFID library but the proprietary configuration of the RFID reader. TYPE ST_RFID_Cfg Struct_Leuze RFM : STRUCT e Op Mode : E_RFID_Op Mode := e RFOP_Read Data; e Trigger Mode : E_RFID_Trigger Mode := e RFTR_Immediate Read; e Read Mode : E_RFID_Read Mode := e RFRD_Single Shot; e Write Mode : E_RFID_Write Mode := e RFWR_Immediate Write; e Network Mode : E_RFID_Network Mode := e RFNM_Network; b AFI : BOOL := FALSE; (* not implemented; ready for future extention *) i AFI : BYTE; (* not implemented; ready for future extention *) b Serial Number Mode : BOOL := FALSE; b Multi Transp Mode : BOOL := FALSE; b Output Automatic : BOOL := TRUE; i Block Size : USINT := 8; t Output Pulse Time : TIME := T#300ms; e Transp Type : E_RFID_Transp Type := e RFTT_Tag It Hfi; i Count Blocks Read : USINT := 1; i Count Blocks Write : USINT := 1; i Start Block Read : UINT := 16#4000; i Start Block Write : UINT := 5; arr Write Data : ARRAY [0..71] OF BYTE; END_STRUCT END_TYPE TF6600 Version: 1.4.0 59
## Page 60

PLC API Name Description e Op Mode This operation mode defines which function is triggered by a trigger pulse. The command e RFC_Trigger On or a pulse at the optional trigger input triggers the action set here. If e RFOP_Write Data is set, a write access is performed. If e RFOP_Read Data is set, a read access is performed [default]. The subsequent answer telegram is received by the function block of the Twin CAT RFID library. There is no assignment of read transponder data in this case. The received raw data can be taken from the function block interface for further processing. TYPE E_RFID_Op Mode : ( e RFOP_Write Data, e RFOP_Read Data, e RFOP_Read Serial Number );END_TYPE e Trigger Mode If e RFTR_Immediate Read is set, the device is always ready to read. With this setting, the trigger condition is always considered met [default]. if e RFTR_Read With Trigger is set, the device only reads if the trigger condition is met. The e RFC_Trigger On command can be used for this purpose (see RFID command set [} 21]). The subsequent answer telegram is received by the function block of the Twin CAT RFID library. There is no assignment of read transponder data in this case. The received raw data can be taken from the function block interface for further processing. TYPE E_RFID_Trigger Mode : ( e RFTR_Immediate Read, e RFTR_Read With Trigger );END_TYPE e Read Mode If e RFRD_Continuous Read is set, the device reads continuously and continuously outputs read data. If e RFRD_Single Shot is set, the device reads precisely once [default]. TYPE E_RFID_Read Mode : ( e RFRD_Continuous Read, e RFRD_Single Shot );END_TYPE e Write Mode If e RFWR_Immediate Write is set, the transponder must be in the field in order to execute a write or read command correctly [default]. If e RFWR_Write To Next Tag is set, the data from a write command is written to the next transponder. ("Preload") TYPE E_RFID_Write Mode : ( e RFWR_Immediate Write, e RFWR_Write To Next Tag );END_TYPE e Network Mode If e RFNM_Network is set, several devices can be integrated in an RS485 network [default]. If e RFNM_Stand Alone is set, the device is in stand-alone mode. The library does not support the operation of several devices within an RS485 network. TYPE E_RFID_Network Mode :( e RFNM_Network, e RFNM_Stand Alone );END_TYPE b Serial Number Mode If b Serial Number Mode is TRUE, the serial number is transferred with write and read commands. By default this is the last transponder serial number detected with the command Get Inventory. Otherwise, the transponder serial number is specified in ST_RFID_Control [} 44]. b Multi Transp Mode If b Multi Transp Mode is TRUE, anti-collision is active when several transponders are in the field. 60 Version: 1.4.0 TF6600
## Page 61

PLC API Name Description b Output Automatic If b Output Automatic is TRUE, the switching output is switched automatically. i Block Size The block size can be set to 4 or 8 bytes. It must match the block size set for reading and writing in ST_RFID_Access Data [} 50]. t Output Pulse Time t Output Pulse Time is used to configure the action time of the output. The pulse duration of the optional output signal can be set between 30 ms and 9000 ms. e Transp Type If the RFID device only recognizes transponders of one type, this can be set with e Transp Type. The value 16#FE is used for unlimited options. The following values are possible (E_RFID_Transp Type [} 65]): e RFTT_ICode e RFTT_STm LRI512 e RFTT_Tag It e RFTT_ICode Sli e RFTT_Infineon SRF55 e RFTT_Inside e RFTT_Tag It Hfi i Count Blocks Read i Count Blocks Read is used to configure the number of blocks that are to be read automatically. The product with i Block Size provides the number of bytes. The maximum number of blocks is between 4 and 9, depending on the block size and other settings. i Count Blocks Write i Count Blocks Write is used to configure the number of blocks to be written automatically. The product with i Block Size provides the number of bytes. The maximum number of blocks is between 4 and 9, depending on the block size and other settings. i Start Block Read i Start Block Read is used to configure the start address for automatic reading. i Start Block Write i Start Block Write is used to configure the start address for automatic writing. arr Write Data Write data are limited to a maximum of 72 bytes. Certain combinations of values are not permitted. The existing dependencies are defined in the proprietary manufacturer's specification. An attempt to write an invalid configuration will result in error e RFERR_Invalid Cfg, or the RFID device receives an error code. Further information on the RFID reader configuration process is summarized in section Configuration [} 39]. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.1.8.5 ST_RFID_Cfg Struct_Pepperl Fuchs IDENT The structure is suitable for reading with e RFC_Get Config (see RFID command set [} 21]). This is not the parameterization of the Twin CAT RFID library but the proprietary configuration of the RFID reader. TYPE ST_RFID_Cfg Struct_Pepperl Fuchs IDENT : STRUCT t Timeout :TIME; i Baudrate :UINT; i Ident Channel :USINT; b Multiplex Mode :BOOL; arr Head Cfg :ARRAY [0..3] OF ST_RFID_Head Cfg; arr Trigger Cfg :ARRAY [0..1] OF ST_RFID_Trigger Cfg; END_STRUCT END_TYPE The Ident Control Compact device from Pepper+Fuchs consists of a central unit and 1-4 write/read heads. Each of these five elements has an ID channel (Ident Channel) that can be used for assigning commands to individual elements. In the standard case, the central unit is assigned channel 0 and the write/read heads channels 1-4. TF6600 Version: 1.4.0 61
## Page 62

PLC API The e RFC_Get Config command together with the data at output st Reader Cfg can be used to check the settings for all ID channels. Name Description t Timeout t Time Out specifies the duration for which the RFID device waits for further telegram data. An error message is issued if the device has not detected a comprehensible command after this time. (The default is 0 ms) i Baudrate i Baudrate is used to display the current baud rate of the RFID device. The supported RFID devices have a maximum transfer rate of 38400 baud. i Ident Channel ID channel of the central unit b Multiplex Mode In multiplex mode, mutual interference between the read/write heads is minimized because only one head is active at a time. arr Head Cfg Devices with up to four write/read heads are available. Each head has a status and a Data Carrier Type. This information is stored per head in a structure of type ST_RFID_Head Cfg. The status of the central unit is output in i Err Code Rcv directly at the output of FB_RFIDReader [} 34]. Possible values for i DCType are explained in ST_RFID_Control [} 44]. TYPE ST_RFID_Head Cfg : STRUCT e Status :E_RFID_Err Code Rcv_Pepperl Fuchs; i DCType :USINT; (* not equal to E_RFID_Transp Type enumeration *) i Reserved :USINT; END_STRUCT END_TYPE arr Trigger Cfg Devices with up to four write/read heads are available. Each head has an i Ident Channel and a b Trigger Mode. For each trigger sensor this information is stored in a structure of type ST_RFID_Trigger Cfg. i Ident Channel indicates the write/read head for which the trigger sensor is configured. If i Trigger Mode is TRUE, the trigger mode is active for a trigger sensor. If b Inverted is TRUE, it is an inverted trigger signal. For more information on the trigger mode, see section Pepperl-Fuchs [} 31] TYPE ST_RFID_Trigger Cfg : STRUCT i Ident Channel :USINT; b Trigger Mode :BOOL; b Inverted :BOOL; b Reserved :BOOL; END_STRUCT END_TYPE Further information on the RFID reader configuration process is summarized in section Configuration [} 39]. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.2 Enumerations 6.2.2.1 E_RFID_Command TYPE E_RFID_Command : ( e RFC_Unknown := 0, e RFC_Get Reader Version, e RFC_Get Config, e RFC_Set Config, e RFC_Get Inventory, e RFC_Polling, e RFC_Trigger On, e RFC_Trigger Off, e RFC_Abort Command, 62 Version: 1.4.0 TF6600
## Page 63

PLC API e RFC_Reset Reader, e RFC_Read Block, e RFC_Write Block, e RFC_Output On, e RFC_Output Off, e RFC_Field On, e RFC_Field Off, e RFC_Send Raw Data, e RFC_Change DCType END_TYPE The function block FB_RFIDReader [} 34] of the Twin CAT PLC RFID library provides the enumeration values displayed in the code area at the e Command input. This is a selection of commands, such as writing to or reading a transponder. Detailed explanations of the commands can be found in the section RFID command set [} 21]. Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.2.2 E_RFID_Response TYPE E_RFID_Response : ( e RFR_No Rsp, e RFR_Unknown, e RFR_Ready, e RFR_Cmd Confirmation, e RFR_Cfg Change Executed, e RFR_Write Cmd Succeded, e RFR_No Transponder, e RFR_Error, e RFR_Data_Reader Version, e RFR_Data_Config, e RFR_Data_Inventory, e RFR_Data_Read Data ); END_TYPE The function block FB_RFIDReader [} 34] of the Twin CAT PLC RFID library offers the enumeration values displayed in the code area at the e Response output. These are partly analogous to the telegram response types of the manufacturer-specific protocols. Which manufacturer-specific Message ID corresponds to the response listed here is indicated in italics in the following description. Due to the complexity of the evaluation, not all equivalents are listed. If necessary, detailed information is given by the raw data representation ST_RFID_Raw Data [} 43] at the output of the function block. TF6600 Version: 1.4.0 63
## Page 64

PLC API Value Description e RFR_No Rsp This value indicates that no response has arrived recently. e RFR_Unknown This value indicates that the telegram that arrived could not be assigned to a certain type and was therefore also not evaluated. This is usually accompanied by an error message (b Error = TRUE). e RFR_Ready Some RFID reader models indicate their operational readiness, e.g. after a reset, with an extra telegram. In this case e Response assumes the value e RFR_Ready. Equivalent in proprietary protocol: Leuze: 'S' Pepperl+Fuchs: Status='2' e RFR_Cmd Confirmation The sent command is confirmed with this response. This can occur with many commands. Exceptions are the commands "Changing the configuration" and "Writing data", because these two commands are followed by special confirmations, which are represented by the following two enumeration values. Equivalent in proprietary protocol: Leuze: 'Q2', 'Q4' e RFR_Cfg Change Executed If the RFID reader configuration has been changed, the RFID reader sends this telegram to confirm the action. Equivalent in proprietary protocol: Leuze: 'Q1' e RFR_Write Cmd Succeded The RFID reader sends this confirmation as soon as data has been written to the transponder. Equivalent in proprietary protocol: Leuze: 'Q5' e RFR_No Transponder This response is given if no transponder is in the reading field. This is not necessarily evaluated as an error, so that the output b Error is also not set. Equivalent in proprietary protocol: Leuze: '$18' Pepperl+Fuchs: Status='5' e RFR_Error If a telegram has been received that transferred an error code, then e RFR_Error is output at the e Response output. The transmitted error code is specified in the output variable i Err Code Rcv (see RFID error codes [} 75]). If e Response assumes the value e RFR_Error, an error is also signaled by b Error = TRUE at the output of the function block. Equivalent in proprietary protocol: Balluff: <NAK>+Failurenumber Deister: Message Error Code>=16#20 Leuze: 'Exx', 'Q0' e RFR_Data_Reader Version An RFID reader is requested by a version query to send model information. This kind of received data is designated with the value e RFR_Data_Reader Version at the e Response output. e RFR_Data_Config A read RFID reader configuration is indicated by the enumeration value e RFR_Data_Config. Equivalent in proprietary protocol: Leuze: 'G' e RFR_Data_Inventory This type of telegram is indicated if a transponder has been detected or if the serial number of a transponder has been read. e RFR_Data_Read Data Receipt of data read from the transponder memory is signaled by the value e RFR_Data_Read Data. Equivalent in proprietary protocol: Deister: Message ID=16#40 or 16#41 64 Version: 1.4.0 TF6600
## Page 65

PLC API Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.2.3 E_RFID_Reader Group TYPE E_RFID_Reader Group : ( e RFRG_Unknown, e RFRG_Balluff BIS, e RFRG_Deister Basic, e RFRG_Deister RDL, e RFRG_Deister UDL, e RFRG_Deister VReader, e RFRG_Leuze RFM, e RFRG_Pepperl Fuchs IDENT, e RFRG_Baltech IDE ); END_TYPE Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.2.4 E_RFID_Reader Manufacturer TYPE E_RFID_Reader Manufacturer : ( e RFRM_Unknown, e RFRM_Balluff, e RFRM_Deister, e RFRM_Leuze, e RFRM_Pepperl Fuchs, e RFRM_Baltech ); END_TYPE Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.2.5 E_RFID_Transp Type TYPE E_RFID_Transp Type : ( e RFTT_No Tag, e RFTT_Type Unknown, e RFTT_ATA5590, e RFTT_ATA5590UID, e RFTT_EM4022_4222, e RFTT_EM4135, e RFTT_EPC1Gen1, e RFTT_EPC1Gen2, e RFTT_Fujitsu MB89R118, e RFTT_ICode, e RFTT_ICode Sli, e RFTT_Infineon SLE55, e RFTT_Infineon SRF55, (* also known as Infineon my-d vicinity *) e RFTT_Inside, e RFTT_ISO180006Typ B, e RFTT_Legic Prime, e RFTT_Legic Advant, e RFTT_Mifare Classic, (* Philips *) e RFTT_Mifare Ultra Light, e RFTT_Mifare DESFire, e RFTT_STm LRI512, e RFTT_Tag It, e RFTT_Tag It Hfi, (* TI *) e RFTT_UCode EPC119, (* Philips *) TF6600 Version: 1.4.0 65
## Page 66

PLC API e RFTT_PICOPASS (* INSIDE Contactless *) ); END_TYPE Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.2.3 T_RFID_Transp SRN (* serial number shown as hex coded string(ascii) *) TYPE T_RFID_Transp SRN : STRING(i RFID_MAXSRNLENGTH); END_TYPE The data type contains an RFID transponder serial number. The serial number of the transponder (often 8 bytes) is specified as a string in hexadecimal format. (i RFID_MAXSRNLENGTH = 51) Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 6.3 Global Constants 6.3.1 Global_version All libraries have a certain version. The version is indicated in the PLC library repository, for example. A global constant of type ST_Lib Version contains the library version information: VAR_GLOBAL CONSTANT st Lib Version_Tc2_RFID : ST_Lib Version; END_VAR To check whether the version you have is the version you need, use the function F_Cmp Lib Version (defined in the Tc2_System library). All other options for comparing library versions, which you may know from Twin CAT 2, are outdated. 66 Version: 1.4.0 TF6600
## Page 67

Examples 7 Examples The following examples have been developed using different RFID reader models. Since there are basically hardly any differences in the handling of the RFID reader with the Twin CAT RFID library, an example developed with another model can also be used for familiarization. Tutorial The Tutorial describes how an RFID reader is put into operation. It is a step-by-step procedure, from the integration of the Twin CAT library through to the detection of the presence of RFID transponders. (See Tutorial [} 67]) Example 1 This example can be used for different RFID readers (Balluff, Baltech, Deister, Leuze, Pepper+Fuchs). The example is tested with the Balluff BIS M 401 and Leuze electronic RFM32 models. In the project, an RFID reader was connected to a 1-channel serial EL6001 (on an EK1100). Other serial terminals can also be used. The project can similarly be used for two RFID readers. The sample program is already prepared for two RFID readers. Only the second linking in the Twin CAT System Manager needs to be carried out. (See Sample 1 [} 71]) Example 2 This example was developed with a Baltech RFID reader, which is optionally installed in the Beckhoff Control Panels and Panel PCs. The device is connected to a serial Com port or a USB port. It can be used for convenient commissioning and testing of the device. The example features a simple visualization. (See Sample 2 [} 72]) Example 3 This example corresponds to a small application. The application includes detection, reading and writing of a transponder in an automatic sequence. The example was created with a Pepperl+Fuchs RFID reader. Both the 2-channel and the 4-channel model can be used. (See Sample 3 [} 73]) 7.1 Tutorial This tutorial shows how you can commission an RFID reader using the Twin CAT PLC. The tutorial is conducted with the RFID reader model Balluff BIS M 401. In principle, however, the same procedure can be adopted for other models. The following steps are thereby performed: 1. Glossary 2. Installation/libraries 3. Serial connection 4. Function block declaration 5. Function block usage 6. Test Assumptions: • You have planned your RFID application in detail and already modeled your application. • You have determined that a reader supported by the Tc2_RFID library basically meets your requirements and you can implement your application with the commands offered. TF6600 Version: 1.4.0 67
## Page 68

Examples • You decide to use the Twin CAT RFID library to facilitate communication with your RFID reader. Download: https://infosys.beckhoff.com/content/1033/tf6600_tc3_rfid/Resources/234213899.zip Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 7.1.1 Glossary Term Explanation CT Carrier type, data carrier type, transponder type DC Data carrier - RFID transponder (data memory) HF High Frequency Label RFID Transponder LF Low Frequency RF Radio Frequency RFID Radio Frequency Identifícation RFID Reader A RFID reader can be both a purely readable device and a read/ write device. Smart Label RFID Transponder SRN Serial Number Tag RFID Transponder UHF Ultra High Frequency See: Installation/libraries [} 68] 7.1.2 Installation/libraries 1. Start the Twin CAT XAE. 2. Create a new Twin CAT project (menu File > command New). 3. Create a new PLC project (context menu of the PLC object in the Twin CAT project tree > command Add New Item). 4. Select your target platform PC and CX (x86, x64). 5. Add the libraries Tc2_RFID and Tc2_Serial Com to the PLC project (context menu of the Reference object > command Add library) ð All required PLC modules for RFID reader communication are available. See: Serial connection [} 68] 7.1.3 Serial connection In this example the RFID reader is connected via a serial EL6001 Ether CAT Terminal. 1. Create a send buffer and a receive buffer (g EL6Com Tx Buffer, g EL6Com Rx Buffer) of type "Com Buffer". In addition, you should create two data structures as they are used for serial communication in the Twin CAT System Manager. g EL6Com Rx Buffer :Com Buffer; g EL6Com Tx Buffer :Com Buffer; EL6Com In Data AT %I* : EL6Com In Data; EL6Com Out Data AT %Q* : EL6Com Out Data; 2. Link the structures in the Twin CAT System Manager to the channels of the serial port. 3. For serial communication, create an instance of the Serial Line Control. Call this cyclically in a fast task. (Mode: Enter the Ether CAT Terminal with 22 bytes of user data as handle.) 68 Version: 1.4.0 TF6600
## Page 69

Examples Line Control( Mode := SERIALLINEMODE_EL6_22B, p Com In := ADR(EL6Com In Data), p Com Out := ADR(EL6Com Out Data), Size Com In := SIZEOF(EL6Com In Data), Tx Buffer := g EL6Com Tx Buffer, Rx Buffer := g EL6Com Rx Buffer ); See: RFID reader connection [} 19] and Function block declaration [} 69] 7.1.4 Function block declaration The function block FB_RFIDReader is the core of the entire RFID reader communication. The declaration and initialization of the function block is described below. 1. Create an instance of the function block FB_RFIDReader. 2. Hand over the manufacturer of your RFID model to the instance at the e Manufacturer input. fb RFIDReader : FB_RFIDReader := (e Manufacturer := e RFRM_Balluff); s Transp Serial Number : STRING; FB_RFIDReader has 7 inputs (6 in the case of the specific FBs due to the missing manufacturer data), 2 inputs/outputs and 10 outputs. To receive messages sent by the RFID reader to the controller, it is sufficient to call the function block cyclically. The b Execute input must thereby remain FALSE. This is used in this example to implement simple presence detection for the time being. 3. Call the function block as follows: fb RFIDReader( b Execute := FALSE, Rx Buffer := Rx Buffer, Tx Buffer := Tx Buffer, b Busy => , b Error => , i Error ID => , i Err Code Rcv => ); s Transp Serial Number := fb RFIDReader.st Transpinfo.s Serial Number; Now the last read serial number of an RFID transponder is shown in your string variable. For error analysis the outputs b Error and i Error ID etc. should also be evaluated. See: Using the function block [} 69] 7.1.5 Using the function block You can achieve a more effective evaluation of the received data with the following instructions: Declarations: fb RFIDReader : FB_RFIDReader := (e Manufacturer := e RFRM_Balluff); s Transp Serial Number : STRING; b Busy : BOOL; b Error : BOOL; i Error ID : UINT; TF6600 Version: 1.4.0 69
## Page 70

Examples i Err Code Rcv : UINT; st Transp Info : ST_RFID_Transp Info; e Error ID : E_RFID_Err ID; e Err Code Rcv : E_RFID_Err Code Rcv_Balluff; fb Trigger Response : R_TRIG; arr Rsp Rcv : ARRAY[0..99] OF BYTE; Program sequence: fb RFIDReader( b Execute := FALSE, Rx Buffer := Rx Buffer, Tx Buffer := Tx Buffer, b Busy => b Busy, b Error => b Error, i Error ID => i Error ID, i Err Code Rcv => i Err Code Rcv ); (* convert Error Codes *) e Error ID := UINT_TO_INT(i Error ID); e Err Code Rcv := UINT_TO_INT(i Err Code Rcv); fb Trigger Response(CLK := fb RFIDReader.b Response Rcv); IF (fb Trigger Response. Q) THEN st Transp Info := fb RFIDReader.st Transp Info; s Transp Serial Number := st Transp Info.s Serial Number; (* detected RFID Tag Serial Number *) MEMSET(ADR(arr Rsp Rcv), 0 , SIZEOF(arr Rsp Rcv) ); MEMCPY(ADR(arr Rsp Rcv), fb RFIDReader.st Raw Data.p Received Rsp, MIN(fb RFIDReader.st Raw Data.i Received Rsp Len, SIZEOF(arr Rsp Rcv)) ); END_IF Received error codes can be represented online as enumeration values by directly assigning the integer variables i Error ID and i Err Code Rcv. Using a trigger, additional data is only evaluated when a new message is received. The string variable s Transp Serial Number now always returns the serial number of the last detected transponder. In this case this can also be seen at the function block output fb RFIDReader.st Transp Info.s Serial Number. Depending on the application, further information can be taken from the outputs of the function block. In order to display a received message as a complete byte sequence, use the MEMCPY function, for example, and copy the raw data into your declared byte array. Each message from your RFID reader is now received and evaluated in the above manner. See: Test [} 70] 7.1.6 Test As soon as you have created the program according to the procedure described, activate the current configuration with the linked variables in the Twin CAT System Manager and set Twin CAT to Run mode. Log into the controller and start the application. If you move a transponder in front of your RFID reader, this is detected and the received message as well as the serial number are adopted in the program code. The values are represented online in the program code or in an additional visualization. Device configuration The Balluff RFID reader must be configured in a way that is suitable for this functionality. The option Type and serial number with CT pres. must be activated. These and other configuration parameters are described in more detail in the section Balluff > RFID reader settings [} 26]. Not every RFID reader supports this setting. 70 Version: 1.4.0 TF6600
## Page 71

Examples Download: https://infosys.beckhoff.com/content/1033/tf6600_tc3_rfid/Resources/234213899.zip 7.2 Sample 1 This example can be used for different RFID readers (Balluff, Baltech, Deister, Leuze, Pepper+Fuchs). The example has been tested with the Balluff BIS M 401 and Leuze electronic RFM32 models. In the project, an RFID reader was connected to a single-channel serial EL6001 (on an EK1100). Other serial terminals can also be used. When using KL terminals, the call of the Serial Line Control in the program code must be adapted. (See RFID reader connection [} 19]) The project can similarly be used for two RFID readers. The sample program is already prepared for two RFID readers. Only the second linking in the Twin CAT System Manager needs to be carried out. The example project contains the call of the RFID function block with different commands. The most important commands were implemented in this example. This includes reading from and writing to the RFID transponder memory. After starting the program, a suitable RFID reader manufacturer must be selected via the local enumeration e Manufacturer. The command type can be selected using the local e Command enumeration. In order to start the call, the local variable b Execute must be set once to TRUE. After that, the results of the query are shown at the outputs of the RFID function block. Alternatively, the operation can be take place with the visualization integrated in the example: Depending on the RFID reader model, the Get Reader Version [} 22] and Get Config [} 22] (if necessary also Set Config [} 23]) commands must be executed first, in order to make correct communication with the RFID reader possible. TF6600 Version: 1.4.0 71
## Page 72

Examples For further information on the RFID reader communication process, refer to the section Function block FB_RFIDReader > Handling instructions [} 38]. Download: https://infosys.beckhoff.com/content/1033/tf6600_tc3_rfid/Resources/5252190859.zip Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 7.3 Sample 2 This example was developed with a Baltech RFID reader, which is optionally installed in the Beckhoff Control Panels and Panel PCs. The device is connected to a serial Com port or a USB port. It can be used for convenient commissioning and testing of the device. If a Baltech RFID reader is used that is connected to a serial Beckhoff terminal instead of to the Com port, the serial background communication in the PLC code must be changed and reconfigured in the Twin CAT System Manager. (See RFID reader interfacing [} 19]) The example project contains the call of the RFID function block with different commands. The commands can be executed using the built-in visualization. The commands Get Reader Version [} 22], Get Inventory [} 23], Read Block [} 24] and Write Block [} 24] are implemented. Thus, an RFID transponder can also be tested and data can be written to and read from it in the form of an ASCII string. 72 Version: 1.4.0 TF6600
## Page 73

Examples The RFID reader must first be initialized to enable correct communication with the RFID reader. The button Init Rfid Reader executes the command Get Reader Version. For further information on the RFID reader communication process, refer to the section Function block FB_RFIDReader > Handling instructions [} 38]. Activating Log View output displays the complete serial transmission in the Twin CAT System Manager Logger View. Download: https://infosys.beckhoff.com/content/1033/tf6600_tc3_rfid/Resources/227370251.zip or https:// infosys.beckhoff.com/content/1033/tf6600_tc3_rfid/Resources/949454859.zip Requirements Development environment Target platform PLC libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID v3.3.6.0 7.4 Sample 3 This example corresponds to a small application. The application includes detection, reading and writing of a transponder in an automatic sequence. TF6600 Version: 1.4.0 73
## Page 74

Examples The example was created with a Pepperl+Fuchs RFID reader. Both the 2-channel and the 4-channel model can be used. In the example, the device is connected directly to the Com port. If a Pepperl+Fuchs RFID reader is used that is connected to a serial Beckhoff terminal instead of to the Com port, the serial background communication in the PLC code must be changed and reconfigured in the Twin CAT System Manager. (See RFID reader interfacing [} 19]) Sequence of the implemented application: Two read/write heads are connected to the RFID device. Both detect transponders arriving in the field fully automatically. After detection, a memory block is read out from the transponder's data memory. The 4-byte value in it is incremented by one by the first read head or decremented by one by the second read head. The new value is immediately written back to the transponder. This process of detection, reading and writing takes about half a second in total. There must be an interval of at least three seconds between two such processes on the same read head in order to avoid unwanted multiple execution. (This can also be solved by checking the tag serial number.) The program essentially contains a state machine with 6 states: 0: Initialization - running Get Reader Version, Get Config etc. 1: Tag detection on read head 1 - buffered Get Inventory 2: Tag detection on read head 2 - buffered Get Inventory 3: Waiting for tag detection 4: Action at read head 1 - Read Block and Write Block 5: Action at read head 2 - Read Block and Write Block The data carrier type (i USEDDCTYPE) should be adapted to the transponder types used. The example project contains the call of the RFID function block with different commands. For further information on the RFID reader communication process, refer to the section Function block FB_RFIDReader > Handling instructions [} 38]. Download: https://infosys.beckhoff.com/content/1033/tf6600_tc3_rfid/Resources/5252195339.zip Requirements Development Environment Target Platform PLC Libraries to include TC3.1.4013 PC or CX (x86, x64) Tc2_RFID 74 Version: 1.4.0 TF6600
## Page 75

Appendix 8 Appendix 8.1 RFID error codes Error outputs are provided at two outputs of the RFID PLC function block. The two output variables i Error ID [} 75] and i Err Code Rcv [} 77] are described below. i Error ID If there is an error, the output variable i Erro ID indicates the type of error. The successor list shows the possible values. TYPE E_RFID_Err ID :( e RFERR_No Error := 0, (* general errors *) e RFERR_Time Out Elapsed := 16#4001, (* invalid input parameters *) e RFERR_Invalid Command := 16#4101, e RFERR_Incompatible Cfg := 16#4102, e RFERR_Invalid Manufacturer := 16#4103, e RFERR_Invalid Time Out Param := 16#4104, e RFERR_Invalid Raw Data Param := 16#4105, e RFERR_Invalid Access Data := 16#4106, e RFERR_Invalid Cfg := 16#4107, e RFERR_Invalid Cfg Param := 16#4108, e RFERR_Invalid Ctrl Head Number := 16#4109, (* error at receive of response *) e RFERR_Invalid Response := 16#4201, e RFERR_Invalid Rsp Len := 16#4202, e RFERR_Invalid Blocksize := 16#4203, e RFERR_Error Rcv := 16#4204, e RFERR_Checksum Error := 16#4205, (* internal errors *) e RFERR_Unknown Reader Group := 16#4401, e RFERR_Created Telegram Too Big := 16#4402 ); END_TYPE If i Error ID has the value e RFERR_Error Rcv, an error code was received from the RFID reader. This received error code is indicated in the output variable i Err Code Rcv. If i Error ID has a different value, an error may also have been received from the RFID reader, which is also displayed in the output variable i Err Code Rcv. TF6600 Version: 1.4.0 75
## Page 76

Appendix Value ID ID Description (hex) (dec) e RFERR_Time Out Elapsed 0x4001 16385 This error occurs if the time period specified as timeout at the input (default = 5 s) has elapsed. Any action still being processed will hence be aborted. A timeout error also occurs if serial background communication does not work. This may be the case, for example, if an incorrect baud rate is set or if the task cycle time is not sufficient to process the data. See also: RFID reader connection [} 19] and Documentation of the PLC library Serial communication. e RFERR_Invalid Command 0x4101 16641 The command has not been executed. The selected command cannot be executed with this RFID reader model. The available commands are listed in the command set [} 21]. To ensure that the function block knows the existing RFID reader model, the "Get Reader Version" command must be executed first, if possible. e RFERR_Incompatible Cfg 0x4102 16642 The command has not been executed. The current RFID reader configuration (see output structure ST_RFID_Config [} 49]) is not compatible with the selected command (and the associated input parameters). Ensure that the configuration has been read once before. Otherwise this error code may also occur. e RFERR_Invalid Manufacturer 0x4103 16643 The RFID manufacturer of the RFID reader model must be specified with the variable "e Manufacturer" at the input of the generic function block FB_RFIDReader. The error e RFERR_Invalid Manufacturer indicates invalid data. e RFERR_Invalid Time Out Param 0x4104 16644 This error is output if the input variable t Time Out is invalid. The condition t Time Out > t Pre Send Delay + t Post Send Delay applies. e RFERR_Invalid Raw Data Param 0x4105 16645 If raw data is to be sent, it must be specified at the input of the function block. The error e RFERR_Invalid Raw Data Param is output if the specification of the input variables p Raw Data Command or i Raw Data Command Len is invalid. See also: Low-level communication [} 40]. e RFERR_Invalid Access Data 0x4106 16646 The command was not executed because the parameters specified at the input in the structure ST_RFID_Access Data [} 50] are invalid. e RFERR_Invalid Cfg 0x4107 16647 The command 'Changing the configuration' was not executed because the specified configuration data are invalid. The configuration data are present as a configuration structure (b Use Cfg Reg = FALSE). In the case of doubt, the exact valid ranges of values for the data are given in the manufacturer’s proprietary protocol specification. If the last read configuration is used for parameters that are not available in the configuration structure (b Use Cfg Default = FALSE in ST_RFID_Config In [} 48]), make sure that the configuration was read first. Otherwise this error code may also occur. e RFERR_Invalid Cfg Param 0x4108 16648 The command "Changing the configuration" was not executed because the specified input parameters of the configuration data are invalid. The configuration data should be present as a configuration register or a configuration structure. Its length or another parameter in ST_RFID_Config In [} 48] is invalid. e RFERR_Invalid Ctrl Head Number 0x4109 16649 If an RFID reader with several read heads is addressed, the read head is specified in the input structure ST_RFID_Control [} 44]. If no read head is available for the specified value, this error value is output. e RFERR_Invalid Response 0x4201 16897 This error is output if the byte sequence of the received response does not correspond to any known message type or if individual bytes do not have the required values. The received data can be analyzed as a raw data block at the output ST_RFID_Raw Data [} 43]. e RFERR_Invalid Rsp Len 0x4202 16898 This error message is generated if the byte sequence theoretically corresponds to a known message type, but the length is not as expected. The received data can be analyzed as a raw data block at the output ST_RFID_Raw Data [} 43]. e RFERR_Invalid Blocksize 0x4203 16899 If this error value occurs, then the received data read out from the transponder could not be evaluated. The number of received bytes indicates that the configured block size does not correspond to the input at the command call. e RFERR_Error Rcv 0x4204 16900 An error code was sent with the received message. The error displayed by the RFID reader is also output and represented by the output variable “i Err Code Rcv” (explanation at the end of this section). e RFERR_Checksum Error 0x4205 16901 Depending on the protocol specification a checksum, for example a CRC checksum, is sent with the telegram. If a telegram with an incorrect checksum is received by the controller, then this error is output. e RFERR_Unknown Reader Group 0x4401 17409 The RFID library assigns the RFID reader models internally to groups. The error "e RFERR_Unknown Reader Group" can occur if the RFID reader is not yet assigned to a group. Therefore, depending on the RFID reader model, the "Get Reader Version" command must be executed as the first query when the program starts. 76 Version: 1.4.0 TF6600
## Page 77

Appendix Value ID ID Description (hex) (dec) e RFERR_Created Telegram Too Bi 0x4402 17410 An attempt was made to send a telegram that exceeded the maximum size of g 300 bytes. Only telegrams with up to 300 bytes can be sent. In a few cases, the RFID device sends several telegrams directly one after the other. It is therefore important to always detect and correct the first error that occurred. i Err Code Rcv If an error code is sent along by the RFID reader, it is output at the output variable i Err Code Rcv. Sometimes status messages are sent by the RFID reader and then sent to i Err Code Rcv, which do not lead to an error (b Error remains FALSE and i Error ID shows no error). A list of possible values can either be found in the data type declarations (E_RFID_Err Code Rcv_Balluff, E_RFID_Err Code Rcv_Deister, E_RFID_Err Code Rcv_Leuze etc.) of the PLC RFID library via the Twin CAT XAE library details or directly in the protocol specification. For further error analysis, reference is made to the logging option. To this end, the input parameter b Logging is set. See the Parameter description in API [} 44] for details. TF6600 Version: 1.4.0 77
## Page 78

Support and Service 9 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 78 Version: 1.4.0 TF6600
## Page 79

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Arm, Arm9 and Cortex are trademarks or registered trademarks of Arm Limited (or its subsidiaries or affiliates) in the US and/or elsewhere. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 80

More Information: www.beckhoff.com/tf6600 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
