---
title: "TF6620 Twin CAT 3"
product: "TF6620"
category: "Communication"
tags: ["CAT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.5.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6620_TC3_S7_Communication_EN.pdf"
release_date: "2025-08-13"
---
Manual | EN TF6620 Twin CAT 3 | S7 Communication 2025-08-13 | Version: 1.5.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 1.4 Documentation issue status.............................................................................................................. 7 2 Overview.................................................................................................................................................... 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation......................................................................................................................................... 9 3.3 Installation from Twin CAT 4026...................................................................................................... 12 3.4 Licensing......................................................................................................................................... 12 4 Technical introduction............................................................................................................................ 15 4.1 Getting started................................................................................................................................. 15 4.2 Mapping vs. PLC library.................................................................................................................. 20 4.3 Single Request vs. Cyclic Request................................................................................................... 21 4.4 Symbol server interface.................................................................................................................. 22 4.5 Importing and exporting data points................................................................................................ 25 4.6 Supported systems and functionalities............................................................................................ 26 4.7 Technical restrictions...................................................................................................................... 26 4.8 Activating the S7 protocol access................................................................................................... 27 4.9 Optimization options........................................................................................................................ 29 4.10 String lengths.................................................................................................................................. 33 5 PLC API.................................................................................................................................................... 35 5.1 Tc3_S7Comm................................................................................................................................. 35 5.1.1 Function blocks................................................................................................................ 35 5.1.2 Data types........................................................................................................................ 59 6 Samples................................................................................................................................................... 61 7 Appendix.................................................................................................................................................. 63 7.1 Troubleshooting.............................................................................................................................. 63 7.2 Support and Service........................................................................................................................ 65 TF6620 Version: 1.5.0 3
## Page 4

Table of contents 4 Version: 1.5.0 TF6620
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF6620 Version: 1.5.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.5.0 TF6620
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. 1.4 Documentation issue status Version Change 1.5.x New: Add Read Byte Array [} 41] Add Write Byte Array [} 45] TF6620 Version: 1.5.0 7
## Page 8

Overview 2 Overview Twin CAT S7 Communication enables data to be exchanged between the Twin CAT system and a Siemens S7 controller. The product is available both in the form of an easy to configure Twin CAT I/O device as well as a PLC library. The underlying protocol implementation is based on the Twin CAT TCP/UDP RT driver and allows read/write commands to be placed on absolutely addressed variables of an S7 controller, whereby various S7 systems and functionalities [} 26] are supported. 8 Version: 1.5.0 TF6620
## Page 9

Installation 3 Installation 3.1 System requirements Technical data Description Operating system Windows 10, Twin CAT/BSD Target platform PC architecture (x86, x64) Minimum Twin CAT version Twin CAT 3.1 Build 4024.11 or higher (Windows) Twin CAT 3.1 Build 4024.12 or higher (Twin CAT/ BSD) Required Twin CAT setup level Twin CAT 3 XAE, XAR Required Twin CAT license TF6620 TC3 S7 Communication 3.2 Installation Setup installation (Twin CAT 3.1 Build 4024) The following section describes how to install the Twin CAT 3 function for Windows-based operating systems. ü The Twin CAT 3 function setup file was downloaded from the Beckhoff website. 1. Run the setup file as administrator. To do this, select the Run As Admin command in the context menu of the file. ð The installation dialog opens. 2. Accept the end user licensing agreement and click Next. TF6620 Version: 1.5.0 9
## Page 10

Installation 3. Enter your user data. 4. If you want to install the full version of the Twin CAT 3 function, select Complete as the installation type. If you want to install the Twin CAT 3 function components separately, select Custom. 10 Version: 1.5.0 TF6620
## Page 11

Installation 5. Click Next, then Install to start the installation. ð A dialog box informs you that the Twin CAT system must be stopped to proceed with the installation. 6. Confirm the dialog with Yes. TF6620 Version: 1.5.0 11
## Page 12

Installation 7. Click Finish to exit the setup. ð The Twin CAT 3 function has been installed successfully. 3.3 Installation from Twin CAT 4026 Twin CAT Package Manager If you are using Twin CAT 3.1 Build 4026 (and higher) on the Microsoft Windows operating system, you can install this function via the Twin CAT Package Manager, see Installation documentation. Normally you install the function via the corresponding workload; however, you can also install the packages contained in the workload individually. This documentation briefly describes the installation process via the workload. Command line program Tc Pkg You can use the Tc Pkg Command Line Interface (CLI) to display the available workloads on the system: tcpkg list TF6620 You can use the following command to install the workload of the TF6620 TC3 S7 Communication Function. tcpkg install TF6620. S7Communication. XAE tcpkg install TF6620. S7Communication. XAR Twin CAT Package Manager UI You can use the User Interface (UI) to display all available workloads and install them if required. To do this, follow the corresponding instructions in the interface. 3.4 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). 12 Version: 1.5.0 TF6620
## Page 13

Installation Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. TF6620 Version: 1.5.0 13
## Page 14

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. 14 Version: 1.5.0 TF6620
## Page 15

Technical introduction 4 Technical introduction 4.1 Getting started This documentation article is intended to allow you an initial, quick start in how to use this product. Following successful installation [} 9] and licensing [} 12], perform the following steps in order to establish a connection to an S7 controller and configure variables for the read/write access. Add an S7 Communication I/O device 1. As the Twin CAT S7 Communication product is based on the real-time Ethernet adapter, you first add a real-time Ethernet adapter (Multi Protocol Handler) as an I/O device to your Twin CAT configuration. To do so, select Add New Item.. 2. In the Insert Device dialog you confirm the selection Real-Time Ethernet Adapter (Multi Protocol Handler) with OK 3. You then link this adapter with the network interface card correspondingly configured for this. TF6620 Version: 1.5.0 15
## Page 16

Technical introduction 4. In the next step you add a TCP/UDP RT module below the real-time Ethernet adapter. To do so, select Add Object(s).. 5. Confirm the TCP/UDP RT Module selection with OK. 6. Then you add an S7 Connector to the TCP/UDP RT module. Several S7 Connectors can be added. For this purpose, also bear in mind the instructions about any possible Technical Restrictions [} 26]. To do so, select Add New Item… again. 7. In the dialog that opens, press OK to add the S7 Connector (Module). 16 Version: 1.5.0 TF6620
## Page 17

Technical introduction ð The finished I/O configuration should then look like this: Configuring the connection parameters Once you have added the I/O device, you can define the connection parameters for the Siemens S7 Controller on the S7 Connector. 1. To do so, double click on the S7 Connector. ð The following connection parameters must be configured for the Siemens S7 Controller: Parameter Description IP Address IP address of the Siemens S7 Controller CPU Type Type of Siemens S7 Controller Rack Rack ID, see S7 view of the device Slot Slot ID, see S7 view of the device Access to data points via the process image Normally, data points on the S7 Controller are accessed via the process image, i.e. the data points should be able to be linked as variables in the process image with other variables, e.g. from the PLC. For this purpose, two different types of access can be configured on the S7 Connector: Single Request and Cyclic Request. TF6620 Version: 1.5.0 17
## Page 18

Technical introduction Access types With Single Request, the configured data points are only read or written “on demand”. For this, corresponding trigger variables are available in the process image. With Cyclic Request, the corresponding data points are read/written cyclically during a configurable cycle time. Both access types are described in detail once again in a separate document article about Single Request vs. Cyclic Request [} 21]. Data point configuration After selecting an access type, the data points can be configured. This is done using the appropriate tabs, Read Variables or Write Variables, for the S7 Request object. In this tabular overview, the address information of a data point can be configured on the S7 Controller. These include: Name of the variables (only for display in the process image), Data Type, S7 Data Area, S7 Byte Address, S7 Bit Offset, S7 Data Block. This information is provided by the Siemens S7 Controller. 18 Version: 1.5.0 TF6620
## Page 19

Technical introduction You can also import the data points from a file or export already configured data points. This makes it easier to exchange this information with other tools. Further information can be found in the documentation article Importing and exporting data points [} 25]. The configured data points below the Read Variables tab are added in the process image to the Read From S7 node as input variables and from there can now be linked with other variables. The configured data points below the Write Variables tab are added in the process image to the Write To S7 node as output variables and from there can now be linked with other variables. TF6620 Version: 1.5.0 19
## Page 20

Technical introduction Access to data points via the PLC Alternatively, the data points can also be configured from the PLC program and be read or written using a function block. For this purpose, the PLC library Tc3_S7Comm [} 35] is available. Unlike the configuration of data points via the process image, with this version, no access type has to be specified as access takes place directly from the PLC logic. The connection parameters are also configured from the PLC. Therefore you do not have to add an S7 Connector for this version. Using the PLC library already mentioned above and the function blocks contained therein, you then have the option of configuring this information. Sample: fb Connection: FB_S7Comm Connection(16#01010050); fb Request Read: FB_S7Comm Single Request; fb Connection.s Ip Addr := '10.3.32.101'; fb Connection.e Cpu Type := E_S7COMM_CPUTYPE. S71500; fb Connection.n Rack := 0; fb Connection.n Slot := 0; fb Request Read. Add Read Var(ADR(data_byte), SIZEOF(data_byte), 0, E_S7COMM_DATAAREA. DATA_BLOCKS, 1); fb Request Read. Add Read Var(ADR(data_dword), SIZEOF(data_dword), 2, E_S7COMM_DATAAREA. DATA_BLOCKS, 1); Further information about both types of communication can be found in the document article Mapping vs. PLC library [} 20], as well as in the Samples [} 61]. NOTICE Constructor parameter at FB_S7Comm Connection Please make sure that the constructor parameter of the "FB_S7Comm Connection" function block is configured with the object ID of your TCPUDP stack. These can be found on the "Objects" tab of the TCPUDP RT adapter in your I/O settings. FB_S7Comm Connection The FB_S7Comm Connection function block is initialized with the ID of the TCP/UDP RT module. This can either, as shown in the code snippet above, be entered statically or configured in the properties of the PLC project instance via the initialization symbol. The latter is shown in the Samples. 4.2 Mapping vs. PLC library Communication with an S7 Controller can be done in two ways. In the classic way, access to the controller and the data points to be read or written can be configured via the I/O device. For operating environments where there should be a somewhat more dynamic access, the PLC library Tc3_S7Comm [} 35] is available for establishing the connection and for reading/writing data points. The following table shows both modes of communication in comparison. Mapping PLC Changing connection parameters no yes dynamically Adding/Removing S7 data points no yes dynamically In the Samples [} 61] chapter you will find examples of both communication types. 20 Version: 1.5.0 TF6620
## Page 21

Technical introduction 4.3 Single Request vs. Cyclic Request When accessing data points on an S7 Controller via an I/O mapping (see chapter about Mapping vs. PLC library [} 20]), various access types can be configured. Their mode of operation is described in more detail below. The following table compares the two types of access. Request Trigger Single via Send Request variable Cyclic via configurable Cycle Time Single Request In the case of Single Request, the data points are configured and added to the process image. However, read and write access is “on demand,” i.e., when a certain condition is met. This condition can be produced using the status and control variables. For example, a request is executed exactly when Send Request is one greater than Receive Counter. The overflow of the variables with the data type BYTE also need to be observed here, i.e. 0 > 255. The following table provides an overview of this: Variable Data type Description Control. Send Request BYTE By incrementing these variables from the application code, a read/write command (request) is triggered. As soon as the associated response has been received from the S7 Controller, the input variable, Status. Receive Counter is also incremented by 1 accordingly. The application thus knows that the read/ write operation was successful. Control. Write To S7Enable BIT Write commands are only executed if this variable was set to TRUE. Status. Receive Counter BYTE see Control. Send Request above Status. Error WORD When an error occurs whilst working through a command, the error code associated with this is displayed here. A description of the error codes is stored in the comment box. TF6620 Version: 1.5.0 21
## Page 22

Technical introduction Cyclic Request In the case of a Cyclic Request, the read or write command is worked through cyclically. The cycle time can be configured via a parameter. If the cycle time is set faster than the real-time task of the system, then the request runs as quickly as possible, i.e. a new request is sent as soon as the previous one has been answered by the remote system. 4.4 Symbol server interface Since product version 1.1.4, the S7 protocol driver implementation includes an ADS symbol server interface that allows ADS read/write access to configured S7 variables. There can be many different use cases for this kind of access. Such use cases can be, but are not limited to: • Providing read/write access to S7 variables for the Twin CAT HMI • Providing read/write access to S7 variables for the Twin CAT OPC UA Server • Providing read/write access to S7 variables for custom ADS client applications • Browsing the configured S7 variables with tools like the Twin CAT Target Browser • ... 22 Version: 1.5.0 TF6620
## Page 23

Technical introduction The symbol server is available as a separate Tc COM object that will be added to an S7 Connector device. The symbol server object does not define any process image. Instead all S7 variables are configured within the Symbol Variables window. Within that window you will find the server port of the ADS symbol server in the top right corner. Multiple symbol servers Please note that you can configure more than one symbol server, e.g., if you want to access multiple S7 controllers. In that case, all symbol servers share the same ADS server port. The individual symbol servers are then sorted under that ADS server port. The following screenshot shows an example of such a configuration – two S7 connectors each with its own symbol server object. The Twin CAT Target Browser connects to the ADS server port and displays the symbol server namespace. TF6620 Version: 1.5.0 23
## Page 24

Technical introduction The following table lists all currently available ADS commands on the symbol server interface. Command Description Ads Get Handle Acquire an ADS handle via the variable’s symbol name. Ads Release Handle Release ADS handle. Ads Read By Handle Read operations on the acquired handle. Also supports sum commands. Ads Write By Handle Write operations on the acquired handle. Also supports sum commands. Ads Read Read operations via direct communication with Index Group/Index Offset. Also supports sum commands. Ads Write Write operations via direct communication with Index Group/Index Offset. Also supports sum commands. Please note that ADS notifications are currently not supported by the symbol server. Example: Connect to symbol server with Twin CAT OPC UA Server In the previous chapter you have seen how to activate the symbol server interface on an S7 Connector device and browse through its namespace by using the Twin CAT Target Browser. As an additional example, we now want to configure the Twin CAT OPC UA Server to access the symbol server interface and make the configured S7 variables available via its OPC UA server address space. After the Twin CAT OPC UA Server has been installed, open its Data Access configuration (Tc Ua Da Config.xml) to configure the symbol server connection details. You can edit the Data Access configuration either by using the Twin CAT OPC UA Configurator or a text editor of your choice. Add a new Data Access device using the following required parameters: Parameter Description Name Unique name for the device. Will be used as entry point on the OPC UA server’s address space. Ads Port ADS server port of the symbol server, e.g. 20100. Ads Net Id Net ID of the system on which the Twin CAT S7 Communication product runs. Auto Cfg Value 5: switches the Twin CAT OPC UA Server to “symbol server access” mode. The following excerpt of Tc Ua Da Config.xml shows an example of such a configuration. <Ua Node Manager> <Name>S7</Name> <Ads Port>20100</Ads Port> <Ads Net Id>127.0.0.1.1.1</Ads Net Id> <Ads Timeout>2000</Ads Timeout> <Ads Time Suspend>20000</Ads Time Suspend> <Auto Cfg>5</Auto Cfg> <Auto Cfg Sym File></Auto Cfg Sym File> <Io Mode>1</Io Mode> <Max Get Handle>100</Max Get Handle> <Release Ads Var Handles>1</Release Ads Var Handles> <Disabled>0</Disabled> </Ua Node Manager> Once this configuration has been activated, the Twin CAT OPC UA Server will connect to the symbol server and import its namespace. An OPC UA Client can then connect to the server and access the variables. 24 Version: 1.5.0 TF6620
## Page 25

Technical introduction Example: Connect to symbol server with custom ADS client Our samples [} 61] repository on Git Hub includes a . NET Core project that demonstrates the different ways an ADS client can access the symbol server. 4.5 Importing and exporting data points Data points from an S7 Controller can be exchanged with other systems via an import/export mechanism or imported from there. The corresponding function is available in the Read/Write Variables tabs from the S7 Request object in the process image. TF6620 Version: 1.5.0 25
## Page 26

Technical introduction A semi-colon separated list is used as a data exchange format. A sample, matching the screenshot above, is provided below: by1;BYTE;DATA_BLOCKS;0;0;1 b1;BOOL;DATA_BLOCKS;1;0;1 b2;BOOL;DATA_BLOCKS;1;1;1 b3;BOOL;DATA_BLOCKS;1;2;1 b4;BOOL;DATA_BLOCKS;1;3;1 w1;DWORD;DATA_BLOCKS;2;0;1 r1;REAL;DATA_BLOCKS;6;0;1 r2;REAL;DATA_BLOCKS;10;0;1 i1;INT;DATA_BLOCKS;14;0;1 4.6 Supported systems and functionalities The following Siemens S7 Controllers have been tested and are supported: • Siemens S7-300 • Siemens S7-400 • Siemens S7-1200 • Siemens S7-1500 When communicating with these control systems, the following Siemens Data Areas are supported: • INPUT • OUTPUT • DATA_BLOCKS • FLAGS Please note that Siemens Communication Processors have not been explicitly tested. 4.7 Technical restrictions When communicating with one of the supported Siemens S7 Controllers [} 26], the following technical restrictions apply: 26 Version: 1.5.0 TF6620
## Page 27

Technical introduction Restriction Description Activating/Enabling the communication With newer Siemens S7 Controllers, the communication must be explicitly activated or enabled. Please consult the manual for your Siemens S7 Controller for more information about enabling the TCP/IP communication with the controller. The chapter Activating the S7 protocol access [} 27] shows you some sample screenshots from the TIA portal. Only communication with absolutely When communicating with variables from the relevant Siemens addressed variables data area, only absolutely addressed variables can be used. A symbolic access is not possible. Caution is therefore required in case the Siemens control program changes, thereby possibly making memory addresses change. Maximum frame size per request Siemens S7 Controllers have a maximum frame size per request. This is reported by the controller when the communication is started up and is approximately 960 bytes for most S7 types. If more than 960 bytes are created in the process image, the Twin CAT S7 communication driver automatically splits the requests into several requests. Maximum number of connections The function TF6620 is based on the Twin CAT TCP/UDP RT stack, which allows a maximum of 32 connections (per stack) as standard. Additionally, there may also be limitations on the part of the Siemens S7 Controller regarding the simultaneous number of TCP/IP connections. Maximum number of requests per A maximum of 64 messages per connection can be configured. connection However, this number can be increased by additional connections. Maximum number of variables per request A maximum of 255 variables can be used per request. However, the number can be increased by additional requests. 4.8 Activating the S7 protocol access The following screenshots show a sample activation of the S7 protocol functions in the TIA portal, which is usually only necessary for S7-1200 and S7-1500 controllers. Please note that the screenshots differ from your operating environment and may look different depending on the TIA version. TF6620 Version: 1.5.0 27
## Page 28

Technical introduction 1. Firstly activate the access via the access level. 2. Then activate the COTP PUT/GET access. 28 Version: 1.5.0 TF6620
## Page 29

Technical introduction 3. Disable the optimized block access. NOTICE Hardware Download Please note that you have to perform a hardware download after changing the access parameters so that these changes become active. 4.9 Optimization options Sometimes the obvious way is not always the most efficient way. The following article shows some possibilities how you can optimize the S7 data communication. Sample 1: reading many BOOL/BIT variables The configuration in the TIA project contains several (in this sample 10) BOOL/BIT variables, which are located in the memory directly "one after the other" and are to be read out: The most obvious implementation would be to attach the 10 variables of type BOOL to a request. TF6620 Version: 1.5.0 29
## Page 30

Technical introduction This implementation would then look like this: The various variables are queried individually here, with each "item" entry being 12 bytes long. The entire payload of the S7 request is thus 132 bytes long. A corresponding response would then look like the following: 30 Version: 1.5.0 TF6620
## Page 31

Technical introduction Each "Item" is 5 bytes long and the whole S7 Response 73 bytes. A more efficient implementation would be to read a byte array, in this case 2 bytes. The byte array would then be "mapped" to the BOOL variables. The request in this case would look like this: TF6620 Version: 1.5.0 31
## Page 32

Technical introduction In this case, the payload is only 24 bytes long (i.e. 108 bytes less). The corresponding response would then be: In this case, the payload of the response is only 20 bytes long (previously 73 bytes). Request: • Direct implementation: 132 bytes • Optimized implementation: 24 bytes • Savings: 108 bytes Response: • Direct implementation: 73 bytes • Optimized implementation: 20 bytes • Savings: 53 bytes Further information If a request frame is longer than the S7 Controller can process, the Twin CAT 3 S7 communication driver must split the request into several requests. This can extremely increase the response time. Sample 2: reading out many WORD variables The configuration in the TIA project contains several (in this sample 5) WORD variables, which are located in the memory directly "one after the other" and are to be read out: 32 Version: 1.5.0 TF6620
## Page 33

Technical introduction The same principle applies as in sample 1: each entry increases the payload size of the request and the associated response. The same approach can be used for optimization (please note the "endianess"). An optimized PLC program could then look as follows: The entries must then be "mapped" accordingly and "rotated" correctly. The savings compared to direct (obvious) implementation would then be as follows: Request: • Direct implementation: 72 bytes • Optimized implementation: 24 bytes • Savings: 48 bytes Response: • Direct implementation: 44 bytes • Optimized implementation: 28 bytes • Savings: 16 bytes 4.10 String lengths You can modify the default length of STRING variables by editing the length in the corresponding Data Type field. Example: TF6620 Version: 1.5.0 33
## Page 34

Technical introduction 34 Version: 1.5.0 TF6620
## Page 35

PLC API 5 PLC API 5.1 Tc3_S7Comm 5.1.1 Function blocks 5.1.1.1 FB_S7Comm Connection With the function block FB_S7Comm Connection, a TCP/IP based connection to a Siemens S7 Controller can be established. It is possible to tell whether the connection was successfully established via the output b Is Connected. Errors concerning setting up the connection are displayed via the output b Error and s Error Txt. Syntax Definition: VAR_INPUT b Execute : BOOL; s Ip Addr : STRING(15); e Cpu Type : E_S7COMM_CPUTYPE; n Rack : UINT; n Slot : UINT; END_VAR VAR_OUTPUT b Error : BOOL; s Error Txt : STRING; b Busy : BOOL; b Is Connected : BOOL; END_VAR Inputs Name Data type Description b Execute BOOL The connection to the S7 Controller is set up in case of a rising edge. The connection is disconnected in case of a falling edge. s Ip Addr STRING(15) IP address of the Siemens S7 Controller. e Cpu Type E_S7COMM_CPUTYPE [} 60] Type of Siemens S7 Controller n Rack UINT Rack ID of the S7 Controller. This can be obtained from the S7 device manager. n Slot UINT Slot ID of the S7 Controller. This can be obtained from the S7 device manager. TF6620 Version: 1.5.0 35
## Page 36

PLC API Outputs Name Data type Description b Error BOOL Switches to TRUE if an error occurs during execution. s Error Txt STRING Contains the error text in the event of an error. b Busy BOOL TRUE until the function block has executed a command. As long as b Busy = TRUE, the function block will not accept any new commands. b Is Connected BOOL TRUE, if the connection to the Siemens S7 Controller was established. Methods Name Definition location Description Add Request [} 36] Local Adds a Single or Cyclic Request to the connection. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.1.1 Add Request Adds a Single/Cyclic Request (FB_S7Comm Single Request [} 48], FB_S7Comm Cyclic Request [} 37]) to an S7 communication connection (FB_S7Comm Connection [} 35]). Read/Write commands can be defined on the respective request type of the added object. Syntax METHOD Add Request : BOOL VAR_INPUT ip Request : ITF_S7Comm Request; END_VAR Return value Name Type Description Add Request BOOL TRUE if the method was carried out correctly. In the event of an error, the error outputs of the function block provide further information on the cause of the fault. Inputs Name Type Description ip Request ITF_S7Comm Request Single/Cyclic Request Object 36 Version: 1.5.0 TF6620
## Page 37

PLC API 5.1.1.2 FB_S7Comm Cyclic Request Cyclic processing (read/write) of data points of an S7 communication connection can be configured with the FB_S7Comm Cyclic Request function block. The b Error output states whether the request was successfully carried out. Any errors occurring at the time of the request are displayed via the output s Error Txt and n Error ID. Syntax Definition: VAR_INPUT b Execute : BOOL; n Cycle Time Ms : UDINT; END_VAR VAR_OUTPUT b Error : BOOL; s Error Txt : STRING; n Error Id : WORD; b Busy : BOOL; n Receive Counter : BYTE; END_VAR Inputs Name Data type Description b Execute BOOL The function block is executed by a rising edge at this input. n Cycle Time Ms UDINT Cycle time to be used in [ms]. Outputs Name Data type Description b Error BOOL Switches to TRUE if an error occurs during execution. s Error Txt STRING Contains the error text in the event of an error. n Error Id WORD Outputs an error code in the event of an error. b Busy BOOL TRUE until the function block has executed a command. As long as b Busy = TRUE, the function block will not accept any new commands. n Receive Counter BYTE Counter for responses received by the S7 Controller. This can be used to check whether a response was received in the cyclic processing. TF6620 Version: 1.5.0 37
## Page 38

PLC API Methods Name Definition loca- Description tion Add Read Var [} 38] Local Adds a read command for a particular S7 data point to the request. Add Read Bit [} 39] Local Adds a read command for a particular BIT-type S7 data point to the request. Add Read String Local Adds a read command on a STRING-type S7 data point to a request. [} 40] Add Read Byte Array Local Adds a read command to the request in an optimized [} 29] [} 41] manner if several data points located consecutively in the memory of the S7 Controller are to be read. Add Write Var [} 42] Local Adds a write command for a particular S7 data point to the request. Add Write Bit [} 43] Local Adds a write command for a particular BIT-type S7 data point to the request. Add Write String Local Adds a write command on a STRING-type S7 data point to a request. [} 44] Add Write Byte Array Local Adds a read command to the request in an optimized [} 29] [} 45] manner if several data points located consecutively in the memory of the S7 Controller are to be written. Remove Read Local Removes a variable from a read request. [} 46] Remove Write Local Removes a variable from a write request. [} 47] Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.1 Add Read Var Adds a read command on an S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. Syntax METHOD Add Read Var : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR 38 Version: 1.5.0 TF6620
## Page 39

PLC API Return value Name Data type Description Add Read Var HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be read from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.2 Add Read Bit Adds a read command on a BIT-type S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. The address of the target variables passed on must be a BOOL data type (not BIT). Syntax METHOD Add Read Bit : HRESULT VAR_INPUT p Var : PVOID; n Byte Off : WORD; n Bit Off : BYTE; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR TF6620 Version: 1.5.0 39
## Page 40

PLC API Return value Name Data type Description Add Read Bit HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Off WORD Byte length of the data type to be read from the S7 Controller n Bit Off BYTE Bit offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.3 Add Read String Adds a read command on a STRING-type S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. The length of the string should not exceed 254 characters. Syntax METHOD Add Read String : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR 40 Version: 1.5.0 TF6620
## Page 41

PLC API Return value Name Data type Description Add Read String HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be read from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.4 Add Read Byte Array Adds a read command to the request in an optimized [} 29] manner if several data points located consecutively in the memory of the S7 Controller are to be read. Syntax METHOD Add Read Var : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR TF6620 Version: 1.5.0 41
## Page 42

PLC API Return value Name Data type Description Add Read Var HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be read from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.5 Add Write Var Adds a write command on an S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. Syntax METHOD Add Write Var : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR 42 Version: 1.5.0 TF6620
## Page 43

PLC API Return value Name Data type Description Add Write Var HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the source variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be written from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.6 Add Write Bit Adds a read command on a BIT-type S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. The address of the source variables passed on must be a BOOL data type (not BIT). Syntax METHOD Add Write Bit : HRESULT VAR_INPUT p Var : PVOID; n Byte Off : WORD; n Bit Off : BYTE; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR TF6620 Version: 1.5.0 43
## Page 44

PLC API Return value Name Data type Description Add Write Bit HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Off WORD Byte length of the data type to be written from the S7 Controller n Bit Off BYTE Bit offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.7 Add Write String Adds a write command on a STRING-type S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. The maximum length of the string should not exceed 254 characters. Syntax METHOD Add Write String : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR 44 Version: 1.5.0 TF6620
## Page 45

PLC API Return value Name Data type Description Add Write String HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the source variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be written from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.8 Add Write Byte Array Adds a write command to the request in an optimized [} 29] manner if several data points located consecutively in the memory of the S7 Controller are to be written. Syntax METHOD Add Read Var : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR TF6620 Version: 1.5.0 45
## Page 46

PLC API Return value Name Data type Description Add Read Var HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be read from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.9 Remove Read Removes a variable from a read request. The variable is specified via its address in the Twin CAT PLC. No read request may be pending at the time that the method is executed, i.e. the output b Busy of the function block must be FALSE. Syntax METHOD Remove Read : HRESULT VAR_INPUT p Var : PVOID; END_VAR 46 Version: 1.5.0 TF6620
## Page 47

PLC API Return value Name Data type Description Remove Read HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the variables in the Twin CAT PLC Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.2.10 Remove Write Removes a variable from a write request. The variable is specified via its address in the Twin CAT PLC. No write request may be pending at the time that the method is executed, i.e. the output b Busy of the function block must be FALSE. Syntax METHOD Remove Write : HRESULT VAR_INPUT p Var : PVOID; END_VAR Return value Name Data type Description Remove Write HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length TF6620 Version: 1.5.0 47
## Page 48

PLC API Inputs Name Data type Description p Var PVOID Address of the variables in the Twin CAT PLC Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3 FB_S7Comm Single Request With the FB_S7Comm Single Request function block, a read/write request can be carried out on a data point of an S7 communication connection. The b Error output states whether the request was successfully carried out. Any errors occurring at the time of the request are displayed via the output s Error Txt and n Error ID. Syntax Definition: VAR_INPUT b Execute : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; s Error Txt : STRING; n Error Id : WORD; b Busy : BOOL; END_VAR Inputs Name Data type Description b Execute BOOL The function block is executed by a rising edge at this input. Outputs Name Data type Description b Error BOOL Switches to TRUE if an error occurs during execution. s Error Txt STRING Contains the error text in the event of an error. n Error Id WORD Outputs an error code in the event of an error. b Busy BOOL TRUE until the function block has executed a command. As long as b Busy = TRUE, the function block will not accept any new commands. 48 Version: 1.5.0 TF6620
## Page 49

PLC API Methods Name Definition location Description Add Read Var [} 38] Local Adds a read command for a particular S7 data point to the request. Add Read Bit [} 50] Local Adds a read command for a particular BIT-type S7 data point to the request. Add Read String [} 51] Local Adds a read command for a particular STRING type S7 data point to the request. Add Read Byte Array [} 52] Local Adds a read command to the request in an optimized [} 29] manner if several data points located consecutively in the memory of the S7 Controller are to be read. Add Write Var [} 42] Local Adds a write command for a particular S7 data point to the request. Add Write Bit [} 54] Local Adds a write command for a particular BIT-type S7 data point to the request. Add Write String [} 55] Local Adds a write command for a particular STRING type S7 data point to the request. Add Write Byte Array [} 56] Local Adds a read command to the request in an optimized [} 29] manner if several data points located consecutively in the memory of the S7 Controller are to be written. Remove Read [} 57] Local Removes a variable from a read request. Remove Write [} 58] Local Removes a variable from a write request. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.1 Add Read Var Adds a read command on an S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. TF6620 Version: 1.5.0 49
## Page 50

PLC API Syntax METHOD Add Read Var : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR Return value Name Data type Description Add Read Var HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be read from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.2 Add Read Bit Adds a read command on a BIT-type S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. The address of the target variables passed on must be a BOOL data type (not BIT). 50 Version: 1.5.0 TF6620
## Page 51

PLC API Syntax METHOD Add Read Bit : HRESULT VAR_INPUT p Var : PVOID; n Byte Off : WORD; n Bit Off : BYTE; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR Return value Name Data type Description Add Read Bit HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Off WORD Byte length of the data type to be read from the S7 Controller n Bit Off BYTE Bit offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.3 Add Read String Adds a read command on a STRING-type S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. The length of the string should not exceed 254 characters. TF6620 Version: 1.5.0 51
## Page 52

PLC API Syntax METHOD Add Read String : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR Return value Name Data type Description Add Read String HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be read from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.4 Add Read Byte Array Adds a read command to the request in an optimized [} 29] manner if several data points located consecutively in the memory of the S7 Controller are to be read. Syntax METHOD Add Read Var : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR 52 Version: 1.5.0 TF6620
## Page 53

PLC API Return value Name Data type Description Add Read Var HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be read from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.5 Add Write Var Adds a write command on an S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. Syntax METHOD Add Write Var : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR TF6620 Version: 1.5.0 53
## Page 54

PLC API Return value Name Data type Description Add Write Var HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the source variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be written from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.6 Add Write Bit Adds a read command on a BIT-type S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. The address of the source variables passed on must be a BOOL data type (not BIT). Syntax METHOD Add Write Bit : HRESULT VAR_INPUT p Var : PVOID; n Byte Off : WORD; n Bit Off : BYTE; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR 54 Version: 1.5.0 TF6620
## Page 55

PLC API Return value Name Data type Description Add Write Bit HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Off WORD Byte length of the data type to be written from the S7 Controller n Bit Off BYTE Bit offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.7 Add Write String Adds a write command on a STRING-type S7 data point to a request. The data point is specified via its absolute address in the S7 Controller. The maximum length of the string should not exceed 254 characters. Syntax METHOD Add Write String : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR TF6620 Version: 1.5.0 55
## Page 56

PLC API Return value Name Data type Description Add Write String HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the source variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be written from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.8 Add Write Byte Array Adds a write command to the request in an optimized [} 29] manner if several data points located consecutively in the memory of the S7 Controller are to be written. Syntax METHOD Add Read Var : HRESULT VAR_INPUT p Var : PVOID; n Byte Size : WORD; n Byte Off : WORD; n Area : E_S7COMM_DATAAREA; n Datablock : WORD; END_VAR 56 Version: 1.5.0 TF6620
## Page 57

PLC API Return value Name Data type Description Add Read Var HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the target variables in the Twin CAT PLC n Byte Size WORD Byte length of the data type to be read from the S7 Controller n Byte Off WORD Byte offset in the S7 Controller n Area E_S7COMM_DATAAREA [} 60] S7 data area n Datablock WORD ID of the data block. Is only sent if E_S7COMM_DATAAREA. DATA_B LOCKS is used as the data area. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.9 Remove Read Removes a variable from a read request. The variable is specified via its address in the Twin CAT PLC. No read request may be pending at the time that the method is executed, i.e. the output b Busy of the function block must be FALSE. Syntax METHOD Remove Read : HRESULT VAR_INPUT p Var : PVOID; END_VAR TF6620 Version: 1.5.0 57
## Page 58

PLC API Return value Name Data type Description Remove Read HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length Inputs Name Data type Description p Var PVOID Address of the variables in the Twin CAT PLC Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.1.3.10 Remove Write Removes a variable from a write request. The variable is specified via its address in the Twin CAT PLC. No write request may be pending at the time that the method is executed, i.e. the output b Busy of the function block must be FALSE. Syntax METHOD Remove Write : HRESULT VAR_INPUT p Var : PVOID; END_VAR Return value Name Data type Description Remove Write HRESULT E_HRESULTAds Err. NOTINIT = Function block has not been initialized correctly. E_HRESULTAds Err. BUSY = Request is active E_HRESULTAds Err. INVALIDDAT A = A transfer parameter has been defined incorrectly E_HRESULTAds Err. INVALIDSIZE = The frame length is greater than the PDU length 58 Version: 1.5.0 TF6620
## Page 59

PLC API Inputs Name Data type Description p Var PVOID Address of the variables in the Twin CAT PLC Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.2 Data types 5.1.2.1 E_S7COMM_CONNECT_STATE E_S7COMM_CONNECT_STATE specifies the status of the communication connection with the S7 Controller. TYPE E_S7COMM_CONNECT_STATE: ( IDLE, START, TCP_SETUP, TCP_WAIT, COTP_SETUP, COTP_WAIT, S7_SETUP, S7_WAIT, CONNECTED, TCP_ERROR, COTP_ERROR, S7_ERROR, RESET, TCP_SETUP_ERROR, TCP_TIMEOUT_ERROR ); END_TYPE Parameter Value Description IDLE START TCP_SETUP TCP_WAIT COTP_SETUP COTP_WAIT S7_SETUP S7_WAIT CONNECTED TCP_ERROR COTP_ERROR S7_ERROR RESET TCP_SETUP_ERROR TCP_TIMEOUT_ERROR TF6620 Version: 1.5.0 59
## Page 60

PLC API Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.2.2 E_S7COMM_CPUTYPE E_S7COMM_CPUTYPE specifies which type of S7 Controller is involved when a connection is established with the S7 Controller. TYPE E_S7COMM_CPUTYPE: ( S7300, S7400, S71200, S71500 ); END_TYPE Parameter Value Description S7300 S7400 S71200 S71500 Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 5.1.2.3 E_S7COMM_DATAAREA E_S7COMM_DATAAREA specifies the S7 data area that the data points come from when addressing data points. TYPE E_S7COMM_DATAAREA: ( INPUT, OUTPUT, FLAGS, DATA_BLOCKS ); END_TYPE Parameter Value Description INPUT OUTPUT FLAGS DATA_BLOCKS Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64) Tc3_S7Comm (Communication) 60 Version: 1.5.0 TF6620
## Page 61

Samples 6 Samples For both communication paths (Mapping vs. PLC library [} 20]) with a Siemens S7 Controller, a separate sample is available to download in each case. Sample Description TF6620_S7Communication Sample_PLC This sample shows how the PLC library Tc3_S7Comm [} 35] can be used to establish a communication connection with an S7 Controller and to read or write data points. TF6620_S7Communication Sample_Sys Man This sample shows how the S7 communication connection can be configured as Twin CAT I/O device to read or write data points from an S7 Controller. Download Sample code and configurations for this product can be obtained from the corresponding repository on Git Hub: https://github.com/Beckhoff/TF6620_Samples. There you have the option to clone the repository or download a ZIP file containing the sample. Further information The samples are based on an imaginary S7 Controller (S7-1500), which can be accessed in the local network under the IP address 192.168.179.1. This controller was configured for the S7 protocol access and provides the following variables in the DATA_BLOCKS data area: Please adapt these samples to match your operating environment. In the PLC sample, the function block instance of type FB_S7Comm Connection is pre-initialized with the TCP/UDP RT module. This is done using the Symbol Initialization tab in the properties of the PLC project instance. TF6620 Version: 1.5.0 61
## Page 62

Samples 62 Version: 1.5.0 TF6620
## Page 63

Appendix 7 Appendix 7.1 Troubleshooting TF6620 Version: 1.5.0 63
## Page 64

Appendix Behavior Category Description No connection is established. The Connector No TCP connection to the S7 connector goes into the 0x F3 TCP Controller can be established. Timeout state. Please check whether the controller can be reached from your target system, e.g. via a ping command. No connection is established. The Connector Please check whether the required connector goes into the 0x F3 TCP S7 Controller is behind the IP Timeout state. The IP address of address. the S7 Controller can be reached via a ping command. No connection is established. The Connector A TCP connection with the S7 connector goes into the 0x F4 Controller could be established, COTP Setup Error state. however the connection to the S7 Communication Service failed. Please check whether the connection parameters "CPU Type", "Rack" and "Slot" match the required S7 Controller. The TCP connection to the S7 Connector Please ensure that there are no Controller cannot be established. firewalls between the Twin CAT device and the S7 Controller that could block the data connection or that the corresponding communication port is allowed in the firewall. Siemens S7 Controllers use TCP port 102 for incoming connections. No connection is established. The Connector Please make sure that the selected connector goes into the 0x F2 TCP network adapter at the Realtime Setup Error state. The logger Ethernet Device has received a displays the following message: valid IP address. If the IP address on the adapter is 0.0.0.0, please S7Connection: src ip address is check that your DHCP server is invalid – maybe ethernet device is functioning correctly or manually not supported? assign an IP address for the adapter – either in the Windows network settings or in the "Parameters (Init)" dialog from the TCP/UDP RT device. After a Write command, the Request Generally, this error means that a following messages appear in the certain function is not supported by logger: the S7 device. S7Connection: S7 error, error Class This error usually only occurs with 0x81, Error Code 0x04 S7-1200 and S7-1500 Controllers if remote access has not been S7Connection: Please check if activated. remote access is enabled on Siemens Controller However, some S7 Controllers (e.g. S7-412-1) only allow 2-byte S7Connection State = 0x F5 data types for a write operation, e.g. WORD, which means that this error code can also occur during a write operation. After a read/write command, the Request The remote access on the S7 connection is in the 0x F5 S7 Error Controller is not enabled. See also state. The entry chapter Activating the S7 protocol "CS7Connector::Receive S7Comm( access [} 27]. )<<< S7 error, error Class 81, Error code 04" is found in the logger 64 Version: 1.5.0 TF6620
## Page 65

Appendix Behavior Category Description After a read/write command, the Request Option 1: The configuration request is in an error state. The parameter "S7 Byte Address" is second nibble of the error variables greater than the data area of the is at the value 3 (Address out of requested "Data Area". range). Option 2: Please check the setting "Optimized Block Access" on the requested data block of the S7 Controller. You can find further information about this in the chapter Activating the S7 protocol access [} 27]. After a read/write command, the Request The requested object is not on the request is in an error state. The S7 Controller. Please check second nibble of the error variables whether the configuration is at the value 6 (Object does not parameter "S7 Data Block" was set exist). correctly. After a read command, incorrect Request Please check whether the address values are displayed. data of the S7 data point were selected correctly or whether they have been changed, e.g. by a change in the S7 control program. I cannot add an Input Data Area to Request Writing input variables is not a write request permitted. I added the symbol server to the Symbol server Please make sure that you use target browser, but I don't see any Twin CAT 3.1 Build 4024.14 at variables. minimum on the system that you have activated the project on. The symbol server interface is only available from this Twin CAT version. 7.2 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support TF6620 Version: 1.5.0 65
## Page 66

Appendix • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 66 Version: 1.5.0 TF6620
## Page 67

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 68

More Information: www.beckhoff.com/tf6620 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
