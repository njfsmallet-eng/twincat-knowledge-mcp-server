---
title: "TwinCAT_3_PLC_Lib_Tc3_BA_Common_EN"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "COMMON", "LIB", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.2.2"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc3_BA_Common_EN.pdf"
release_date: "2024-06-05"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc3_BA_Common 2024-06-05 | Version: 1.2.2
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 General Information.................................................................................................................................. 9 4 Programming........................................................................................................................................... 10 4.1 POUs............................................................................................................................................... 10 4.1.1 Controller.......................................................................................................................... 10 4.1.2 Universal.......................................................................................................................... 22 4.2 DUTs............................................................................................................................................... 40 4.2.1 Structures......................................................................................................................... 40 4.2.2 Enums.............................................................................................................................. 41 4.3 GVLs............................................................................................................................................... 43 4.3.1 Parameter........................................................................................................................ 43 5 Appendix.................................................................................................................................................. 44 5.1 Support and Service........................................................................................................................ 44 TE1000 Version: 1.2.2 3
## Page 4

Table of contents 4 Version: 1.2.2 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. For installation and commissioning of the components, it is absolutely necessary to observe the documentation and the following notes and explanations. The qualified personnel is obliged to always use the currently valid documentation. The responsible staff must ensure that the application or use of the products described satisfies all requirements for safety, including all the relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. No claims to modify products that have already been supplied may be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of designations or trademarks used in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Patents The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 and similar applications and registrations in several other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document as well as the use and communication of its contents without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. TE1000 Version: 1.2.2 5
## Page 6

Foreword Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.2.2 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.2.2 7
## Page 8

Introduction 2 Introduction The Twin CAT3 Building Automation library (TC3 BA Common) provides controller function blocks and a sequence linker function block. These function blocks are used by both the TC3_BA library and the Tc2_BACnet Rev12 library. 8 Version: 1.2.2 TE1000
## Page 9

General Information 3 General Information Further libraries required For PC systems and Embedded PCs (CXxxxx): • Tc2_Standard • Tc2_Tc Base • Tc2_Tc System • Tc2_Tc Utilities TE1000 Version: 1.2.2 9
## Page 10

Programming 4 Programming 4.1 POUs 4.1.1 Controller Function blocks Name Description FB_BA_Seq Ctrl [} 16] Sequence controller (see Introduction – sequence controller [} 10]). FB_BA_Seq Link [} 20] Sequence controller control function block. FB_BA_PIDCtrl [} 13] Universal PID controller. 4.1.1.1 Introduction – sequence controller In heating, ventilation and air-conditioning systems, it is often the case that several actuators, working in a so-called controller sequence, are used in order to achieve a control variable. In the air conditioning system shown below, three actuators are involved in the regulation of the supply air temperature. In the project a dedicated sequence controller is instanced for each of these actuators. During active control only one of these sequence controllers is active. The other, non-active controllers fix their control signal so that it is energetically optimal for the tempering of the inlet air temperature. Depending on the direction of action of the individual controller, this means either the maximum or the minimum for the control value lr Y. If the effect of the active actuator (controller) is insufficient when reaching an end position, the active controller switches to the adjacent controller to the left or right. This then takes over control. The previously active controller remains at the end position of lr YMax or lr YMin, depending on the direction of action. This is repeated with the remaining actuators until the set value or the left or right end of the sequence is reached. In the sequence of the illustrated air conditioning system, all actuators that influence the control variable are shown from left to right. At the far left is the actuator that enables the greatest possible increase in the supply air temperature; at the far right is the actuator that effects the greatest possible decrease in the supply air temperature. Some actuators, such as a recirculating air flap or a heat recovery unit change their direction of action during operation. (indirect = heating, direct = cooling) Actuators with varying direction of action, such as outside air flap, recirculating air flap or heat recovery unit, are only listed once. • 1: Preheater controller • 2: Mixed air controller • 3: Cooler Schematic diagram This plant is schematically represented as follows: 10 Version: 1.2.2 TE1000
## Page 11

Programming Rules for creating a sequence The following rules must be followed for creating the sequences; inlet air control is used as reference: • The sequence controllers are numbered starting with the heating sequences with low ordinal numbers to the cooling sequences with high ordinal numbers. • A series of heating sequences should not include a cooling sequence. Similarly, a series of cooling sequences should not include a heating sequence. Sequences with reversal of direction of action for a mixed air system or heat recovery should be positioned between the heating and cooling sequences. In this diagram controller 4 would be placed incorrectly, if controller 5 changed to heating mode. Or: Controller 4 is correct, but controller 5 would have to be a pure cooling controller. In both cases there would be two switches from heating to cooling. • The set values within the sequence must be monotonically increasing. This requirement is a result of the switching behavior explained above: If the set value of a controller with a lower number is higher than the next higher one, the result could be continuous switching between the two controllers. As mentioned above, controllers with the same direction of action usually have the same set value. SP1 ≤ SP2 ≤ SP3 ≤ SP4 ≤ SP5 ≤ SP6 ≤ SP7 ≤ SP8 ≤ SP9 Sequence controllers in the PLC The TC3_BA_Common library provides two function blocks for the implementation of a sequence controller in the PLC program: The function block FB_BA_Seq Ctrl [} 16]: This function block provides an individual controller as part of a sequence of up to 16 controllers. TE1000 Version: 1.2.2 11
## Page 12

Programming The function block FB_BA_Seq Link [} 20]: This function block is the control function block of the sequence and therefore only exists once per sequence. It decides which controller of the sequence is currently active and checks the sequence for certain error states, such as duplicate allocation of ordinal number at the controllers. The structure variable ST_BA_Seq Link [} 40] is used to link the sequence controllers with the sequence linker FB_BA_Seq Link [} 20]. This structure variable has to be declared once per sequence control. The sequence control is enabled at input b En of the function block FB_BA_Seq Link [} 20]. The variable usi Start Ctrl is used to determine which controller is used as the first one after the start of control mode. In the example, the sequence controller with the no. 5 is assigned as the start controller. Switching from controller 5 to another controller in the sequence after restarting the control is blocked for the value of the input variable udi Ini Swi Ovr Dly_sec. 12 Version: 1.2.2 TE1000
## Page 13

Programming 4.1.1.2 FB_BA_PIDCtrl Universal PID controller, alternatively in parallel structure or with upstream proportional component. Functional description This controller is divided internally into two consecutive parts: • the controller itself, illustrated in the functional diagrams below as P, I and D component with an output limitation. • a deadband element that applies a hysteresis to the output changes of the controller. Functional diagram udi Mode = 0 (upstream proportional component): udi Mode = 1 (parallel structure): TE1000 Version: 1.2.2 13
## Page 14

Programming Passive behavior (b En = FALSE) The outputs are set as follows: r Y 0.0 r E 0.0 b ARW FALSE The internal values for the P, I, and D components are set to 0, also the values for the I and D components of the preceding cycle. In case of a restart the control value is thus calculated in the first cycle without past values. Active behavior (b En = TRUE) In the first cycle, the I and D components are calculated "clean", i.e. without historical values, as already mentioned. Synchronization A positive signal at b Sync sets the I component such that the control value assumes the value r Sync. If b En and b Sync are set at the same time, this method can be used to set an initial value as a starting point for the control. If the I component is not active, the D component is set accordingly. Note that internally only the rising edge of b Sync is evaluated, in view of the fact that it is a set action. For a further synchronization, e.g. with a transfer value, a TRUE signal must be set again at input b Sync. Anti-Reset-Windup If the I component is active, the controller ensures that it this maintained if the controller output r Y should try to go beyond the limits r YMin or r YMax. A preliminary calculation of the controller output takes place inside the controller in every cycle. If this is smaller than the lower output limit r YMin or greater than the upper limit r YMax, then the I component is adjusted in such a way that the sum of the P, I and D components results in r YMin or r YMax respectively. This ensures that the I component is always just large enough so that the control value can immediately assume values within the limits in the case of a corresponding control deviation without an integral component that has become too large having to be reduced first. Direction of action b Actn = FALSE can be used to reverse the direction of action such that a control deviation of less than 0 results in a change in control value to positive. This is achieved by a negative calculation of the control deviation: b Actn r XW (control deviation) Direction of action TRUE r X-r W (actual value-set value) direct (cooling) FALSE r W-r X (set value-actual value) indirect (heating) Neutral zone A value of r NZ > 0.0 enables the function of the neutral zone (deadband). A value equal to zero deactivates the deadband element and the values at the input are passed directly through. If, in the active case, the change at the input of the element r Yin in a PLC cycle is smaller than r NZ/2 in comparison with the previous PLC cycle, then the output is held at the value of the previous cycle until the change is larger than or equal to r NZ/2. Example: r NZ = 1, r Yin = 55.0, r Y = 55.0 14 Version: 1.2.2 TE1000
## Page 15

Programming PLC cycle+1 r Yin = 55.2 r Y = 55.0 PLC cycle+2 r Yin = 55.3 r Y = 55.0 PLC cycle+3 r Yin = 55.1 r Y = 55.0 PLC cycle+4 r Yin = 55.6 r Y = 55.6 PLC cycle+5 r Yin = 55.4 r Y = 55.6 PLC cycle+6 r Yin = 55.3 r Y = 55.6 PLC cycle+7 r Yin = 55.1 r Y = 55.1 This function is intended to avoid an unnecessarily large number of actuating pulses. VAR_INPUT b En : BOOL; r W : REAL; r X : REAL; udi Op Mode : UDINT; b Actn : BOOL; r Kp : REAL; udi Tn_ms : UDINT; udi Tv_ms : UDINT; udi Td_ms : UDINT; r YMax : REAL; r YMin : REAL; r NZ : REAL; udi Cyc Cl : UDINT; b Sync : BOOL; r Sync : REAL; b En: Controller activation. r W: Set value. r X: Actual value. udi Op Mode: udi Mode = 0: Controller with upstream proportional component, udi Mode = 1: Controller in parallel structure. Internally limited to the values 0 and 1. b Actn: Direction of action [} 14] of the controller. r Kp: Controller gain. Only affects the proportional component. Internally limited to a minimum value of 0. udi Tn_ms: Integral action time of the I component [ms]. A zero value at this parameter disables the I component. Internally limited to a minimum value of 0. udi Tv_ms: Rate time of the D component [ms]. A zero value at this parameter disables the D component. Internally limited to a minimum value of 0. udi Td_ms: Damping time of the D component [s]. Internally limited to a minimum value of 0. r YMax: Upper controller output limit. Selectable range: 0..100%. r YMin: Lower controller output limit [%]. Selectable range: 0..100%. The value r YMin is upwardly limited by r YMax. r NZ: Neutral zone. udi Cyc Cl: Call cycle of the function block as a multiple of the cycle time. Internally limited to a minimum value of 1. Example: t Task Cycle Time = 20ms, udi Ctrl Cycle Call =10 -> The control algorithm is called every 200 ms. Thus the outputs are also updated only every 200 ms. b Sync / r Sync: Synchronization command: Set output value r Y to r Sync. The value r Sync is limited internally to values ranging from r YMin to r YMax. VAR_OUTPUT r Y : REAL; r E : REAL; b ARW : BOOL; TE1000 Version: 1.2.2 15
## Page 16

Programming r Y: Control value. Range limited by r YMin and r YMax. r E: Control deviation (The calculation depends on the direction of action [} 14]). b ARW: Anti-Reset-Windup function is active. Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 4.1.1.3 FB_BA_Seq Ctrl PID controller as part of a sequence. Functional description The functionalities of this controller are identical to FB_BA_PIDCtrl [} 13]. udi Op Mode = 0 (upstream proportional component) udi Op Mode = 1 (parallel structure) 16 Version: 1.2.2 TE1000
## Page 17

Programming In addition the controller, if enabled by b En = TRUE, is controlled via a higher level control function block FB_BA_Seq Link [} 20]. The data exchange between the control function block FB_BA_Seq Link [} 20] and the sequence controllers FB_BA_Seq Ctrl takes place via the structure variable st Seq Link [} 40]. Heating-cooling sequence The controller sequence should be configured such that the sequence controller with lower ordinal number are used for heating and the ones with the higher number for cooling. Only one change is permitted: • Sequence controller n (udi My Num=n, b Actn=TRUE) • Sequence controller n+1 (udi My Num = n+1, b Actn = FALSE) Exclusive programming of cooling and heating controllers is also possible. Any parameterization that contradicts this convention is detected and indicated as an error at control function block FB_BA_Seq Link [} 20]. Controller output The control function block FB_BA_Seq Link [} 20] specifies which sequence controller is active. What is output at the respective control output r Y is determined inside the individual sequence controllers. Each controller receives the information about the states of the other controllers via the in-out variable st Seq Link and evaluates four cases internally. 1. None of the sequence controllers is enabled, whether due to a missing enable signal (b En) at the input or due to an error detected on the control function block FB_BA_Seq Link [} 20] -> The internal PID controllers are inactive and output 0.0 at the control output r Y. 2. The sequence controller is enabled and has been set to active by the control function block FB_BA_Seq Link [} 20]. -> The internal PID controller is active. Its output signal is output at the control output r Y. 3. The sequence controller is enabled, but a sequence controller with a higher ordinal number has been set to active by the control function block FB_BA_Seq Link [} 20] -> The internal PID controller is inactive. If the sequence controller is in heating mode (b Actn=FALSE), it will output its minimum value r YMin at the control output r Y. Conversely, if it is in cooling mode (b Actn = TRUE), then it outputs the maximum value r YMax at the control output r Y. 4. The sequence controller is enabled, but a sequence controller with a lower ordinal number has been set to active by the control function block FB_BA_Seq Link [} 20] -> The internal PID controller is inactive. If the sequence controller is in heating mode (b Actn=FALSE), it will output its maximum value r YMax at the control output r Y. If it is in cooling mode (b Actn=TRUE), it will output its minimum value r YMin at the control output r Y. Synchronization If a sequence controller is activated by the higher-level controller, this always results in synchronization, i.e. the controller starts with a fixed value at the output r Y. 3 cases are distinguished: TE1000 Version: 1.2.2 17
## Page 18

Programming 1. The entire sequence control was switched on via the input b En of the higher-level controller FB_BA_Seq Link [} 20]. The controller with the ordinal number udi Stt Ctrl at the input of FB_BA_Seq Link [} 20] is the start controller. -> The sequence controller is synchronized with the value, which is entered at its input r YSeq Init. 2. The sequence controller, which has just has been activated, had a higher ordinal number than the "previous" one -> If the sequence controller is in heating mode (b Actn = FALSE), then it is synchronized with its minimum value r YMin. If it is in cooling mode (b Actn=TRUE), the synchronization value is its maximum value r YMax. 3. The sequence controller, which has just has been activated, had a lower ordinal number than the "previous" one -> If the sequence controller is in heating mode (b Actn = FALSE), then it is synchronized with its maximum value r YMax. If it is in cooling mode (b Actn=TRUE), the synchronization value is its minimum value r YMin. Each sequence controller can also be synchronized by specifying a value r Sync and activating b Sync, if it has just been activated by the higher-level controller. A constant TRUE signal at the input b Sync (e.g. accidental) is internally intercepted through edge formation, so that obstruction of the synchronization described above on activation is avoided. Start-up behavior In order to enable "sensible" adjustment of the entire control sequence, the start controller is maintained in active state as a minimum for the time udi Ini Swi Ovr Dly_sec [s], which is entered at the function block FB_BA_Seq Link [} 20]. During this time, no switching takes place to another controller of this sequence. The output r Y of the start controller is synchronized once to its value r YSeq Init. VAR_INPUT b En : BOOL; r W : REAL; r X : REAL; udi Op Mode : UDINT; b Actn : BOOL; r Kp : REAL; udi Tn_ms : UDINT; udi Tv_ms : UDINT; udi Td_ms : UDINT; r YMax : REAL; r YMin : REAL; r NZ : REAL; udi Cyc Cl : UDINT; b Sync : BOOL; r Sync : REAL; r YSeq Init : REAL; udi My Num : UDINT; b En: Activation of the sequence controller r W: Set value r X: Actual value udi Op Mode: udi Op Mode=0: Controller with upstream proportional component, udi Op Mode = 1: Controller in parallel structure. The values are limited internally to 0 and 1. b Actn: Direction of action reversal of the controller. For heating/cooling operation: b Actn=FALSE corresponds to heating mode, b Actn=TRUE corresponds to cooling mode. r Kp: Controller gain. Only affects the proportional component. Internally limited to a minimum value of 0. udi Tn_ms: Integral action time of the I component [ms]. A zero value at this parameter disables the I component. Internally limited to a minimum value of 0. udi Tv_ms: Rate time of the D component [ms]. A zero value at this parameter disables the D component. Internally limited to a minimum value of 0. udi Td_ms: Damping time of the D component [s]. Internally limited to a minimum value of 0. 18 Version: 1.2.2 TE1000
## Page 19

Programming r YMax: Upper controller output limit [%]. Selectable range: 0..100%. r YMin: Lower controller output limit [%]. Selectable range: 0..100%. The value lr Min is upwardly limited by lr YMax. r NZ: neutral zone (see Deadband diagram). Internally limited to a minimum value of 0. Mode of action is same as FB_BA_PID_Ctrl [} 13]. udi Cyc Cl: Call cycle of the function block as a multiple of the cycle time. Internally limited to a minimum value of 1. Example: t Task Cycle Time = 20 ms, udi Cyc Cl = 10 -> the control algorithm is called every 200 ms. Thus the outputs are also updated only every 200 ms. b Sync / r Sync: Synchronization command: Set output value r Y to r Sync. The value r Sync is limited internally to values ranging from r YMin to r YMax. r YSeq Init: Starting value of the controller after restart of the whole control sequence. udi My Num: Ordinal number of the sequence controller. Internally limited to values ranging from 0 to g BA_c Max Seq Ctrl. VAR_OUTPUT r Y : REAL; r E : REAL; b Err : BOOL; s Err Descr : T_MAXSTRING; r Y: Control value. Section: 0..100%, unless limited further by r YMin and r YMax. r E: Control deviation (The calculation depends on the direction of action [} 14]). b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: The controller ordinal number udi My Num has been assigned twice 02: Error: The controller ordinal number udi My Num of the enabled controller is 0. That is only allowed for controllers that are not in use and thus not enabled. VAR_IN_OUT st Seq Link : ST_BA_Seq Link; st Seq Link: Data and command structure (see ST_BA_Seq Link / ST_BA_Seq Link Data [} 40]) between the individual sequence controllers and the control function block FB_BA_Seq Link [} 20]. If several sequence controllers have the same number (di My Num), this is detected and output as an error at the sequence controller and at the control function block FB_BA_Seq Link [} 20]. Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 TE1000 Version: 1.2.2 19
## Page 20

Programming 4.1.1.4 FB_BA_Seq Link This function block represents the higher-level control unit, which specifies which sequence controller is currently active. The data exchange between the control function block FB_BA_Seq Link and the sequence controllers FB_BA_Seq Ctrl [} 16] takes place via the structure variable st Seq Link [} 40]. Functional description Start-up behavior A TRUE signal at input b En activates the entire sequence control. The function block will initially activate the sequence controller named on udi Stt Ctrl. All other sequence controller base their output value on the ranking of the active controller, see FB_BA_Seq Ctrl [} 16]. The start controller will be set once to its value r Sync at the start of the sequence. In order to enable "sensible" adjustment of the entire control sequence, the start controller is maintained in active state as a minimum for the time udi Ini Swi Ovr Dly_sec [s]. During this time, no switching takes place to another controller of this sequence. Switching behavior When the sequence controller reaches its maximum or minimum value, the next controller in the sequence is activated, depending on the controller direction of action, if the actual value is below or above the set value of the next controller. 4 cases are distinguished: • The still active controller has direct direction of action (cooling) and is at its maximum value: The next higher controller in the sequence will be selected if the actual value exceeds the set value for this controller. • The still active controller has direct direction of action (cooling) and is at its minimum value: The next lower controller in the sequence is then selected, if the actual value falls below the set value for this controller. • The still active controller has indirect direction of action (heating) and is at its maximum value: The next lower controller in the sequence is then selected, if the actual value falls below the set value for this controller. • The still active controller has indirect direction of action (heating) and is at its minimum value: The next higher controller in the sequence will be selected if the actual value exceeds the set value for this controller. Switch-off behavior If the enable status is removed from a controller within the sequence or if it develops a fault, it is no longer available for the whole sequence. If this is not the previously active controller, a temperature change may occur, depending on which control value this controller has output, which is compensated by the controller sequence, if possible. However, if it is the active controller whose enable is canceled, the next "sensible" controller must be selected. The sequence link function block uses the following rules: • The deactivated controller had direct direction of action (cooling) 20 Version: 1.2.2 TE1000
## Page 21

Programming There is an operational controller with a higher ordinal number → switch to the next higher operational controller. Only an operational controller with lower ordinal number is available → switch to the next lower operational controller. No operational controller is available → fault message • The deactivated controller had indirect direction of action (heating) • An operational controller with lower ordinal number is available → switch to the next lower operational controller. There is an operational controller with a higher ordinal number → switch to the next higher operational controller. No operational controller is available → fault message Sequence behavior If a controller is added to the sequence, it is in any case initially inactive and will output its minimum or maximum value, depending on the direction of action and positioning within the sequence order. The resulting temperature change is compensated by the controller sequence, if possible. VAR_INPUT b En : BOOL; udi Stt Ctrl : UDINT; udi Ini Swi Ovr Dly_sec : UDINT; r X : REAL b En: Activation of the sequence controller. udi Stt Ctrl: Ordinal number of the sequence controller that should be the start controller upon general activation. Internally limited to values ranging from 0 to g BA_c Max Seq Ctrl. udi Ini Swi Ovr Dly_sec: The first controller remains active for at least this time [s] in the sequence before other criteria (see Switching behavior [} 20]) allow switching to a different controller. r X: Actual value of the control. VAR_OUTPUT udi Cur Ctrl : UDINT; b Seq Actv : BOOL; b Not Read : BOOL; b None Op : BOOL; udi Rem Ti Ini Swi Ovr Dly_sec : UDINT; b Err : BOOL; s Err Descr : T_MAXSTRING; udi Cur Ctrl: Ordinal number of the currently active sequence controller. If no controller is active, 0 is output here. b Seq Actv: The sequence function block is enabled (b En) and has no error resulting in switch-off, see error detection. b Not Read: Each sequence controller transfers data to the control function block via the structure st Seq Link. This output is TRUE, as long as no data were transmitted - this is the case when the PLC is switched on. b None Op: This output is switched to TRUE, if none of the sequence controller is enabled (b En=TRUE). udi Rem Ti Ini Swi Ovr Dly_sec: Remaining initialization time [s] before switching for the first time (see Switching behavior [} 20]). b Err: This output is switched to TRUE if the parameters entered are erroneous. This function block may not suspend its execution in the event of an error, see error detection. s Err Descr: Contains the error description. TE1000 Version: 1.2.2 21
## Page 22

Programming Error description 01: Error: The sequence link has been informed that the controller ordinal number udi My Num has been assigned twice. 02: Warning: Direction of action changed twice in the controller sequence. 03: Warning: In the controller sequence, a controller with a higher ordinal number has a lower set value than its "predecessor". No correction takes place; the controller sequence runs with the parameters that were entered. 04: Warning: The sequence controller, which is defined as start controller (udi Stt Ctrl) is not parameterized at all, i.e. it is not present. The controller with the lowest ordinal number is used as start controller. 05: Warning: The ordinal number of the start controller is higher than the maximum permitted number of controllers or zero. The controller with the lowest ordinal number is used as start controller. 06: Warning: The sequence controller, which is defined as start controller (udi Stt Ctrl) is not enabled (present). The controller with the lowest ordinal number is used as start controller. Only the first error triggers a fault in the sequence link function block and blocks its execution (b Seq Actv = FALSE). All associated controllers are then no longer active, and all controllers issue the control value "0". The function block is not active: VAR_IN_OUT st Seq Link : ST_BA_Seq Link; st Seq Link: Data and command structure (see ST_BA_Seq Link / ST_BA_Seq Link Data [} 40]) between the individual sequence controllers and the control function block FB_BA_Seq Link. This structure is used by the sequence link function block to receive all relevant sequence controller data and at the same time to notify the controllers which is the active one. If several sequence controllers have the same number (udi My Num), this is detected and output as an error at the sequence controller and at the control function block. Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 4.1.2 Universal 4.1.2.1 Analog inputs/outputs 4.1.2.1.1 FB_BA_KL32xx Config 22 Version: 1.2.2 TE1000
## Page 23

Programming Configuration of the Bus Terminals for temperature measurement. Functional description The function block is for the configuration of Bus Terminals of the types KL3208_0010, KL3201, KL3202 and KL3204. VAR_INPUT TI_usi State : USINT; TI_i Data In : INT; b Configurate : BOOL; b Read Config : BOOL; e Terminal : E_BA_TERMINAL_KL; e Sensor : E_BA_SENSOR; TI_usi State: Linking with the corresponding status byte of the Bus Terminal in the I/O area of the program. TI_i Data In: Linking with the corresponding raw data (Data In) of the Bus Terminal in the I/O area of the program (0 - 32767). b Configurate: A rising edge starts the configuration of the Bus Terminal. b Read Config: A rising edge starts the reading of the Bus Terminal. e Terminal: Selection of the respective Bus Terminal (see E_BA_Terminal_KL [} 41]). e Sensor: Selection of the sensor type (see E_BA_Sensor [} 42]). VAR_OUTPUT TO_usi Ctrl : USINT; TO_i Data Out : INT; usi State : USINT; i Data : INT; r Val : REAL; b Wire Break : BOOL; b Short Circuit : BOOL; w Terminal Type : WORD; w Special Type : WORD; w Firmware Version : WORD; s Description : STRING; s Sensor Type : STRING; b Err : BOOL; s Err Descr : T_MAXSTRING; TO_usi Ctrl: Linking with the corresponding control byte of the Bus Terminal in the I/O area of the program. TO_i Data Out: Linking with the corresponding raw data (Data Out) of the Bus Terminal in the I/O area of the program. usi State: Output of the present terminal status. i Data: Output of the present process data. r Val: Scaled output value. b Wire Break: Display of the channel status, sensor wire breakage. b Short Circuit: Display of the channel status, sensor short-circuit. w Terminal Type: Display of the terminal type. w Special Type: Display of the special version of the terminal. w Firmware Version: Display of the terminal firmware. s Description: Display of the terminal type and firmware. s Sensor Type: Display of the sensor type. b Err: Error in the terminal configuration. TE1000 Version: 1.2.2 23
## Page 24

Programming s Err Descr: Contains the error description. Error description 01: Error: Check the terminal configuration KL32xx e Terminal/e Sensor/TI_usi State/TI_i Data In/TO_usi Ctrl/ TO_i Data Out Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 4.1.2.2 Array 4.1.2.2.1 FB_BA_Dynamic Array The function block generates and deletes memory areas dynamically so that entries can be added and removed at runtime. As soon as the maximum capacity [} 28] of the array is reached, the internal memory area is automatically extended. If the capacity is more than sufficient, the internal memory area is reduced in size. The internally used memory is allocated from the router memory pool and is generated via _NEW and released via _DELETE at runtime. With each adaptation (i.e. extension or reduction in size) of the internal memory, the pointers to the obsolete/adapted memory are also invalid! The data type of the entries is not important for the dynamic array! The user must ensure in every case that the data type is always correctly observed by the application when dealing with contained entries. Furthermore, all data added to the array must have a uniformly defined size [} 24]! It is recommended to use the dynamic array in particular in cases where the expected memory utilization can be estimated relatively well. Router memory is only available to a limited extent (especially with small controllers) and is to be used as efficiently as possible! If necessary, the amount of router memory available in the target system must additionally be adapted. VAR_OUTPUT b Ready : BOOL; discount : DINT; b Ready: Status of the allocated memory. (TRUE if at least one entry is contained in the array and memory is thus already generated) di Count: Current number of entries contained. VAR Internal variables that have to be initialized during the declaration. ui Entry Size : UINT; ui Min Exp Count: : UINT; ui Entry Size: Expected size of entries. Used to allocate internal memory and to manage memory areas of recorded entries. ui Min Exp Count: Expected size of the internal memory (specified in [number of entries]) on reaching the maximum capacity [} 28]. 24 Version: 1.2.2 TE1000
## Page 25

Programming For further information, see examples [} 25] of initialization during variable declaration. Application Two typical application cases are imaginable: Case 1) Array contains data sets In this case the array contains data sets (generic types such as BOOL, INT, STRING or structures) by reserving internal memory in accordance with the size of the type used. Case 2) Array contains pointers In this case the array contains pointers to externally declared data and only memory corresponding to the size of memory addresses is reserved. Instances of the dynamic array are not called cyclically. It is sufficient to use the management functions and properties described here. Examples Example 1: Data sets of the data type ST_DATA are stored in an array. Access to the respective data sets takes place by means of pointers to the internal memory of the array or by means of a copy of a data set. VAR fb Array : FB_Dynamic Array := (ui Entry Size:=SIZEOF(ST_Data), ui Min Exp Count:=5); st My Data Tmp : ST_Data; ptr My Data Tmp : POINTER TO ST_Data; di Index Tmp : DINT; END_VAR // 1) Save data in array and remove them with the help of index position: IF (fb Array. Add Entry(ADR(st My Data Tmp), di Result Index=>di Index Tmp)) THEN fb Array. Remove Entry(di Index Tmp); END_IF // 2) List all data sets consecutively: FOR di Index Tmp = 0 TO fb Array. Last Index DO IF (fb Array. Get Entry Ex(di Index Tmp, p Memory Ptr=>ptr My Data Temp)) THEN ptr My Data Tmp^.di Value := (di Index Tmp+1); END_IF END_FOR // 3) Get a copy of the first data set: If (fb Array. Get Entry(0, ADR(st My Data Tmp))) THEN // Edit and update data set: st My Data Tmp.di Value := 99; fb Array. Set Entry(0, ADR(st My Data Tmp)); END_IF Example 2: The addresses of externally declared instances of the function block FB_Object are stored in an array. VAR fb Array : FB_Dynamic Array := (ui Entry Size:=SIZEOF(POINTER TO FB_Object), ui Min Exp Count:=5); fb My Object1 : FB_Object; fb My Object2 : FB_Object; fb Object Tmp : POINTER TO FB_Object; di Index Tmp : DINT; END_VAR // 1) Add object to array and remove it with the help of index position: If (fb Array. Add Entry Ptr(ADR(fb My Object1), di Result Index=>di Index Tmp)) THEN fb Array. Remove Entry(di Index Tmp); END_IF // 2) Add object to array and remove subsequently with the use of the pointer: TE1000 Version: 1.2.2 25
## Page 26

Programming fb Array. Add Entry Ptr(ADR(fb My Object1)); fb Array. Remove Entry Ex Ptr(ADR(fb My Object1)); // 3) Determine the index position of an object within an array: IF (fb Array. Find Entry Ptr(ADR(fb My Object1), di Result Index=>di Index Temp)) THEN // Replace entry on position "fb My Object1" with "fb My Object2": fb Array. Set Entry Ptr(di Index Tmp, ADR(fb My Object2)); ELSE // Error handling … END_IF // 4) Determine first object: IF (fb Array. Get Entry(0,ADR(fb Obj Temp))) THEN // … END_IF // 5) Remove content of the array if it has more than 10 entries: IF(fb Array.di Count > 10) THEN fb_Array. Reset(); END_IF Error messages The following error messages may be output in the Twin CAT display window at runtime: [EDB4] Entry-size of array not defined! The expected size [} 24] of entries was not initialized during the declaration of the array. [EDB7] Expansion-count of entries not defined! The expected size [} 24] of the internal memory was not initialized during the declaration of the array. 26 Version: 1.2.2 TE1000
## Page 27

Programming Methods of FB_BA_Dynamic Array Name Definition location Description Add Entry [} 28] Local Creates a new data set at the end of the array and copies the content of the specified entry to the internal memory Find Entry [} 28] Local Determines the position of the specified entry in the array by comparing its content with the data sets of the array. Get Entry [} 29] Local Copies the contents of the data set to a certain position in the specified memory area. Get Entry Ex [} 29] Local Determines a pointer to the internal memory of the specified data set. Remove Entry [} 29] Local Removes the data set at the specified index position from the array. Remove Entry Ex [} 30] Local Determines the position of the specified entry and deletes it from the array. Reset [} 30] Local Resets the complete content of the array. Set Entry [} 30] Local Replaces the existing data set with a new one by overwriting the internal memory area of the existing data set with the value of the new entry. Add Entry Ptr [} 31] Local Creates a new entry at the end of the array and copies its memory address (i.e. the address to which the pointer p Entry points) to the internal memory. Find Entry Ptr [} 31] Local Determines the position of an entry in the array by comparing its address with the addresses stored in the array. Get Entry Ex Ptr [} 31] Local Outputs a pointer to the memory address of the requested entry. Remove Entry Ex Ptr [} 32] Local Determines the position of the specified entry and deletes it from the array. Set Entry Ptr [} 32] Local Replaces an existing entry with a new one. TE1000 Version: 1.2.2 27
## Page 28

Programming Properties of FB_BA_Dynamic Array Name Type Access Definition loca- Initial value Description tion Cur Capacity DINT Get Local - Current capacity of the array (number of entries). Corresponds to the maximum number of entries that can be accepted by the internal memory. Entry Size DINT Get Local ui Entry Size Expected size of entries that are stored in the array [} 24] Last Index DINT Get Local - Index position of the last entry. This is -1 if no entries exist Used Memory DINT Get Local - Size of the internal memory consumed [bytes]. Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 4.1.2.2.1.1 Add Entry Creates a new data set at the end of the array and copies the content of the specified entry to the internal memory. VAR_INPUT p Entry : PVOID; p Entry: Pointer to the entry to be added. VAR_OUTPUT Add Entry : BOOL; di Result Index : DINT; Add Entry: Result of the function. di Result Index: Index position of the entry added. 4.1.2.2.1.2 Find Entry Determines the position of the specified entry in the array by comparing its content with the data sets of the array. 28 Version: 1.2.2 TE1000
## Page 29

Programming VAR_INPUT p Entry : PVOID; p Entry: Pointer to the entry sought. VAR_OUTPUT Find Entry : BOOL; di Result Index : DINT; Find Entry: Result of the function. di Result Index: Index position of the entry added. 4.1.2.2.1.3 Get Entry Copies the contents of the data set to a certain position in the specified memory area. VAR_INPUT di Index : DINT; p Result Entry : PVOID; di Index: Index position of the data set to be output. p Result Entry: Pointer to the memory area that is to be used to output the data record. VAR_OUTPUT Get Entry : BOOL; Get Entry: Result of the function. 4.1.2.2.1.4 Get Entry Ex Determines a pointer to the internal memory of the specified data set. VAR_INPUT di Index : DINT; di Index: Index position of the data set to be output. VAR_OUTPUT Get Entry Ex : BOOL; p Memory Ptr : POINTER TO PVOID; Get Entry: Result of the function. p Memory Ptr: Pointer that is to be used to output the data set. 4.1.2.2.1.5 Remove Entry Removes the data set at the specified index position from the array. TE1000 Version: 1.2.2 29
## Page 30

Programming VAR_INPUT di Index : DINT; di Index: Index position of the data set to be removed. VAR_OUTPUT Remove Entry : BOOL; Remove Entry: Result of the function. 4.1.2.2.1.6 Remove Entry Ex Determines the position of the specified entry and deletes it from the array. VAR_INPUT p Entry : PVOID; p Entry: Pointer to the entry to be removed. VAR_OUTPUT Remove Entry Ex : BOOL; Remove Entry Ex: Result of the function. 4.1.2.2.1.7 Reset Resets the complete content of the array. 4.1.2.2.1.8 Set Entry Replaces the existing data set with a new one by overwriting the internal memory area of the existing data set with the value of the new entry. VAR_INPUT di Index : DINT; p Entry : PVOID; di Index: Index position of the data set to be replaced. p Entry: Pointer to the entry to be removed. VAR_OUTPUT Set Entry : BOOL; Set Entry: Result of the function. 30 Version: 1.2.2 TE1000
## Page 31

Programming 4.1.2.2.1.9 Add Entry Ptr Creates a new entry at the end of the array and copies its memory address (i.e. the address to which the pointer p Entry points) to the internal memory. VAR_INPUT p Entry : PVOID; p Entry: Pointer to the entry to be added. VAR_OUTPUT Add Entry Ptr : BOOL; di Result Index : DINT; Add Entry Ptr: Result of the function. di Result Index: Index position of the entry added. 4.1.2.2.1.10 Find Entry Ptr Determines the position of an entry in the array by comparing its address with the addresses stored in the array. VAR_INPUT p Entry : PVOID; p Entry: Pointer to the entry sought. VAR_OUTPUT Find Entry Ptr : BOOL; di Result Index : DINT; Find Entry Ptr: Result of the function. di Result Index: Index position of the entry sought. 4.1.2.2.1.11 Get Entry Ex Ptr Outputs a pointer to the memory address of the requested entry. VAR_INPUT di Index : DINT; di Index: Index position of the entry to be output. VAR_OUTPUT Get Entry Ex Ptr : BOOL; p Entry Ptr : POINTER TO PVOID; Get Entry Ex Ptr: Result of the function. TE1000 Version: 1.2.2 31
## Page 32

Programming p Entry Ptr: Pointer that is to be used to output the entry. 4.1.2.2.1.12 Remove Entry Ex Ptr Determines the position of the specified entry and deletes it from the array. VAR_INPUT p Entry : PVOID; p Entry: Pointer to the entry to be removed. VAR_OUTPUT Remove Entry Ex Ptr : BOOL; Remove Entry Ex Ptr: Result of the function. 4.1.2.2.1.13 Set Entry Ptr Replaces an existing entry by a new one by overwriting the memory address of the existing entry with the memory address of the new entry. VAR_INPUT di Index : DINT; p Entry : PVOID; di Index: Index position of the entry to be replaced. p Entry: Pointer to the entry to be replaced. VAR_OUTPUT Set Entry Ptr : BOOL; Set Entry Ptr: Result of the function. 4.1.2.2.2 FB_BA_Static Array The function block is an extension of the function block FB_Dynamic Array [} 24]. The background to this extension is to avoid the use of router memory and to use static memory instead. This must be declared in the application, where its size can be adapted as desired. The static memory must be provided by the application, but it must never be changed outside of the array! The management should take place in all cases via the array itself. It is recommended to always use the static array in cases where the expected memory utilization can be precisely estimated. 32 Version: 1.2.2 TE1000
## Page 33

Programming For reasons of efficiency the memory size should be dimensioned such that as little memory as possible and as much memory as necessary is reserved. Global constants and parameter lists are suitable for declaring the limits of the memory area. Application In principle the application cases are identical to those with the dynamic array [} 24]. Only the declaration differs in part, as the external memory area and its size are to be transferred there. Further information See examples [} 33] of initialization during variable declaration. Examples Example declaration of the array, its static memory and corresponding constants. VAR_GLOBAL CONSTANT ui Object Count : UINT := 100; ui Array Mem Size : UINT := TO_UINT(ui Object Count * SIZEOF(FB_OBJECT)); END_VAR VAR b Array Memory : ARRAY[0.. ui Array Mem Size] OF BYTE; fb Array : FB_Static Array := (ui Entry Size:=SIZEOF(FB_Object), p Ext Memory:=ADR(b Array Memory ), ui Ext Memory Size:=ui Array Mem Size);) END_VAR Further information Since the static array is to be used in exactly the same way as the dynamic array [} 24], appropriate application examples [} 25] are documented there. Methods of FB_BA_Static Array Name Definition location Description Add Entry [} 28] Local Creates a new data set at the end of the array and copies the content of the specified entry to the internal memory Reset [} 30] Local Resets the complete content of the array. Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 4.1.2.3 Log 4.1.2.3.1 FB_BA_Log Message The function block outputs messages in the Twin CAT display window. The symbol path of the function block is inserted for each message to be output so that the user can recognize the calling function block instance by the message. TE1000 Version: 1.2.2 33
## Page 34

Programming Instances of this function block cannot be called explicitly. Separate functions are available for various application cases, which are described in the following section of this documentation. The functionality to output messages is provided by the ADSLOGDINT function, which is used internally. VAR_OUTPUT s Result : T_Max STRING; s Result: Content of the message last output. Application Context-related additional information The developer has the possibility to output an abbreviation in each message. Using this abbreviation, messages can be localized more easily in the source code (e.g. when searching for the abbreviation using the search function). Suppression of cyclically repeated messages In order to suppress the cyclic output of the same message, the current log code is compared with the log code used last. If the two values correspond, the output of the message is suppressed, which conversely means that different successive messages would be displayed. This behavior can be influenced with the b Ignore Block option from the Show function: TRUE prevents the suppression of a cyclically repeated message. Example 1: The example function Do Work() outputs a warning in row 150: FUNCTION_BLOCK FB_TEST VAR fb Log Msg : FB_BA_Log Message; END_VAR FUNCTION Do Work fb Log Msg. Show(ADSLOG_MSGTYPE_WARN, 'DW150', 'Function not ready.', FALSE; Example 2: The example function Init() outputs an error message in row 80 that could be Suppression of cyclically repeated messages [} 34] FUNCTION_BLOCK FB_TEST VAR fb Log Msg : FB_BA_Log Message; i State : INT := 0; s Device : STRING := 'CX9020'; END_VAR FUNCTION Init fb Log Msg. Show1(ADSLOG_MSGTYPE_ERROR, 'I80', 'device %s has an Invalid state "%d".', F_STRINGEx(s Device), F_INT(i State), TRUE; Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 34 Version: 1.2.2 TE1000
## Page 35

Programming 4.1.2.3.1.1 Show Output of a simple message. VAR_INPUT d Log Type : DWORD; s Log Code : T_Max String; s Log Text : T_Max String; b Ignore Block : BOOL; d Log Type: Log type of the message to be displayed. s Log Code: Optional, context-related additional information [} 34]. s Log Text: Content of the message. b Ignore Block: Prevents the suppression of cyclically repeated messages [} 34]. VAR_OUTPUT Show : BOOL; Show: Indicator of whether a message was output (TRUE) or discarded (FALSE). 4.1.2.3.1.2 Show1 Output of a message with a value to be formatted. VAR_INPUT d Log Type : DWORD; s Log Code : T_Max String; s Log Text : T_Max String; t Arg1 : T_Arg; b Ignore Block : BOOL; d Log Type: Log type of the message to be displayed. s Log Code: Optional, context-related additional information [} 34]. s Log Text: Content of the message. t Arg1: Value to be formatted (see T_Arg). b Ignore Block: Prevents the suppression of cyclically repeated messages [} 34]. VAR_OUTPUT Show1 : BOOL; Show1: Indicator of whether a message was output (TRUE) or discarded (FALSE). TE1000 Version: 1.2.2 35
## Page 36

Programming 4.1.2.3.1.3 Show2 Output of a message with two values to be formatted. VAR_INPUT d Log Type : DWORD; s Log Code : T_Max String; s Log Text : T_Max String; t Arg1 : T_Arg; t Arg2 : T_Arg; b Ignore Block : BOOL; d Log Type: Log type of the message to be displayed. s Log Code: Optional, context-related additional information [} 34]. s Log Text: Content of the message. t Arg1: First value to be formatted (see T_Arg). t Arg2: Second value to be formatted (see T_Arg). b Ignore Block: Prevents the suppression of cyclically repeated messages [} 34]. VAR_OUTPUT Show2 : BOOL; Show2: Indicator of whether a message was output (TRUE) or discarded (FALSE). 4.1.2.3.1.4 Show3 Output of a message with two values to be formatted. VAR_INPUT d Log Type : DWORD; s Log Code : T_Max String; s Log Text : T_Max String; t Arg1 : T_Arg; t Arg2 : T_Arg; t Arg3 : T_Arg; b Ignore Block : BOOL; d Log Type: Log type of the message to be displayed. s Log Code: Optional, context-related additional information [} 34]. s Log Text: Content of the message. 36 Version: 1.2.2 TE1000
## Page 37

Programming t Arg1: First value to be formatted (see T_Arg). t Arg2: Second value to be formatted (see T_Arg). t Arg3: Second value to be formatted (see T_Arg). b Ignore Block: Prevents the suppression of cyclically repeated messages [} 34]. VAR_OUTPUT Show3 : BOOL; Show3: Indicator of whether a message was output (TRUE) or discarded (FALSE). 4.1.2.3.1.5 Show4 Output of a message with four values to be formatted. VAR_INPUT d Log Type : DWORD; s Log Code : T_Max String; s Log Text : T_Max String; t Arg1 : T_Arg; t Arg2 : T_Arg; t Arg3 : T_Arg; t Arg4 : T_Arg; b Ignore Block : BOOL; d Log Type: Log type of the message to be displayed. s Log Code: Optional, context-related additional information [} 34]. s Log Text: Content of the message. t Arg1: First value to be formatted (see T_Arg). t Arg2: Second value to be formatted (see T_Arg). t Arg3: Second value to be formatted (see T_Arg). t Arg4: Second value to be formatted (see T_Arg). b Ignore Block: Prevents the suppression of cyclically repeated messages [} 34]. VAR_OUTPUT Show4 : BOOL; Show4: Indicator of whether a message was output (TRUE) or discarded (FALSE). TE1000 Version: 1.2.2 37
## Page 38

Programming 4.1.2.3.1.6 Show5 Output of a message with five values to be formatted. VAR_INPUT d Log Type : DWORD; s Log Code : T_Max String; s Log Text : T_Max String; t Arg1 : T_Arg; t Arg2 : T_Arg; t Arg3 : T_Arg; t Arg4 : T_Arg; t Arg5 : T_Arg; b Ignore Block : BOOL; d Log Type: Log type of the message to be displayed. s Log Code: Optional, context-related additional information [} 34]. s Log Text: Content of the message. t Arg1: First value to be formatted (see T_Arg). t Arg2: Second value to be formatted (see T_Arg). t Arg3: Second value to be formatted (see T_Arg). t Arg4: Second value to be formatted (see T_Arg). t Arg5: Second value to be formatted (see T_Arg). b Ignore Block: Prevents the suppression of cyclically repeated messages [} 34]. VAR_OUTPUT Show5 : BOOL; Show5: Indicator of whether a message was output (TRUE) or discarded (FALSE). 4.1.2.4 Trigger 4.1.2.4.1 FB_BA_ATrig COV The function block monitors the value x Value for changes (Change of Value). The monitored value is independent of the data type (ANY). For reasons of performance, however, only data types smaller than or equal to 4 bytes are supported! 38 Version: 1.2.2 TE1000
## Page 39

Programming VAR_INPUT x Value : ANY; b Force : BOOL; x Value: Value to be monitored. b Force: Forces a positive comparison ("b Q=TRUE"). VAR_OUTPUT b Ready : BOOL; b Q : BOOL; b Ready: Indicates operability: If x Value is valid. Correct value assignment and observance of the permissible data type size. Memory is initialized. The comparison can be made at the earliest after one cycle, as the internal memory first has to be initialized with the value x Value. b Q: Result of the last comparison (TRUE if the value has changed). Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 4.1.2.4.2 FB_BA_RFTrig Function block for the detection of a rising or falling edge on a Boolean variable. The use of the separate function blocks R_TRIG and F_TRIG can be avoided with the block. VAR_INPUT b Value : BOOL; b Value: Value to be monitored. VAR_OUTPUT Q : BOOL; Qr : BOOL; Qf : BOOL; Q: TRUE if an edge is detected. Qr: Result of the last comparison (TRUE as soon as the monitored value changes from FALSE to TRUE). Qf: Result of the last comparison (TRUE as soon as the monitored value changes from TRUE to FALSE). Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 TE1000 Version: 1.2.2 39
## Page 40

Programming 4.2 DUTs 4.2.1 Structures 4.2.1.1 ST_BA_Seq Link / ST_BA_Seq Link Data Structure of the data and command exchange between the control function block FB_BA_Seq Link [} 20] and the sequence controllers FB_BA_Seq Ctrl [} 16]. This structure has to be created once per sequence control: st Seq Link : ST_BA_Seq Link; Within this structure, a further field structure is declared automatically, through which the sequence link function block and the individual sequence controllers exchange all relevant data. Each sequence controller writes its data into the field element corresponding to its ordinal number (entry at input di My Num at the sequence controller function block). It is always the complete structure with all field elements that is linked to the function blocks. The structures have the following setup: TYPE ST_BA_Seq Link : STRUCT arr Seq Link Data : ARRAY[1..16] OF ST_BA_Seq Link Data; di Cur Ctrl : DINT; b Seq Actv : BOOL; END_STRUCT END_TYPE arr Seq Link Data: Parameters of the individual sequence controllers. See below for a description of the structure ST_BA_Seq Link Data. di Cur Ctrl: from FB_BA_Seq Link: Specification of current sequence controllers. b Seq Actv: The sequence control is enabled and active. TYPE ST_BA_Seq Link Data: STRUCT lr Y : LREAL; lr YMin : LREAL; lr YMax : LREAL; lr W : LREAL; b Actn : BOOL; b Op : BOOL; b Presence : BOOL; b Err Double : BOOL; di Cur Ctrl : DINT; END_STRUCT END_TYPE lr Y: from FB_BA_Seq Ctrl: Transfer of current control value. lr YMin: from FB_BA_Seq Ctrl: Transfer of minimum control value. lr YMax: from FB_BA_Seq Ctrl: Transfer of maximum control value. lr W: from FB_BA_Seq Ctrl: Transfer of current set value. b Actn: from FB_BA_Seq Ctrl: Transfer of inverse direction of action (b Actn = FALSE: heating mode - b Actn = TRUE: cooling mode). b Op: from FB_BA_Seq Ctrl: Sequence controller is enabled, i.e. its input b En is set to TRUE. b Presence: from FB_BA_Seq Ctrl: Checkbit, see below b Err Double: from FB_BA_Seq Ctrl: Error during number verification: Two or more sequence controllers exist with the same ordinal number di My Num. di Cur Ctrl: from FB_BA_Seq Link: Specification of current sequence controllers. 40 Version: 1.2.2 TE1000
## Page 41

Programming Note regarding check bit: Every sequence controller sets the b Presence flag in the structure that is valid for itself. If it is already set, however, then it is mandatory for di My Num to be assigned twice and two sequence controllers access the same structure. After the evaluation, the sequence link function block resets all check bits, so that this test takes place cyclically. This means that an error can automatically be rectified via an online change, and new sequence controllers can be added, if required. Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 4.2.2 Enums 4.2.2.1 E_BA_Terminal_KL Enumerator for selecting the respective Bus Terminal. TYPE E_BA_TERMINAL_KL: ( KL3208_0010 := 0, KL320x_0000 := 1, KL300x := 2, KL301x := 3, KL302x := 4, KL304x := 5, KL305x := 6, KL306x := 7, KL3132_0000 := 8, KL3142_0000 := 9, KL3152_0000 := 10, KL3162_0000 := 11, KL3172_0000 := 12, KL3172_0500 := 13, KL3172_1000 := 14, KL3182_0000 := 15, KL3404 := 16, KL3464 := 17, KL3408 := 18, KL3468 := 19, KL3444 := 20, KL3454 := 21, KL3448 := 22, KL3458 := 23, Undefined := 16#FFFF )DINT; END_TYPE KL3208_0010: Temperature sensors with wire breakage and short-circuit detection. KL320x_0000: Temperature sensors with wire breakage and short-circuit detection. KL300x: -10 V to 10 V. KL301x: 0 m A to 20 m A with wire breakage and short-circuit detection. KL302x: 4 m A to 20 m A with wire breakage and short-circuit detection. KL304x: 0 m A to 20 m A with wire breakage and short-circuit detection. KL305x: 4 m A to 20 m A with wire breakage and short-circuit detection. KL306x: 0 V to 10 V. KL3132_0000: -10 V to +10 V. KL3142_0000: 0 m A to 20 m A with wire breakage and short-circuit detection. KL3152_0000: 4 m A to 20 m A with wire breakage and short-circuit detection. TE1000 Version: 1.2.2 41
## Page 42

Programming KL3162_0000: 0 V to +10 V. KL3172_0000: 0 V to +2 V. KL3172_0500: 0 V to +0.5 V. KL3172_1000: 0 V to +1.0 V. KL3182_0000: -2.0 V to +2.0 V. KL3404: -10 V to +10 V. KL3464: 0 V to +10 V. KL3408: -10 V to +10 V. KL3468: 0 V to +10 V. KL3444: 0 m A to 20 m A with wire breakage and short-circuit detection. KL3454: 4 m A to 20 m A with wire breakage and short-circuit detection. KL3448: 0 m A to 20 m A with wire breakage and short-circuit detection. KL3458: 4 m A to 20 m A with wire breakage and short-circuit detection. Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 4.2.2.2 E_BA_Sensor Enumerator for selecting a sensor type for measuring analog values. TYPE E_BA_SENSOR : ( KL3208_0010_PT1000 := 0, KL3208_0010_NI1000 := 1, KL3208_0010_NI1000_LS := 2, KL3208_0010_NTC1K8 := 3, KL3208_0010_NTC1K8_TK := 4, KL3208_0010_NTC2K2 := 5, KL3208_0010_NTC3K := 6, KL3208_0010_NTC5K := 7, KL3208_0010_NTC10K := 8, KL3208_0010_NTC10KPRE := 9, KL3208_0010_NTC10K_3204 := 10, KL3208_0010_NTC10KTYP2 := 11, KL3208_0010_NTC10KTYP3 := 12, KL3208_0010_NTC10KDALE := 13, KL3208_0010_NTC10K3A221 := 14, KL3208_0010_NTC20K := 15, KL3208_0010_NTC100K := 16, KL3208_0010_Poti_Resolution_01 := 17, KL3208_0010_Poti_Resolution_1_1 := 18, KL320x_0000_PT1000 := 19, KL320x_0000_NI1000 := 20, KL320x_0000_PT100 := 21, KL320x_0000_PT200 := 22, KL320x_0000_PT500 := 23, KL320x_0000_NI100 := 24, KL320x_0000_NI120 := 25, KL320x_0000_Output_10_5000 := 26, KL320x_0000_Output_10_1200 := 27, Undefined := 16#FFFF )DINT; END_TYPE 42 Version: 1.2.2 TE1000
## Page 43

Programming Requirements Development environment Required library Necessary function Twin CAT3.1 4022.16 Tc3_BA_Common from V1.0.4.3 TF8040 | Twin CAT Building Automation from V1.0.5.0 4.3 GVLs 4.3.1 Parameter Global parameters VAR_GLOBAL CONSTANT usi Max Seq Ctrl : USINT := 16; END_VAR usi Max Seq Ctrl: Maximum number of sequence controllers in a sequence. TE1000 Version: 1.2.2 43
## Page 44

Appendix 5 Appendix 5.1 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 44 Version: 1.2.2 TE1000
## Page 46

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
