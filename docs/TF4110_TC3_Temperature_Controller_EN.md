---
title: "TF4110_TC3_Temperature_Controller_EN"
product: "TF4110"
category: "Motion_Control"
tags: ["CONTROLLER", "TEMPERATURE"]
language: "EN"
document_type: "Manual"
version: "2.0.1"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF4110_TC3_Temperature_Controller_EN.pdf"
release_date: "2022-10-21"
---
Manual | EN TF4110 Twin CAT 3 | Temperature Controller 2022-10-21 | Version: 2.0.1
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 Safety instructions............................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Product description.................................................................................................................................. 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation......................................................................................................................................... 9 3.3 Licensing......................................................................................................................................... 12 4 Configuration........................................................................................................................................... 15 4.1 Block Diagram................................................................................................................................. 15 4.2 Generating the Set Value................................................................................................................ 15 4.3 Generating the Control Value.......................................................................................................... 17 4.4 Commisioning the Controller in Stages........................................................................................... 17 5 PLC libraries............................................................................................................................................ 21 5.1 Function Block................................................................................................................................. 21 5.1.1 FB_CTRL_Temp Controller.............................................................................................. 21 5.1.2 Structure definitions......................................................................................................... 23 5.1.3 FB_Temp Controller.......................................................................................................... 30 5.1.4 Structure Definitions......................................................................................................... 32 5.1.5 FB_CTRL_Temp Controller_Dist Comp............................................................................. 39 5.1.6 Structure Definitions (ST_CTRL_Dist Comp Parameter)................................................... 41 5.2 Global Constants............................................................................................................................. 41 5.2.1 Library version.................................................................................................................. 41 6 Sample..................................................................................................................................................... 43 7 Appendix.................................................................................................................................................. 44 7.1 Control Algorithm............................................................................................................................ 44 7.2 Alarm............................................................................................................................................... 45 7.3 Self-tuning....................................................................................................................................... 45 7.4 Disturbance Compensation............................................................................................................. 46 TF4110 Version: 2.0.1 3
## Page 4

Table of contents 4 Version: 2.0.1 TF4110
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilization of this document as well as the communication of its contents to others without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF4110 Version: 2.0.1 5
## Page 6

Foreword 1.2 Safety instructions Safety regulations Please note the following safety instructions and explanations! Product-specific safety instructions can be found on following pages or in the areas mounting, wiring, commissioning etc. Exclusion of liability All the components are supplied in particular hardware and software configurations appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation and drive engineering who are familiar with the applicable national standards. Description of symbols In this documentation the following symbols are used with an accompanying safety instruction or note. The safety instructions must be read carefully and followed without fail! DANGER Serious risk of injury! Failure to follow the safety instructions associated with this symbol directly endangers the life and health of persons. WARNING Risk of injury! Failure to follow the safety instructions associated with this symbol endangers the life and health of per- sons. CAUTION Personal injuries! Failure to follow the safety instructions associated with this symbol can lead to injuries to persons. NOTE Damage to the environment or devices Failure to follow the instructions associated with this symbol can lead to damage to the environment or equipment. Tip or pointer This symbol indicates information that contributes to better understanding. 6 Version: 2.0.1 TF4110
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF4110 Version: 2.0.1 7
## Page 8

Product description 2 Product description The Twin CAT Temperature Controller is a universally applicable PLC function block for monitoring and controlling a wide variety of temperature-dependent processes. The controller can be operated in • automatic mode (closed loop) and • manual mode (open loop). The control value can be accessed in digital or analog form. The digital control value is pulse width modulated (PWM). A two-point or three-point output is also available. The control value is limited to the permitted maximum and minimum values. The setpoint is also limited to permitted minimum and maximum values, and can also be ramped. A bit is available in the interface to the function block that provides easy switching from the setpoint to a standby setpoint. A soft start can be parameterized to support "heater baking". This involves the setpoint (optionally ramped) being initially set to a low value, remaining there for a certain time, then being changed to the true setpoint (again optionally ramped). The actual value can be digitally filtered. The control algorithm is PID-based. An additional pre-controller can be inserted in order to minimize overshoot. The controller has a variety of parameterizable monitoring functions. There is • tolerance band monitoring (two different tolerance bands), • absolute value monitoring, • encoder monitoring (open, backvoltage, reverse) and • heating current monitoring (open, short circuit, leakage current). There is an algorithm for determination of optimal controller parameters that greatly simplifies the process of commissioning the controller. This algorithm evaluates a jump and uses the inflectional tangent method to determine the maximum velocity and delay time of the section. This data allows a controller to be specified according to the rules of Chien, Hrones and Reswick. The parameters for the pre-controller are also determined here. If the controller parameters are already known, then the controller can also be operated using these externally supplied parameters. The controller parameters can be determined separately for the heating and cooling section. A corresponding sequence of the tuning process can be preselected. If no separate parameter set is determined for cooling, it is also possible to use the heating parameter set for the cooling section by means of a freely selectable scaling factor. Commissioning the Controller in Stages [} 17]. Documentation of the function block [} 21] and the required structures. 8 Version: 2.0.1 TF4110
## Page 9

Installation 3 Installation 3.1 System requirements This section describes the minimum requirements needed for engineering and/or runtime systems. Development environment A pure development environment describes a computer on which PLC programs are developed but not executed. The following components must be installed on a development computer: • Twin CAT 3 XAE (Engineering) build 4012 or higher • Twin CAT 3 function TF4110 temperature controller version 3.3.0.0 or higher • Please note: A 7-day trial license can be used (multiple times, if required) for the development environment, see Licensing [} 12]. Runtime environment A runtime environment describes a computer on which PLC programs are executed. The following components must be installed on a runtime computer: • Twin CAT3 XAR build 4012 or higher • Installation of TC1200 PLC and TF4110 temperature controller • Licenses for TC1200 PLC and TF4110 temperature controller Note: A 7-day trial license key can be used for testing purposes, see Licensing [} 12]. Developer environment and runtime on one computer If runtime and development environments are to run on the same computer (e.g. to test a PLC program before it is loaded on the target computer), the following requirements must be met: • Twin CAT3 XAE (engineering installation) build 4012 or higher • Licenses for TC1200 PLC and TF4110 temperature controller • Please note: A 7-day trial license key can be used for testing purposes, see Licensing [} 12]. 3.2 Installation The following section describes how to install the Twin CAT 3 Function for Windows-based operating systems. ü The Twin CAT 3 Function setup file was downloaded from the Beckhoff website. 1. Run the setup file as administrator. To do this, select the command Run as administrator in the context menu of the file. ð The installation dialog opens. TF4110 Version: 2.0.1 9
## Page 10

Installation 2. Accept the end user licensing agreement and click Next. 3. Enter your user data. 10 Version: 2.0.1 TF4110
## Page 11

Installation 4. If you want to install the full version of the Twin CAT 3 Function, select Complete as installation type. If you want to install the Twin CAT 3 Function components separately, select Custom. 5. Select Next, then Install to start the installation. ð A dialog box informs you that the Twin CAT system must be stopped to proceed with the installation. TF4110 Version: 2.0.1 11
## Page 12

Installation 6. Confirm the dialog with Yes. 7. Select Finish to exit the setup. ð The Twin CAT 3 Function has been successfully installed and can be licensed (see Licensing [} 12]). 3.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 12 Version: 2.0.1 TF4110
## Page 13

Installation 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. TF4110 Version: 2.0.1 13
## Page 14

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. 14 Version: 2.0.1 TF4110
## Page 15

Configuration 4 Configuration 4.1 Block Diagram The Twin CAT Temperature Controller consists of a number of function blocks. The following function blocks are involved: • Self-tuning algorithm (FB_Selftuner) • Control algorithm (FB_Control Algorithm) • Setpoint generator (FB_Setpoint Conditioner) • Control value generator (FB_Control Value Conditioner) • Alarming (FB_Alarming) These function blocks in turn call a number of other subsidiary function blocks. 4.2 Generating the Set Value One bit switches between the setpoints. In addition to the actual setpoint, there is also a standby setpoint. The standby setpoint can be used to reduce the temperature during operating pauses to a lower value in order to save power. If necessary the steps in the setpoint can be ramped. The parameter set for the setpoints includes a rate of rise and a rate of fall. The setpoints are restricted to their limits. TF4110 Version: 2.0.1 15
## Page 16

Configuration In order to permit "heater baking", a soft start can be parameterized. In this case, the temperature is first ramped up from ambient to a low setpoint (f WStart Up). This temperature is then maintained for a period of time (t Start Up), and only after that has elapsed does the ramp up to the actual setpoint begin. 16 Version: 2.0.1 TF4110
## Page 17

Configuration 4.3 Generating the Control Value The control value (CV) calculated by the controller is first limited to fall within a valid range. The values of the limits are passed to the controller function block via the control value structure. The control value is made available in three different ways. The control value can be picked up in analog form. However, the more common output is probably the digital output as a pulse width modulated signal. The cycle time required for the pulse width modulation is supplied to the controller in the control value structure. Additionally, a two-point output (for heating or cooling) and a three-point output (for heating and cooling) can be connected. 4.4 Commisioning the Controller in Stages The following steps must be taken: 1. Insert the controller library into the project via the library manager. • Insert the Tc2_Temp Controller in the library manager. 2. Program at least one instance of the controller. • To do this, create an instance of the controller function block FB_Temp Controller. • Also create an instance of the structure ST_Controller Parameter. • Insert library. 3. Create external wiring. TF4110 Version: 2.0.1 17
## Page 18

Configuration Name Description e Ctrl Mode Connection necessary Switches the controller to an operation mode (active, passive, tuning). b Sel Setpoint Connection optional Selects one of two possible setpoints. FALSE selects the normal setpoint, while TRUE selects the standby setpoint. f W1 Connection necessary Setpoint f W2 Connection optional Standby setpoint is usually smaller than f W1. f Sel Setpoint can be used to switch between f W1 and f W2. f X Connection necessary Actual value, expected as LREAL number. The actual value may first have to be converted to LREAL outside the function block. f YManual Connection optional Control value in manual operation b Open Thermocouple Connection optional The thermocouple is open if TRUE. Must be reported by the hardware (e.g. KL3xxx or EL3xxx). b Reverse Thermocouple Connection optional TRUE indicates that the thermocouple has been connected with the wrong polarity. Must be indicated by the hardware. b Back Voltage Connection optional TRUE indicates that the input voltage at the thermocouple is too high. Must be indicated by the hardware. b Leakage Connection optional TRUE indicates that leakage current has been detected at the heating element. Must be indicated by the hardware. b Short Circuit Connection optional TRUE indicates that a short circuit has been detected at the heating element. Must be indicated by the hardware. b Open Circuit Connection optional TRUE indicates that an open circuit has been detected at the heating element. Must be indicated by the hardware. s Controller Parameter Connection necessary General parameters (sampling time etc.) are passed to the function block in this structure. s Para Controller External Connection optional An external controller parameter set is passed to the function block in this structure. 4. Perform the necessary parameterization of the controller via the structure. • The parameters can be specified through initial values, or by assignment. • If the parameters are assigned by initial values, it could look like this, for example: (* parameters *) s Controller Parameter : ST_CTRL_Temp Ctrl Parameter := ( (* base *) t Ctrl Cycle Time := t#1000ms, t Task Cycle Time := t#10ms, f YMin := -100, f YMax := 100, t PWMCycle Time := t#100ms , f YManual := 20, b Filter := FALSE, t Filter := t#100ms, b Deadband := FALSE, f EDeadband := 1.0, (* deadband *) f WMin := 15, f WMax := 60, f WStart Up := 20.0, 18 Version: 2.0.1 TF4110
## Page 19

Configuration t Start Up := t#160s, f WVelo Pos := 0.01, f WVelo Neg := 0.01, b Start Up Ramping := FALSE, f WStart Up Velo Pos := 0.1, f WStart Up Velo Neg := 0.1, i Mode := e CTRL_Control Mode_HEATING, dw Alarm Supp := 16#FF_FF_FF_FF, b Sel Ctrl Parameter Set:= FALSE, (* tuninig *) i Tuning Mode := e CTRL_Tune Mode_heating, f YTune Heating := 100.0, f YTune Cooling := -100.0, f End Tune Percent Heating := 80.0, (* switch to closed loop control when X > 0.8*W *) f End Tune Percent Cooling := -70.0, (* switch to closed loop control when X < 0.2*W *) i Reaction On Failure := e CTRL_Reaction On Failure_Stop Controller, Temp Low := -50.0, Temp Low Low := -100.0, Temp High := 100.0, Temp High High := 155.0, Temp Absolute High := 150.0, Temp Absolute Low := -95.0, b Enable Pre Controller := FALSE, b Enable Zones := FALSE, b Enable CVFilter := FALSE, i Filter Type := e CTRL_Filter Type_AVERAGE, i Controller Type := e CTRL_Controller Type_PID ); Assignment in the code can look like the following in ST: s Controller Parameter.t PWMCycle Time := t#100ms; 5. Set the controller sampling time, the task cycle time and the PWM cycle time. • The controller's sampling time must be adapted to the section. It should be selected to be equal to or less than one tenth of the loop's dominant time constants. • The task cycle time is specified by the PLC task from which the controller function block has been called. This value can be read from the task configuration (PLC Control: Resources Task Configuration). The PWM cycle time is usually equal to the controller cycle time. If the task cycle time is 10ms and the PWM cycle time (=controller sampling time) is chosen to be 100ms, then a total of 10 levels (PWM cycle time / task cycle time) are available. 6. Parameterization of Twin CAT Scope. • To check the results, make a scope recording of the tuning process and the closed-loop control behavior. • To do this, start and parameterize the Twin CAT Scope View. • Record the following channels: setpoint (f W1 or f W2), actual value (f X) and the analog control value (f YAnalog). 7. Switch off alarms during the commissioning phase. • The alarms can be temporarily switched off during the commissioning phase. • Set a corresponding bit mask in the dw Alarm Supp Dword. • If a bit is set in this Dword, the corresponding alarm is disabled. The assignment of the individual alarms is described here [} 32]. Information: After initial commissioning, switch all required alarms back on. 8. Start the controller with tuning. • If the controller parameters are to be determined by tuning, the control mode must be set to e CTRL_MODE_TUNE. TF4110 Version: 2.0.1 19
## Page 20

Configuration • A fixed waiting time of 20s first elapses. During this waiting time the temperature is monitored to ensure that it remains within a +-1°C band. If the temperature goes outside this band, the waiting starts again. The process is then subjected to a step excitation with a control value of f YTune. The process then reacts with the step response. As long as 80% of the setpoint is not reached, the process parameters are determined using the inflectional tangent method. For safety reasons, after 80% of the setpoint has been reached, control is switched over to closed loop control. If the temperature reaches the 80% mark too quickly (with no clear inflection) then the value of f YTune is to be reduced. The parameters determined in this way are used for the PID controller, and are provided in a structure at the output of the controller. Setting the control mode Once the tuning has been completed successfully, the e Ctrl State is set to e C- TRL_STATE_TUNED. The controller enters standby mode. Closed-loop operation with the estimated parameters can only be activated by setting the control mode to e CTRL_MODE_ACTIVE. 9. Linking the internal control parameters with the external connections. The controller parameters determined in the tuning process can be supplied again to the controller as external parameters. This may be necessary if the tuning is only to be carried out once (e.g. only during the initial commissioning). • To do this, trace the structure s Para Controller Internal to the input of the controller s Para Controller External and set the flag b Sel Ctrl Parameter Set to TRUE. 10. Perform fine-tuning manually. The control parameters determined in the tuning process are designed to produce fast settling, with about 10% overshoot. If only very little overshoot is permitted, or even none at all, then the following parameters from the ST_Controller Parameter structure can be used to perform fine tuning. These values are guide values. Behavior f Tune Kp f Tune Tn f Tune Tv f Tune Td Fast settling with 1.2 2.0 0.42 0.25 overshoots of 10%-20% Slower settling with 1.0 2.5 0.42 0.25 low overshoot Almost asymptotic 0.5 3.0 1.0 0.25 settling with extremely small overshoot Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller 20 Version: 2.0.1 TF4110
## Page 21

PLC libraries 5 PLC libraries 5.1 Function Block 5.1.1 FB_CTRL_Temp Controller The temperature controller function block FB_CTRL_Temp Controller has various inputs and outputs, which are described below. All the controller's parameters are passed to it via structures. Interface VAR_INPUT VAR_INPUT e Ctrl Mode : E_CTRL_MODE; b Sel Setpoint : BOOL; f W1 : LREAL; f W2 : LREAL; f X : LREAL; f YManual : LREAL; b Open Thermocouple : BOOL; (* thermocouple *) b Reverse Thermocouple : BOOL; b Back Voltage : BOOL; b Leakage : BOOL; (* heating system *) b Short Circuit : BOOL; b Open Circuit : BOOL; s Para Controller External : ST_CTRL_Para Controller END_VAR TF4110 Version: 2.0.1 21
## Page 22

PLC libraries Name Unit Value range Description e Control Mode 1 E_CTRL_MODE Mode switching b Sel Setpoint 1 [TRUE,FALSE] Selects one of two possible setpoints. FALSE selects the normal setpoint, while TRUE selects the standby setpoint. f W1 °C LREAL Setpoint f W2 °C LREAL Standby setpoint is usually smaller than f W1. f Sel Setpoint can be used to switch between f W1 and f W2. f X °C LREAL Actual value f YManual -100% - LREAL Control value in manual operation +100% b Open Thermoc 1 [TRUE,FALSE] The thermocouple is open if TRUE. Must be indicated by ouple the hardware. b Reverse Therm 1 [TRUE,FALSE] TRUE indicates that the thermocouple has been ocouple connected with the wrong polarity. Must be indicated by the hardware. b Back Voltage 1 [TRUE,FALSE] TRUE indicates that the input voltage at the thermocouple is too high. Must be indicated by the hardware. b Leakage 1 [TRUE,FALSE] TRUE indicates that leakage current has been detected at the heating element. Must be indicated by the hardware. b Short Circuit 1 [TRUE,FALSE] TRUE indicates that a short circuit has been detected at the heating element. Must be indicated by the hardware. b Open Circuit 1 [TRUE,FALSE] TRUE indicates that an open circuit has been detected at the heating element. Must be indicated by the hardware. s Controller Para none Structure General parameters (sampling time etc.) are passed to meter the function block in this structure. s Para Controller none Structure An external controller parameter set is passed to the External function block in this structure. VAR_OUTPUT VAR_OUTPUT f YAnalog : LREAL; b YPWMPos : BOOL; b YPWMNeg : BOOL; b YDig Pos : BOOL; b YDig Neg : BOOL; dw Alarm : DWORD; f Max Over Shoot : LREAL; t Start Up Time : TIME; e Ctrl State : E_CTRL_STATE := e CTRL_STATE_IDLE; s Para Controller Internal : ST_CTRL_Para Controller; b Error : BOOL; e Error Id : E_CTRL_Error Codes; END_VAR 22 Version: 2.0.1 TF4110
## Page 23

PLC libraries Name Unit Value range Description f YAnalog none LREAL Analog control value b YPWMPos none [TRUE,FALSE] Boolean output, pulse width modulated. Positive/heating mode b YPWMNeg none [TRUE,FALSE] Boolean output, pulse width modulated. Negative/cooling mode b YDig Pos none [TRUE,FALSE] Boolean output of a three-step controller (TRUE control value 100%, FALSE control value off) b YDig Neg none [TRUE,FALSE] Boolean output of a three-step controller (TRUE control value -100%, FALSE control value off) dw Alarm none DWORD Alarm messages (see ENUM ...) f Max Over Shoot °C LREAL Max. overshoot in °C above/below setpoint. t Start Up Time TIME - Startup time until the setpoint is reached for the first time e Ctrl State none E_CTRL_STATE current controller status (see ENUM ...) s Para Controller I none Structure In this structure the internal controller parameter set nternal (determined by the tuning) is made available. b Error none [TRUE,FALSE] If an error is present, then b Error is TRUE. i Error Id none INT If b Error is TRUE, then i Error Id provides an error code (see ENUM ...) VAR_IN_OUT VAR_IN_OUT s Controller Parameter : ST_CTRL_Temp Ctrl Parameter; (* controller parameter set *) END_VAR Name Type Description s Controller ST_CTRL_Temp Ctrl Parameter structure of the function block parameter Parameter Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller 5.1.2 Structure definitions ST_Controller Parameter TYPE ST_CTRL_Temp Ctrl Parameter: STRUCT (* general parameters *) i Mode : E_CTRL_Control Mode; i Reaction On Failure : E_CTRL_Reaction On Failure; b Sel Ctrl Parameter Set : BOOL; dw Alarm Supp : DWORD; t Ctrl Cycle Time : TIME; t Task Cycle Time : TIME; (* tuning parameteer *) i Tuning Mode : E_CTRL_Tune Mode; t Tune Stabilisation : TIME := T#20S; f End Tune Percent Heating : LREAL := 80.0; f YTune Heating : LREAL; f YStable Heating : LREAL; f End Tune Percent Cooling : LREAL := 20.0; f YTune Cooling : LREAL; f YStable Cooling : LREAL; f Scaling Factor : LREAL := 1.0; (* setpoint parameters *) f WMin : LREAL; TF4110 Version: 2.0.1 23
## Page 24

PLC libraries f WMax : LREAL; (* start up *) b Enable Soft Start : BOOL; b Enable Ramping : BOOL; f WStart Up : LREAL; t Start Up : TIME; b Start Up Ramping : BOOL; f WStart Up Velo Pos : LREAL; f WStart Up Velo Neg : LREAL; f WVelo Pos : LREAL; f WVelo Neg : LREAL; (* actual value parameters *) b Filter : BOOL; t Filter : TIME; (* deadband parameters *) b Deadband : BOOL; f EDeadband : LREAL; (* control value parameters *) f YMin : LREAL; f YMax : LREAL; f YManual : LREAL; f YOn Failure : LREAL; t PWMCycle Time : TIME; t PWMMin Off Time : TIME; t PWMMin On Time : TIME; t PWMWaiting Time : TIME; f YThreshold Off : LREAL; f YThreshold On : LREAL; n Cycles For Switch Over : INT := 100; (* controller settings *) b Enable Pre Controller : BOOL; b Enable Zones : BOOL; b Enable CVFilter : BOOL; i Filter Type : E_CTRL_Filter Type; i Controller Type : E_CTRL_Controller Type; (* min max temperatures *) Temp Low : LREAL; Temp Low Low : LREAL; Temp High : LREAL; Temp High High : LREAL; Temp Absolute High : LREAL; Temp Absolute Low : LREAL; (* internal tuning parameters *) f Tune Kp : LREAL := 1.2; f Tune Tn : LREAL := 2.0; f Tune Tv : LREAL := 0.42; f Tune Td : LREAL := 0.25; END_STRUCT END_TYPE 24 Version: 2.0.1 TF4110
## Page 25

PLC libraries Name Unit Value range Description General parameters i Mode none INT Controller operation mode (1 = heating, 2 = cooling, 3 = heating & cooling) (see below) i Reaction On Fail none INT Parameterizable reaction to errors (see below) ure b Sel Ctrl Paramet none BOOL TRUE = external parameter set, FALSE = internal er Set parameter set (determined by tuning) dw Alarm Supp none DWORD Masks out the alarms (see below) t Ctrl Cycle Time s TIME Controller's sampling time. In the course of the sampling time the controller re-calculates the control value. t Task Cycle Time s TIME Task cycle time. The FB is called with this time interval. Tuning parameters i Tuning Mode K E_CTRL_Tune Mod Determination of the tuning sequence (see below.) e t Tune s TIME Waiting time until the section is stable for tuning. stabilization f End Tune Perce % LREAL Percentage value of setpoint, from which the system nt Heating switches to Closed Loop Control. f YTune Cooling K LREAL Step change in control value during tuning. f YStable Cooling K LREAL Control value when switching to tuning during cooling. f Scaling Factor none LREAL Scaling factor for parameter switching if no tuning is performed for cooling. Setpoint parameters f WMin K LREAL Minimum setpoint f WMax K LREAL Maximum setpoint b Enable Soft Star none BOOL FALSE = no soft start, TRUE = soft start t b Enable Rampin none BOOL FALSE = no ramping, TRUE = ramping g f WStart Up K LREAL Setpoint at start-up t Start Up s TIME Time with the f WStart Up setpoint b Start Up Rampin none [TRUE,FALSE] Switches on ramping during the start-up phase. g f WStart Up Velo P K/s LREAL Rate of rise (of ramp) during the start-up phase os f WStart Up Velo N K/s LREAL Rate of fall (of ramp) during the start-up phase eg f WVelo Pos K/s LREAL Rate of rise (of ramp) f WVelo Neg K/s LREAL Rate of fall (of ramp). Actual value parameters t Filter s TIME Time constant of the actual value filter (first order P-T1 filter) b Filter none [TRUE,FALSE] The actual value filter is actuated if TRUE. Deadband parameters b Deadband none [TRUE,FALSE] TRUE = deadband on, FALSE = deadband off f EDeadband K LREAL Deadband in degrees Control value parameters TF4110 Version: 2.0.1 25
## Page 26

PLC libraries Name Unit Value range Description f YMin none LREAL Minimum value of the control value f YMax none LREAL Maximum value of the control value f YManual none LREAL Control value in manual operation f YOn Failure none LREAL Control value in case of error (parameterizable) t PWMCycle Tim s TIME Cycle time of the PWM signal e t PWMMin Off Tim s TIME PWM: minimum switch-off time e t PWMMin On Tim s TIME PWM: minimum switch-on time e t PWMWaiting Ti s TIME PWM: Waiting time when switching from heating to me cooling f YThreshold Off % LREAL 3-point: Switch-off threshold f YThreshold On % LREAL 3-point: Switch-on threshold n Cycles For Swit none INT Number of cycles for transition from one parameter set to ch Over another Controller parameters b Enable Pre Cont none [TRUE,FALSE] Switches pre-controller on. roller b Enable Zones none [TRUE,FALSE] Switches open loop characteristic on until close to setpoint. b Enable CVFilter none [TRUE,FALSE] Switches on control value filter following the main controller. i Filter Type none ENUM Selection of a filter type for the control value filter following the main controller (see below). i Controller Type none ENUM Selection of a control algorithm (see below). Alarming parameters Temp Low K LREAL Relative lower temperature limit in the first band Temp Low Low K LREAL Relative lower temperature limit in the second band Temp High K LREAL Relative upper temperature limit in the first band Temp High High K LREAL Relative upper temperature limit in the second band Temp Absolute Hi K LREAL Absolute upper temperature limit gh Temp Absolute L K LREAL Absolute lower temperature limit ow Expert parameters f Tune Kp none LREAL Fine Tuning parameters for the PID controller (only for advanced users) f Tune Tn none LREAL Fine Tuning parameters for the PID controller (only for advanced users) f Tune Tv none LREAL Fine Tuning parameters for the PID controller (only for advanced users) f Tune Td none LREAL Fine Tuning parameters for the PID controller (only for advanced users) ST_CTRL_Para Controller TYPE ST_CTRL_Para Controller : STRUCT (* Controller parameter set - heating *) Kp Heat : FLOAT; Tn Heat : TIME; 26 Version: 2.0.1 TF4110
## Page 27

PLC libraries Tv Heat : TIME; Td Heat : TIME; (* Controller parameter set - cooling *) Kp Cool : FLOAT; Tn Cool : TIME; Tv Cool : TIME; Td Cool : TIME; END_STRUCT END_TYPE Name Unit Value range Description Kp Heat none LREAL Gain factor for the main controller Tn Heat s TIME Integral action time for main controller (I component) Tv Heat s TIME Derivative action time for main controller (D component) Td Heat s TIME Damping time for the main controller Kp Cool none LREAL Gain factor for the main controller Tn Cool s TIME Integral action time for main controller (I component) Tv Cool s TIME Derivative action time for main controller (D component) Td Cool s TIME Damping time for the main controller ENUM: E_CTRL_ERRORCODES See documentation of the Twin CAT controller toolbox. ENUM: E_CTRL_Reaction On Failure Name Description e CTRL_Reaction On Failure_No Failure No error e CTRL_Reaction On Failure_Stop Controller If there is an error (an alarm) the controller will stop. e CTRL_Reaction On Failure_Set Man Mode If there is an error (an alarm) the controller will switch to manual operation. e CTRL_Reaction On Failure_Set YMax If there is an error (an alarm) set the control value to its maximum. e CTRL_Reaction On Failure_Set YMin If there is an error (an alarm) set the control value to its minimum. e CTRL_Reaction On Failure_Set YMean If error (alarm), set control value to average value (in preparation). ENUM: E_CTRL_Controller State Internal Name Description E_CTRL_Controller State Internal Heating internal E_CTRL_Controller State Internal Cooling internal ENUM: E_CTRL_Control Mode Name Description e CTRL_Control Mode_HEATING Heating only e CTRL_Control Mode_COOLING Cooling only e CTRL_Control Mode_HEATING_COOLING Heating and cooling ENUM: E_CTRL_STATE See documentation of the Twin CAT controller toolbox. TF4110 Version: 2.0.1 27
## Page 28

PLC libraries ENUM: E_CTRL_STATE_TUNIG Name Description e CTRL_STATE_TUNING_INIT Tuning: Initialization e CTRL_STATE_TUNING_IDLE Tuning: Waiting for stable input signal (control variable) e CTRL_STATE_TUNING_PULSE Tuning: Excitation through short pulse (in preparation) e CTRL_STATE_TUNING_STEP Tuning: Excitation through step change (inflectional tangent method) e CTRL_STATE_TUNING_READY Tuning: Determining the parameters, finalization e CTRL_STATE_TUNING_ERROR Tuning: Error during tuning ENUM: E_CTRL_Tune Mode Name Description e CTRL_Tune Mode_HEATING Tuning: heating only e CTRL_Tune Mode_COOLING Tuning: cooling only e CTRL_Tune Mode_HEATING_COOLING Tuning: first heating, then cooling e CTRL_Tune Mode_COOLING_HEATING Tuning: first cooling, then heating e CTRL_Tune Mode_OSCILLATION Tuning: on-the-fly parameter estimation through vibration excitation (in preparation) ENUM: E_CTRL_Filter Type Name Description e CTRL_Filter Type_FIRSTORDER First order filter e CTRL_Filter Type_AVERAGE Mean value filter ENUM: E_CTRL_Controller Type Name Description e CTRL_Controller Type_PID Standard PID control algorithm e CTRL_Controller Type_PI Standard PI control algorithm e CTRL_Controller Type_PID_Pre Standard PID control algorithm with pre-controller (in preparation) e CTRL_Controller Type_PIDD2 Serial PID control algorithm (in preparation) 28 Version: 2.0.1 TF4110
## Page 29

PLC libraries Bit-masks for alarms Name Mask Description n Alarm Open 2#0000_0000_0000_0000_0000_0000_0000_0001 Hardware: open Thermocouple temperature sensor n Alarm Reverse 2#0000_0000_0000_0000_0000_0000_0000_0010 Hardware: reverse Thermocouple connected temperature sensor n Alarm Back Voltage 2#0000_0000_0000_0000_0000_0000_0000_0100 Hardware: excessive voltage at temperature sensor n Alarm Leakage 2#0000_0000_0000_0000_0000_0000_0000_1000 Hardware: leakage Current current measured n Alarm Short Circuit 2#0000_0000_0000_0000_0000_0000_0001_0000 Hardware: Short circuit n Alarm Open Circuit 2#0000_0000_0000_0000_0000_0000_0010_0000 Hardware: no current n Alarm Limit Low 2#0000_0000_0000_0000_0000_0001_0000_0000 Software: fallen below first lower relative temperature n Alarm Limit Low Low 2#0000_0000_0000_0000_0000_0010_0000_0000 Software: fallen below second lower relative temperature n Alarm Limit High 2#0000_0000_0000_0000_0000_0100_0000_0000 Software: first upper relative temperature exceeded n Alarm Limit High High 2#0000_0000_0000_0000_0000_1000_0000_0000 Software: second upper relative temperature exceeded n Alarm Absolute High 2#0000_0000_0000_0000_0001_0000_0000_0000 Software: upper absolute temperature exceeded n Alarm Absolute Low 2#0000_0000_0000_0000_0010_0000_0000_0000 Software: fallen below lower absolute temperature Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller TF4110 Version: 2.0.1 29
## Page 30

PLC libraries 5.1.3 FB_Temp Controller The temperature controller function block FB_Temp Controller has a variety of inputs and outputs that are described below. All the controller's parameters are passed to it via structures. The definition of the structures and enums can be found here [} 32]. NOTE This version of the function block is obsolete. You should no longer use this function block. Interface VAR_INPUT VAR_INPUT b On : BOOL; b Init : BOOL; b Tune : BOOL; b Manual : BOOL; b Sel Setpoint : BOOL; b Sel Ctrl Parameter Se : BOOL; b Enable Soft Start : BOOL; b Enable Ramping : BOOL; f W1 : LREAL; f W2 : LREAL; f X : LREAL; b Open Thermocouple : BOOL; b Reverse Thermocouple : BOOL; b Back Voltage : BOOL; b Leakage : BOOL; b Short Circuit : BOOL; b Open Circuit : BOOL; s Para Controller External : ST_Para Controller; s Log Data : ST_Log Data := (b Log := FALSE, str Log File Name :='', str Log String := '' ); END_VAR 30 Version: 2.0.1 TF4110
## Page 31

PLC libraries Name Unit Value range Description b On 1 [TRUE,FALSE] TRUE switches the controller on. b Init 1 [TRUE,FALSE] Initialization flag, which must be active (TRUE) for precisely the first cycle in which the controller is called. b Tune 1 [TRUE,FALSE] A rising edge switches the self-tuning on. If it is switched to FALSE during the self-tuning process then the self- tuning is aborted and the controller continues operation using the old parameters (if they are still present). b Manual 1 [TRUE,FALSE] TRUE switches manual operation on. If the signal goes FALSE again, the controller returns to automatic mode. b Sel Setpoint 1 [TRUE,FALSE] Selects one of two possible setpoints. FALSE selects the normal setpoint, while TRUE selects the standby setpoint. b Sel Ctrl Paramet 1 [TRUE,FALSE] Selects one of two parameter sets. FALSE causes the er Set internal (determined) parameter set to be used, while TRUE switches to one provided externally. b Enable Soft Star 1 [TRUE,FALSE] The soft start-up process is used if TRUE. t b Enable Rampin 1 [TRUE,FALSE] TRUE causes each setpoint step-change to be converted g to a ramp. f W1 °C LREAL Setpoint f W2 °C LREAL Standby setpoint, generally smaller than f W1. f Sel Setpoint can be used to switch between f W1 and f W2. f X °C LREAL Actual value - this value must be converted to LREAL. b Open Thermoc 1 [TRUE,FALSE] The thermocouple is open if TRUE. Must be indicated by ouple the hardware (e.g. KLxxxx). b Reverse Therm 1 [TRUE,FALSE] TRUE indicates that the thermocouple has been ocouple connected with the wrong polarity. Must be indicated by the hardware. b Back Voltage 1 [TRUE,FALSE] TRUE indicates that the input voltage at the thermocouple is too high. Must be indicated by the hardware. b Leakage 1 [TRUE,FALSE] TRUE indicates that leakage current has been detected at the heating element. Must be indicated by the hardware. b Short Circuit 1 [TRUE,FALSE] TRUE indicates that a short circuit has been detected at the heating element. Must be indicated by the hardware. b Open Circuit 1 [TRUE,FALSE] TRUE indicates that an open circuit has been detected at the heating element. Must be indicated by the hardware. s Controller Para none Structure General parameters (sampling time etc.) are passed to meter the function block in this structure. s Para Controller none Structure An external controller parameter set is passed to the External function block in this structure. s Log Data none Structure This structure passes parameters for logging to the function block (filenames etc.). VAR_OUTPUT VAR_OUTPUT f YAnalog : LREAL; b YPWM : BOOL; b YDig : BOOL; b YDig Pos : BOOL; b YDig Neg : BOOL; dw Alarm : DWORD; i State : States := TC_STATE_IDLE; s Para Controller Internal : ST_Para Controller; TF4110 Version: 2.0.1 31
## Page 32

PLC libraries b Error : BOOL; i Error Id : Error Codes; END_VAR Name Unit Value range Description f YAnalog none LREAL Analog control value b YPWM none [TRUE,FALSE] Boolean output, pulse width modulated b YDig none [TRUE,FALSE] Boolean output of an on-off controller (TRUE control value 100%, FALSE control value off) b YDig Pos none [TRUE,FALSE] Boolean output of a three-step controller (TRUE control value 100%, FALSE control value off) b YDig Neg none [TRUE,FALSE] Boolean output of a three-step controller (TRUE control value -100%, FALSE control value off) dw Alarm none DWORD Alarm messages (see ENUM ...) i State none INT Current controller status (see ENUM ...) s Para Controller I none Structure In this structure the internal controller parameter set nternal (determined by the tuning) is made available. b Error none [TRUE,FALSE] If an error is present, then b Error is TRUE. i Error Id none INT If b Error is TRUE, then i Error Id provides an error code (see ENUM ...). VAR_IN_OUT VAR_IN_OUT s Controller Parameter : ST_Controller Parameter; END_VAR Name Type Description s Controller ST_Controller Parameter Parameter structure of the function block parameter Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller 5.1.4 Structure Definitions NOTE This version of the function block is obsolete. You should no longer use this function block. TYPE ST_Para Control Value : STRUCT (* general parameters *) i Mode : E_Control Mode; i Reaction On Failure : E_Reaction On Failure; f YTune : LREAL; f YStable : LREAL; dw Alarm Supp : DWORD; t Ctrl Cycle Time : TIME; t Task Cycle Time : TIME; (* setpoint parameters *) f WMin : LREAL; f WMax : LREAL; (* start up *) f WStart Up : LREAL; t Start Up : TIME; b Start Up Ramping : BOOL; f WStart Up Velo Pos : LREAL; 32 Version: 2.0.1 TF4110
## Page 33

PLC libraries f WStart Up Velo Neg : LREAL; f WVelo Pos : LREAL; f WVelo Neg : LREAL; (* actual value parameters *) b Filter : BOOL; t Filter : TIME; (* control value parameters *) f YMin : LREAL; f YMax : LREAL; f YManual : LREAL; f YOn Failure : LREAL; t PWMCycle Time : TIME; (* controller settings *) b Enable Pre Controller : BOOL; b Enable Zones : BOOL; b Enable CVFilter : BOOL; i Filter Type : E_Filter Type; i Controller Type : E_Controller Type; (* min max temperatures *) Temp Low : LREAL; Temp Low Low : LREAL; Temp High : LREAL; Temp High High : LREAL; Temp Absolute High : LREAL; Temp Absolute Low : LREAL; (* internal tuning parameters *) f Tune Kp : LREAL := 1.2; f Tune Tn : LREAL := 2.0; f Tune Tv : LREAL := 0.42; f Tune Td : LREAL := 0.25; END_STRUCT END_TYPE TF4110 Version: 2.0.1 33
## Page 34

PLC libraries ST_Controller Parameter 34 Version: 2.0.1 TF4110
## Page 35

PLC libraries Name Unit Value range Description i Mode none INT Controller operation mode (1 = heating, 2 = cooling, 3 = heating & cooling) (see below) i Reaction On Fail none INT Parameterizable reaction to errors (see below) ure f YTune none LREAL Control value during the self-tuning (normally 100%) f YStable none LREAL Control value during the settling phase (normally 0%) dw Alarm Supp none DWORD Masks out the alarms (see below) t Ctrl Cycle Time s TIME Controller's sampling time. In the course of the sampling time the controller re-calculates the control value. t Task Cycle Time s TIME Task cycle time. The FB is called with this time interval. f WMin K LREAL Minimum setpoint f WMax K LREAL Maximum setpoint f WVelo Pos K/s LREAL Rate of rise (of ramp) f WVelo Neg K/s LREAL Rate of fall (of ramp). f WStart Up K LREAL Setpoint at start-up t Start Up s TIME Time with the f WStart Up setpoint b Start Up Rampin none [TRUE,FALSE] Switches on ramping during the start-up phase. g f WStart Up Velo P K/s LREAL Rate of rise (of ramp) during the start-up phase os f WStart Up Velo N K/s LREAL Rate of fall (of ramp) during the start-up phase eg f YMin none LREAL Minimum value of the control value f YMax none LREAL Maximum value of the control value f YManual none LREAL Control value in manual operation f YOn Failure none LREAL Control value in case of error (parameterizable) t PWMCycle Tim s TIME Cycle time of the PWM signal e t Filter s TIME Time constant of the actual value filter (first order P-T1 filter) b Filter none [TRUE,FALSE] The actual value filter is actuated if TRUE. b Enable Pre Cont none [TRUE,FALSE] Switches pre-controller on. roller b Enable Zones none [TRUE,FALSE] Switches open loop characteristic on until close to setpoint. b Enable CVFilter none [TRUE,FALSE] Switches on control value filter following the main controller. i Filter Type none ENUM Selection of a filter type for the control value filter following the main controller (see below). i Controller Type none ENUM Selection of a control algorithm (see below). Temp Low K LREAL Relative lower temperature limit in the first band Temp Low Low K LREAL Relative lower temperature limit in the second band Temp High K LREAL Relative upper temperature limit in the first band Temp High High K LREAL Relative upper temperature limit in the second band Temp Absolute Hi K LREAL Absolute upper temperature limit gh Temp Absolute L K LREAL Absolute lower temperature limit ow f Tune Kp none LREAL Fine Tuning parameters for the PID controller (only for advanced users) f Tune Tn none LREAL Fine Tuning parameters for the PID controller (only for advanced users) TF4110 Version: 2.0.1 35
## Page 36

PLC libraries Name Unit Value range Description f Tune Tv none LREAL Fine Tuning parameters for the PID controller (only for advanced users) f Tune Td none LREAL Fine Tuning parameters for the PID controller (only for advanced users) ST_Para Controller TYPE ST_Para Controller : STRUCT (* Main Controller parameter set *) Kp Main : LREAL; Tn Main : LREAL; Tv Main : LREAL; Td Main : LREAL; (* Pre Controller parameter set *) Kp Pre : LREAL; Tv Pre : LREAL; Td Pre : LREAL; END_STRUCT END_TYPE Name Unit Value range Description Kp Main none LREAL Gain factor for the main controller Tn Main s TIME Integral action time for main controller (I component) Tv Main s TIME Derivative action time for main controller (D component) Td Main s TIME Damping time for the main controller Kp Pre none LREAL Amplification factor for the pre-controller Tv Pre s TIME Derivative action time for pre-controller (D component) Td Pre s TIME Damping time for the pre-controller Table 1: ENUM: Error codes Name Description TC_ERR_NOERROR No error TC_ERR_INVALIDPARAM Invalid parameter TC_ERR_NO_INIT Missing function block initialization. TC_ERR_NO_INFLECTION_POINT No inflection was found during self-tuning. No parameters could be determined. TC_ERR_INVALID_PARAM Invalid parameter TC_ERR_INVALID_CYCLETIME Invalid combination of cycle times (sampling times and PWM cycle times) TC_ERR_WRONG_TU A valid value for the Tu parameter could not be found due to faulty or aborted self-tuning. Table 2: ENUM: Reaction On Failure Name Description TC_On Failure No Failure No error TC_On Failure Stop Controller If there is an error (an alarm) the controller will stop. TC_On Failure Set Man Mode If there is an error (an alarm) the controller will switch to manual operation. TC_On Failure Set YMax If there is an error (an alarm) set the control value to its maximum. TC_On Failure Set YMin If there is an error (an alarm) set the control value to its minimum. 36 Version: 2.0.1 TF4110
## Page 37

PLC libraries Table 3: ENUM: ST_Control Mode Name Description CTRLMODE_HEATING Heating only CTRLMODE_COOLING Cooling only CTRLMODE_HEATING_COOLING Heating and cooling Table 4: ENUM: states Name Description TC_STATE_IDLE Controller switched off. TC_STATE_INIT Controller is being initialized. TC_STATE_OFF Controller switched off, was previously switched on. TC_STATE_TUNE Controller in tuning / self adjustment state. TC_STATE_MANUAL_OPERATION Controller in manual operation. TC_STATE_CLOSED_LOOP Controller in automatic operation. TC_STATE_TUNE_IDLE Tuning started but not yet running. Waiting for idle. TC_STATE_TUNE_PULSE Pulse for determination of dead time. TC_STATE_TUNE_STEP Step for determination of dead time and maximum velocity. TC_STATE_TUNE_READY Self-tuning complete. TC_STATE_ERROR Error (logical error) Table 5: ENUM: E_Filter Type Name Description E_Filter Type_FIRSTORDER First order filter E_Filter Type_AVERAGE Mean value filter Table 6: ENUM: E_Controller Type Name Description E_Controller Type_PID Standard PID control algorithm E_Controller Type_PIDD2 Planned serial PID control algorithm TF4110 Version: 2.0.1 37
## Page 38

PLC libraries Bit-masks for alarms Name Mask Description n Alarm Open 2#0000_0000_0000_0000_0000_0000_0000_0001 Hardware: open Thermocouple temperature sensor n Alarm Reverse 2#0000_0000_0000_0000_0000_0000_0000_0010 Hardware: reverse Thermocouple connected temperature sensor n Alarm Back 2#0000_0000_0000_0000_0000_0000_0000_0100 Hardware: excessive Voltage voltage at temperature sensor n Alarm Leakage 2#0000_0000_0000_0000_0000_0000_0000_1000 Hardware: Measured Current leakage current. n Alarm Short Circuit 2#0000_0000_0000_0000_0000_0000_0001_0000 Hardware: Short circuit n Alarm Open Circuit 2#0000_0000_0000_0000_0000_0000_0010_0000 Hardware: no current n Alarm Limit Low 2#0000_0000_0000_0000_0000_0001_0000_0000 Software: fallen below first lower relative temperature. n Alarm Limit Low 2#0000_0000_0000_0000_0000_0010_0000_0000 Software: fallen below Low second lower relative temperature. n Alarm Limit High 2#0000_0000_0000_0000_0000_0100_0000_0000 Software: first upper relative temperature exceeded. n Alarm Limit High 2#0000_0000_0000_0000_0000_1000_0000_0000 Software: second High upper relative temperature exceeded. n Alarm Absolute 2#0000_0000_0000_0000_0001_0000_0000_0000 Software: upper High absolute temperature exceeded. n Alarm Absolute 2#0000_0000_0000_0000_0010_0000_0000_0000 Software: fallen below Low lower absolute temperature. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller 38 Version: 2.0.1 TF4110
## Page 39

PLC libraries 5.1.5 FB_CTRL_Temp Controller_Dist Comp This temperature controller function block adds disturbance compensation to the FB_CTRL_Temp Controller function blocks. The structure is described here. VAR_INPUT VAR_INPUT e Ctrl Mode : E_CTRL_MODE; b Sel Setpoint : BOOL; f W1 : LREAL; f W2 : LREAL; f X : LREAL; f YManual : LREAL; b Open Thermocouple : BOOL; b Reverse Thermocouple : BOOL; b Back Voltage : BOOL; b Leakage : BOOL; b Short Circuit : BOOL; b Open Circuit : BOOL; f D : LREAL; b Compensate Disturbance : BOOL; st Para Controller External : ST_CTRL_Para Controller; END_VAR TF4110 Version: 2.0.1 39
## Page 40

PLC libraries Name Unit Area Description e Control Mode Obsolete E_CTRL_MODE Switches mode. b Sel Setpoint Obsolete [True, False] Selects one of the two possible setpoints; TRUE selects the standby setpoint. f W1 °C LREAL Setpoint f W2 °C LREAL Standby setpoint (normally less than f W1, b Sel Setpoint is used to switch between f W1 and f W2). f X °C LREAL Actual value f YManual % [-100%, +100%] Control value in manual mode b Open Thermocouple Obsolete [True, False] The thermocouple is open when TRUE; must be specified by the hardware. b Reverse Thermocouple Obsolete [True, False] The thermocouple is connected with incorrect polarity if TRUE; must be specified by the hardware. b Back Voltage Obsolete [True, False] The input voltage at the thermocouple is too high if TRUE; must be specified by the hardware b Leakage Obsolete [True, False] Leakage current was detected if TRUE; must be specified by the hardware. b Short Circuit Obsolete [True; False] Short circuit was detected if TRUE; must be specified by the hardware. b Open Circuit Obsolete [True, False] Open circuit was detected if TRUE; must be specified by the hardware. f D Obsolete LREAL Actual value of the measured disturbance variable b Compensate Disturbance Obsolete [True, False] Disturbance compensation is enabled if TRUE. s Para Controller External Obsolete Structure An external controller parameter set was transferred to the controller. VAR_OUTPUT VAR_OUTPUT f YAnalog : LREAL; b YPWMPos : BOOL; b YPWMPos : BOOL; b YPWMNeg : BOOL; b YDig Pos : BOOL; b YDig Neg : BOOL; dw Alarm : DWORD; f Max Over Shoot : LREAL; t Start Up Time : TIME; e Ctrl State : E_CTRL_STATE; s Para Controller Internal : ST_CTRL_Para Controller; 40 Version: 2.0.1 TF4110
## Page 41

PLC libraries b Error : BOOL; e Error Id : E_CTRL_Error Codes; END_VAR VAR_IN_OUT VAR_IN_OUT s Controller Parameter : ST_CTRL_Temp Ctrl Parameter; s Compensator Parameter : ST_CTRL_Dist Comp Parameter; END_VAR Name Type Description s Controller ST_CTRL_Temp Ctrl Parameter structure of the function block parameter Parameter s Compensator P ST_CTRL_Dist Comp Parameter structure of the function block arameter Parameter Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller 5.1.6 Structure Definitions (ST_CTRL_Dist Comp Parameter) ST_CTRL_Dist Comp Parameter TYPE ST_CTRL_Dist Comp Parameters STRUCT f Kd : LREAL := 0; t T1 : TIME := T#0MS; t T2 : TIME := T#0MS; END_STRUCT END_TYPE Name Unit Range Description f Kd NA LREAL Propportional gain of the Lead-Lag compensator t T1 Time TIME First time constant of the Lead-Lag compensator t T2 Time TIME Second time constant of the Lead-Lag compensator 5.2 Global Constants 5.2.1 Library version All libraries have a characteristic version. This version can also be seen in the PLC library repository. A global constant contains information on the library version: Global_Version VAR_GLOBAL CONSTANT st Lib Version_Tc2_Temp Controller : ST_Lib Version; END_VAR The function F_Cmp Lib Version (defined in the library Tc2_System) is offered to compare the existing version with a required version. TF4110 Version: 2.0.1 41
## Page 42

PLC libraries Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller 42 Version: 2.0.1 TF4110
## Page 43

Sample 6 Sample The sample program includes the integration into a MAIN program. The controlled system is simulated by a PT2 element. A recording of the values can be made with the Twin CAT Scope View. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller TF4110 Version: 2.0.1 43
## Page 44

Appendix 7 Appendix 7.1 Control Algorithm The heart of the Twin CAT Temperature Controller is a standard PID controller. This controller kernel also supports anti-reset windup measures to limit the I-component if the control value is subjected to limiting. Since the controller has been designed to minimize disturbances using the adjusting procedure according to Chien, Hrones and Reswick, overshoot is possible when the set point is changed. In order to reduce such overshoot, a pre-controller can be inserted to handle changes in the set point. The pre-controller has a D-T1 characteristic, and reduces ringing in the controller as a whole. Since the D component of the pre-controller has the effect of "roughening" the control value, the use of a pre-controller must be considered very carefully. The pre-controller is switched off when the actual value enters within a certain range of the setpoint and remains there for some length of time. The pre-controller is switched off by ramping it down over a considerable period of time. To minimize oscillation of the control value, it is optionally possible to follow the main controller with a filter. P-T1 and moving average filters are available for this purpose. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller 44 Version: 2.0.1 TF4110
## Page 45

Appendix 7.2 Alarm The following alarm conditions are continuously monitored by the temperature controller: • Absolute temperatures (high and low) • Relative temperatures (in two bands around the setpoint) The following hardware conditions related to the sensor can also be linked to the temperature controller: • Open thermocouple: broken wire to the temperature sensor. • Back voltage: a voltage outside the permitted range is present at the temperature sensor. • Reverse thermocouple: temperature sensor is connected with the wrong polarity. If a current sensor is connected, then the following signals can be linked to the temperature controller: • Short circuit • open circuit • Leakage current Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller 7.3 Self-tuning The self-tuning algorithm is based on the classic inflectional tangents method. This method was first developed by Ziegler and Nichols. It is assumed that a linear P-T1 loop with a dead time is being examined. The maximum rate of change is determined following an experimental step. This is achieved through examining the differences over a number of samples. A tangent is constructed to the point where the rate of change is a maximum, and its intersection with the time axis is found. The delay time, Tu, is the time from the start of the measurement up to the intersection of the inflection tangent and the time axis. Knowing Tu and Vmax, the Chien, Hrones and Reswick formula yields the controller parameters for suppression of TF4110 Version: 2.0.1 45
## Page 46

Appendix disturbances with 20% overshoot. The parameters for the pre-controller can easily be derived from the parameters for the main controller with the aid of heuristic formulas. After completion of the self-tuning these parameters are used in an automatic switch to closed loop operation. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4016 PC or CX Tc2_Temp Controller 7.4 Disturbance Compensation Disturbance compensation A disturbance signal has a considerable influence on the quality of the controller and perhaps on the controlled process. A PID controller can passively counter the effect of an interference signal by increasing the controller output. However, this is an inefficient way of compensating. The function block FB_CTRL_Temp Controller_Dist Comp offers an additional lead/lag compensation to actively compensate an interference signal. It is assumed that the interference signal in question is measured and fed into the function block. The following block diagram explains the structure of the disturbance compensation: The disturbance compensation is a lead/lag compensator. A lead/lag compensator is a versatile component that can be used to set up I, D, PI, PD, and PID compensations provided the gain and time constants are carefully selected. With the help of the compensator, permanent deviations and peaks can be reduced and the dynamic behavior in case of interference can be improved. Here you can find further information about the lead/lag compensator. 46 Version: 2.0.1 TF4110
## Page 48

More Information: www.beckhoff.com/tf4110 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
