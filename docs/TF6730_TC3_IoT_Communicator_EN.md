---
title: "TF6730_TC3_IoT_Communicator_EN"
product: "TF6730"
category: "IoT"
tags: ["COMMUNICATOR", "IoT"]
language: "EN"
document_type: "Manual"
version: "1.11.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6730_TC3_IoT_Communicator_EN.pdf"
release_date: "2025-09-29"
---
Manual | EN TF6730-TF6735 Twin CAT 3 | Io T Communicator (-App) 2025-09-29 | Version: 1.11.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 1.4 Documentation issue status.............................................................................................................. 7 2 Overview.................................................................................................................................................... 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation......................................................................................................................................... 9 3.3 Licensing........................................................................................................................................... 9 4 Technical introduction............................................................................................................................ 12 4.1 MQTT.............................................................................................................................................. 12 4.1.1 Broker............................................................................................................................... 12 4.1.2 Quality of Service............................................................................................................. 12 4.2 Security........................................................................................................................................... 14 4.2.1 Authentication.................................................................................................................. 14 4.2.2 Encryption........................................................................................................................ 14 5 Configuration........................................................................................................................................... 15 5.1 Attributes......................................................................................................................................... 15 5.2 Arrays.............................................................................................................................................. 17 5.3 Widgets........................................................................................................................................... 17 5.3.1 Lighting............................................................................................................................. 17 5.3.2 Blinds............................................................................................................................... 19 5.3.3 Blinds (simplified)............................................................................................................. 21 5.3.4 Socket.............................................................................................................................. 23 5.3.5 Air conditioning system.................................................................................................... 23 5.3.6 Ventilation........................................................................................................................ 26 5.3.7 Timer................................................................................................................................ 28 5.3.8 Generic widget................................................................................................................. 30 5.3.9 RGBW lighting.................................................................................................................. 35 5.3.10 Bar chart........................................................................................................................... 37 5.3.11 Charging station............................................................................................................... 40 5.3.12 Energy monitoring............................................................................................................ 42 5.3.13 4-channel LED................................................................................................................. 44 5.4 Nested structures............................................................................................................................ 47 5.5 Limitation of decimal places............................................................................................................ 47 5.6 Navigation via QR code.................................................................................................................. 47 5.7 On Change mechanisms.................................................................................................................. 49 5.8 Using UTF-8 characters.................................................................................................................. 51 5.9 User authorizations......................................................................................................................... 52 6 PLC API.................................................................................................................................................... 53 6.1 Function blocks............................................................................................................................... 53 6.1.1 FB_Iot Communicator....................................................................................................... 53 TF6730-TF6735 Version: 1.11.0 3
## Page 4

Table of contents 6.1.2 FB_Iot Command.............................................................................................................. 62 6.2 Data types....................................................................................................................................... 63 6.2.1 ST_Iot Communicator Tls.................................................................................................. 63 6.2.2 E_Iot Communicator Datatype........................................................................................... 64 6.2.3 E_Iot Communicator Tls Version........................................................................................ 65 7 App........................................................................................................................................................... 66 7.1 Settings........................................................................................................................................... 66 7.1.1 Connection settings.......................................................................................................... 67 7.1.2 App settings..................................................................................................................... 71 7.1.3 Favorites.......................................................................................................................... 73 7.2 Device overview.............................................................................................................................. 75 7.3 (Push) messages............................................................................................................................ 78 8 Samples................................................................................................................................................... 80 8.1 Application sample.......................................................................................................................... 80 9 Appendix.................................................................................................................................................. 83 9.1 List of available icons...................................................................................................................... 83 9.2 List of available colors..................................................................................................................... 84 9.3 Support and Service........................................................................................................................ 85 4 Version: 1.11.0 TF6730-TF6735
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF6730-TF6735 Version: 1.11.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.11.0 TF6730-TF6735
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. 1.4 Documentation issue status Version Change 1.11.x New: Send Custom Device Icon [} 61] (Push) messages [} 78] 1.10.x New: 4-channel LED [} 44] Favorites [} 73] 1.9.x New: Permitted Users [} 15] Energy monitoring [} 42] Using UTF-8 characters [} 51] User authorizations [} 52] 1.8.x New: RGBW lighting [} 35] Bar chart [} 37] On Change mechanisms [} 49] Arrays [} 17] Send Data_On Change [} 60] Send Data As String_On Change [} 60] TF6730-TF6735 Version: 1.11.0 7
## Page 8

Overview 2 Overview The function blocks of the Tc3_Io TCommunicator PLC library can be used to realize data exchange between the local Twin CAT PLC and a mobile end device (smart device) via an MQTT message broker. Symbols can be sent and received. Messages can be stored on the broker and read or deleted via the smart device. To this end, the Twin CAT Io T Communicator app must be installed and running on the mobile end device. The Twin CAT Io T Communicator app can be downloaded free of charge from the Apple® App Store or Google™ Play Store. Google™ Play and the Google™ Play logo are trademarks of Google Inc. 8 Version: 1.11.0 TF6730-TF6735
## Page 9

Installation 3 Installation 3.1 System requirements Technical Data Description Operating system Windows 10, Windows CE 7 Target platform PC architecture (x86, x64 and Arm®) Minimum Twin CAT version Twin CAT 3.1 build 4022.0 or higher Required Twin CAT setup level Twin CAT 3 XAE, XAR Required Twin CAT license TF6730 TC3 Io T Communicator Twin CAT library to be integrated TC3_Iot Communicator 3.2 Installation Twin CAT 3.1 Build 4022 and 4024 All the required components are supplied directly with the Twin CAT Setup. • Twin CAT XAE Setup: Contains the MQTT driver and the PLC library (Tc3_Iot Communicator). • Twin CAT XAR Setup: Contains only the MQTT driver. Twin CAT 3.1 Build 4026 The MQTT driver is already included in the Twin CAT Standard Workload. The PLC library Tc3_Iot Communicator can be installed via the package Twin CAT. XAE. PLC. Lib. Tc3_Iot Communicator. If you are using Twin CAT 3.1 Build 4026 (and higher) on the Microsoft Windows operating system, you can install this function via the Twin CAT Package Manager, see Installation documentation. Normally you install the function via the corresponding workload; however, you can also install the packages contained in the workload individually. This documentation briefly describes the installation process via the workload. Command line program Tc Pkg You can use the Tc Pkg Command Line Interface (CLI) to display the available workloads on the system: tcpkg list -t workload You can use the following command to install the Workload of the TF6730 Io T Communicator function. tcpkg install TF6730. Iot Communicator. XAE Twin CAT Package Manager UI You can use the User Interface (UI) to display all available workloads and install them if required. To do this, follow the corresponding instructions in the interface. 3.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". TF6730-TF6735 Version: 1.11.0 9
## Page 10

Installation Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 10 Version: 1.11.0 TF6730-TF6735
## Page 11

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. TF6730-TF6735 Version: 1.11.0 11
## Page 12

Technical introduction 4 Technical introduction 4.1 MQTT 4.1.1 Broker An MQTT broker is required to exchange or synchronize process data and messages with a smart device. The MQTT broker must be accessible via the IP address or host name from the Twin CAT PLC and the mobile device. Twin CAT and smartphone do not have to be connected directly. MQTT is a publisher/subscriber-based communication protocol, which enables message-based transfer between applications. The message broker is a central component of this transfer type, which distributes messages between the individual applications or the sender and receiver of a message. The message broker decouples the sender and receiver, so that it is not necessary for the sender and receiver to know their respective address information. During sending and receiving all communication devices contact the message broker, which handles the distribution of the messages. MQTT broker requirements for TC3 Io T Communicator For optimal use of the Twin CAT Io T Communicator app, the MQTT broker should meet the following requirements: • MQTT protocol version 3.1.1 (see OASIS standard specification) • Clients require access to the topic (see Topic structure) • Retain messages and Quality of Service 0 & 1 (see Quality of Service [} 12]) 4.1.2 Quality of Service Quality of Service (Qo S) is an arrangement between the sender and receiver of a message with regard to guaranteeing of the message transfer. MQTT features three different levels: • 0 – not more than once • 1 – at least once • 2 – exactly once Both types of communication (publish/subscribe) with the message broker must be taken into account and considered separately. The Qo S level that a client uses for publishing a message is set by the respective client. When the broker forwards the message to client that has subscribed to the topic, the subscriber uses the Qo S level that was specified when the subscription was established. This means that a Qo S level that may have been specified as 2 by the publisher can be “overwritten” with 0 by the subscriber. Qo S Level 0 At this Qo S level the receiver does not acknowledge receipt. The message is not sent a second time. 12 Version: 1.11.0 TF6730-TF6735
## Page 13

Technical introduction Qo S Level 1 At this Qo S level the system guarantees that the message arrives at the receiver at least once, although the message may arrive more than once. The sender stores the message internally until it has received an acknowledgment from the receiver in the form of a PUBACK message. If the PUBACK message fails to arrive within a certain time, the message is resent. Qo S Level 2 At this Qo S level the system guarantees that the message arrives at the receiver no more than once. On the MQTT side this is realized through a handshake mechanism. Qo S level 2 is the safest level (from a message transfer perspective), but also the slowest. When a receiver receives a message with Qo S level 2, it acknowledges the message with a PUBREC. The sender of the message remembers it internally until it has received a PUBCOMP. This additional handshake (compared with Qo S 1) is important for avoiding duplicate transfer of the message. Once the sender of the message receives a PUBREC, it can discard the initial publish information, since it knows that the message was received once by the receiver. In other words, it remembers the PUBREC internally and sends a PUBREL. Once the receiver has received a PUBREL, it can discard the previously remembered states and respond with a PUBCOMP, and vice versa. Whenever a package is lost, the respective communication device is responsible for resending the last message after a certain time. TF6730-TF6735 Version: 1.11.0 13
## Page 14

Technical introduction 4.2 Security The MQTT specification offers MQTT clients the option to use user name/password authentication with the message broker. Common cryptography mechanisms such as TLS (Transport Layer Security) can be used to provide additional protection for the data communication between client and message broker. 4.2.1 Authentication The TC3_Io TCommunicator PLC library and the Twin CAT Io T Communicator app can use an authentication mechanism, which is standardized and implemented in the MQTT protocol (see OASIS standard specification). The PLC library and the app use MQTT protocol version 3.1.1. NOTICE Authentication does not guarantee protection against cyber attacks In addition to authentication, TLS encryption should be implemented. Otherwise, the user name and password are transmitted in plain text. (See Encryption [} 14]) 4.2.2 Encryption Encryption and authentication via TLS can be accomplished through a certificate authority (CA). The CA provides a signature via the public key for the message broker (the so-called server key) and usually also for all connecting clients. All communication devices can then trust each other, because the issuing certificate authority is trusted. Depending on the message broker, an MQTT client may connect without a dedicated client certificate. In this case the client uses the public key of the issuing certificate authority when it establishes a connection to the broker. 14 Version: 1.11.0 TF6730-TF6735
## Page 15

Configuration 5 Configuration 5.1 Attributes The attributes listed below are the generally applicable attributes. The attributes introduced specifically for the widgets are described at Widgets [} 17]. Display name of the variable (iot. Display Name) Syntax: {attribute 'iot. Display Name' := 'Ceiling Lights'} Defines the name to be displayed in the app for this variable. If this attribute is not specified, the PLC variable name is displayed in the app. Unity of variable (iot. Unit) Syntax: {attribute 'iot. Unit' := '°C'} Defines the unit behind the value of the variable in the app. If this attribute is not specified, the unit behind the value remains empty. Variable cannot be changed (iot. Readonly) Syntax: {attribute 'iot. Read Only' := 'TRUE'} Defines whether the variable can be changed from the app. If this attribute is specified with the value TRUE, the variable can no longer be changed, and a padlock symbol appears next to the variable name. If this attribute is not specified, the variable can be changed by default. User configuration (Io T. Permitted Users) Syntax: {attribute 'iot. Permitted Users' := 'User1,User2'} By default, every variable (regardless of whether it is a structure or simple data type) can be seen by every user. If this attribute is added, only the specified users can see the variable in their app. Icons general (iot. Icon) Syntax: {attribute 'iot. Icon' := 'Room'} Defines the icon that is displayed on a single variable or on a structure. The Twin CAT cube is displayed by default for structures. The available icons are listed in the List of available icons [} 83]. The Io T. Nested Struct Icon attribute can also be used for structures. Icon of a nested structure (iot. Nested Struct Icon) Syntax: {attribute 'iot. Nested Struct Icon' := 'Room'} Defines the icon for the start page of a nested structure. The Twin CAT cube is displayed by default. The available icons are listed in the List of available icons [} 83]. Minimum and maximum value of the variable (iot. Min Value and iot. Max Value) Syntax: {attribute 'iot. Min Value' := '10'} {attribute 'iot. Max Value' := '30'} Defines a minimum and maximum value for numerical variables. If both attributes ('Min Value' AND 'Max Value') are specified, a progress bar in the app shows the progress of the current value with respect to the minimum and maximum value. TF6730-TF6735 Version: 1.11.0 15
## Page 16

Configuration NOTICE Progress indicator The minimum and maximum value define the range covered by the progress bar in the app. The value can be higher or lower than the values specified in the PLC. When a value goes leaves its prescribed range, it is highlighted in the app with a value in red. In the following screenshot a value has left its defined range. Limitation of the decimal places at a variable (iot. Decimal Precision) Syntax: {attribute 'iot. Decimal Precision' := '3'} Defines a number of decimal places to which a floating-point number is rounded. This setting overwrites any existing app setting for the respective variable. Changing the text color (Io T. Value Text Color and Io T. Value Text Color Dark) Syntax: {attribute 'iot. Value Text Color' := 'Green'} Syntax: {attribute 'iot. Value Text Color Dark' := 'Blue'} Defines a color for the display of a variable value in the app. The function is only supported for simple variable types. Available colors can be found at List of available colors [} 84]. The following table lists the different combinations: Configuration Effect The attribute is not set. The default color is used. Only the Value Text Color attribute is set. The set color is used in Light Mode and Dark Mode. The attributes Value Text Color and The set colors are used in Light Mode and Dark Value Text Color Dark are set. Mode. Only the Value Text Color Dark attribute is set. The set color is only used in Dark Mode; in Light Mode, the default color is used. 16 Version: 1.11.0 TF6730-TF6735
## Page 17

Configuration Example See also: examples > Application sample [} 80] 5.2 Arrays One-dimensional arrays of simple data types are supported. If one of these arrays is too long to be displayed in a field in the Communicator app, the list of array values can be opened in a pop-up window by clicking on the field. Arrays of structures and multi-dimensional arrays of any data type are currently not supported. 5.3 Widgets The widgets add functions to the app for operating a building automation system. The widgets are first available with app version 1.4.0 and Tc3_Iot Communicator library version 1.1.14.0 and will be extended with more widgets in following versions. 5.3.1 Lighting The described widget is suitable for displaying light sources in the app. The various configuration options are described below. In the figure all available features of the widget are active. TF6730-TF6735 Version: 1.11.0 17
## Page 18

Configuration The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'Lighting'} {attribute 'iot. Light Value Visible' := 'true'} {attribute 'iot. Light Slider Visible' := 'true'} {attribute 'iot. Light Mode Visible' := 'true'} {attribute 'iot. Light Mode Changeable' := 'true'} st Lighting Widget Sample : ST_Lighting Widget Sample; Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or also additional write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: Lighting. iot. Light Value Visible BOOL Determines whether the dimming value is displayed (TRUE) or not (FALSE). iot. Light Slider Visible BOOL Determines whether the slider is displayed (TRUE) or not (FALSE). iot. Light Mode Visible BOOL Determines whether the mode is displayed (TRUE) or not (FALSE). iot. Light Mode Changeable BOOL Determines whether the mode is adjustable (TRUE) or not (FALSE). TYPE ST_Lighting Widget Sample : STRUCT s Display Name : STRING := ''; b Light : BOOL := FALSE; {attribute 'iot. Unit' := '%'} {attribute 'iot. Min Value' := '0'} {attribute 'iot. Max Value' := '100'} n Light : INT := 100; s Mode : STRING := 'Automatic'; a Modes : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; END_STRUCT END_TYPE 18 Version: 1.11.0 TF6730-TF6735
## Page 19

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display Display text of the widget. name of the widget and overwrites the PLC attribute 'iot. Display Name'. b Light BOOL Switches the lighting on Toggle switch top right. (TRUE) or off (FALSE). iot. Unit STRING Unit of the dimming value. Unit after the numerical value. iot. Min Value INT Lower limit of the dimming On the left side under the value. slider. iot. Max Value INT Upper limit of the dimming On the right side under the value. slider. n Light INT Dimming value of the Display in the numerical widget. value and additionally display in the filling of the slider. s Mode STRING Mode of lighting. The currently displayed mode. a Modes ARRAY [0..n] OF Array of the different By pressing on the current STRING modes that can be set by mode, the adjustable the user. modes can be displayed. 5.3.2 Blinds The described widget is suitable for displaying blinds in the app. The various configuration options are described below. In the figure all available features of the widget are active. The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'Blinds'} {attribute 'iot. Blinds Position Value Visible' := 'true'} {attribute 'iot. Blinds Position Slider Visible' := 'true'} {attribute 'iot. Blinds Angle Value Visible' := 'true'} {attribute 'iot. Blinds Angle Slider Visible' := 'true'} {attribute 'iot. Blinds Mode Visible' := 'true'} {attribute 'iot. Blinds Mode Changeable' := 'true'} st Blinds Widget Sample : ST_Blinds Widget Sample; TF6730-TF6735 Version: 1.11.0 19
## Page 20

Configuration Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or additionally also write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: Blinds. iot. Blinds Position Value Visible BOOL Determines whether the position value is displayed (TRUE) or not (FALSE). iot. Blinds Position Slider Visible BOOL Determines whether the slider for the position value is displayed (TRUE) or not (FALSE). iot. Blinds Angle Value Visible BOOL Determines whether the angle value is displayed (TRUE) or not (FALSE). iot. Blinds Angle Slider Visible BOOL Determines whether the slider for the angle value is displayed (TRUE) or not (FALSE). iot. Blinds Mode Visible BOOL Determines whether the mode is displayed (TRUE) or not (FALSE). iot. Blinds Mode Changeable BOOL Determines whether the mode is adjustable (TRUE) or not (FALSE). TYPE ST_Blinds Widget Sample : STRUCT s Display Name : STRING := ''; b Active : BOOL; b Position Up : BOOL; b Position Down : BOOL; b Angle Up : BOOL; b Angle Down : BOOL; {attribute 'iot. Unit' := '%'} {attribute 'iot. Min Value' := '0'} {attribute 'iot. Max Value' := '100'} n Position Value : INT; n Position Request : INT; {attribute 'iot. Unit' := '°'} {attribute 'iot. Min Value' := '-90'} {attribute 'iot. Max Value' := '90'} n Angle Value : INT; n Angle Request : INT; s Mode : STRING := 'Automatic'; a Modes : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; END_STRUCT END_TYPE 20 Version: 1.11.0 TF6730-TF6735
## Page 21

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display name Display text of the of the widget and overwrites widget. the PLC attribute 'iot. Display Name'. b Active BOOL Intended to detect activation Click on the area of the of the blinds. widget where there are no other control elements. b Position Up BOOL Intended for raising the Button on the left side of blinds. the top slider. b Position Down BOOL Intended for lowering the Button on the right side blinds. of the top slider. b Angle Up BOOL Intended for setting the angle Button on the left side of value in the direction of the the bottom slider. minimum value. b Angle Down BOOL Intended for setting the angle Button on the right side value in the direction of the of the bottom slider. maximum value. iot. Unit STRING Unit of the position value. Unit after the first numerical value. iot. Min Value INT Lower limit of the position Only shown in the PLC. value. iot. Max Value INT Upper limit of the position Only shown in the PLC. value. n Position Value INT Position value of the blinds. The first of the two numerical values. n Position Request INT Target value of the position of The value sent to the the blinds. app at the moment of releasing the top slider. iot. Unit STRING Unit of the angle value. Unit after the second numerical value. iot. Min Value INT Lower limit of the angle value. Only shown in the PLC. iot. Max Value INT Upper limit of the angle value. Only shown in the PLC. n Angle Value INT Angle value of the blinds. The second of the two numerical values. n Angle Request INT Target value of the position of The value sent to the the blinds. app at the moment of releasing the bottom slider. s Mode STRING Mode of the blinds. The currently displayed mode. a Modes ARRAY [0..n] OF Array of the different modes By pressing on the STRING that can be set by the user. current mode, the adjustable modes can be displayed. 5.3.3 Blinds (simplified) The described widget is suitable for displaying blinds in the app. The various configuration options are described below. In the figure all available features of the widget are active. Compared to the other version of the blinds widget, this version is simplified. It offers fewer options, but it has a simpler display. TF6730-TF6735 Version: 1.11.0 21
## Page 22

Configuration The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'Simple Blinds'} {attribute 'iot. Blinds Position Slider Visible' := 'true'} st Simple Blinds Widget Sample : ST_Simple Blinds Widget Sample; Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or additionally also write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: Simple Blinds. iot. Blinds Position Slider Visible BOOL Determines whether the slider for the position value is displayed (TRUE) or not (FALSE). TYPE ST_Simple Blinds Widget Sample : STRUCT s Display Name : STRING := ''; b Position Up : BOOL; b Position Down : BOOL; {attribute 'iot. Min Value' := '0'} {attribute 'iot. Max Value' := '100'} n Position Value : INT; END_STRUCT END_TYPE Attribute Data type Description Display in widget s Display Name STRING Specifies the display name of Display text of the the widget and overwrites the widget. PLC attribute 'iot. Display Name'. b Position Up BOOL Intended for raising the Button labeled "Up". blinds. b Position Down BOOL Intended for lowering the Button labeled "Down". blinds. iot. Min Value INT Lower limit of the position This value is only value. required in the PLC so that the status display can be scaled correctly. iot. Max Value INT Upper limit of the position This value is only value. required in the PLC so that the status display can be scaled correctly. n Position Value INT Position value of the blinds. This value is only available in the PLC and is required to display the status below the buttons. 22 Version: 1.11.0 TF6730-TF6735
## Page 23

Configuration 5.3.4 Socket The described widget is suitable for displaying a socket in the app. The various configuration options are described below. In the figure all available features of the widget are active. The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'Plug'} {attribute 'iot. Plug Mode Visible' := 'true'} {attribute 'iot. Plug Mode Changeable' := 'true'} st Plug Widget Sample : ST_Plug Widget Sample; Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or also additional write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: Plug. iot. Plug Mode Visible BOOL Determines whether the mode is displayed (TRUE) or not (FALSE). iot. Plug Mode Changeable BOOL Determines whether the mode is adjustable (TRUE) or not (FALSE). TYPE ST_Plug Widget Sample : STRUCT s Display Name : STRING := ''; b On : BOOL; s Mode : STRING := 'Automatic'; a Modes : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; END_STRUCT END_TYPE Attribute Data type Description Display in widget s Display Name STRING Determines the display Display text of the widget. name of the widget and overwrites the PLC attribute 'iot. Display Name'. b On BOOL Switches the socket on Toggle switch top right. (TRUE) or off (FALSE). s Mode STRING Mode of the socket. The currently displayed mode. a Modes ARRAY [0..n] OF Array of the different By pressing on the current STRING modes that can be set by mode, the adjustable the user. modes can be displayed. 5.3.5 Air conditioning system The described widget is suitable for displaying air conditioning systems in the app. The various configuration options are described below. In the figure all available features of the widget are active. TF6730-TF6735 Version: 1.11.0 23
## Page 24

Configuration The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'AC'} {attribute 'iot. ACValue Request Visible' := 'true'} {attribute 'iot. ACSlider Visible' := 'true'} {attribute 'iot. ACMode Visible' := 'true'} {attribute 'iot. ACMode Changeable' := 'true'} {attribute 'iot. ACMode Strength Visible' := 'true'} {attribute 'iot. ACMode Strength Changeable' := 'true'} {attribute 'iot. ACMode Lamella Visible' := 'true'} {attribute 'iot. ACMode Lamella Changeable' := 'true'} {attribute 'iot. Decimal Precision' := '2'} st ACWidget Sample : ST_ACWidget Sample; Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or also additional write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: AC. iot. ACValue Request Visible BOOL Determines whether the target value is displayed behind the current temperature value (TRUE) or not (FALSE). iot. ACSlider Visible BOOL Determines whether the slider is displayed (TRUE) or not (FALSE). iot. ACMode Visible BOOL Determines whether the mode is displayed (TRUE) or not (FALSE). iot. ACMode Changeable BOOL Determines whether the mode is adjustable (TRUE) or not (FALSE). iot. ACMode Strength Visible BOOL Determines whether the mode for the strength is displayed (TRUE) or not (FALSE). iot. ACMode Strength Changeable BOOL Determines whether the mode for the strength is adjustable (TRUE) or not (FALSE). iot. ACMode Lamella Visible BOOL Determines whether the mode for the slats is displayed (TRUE) or not (FALSE). iot. ACMode Lamella Changeable BOOL Determines whether the mode for the slats is adjustable (TRUE) or not (FALSE). iot. Decimal Precision INT Sets the number of decimal places. This setting overwrites the setting at the variable n Temperature. 24 Version: 1.11.0 TF6730-TF6735
## Page 25

Configuration TYPE ST_ACWidget Sample : STRUCT s Display Name : STRING := ''; n Ac Mode : INT; // 0: Off, 1: Cooling, 2: Ventilating, 3: Heating, 4: Cooling Off, 5: Ventilating Off, 6: Heating Off {attribute 'iot. Unit' := '°C'} {attribute 'iot. Min Value' := '18'} {attribute 'iot. Max Value' := '23'} {attribute 'iot. Decimal Precision' := '2'} n Temperature : LREAL; n Temperature Request : LREAL; s Mode : STRING := 'Only From PLCMode'; a Modes : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; s Mode_Strength : STRING := 'Level 3'; a Modes_Strength : ARRAY[0..2] OF STRING := ['Level 0', 'Level 1', 'Level 2']; s Mode_Lamella : STRING := 'Quick Swing'; a Modes_Lamella : ARRAY[0..1] OF STRING := ['Static', 'Swing']; END_STRUCT END_TYPE TF6730-TF6735 Version: 1.11.0 25
## Page 26

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display Display text of the widget. name of the widget and overwrites the PLC attribute 'iot. Display Name'. n Ac Mode INT Determines the mode of Icon top right. the AC widget. 0: no icon 1: Cooling (blue) 2: Ventilating (green) 3: Heating (red) 4: Cooling off (gray) 5: Ventilating off (gray) 6: Heating off (gray) iot. Unit STRING Unit of the temperature Unit behind both numerical value. values. iot. Min Value INT Lower limit of the On the left side under the temperature range. slider. iot. Max Value INT Upper limit of the On the right side under the temperature range. slider. iot. Decimal Precision INT Number of decimal places For both temperature for the temperature values. values. Overwritten by the Decimal Precision on the widget and applies to both temperature values. n Temperature LREAL Current temperature The number on the left value. side of the arrow. n Temperature Request LREAL Requested temperature The temperature value, possible via the requested via the slider is slider in steps of 0.1. then displayed on the right side of the arrow. s Mode STRING Mode of the air The currently displayed conditioning system. mode (left). a Modes ARRAY [0..n] OF Array of the different By pressing on the current STRING general modes that can be mode (left), the adjustable set by the user. modes can be displayed. s Mode_Strength STRING Mode of the stage of air The currently displayed conditioning system. mode (centered). a Modes_Strength ARRAY [0..n] OF Array of the different step By pressing on the current STRING modes adjustable by the mode (centered), the user. adjustable modes can be displayed. s Mode_Lamella STRING Mode of the louvers of the The currently displayed air conditioning system. mode (right). a Modes_Lamella ARRAY [0..n] OF Array of the different By pressing on the current STRING louver modes adjustable mode (right), the by the user. adjustable modes can be displayed. 5.3.6 Ventilation The described widget is suitable for displaying a ventilation in the app. The various configuration options are described below. In the figure all available features of the widget are active. 26 Version: 1.11.0 TF6730-TF6735
## Page 27

Configuration The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'Ventilation'} {attribute 'iot. Ventilation Value Request Visible' := 'true'} {attribute 'iot. Ventilation Slider Visible' := 'true'} {attribute 'iot. Ventilation Mode Visible' := 'true'} {attribute 'iot. Ventilation Mode Changeable' := 'true'} st Ventilation Widget Sample : ST_Ventilation Widget Sample; Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or also additional write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: Ventilation. iot. Ventilation Value Request Visible BOOL Determines whether the requested air value (CO2 concentration) is displayed (TRUE) or not (FALSE). iot. Ventilation Slider Visible BOOL Determines whether the slider is displayed (TRUE) or not (FALSE). iot. Ventilation Mode Visible BOOL Determines whether the mode is displayed (TRUE) or not (FALSE). iot. Ventilation Mode Changeable BOOL Determines whether the mode is adjustable (TRUE) or not (FALSE). TYPE ST_Ventilation Widget Sample : STRUCT s Display Name : STRING := ''; b On : BOOL; {attribute 'iot. Unit' := 'ppm'} {attribute 'iot. Min Value' := '400'} {attribute 'iot. Max Value' := '1400'} n Value : INT; n Value Request : INT; s Mode : STRING := 'Automatic'; a Modes : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; END_STRUCT END_TYPE TF6730-TF6735 Version: 1.11.0 27
## Page 28

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display Display text of the widget. name of the widget and overwrites the PLC attribute 'iot. Display Name'. b On BOOL Switches the ventilation on Toggle switch top right. (TRUE) or off (FALSE). iot. Unit STRING Unit of air value (of CO2 Unit behind both numerical concentration). values. iot. Min Value INT Lower limit of the air value On the left side under the (the CO2 concentration). slider. iot. Max Value INT Upper limit of the air value On the right side under the (of the CO2 slider. concentration). n Value INT Current air value (CO2 The number to the left of concentration). the arrow. n Value Request INT Requested air value (CO2 The number requested via concentration) via the the slider is subsequently slider. displayed on the right side of the arrow. s Mode STRING Mode of ventilation. The currently displayed mode. a Modes ARRAY [0..n] OF Array of the different By pressing on the current STRING modes that can be set by mode, the adjustable the user. modes can be displayed. 5.3.7 Timer The described widget is suitable for displaying a timer in the app. The various configuration options are described below. In the figure all available features of the widget are active. The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'Time Switch'} {attribute 'iot. Time Switch Start Time Visible' := 'true'} {attribute 'iot. Time Switch End Time Visible' := 'true'} {attribute 'iot. Time Switch Start Date Visible' := 'true'} {attribute 'iot. Time Switch End Date Visible' := 'true'} {attribute 'iot. Time Switch Days Visible' := 'true'} {attribute 'iot. Time Switch Date Yearly Visible' := 'true'} {attribute 'iot. Time Switch Mode Visible' := 'true'} {attribute 'iot. Time Switch Mode Changeable' := 'true'} st Time Switch Widget Sample : ST_Time Switch Widget Sample; 28 Version: 1.11.0 TF6730-TF6735
## Page 29

Configuration Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or also additional write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: Time Switch. iot. Time Switch Start Time Visible BOOL Determines whether the start time is displayed (TRUE) or not (FALSE). iot. Time Switch End Time Visible BOOL Determines whether the end time is displayed (TRUE) or not (FALSE). iot. Time Switch Start Date Visible BOOL Determines whether the start date is displayed (TRUE) or not (FALSE). iot. Time Switch End Date Visible BOOL Determines whether the end date is displayed (TRUE) or not (FALSE). iot. Time Switch Days Visible BOOL Determines whether the weekdays are displayed (TRUE) or not (FALSE). iot. Time Switch Date Yearly Visible BOOL Determines whether the attribute for the annual configuration is displayed (TRUE) or not (FALSE). iot. Time Switch Mode Visible BOOL Determines whether the mode is displayed (TRUE) or not (FALSE). iot. Time Switch Mode Changeable BOOL Determines whether the mode is adjustable (TRUE) or not (FALSE). TYPE ST_Time Switch Widget Sample : STRUCT s Display Name : STRING := ''; b On : BOOL; t Start Time : TIME_OF_DAY; t End Time : TIME_OF_DAY; d Start Date : DATE; d End Date : DATE; b Yearly : BOOL; b Monday : BOOL; b Tuesday : BOOL; b Wednesday : BOOL; b Thursday : BOOL; b Friday : BOOL; b Saturday : BOOL; b Sunday : BOOL; s Mode : STRING := 'Automatic'; a Modes : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; END_STRUCT END_TYPE TF6730-TF6735 Version: 1.11.0 29
## Page 30

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display Display text of the widget. name of the widget and overwrites the PLC attribute 'iot. Display Name'. b On BOOL Switches the timer on Toggle switch top right. (TRUE) or off (FALSE). t Start Time TIME_OF_DAY Start time of the timer. Time on the left side of the arrow. t End Time TIME_OF_DAY End time of the timer. Time on the right side of the arrow. d Start Date DATE Start date of the timer. Date on the left side of the arrow. d End Date DATE End date of the timer. Date on the right side of the arrow. b Yearly BOOL Yearly. Yearly (Depending on the language of the operating system). b Monday BOOL Monday. M. b Tuesday BOOL Tuesday. D. b Wednesday BOOL Wednesday. M. b Thursday BOOL Thursday. D. b Friday BOOL Friday. F. b Saturday BOOL Saturday. S. b Sunday BOOL Sunday. S. s Mode STRING Mode of the timer. The currently displayed mode. a Modes ARRAY [0..n] OF Array of the different By pressing on the current STRING modes that can be set by mode, the adjustable the user. modes can be displayed. 5.3.8 Generic widget The described widget is suitable for displaying a custom widget in the app, which is a flexible alternative in addition to the specific widgets. The various configuration options are described below. In the figure all available features of the widget are active. The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. 30 Version: 1.11.0 TF6730-TF6735
## Page 31

Configuration {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'General'} {attribute 'iot. General Widget Icon' := 'Room'} {attribute 'iot. General Widget Color' := '#F81894'} {attribute 'iot. General Value1Switch Visible' := 'true'} {attribute 'iot. General Value2Visible' := 'true'} {attribute 'iot. General Value2Slider Visible' := 'true'} {attribute 'iot. General Value2Slider Values Visible' := 'true'} {attribute 'iot. General Value2Slider Buttons Visible' := 'true'} {attribute 'iot. General Value2Slider Buttons Inverted' := 'true'} {attribute 'iot. General Value3Visible' := 'true'} {attribute 'iot. General Value3Slider Visible' := 'true'} {attribute 'iot. General Value3Slider Values Visible' := 'true'} {attribute 'iot. General Value3Slider Buttons Visible' := 'true'} {attribute 'iot. General Value3Slider Buttons Inverted' := 'true'} {attribute 'iot. General Mode1Visible' := 'true'} {attribute 'iot. General Mode1Changeable' := 'true'} {attribute 'iot. General Mode2Visible' := 'true'} {attribute 'iot. General Mode2Changeable' := 'true'} {attribute 'iot. General Mode3Visible' := 'true'} {attribute 'iot. General Mode3Changeable' := 'true'} st General Widget Sample : ST_General Widget Sample; TF6730-TF6735 Version: 1.11.0 31
## Page 32

Configuration Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or also additional write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: General. iot. General Widget Icon STRING Determines which icon is used for the widget. The list of available icons can be found at List of available icons [} 83]. iot. General Widget Color STRING Determines with which color sliders and buttons are displayed. The list of available colors can be found at List of available colors [} 84]. The color must either be specified in one of the strings given in the appendix or as a hex code with "#" in front of the value. iot. General Value1Switch Visible BOOL Determines whether the button is displayed (TRUE) or not (FALSE). iot. General Value2Visible BOOL Determines whether the left of the two numerical values is visible (TRUE) or not (FALSE). iot. General Value2Slider Visible BOOL Determines whether the upper of the two sliders is visible (TRUE) or not (FALSE). iot. General Value2Slider Values Visible BOOL Determines whether the borders of the upper slider are visible (TRUE) or not (FALSE). iot. General Value2Slider Buttons Visible BOOL Determines whether the buttons of the upper slider are visible (TRUE) or not (FALSE). iot. General Value2Slider Buttons Inverted BOOL This setting can be used to reverse the orientation of the top slider buttons. iot. General Value3Visible BOOL Determines whether the right of the two numerical values is visible (TRUE) or not (FALSE). iot. General Value3Slider Visible BOOL Determines whether the lower of the two sliders is visible (TRUE) or not (FALSE). iot. General Value3Slider Values Visible BOOL Determines whether the borders of the lower slider are visible (TRUE) or not (FALSE). iot. General Value3Slider Buttons Visible BOOL Determines whether the buttons of the lower slider are visible (TRUE) or not (FALSE). iot. General Value3Slider Buttons Inverted BOOL This setting can be used to reverse the orientation of the buttons of the lower slider. iot. General Mode1Visible BOOL Determines whether the first mode is displayed (TRUE) or not (FALSE). iot. General Mode1Changeable BOOL Determines whether the first mode is adjustable (TRUE) or not (FALSE). iot. General Mode2Visible BOOL Determines whether the second mode is displayed (TRUE) or not (FALSE). iot. General Mode2Changeable BOOL Determines whether the second mode is adjustable (TRUE) or not (FALSE). iot. General Mode3Visible BOOL Determines whether the third mode is displayed (TRUE) or not (FALSE). iot. General Mode3Changeable BOOL Determines whether the third mode is adjustable (TRUE) or not (FALSE). 32 Version: 1.11.0 TF6730-TF6735
## Page 33

Configuration TYPE ST_General Widget Sample : STRUCT s Display Name : STRING := ''; b Value1 : BOOL := FALSE; {attribute 'iot. Unit' := '%'} {attribute 'iot. Min Value' := '0'} {attribute 'iot. Max Value' := '100'} n Value2 : INT; n Value2Request : INT; b Value2Up : BOOL; b Value2Down : BOOL; {attribute 'iot. Unit' := '%'} {attribute 'iot. Min Value' := '0'} {attribute 'iot. Max Value' := '100'} n Value3 : INT; n Value3Request : INT; b Value3Up : BOOL; b Value3Down : BOOL; s Mode1 : STRING := 'Automatic'; a Modes1 : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; s Mode2 : STRING := 'Automatic'; a Modes2 : ARRAY[0..2] OF STRING := ['Manual', 'Automatic', 'Next Mode']; s Mode3 : STRING := 'Automatic'; a Modes3 : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; END_STRUCT END_TYPE TF6730-TF6735 Version: 1.11.0 33
## Page 34

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display Display text of the widget. name of the widget and overwrites the PLC attribute 'iot. Display Name'. b Value1 BOOL Turns the widget on Toggle switch top right. (TRUE) or off (FALSE). iot. Unit STRING Unit of the first value. Unit after the first numerical value. iot. Min Value INT Lower limit of the first On the left side under the value. top slider. iot. Max Value INT Upper limit of the first On the right side under the value. top slider. n Value2 INT First value. Display in the left numerical value and additionally in the filling of the upper slider. n Value2Request INT Request value for the first The value to which the value. upper slider is moved. n Value2Up BOOL One of the buttons for the On the left side of the top slider. upper slider. n Value2Down BOOL One of the buttons for the On the right side of the top top slider. slider. iot. Unit STRING Unit of the second value. Unit after the second numerical value. iot. Min Value INT Lower limit of the second On the left side under the value. bottom slider. iot. Max Value INT Upper limit of the second On the right side under the value. bottom slider. n Value3 INT Second value. Display in the right numerical value and additionally in the filling of the lower slider. n Value3Request INT Request value for the The value to which the second value. lower slider is moved. n Value3Up BOOL One of the buttons for the On the left side of the bottom slider. bottom slider. n Value3Down BOOL One of the buttons for the On the right side of the bottom slider. bottom slider. s Mode1 STRING First mode. The currently displayed first mode. a Modes1 ARRAY [0..n] OF Array of the different By pressing on the current STRING modes that can be set by mode, the adjustable the user for the first mode. modes can be displayed. s Mode2 STRING Second mode. The currently displayed second mode. a Modes2 ARRAY [0..n] OF Array of the different By pressing on the current STRING modes that can be set by mode, the adjustable the user for the second modes can be displayed. mode. s Mode3 STRING Third mode. The currently displayed third mode. a Modes3 ARRAY [0..n] OF Array of the different By pressing on the current STRING modes that can be set by mode, the adjustable the user for the third modes can be displayed. mode. 34 Version: 1.11.0 TF6730-TF6735
## Page 35

Configuration 5.3.9 RGBW lighting The described widget is suitable for operating RGBW lighting from the app. The various configuration options are described below. In the figure all available features of the widget are active. The following illustration shows the color palette that becomes visible by clicking on the color palette icon. If the same value is selected for 100 ms when moving the selection point, it is sent by the app to the PLC. The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'RGBW'} {attribute 'iot. Light Value Visible' := 'true'} {attribute 'iot. Light Slider Visible' := 'true'} {attribute 'iot. Light Color Palette Visible' := 'true'} {attribute 'iot. Light Color Temperature Slider Visible' := 'true'} {attribute 'iot. Light White Slider Visible' := 'true'} {attribute 'iot. Light Mode Visible' := 'true'} {attribute 'iot. Light Mode Changeable' := 'true'} st General Widget Sample : ST_RGBWWidget Sample; TF6730-TF6735 Version: 1.11.0 35
## Page 36

Configuration Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or also additional write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: RGBW. iot. Light Value Visible BOOL Determines whether the dimming value is displayed (TRUE) or not (FALSE). iot. Light Slider Visible BOOL Determines whether the upper of the three sliders (for the dimming value of the light) is visible (TRUE) or not (FALSE). io T. Light Color Palette Visible BOOL Determines whether the color palette is displayed (TRUE) or not (FALSE). io T. Light Color Temperature Slider Visible BOOL Determines whether the lower of the three sliders (for the color temperature) is visible (TRUE) or not (FALSE). io T. Light White Slider Visible BOOL Determines whether the middle of the three sliders (for the white component) is visible (TRUE) or not (FALSE). iot. Light Mode Visible BOOL Determines whether the mode is displayed (TRUE) or not (FALSE). iot. Light Mode Changeable BOOL Determines whether the mode is adjustable (TRUE) or not (FALSE). TYPE ST_RGBWWidget Sample : STRUCT s Display Name : STRING := ''; b Light : BOOL := FALSE; {attribute 'iot. Unit' := '%'} {attribute 'iot. Min Value' := '0'} {attribute 'iot. Max Value' := '100'} n Light : INT := 100; n Hue Value : INT := 57; n Saturation : INT := 100; {attribute 'iot. Min Value' := '2400'} {attribute 'iot. Max Value' := '6500'} n Color Temperature : INT := 3500; n White : INT := 50; s Mode : STRING := 'Automatic'; a Modes : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; END_STRUCT END_TYPE 36 Version: 1.11.0 TF6730-TF6735
## Page 37

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display Display text of the widget. name of the widget and overwrites the PLC attribute 'iot. Display Name'. b Light BOOL Switches the lighting on Toggle switch top right. (TRUE) or off (FALSE). iot. Unit STRING Unit of the dimming value. Unit after the numerical value. iot. Min Value INT Lower limit of the dimming On the left side under the value. top slider. iot. Max Value INT Upper limit of the dimming On the right side under the value. top slider. n Light INT Dimming value of the Numerical value and lighting. additional image in the filling of the upper slider. n Hue Value INT The Hue color value in the The number of degrees of value range from 0 (red) to the circle in the color 360 (red again). palette. n Saturation INT Saturation of the color At the top of the color value in the value range palette, the value is 0 and from 0 (grey) to 100 at the bottom of the color (selected color). palette, the value is 100. iot. Min Value INT Lower limit of the color No explicit display, defines temperature value. the value range of the lower slider. iot. Max Value INT Upper limit of the color No explicit display, defines temperature value. the value range of the lower slider. n Color Temperature INT Value of the color Display in the lower slider. temperature. n White INT Value of the white Display in the middle component (between 0 slider. and 100). s Mode STRING Mode of lighting. The currently displayed mode. a Modes ARRAY [0..n] OF Array of the different By pressing on the current STRING modes that can be set by mode, the adjustable the user. modes can be displayed. 5.3.10 Bar chart The widget described is suitable for displaying a horizontal bar chart in the app. This bar chart can display both individual bars and two bars to be compared. The various configuration options are described below. In the figure all available features of the widget are active. TF6730-TF6735 Version: 1.11.0 37
## Page 38

Configuration The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'Bar Chart'} {attribute 'iot. Chart XAxis Label' := 'Name for X Axis'} {attribute 'iot. Chart YAxis Label' := 'Name for Y Axis'} {attribute 'iot. Unit' := 'Unit for X Axis'} {attribute 'iot. Chart Legend Visible' := 'true'} {attribute 'iot. Chart Values Visible' := 'true'} {attribute 'iot. Min Value':='0'} {attribute 'iot. Max Value':='1550'} {attribute 'iot. Chart Bar Color1' := '#00FFFF'} {attribute 'iot. Chart Bar Color2' := '#FF00FF'} st Chart : ST_Bar Chart Widget Sample; 38 Version: 1.11.0 TF6730-TF6735
## Page 39

Configuration Attribute Data type Description iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: Bar Chart. io T. Chart XAxis Label STRING The display name of the X-axis. io T. Chart YAxis Label STRING The display name of the Y-axis. iot. Unit STRING Unit displayed in square brackets after the display name of the X-axis. io T. Chart Legend Visible BOOL Determines whether the legend is displayed (TRUE) or not (FALSE). io T. Chart Values Visible BOOL Determines whether the values of the bars are displayed in the diagram (TRUE) or not (FALSE). iot. Min Value INT Lower limit of the value range of the diagram. iot. Max Value INT Upper limit of the value range of the diagram. io T. Chart Bar Color1 STRING Fixes the color of the upper bars. The list of available colors can be found at List of available colors [} 84]. The color must either be specified in one of the strings given in the appendix or as a hex code with "#" in front of the value. io T. Chart Bar Color2 STRING Fixes the color of the lower bars. The list of available colors can be found at List of available colors [} 84]. The color must either be specified in one of the strings given in the appendix or as a hex code with "#" in front of the value. TYPE ST_Bar Chart Widget Sample : STRUCT s Display Name : STRING := ''; a Data Series : ARRAY[0..n] OF INT; a Comparism Data Series : ARRAY[0..n] OF INT; a Data Series Identifier : ARRAY[0..n] OF STRING; a Legend Labels : ARRAY[0..n] OF STRING; END_STRUCT END_TYPE TF6730-TF6735 Version: 1.11.0 39
## Page 40

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display Display text of the widget. name of the widget and overwrites the PLC attribute 'iot. Display Name'. a Data Series ARRAY [0..n] OF INT The first data series Length of the upper displayed in the bar chart. beams. The array must be the same size as the Comparism Data Series and the Data Series Identifier. a Comparism Data Series ARRAY [0..n] OF INT The second data series Length of the lower displayed in the bar chart. beams. The array must be the same size as the Data Series and the Data Series Identifier. When sending an empty array, a bar chart with only one bar is displayed. a Data Series Identifier ARRAY [0..n] OF Names of the values on Labels of the values on STRING the Y-axis. This array must the Y-axis. be the same size as the Data Series and the Comparism Data Series. a Legend Labels ARRAY [0..0] OF Legend of the bar chart. Between the title of the STRING The size of the array is widget and the diagram. ARRAY [0..1] OF determined by the number STRING of bars displayed. 5.3.11 Charging station The widget described is suitable for displaying and operating a charging station in the app. The various configuration options are described below. In the figure all available features of the widget are active. The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'Charging Station'} {attribute 'iot. Charging Station Reserve Visible' := 'true'} 40 Version: 1.11.0 TF6730-TF6735
## Page 41

Configuration {attribute 'iot. Charging Station Phase2Visible' := 'true'} {attribute 'iot. Charging Station Phase3Visible' := 'true'} st Charging Station Widget Sample : ST_Charging Station Widget Sample; Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or additionally also write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: Charging Station. io T. Charging Station Reserve Visible BOOL Specifies whether the reserve button is displayed (TRUE) or not (FALSE). iot. Charging Station Phase2Visible BOOL Specifies whether the values of the second phase are displayed (TRUE) or not (FALSE). iot. Charging Station Phase3Visible BOOL Specifies whether the values of the third phase are displayed (TRUE) or not (FALSE). TYPE ST_Charging Station Widget Sample : STRUCT s Display Name : STRING; b Start Charging : BOOL; b Stop Charging : BOOL; b Reserve Charging : BOOL; s Status : STRING; n Battery Level : UINT; n Current Power : LREAL; a Three Phase Max Power : ARRAY[0..2] OF LREAL; a Three Phase Current Power : ARRAY[0..2] OF LREAL; a Three Phase Amperage : ARRAY[0..2] OF LREAL; a Three Phase Voltage : ARRAY[0..2] OF LREAL; n Charging Time : UDINT; n Charging Energy : LREAL; END_STRUCT END_TYPE TF6730-TF6735 Version: 1.11.0 41
## Page 42

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display name Display text of the of the widget and overwrites widget. the PLC attribute 'iot. Display Name'. b Start Charging BOOL Intended to trigger the start of The left button. a charging process. b Stop Charging BOOL Intended to trigger the stop of The center button. a charging process. b Reserve Charging BOOL Intended to trigger the The right button. reservation of a charging station. s Status STRING Intended to indicate the Text under the display status of charging. text of the widget. n Battery Level UINT The charge status of the Marked as "Battery vehicle, if known. Level" in this figure. n Current Power LREAL The current power at which Marked as "Power" in the vehicle is charging in k W. this figure. a Three Phase Max Power ARRAY [0..2] OF LREAL The three maximum power Scaling of the three red- values of the three phases in filled circles. k W. a Three Phase Current Po ARRAY [0..2] OF LREAL The current power of the Fill in the red circles and wer three phases in k W. value above the circles. a Three Phase Amperage ARRAY [0..2] OF LREAL The current amperage of the Upper value within the three phases in A. three circles. a Three Phase Voltage ARRAY [0..2] OF LREAL The current voltage of the Lower value within the three phases in V. three circles. n Charging Time UDINT The elapsed time of the Marked as "Charging charging process in seconds. Time" in this figure. n Charging Energy LREAL The energy charged so far Marked as "Energy during the current charging charged" in this figure. process in k Wh. 5.3.12 Energy monitoring The described widget is suitable for displaying the energy data in the app. The different configuration options are described below. In the figure all available features of the widget are active. The values shown in the widget do not claim to be realistic. They are merely intended to show different possibilities of presentation. 42 Version: 1.11.0 TF6730-TF6735
## Page 43

Configuration The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'Energy Monitoring'} {attribute 'iot. Energy Monitoring Phase2Visible' := 'true'} {attribute 'iot. Energy Monitoring Phase3Visible' := 'true'} st Energy Monitoring Widget Sample : ST_Energy Monitoring Widget Sample; Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or additionally also write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: Energy Monitoring. io T. Energy Monitoring Phase2Visible BOOL Specifies whether the values of the second phase are displayed (TRUE) or not (FALSE). io T. Energy Monitoring Phase3Visible BOOL Specifies whether the values of the third phase are displayed (TRUE) or not (FALSE). TYPE ST_Energy Monitoring Widget Sample : STRUCT s Display Name : STRING; s Status : STRING; a Three Phase Max Power : ARRAY[0..2] OF LREAL; a Three Phase Current Power : ARRAY[0..2] OF LREAL; a Three Phase Power Units : ARRAY[0..2] OF STRING; a Three Phase Amperage : ARRAY[0..2] OF LREAL; a Three Phase Amperage Units : ARRAY[0..2] OF STRING; a Three Phase Voltage : ARRAY[0..2] OF LREAL; a Three Phase Voltage Units : ARRAY[0..2] OF STRING; n Power Quality Factor : LREAL; n Current Power : LREAL; s Power Unit : STRING; n Energy : LREAL; s Energy Unit : STRING; END_STRUCT END_TYPE TF6730-TF6735 Version: 1.11.0 43
## Page 44

Configuration Attribute Data type Description Display in widget s Display Name STRING Determines the display name Display text of the of the widget and overwrites widget. the PLC attribute 'iot. Display Name'. s Status STRING Intended to indicate the Text under the display status of energy monitoring. text of the widget. a Three Phase Max Power ARRAY [0..2] OF LREAL The three maximum power Scaling of the three red- values of the three phases. filled circles. a Three Phase Current Po ARRAY [0..2] OF LREAL The current power of the Fill in the red circles and wer three phases. value above the circles. a Three Phase Power Units ARRAY [0..2] OF Intended to define the units of Units behind the value STRING the three powers. You can above the circles. find out more about processing the units later in this chapter. a Three Phase Amperage ARRAY [0..2] OF LREAL The three values of the Value of the upper amperages of the three number in the circles. phases. a Three Phase Amperage ARRAY [0..2] OF Intended to define the units of Unit behind the upper Units STRING the three amperages. You value in the circles. can find out more about processing the units later in this chapter. a Three Phase Voltage ARRAY [0..2] OF LREAL The three values of the Value of the lower voltages of the three phases. number in the circles. a Three Phase Voltage Unit ARRAY [0..2] OF Intended to define the units of Unit behind the lower s STRING the three voltages. You can value in the circles. find out more about processing the units later in this chapter. n Power Quality Factor LREAL The power quality factor. Marked as "Power Quality Factor" in this figure. n Current Power LREAL The current total power. Marked as "Power" in this figure. s Power Unit STRING Unit of the current total Behind the value for power. "Power". n Energy LREAL The energy charged so far Marked as “Energy” in during the current charging this figure. process. s Energy Unit STRING Unit of the energy charged so Behind the value for far. "Energy". Automatic conversion of units Starting from the base unit specified in the respective arrays, the current value is automatically converted in the range between nano (10^-9) and exa (10^18) to enable a meaningful display in the widget. For example, if A is specified as the base unit, a value of 0.0001 A would be displayed as 100 µA. If the value is 10000 A, 10 k A would be displayed. 5.3.13 4-channel LED The widget described is suitable for operating RGBW lighting from the app. Compared to the widget RGBW lighting [} 35], the focus here is specifically on the 4-channel EL2564. Separate values can be assigned to each individual channel, and a common color value can be set using the color palette. The various configuration options are described below. In the figure all available features of the widget are active. 44 Version: 1.11.0 TF6730-TF6735
## Page 45

Configuration The following illustration shows the color palette that becomes visible by clicking on the color palette icon. The widget is transferred as a substructure in the overall structure of the Send Data [} 56]() method. To build the widget, various PLC attributes are used when declaring the structure. {attribute 'iot. Read Only' := 'false'} {attribute 'iot. Display Name' := 'Name for Widget'} {attribute 'iot. Widget Type' := 'RGBWEL2564'} {attribute 'iot. Led Red Slider Visible' := 'true'} {attribute 'iot. Led Green Slider Visible' := 'true'} {attribute 'iot. Led Blue Slider Visible' := 'true'} {attribute 'iot. Led White Slider Visible' := 'true'} {attribute 'iot. Led Mode Visible' := 'true'} {attribute 'iot. Led Mode Changeable' := 'true'} st General Widget Sample : ST_RGBWEL2564Widget Sample; TF6730-TF6735 Version: 1.11.0 45
## Page 46

Configuration Attribute Data type Description iot. Read Only BOOL Determines whether the widget on the app side gets only read access (TRUE) or also additional write access to the PLC (FALSE). iot. Display Name STRING The display name of the widget in the app. This will be overwritten by s Display Name as soon as s Display Name is not an empty string. iot. Widget Type STRING Type specification for the widget, in this case: RGBWEL2564. iot. Led Red Slider Visible BOOL Specifies whether the slider is displayed for the red channel (TRUE) or not (FALSE). iot. Led Green Slider Visible BOOL Specifies whether the slider is displayed for the green channel (TRUE) or not (FALSE). io T. Led Blue Slider Visible BOOL Specifies whether the slider is displayed for the blue channel (TRUE) or not (FALSE). io T. Led White Slider Visible BOOL Specifies whether the slider is displayed for the white channel (TRUE) or not (FALSE). io T. Led Mode Visible BOOL Specifies whether the mode is displayed (TRUE) or not (FALSE). io T. Led Mode Changeable BOOL Specifies whether the mode is adjustable (TRUE) or not (FALSE). TYPE ST_RGBWEL2564Widget Sample : STRUCT s Display Name : STRING := ''; b On : BOOL := FALSE; n Red : INT; n Green : INT; n Blue : INT; n White : INT; s Mode : STRING := 'Automatic'; a Modes : ARRAY[0..1] OF STRING := ['Manual', 'Automatic']; END_STRUCT END_TYPE Attribute Data type Description Display in widget s Display Name STRING Specifies the display name Display text of the widget. of the widget and overwrites the PLC attribute 'iot. Display Name'. b On BOOL Switches the lighting on Toggle switch top right. (TRUE) or off (FALSE). n Red INT The value for the red Red colored slider. channel in the value range from 0 to 32767. n Green INT The value for the green Green colored slider. channel in the value range from 0 to 32767. n Blue INT The value for the blue Blue colored slider. channel in the value range from 0 to 32767. n White INT The value for the white White colored slider. channel in the value range from 0 to 32767. s Mode STRING Mode of lighting. The currently displayed mode. a Modes ARRAY [0..n] OF Array of the different By pressing on the current STRING modes that can be set by mode, the adjustable the user. modes can be displayed. 46 Version: 1.11.0 TF6730-TF6735
## Page 47

Configuration 5.4 Nested structures It is possible to communicate with the Communicator app from the PLC via several levels of nested structures. These nested structures can be directly displayed on the app side and can be expanded down to the last level. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.17 or higher App version 1.2.2 or higher TC3_Iot Communicator 5.5 Limitation of decimal places In many use cases it is sufficient in the app not to display all decimal places of floating-point numbers (PLC: REAL and LREAL). As an example, a temperature value is mentioned at this point, where a human being can still do something with a maximum of two digits after the decimal point. At this point there are two possibilities to influence the number of decimal places displayed. In the first option, a setting is used for the entire app, and each variable is limited to a number of decimal places specified in the app settings (see App settings [} 71]). The second possibility is to set a certain number of decimal places for a single variable via the PLC attributes (cf. Limitation of decimal places [} 16]). If different values for the number of decimal places are defined in the app settings and the setting on a single variable, the setting on the single variable is always taken into account first. It is therefore possible, for example, to define the value 2 for all floating-point numbers via the app settings and still deviate from this number for individual variables. The restriction of decimal places means that the values are rounded. They are not cut off at all. The table below shows a simple example: Value Decimal Number Precision Display in the app 1.68678 3 1.687 1.68678 1 1.7 1.68678 0 2 Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.23 or higher App version 1.2.6 or higher TC3_Iot Communicator 5.6 Navigation via QR code A QR code can be generated for each page below a device. With the help of this QR code it is possible to open any page of the app directly. For this purpose, the QR code can be used as a graphic or the URL behind it can be used directly. TF6730-TF6735 Version: 1.11.0 47
## Page 48

Configuration A QR code can also be generated for a graph. This QR code can be used to reopen this graph as well as a single page. For this purpose, a button for generating a QR code is displayed at the top of the navigation bar. 48 Version: 1.11.0 TF6730-TF6735
## Page 49

Configuration 5.7 On Change mechanisms The On Change mechanism is primarily intended for use with the Send Data As String [} 58] mechanism. There are various references to the use of this mechanism. Difference between the different methods The Send Data [} 56] method and the Send Data As String [} 58] method are sent as retain messages. This has the effect that a newly connected app automatically has the most recently sent data available, even if no data is currently being sent. If the respective On Change methods are used, the messages are not sent as retain messages. With a new connection, the current status of the data should be sent as a retain message so that the newly connected app instance also has the current status of the data available. Further information on the On Change methods can be found at Send Data_On Change [} 60] and Send Data As String_On Change [} 60]. Adding variables/widgets If the Send Data As String [} 58] mechanism is used, a certain structure of the JSON document must be taken into account. If changes (add/delete or adjust) are made to the structure between two calls, the following points must be observed: • If a variable/widget is added and no change to the order is desired, the Force Update parameter can remain FALSE. • If a variable/widget is added and a change to the order is desired, the Force Update parameter must be set to TRUE for a call. It should then be set to FALSE again. TF6730-TF6735 Version: 1.11.0 49
## Page 50

Configuration • If a variable/widget is deleted, the page in the app must be closed and reopened once. • If a variable/widget is changed in relation to the metadata (e.g. reconfiguration of a widget), Force Update must be set to TRUE for a call, otherwise only the values of the widget are updated. It should then be set to FALSE again. Additional Notes • The b New App Subscribe parameter of the FB_Iot Communicator [} 53] function block goes TRUE for one cycle when a new app instance connects to the topic on the message broker. This parameter can be used to identify the right time to send a retain message. • The n Active App Instances parameter of the FB_Iot Communicator [} 53] function block specifies the number of connected app instances. If no app is connected, no data is sent in order to save performance and data volume. Structure Twin CAT JSON The Twin CAT Io T Communicator product range uses a JSON format called Twin CAT JSON for communication: the structure of a Twin CAT JSON document is described below using the widgets Socket [} 23] and Ventilation [} 26] as an example. { "Timestamp" : "2022-08-04T07:15:06.176", "Group Name" : "Widget Testpage", "Values" : { "s Page Desc" : "Twin CAT JSON Page", "st Plug" : { "s Display Name" : "", "b On" : true, "s Mode" : "Manual", "a Modes" : [ "Manual", "Automatic" ] }, "st Vent" : { "s Display Name" : "", "b On" : true, "n Value" : 725, "n Value Request" : 400, "s Mode" : "Manual", "a Modes" : [ "Manual", "Automatic" ] } }, "Meta Data" : { "s Page Desc" : { "iot. Display Name" : "Info", "iot. Read Only" : "true" }, "st Plug" : { "iot. Display Name" : "Plug Widget", "iot. Read Only" : "false", "iot. Widget Type" : "Plug", "iot. Plug Mode Visible" : "true", "iot. Plug Mode Changeable" : "false" }, "st Vent" : { "iot. Display Name" : "Ventilation Widget", "iot. Read Only" : "false", "iot. Widget Type" : "Ventilation", "iot. Ventilation Slider Visible" : "true", "iot. Ventilation Value Request Visible" : "false", "iot. Ventilation Mode Visible" : "true", "iot. Ventilation Mode Changeable" : "false" }, "st Vent.n Value" : { "iot. Unit" : "ppm", "iot. Min Value" : "400", "iot. Max Value" : "1400" } }, "Force Update":false } 50 Version: 1.11.0 TF6730-TF6735
## Page 51

Configuration Range Description Timestamp Must contain a timestamp per message in the format: "YYYY-MM-DDThh:mm:ss.fff" e.g. "2022-08-04T07:15:06.176". Group Name Name of the entry node of the Communicator function block in the app. Values The values to be displayed, starting on the first page, with subsequent nesting. Meta Data Everything that is implemented in PLC attributes (for example, the configuration of widgets). Force Update Optional parameter. Is used in the On Change mechanism to trigger an update after changes. More accurate information can be found at On Change mechanisms [} 49]. 5.8 Using UTF-8 characters Variables Twin CAT uses the ISO/IEC 8859-1 character set by default. The Twin CAT Io T Communicator app, on the other hand, uses UTF-8 for decoding STRINGs. The first 128 characters are the same for UTF-8 and ISO/IEC 8859-1. For all characters not contained in the first 128 characters, the following method must be applied to the STRING variable: s My UTF8Text : STRING := ws Literal_TO_UTF8( "äöüßéèêµ€° Ἀθῆναι İstanbul Київ"); When used in arrays, the conversion must take place outside the array: a Data : ARRAY[0..2] OF STRING := ['Sample1', s My UTF8Text, 'Sample2']; It should be noted at this point that this conversion must also be taken into account in other program sequences. Attributes If special characters are to be used in the attributes, a check mark can be set for the UTF-8 encoding of the ADS symbols in Twin CAT Build 3.1.4024. TF6730-TF6735 Version: 1.11.0 51
## Page 52

Configuration With Twin CAT 3.1.4026, this setting is set by default. Therefore, it no longer needs to be set manually by the user. 5.9 User authorizations It is possible to assign authorizations for users. This feature can be used to display individual areas per user or to deny certain users access to areas of the app. This feature is only intended for display within the app. If there is a direct connection to the message broker, all content can potentially be viewed. Configuration at device level It is possible to assign user authorization for an entire device (and thus an instance of the function block FB_Iot Communicator [} 53]). The variable s Permitted Users is available in FB_Iot Communicator [} 53] for this purpose. Configuration at variable level It is also possible to assign authorizations for each variable. The iot. Permitted Users attribute can be used for this purpose. This applies to both structures and individual variables. At both device and variable level, the permitted users are specified comma-separated by a string. Further information can be found at FB_Iot Communicator [} 53] and at Permitted Users [} 15]. 52 Version: 1.11.0 TF6730-TF6735
## Page 53

PLC API 6 PLC API 6.1 Function blocks 6.1.1 FB_Iot Communicator The function block enables communication with an MQTT broker. An FB_Iot Communicator function block deals with the connection to precisely one broker and with sending and receiving of data for precisely one device. To ensure the background communication to this broker and thus enable sending and receiving of data and messages, the Execute method of the function block must be called cyclically. All connection parameters exist as input parameters and are evaluated when a connection is established. Syntax Definition: FUNCTION_BLOCK FB_Iot Communicator VAR_INPUT s Host Name : STRING := '127.0.0.1'; n Port : UINT := 1883; s Client Id : STRING; s Main Topic : STRING; s Device Name : STRING; s User : STRING; s Password : STRING; st Tls : ST_Iot Communicator Tls; b Retain : BOOL := TRUE; e Qo S : Tc Iot Mqtt Qos := Tc Iot Mqtt Qos. At Least Once Delivery; s Device Icon : STRING; t Heartbeat Interval : TIME := TIME#1m0s0ms; s Permitted Users : STRING(512) := '*'; END_VAR VAR_OUTPUT b Error : BOOL; hr Error Code : HRESULT; e Connection State : ETc Iot Mqtt Client State; b Connected : BOOL; n Active App Instances : UINT; b New App Subscribe : BOOL; fb Command : FB_Io TCommand; END_VAR TF6730-TF6735 Version: 1.11.0 53
## Page 54

PLC API Inputs Name Type Description s Host Name STRING s Host Name can be specified as the host name or as the IP address. If no information is provided, the local host is used. n Port UINT The host port is specified here. (Default: 1883) s Client Id STRING The client ID can be specified individually. If no ID is specified, it is generated. s Main Topic STRING Here you specify the main topic in which the data and messages are sent. s Device Name STRING Here you can enter the name of the device to which the data and messages belong. s User STRING Optionally, a user name can be specified. s Password STRING A password for the user name can be entered here. st TLS ST_Iot Communicator Tls [} 63] Parameter structure If the broker offers a TLS-secured connection, the required configuration can be implemented here. b Retain BOOL By default, the broker stores the current data and the last 255 messages, together with the current device status. If this is not desirable, b Retain can be set to FALSE. e Qo S Tc Iot Mqtt Qos The Quality of Service (Qo S for short) can be set with this setting. s Device Icon STRING This setting can be used to change the icon of the Communicator function block. If the setting is not set, the Twin CAT cube is used as icon by default. The list of available icons can be found at List of available icons [} 83]. t Heartbeat Interval TIME The timespan after which the online information of this function block is updated. The online information is visible at the top level in the app, where you can see the overview of the individual function blocks. The default value is 60 seconds. s Permitted Users STRING(512) This variable can be used to specify the users who are authorized to see a device. The users are separated by a comma. With the default value '*', all users are authorized to see the device. 54 Version: 1.11.0 TF6730-TF6735
## Page 55

PLC API Outputs Name Type Description b Error BOOL TRUE if an error situation occurs. hr Error Code HRESULT Returns an error code if the b Error output is set. e Connection State ETc Iot Mqtt Client State Indicates the state of the connection between client and broker as enumeration ETc Iot Mqtt Client State. b Connected BOOL TRUE if there is a connection between the client and the broker. n Active App Instances UINT Shows the number of currently connected app instances. b New App Subscribe BOOL Goes TRUE for one cycle when a new app instance has connected. Can be used when using On Change functionalities to publish the current status of the data again as a retain message during the connection. fb Command FB_Iot Command [} 62] Provides all the necessary functionality to evaluate received data ("Commands"). Methods Name Description Execute [} 56] Method for background communication with the Twin CAT driver. This method must be called cyclically. Send Data [} 56] Method for sending data to the specified MQTT message broker as a retain message. Send Message [} 57] Method for sending a (push) message to the specified MQTT message broker. Send Data As String [} 58] Method for sending data to the specified MQTT message broker where the JSON document is transferred directly. Send Data_On Change [} 60] Method for sending On Change data to the specified MQTT message broker. Send Data As String_On Change [} 60] Method for sending On Change data to the specified MQTT message broker where the JSON document is transferred directly. Strings in UTF-8 format The variables of type STRING used here are based on the UTF-8 format. This STRING formatting is common for MQTT communication. In order to be able to receive special characters and texts from a wide range of languages, the character set in the Tc3_Iot Communicator library is not limited to the typical character set of the data type STRING. Instead, the Unicode character set in UTF-8 format is used in conjunction with the data type STRING. If the ASCII character set is used, there is no difference between the typical formatting of a STRING and the UTF-8 formatting of a STRING. TF6730-TF6735 Version: 1.11.0 55
## Page 56

PLC API Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4022.0 IPC or CX (x86, x64, Arm®) Tc3_Iot Communicator 6.1.1.1 Execute This method must be called cyclically in order to ensure the background communication with the MQTT broker. Syntax METHOD Execute VAR_INPUT b Connect : BOOL; END_VAR Inputs Name Type Description b Connect BOOL The connection to the broker is established when b Connect is set to TRUE. b Connect must remain set to maintain the connection. The connection to the broker is cut off by calling the Execute() method with FALSE as the input. Any errors are reported at the outputs b Error, hr Error Code and e Connection State of the function block instance. 6.1.1.2 Send Data This method is called once to send data to the broker. Syntax METHOD Send Data : BOOL VAR_INPUT p Machine Struct : PVOID; n Struct Size : UINT; END_VAR Return value Name Type Description Send Data BOOL The method returns the return value TRUE if the call was successful. Inputs Name Type Description p Machine Struct PVOID Address for the structure in which the device variables are declared. n Struct Size UINT Size of the structure specified in p Machine Struct. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 56 Version: 1.11.0 TF6730-TF6735
## Page 57

PLC API 6.1.1.3 Send Message This method is called once to send a (push) message to the broker. This message is then displayed in the app. This is not a message that is visible as a push message on the mobile phone. The Send Message Ex [} 57] method can be used to send categorized (push) messages. Syntax METHOD Send Message : BOOL VAR_INPUT s Message : STRING(255); END_VAR Return value Name Type Description Send Message BOOL The method returns the return value TRUE if the call was successful. Inputs Name Type Description s Message STRING Text of the (push) message to be sent to the broker. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. Strings in UTF-8 format The variables of type STRING used here are based on the UTF-8 format. This STRING formatting is common for MQTT communication. In order to be able to receive special characters and texts from a wide range of languages, the character set in the Tc3_Iot Communicator library is not limited to the typical character set of the data type STRING. Instead, the Unicode character set in UTF-8 format is used in conjunction with the data type STRING. If the ASCII character set is used, there is no difference between the typical formatting of a STRING and the UTF-8 formatting of a STRING. 6.1.1.4 Send Message Ex This method is called once to send a categorized (push) message to the broker. This message is then displayed in the app. This is not a message that is visible as a push message on the mobile phone. The Send Message [} 57] method can be used to send (push) messages without a category. Syntax METHOD Send Message Ex : BOOL VAR_INPUT s Message : STRING(255); s Type : STRING(255); END_VAR TF6730-TF6735 Version: 1.11.0 57
## Page 58

PLC API Return value Name Type Description Send Message Ex BOOL The method returns the return value TRUE if the call was successful. Inputs Name Type Description s Message STRING Text of the (push) message to be sent to the broker. s Type STRING Category of the (push) message. Currently possible categories are: Info, Warning, Error, Critical. If an unknown category is entered, a question mark is displayed instead of the category. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. Strings in UTF-8 format The variables of type STRING used here are based on the UTF-8 format. This STRING formatting is common for MQTT communication. In order to be able to receive special characters and texts from a wide range of languages, the character set in the Tc3_Iot Communicator library is not limited to the typical character set of the data type STRING. Instead, the Unicode character set in UTF-8 format is used in conjunction with the data type STRING. If the ASCII character set is used, there is no difference between the typical formatting of a STRING and the UTF-8 formatting of a STRING. 6.1.1.5 Send Data As String This method is called once to send data to the broker. Unlike the classic Send Data [} 56]() method, the JSON document is passed directly at this point. In this way, the user achieves greater flexibility, but in return must send a correctly constructed JSON document to the app. The method is intended for users experienced in handling JSON documents. In case of incorrectly formatted JSON documents, the information cannot be displayed in the app. Syntax METHOD Send Data As String : BOOL VAR_INPUT s Json String : POINTER TO STRING; n Json Len : UINT; END_VAR Return value Name Type Description Send Data As String BOOL The method returns the return value TRUE if the call was successful. Inputs Name Type Description s Json String POINTER TO STRING Pointer to the JSON string to be sent. n Json Len UINT Length of the JSON string 58 Version: 1.11.0 TF6730-TF6735
## Page 59

PLC API Possible errors are output at the outputs b Error and hr Error Code of the function block instance. Structure Twin CAT JSON The Twin CAT Io T Communicator product range uses a JSON format called Twin CAT JSON for communication: the structure of a Twin CAT JSON document is described below using the widgets Socket [} 23] and Ventilation [} 26] as an example. { "Timestamp" : "2022-08-04T07:15:06.176", "Group Name" : "Widget Testpage", "Values" : { "s Page Desc" : "Twin CAT JSON Page", "st Plug" : { "s Display Name" : "", "b On" : true, "s Mode" : "Manual", "a Modes" : [ "Manual", "Automatic" ] }, "st Vent" : { "s Display Name" : "", "b On" : true, "n Value" : 725, "n Value Request" : 400, "s Mode" : "Manual", "a Modes" : [ "Manual", "Automatic" ] } }, "Meta Data" : { "s Page Desc" : { "iot. Display Name" : "Info", "iot. Read Only" : "true" }, "st Plug" : { "iot. Display Name" : "Plug Widget", "iot. Read Only" : "false", "iot. Widget Type" : "Plug", "iot. Plug Mode Visible" : "true", "iot. Plug Mode Changeable" : "false" }, "st Vent" : { "iot. Display Name" : "Ventilation Widget", "iot. Read Only" : "false", "iot. Widget Type" : "Ventilation", "iot. Ventilation Slider Visible" : "true", "iot. Ventilation Value Request Visible" : "false", "iot. Ventilation Mode Visible" : "true", "iot. Ventilation Mode Changeable" : "false" }, "st Vent.n Value" : { "iot. Unit" : "ppm", "iot. Min Value" : "400", "iot. Max Value" : "1400" } }, "Force Update":false } Range Description Timestamp Must contain a timestamp per message in the format: "YYYY-MM-DDThh:mm:ss.fff" e.g. "2022-08-04T07:15:06.176". Group Name Name of the entry node of the Communicator function block in the app. Values The values to be displayed, starting on the first page, with subsequent nesting. Meta Data Everything that is implemented in PLC attributes (for example, the configuration of widgets). Force Update Optional parameter. Is used in the On Change mechanism to trigger an update after changes. More accurate information can be found at On Change mechanisms [} 49]. TF6730-TF6735 Version: 1.11.0 59
## Page 60

PLC API 6.1.1.6 Send Data_On Change This method is called once to send data to the broker. The Send Data [} 56] method always transfers the entire data as a retain message. With the Send Data_On Change method, on the other hand, it is possible to transfer individual parts of the data in order to save data traffic. However, it should be noted that with the Send Data_On Change method the messages are not sent as retain messages and are therefore only known to currently connected app instances. The data must be kept ready in the Twin CAT project and sent as a complete data block and as a retain message when a new client is connected using the Send Data [} 56] method. It should be noted at this point that the On Change mechanisms [} 49] are mainly intended for use with the Send Data As String [} 58] methods. With the Send Data methods, On Change can only be used if a structure is used when sending the structure that has the same variable path up to the variables to be changed. Syntax METHOD Send Data_On Change : BOOL VAR_INPUT p Machine Struct : PVOID; n Struct Size : UINT; END_VAR Return value Name Type Description Send Data_On BOOL The method returns the return value TRUE if the call was successful. Change Inputs Name Type Description p Machine Struct PVOID Address for the structure in which the device variables are declared. n Struct Size UINT Size of the structure specified in p Machine Struct. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 6.1.1.7 Send Data As String_On Change This method is called once to send data to the broker. Unlike the classic Send Data [} 56]() method, the JSON document is passed directly at this point. In this way, the user achieves greater flexibility, but in return must send a correctly constructed JSON document to the app. The method is intended for users experienced in handling JSON documents. In case of incorrectly formatted JSON documents, the information cannot be displayed in the app. The Send Data As String [} 58] method transmits the data as a retain message. With the Send Data As String_On Change method, on the other hand, it is possible to transfer individual parts of the data in order to save data traffic. However, it should be noted that with the Send Data As String_On Change method the messages are not sent as retain messages and are therefore only known to currently connected app instances. The data must be kept ready in the Twin CAT project and sent as a complete data block when a new client is connected using the Send Data As String [} 58] method. 60 Version: 1.11.0 TF6730-TF6735
## Page 61

PLC API Syntax METHOD Send Data As String_On Change : BOOL VAR_INPUT s Json String : POINTER TO STRING; n Json Len : UINT; END_VAR Return value Name Type Description Send Data As String_On BOOL The method returns the return value TRUE if the call was successful. Change Inputs Name Type Description s Json String POINTER TO STRING Pointer to the JSON string to be sent. n Json Len UINT Length of the JSON string Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 6.1.1.8 Send Custom Device Icon This method allows the user to send a user-defined icon to be displayed at the top level of a Communicator function block. The Twin CAT cube is displayed here by default. The icon is transmitted as a Base64- encoded string and can also be changed at runtime. Please note that, depending on the image size, large amounts of data may be transferred. This means that more storage space is required in the PLC, the message broker and the app. For static images, it is therefore recommended that the icon is only transferred once when the program is started. By saving the image in the retain topic, it remains permanently available for all subsequent clients. Syntax METHOD Send Custom Device Icon : BOOL VAR_INPUT p Base64Encoded Icon String : POINTER TO STRING; b Is Icon Multicolor : BOOL; END_VAR Return value Name Type Description Send Custom Device Ico BOOL The method returns the return value TRUE if the call was successful. n TF6730-TF6735 Version: 1.11.0 61
## Page 62

PLC API Inputs Name Type Description p Base64Encode POINTER TO STRING Pointer to the Base64 string that contains the image. The d Icon String image must be converted from an image format to a Base64 string using a converter. Please note that only the Base64 string is specified here. b Is Icon Multicolor BOOL Set to TRUE for multicolor icons to ensure that colors are not inverted when the app is running in Dark Mode. If this setting is set to FALSE, the icon will always be displayed in black and white. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 6.1.2 FB_Iot Command The function block FB_Iot Command provides functions for evaluating received commands. It must not instantiated, since it is already declared at the output of the FB_Iot Communicator [} 53] instance and is used to access the outputs and received commands. Syntax Definition: FUNCTION BLOCK FB_Iot Command VAR_INPUT END_VAR VAR_OUTPUT b Error : BOOL; hr Error Code : HRESULT; b Available : BOOL; // if true, a new command is available s Var Name : STRING; // Name of variable in currently available command END_VAR Outputs Name Type Description b Error BOOL TRUE if an error situation occurs. hr Error Code HRESULT Returns an error code if the b Error output is set. b Available BOOL TRUE, if a new command is available. s Var Name STRING If b Available is TRUE, s Var Name contains the name of the variable that was received. Methods Name Description Get Value [} 63] Method for accessing the value of the command, if b Available is TRUE Remove [} 63] Method for discarding the currently available command 62 Version: 1.11.0 TF6730-TF6735
## Page 63

PLC API Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4022.0 IPC or CX (x86, x64, Arm®) Tc3_Iot Communicator 6.1.2.1 Get Value This method is called to access the value of the variable in the current command. Syntax METHOD Get Value : BOOL VAR_INPUT p Value : PVOID; n Size : UDINT; e Datatype : E_Iot Communicator Datatype; END_VAR Return value Name Type Description Get Value BOOL The method returns the return value TRUE if the call was successful. Inputs Name Type Description p Value PVOID Address of the variable to which the received value is to be written. n Size UDINT Size of the variable specified in p Value e Datatype E_Iot Communicator Datatype Data type of the variable specified in p Value, based on enum E_Iot Communicator Datatype 6.1.2.2 Remove This method is called to remove the currently available command from the memory. Return value Name Type Description Remove BOOL This value is set to TRUE if the method is called successfully. 6.2 Data types 6.2.1 ST_Iot Communicator Tls TLS security settings for the MQTT client. TF6730-TF6735 Version: 1.11.0 63
## Page 64

PLC API Syntax Definition: TYPE ST_Iot Communicator Tls : STRUCT e Version : E_Iot Communicator Tls Version := E_Iot Communicator Tls Version.tlsv1_2; // TLS version, which is used s CA : STRING(255); // certificate authority as filename (PEM or DER format) or as string (PEM) s Cert : STRING(255); // (*optional*) client certificate as filename (PEM or DER for mat) or as string (PEM) s Key File : STRING(255); // (*optional*) client key as filename s Key Pwd : STRING(255); b No Server Cert Check : BOOL; // if FALSE the server certificate is validated (default) END_STRUCT END_TYPE Parameter Name Type Description e Version E_Iot Communicator Tls Version TLS version to be used, based on enum E_Iot Communicator Tls Version. s CA STRING(255) Certificate of the certificate authority (CA) s Cert STRING(255) Client certificate that is used for authentication at the broker (optional) s Key File STRING(255) Private key of the client s Key Pwd STRING(255) Password of the private key, if applicable b No Server C BOOL Disables verification of the server certificate validity. ert Check If communication is to take place without TLS encryption (HTTP), this value must remain FALSE. 6.2.2 E_Iot Communicator Datatype Syntax TYPE E_Iot Communicator Datatype : { type_STRING :=0, type_BOOL :=1, type_SINT :=2, type_INT :=3, type_DINT :=4, type_LINT :=5, type_USINT_BYTE :=6, type_UINT_WORD :=7, type_UDINT_DWORD:=8, type_ULINT :=9, type_REAL :=10, type_LREAL :=11 ) INT; END_TYPE 64 Version: 1.11.0 TF6730-TF6735
## Page 65

PLC API Parameter Name Type Description type_STRING INT Data type STRING. type_BOOL INT Data type BOOL. type_SINT INT Data type SINT. type_INT INT Data type INT. type_DINT INT Data type DINT. type_LINT INT Data type LINT. type_USINT_BYTE INT Data type USINT_BYTE. type_UINT_WORD INT Data type UINT_WORD. type_UDINT_DWORD INT Data type UDINT_DWORD. type_ULINT INT Data type ULINT. type_REAL INT Data type REAL. type_LREAL INT Data type LREAL. 6.2.3 E_Iot Communicator Tls Version Syntax TYPE E_Iot Communicator Tls Version : { tlsv1 :=0, tlsv1_1:=1, tlsv1_2:=2 ) INT; END_TYPE Parameter Name Type Description tlsv1 INT TLS version 1. tlsv1_1 INT TLS version 1.1. tlsv1_2 INT TLS version 1.2. TF6730-TF6735 Version: 1.11.0 65
## Page 66

App 7 App The Twin CAT Io T Communicator app can be downloaded free of charge from the Apple® App Store or Google™ Play Store. Google™ Play and the Google™ Play logo are trademarks of Google Inc. At this point it is recommended in the case of new projects to work with the latest versions of both the app and Twin CAT as the engineering so that new features can also be used. Since the app version 1.2.2, the "dark mode" has also been supported in addition to the "light mode". The mode in which the app is displayed depends on the respective operating system settings. 7.1 Settings The settings within the app are divided into three different areas. The first area enables the configuration of the connection to the broker, general app settings can be made in the second area and device information can be displayed in the third and last area. 66 Version: 1.11.0 TF6730-TF6735
## Page 67

App 7.1.1 Connection settings The app and the PLC must be connected to the same message broker in order to be able to receive data from the PLC. The different setting options for connecting to this message broker are described below. TF6730-TF6735 Version: 1.11.0 67
## Page 68

App Basic settings Setting Meaning Broker Address IP address or host name of the message broker. Port The port of the message broker. Usually 1883 (MQTT) or 8883 (MQTT TLS). Timeout This setting specifies the time after the connection to the message broker runs into a timeout. After this time, the connection to the second message broker is attempted if a fallback connection is active. Client Id The client ID of the app with which the connection to the message broker is established. If no user-defined value is entered, the unique device identifier of the mobile device is used. Topic Main topic via which the messages from the associated PLC program are communicated. Authentication Depending on the broker configuration, it may be necessary to enter a user name and password when establishing the connection. If a broker with the option of anonymous access is used, these boxes in the configuration are left empty. Setting Meaning User name User name for logging into the message broker Password Password associated with the user Security In addition to the authentication, the encryption of messages plays an important role. Setting Meaning Encryption Selection of the encryption protocol. CA certificate Referencing the CA certificate as a file. Free file access with Android, only in the “Twin CAT Io T” area under "On my i Phone" with i OS. Further information under Installation of CA certificates [} 71]. PKCS12 Certificate (PFX) Referencing the client certificate as a file. Free file access with Android, only in the “Twin CAT Io T” area under "On my i Phone" with i OS. The certificate must be available as a PFX file. Information on the conversion can be found in popular technical literature. PKCS12 Password Password for the PFX file. Skip Server Certificate Validation This setting disables the validation of the server certificate. 68 Version: 1.11.0 TF6730-TF6735
## Page 69

App Advanced Settings Setting Meaning Fallback Connection An alternative connection to another message broker can be specified here if the primary connection cannot be reached. After the timeout defined above in the settings, the connection to the fallback connection is attempted. Recent Connections The most recent configured connections are displayed here. The connection parameters are inserted automatically by clicking the individual boxes. A new entry is added in the case of a new connection attempt. If a connection has already been established before with these parameters, the entry is placed at the top of the list. Scan QR code A QR code with the connection parameters can be scanned here. The formatting can be found below in a separate section. Use of QR codes for establishing a connection The settings page in the app offers an option to scan a QR code containing the connection parameters. The selection options with regard to security are less extensive in comparison with a manual connection setting. In addition, the user should consider that anyone can gain access via the QR code, depending on the location. It is possible to equip a QR code with the so-called lock parameter. In this case, a connection can be established via the QR code, but no connection details are displayed to the app user. It should be noted at this point that a user can access the data by directly reading the QR code. TF6730-TF6735 Version: 1.11.0 69
## Page 70

App The content of an example QR code looks like this: http://iotdemo.beckhoff.com/app?&broker=iot.beckhoff.com&port=1883&topic=TOPICNAME The connection parameters for the broker address and the broker port as well as for the topic "TOPICNAME" are entered here by scanning the QR code. The following list describes the possible parameters that can be mapped via the URL: 70 Version: 1.11.0 TF6730-TF6735
## Page 71

App Parameters Values broker IP address or host name of the broker. port Port of the message broker (normally 1883 or 8883). clientid Client ID of the app, if required. topic Topic to which the Communicator PLC library is published. user User name for logging into the message broker. password Password to log in to the message broker. lock The possible values are "true" or "1" if you want to hide the connection details. tls Possible values: "Default", "TLSv1_0", "TLSv1_1", "TLSv1_2". No paths to certificates can be specified via the QR code. TLS can therefore only be used without a client certificate and by skipping the validation of the server certificate. As a result, encryption is achieved, but this does not guarantee any security in communication! skip Cert Check The possible values are "true" or "false" to enable or disable the validation of the server certificate. Further description in the "tls" line. favorite Name Name under which a connection is saved as a favorite immediately after scanning the QR code. If there are already three configured favorites, adding as a favorite will fail. 7.1.1.1 Installation of CA certificates To reference CA certificates under the two supported operating systems, Android and i OS, they must first be installed. You will find brief instructions for both below, for further information please refer to the documentation of the two manufacturers. Installation of CA certificates Android 1. Select the path: Settings/Security/Encryption and credentials/Install a certificate/CA certificate. 2. Select a CA certificate. 3. Assign a name for the certificate (optional). ð The system reports the successful installation of the CA certificate. Installation of CA certificates i OS 1. Click on the CA certificate file (must be located outside the Twin CAT Io T folder). This loads the profile. 2. Select the path: Settings/General/Profile. 3. Choose the profile of the CA certificate. 4. Press Install in the top right-hand corner. 5. Confirm the installation by entering the code. 6. Read the warnings at the top right and then press Install to confirm. 7. Select the path: Settings/General/Info/Certificate trust settings. 8. Activate the installed certificate under Activate full trust for root certificates 7.1.2 App settings In addition to the connection settings, general settings can be made for the app. These are described below. TF6730-TF6735 Version: 1.11.0 71
## Page 72

App 72 Version: 1.11.0 TF6730-TF6735
## Page 73

App Setting Meaning Default Keep Screen on When activated, the mobile device FALSE screen will not turn off while the app is open. Lock Application If activated, the set secure route of FALSE the operating system is used in order to protect the app against unauthorized access (Face-ID, Touch-ID, Code, etc.) Data as Default Page If activated, the Data tab is opened TRUE when opening a device, otherwise the Messages tab is opened. Show Message Filter When activated, messages on the FALSE message page can be filtered by category. Show QR Code Button A button for generating a QR code TRUE is displayed on each page within a Device. Toggle Booleans If this setting is activated, Boolean FALSE variables can be switched directly by pressing the display field. If inactive, a selection dialog opens on pressing the variable. This setting is only relevant if "Display Booleans as Switch" is FALSE. Display Booleans as Switch Boolean variables are displayed as TRUE switches. If this setting is disabled, these variables are displayed as a text field. Hide Read-Only Icons When activated, the lock icon for FALSE displaying read-only elements is hidden. There is then no way to recognize a read-only element. Decimal Number Precision Describes the number of decimal This value is not set by default. places to which REAL or LREAL values are rounded when displayed in the app. If a different value is defined on the PLC side for a single variable, the Decimal Number Precision for that variable is overwritten from the PLC. Smooth Line When displaying a live graph, the FALSE curve of the graph is shown rounded off if this feature is activated. Auto Panning If activated, the graph is trimmed to TRUE a certain timespan. Auto Panning Timespan The timespan to which a graph is 5s trimmed in the Live View. 7.1.3 Favorites The connection settings contain an overview of the most recent connections. Click on Recent connections to open them. In this overview, the user can assign names for a connection and add them to the user's favorites. Up to three favorites are then loaded into the quick access on the device overview page and can be opened using the star. TF6730-TF6735 Version: 1.11.0 73
## Page 74

App If no favorites have been created, the star is not displayed. It is also possible to establish a connection to the favorites directly via the app icon. 74 Version: 1.11.0 TF6730-TF6735
## Page 75

App 7.2 Device overview All Io T Communicator function blocks currently connected to the same broker and the same topic are displayed in the device overview. The overview of variables for a device can be opened by clicking this device. TF6730-TF6735 Version: 1.11.0 75
## Page 76

App There may be one or more levels, depending on the setup of the structure sent from the PLC. 76 Version: 1.11.0 TF6730-TF6735
## Page 77

App The graph display is configured via the list symbol in the top right corner. As soon as the user has clicked on the list icon, a selection option appears for the variables that can be displayed in a graph. After selecting the variables, press the play icon in the top right corner. The graph is then displayed according to the settings. TF6730-TF6735 Version: 1.11.0 77
## Page 78

App 7.3 (Push) messages Messages can be displayed under each device. These messages can be sent from the PLC using the methods Send Message [} 57] and Send Message Ex [} 57]. 78 Version: 1.11.0 TF6730-TF6735
## Page 79

App Categories for messages can be defined optionally. The messages can then be filtered using the check marks at the top of the screenshot. A maximum of 255 messages are stored for a device, after which a ring buffer principle is applied and the oldest message is removed. TF6730-TF6735 Version: 1.11.0 79
## Page 80

Samples 8 Samples The samples are divided into two sections. First, there is the Application sample [} 80], which builds and explains a sample step by step. On the other hand, there are two samples on Github that can be downloaded and used directly as PLC code. The first sample (TF6730_Full Sample) covers the standard functions of the app, while the second sample (TF6730_Widget-Sample) deals with the special extensions for building automation. Overview Sample Description TF6730_Full Sample Sample of the standard app functionalities. TF6730_Widget Sample Sample of widget extensions for building automation. Downloads The sample code for the projects described in the overview can be obtained from the corresponding repository on Git Hub: https://github.com/Beckhoff/TF6730_Samples. There you have the option to clone the repository or download a ZIP file containing the sample. 8.1 Application sample Creation of the PLC program Defining a structure Create a structure within which you define the process data to be sent. Assign attributes for the declared variables to define their representation in the app (see Attributes [} 15]). TYPE ST_Process Data : STRUCT {attribute 'iot. Display Name' := 'Kitchen Lights'} b Lamp1 : BOOL; {attribute 'iot. Display Name' := 'Living Room Lights'} b Lamp2 : BOOL; {attribute 'iot. Display Name' := 'Outside Temperature'} {attribute 'iot. Read Only' := 'true'} {attribute 'iot. Unit' := 'Celsius'} {attribute 'iot. Min Value' := '5'} 80 Version: 1.11.0 TF6730-TF6735
## Page 81

Samples {attribute 'iot. Max Value' := '30'} n Temp : REAL; st Second Level : ST_Test; END_STRUCT END_TYPE Configuration In the main program, declare an instance of the function block FB_Iot Communicator. Define the outputs according to your connection data (see FB_Iot Communicator [} 53]). In addition, declare the structure with the process data to be sent and an instance of the TON timer function block. fb Io T : FB_Iot Communicator := ( s Host Name := 'YOUR_MQTT_BROKER', // MQTT Broker Adress n Port := 1883, // MQTT Port s Main Topic := 'plants', // Main Topic s Device Name := 'Building 12.3', // Device Name s User := 'engineer1', // MQTT Username s Password := 'abcdefg'); // MQTT Password st Data: ST_Process Data; // Values to send timer : TON; // Timer to send data Establishing a connection Cyclically call the Execute method in the implementation part of the main program via the instance of the function block FB_Iot Communicator to maintain the connection to the broker and thus enable sending and receiving of data and messages (see Execute [} 56]). fb Io T. Execute(TRUE); Sending data Send the process data to the broker with a sample rate of 500 ms. To this end, call the instance of the timer function block with the corresponding input variables and the Send Data method of the function block FB_Iot Communicator (see Send Data [} 56]). timer(IN := NOT timer. Q, PT := T#500MS); IF fb Io T.b Connected AND timer. Q THEN fb Io T. Send Data(ADR(st Data), SIZEOF(st Data)); END_IF A nested structure must be transferred here for structuring over several levels. The following structure shows a simple example of how nesting can be continued indefinitely. TYPE ST_Test : STRUCT st Level1 : ST_Level_1; n Counter : INT; END_STRUCT END_TYPE TYPE ST_Level_1 : STRUCT n Double Counter: INT; st Level2 : ST_Level_2; END_STRUCT END_TYPE Receiving and evaluating commands Call the function block FB_Iot Command and its methods to receive and evaluate commands (see FB_Iot Command [} 62]). IF fb Io T.fb Command.b Available THEN IF fb Io T.fb Command.s Var Name = 'b Lamp1' THEN fb Io T.fb Command. Get Value(ADR(st Data.b Lamp1), SIZEOF(st Data.b Lamp1), E_Iot Communicator Datatype.type_BOOL); ELSIF fb Io T.fb Command.s Var Name = 'st Second Level.n Double Counter' THEN fb Io T.fb Command. Get Value(ADR(st Data.st Second Level.st Level1.n Double Counter), SIZEOF(st Data.st Second Level.st Level1.n Double Counter), E_Iot Communicator Datatype.type_BOOL); END_IF fb Io T.fb Command. Remove(); END_IF Sending (push) messages TF6730-TF6735 Version: 1.11.0 81
## Page 82

Samples Call the Send Message method of the function block FB_Iot Communicator to send a (push) message to the broker (see Send Message [} 57]). fb Io T. Send Message('This is a test alarm message!'); 82 Version: 1.11.0 TF6730-TF6735
## Page 83

Appendix 9 Appendix 9.1 List of available icons TF6730-TF6735 Version: 1.11.0 83
## Page 84

Appendix 9.2 List of available colors The available colors are the colors displayed in the Colors Class of Windows (https://docs.microsoft.com/en- us/dotnet/api/system.windows.media.colors). Both the strings and the hexadecimal values can be used. The first two digits of the hexadecimal representation represent the opacity, the other 6 are the representation of the color. 84 Version: 1.11.0 TF6730-TF6735
## Page 85

Appendix 9.3 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems TF6730-TF6735 Version: 1.11.0 85
## Page 86

Appendix • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 86 Version: 1.11.0 TF6730-TF6735
## Page 87

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Apple and Safari are trademarks of Apple Inc., registered in the U. S. and other countries and regions. Arm, Arm9 and Cortex are trademarks or registered trademarks of Arm Limited (or its subsidiaries or affiliates) in the US and/or elsewhere. Chrome, Chromium and Google are trademarks of Google LLC. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 88

More Information: www.beckhoff.com/tf6730 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
