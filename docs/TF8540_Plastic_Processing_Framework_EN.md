---
title: "TF8540_Plastic_Processing_Framework_EN"
product: "TF8540"
category: "Process_Engineering"
tags: ["FRAMEWORK", "PLASTIC", "PROCESSING"]
language: "EN"
document_type: "Manual"
version: "1.1.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF8540_Plastic_Processing_Framework_EN.pdf"
release_date: "2025-05-22"
---
Manual | EN TF8540 Twin CAT 3 | Plastic Processing Framework 2025-05-22 | Version: 1.1.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 1.4 Documentation issue status.............................................................................................................. 7 2 Introduction............................................................................................................................................... 8 3 PLC temperature controller...................................................................................................................... 9 3.1 Introduction....................................................................................................................................... 9 3.2 Overview......................................................................................................................................... 10 3.3 Function blocks............................................................................................................................... 12 3.3.1 FB_Temp Ctrl Main Body_Tc Pfw()..................................................................................... 12 3.3.2 FB_Temp Ctrl Main Body_Tc Pfw_TC3()............................................................................. 13 3.3.3 FB_Temp Ctrl Enable Zone_Tc Pfw().................................................................................. 15 3.3.4 FB_Temp Ctrl Stand By Zone_Tc Pfw()................................................................................ 15 3.3.5 FB_Temp Ctrl State_Tc Pfw()............................................................................................. 16 3.3.6 FB_Temp Ctrl Callback_Tc Pfw()........................................................................................ 17 3.3.7 FB_Fc Main Body_Tc Pfw()................................................................................................ 18 3.4 Utilities............................................................................................................................................. 19 3.4.1 Stand Alone...................................................................................................................... 19 3.4.2 FB_x L3403_Tc Pfw()........................................................................................................ 25 3.4.3 FB_Temp Ctrl Adapt Fm33xx_Tc Pfw()............................................................................... 26 3.4.4 FB_Temp Ctrl Clear Supply_Tc Pfw().................................................................................. 27 3.4.5 FB_Temp Ctrl Clear Zones_Tc Pfw()................................................................................... 27 3.4.6 FB_Term Coe Read_Tc Pfw()............................................................................................. 28 3.4.7 FB_Term Coe Write_Tc Pfw()............................................................................................. 29 3.4.8 FB_Term Reg Read_Tc Pfw()............................................................................................. 31 3.4.9 FB_Term Reg Write_Tc Pfw()............................................................................................. 32 3.5 Enumerations.................................................................................................................................. 34 3.5.1 E_Tc Pfw_Tctrl Power Terminal.......................................................................................... 34 3.5.2 E_Tc Pfw_Tctrl Out Select.................................................................................................. 34 3.5.3 E_Tc Pfw_Temp Sens Type............................................................................................... 35 3.5.4 E_Tc Pfw_Terminal Type................................................................................................... 36 3.6 Structures........................................................................................................................................ 39 3.6.1 Mapping........................................................................................................................... 39 3.6.2 ST_Tc Pfw_Temp Mparam From Hmi_Itf............................................................................ 45 3.6.3 ST_Tc Pfw_Temp Pparam From Hmi_Itf............................................................................. 54 3.6.4 ST_Tc Pfw_Temp To Hmi_Itf.............................................................................................. 55 3.6.5 ST_Tc Pfw_Supply Param................................................................................................. 57 3.6.6 ST_Tc Pfw_Temp Ctrl_Itf................................................................................................... 58 3.6.7 ST_Tc Pfw_Power Measurement_Cfg............................................................................... 62 3.7 Knowledge Base............................................................................................................................. 63 3.7.1 Commissioning................................................................................................................. 63 3.7.2 Alarm handling................................................................................................................. 72 3.7.3 Heating current monitoring............................................................................................... 74 TF8540 Version: 1.1.0 3
## Page 4

Table of contents 3.7.4 Parameters saving/loading............................................................................................... 75 3.7.5 Supply groups.................................................................................................................. 78 3.7.6 FAQs................................................................................................................................ 80 3.7.7 Global variables............................................................................................................... 82 4 PLC timer................................................................................................................................................. 87 4.1 Overview......................................................................................................................................... 87 4.2 Function blocks............................................................................................................................... 87 4.2.1 FB_Clock Timer_Tc Pfw().................................................................................................. 87 4.2.2 FB_Clock Timer Param Save_Tc Pfw()............................................................................... 87 4.2.3 FB_Clock Timer Param Load_Tc Pfw()............................................................................... 88 4.3 Structures........................................................................................................................................ 89 4.3.1 ST_Tc Pfw_Clock Timer Itf................................................................................................. 89 4.3.2 ST_Tc Pfw_Clock Timer Cam............................................................................................. 90 4.4 Knowledge Base............................................................................................................................. 90 4.4.1 Commissioning................................................................................................................. 90 4.4.2 Global variables............................................................................................................... 92 4.4.3 FAQs................................................................................................................................ 93 5 PLC alarm visualization.......................................................................................................................... 94 5.1 Overview......................................................................................................................................... 94 5.2 Function blocks............................................................................................................................... 94 5.2.1 FB_Msg Append_Tc Tv A()................................................................................................. 94 5.2.2 FB_Msg Clear Pending_Tc Tv A()....................................................................................... 95 5.2.3 FB_Msg Clear Signal_Tc Tv A().......................................................................................... 96 5.2.4 FB_Msg Deactivate_Tc Tv A()............................................................................................ 97 5.2.5 FB_Msg Garbage Collect_Tc Tv A().................................................................................... 97 5.2.6 FB_Msg Update Time_Tc Tv A()......................................................................................... 98 5.3 Structures........................................................................................................................................ 99 5.3.1 ST_Tc Tv A_Alarm_Itf........................................................................................................ 99 5.4 Knowledge Base........................................................................................................................... 100 5.4.1 Commissioning............................................................................................................... 100 5.4.2 Global variables............................................................................................................. 101 5.4.3 FAQs.............................................................................................................................. 101 4 Version: 1.1.0 TF8540
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF8540 Version: 1.1.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.1.0 TF8540
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. 1.4 Documentation issue status Version Change 1.1.x Extension by additional sensor and terminal types, parameter extension 1.0.x Formatting TF8540 Version: 1.1.0 7
## Page 8

Introduction 2 Introduction The Plastics Processing Framework facilitates the setup of PLC projects for plastics machines. The goal of the Plastics Processing Framework is to combine the basic elements that are present in every plastics machine into one package. Specifically, the following topics are covered: • Temperature control Autotune Loading/ saving of parameters • Message output • Filter blocks • Timers This documentation is divided into three different modules: • The first section describes the controller in more detail. Controller function Load and save functions Filter functions • In the second section a weekly timer is presented to activate the controller also timer-controlled. • The last section describes functions to realize message handling Add messages to a list or remove them from a list, Enabling or disabling messages Each module is organized as follows: • Overview: Gives an overview of this module. • Function blocks: The individual function blocks for this module are explained. • Structures: The individual structures for this function block are explained. • Knowledge Base: Frequently asked questions and commissioning instructions can be found here. Software version The documentation is based on software version 1.0.9 of Pfw Lib_Processing.lib. In older versions of Pfw Lib_Processing.lib it cannot be guaranteed that all functions explained here are implemented. Knowledge Base All the functions, function blocks and data types present in this framework part are listed here. You will find answers to frequently asked questions and notes on the use of the framework, commissioning, problem analysis and sample projects in the Knowledge Base. Observe the notes on documentation. Some of the components listed here are not intended to be used by an application. Their presence, interface and behavior is therefore not guaranteed. Because, however, a Twin CAT PLC Framework is strictly open, it is not possible to hide these internal components. It is, nevertheless, essential to avoid calling these components, identified with (internal use only) or (not recommended), directly from an application. If one of these components would, in practice, be useful for you, please make contact with our Support Department. We will then examine the possibility of making the function block available to you, independently of the library, and for you to then take the responsibility for using it. If the library contains function blocks, types or constants that are not listed in the documentation, then these are elements that have not yet been approved, and are the subject of current software maintenance and development work. These elements must never be directly used in an application, because they are, as a general rule, not yet tested. The framework makes a number of hardware and software requirements. 8 Version: 1.1.0 TF8540
## Page 9

PLC temperature controller 3 PLC temperature controller 3.1 Introduction Temperature control of the Plastics Processing Framework The temperature controller of the Plastics Processing Framework has been optimized for • a quick start-up, • overshot-free response to setpoint changes, • fast correction of faults, • optimal heating and cooling ratio, • independent parameter determination and • exact response to setpoint changes during production . These requirements cannot be realized with a normal PID controller, which is why further algorithms were implemented in addition to the PID controller. The following figure shows schematically the structure of the controller. Determination of the path parameters: • Takes place via the inflectional tangent method. • Separate control parameter determination for heating and cooling. • Determination of the idle load: Reduces overshoot on setpoint change. Parameter determination must be carried out in the controlled state. Takes only a few seconds and does not affect the actual temperature. The control behavior: • Large setpoint step-changes: Controlled by the Beckhoff algorithm. After reaching the set temperature, the PID controller is added. The optimally matched controller combinations enable fast and overshot- free control. • Small setpoint step-changes: Are controlled by a modified PID controller, which has been optimized to handle large dead times. TF8540 Version: 1.1.0 9
## Page 10

PLC temperature controller • Exact response to setpoint changes: To guarantee exact response to setpoint changes during production, other stabilization measures have been taken in addition to the PID controller, such as taking transport and friction energy into account. Other special features of the controller: • Support of common thermocouples and Pt sensors. • Error heating: Enables production even if the temperature sensor is defective. • Extruder compensation: Calculates the shear rate and material transport into the process value. • Zoning: Distribution of switch-on times within a PWM cycle avoids unnecessary power peaks. • Power control heating tapes: Measures and checks the heating power of the heating tapes. • I/O swap: If an input or output channel is defective, the operator can swap it from one channel to the other during operation. • The temperature controller handles all terminal communication, so the controller only needs to be parameterized. • Load and save routines are available for separate storage of product and machine data. • Various filter functions (e.g. HMI filter) are available. • Alarm handling functions are available. • The library monitors: the operating state of the terminals, the autotuning, whether the current temperature exceeds certain limits, whether there is an appropriate temperature change for the heating power output. Useful hints: • Sample program: see Knowledge Base at Commissioning [} 90]. • Commissioning instructions: see Knowledge Base [} 63]. • How do I include other functions (power measurement, scope functions, etc.): see Knowledge Base in the FAQs [} 80]. 3.2 Overview Function blocks in Temp.-Ctrl. Folder Name Description FB_Temp Ctrl Main Body_Tc Pfw [} 12] Framework function block to be called cyclically. FB_Temp Ctrl Enable Zone_Tc Pfw [} 15] Zones of temperature control are switched to active or passive state. FB_Temp Ctrl Stand By Zone_Tc Pfw [} 15] Zones of the temperature control are switched to standby or active state. FB_Temp Ctrl State_Tc Pfw [} 16] This function block determines a set of state information of a zone. FB_Temp Ctrl Callback_Tc Pfw [} 17] This function block checks the type of the linked terminal once and parameterizes it according to the specified sensor type. 10 Version: 1.1.0 TF8540
## Page 11

PLC temperature controller Utilities Name Description FB_Temp Ctrl Adapt Fm33xx_Tc Pfw [} 26] The I/O data of FM3312 or FM3332 fieldbus modules are adapted to the I/O structures of the library. FB_Temp Ctrl Clear Supply_Tc Pfw [} 27] The data of the supply groups of the temperature control are initialized. FB_Temp Ctrl Clear Zones_Tc Pfw [} 27] The data of the controller zones of the temperature control are initialized. FB_Term Coe Read_Tc Pfw [} 28] Function block is used for read access to EL terminals. FB_Term Coe Write_Tc Pfw [} 29] Function block is used for write access to EL terminals. FB_Term Reg Read_Tc Pfw [} 31] Function block is used for read access to KL terminals. FB_Term Reg Write_Tc Pfw [} 32] Function block is used for write access to KL terminals. FUN_Temp Ctrl Sensor Type Code_Tc Pfw The function returns the numerical translation for a textual sensor type. FUN_Temp Ctrl Sensor Type Name_Tc Pfw The function returns the textual translation for a numeric sensor type. Framework function blocks in the Stand Alone folder Name Description FB_Temp Param Load_Tc Pfw [} 24] This function block reads the parameters of a zone from a file. FB_Temp Param Save_Tc Pfw [} 21] This function block writes the parameters of a zone into a file. FB_Temp Param Save P_Tc Pfw [} 22] This function block writes the parameters of a zone into a file. Data types: Enumerations Name Description E_Tc Pfw_Tctrl Out Select [} 34] Identifiers for selecting the output signal of a zone of temperature control. E_Tc Pfw_Temp Sens Type [} 35] Identifiers for the supported types of temperature sensors. E_Tc Pfw_Terminal Type [} 36] Framework basics: Identifiers for the supported types of I/O terminals. Data types: Structure types Name Description ST_Tc Pfw_FM3332_Input [} 43] Such a structure contains the input data of a FM3312 or FM3332 fieldbus module. ST_Tc Pfw_Supply Param [} 57] Such a structure contains the parameters and runtime data of a supply group. ST_Tc Pfw_Temp Ctrl_Itf [} 58] State and activity of a zone of temperature control. ST_Tc Pfw_Temp Ctrl Input [} 39] Input data of a zone of temperature control. ST_Tc Pfw_Temp Ctrl Output [} 39] Output data of a zone of temperature control. ST_Tc Pfw_Temp Mparam From Hmi_Itf [} 45] Machine data of a zone of temperature control. ST_Tc Pfw_Temp Pparam From Hmi_Itf [} 54] Product data of a zone of temperature control. ST_Tc Pfw_Temp To Hmi_Itf [} 55] Visualization data of a zone of temperature control. TF8540 Version: 1.1.0 11
## Page 12

PLC temperature controller 3.3 Function blocks 3.3.1 FB_Temp Ctrl Main Body_Tc Pfw() This function block must be called in the application. It organizes internally the complete temperature control. Syntax VAR_INPUT Config Enable : BOOL; t Cycle : LREAL; Looptest_Enable: BOOL; Callback_Enable: BOOL; Simu_Enable : BOOL:=FALSE; Simu_Dis Charge : BOOL:=FALSE; END_VAR Inputs Name Type Description Config Enable BOOL If TRUE, the configuration is valid. t Cycle LREAL Cycle time Looptest_Enable BOOL A current measurement is performed. Callback_Enable BOOL Checks once (by calling FB_Temp Ctrl Callback_Tc Pfw()) the type of the linked terminal and parameterizes it according to the specified sensor type. Simu_Enable BOOL Used for internal simulation purposes. Simu_Dis Charge LREAL Used for internal simulation purposes. Behavior of the function block: With each call the function block checks the global variable b Pfw_Use Temp Control. If this variable is TRUE and Config Enable indicates a valid configuration, the function block becomes active: • In the first cycle the function block calls an internal function block of type FB_internal_tmp Ctrl Initlinks_Tc Pfw() to initialize the structures used by the temperature control. • If Looptest_Enable is set, a current measurement is performed. • If Callback_Enable is set, a function block of type FB_Temp Ctrl Callback_Tc Pfw() is called. This function block checks the type of the linked terminal once and parameterizes it according to the specified sensor type. • The following activities are performed for each zone of the control: If in aaa Pfw Temp Mparam From Hmi the Signal Update is set, the entered values are limited to the permissible value ranges if required and taken over into the control. Update is deleted. If in aaa Pfw Temp Pparam From Hmi the Signal Update is set, the entered values are limited to the permissible value ranges if required and taken over into the control. Update is deleted. If In Use is set to TRUE in aaa Pfw Temp To Hmi, the following steps are performed: - A FB_CTRL_Temp Controller() function block from the Tc Temp Ctrl. LIB library is called. - In out_Pfw Temp Ctrl Output YPWMPos, YPWMNeg, YDig Pos, YDig Neg and Yanalog are updated. - Various signals (aaa Temp Fault_Reset, Autotune in aaa Pfw Temp Mparam From Hmi etc.) control the resetting of fault conditions or activate autotuning. 12 Version: 1.1.0 TF8540
## Page 13

PLC temperature controller - If a problem is reported by the controller function block or from the I/O interface, the corresponding events are activated. - Various data in aaa Pfw Temp To Hmi are updated. • If the actual temperature of at least one zone is below f Absolute Low in aaa Pfw Temp Mparam From Hmi, aaa Temp Alarm_Absolute Low is signaled. • If the actual temperature of at least one zone is above f Absolute High in aaa Pfw Temp Pparam From Hmi, aaa Temp Alarm_Absolute High is signaled. At the end of the cycle aaa Temp Fault_Reset is automatically deleted. If Callback_Enable is not set, no function block of type FB_Temp Ctrl Callback_Tc Pfw() is called. In this case, the application must ensure that the I/O electronics match the sensor type. 3.3.2 FB_Temp Ctrl Main Body_Tc Pfw_TC3() This function block must be called cyclically in the application. It organizes internally the complete temperature control. Syntax VAR_INPUT i Param Load Check:I_Param Load Check; Config Enable : BOOL; t Cycle : LREAL; Looptest_Enable : BOOL; Callback_Enable : BOOL; Simu_Enable : BOOL:=FALSE; Simu_Dis Charge : BOOL:=FALSE; Scope_Temp Ctrl Variables: FB_Scope_Temp Ctrl Variables; END_VAR TF8540 Version: 1.1.0 13
## Page 14

PLC temperature controller Inputs Name Type Description i Param Load Check I_Param Load Check Optional interface for (external) storage of temperature zones. Config Enable BOOL If TRUE, the configuration is valid t Cycle LREAL Cycle time Looptest_Enable BOOL A current measurement is performed. Callback_Enable BOOL Checks once (by calling FB_Temp Ctrl Callback_Tc Pfw()) the type of the linked terminal and parameterizes it according to the specified sensor type. Simu_Enable BOOL Used for internal simulation purposes. Simu_Dis Charge BOOL Used for internal simulation purposes. Scope_Temp Ctrl Variables FB_Scope_Temp Ctrl Variables Display of the individual temperature zones and their internal variables. Behavior of the function block: With each call the function block checks the global variable b Pfw_Use Temp Control. If this variable is TRUE and Config Enable indicates a valid configuration, the function block becomes active: • In the first cycle the function block calls an internal function block of type FB_internal_tmp Ctrl Initlinks_Tc Pfw() to initialize the structures used by the temperature control. • If Looptest_Enable is set, a current measurement is performed. • If Callback_Enable is set, a function block of type FB_Temp Ctrl Callback_Tc Pfw() is called. This function block checks the type of the linked terminal once and parameterizes it according to the specified sensor type. • The following activities are performed for each zone of the control: ◦ If in aaa Pfw Temp Mparam From Hmi the Signal Update is set, the entered values are limited to the permissible value ranges if required and taken over into the control. Update is deleted. ◦ If in aaa Pfw Temp Pparam From Hmi the Signal Update is set, the entered values are limited to the permissible value ranges if required and taken over into the control. Update is deleted. ◦ If In Use is set to TRUE in aaa Pfw Temp To Hmi, the following steps are performed: - A FB_CTRL_Temp Controller() function block from the Tc Temp Ctrl. LIB library is called. - In out_Pfw Temp Ctrl Output YPWMPos, YPWMNeg, YDig Pos, YDig Neg and Yanalog are updated. - Various signals (aaa Temp Fault_Reset, Autotune in aaa Pfw Temp Mparam From Hmi etc.) control the resetting of fault conditions or activate autotuning. - If a problem is reported by the controller function block or from the I/O interface, the corresponding events are activated. - Various data in aaa Pfw Temp To Hmi are updated. • If the actual temperature of at least one zone is below f Absolute Low in aaa Pfw Temp Mparam From Hmi, aaa Temp Alarm_Absolute Low is signaled. • If the actual temperature of at least one zone is above f Absolute High in aaa Pfw Temp Pparam From Hmi, aaa Temp Alarm_Absolute High is signaled. At the end of the cycle aaa Temp Fault_Reset is automatically deleted. 14 Version: 1.1.0 TF8540
## Page 15

PLC temperature controller If Callback_Enable is not set, no function block of type FB_Temp Ctrl Callback_Tc Pfw() is called. In this case, the application must ensure that the I/O electronics match the sensor type. 3.3.3 FB_Temp Ctrl Enable Zone_Tc Pfw() One or more function blocks of this type are called from a function block of the application to switch individual zones, zone groups or all zones of the temperature control to the active or passive state. Syntax VAR_INPUT Module Id: INT:=-1; Zone Id : INT:=-1; Enable : BOOL:=TRUE; END_VAR Inputs Name Type Description Module Id INT Module Id of the temperature zones to be controlled. Zone Id INT Zone Id of the temperature zones to be controlled. Enable BOOL New state of the temperature zones. Behavior of the function block: • To control a zone in a group, both the Module Id and the Zone Id must be specified. • To control all zones in a group, the Module Id must be specified. The value 0 is used here as Zone Id. • To control all zones in all groups, use the value 0 for both Module Id and Zone Id. In the zone(s) selected in this way, ST_Tc Pfw_Temp Ctrl_Itf. Enable is updated with Enable. 3.3.4 FB_Temp Ctrl Stand By Zone_Tc Pfw() One or more function blocks of this type are called from a function block of the application to switch individual zones, zone groups or all zones of the temperature control into the standby or active state. Syntax VAR_INPUT Module Id : INT:=-1; Zone Id : INT:=-1; Stand By : BOOL:=TRUE; END_VAR TF8540 Version: 1.1.0 15
## Page 16

PLC temperature controller Inputs Name Type Description Module Id INT Module Id of the temperature zones to be controlled. Zone Id INT Zone Id of the temperature zones to be controlled. Stand By BOOL New state of the temperature zones. Behavior of the function block: • To control a zone in a group, both the Module Id and the Zone Id must be specified. • To control all zones in a group, the Module Id must be specified. The value 0 is used here as Zone Id. • To control all zones in all groups, use the value 0 for both Module Id and Zone Id. In the zone(s) selected in this way ST_Tc Pfw_Temp Ctrl_Itf. Sel Setpoint is updated with Stand By. 3.3.5 FB_Temp Ctrl State_Tc Pfw() This function block determines a set of state information of a zone. Syntax VAR_INPUT Module Id:INT:=-1; Zone Id:INT:=-1; END_VAR VAR_OUTPUT Disabled : BOOL; Enabled : BOOL; On Stand By : BOOL; Error : BOOL; Tuning : BOOL; Alarm_LL : BOOL; Alarm_L : BOOL; Alarm_H : BOOL; Alarm_HH : BOOL; Alarm_AL : BOOL; Alarm_AH : BOOL; Extruder Block : BOOL; Alarm_No Response : BOOL; END_VAR Inputs Name Type Description Module Id INT Module Id of the temperature zones to be controlled. Zone Id INT Zone Id of the temperature zones to be controlled. 16 Version: 1.1.0 TF8540
## Page 17

PLC temperature controller Outputs Name Type Description Disabled BOOL TRUE if the zone is not enabled. Enabled BOOL TRUE if the zone is enabled. On Stand By BOOL TRUE if the zone is enabled and switched to lowering. Error BOOL TRUE if the zone is in an error state. Tuning BOOL TRUE if the automatic tuning function of the zone is active. Alarm_LL BOOL TRUE if the actual temperature of the zone falls below the outer negative tolerance threshold. Alarm_L BOOL TRUE if the actual temperature of the zone falls below the inner negative tolerance threshold. Alarm_H BOOL TRUE if the actual temperature of the zone falls below the inner positive tolerance threshold. Alarm_HH BOOL TRUE if the actual temperature of the zone exceeds the outer positive tolerance threshold. Alarm_AL BOOL TRUE if the actual temperature of the zone falls below the negative absolute alarm threshold. Alarm_AH BOOL TRUE if the actual temperature of the zone exceeds the positive absolute alarm threshold. Extruder Block BOOL TRUE if the actual temperature of the zone falls below the negative absolute alarm threshold and this causes the extruder to shut down. Alarm_No Response BOOL TRUE if the actual temperature of the zone does not show an appropriate response to the heating power. Possible cause is, for example, an incorrectly mounted sensor or a defect in the heater that cannot be detected by other means. Behavior of the function block: In each cycle, the function block updates the state of one or more zones. Here, the behavior is determined in detail by the call: • If the function block is called with unknown Module Id>0 and/or an unknown Zone Id>0 or if aaa Pfw Temp To Hmi[..]. In Use=FALSE all outputs are FALSE. • If Module Id<>0 and Zone Id=0, the states of all zones of the module are ORed. • If Module Id<>0 and Zone Id<>0, the state of the selected zone is reported. 3.3.6 FB_Temp Ctrl Callback_Tc Pfw() This function block checks the type of the linked terminal once and parameterizes it according to the specified sensor type. Syntax VAR_INPUT t Cycle: LREAL; END_VAR Inputs Name Type Description t Cycle LREAL Cycle time TF8540 Version: 1.1.0 17
## Page 18

PLC temperature controller Behavior of the function block: By means of aaa Pfw Temp Mparam From Hmi[..]. Temp Sens Term the function block detects whether the I/O electronics used support register communication or acyclic Co E communication. If this is the case, the terminal type is read out from the module and checked. If the hardware type matches the software setting, the module is set to the sensor type specified in aaa Pfw Temp Mparam From Hmi[..]. Sensor Type. 3.3.7 FB_Fc Main Body_Tc Pfw() This function block must be called by the application after the Temp Ctrl_FB_Temp Ctrl Main Body_Tc Pfw. The function block organizes the intermittent switching on of the cooling independently of the controller output. Syntax VAR_INPUT Activate: BOOL; END_VAR VAR_IN_OUT Temp To Hmi : ST_Tc Pfw_Temp To Hmi_Itf; Temp Ctrl : ST_Tc Pfw_Temp Ctrl_Itf; Temp Out : ST_Tc Pfw_Temp Ctrl Output; Mparam : ST_Tc Pfw_Temp Mparam From Hmi_Itf; END_VAR VAR_OUTPUT Error : BOOL; Error ID : BOOL; (* not used yet *) END_VAR Inputs Name Type Description Activate BOOL Only with a TRUE the forced cooling is really output. Inputs/outputs Name Type Description Temp To Hmi ST_Tc Pfw_Temp To Hmi_Itf A reference to the data on the HMI of the zone must be provided here. Temp Ctrl ST_Tc Pfw_Temp Ctrl_Itf A reference to the runtime data of the zone must be provided here. Temp Out ST_Tc Pfw_Temp Ctrl Output A reference to the output interface of the zone must be provided here. Mparam ST_Tc Pfw_Temp Mparam From Hmi_Itf A reference to the machine parameters of the zone must be provided here. Outputs Name Type Description Error BOOL Indicates when something is misconfigured. Error ID BOOL Not used. 18 Version: 1.1.0 TF8540
## Page 19

PLC temperature controller Behavior of the function block: A prerequisite for proper functioning is that the zone is "In Use" and has cooling. Furthermore, fc_Enable must be enabled in the machine parameters of this zone and realistic times must have been set for the cooling time fc_On Time and the pause time fpwm Off Time. If the fpwm Off Time has expired, cooling becomes active for the time fc_On Time minus the cooling power already output. 3.4 Utilities 3.4.1 Stand Alone 3.4.1.1 FB_Power Measurement_Tc Pfw() This function block must be called in the application. It organizes internally the complete temperature control. Syntax VAR_INPUT p Power Input : POINTER TO BYTE; p Power Output : POINTER TO BYTE; st Power Ctrl : ST_Tc Pfw_Power Measurment_Ctrl; st Power Cfg : ST_Tc Pfw_Power Measurement_Cfg; f Cycle Time : LREAL:=0.025; END_VAR VAR_OUTPUT st Power State : ST_Tc Pfw_x L3403_State; END_VAR Inputs Name Type Description p Power Input POINTER TO BYTE Pointer to the input structure of the power measurement terminal. p Power Output POINTER TO BYTE Pointer to the output structure of the power measurement terminal. st Power Ctrl ST_Tc Pfw_Power Measurment_Ctrl Allows the current voltage to be read out separately. st Power Cfg ST_Tc Pfw_Power Measurement_Cfg Configuration of the power measurement terminal. f Cycle Time LREAL Transfer of the cycle time for this function block. Outputs Name Type Description st Power State ST_Tc Pfw_x L3403_State Here the current power, current and error states are reported back. TF8540 Version: 1.1.0 19
## Page 20

PLC temperature controller Behavior of the function block: This function block must be called cyclically by the application. The function block receives the mapping interface from the application as a pointer via p Power Input and p Power Output. Depending on the selected power measurement terminal in st Power Cfg the pointer addresses are interpreted. Depending on the supply line, the function block distributes the measured services to the individual Supply Lines. The pointer address and the stored terminal type must match at all times. Otherwise there will be wrong memory accesses. When measuring power with the EL3403, the increased filter time must also be taken into account. 3.4.1.2 FB_Fc Main Body_Tc Pfw() This function block must be called by the application after the Temp Ctrl_FB_Temp Ctrl Main Body_Tc Pfw. The function block organizes the intermittent switching on of the cooling independently of the controller output. Syntax VAR_INPUT Activate: BOOL; END_VAR VAR_IN_OUT Temp To Hmi: ST_Tc Pfw_Temp To Hmi_Itf; Temp Ctrl : ST_Tc Pfw_Temp Ctrl_Itf; Temp Out : ST_Tc Pfw_Temp Ctrl Output; Mparam : ST_Tc Pfw_Temp Mparam From Hmi_Itf; END_VAR VAR_OUTPUT Error : BOOL; Error ID : BOOL; (* not used yet *) END_VAR Inputs Name Type Description Activate BOOL Only with a TRUE the forced cooling is really output. Inputs/outputs Name Type Description Temp To Hmi ST_Tc Pfw_Temp To Hmi_Itf A reference to the data on the HMI of the zone must be provided here. Temp Ctrl ST_Tc Pfw_Temp Ctrl_Itf A reference to the runtime data of the zone must be provided here. Temp Out ST_Tc Pfw_Temp Ctrl Output A reference to the output interface of the zone must be provided here. Mparam ST_Tc Pfw_Temp Mparam From Hmi_Itf A reference to the machine parameters of the zone must be provided here. 20 Version: 1.1.0 TF8540
## Page 21

PLC temperature controller Outputs Name Type Description Error BOOL Indicates when something is misconfigured. Error ID BOOL Not used. Behavior of the function block: A prerequisite for proper functioning is that the zone is "In Use" and has cooling. Furthermore, fc_Enable must be enabled in the machine parameters of this zone and realistic times must have been set for the cooling time fc_On Time and the pause time fpwm Off Time. If the fpwm Off Time has expired, cooling becomes active for the time fc_On Time minus the cooling power already output. 3.4.1.3 FB_Temp Param Save_Tc Pfw() This function block writes the parameters of a zone into a file. A FB_Temp Param Load_Tc Pfw function block must be used to read the file. Instead of this function block, you can alternatively call a save via the Save Delay in the machine parameters, the product parameters or the Supply Lines. Syntax VAR_INPUT Execute : BOOL; Path Name : STRING(80); Pre Fix : STRING(20); END_VAR VAR_IN_OUT Mparam : ST_Tc Pfw_Temp Mparam From Hmi_Itf; Pparam : ST_Tc Pfw_Temp Pparam From Hmi_Itf; END_VAR VAR_OUT Done : BOOL; Error : BOOL; Error Id : DINT; s File Name : STRING(80); END_VAR Inputs Name Type Description Execute BOOL A rising edge at this input starts the process. With a FALSE at Execute all outputs are deleted. This ensures that they are present for at least one cycle. Path Name STRING The path name to be used must be provided here. Pre Fix STRING Prefix to be used before the filename. TF8540 Version: 1.1.0 21
## Page 22

PLC temperature controller Inputs/outputs Name Type Description Mparam ST_Tc Pfw_Temp Mparam From Hmi_Itf A reference to the machine parameters of the zone must be provided here. Pparam ST_Tc Pfw_Temp Pparam From Hmi_Itf A reference to the product parameters of the zone must be provided here. Outputs Name Type Description Done BOOL A TRUE indicates here the successful processing of the command. Error BOOL A TRUE indicates here the occurrence of a problem during the processing of the command. Error Id DINT If an error has occurred, coded information about the nature of the problem is provided here. s File Name STRING Name of the saved file. Behavior of the function block: On a rising edge at Execute, the function block forms a filename from Path Name, the textual name of the zone and STRING constants. Example: 'C:\Parameter\Tctrl_Zone1.par' is formed from Path Name:='C:\Parameter\' and Mparam. Zone Name:='Zone1'. The parameters are written in an encoded binary format that cannot be edited with a text editor. The coding makes the format largely insensitive to version differences. As a rule, files are readable even if they were written by older or younger versions of the library. NOTICE If the product parameters are to be saved independently of the machine data of the zone, one FB_Temp Param Save_Tc Pfw() function block and one FB_Temp Param Save P_Tc Pfw() function block must be used. To avoid mutual overwriting of files with the same name, the path names must be chosen differently. At system startup first the machine data and then the product parameters are to be loaded with FB_Temp Param Load_Tc Pfw() function blocks. NOTICE New parameters may be added when the version of the library is changed. These are filled with default values whose effect does not always produce the desired behavior. 3.4.1.4 FB_Temp Param Save P_Tc Pfw() This function block writes the product parameters of a zone into a file. A FB_Temp Param Load_Tc Pfw function block must be used to read the file. Syntax VAR_INPUT Execute : BOOL; Path Name: STRING(80); END_VAR 22 Version: 1.1.0 TF8540
## Page 23

PLC temperature controller VAR_IN_OUT Mparam : ST_Tc Pfw_Temp Mparam From Hmi_Itf; Pparam : ST_Tc Pfw_Temp Pparam From Hmi_Itf; END_VAR VAR_OUT Done : BOOL; Error : BOOL; Error Id : DINT; END_VAR Inputs Name Type Description Execute BOOL The process is initiated by a rising edge at this input. With a FALSE at Execute all outputs are deleted. This ensures that they are present for at least one cycle. Path Name STRING The path name to be used must be provided here. Inputs/outputs Name Type Description Mparam ST_Tc Pfw_Temp Mparam From Hmi_Itf A reference to the machine parameters of the zone must be provided here. Pparam ST_Tc Pfw_Temp Pparam From Hmi_Itf A reference to the product parameters of the zone must be provided here. Outputs Name Type Description Done BOOL A TRUE indicates here the successful processing of the command. Error BOOL A TRUE indicates here the occurrence of a problem during the processing of the command. Error Id BOOL If an error has occurred, coded information about the nature of the problem is provided here. Behavior of the function block: On a rising edge at Execute, the function block forms a filename from Path Name, the textual name of the zone and STRING constants. Example: 'C:\Parameter\Tctrl_Zone1.par' is formed from Path Name:='C:\Parameter\' and Mparam. Zone Name:='Zone1'. The parameters are written in an encoded binary format that cannot be edited with a text editor. The coding makes the format largely insensitive to version differences. As a rule, files are readable even if they were written by older or younger versions of the library. NOTICE If the product parameters are to be saved independently of the machine data of the zone, one FB_Temp Param Save_Tc Pfw() function block and one FB_Temp Param Save P_Tc Pfw() function block must be used. To avoid mutual overwriting of files with the same name, the path names must be chosen differently. At system startup first the machine data and then the product parameters are to be loaded with FB_Temp Param Load_Tc Pfw() function blocks. NOTICE New parameters may be added when the version of the library is changed. These are filled with default values whose effect does not always produce the desired behavior. TF8540 Version: 1.1.0 23
## Page 24

PLC temperature controller 3.4.1.5 FB_Temp Param Load_Tc Pfw() This function block reads the parameters of a zone from a file. For writing the file a FB_Temp Param Save_Tc Pfw function block must be used. Syntax VAR_INPUT Execute : BOOL; Path Name : STRING(80); Product Param :BOOL:=FALSE; END_VAR VAR_IN_OUT Mparam : ST_Tc Pfw_Temp Mparam From Hmi_Itf; Pparam : ST_Tc Pfw_Temp Pparam From Hmi_Itf; END_VAR VAR_OUT Done : BOOL; Error : BOOL; Error Id : DINT; END_VAR Inputs Name Type Description Execute BOOL The process is initiated by a rising edge at this input. With a FALSE at Execute all outputs are deleted. This ensures that they are present for at least one cycle. Path Name STRING The path name to be used must be provided here. Product Param BOOL If TRUE, the product data will be loaded. Inputs/outputs Name Type Description Mparam ST_Tc Pfw_Temp Mparam From Hmi_Itf A reference to the machine parameters of the zone must be provided here. Pparam ST_Tc Pfw_Temp Pparam From Hmi_Itf A reference to the product parameters of the zone must be provided here. Outputs Name Type Description Done BOOL A TRUE indicates here the successful processing of the command. Error BOOL A TRUE indicates here the occurrence of a problem during the processing of the command. Error Id DINT If an error has occurred, coded information about the nature of the problem is provided here. Behavior of the function block: On a rising edge at Execute, the function block forms a filename from Path Name, the textual name of the zone and STRING constants. 24 Version: 1.1.0 TF8540
## Page 25

PLC temperature controller Example: 'C:\Parameter\Tctrl_Zone1.par' is formed from Path Name:='C:\Parameter\' and Mparam. Zone Name:='Zone1'. The parameters are read in an encoded binary format that cannot be edited with a text editor. The coding makes the format largely insensitive to version differences. As a rule, files are readable even if they were written by older or younger versions of the library. NOTICE If the product parameters are to be saved independently of the machine data of the zone, one FB_Temp Param Save_Tc Pfw() function block and one FB_Temp Param Save P_Tc Pfw() function block must be used. To avoid mutual overwriting of files with the same name, the path names must be chosen differently. At system startup first the machine data and then the product parameters are to be loaded with FB_Temp Param Load_Tc Pfw() function blocks. NOTICE New parameters may be added when the version of the library is changed. These are filled with default values whose effect does not always produce the desired behavior. 3.4.2 FB_x L3403_Tc Pfw() This function block processes the data (voltage, line) determined by an x L3403 and makes it available to the application. The FB_Power Measurement_Tc Pfw() function block should be called by the application. This function block calls FB_x L3403_Tc Pfw() internally. Syntax VAR_INPUT I_ratio : LREAL:=1.0; Cycle Time : LREAL:=0.025; Read Voltage : BOOL:=FALSE; Using_EL : BOOL:=FALSE; END_VAR VAR_IN_OUT Input : ST_Tc Pfw_x L3403_Input; Output : ST_Tc Pfw_x L3403_Output; State : ST_Tc Pfw_x L3403_State; END_VAR Inputs Name Type Description I_ratio LREAL The ratio of the current transformers must be entered here. Cycle Time LREAL Cycle time with which this function block is called. Read Voltage BOOL A TRUE causes the currently measured voltage to be read out instead of the power. Using_EL BOOL A TRUE tells the function block that it is an EL terminal. TF8540 Version: 1.1.0 25
## Page 26

PLC temperature controller Inputs/outputs Name Type Description Input ST_Tc Pfw_x L3403_Input Provides the input data of the terminal. Output ST_Tc Pfw_x L3403_Output Provides the output data of the terminal. State ST_Tc Pfw_x L3403_State Returns the state of the terminal and the processed data to the application. Behavior of the function block: If the terminal does not report an error, the prepared input data are provided in each cycle. When measuring power with the EL3403, the increased filter time must also be taken into account. 3.4.3 FB_Temp Ctrl Adapt Fm33xx_Tc Pfw() The I/O data of FM3312 or FM3332 fieldbus modules are adapted to the I/O structures of the library. This function block must be called in the application. It organizes internally the complete temperature control. Syntax VAR_INPUT FM_Input : POINTER TO ST_Tc Pfw_FM3332_Input; Zone Idx : INT; First Fm Idx: INT; Last Fm Idx : INT; END_VAR VAR_OUTPUT Error : BOOL; END_VAR Inputs Name Type Description FM_Input POINTER TO The address of a single variable or an array of type ST_Tc Pfw_FM3332_Inpu ST_Tc Pfw_FM3332_Input. t Zone Idx INT The index of the zone to which the process image is to be assigned. First Fm Idx INT The first index of the process image provided as FM_Input. Last Fm Idx INT The last index of the process image provided as FM_Input. Outputs Name Type Description Error BOOL Any problems with call parameters or zone parameters are signaled here. 26 Version: 1.1.0 TF8540
## Page 27

PLC temperature controller Behavior of the function block: If one of the call parameters is outside the permissible range, this is reported with Error. Furthermore, Error is reported if the call parameters are correct but the addressed zone has an invalid setting in aaa Pfw Temp Mparam From Hmi[Zone Idx]. Term Channel in its parameters. Two modes can be used here: • If in FM_Input the address of the only ST_Tc Pfw_FM3332_Input process image of the application or within an array the address of the process image responsible for this zone is provided, the index (1..32) of the input in the process image must be specified as Term Channel. • If in FM_Input the address of the first ST_Tc Pfw_FM3332_Input process image of an array is provided, the index of the input in the process image array is to be specified as Term Channel. This index is 1..32 for the inputs of the first module, 33..64 for the inputs of the second module and so on. NOTICE The same image is used for modules with less than 32 inputs. The channels not implemented in the module's hardware then remain unused, but are counted when determining the input index as described above. Otherwise the data of the ST_Tc Pfw_FM3332_Input process image is converted to the ST_Tc Pfw_Temp Ctrl Input process image of the zone: • The process value for the actual temperature is compatible and is copied. • An EL_Sns Wc State for connection monitoring is derived from the Dp State. • The bit in Open Circuit[..] belonging to the measuring channel is mapped as SNS_Overrange bit in KL_Sns State. • The bit in Backvoltage[..] belonging to the measuring channel is mapped as SNS_General Error bit in KL_Sns State. 3.4.4 FB_Temp Ctrl Clear Supply_Tc Pfw() A function block of this type must be called once in the initialization phase of the application before the parameters are provided. The function block initializes the data of the supply groups of the temperature control. 3.4.5 FB_Temp Ctrl Clear Zones_Tc Pfw() A function block of this type must be called once in the initialization phase of the application before the parameters are provided. The function block initializes the data of all zones of the temperature control: • aaa Pfw Temp Pparam From Hmi • aaa Pfw Temp Mparam From Hmi • aaa Pfw Temp To Hmi • aaa Temp Ctrl • out_Pfw Temp Ctrl Output TF8540 Version: 1.1.0 27
## Page 28

PLC temperature controller 3.4.6 FB_Term Coe Read_Tc Pfw() A function block of this type is used by FB_Temp Ctrl Callback_Tc Pfw for read access to EL terminals. Syntax VAR_INPUT Execute : BOOL; Term Type : E_Tc Pfw_Terminal Type:=e Tc Pfw Term T_No Terminal; Pdata : POINTER TO BYTE:=0; Byte Count : BYTE:=0; Index : WORD:=0; Subindex : BYTE:=0; END_VAR VAR_IN_OUT Temp In : ST_Tc Pfw_Temp Ctrl Input; END_VAR VAR_OUTPUT Busy : BOOL:=FALSE; Done : BOOL:=FALSE; Command Aborted: BOOL:=FALSE; Error : BOOL:=FALSE; Error ID : UDINT:=0; END_VAR Inputs Name Type Description Execute BOOL A rising edge starts the process. A falling edge clears all outputs. Term Type E_Tc Pfw_Terminal The coded type of the addressed terminal. Type Pdata POINTER TO The destination address for the read data. BYTE Byte Count BYTE The size of the data to be read in bytes. Index WORD The Co E address according to the object directory of the terminal. Subindex BYTE The Co E address according to the object directory of the terminal. Inputs/outputs Name Type Description Temp In ST_Tc Pfw_Temp Ctrl Input The input process image of the terminal. Outputs Name Type Description Busy BOOL The ongoing activity of the function block is signaled here. Done BOOL The successful completion of the operation is reported here. Command Aborted BOOL A TRUE indicates here that the process was aborted. Error BOOL A TRUE indicates here the occurrence of a problem. Error ID UDINT In the event of an error, coded information is provided here. 28 Version: 1.1.0 TF8540
## Page 29

PLC temperature controller Behavior of the function block: A rising edge at Execute causes the function block to perform a series of checks. • The subindex must be in the range 0 to 127 (inclusive). • Byte Count must be greater than 0. • Pdata must not be 0. • Term Type must identify an EL terminal. Only these support the Co E communication mechanism used here. If one of the above conditions is not met, an error is reported. Otherwise, the access is transmitted to the terminal. The result of the transmission is provided at the outputs. In addition to the above-mentioned error possibilities, problems can occur during transmission. Furthermore, the terminal can report a problem (addressing, values, access type). A Co E access requires that ST_Tc Pfw_Temp Ctrl Input. EL_Ads Addr is linked. 3.4.7 FB_Term Coe Write_Tc Pfw() A function block of this type is used by FB_Temp Ctrl Callback_Tc Pfw for write access to EL terminals. Syntax VAR_INPUT Execute : BOOL; Term Type : Tc Pfw_Terminal Type:=e Tc Pfw Term T_No Terminal; Pdata : POINTER TO BYTE:=0; Byte Count : BYTE:=0; Index : WORD:=0; Subindex : BYTE:=0; END_VAR VAR_IN_OUT Temp In : ST_Tc Pfw_Temp Ctrl Input; END_VAR VAR_OUTPUT Busy : BOOL:=FALSE; Done : BOOL:=FALSE; Command Aborted: BOOL:=FALSE; Error : BOOL:=FALSE; Error ID : UDINT:=0; END_VAR TF8540 Version: 1.1.0 29
## Page 30

PLC temperature controller Inputs Name Type Description Execute BOOL A rising edge starts the process. A falling edge clears all outputs. Term Type _Tc Pfw_Terminal T The coded type of the addressed terminal. ype Pdata POINTER TO The destination address for the read data. BYTE Byte Count BYTE The size of the data to be read in bytes. Index WORD The Co E address according to the object directory of the terminal. Subindex BYTE The Co E address according to the object directory of the terminal. Inputs/outputs Name Type Description Temp In ST_Tc Pfw_Temp Ctrl Input The input process image of the terminal. Outputs Name Type Description Busy BOOL The ongoing activity of the function block is signaled here. Done BOOL The successful completion of the operation is reported here. Command Aborted BOOL A TRUE indicates here that the process was aborted. Error BOOL A TRUE indicates here the occurrence of a problem. Error ID UDINT In the event of an error, coded information is provided here. Behavior of the function block: A rising edge at Execute causes the function block to perform a series of checks: • The subindex must be in the range 0 to 127 (inclusive). • Byte Count must be greater than 0. • Pdata must not be 0. • Term Type must identify an EL terminal. Only these support the Co E communication mechanism used here. If one of the above conditions is not met, an error is reported. Otherwise, the access is transmitted to the terminal. The result of the transmission is provided at the outputs. In addition to the above-mentioned error possibilities, problems can occur during transmission. Furthermore, the terminal can report a problem (addressing, values, access type). A Co E access requires that ST_Tc Pfw_Temp Ctrl Input. EL_Ads Addr is linked. 30 Version: 1.1.0 TF8540
## Page 31

PLC temperature controller 3.4.8 FB_Term Reg Read_Tc Pfw() A function block of this type is used by FB_Temp Ctrl Callback_Tc Pfw for read access to EL terminals. Syntax VAR_INPUT Execute : BOOL; Term Type : E_Tc Pfw_Terminal Type:=e Tc Pfw Term T_No Terminal; Select : INT:=-1; Cycle Time : LREAL:=0.025; END_VAR VAR_IN_OUT Ctrl : USINT; State : USINT; In Data : INT; Out Data : INT; END_VAR VAR_OUTPUT Reg Data : WORD:=0; Busy : BOOL:=FALSE; Done : BOOL:=FALSE; Command Aborted: BOOL:=FALSE; Error : BOOL:=FALSE; Error ID : UDINT:=0; END_VAR Inputs Name Type Description Execute BOOL A rising edge starts the process. A falling edge clears all outputs. Term Type E_Tc Pfw_Terminal The coded type of the addressed terminal. Type Select INT The register address of the terminal. Cycle Time LREAL The cycle time of the calling task. Inputs/outputs Name Type Description Ctrl USINT A reference to ST_Tc Pfw_Temp Ctrl Output. KL_Sns Ctrl of the terminal. State USINT A reference to ST_Tc Pfw_Temp Ctrl Input. KL_Sns State of the terminal. In Data INT A reference to ST_Tc Pfw_Temp Ctrl Input. KL_Sns Data of the terminal. Out Data INT A reference to ST_Tc Pfw_Temp Ctrl Output. KL_Sns Data of the terminal. TF8540 Version: 1.1.0 31
## Page 32

PLC temperature controller Outputs Name Type Description Reg Data WORD If successfully executed, the read register content is provided here. Busy BOOL The ongoing activity of the function block is signaled here. Done BOOL The successful completion of the operation is reported here. Command Aborted BOOL A TRUE indicates here that the process was aborted. Error BOOL A TRUE indicates here the occurrence of a problem. Error ID UDINT In the event of an error, coded information is provided here. Behavior of the function block: A rising edge at Execute causes the function block to perform a series of checks: • Select must be in the range 0 to 63 (inclusive). • No other register communication must be active with this terminal. • Term Type must identify a KL terminal. Only these support the communication mechanism used here. If one of the above conditions is not met, an error is reported. Otherwise, the access is transmitted to the terminal. The result of the transmission is provided at the outputs. In addition to the above-mentioned error possibilities, problems can occur during transmission. Furthermore, the terminal can report a problem (addressing, values, access type). A register access requires that all elements with name beginning with "KL_" in ST_Tc Pfw_Temp Ctrl Input are linked. 3.4.9 FB_Term Reg Write_Tc Pfw() A function block of this type is used by FB_Temp Ctrl Callback_Tc Pfw for write access to KL terminals. Syntax VAR_INPUT Execute : BOOL; Term Type : E_Tc Pfw_Terminal Type:=e Tc Pfw Term T_No Terminal; Select : INT:=-1; Reg Data : WORD:=0; Cycle Time : LREAL:=0.01; END_VAR VAR_IN_OUT Ctrl : USINT; State : USINT; In Data : INT; Out Data : INT; END_VAR VAR_OUTPUT Busy : BOOL:=FALSE; Done : BOOL:=FALSE; Command Aborted :BOOL:=FALSE; 32 Version: 1.1.0 TF8540
## Page 33

PLC temperature controller Error: BOOL :=FALSE; Error ID : UDINT:=0; END_VAR Inputs Name Type Description Execute BOOL A rising edge starts the process. A falling edge clears all outputs. Term Type E_Tc Pfw_Terminal The coded type of the addressed terminal. Type Select INT The register address of the terminal. Reg Data WORD The register content to be written is to be provided here. Cycle Time LREAL The cycle time of the calling task. Inputs/outputs Name Type Description Ctrl USINT A reference to ST_Tc Pfw_Temp Ctrl Output. KL_Sns Ctrl of the terminal. State USINT A reference to ST_Tc Pfw_Temp Ctrl Input. KL_Sns State of the terminal. In Data INT A reference to ST_Tc Pfw_Temp Ctrl Input. KL_Sns Data of the terminal. Out Data INT A reference to ST_Tc Pfw_Temp Ctrl Output. KL_Sns Data of the terminal. Outputs Name Type Description Busy BOOL The ongoing activity of the function block is signaled here. Done BOOL The successful completion of the operation is reported here. Command Aborted BOOL A TRUE indicates here that the process was aborted. Error BOOL A TRUE indicates here the occurrence of a problem. Error ID UDINT In the event of an error, coded information is provided here. Behavior of the function block: A rising edge at Execute causes the function block to perform a series of checks: • Select must be in the range 0 to 63 (inclusive). • No other register communication must be active with this terminal. • Term Type must identify a KL terminal. Only these support the communication mechanism used here. If one of the above conditions is not met, an error is reported. Otherwise, the access is transmitted to the terminal. The result of the transmission is provided at the outputs. In addition to the above-mentioned error possibilities, problems can occur during transmission. Furthermore, the terminal can report a problem (addressing, values, access type). A register access requires that all elements with name beginning with "KL_" in ST_Tc Pfw_Temp Ctrl Input are linked. TF8540 Version: 1.1.0 33
## Page 34

PLC temperature controller 3.5 Enumerations 3.5.1 E_Tc Pfw_Tctrl Power Terminal This enumeration defines identifiers for the supported types of I/O terminals. These identifiers are used in ST_Tc Pfw_Power Measurement_Cfg. Syntax TYPE E_Tc Pfw_Tctrl Power Terminal: (* last modification: 16.03.2009 *) ( No Terminal, KL3403, EL3403, EL3773, EL3x64, EL3413, EL3443, EL3446, EL3453, Simulation:=1000, Customized:=10000 ); END_TYPE Values Name Description No Terminal No power measurement terminal connected. KL3403 Bus Terminal, 3-channel analog input, power measurement, 500 V AC, 1 A, 16 bit EL3403 Ether CAT Terminal, 3-channel analog input, power measurement, 500 V AC, 1 A, 16 bit EL3773 Ether CAT Terminal, 3-channel analog input, multi-function, 500 V AC/DC, 1 A, 16 bit, 10 ksps, oversampling EL3x64 EL3064 - Ether CAT Terminal, 4-channel analog input, voltage, 0...10 V, 12 bit, single- ended EL3164 - Ether CAT Terminal, 4-channel analog input, voltage, 0...10 V, 16 bit, single- ended EL3413 Ether CAT Terminal, 3-channel analog input, power measurement, 690 V AC, 1/5 A, 16 bit, electrically isolated EL3443 Ether CAT Terminal, 3-channel analog input, power measurement, 480 V AC/DC, 1 A, 24 bit EL3446 Ether CAT Terminal, 6-channel analog input, current, 1 A, 24 bit, distributed power measurement EL3453 Ether CAT Terminal, 3-channel analog input, power measurement, 690 V AC, 0.1/1/5 A, 24 bit, electrically isolated Simulation Power measurement via simulation. Customized Lower limit of the customer-specific range. 3.5.2 E_Tc Pfw_Tctrl Out Select This enumeration defines identifiers for selecting the output signal of a zone of temperature control. These identifiers are used in ST_Tc Pfw_Temp Mparam From Hmi_Itf. Syntax TYPE E_Tc Pfw_Tctrl Out Select: (* last modification: xx.xx.200x *) ( e Tc Pfw Tc Out_No Signal, e Tc Pfw Tc Out_PWM, e Tc Pfw Tc Out_Sign, 34 Version: 1.1.0 TF8540
## Page 35

PLC temperature controller e Tc Pfw Tc Out_2step ); END_TYPE Values Name Description e Tc Pfw Tc Out_No Signal None of the output signals is selected. e Tc Pfw Tc Out_PWM The PWM signal derived from the PID controller response is selected. e Tc Pfw Tc Out_Sign A switching signal is selected which is derived from the sign of the controller output. e Tc Pfw Tc Out_2step A switching signal is selected that is formed by an on-off controller (Schmitt trigger) from the control deviation. 3.5.3 E_Tc Pfw_Temp Sens Type This enumeration defines identifiers for the supported types of temperature sensors. These identifiers are used in ST_Tc Pfw_Temp Mparam From Hmi_Itf. Syntax TYPE E_Tc Pfw_Temp Sens Type: ( e Tc Pfw Temp Sens T_No Sensor, e Tc Pfw Temp Sens T_TC_B, e Tc Pfw Temp Sens T_TC_E, e Tc Pfw Temp Sens T_TC_J, e Tc Pfw Temp Sens T_TC_K, e Tc Pfw Temp Sens T_TC_L, e Tc Pfw Temp Sens T_TC_N, e Tc Pfw Temp Sens T_TC_R, e Tc Pfw Temp Sens T_TC_S, e Tc Pfw Temp Sens T_TC_T, e Tc Pfw Temp Sens T_TC_U, e Tc Pfw Temp Sens T_TC_C, e Tc Pfw Temp Sens T_PT_100:=100, e Tc Pfw Temp Sens T_NI_100, e Tc Pfw Temp Sens T_NI_120, e Tc Pfw Temp Sens T_PT_200, e Tc Pfw Temp Sens T_PT_500, e Tc Pfw Temp Sens T_PT_1000, e Tc Pfw Temp Sens T_NI_1000, e Tc Pfw Temps T_Customized:=10000 ); END_TYPE TF8540 Version: 1.1.0 35
## Page 36

PLC temperature controller Values Name Description e Tc Pfw Temp Sens T_No Sensor This identifier appears in the configuration of unused temperature controller zones. e Tc Pfw Temp Sens T_TC_B Type B sensor: 600 °C to 1800 °C e Tc Pfw Temp Sens T_TC_E Type E sensor: -100 °C to 1000 °C e Tc Pfw Temp Sens T_TC_J Type J sensor: -100 °C to 1200 °C e Tc Pfw Temp Sens T_TC_K Type K sensor: -100 °C to 1370 °C e Tc Pfw Temp Sens T_TC_L Type L sensor: -25 °C to 900 °C e Tc Pfw Temp Sens T_TC_N Type N sensor: -100 °C to 1300 °C e Tc Pfw Temp Sens T_TC_R Type R sensor: 0 °C to 1700 °C e Tc Pfw Temp Sens T_TC_S Type S sensor: 0 °C to 1700 °C e Tc Pfw Temp Sens T_TC_T Type T sensor: -100 °C to 400 °C e Tc Pfw Temp Sens T_TC_U Type U sensor: -25 °C to 600 °C e Tc Pfw Temp Sens T_TC_C Type C sensor: 0 °C to 2320 °C e Tc Pfw Temp Sens T_PT_100 PT100 sensor: -200 °C to 850 °C e Tc Pfw Temp Sens T_NI_100 NI100 sensor: -60 °C to 250 °C. e Tc Pfw Temp Sens T_NI_120 NI120 sensor: -60 °C to 320 °C. e Tc Pfw Temp Sens T_PT_200 PT200 sensor: -200 °C to 850 °C e Tc Pfw Temp Sens T_PT_500 PT500 sensor: -200 °C to 850 °C e Tc Pfw Temp Sens T_PT_1000 PT1000 sensor: -200 °C to 850 °C e Tc Pfw Temp Sens T_NI_1000 NI1000 sensor: -60 °C to 250 °C e Tc Pfw Temps T_Customized These and all higher numerical values mark application-specific temperature sensors. 3.5.4 E_Tc Pfw_Terminal Type This enumeration defines identifiers for the supported types of I/O terminals. These identifiers are used in ST_Tc Pfw_Temp Mparam From Hmi_Itf. Syntax TYPE E_Tc Pfw_Terminal Type: ( e Tc Pfw Term T_No Terminal, e Tc Pfw Term T_KL_Range Low:=1000, e Tc Pfw Term T_KL300x, (* +/-10V *) e Tc Pfw Term T_KL301x, (* 0..20m A *) e Tc Pfw Term T_KL302x, (* 4..20m A *) e Tc Pfw Term T_KL304x, (* 0..20m A *) e Tc Pfw Term T_KL305x, (* 4..20m A *) e Tc Pfw Term T_KL306x, (* 0..10V *) e Tc Pfw Term T_KL310x, (* +/-10V *) e Tc Pfw Term T_KL311x, (* 0..20m A *) e Tc Pfw Term T_KL312x, (* 4..20m A *) e Tc Pfw Term T_KL313x, (* +/-10V *) e Tc Pfw Term T_KL314x, (* 0..20m A *) e Tc Pfw Term T_KL315x, (* 4..20m A *) e Tc Pfw Term T_KL317x, (* 0..2V *) e Tc Pfw Term T_KL318x, (* +/-2V *) e Tc Pfw Term T_KL340x, (* +/-10V *) e Tc Pfw Term T_KL344x, (* 0..20m A *) e Tc Pfw Term T_KL346x, (* 0..10V *) e Tc Pfw Term T_KL331x, (* thermo couple *) e Tc Pfw Term T_KL_Range High, e Tc Pfw Term T_EL_Range Low:=2000, e Tc Pfw Term T_EL331x, (* thermo couple *) e Tc Pfw Term T_EL320x, (* PT100/PT1000 *) e Tc Pfw Term T_EL321x, (* PT100/PT1000 *) e Tc Pfw Term T_EL316x, (* 0..10V *) e Tc Pfw Term T_EL312x, (* 4..20m A *) 36 Version: 1.1.0 TF8540
## Page 37

PLC temperature controller e Tc Pfw Term T_EL331x_0010, (* thermo couple high resolution*) e Tc Pfw Term T_EL3751, (* multi-function input *) e Tc Pfw Term T_EL_Range High, e Tc Pfw Term T_XX_Range Low:=3000, e Tc Pfw Term T_FM33xx, (* thermo couple *) e Tc Pfw Term T_EM8908, (* multi signal backplane *) e Tc Pfw Term T_XX_Range High, e Tc Pfw Term T_Customized:=10000 ); END_TYPE TF8540 Version: 1.1.0 37
## Page 38

PLC temperature controller Values Name Description e Tc Pfw Term T_No Sensor No I/O electronics available, the zone is operated in simulation. e Tc Pfw Term T_KL_Range Low Lower limit of identifiers for K-bus terminals. e Tc Pfw Term T_KL300x K-bus terminals for connection of 1 or 2 ±10 V signals. e Tc Pfw Term T_KL301x K-bus terminals for connection of 1 or 2 0..20 m A signals. e Tc Pfw Term T_KL302x K-bus terminals for connection of 1 or 2 4..20 m A signals. e Tc Pfw Term T_KL304x K-bus terminals for connection of 1, 2 or 4 0..20 m A signals. e Tc Pfw Term T_KL305x K-bus terminals for connection of 1, 2 or 4 4..20 m A signals. e Tc Pfw Term T_KL306x K-bus terminals for connection of 1, 2 or 4 0..10 V signals. e Tc Pfw Term T_KL310x K-bus terminals for connection of 2 ±10 V signals. e Tc Pfw Term T_KL311x K-bus terminals for connection of 2 0..20 m A signals. e Tc Pfw Term T_KL312x K-bus terminals for connection of 2 4..20 m A signals. e Tc Pfw Term T_KL313x K-bus terminals for connection of 2 ±10 V signals. e Tc Pfw Term T_KL314x K-bus terminals for connection of 2 0..20 m A signals. e Tc Pfw Term T_KL315x K-bus terminals for connection of 2 4..20 m A signals. e Tc Pfw Term T_KL317x K-bus terminals for connection of 2 0..2 V signals. e Tc Pfw Term T_KL318x K-bus terminals for connection of 2 ±2 V signals. e Tc Pfw Term T_KL340x K-bus terminals for connection of 4 or 8 ±10 V signals. e Tc Pfw Term T_KL344x K-bus terminals for connection of 4 or 8 0..20 m A signals. e Tc Pfw Term T_KL346x K-bus terminals for connection of 4 or 8 0..10 V signals. e Tc Pfw Term T_KL331x K-bus terminals for direct connection of 1, 2 or 4 thermocouples. e Tc Pfw Term T_KL_Range High Upper limit of identifiers for K-bus terminals. e Tc Pfw Term T_EL_Range Low Lower limit of identifiers for Ether CAT Terminals. e Tc Pfw Term T_EL3751 Ether CAT Terminals for the connection of analog inputs with multi- functional input e Tc Pfw Term T_EL331x Ether CAT Terminals for direct connection of 1, 2 or 4 thermocouples. e Tc Pfw Term T_EL331x_0010 Ether CAT Terminals for direct connection of up to 4 thermocouples. e Tc Pfw Term T_EL320x Ether CAT Terminals for direct connection of PT100 or PT1000 sensors. e Tc Pfw Term T_EL321x Ether CAT Terminals for direct connection of PT100 or PT1000 sensors. e Tc Pfw Term T_EL316x Ether CAT Terminals for the connection of analog inputs of 0..10 V signals. e Tc Pfw Term T_EL312x Ether CAT Terminals for the connection of analog inputs of 4..20 m A signals. e Tc Pfw Term T_EL_Range High Upper limit of identifiers for Ether CAT Terminals. e Tc Pfw Term T_XX_Range Low Lower limit of identifiers for other modules. e Tc Pfw Term T_FM33xx Profibus module for the direct connection of 12 or 32 thermocouples. An adjustment function block must be called. e Tc Pfw Term T_EM8908 I/O board for injection molding machines. e Tc Pfw Term T_XX_Range High Upper limit of identifiers for other modules. e Tc Pfw Term T_Customized Selection if an unsupported terminal is implemented in the application. The internal checks carried out in the library are bypassed and the settings must be made manually. 38 Version: 1.1.0 TF8540
## Page 39

PLC temperature controller 3.6 Structures 3.6.1 Mapping 3.6.1.1 ST_Tc Pfw_Temp Ctrl Output This structure contains the output data of a zone for the I/O link. NOTICE The link established with the System Manager to the I/O terminal variables must match the type set in aaa Pfw Temp Mparam From Hmi[..]. Temp Sens Term. Syntax TYPE ST_Tc Pfw_Temp Ctrl Output : (* last modification: 15.07.2008 *) STRUCT (* ========================================== temperature zone output data see cnv_Temp Ctrl Output_Tc Pfw for format definition ========================================== *) Htr_Analog : INT; KL_Sns Data : INT; KL_Sns Ctrl : USINT; Htr_Pwm Pos : BOOL; Htr_Pwm Neg : BOOL; Htr_Dig Pos : BOOL; Htr_Dig Neg : BOOL; Sel Out Neg : BOOL; Sel Out Pos : BOOL; No High Alarm: BOOL; END_STRUCT END_TYPE Parameter Name Type Description Htr_Analog INT The power demand of the zone as an integer number in the range ±32767. KL_Sns Data INT When using a terminal from the KL331x type family, the "Data Off" process value must be linked here. This connection is used for register communication. KL_Sns Ctrl USINT When using a terminal from the KL331x type family, the "Control" process value must be linked here. This connection is used for register communication. Htr_Pwm Pos BOOL The PWM heating signal. Should not be used anymore, please use Sel Out Neg instead. Htr_Pwm Neg BOOL The PWM cooling signal. Should not be used anymore, please use Sel Out Pos instead. Htr_Dig Pos BOOL The digital heating signal. Should not be used anymore, please use Sel Out Neg instead. Htr_Dig Neg BOOL The digital cooling signal. Should not be used anymore, please use Sel Out Pos instead. Sel Out Neg BOOL The cooling signal selected by aaa Pfw Temp Mparam From Hmi[..]. Output Sel_C. Sel Out Pos BOOL The heating signal selected by aaa Pfw Temp Mparam From Hmi[..]. Output Sel_H. No High Alarm BOOL This output is TRUE as long as the temperature of the zone does not exceed the threshold aaa Pfw Temp Mparam From Hmi[..]. Absolute High. 3.6.1.2 ST_Tc Pfw_Temp Ctrl Input This structure contains the input data of a zone for the I/O link. TF8540 Version: 1.1.0 39
## Page 40

PLC temperature controller NOTICE The link established with the System Manager to the I/O terminal variables must match the type set in aaa Pfw Temp Mparam From Hmi[..]. Temp Sens Term. Syntax TYPE ST_Tc Pfw_Temp Ctrl Input : (* last modification: 11.01.2008 *) STRUCT (* ========================================== temperature zone input data see cnv_Temp Ctrl Input_Tc Pfw for format definition ========================================== *) KL_Sns Data : INT; EL_Sns Data : INT; EL_Sns State : UINT; KL_Sns State : USINT; EL_Sns Underrun : BOOL; EL_Sns Overrun : BOOL; EL_Sns Error : BOOL; EL_Sns Wc State : BOOL; EL_Ads Addr : ST_Tc Pfw_Ads Addr; END_STRUCT END_TYPE Parameter Name Type Description KL_Sns Data INT When using a terminal from the KL331x type family, the "Data On" process value must be linked here. This connection is used to determine the actual temperature and for register communication. EL_Sns Data INT When using a terminal from the EL331x type family, the "State" process value must be linked here. This connection is used to determine the actual temperature. EL_Sns State UINT When using a terminal from the EL331x type family, the "State" process value must be linked here. This connection is used for monitoring the terminal operating state. KL_Sns State USINT When using a terminal from the KL331x type family, the "State" process value must be linked here. This connection is used for diagnostics and for register communication. EL_Sns Underrun BOOL When using a terminal from the EL331x type family, the "Underrange" signal must be linked here. This connection is used for diagnostics. EL_Sns Overrun BOOL When using a terminal from the EL331x type family, the "Overrange" signal must be linked here. This connection is used for diagnostics. EL_Sns Error BOOL When using a terminal from the EL331x type family, the "Error" signal must be linked here. This connection is used for diagnostics. EL_Sns Wc State BOOL When using a terminal from the EL331x type family, the "Wc State" process value must be linked here. This connection is used for connection monitoring. EL_Ads Addr ST_Tc Pfw_Ads Addr When using a terminal from the EL331x type family, the "Ads Addr" process value must be linked here. This connection is used for Co E communication. 40 Version: 1.1.0 TF8540
## Page 41

PLC temperature controller 3.6.1.3 Power measurement 3.6.1.3.1 ST_Tc Pfw_EL3773_Input Such a structure contains the input data for power measurement. Syntax TYPE ST_Tc Pfw_EL3773_Input: (* location Pfw Lib_Temp Control. PRO *) (* last modification: 08.09.2010 *) STRUCT ui Status U1 : UINT; i Voltage U1 : ARRAY[1..cn Oversampling] OF INT; ui Status U2 : UINT; i Voltage U2 : ARRAY[1..cn Oversampling] OF INT; ui Status U3 : UINT; i Voltage U3 : ARRAY[1..cn Oversampling] OF INT; ui Status I1 : UINT; i Current I1 : ARRAY[1..cn Oversampling] OF INT; ui Status I2 : UINT; i Current I2 : ARRAY[1..cn Oversampling] OF INT; ui Status I3 : UINT; i Current I3 : ARRAY[1..cn Oversampling] OF INT; Sample Count : UINT; Wc State : BOOL; Input Toggle : BOOL; State : UINT; Dc Output Shift: UDINT; Dc Input Shift : UDINT; Ads Addr : ST_Tc Pfw_Ads Addr; END_STRUCT END_TYPE TF8540 Version: 1.1.0 41
## Page 42

PLC temperature controller Parameter Name Type Description ui Status U1 UINT Status of the first voltage channel i Voltage U1 ARRAY Voltage of the first channel ui Status U2 UINT Status of the second voltage channel i Voltage U2 ARRAY Voltage of the second channel ui Status U3 UINT Status of the third voltage channel i Voltage U3 ARRAY Voltage of the third channel ui Status I1 UINT Status of the first current channel i Current I1 ARRAY Current value of the first current channel ui Status I2 UINT Status of the second current channel i Current I2 ARRAY Current value of the second current channel ui Status I3 UINT Status of the third current channel i Current I3 ARRAY Current value of the third current channel Sample Count UINT The Sample Counter is incremented by one unit with each process data cycle. The Cycle Counter enables the higher- level controller to check whether a data record has possibly been omitted or transmitted twice. In that case the DC shift time of the terminal usually has to be adapted. Wc State BOOL Must be linked to the "Wc State" variable of the EL terminal. This is used to detect whether the process data coming from the terminal are OK. Input Toggle BOOL The variable Input Toggle indicates whether a new valid telegram was received. The value is incremented by one after each successful cycle. State UINT Must be linked to the "State" variable of the EL terminal. This is used to return the current state of the terminal. Dc Output Shift UDINT Dc Output Shift is the time for the output of the process data to the drive, i.e. for the time delay between the calculation and the effect of these data. Dc Input Shift UDINT Dc Input Shift is the time required to transmit status information, such as the actual position of a drive, to the controller. In other words, it is the time between the acquisition and the evaluation of these data. Ads Addr ST_Tc Pfw_Ads Addr When using the EL3773 terminal, the process value "Ads Addr" must be linked here. This connection is used for Co E communication. 3.6.1.3.2 ST_Tc Pfw_x L3403_Input Such a structure contains the input data for power measurement. Syntax TYPE ST_Tc Pfw_x L3403_Input: (* location Pfw Lib_Temp Control. PRO *) (* last modification: 08.09.2010 *) STRUCT KL_Data In : ARRAY[1..3] OF INT; KL_State : ARRAY[1..3] OF USINT; EL_Current : ARRAY[1..3] OF DINT; EL_Voltage : ARRAY[1..3] OF DINT; EL_Power : ARRAY[1..3] OF DINT; EL_No Zero Cross : ARRAY[1..3] OF BOOL; EL_Wc State : BOOL; EL_State : UINT; 42 Version: 1.1.0 TF8540
## Page 43

PLC temperature controller EL_Ads Addr : ST_Tc Pfw_Ads Addr; END_STRUCT END_TYPE Parameter Name Type Description KL_Data In ARRAY OF INT Must be linked to "Data on". This is used to communicate with the terminals. KL_State ARRAY OF USINT Must be linked to the "State" variable of the KL terminal. This is used to transfer the state of the terminal. EL_Current ARRAY OF DINT Must be linked to the "Current" variable of the EL terminal. EL_Voltage ARRAY OF DINT Must be linked to the "Voltage" variable of the EL terminal. EL_Power ARRAY OF DINT Must be linked to the "Active Power" variable of the EL terminal. The power is stored in this variable. EL_No Zero Cross ARRAY OF BOOL Must be linked to "Missing Zero Crossing" of the EL terminal. EL_Wc State BOOL Must be linked to the "Wc State" variable of the EL terminal. This is used to detect whether the process data coming from the terminal are OK. EL_State UINT Must be linked to the "State" variable of the EL terminal. This is used to return the current state of the terminal. EL_Ads Addr ST_Tc Pfw_Ads Addr When using the EL3403 terminal, the process value "Ads Addr" must be linked here. This connection is used for Co E communication. 3.6.1.3.3 ST_Tc Pfw_x L3403_Output Such a structure contains the output data for power measurement. Syntax TYPE ST_Tc Pfw_x L3403_Output : (* location Pfw Lib_Temp Control. PRO *) (* last modification: 08.09.2010 *) STRUCT KL_Ctrl : ARRAY[1..3] OF USINT; END_STRUCT END_TYPE Parameter Name Type Description KL_Ctrl ARRAY OF USINT Must be linked to "Data Off" in the terminal. This is used to define which process data the terminal is to be made available. Example: 0 -> apparent power. 3.6.1.3.4 ST_Tc Pfw_FM3332_Input Such a structure contains the input data of a FM3312 or FM3332 fieldbus module. The link established with the System Manager to the variables of the I/O module must match the type set in aaa Pfw Temp Mparam From Hmi[..]. Temp Sens Term. To be able to evaluate the process image of a FM33xx module, it must be distributed to the process images of the zones and converted. For this purpose a function block of type FB_Temp Ctrl Adapt Fm33xx_Tc Pfw() must be used. TF8540 Version: 1.1.0 43
## Page 44

PLC temperature controller Syntax TYPE ST_Tc Pfw_FM3332_Input: (* last modification: 16.03.2009 *) STRUCT Dp State : USINT; Ext Diag Flag : BOOL; (**) Kanal_Daten : ARRAY[1..32] OF UINT; (**) Open Circuit : ARRAY[0..3] OF SINT; Backvoltage : ARRAY[0..3] OF SINT; END_STRUCT END_TYPE Parameter Name Type Description Dp State USINT The Profi Bus DP State. This status is used to monitor communication and device status. Ext Diag Flag BOOL reserved Channel_Data ARRAY OF UINT The actual values of up to 32 channels. Open Circuit ARRAY OF SINT Alarm signals for up to 32 channels are combined in four bytes of 8 bits each. Reported problem: wire break in the measuring circuit. Back voltage ARRAY OF SINT Alarm signals for up to 32 channels are combined in four bytes of 8 bits each. Reported problem: external voltage in the measuring circuit. 3.6.1.3.5 ST_Tc Pfw_x L3403_State Such a structure contains the results of the power measurement and makes this available to the application. Syntax TYPE ST_Tc Pfw_x L3403_State : (* location Pfw Lib_Temp Control. PRO *) (* last modification: 08.09.2010 *) STRUCT Power: ARRAY[1..3] OF LREAL; Voltage: ARRAY[1..3] OF LREAL; Current: ARRAY[1..3] OF LREAL; Line Error: ARRAY[1..3] OF BOOL; Sub Type : INT; Error ID : INT; Latched Err ID : INT; Latched Err : BOOL; Error : BOOL; Ready : BOOL; END_STRUCT END_TYPE 44 Version: 1.1.0 TF8540
## Page 45

PLC temperature controller Parameter Name Type Description Power ARRAY OF LREAL Prepared power for further processing. Voltage ARRAY OF LREAL Prepared tension for further processing. Current ARRAY OF LREAL Prepared current for further processing. Line Error ARRAY OF BOOL A TRUE indicates that the terminal is in an error state. Sub Type INT The terminal subtype, which influences the conversion factor. Error ID INT Detailed information about the error is provided via this Error ID. The error codes can be consulted in the constants. Latched Err ID INT Here the last active Error ID is stored even after an error reset. Latched Err BOOL Latched Error = TRUE remains active even after an error reset. This must be actively reset, i.e. Latched Error = FALSE. Error BOOL A TRUE indicates that the function block is in an error state. By a TRUE at the reset input of the function block FB_x L3403_Tc Pfw.htm it is possible to reset the function block. Ready BOOL Indicates a completed conversion at a KL terminal. 3.6.2 ST_Tc Pfw_Temp Mparam From Hmi_Itf Such a structure contains the machine data of a zone. Syntax TYPE ST_Tc Pfw_Temp Mparam From Hmi_Itf : (* last modification: 20.12.2010 *) STRUCT (* ========================================== temperature zone machine parameters see cnv_Temp Mparam From Hmi_Tc Pfw for format definition ========================================== *) Zone Name: STRING(79); Absolute High : LREAL; Absolute Low : LREAL; Extruder Comp : LREAL; Kp Cool : LREAL; Kp Heat : LREAL; Td Cool : LREAL; Td Heat : LREAL; Tn Cool : LREAL; Tn Heat : LREAL; Tv Cool : LREAL; Tv Heat : LREAL; Kff Heat : LREAL; Kff Cool : LREAL; Gain PIDHeat : LREAL:=1.0; Gain PIDCool : LREAL:=1.0; Overshoot : LREAL; Tracking_Td : LREAL; Ramping_Rate : LREAL; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=9 *) Ramping_Rate C : LREAL; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=15 *) Ramping_Tolerance : LREAL; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=9 *) d Tmax : LREAL; Sensor Offset : LREAL; Settling Time : LREAL; Supply Load_Cooler : LREAL; Supply Load_Heater : LREAL; Supply Load_Tolerance : LREAL; Tune End : LREAL; Tune Kp : LREAL; Tune Td : LREAL; Tune Tn : LREAL; Tune Tv : LREAL; Tune Tracking Td : LREAL:=0.0; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=15 *) Tune Y : LREAL; Tune End Min : LREAL:=10.0; Tune Min Temp Delta : LREAL:=40.0; L_Load Idle : LREAL; TF8540 Version: 1.1.0 45
## Page 46

PLC temperature controller Act Temp Filter : LREAL:=0.1; Weighting_C : LREAL; Setpoint ramp will start moving *) Error Heating Factor : LREAL:=0.0; (* starting with V1.0.8: will define default heating in error sta te *) f Pwm Std Max On Time : LREAL; f Pwm Max On Time : ARRAY[cnv_Temp Ctrl_Setpoint First..cnv_Temp Ctrl_Setpoint Last] OF LREAL:=0.0; f Pwm Min On Time : LREAL:=0.0; fc_On Time : LREAL:=0.0; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=15 *) fc_Off Time : LREAL:=0.0; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=15 * Act Temp Gain : LREAL:=1.0; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=18 *) Act Temp Offset : LREAL:=0.0; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=18 *) Save Delay : DINT:=-1; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=17 *) Output Sel_H : E_Tc Pfw_Tctrl Out Select:=e Tc Pfw Tc Out_PWM; Output Sel_C : E_Tc Pfw_Tctrl Out Select:=e Tc Pfw Tc Out_PWM; Temp Sens Term : E_Tc Pfw_Terminal Type :=e Tc Pfw Term T_No Terminal; Sensor Type :E_Tc Pfw_Temp Sens Type:=e Tc Pfw Temp Sens T_No Sensor; App_Hmi Type : INT:=0; Term Channel : INT; Extruder Id : INT; Module Id : INT; Zone Id : INT; Supply Id : INT; CJ_Comp Mode : INT; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=8 *) CJ_Comp Zone : INT; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=8 *) Term Idx : INT; (* used to connect the zone to a terminal *) Heater Swap Idx : INT; (* used for I/O re-location of selected heater signal *) Cooler Swap Idx : INT; (* used for I/O re-location of selected cooler signal *) n Pwm Factor C : INT; e Tuning Method : E_Tc Pfw_Tctrl Tuning Method; In Use : BOOL; Use Cooling : BOOL; Extruder Comp Ena : BOOL; Tune Cooling : BOOL; Autotune : BOOL; Start Re Tune : BOOL; Enable : BOOL; Update : BOOL; Ena Extruder Block : BOOL; No Fan While Track Down : BOOL; Ena_Tune Idle Load : BOOL; Looptest Update : BOOL:=FALSE; Enable Error Heating : BOOL:=FALSE; (* starting with V1.0.8: will enable default heating in error st ate *) Read Back : BOOL:=FALSE; Tune Extruder Comp : BOOL; Tune Heater Load : BOOL:=FALSE; (* tuning heater power monitoring *) Openloop Heating : BOOL:=FALSE; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=15 * fc_Enable : BOOL:=FALSE; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=15 *) Hibernate I_Cool : BOOL:=FALSE; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=15 *) Hibernate I_Heat : BOOL:=FALSE; (* starting with cnv_Temp Mparam From Hmi_Tc Pfw=15 *) b Saving Params : BOOL:=FALSE; (* *) b Load Params : BOOL:=FALSE; (* *) b High Precision : BOOL; b Disable Terminal Com : BOOL; b Reset : BOOL; Enable Act Temp Filter : BOOL:=FALSE; END_STRUCT END_TYPE 46 Version: 1.1.0 TF8540
## Page 47

PLC temperature controller Variable Monitoring Action Control Confi-gura- Auto-tun- Description tion ing Absolute Hig x An alarm is triggered if the h actual zone temperature exceeds this limit value. Absolute Lo x An alarm is triggered if the w actual zone temperature falls below this limit value. Act Temp Filt x Filter time of the actual er temperature filtering. Act Temp Gai x Scaling for the current n temperature (for subsequent calibration) Act Temp Off x Offset for the current set temperature (for a subsequent calibration) Autotune x A TRUE here enables the autotuning (automatic parameter determination) of the zone. In order to perform the autotuning successfully, the zone must be stable, In Use, Enable and be able to pass through at least a 40 °C temperature lift. App_Hmi Ty Represents a numbering pe used only by the application, but stored by the library. Group formations (hot runner, cylinder1, cylinder2, etc.) are to be made possible via this. b Disable Ter x Disables terminal minal Com communication for this zone. b High Precisi x The control of the actual on temperature is highly accurate. As a result, heating up may take more time. b Reset x Performs a reset in this zone. b Saving Par x This indicates that machine ams data are being stored. b Load Para x A TRUE triggers the loading ms of machine parameters. CJ_Comp M Enables external ode compensation for thermocouples. CJ_Comp Zo Zone that measures the ne temperature to be compensated. Cooler Swap x Defines the output of fan Idx switching signals via the redirectable I/O level. d Tmax x This is where the maximum rate of rise is recorded during autotuning. The determined value is displayed in °C/s. Enable x A TRUE enables active heating or cooling. TF8540 Version: 1.1.0 47
## Page 48

PLC temperature controller Variable Monitoring Action Control Confi-gura- Auto-tun- Description tion ing Enable Act T x Enables actual temperature emp Filter filtering. Enable Error x A TRUE here enables the Heating output of heating power when the temperature sensor is disturbed. As soon as a sensor error occurs, the temperature necessary to maintain the current temperature is output. This function is only fully functional if the Ena_Tune Idle Load was successfully executed before. Ena Extruder reserved Block Ena_Tune Idl x A TRUE enables the e Load parameter determination for the "Idle Load". In this optimization, the system is not excited in any way. Error Heating x This parameter influences the Factor output of heating power when the temperature sensor is disturbed. It can take values between 0% and 100%, where 100% is the maximum power to keep the zone at the current temperature. e Tuning Met e Tc Pfw Tc Tun_Step Respons hod e: Is the default autotune operation. The parameters are determined via a step response. e Tuning Met e Tc Pfw Tc Tun_Oscillation Tes hod t: In preparation Extruder Co This parameter compensates mp the friction and transport energy in a zone. Extruder Co A TRUE enables extruder mp Ena compensation. When the path is switched on, the appropriate energy is automatically provided in the respective zone, minimizing controller settling. Speed changes in the range of 20% (related to the adjustment speed) are compensated without any problems, whereas in case of large speed changes (e.g. product change) a new compensation is necessary. Extruder Id reserved 48 Version: 1.1.0 TF8540
## Page 49

PLC temperature controller Variable Monitoring Action Control Confi-gura- Auto-tun- Description tion ing fc_Enable x Enabling forced fluid cooling. In order not to overheat the fluid under the heating tape, the fluid must circulate at certain intervals. Enabling automatically causes the fault to be calculated in the controller. fc_On Time x For this time (in seconds ) the forced cooling is active (the cooling output is switched). If cooling is performed via the controller output during the "fc_Off Time" phase, this is taken into account. fc_Off Time x For this time duration (in seconds ) the forced cooling is inactive, but can be activated at any time via the controller output. f Pwm Min On x This factor can be used to Time define the minimum PWM switch-on time in relation to the cycle time. A value between 0.1 and 1.0 must be entered. f Pwm Max O x This factor can be used to n Time define the maximum PWM switch-on time in relation to the cycle time. A value between 0.05 and 0.75*Pwm Max On must be entered. A PWMMax On time is assigned to each setpoint in the array. If null the PWMMax On Time from the Supply Line is used. f Pwm Std Ma x This factor can be used to x On Time define the maximum PWM switch-on time in relation to the cycle time. A value between 0.05 and 0.75*Pwm Max On must be entered. This variable is active when controlling to the setpoint. If null the PWMMax On Time from the Supply Line is used. Heater Swap x Defines the output of heating Idx switching signals via the redirectable I/O level. Hibernate I_ A TRUE causes the I part of Heat the heating control to freeze. Hibernate I_ A TRUE causes the I part of Cool the cooling controller to freeze. TF8540 Version: 1.1.0 49
## Page 50

PLC temperature controller Variable Monitoring Action Control Confi-gura- Auto-tun- Description tion ing In Use x The zone becomes an active part of the temperature control by TRUE. If FALSE, the zone will not be active even if Enable is set and the group is switched on. It will not signal a fault at any time or for any reason and will not be considered in load balancing or optional current measurement. Kp Cool x The parameter for the P part of the temperature controller. This parameter should be determined by autotuning. Kp Heat x The parameter for the P part of the temperature controller. This parameter should be determined by autotuning. Gain PIDHea x The parameter for the overall t gain of the temperature control during heating. Increases ramp slope and P part. Weakens I part and D part (damping and derivative action time for ramping and tracking). Gain PIDCoo x The parameter for the overall l gain of the temperature control during cooling. Increases ramp slope and P part. Weakens I part and D part (damping and derivative action time for ramping and tracking). L_Load Idle x This parameter represents the base load. A properly set Idle Load enables the set temperature to be reached without overshoot, as well as good system behavior during "error heating". This parameter should be determined by an Idle- Tune. Looptest Upd reserved. ate Module Id x This parameter assigns a temperature group to the zone. A number of functions (e.g. switching on, lowering, etc.) are organized and controlled within a temperature group. 50 Version: 1.1.0 TF8540
## Page 51

PLC temperature controller Variable Monitoring Action Control Confi-gura- Auto-tun- Description tion ing No Fan While x If this parameter is set, an Track Down existing cooling is not used to reach the set temperature when the preset is reduced. n Pwm Factor x The PWM cycle time is C multiplied by this factor to realize an appropriate cycle time during cooling. Output Sel_ x These parameters determine C which of the offered signals are selected for heating. Output Sel_ x These parameters determine H which of the offered signals are selected for (optional) cooling. Overshoot x This is where the amount of overshoot is recorded during autotuning. This allows conclusions to be drawn about the dynamics of the system. Openloop He x If a zone has no sensor, the ating zone can be heated in a controlled manner via a fixed control value. Ramping_R x x Specifies the slope with ate which the controller setpoint should reach the entered setpoint during heating. The input is to be made in °C/min This parameter should be determined by autotuning. Ramping_R x x Specifies the slope with ate C which the controller setpoint should reach the entered setpoint during cooling. The input is to be made in °C/min This parameter should be determined by autotuning. Ramping_T x Specifies from when a olerance setpoint change is to be increased via a ramp. It is recommended to approach setpoint changes of 5 to 10 °C via ramping. If the slope of the automatically determined ramp is too small, it can be changed via the Ramping_Rate parameter. Read Back reserved. Save Delay x Time in µs. The value is counted down contin uously. If the value reaches 0, saving is activated. -1 means idle state. TF8540 Version: 1.1.0 51
## Page 52

PLC temperature controller Variable Monitoring Action Control Confi-gura- Auto-tun- Description tion ing Sensor Offse An offset to be used when t determining the actual temperature can be specified here. The specification has to be made in °C. Sensor Type x These parameters determine which of the supported sensor types are used to record the actual temperature. Settling Time x x x This parameter is used in various places to take into account the time behavior of the zone. Start Re Tune x If the controller does not regulate ideally during operation, there is the possibility of subsequent self- optimization. This can be done during production. Supply Id x This parameter assigns the zone to a supply line. It will take some parameters for the PWM output from this group. A range of functions (e.g. load balancing, current measurement etc.) is organized and synchronized within a supply line. By default, there are 4 different supply groups, with 1 to 3 to be used for phases 1 to 3. Two or three-phase heating tapes can be entered in supply line 4. Supply Load The cooling capacity of the _Cooler zone in watts. Supply Load x x x The heating power of the _Heater zone in watts. In the case of (optional) monitoring of the heating power, this is the setpoint. Supply Load x If the deviation of the _Tolerance measured heating power exceeds this tolerance, an alarm is triggered. The tolerance is specified in % between 0.0 and 100.0. If 0.0 is set here or the FB_Temp Ctrl Main Body_Tc Pf w() function block is called with Looptest_Enable:=FALSE, no monitoring takes place. 52 Version: 1.1.0 TF8540
## Page 53

PLC temperature controller Variable Monitoring Action Control Confi-gura- Auto-tun- Description tion ing Td Cool x The parameter for the D part (damping time) of the temperature controller. This parameter should be determined by autotuning. Td Heat x The parameter for the D part (damping time) of the temperature controller. This parameter should be determined by autotuning. Temp Sens T x These parameters determine erm which of the supported I/O terminals is used to acquire the actual temperature. Term Chann x For multi-channel terminals, el the channel within the terminal must be specified here. Term Idx x Defines the redirection of the actual temperature acquisition. Tn Cool x The parameter for the I part of the temperature controller. This parameter should be determined by autotuning. Tn Heat x The parameter for the I part of the temperature controller. This parameter should be determined by autotuning. Tracking_Td x This parameter is used for controlling of large set value changes. This parameter should be determined by autotuning. Tune Cooling x Only if a TRUE is entered here, the cooling behavior is evaluated during autotuning. Tune End x This percentage of the temperature setpoint is used in autotuning. Tune Extrud x A TRUE here calculates the er Comp Extruder Comp. Tune Heater x A TRUE here calculates the Load heating power of this zone. Tune_Idle Lo x A TRUE here calculates the ad Idle Load of this zone during autotuning. Tune Kp x The P part of the autotuning mechanism. This factor is used to weight the P part in autotuning. Tune Td x The D part of the autotuning mechanism. This factor is used to weight the delay of the D part in autotuning. TF8540 Version: 1.1.0 53
## Page 54

PLC temperature controller Variable Monitoring Action Control Confi-gura- Auto-tun- Description tion ing Tune Tn x The I part of the autotuning mechanism. This factor is used to weight the I part in autotuning. Tune Tv x The D part of the autotuning mechanism. This factor is used to weight the D part in autotuning. Tune Trackin x The D part of the autotuning g Td mechanism. This factor is used to set the D part of the Beckhoff algorithm. A value between zero and one means aggressive control; a value greater than one means cautious control. Default is zero. Tune Y x This percentage of the available heating power is used in autotuning. Tv Cool x The parameter for the D part (derivative action time) of the temperature controller. This parameter should be determined by autotuning. Tv Heat x The parameter for the D part (derivative action time) of the temperature controller. This parameter should be determined by autotuning. Update x With a TRUE the user interface signals here that it has changed values in this structure. The framework will check these values, adjust them if necessary and adopt them. Use Cooling x Only if a TRUE is entered here, the controller outputs to the cooling. Weighting_ x x Weighting factor, which is C used to determine the cooling parameters for the control. Zone Id x This parameter numbers the zones inside the machine. The numerical value may only be used in a single zone. Zone Name x The textual name of the zone. Example: 'Ext_1' or 'Head_5'. 3.6.3 ST_Tc Pfw_Temp Pparam From Hmi_Itf Such a structure contains the product data of a zone of temperature control. 54 Version: 1.1.0 TF8540
## Page 55

PLC temperature controller Syntax TYPE ST_Tc Pfw_Temp Pparam From Hmi_Itf : (* last modification: 11.11.2008 *) STRUCT (* see cnv_Temp Pparam From Hmi_Tc Pfw for format definition Attention: HMI access via address *) Setpoint: LREAL; Standby Setpoint: LREAL; Setpoints : ARRAY[cnv_Temp Ctrl_Setpoint First..cnv_Temp Ctrl_Setpoint Last] OF LREAL; (* AST: supp orting selectable setpoints *) Threshold_PP : LREAL; Threshold_P : LREAL; Threshold_M : LREAL; Threshold_MM : LREAL; Openloop_Output: LREAL; Save Delay: DINT:=-1; Update : BOOL; b Load Params : BOOL:=FALSE; (* *) b Saving Params : BOOL:=FALSE; (* *) END_STRUCT END_TYPE Parameter Name Type Description Setpoint LREAL The temperature setpoint of the zone. Standby Setpoint LREAL This value is used as the temperature setpoint by the zone in standby. Setpoints ARRAY OF Additional setpoints can be specified here, which can be easily LREAL switched over via an index. The number of the index is to be specified in Temp Ctrl. Select Setpoint. Threshold_PP LREAL The outer positive tolerance limit. Threshold_P LREAL The inner positive tolerance limit. Threshold_M LREAL The inner negative tolerance limit. Threshold_MM LREAL The outer negative tolerance limit. Openloop_Output LREAL Control value output if no actual temperature is available. Save Delay DINT Memory delay in µs. After a time written to this variable by the application, the saving of the actual values is triggered. (If the value is zero, the system is saved; if it is -1, the system is at rest; if the value is greater than zero, the system is saved after the time has elapsed) Update BOOL With a TRUE the user interface signals here that it has changed values in this structure. The framework will check these values, adjust them if necessary and adopt them. b Load Params BOOL This flag triggers the saving of the parameters. b Saving Params BOOL Signals to the application that data are being saved. 3.6.4 ST_Tc Pfw_Temp To Hmi_Itf Such a structure contains the visualization data of a zone of temperature control. Syntax TYPE ST_Tc Pfw_Temp To Hmi_Itf : (* last modification: 25.09.2008 *) STRUCT Actual Temp : LREAL; Supply Match : LREAL; Act Current : LREAL; File Err Id : DINT; Error Id : UINT; TF8540 Version: 1.1.0 55
## Page 56

PLC temperature controller Module Id : INT; Power Level : INT; Zone Id : INT; Cooling : BOOL; Enable : BOOL; Error : BOOL; File Err : BOOL; Heating : BOOL; In Use : BOOL; On Stand By : BOOL; Tuning Active : BOOL; Tuning Done : BOOL; Idle Load Active : BOOL; Idle Load Done : BOOL; Looptest Active : BOOL; Extruder Comp Active: BOOL; Extruder Comp Done : BOOL; (* *) END_STRUCT END_TYPE Parameter Name Type Description Actual Temp LREAL The actual temperature of the zone. Supply Match LREAL Reflects the relationship between measured current power and the specified target power. Act Current LREAL Actual current. File Err Id DINT In case of storage/loading of the zone, a coded information is provided here. However, only if saving and loading are performed via the machine and product parameters. Error Id UINT In the event of an error, coded information is provided here. The conversion of the error number into a plain text can be seen in the global variables. Error numbers that are not listed there are usually general Beckhoff error numbers of subordinate function blocks (mostly ADS errors). Module Id INT This Id specifies the group to which this zone is assigned. Power Level INT This value reflects the power value specified by the controller in %. Zone Id INT This Id reflects the classification of the zone within its group. Cooling BOOL A TRUE here indicates that the zone is actively cooling. Enable BOOL A TRUE here indicates that the controller is enabled for the zone. Error BOOL A TRUE here indicates that a controller, autotuning or hardware error has occurred in the zone. File Err BOOL A TRUE here signals that an error has occurred in the storage/loading case of the zone. Heating BOOL A TRUE here indicates that the zone is actively heating. In Use BOOL A TRUE here indicates that the zone is an active part of the current configuration. Prerequisite is that in the machine parameters Module Id<>0; Zone Id<>0; Supply Id<>0 and In Use:=TRUE On Stand By BOOL A TRUE indicates here that the zone has been switched to the standby setpoint. Tuning Active BOOL During autotuning of the zone this signal is TRUE. Tuning Done BOOL A successful autotuning of the zone is reported here. Idle Load Active BOOL This signal is TRUE during Idle Load tuning of the zone. Idle Load Done BOOL A successful Idle Load tuning of the zone is reported here. Looptest Active BOOL A TRUE here indicates that power measurement is active. Extruder Comp Active BOOL Signals that the automatic calculation of extruder compensation is active. Extruder Comp Done BOOL Signals that the automatic calculation of the extruder compensation has been successful. 56 Version: 1.1.0 TF8540
## Page 57

PLC temperature controller 3.6.5 ST_Tc Pfw_Supply Param This structure describes the parameters and runtime data of a supply unit. Syntax TYPE ST_Tc Pfw_Supply Param : (* last modification: 28.05.2008 *) STRUCT (* see cnv_Supply Param_Tc Pfw for format definition *) (* temperature controller pwm setup *) f Pwm Cycle Time : LREAL; (* will be updated to all temperature zones in supply group *) f Pwm Min On Time : LREAL; (* will be updated to all temperature zones in supply group *) f Pwm Max On Time : LREAL; (* will be updated to all temperature zones in supply group *) f Pwm Max On C : LREAL; f Pwm Max Ramp Load : LREAL; (* in k W, will be updated to all temperature zones in supply group * ) f Act Supply Load : LREAL; f Act Supply Current: LREAL; f Supply Load : LREAL; f Supply Match : LREAL; n Pwm Factor C : INT:=1; (* will be updated to all temperature zones in supply group *) (* internal *) f Used Load : LREAL; f Used Load_H : LREAL; f Used Load_C : LREAL; tpwmtimer : LREAL:=0.0; Save Delay : DINT:=-1; File Err Id : DINT; refresh_H : BOOL; Unsaved : BOOL; b Saving Params : BOOL:=FALSE; (* *) b Load Params : BOOL:=FALSE; (* *) File Err : BOOL:=FALSE; (* *) END_STRUCT END_TYPE TF8540 Version: 1.1.0 57
## Page 58

PLC temperature controller Parameter Name Type Description f Pwm Cycle Time LREAL The cycle time (in seconds) of the PWM signal generator. f Pwm Min On Time LREAL The minimum switch-on component of the PWM signal. Range 0.1 to 1.0 f Pwm Max On Time LREAL The maximum switch-on time from the PWM signal. Range 0.1 to 1.0 f Pwm Max On C LREAL The maximum switch-on time of the cooling output from the PWM signal. If zero, the f Pwm Max On Time is used. Range 0.1 to 1.0 f Pwm Max Ramp Load LREAL reserved f Act Supply Load LREAL If a power measurement is performed, the current power can be read here. f Act Supply Current LREAL If a power measurement is performed, the current currently measured can be read here. f Supply Load LREAL The predicted total power of the supply line. f Supply Match LREAL The ratio of f Act Supply Load to f Supply Load. n Pwm Factor C INT The multiplier for the cooling PWM cycle time. Tpwm_cool := Tpwm_heat * n Pwm Factor C. f Used Load LREAL reserved f Used Load_H LREAL reserved f Used Load_C LREAL reserved tpwmtimer LREAL Counter for the PWM cycles of the heating control. Save Delay DINT Memory delay in µs. After a time written to this variable by the application, the saving is triggered. (If the value is zero, the system is saved; if it is -1, the system is at rest; if the value is greater than zero, the system is saved after the time has elapsed) File Err Id DINT In case of storage/loading of the zone, a coded information is provided here. However, only if saving and loading are performed via the machine and product parameters. refresh_H BOOL Trigger signals for heating and cooling PWM cycles. Unsaved BOOL Signals the application that parameters have changed from the library. b Saving Params BOOL Signals to the application that data are being saved. b Load Params BOOL This flag triggers the saving of the parameters. File Err BOOL In case of storage/charging of the zone, it is displayed here if the storage or charging process has failed. The controller output is usually provided to the heating tape as a PWM signal. It is possible to provide a separate PWM configuration for each phase of a supply line. 3.6.6 ST_Tc Pfw_Temp Ctrl_Itf Such a structure contains the visualization data of a zone of temperature control. Syntax TYPE ST_Tc Pfw_Temp Ctrl_Itf : (* last modification: 01.10.2010 *) STRUCT (* ========================================== temperature zone internal data see cnv_Temp Ctrl_Itf_Tc Pfw for format definition ========================================== *) st Rt Data: ST_Tc Pfw_Temp Ctrl_Rt Data; Zone Name: STRING(79); Heater_Supply Load : LREAL; 58 Version: 1.1.0 TF8540
## Page 59

PLC temperature controller Setpoint : LREAL; Threshold_PP : LREAL; Threshold_P : LREAL; Threshold_M : LREAL; Threshold_MM : LREAL; Standby Setpoint : LREAL; temp Energy : LREAL; Openloop_Output : LREAL; Prev Same Supply : INT; Next Same Supply : INT; Evt Idx_Autotune : INT; Evt Idx_Hardware : INT; Temp Term Init : INT; Select Setpoint : INT:=0; (* AST: supporting selectable setpoints *) Sel Setpoint : BOOL; Cmd_Tune Heater Load : BOOL; Sema_Update : BOOL; Sema_Used : BOOL; Loop Test : BOOL; Loop Test_Inv : BOOL; Enable : BOOL; Alarm_Low Low : BOOL; Alarm_Low : BOOL; Alarm_High : BOOL; Alarm_High High : BOOL; Alarm_Absolute Low : BOOL; Alarm_Absolute High : BOOL; Alarm_No Response : BOOL; Force_Heating : BOOL:=FALSE; Force_Cooling : BOOL:=FALSE; Fault : BOOL:=FALSE; (* starting with V1.0.9 *) END_STRUCT END_TYPE TF8540 Version: 1.1.0 59
## Page 60

PLC temperature controller Parameter 60 Version: 1.1.0 TF8540
## Page 61

PLC temperature controller Name Type Description st Rt Data ST_Tc Pfw_Te The runtime data of the zone. mp Ctrl_Rt Data Zone Name STRING Reserved, not guaranteed. Heater_Supply Load LREAL The total heating power of all zones of the same supply line. Setpoint LREAL The set temperature of the zone. (Copy of the parameter from ST_Tc Pfw_Temp Pparam From Hmi_Itf). Threshold_PP LREAL The outer positive tolerance limit of the zone. (Copy of the parameter from ST_Tc Pfw_Temp Pparam From Hmi_Itf). Threshold_P LREAL The inner positive tolerance limit of the zone. (Copy of the parameter from ST_Tc Pfw_Temp Pparam From Hmi_Itf). Threshold_M LREAL The inner negative tolerance limit of the zone. (Copy of the parameter from ST_Tc Pfw_Temp Pparam From Hmi_Itf). Threshold_MM LREAL The outer negative tolerance limit of the zone. (Copy of the parameter from ST_Tc Pfw_Temp Pparam From Hmi_Itf). Standby Setpoint LREAL The set lowering temperature of the zone. (Copy of the parameter from ST_Tc Pfw_Temp Pparam From Hmi_Itf). temp Energy LREAL Intermediate variable for energy calculation. Openloop_Output LREAL Copy of the specified control rate from the product parameters. Prev Same Supply INT Reserved for internal use. Next Same Supply INT Reserved for internal use. Evt Idx_Autotune INT Reserved for Blow Molding Framework. Evt Idx_Hardware INT Reserved for Blow Molding Framework. Temp Term Init INT Reserved for the FB_Temp Ctrl Callback_Tc Pfw() function block. Select Setpoint INT Selection of the setpoint from the Setpoints array. If the value is outside the value range, Setpoint from the product parameters is active. Sel Setpoint BOOL The switching of the effective setpoint of the zone. A TRUE selects the Standby Setpoint, a FALSE the Setpoint. Cmd_Tune Heater Load BOOL Reserved for automatic measurement of heating power. Sema_Update BOOL reserved Sema_Used BOOL reserved Loop Test BOOL The current measurement for this zone is active. The heating is switched on for a short time independently of the control. Loop Test_Inv BOOL Current measurement for another zone of the same supply line is active. The heating is switched off for a short time independently of the control. Enable BOOL A TRUE here indicates that the controller is enabled for the zone. Alarm_Low Low BOOL The zone is ST_Tc Pfw_Temp Mparam From Hmi_Itf. In Use and the actual temperature of the zone is below the effective setpoint by more than the outer negative tolerance limit. Alarm_Low BOOL The zone is ST_Tc Pfw_Temp Mparam From Hmi_Itf. In Use and the actual temperature of the zone is below the effective setpoint by more than the inner negative tolerance limit. TF8540 Version: 1.1.0 61
## Page 62

PLC temperature controller Name Type Description Alarm_High BOOL The zone is ST_Tc Pfw_Temp Mparam From Hmi_Itf. In Use and the actual temperature of the zone is more than the inner positive tolerance limit above the effective setpoint. Alarm_High High BOOL The zone is ST_Tc Pfw_Temp Mparam From Hmi_Itf. In Use and the actual temperature of the zone is more than the outer positive tolerance limit above the effective setpoint. Alarm_Absolute Low BOOL The zone is ST_Tc Pfw_Temp Mparam From Hmi_Itf. In Use and the actual temperature of the zone is below ST_Tc Pfw_Temp Mparam From Hmi_Itf. Absolute Low. Alarm_Absolute High BOOL The zone is ST_Tc Pfw_Temp Mparam From Hmi_Itf. In Use and the actual temperature of the zone is above ST_Tc Pfw_Temp Mparam From Hmi_Itf. Absolute High. If this flag is set, no heating power is generated in this zone. Alarm_No Response BOOL The actual temperature of the zone has not responded to the heating power within a reasonable time. Force_Heating BOOL A TRUE produces a heating power output at 100% for 100 cycles. Force_Cooling BOOL A TRUE will produce a cooling output at 100% for 100 cycles. Fault BOOL Error. 3.6.7 ST_Tc Pfw_Power Measurement_Cfg Such a structure contains the configuration data for power measurement. These data are not stored. Syntax TYPE ST_Tc Pfw_x L3403_Input: (* location Pfw Lib_Temp Control. PRO *) (* last modification: 08.09.2010 *) STRUCT Cycle Time : LREAL:=0.025; I_ratio : LREAL:=1.0; e Power Terminal: E_Tc Pfw_Tctrl Power Terminal; Terminal Idx : INT; Terminal Sub Idx: INT; END_TYPE Parameter Name Type Description Cycle Time LREAL Task cycle time. I_ratio LREAL Ratio of the current transformers. e Power Terminal E_Tc Pfw_Tctrl Power Termi Type of power measurement terminal that is connected. nal Terminal Idx INT Number of the Supplygroup which is assigned to it. Terminal Sub Idx INT For terminals containing more than three current measurement channels (EL3446), it must be specified whether the group is connected to the first three current measurement inputs (-> 1) or to the rear three current measurement inputs (-> 2). 62 Version: 1.1.0 TF8540
## Page 63

PLC temperature controller 3.7 Knowledge Base 3.7.1 Commissioning 3.7.1.1 Global Commissioning The Pfw Lib_Temp Control.lib library is divided into six main structures. • ST_Tc Pfw_Temp Ctrl Input This structure contains all linkable input variables. • ST_Tc Pfw_Temp Ctrl Output This structure contains all linkable output variables. • ST_Tc Pfw_Temp Mparam From Hmi_Itf All machine parameters are stored in this structure. • ST_Tc Pfw_Temp Pparam From Hmi_Itf All product parameters are stored in this structure. • ST_Tc Pfw_Supply Param Settings for PWM output are made in this structure. • ST_Tc Pfw_Temp To Hmi_Itf This structure shows the current states of the temperature controller. For successful commissioning of the temperature controller, the Pfw Lib_Temp Control.lib library must be included in the project. The following steps must then be carried out: Creating an instance of the function block FB_Temp Ctrl Main Body_Tc Pfw and declaring the variables Variable Short description Example value Config Enable Signals the validity of the TRUE parameters. Callback_Enable Enables background TRUE communication with the I/O terminals. Looptest_Enable Activates the power monitoring of FALSE the heating tapes. t Cycle Cycle time (A cycle time unequal to 0.025s the mains frequency is recommended). Simu_Enable Starting a simulation. FALSE Simu_Dis Charge Reset simulation to initial value. FALSE Simu_Dis Charge Reset simulation to initial value. FALSE The temperature library contains two simulations: • A Pt2 path that is active when the aaa Pfw Temp Mparam From Hmi[..]. Temp Sens Term parameter contains a 0 (recommended simulation for the user). • If the parameter Simu_Enable is set, a physical model of an extruder cylinder becomes active. This simulation is mainly intended for development purposes and should not be activated by the user. TF8540 Version: 1.1.0 63
## Page 64

PLC temperature controller Constant definition Variable Short description Type Example value cn Pfw Temp Ctrl First Number of the first zone (usually 1). INT 1 cn Pfw Temp Ctrl Last Number of the last zone. INT 32 cn Pfw App Supply First Number of the first supply group. INT 1 cn Pfw App Supply Last Number of the last supply group. INT 3 cn Pfw Temp Trend First cn Pfw Temp Trend First and INT 1 cn Pfw Temp Trend Last specify the number of samples for trend acquisition. cn Pfw Temp Trend Last cn Pfw Temp Trend First and INT 100 cn Pfw Temp Trend Last specify the number of samples for trend acquisition. cn Pfw Temp Trend_s PH Period value of the sampling time in ms. INT cn Pfw Bool Out Swap First Initial index of the array INT 1 out_Swapped Digital Out. cn Pfw Bool Out Swap Last End index of the array INT 2 (When not in out_Swapped Digital Out. use) cn Pfw Bool In Swap First Initial index of the array INT 1 in_Swapped Digital In. cn Pfw Bool In Swap Last End index of the array INT 2 (When not in in_Swapped Digital In. use) cn Pfw Scope Sample First cn Pfw Scope Sample First and INT cn Pfw Scope Sample Last specify the number of samples for scope acquisition. cn Pfw Scope Sample Last cn Pfw Scope Sample First and INT cn Pfw Scope Sample Last specify the number of samples for scope acquisition. b Pfw_Use Temp Control The feedback is active and thus the BOOL TRUE reading of actual values is possible. b Pfw_Use Rt Scope The acquisition of scope data is active. BOOL FALSE b Pfw_Use Temp Trend The acquisition of trend data is active. BOOL FALSE cnst_pfw_sel Rel Alarm Via a TRUE, the selected setpoint is BOOL FALSE used for the relative alarms. With a FALSE the internally ramped setpoint is used. cn Pfw Loop Test Timer Time in ms in which the power LREAL 0.4 s measurement measures. cn Pfw Loop Test Cycle Time in ms which is available for the LREAL 9.999 s controller before the next zone is checked. cnst_Pfw Param File Path_CE Folder path on a CE operating system. STRING cnst_Pfw Param File Path_XP Folder path on an XP/ Win7 operating STRING system. cnst_Pfw Sub Dir_Logging Subfolder for log files. STRING cnst_Pfw Sub Dir_Product Subfolder for product files. STRING cnst_Pfw Sub Dir_Machine Subfolder for machine files. STRING cnst_Pfw Sub Dir_Supply Subfolder for supply files. STRING b Pfw_Use Energy Recording Activation of a theoretical energy BOOL FALSE acquisition. b Pfw Run On_Win CE A TRUE activates the folder path for a BOOL TRUE CE operating system. 64 Version: 1.1.0 TF8540
## Page 65

PLC temperature controller Please note that the constants of the timer as well as the alarm visualization must also be taken into account. A heating zone in this library is an actuator (Solid State Relay - SSR or contactor), one or more heating tapes and a temperature sensor. If a calculated temperature is regarded as an actual value, this must be done in the application. Sample project The loading and saving of product and machine parameters as well as the general handling of the temperature library will be explained in more detail using the sample project. To start the application it is necessary to include the Pfw Lib_Temp Control.lib and to adjust the path for saving and loading the parameters. 3.7.1.2 Application Commissioning (parameterization) The following table lists all parameters necessary for initializing the temperature controller. After changes have been made to the parameters of the aaa Pfw Temp Mparam From Hmi, aaa Pfw Temp Pparam From Hmi, st Pfw Supply Line Cfg structures, they must be saved via the respective structure. For this purpose, the following variables are provided in each structure: • Save Delay: If a number in ms is entered here, the library counts from this number to zero. At zero, the file is saved and at -1, saving is inactive. • Save Param: Triggers immediate saving. • Load Param: Loads the parameters from the previously defined path. During saving, a backup file is always created, so that the validity of the data is ensured at all times. In the structure aaa Pfw Temp Mparam From Hmi[...] the machine data are initialized: TF8540 Version: 1.1.0 65
## Page 66

PLC temperature controller Variable Short description Example value Type Zone Name Name of the zone Z1 STRING Absolute High Temperature upper limit for alarm and 250 °C LREAL shutdown Absolute Low Temperature lower limit for alarm and shutdown 40 °C LREAL Extruder Comp TRUE: active; FALSE: inactive FALSE BOOL Kp Cool P gain from PID controller (heating) ... %/°C LREAL Kp Heat P gain from PID controller (cooling) .. %/°C LREAL Gain PIDCool Overall gain in temperature control during LREAL cooling. Gain PIDHeat Overall gain of temperature control during LREAL heating. Td Cool The D part (damping time) of the temperature ... s LREAL controller (cooling) Td Heat The D part (damping time) of the temperature ... s LREAL controller (heating) Tn Cool Integral action time from PID controller ... s LREAL (heating) Tn Heat Integral action time from PID controller (cooling) ... s LREAL Tv Cool The D part (derivative action time) of the ... s LREAL temperature controller (cooling) Tv Heat The D part (derivative action time) of the ... s LREAL temperature controller (heating) Overshoot Overshoot after self-optimization ... °C LREAL Tracking_Td Time constant for control with large setpoint ... s LREAL changes Ramping_Rate Ramp slope in °C/min ... °C/min LREAL Ramping_Tolerance Up to which setpoint step-change should a 5 °C LREAL ramp be used? d Tmax max. slope of the path for a step response ... °C/s LREAL Sensor Offset Offset temperature from temperature sensor 0 °C LREAL Settling Time path-specific time base 5 s LREAL Supply Load_Cooler Cooling capacity 100 W LREAL Supply Load_Heater Heating capacity 1000 W LREAL Supply Load_Tolerance If the measured heating power deviates from LREAL this tolerance, an alarm is triggered. Tune End Final temperature of self-tuning in relation to 80% LREAL setpoint [%] Tune Kp Setting factor for the Kp value 1.2 LREAL Tune Td Setting factor for the Td value 0.25 LREAL Tune Tn Setting factor for the Tn value 2 LREAL Tune Tv Setting factor for the Tv value 0.5 LREAL Tune Y Power output during self-tuning 100% LREAL Tune Tracking Td Setting factor for the Tracking Td value 0 LREAL L_Load Idle Discharge resistance to the environment 2 W/°C LREAL Error Heating Factor Heating factor with control switched off 20 % LREAL f Pwm Std Max On Time Maximum heating on time when the setpoint is 0.0 LREAL selected. At zero the Max PWMOn Time of the Supply Line is used. Value range 0.0...1.0 f Pwm Max On Time Maximum heating on-time when one of the 20 % LREAL setpoints in the array is selected. At zero the Max PWMOn Time of the Supply Line is used. Value range 0.0...1.0 66 Version: 1.1.0 TF8540
## Page 67

PLC temperature controller Variable Short description Example value Type f Pwm Min On Time Minimum heating on time when the setpoint is 20 % LREAL selected. At zero the Pwm Min On Time of the Supply Line is used. Value range 0.0...1.0 Weighting_C Factor between the determined heating and LREAL cooling parameters fc_On Time Switch-on time of forced cooling LREAL fc_Off Time Duration for normal regulation LREAL Act Temp Filter Filter time of the actual temperature filtering 0.1 s LREAL Output Sel_H Heating signal selection (see 1 INT E_Tc Pfw_Tctrl Out Select) Output Sel_C Cooling signal selection (see 3 INT E_Tc Pfw_Tctrl Out Select) Temp Sens Term Sensor terminal type must be selected by E_Tc Pfw_Terminal Type. If the existing terminal is not available in E_Tc Pfw_Terminal Type, E_Tc Pfw_Terminal Type.e Tc Pfw Term T_Custom ized can be selected as the terminal type. Sensor Type Type of sensor must be selected by E_Tc Pfw_Temp Sens Type. Term Channel Sensor terminal channel 1 INT Extruder Id Extruder number 1 INT Module Id Assigns a temperature group to zones 1 INT Zone Id Numbering of the zone of a machine 1 INT Supply Id Supply group to distribute the power evenly 2 INT among the three phases CJ_Comp Mode CJ_Comp Zone Sens Term Swap Idx Heater Swap Idx Cooler Swap Idx In Use TRUE: zone in use; FALSE: zone not in use TRUE The zone is only active in case of feedback from ST_Tc Pfw_Temp To Hmi_Itf[x]. In Use. Requirement: Module Id<>0; Zone Id<>0; Supply Id<>0 Use Cooling Zone has a cooling. TRUE BOOL Extruder Comp Ena Enabling extruder compensation FALSE BOOL Tune Cooling Self-optimization for cooling FALSE BOOL Tune_Idle Load Self-optimization for Idle Load determination. TRUE BOOL This would follow the heating power determination. Autotune Self-optimization for heating FALSE BOOL Enable Zone is active TRUE BOOL Update The user interface indicates that values in this FALSE BOOL structure have been changed. Enable Act Temp Filter Enabling actual temperature filtering. FALSE BOOL Ena Extruder Block reserved FALSE BOOL No Fan While Track Down Do not use a fan when cooling down. FALSE BOOL Ena_Tune Idle Load Enable calculation of the discharge resistance. FALSE BOOL Looptest Update Enable power measurement in this zone. FALSE BOOL Enable Error Heating Enable that the heating tape is supplied with a FALSE BOOL predefined power (Error Heating Factor). TF8540 Version: 1.1.0 67
## Page 68

PLC temperature controller Variable Short description Example value Type No Fan While Track Down reserved FALSE BOOL Ena_Tune Idle Load reserved FALSE BOOL Openloop Heating Set output with a predefined output FALSE BOOL fc_Enable Enabling forced cooling FALSE BOOL Hibernate I_Cool Freezing of the I part for heating FALSE BOOL hibernate I_Heat Freezing the I part for cooling FALSE BOOL b Saving Params Signal that machine data are currently being BOOL stored. b Load Params Loads the machine data FALSE BOOL Read Back reserved FALSE BOOL In the structure aaa Pfw Temp Pparam From Hmi[...] the product data are initialized: Variable Short description Example value Type Note Setpoint Setpoint during operation 180 °C LREAL must be parameterized Standby Setpoint Setpoint in standby 60 °C LREAL must be parameterized Threshold_M The inner negative -5 °C LREAL must be parameterized tolerance limit, referred to the setpoint (threshold for the on-off controller) Threshold_MM The outer negative -10 °C LREAL must be parameterized tolerance limit, referred to the setpoint Threshold_P The inner positive +5 °C LREAL must be parameterized tolerance limit, referred to the setpoint (threshold for the on-off controller) Threshold_PP The outer positive +10 °C LREAL must be parameterized tolerance limit, referred to the setpoint Update The user interface BOOL optional indicates that values in this structure have been changed, relative to the setpoint. In the structure st Pfw Supply Line Cfg[...] the settings for the PWM are initialized and the connection between a zone and the supply network is established. This information is only important for heating power monitoring and zooning. If both are not used, it is sufficient to initialize the array with one element. Plastics machines are sometimes designed to contain several temperature control groups (extruders1..n, heating channels, etc.). These are partly supplied separately. These supply units are called supply groups in the framework. Each supply group consists of four supply lines (phase 1..3 and multi-phase elements) . Several heating zones can be connected to one supply line. The first supply line of a group represents the supply for the heating zones, which are connected between L1 and the neutral conductor. The second for L2 and N and the third for L3 and N. The fourth supply line includes all heating zones that are connected between two outer conductors in star or delta. 68 Version: 1.1.0 TF8540
## Page 69

PLC temperature controller Variable Short description Example value Parameterization level f Pwm Cycle Time PWM cycle time 0.1 s LREAL yes f Pwm Max On Time PWM maximum switch-on 0.9 for 90% LREAL yes time (related to cycle time) f Pwm Min On Time PWM minimum switch-on 0.1 for 10% LREAL yes time (related to cycle time) f Pwm Max On C PWM maximum switch-on 0.1 for 10% LREAL yes time (related to the cycle time) for cooling f Pwm Max Ramp Load reserved LREAL optional f Act Supply Load If a power measurement is ... W LREAL optional performed, the current power can be read here. f Act Supply Current If a power measurement is ... W LREAL optional performed, the current currently measured can be read here. f Supply Load The predicted total power ... W LREAL optional of the supply line. f Supply Match The ratio of LREAL optional f Act Supply Load to f Supply Load n Pwm Factor C For PWM cooling, 1 INT must be parameterized n Pwm Factor C is multiplied by "f Pwm Cycle Time" (reason: cooling is often controlled via contactors). In the structure aaa Pfw Temp To Hmi[...] the following display values are written back to the HMI: TF8540 Version: 1.1.0 69
## Page 70

PLC temperature controller Variable Short description Actual Temp Current temperature of the zone LREAL Supply Match Current measured power ratio (actual power/target power) LREAL Act Current Current measured from the zone LREAL File Err Id Error number if loading or saving of the machines or product data DINT fails. Error Id Error number WORD Module Id Module number INT Power Level Heating power output of the controller LREAL Zone Id Zone number INT Cooling The zone is cooling. BOOL Enable The zone controls to its setpoint. BOOL Error The zone is heating. BOOL Heating The zone is in error state. BOOL File Err The zone could not successfully load or save the machine or product BOOL parameters. In Use Zone is used. BOOL In the machine parameters must be: Module Id<>0; Zone Id<>0; Supply Id<>0 and In Use:=TRUE On Stand By Standby temperature is active as setpoint. BOOL Tuning Active Self-optimization active BOOL Tuning Done Self-optimization successful BOOL Idle Load Active Calculation of the discharge resistance active BOOL Idle Load Done Calculation of the discharge resistance successful BOOL Looptest Active Activation of the power control of the individual heating tapes BOOL Extruder Comp Active Feedback that the extruder compensation is being taught. BOOL Extruder Comp Done Feedback that the extruder compensation was successfully taught. BOOL 3.7.1.3 Mapping System Manager The following variables must be linked for each temperature sensor: • EL terminal (EL33xx): 70 Version: 1.1.0 TF8540
## Page 71

PLC temperature controller Terminal vari- PLC variable Comment able Value in_Pfw Temp Ctrl Input[...]. EL_Sns_Data Process value Underrange in_Pfw Temp Ctrl Input[...]. EL_Sns Underrun The temperature has fallen below the lower temperature range of the sensor. Overrange in_Pfw Temp Ctrl Input[...]. EL_Sns Overrun The upper temperature range of the sensor has been exceeded. Error in_Pfw Temp Ctrl Input[...]. EL_Sns Error The channel of a terminal supplies an error. Wc State in_Pfw Temp Ctrl Input[...]. EL_Sns Wc State If the value is 0, the terminal data is valid; if the value is 1, the data is invalid. The terminal variable must be linked to each PLC channel used by this terminal (multiple linking). Ads Addr in_Pfw Temp Ctrl Input[...]. EL_Ads Addr Address for communication with the terminal. The terminal variable must be linked to each PLC channel used by this terminal (multiple linking). State in_Pfw Temp Ctrl Input[...]. EL_Sns State General terminal status The terminal variable must be linked to each PLC channel used by this terminal (multiple linking). • KL terminal (KL33xx): Terminal vari- PLC variable Description able Data In in_Pfw Temp Ctrl Input[...]. KL_Sns Data Data input State in_Pfw Temp Ctrl Input[...]. KL_Sns State Terminal state Data out out_Pfw Temp Ctrl Output[...]. KL_Sns Data Data output Ctrl out_Pfw Temp Ctrl Output[...]. KL_Sns Ctrl To register communication • Via aaa Pfw Temp Mparam From Hmi[..]. Output Sel_C a cooling signal is selected in the PLC, which must be linked to the System Manager by out_Pfw Temp Ctrl Output[...]. Sel Out Neg. • Via aaa Pfw Temp Mparam From Hmi[..]. Output Sel_H a heating signal is selected in the PLC, which must be linked to the System Manager by out_Pfw Temp Ctrl Output[...]. Sel Out Pos. 3.7.1.4 Self-optimization After the library is included and all parameters are predefined, a self-optimization should be performed. The following parameters are relevant for this purpose: • Tune Cooling: If the zone has cooling (Use Cooling must be TRUE and the output type must be set Output Sel_H), separate parameters can be determined for the cooling. • Tune_Idle Load: A TRUE triggers the determination of the pre-control part during self-optimization. • Tune Y: Specifies the amount of heating power output during self-optimization. • Tune End: After Tune End/100* setpoint the output is switched off and the overshoot is determined. It should be guaranteed that after overshooting the actual temperature is below the set temperature. Self-optimization is started via the signal ST_Tc Pfw_Temp Mparam From Hmi_Itf[...]. Autotune. Then ST_Tc Pfw_Temp To Hmi_Itf[...]. Tuning Active becomes TRUE. If this is not the case, it was aborted with error. After the autotune was successful, this is indicated in ST_Tc Pfw_Temp To Hmi_Itf[...]. Tuning Done via a TRUE. Self-optimization can be aborted at any time by setting ST_Tc Pfw_Temp Mparam From Hmi_Itf[...]. Autotune to FALSE. TF8540 Version: 1.1.0 71
## Page 72

PLC temperature controller Prerequisite for successful self-optimization is that the controller is active (ST_Tc Pfw_Temp Mparam From Hmi_Itf[...]. Enable) and has stabilized to standby temperature. It is recommended that the actual temperature is close to the ambient temperature. The difference between the current temperature and the operating point temperature should be at least 40.0 °C. After activating the autotune, the temperature is monitored for a certain time to check if it is stable. Subsequently, a control value in the amount of Tune Y is output. If the actual temperature cuts ST_Tc Pfw_Temp Mparam From Hmi_Itf[...]. Tune End*ST_Tc Pfw_Temp Pparam From Hmi_Itf[...]. Setpoint, the setpoint output is switched off and the overshoot is observed. 3.7.2 Alarm handling Overview of the Plastics Processing Framework alarms The following alarm conditions are continuously monitored by the temperature controller: • Absolute temperatures (high and low): ◦ the actual temperature is below aaa Pfw Temp Mparam From Hmi[...]. Absolute Low, the global flag aaa Temp Alarm_Absolute Low is set to TRUE. As soon as the actual temperature exceeds the threshold, aaa Temp Alarm_Absolute Low becomes FALSE again. 72 Version: 1.1.0 TF8540
## Page 73

PLC temperature controller ◦ if the actual temperature is above aaa Pfw Temp Mparam From Hmi[...]. Absolute High, the global flag aaa Temp Alarm_Absolute High is set to TRUE. As soon as the actual temperature falls below the threshold, aaa Temp Alarm_Absolute High becomes FALSE again. As soon as aaa Temp Alarm_Absolute High is active, the corresponding zone is switched off. After falling below the limit, the zone returns to regulated operation. • Relative temperatures (in two bands around the setpoint): ◦ if the actual temperature is below aaa Pfw Temp Pparam From Hmi[...]. Threshold_MM, the global flag aaa Temp Alarm_Low Low is set to TRUE. As soon as the actual temperature exceeds the threshold, aaa Temp Alarm_Low Low becomes FALSE again. ◦ if the actual temperature is below aaa Pfw Temp Pparam From Hmi[...]. Threshold_M, the global flag aaa Temp Alarm_Low is set to TRUE. As soon as the actual temperature exceeds the threshold, aaa Temp Alarm_Low becomes FALSE again. ◦ if the actual temperature is above aaa Pfw Temp Pparam From Hmi[...]. Threshold_PP, the global flag aaa Temp Alarm_High High is set to TRUE. As soon as the actual temperature falls below the threshold, aaa Temp Alarm_High High becomes FALSE again. ◦ if the actual temperature is above aaa Pfw Temp Pparam From Hmi[...]. Threshold_P, the global flag aaa Temp Alarm_High is set to TRUE. As soon as the actual temperature falls below the threshold, aaa Temp Alarm_High becomes FALSE again. • If the constant cnst_pfw_sel Rel Alarm is TRUE, the relative alarms refer to the entered set temperature, otherwise to the internally ramped set temperature. • Error messages from the terminal: TF8540 Version: 1.1.0 73
## Page 74

PLC temperature controller ◦ Are passed on via ST_Tc Pfw_Temp To Hmi_Itf[...]. Error and ST_Tc Pfw_Temp To Hmi_Itf[...]. Error Id. ◦ The associated zone is then switched off. ◦ By activating the error heating in the machine parameters, the zone is further kept at temperature. • Error messages during autotune: ◦ Are passed on via ST_Tc Pfw_Temp To Hmi_Itf[...]. Error and ST_Tc Pfw_Temp To Hmi_Itf[...]. Error Id. • Misbehavior during heating: ◦ If the actual value of a zone does not react to the setpoint change during heating up, an error is output and the zone switches off. 3.7.3 Heating current monitoring In the Plastics Processing Framework, heating tape monitoring is called "Looptest". This allows to detect the following malfunctions of a heating zone: • Condition of the actuators ◦ Shorted Solid State Relays (SSR) ◦ "Sticking" contactors • Condition of the heating tapes ◦ Partial and total failure ◦ Performance losses due to aging Plastics machines are sometimes designed to contain several temperature control groups (extruders1..n, heating channels, etc.). These are partly supplied separately. These supply units are called supply groups in the framework. Each supply group consists of four supply lines and one power measurement terminal. Several heating zones can be connected to one supply line. Each heating zone contains an actuator (solid state relay - SSR or contactor), one or more heating tapes and a temperature sensor. The first supply line of a group represents the supply for the heating zones, which are connected between L1 and the neutral conductor. The second for L2 and N and the third for L3 and N. The fourth supply line includes all heating zones that are connected between two outer conductors in star or delta. In the parameters of a heating zone, it is now possible to set in which supply line the zone is located and thus to which supply group it belongs. Furthermore, the nominal output of the heating element can be set in the parameters. This information is necessary so that the Looptest can assign the zone, test it and interpret its measurement. In the Plastic Processing Framework, there is one loop test per supply group. This passes through all heating zones. If it finds a zone that belongs to its supply group, it starts a measurement. For this purpose, all elements belonging to this group are switched off and the power is determined. This should be zero. If this is not the case, an actuator is defective. After a time t (default setting 200 ms) has elapsed, the heating Looptest element is switched on for the same time and the power is determined. This is compared with the nominal output of the heating zone. If it deviates by a set percentage value, an error is displayed. After that, the control is active for 10 seconds. The self-generated additional heating power is taken into account in the controller. After that, the next zone of the same supply group is searched. The following figure illustrates this with an example. It is assumed that a plant has only one supply group, for example an extruder with n zones. The loop test is active and finds zone 1. As described before, all zones are switched off first and the power is measured. Zone 1 is then switched on for t and the power is Looptest measured again. In a cycle of 10 seconds, the next zone is tested using the same procedure. 74 Version: 1.1.0 TF8540
## Page 75

PLC temperature controller The EL3403 calculates the power over an interval of 10 periods by default. The calculated power is then filtered using low-pass and high-pass filters. In addition, solid state relays, especially those that switch in zero crossing, have a not inconsiderable switching time. This leads to the fact that in some cases a usable power is measured only after 500 ms. With an interval of one period, the time could be reduced to 200 ms. Nevertheless, measuring errors of around 10% can occur under certain circumstances. If a correspondingly longer measuring time (e.g. 400 ms) is kept available, the accuracy increases considerably. An advantage of the x L3403 terminals is that the calculation of the power takes place within the terminal and thus no PLC computing time is required. Implementation: The following points must be observed for the implementation: • FB_Power Measurement_Tc Pfw: This function block must be instantiated according to the number of terminals. • ST_Tc Pfw_Power Measurement_Cfg: Must be created as ARRAY according to the terminal number. • ST_Tc Pfw_Power Measurment_Ctrl: Must be applied as ARRAY according to the terminal number. • ST_Tc Pfw_x L3403_State: Must be applied as ARRAY according to the terminal number. Even if no x L3403 is in use. The mapping structures provided by the library for mapping to the power measurement terminal must be used and passed to the FB_Power Measurement_Tc Pfw function block as an address. NOTICE The pointer address and the stored terminal type must match at all times. Otherwise there will be wrong memory accesses. 3.7.4 Parameters saving/loading The structures ST_Tc Pfw_Temp Mparam From Hmi_Itf, ST_Tc Pfw_Temp Pparam From Hmi_Itf, ST_Tc Pfw_Supply Param contain parameters that must be stored remanently. The following variables are stored in each structure for this purpose: • Save Delay: Time-delayed saving. After a parameter change, a time-delayed saving can be performed here via a number in milliseconds. Based on the entered value, the library automatically counts down this number to zero. At zero the saving routine is triggered internally and at -1 the saving delay is inactive. • b Load Params: The parameters of the corresponding structure can be loaded via a TRUE TF8540 Version: 1.1.0 75
## Page 76

PLC temperature controller • b Saving Params: Feedback that parameters are being saved. The path C:\Data must be created on the target system so that the parameter files can be created. The corresponding subdirectories within this folder are generated automatically after the first save. The following flow chart should make clear how the saving process works. During saving, a temporary file is created first. Then the backup file is deleted and the original file is converted to a backup file. As a final step, the temporary file is converted into an "original file". This mechanism ensures that there is always a completely saved parameter file. 76 Version: 1.1.0 TF8540
## Page 77

PLC temperature controller When loading a product via b Load Params the following process checks whether the saved file is consistent. TF8540 Version: 1.1.0 77
## Page 78

PLC temperature controller 3.7.5 Supply groups A supply line represents a supply unit. For heating power monitoring and for distributed switch-on (zoning), it must be known which zone is connected to which supply line. As a rule, the supply consists of one, two or more phases of a three-phase network. Heating tapes that are connected between phase 1 and neutral conductor must get a 1 in the MParam. Supply ID. Heating tapes connected between phase 2 and neutral conductor are assigned a 2 in the Mparam. Supply ID. Heating tapes connected between phase 3 and neutral conductor are assigned a 3 in the Mparam. Supply ID. Multiphase heating tapes (two-phase or three-phase) are assigned a 4 in the Mparam. Supply ID. 78 Version: 1.1.0 TF8540
## Page 79

PLC temperature controller Heating tape Supply ID L1-N 1 L2-N 2 L3-N 3 Multiphase (L1 - L2; L2-L3; L1-L2-L3; etc) 4 If there is more than one supply for the heaters, there must be at least one power measurement terminal for each supply. This can be the case, for example, with several extruders that are operated on one control system. The numbering of the subsequent supply groups is consecutive. This means that supply group 2 has been assigned Supply IDs 5,6,7,8. The constant cn Pfw App Supply Last must be at least equal to the largest value of the Mparam. Supply ID. This constant defines the size of the Temp Ctrl_ST_Tc Pfw_Supply Param array. The Supply Params represent essential properties of the output generation, like the PWM cycle time, minimum and maximum switch-on time. TF8540 Version: 1.1.0 79
## Page 80

PLC temperature controller 3.7.6 FAQs Name Description FAQ#1 [} 80] What are the hardware requirements? FAQ#2 [} 80] What are the software requirements? FAQ#3 [} 80] Can a zone heat in case of sensor failure? FAQ#4 [} 81] How can I redirect the output of heating and cooling signals? FAQ#5 [} 81] How can I redirect the acquisition of the actual temperature? FAQ#6 [} 81] How does the Idle Load Tuning work? FAQ#7 [} 81] How does extruder compensation work? FAQ#8 [} 81] What should I do in case of malfunction? FAQ#1: Hardware requirements An IPC with x86 architecture and hardware FPU. Computing power requirements and fieldbus support must be clarified in each case. Examples: • DIN-rail PCs of the types CX1010, CX1020 or CX1030. • DIN-rail PCs of the types CX50xx. • DIN-rail PCs of the types CX51xx. • DIN-rail PCs of the types CX20xx. • Control cabinet PCs of the families C41xx, C61xx, C62xx, C69xx. • Panel PCs of the families CP62xx, CP72xx, CP67xx, CP22xx, CP32xx and CP37xx. • Other PC families are usually suitable as well. This must be clarified in each individual case. Alternatively, an IPC with i XP architecture and FPU emulation. Here, there may be restrictions on the number of zones and/or the cycle time. • DIN-rail PCs of the types CX9010 or CX9020. • Panel PCs of the families CP66xx and CP26xx. A fieldbus architecture with suitable performance: • Preferably Ether CAT • Alternatively, one of the following fieldbuses (cycle times of 10 ms or less should be aimed for): ◦ Light Bus ◦ RT Ethernet ◦ Profibus with 12 MBaud FAQ#2: Software requirements A Microsoft operating system of the type Windows CE 6, Windows Embedded Compact 7, Windows XP, Windows XPe. An executable and licensed Twin CAT system, released for at least Twin CAT PLC. A licensed copy of the Plastics Temperature Control Framework Library Pfw Lib_Temp Control. LIB, version V1.0.1 or higher. A provided Plastics Framework App Extension project Pfw Lib_Temp Control App Extension. PRO whose version matches the Plastics Temperature Control Framework Library version. FAQ#3: Heating in case of sensor failure In the event of a temperature sensor failure, it may be necessary to continue operating the machine. In such a case, the library can be made to estimate the power demand of the zone and output the corresponding heating signal. A number of preconditions have to be met: 80 Version: 1.1.0 TF8540
## Page 81

PLC temperature controller • The signal type must be set to e Tc Pfw Tc Out_PWM. • The zone must be fully commissioned beforehand. Above all, the Idle Load Tuning must have been done with sufficient accuracy. • This option should not be enabled in adjacent zones. Otherwise, the risk of overheating of the heating tapes and the material increases due to the uncontrolled output of the power. NOTICE This option must never be activated in zones that receive excess energy (friction, discharge from neighboring zones) from the process during operation. To enable the option, set Enable Error Heating to TRUE in the machine data. A value in the range 0...1 in Error Heating Factor can be used to specify which portion of the estimated power should be output. If the set temperature of the zone is changed, Error Heating Factor does not need to be adjusted. The estimation will automatically adjust the required power. FAQ#4: Redirecting heating and cooling signals If a digital output of the PLC is defective, the operator can connect this digital output to another free output and then redirect the corresponding signal to the other output in the HMI. In order to use this feature, various settings must be made in the temperature library. Since the commissioning of the I/O redirection is somewhat more sophisticated, contact the support in this case. If you do not want to use this feature, the settings in the step-by-step commissioning are to be applied. FAQ#5: Redirect actual temperature acquisition If an analog input of the PLC is defective, the operator can connect this analog input to another free input and then redirect the corresponding signal to the other input in the HMI. In order to use this feature, various settings must be made in the temperature library. Since the commissioning of the I/O redirection is somewhat more sophisticated, contact the support in this case. If you do not want to use this feature, the settings in the step-by-step commissioning are to be applied. FAQ#6: The Idle Load Tuning The prerequisite for determining the base load is: • the system must be stable (control deviation of less than 1 °C) • the setpoint must be greater than 70 °C • there must be no disturbances acting on the system (rotating screw). The actual value is not excited during base load determination. Only internal calculations take place. The determination takes several seconds, after which the determined value is automatically included in the control. FAQ#7: Extruder compensation Prerequisite for determining the extruder compensation: • the system must be stable (control deviation of less than 1 °C) • the screw speed must have reached the working speed After the extruder compensation has been determined, it is not active. Only when the parameter Extruder Comp Ena from the machine parameters receives a TRUE, it also becomes effective. With correct extruder compensation, the actual temperature behaves much more smoothly when the screw is switched on or off than without compensation. FAQ#8: Behavior in case of malfunction Take screenshots of the machine and product parameters. Record the behavior using the scope. TF8540 Version: 1.1.0 81
## Page 82

PLC temperature controller 3.7.7 Global variables Error Codes 82 Version: 1.1.0 TF8540
## Page 83

PLC temperature controller Name hex dec Description Error-heat- ing dw Tc Pfw Temp Err No Erro 16#0000 0 No error. r dw Tc Pfw Temp Err Illegal 16#0706 1798 Parameter has a value that is not allowed. x Value Example: Temp Sens Term is not allowed. The selected sensor does not match the selected terminal. dw Tc Pfw Temp Err Busy 16#0708 1800 Terminal is already active. x FB_Temp Ctrl Callback_Tc Pfw() reports this error if it finds the communication path busy. dw Tc Pfw Temp Tune Err_ 16#1001 4097 During autotuning this error is reported if No Sig Type Output Sel_H does not select an active signal. dw Tc Pfw Temp Tune Err_ 16#1002 4098 In autotuning, this error is reported when the Parameter tuning parameters are not allowed. dw Tc Pfw Temp Tune Err_ 16#1003 4099 During autotuning, this error is reported if the No Travel setpoint step-change is <25 °C. dw Tc Pfw Temp Tune Err_ 16#1004 4100 During autotuning, this error is reported if the No Settling actual temperature of the zone is not stable before the heating test (actual temperature fluctuates by >2 °C). dw Tc Pfw Temp Tune Err_ 16#1005 4101 This error is reported when autotuning has Aborted been aborted by operator intervention. dw Tc Pfw Temp Tune Err_ 16#1006 4102 During the heating or cooling test, an Short Of Points insufficient number of measuring points was determined. dw Tc Pfw Temp Tune Err_ 16#1007 4103 When evaluating the measuring points of a No Top heating or cooling test, no inflection point (= point of maximum slope) was determined. dw Tc Pfw Temp Tune Err_ 16#1008 4104 The measured values cannot be evaluated. No Response The zone has not responded or the measured values are heavily disturbed. dw Tc Pfw Temp Err Not Su 16#4107 16647 FB_Temp Ctrl Callback_Tc Pfw() reports this pport error if the terminal used does not support a required functionality. Example: The linked terminal is not of the specified type. dw Tc Pfw Temp Err Sns Un 16#4450 17488 The terminal reports an undershooting of the x derrun measuring range. dw Tc Pfw Temp Err Sns Ov 16#4451 17489 The terminal reports that the measuring x errun range has been exceeded. dw Tc Pfw Temp Err Sns Hd 16#4464 17508 The terminal reports an internal fault. x w Failed dw Tc Pfw Temp Err Discon 16#4FF0 20464 The connection to the terminal is interrupted. x ected Not all fieldbuses and I/O devices support connection monitoring. dw Tc Pfw Temp Err_No Re 16#4FF1 20465 Actual temperature does not respond to x sponse heating. dw Tc Pfw Temp Err Not Op 16#4FF2 20466 The terminal is not in an operable state. x erational dw Tc Pfw Temp Err Io Swa 16#4FF3 20467 I/O redirection causes a collision. The p Collision Sens Term Swap Idx variable in the machine parameters is probably not configured correctly. dw Tc Pfw Temp Err Ads Sw 16#4FF4 20468 Term Channel redirection causes an ADS ap Collision collision. The Sens Term Swap Idx variable in the machine parameters is probably not configured correctly. TF8540 Version: 1.1.0 83
## Page 84

PLC temperature controller Name hex dec Description Error-heat- ing dw Tc Pfw Temp Err Inherit 16#4FF5 20469 Hardware problem in another channel. ed Fault dw Tc Pfw Temp Err Over C 16#4FFE 20478 This error is generated when the deviation urrent between the actual heating power and the set heating power is greater than the specified tolerance. See power measurement dw Tc Pfw Temp Err Under 16#4FFF 20479 reserved. x Current dw Tc Pfw Temp Err Sns Co 16#5000 20480 reserved. x mm Failed Errorheating: if errorheating is active, heating power continues to be output for errors marked with x and the zone is kept at temperature. Declared global constants Name Description cnv_Supply Param_Tc Pfw Current version identifier of the ST_Tc Pfw_Supply Param structure. cnv_Temp Ctrl_Itf_Tc Pfw Current version identifier of the ST_Tc Pfw_Temp Ctrl_Itf structure. cnv_Temp Ctrl Input_Tc Pfw Current version identifier of the ST_Tc Pfw_Temp Ctrl Input structure. cnv_Temp Ctrl Output_Tc Pfw Current version identifier of the ST_Tc Pfw_Temp Ctrl Output structure. cnv_Temp Mparam From Hmi_Tc Pfw Current version identifier of the ST_Tc Pfw_Temp Mparam From Hmi_Itf structure. cnv_Temp Mparam File Vers Only for stand-alone operation: Current version identifier of the structure of the optional parameter file. cnv_Temp Pparam From Hmi_Tc Pfw Current version identifier of the ST_Tc Pfw_Temp Pparam From Hmi_Itf structure. cnv_Temp To Hmi_Tc Pfw Current version identifier of the ST_Tc Pfw_Temp To Hmi_Itf structure. 84 Version: 1.1.0 TF8540
## Page 85

PLC temperature controller Undeclared global constants Name Description Type Recommendation value/ maximum values cn Pfw Temp Ctrl First Initial index to set the size of the array INT 1 (recommended) and thus the number of zones that can be controlled. cn Pfw Temp Ctrl Last End index to set the size of the array INT 512 (depending on CPU) and thus the number of zones that can be controlled. cn Pfw Scope Sample First Initial index to set the size of the array INT 1 (recommended) and thus the number of memory points in the scope. cn Pfw Scope Sample Last End index to set the size of the array INT 32767 (max.) and thus the number of memory points in the scope. cn Pfw Temp Trend First Initial index to set the size of the array INT 1 (recommended) and thus the number of memory points in the trend. cn Pfw Temp Trend Last End index to set the size of the array INT 32767 (max.) and thus the number of memory points in the trend. cn Pfw App Supply First Initial index to set the size of the array INT 1 and thus the number of supply groups (usually 4; 1=phase 1, 2=phase 2, 3=phase 3 and 4 for multi-phase heating tapes). cn Pfw App Supply Last End index to set the size of the array INT 4 and thus the number of supply groups (usually 4; 1=phase 1, 2=phase 2, 3=phase 3 and 4 for multi-phase heating tapes). cn Pfw Bool Out Swap First Initial index of the array INT 1 out_Swapped Digital Out (I/O redirection). cn Pfw Bool Out Swap Last End index of the array INT 2 (when not in use) out_Swapped Digital Out (I/O redirection). cn Pfw Bool In Swap First Initial index of the array INT 1 in_Swapped Digital In (I/O redirection). cn Pfw Bool In Swap Last End index of the array INT 2 (when not in use) in_Swapped Digital In (I/O redirection). TF8540 Version: 1.1.0 85
## Page 86

PLC temperature controller Global variables of the framework Name Description aaa Pfw Temp Mparam From Hmi The machine parameters of the zones. aaa Pfw Temp Pparam From Hmi The product parameters of the zones. aaa Pfw Temp To Hmi The interfaces of the zones to the HMI. aaa Temp Alarm_Absolute High Collective message: Exceeding of the alarm threshold by at least one zone. aaa Temp Alarm_Absolute Low Collective message: At least one zone falls below the alarm threshold. aaa Temp Alarm_High Collective message: Exceeding of the positive inner tolerance threshold by at least one zone. aaa Temp Alarm_High High Collective message: Exceeding of the positive outer tolerance threshold by at least one zone. aaa Temp Alarm_Low Collective message: Exceeding of the negative inner tolerance threshold by at least one zone. aaa Temp Alarm_Low Low Collective message: Exceeding of the negative outer tolerance threshold by at least one zone. aaa Temp Fault_Reset Collective command: Reset of possible error states for all zones. b Pfw Temp Links Init Done reserved in_Pfw Temp Ctrl Input The input process images of the zones. out_Pfw Temp Ctrl Output The output process images of the zones. st Pfw Supply Line Cfg The parameters of the supply groups. st Pfw Temp Ctrl The runtime data of the zones. out_Swapped Digital Out For the redirection of digital output signals. This array provides the interface for linking the digital outputs. (I/O redirection) in_Swapped Digital In For redirecting digital input signals. This array provides the interface for linking the digital inputs. (I/O redirection) 86 Version: 1.1.0 TF8540
## Page 87

PLC timer 4 PLC timer 4.1 Overview Via the weekly timer it is possible to automatically transfer zones to different operating states. Memory and load routines are provided so that the set times are also available after a restart. The following table gives an overview of the provided function blocks and their meaning. Name Description FB_Clock Timer_Tc Pfw() [} 87] Switches the outputs on or off according to the set time. FB_Clock Timer Param Save_Tc Pfw() [} 87] Saves the timer settings. FB_Clock Timer Param Load_Tc Pfw() [} 88] Loads the timer settings. Data types: Structure types Name Description ST_Tc Pfw_Clock Timer Cam [} 90] Is a substructure of the structure ST_Tc Pfw_Clock Timer Itf. This is used to enter the switch-on and switch-off time. ST_Tc Pfw_Clock Timer Itf [} 89] The structure contains the interfaces for setting the timer. 4.2 Function blocks 4.2.1 FB_Clock Timer_Tc Pfw() The actual timer is implemented in this function block. It must be called cyclically and enables or disables the corresponding output ST_Tc Pfw_Clock Timer Itf. Q in the set time. Syntax VAR_INPUT udisecond : UDINT:=0; END_VAR Inputs Name Type Description udisecond UDINT Time of the task in microseconds 4.2.2 FB_Clock Timer Param Save_Tc Pfw() TF8540 Version: 1.1.0 87
## Page 88

PLC timer This function block saves the current settings of the timer as a binary file. Syntax VAR_IN_OUT Clock Itf : ST_Tc Pfw_Clock Timer Itf; END_VAR VAR_INPUT Idx: INT; Execute : BOOL:=FALSE; Path Name : STRING(80); END_VAR VAR_OUTPUT Done : BOOL:=FALSE; Error : BOOL:=FALSE; Error Id : UDINT:=0; END_VAR Inputs Name Type Description Idx INT Timer number Execute BOOL The storage process is started with a rising edge. Path Name STRING Path name where to save the timer settings. Inputs/outputs Name Type Description Clock Itf ST_Tc Pfw_Clock Time r Itf Outputs Name Type Description Done BOOL Feedback that saving was successful. Error BOOL Error while saving timer settings. Error Id UDINT Error number A positive edge at the Execute input activates the saving process. After a successful saving process, a Done is present for one cycle. If loading is not successful, an error with error number is returned. 4.2.3 FB_Clock Timer Param Load_Tc Pfw() This function block loads the saved settings of the timer. Syntax VAR_IN_OUT Clock Itf: ST_Tc Pfw_Clock Timer Itf; END_VAR VAR_INPUT Idx : INT; Execute : BOOL:=FALSE; Path Name: STRING(80); END_VAR 88 Version: 1.1.0 TF8540
## Page 89

PLC timer VAR_OUTPUT Done : BOOL:=FALSE; Error : BOOL:=FALSE; Error Id : UDINT:=0; END_VAR Inputs Name Type Description Idx INT Timer number Execute BOOL The loading process is started with a rising edge. Path Name STRING Path name where the timer settings can be loaded. Inputs/outputs Name Type Description Clock Itf ST_Tc Pfw_Clock Time Current settings of the timer as binary file. r Itf Outputs Name Type Description Done BOOL Feedback that loading was successful. Error BOOL Error while loading timer settings. Error Id UDINT Error number Behavior of the function block: A positive edge at the Execute input activates the loading process. After a successful loading process, a Done is present for one cycle. If loading is not successful, an error with error number is returned. 4.3 Structures 4.3.1 ST_Tc Pfw_Clock Timer Itf This structure must be declared in the global variables of the application. The structure contains the interfaces for setting the timer. In this structure the day of the week is selected as well as the time; when the timer is active and when it is inactive. Syntax TYPE ST_Tc Pfw_Clock Timer Itf: (* location Pfw Lib_Common. PRO *) (* last modification: 08.07.2008 *) STRUCT (* see cnv_Clock Timer Itf_Tc Pfw for format information *) Q : ARRAY[cn Pfw Clock Timer Cam First..cn Pfw Clock Timer Cam Last] OF BOOL:=FALSE; Day: ARRAY[1..7,cn Pfw Clock Timer Cam First..cn Pfw Clock Timer Cam Last] OF ST_Tc Pfw_Clock Timer Cam; END_STRUCT END_TYPE TF8540 Version: 1.1.0 89
## Page 90

PLC timer Parameter Name Type Description Q ARRAY OF BOOL Is a one-dimensional array in which the number of outputs per timer is specified. This allows a zone to assume up to 9 different operating states per day. Day ARRAY OF Is a two-dimensional array in which the first number indicates the ST_Tc Pfw_Clock Timer Cam day of the week (1=Monday, 2=Tuesday, ..., 7=Sunday) and the second number indicates the number of the timer. 4.3.2 ST_Tc Pfw_Clock Timer Cam Is a substructure of the structure ST_Tc Pfw_Clock Timer Itf. This is used to enter the switch-on and switch-off time. Syntax TYPE ST_Tc Pfw_Clock Timer Cam: (* location Pfw Lib_Common. PRO *) (* last modification: 05.06.2008 *) STRUCT (* see cnv_Clock Timer Cam_Tc Pfw for format information *) On : ARRAY[1..3] OF INT; Off : ARRAY[1..3] OF INT; END_STRUCT END_TYPE Parameter Name Type Description On ARRAY OF INT After the time entered in On by the operator, the corresponding output becomes active. In the first place On[1] is the hour with the value range 0...23, in the second place On[2] the minute with the value range 0...59 and in the third place On[3] the second with the value range 0...59. Off ARRAY OF INT After the time entered in Off by the operator, the corresponding output becomes inactive. In the first place On[1] is the hour with the value range 0...23, in the second place Off[2] the minute with the value range 0...59 and in the third place Off[3] the second with the value range 0...59. 4.4 Knowledge Base 4.4.1 Commissioning These commissioning instructions assume that the temperature controller is fully commissioned. In the first step it is necessary that an array of type ST_Tc Pfw_Clock Timer Itf is created in the global variables. The array size reflects the number of weekly timers. Subsequently, the following constants are to be created: 90 Version: 1.1.0 TF8540
## Page 91

PLC timer Constant definition Variable Short description Example Maximum values value cn Pfw App Clock Timer First Initial index to set the size of the 1 1 array and thus the number of weekly timers. cn Pfw App Clock Timer Last End index to set the size of the 2 Limited by array and thus the number of computing power weekly timers. and memory cn Pfw Clock Timer Cam First Initial index to set the size of the 1 1 array and thus the number of channels per weekly timer. cn Pfw Clock Timer Cam Las3 End index to set the size of the 3 9 array and thus the number of channels per weekly timer. Parameterization In order to transfer the correct time to the timer, the following structure must be observed: The structure ST_Tc Pfw_Clock Timer Itf is divided into Q and Day, where Day is a two-dimensional array. The first index indicates the number of the day of the week (1=Monday, 2=Tuesday,3=Wednesday, 4=Thursday, 5=Friday, 6=Saturday, 7=Sunday) and the second index indicates the number of the corresponding channel. This two-dimensional array is again divided into an On-Array and an Off-Array. Both On-Array and Off-Array has three elements for: • On/Off[1]=hour in the value range 0...23, • On/Off[2]=minute in the value range 0...59, • On/Off[3]=second in the value range 0...59. This is used to set the switch-on and switch-off time and to set output Q accordingly. Parameterization A very simple application has been prepared as a sample project. • All program lines referring to the weekly timer are marked with (*Clock Timer*). • If different times are entered into the array during the running program, the corresponding output will be active at the corresponding times. • Example: ◦ On Tuesday from 17:00 to 18:00 standby / the output st Clock Timer[1]. Q[1] must activate the controller in the application. TF8540 Version: 1.1.0 91
## Page 92

PLC timer 4.4.2 Global variables Error Codes No error codes are defined. If an error code is issued, it must be consulted in the Information System because it is an error of another library. Declared global constants Name Description cnv_Clock Timer Param File Vers Current version identifier cnv_Clock Timer Itf_Tc Pfw Current version identifier of the ST_Tc Pfw_Clock Timer Itf structure. cnv_Clock Timer Cam_Tc Pfw Current version identifier of the ST_Tc Pfw_Clock Timer Cam structure. Undeclared global constants Name Description Maximum values cn Pfw Clock Timer Cam First Initial index to set the size of the array and thus 1 the number of channels per weekly timer. cn Pfw Clock Timer Cam Last End index to set the size of the array and thus the Limited by computing number of channels per weekly timer. power and memory cn Pfw App Clock Timer First Initial index to set the size of the array and thus 1 the number of timers. cn Pfw App Clock Timer Last End index to set the size of the array and thus the 9 number of timers. 92 Version: 1.1.0 TF8540
## Page 93

PLC timer 4.4.3 FAQs Name Description FAQ#1 Which time inputs are allowed? [} 93] FAQ#2 How is the time calculated? Is summer/winter time taken into account? Are leap years taken into account? [} 93] FAQ#3 How do I activate a time over several days? [} 93] FAQ#4 Can I specify multiple switching times via a timer? [} 93] FAQ#1: Time inputs A 24h time specification is necessary, i.e.: • Hour: value range 0...23 • Minute: value range 0...59 • Second: value range 0...59 FAQ#2: How is the time calculated? The time is determined from the time in the computer. It is important that this time is set correctly. Since the computer recognizes a summertime/wintertime changeover, this is also recognized in the control. Since the computer knows the leap years, these are also recognized in the control. FAQ#3: Activate time over several days In the structure ST_Tc Pfw_Clock Timer Cam the start time is entered at On and at Off the time 23:59:59 must be entered. On the following day, 00:00:00 is entered at On and Off is entered when the system is to be switched off again. In this case, the heating is not turned off for a second at midnight, but remains active. FAQ#4: Specify multiple switching times via a timer It is possible to create 9 channels per weekly timer. A switch-on time and a switch-off time are specified for each channel, as well as an output. TF8540 Version: 1.1.0 93
## Page 94

PLC alarm visualization 5 PLC alarm visualization 5.1 Overview Ready-made function blocks are provided for displaying, disabling, deleting and managing messages (alarms, warnings, etc.). The temperature control itself only provides an Error ID and an error flag in case of an error. Messages are entered and activated by the function block FB_Msg Append_Tc Tv A() in an array of the type ST_Tc Tv A_Alarm_Itf (alarm history). If the cause of a message has been eliminated, this message can be disabled via Reset. The deactivation of a message takes place via the function block FB_Msg Deactivate_Tc Tv A(). Afterwards the message can be deleted by calling the function block FB_Msg Clear Pending_Tc Tv A() in the alarm history. So that no empty lines are created in the alarm history by deleted messages, the function block FB_Msg Garbage Collect_Tc Tv A() must be called cyclically. Data types: function blocks Name Description FB_Msg Append_Tc Tv A() [} 94] Activates an active error message in the array of type ST_Tc Tv A_Alarm_Itf. FB_Msg Clear Pending_Tc Tv A() [} 95] This function block deletes inactive errors from the error history (array of type ST_Tc Tv A_Alarm_Itf). FB_Msg Clear Signal_Tc Tv A() [} 96] This function block deletes the message. FB_Msg Deactivate_Tc Tv A() [} 97] Disables an inactive error message in the array of type ST_Tc Tv A_Alarm_Itf. FB_Msg Garbage Collect_Tc Tv A() [} 97] Must be called cyclically and re-sorts the error history (array of type ST_Tc Tv A_Alarm_Itf). FB_Msg Update Time_Tc Tv A() [} 98] This function block determines the Windows system time and returns it to the application. Data types: Structure types Name Description ST_Tc Tv A_Alarm_Itf [} 99] Creating an array of this structure results in the alarm history. 5.2 Function blocks 5.2.1 FB_Msg Append_Tc Tv A() This function block appends active alarms to an array of type ST_Tc Tv A_Alarm_Itf. To get as much information as possible about the error in the visualization, the parameters listed below can be given to the error message. 94 Version: 1.1.0 TF8540
## Page 95

PLC alarm visualization Syntax VAR_IN_OUT st Time : TIMESTRUCT; END_VAR VAR_INPUT Idx1 : INT:=0; Idx2 : INT:=0; Error Id : DINT:=0; Prio : INT:=0; Active : BOOL:=TRUE; Idx First : INT; Idx Last : INT; sync_idx : INT:=0; p Alarm Buffer: POINTER TO ST_Tc Tv A_Alarm_Itf; END_VAR Inputs Name Type Description Idx1 INT Zone number or drive number of the faulty zone. Idx2 INT Module number of the faulty zone. Error Id DINT If necessary, the error number can also be read as a plain text message from an .xml file. Prio INT The priority of the error, where 3=Alarm 2=Warning 1=Note 0=Empty. Active BOOL Active indicates that the error is active. Idx First INT The first index in the alarm buffer. Idx Last INT The last index in the alarm buffer. sync_idx INT The address of the alarm buffer with the type ST_Tc Tv A_Alarm_Itf. p Alarm Buffer POINTER TO The address of the alarm buffer with the type ST_Tc Tv A_Alarm_Itf ST_Tc Tv A_Alarm_Itf. Inputs/outputs Name Type Description st Time TIMESTRUCT The time when the error occurred. After a successful call of this function block, there must be another entry at the first free position in the alarm history. 5.2.2 FB_Msg Clear Pending_Tc Tv A() This function block deletes all inactive messages from the alarm history. Syntax VAR_INPUT Idx First : INT; Idx Last : INT; p Alarm Buffer: POINTER TO ST_Tc Tv A_Alarm_Itf; END_VAR TF8540 Version: 1.1.0 95
## Page 96

PLC alarm visualization Inputs Name Type Description Idx First INT The first index in the alarm buffer. Idx Last INT The last index in the alarm buffer. p Alarm Buffer POINTER TO The address of the alarm buffer with the type ST_Tc Tv A_Alarm_Itf ST_Tc Tv A_Alarm_Itf. 5.2.3 FB_Msg Clear Signal_Tc Tv A() This function block disables the boolean expression ST_Tc Tv A_Alarm_Itf. Signal. Syntax VAR_INPUT Idx First: INT; Idx Last: INT; p Alarm Buffer: POINTER TO ST_Tc Tv A_Alarm_Itf; Idx1 : INT:=0; Idx2 : INT:=0; Error Id: DINT:=0; Prio : INT:=0; END_VAR Inputs Name Type Description Idx First INT The first index in the alarm buffer. Idx Last INT The last index in the alarm buffer. p Alarm Buffer POINTER TO The address of the alarm buffer with the type ST_Tc Tv A_Alarm_Itf ST_Tc Tv A_Alarm_Itf. Idx1 INT Zone number of the faulty zone. Idx2 INT Module number of the faulty zone. Error Id DINT The error number Prio INT The priority of the error, where 3=Alarm 2=Warning 1=Note 0=Empty. Behavior of the function block: If an alarm with prio:=3 is present in the alarm buffer, this alarm additionally sets the signal ST_Tc Tv A_Alarm_Itf. Signal:=TRUE. This can be used to control a horn, for example. By calling this function block all ST_Tc Tv A_Alarm_Itf. Signal:=FALSE, which turns off the message. 96 Version: 1.1.0 TF8540
## Page 97

PLC alarm visualization 5.2.4 FB_Msg Deactivate_Tc Tv A() This function block disables an inactive message in the alarm history (type: ST_Tc Tv A_Alarm_Itf). The message is not deleted from the alarm history. Syntax VAR_INPUT Idx1 : INT:=0; Idx2 : INT:=0; Error Id : DINT:=0; Prio : INT:=0; Idx First : INT; Idx Last : INT; p Alarm Buffer: POINTER TO ST_Tc Tv A_Alarm_Itf; END_VAR Inputs Name Type Description Idx1 INT Zone number of the faulty zone. Idx2 INT Module number of the faulty zone. Error Id DINT The error number Prio INT The priority of the error, where 3=Alarm 2=Warning 1=Note 0=Empty. Idx First INT The first index in the alarm buffer. Idx Last INT The last index in the alarm buffer. p Alarm Buffer POINTER TO The address of the alarm buffer with the type ST_Tc Tv A_Alarm_Itf ST_Tc Tv A_Alarm_Itf. Behavior of the function block: Each FB_Msg Append_Tc Tv A() function block also includes a FB_Msg Deactivate_Tc Tv A() that resets the message. To ensure that exactly the right message is reset, the deactivation must be called with the same properties (Idx1, Idx2, Error ID, Prio) as the activation. After a successful deactivation ST_Tc Tv A_Alarm_Itf.active:=FALSE. The variable ST_Tc Tv A_Alarm_Itf. Bitmap depends on ST_Tc Tv A_Alarm_Itf. Prio and whether ST_Tc Tv A_Alarm_Itf.active:=TRUE or FALSE. 5.2.5 FB_Msg Garbage Collect_Tc Tv A() TF8540 Version: 1.1.0 97
## Page 98

PLC alarm visualization This function block checks whether the alarm history (array of type ST_Tc Tv A_Alarm_Itf) contains empty cells and moves subsequent messages up. Syntax VAR_INPUT Idx First : INT; Idx Last : INT; sync_idx : INT:=0; p Alarm Buffer: POINTER TO ST_Tc Tv A_Alarm_Itf; END_VAR VAR_OUTPUT signaled : BOOL; END_VAR Inputs Name Type Description Idx First INT The first index in the alarm buffer. Idx Last INT The last index in the alarm buffer. sync_idx INT Reserved; with 0 the array is automatically searched for spaces. p Alarm Buffer POINTER TO The address of the alarm buffer with the type ST_Tc Tv A_Alarm_Itf ST_Tc Tv A_Alarm_Itf. Outputs Name Type Description signaled BOOL Signals whether a message is present. 5.2.6 FB_Msg Update Time_Tc Tv A() This function block determines the Windows system time and returns it to the application. VAR_INPUT n Task Id: INT; END_VAR VAR_IN_OUT st Time : TIMESTRUCT; END_VAR Inputs Name Type Description n Task Id INT Task in which the alarm handling takes place. Inputs/outputs Name Type Description st Time TIMESTRUCT Windows system time. 98 Version: 1.1.0 TF8540
## Page 99

PLC alarm visualization 5.3 Structures 5.3.1 ST_Tc Tv A_Alarm_Itf Creating an array of this structure results in the alarm history. Each new, active and inactive message is temporarily stored in this array. Syntax TYPE ST_Tc Tv A_Alarm_Itf : (* last modification: 04.10.2008 *) STRUCT (* ========================================== message data see cnv_Itf Struct Type_Tv A for format definition ========================================== *) s Time: STRING(23); Error Id: DINT:=0; Count : INT:=0; Bitmap : INT:=0; (* 5=Alarm Inaktiv 4=Alarm Aktiv 3=Warning Inaktiv 2=Warning Aktiv 1=Note 0=Empty *) Prio : INT:=0; (* 3=Alarm 2=Warning 1=Note 0=Empty *) Idx1 : INT:=0; (* module or drive no. *) Idx2 : INT:=0; (* zone no. *) i_align: ARRAY[1..3]OF INT; Active : BOOL:=FALSE; Pending: BOOL:=FALSE; Signal : BOOL:=FALSE; b_align: ARRAY[1..5]OF BOOL; (**) END_STRUCT END_TYPE Parameter Name Type Description s Time STRING The cycle time (in seconds) of the PWM signal generator. Error Id DINT Error number (this can be used to read a plain text message from an . XML file). Count INT Number of the alarm memory. Bitmap INT This can be used to visualize the state in an error message. Where 5=Alarm inactive, 4=Alarm active, 3=Warning inactive, 2=Warning active, 1=Note, 0=Empty. Prio INT Indicates the type of alarm. A distinction is made between Alarm=3, Warning=2, Note=1, Empty=0. Idx1 INT The module or drive number should be specified here (but can be used arbitrarily). Idx2 INT The zone number is to be specified here (but can be used as desired). i_align ARRAY OF INT INTEGER Alignment. Active BOOL By calling the function block FB_Msg Append_Tc Tv A() an error is added to the alarm history and activated via this Bool. If the error is corrected, this Boolean is deactivated by the function block FB_Msg Deactivate_Tc Tv A(). Pending BOOL Alarms that are no longer active (Active:=FALSE) can be deactivated via the function block FB_Msg Clear Pending_Tc Tv A(). Signal BOOL For messages with Prio:=5 additionally Signal:=TRUE, whereby a horn can be activated. By calling FB_Msg Clear Signal_Tc Tv A() Signal:=FALSE. b_align ARRAY OF BOOL BOOL Alignment. TF8540 Version: 1.1.0 99
## Page 100

PLC alarm visualization 5.4 Knowledge Base 5.4.1 Commissioning There are two application examples for alarm handling commissioning: • minimal application to describe only the alarm handling. • Application with complete temperature library for alarm handling of the temperature library. In both applications important places for alarm handling are marked by (*TVAlarm*). Basic structure of the Example_Tv Alarm application for alarm handling The project has the following arrays: • st Visu Temp Alarm: This array is of type ST_Visu Alarm (an application specific structure) and is used as a buffer in case there are several program parts generating an error at the same time (e.g. several zones on one extruder), as well as for presetting prio, Idx1 and Idx2 to each error number. • aaa Pfw Temp Message Hmi: This array is of type ST_Tc Tv A_Alarm_Itf and is the array that must be used for visualization. Here the individual errors are listed in order. • FB_Init Alarm Message: In this function block exactly one error code is assigned to each cell of the array st Visu Temp Alarm. • F_init Temp Msg: This function is called in the FB_Init Alarm Message function block and is responsible for initializing the error code in the st Visu Temp Alarm array. • FB_Msg Check: This function block must be called cyclically. All library function blocks are called from here. This means: ◦ active messages are entered into the event system as active, ◦ inactive messages are entered into the event system as inactive, ◦ inactive messages can be deleted. • FB_Msg Check Temp: In this function block all messages that have become active in this cycle are entered at the corresponding positions in the array st Visu Temp Alarm. Since the Pfw Lib_Processing.lib library was included in this example, various constants had to be declared for the temperature control. But these are unimportant for the actual alarm handling and only serve to compile the project. In the source code these places are marked accordingly. Basic structure of the Example_Tv Alarm_Temp Ctrl application for alarm handling Compared to the example above, this alarm handling is much more sophisticated due to the different zones of temperature control and due to the many possible error messages. The project have the following arrays: • st Visu Temp Alarm: This array is of type ST_Visu Alarm (an application-specific structure) and serves as a buffer in case several alarms become active in one cycle. In the array you have the possibility to record 30 different errors for one zone. • aaa Pfw Temp Message Hmi: This array is of type ST_Tc Tv A_Alarm_Itf and must be used for visualization. • FB_Init Alarm Message: In this function block exactly one error code is assigned to each cell of an array st Visu Temp Alarm. • F_init Temp Msg: This function is called in the FB_Init Alarm Message function block and is responsible for initializing the error code in the st Visu Temp Alarm array. 100 Version: 1.1.0 TF8540
## Page 101

PLC alarm visualization • FB_Msg Check: This function block must be called cyclically. All library function blocks are called from here. This means ◦ active messages are entered into the event system as active, ◦ inactive messages are entered into the event system as inactive, ◦ inactive messages can be deleted. • FB_Msg Check Temp: In this function block all messages that have become active in this cycle are entered at the corresponding positions in the array st Visu Temp Alarm. 5.4.2 Global variables Error Codes No error codes are defined. If an error code is output, it must be consulted in the Beckhoff information system, because it is an error of another library. Name Description cnv_Itf Struct Type_Tv A Current version identifier of the ST_Tc Tv A_Alarm_Itf structure. 5.4.3 FAQs Name Description FAQ#1 [} 101] Is a distinction made between alarm, warning and information? FAQ#2 [} 101] Can other errors, other than those from specific libraries, be logged? FAQ#1: Is there a distinction between alarm, warning and information? There are three different message levels, which can be set under ST_Tc Tv A_Alarm_Itf. Prio: • prio:=3 means alarm and activates ST_Tc Tv A_Alarm_Itf.signal at the same time. This output can be linked to a horn, for example. • prio:=2 is a warning. • prio:=1 is an information. FAQ#2: Can other errors besides those from specific libraries be logged as well? If the additional error codes are included in the alarm management, it is possible to display these messages as well. TF8540 Version: 1.1.0 101
## Page 102

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Third-party trademark statements Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 103

More Information: www.beckhoff.com/tf8540 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
