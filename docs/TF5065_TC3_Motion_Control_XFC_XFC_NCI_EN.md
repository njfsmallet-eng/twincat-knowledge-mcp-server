---
title: "TF5065_TC3_Motion_Control_XFC_XFC_NCI_EN"
product: "TF5065"
category: "Motion_Control"
tags: ["CONTROL", "MOTION", "NC", "NCI", "XFC"]
language: "EN"
document_type: "Manual"
version: "2.3.2"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5065_TC3_Motion_Control_XFC_XFC_NCI_EN.pdf"
release_date: "2025-08-08"
---
Manual | EN TF5065 Twin CAT 3 | Motion Control XFC/XFC NC I 2025-08-08 | Version: 2.3.2
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 Dead time compensation.......................................................................................................................... 9 4 PLC libraries............................................................................................................................................ 12 4.1 Tc2_MC2_XFC............................................................................................................................... 12 4.1.1 Function blocks................................................................................................................ 12 4.1.2 Functions.......................................................................................................................... 41 4.1.3 Data types........................................................................................................................ 42 4.2 Tc2_Nci XFC.................................................................................................................................... 53 4.2.1 Function blocks................................................................................................................ 53 4.2.2 Data types........................................................................................................................ 58 4.3 Tc3_MC2_Advanced Homing_XFC................................................................................................. 60 4.3.1 Overview.......................................................................................................................... 60 4.3.2 Function blocks................................................................................................................ 60 4.3.3 Data types........................................................................................................................ 78 5 Samples................................................................................................................................................... 79 6 Support and Service............................................................................................................................... 80 TF5065 Version: 2.3.2 3
## Page 4

Table of contents 4 Version: 2.3.2 TF5065
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF5065 Version: 2.3.2 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 2.3.2 TF5065
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF5065 Version: 2.3.2 7
## Page 8

Introduction 2 Introduction e Xtreme Fast Control (XFC) is the name given to a technique that enables very fast, temporally high- precision reactions using Ether CAT, special I/O terminals and Twin CAT on the PC. Using Ether CAT Distributed Clocks (DC) and appropriate terminals, distributed latches or cam controllers can be implemented simply in this way. • Function blocks for the high-precision acquisition and switching of digital signals related to axis positions • Ether CAT Distributed Clocks with the timestamp-based Ether CAT, as for example EL1252, EL2252 or EL2262 input and output terminals • Blocks for the conversion of DC time to position and vice versa • Convenient PLCopen-compliant Touch Probe function block • Digital cam controller as PLCopen-compliant function block 8 Version: 2.3.2 TF5065
## Page 9

Dead time compensation 3 Dead time compensation A prerequisite for high-precision conversion of positions into times and vice versa is precise dead time compensation of the axes. In Twin CAT 3 such a dead time compensation function is available for Ether CAT and Sercos axes. It operates largely automatically. Nevertheless, a manual configuration can be necessary, for example to compensate the drive's internal dead times. Support of distributed clocks Support for distributed clocks must initially be activated in Ether CAT drives as follows: 1. Call the drive's Ether CAT Advanced Settings dialog. 2. Activate the switch Include DC Shift Times. ð The time information is made available in the info data (Info Data) of the drive and later linked with the NC axis. Dc Input Shift is the time required to transmit status information, such as the actual position of a drive, to the controller. In other words, it is the time between the acquisition and the evaluation of these data. Dc Output Shift is the time for the output of the process data to the drive, i.e. for the time delay between the calculation and the effect of these data. The time information is provided dynamically by the system and is used by the NC for dead time compensation of an axis. TF5065 Version: 2.3.2 9
## Page 10

Dead time compensation For Sercos axes the times Dc Input Shift and Dc Output Shift are provided by the Sercos card and do not have to be configured. If a drive is linked to an NC axis these times are also linked. Compensation of the encoder dead time The dead time compensation for the data acquisition side is activated on the Time Compensation tab of the axis encoder. The dead time from Dc Input Shift provided by the system is used for calculating the compensation. In special cases, for example in the event of additional dead times due to the hardware used, it may be necessary to configure further times. The value Encoder Delay in Cycles indicates additional delays (whole I/O cycles). This time is therefore not a fixed value, but changes with the cycle time. The value Additional Encoder Delay is a fixed time value in µs caused by the hardware used. 10 Version: 2.3.2 TF5065
## Page 11

Dead time compensation Compensation of the drive dead time The dead time compensation in the output direction is activated on the Time Compensation tab of the NC axis drive. As a result the time from Dc Output Shift provided by the system is used for calculating the compensation. In special cases further times can be configured. The value Task Delay in Cycles is based on the setting in the task configuration. Depending on the set task timing the dead time may be extended by one cycle. The value Drive Delay in Cycles indicates additional delays by entire I/O cycles caused by the drive (e.g. depending on the interpolation type of the drive). The value Additional Drive Delay is a fixed time value in µs caused by the hardware used. Effect of dead time compensation Dead time compensation is used for conversion of all NC data that are cyclically exchanged with the PLC (Nc To Plc) to the current time. The actual position, set position and following error of the axis in particular refer to the current time and reflect the physical axis position at this time. The PLC can use these values for further high-precision time and position calculations. (See basic functions XFC_Get Cur Dc Task Time [} 41], XFC_Time Of Position [} 13] and XFC_Position At Time [} 12].) TF5065 Version: 2.3.2 11
## Page 12

PLC libraries 4 PLC libraries 4.1 Tc2_MC2_XFC The library Tc2_Mc2_XFC facilitates precisely timed acquisition of axis positions and output of digital signals at precise positions in conjunction with Ether CAT XFC terminals (timestamp terminals and oversampling terminals). A precise correlation between time and position can thus be established at any time. Important applications include the acquisition of latch positions (touch probe or measuring probe function) and the realization of digital cam controllers. The library provides various function blocks for this. 4.1.1 Function blocks 4.1.1.1 Basic blocks 4.1.1.1.1 XFC_Position At Time XFC_Position At Time Dc Time T_DCTIME32 LREAL Position Options ST_Nc Time Conversion Options BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID The function block XFC_Position At Time calculates an axis position, which will be or was valid at a given time. The function extrapolates the position in relation to the current position and dynamics. Precise extrapolation is only possible over a short interval, since the axis dynamics may change. The function block requires precisely one call in order to provide the result. It can therefore be used similar to a function, although as well as the position it may also return an error. This error must be analyzed in order to ensure that the calculated position is valid. Inputs VAR_INPUT Dc Time : T_DCTIME32; Options : ST_Nc Time Conversion Options; END_VAR Name Type Description Dc Time T_DCTIME32 Distributed Clock System Time. Contains the lower 32 bits of the complete Dc Time, thus covering a time range of +/- 2 seconds around the current time. In order to optimize the calculation of the position value, the time should be close to the current time, i.e. only a few PLC or NC cycles in the future or the past. Options ST_Nc Time Conversion Optio Data structure with options for position extrapolation. ns [} 42] / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR 12 Version: 2.3.2 TF5065
## Page 13

PLC libraries Name Type Description Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Position : LREAL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Position LREAL Extrapolated position that will be or was reached at the specified time Dc Time. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 4.1.1.1.2 XFC_Time Of Position XFC_Time Of Position Position LREAL T_DCTIME32 Dc Time Options ST_Nc Time Conversion Options BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID The function block XFC_Time Of Position calculates the time at which the axis will be or was at a specified position. The function block extrapolates the time in relation to the current position and dynamics. Precise extrapolation is only possible over a short interval, since the axis dynamics may change. It needs exactly one call to provide the result. It can therefore be used similar to a function, although as well as the time it may also return an error. This error must be analyzed in order to ensure that the calculated time Dc Time is valid. Inputs VAR_INPUT Position : LREAL; Options : ST_Nc Time Conversion Options; END_VAR Name Type Description Position LREAL Absolute axis position Options ST_Nc Time Conversion Optio Data structure with options for position extrapolation. ns [} 42] / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. TF5065 Version: 2.3.2 13
## Page 14

PLC libraries Outputs VAR_OUTPUT Dc Time : T_DCTIME32; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Dc Time T_DCTIME32 Distributed clock system time at which the position will be reached or was reached. Dc Time contains the lower 32 bits of the complete Dc Time and covers a time range of +/- 2 seconds around the current time. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 4.1.1.1.3 XFC_Time To Position XFC_Time To Position Position LREAL DINT Duration Options ST_Nc Time Conversion Options T_DCTIME32 Time Of Position ↔ Axis Reference To AXIS_REF BOOL Error UDINT Error ID The function block XFC_Time To Position calculates the time period within which an axis will reach a position, or the time that has elapsed since the axis passed this position. The function block extrapolates the time in relation to the current position and dynamics. Precise extrapolation is only possible over a short interval, since the axis dynamics may change. It needs exactly one call to provide the result. It can therefore be used similar to a function, although as well as the time it may also return an error. This error must be analyzed in order to ensure that the calculated time duration is valid. Inputs VAR_INPUT Position : LREAL; Options : ST_Nc Time Conversion Options; END_VAR Name Type Description Position LREAL Absolute axis position Options ST_Nc Time Conversion Optio Data structure with options for position extrapolation. ns [} 42] / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. 14 Version: 2.3.2 TF5065
## Page 15

PLC libraries Outputs VAR_OUTPUT Duration : DINT; Time Of Position : T_DCTIME32; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Duration DINT Time duration in nanoseconds after which the position will be reached (> 0) or since the position was passed (< 0). Duration is a differential value from two variables of the type T_DCTIME32 Distributed Clock System Time. Time Of Position T_DCTIME32 Distributed clock system time at which the position will be reached or was reached. Dc Time contains the lower 32 bits of the complete Dc Time and covers a time range of +/- 2 seconds around the current time. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 4.1.1.1.4 XFC_Time To Modulo Position XFC_Time To Modulo Position Position LREAL DINT Duration Modulo Factor LREAL LREAL Absolute Position Options ST_Nc Time Conversion Options T_DCTIME32 Time Of Position ↔ Axis Reference To AXIS_REF BOOL Error UDINT Error ID The function block XFC_Time To Modulo Position calculates the time period within which an axis will reach a position, or the time that has elapsed since the axis passed this position. In this case the position is the nearest modulo position in the direction of travel. The function extrapolates the time in relation to the current position and dynamics. Precise extrapolation is only possible over a short interval, since the axis dynamics may change. The function block requires precisely one call in order to provide the result. It can therefore be used similar to a function, although as well as the time it may also return an error. This error must be analyzed in order to ensure that the calculated time duration is valid. Inputs VAR_INPUT Position : LREAL; Modulo Factor : LREAL; Options : ST_Nc Time Conversion Options; END_VAR Name Type Description Position LREAL Absolute axis position Modulo Fac LREAL Modulo divider to be used for the calculation. Modulo Factor can be tor identical to the modulo factor of the axis, e.g. 360. However, a factor deviating from that can also be used. Options ST_Nc Time Conversion Optio Data structure with options for position extrapolation. ns [} 42] TF5065 Version: 2.3.2 15
## Page 16

PLC libraries / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Duration : DINT; Absolute Position : LREAL; Time Of Position : T_DCTIME32; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Duration DINT Time duration in nanoseconds after which the position will be reached. Duration is a differential value from two variables of the type T_DCTIME32 Distributed Clock System Time. Absolute Positi LREAL Absolute position (not modulo) corresponding to the modulo on position and the determined time. Time Of Positio T_DCTIME32 Distributed clock system time at which the Position will be reached n or was reached. Dc Time contains the lower 32 bits of the complete Dc Time and covers a time range of +/- 2 seconds around the current time. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 4.1.1.2 Cam controller 4.1.1.2.1 MC_Digital Cam Switch MC_Digital Cam Switch Enable BOOL BOOL In Operation Options ST_Cam Switch Options BOOL Busy ↔ Axis Reference To AXIS_REF BOOL Error ↔ Switches Reference To CAMSWITCH_REF UDINT Error ID ↔ Output Reference To OUTPUT_REF ↔ Track Options Reference To TRACK_REF The function block MC_Digital Cam Switch is a digital cam controller with one or several cams on a digital output track. Position, time and brake cams can be realized through suitable parameterization. Further output tracks can be realized with independent instances of the function block. In addition to the switching state of the digital output the output data structure contains precise time information for the next switching operations. This information is used for the actual output at an XFC output terminal with a downstream function block (XFC_EL2252_V2 [} 35] or XFC_EL2262 [} 38]). 16 Version: 2.3.2 TF5065
## Page 17

PLC libraries Inputs VAR_INPUT Enable : BOOL; Options : ST_Cam Switch Options; END_VAR Name Type Description Enable BOOL The cam controller is activated via the Enable input. The initial state remains unchanged, as long as Enable=FALSE. Options ST_Cam Switch Options [} 45] Optional parameter / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Switches : CAMSWITCH_REF; Output : OUTPUT_REF; Track Options : TRACK_REF; END_VAR Name Type Description Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. Switches CAMSWITCH_REF [} 42] The data structure Switches contains a reference to the parameterization of all cams on the cam track. Output OUTPUT_REF [} 44] The data structure Output contains the calculated state of the digital output and the associated timestamp for the output at a digital XFC output terminal. Track Options TRACK_REF [} 46] The data structure Track Options contains the parameterization for the cam track. Outputs VAR_OUTPUT In Operation : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description In Operation BOOL In Operation is TRUE, as long as the cam controller is active and the cam track is calculated according to the cam parameterization. Busy BOOL Busy is TRUE as long as the function block has not been completed. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the Overview of NC Errors. TF5065 Version: 2.3.2 17
## Page 18

PLC libraries Example for two digital cam tracks The following switching diagrams result from the cam data. The switching sequence is represented without any time compensation and hysteresis and varies for both directions of travel due to the cam data. Switching sequence for positive direction of travel Switching sequence for negative direction of travel 18 Version: 2.3.2 TF5065
## Page 19

PLC libraries 4.1.1.2.2 MC_Digital Cam Switch_Multi Edge MC_Digital Cam Switch_Multi Edge Enable BOOL BOOL In Operation Options ST_Cam Switch Options BOOL Busy ↔ Axis Reference To AXIS_REF BOOL Error ↔ Switches Reference To CAMSWITCH_REF UDINT Error ID ↔ Output Reference To OUTPUT_REF_MULTIEDGE ↔ Track Options Reference To TRACK_REF The function block MC_Digital Cam Switch_Multi Edge is a digital cam controller with one or several cams on a digital output track. The function block supplements the function block MC_Digital Cam Switch by the capability of being able to perform multiple switching operations during a PLC cycle. The switching operations are defined by position cams. Further output tracks can be realized with independent instances of the function block. In addition to the switching state of the digital output the output data structure contains precise time information for the next switching operations. With this information, the actual output can take place on an XFC multi-timestamp output terminal with a downstream function block (XFC_EL1259_Multi Edge, XFC_EL2212_Multi Edge [} 33], XFC_EL2258_Multi Edge [} 37] or XFC_EL2262_Multi Edge [} 39]). Time cams and brake cams cannot be used with the function block MC_Digital Cam Switch_Multi Edge. Terminals without multi-timestamp functionality are not suitable for use with this function block. Inputs VAR_INPUT Enable : BOOL; Options : ST_Cam Switch Options; END_VAR Name Type Description Enable BOOL The cam controller is activated via the Enable input. The initial state remains unchanged, as long as Enable=FALSE. Options ST_Cam Switch Options [} 45] Optional parameters / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Switches : CAMSWITCH_REF; Output : OUTPUT_REF_MULTIEDGE; Track Options : TRACK_REF; END_VAR Name Type Description Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. Switches CAMSWITCH_REF [} 42] The data structure Switches contains a reference to the parameterization of all cams on the cam track. Output OUTPUT_REF_MULTIEDGE The data structure Output contains the calculated state of the digital output and the associated timestamp for the [} 45] output at a digital XFC output terminal. Track Options TRACK_REF [} 46] The data structure Track Options contains the parameterization for the cam track. TF5065 Version: 2.3.2 19
## Page 20

PLC libraries Outputs VAR_OUTPUT In Operation : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description In Operation BOOL In Operation is TRUE, as long as the cam controller is active and the cam track is calculated according to the cam parameterization. Busy BOOL Busy is TRUE as long as the block function is not completed. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 4.1.1.2.3 MC_Digital Cam Switch_EL5131 MC_Digital Cam Switch_EL5131 ↔ Axis Reference To AXIS_REF BOOL In Operation ↔ Switches Reference To CAMSWITCH_REF BOOL Busy ↔ Track Options Reference To TRACK_REF BOOL Error ↔ EL5131_IO Reference To EL5131_Io Interface UDINT Error ID Enable BOOL Options ST_Cam Switch Options The MC_Digital Cam Switch_EL5131 function block is a digital cam switch based on an EL5131 incremental encoder terminal. Position and time cams can be used with this function block. Inputs VAR_INPUT Enable : BOOL; Options : ST_Cam Switch Options; END_VAR Name Type Description Enable BOOL The cam controller is activated via the Enable input. The initial state remains unchanged, as long as Enable=FALSE. Options ST_Cam Switch Options [} 45] Optional parameter / Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; Switches : CAMSWITCH_REF; Track Options : TRACK_REF; EL5131_IO : EL5131_Io Interface; END_VAR Name Type Description Axis AXIS_REF The AXIS_REF type axis data structure addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity, or error status. 20 Version: 2.3.2 TF5065
## Page 21

PLC libraries Name Type Description Switches CAMSWITCH_REF [} 42] The Switches data structure contains a reference to the parameterization of all cams on the cam track. Track Options TRACK_REF [} 46] The Track Options data structure contains the parameterization for the cam track. EL5131_IO Process image of the terminal. Outputs VAR_OUTPUT In Operation : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description In Operation BOOL In Operation is TRUE, as long as the cam controller is active and the cam track is calculated according to the cam parameterization. Busy BOOL Busy is TRUE as long as the function block has not been completed. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the Overview of NC Errors. Requirements Development environment PLC libraries to include Twin CAT 3.1 Build 4024.55 Tc2_MC2 3.3.59 Tc2_MC2_XFC 3.3.25 4.1.1.2.4 XFC_Position Cam XFC_Position Cam First On Position LREAL BOOL Error Last On Position LREAL UDINT Error ID Modulo BOOL Modulo Factor LREAL On Compensation LREAL Off Compensation LREAL Options ST_Cam Switch Options ↔ Output Reference To OUTPUT_REF ↔ Axis Reference To AXIS_REF The function block XFC_Position Cam realizes a position cam that switches a digital output on or off, depending on the position. In contrast to the digital cam controller MC_Digital Cam Switch [} 16], the function block switches precisely one cam on a digital output track. This facilitates parameterization of the function block, although it cannot be used if several cams are required on an output track. In addition to the switching state of the digital output the output data structure contains precise time information for the next switching operations. This information is used for the actual output at an XFC output terminal with a downstream function block (XFC_EL2252_V2 [} 35] or XFC_EL2262 [} 38]). TF5065 Version: 2.3.2 21
## Page 22

PLC libraries Inputs VAR_INPUT First On Position : LREAL; Last On Position : LREAL; Modulo : BOOL; Modulo Factor : LREAL := 360; On Compensation : LREAL; Off Compensation : LREAL; Options : ST_Cam Switch Options; END_VAR Name Type Description First On Position LREAL First position from which the cam is switched on. Last On Position LREAL Last position up to which the cam is switched on. The cam function is inverted, if Last On Position < First On Position Modulo BOOL If Modulo TRUE, all positions are interpreted as modulo. The cam function is repeated cyclically. The parameter Modulo Factor is used for calculating the modulo cycle. Modulo Factor LREAL Modulo Factor indicates the length of a modulo cycle in the positioning unit of the axis and is only used if Modulo TRUE. On Compensatio LREAL Compensation time for the rising edge of the cam in [s]. n For negative values of On Compensation the switching time is brought forward, otherwise it is delayed. The value On Compensation parameterized here has priority over TRACK_REF. [} 46] Off Compensatio LREAL Compensation time for the falling edge of the cam in [s]. n For negative values of Off Compensation the switching time is brought forward, otherwise it is delayed. The value Off Compensation parameterized here has priority over TRACK_REF [} 46]. Options ST_Cam Switch Options [} 45] Optional parameters / Inputs/Outputs VAR_IN_OUT Output : OUTPUT_REF; Axis : AXIS_REF; END_VAR Name Type Description Output OUTPUT_REF [} 44] The data structure Output contains the calculated state of the digital output and the associated timestamp for the output at a digital XFC output terminal Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Error BOOL Becomes TRUE if an error occurs. Error ID UDINT Returns a error number when the error output is set. 22 Version: 2.3.2 TF5065
## Page 23

PLC libraries Method of function of the time compensation 4.1.1.2.5 XFC_Time Cam XFC_Time Cam First On Position LREAL BOOL Error Duration LREAL UDINT Error ID Modulo BOOL Modulo Factor LREAL On Compensation LREAL Off Compensation LREAL Options ST_Cam Switch Options ↔ Output Reference To OUTPUT_REF ↔ Axis Reference To AXIS_REF The function block XFC_Time Cam realizes a time cam that activates a digital output depending on the position and switches it off after a certain time. In contrast to the digital cam controller MC_Digital Cam Switch [} 16], the function block switches precisely one cam on a digital output track. This facilitates parameterization of the function block, although it cannot be used if several cams are required on an output track. In addition to the switching state of the digital output the output data structure contains precise time information for the next switching operations. This information is used for the actual output at an XFC output terminal with a downstream function block (XFC_EL2252_V2 [} 35] or XFC_EL2262 [} 38]). Inputs VAR_INPUT First On Position : LREAL; Duration : LREAL; Modulo : BOOL; Modulo Factor : LREAL := 360; On Compensation : LREAL; Off Compensation : LREAL; Options : ST_Cam Switch Options; END_VAR Name Type Description First On Position LREAL First position from which the cam is switched on. Duration LREAL Switch-on duration of the cam in [s]. Modulo BOOL If Modulo TRUE, all positions are interpreted as modulo. The cam function is repeated cyclically. The parameter Modulo Factor is used for calculating the modulo cycle. TF5065 Version: 2.3.2 23
## Page 24

PLC libraries Name Type Description Modulo Factor LREAL Modulo Factor indicates the length of a modulo cycle in the positioning unit of the axis and is only used if Modulo TRUE. On Compensatio LREAL Compensation time for the rising edge of the cam in [s]. n For negative values of On Compensation the switching time is brought forward, otherwise it is delayed. The value On Compensation parameterized here has priority over TRACK_REF [} 46]. Off Compensatio LREAL Compensation time for the falling edge of the cam in [s]. n For negative values of Off Compensation the switching time is brought forward, otherwise it is delayed. The value Off Compensation parameterized here has priority over TRACK_REF [} 46]. Options ST_Cam Switch Options [} 45] Optional parameters / Inputs/Outputs VAR_IN_OUT Output : OUTPUT_REF; Axis : AXIS_REF; END_VAR Name Type Description Output OUTPUT_REF [} 44] The data structure Output contains the calculated state of the digital output and the associated timestamp for the output at a digital XFC output terminal Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Error BOOL Becomes TRUE if an error occurs. Error ID UDINT Returns a error number when the error output is set. 24 Version: 2.3.2 TF5065
## Page 25

PLC libraries Method of function of the time compensation 4.1.1.2.6 XFC_Break Cam XFC_Break Cam Break Release BOOL BOOL Error Last On Position LREAL UDINT Error ID Modulo BOOL Modulo Factor LREAL Off Compensation LREAL Options ST_Cam Switch Options ↔ Output Reference To OUTPUT_REF ↔ Axis Reference To AXIS_REF The function block XFC_Break Cam realizes a brake cam, which deactivates a digital output depending on the position as soon as Break Release is withdrawn. In addition to the switching state of the digital output the output data structure contains precise time information for the next switching operations. This information is used for the actual output at an XFC output terminal with a downstream function block (XFC_EL2252_V2 [} 35] or XFC_EL2262 [} 38]). Inputs VAR_INPUT Break Release : LREAL; Last On Position : LREAL; Modulo : BOOL; Modulo Factor : LREAL := 360; Off Compensation : LREAL; Options : ST_Cam Switch Options; END_VAR Name Type Description Break Release LREAL Brake enable. The cam remains active as long as Break Release is TRUE. When Break Release becomes FALSE, the cam is switched off at position Last On Position. Last On Position LREAL Last position up to which the cam is switched on. Modulo BOOL If Modulo TRUE, all positions are interpreted as modulo. The cam function is repeated cyclically. The parameter Modulo Factor is used for calculating the modulo cycle. Modulo Factor LREAL Modulo Factor indicates the length of a modulo cycle in the positioning unit of the axis and is only used if Modulo=TRUE. TF5065 Version: 2.3.2 25
## Page 26

PLC libraries Name Type Description Off Compensatio LREAL Compensation time for the falling edge of the cam in [s]. n For negative values of Off Compensation the switching time is brought forward, otherwise it is delayed. The value Off Compensation parameterized here has priority over TRACK_REF [} 46]. Options ST_Cam Switch Options [} 45] Optional parameters / Inputs/Outputs VAR_IN_OUT Output : OUTPUT_REF; Axis : AXIS_REF; END_VAR Name Type Description Output OUTPUT_REF [} 44] The data structure Output contains the calculated state of the digital output and the associated timestamp for the output at a digital XFC output terminal. Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Error BOOL Becomes TRUE if an error occurs. Error ID UDINT Returns a error number when the error output is set. Method of function of the time compensation 26 Version: 2.3.2 TF5065
## Page 27

PLC libraries 4.1.1.3 Touch Probe 4.1.1.3.1 XFC_Touch Probe XFC_Touch Probe Execute BOOL BOOL Done Window Only BOOL BOOL Busy First Position LREAL BOOL Error Last Position LREAL UDINT Error ID Options ST_Xfc Touch Probe Options LREAL Recorded Position ↔ Axis Reference To AXIS_REF ↔ Trigger Input Reference To XFC_TRIGGER_REF The function block XFC_Touch Probe records an axis position at the time of the edge of a digital input signal (measuring probe function). The digital input signal is recorded with an XFC input terminal (e.g. EL1252) with timestamps for the falling and rising signal edge. The function block determines the axis position at which the edge change occurred and issues it as Recorded Position. In contrast to the conventional Touch Probe function MC_Touch Probe the digital input is not directly linked to the drive hardware. The position of each Ether CAT or Sercos axis in the system can be recorded via the timestamp of the input. This axis is exactly synchronized via Dead time compensation [} 9]. The function block can be used in free-running or single-shot mode. In free-running mode each edge of the input signal is recorded (maximum one edge per PLC cycle). In single-shot mode the next edge is only recorded once until the function block is triggered again. The optional window function can be used to ignore signal edges outside the defined position filter. The sample [} 79] shows how the function block can be used in free-running (Free Run = TRUE) or in single-shot mode (Free Run = FALSE). TF5065 Version: 2.3.2 27
## Page 28

PLC libraries Signal curve Inputs VAR_INPUT Execute : BOOL; Window Only : BOOL; First Position : LREAL; Last Position : LREAL; Options : ST_Xfc Touch Probe Options; END_VAR Name Type Description Execute BOOL If Execute is active, the axis position is recorded at the defined signal edge of the input signal. A falling edge at Execute terminates the process immediately. Depending on the configuration in Trigger Input. Free Run the next signal edge is recorded and evaluated once. If Free Run is TRUE, a new position value is recorded continuously with each defined edge of the input signal, while Execute remains TRUE. Window Only BOOL If this option is active, only one position inside the window between First Position and Last Position is recorded. Positions outside the window are discarded. Only if the recorded position lies inside the window does Done become TRUE. The recording window can be interpreted in terms of absolute or modulo values. In this connection the flag Modulo Positions [} 51]in the structure Trigger Input [} 51]is to be set accordingly. In the case of absolute value positions there is exactly one window. In the case of 28 Version: 2.3.2 TF5065
## Page 29

PLC libraries Name Type Description modulo value positions the window repeats itself within the modulo cycle defined in the axis parameters (e.g. 0 to 360 degrees). First Position LREAL Initial position of the recording window, if Window Only is TRUE. This position can be interpreted as an absolute or modulo value. In this connection the flag Modulo Positions [} 51] is to be set appropriately in the structure Trigger Input (see below). Last Position LREAL Final position of the recording window, if Window Only is TRUE. This position can be interpreted as an absolute or modulo value. In this connection the flag Modulo Positions [} 51] is to be set appropriately in the structure Trigger Input (see below). Options ST_Xfc Touch Probe Options Optional parameters [} 50] / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Trigger Input : XFC_TRIGGER_REF; END_VAR Name Type Description Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. Trigger Input XFC_TRIGGER_REF [} 51] Trigger Input is a data structure for describing the trigger source and for feeding the state and timestamp of a digital input signal. This data structure is filled by the user. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; Recorded Position : LREAL; END_VAR Name Type Description Done BOOL The value Recorded Position is valid. If Trigger Input. Free Run is TRUE, Done only remains TRUE only for one PLC cycle and is then reset automatically, since Touch Probe is automatically reactivated. Busy BOOL Becomes TRUE as soon as the function block is active, and becomes FALSE when it has returned to its initial state. If Trigger Input. Free Run is TRUE, Busy remains TRUE continuously, even if Done or Error become TRUE, since Touch Probe is automatically reactivated. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number TF5065 Version: 2.3.2 29
## Page 30

PLC libraries Name Type Description Recorded Position LREAL Axis position recorded at the point in time of the trigger signal. If Trigger Input. Free Run is TRUE, the function block operates in free-running mode, so that each valid change in the input signal leads to a new Recorded Position. The position can be analyzed, if Done becomes TRUE. 4.1.1.3.2 XFC_EL1258_Touch Probe XFC_EL1258_Touch Probe Execute BOOL BOOL Done Window Only BOOL BOOL Busy First Position LREAL BOOL Error Last Position LREAL UDINT Error ID Options ST_Xfc Touch Probe Options ST_Recorded Position Recorded Positions ↔ Axis Reference To AXIS_REF UDINT No Of Recorded Positions ↔ Trigger Input Reference To XFC_MT_TRIGGER_REF ST_EL1258_Diagnostics Diagnostic ↔ EL1258 Reference To EL1258_MT_Io Interface The function block XFC_EL1258_Touch Probe records the axis positions at the time of the edges of a digital input signal (touch probe function). The digital input signal is recorded with an EL1258 XFC input terminal with timestamps for falling and rising signal edges. The function block determines the axis positions at which an edge change occurred and issues it as Recorded Position. In contrast to the conventional Touch Probe function MC_Touch Probe the digital input is not directly linked to the drive hardware. The position of each Ether CAT or Sercos axis in the system can be recorded via the timestamps of the input. This axis is exactly synchronized via Dead time compensation. The function block can be used in free-running or single-shot mode. In free-running mode, each edge of the input signal is recorded (including several edges per PLC cycle). In single-shot mode the next edges are only recorded once until the function block is triggered again. The optional window function can be used to ignore signal edges outside the defined position filter. Inputs VAR_INPUT Execute : BOOL; Window Only : BOOL; First Position : LREAL; Last Position : LREAL; Options : ST_Xfc Touch Probe Options; EL1258 : EL1258_MT_Io Interface; END_VAR Name Type Description Execute BOOL If Execute is active, the axis position is recorded at the defined signal edge of the input signal. A falling edge at Execute terminates the process immediately. Depending on the configuration in Trigger Input. Free Run the next signal edge is recorded and evaluated once. If Free Run is TRUE, a new position value is recorded continuously with each defined edge of the input signal, while Execute remains TRUE. Window Only BOOL If this option is active, only one position inside the window between First Position and Last Position is recorded. Positions outside the window are discarded. Only when the recorded position is within the window, Done becomes TRUE. The recording window can be interpreted in terms of absolute or modulo values. In this connection the flag 30 Version: 2.3.2 TF5065
## Page 31

PLC libraries Name Type Description Modulo Positions [} 51] is to be set appropriately in the structure Trigger Input [} 51]. In the case of absolute value positions there is exactly one window. In the case of modulo value positions the window repeats itself within the modulo cycle defined in the axis parameters (e.g. 0 to 360 degrees). First Position LREAL Initial position of the recording window, if Window Only is TRUE. This position can be interpreted as an absolute or modulo value. In this connection the flag Modulo Positions [} 51] is to be set appropriately in the structure Trigger Input (see below). Last Position LREAL Final position of the recording window, if Window Only is TRUE. This position can be interpreted as an absolute or modulo value. In this connection the flag Modulo Positions [} 51] is to be set appropriately in the structure Trigger Input (see below). Options ST_Xfc Touch Probe Options Optional parameters [} 50] EL1258 EL1258_MT_Io Interface [} 47] Process image of the terminal / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Trigger Input : XFC_TRIGGER_REF; END_VAR Name Type Description Axis AXIS_REF The axis data structure of type AXIS_REF addresses an axis unambiguously within the system. Among other parameters, it contains the current axis status, including position, velocity or error state. Trigger Input XFC_MT_TRIGGER_REF Trigger Input is a data structure for describing the trigger source and for feeding the state and timestamp of a digital input signal. This data structure is filled by the user. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; Recorded Positions : ARRAY[1..10]; No Of Recorded Positions : UDINT; Diagnostic : ST_EL1258_Diagnostics; END_VAR Name Type Description Done BOOL The value Recorded Position is valid. If Trigger Input. Free Run is TRUE, Done only remains TRUE for one PLC cycle and is then reset automatically, since Touch Probe is automatically reactivated. Busy BOOL Becomes TRUE as soon as the function block is active, and becomes FALSE when it has returned to its initial state. If Trigger Input. Free Run is TRUE, Busy remains TRUE continuously, even if Done or Error become TRUE, since Touch Probe is automatically reactivated. Error BOOL Becomes TRUE if an error occurs. TF5065 Version: 2.3.2 31
## Page 32

PLC libraries Name Type Description Error ID UDINT If the error output is set, this parameter supplies the error number. Recorded Positio ARRAY[1..10] One or more detected axis positions at the time of the ns trigger event. If Trigger Input. Free Run is TRUE, the function block operates in free-running mode, so that each valid change in the input signal leads to a new Recorded Position. The positions can be evaluated if Done is TRUE. No Of Recorded P UDINT Number of positions recorded. ositions Diagnostic ST_EL1258_Diagnostics Data structure containing diagnostic data that can be used for error analysis. [} 50] 4.1.1.4 Output routines for digital terminals 4.1.1.4.1 XFC_EL2212_V2 XFC_EL2212_V2 Force When Late BOOL BOOL Error ↔ Output1 Reference To OUTPUT_REF UDINT Error ID ↔ Output2 Reference To OUTPUT_REF BOOL Error Output Missed ↔ Track Options1 Reference To TRACK_REF BOOL Precision Reduced ↔ Track Options2 Reference To TRACK_REF ↔ EL2212 Reference To EL2212_Io Interface The function block XFC_EL2212_V2 handles the output of a digital cam with the EL2212 XFC timestamp terminal. The output of the data to the terminal takes place only shortly before reaching the timestamp of one of the outputs. Four PLC cycles are required for activation and acknowledgement of the outputs. Only then can a further edge change take place. The minimum time between two edge changes of the output signal is therefore four PLC cycles, in order to prevent errors or loss of precision. If the output signal is generated by a cam controller, a minimum cam width can be calculated from the maximum velocity and the PLC cycle time. The outputs Output1 and Output2 cannot be used completely independently of each other since the activation takes place with only one timestamp. As a prerequisite, the switching edges of both channels must be sufficiently far apart. In this case, the respectively nearest timestamp is applied to the block. Inputs VAR_INPUT Force When Late : BOOL; END_VAR Name Type Description Force When Late BOOL If Force When Late is TRUE, the output is activated even if the time stamp is already exceeded. It is recommended to set Force When Late to prevent the loss of a switching edge in case of fluctuations of the time signal. / Inputs/outputs VAR_IN_OUT Output1 : OUTPUT_REF; Output2 : OUTPUT_REF; Track Options1 : TRACK_REF; 32 Version: 2.3.2 TF5065
## Page 33

PLC libraries Track Options2 : TRACK_REF; EL2212 : EL2212_Io Interface; END_VAR Name Type Description Output1 OUTPUT_REF [} 44] Output state for channel 1 of the Terminal. The data structure Output contains the calculated state of the digital output and the associated time stamp for the output at a digital XFC output terminal Output2 OUTPUT_REF [} 44] Output state for channel 2 of the Terminal. The data structure Output contains the calculated state of the digital output and the associated time stamp for the output at a digital XFC output terminal. Track Options1 TRACK_REF [} 46] The Track Options1 data structure contains the parameterization of Cam Track 1 for Output1. Track Options2 TRACK_REF [} 46] The Track Options2 data structure contains the parameterization of Cam Track 2 for Output2. EL2212 EL2212_Io Interface [} 47] Process image of the terminal Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; Error Output Missed : BOOL; Precision Reduced : BOOL; END_VAR Name Type Description Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If an error output is set, this parameter supplies an error number Error Output Miss BOOL The exact switching point transferred in the Output1 or ed Output2 structures could not be maintained and the output state remains unchanged. If Force When Late is TRUE, the initial state is always output and Error Output Missed does not become TRUE. Precision Reduce BOOL The exact switching point transferred in the Output1 or d Output2 structures could not be maintained, but the output status was output with a delay. Precision Reduced should be regarded as a warning. It can only become TRUE if Force When Late is TRUE. 4.1.1.4.2 XFC_EL2212_Multi Edge XFC_EL2212_Multi Edge Force When Late BOOL BOOL Error Reset BOOL UDINT Error ID ↔ Output Reference To OUTPUT_REF_MULTIEDGE BOOL Error Output Missed ↔ Track Options Reference To TRACK_REF BOOL Precision Reduced ↔ EL2212 Reference To EL2212_MT_Io Interface ST_EL2258_Diagnostics Diagnostics The function block XFC_EL2212_Multi Edge handles the output of a multi-edge cam controller MC_Digital Cam Switch_Multi Edge [} 19] via the EL2212 XFC timestamp terminal. Inputs VAR_INPUT Force When Late : BOOL; Reset : BOOL; END_VAR TF5065 Version: 2.3.2 33
## Page 34

PLC libraries Name Type Description Force When Late BOOL If Force When Late is TRUE, the output is activated even if the time stamp is already exceeded. It is recommended to set Force When Late to prevent the loss of a switching edge in case of fluctuations of the time signal. Reset BOOL Reset initiates a reset of the terminal / Inputs/outputs VAR_IN_OUT Output : OUTPUT_REF_MULTIEDGE; Track Options : TRACK_REF; EL2212 : EL2212_Io Interface; END_VAR Name Type Description Output OUTPUT_REF_MULTIEDGE Output state for a channel of the Terminal. The data structure Output contains the next calculated states of the [} 45] digital output and the associated timestamp for output on a digital XFC output terminal. Track Options TRACK_REF [} 46] The data structure Track Options contains the parameterization for the cam track. EL2212 EL2212_Io Interface [} 47] Process image of the terminal Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; Error Output Missed : BOOL; Precision Reduced : BOOL; Diagnostics : ST_EL2258_Diagnostics; END_VAR Name Type Description Error BOOL Becomes TRUE if an error occurs. Error ID UDINT Returns a error number when the error output is set. Error Output Missed BOOL One of the switching points passed in the Output structure could not be met and the output state remains unchanged. If Force When Late is TRUE, the output state is always output and Error Output Missed does not become TRUE. Precision Reduced BOOL One of the switching points passed in the Output structure could not be kept, but the output state was delayed. Precision Reduced is to be understood as a warning and can only become TRUE if Force When Late is TRUE. Diagnostics ST_EL2258_Diagnostics Data structure containing diagnostic data that can be used for error analysis. [} 48] Process image The terminal is inserted in the process image with up to 10 timestamps for operation with this function block in the multi-timestamp mode and the DC mode must be activated. 34 Version: 2.3.2 TF5065
## Page 35

PLC libraries 4.1.1.4.3 XFC_EL2252_V2 XFC_EL2252_V2 Force When Late BOOL BOOL Error ↔ Output1 Reference To OUTPUT_REF UDINT Error ID ↔ Output2 Reference To OUTPUT_REF BOOL Error Output Missed ↔ Track Options1 Reference To TRACK_REF BOOL Precision Reduced ↔ Track Options2 Reference To TRACK_REF ↔ EL2252 Reference To EL2252_Io Interface The function block XFC_EL2252_V2 handles the output of a digital cam with the EL2252 XFC timestamp terminal. The output of the data to the terminal takes place only shortly before reaching the timestamp of one of the outputs. Four PLC cycles are required for activation and acknowledgement of the outputs. Only then can a further edge change take place. The minimum time between two edge changes of the output signal is therefore four PLC cycles, in order to prevent errors or loss of precision. If the output signal is generated by a cam controller, a minimum cam width can be calculated from the maximum velocity and the PLC cycle time. The outputs Output1 and Output2 cannot be used completely independently of each other since the activation takes place with only one timestamp. As a prerequisite, the switching edges of both channels must be sufficiently far apart. In this case, the respectively nearest timestamp is applied to the block. Inputs VAR_INPUT Force When Late : BOOL; END_VAR Name Type Description Force When Late BOOL If Force When Late is TRUE, the output is activated even if the time stamp is already exceeded. It is recommended to set Force When Late to prevent the loss of a switching edge in case of fluctuations of the time signal. / Inputs/outputs VAR_IN_OUT Output1 : OUTPUT_REF; Output2 : OUTPUT_REF; Track Options1 : TRACK_REF; Track Options2 : TRACK_REF; EL2252 : EL2252_Io Interface; END_VAR Name Type Description Output1 OUTPUT_REF [} 44] Output state for channel 1 of the Terminal. The data structure Output contains the calculated state of the digital output and the associated time stamp for the output at a digital XFC output terminal. Output2 OUTPUT_REF [} 44] Output state for channel 2 of the Terminal. The data structure Output contains the calculated state of the digital output and the associated time stamp for the output at a digital XFC output terminal. Track Options1 TRACK_REF [} 46] The Track Options1 data structure contains the parameterization of Cam Track 1 for Output1. Track Options2 TRACK_REF [} 46] The Track Options2 data structure contains the parameterization of Cam Track 2 for Output2. EL2252 EL2252_Io Interface Process image of the terminal [} 47] TF5065 Version: 2.3.2 35
## Page 36

PLC libraries Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; Error Output Missed : BOOL; Precision Reduced : BOOL; END_VAR Name Type Description Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If an error output is set, this parameter supplies an error number Error Output Missed BOOL The exact switching point transferred in the Output1 or Output2 structures could not be maintained and the output state remains unchanged. If Force When Late is TRUE, the initial state is always output and Error Output Missed does not become TRUE. Precision Reduced BOOL The exact switching point transferred in the Output1 or Output2 structures could not be maintained, but the output status was output with a delay. Precision Reduced should be regarded as a warning. It can only become TRUE if Force When Late is TRUE. Example for a position cam output The function block XFC_Position Cam [} 21] is hardware-independent and transfers the necessary switching information for output to the function block XFC_EL2252_V2 in the Output Ref1 data structure. The data structure is used for data transfer on both function blocks. Output of two position cams on one output terminal The outputs Output1 and Output2 cannot be used completely independently of each other with the EL2252 because activation occurs with only one timestamp. As a prerequisite, the switching edges of both channels must be sufficiently far apart (4 PLC cycles). As soon as the switching edges are closer together, they are output inaccurately. 36 Version: 2.3.2 TF5065
## Page 37

PLC libraries 4.1.1.4.4 XFC_EL2258_Multi Edge XFC_EL2258_Multi Edge Force When Late BOOL BOOL Error Reset BOOL UDINT Error ID ↔ Output Reference To OUTPUT_REF_MULTIEDGE BOOL Error Output Missed ↔ Track Options Reference To TRACK_REF BOOL Precision Reduced ↔ EL2258 Reference To EL2258_MT_Io Interface ST_EL2258_Diagnostics Diagnostics The function block XFC_EL2258_Multi Edge handles the output of a multi-edge cam controller MC_Digital Cam Switch_Multi Edge [} 19] via the EL2258 XFC timestamp terminal. Inputs VAR_INPUT Force When Late : BOOL; Reset : BOOL; END_VAR Name Type Description Force When Late BOOL If Force When Late is TRUE, the output is activated even if the time stamp is already exceeded. Reset BOOL It is recommended to set Force When Late to prevent the loss of a switching edge in case of fluctuations of the time signal. / Inputs/outputs VAR_IN_OUT Output : OUTPUT_REF_MULTIEDGE; Track Options : TRACK_REF; EL2258 : EL2258_Io Interface; END_VAR Name Type Description Output OUTPUT_REF_MULTIED Output state for a channel of the Terminal. The data structure Output contains the next calculated states of the GE [} 45] digital output and the associated timestamp for output on a digital XFC output terminal. Track Options TRACK_REF [} 46] The data structure Track Options contains the parameterization for the cam track. EL2258 EL2258_Io Interface Process image of the terminal [} 48] Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; Error Output Missed : BOOL; Precision Reduced : BOOL; Diagnostics : ST_EL2258_Diagnostics; END_VAR Name Type Description Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If an error output is set, this parameter supplies an error number TF5065 Version: 2.3.2 37
## Page 38

PLC libraries Name Type Description Error Output Missed BOOL One of the switching points transferred in the Output structure could not be maintained and the output state remains unchanged. If Force When Late is TRUE, the initial state is always output and Error Output Missed does not become TRUE. Precision Reduced BOOL One of the switching points transferred in the Output structure could not be maintained, but the output state was output with a delay. Precision Reduced should be regarded as a warning. It can only become TRUE if Force When Late is TRUE. Diagnostics ST_EL2258_Diagnostics Data structure containing diagnostic data that can be used for error analysis. [} 48] 4.1.1.4.5 XFC_EL2262 XFC_EL2262 Oversampling Factor UINT BOOL Error Output One Cycle Delayed BOOL UDINT Error ID Force When Late BOOL BOOL Error Output Missed Channel INT BOOL Precision Reduced ↔ Output Reference To OUTPUT_REF ↔ Track Options Reference To TRACK_REF ↔ EL2262 Reference To EL2262_Io Interface The function block XFC_EL2262 handles the output of a digital cam with the EL2262 XFC oversampling terminal. The maximum frequency depends on the cycle time. The minimum distance between two rising signal edges is two PLC cycles. The minimum distance between rising and falling edge can be smaller than a PLC cycle. The switching accuracy is determined by the set oversampling factor of the terminal. The two channels of the terminal are independent of each other and are served by two instances of the XFC_EL2262 function block. Inputs VAR_INPUT Oversampling Factor : UINT; Output One Cycle Delayed : BOOL; (* TRUE if EL2262 is updated with the NC SAF task at the beginning of the next cycle *) Force When Late : BOOL; Channel : INT; END_VAR Name Type Description Oversampling Factor UINT Oversampling factor for the EL2262 terminal Output One Cycle Delayed BOOL Output One Cycle Delayed is TRUE, if the output of the process image is delayed by a cycle due to the set timing. Output One Cycle Delayed depends on the timing of the output task to which the EL2262 is linked. Force When Late BOOL If the time information changes slightly from cycle to cycle, it might not be possible for a switching edge to be output. In such a situation Force When Late forces the best possible switching. In this case the Precision Reduced output goes TRUE and can be used for diagnosis. (Can be used in the case of increased jitter in an axis position where the output of a switching edge cannot be determined to an exact output cycle). Channel INT Channel number 0 or 1 of the EL2262 Terminal 38 Version: 2.3.2 TF5065
## Page 39

PLC libraries / Inputs/outputs VAR_IN_OUT Output : OUTPUT_REF; Track Options : TRACK_REF; EL2262 : EL2262_Io Interface; END_VAR Name Type Description Output OUTPUT_REF [} 44] The data structure Output contains the calculated state of the digital output and the associated time stamp for the output at a digital XFC output terminal Track Options TRACK_REF [} 46] The data structure Track Options contains the parameterization for the cam track. EL2262 EL2262_Io Interface Process image of the terminal [} 48] Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; Error Output Missed : BOOL; Precision Reduced : BOOL; END_VAR Name Type Description Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If an error output is set, this parameter supplies an error number Error Output Missed BOOL Indicates that a switching edge cannot be determined to an exact cycle and therefore cannot be output. The Force When Late input can be set in order to output the switching edge as well as possible. Precision Reduced BOOL indicates that a switching edge cannot be determined to an exact cycle. However, the switching edge was output as well as possible. 4.1.1.4.6 XFC_EL2262_Multi Edge XFC_EL2262_Multi Edge Reset BOOL BOOL Error Preset BOOL UDINT Error ID Oversampling Factor UINT BOOL Error Output Missed Output One Cycle Delayed BOOL BOOL Precision Reduced Force When Late BOOL ST_EL2262_Diagnostics Diagnostics Channel INT ↔ Output Reference To OUTPUT_REF_MULTIEDGE ↔ Track Options Reference To TRACK_REF ↔ EL2262 Reference To EL2262_Io Interface The function block XFC_EL2262_Multiedge handles the output of a digital cam with the EL2262 XFC oversampling terminal. The maximum frequency depends on the cycle time. The minimum distance between two rising signal edges = (2*PLC cycle time) / oversampling factor. The minimum distance between a rising and falling edge = PLC cycle time / oversampling factor. The switching accuracy is determined by the set oversampling factor of the terminal. TF5065 Version: 2.3.2 39
## Page 40

PLC libraries Inputs VAR_INPUT Reset : BOOL; Preset : BOOL; Oversampling Factor : UINT; Output One Cycle Delayed : BOOL; (* TRUE if EL2262 is updated with the NC SAF task at the begi nning of the next cycle *) Force When Late : BOOL; (* forces the output even when the timestamp is missed *) Channel : INT; (* select 0 or 1 for Output0 or Output1 *) END_VAR Name Type Description Reset BOOL The terminal output is deactivated. Preset BOOL The terminal output is activated. Oversampling Factor UINT Oversampling factor for the EL2262 terminal Output One Cycle Delay BOOL Output One Cycle Delayed is TRUE, if the output of the ed process image is delayed by a cycle due to the set timing. Output One Cycle Delayed depends on the timing of the output task to which the EL2262 is linked. Force When Late BOOL If the time information changes slightly from cycle to cycle, it might not be possible for a switching edge to be output. In such a situation Force When Late forces the best possible switching. In this case the Precision Reduced output goes TRUE and can be used for diagnosis. (Can be used in the case of increased jitter in an axis position where the output of a switching edge cannot be determined to an exact output cycle). Channel INT Defines the output channel of the EL2262, where 0 = Output0 and 1 = Output1. / Inputs/outputs VAR_IN_OUT Output : OUTPUT_REF_MULTIEDGE; Track Options : TRACK_REF; EL2262 : EL2262_Io Interface; END_VAR Name Type Description Output OUTPUT_REF_MULTIED The data structure Output contains an array of calculated states of the digital output and the associated timestamp GE [} 45] for output on a digital XFC output terminal Track Options TRACK_REF [} 46] The data structure Track Options contains the parameterization for the cam track. EL2262 EL2262_Io Interface Process image of the terminal [} 48] Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; Error Output Missed : BOOL; Precision Reduced : BOOL; Diagnostics : ST_EL2262_Diagnostics; END_VAR Name Type Description Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If an error output is set, this parameter supplies an error number 40 Version: 2.3.2 TF5065
## Page 41

PLC libraries Name Type Description Error Output Missed BOOL One of the switching points transferred in the Output structure could not be maintained and the output state remains unchanged. If Force When Late is TRUE, the initial state is always output and Error Output Missed does not become TRUE. Precision Reduced BOOL One of the switching points transferred in the Output structure could not be maintained, but the output state was output with a delay. Precision Reduced should be regarded as a warning. It can only become TRUE if Force When Late is TRUE. Diagnostics ST_EL2262_Diagnostics Data structure containing diagnostic data that can be used for error analysis. [} 49] 4.1.2 Functions 4.1.2.1 Basic functions 4.1.2.1.1 XFC_Get Cur Dc Task Time The function XFC_Get Cur Dc Task Time determines the start time of the current PLC cycle. The function optimizes the calls of the system function F_Get Cur Dc Task Time by answering several queries within a PLC task cycle with the same time, without calling the system function repeatedly. Return value FUNCTION XFCF_Get Cur Dc Task Time : T_DCTIME Name Type Description XFCF_Get Cur Dc Task T T_DCTIME Return value of the function. ime Complete 64-bit distributed clock system time. Start time of the current PLC cycle (cycle of the task that calls this function.) 4.1.2.1.2 XFC_Extend Dc Time The function XFC_Extend Dc Time extends a 32-bit time stamp to 64 bit. A prerequisite for the extension to a complete time stamp is that the 32-bit time stamp is valid for the current time range. It is not possible to guarantee error-free extension of a time stamp that applies more than approx. +/- 2 seconds before or after the current time. Inputs VAR_INPUT Time Stamp32 : T_DCTIME32; END_VAR TF5065 Version: 2.3.2 41
## Page 42

PLC libraries Name Type Description Time Stamp32 T_DCTIME32 Distributed Clock System Time. Contains the lower 32 bits of the complete Dc Time, thus covering a time range of +/- 2 seconds around the current time. Return value FUNCTION XFCF_Extend Dc Time : T_DCTIME Name Type Description XFCF_Extend Dc Time T_DCTIME Return value of the function. Complete 64-bit distributed clock system time. 4.1.3 Data types 4.1.3.1 ST_Nc Time Conversion Options TYPE ST_Nc Time Conversion Options : STRUCT Sub Index : UINT; Interpolation Options : UINT; Compensation Time : DINT; END_STRUCT END_TYPE Name Type Description Sub Index UINT For axes with more than one encoder the index (0..9) of the encoder to which the position refers can be specified in Sub Index. No subindex can be specified for Path function blocks that refer to multiple interpolated axes. Interpolation Options UINT Bit mask for special options: Interpolation Options.0 = FALSE: The position extrapolation is carried out with the current velocity, without taking into account the current acceleration. Interpolation Options.0 = TRUE: The axis acceleration is included in the position extrapolation. Interpolation Options.12 = TRUE: The position buffer is ignored. Interpolation Options.15 = TRUE: a logger message is forced. Compensation Time DINT Additional compensation time 4.1.3.2 Digital Cam Switch 4.1.3.2.1 CAMSWITCH_REF The data type CAMSWITCH_REF refers to a data structure with cam parameters for a digital cam controller MC_Digital Cam Switch [} 16]. TYPE CAMSWITCH_REF : STRUCT Number Of Switches : UDINT; p Switches : POINTER TO MC_Cam Switch; Size Of Switches : UDINT; END_STRUCT END_TYPE 42 Version: 2.3.2 TF5065
## Page 43

PLC libraries Name Type Description Number Of Switches UDINT Number of array elements used. Can be less than the maximum number. p Switches POINTER TO Pointer to the digital cam array. MC_Cam Switch Size Of Switches UDINT Maximum size of the digital cam array. The actual data structure for parameterization of a digital cam controller is usually an ARRAY OF MC_Cam Switch [} 44]. CAMSWITCH_REF [} 42] refers to this structure via a pointer and clearly defines the size of the structure and the number of actual cams. A variable of type CAMSWITCH_REF is initialized as illustrated in the following example: VAR Cam Switch Array : ARRAY[1..3] OF MC_Cam Switch; Cam Switch Ref : CAMSWITCH_REF; END_VAR (* real number of defined digital cams *) Cam Switch Ref. Number Of Switches := 1; (* 1..3 *) (* pointer to the digital cam data array *) Cam Switch Ref.p Switches := ADR(Cam Switch Array); (* maximum size of the digital cam data array *) Cam Switch Ref. Size Of Switches := SIZEOF(Cam Switch Array); Example with two cam tracks 4.1.3.2.2 E_Cam Switch Direction TYPE E_Cam Switch Direction : ( CAMSWITCHDIRECTION_BOTH, (* digital cam will work in both directions *) CAMSWITCHDIRECTION_POSITIVE, (* digital cam is just working in positive direction *) CAMSWITCHDIRECTION_NEGATIVE (* digital cam is just working in negative direction *) ); END_TYPE Name Description CAMSWITCHDIRECTION_BOTH The digital cam works in both directions. CAMSWITCHDIRECTION_POSITIVE The digital cam works in the positive direction. CAMSWITCHDIRECTION_NEGATIVE The digital cam works in the negative direction. 4.1.3.2.3 E_Cam Switch Mode TYPE E_Cam Switch Mode : ( CAMSWITCHMODE_POSITION, (* position cam *) CAMSWITCHMODE_TIME, (* time cam *) TF5065 Version: 2.3.2 43
## Page 44

PLC libraries CAMSWITCHMODE_BREAK (* break cam *) ); END_TYPE Name Description CAMSWITCHMODE_POSITION Position cam CAMSWITCHMODE_TIME Time cam CAMSWITCHMODE_BREAK Brake cam 4.1.3.2.4 MC_Cam Switch The data type MC_Cam Switch contains all parameters of a digital cam for a digital cam controller MC_Digital Cam Switch [} 16]. TYPE MC_Cam Switch : STRUCT First On Position : LREAL; Last On Position : LREAL; Axis Direction : E_Cam Switch Direction; Cam Switch Mode : E_Cam Switch Mode; Duration : LREAL; END_STRUCT END_TYPE The data structure for parameterization of a digital cam controller is usually an ARRAY OF MC_Cam Switch. A further structure CAMSWITCH_REF [} 42] refers to this structure. Name Type Description First On Position LREAL First position from which the cam is switched on. Last On Position LREAL Last position up to which the cam is switched on. The cam function is inverted, if Last On Position < First On Position. Last On Positionis is not used for time cams. Axis Direction E_Cam Switch Direction Axis Direction defines in which axis travel direction the digital cam is active (positive, negative or both directions). [} 43] Cam Switch Mode E_Cam Switch Mode Digital cam type (position cam, time cam or brake cam). [} 43] Duration LREAL Duration defines the switch-on time of the cam in [s] and is only used for time cams. 4.1.3.2.5 OUTPUT_REF The data type OUTPUT_REF contains data describing the state of a digital output. In addition to the switching state it contains time stamps for state changes. TYPE OUTPUT_REF : STRUCT Level : BOOL; (* current level of the digital output *) Next State Change Valid : BOOL; (* time value Next State Change is valid *) Next State Change : T_DCTIME32; (* time of next state change - current level will be inverted *) Next On Time Valid : BOOL; (* time value Next On Time is valid *) Next On Time : T_DCTIME32; (* time when the digital output is turned ON next time *) Next Off Time Valid : BOOL; (* time value Next Off Time is valid *) Next Off Time : T_DCTIME32; (* time when the digital output is turned OFF next time *) END_STRUCT END_TYPE Name Type Description Level BOOL Current switching state of the digital output Next State Change Valid BOOL Next State Change Valid is TRUE, if the time stamp Next State Change is valid. 44 Version: 2.3.2 TF5065
## Page 45

PLC libraries Name Type Description Next State Change T_DCTIME32 Time of the next change of state (distributed clock Time Stamp) Next On Time Valid BOOL Next On Time Valid is TRUE, if the time stamp Next On Time is valid. Next On Time T_DCTIME32 Time of the next positive switching edge (distributed clock Time Stamp) Next Off Time Valid BOOL Next Off Time Valid is TRUE, if the time stamp Next Off Time is valid. Next Off Time T_DCTIME32 Time of the next negative switching edge (distributed clock Time Stamp) 4.1.3.2.6 OUTPUT_REF_MULTIEDGE The data type OUTPUT_REF_MULTIEDGE contains data describing the state of a digital output. In addition to the switching state it contains time stamps for state changes. The data type is used in conjunction with terminals that allow multiple switching operations per PLC cycle by means of multi-timestamp. TYPE OUTPUT_REF_MULTIEDGE : STRUCT Switch Event : ARRAY [0.. TCMC2_XFC_MAXINDEXOFMULTIEDGEOUTPUTEVENTS] OF ST_Switch Event; END_STRUCT END_TYPE Name Type Switch Event ARRAY [0.. TCMC2_XFC_MAXINDEXOFMULTIEDGEOUTPUTEVENTS] OF ST_Switch Event [} 45] 4.1.3.2.7 ST_Cam Switch Options Name Type Description Encoder Index UINT If more than one encoder is connected to the axis, the encoder index [0 – 9] can be defined here. The first encoder has the index 0. No subindex can be specified for Path function blocks that refer to multiple interpolated axes. Use Acceleration BOOL Use Acceleration can be set to TRUE in order to incorporate the acceleration of the axis into the position calculation. Use Acceleration can be advantageous if the setpoint values of the acceleration can be used. Use Acceleration may be disadvantageous with encoder axes that supply a noisy position signal, because the acceleration is also erroneous. 4.1.3.2.8 ST_Switch Event TYPE ST_Switch Event : STRUCT ID : UDINT; Valid : BOOL; (* time value is valid *) Level : BOOL; (* next level of the digital signal *) Position : LREAL; Dc Time : T_DCTIME32; (* time when the digital output changes *) Duration : DINT; END_STRUCT END_TYPE Name Type Description ID UDINT Internal ID of the switching edge Valid BOOL Valid is TRUE if the Dc Time timestamp is valid. Level BOOL Current switching state of the digital output TF5065 Version: 2.3.2 45
## Page 46

PLC libraries Name Type Description Position LREAL Switching position of the switching operation Dc Time T_DCTIME32 Time of the next change of state (distributed clock Time Stamp) Duration DINT Not used 4.1.3.2.9 TRACK_REF The data type TRACK_REF contains the parameters of a digital cam track for a digital cam controller MC_Digital Cam Switch [} 16]. TYPE TRACK_REF : STRUCT Modulo Positions : BOOL := TRUE; (* all cam positions are interpreted as modulo positions when TR UE *) Modulo Factor : LREAL := 360; (* e. g. 360 degrees *) On Compensation : LREAL; (* compensation time [s] *) Off Compensation : LREAL; (* compensation time [s] *) Hysteresis : LREAL; (* distance from last switch position (+ or -) *) Break Release : BOOL; (* allow break to be released when TRUE, break cams will be acti vated when FALSE *) Force : BOOL; (* override all digital cams and set track ON *) Disable : BOOL; (* override all digital cams and set track OFF - overrides Force as well *) END_STRUCT END_TYPE Name Type Description Modulo Positions BOOL If Modulo TRUE, all positions are interpreted as modulo. The cam function is repeated cyclically. The parameter Modulo Factor is used for calculating the modulo cycle. Modulo Factor LREAL Modulo Factor indicates the length of a modulo cycle in the positioning unit of the axis and is only used if Modulo TRUE. On Compensation LREAL Compensation time for the rising edge of the cam in [s]. For negative values of On Compensation the switching time is brought forward, otherwise it is delayed. Off Compensation LREAL Compensation time for the falling edge of the cam in [s]. For negative values of Off Compensation the switching time is brought forward, otherwise it is delayed. Hysteresis LREAL Hysteresis of the switching operations for reversing the rotation direction. The hysteresis is specified in the position unit of the axis. (available from library 3.3.27.0) Break Release BOOL Brake enable for brake cams on this cam track Force BOOL The digital output is activated independent of the cams on this track. Disable has priority over Force. Disable BOOL The digital output is deactivated independent of the cams on this track. Disable has priority over Force. 46 Version: 2.3.2 TF5065
## Page 47

PLC libraries Method of function of the time compensation 4.1.3.3 IO Terminals 4.1.3.3.1 EL1258_MT_Io Interface Name Type Description Status _EL1258_Status Input Event State _EL1258_Input Events MTI inputs Input Event Time ARRAY [1..10] OF MTI input of the Event time 1..10 T_DCTIME32 Ctrl _EL1258_Ctrl 4.1.3.3.2 EL2212_Io Interface Name Type Description Status1 WORD Status channel 1 Status1 WORD Status channel 2 Feedback BYTE Not used Wc State BOOL Not used State UINT Not used Output1 BOOL Signal output channel 1 Tri State1 BOOL Channel 1 Reset1 BOOL Channel 1 Output2 BOOL Signal output channel 2 Tri State2 BOOL Channel 2 Reset2 BOOL Channel 2 Activate BYTE PDO 0x1602, activates the output Start Time T_ULARGE_INTEGER PDO 0x1602, activates the output 4.1.3.3.3 EL2252_Io Interface Name Type Description Sys Time T_ULARGE_INTEGER Not used Feedback BYTE Not used Wc State Out BOOL Not used Wc State In BOOL Not used TF5065 Version: 2.3.2 47
## Page 48

PLC libraries Name Type Description State UINT Not used Activate BYTE Activates the output Start Time T_ULARGE_INTEGER Activates the output Output1 BOOL Signal of output channel 1 Tri State1 BOOL Channel 1 Output1 BOOL Signal of output channel 2 Tri State1 BOOL Channel 2 4.1.3.3.4 EL2258_MT_Io Interface Name Type Description Status _EL2258_Status MTO status Ctrl _EL2258_Ctrl MTO Ctrl Outputs DWORD MTO outputs Output Event Time ARRAY [1..10] OF T_DCTIME32 MTO output event time 4.1.3.3.5 EL2262_Io Interface Name Type Description Start Time Next Output T_DCTIME32 Time stamp of the next signal output of the EL2262 terminal. Wc State BOOL State UINT Cycle Counter0 WORD Output0 ARRAY [0..31] OF Array with 1024 to 10000x oversampling – Channel 1 DWORD Cycle Counter1 WORD Output1 ARRAY [0..31] OF Array with 1024 to 10000x oversampling – Channel 1 DWORD 4.1.3.4 Terminal output routines 4.1.3.4.1 ST_EL2258_Diagnostics The data type ST_EL2258_Diagnostics contains diagnostic data that can be used for error analysis. TYPE ST_EL2258_Diagnostics : STRUCT Error On Output Missed : BOOL; Error Off Output Missed : BOOL; Error No Of Events Exceeded : BOOL; Error Buffer Overflow : BOOL; Error Event Distance : BOOL; On Precision Reduced : BOOL; Off Precision Reduced : BOOL; Last Output Level : BOOL; Activated On Values : INT; Activated Off Values : INT; END_STRUCT END_TYPE Name Type Description Error On Output Missed BOOL Indicates that a rising switching edge could not be determined to an exact cycle and therefore could not be output. The Force When Late input can be set in order to output the switching edge as well as possible. 48 Version: 2.3.2 TF5065
## Page 49

PLC libraries Name Type Description Error Off Output Missed BOOL Indicates that a falling switching edge could not be determined to an exact cycle and therefore could not be output. The Force When Late input can be set in order to output the switching edge as well as possible. Error No Of Events Exceed BOOL Indicates that too many edges were delivered for a cycle ed and that therefore not all of them can be output. Error Buffer Overflow BOOL Indicates that the output buffer of the EL2258 is full. Error Event Distance BOOL Indicates that the distance between two consecutive edges is too small. On Precision Reduced BOOL Indicates that a rising switching edge could not be determined to an exact cycle. However, the switching edge was output as well as possible. Off Precision Reduced BOOL Indicates that a falling switching edge could not be determined to an exact cycle. However, the switching edge was output as well as possible. Last Output Level BOOL Indicates which signal state the channel of the EL2262 will have after the following update. Activated On Values INT Number of rising edges activated in this cycle. Activated Off Values INT Number of falling edges activated in this cycle. 4.1.3.4.2 ST_EL2262_Diagnostics The data type ST_EL2262_Diagnostics contains diagnostic data that can be used for error analysis. TYPE ST_EL2262_Diagnostics : STRUCT Error On Output Missed : BOOL; Error Off Output Missed : BOOL; On Precision Reduced : BOOL; Off Precision Reduced : BOOL; Last Output Level : BOOL; Activated On Values : INT; Activated Off Values : INT; END_STRUCT END_TYPE Name Type Description Error On Output Missed BOOL Indicates that a rising switching edge could not be determined to an exact cycle and therefore could not be output. The Force When Late input can be set in order to output the switching edge as well as possible. Error Off Output Missed BOOL Indicates that a falling switching edge could not be determined to an exact cycle and therefore could not be output. The Force When Late input can be set in order to output the switching edge as well as possible. On Precision Reduced BOOL Indicates that a rising switching edge could not be determined to an exact cycle. However, the switching edge was output as well as possible. Off Precision Reduced BOOL Indicates that a falling switching edge could not be determined to an exact cycle. However, the switching edge was output as well as possible. Last Output Level BOOL Indicates which signal state the channel of the EL2262 will have after the following update. Activated On Values INT Number of rising edges activated in this cycle Activated Off Values INT Number of falling edges activated in this cycle TF5065 Version: 2.3.2 49
## Page 50

PLC libraries 4.1.3.5 Touch Probe 4.1.3.5.1 ST_EL1258_Diagnostics The data type ST_EL1258_Diagnostics contains diagnostic data that can be used for error analysis. TYPE ST_EL1258_Diagnostics : STRUCT Events In Input Buffer: UDINT; No Of Receive Events: UDINT; No Of Receive Events Rising: UDINT; No Of Receive Events Falling: UDINT; No Of Recorded Events Rising: UDINT; No Of Recorded Events Falling: UDINT; Error Buffer Overflow: BOOL; Error Modulo Input: BOOL; END_STRUCT END_TYPE Name Type Description Events In Input Buffer UDINT Counts the events as long as Error Buffer Overflow is FALSE. No Of Receive Events UDINT Number of input events of EL1258. No Of Receive Events Rising UDINT Number of rising edges of EL1258. No Of Receive Events Falling UDINT Number of falling edges of EL1258. No Of Recorded Events Rising UDINT Number of rising edges in the recorded events as long as Window Only is FALSE and No Of Receive Events Rising = No Of Recorded Events Rising. No Of Recorded Events Falling UDINT Number of falling edges in the recorded events as long as Window Only is FALSE and No Of Receive Events Falling = No Of Recorded Events Falling. Error Buffer Overflow BOOL Indicates that the output buffer of the EL1258 is full. Error Modulo Input BOOL No Of Recorded Events Rising + No Of Recorded Events-Falling = No Of Recorded Events. 4.1.3.5.2 ST_XFCTouch Probe Options Name Type Description Use Acceleration BOOL Use Acceleration can be set to TRUE in order to incorporate the acceleration of the axis into the position calculation. Use Acceleration can be advantageous if the setpoint values of the acceleration can be used. Use Acceleration may be disadvantageous with encoder axes that supply a noisy position signal, because the acceleration is also erroneous. 4.1.3.5.3 XFC_MT_TRIGGER_REF TYPE XFC_MT_TRIGGER_REF : STRUCT Signal : BOOL; Free Run : BOOL; Encoder Index : UINT; Modulo Positions : BOOL; Modulo Factor : LREAL := 360.0; END_STRUCT END_TYPE Name Type Description Signal BOOL Current state of the digital input signal. The current state must be supplied here. 50 Version: 2.3.2 TF5065
## Page 51

PLC libraries Name Type Description Free Run BOOL If Free Run is TRUE, the input is latched continuously. In the case of the function block XFC_EL1258_Touch Probe, the input Execute must then remain TRUE. No edge at Execute is required in order to record the next new position value. Encoder Index UINT If more than one encoder is connected to the axis, the encoder index [0 – 9] can be defined here. The first encoder has the index 0. Modulo Positions BOOL If Modulo Positions is TRUE, all positions are interpreted as modulo. The parameter Modulo Factor is used for calculating the modulo cycle. Modulo Factor LREAL Modulo Factor indicates the length of a modulo cycle in the positioning unit of the axis and is only used if Modulo Positions is TRUE. 4.1.3.5.4 XFC_TRIGGER_REF The data type XFC_TRIGGER_REF contains the status and parameters of a digital input that is used for the function block XFC_Touch Probe [} 27]. TYPE XFC_TRIGGER_REF : STRUCT Signal : BOOL; Timestamp Rising Edge : T_DCTIME32; Timestamp Falling Edge : T_DCTIME32; Edge : E_Signal Edge; Free Run : BOOL; Encoder Index : UINT; Modulo Positions : BOOL; Modulo Factor : LREAL := 360.0; END_STRUCT END_TYPE Name Type Description Signal BOOL Current state of the digital input signal. The current state must be supplied here. Timestamp Rising Edge T_DCTIME32 Time stamp of the last rising edge of the digital input signal. Only the time stamp of the edge defined via Edge has to be supplied. If the input signal supplies a 64-bit time stamp T_DCTIME, only the lower 32 bits are supplied. It is therefore important to ensure that the value at the time of the evaluation is not older than 2 seconds. Timestamp Falling Edge T_DCTIME32 Time stamp of the last falling edge of the digital input signal. Only the time stamp of the edge defined via Edge has to be supplied. If the input signal supplies a 64-bit time stamp T_DCTIME, only the lower 32 bits are supplied. It is therefore important to ensure that the value at the time of the evaluation is not older than 2 seconds. Edge E_Signal Edge Edge defines the signal edge to be used for the evaluation of the axis position. TYPE E_Signal Edge : ( Rising Edge, Falling Edge ); END_TYPE Free Run BOOL If Free Run is TRUE, the input is latched continuously. In this case the input Execute must remain TRUE in function block XFC_Touch Probe [} 27]. No edge at Execute is required in order to record the next new position value. Encoder Index UINT If more than one encoder is connected to the axis, the encoder index [0 – 9] can be defined here. The first encoder has the index 0. TF5065 Version: 2.3.2 51
## Page 52

PLC libraries Name Type Description Modulo Positions BOOL If Modulo Positions is TRUE, all positions are interpreted as modulo. The parameter Modulo Factor is used for calculating the modulo cycle. Modulo Factor LREAL Modulo Factor indicates the length of a modulo cycle in the positioning unit of the axis and is only used if Modulo Positions is TRUE. 52 Version: 2.3.2 TF5065
## Page 53

PLC libraries 4.2 Tc2_Nci XFC The Tc2_Nci XFC library facilitates the precisely timed recording of relative path distances and the path- precise output of digital signals in connection with the Ether CAT XFC terminals. The required output function blocks are included in the Tc2_MC2_XFC library. A precise correlation between time and relative path position can thus be established at any time. The library provides various function blocks for the calculation of the timestamps or positions. 4.2.1 Function blocks 4.2.1.1 Basic blocks 4.2.1.1.1 XFC_Path Position At Time XFC_Path Position At Time Grp Id UINT LREAL Path Position Dc Time T_DCTIME32 BOOL Error Options ST_Nc Time Conversion Options UDINT Error ID The function block XFC_Path Position At Time calculates a relative path at a given time in relation to the current path position. The function extrapolates the path distance in relation to the current dynamics. Precise extrapolation is only possible over a short interval, since the group dynamics may change. The function block requires precisely one call in order to provide the result. Therefore it can be used in a similar way to a function, but may return an error in addition to the relative path distance. This error must be evaluated to ensure that the calculated path distance is valid. Inputs VAR_INPUT Grp Id : UDINT; Dc Time : T_DCTIME32; Options : ST_Nc Time Conversion Options; END_VAR Name Type Description Grp Id UDINT Group ID of the Nci group. This clearly identifies the requested Nci group in the system. Dc Time T_DCTIME32 Distributed Clock System Time. Dc Time contains the lower 32 bits of the complete Dc Time and covers a time range of +/- 2 seconds around the current time. In order to optimize the calculation of the path value, the time should be close to the current time, i.e. only a few PLC or NC cycles in the future or the past. Options ST_Nc Time Conversion O Data structure with options for the extrapolation of the relative path. ptions [} 42] Outputs VAR_OUTPUT Path Position : LREAL; Error : BOOL; Error ID : UDINT; END_VAR TF5065 Version: 2.3.2 53
## Page 54

PLC libraries Name Type Description Path Position LREAL Extrapolated relative path up to the preset time Dc Time. Error BOOL Becomes TRUE if an error occurs Error ID UDINT If the error output is set, this parameter supplies the error number. 4.2.1.1.2 XFC_Time Of Path Position XFC_Time Of Path Position Grp Id UINT T_DCTIME32 Dc Time Path Position LREAL BOOL Error Options ST_Nc Time Conversion Options UDINT Error ID The function block XFC_Time Of Path Position calculates the time at which an Nci group has traveled or will have traveled a preset relative path. The function extrapolates the time in relation to the current path position and dynamics. Precise extrapolation is only possible over a short interval, since the Nci group dynamics may change. The function block requires precisely one call in order to provide the result. It can therefore be used similar to a function, although as well as the time it may also return an error. This error must be analyzed in order to ensure that the calculated time Dc Time is valid. Inputs VAR_INPUT Grp Id : UDINT; Path Position : LREAL; Options : ST_Nc Time Conversion Options; END_VAR Name Type Description Grp Id UDINT Group ID of the Nci group. This clearly identifies the requested Nci group in the system. Path Position LREAL Relative path Options ST_Nc Time Conversion O Data structure with options for the extrapolation of the relative path. ptions [} 42] Outputs VAR_OUTPUT Dc Time : T_DCTIME32; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Dc Time T_DCTIME32 Distributed clock system time at which the relative path Path Position will have been travelled or at which this was passed. Dc Time contains the lower 32 bits of the complete Dc Time and covers a time range of +/- 2 seconds around the current time. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 54 Version: 2.3.2 TF5065
## Page 55

PLC libraries 4.2.1.1.3 XFC_Time To Path Position XFC_Time To Path Position Grp Id UINT DINT Duration Path Id UDINT T_DCTIME32 Time Of Position Path Position LREAL BOOL Error Options ST_Nc Time Conversion Options UDINT Error ID The function block XFC_Time To Path Position calculates the time period within which an Nci group has traveled a relative path or which has elapsed since then. The function extrapolates the time in relation to the current path position and dynamics. Precise extrapolation is only possible over a short interval, since the group dynamics may change. The function block requires precisely one call in order to provide the result. It can therefore be used similar to a function, although as well as the time it may also return an error. This error must be analyzed in order to ensure that the calculated time duration is valid. Inputs VAR_INPUT Grp Id : UDINT; Path Id : UDINT; Path Position : LREAL; Options : ST_Nc Time Conversion Options; END_VAR Name Type Description Grp Id UDINT Group ID of the Nci group. This clearly identifies the requested Nci group in the system. Path Id UDINT Unique ID that continually increases over the path course and belongs to the relative path. Path Position LREAL Relative path Options ST_Nc Time Conversion O Data structure with options for the extrapolation of the relative path. ptions [} 42] Outputs VAR_OUTPUT Duration : DINT; Time Of Position : T_DCTIME32; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Duration DINT Time period in nanoseconds after which the relative path will have been travelled (>0) or which has elapsed since then (<0). Duration is a differential value from two variables of the type T_DCTIME32 Time Of Position T_DCTIME32 Distributed clock system time at which the relative path distance was or will have been be travelled. Dc Time contains the lower 32 bits of the complete Dc Time and covers a time range of +/- 2 seconds around the current time. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. TF5065 Version: 2.3.2 55
## Page 56

PLC libraries 4.2.1.2 Cam controller 4.2.1.2.1 XFC_Path Position Cam XFC_Path Position Cam HParam UDINT First Path Id UDINT Last Path Id UDINT First On Path Position LREAL Last On Path Position LREAL On Compensation LREAL Off Compensation LREAL Options ST_Cam Switch Options ↔ Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF ↔ Output Reference To OUTPUT_REF The function block XFC_Path Position Cam realizes a path cam that switches a digital output on and off depending on the path. In contrast to the digital cam controller MC_Path Digital Cam Switch_Multi Edge [} 57], the function block switches precisely one cam on a digital output track. This facilitates parameterization of the function block, although it cannot be used if several cams are required on an output track. In addition to the switching state of the digital output the output data structure contains precise time information for the next switching operations. This information is used for the actual output at an XFC output terminal with a downstream function block (XFC_EL2252_V2 [} 35] or XFC_EL2262 [} 38]). Inputs VAR_INPUT HParam : UDINT; First Path Id : UDINT; Last Path Id : UDINT; First On Path Position : LREAL; Last On Path Position : LREAL; On Compensation : LREAL; Off Compensation : LREAL; Options : ST_Cam Switch Options; END_VAR Name Type Description HParam UDINT H-parameter value that corresponds to the switching state. First Path Id UDINT Unique ID that continually increases over the path and belongs to the relative path until the cam switches on. Last Path Id UDINT Unique ID that continually increases over the path and belongs to the relative path until the cam switches off. First On Path Position LREAL Relative path until the cam switches on. Last On Path Position LREAL Relative path until the cam switches off. On Compensation LREAL Compensation time for the rising edge of the cam in [s]. For negative values of On Compensation the switching time is brought forward, otherwise it is delayed. The value On Compensation parameterized here has priority over TRACK_REF Off Compensation LREAL Compensation time for the falling edge of the cam in [s]. For negative values of Off Compensation the switching time is brought forward, otherwise it is delayed. The value Off Compensation parameterized here has priority over TRACK_REF 56 Version: 2.3.2 TF5065
## Page 57

PLC libraries Name Type Description Options ST_Cam Switch Options Optional parameters [} 45] / Inputs/outputs VAR_IN_OUT Nci To Plc : Nci Channel To Plc; Output : OUTPUT_REF; END_VAR Name Type Description Nci To Plc Nci Channel To Plc The structure of the cyclic channel interface from the NCI to the PLC. This structure is only accessed for reading Output OUTPUT_REF [} 44] The data structure Output contains the calculated state of the digital output and the associated time stamp for the output at a digital XFC output terminal 4.2.1.2.2 MC_Path Digital Cam Switch_Multi Edge MC_Path Digital Cam Switch_Multi Edge Enable BOOL BOOL In Operation HParam UDINT BOOL Busy Options ST_Cam Switch Options BOOL Error ↔ Nci To Plc Reference To NCTOPLC_NCICHANNEL_REF UDINT Error ID ↔ Switches Reference To PATH_CAMSWITCH_REF ↔ Output Reference To OUTPUT_REF_MULTIEDGE ↔ Track Options Reference To TRACK_REF The function block MC_Path Digital Cam Switch_Multi Edge is a digital cam controller with one or several cams on a digital output track. The function block is capable of performing several switching operations during a PLC cycle. The switching operations are defined by position cams. Further output tracks can be realized with independent instances of the function block. In addition to the switching states of the digital output the output data structure contains precise time information for the next switching operations. With this information, the actual output can take place on an XFC multi-timestamp output terminal with a downstream function block (XFC_EL1259_Multi Edge, XFC_EL2212_Multi Edge [} 33], XFC_EL2262_Multi Edge [} 39] or XFC_EL2258_Multi Edge [} 37]). Time cams and brake cams cannot be used with the function block MC_Path Digital Cam Switch_Multi Edge. Terminals without multi-timestamp functionality are not suitable for use with this function block. Inputs VAR_INPUT Enable : BOOL; HParam : DINT; Options : ST_Cam Switch Options; END_VAR Name Type Description Enable BOOL The cam controller is activated via the Enable input. The initial state remains unchanged, as long as Enable=FALSE. HParam DINT H-parameter value that corresponds to the switching state TRUE. Options ST_Cam Switch Options Optional parameters [} 45] TF5065 Version: 2.3.2 57
## Page 58

PLC libraries / Inputs/outputs VAR_IN_OUT Nci To Plc : NCTOPLC_NCICHANNEL_REF; Switches : PATH_CAMSWITCH_REF; Output : OUTPUT_REF_MULTIEDGE; Track Options : TRACK_REF; END_VAR Name Type Description Nci To Plc NCTOPLC_NCICHANN The structure of the cyclic channel interface from the NCI EL_REF to the PLC. This structure is only accessed for reading. Switches PATH_CAMSWITCH_REF The data structure Switches contains a reference to the parameterization of all cams on the cam track. [} 59] Output OUTPUT_REF_MULTIED The data structure Output contains the calculated states of the digital output and the associated time stamps for the GE [} 45] output at a digital XFC output terminal. Track Options TRACK_REF [} 46] The data structure Track Options contains the parameterization for the cam track. Outputs VAR_OUTPUT In Operation : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description In Operation BOOL In Operation is TRUE, as long as the cam controller is active and the cam track is calculated according to the cam parameterization. Busy BOOL Busy is TRUE as long as the block function is not completed. Error BOOL Becomes TRUE if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number 4.2.2 Data types 4.2.2.1 MC_Path Cam Switch The data type MC_Path Cam Switch contains all parameters of a digital cam for a digital cam controller MC_Path Digital Cam Switch_Multi Edge [} 57]. TYPE MC_Path Cam Switch : STRUCT First On Position : LREAL; Last On Position : LREAL; First Path Id : UDINT; Last Path Id : UDINT; Cam Switch Mode : E_Cam Switch Mode; Duration : LREAL; END_STRUCT END_TYPE The data structure for parameterization of a digital cam controller is usually an ARRAY OF MC_Path Cam Switch. A further structure PATH_CAMSWITCH_REF [} 59] refers to this structure. Name Type Description First On Position LREAL First position from which the cam is switched on. 58 Version: 2.3.2 TF5065
## Page 59

PLC libraries Name Type Description Last On Position LREAL Last position up to which the cam is switched on. The cam function is inverted, if Last On Position < First On Position. Last On Positionis is not used for time cams. First Path Id UDINT Unique ID that continually increases over the path and belongs to the relative path until the cam switches on. Last Path Id UDINT Unique ID that continually increases over the path and belongs to the relative path until the cam switches off. Cam Switch Mode E_Cam Switch Mode Digital cam type (position cam, time cam or brake cam). [} 43] Duration LREAL Duration defines the switch-on time of the cam in [s] and is only used for time cams. TYPE E_Cam Switch Mode : ( CAMSWITCHMODE_POSITION, (* position cam *) CAMSWITCHMODE_TIME, (* time cam *) CAMSWITCHMODE_BREAK (* break cam *) ); END_TYPE 4.2.2.2 PATH_CAMSWITCH_REF The data type PATH_CAMSWITCH_REF refers to a data structure with cam parameters for a digital cam controller MC_Path Digital Cam Switch_Multi Edge. TYPE PATH_CAMSWITCH_REF : STRUCT Number Of Switches : UDINT; p Switches : POINTER TO MC_Path Cam Switch; Size Of Switches : UDINT; END_STRUCT END_TYPE Name Type Description Number Of Switches UDINT Number of array elements used, can be less than the maximum number. p Switches POINTER TO Pointer to an array of switches, transferred with ADR. MC_Path Cam Switch [} 58] Size Of Switches UDINT Maximum size of the array. The actual data structure for parameterization of a digital cam controller is usually an ARRAY OF MC_Path Cam Switch [} 58]. PATH_CAMSWITCH_REF refers to this structure via a POINTER and clearly defines the size of the structure and the number of cams that were actually used. A variable of type PATH_CAMSWITCH_REF is initialized as illustrated in the following example: VAR Cam Switch Array : ARRAY[1..3] OF MC_Path Cam Switch; Cam Switch Ref : PATH_CAMSWITCH_REF; END_VAR (* real number of defined digital cams *) Cam Switch Ref. Number Of Switches := 1; (* 1..3 *) (* pointer to the digital cam data array *) Cam Switch Ref.p Switches := ADR(Cam Switch Array); (* maximum size of the digital cam data array *) Cam Switch Ref. Size Of Switches := SIZEOF(Cam Switch Array); TF5065 Version: 2.3.2 59
## Page 60

PLC libraries 4.3 Tc3_MC2_Advanced Homing_XFC 4.3.1 Overview The Twin CAT Motion Control PLC library Tc3_MC2_Advanced Homing_XFC includes function blocks for programming machine applications. The Tc3_MC2_Advanced Homing_XFC is based on the similarly revised PLCopen specification for Motion Control function blocks V2.0. This library contains function blocks of Part 5 – Homing Procedures (www. PLCopen.org). Twin CAT version The Tc3_MC2_Advanced Homing_XFC library can be used with Twin CAT version 3.1 Build 4020 or higher. With remote programmed controllers care must be taken that an appropriate version is installed on both the programmer PC and the control PC. In the case of control systems with the operating system Windows CE, the version of the installed image is decisive. Further information, including referencing sequences, can be found in the Motion library Tc3_MC2_Advanced Homing. 4.3.2 Function blocks 4.3.2.1 Referencing functions (passive) 4.3.2.1.1 XFC_Step Reference Flying Switch XFC_Step Reference Flying Switch Execute BOOL BOOL Done Switch Mode MC_Switch_Mode BOOL Busy Reference Signal XFC_Ref_Signal_Ref BOOL Active Set Position LREAL BOOL Command Aborted Time Limit TIME BOOL Error Distance Limit LREAL UDINT Error ID Buffer Mode MC_Buffer Mode Options ST_Home_Options ↔ Axis Reference To AXIS_REF This function block MC_Step Reference Flying Switch performs referencing during a running movement via an absolutely positioned external physical switch. The execution does not start or modify any movement itself. Inputs VAR_INPUT Execute : BOOL; Switch Mode : MC_Switch_Mode; Reference Signal : XFC_Ref_Signal_Ref; Set Position : LREAL; Time Limit : TIME; Distance Limit : LREAL; 60 Version: 2.3.2 TF5065
## Page 61

PLC libraries Buffer Mode : MC_Buffer Mode; Options : ST_Home_Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge at the Execute input. Switch Mode MC_Switch_Mode Enumeration that defines the final condition for the search procedure. Reference Signal XFC_Ref_Signal_Ref [} 78] Configuration of the reference signal source. Set Position LREAL Position value to which the axis position is to be set. Time Limit TIME Exceeding this time leads to the search procedure being aborted. Distance Limit LREAL Exceeding this distance in relation to the start position leads to the search procedure being aborted. Buffer Mode MC_Buffer Mode Currently not implemented. Options ST_Home_Options Currently not used. Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF Axis data structure of the type AXIS_REF, which uniquely addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL Becomes TRUE, if the command was completed successfully. Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. If Busy becomes FALSE again, the function block is ready for a new order. At the same time one of the outputs, Done, Command Aborted or Error, is set. Active BOOL Indicates that the command is executed. Command Aborted BOOL Becomes TRUE, if the command could not be fully executed. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. TF5065 Version: 2.3.2 61
## Page 62

PLC libraries 4.3.2.1.2 XFC_Step Reference Flying Ref Pulse XFC_Step Reference Flying Ref Pulse Execute BOOL BOOL Done Reference Signal XFC_Ref_Signal_Ref BOOL Busy Set Position LREAL BOOL Active Time Limit TIME BOOL Command Aborted Distance Limit LREAL BOOL Error Buffer Mode MC_Buffer Mode UDINT Error ID Options ST_Home_Options ↔ Axis Reference To AXIS_REF This function block XFC_Step Reference Flying Ref Pulse performs referencing during a running movement to the zero pulse of an encoder. The execution does not start or modify any movement itself. Inputs VAR_INPUT Execute : BOOL; Reference Signal : XFC_Ref_Signal_Ref; Set Position : LREAL; Time Limit : TIME; Distance Limit : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Home_Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge at the Execute input. Reference Signal XFC_Ref_Signal_Ref Configuration of the reference signal source. [} 78] Set Position LREAL Position value to which the axis position is to be set. Time Limit TIME Exceeding this time leads to the search procedure being aborted. Distance Limit LREAL Exceeding this distance in relation to the start position leads to the search procedure being aborted. Buffer Mode MC_Buffer Mode Currently not implemented. Options ST_Home_Options Currently not used. Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF Axis data structure of the type AXIS_REF, which uniquely addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR 62 Version: 2.3.2 TF5065
## Page 63

PLC libraries Name Type Description Done BOOL Becomes TRUE, if the command was completed successfully. Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. If Busy becomes FALSE again, the function block is ready for a new order. At the same time one of the outputs, Done, Command Aborted or Error, is set. Active BOOL Indicates that the command is executed. Command Aborted BOOL Becomes TRUE, if the command could not be fully executed. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 4.3.2.2 Step functions 4.3.2.2.1 XFC_Step Absolute Switch XFC_Step Absolute Switch Execute BOOL BOOL Done Direction MC_Home_Direction BOOL Busy Switch Mode MC_Switch_Mode BOOL Active Reference Signal XFC_Ref_Signal_Ref BOOL Command Aborted Velocity LREAL BOOL Error Acceleration LREAL UDINT Error ID Deceleration LREAL Jerk LREAL Set Position LREAL Time Limit TIME Distance Limit LREAL Torque Limit LREAL Positive Limit Switch BOOL Negative Limit Switch BOOL Buffer Mode MC_Buffer Mode Options ST_Home_Options4 ↔ Axis Reference To AXIS_REF ↔ Parameter Reference To MC_Homing Parameter This function block searches for an absolutely positioned, external physical switch. In general, an absolute switch has two "off" areas and one "on" area. TF5065 Version: 2.3.2 63
## Page 64

PLC libraries If the absolute switch cannot be overcrossed, then it has only one "off" area and one "on" area. Inputs VAR_INPUT Execute : BOOL; Direction : MC_Home_Direction; Switch Mode : MC_Switch_Mode; Reference Signal : XFC_Ref_Signal_Ref; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Set Position : LREAL; Time Limit : TIME; Distance Limit : LREAL; Torque Limit : LREAL; Positive Limit Switch : BOOL; Negative Limit Switch : BOOL; Buffer Mode : MC_Buffer Mode; Options : ST_Home_Options4; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge at the Execute input. Direction MC_Home_Direction Enumeration that defines the initial direction of movement for the search procedure. Switch Mode MC_Switch_Mode Enumeration that defines the final condition for the search procedure. 64 Version: 2.3.2 TF5065
## Page 65

PLC libraries Name Type Description Reference Signal XFC_Ref_Signal_Ref [} 78] This structure defines the source of the reference cam signal. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0). If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0). If the value is 0, the standard jerk from the axis configuration in the System Manager is used. Set Position LREAL Position value to which the axis position is to be set. Time Limit TIME Exceeding this time leads to the search procedure being aborted. Distance Limit LREAL Exceeding this distance in relation to the start position leads to the search procedure being aborted. Torque Limit LREAL The motor torque is limited to this value in order to avoid mechanical damage. Positive Limit Switch BOOL Signal of the hardware limit switch in the logically positive direction of movement (Positive Limit Switch = FALSE within the permissible travel range). Negative Limit Switch BOOL Signal of the hardware limit switch in the logically negative direction of movement (Negative Limit Switch = FALSE within the permissible travel range). Buffer Mode MC_Buffer Mode Currently not implemented Options ST_Home_Options4 Disable Drive Access: Set to FALSE for Beckhoff drives, usually to TRUE for third-party drives (see info). Enable Lag Error Detection: In the step functions, the lag error detection is switched off in order to ensure a smooth referencing process. If it would be purposeful to keep the lag error detection active in an application, this can be achieved by setting this flag. If Disable Drive Access = TRUE, the user is responsible for modifying and reconstructing required drive parameters. The parameters required for the intended homing sequence must be agreed with the manufacturer of the third-party drive. / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Parameter : MC_Homing Parameter; END_VAR Name Type Description Axis AXIS_REF Axis data structure of the type AXIS_REF, which uniquely addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Parameter MC_Homing Parameter Data structure of the type MC_Homing Parameter, which must be transferred from function block to function block over the entire homing sequence. TF5065 Version: 2.3.2 65
## Page 66

PLC libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL Becomes TRUE, if the command was completed successfully. Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. If Busy becomes FALSE again, the function block is ready for a new order. At the same time one of the outputs, Done, Command Aborted or Error, is set. Active BOOL Indicates that the command is executed. Command Aborted BOOL Becomes TRUE, if the command could not be fully executed. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 4.3.2.2.2 XFC_Step Absolute Switch Detection XFC_Step Absolute Switch Detection Execute BOOL BOOL Done Direction MC_Home_Direction BOOL Busy Switch Mode MC_Switch_Mode BOOL Active Reference Signal XFC_Ref_Signal_Ref BOOL Command Aborted Velocity LREAL BOOL Error Acceleration LREAL UDINT Error ID Deceleration LREAL LREAL Recorded Position Jerk LREAL Time Limit TIME Distance Limit LREAL Torque Limit LREAL Positive Limit Switch BOOL Negative Limit Switch BOOL Buffer Mode MC_Buffer Mode Options ST_Home_Options4 ↔ Axis Reference To AXIS_REF ↔ Parameter Reference To MC_Homing Parameter This function block searches for an absolutely positioned, external physical switch. In general, an absolute switch has two "off" areas and one "on" area. 66 Version: 2.3.2 TF5065
## Page 67

PLC libraries If the absolute switch cannot be overcrossed, then it has only one "off" area and one "on" area. The ".. Detection" version of this function block does not manipulate the current position of the axis at the end of the sequence, but instead returns the detected position to the user as "Recorded Position". Inputs VAR_INPUT Execute : BOOL; Direction : MC_Home_Direction; Switch Mode : MC_Switch_Mode; Reference Signal : XFC_Ref_Signal_Ref; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Time Limit : TIME; Distance Limit : LREAL; Torque Limit : LREAL; Positive Limit Switch : BOOL; Negative Limit Switch : BOOL; Buffer Mode : MC_Buffer Mode; Options : ST_Home_Options4; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge at the Execute input. Direction MC_Home_Direction Enumeration that defines the initial direction of movement for the search procedure. Switch Mode MC_Switch_Mode Enumeration that defines the final condition for the search procedure. TF5065 Version: 2.3.2 67
## Page 68

PLC libraries Name Type Description Reference Signal XFC_Ref_Signal_Ref [} 78] This structure defines the source of the reference cam signal. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0). If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0). If the value is 0, the standard jerk from the axis configuration in the System Manager is used. Time Limit TIME Exceeding this time leads to the search procedure being aborted. Distance Limit LREAL Exceeding this distance in relation to the start position leads to the search procedure being aborted. Torque Limit LREAL The motor torque is limited to this value in order to avoid mechanical damage. Positive Limit Switch BOOL Signal of the hardware limit switch in the logically positive direction of movement (Positive Limit Switch = FALSE within the permissible travel range). Negative Limit Switch BOOL Signal of the hardware limit switch in the logically negative direction of movement (Negative Limit Switch = FALSE within the permissible travel range). Buffer Mode MC_Buffer Mode Currently not implemented Options ST_Home_Options4 Disable Drive Access: Set to FALSE for Beckhoff drives, usually to TRUE for third-party drives (see info). Enable Lag Error Detection: In the step functions, the lag error detection is switched off in order to ensure a smooth referencing process. If it would be purposeful to keep the lag error detection active in an application, this can be achieved by setting this flag. If Disable Drive Access = TRUE, the user is responsible for modifying and reconstructing required drive parameters. The parameters required for the intended homing sequence must be agreed with the manufacturer of the third-party drive. / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Parameter : MC_Homing Parameter; END_VAR Name Type Description Axis AXIS_REF Axis data structure of the type AXIS_REF, which uniquely addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Parameter MC_Homing Parameter Data structure of the type MC_Homing Parameter, which must be transferred from function block to function block over the entire homing sequence. 68 Version: 2.3.2 TF5065
## Page 69

PLC libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; Recorded Position : LREAL; END_VAR Name Type Description Done BOOL Becomes TRUE, if the command was completed successfully. Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. When Busy becomes FALSE again, the function block is ready for a new order. At the same time one of the outputs, Done, Command Aborted or Error, is set. Active BOOL Indicates that the command is executed. Command Aborted BOOL Becomes TRUE, if the command could not be fully executed. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Recorded Position LREAL Axis position at which the event was recorded. 4.3.2.2.3 XFC_Step Limit Switch XFC_Step Limit Switch Execute BOOL BOOL Done Direction MC_Home_Direction BOOL Busy Limit Switch Mode MC_Switch_Mode BOOL Active Limit Switch Signal XFC_Ref_Signal_Ref BOOL Command Aborted Velocity LREAL BOOL Error Acceleration LREAL UDINT Error ID Deceleration LREAL Jerk LREAL Set Position LREAL Torque Limit LREAL Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode Options ST_Home_Options4 ↔ Axis Reference To AXIS_REF ↔ Parameter Reference To MC_Homing Parameter This function block performs the search for a hardware limit switch. Inputs VAR_INPUT Execute : BOOL; Direction : MC_Home_Direction; Limit Switch Mode : MC_Switch_Mode; Limit Switch Signal : XFC_Ref_Signal_Ref; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Set Position : LREAL; Time Limit : TIME; Distance Limit : LREAL; Torque Limit : LREAL; TF5065 Version: 2.3.2 69
## Page 70

PLC libraries Buffer Mode : MC_Buffer Mode; Options : ST_Home_Options4; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge at the Execute input. Direction MC_Home_Direction Enumeration that defines the initial direction of movement for the search procedure. Limit Switch Mode MC_Switch_Mode Enumeration that defines the final condition for the search procedure. Limit Switch Signal XFC_Ref_Signal_Ref [} 78] This structure defines the source of the reference cam signal. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0). If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0). If the value is 0, the standard jerk from the axis configuration in the System Manager is used. Set Position LREAL Position value to which the axis position is to be set. Time Limit TIME Exceeding this time leads to the search procedure being aborted. Distance Limit LREAL Exceeding this distance in relation to the start position leads to the search procedure being aborted. Torque Limit LREAL The motor torque is limited to this value in order to avoid mechanical damage. Buffer Mode MC_Buffer Mode Currently not implemented. Options ST_Home_Options4 Disable Drive Access: Set to FALSE for Beckhoff drives, usually to TRUE for third-party drives (see info). Enable Lag Error Detection: In the step functions, the lag error detection is switched off in order to ensure a smooth referencing process. If it would be purposeful to keep the lag error detection active in an application, this can be achieved by setting this flag. If Disable Drive Access = TRUE, the user is responsible for modifying and reconstructing required drive parameters. The parameters required for the intended homing sequence must be agreed with the manufacturer of the third-party drive. 70 Version: 2.3.2 TF5065
## Page 71

PLC libraries / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Parameter : MC_Homing Parameter; END_VAR Name Type Description Axis AXIS_REF Axis data structure of the type AXIS_REF, which uniquely addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Parameter MC_Homing Parameter Data structure of the type MC_Homing Parameter, which must be transferred from function block to function block over the entire homing sequence. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL Becomes TRUE, if the command was completed successfully. Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. If Busy becomes FALSE again, the function block is ready for a new order. At the same time one of the outputs, Done, Command Aborted or Error, is set. Active BOOL Indicates that the command is executed. Command Aborted BOOL Becomes TRUE, if the command could not be fully executed. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. TF5065 Version: 2.3.2 71
## Page 72

PLC libraries 4.3.2.2.4 XFC_Step Limit Switch Detection XFC_Step Limit Switch Detection Execute BOOL BOOL Done Direction MC_Home_Direction BOOL Busy Limit Switch Mode MC_Switch_Mode BOOL Active Limit Switch Signal XFC_Ref_Signal_Ref BOOL Command Aborted Velocity LREAL BOOL Error Acceleration LREAL UDINT Error ID Deceleration LREAL LREAL Recorded Position Jerk LREAL Torque Limit LREAL Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode Options ST_Home_Options4 ↔ Axis Reference To AXIS_REF ↔ Parameter Reference To MC_Homing Parameter This function block performs the search for a hardware limit switch. The "…Detection" version of this function block does not manipulate the current position of the axis at the end of the sequence, but instead returns the detected position to the user as "Recorded Position". Inputs VAR_INPUT Execute : BOOL; Direction : MC_Home_Direction; Limit Switch Mode : MC_Switch_Mode; Limit Switch Signal : XFC_Ref_Signal_Ref; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Time Limit : TIME; Distance Limit : LREAL; Torque Limit : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Home_Options4; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge at the Execute input. Direction MC_Home_Direction Enumeration that defines the initial direction of movement for the search procedure. Limit Switch Mode MC_Switch_Mode Enumeration that defines the final condition for the search procedure. Limit Switch Signal XFC_Ref_Signal_Ref [} 78] This structure defines the source of the reference cam signal. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0). If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0). If the value is 0, the standard jerk from the axis configuration in the System Manager is used. Time Limit TIME Exceeding this time leads to the search procedure being aborted. 72 Version: 2.3.2 TF5065
## Page 73

PLC libraries Name Type Description Distance Limit LREAL Exceeding this distance in relation to the start position leads to the search procedure being aborted. Torque Limit LREAL The motor torque is limited to this value in order to avoid mechanical damage. Buffer Mode MC_Buffer Mode Currently not implemented. Options ST_Home_Options4 Disable Drive Access: Set to FALSE for Beckhoff drives, usually to TRUE for third-party drives (see info). Enable Lag Error Detection: In the step functions, the lag error detection is switched off in order to ensure a smooth referencing process. If it would be purposeful to keep the lag error detection active in an application, this can be achieved by setting this flag. If Disable Drive Access = TRUE, the user is responsible for modifying and reconstructing required drive parameters. The parameters required for the intended homing sequence must be agreed with the manufacturer of the third-party drive. / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Parameter : MC_Homing Parameter; END_VAR Name Type Description Axis AXIS_REF Axis data structure of the type AXIS_REF, which uniquely addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Parameter MC_Homing Parameter Data structure of the type MC_Homing Parameter, which must be transferred from function block to function block over the entire homing sequence. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; Recorded Position : LREAL; END_VAR Name Type Description Done BOOL Becomes TRUE, if the command was completed successfully. Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. When Busy becomes FALSE again, the function block is ready for a new order. At the same time one of the outputs, Done, Command Aborted or Error, is set. Active BOOL Indicates that the command is executed. Command Aborted BOOL Becomes TRUE, if the command could not be fully executed. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Recorded Position LREAL Axis position at which the event was recorded. TF5065 Version: 2.3.2 73
## Page 74

PLC libraries 4.3.2.2.5 XFC_Step Reference Pulse XFC_Step Reference Pulse Execute BOOL BOOL Done Direction MC_Home_Direction BOOL Busy Reference Signal XFC_Ref_Signal_Ref BOOL Active Velocity LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error ID Jerk LREAL Set Position LREAL Torque Limit LREAL Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode Options ST_Home_Options4 ↔ Axis Reference To AXIS_REF ↔ Parameter Reference To MC_Homing Parameter This function block performs the search for a zero pulse of an encoder. A zero pulse is not present in all encoders and occurs only once per encoder revolution. The advantage of using a zero pulse for referencing is the high accuracy of this signal compared to that of a standard sensor. Inputs VAR_INPUT Execute : BOOL; Direction : MC_Home_Direction; Switch Mode : MC_Switch_Mode; Reference Signal : XFC_Ref_Signal_Ref; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Set Position : LREAL; Time Limit : TIME; Distance Limit : LREAL; Torque Limit : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Home_Options4; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge at the Execute input. Direction MC_Home_Direction Enumeration that defines the initial direction of movement for the search procedure. Switch Mode MC_Switch_Mode Enumeration that defines the final condition for the search procedure. Reference Signal XFC_Ref_Signal_Ref [} 78] This structure defines the source of the reference cam signal. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0). If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0). If the value is 0, the standard jerk from the axis configuration in the System Manager is used. Set Position LREAL Position value to which the axis position is to be set. 74 Version: 2.3.2 TF5065
## Page 75

PLC libraries Name Type Description Time Limit TIME Exceeding this time leads to the search procedure being aborted. Distance Limit LREAL Exceeding this distance in relation to the start position leads to the search procedure being aborted. Torque Limit LREAL The motor torque is limited to this value in order to avoid mechanical damage. Buffer Mode MC_Buffer Mode Currently not implemented. Options ST_Home_Options4 Disable Drive Access: Set to FALSE for Beckhoff drives, usually to TRUE for third-party drives (see info). Enable Lag Error Detection: In the step functions the lag error detection is switched off in order to ensure a smooth referencing process. If it would be purposeful to keep the lag error detection active in an application, this can be achieved by setting this flag. If Disable Drive Access = TRUE, the user is responsible for modifying and reconstructing required drive parameters. The parameters required for the intended homing sequence must be agreed with the manufacturer of the third-party drive. / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Parameter : MC_Homing Parameter; END_VAR Name Type Description Axis AXIS_REF Axis data structure of the type AXIS_REF, which uniquely addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Parameter MC_Homing Parameter Data structure of the type MC_Homing Parameter, which must be transferred from function block to function block over the entire homing sequence. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL Becomes TRUE, if the command was completed successfully. Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. If Busy becomes FALSE again, the function block is ready for a new order. At the same time one of the outputs, Done, Command Aborted or Error, is set. Active BOOL Indicates that the command is executed. TF5065 Version: 2.3.2 75
## Page 76

PLC libraries Name Type Description Command Aborted BOOL Becomes TRUE, if the command could not be fully executed. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 4.3.2.2.6 XFC_Step Reference Pulse Detection XFC_Step Reference Pulse Detection Execute BOOL BOOL Done Direction MC_Home_Direction BOOL Busy Reference Signal XFC_Ref_Signal_Ref BOOL Active Velocity LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error ID Jerk LREAL LREAL Recorded Position Torque Limit LREAL Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode Options ST_Home_Options4 ↔ Axis Reference To AXIS_REF ↔ Parameter Reference To MC_Homing Parameter This function block performs the search for a zero pulse of an encoder. A zero pulse is not present in all encoders and occurs only once per encoder revolution. The advantage of using a zero pulse for referencing is the high accuracy of this signal compared to that of a standard sensor. The "…Detection" version of this function block does not manipulate the current position of the axis at the end of the sequence, but instead returns the detected position to the user as "Recorded Position". Inputs VAR_INPUT Execute : BOOL; Direction : MC_Home_Direction; Switch Mode : MC_Switch_Mode; Reference Signal : XFC_Ref_Signal_Ref; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Time Limit : TIME; Distance Limit : LREAL; Torque Limit : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Home_Options4; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge at the Execute input. Direction MC_Home_Direction Enumeration that defines the initial direction of movement for the search procedure. Switch Mode MC_Switch_Mode Enumeration that defines the final condition for the search procedure. Reference Signal XFC_Ref_Signal_Ref [} 78] This structure defines the source of the reference cam signal. Velocity LREAL Maximum travel velocity (>0). 76 Version: 2.3.2 TF5065
## Page 77

PLC libraries Name Type Description Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0). If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0). If the value is 0, the standard jerk from the axis configuration in the System Manager is used. Time Limit TIME Exceeding this time leads to the search procedure being aborted. Distance Limit LREAL Exceeding this distance in relation to the start position leads to the search procedure being aborted. Torque Limit LREAL The motor torque is limited to this value in order to avoid mechanical damage. Buffer Mode MC_Buffer Mode Currently not implemented. Options ST_Home_Options4 Disable Drive Access: Set to FALSE for Beckhoff drives, usually to TRUE for third-party drives (see info). Enable Lag Error Detection: In the step functions, the lag error detection is switched off in order to ensure a smooth referencing process. If it would be purposeful to keep the lag error detection active in an application, this can be achieved by setting this flag. If Disable Drive Access = TRUE, the user is responsible for modifying and reconstructing required drive parameters. The parameters required for the intended homing sequence must be agreed with the manufacturer of the third-party drive. / Inputs/Outputs VAR_IN_OUT Axis : AXIS_REF; Parameter : MC_Homing Parameter; END_VAR Name Type Description Axis AXIS_REF Axis data structure of the type AXIS_REF, which uniquely addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Parameter MC_Homing Parameter Data structure of the type MC_Homing Parameter, which must be transferred from function block to function block over the entire homing sequence. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; Recorded Position : LREAL; END_VAR Name Type Description Done BOOL Becomes TRUE, if the command was completed successfully. TF5065 Version: 2.3.2 77
## Page 78

PLC libraries Name Type Description Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. When Busy becomes FALSE again, the function block is ready for a new order. At the same time one of the outputs, Done, Command Aborted or Error, is set. Active BOOL Indicates that the command is executed. Command Aborted BOOL Becomes TRUE, if the command could not be fully executed. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Recorded Position LREAL Axis position at which the event was recorded. 4.3.3 Data types 4.3.3.1 General 4.3.3.1.1 XFC_Ref_Signal_Ref TYPE XFC_Ref_Signal_Ref : STRUCT Level : BOOL; Time Stamp Rising Edge : UDINT; Time Stamp Falling Edge : UDINT; END_STRUCT END_TYPE Name Type Description Level BOOL The current signal state of the sensor must be transferred here. Time Stamp Risin UDINT Timestamp of the last rising edge of the digital input signal. g Edge If the input signal supplies a 64-bit timestamp T_DCTIME, only the lower 32 bits are supplied. It is therefore important to ensure that the value at the time of the evaluation is not older than 2 seconds. Time Stamp Fallin UDINT Timestamp of the last falling edge of the digital input signal. g Edge If the input signal supplies a 64-bit timestamp T_DCTIME, only the lower 32 bits are supplied. It is therefore important to ensure that the value at the time of the evaluation is not older than 2 seconds. 78 Version: 2.3.2 TF5065
## Page 79

Samples 5 Samples XFC Touch Probe The XFC_Touch Probe [} 27] function block records an axis position at the time of the edge of a digital input signal (measuring probe function). The following example shows how the function block can be used in free- running (Free Run = TRUE) or in single-shot mode (Free Run = FALSE). Download: https://infosys.beckhoff.com/content/1033/TF5065_TC3_PLC_Motion_Control_XFC/XFC_NCI/ Resources/12595575307.zip NCI XFC Fast output switching This example shows how an output can be switched using the XFC functionalities in conjunction with the NCI. Download: https://infosys.beckhoff.com/content/1033/TF5065_TC3_PLC_Motion_Control_XFC/XFC_NCI/ Resources/13632374795.zip TF5065 Version: 2.3.2 79
## Page 80

Support and Service 6 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 80 Version: 2.3.2 TF5065
## Page 81

Trademark statements Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 82

More Information: www.beckhoff.com/TF5065 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
