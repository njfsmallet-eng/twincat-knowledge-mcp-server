---
title: "TF5200_distance_control_en"
product: "TF5200"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.46"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5200_distance_control_en.pdf"
release_date: "2025-06-06"
---
Functional description | EN TF5200 | Twin CAT 3 CNC Distance control 6/6/2025 | Version: 1.46
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5200 | Twin CAT 3 CNC Version: 1.46 3 Distance control
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 5

Table of contents Table of contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Description................................................................................................................................................ 9 3 Control...................................................................................................................................................... 16 4 Smoothing sensor data.......................................................................................................................... 17 4.1 Moving averaging filter.................................................................................................................... 19 4.2 Exponentially weighted averaging filter........................................................................................... 20 4.2.1 Influence of parameters................................................................................................... 20 4.3 Low-pass filters............................................................................................................................... 21 4.4 Kalman filter with averaging filter model......................................................................................... 21 4.4.1 Influence of parameters:.................................................................................................. 22 4.5 Kalman filter with exponential model............................................................................................... 24 4.5.1 Influence of parameters:.................................................................................................. 24 5 Operation mode of distance control...................................................................................................... 27 5.1 Specifying the workpiece surface (SET_POS, surface).................................................................. 28 5.2 Specifying the distance (SET_DIST, distance)............................................................................... 34 6 Programming........................................................................................................................................... 38 7 Various distance control options.......................................................................................................... 41 7.1 Option: Use of distance sensor and motor encoder........................................................................ 41 7.2 Option: Weighting of acceleration dependent on distance deviation.............................................. 43 7.3 Option: Dead time reduction........................................................................................................... 44 7.4 Option: Dynamic weighting of the lowering movement................................................................... 45 7.5 Parameter display........................................................................................................................... 46 7.6 Changing parameters...................................................................................................................... 47 8 Parameter................................................................................................................................................. 48 8.1 Overview......................................................................................................................................... 48 8.2 Description...................................................................................................................................... 50 8.3 Example of distance axis................................................................................................................ 62 8.4 CNC objects of axis-specific distance control................................................................................. 63 9 PLC interface........................................................................................................................................... 69 9.1 Distance control states and transitions........................................................................................... 69 9.2 Control commands for distance control........................................................................................... 72 10 Error messages....................................................................................................................................... 75 11 Support and Service............................................................................................................................... 76 Index......................................................................................................................................................... 77 TF5200 | Twin CAT 3 CNC Version: 5 Distance control
## Page 6

Table of contents 6 Version: TF5200 | Twin CAT 3 CNC Distance control
## Page 7

List of figures List of figures Fig. 1 Specifying the ideal workpiece surface for height control............................................................ 9 Fig. 2 Specifying the distance to workpiece for height control............................................................... 10 Fig. 3 Structure of distance control in conjunction with other compensations........................................ 12 Fig. 4 Sensing the workpiece surface.................................................................................................... 13 Fig. 5 Twin CAT configuration example for SERCOS (ID S-0-0053)...................................................... 14 Fig. 6 Twin CAT configuration example for CANopen DS402 (PDO 0x60E4, Subindex 1).................... 14 Fig. 7 Twin CAT configuration example for Profi Drive (G1_XIST2)........................................................ 15 Fig. 8 Test set-up to determine the filter effect....................................................................................... 17 Fig. 9 Unfiltered sensor data when crossing over an obstacle............................................................... 18 Fig. 10 Different filter effect with varying n_cycles................................................................................... 19 Fig. 11 Different filter effect due to smoothing factor............................................................................... 20 Fig. 12 Different filter effect with varying n_cycles................................................................................... 21 Fig. 13 Different filter effect with varying n_cycles................................................................................... 22 Fig. 14 Different filter effect with varying sigma....................................................................................... 23 Fig. 15 Different filter effect with varying n_cycles................................................................................... 24 Fig. 16 Different filter effect with varying smoothing factor...................................................................... 25 Fig. 17 Different filter effect with varying sigma....................................................................................... 26 Fig. 18 Sensing the workpiece surface.................................................................................................... 27 Fig. 19 Specifying the ideal workpiece surface for distance control......................................................... 28 Fig. 20 Block diagram of distance control................................................................................................ 28 Fig. 21 Ideal workpiece............................................................................................................................ 30 Fig. 22 Real workpiece without distance control...................................................................................... 31 Fig. 23 Real workpiece with distance control........................................................................................... 32 Fig. 24 Constant workpiece surface with changed tool distance............................................................. 32 Fig. 25 Specifying the distance to workpiece for height control............................................................... 34 Fig. 26 Profiled workpiece surface with constant tool distance................................................................ 35 Fig. 27 Specifying the distance: distance................................................................................................. 36 Fig. 28 Block diagram of distance control with distance specification...................................................... 37 Fig. 29 Block diagram of distance control with distance sensor............................................................... 41 Fig. 30 Block diagram with distance sensor and motor encoder.............................................................. 42 Fig. 31 Distance-dependent acceleration weighting................................................................................ 43 Fig. 32 Reduction in velocity by dynamic weighting of the lowering movement....................................... 45 Fig. 33 Reduction in acceleration by dynamic weighting of the lowering movement............................... 45 Fig. 34 Axis-specific CNC objects in the position control loop................................................................. 46 Fig. 35 View Option: Adaptive acceleration weighting............................................................................. 54 Fig. 36 Distance control state graph and transitions................................................................................ 69 TF5200 | Twin CAT 3 CNC Version: 1.46 7 Distance control
## Page 8

Overview 1 Overview Task Distance control has the task of controlling the distance between tools and workpieces. This takes place by additional electronic probe systems or sensors which detect the actual distance and then send the measurement to the controller. For example, distance control compensates for thickness tolerances in workpieces or prevents the tool from contacting the workpiece in the event of surface unevenness. Characteristics There are two types of distance control: 1. axis-specific variant, also height control, that is configured for an axis 2. channel-specific variant, also 3D distance control Parameterisation The parameters for each variant are configured either: • in the parameters of each axis list [} 48] for axis-specific variants • or in the parameters in the channel for 3D distance control Programming Each of the variants is programmed either: • by the NC command <axis_name> [ DIST_CTRL ...] [} 38] or by the PLC for axis-specific variants • By the NC command #DIST CRL[…] for channel-specific variants Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. 8 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 9

Description 2 Description Task Motions are generated by electronic probe systems or sensors. These motions should superimpose the programmed positions of axes when an NC program is interpolated. This control helps to implement • distance control (e.g. contact with the curved surface of a plate) or • height control (e.g. to compensate for workpiece thickness tolerances). Fig. 1: Specifying the ideal workpiece surface for height control TF5200 | Twin CAT 3 CNC Version: 1.46 9 Distance control
## Page 10

Description Fig. 2: Specifying the distance to workpiece for height control 10 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 11

Description Properties A second measuring system is connected to the controller via a parameterisable sensor source. This measuring system can output axis-specific compensation values to an axis in addition to the interpolated command point to compensate the actual position of the axis. Distance control is enabled and disabled in the • NC program or • via the PLC. Variables relevant to distance control can be parameterised via the axis machine data. Distance control operates in the interpolation cycle of the control system (GEO task). Distance control is only available for SERCOS, PROFIdrive or CANopen drives. Parameterisation overview The motion generated by distance control can be influenced by machine data. • Activate a smoothing filter • Maximum permissible compensation value • Maximum additive axis velocity • Maximum permissible actual value jump of the probe system • Maximum upper axis position • Minimum lower axis position • Tolerance value • Dynamic weighting dependent on distance (as of CNC Build V2.11.2804.02) • Dynamic weighting dependent on lowering movement (as of CNC Build V2.11.2807.13) Enable/disable is executed either by the NC program or the PLC. TF5200 | Twin CAT 3 CNC Version: 1.46 11 Distance control
## Page 12

Description Fig. 3: Structure of distance control in conjunction with other compensations 12 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 13

Description Fig. 4: Sensing the workpiece surface Correction of set position The actual workpiece surface produces a height offset: where This results in a correction of the programmed command position Pos of the tool as follows: Cmd TF5200 | Twin CAT 3 CNC Version: 1.46 13 Distance control
## Page 14

Description Configuration overview The encoder of the electronic probe system is connected to the controlled axis as actual value encoder 2. Make sure that the first configured encoder is used for axis position control and the second encoder for distance control. Encoder for distance control. Fig. 5: Twin CAT configuration example for SERCOS (ID S-0-0053) Fig. 6: Twin CAT configuration example for CANopen DS402 (PDO 0x60E4, Subindex 1) 14 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 15

Description Fig. 7: Twin CAT configuration example for Profi Drive (G1_XIST2) NOTICE The axis-specific feed override and the axis-specific feedhold enable act on distance control (see [HLI// Control commands of an axis]). When override is 0 or when feedhold is set, distance control is no longer active and the current value is frozen. TF5200 | Twin CAT 3 CNC Version: 1.46 15 Distance control
## Page 16

Control 3 Control Distance control can be used optionally with P, PI, PD or PID controllers. This helps to combine the different advantages of the individual controllers. If distance control with a P-only controller does not work fast enough or problems occur with oscillation, we advise you to execute control as a PD controller. The I component should only be considered for permanent control deviations. Characteristics of individual controllers for distance control: P controller Weights the output value and affects distance control dynamics. Can be set using P- AXIS-00759 [} 58]. I controller Permanent control deviations are completely compensated after a certain time. If there is no permanent control deviation, we advise you to disable the I component using P-AXIS-00764 [} 59] = 0 to avoid a negative effect on distance control dynamics. D controller The faster the distance values change, the stronger the reaction of the D controller. This helps to reduce oscillations. Can be set using P-AXIS-00765 [} 59]. Step-by-step and iterative parameterisation of the controller: 1. Setting the proportional component using P-AXIS-00759 [} 58]: First set the controller as a P-only controller. This means disabling the I and D controllers by using P- AXIS-00764 [} 59]=0 and P-AXIS-00765 [} 59]=0, respectively. To avoid controller instability, start with a low Kp factor. Normally, a good start value is Kp=0.2. Then observe the response of the control loop at a defined input step, i.e. a change in distance. You can increase the Kp factor step by step un- til there is a recognisable but rapid drop in oscillation. 2. Setting the integral component using P-AXIS-00764 [} 59]: The integral component ensures that permanent control deviations are completely compensated after a certain time. If there are no permanent control deviations, you should disable the integral compon- ent. 3. The controller then operates as a PI controller. To avoid instability, start with a high integral action time value Tn. Normally, a good start value is Tn=5. In analogy to section 1, observe the response of the control loop at a defined change in distance and gradually reduce Tn. A good value for Tn is reached when the control deviation is compensated within the required time without causing any undesirable oscillations. 4. Setting the derivative component using P-AXIS-00765 [} 59]: The controller is then used as a PID or a PD controller. Again, start with a passive value for the deriv- ative action time Tv. Normally, a good start value is Tv=0.01. As before, increase the derivative com- ponent step by step and observe the step response. The aim is to damp oscillations as much as pos- sible without negatively affecting control loop dynamics. 5. Readjusting: To obtain the best controller response, you can even readjust the parameters again. For example, you can correct the P component upwards by using the D component. 16 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 17

Smoothing sensor data 4 Smoothing sensor data Sensor values may be noisy. This can make the distance controller excite the system with oscillations. Filters can help to smooth the input signal and improve the performance of the distance controller. The following sections describe the effect of the filters and the influence of the individual parameters on the filter effect in a single test. For this test, a millimetre high obstacle approx. 2.8mm high was crossed by a sensor. The distance controller is disabled for this test in order to demonstrate the effect of the filters without any feedback from the distance controller. Fig. 8: Test set-up to determine the filter effect The figure below shows the unfiltered sensor data recorded. TF5200 | Twin CAT 3 CNC Version: 1.46 17 Distance control
## Page 18

Smoothing sensor data Fig. 9: Unfiltered sensor data when crossing over an obstacle When you select a filter, remember that the filters introduce a dead time into the system. For the distance controller, this means a slower reaction to changes in distance. When you configure the filter, you must compromise between filter effect and filter delay. The aim of configuring the filter is to achieve the best possible smoothing of the measured values when traversing the smooth plane and, at the same time, the lowest possible delay when reacting to an obstacle. In order to optimise the performance of the distance control, you can also adjust the PID controller at the same time as you configure a suitable filter. WARNING When you configure filters, re- member that an en- abled dis- tance con- troller auto- matically causes a feedback on the filter. This can lead to un- desired be- haviour of the distance controller and even result in os- cillations on the axis. 18 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 19

Smoothing sensor data 4.1 Moving averaging filter The moving average filter is the sequence of arithmetic averages over a number P-AXIS-00413 [} 50] of measured values Influence of the parameter: It is possible to achieve good smoothing of sensor data with a moving average filter. However, smoothing sensor data causes a relatively large delay in the system. The following conditions for the parameters are active: The more measured values are included in the filter via P-AXIS-00413 [} 50], the better the smoothing, but the greater the reaction delay involved. Fig. 10: Different filter effect with varying n_cycles Example parameters: Moving averaging filter kenngr.distc.filter_type MOVING_AVERAGE # Filter type kenngr.distc.n_cycles 20 # Number of included measured values TF5200 | Twin CAT 3 CNC Version: 1.46 19 Distance control
## Page 20

Smoothing sensor data 4.2 Exponentially weighted averaging filter The exponentially weighted averaging filter expands the moving averaging filter by an exponential weighting of the included sensor data. Current measured values are weighted more heavily than older measured values. The weighting of individual measured values is calculated based on a smoothing factor (P- AXIS-00784). The smoothing factor indicates the percentage weighting of the current measured value. 4.2.1 Influence of parameters Smoothing factor (P-AXIS-00784): The greater the weighting of the current measured value, the lower the filter effect but the faster the reaction to changes in the distance. Fig. 11: Different filter effect due to smoothing factor 20 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 21

Smoothing sensor data Number of measured values - n_cycles (P-AXIS-00413): The more measured values are included in the filter via P-AXIS-00413 [} 50], the better the smoothing, but the greater the reaction delay involved. The greater the smoothing factor, the smaller the influence of P- AXIS-00413. Also, the influence of P-AXIS-00413 decreases steadily with increasing numbers due to the exponential weighting. Fig. 12: Different filter effect with varying n_cycles Example parameters: Exponentially weighted averaging filter kenngr.distc.filter_type EXPO_MEAN # Filter type kenngr.distc.n_cycles 30 # Number of included measured values kenngr.distc.smoothing_factor 0.3 # Smoothing factor 4.3 Low-pass filters The oscillation tendency may be suppressed better by using a low-pass filter if the sensor signal is subject to heavy noise. Example parameters kenngr.distc.filter_type LOWPASS # Low-pass filter kenngr.distc.low_pass_filter_order 2 # Low-pass filter kenngr.distc.low_pass_filter_fg_f0 30 # Frequency 30 Hz 4.4 Kalman filter with averaging filter model The Kalman filter tries to estimate the next measured values of the sensor based on a prediction model. The filter first builds the prediction and then refines it by the specified uncertainty of the measured values. The basis of the prediction is the moving averaging filter [} 19]. TF5200 | Twin CAT 3 CNC Version: 1.46 21 Distance control
## Page 22

Smoothing sensor data 4.4.1 Influence of parameters: Number of measured values - n_cycles (P-AXIS-00413): The parameter P-AXIS-00413 [} 50] specifies the number of measured values that are included in the prediction model of the moving averaging filter. Accordingly, the larger the number of included measured values, the better the smoothing effect. The prediction characteristic of the Kalman filter reduces the dead time compared to a conventional moving averaging filter. However, it should be noted that the dead time of the prediction model leads to an oscillation at large changes in distance. The distance increases as the number of included measured values rises (P-AXIS-00413). Fig. 13: Different filter effect with varying n_cycles 22 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 23

Smoothing sensor data Degree of uncertainty - sigma (P-AXIS-00783): The parameter P-AXIS-00783 [} 60] indicates the degree of uncertainty of the recorded measured values. The lower the specified uncertainty of the measured values, the more the prediction from the moving averaging filter is approximated to the actual measured values. Fig. 14: Different filter effect with varying sigma Example parameters: Kalman filter with averaging filter model kenngr.distc.filter_type KALMAN_MA #Filter type kenngr.distc.n_cycles 30 #Number of included measured values kenngr.distc.kalman_sigma 1000 #Uncertainty of measured values TF5200 | Twin CAT 3 CNC Version: 1.46 23 Distance control
## Page 24

Smoothing sensor data 4.5 Kalman filter with exponential model The Kalman filter tries to estimate the next measured values of the sensor based on a prediction model. The filter first forms the prediction and then refines it using the uncertainty of the measured values. The basis of the prediction is the exponentially weighted averaging filter [} 20]. 4.5.1 Influence of parameters: Number of measured values - n_cycles (P-AXIS-00413): The parameter P-AXIS-00413 specifies the number of measured values that are included in the prediction model of the exponentially weighted averaging filter. Accordingly, the larger the number of included measured values, the better the smoothing effect. The prediction characteristic of the Kalman filter reduces the dead time compared to a conventional exponential averaging filter. However, it should be noted that the dead time of the averaging filter leads to an oscillation with large changes in distance. The distance increases as the number of included measured values rises (P-AXIS-00413). Fig. 15: Different filter effect with varying n_cycles 24 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 25

Smoothing sensor data Smoothing factor (P-AXIS-00784) The section Exponentially weighted averaging filter [} 20] explains the influence of the smoothing factor on the exponentially weighted averaging filter. The oscillation caused by the dead time of the filter can be improved by a higher weighting of the current measured value. At the same time, however, this reduces the smoothing effect. Fig. 16: Different filter effect with varying smoothing factor TF5200 | Twin CAT 3 CNC Version: 1.46 25 Distance control
## Page 26

Smoothing sensor data Degree of uncertainty - sigma (P-AXIS-00783): The parameter P-AXIS-00783 indicates the degree of uncertainty of the recorded measured values. The lower the specified uncertainty of the measured values, the more the prediction from the moving averaging filter is approximated to the actual measured values. Fig. 17: Different filter effect with varying sigma Example parameters: Kalman filter with exponential model kenngr.distc.filter_type KALMAN_EXPO #Filter type kenngr.distc.n_cycles 30 #Number of included measured values kenngr.distc.kalman_sigma 1000 #Uncertainty of measured values kenngr.distc.smoothing_factor 0.3 #Smoothing factor 26 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 27

Operation mode of distance control 5 Operation mode of distance control Distance control is integrated after interpolation and superimposes the programmed motion. Distance control acts independently of the current state of the interpolator, i.e. it is active even when it is waiting for acknowledgements (e.g. M functions). Distance control determines the actual absolute position of the workpiece surface with the aid of the axis motor encoder and an additional encoder sensor. The two encoders are coupled to one another, i.e. the values of the two encoders always act in opposite directions when the axes move. The axis-specific feed override and feedhold act on distance control (see [HLI//Control commands of an axis]). When override is 0 or when the axis-specific feedhold is set, the current value of distance control is frozen. Fig. 18: Sensing the workpiece surface The encoder position of the motor and the sensor position must act in opposite directions when the Z axis is lifted or lowered. For example, if the Z axis is lifted and the encoder value of the motor increases, the encoder value of the sensor must be reduced. If required, the parameter P-AXIS-00230 can be used to invert the motion direction of the sensor. TF5200 | Twin CAT 3 CNC Version: 1.46 27 Distance control
## Page 28

Operation mode of distance control 5.1 Specifying the workpiece surface (SET_POS, surface) Calculating deviation The deviation of the real workpiece surface from the specified command position (SET_POS) is determined in each cycle by the electronic probe. Deviation results from: Deviation = motor encoder + sensor encoder - set position (SET_POS) = actual workpiece surface position - set position (SET_POS) To compensate for the workpiece surface deviation, the drive position is additionally moved by the calculated offset of the distance control: Drive setpoint = programmed setpoint (PCS) + distance control offset Fig. 19: Specifying the ideal workpiece surface for distance control Fig. 20: Block diagram of distance control 28 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 29

Operation mode of distance control Selecting and deselecting via the NC program The NC program activates and deactivates distance control and also freezes the current correction value. Example: N10 Z[DIST_CTRL SET_POS=30] Set the position Nxx Z[DIST_CTRL ON] Select … Nxx Z[DIST_CTRL OFF] Deselect N999 M30 The complete CNC syntax is described in the Programming [} 38] chapter. Typical sequence Typical sequence for activating distance control: 1. The tool is replaced. 2. X and Y axes move to machining position. 3. Distance control is activated and the workpiece set position is set. The Z axis must then be located within the detection range of the distance sensor. 4. Sensor or probe ring signals distance; distance control corrects height errors. 5. Z axis is lowered. 6. Distance control is active; thickness tolerances or position differences are compensated. Deactivating distance control: 1. Distance control is deactivated via the NC program 2. Distance control is inactive; thickness tolerances or position differences are no longer compensated; and the current offset remains active until the next position request. TF5200 | Twin CAT 3 CNC Version: 1.46 29 Distance control
## Page 30

Operation mode of distance control Operating principle With distance control, deviations in the position of the workpiece surface (actual position) can be corrected with respect to a specified set position: Fig. 21: Ideal workpiece 30 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 31

Operation mode of distance control Deviation A deviation from the ideal workpiece surface (e.g. with a thinner workpiece) is detected by the sensor (encoder 2): Fig. 22: Real workpiece without distance control TF5200 | Twin CAT 3 CNC Version: 1.46 31 Distance control
## Page 32

Operation mode of distance control Offset compensation After activation of distance control with SET_POS=20 mm (expected workpiece height), the offset is compensated by distance control. As a result, there is no need to adapt the NC program (PCS position). The NC program assumes a constant workpiece surface of Z=20 mm. Fig. 23: Real workpiece with distance control Distance control is automatically deactivated if an axis error or a CNC reset occurs. At program end, distance control remains active. Fig. 24: Constant workpiece surface with changed tool distance 32 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 33

Operation mode of distance control Height changes Changes in the workpiece surface are compensated by distance control. The NC program therefore assumes a plane workpiece. Height changes in the workpiece surface can be defined by programming the axis. At Z=SET_POS the TCP tip touches the workpiece surface. TF5200 | Twin CAT 3 CNC Version: 1.46 33 Distance control
## Page 34

Operation mode of distance control 5.2 Specifying the distance (SET_DIST, distance) Specifying the set distance for distance control is only available as of CNC Build V2.11.2800.28. Distance In addition to specifying the workpiece surface for a given tool height (see previous section), the distance between the tool and the workpiece can also be specified directly in the NC program or via the PLC as of CNC Build V2.11.2800.28. When distance is commanded via the PLC interface, the set distance can be respecified in every cycle. In this case tool height is no longer changed by the NC program but is changed explicitly by distance control. This is especially of advantage when a constant distance needs to be maintained to a workpiece surface of any curvature. For large changes, distance control is supported by additional programming of the Z axis. Fig. 25: Specifying the distance to workpiece for height control NOTICE If distance control is activated in "constant distance" mode, no further changes in distance to the workpiece can be specified for this axis in the NC program by explicit programming of the Z axis. 34 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 35

Operation mode of distance control Fig. 26: Profiled workpiece surface with constant tool distance TF5200 | Twin CAT 3 CNC Version: 1.46 35 Distance control
## Page 36

Operation mode of distance control Fig. 27: Specifying the distance: distance When the Z axis is lifted, distance control must be frozen (FREEZE) or deactivated (OFF), other- wise distance control prevents lifting/lowering. 36 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 37

Operation mode of distance control Fig. 28: Block diagram of distance control with distance specification TF5200 | Twin CAT 3 CNC Version: 1.46 37 Distance control
## Page 38

Programming 6 Programming Syntax for Select by specifying the position of the workpiece surface: <axis_name> [DIST_CTRL ON | DRYRUN [ SET_POS=.. ] ] Syntax for Select by specifying a constant distance to the workpiece surface: <axis_name> [DIST_CTRL ON | DRYRUN CONST_DIST [ SET_DIST=.. ] ] Syntax for Deselect or Freeze offset <axis_name> [DIST_CTRL [ OFF [ NO_MOVE ] ] | FREEZE ] Syntax for Test or reference sensor: <axis_name> [DIST_CTRL CHECK_POS | REF ] Optionally, the following parameters can also be programmed in combination with select/deselect: Syntax for additional sensor parameters: <axis_name> [DIST_CTRL [SENSOR_SOURCE=<ident> SENSOR_VAR=..] [ VAL1=.. - VAL5=.. ] { \ } ] Syntax for additional control parameters: <axis_name> [DIST_CTRL [ KP=.. ] [ I_TN=.. ] [ D_TV=.. ] { \ } ] Syntax for additional parameters for smoothing sensor signal: <axis_name> [DIST_CTRL [ FILTER_TYPE=.. ] [ N_CYCLES=.. ] [ FG_F0=.. ] [ ORDER=.. ] [ SMOOTH_FACT=.. ] [ KALMAN_SIGMA=.. ] { \ } ] <axis_name> Name of the axis supporting the tool. DIST_CTRL Identifier for the "Sensed spindles” function. Must always be programmed as the first keyword. ON Activate distance control specifying the position of the workpiece surface. A set position at activation must be set with SET_POS. SET_POS=.. Specify the position of the workpiece surface in [mm, inch] (absolute position). In the event of reset or program end, the parameter is reset, i.e. a new parameter must be specified before distance control is reactivated. CONST_DIST Activate distance control in combination with ON by specifying a constant distance to the workpiece surface. A distance must be set with SET_DIST at activation. [as of V2.11.2804.03] SET_DIST=.. Specify the constant distance to the workpiece surface in [mm, inch]. In the event of reset or program end, the distance is reset, i.e. a new distance must be specified before distance control is reactivated. DRYRUN In combination with ON, the axis is not tracked in DRYRUN mode when there are changes in the workpiece surface. This allows data to be evaluated without feedback from the controller (e.g. filter effect). [as of V3.1.3079.23] When distance control is activated specifying the position of the workpiece surface, a set position must be set with SET_POS. When distance control is activated specifying a constant distance to the workpiece surface, a set distance must be set with SET_DIST. 38 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 39

Programming OFF Deactivate distance control. NO_MOVE By default, the resulting correction offset is executed when distance control is switched off. This motion can be suppressed by specifying NO_MOVE in combination with OFF. The channel is initialised with the changed axis position. The position offset is only executed at the next axis motion programmed in the NC program. FREEZE Freeze the compensated control distance across the workpiece. The axis position or the output compensation value is maintained. Axis tracking is interrupted. CHECK_POS Check whether position is within the tolerance window. REF Reference measuring system (sensor) (only if there is no absolute measuring system). SENSOR_SOURCE=< Specify the source of the sensor signal [as of V3.1.3080.12 or V3.1.3107.45]. The ident> following sources can be set for channel-specific distance control. Valid identifiers: DEFAULT: IF “DEFAULT” is selected as the sensor source, the CNC automatically sets to the “SECOND_ENCODER” sensor source internally. VARIABLE: The sensor signal is transferred to the CNC by a V. E. variable. In addition, the name of the V. E. variable must also be specified by the parameter “SENSOR_VAR”. SECOND_ENCODER: Make sure that the first configured encoder (P-AXIS-00823) is used for axis position control and the second encoder (P-AXIS-00824) for distance control. SENSOR_VAR=.. Name of the V. E. variable which transfers the sensor signal to the CNC. [as of V3.1.3080.12 or V3.1.3107.45] VAL1=..-VAL5=.. Five freely assignable values in real format. KP=.. Weighting the distance control output values. Parameterisation can be executed analogous to P-AXIS-00759 [} 58]. The value range is limited to 0.0 < KP <= 2.0. For KP values less than 1.0, the distance control dynamics are reduced; for KP values greater than 1.0, the dynamics are increased. A KP factor less than 1 reduces a possible distance control oscillation and steadies control in the event of minor distance errors. [as of V2.11.2809.06 or V3.1.3079.06] I_TN=.. Integral action time of the PID controller in [s]. The integral action time defines the time after which the P and I components of the manipulated variable are equal. Parameterisation can be executed analogous to P-AXIS-00764 [} 59]. The value range is limited to 0.0 <= I_TN <= 50.0. A large integral action time produces greater control stability. The shorter the integration action time, the greater the I component and the faster the control. A short integral action time excites oscillations more strongly. [as of V2.11.2809.06 or V3.1.3079.06] D_TV=.. Derivative action time of the PID controller in [s]. The derivative action time defines the time after which the P and D components of the manipulated variable are equal. Parameterisation can be executed analogous to P-AXIS-00765 [} 59]. The value range is limited to 0.0 <= D_TV <= 2.0. The larger the derivative action time, the stronger the D component. [as of V2.11.2809.06 or V3.1.3079.06] FILTER_TYPE=.. Filter type to filter sensor values according to P-AXIS-00782 [} 59]. [as of V3.1.3079.23] N_CYCLES=.. Number the measured values used for filtering according to P-AXIS-00413 [} 50]. [as of V3.1.3079.23] FG_F0=.. Cut-off frequency for the low-pass filter in [Hz] according to P-AXIS-00508. [as of V3.1.3079.23] ORDER=.. Order of the low-pass filter according to P-AXIS-00507. [as of V3.1.3079.23] SMOOTH_FACT=.. Smoothing factor of the exponential averaging filter according to P-AXIS-00784. Specifies the weighting of the current measured value. KALMAN_SIGMA=.. Uncertainty of the included measured values according to P-AXIS-00783 [} 60]. [as of V3.1.3079.23] \ Separator ("backslash") for clear programming of the command over multiple lines. TF5200 | Twin CAT 3 CNC Version: 1.46 39 Distance control
## Page 40

Programming If distance control is still active at program end, it is not automatically deselected. When a reset or axis error occurs, active distance control is always deselected automatically. Parameters of the PID controller are not reset at program end. Programming examples for distance control %DIST_1 ;Set expected position of the workpiece surface N10 Z[DIST_CTRL SET_POS=30] N20 Z[DIST_CTRL ON] ;Select ; … Nxx Z[DIST_CTRL OFF] ;Deselect N999 M30 %DIST_2 ;Select + set expected position of the workpiece surface N10 Z[DIST_CTRL ON SET_POS=30] ; … Nxx Z[DIST_CTRL FREEZE] ;Hold position ; … Nxx Z[DIST_CTRL OFF] ;Deselect N999 M30 %DIST_3 ;Select + set expected position of the workpiece surface N10 Z[DIST_CTRL ON SET_POS=50] ;Deactivate distance control; Z axis does not move Nxx Z[DIST_CTRL OFF NO_MOVE] ;The generated compensation offset is included for motion ;to the target point 100 Nxx G0 Z100 N999 M30 %DIST_4 ;Set distance parameters N10 Z[DIST_CTRL SET_POS=30] ;Select specifying the position of the workpiece surface (SET_POS) N20 Z[DIST_CTRL ON] ; … Nxx Z[DIST_CTRL OFF] ;Deselect ; … ;Select specifying the workpiece surface (SET_DIST) Nxx Z[DIST_CTRL SET_DIST=10] Nxx Z[DIST_CTRL ON CONST_DIST] ; … Nxx Z[DIST_CTRL OFF] ;Deselect N999 M30 %DIST_5 ;Select filter type N10Z[DIST_CTRL FILTER_TYPE=KALMAN_MA] ;Parametrise filter N20 Z[DIST_CTRL N_CYCLES=30 KALMAN_SIGMA=1000] ;Check the filter effect on the sensor signal N30 Z[DIST_CTRL DRYRUN] ;… ;Parameterise the PID controller Nxx Z[DIST_CTRL KP=0.3 I_TN=0 D_TV=0.01] ;Activate distance control Nxx Z[DIST_CTRL ON CONST_DIST SET_DIST=1] ; … ;Change filter Nxx Z[DIST_CTRL FILTER_TYPE=KALMAN_EXPO SMOOTH_FACT=0.3] ; … Nxx Z[DIST_CTRL OFF]; Deselect N999 M30 40 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 41

Various distance control options 7 Various distance control options 7.1 Option: Use of distance sensor and motor encoder This option is available starting at CNC Build V2.11.2804.02 and higher. Distance sensor Normally the distance is just measured by the distance sensor. The actual position of the Z axis is not included. Deviation = Set distance - Sensor value Δd = d - d (controller : Z = Z + Δd) com act Dist Ctrl offset,i offset,i-1 d = Filter (d’ ) act act Fig. 29: Block diagram of distance control with distance sensor TF5200 | Twin CAT 3 CNC Version: 1.46 41 Distance control
## Page 42

Various distance control options Distance sensor and motor encoder As an extension, both the distance sensor and the Z actual value sensor can be used. The inverse coupling of the two encoders (motor, distance) generally causes a reduction in oscillation tendency. Deviation = Set distance - Sensor value Δd = d - d (Z = Z + dε) com act offset,i offset,i-1 d = filter (d’ + Z - Z ) = filter (d’ - ΔΖ) act act act com act Fig. 30: Block diagram with distance sensor and motor encoder Example parameters kenngr.distc.mode_dist_use_both_encoder 1 # Motor and distance encoder active 42 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 43

Various distance control options 7.2 Option: Weighting of acceleration dependent on distance deviation This option is available starting at CNC Build V2.11.2804.02 and higher. Acceleration weighting To reduce a possible oscillation the acceleration can be reduced for small deviations. Fig. 31: Distance-dependent acceleration weighting Example parameters kenngr.distc.use_adaptive_acceleration 1 # adaptive acceleration active kenngr.distc.a_min 1000 # [mm/s*s] Min. acceleration kenngr.distc.a_max 10000 # [mm/s*s] Max. acceleration kenngr.distc.dist_error_a_min 250 # [0.1 µm] Min. distance error kenngr.distc.dist_error_a_max 500 # [0.1 µm] Max. distance error TF5200 | Twin CAT 3 CNC Version: 1.46 43 Distance control
## Page 44

Various distance control options 7.3 Option: Dead time reduction This option is available starting at CNC Build V2.11.2804.02 and higher. Dead time reduction The dead time of distance control can be reduced by an optimized schedule of the CNC. This setting is generally recommended. Example parameters kenngr.distc.optimized_scheduling 1 # Scheduling active 44 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 45

Various distance control options 7.4 Option: Dynamic weighting of the lowering movement This option is available starting at CNC Build V2.11.2807.13 and higher. Dynamic weighting of the lowering movement The “dynamic weighting of the lowering movement” option can be used to reduce the speed and acceleration of the lowering movement towards the workpiece. The lifting movement normally uses high dynamics in order to be able to avoid obstacles or protrusions quickly. The weighting can be used to reduce the dynamics of the lowering movement compared to the lifting movement in order to approach the workpiece more slowly. This option can also be combined with the “acceleration weighting dependent on distance deviation” option. Fig. 32: Reduction in velocity by dynamic weighting of the lowering movement Fig. 33: Reduction in acceleration by dynamic weighting of the lowering movement Example parameters kenngr.distc.v_weight_down 500 # Lowering movement at 50% velocity of P- AXIS-00415 kenngr.distc.a_weight_down 300 # Lowering movement at 30% acceleration of P- AXIS-00416 TF5200 | Twin CAT 3 CNC Version: 1.46 45 Distance control
## Page 46

Various distance control options 7.5 Parameter display When you start up the distance control system, it is useful to record some values, e.g. using the ISG Object Browser. Fig. 34: Axis-specific CNC objects in the position control loop Number Name of the CNC object 1 DIST_CTRL::set_pos [} 63] 2 DIST_CTRL::set_distance [} 63] 3 DIST_CTRL::target_deviation [} 66] 4 DIST_CTRL::delta_deviation_pre_limiter [} 67] 5 DIST_CTRL::m_actual_offset [} 63] 6 DIST_CTRL_IFC::sloped_delta_deviation [} 63] 7 DIST_CTRL_IFC::actual_offset [} 67] 8 DIST_CTRL_IFC::delta_offset [} 68] 9 DIST_CTRL::sensor_value [} 67] 10 DIST_CTRL::feedback_value [} 66] 11 DIST_CTRL>::filtered_feedback [} 66] 12 m_sollw_absolut (axis-specific) 13 sollw_absolut (axis-specific) 14 dig cmd pos high_res (axis-specific) 15 dig act pos (axis-specific) The previous axis-specific CNC objects remain available. 46 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 47

Various distance control options 7.6 Changing parameters Certain distance control parameters can be edited using CNC objects. The objects provided are in the GEO task and are: Name Type Unit Index-Group Index-Offset DIST_CTRL_PARAM[0]::v_max SGN32 µm/s 0x120300 0x13500 (*) [} 67] DIST_CTRL_PARAM[0]::a_max SGN32 mm/s^2 0x120300 0x13501 (*) [} 67] DIST_CTRL::kp [} 64] REAL64 - 0x120300 0x13106(*) DIST_CTRL::i_tn [} 64] REAL64 s 0x120300 0x13107(*) DIST_CTRL::d_tv [} 64] REAL64 s 0x20300 0x13108(*) (*) for the first axis, otherwise + 0x10000 * axis_index (e.g. 0x30152 for the 3rd axis) Take note that the new values are only adopted and active in the internal distance control work data for the following transitions for security reasons: 1. from INACTIVE state to ACTIVE or 2. from FREEZE state to ACTIVE Parameters can be changed directly from the ISG object browser. All writable parameters are highlighted in colour TF5200 | Twin CAT 3 CNC Version: 1.46 47 Distance control
## Page 48

Parameter 8 Parameter 8.1 Overview ID Parameter Description P-AXIS-00328 lr_param.distance_cont Enabling of distance control rol_on P-AXIS-00414 kenngr.distc.max_devi Maximum position offset [0.1 µm] ation P-AXIS-00415 kenngr.distc.v_max Maximum velocity [µm/s] P-AXIS-00416 kenngr.distc.a_max Maximum acceleration [mm/s^2] P-AXIS-00417 kenngr.distc.max_act_ Maximum permissible change speed of measured distance [0.1 value_change µm/cycle] P-AXIS-00418 kenngr.distc.ref_offset Reference point offset for control measuring system P-AXIS-00419 kenngr.distc.max_pos Upper limit for measuring system P-AXIS-00420 kenngr.distc.min_pos Lower limit for measuring system P-AXIS-00421 kenngr.distc.tolerance Tolerance band for limits P-AXIS-00428 kenngr.distc.check_sw Consideration of distance control in software limit switch _limit_switch monitoring P-AXIS-00500 kenngr.distc. Option: Coupling of distance sensor and motor encoder mode_dist_use_both_e ncoder P-AXIS-00501 kenngr.distc. use_adaptive_accelera tion Option: Adaptive weighting of acceleration P-AXIS-00502 kenngr.distc.a_min P-AXIS-00416 kenngr.distc.a_max P-AXIS-00504 kenngr.distc.dist_error _a_min P-AXIS-00505 kenngr.distc.dist_error _a_max P-AXIS-00509 kenngr.distc.optimized Option: Dead time reduction _scheduling P-AXIS-00533 kenngr.distc.v_weight_ down Velocity weighting for the lowering movement P-AXIS-00534 kenngr.distc.a_weight_ down P-AXIS-00422 lr_hw[1].encoder_resol Numerator distance resolution of the additive sensor measuring ution_num system [increments] P-AXIS-00423 lr_hw[1].encoder_resol Denominator distance resolution of the additive sensor measuring ution_denom system [0.1 µm] P-AXIS-00230 lr_hw[1].vz_istw Sign reversal of actual sensor values P-AXIS-00424 lr_hw[1].mode_act_pos Definition of the sensor value range: Linear scale or modulo handling of sensor values P-AXIS-00759 kenngr.distc.kp Weighting the distance control output values P-AXIS-00764 kenngr.distc.i_tn Integral action time of the PID controller P-AXIS-00765 kenngr.distc.d_tv Derivative action time of the PID controller P-AXIS-00782 kenngr.distc.filter_type P-AXIS-00507 kenngr.distc.low_pass_ filter_order 48 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 49

Parameter P-AXIS-00508 kenngr.distc.low_pass_ filter_fg_f0 Smoothing sensor data P-AXIS-00413 kenngr.distc.n_cycles P-AXIS-00783 kenngr.distc.kalman_si gma P-AXIS-00784 kenngr.distc.smoothing _factor TF5200 | Twin CAT 3 CNC Version: 1.46 49 Distance control
## Page 50

Parameter 8.2 Description P-AXIS-00328 Enabling of distance control (spindle with touch probe) Description The distance control for a spindle with touch probe is enabled with this parameter. The activation is done by a special command in the NC program [PROG//section 'Distance controlled spindles']. Parameter lr_param.distance_control_on Data type BOOLEAN Data range 0/1 Axis types T, R Dimension T: ---- R: ---- Default value 0 drive types. SERCOS, Profidrive, CANopen Remarks P-AXIS-00413 Filtering of sensor values Description Sensor values may be noisy. To keep excitation of the machine low, the setpoints for distance control can be smoothed by a filter. The parameter specified the number of values that are used for filtering. Parameter kenngr.dist_ctrl[i].n_cycles (where i=0) Data type SGN32 Data range 0 ≤ n_cycles < 100 Axis types T, R Dimension T: ---- R: ---- Default value 4 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.n_cycles continues to be available. P-AXIS-00414 Maximum position offset Description The correction value of the axis that was calculated via distance control may not exceed this machine data item. An error message is issued if this value is exceeded. The correction value is limited. Parameter kenngr.dist_ctrl[i].max_deviation (where i=0) Data type SGN32 Data range 0 ≤ max_deviation < MAX(SGN32) Axis types T, R Dimension T: 0.1µm R: 0.0001 ° Default value 50000 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.max_deviation continues to be available. P-AXIS-00415 Maximum velocity Description The parameter defines the maximum velocity at which a position offset is cleared. Distance compensation is dynamically limited to maximum velocity to limit any resulting excitation. 50 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 51

Parameter Parameter kenngr.dist_ctrl[i].v_max (where i=0) Data type SGN32 Data range 0 ≤ v_max < MAX(SGN32) Axis types T, R Dimension T: 0.001 mm/s R: 0,001°/s Default value 5000 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.v_max continues to be available. P-AXIS-00416 Maximum acceleration Description The parameter defines the maximum acceleration at which a position offset is executed. Correction of the distance is limited dynamically with respect to maximum acceleration to limit the resulting excitation. If no acceleration is specified, the maximum axis acceleration is used automatically (see P-AXIS-00008). Parameter kenngr.dist_ctrl[i].a_max (where i=0) Data type SGN32 Data range 0 ≤ a_max < MAX(SGN32) Axis types T, R Dimension T: 1 mm/s² R: 1°/s² Default value 0 Drive types SERCOS, Profidrive, CANopen Remarks When this parameter is 0, the maximum axis acceleration P-AXIS-00008 is used. Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.a_max continues to be available. P-AXIS-00417 Maximum permissible change speed of measured distance Description The parameter defines the maximum permissible change in velocity of the measured distance. When distance control is activated, the sensor actual values are monitored for their change velocity. If the maximum permissible change in velocity is exceeded, the error message ID 70329 is output. This detects problems with actual value detection. Parameter kenngr.dist_ctrl[i].max_act_value_change (where i=0) Data type SGN32 Data range 0 ≤ max_act_value_change < MAX(SGN32) Axis types T, R Dimension T: µm/s R: 0.0001°/s Default value 5000 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.max_act_value_change continues to be available. P-AXIS-00418 Reference point offset for measuring system TF5200 | Twin CAT 3 CNC Version: 1.46 51 Distance control
## Page 52

Parameter Description The value range of the sensor measuring system can be moved by an offset using this machine data item. This is necessary in the case of absolute sensors, for example, to define the reference point, i.e. the sensor position that is adjusted if the spindle touches the ideal workpiece surface. Parameter kenngr.dist_ctrl[i].ref_offset (where i=0) Data type SGN32 Data range MIN(SGN32) ≤ ref_offset < MAX(SGN32) Axis types T, R Dimension T: 0.1µm R: 0.0001 ° Default value 0 (No offset) Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.ref_offset continues to be available. P-AXIS-00419 Upper limit for measuring system Description The parameter defines the upper limit of the sensor. An error message is output if this limit is exceeded when distance control is active. Parameter kenngr.dist_ctrl[i].max_pos (where i=0) Data type SGN32 Data range 0 ≤ max_pos < MAX(SGN32) Axis types T, R Dimension T: 0.1µm R: 0.0001 ° Default value 50000 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.max_pos continues to be available. P-AXIS-00420 Lower limit for measuring system Description The following value defines the lower limit of the sensor. An error message is generated if it is exceeded while distance control is active. Parameter kenngr.dist_ctrl[i].min_pos (where i=0) Data type SGN32 Data range 0 ≤ min_pos < MAX(SGN32) Axis types T, R Dimension T: 0.1µm R: 0.0001 ° Default value -50000 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.min_pos continues to be available. P-AXIS-00421 Tolerance band for limits 52 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 53

Parameter Description This parameter defines a minimum distance from the minimum and maximum sensor positions. If this distance is undershot, the CNC generates the error messages ID 70330 or ID 70576. If the tolerance band is specified by zero, the limits of the minimum and maximum sensor positions from the axis parameters P-AXIS-00419 and P- AXIS-00420 have a direct effect. Parameter kenngr.dist_ctrl[i].tolerance (where i=0) Data type SGN32 Data range 0 ≤ tolerance < MAX(SGN32) Axis types T, R Dimension T: 0.1µm R: 0.0001 ° Default value 0 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameters kenngr.distc.tolerance and kenngr.distc.toleranz continue to be available. P-AXIS-00428 Consideration of distance control in software limit switch monitoring Description This parameter defines whether the calculated distance control offset is included in the software limit switch monitor (see [FCT-A2]). Parameter kenngr.dist_ctrl[i].check_sw_limit_switch (where i=0) Data type BOOLEAN Data range 0: Offset of distance control is not considered in software limit switch monitoring (default). 1: Offset of distance control is considered in software limit switch monitoring. Axis types T, R, S Dimension T: ---- R,S: ---- Default value 0 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.check_sw_limit_switch continues to be available. P-AXIS-00500 Option: Coupling of distance sensor and motor encoder Description As an extension, both the distance sensor and the Z actual value sensor can be used. The inverse coupling of the two sensors can reduce an oscillation tendency. Parameter kenngr.dist_ctrl[i].mode_dist_use_both_encoder (where i=0) Data type BOOLEAN Data range 0: No coupling 1: Coupling of motor encoder and distance sensor active Axis types T, R Dimension T: ---- R: ---- Default value 0 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.mode_dist_use_both_encoder continues to be available. TF5200 | Twin CAT 3 CNC Version: 1.46 53 Distance control
## Page 54

Parameter P-AXIS-00501 Option: Adaptive weighting of acceleration Description To reduce a possible oscillation the acceleration can be reduced for small deviations. Parameter kenngr.dist_ctrl[i].use_adaptive_acceleration (where i=0) Data type BOOLEAN Data range 0: No adaptive weighting of acceleration 1: Adaptive weighting of acceleration active Axis types T, R Dimension T: ---- R: ---- Default value 0 Drive types SERCOS, Profidrive, CANopen Remarks In addition the following limits for acceleration and distance error must be configured: P-AXIS-00502 or P-AXIS-00416 and P-AXIS-00504 or P-AXIS-00505 Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.use_adaptive_acceleration continues to be available. Fig. 35: View Option: Adaptive acceleration weighting P-AXIS-00502 Minimum acceleration Description The parameter defines the minimum acceleration of distance control. Parameter kenngr.dist_ctrl[i].a_min (where i=0) Data type UNS32 Data range 1 ... MAX (UNS32) Axis types T, R Dimension T: mm/s² R: mm/s² Default value 500 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.a_min continues to be available. P-AXIS-00504 Minimum distance error 54 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 55

Parameter Description The parameter defines the minimum distance error for distance control up to which the minimum acceleration (P-AXIS-00502) is used. Parameter kenngr.dist_ctrl[i].dist_error_a_min (where i=0) Data type UNS32 Data range 0 ≤ P-AXIS-00504 < MAX(UNS32) Axis types T, R Dimension T: 0.1µm R: 0.0001 ° Default value 1000 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.dist_error_a_min continues to be available. P-AXIS-00505 Maximum distance error Description The parameter defines the maximum distance error for distance control from which the maximum acceleration (P-AXIS-00416) is used. Parameter kenngr.dist_ctrl[i].dist_error_a_max (where i=0) Data type UNS32 Data range 0 ≤ P-AXIS-00505 < MAX(UNS32) Axis types T, R Dimension T: 0.1µm R: 0.0001 ° Default value 5000 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.dist_error_a_max continues to be available. P-AXIS-00507 Order of the filter Description The filter order describes its behaviour in the event of a drop in frequency response. The following applies: Frequency drop = - P-AXIS-00507 20 d B/decade * Parameter kenngr.dist_ctrl[i].low_pass_filter_order (where i=0) Data type UNS32 Data range 0 … 6 Axis types T, R Dimension T: ---- R: ---- Default value 4 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.low_pass_filter_order continues to be available. P-AXIS-00508 Filter cut-off frequency Description The parameter defines the value of a filter's characteristic frequency. Parameter kenngr.dist_ctrl[i].low_pass_filter_fg_f0 (where i=0) Data type REAL64 Data range 0 ≤ low_pass_filter_fg_f0 < MAX(REAL64) Axis types T, R TF5200 | Twin CAT 3 CNC Version: 1.46 55 Distance control
## Page 56

Parameter Dimension T: Hz R: Hz Default value 25 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.low_pass_filter_fg_f0 continues to be available. P-AXIS-00509 Option: Dead time reduction Description The dead time of distance control can be reduced by an optimised schedule of the CNC. Parameter kenngr.dist_ctrl[i].optimized_scheduling (where i=0) Data type BOOLEAN Data range 0: Without optimised scheduling 1: Optimised scheduling active Axis types T, R Dimension T: ---- R: ---- Default value 0 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.optimized_scheduling continues to be available. P-AXIS-00533 Weighting factor for velocity of lowering movement Description This parameter weights the velocity (see P-AXIS-00415) of the lowering movement (towards the workpiece). This can be useful since the lifting movement is normally highly dynamic in order to avoid an obstacle or elevation quickly. Due to the weighting factor, it is possible to use a reduced velocity for (re-)approaching the workpiece. Parameter kenngr.distc.dist_ctrl[i].v_weight_down (where i=0) Data type UNS32 Data range 0 ≤ v_weight_down < 2000 Axis types T, R Dimension T: 0.1% R: 0.1% Default value 0 * Drive types SERCOS, Profidrive, CANopen Remarks * The weighting is deactivated; lifting and lowering movements use the identical velocity P-AXIS-00415. Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.v_weight_down (available as of V2.11.2807.13) continues to be available. P-AXIS-00534 Weighting factor for acceleration of lowering movement 56 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 57

Parameter Description This parameter weights the velocity (see P-AXIS-00416) of the lowering movement (towards the workpiece). This can be useful since the lifting movement is normally highly dynamic in order to avoid an obstacle or elevation quickly. Due to the weighting factor, it is possible to use a reduced acceleration for (re-)approaching the workpiece. Parameter kenngr.distc.a_weight_down Data type UNS32 Data range 0 ≤ a_weight_down < 2000 Axis types T, R Dimension T: 0.1% R: 0.1% Default value 0 * Drive types SERCOS, Profidrive, CANopen Remarks * The weighting is deactivated; lifting and lowering movements use the identical acceleration P-AXIS-00416. Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.a_weight_down (as of V2.11.2807.13) continues to be available. P-AXIS-00422 Numerator distance resolution of the additive sensor measuring system Description The distance resolution of the sensor measuring system is specified as the quotient P-AXIS-00423 in the dimension [increments/0.1 µm] for translatory axes or [increments/10^-4°] for rotary axes. The number of sensor increments must be specified in P-AXIS-00422. Parameter lr_hw[i].encoder_resolution_num Data type UNS32 Data range 0 < encoder_resolution_num < MAX(UNS32) Axis types T, R, S Dimension T: increments R,S: increments Default value 1 Drive types ---- Remarks This entry is valid for 'lr_hw[i].*' with i ≥ 1! The resolution of the motor sensor 'lr_hw[0].*' is defined by P-AXIS-00233 and P- AXIS-00234. P-AXIS-00423 Denominator distance resolution of the additive sensor measuring system Description The distance resolution of the sensor measuring system is specified as the quotient P-AXIS-00422 / P-AXIS-00423 in the dimension [increments/0.1 µm] for translatory axes or [increments/10^-4°] for rotary axes. The amount of the travel range must be specified in this parameter. Parameter lr_hw[i].encoder_resolution_denom Data type UNS32 Data range 0 ≤ encoder_resolution_denom < MAX(UNS32) Axis types T, R, S Dimension T: 0.1 µm R,S: 0.0001° Default value 1 Drive types ---- Remarks This entry is valid for 'lr_hw[i].*' with i ≥ 1! The resolution of the motor sensor 'lr_hw[0].*' is defined by P-AXIS-00233 and P- AXIS-00234. TF5200 | Twin CAT 3 CNC Version: 1.46 57 Distance control
## Page 58

Parameter P-AXIS-00230 Sign reversal of actual value Description This parameter defines the sign reversal of the actual value. Parameter lr_hw[i].vz_istw Data type BOOLEAN Data range 0/1 Axis types T, R, S Dimension T: ---- R,S: ---- Default value 0 Drive types ---- Remarks These entries are not taken over when the axis parameters list is updated. Updates only become effective when the controller is rebooted. P-AXIS-00424 Handling of the additive sensor values Description This parameter defines whether the sensor positions are to be considered as linear or modulo values. By default, it can be handled according to the axis type or an individual default can be defined. When sensor values are handled according to the set axis type (see P-AXIS-00018), values are considered linear for the TRANSLATOR axis type, while modulo handling applies to the ROTATOR axis type. Parameter lr_hw[i].mode_act_pos Data type UNS16 Data range 0, 1, 2 where: 0: depending on axis type (default) 1 : linear 2 : modulo Axis types T, R Dimension T: ---- R: ---- Default value 0 Drive types ---- Remarks This entry is valid for 'lr_hw[i].*' with i ≥ 1! The setting of the sensor value range for the motor sensor 'lr_hw[0].*' is defined by P-AXIS-00122. P-AXIS-00759 Weighting the distance control output values Description The parameter weights the cyclic output value of distance control. This may affect distance control dynamics. For kp values less than 1.0, distance control dynamics are reduced; for kp value greater than 1.0, dynamics are increased. Parameter kenngr.dist_ctrl[i].kp (where i=0) Data type REAL64 Data range 0.0 < kp <= 2.0 Axis types T, R Dimension T: ---- R: ---- Default value 1.0 Drive types SERCOS, Profidrive, CANopen Remarks A kp factor less than 1 reduces a possible distance control oscillation and steadies the control in the event of minor distance errors. Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.kp (as of V2.11.2809.06 and V3.1.3079.06 continues to be available. 58 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 59

Parameter P-AXIS-00764 Integral (I) action time of the PID controller Description This parameter weights the I component of the PID controller. The integral action time defines the time after which the P and I components of the manipulated variable are equal. A large integral action time produces greater control stability. The shorter the integration action time, the greater the I component and the faster the control. Disable the I component by i_tn = 0. Parameter kenngr.dist_ctrl[i].i_tn (where i=0) Data type REAL64 Data range 0.0 <= i_tn <= 50.0 Axis types T, R Dimension T: s R: s Default value 0.0 Drive types SERCOS, Profidrive, CANopen Remarks To begin with, it is advisable to select a high initial value for the integral action time setting (e.g. 5) to avoid instability in the control loop. You can then reduce the integral action time step by step to obtain the effect you require. If there are no permanent control deviations, do not use the I component at first. Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.i_tn (as of V2.11.2809.06 and V3.1.3079.06) continues to be available. P-AXIS-00765 Derivative (D) action time of the PID controller Description This parameter weights the D component of the PID controller. The derivative action time defines the time after which the P and D components of the manipulated variable are equal. The derivative action time stabilises controller behaviour and reduces oscillations. The larger the derivative action time, the stronger the D component. Disable the D component by d_tv=0. Parameter kenngr.dist_ctrl[i].d_tv (where i=0) Data type REAL64 Data range 0.0 <= d_tv <= 2.0 Axis types T, R Dimension T: s R: s Default value 0.0 Drive types SERCOS, Profidrive, CANopen Remarks To begin with, it is advisable to select a low initial value for the derivative action time setting to avoid instability in the control loop (e.g.: 0.01). You can then reduce the derivative action time step by step to obtain the effect you require. Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.d_tv (as of V2.11.2809.06 and V3.1.3079.06) continues to be available. P-AXIS-00782 Filter type for smoothing sensor data TF5200 | Twin CAT 3 CNC Version: 1.46 59 Distance control
## Page 60

Parameter Description Sensor values may be noisy. The oscillation tendency can better be suppressed by using a suitable filter . You can select the following filter types for distance control: • DEFAULT: Moving averaging filter with P-AXIS-00413 [} 50] = 4 • MOVING_AVERAGE: Moving averaging filter • LOWPASS: Low-pass filter • KALMAN_MA: Kalman filter with prediction from averaging filter • EXPO_MEAN: Exponentially weighted averaging filter • KALMAN_EXPO: Kalman filter with prediction from exponentially weighted averaging filter Parameter kenngr.dist_ctrl[i].filter_type (where i=0) Data type STRING Data range DEFAULT MOVING_AVERAGE LOWPASS KALMAN_MA EXPO_MEAN KALMAN_EXPO Axis types T, R Dimension T: ---- R: ---- Default value DEFAULT Drive types SERCOS, Profidrive, CANopen Remarks In addition, the following filter parameters are required for each of the filter types:: • MOVING_AVERAGE: P-AXIS-00413 [} 50] • LOWPASS: P-AXIS-00507 [} 55], P-AXIS-00508 [} 55] (As of v3.1.3079.21 this setting replaces the parameter P-AXIS-00506) • KALMAN_MA: P-AXIS-00413 [} 50], P-AXIS-00783 [} 60] • EXPO_MEAN: P-AXIS-00413 [} 50], P-AXIS-00784 [} 61] • KALMAN_EXPO: P-AXIS-00413 [} 50], P-AXIS-00784 [} 61], P-AXIS-00783 [} 60] Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.filter_type continues to be available. P-AXIS-00783 Uncertainty of measured values Description The parameter specifies the degree of deviation of the measured value from the actual values. The higher this value, the better the filter effect. However, possible overshoots are amplified. Parameter kenngr.dist_ctrl[i].kalman_sigma (where i=0) Data type REAL64 Data range 1.0 ≤ P-AXIS-00783 ≤ 10000.0 Axis types T, R Dimension T: ---- R: ---- Default value 4 Drive types SERCOS, Profidrive, CANopen 60 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 61

Parameter Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.kalman_sigma continues to be available. P-AXIS-00784 Smoothing factor Description The parameter specifies the weighting of the current measured value. Example: With a smoothing factor of 0.5, the current value is applied to the average value at a rate of 50%. Parameter kenngr.dist_ctrl[i].smoothing_factor (where i=0) Data type REAL64 Data range 0 < P-AXIS-00784 ≤ 1.0 Axis types T, R Dimension T: ---- R: ---- Default value 0.7 Drive types SERCOS, Profidrive, CANopen Remarks Available as of Build V3.1.3080.12 or V3.1.3107.44 For compatibility reasons, the parameter kenngr.distc.smoothing_factor continues to be available. TF5200 | Twin CAT 3 CNC Version: 1.46 61 Distance control
## Page 62

Parameter 8.3 Example of distance axis Example parameters # ------ Distance control -------- lr_param.distance_control_on 1 Enable the distance control function kenngr.dist_ctrl[0].max_abweichung 20000000 # [0.1µm] Max. permissible deviation .dist_ctrl[0].v_max 50000 # [µm/s] Max. velocity of distance controller kenngr.dist_ctrl[0].a_max 10000 # [mm/s*s] Max. acceleration kenngr.dist_ctrl[0].max_istw_sprung 100000000 # Max. actual value jump/cycle kenngr.dist_ctrl[0].ref_offset 0 # Reference point offset Kenngr.dist_ctrl[0].max_pos 1500000 # [0.1µm] Max. position kenngr.dist_ctrl[0].min_pos -1500000 # [0.1µm] Min. position kenngr.dist_ctrl[0].toleranz 50000 # [0.1µm] Tolerance value of probing depth kenngr.dist_ctrl[0].check_sw_limit_switc 1 # Distance control offset h monitor kenngr.dist_ctrl[0].optimized_scheduling 1 # Opt. scheduling active kenngr.dist_ctrl[0].mode_dist_use_both_e 1 # Motor and distance encoder active ncoder #kenngr.dist_ctrl[0].use_adaptive_accele 1 Adaptive weighting of acceleration active ration kenngr.dist_ctrl[0].a_min 1000 # [mm/s*s] Min. acceleration kenngr.dist_ctrl[0].a_max 10000 # [mm/s*s] Max. acceleration kenngr.dist_ctrl[0].dist_error_a_min 250 # [0.1 µm] Min. distance kenngr.dist_ctrl[0].dist_error_a_max 500 # [0.1 µm] Max. distance kenngr.dist_ctrl[0].filter_type KALMAN_MA # Kalman filter active kenngr.dist_ctrl[0].n_cycles 20 # Number of measured values for filtering kenngr.dist_ctrl[0].sigma 1000 # Uncertainty of measured values 62 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 63

Parameter 8.4 CNC objects of axis-specific distance control Available as of Build V3.1.3080.12 or V3.1.3107.44 Name DIST_CTRL_IFC::a_max_int Description Maximum acceleration of the linear slope. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3000 ID Data type REAL64 Length 8 Attributes read Unit [0.1 µm/s²] Remarks Name DIST_CTRL_IFC::sloped_delta_deviation Description The deviation to be executed in this cycle after being influenced by the slope. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3001 ID Data type SGN64 Length 8 Attributes read Unit [0.01 nm] Remarks Name DIST_CTRL::m_actual_offset Description Current offset to the interpolated command position of the drive as specified by distance control. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3100 ID Data type SGN64 Length 8 Attributes read Unit [0.01 nm] Remarks Name DIST_CTRL::v_max_int Description Maximum permissible velocity of the axis. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3102 ID Data type REAL64 Length 8 Attributes read Unit [0.1 µm/s] Remarks Name DIST_CTRL::set_distance Description Set command distance of the tool to the surface. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3103 ID Data type SGN64 Length 8 Attributes read Unit [0.01 nm] Remarks Only effective in “SET_DIST” mode Name DIST_CTRL::set_pos Description Set command value of the workpiece surface. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3104 ID Data type SGN64 Length 8 Attributes read Unit [0.01 nm] TF5200 | Twin CAT 3 CNC Version: 1.46 63 Distance control
## Page 64

Parameter Remarks Only effective in “SET_POS” mode Name DIST_CTRL::state Description Current internal state of distance control 0: INACTIVE 2: ACTIVE 3: FREEZE 4: OFF 5: OFF_NO_MOVE 6-12: ERROR 15:DRYRUN Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3105 ID Data type UNS32 Length 4 Attributes read Unit [-] Remarks Name DIST_CTRL::kp Description Weighting the distance control output values. Parameterisation can be executed analogous to P-AXIS-00759 [} 58]. The value range is limited to 0.0 < KP <= 2.0. For KP values less than 1.0, the distance control dynamics are reduced; for KP values greater than 1.0, the dynamics are increased. A KP factor less than 1 reduces a possible distance control oscillation and steadies control in the event of minor distance errors. [as of V2.11.2809.06 or V3.1.3079.06] Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3106 ID Data type REAL64 Length 8 Attributes read/ write Unit [-] Remarks Name DIST_CTRL::i_tn Description Integral action time of the PID controller in [s]. The integral action time defines the time after which the P and I components of the manipulated variable are equal. Parameterisation can be executed analogous to P-AXIS-00764 [} 59]. The value range is limited to 0.0 <= I_TN <= 50.0. A large integral action time produces greater control stability. The shorter the integration action time, the greater the I component and the faster the control. A short integral action time excites oscillations more strongly. [as of V2.11.2809.06 or V3.1.3079.06] Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3107 ID Data type REAL64 Length 8 Attributes read/ write Unit [s] Remarks Name DIST_CTRL::d_tv 64 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 65

Parameter Description Derivative action time of the PID controller in [s]. The derivative action time defines the time after which the P and D components of the manipulated variable are equal. Parameterisation can be executed analogous to P-AXIS-00765 [} 59]. The value range is limited to 0.0 <= D_TV <= 2.0. The larger the derivative action time, the stronger the D component. [as of V2.11.2809.06 or V3.1.3079.06] Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3108 ID Data type REAL64 Length 8 Attributes read/ write Unit [s] Remarks Name DIST_CTRL::smoothing_fact Description Currently set smoothing factor of the exponential averaging filter analogous to P- AXIS-00784 [} 61]. Specifies the weighting of the current measured value. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3109 ID Data type REAL64 Length 8 Attributes read Unit [-] Remarks Name DIST_CTRL::kalman_sigma Description Currently set uncertainty of the included measured values analogous to P- AXIS-00783 [} 60]. [as of V3.1.3079.23] Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >310A ID Data type REAL64 Length 8 Attributes read Unit [-] Remarks Name DIST_CTRL::n_cycles Description Currently set number of measured values used for filtering according to P- AXIS-00413 [} 50]. [as of V3.1.3079.23] Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >310B ID Data type SGN32 Length 4 Attributes read Unit [-] Remarks Name DIST_CTRL::skip_dist_ctrl Description Not in use - in preparation Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >310C ID Data type BOOLEAN Length 1 Attributes read Unit [-] Remarks Name DIST_CTRL::filter_type TF5200 | Twin CAT 3 CNC Version: 1.46 65 Distance control
## Page 66

Parameter Description Active filter type to smooth sensor values. Filter types for smoothing sensor values, see P-AXIS-00782 [} 59]. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >310D ID Data type STRING Length 30 Attributes read Unit [-] Remarks Name DIST_CTRL::max_dist_change Description Maximum change in sensor values per cycle. Required for the “Kalman_DYN” filter. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >310E ID Data type REAL64 Length 8 Attributes read Unit [0.1 µm] Remarks Filter not yet available. Name DIST_CTRL::filtered_feedback Description Filtered feedback value. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >310F ID Data type SGN64 Length 8 Attributes read Unit [0.01 nm] Remarks Name DIST_CTRL::feedback_value Description Calculated distance control feedback value. SET_DIST mode: Measured actual distance between the interpolated command position of the drive and the surface. SET_DIST (use_both_encoder) and SET_POS modes: Measured position of the real surface in the selected coordinate system. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3110 ID Data type SGN64 Length 8 Attributes read Unit [0.01 nm] Remarks Name DIST_CTRL::target_deviation Description SET_DIST mode: Current difference between the interpolated command position of the dive and the set command distance to the surface. SET_POS mode: Current difference between the measured real surface and the specified command surface. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3111 ID Data type SGN64 Length 8 Attributes read Unit [0.01 nm] I Remarks Filtered sensor values are included in this value. 66 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 67

Parameter Name DIST_CTRL::delta_deviation_pre_limiter Description The distance to be executed in this cycle before being influenced by the limiter. Influenced by the PID controller. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3112 ID Data type SGN64 Length 8 Attributes read Unit [0.01 nm] Remarks SET_DIST: For kp=1, this is the distance to go between the actual position of the tool and the set command distance to the surface. SET_POS: For kp=1, this is the distance to go to be executed in order to compensate for the difference between the actual position of the tool and the real surface. Name DIST_CTRL::sensor_value Description Return value of the sensor. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3113 ID Data type SGN64 Length 8 Attributes read Unit [0.01 nm] Remarks Name DIST_CTRL_PARAM[0]::v_max Description The maximum velocity set by P-AXIS-00415 [} 50] when a position offset is executed. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3500 ID Data type SGN32 Length 4 Attributes read/ write Unit [µm/s] Remarks The new values only become effective with the following transitions for safety reasons 1. From INACTIVE to ACTIVE state 2. From FREEZE to ACTIVE state Name DIST_CTRL_PARAM[0]::a_max Description The maximum acceleration set by P-AXIS-00416 [} 51] when a position offset is executed. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3501 ID Data type SGN32 Length 4 Attributes read/ write Unit [mm/s²] Remarks The new values only become effective with the following transitions for safety reasons 1. From INACTIVE to ACTIVE state 2. From FREEZE to ACTIVE state Name DIST_CTRL_IFC::actual_offset Description Offset to the interpolated command position of the drive currently output by distance control to the drive. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3900 ID TF5200 | Twin CAT 3 CNC Version: 1.46 67 Distance control
## Page 68

Parameter Data type SGN32 Length 4 Attributes read Unit [Incr.] Remarks The drive resolution and the gear ratio are included in this value. Name DIST_CTRL_IFC::delta_offset Description Delta currently output to the drive indicating that the cycle must be executed. Task GEO (Port 551) Index group 0x120300 Index offset 0x<A >3901 ID Data type SGN32 Length 4 Attributes read Unit [Incr.] Remarks The drive resolution and the gear ratio are included in this value. 68 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 69

PLC interface 9 PLC interface 9.1 Distance control states and transitions Alternative commanding via SPS interface Basic condition: Distance control is enabled for the axis (see P-AXIS-00328). In addition to the NC program, distance control can also be commanded via the PLC interface (see [HLI// Distance control]) by specifying the required status transitions (e.g. activating or deactivating) and specifying command positions via the Distance Control control unit. The current state of the distance control unit can be viewed in the state of the Distance Control control unit. The control unit state also includes the current actual position of the workpiece surface, the current distance, the active command source (0=NC program,1=PLC) and the current output position offset. Explanation of figure: Distance control has 6 internal states which are depicted in the figure below together with the permitted transitions. Transitions, such as a transition to error state, are displayed automatically and cannot be commanded. A change in the “Active” and “Active constant Distance” states is only permitted in the “Freeze” or “Inactive” states. Fig. 36: Distance control state graph and transitions Defined states of distance control State Value Meaning HLI_DIST_CTRL_STATE_IN 0 Distance control is deactivated. The specified offset ACTIVE (“actual_offset”) is 0. HLI_DIST_CTRL_STATE_A 1 Distance control is active and adjusts the axis to the workpiece CTIVE surface. HLI_DIST_CTRL_STATE_F 2 Distance control is active. The offset (“actual_offset”) is frozen, REEZE i.e. the axis is not adjusted to the workpiece surface. TF5200 | Twin CAT 3 CNC Version: 1.46 69 Distance control
## Page 70

PLC interface HLI_DIST_CTRL_STATE_T 3 Distance control was deactivated. The actual active offset URNING_OFF (“actual_offset”) is run out. As soon as the offset is 0, an automatic switch to INACTIVE state takes place. HLI_DIST_CTRL_STATE_A 4 Distance control is active and adjusts the axis to the workpiece CTIVE_CONST_DIST surface. Continuous specification of the set distance of the tool to the workpiece surface. HLI_DIST_CTRL_STATE_E 5 Distance control is in error state, e.g. due to an incorrect state RROR transition or due to an error in the position controller. Only a transition to TURNING OFF is possible to exit this state. HLI_DIST_CTRL_STATE_D 6 Distance control is active, however axis is not adjusted to RYRUN_CONST_DIST workpiece surface. This allows the evaluation of data, for example filter effect without feedback from the control system. Continuous commanding of the set distance of the tool to the workpiece surface. HLI_DIST_CTRL_STATE_D 7 Distance control is active, however axis is not adjusted to RYRUN_SETPOS workpiece surface. This allows the evaluation of data, for example filter effect without feedback from the control system. 70 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 71

PLC interface Permissible transitions to command the distance control Transition Value Meaning HLI_DIST_CTRL_OFF 0 Distance control is deactivated. The program switches to the TURNING OFF state in which the position offset is run out. The state then switches automatically to the INACTIVE state. HLI_DIST_CTRL_ON 1 Distance control is activated. When activated a command position for the workpiece surface must be transferred in the “position” datum. If no absolute encoder is used, distance control must first be referenced. HLI_DIST_CTRL_FREEZE 2 The current position offset is frozen. Axis adjustment to the actual workpiece surface is ended. HLI_DIST_CTRL_REF 3 Referencing distance control if no absolute encoder is used. Referencing is only permitted in the INACTIVE state. With this transition a reference position must additionally transferred in the “position” datum. HLI_DIST_CTRL_ON_CONS 4 Activating distance control with continuous distance specification. T_DIST On activation, a set position must be specified. If the distance sensor supplies no absolute values, distance control must be referenced in advance. HLI_DIST_CTRL_DRYRUN 5 Activate distance control for pure evaluation of data. No axis tracking in case of changes to the workpiece surface. When activated a command position for the workpiece surface must be transferred in the “position” datum. If no absolute encoder is used, distance control must first be referenced. HLI_DIST_CTRL_CONST_D 6 Activate distance control for pure evaluation of data. No axis IST tracking in case of changes to the workpiece surface. On activation, a set position must be specified. If the distance sensor supplies no absolute values, distance control must be referenced in advance. TF5200 | Twin CAT 3 CNC Version: 1.46 71 Distance control
## Page 72

PLC interface 9.2 Control commands for distance control Command distance control Description This control unit can influence the distance control of the axis. This is dependent on whether the distance control function is selected in the axis parameters (see P- AXIS-00328). Data type MC_CONTROL_DISTANCE_CONTROL, see description of Control unit with usage check Access PLC reads state_r and writes command_w + enable_w ST path gp Ax[axis_idx]^.lr_mc_control.distance_control Flow control of commanded values ST element .command_semaphor_rw Signal flow PLC → CNC Data type BOOL Special features Consumption data item Access CNC accepts the commanded values when this element has the value TRUE. After successful acceptance the CNC sets this value to FALSE. PLC sets this value to TRUE when the commanded value is enabled for acceptance by the CNC. The commanded values can only be updated by the PLC if this element has the value FALSE. Commanded values ST element .command_w Signal flow PLC → CNC Data type HLI_DISTANCE_CONTROL_COMMAND Access PLC is writing Distance control state ST element .state_r Signal flow CNC → PLC Data type HLI_DISTANCE_CONTROL_STATE Access PLC is reading Redirection ST element .enable_w Distance control state Description This entry reads the distance control state. Signal flow PLC → CNC Data type HLI_DISTANCE_CONTROL_STATE ST Path gp Ax[axis_idx]^.lr_mc_control.distance_control.state_r Access PLC is reading Elements of the data type Element .actual_state Data type UDINT Access PLC is reading Value range/ See table: Distance control states and transitions [} 69] Description Element .actual_position Data type DINT Unit 0.1 µm or 0.0001° Access PLC reads Description This data item indicates the current actual position of the workpiece surface detected by the sensing controller. 72 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 73

PLC interface Characteristics This data item is entered only if distance control is activated in the axis parameters (see P-AXIS-00328). Element .actual_offset Data type DINT Unit 0.1 µm or 0.0001° Access PLC reads Description This data item indicates the current position offset of distance control by which the axis was moved due to deviations between the actual workpiece surface and the specified position (SET_POS). The following applies in stationary state (constant workpiece surface and position offset completely run out): Position offset = SET_POS – actual_position Characteristics This data item is entered only if distance control is activated in the axis parameters (see P-AXIS-00328). Command for distance control Description This entry commands distance control. Signal flow PLC → CNC Data type HLI_DISTANCE_CONTROL_COMMAND ST Path gp Ax[axis_idx]^.lr_mc_control.distance_control.command_w Access PLC writes Elements of the data type ST element .transition Data type UDINT Value range/ See Table - Permissible transitions to command distance control [} 71] Description ST element .position Data type DINT Value range [DINT_MIN, DINT_MAX] Description The meaning depends on the commanded transition: HLI_DIST_CTRL_ON: Command position of the workpiece surface (SET_POS) HLI_DIST_CTRL_REF: Reference position of the workpiece surface (REF_POS) Cyclic command for distance control Description This entry specifies cyclic set values are specified (position of workpiece surface or set distance). Signal flow PLC → CNC Data type HLIDistance Control Cyclic Command ST Path p AC[axis_idx]^.addr^. Mc Control Lr_Data. MCControl_Distance Control. Cyclic Com mand Access PLC writes Elements of the data type ST element . D_Position Data type DINT Value range [DINT_MIN, DINT_MAX] Description The meaning depends on the commanded transition: HLI_DIST_CTRL_ON: Command position of the workpiece surface (SET_POS) HLI_DIST_CTRL_REF: Reference position of the workpiece surface (REF_POS) ST element . D_Distance Data type DINT Value range [DINT_MIN, DINT_MAX] TF5200 | Twin CAT 3 CNC Version: 1.46 73 Distance control
## Page 74

PLC interface Description Specification of the distance to workpiece surface after selection by transition HLI_DIST_CTRL_ON_CONST_DIST. 74 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 75

Error messages 10 Error messages The following error messages can occur when distance control is active: ID 70329 Actual value change of sensor signal greater than limit ID 70330 Sensor completely run out ID 70331 Excessive sensing deviation ID 70332 Distance control still active at program end ID 70333 Distance control active for axis that is to be specified. ID 70334 On repeat selection, deselection of distance control not yet complete ID 70335 Distance control selected without programmed position ID 70336 Function is not available TF5200 | Twin CAT 3 CNC Version: 1.46 75 Distance control
## Page 76

Support and Service 11 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 76 Version: 1.46 TF5200 | Twin CAT 3 CNC Distance control
## Page 77

Index Index A axis Distance control command 73 Distance control cyclic command 73 Distance control state 72 distance control:command 72 D Distance control Command 72, 73 cyclic command 73 State 72 P P-AXIS-00230 58 P-AXIS-00328 50 P-AXIS-00413 50 P-AXIS-00414 50 P-AXIS-00415 50 P-AXIS-00416 51 P-AXIS-00417 51 P-AXIS-00418 51 P-AXIS-00419 52 P-AXIS-00420 52 P-AXIS-00421 52 P-AXIS-00422 57 P-AXIS-00423 57 P-AXIS-00424 58 P-AXIS-00428 53 P-AXIS-00500 53 P-AXIS-00501 54 P-AXIS-00502 54 P-AXIS-00504 54 P-AXIS-00505 55 P-AXIS-00507 55 P-AXIS-00508 55 P-AXIS-00509 56 P-AXIS-00533 56 P-AXIS-00534 56 P-AXIS-00759 58 P-AXIS-00764 59 P-AXIS-00765 59 P-AXIS-00782 59 P-AXIS-00783 60 P-AXIS-00784 61 TF5200 | Twin CAT 3 CNC Version: 1.46 77 Distance control
## Page 79

More Information: www.beckhoff.com/TF5200 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
