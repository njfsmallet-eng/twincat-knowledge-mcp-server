---
title: "TwinCAT_3_PLC_Lib_Tc3_DriveMotionControl_EN"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "CONTROL", "DRIVE", "LIB", "MOTION", "NC", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.5.3"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc3_DriveMotionControl_EN.pdf"
release_date: "2025-06-26"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc3_Drive Motion Control 2025-06-26 | Version: 1.5.3
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 State diagram............................................................................................................................................ 9 4 General rules for MC function blocks................................................................................................... 11 5 Organization blocks................................................................................................................................ 13 5.1 Axis functions.................................................................................................................................. 13 5.1.1 MC_Power....................................................................................................................... 13 5.1.2 MC_Reset........................................................................................................................ 14 5.1.3 MC_Set Position............................................................................................................... 15 5.2 Touch probe.................................................................................................................................... 16 5.2.1 MC_Abort Trigger.............................................................................................................. 16 5.2.2 MC_Touch Probe.............................................................................................................. 17 6 Motion function blocks........................................................................................................................... 21 6.1 MC_Home (Homing)....................................................................................................................... 21 6.2 MC_Jog (Manual Motion)................................................................................................................ 23 6.3 Point to point motion....................................................................................................................... 25 6.3.1 MC_Halt........................................................................................................................... 25 6.3.2 MC_Move Absolute........................................................................................................... 26 6.3.3 MC_Move Modulo............................................................................................................. 28 6.3.4 Modulo positioning........................................................................................................... 30 6.3.5 MC_Move Relative............................................................................................................ 34 6.3.6 MC_Move Velocity............................................................................................................ 35 6.3.7 MC_Stop.......................................................................................................................... 37 7 Data types................................................................................................................................................ 39 7.1 Axis interface................................................................................................................................... 39 7.1.1 AXIS_REF........................................................................................................................ 39 7.1.2 DRIVETOPLC_INFODATA.............................................................................................. 40 7.1.3 DRIVETOPLC_WCSTATE............................................................................................... 40 7.2 Homing............................................................................................................................................ 40 7.2.1 E_Encoder Reference Mode.............................................................................................. 40 7.2.2 MC_Homing Mode............................................................................................................ 40 7.2.3 ST_Homing Options.......................................................................................................... 41 7.3 Motion............................................................................................................................................. 41 7.3.1 MC_Direction................................................................................................................... 41 7.3.2 ST_Move Options............................................................................................................. 41 7.4 Status and parameter...................................................................................................................... 42 7.4.1 MC_Axis States................................................................................................................. 42 7.4.2 ST_Axis Parameters......................................................................................................... 42 7.4.3 ST_Axis Status.................................................................................................................. 42 7.5 Touch probe.................................................................................................................................... 43 TE1000 Version: 1.5.3 3
## Page 4

Table of contents 7.5.1 E_Signal Edge.................................................................................................................. 43 7.5.2 E_Signal Source............................................................................................................... 44 7.5.3 E_Touch Probe................................................................................................................. 44 7.5.4 MC_Touch Probe Recorded Data....................................................................................... 44 7.5.5 TRIGGER_REF................................................................................................................ 45 8 Global constants..................................................................................................................................... 46 8.1 Library version................................................................................................................................. 46 9 Support and Service............................................................................................................................... 47 4 Version: 1.5.3 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1000 Version: 1.5.3 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.5.3 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.5.3 7
## Page 8

Overview 2 Overview The Twin CAT Motion Control PLC library Tc3_Drive Motion Control contains function blocks for programming simple machine applications based on Beckhoff servo terminal technology. It is based on the PLCopen specification for Motion Control function blocks V2.0 (www. PLCopen.org). This library offers an alternative option for controlling simple movements without using Twin CAT NC PTP. The functionality is reduced compared to Twin CAT NC PTP. If the library is to be used in parallel with Tc2_MC2, set the option "Qualified access only" = TRUE for one of the libraries. This library can then be addressed via the corresponding namespace, e.g. Tc2_MC2. MC_Power. Motion commands can be commanded directly to a servo terminal in the usual PLCopen-compliant manner. 8 Version: 1.5.3 TE1000
## Page 9

State diagram 3 State diagram The following state diagram defines the behavior of an axis. Note 1 From undefined state in which an error occurs. Note 2 From undefined state if MC_Power. Enable = FALSE. The axis has no fault. Note 3 MC_Reset and MC_Power. Status = FALSE Note 4 MC_Reset and MC_Power. Status = TRUE and MC_Power. Enable = TRUE Note 5 MC_Power. Status = TRUE and MC_Power. Enable = TRUE Note 6 MC_Stop. Done = TRUE and MC_Stop. Execute = FALSE Motion commands are always processed sequentially. All commands operate in the described state diagram. The axis is always in one of the defined states. Each motion command that causes a transition changes the state of the axis and thus the motion profile. The state diagram is an abstraction layer that reflects the real axis state, comparable to the process image for I/O points. The axis state changes immediately when the command is issued. The state diagram refers to single axes. The "Disabled" state is the default state of an axis. In this state can the axis cannot be moved through a function block. When the MC_Power function block is called with Enable = TRUE, the axis changes to the "Standstill" state or, in the event of an error, to "Error Stop" state. If the function block MC_Power is called with Enable = FALSE, the status changes to "Disabled". TE1000 Version: 1.5.3 9
## Page 10

State diagram The purpose of "Error Stop" state is to stop the axis and then block further commands, until a reset was triggered. The "Error" state transition only refers to actual axis errors and not to execution errors of a function block. Axis errors can also be displayed at the error output of a function block. Function blocks that are not listed in the state diagram influence the status of the axis. The "Stopping" state indicates that the axis is in a stop ramp. After the complete stop the state does not change to "Standstill" until MC_Stop is called with Execute = FALSE. Otherwise the axis remains locked for further motion commands. 10 Version: 1.5.3 TE1000
## Page 11

General rules for MC function blocks 4 General rules for MC function blocks The rules described below apply to all MC function blocks. They ensure a defined processing by the PLC program. Exclusivity of the outputs The outputs "Busy", "Done", "Error" and "Command Aborted" are mutually exclusive, i.e. only one of these outputs can be TRUE on a function block at the same time. When the "Execute" input becomes TRUE, one of the outputs must become TRUE. At the same time, however, only one of the outputs "Active", "Done", "Error" and "Command Aborted" can be TRUE. An exception is the motion command MC_Stop [} 37]. This sets the "Done" output to TRUE as soon as the axis is stopped. Nevertheless, the "Busy" and "Active" outputs remain TRUE because the axis is locked. The axis is unlocked and the "Busy" and "Active" outputs set to FALSE only after the "Execute" input is set to FALSE. Initial state If the function block is not active, the outputs "Done", "Error", "Error ID" and "Command Aborted" are reset with a falling edge at input "Execute". However, the falling edge at input "Execute" does not affect the command execution. If the "Execute" input is already reset during command execution, this ensures that one of the outputs is set at the end of the command for a PLC cycle. Only then are the outputs reset. If the "Execute" input is triggered more than once during the execution of a command, the function block does not provide any feedback, nor does it execute any further commands. Input parameters The input parameters become active with a rising edge. To change the parameters, the command must be retriggered after it has finished. If an input parameter is not passed to the function block, the last value passed to this function block remains valid. Meaningful values should be parameterized at the first call. Position and Distance The "Position" input designates a defined value within a coordinate system. The "Distance" input, on the other hand, is a relative dimension, i.e. the distance between two positions. "Position" and "Distance" are specified in technical units, e.g. mm or °, according to the axis scaling. Dynamic parameters The dynamic parameters for Move functions are specified in technical units with second as time base. For example, if an axis is scaled in millimeters, the parameters have the following units: Velocity mm/s Acceleration mm/s2 Deceleration mm/s2 Error handling All function blocks have two error outputs for indicating errors during command execution. The "Error" output indicates the error and the "Error ID" output contains a supplementary error number. The outputs "Done" and "In Velocity" indicate successful command execution and are not set if the "Error" output is TRUE. Errors of different type are signaled at the function block output. The error type is not specified explicitly. It depends on the unique and global error number. TE1000 Version: 1.5.3 11
## Page 12

General rules for MC function blocks Error types • Function block errors only concern the function block, not the axis (e.g. incorrect parameterization). Function block errors do not have to be reset explicitly. They are reset automatically when the "Execute" input is reset. • Communication errors (e.g. the function block cannot address the axis) usually indicate incorrect configuration or parameterization. A Reset is not possible. The function block can be retriggered after the configuration has been corrected. • In many cases, drive errors (controller) can be reset via the motion command MC_Reset [} 14]. Behavior of the Done output The output "Done" (or alternatively "In Velocity") is set if a command was executed successfully. Behavior of the Command Aborted output The output "Command Aborted" is set if a command is interrupted. Behavior of the Busy output The "Busy" output indicates that the function block is active. The function block can only be triggered by a rising edge at the "Execute" input if the "Busy" output is FALSE. "Busy" is immediately set with the positive edge at the "Execute" input and is not reset until the command has been successfully or unsuccessfully terminated. As long as the "Busy" output is TRUE, the function block must be called cyclically in order to be able to execute the command. Behavior of the Active output The "Active" output of a function block indicates that the function block has control over the axis. Option input Many function blocks have an "Options" input with a data structure containing additional, infrequently required options. In many cases the options are not required to perform the basic function of the function block, so that the input can remain unused. The user only has to occupy the Options data structure in cases where the documentation explicitly refers to certain options. 12 Version: 1.5.3 TE1000
## Page 13

Organization blocks 5 Organization blocks 5.1 Axis functions 5.1.1 MC_Power MC_Power Enable BOOL BOOL Status ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Active BOOL Error UDINT Error ID The function block MC_Power switches the software enabling of an axis. At Status output operational readiness of the axis is indicated. In addition to software enable it may be necessary to activate a hardware enable signal in order to enable a drive. This signal is not influenced by MC_Power and must be activated separately by the PLC. Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL General software enable for the axis. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Status : BOOL; Busy : BOOL; Active : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Status BOOL TRUE when the axis is ready for operation. Busy BOOL TRUE, as long as the function block is called with Enable = TRUE. Active BOOL Indicates that the command is executed. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. TE1000 Version: 1.5.3 13
## Page 14

Organization blocks Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 5.1.2 MC_Reset MC_Reset Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Error UDINT Error ID The function block MC_Reset resets the NC axis. In many cases this also leads to a reset of a connected drive device. Depending on the bus system or drive types, in some cases a separate reset may be required for the drive device. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE, if the reset was executed successfully. Busy BOOL TRUE, as long as the function block is called with Enable = TRUE. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 14 Version: 1.5.3 TE1000
## Page 15

Organization blocks 5.1.3 MC_Set Position MC_Set Position Execute BOOL BOOL Done Position LREAL BOOL Busy Mode BOOL BOOL Error Options ST_Set Position Options UDINT Error ID ↔ Axis Reference To AXIS_REF The function block MC_Set Position sets the current axis position to a parameterizable value. In absolute mode, the actual position is set to the parameterized absolute Position value. In relative mode, the actual position is offset by the parameterized Position value. In both cases, the set position of the axis is set such that any lag error that may exist is retained. The switch Options. Clear Position Lag can be used to clear the lag error. Relative mode can be used to change the axis position during the motion. Inputs VAR_INPUT Execute : BOOL; Position : LREAL; Mode : BOOL; (* RELATIVE=True, ABSOLUTE=False (Default) *) Options : ST_Set Position Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Position LREAL Position value to which the axis position is to be set. In absolute mode the actual position is set to this value, in relative mode it is shifted by this value. Mode BOOL The axis position is set to an absolute value set if Mode = FALSE. Otherwise the axis position is changed relative to the specified Position value. Relative mode can be used for changing the position of an axis during motion. Options ST_Set Position Options Not used at present See also: General rules for MC function blocks [} 11] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR TE1000 Version: 1.5.3 15
## Page 16

Organization blocks Name Type Description Done BOOL TRUE if the position was set successfully. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done" or "Error" is set. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 11] Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 5.2 Touch probe 5.2.1 MC_Abort Trigger MC_Abort Trigger Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF BOOL Busy ↔ Trigger Input Reference To TRIGGER_REF BOOL Error UDINT Error ID The function block MC_Abort Trigger cancels a touch probe cycle started by MC_Touch Probe. MC_Touch Probe starts a touch probe cycle by activating a position latch in the drive hardware. The function block MC_Abort Trigger can be used to terminate the procedure before the trigger signal has activated the position latch. If the touch probe cycle has completed successfully, it is not necessary to call up this function block. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with the rising edge and the external position latch is disabled. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; Trigger Input : TRIGGER_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure Trigger Input TRIGGER_REF [} 45] Data structure for describing the trigger source. This data structure must be parameterized before the function block is called for the first time. 16 Version: 1.5.3 TE1000
## Page 17

Organization blocks Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE as soon as the touch probe cycle has been successfully terminated. Busy BOOL TRUE as soon as the function block is active. FALSE if it is in the default state. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 5.2.2 MC_Touch Probe MC_Touch Probe Execute BOOL BOOL Done Window Only BOOL BOOL Busy First Position LREAL BOOL Command Aborted Last Position LREAL BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID ↔ Trigger Input Reference To TRIGGER_REF LREAL Recorded Position MC_Touch Probe Recorded Data Recorded Data The function block MC_Touch Probe records an axis position at the time of a digital signal (touch probe function). The position is captured via an external hardware latch and is therefore highly accurate and independent of the cycle time. The function block controls this mechanism and determines the externally recorded position. The parameters involved may have to be set in the drive parameters. For the servo terminal the parameters can be found in the objects DMC Setting (0x8030) or DMC Features (0x8031). After a measuring probe cycle has been initiated by a rising edge on the "Execute" input, this is only terminated if the outputs "Done", "Error" or" Command Aborted" become TRUE. If the operation is to be aborted in the meantime, the function block MC_Abort Trigger [} 16] must be called with the same Trigger Input [} 45] data structure. Otherwise no new cycle can be initiated. TE1000 Version: 1.5.3 17
## Page 18

Organization blocks Signal curve Inputs VAR_INPUT Execute : BOOL; Window Only : BOOL; First Position : LREAL; Last Position : LREAL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge, and the external position latch is activated. Window Only BOOL If Window Only = TRUE, only one position within the window between "First Position" and "Last Position" is recorded. Positions outside the window are rejected and the external position latch is automatically newly activated. Only if the recorded position lies inside the window, "Done" becomes TRUE. The recording window can be interpreted in terms of absolute or modulo values. For this purpose, the "Modulo Positions" flag must be set accordingly in the Trigger Input [} 45] data structure. In the case of absolute value positions there is exactly one window. With modulo positions, the window is repeated within the modulo cycle defined in the axis parameters (e.g. 0 to 360°). 18 Version: 1.5.3 TE1000
## Page 19

Organization blocks Name Type Description First Position LREAL Initial position of the recording window, if "Window Only" is TRUE. This position can be interpreted as an absolute or modulo value. For this purpose, the "Modulo Positions" flag must be set accordingly in the Trigger Input [} 45] data structure. Last Position LREAL End position of the recording window, if "Window Only" is TRUE. This position can be interpreted as an absolute or modulo value. For this purpose, the "Modulo Positions" flag must be set accordingly in the Trigger Input [} 45] data structure. TE1000 Version: 1.5.3 19
## Page 20

Organization blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; Trigger Input : TRIGGER_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure Trigger Input TRIGGER_REF [} 45] Data structure for describing the trigger source. This data structure must be parameterized before the function block is called for the first time. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; Recorded Position : LREAL; Recorded Data : MC_Touch Probe Recorded Data; END_VAR Name Type Description Done BOOL TRUE if an axis position was successfully detected. The position is sent to the output "Recorded Position". Busy BOOL TRUE as soon as the function block is active. FALSE if it is in the default state. Command Aborte BOOL TRUE if the process is interrupted by an external event, d e.g. by the call up of MC_Abort Trigger [} 16]. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Recorded Data MC_Touch Probe Recorded Dat Data structure with complementary information relating to a the logged axis position at the time of the trigger signal Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 20 Version: 1.5.3 TE1000
## Page 21

Motion function blocks 6 Motion function blocks 6.1 MC_Home (Homing) MC_Home Execute BOOL BOOL Done Position LREAL BOOL Busy Homing Mode MC_Homing Mode BOOL Active Options ST_Homing Options BOOL Command Aborted ↔ Axis Reference To AXIS_REF BOOL Error UDINT Error ID An axis reference run is carried out with the function block MC_Home. Reference mode is set in the options with the parameter "Reference Mode". The parameters involved may have to be set in the drive parameters. For the servo terminal, the parameters can be found in the objects DMC Setting (0x8030) or DMC Features (0x8031). Inputs VAR_INPUT Execute : BOOL; Position : LREAL := DEFAULT_HOME_POSITION; Homing Mode : MC_Homing Mode; Options : ST_Homing Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Position LREAL Absolute reference position to which the axis is set after homing. Alternatively, the constant DEFAULT_HOME_POSITION can be used here. In this case, the "Reference position for homing" specified in the Twin CAT System Manager is used. Homing Mode MC_Homing Mode Determines how the calibration is performed. (Type: MC_Homing Mode [} 40]) • MC_Default Homing Initiates default homing. • MC_Direct Sets the axis position directly to Position without executing a movement. • MC_Block Performs homing to a mechanical end stop. • MC_Force Calibration Enforces the "axis is calibrated" state. No movement takes place, and the position remains unchanged. • MC_Reset Calibration Resets the calibration state of the axis. No movement takes place, and the position remains unchanged. Options ST_Homing Options Data structure containing additional parameters. • Search Direction: Direction in which the referencing cam is to be searched • Search Velocity: Velocity at which the referencing cam is to be searched TE1000 Version: 1.5.3 21
## Page 22

Motion function blocks Name Type Description • Sync Direction: Direction in which the falling edge of the referencing cam is searched after the referencing cam has been detected • Sync Velocity: Velocity at which the falling edge of the referencing cam is searched for after the referencing cam has been detected • Reference Mode: Referencing mode (currently only ENCODERREFERENCEMODE_CAMATDIGITALINPU T) • Acceleration: Acceleration for homing • Deceleration: Deceleration for homing The signal of a referencing cam must be routed to a digital terminal input (Homing Mode = MC_Default Homing). Since the reference position is generally set during the motion, the axis will not stop exactly at this position. The standstill position differs by the braking distance of the axis, although the calibration is nevertheless exact. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE when the axis has been calibrated and the movement is complete. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Currently not implemented - "Active" indicates that the command is running. If the command has been buffered, it may only become active after a running command has been terminated. 22 Version: 1.5.3 TE1000
## Page 23

Motion function blocks Name Type Description Command Aborte BOOL TRUE if the command could not be executed completely. d Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Note The referencing process has several phases. The following diagram illustrates the sequence after starting function block MC_Home with the individual phases for the case Homing Mode = MC_Default Homing. Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 6.2 MC_Jog (Manual Motion) MC_Jog Jog Forward BOOL BOOL Done Jog Backwards BOOL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID The function block MC_Jog enables an axis to be moved via manual keys. The key signal can be linked directly with the "Jog Forward" and "Jog Backwards" inputs. Inputs VAR_INPUT Jog Forward : BOOL; Jog Backwards : BOOL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; END_VAR TE1000 Version: 1.5.3 23
## Page 24

Motion function blocks Name Type Description Jog Forward BOOL The command is executed with a rising edge, and the axis is moved in positive direction of travel. During the motion no further signal edges are accepted (this includes the "Jog Backwards" input). Jog Backwards BOOL The command is executed with a rising edge, and the axis is moved in negative direction of travel. "Jog Forward" and "Jog Backwards" should be triggered alternatively, although they are also mutually locked internally. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0). Deceleration LREAL Deceleration (≥0). Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if a movement was successfully completed. Busy BOOL TRUE as soon as the function block is active. FALSE if it is in the default state. Only then can a further edge be accepted at the jog inputs. Active BOOL Indicates that the axis is moved via the jog function. Command Aborte BOOL TRUE if the process is interrupted by an external event, d e.g. by the call up of MC_Stop [} 37]. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 24 Version: 1.5.3 TE1000
## Page 25

Motion function blocks 6.3 Point to point motion 6.3.1 MC_Halt MC_Halt Execute BOOL BOOL Done Deceleration LREAL BOOL Busy Options ST_Move Options BOOL Active ↔ Axis Reference To AXIS_REF BOOL Command Aborted BOOL Error UDINT Error ID The function block MC_Halt stops an axis with a defined deceleration ramp. In contrast to MC_Stop [} 37], the axis is not locked against further movement commands. The axis can therefore be started by another command after the stop. Inputs VAR_INPUT Execute : BOOL; Deceleration : LREAL; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Deceleration LREAL Deceleration If the value is ≤ 0, the deceleration parameterized with the last Move command is used. For safety reasons MC_Halt and MC_Stop [} 37] cannot be executed with weaker dynamics than the currently active motion command. The parameterization is adjusted automatically, if necessary. Options ST_Move Options Data structure (ST_Move Options [} 41]), which contains additional, rarely required parameters. The input can normally remain unused. See also: General rules for MC function blocks [} 11]. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; TE1000 Version: 1.5.3 25
## Page 26

Motion function blocks Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the axis has been stopped and is stationary. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL Becomes TRUE, if the command could not be fully d executed. The running command may have been followed by a Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 11]. Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 6.3.2 MC_Move Absolute MC_Move Absolute Execute BOOL BOOL Done Position LREAL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Options ST_Move Options UDINT Error ID ↔ Axis Reference To AXIS_REF The function block MC_Move Absolute starts the positioning to an absolute target position and monitors the axis movement over the entire travel path. The "Done" output is set once the target position has been reached. Otherwise, the output "Command Aborted" or, in case of an error, the output "Error" is set. MC_Move Absolute is predominantly used for linear axis systems. For modulo axes the position is not interpreted as a modulo position, but as an absolute position in continuous absolute coordinate system. Alternatively, the function block MC_Move Modulo [} 28] can be used for modulo positioning. Inputs VAR_INPUT Execute : BOOL; Position : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Options : ST_Move Options; END_VAR 26 Version: 1.5.3 TE1000
## Page 27

Motion function blocks Name Type Description Execute BOOL The command is executed with a rising edge. Position LREAL Absolute target position to be used for positioning. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (>0) Deceleration LREAL Deceleration (>0) Options ST_Move Options Data structure (ST_Move Options [} 41]) containing additional, rarely used parameters. The input can normally remain unused. See also: General rules for MC function blocks [} 11]. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE when the target position has been reached. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 11]. TE1000 Version: 1.5.3 27
## Page 28

Motion function blocks Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 6.3.3 MC_Move Modulo MC_Move Modulo Execute BOOL BOOL Done Position LREAL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Direction MC_Direction UDINT Error ID Options ST_Move Options ↔ Axis Reference To AXIS_REF The function block MC_Move Modulo is used to execute a positioning operation, which refers to the modulo position of an axis. The basis for a modulo rotation is the adjustable parameter "Modulo Factor" of the AXIS_REF structure (Axis. Parameter. Modulo Factor, e.g. 360°). A distinction is made between three possible start types, depending on the "Direction" input. • Positioning in positive direction • Positioning in negative direction • Positioning along shortest path Starting an axis from standstill If an axis is started from standstill with MC_Move Modulo , it is possible to specify positions greater than or equal to 360°, in order to perform additional full turns. Special cases Particular attention should be paid to the behavior when requesting one or more complete modulo rotations. No movement is performed if the axis is at an exact set position of 90° and is positioned at 90°, for example. If 450° in positive direction is requested, the axis performs one rotation. The behavior can be different following an axis reset, because the reset will cause the current actual position to be adopted as the set position. This means that the axis is no longer exactly at 90°, but slightly below or above this value. These cases will give rise either to a minimum positioning to 90 degrees, or on the other hand a complete rotation. Depending on the use case, it may be more effective for complete modulo rotations to calculate the desired target position on the basis of the current absolute position, and then to position using the function block MC_Move Absolute [} 26]. See also: Modulo positioning [} 30] Inputs VAR_INPUT Execute : BOOL; Position : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Direction : MC_Direction; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. 28 Version: 1.5.3 TE1000
## Page 29

Motion function blocks Name Type Description Position LREAL Modulo target position to be used for positioning. If the axis is started from standstill, positions greater than 360° result in additional turns. Negative positions are not permitted. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0) Deceleration LREAL Deceleration (≥0) Direction MC_Direction Positive or negative direction of travel (type MC_Direction [} 41]). If the axis is started during a motion, the direction may not be reversed. Options ST_Move Options Data structure (ST_Move Options [} 41]) containing additional, rarely used parameters. The input can normally remain unused. See also: General rules for MC function blocks [} 11]. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE when the target position has been reached. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. TE1000 Version: 1.5.3 29
## Page 30

Motion function blocks See also: General rules for MC function blocks [} 11]. 6.3.4 Modulo positioning Modulo positioning (MC_Move Modulo [} 28]) is possible irrespective of the axis type. If may be used both for linear or rotary axes, because Twin CAT makes no distinction between these types. A modulo axis has a consecutive absolute position in the range ±∞. The modulo position of the axis is simply a piece of additional information about the absolute axis position. Modulo positioning represents the required target position in a different way. Unlike absolute positioning, where the user specifies the target unambiguously, modulo positioning has some risks, because the required target position may be interpreted in different ways. Settings in the AXIS_REF parameters Modulo positioning generally refers to a modulo period to be set under Axis Parameter. Modulo Factor of the corresponding AXIS_REF [} 39]. In addition, appropriate settings are required in the drive parameters (e.g. EL72xx). The examples on this page are given based on a rotary axis with a modulo period of 360°. Special features of axis resets Axis positioning always refers to the set position. The set position of an axis is normally the target position of the last travel command. An axis reset (MC_Reset [} 14], controller enable with MC_Power [} 13]) can lead to a set position that is different from that expected by the user, because in this case the current actual position is used as the set position. The axis reset resets any lag error that may have occurred as a result of this procedure. If this possibility is not considered, subsequent positioning may lead to unexpected behavior. Example: An axis is positioned to 90°, with the result that subsequently the set position of the axis is exactly 90°. A further modulo travel command to 450° in positive direction results in a full turn, with the subsequent modulo position of the axis is once again exactly 90°. If an axis reset is then carried out, the set position can randomly be somewhat smaller or slightly larger than 90°. The new value depends on the actual value of the axis at the time of the reset. However, the next travel command will lead to different results. If the set position is slightly less than 90°, a new travel command to 90° in positive direction only leads to minimum motion. The deviation created by the reset is compensated, and the subsequent set position is once again exactly 90°. However, if the set position after the axis reset is slightly more than 90°, the same travel command leads to a full turn to reach the exact set position of 90°. This problem occurs if complete turns by 360° or multiples of 360° were initiated. For positioning to an angle that is significantly different from the current modulo position, the travel command is unambiguous. 30 Version: 1.5.3 TE1000
## Page 31

Motion function blocks Modulo positioning by less than one turn Modulo positioning from a starting position to a non-identical target position is unambiguous and requires no special consideration. A modulo target position in the range [0 ≤ position < 360] reaches the required target in less than one whole turn. No motion occurs if target position and starting position are identical. Target positions of more than 360° lead to one or more full turns before the axis travels to the required target position. For a movement from 270° to 0°, a modulo target position of 0° (not 360°) should therefore be specified, because 360° is outside the basic range and would lead to an additional turn. For modulo positioning, a distinction is made between three different directions, i.e. positive direction, negative direction and along shortest path (MC_Direction [} 41]). For positioning along the shortest path, target positions of more than 360° are not sensible, because the movement towards the target is always direct. In contrast to positive or negative direction, it is therefore not possible to carry out several turns before the axis moves to the target. For modulo positioning with start type "along shortest path", only modulo target positions within the basic period (e.g. less than 360°) are permitted, otherwise an error is returned. The following table shows some positioning examples: Direction Absolute starting Modulo target posi- Relative travel path Absolute end posi- Modulo end posi- (modulo start type) position tion tion tion Positive direction 90.00 0.00 270.00 360.00 0.00 Positive direction 90.00 360.00 630.00 720.00 0.00 Positive direction 90.00 720.00 990.00 1080.00 0.00 TE1000 Version: 1.5.3 31
## Page 32

Motion function blocks Direction Absolute starting Modulo target posi- Relative travel path Absolute end posi- Modulo end posi- (modulo start type) position tion tion tion Negative direction 90.00 0.00 -90.00 0.00 0.00 Negative direction 90.00 360.00 -450.00 -360.00 0.00 Negative direction 90.00 720.00 -810.00 -720.00 0.00 Along shortest path 90.00 0.00 -90.00 0.00 0.00 Modulo positioning with full turns In principle, modulo positioning by one or full turns are no different than positioning to an angle that differs from the starting position. No motion occurs if target position and starting position are identical. For a full turn, 360° has to be added to the starting position. The reset behavior described above shows that positioning with full turns requires particular attention. The following table shows positioning examples for a starting position of approximately 90°. Direction Absolute starting Modulo target posi- Relative travel path Absolute end posi- Modulo end posi- (modulo start type) position tion tion tion Positive direction 90.00 90.00 0.00 90.00 90.00 Positive direction 91.10 90.00 358.90 450.00 90.00 Positive direction 88.90 90.00 1.10 90.00 90.00 Positive direction 90.00 450.00 360.00 450.00 90.00 Positive direction 91.10 450.00 718.90 810.00 90.00 Positive direction 88.90 450.00 361.10 450.00 90.00 Positive direction 90.00 810.00 720.00 810.00 90.00 Positive direction 91.10 810.00 1078.90 1,170.00 90.00 Positive direction 88.90 810.00 721.10 810.00 90.00 Negative direction 90.00 90.00 0.00 90.00 90.00 Negative direction 91.10 90.00 -1.10 90.00 90.00 Negative direction 88.90 90.00 -358.90 -270.00 90.00 Negative direction 90.00 450.00 -360.00 -270.00 90.00 Negative direction 91.10 450.00 -361.10 -270.00 90.00 Negative direction 88.90 450.00 -718.90 -630.00 90.00 Negative direction 90.00 810.00 -720.00 -630.00 90.00 Negative direction 91.10 810.00 -721.10 -630.00 90.00 Negative direction 88.90 810.00 -1078.90 -990.00 90.00 Modulo calculations within the PLC program All positioning jobs on an axis are executed based of the set position. The current actual position is only used for control purposes. If a new target position is to be calculated in a PLC program based on the current position, this calculation must be performed with the current set position of the axis (Axis. Status. Modulo Set Pos and Axis. Status. Modulo Set Turns). It is not advisable to perform order calculations based on the actual modulo position, which is available in the axis status (Modulo Act Pos and Modulo Act Turns), Due to the greater or lesser control deviation of the axis, errors in the programmed sequence, such as undesired rotations, could occur. Application example Within a system, a rotational axis carries out an operation. The starting position for each operation is 90°, and with each cycle the axis is to be positioned by 360° in positive direction. Reverse positioning is not permitted for mechanical reasons. Small reverse positioning is acceptable as part of position control movements. 32 Version: 1.5.3 TE1000
## Page 33

Motion function blocks Since the axis may only be pre-positioned, the motion command MC_Move Modulo [} 28] with the modulo startup type "positive direction" (MC_Positive_Direction) is used. The modulo target position is specified as 450°, since the original orientation is to be reached again after a full turn by 360°. A modulo target position of 90° would not lead to any motion. The process starts with a basic positioning movement (MC_Move Modulo [} 28]) to ensure that the starting position is accurate. The step sequence then changes into an execution cycle. In the event of a fault, the axis is reset with MC_Reset [} 14] and subsequently (at the start of the step sequence) moved to its valid starting position. In this case, 90° is specified as the target position so that this position is approached as quickly as possible. No motion occurs if the axis is already at the starting position. Alternatively, the reset step may be carried out at the start of the step sequence, so that the axis is initialized at the start of the process. Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control TE1000 Version: 1.5.3 33
## Page 34

Motion function blocks 6.3.5 MC_Move Relative MC_Move Relative Execute BOOL BOOL Done Distance LREAL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Options ST_Move Options UDINT Error ID ↔ Axis Reference To AXIS_REF The function block MC_Move Relative starts a relative positioning procedure based on the current set position and monitors the axis movement over the whole travel path. The "Done" output is set once the target position has been reached. Otherwise, the output "Command Aborted" or, in case of an error, the output "Error" is set. Inputs VAR_INPUT Execute : BOOL; Distance : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Distance LREAL Relative distance to be used for positioning. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0) Deceleration LREAL Deceleration (≥0) Options ST_Move Options Data structure (ST_Move Options [} 41]) containing additional, rarely used parameters. The input can normally remain unused. See also: General rules for MC function blocks [} 11]. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR 34 Version: 1.5.3 TE1000
## Page 35

Motion function blocks Name Type Description Done BOOL TRUE when the target position has been reached. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 11]. Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 6.3.6 MC_Move Velocity MC_Move Velocity Execute BOOL BOOL In Velocity Continuous Update BOOL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Direction MC_Direction UDINT Error ID Options ST_Move Options ↔ Axis Reference To AXIS_REF The function block MC_Move Velocity starts an endless travel with a specified velocity and direction. The movement can be stopped through a Stop command. The In Velocity output is set once the constant velocity is reached. Once constant velocity has been reached, the block function is complete, and no further monitoring of the movement takes place. If the command is aborted during the acceleration phase, the output "Command Aborted" or, in the event of an error, the output "Error" is set. Inputs VAR_INPUT Execute : BOOL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Direction : MC_Direction := MC_Positive_Direction; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. TE1000 Version: 1.5.3 35
## Page 36

Motion function blocks Name Type Description Continuous Updat BOOL If Continuous Update is TRUE, the dynamics can be e changed according to the Velocity, Acceleration and Deceleration inputs during the processing of the command with a rising edge at the Execute input and brought into effect as quickly as possible. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0) Deceleration LREAL Deceleration (≥0) Direction MC_Direction Positive or negative direction of travel (type MC_Direction [} 41]) Options ST_Move Options Data structure (ST_Move Options [} 41]) containing additional, rarely used parameters. The input can normally remain unused. See also: General rules for MC function blocks [} 11]. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT In Velocity : BOOL; (* B *) Busy : BOOL; (* E *) Active : BOOL; (* E *) Command Aborted : BOOL; (* E *) Error : BOOL; (* B *) Error ID : UDINT; (* E *) END_VAR Name Type Description In Velocity BOOL After the axis acceleration, the In Velocity output assumes the value TRUE once the requested target velocity has been reached. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the function block is active. If "Busy" is FALSE, the function block is ready for a new order. At the same time one of the outputs "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 36 Version: 1.5.3 TE1000
## Page 37

Motion function blocks See also: General rules for MC function blocks [} 11]. Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 6.3.7 MC_Stop MC_Stop Execute BOOL BOOL Done Deceleration LREAL BOOL Busy Options ST_Move Options BOOL Active ↔ Axis Reference To AXIS_REF BOOL Command Aborted BOOL Error UDINT Error ID The function block MC_Stop stops an axis with a defined deceleration ramp and locks the axis against other motion commands. The function block is therefore suitable for stops in special situations, in which further axis movements are to be prevented. At the same time the axis is blocked for other motion commands. The axis can only be restarted once the Execute signal has been set to FALSE after the axis has stopped. A few cycles are required to release the axis after a falling edge of Execute. During this phase the "Busy" output remains TRUE, and the function block has to be called until "Busy" becomes FALSE. The locking of the axis is canceled with an MC_Reset [} 14]. Alternatively, the axis can be stopped with MC_Halt [} 25] without locking. MC_Halt is preferable for normal movements. Inputs VAR_INPUT Execute : BOOL; Deceleration : LREAL; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. The axis is locked during the stop. The axis can only be restarted once the Execute signal has been set to FALSE after the axis has stopped. Deceleration LREAL Deceleration If the value is 0, the deceleration parameterized with the last Move command is used. For safety reasons MC_Stop and MC_Halt cannot be executed with weaker dynamics than the currently active motion command. The parameterization is adjusted automatically, if necessary. Options ST_Move Options Data structure (ST_Move Options [} 41]) containing additional, rarely used parameters. The input can normally remain unused. See also: General rules for MC function blocks [} 11]. TE1000 Version: 1.5.3 37
## Page 38

Motion function blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 39] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the axis has been stopped and is stationary. Busy BOOL TRUE as soon as the command is started with Execute and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. "Busy" remains TRUE as long as the axis is locked. The axis is only unlocked and "Busy" becomes FALSE when Execute is set to FALSE. Active BOOL Indicates that the function block controls the axis. Remains TRUE as long as the axis is locked. The axis is only unlocked and "Active" becomes FALSE when Execute is set to FALSE. Command Aborte BOOL TRUE if the command could not be executed completely. d Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 11]. Requirements Development environment PLC libraries to include Twin CAT 3.1.4024.11 Tc3_Drive Motion Control 38 Version: 1.5.3 TE1000
## Page 39

Data types 7 Data types 7.1 Axis interface 7.1.1 AXIS_REF The AXIS_REF data type contains axis information. AXIS_REF is an interface between the PLC and the DRIVE. It is added to MC function blocks as axis reference. TYPE AXIS_REF : VAR_INPUT Plc To Drive AT %Q* : PLCTODRIVE_AXIS_REF; Parameter : ST_Axis Parameters; END_VAR VAR_OUTPUT Drive To Plc AT %I* : DRIVETOPLC_AXIS_REF; Wc State AT %I* : DRIVETOPLC_WCSTATE; Info Data AT %I* : DRIVETOPLC_IFODATA; Status : ST_Axis Status; END_VAR END_TYPE For the library function, it is essential to parameterize the Encoder Scaling Factor and Max Velocity parameters of the ST_Axis Parameters data type. AXIS_REF elements Name Description Plc To Drive Data structure that is cyclically exchanged between PLC and DRIVE. The MC function blocks communicate with the DRIVE via this data structure and send control information and commands from the PLC to the DRIVE. The data structure is automatically placed in the output process image of the PLC and must be connected to the input process image of a DRIVE in the Twin CAT development environment. Parameter Data structure for parameterization of the axis (type: ST_Axis Parameters [} 42]). Drive To Plc Data structure that is cyclically exchanged between PLC and DRIVE. The MC function blocks communicate with the DRIVE via this data structure and receive status information from the DRIVE. The data structure is automatically placed in the input process image of the PLC and must be connected to the output process image of a DRIVE in the Twin CAT System Manager. The DRIVETOPLC structure contains all main state data for an axis such as position, velocity and instruction state. Since data exchange takes place cyclically, the PLC can access the current axis state at any time without additional communication effort. Wc State Data structure that is cyclically exchanged between PLC and DRIVE and contains the Wc State of the DRIVE. The data structure is automatically placed in the input process image of the PLC and must be connected to the output process image of a DRIVE in the Twin CAT development environment (type: DRIVETOPLC_WCSTATE [} 40]). Info Data Data structure that is cyclically exchanged between PLC and DRIVE and contains ADS information for accessing DRIVE parameters. The data structure is automatically placed in the input process image of the PLC and must be connected to the output process image of a DRIVE in the Twin CAT development environment (type: DRIVETOPLC_INFODATA [} 40]). TE1000 Version: 1.5.3 39
## Page 40

Data types Name Description Status Data structure containing additional or processed status information for an axis (type: ST_Axis Status [} 42]). This data structure is not refreshed cyclically, but has to be updated through the PLC program. For this purpose MC_Read Status or alternatively the action "Read Status" of AXIS_REF can be called (see sample). Sample: VAR Axis1 : AXIS_REF (* axis data structure for Axis-1 *) END_VAR (* program code at the beginning of each PLC cycle *) Axis1. Read Status(); (* alternative program code at the beginning of each PLC cycle *) Axis1(); The call of "Read Status" or "Axis1" should be made once at the beginning of each PLC cycle. The current status information can then be accessed in AXIS_REF from the whole PLC program. Within a cycle the status does not change. 7.1.2 DRIVETOPLC_INFODATA The structure DRIVETOPLC_INFODATA is part of the structure AXIS_REF [} 39]. TYPE DRIVETOPLC_INFODATA : State : UINT; Ads Addr : AMSADDR; END_TYPE 7.1.3 DRIVETOPLC_WCSTATE The structure DRIVETOPLC_WCSTATE is part of the structure AXIS_REF [} 39]. TYPE DRIVETOPLC_WCSTATE : Wc State : BIT; Input Toggle : BIT; END_TYPE 7.2 Homing 7.2.1 E_Encoder Reference Mode TYPE E_Encoder Reference Mode : ( Encoder Reference Mode_Cam At Digital Input, (* Cam is connected to digital input*) ); END_TYPE 7.2.2 MC_Homing Mode This data type is used to parameterize the function block MC_Home [} 21]. TYPE MC_Homing Mode : ( MC_Default Homing :=0, (* default homing as defined in the System Manager encoder parameter s *) MC_Direct :=4, (* Static Homing forcing position from user reference *) MC_Block :=6, (* Homing against hardware parts blocking movement *) MC_Force Calibration :=7, (* set the calibration flag without perfomring any motion or changi ng the position *) MC_Reset Calibration :=8 (* resets the calibration flag without perfomring any motion or cha 40 Version: 1.5.3 TE1000
## Page 41

Data types nging the position *) ); END_TYPE 7.2.3 ST_Homing Options TYPE ST_Homing Options : STRUCT ( Search Direction : MC_Direction := MC_Direction. MC_Undefined_Direction; (* search direction *) Search Velocity : LREAL; (* search velocity *) Sync Direction : MC_Direction := MC_Direction. MC_Undefined_Direction; (* synchronization direction *) Sync Velocity : LREAL; (* synchronization velocity *) Reference Mode : E_Encoder Reference Mode := E_Encoder Reference Mode. ENCODERREFERENCEMODE_CAMATD IGITALINPUT; (* Mode of reference sequence *) Acceleration : LREAL; (* user defined acceleration *) Deceleration : LREAL; (* user defined deceleration *) ); END_TYPE Name Data type Description Search Direction MC_Direction Direction in which the referencing cam is to be searched. Search Velocity LREAL Velocity at which the referencing cam is to be searched. Sync Direction MC_Direction Direction in which the falling edge of the referencing cam is searched after the referencing cam has been detected. Reference Mode E_Encoder Reference Mo Referencing mode (currently only de ENCODERREFERENCEMODE_CAMATDIGITALINP UT). Acceleration LREAL Acceleration for the reference run Deceleration LREAL Deceleration for the reference run 7.3 Motion 7.3.1 MC_Direction This enumeration type contains the possible directions of movement for the function blocks MC_Move Velocity [} 35] and MC_Move Modulo [} 28]. TYPE MC_Direction : ( MC_Undefined_Direction := 0, MC_Positive_Direction := 1, MC_Shortest_Way := 2, MC_Negative_Direction := 3 ); END_TYPE 7.3.2 ST_Move Options This data type is intended for possible future optional motion commands settings such as MC_Move Absolute or MC_Halt. TYPE ST_Move Options : STRUCT END_STRUCT END_TYPE TE1000 Version: 1.5.3 41
## Page 42

Data types 7.4 Status and parameter 7.4.1 MC_Axis States This data type describes the operating states according to the Plc Open state diagram [} 9]. TYPE MC_Axis States : ( MC_AXISSTATE_UNDEFINED, MC_AXISSTATE_DISABLED, MC_AXISSTATE_STANDSTILL, MC_AXISSTATE_ERRORSTOP, MC_AXISSTATE_STOPPING, MC_AXISSTATE_HOMING, MC_AXISSTATE_DISCRETEMOTION, MC_AXISSTATE_CONTINOUSMOTION ); END_TYPE See also: General rules for MC function blocks [} 11]. 7.4.2 ST_Axis Parameters This data type contains basic necessary axis parameters. TYPE ST_Axis Parameters : STRUCT Encoder Scaling Factor : LREAL; Max Velocity : LREAL; Modulo Factor : LREAL := 360.0; END_STRUCT END_TYPE Formula for calculating the parameters: Motor speed Limitation "Motor speed limitation" depends on the configured voltage and the motor used. For the servo terminals, this value can be read from Co E object 0x8011:1B, for example. 7.4.3 ST_Axis Status This data type contains extensive status information about an axis. The data structure must be updated in each PLC cycle by calling MC_Read Status or by calling the action Axis. Read Status() or Axis() (AXIS_REF [} 39]). TYPE ST_Axis Status : STRUCT Axis Id : UDINT; Axis Name : STRING; Act Pos : LREAL; Modulo Act Pos : LREAL; Act Velo : LREAL; Act Acceleration : LREAL; Set Pos : LREAL; Modulo Set Pos : LREAL; 42 Version: 1.5.3 TE1000
## Page 43

Data types Set Velo : LREAL; Set Acceleration : LREAL; Pos Diff : LREAL; Target Position : LREAL; Target Velocity : LREAL; Target Acceleration : LREAL; Target Deceleration : LREAL; Info Data1 : LREAL; Info Data2 : LREAL; Info Data3 : LREAL; Digital Input1 : BOOL; Digital Input2 : BOOL; Cmd No : UINT; Cmd State : UINT; Motion State : MC_Axis States; (* motion state in the PLCopen state diagram *) Error : BOOL; (* axis error state *) Error Id : UDINT; (* axis error code *) (* statemachine states: *) Error Stop : BOOL; Disabled : BOOL; Stopping : BOOL; Stand Still : BOOL; Discrete Motion : BOOL; Continuous Motion : BOOL; Homing : BOOL; (* additional status *) Constant Velocity : BOOL; Accelerating : BOOL; Decelerating : BOOL; (* Status *) Operational : BOOL; Control Loop Closed : BOOL; (* operational and position control active *) Has Job : BOOL; Has Been Stopped : BOOL; In Target Position : BOOL; Protected : BOOL; Homed : BOOL; Homing Busy : BOOL; Motion Commands Locked : BOOL; (* stop 'n hold *) Moving : BOOL; Positive Direction : BOOL; Negative Direction : BOOL; Not Moving : BOOL; PTPmode : BOOL; Drive Device Error : BOOL; Drive Positioning Error: BOOL; Io Data Invalid : BOOL; END_STRUCT END_TYPE 7.5 Touch probe 7.5.1 E_Signal Edge Edge defines whether the rising or falling edge of the trigger signal is evaluated. TYPE E_Signal Edge : ( Rising Edge, Falling Edge ) UINT; END_TYPE TE1000 Version: 1.5.3 43
## Page 44

Data types Name Description Rising Edge Rising signal edge Falling Edge Falling signal edge 7.5.2 E_Signal Source TYPE E_Signal Source : ( Signal Source_Default, (* undefined or externally configured *) Signal Source_Zero Pulse := 128, (* encoder zero pulse *) ); END_TYPE Name Description Signal Source Optionally defines the signal source, if it can be selected via the controller. In many cases the signal source is permanently configured in the drive and should then be set to the default value "Signal Source_Default". 7.5.3 E_Touch Probe TYPE E_Touch Probe : ( Touch Probe1 := 1, (* 1st hardware probe unit with Sercos, Can Open, KL5xxx and others *) Plc Event := 10 (* simple PLC signal TRUE/FALSE *) ); END_TYPE Name Description Touch Probe Defines the latch unit (probe unit) within the encoder hardware used. Plc Event If the signal source "Touch Probe" is set to the type "Plc Event", a rising edge on these variables triggers the recording of the current axis position. "Plc Event" is not a real latch function, but depends on the cycle time. 7.5.4 MC_Touch Probe Recorded Data TYPE MC_Touch Probe Recorded Data : STRUCT Counter : LREAL; Recorded Position : LREAL; Absolute Position : LREAL; Modulo Position : LREAL; END_STRUCT END_TYPE Name Data type Description Counter LREAL Counter indicating how many valid edges were detected in the last cycle. Detection of multiple edges is only implemented in mode TOUCHPROBEMODE_CONTINUOUS under SERCOS / SOE and must be supported explicitly by the hardware (e.g. AX5000). Recorded Position LREAL Axis position recorded at the point in time of the trigger signal. This corresponds to the absolute axis position or the modulo axis position, depending on the parameterization. Absolute Position LREAL Absolute axis position detected at the point in time of the trigger signal. Modulo Position LREAL Modulo axis position recorded at the point in time of the trigger signal. 44 Version: 1.5.3 TE1000
## Page 45

Data types 7.5.5 TRIGGER_REF TYPE TRIGGER_REF : STRUCT Touch Probe : E_Touch Probe; (* probe unit definition *) Signal Source : E_Signal Source; (* optional physical signal source used by the probe unit *) Edge : E_Signal Edge; (* rising or falling signal edge *) Mode : E_Touch Probe Mode; (* single shot or continuous monitoring *) Plc Event : BOOL; (* PLC trigger signal input when Touch Probe signal source is set to 'Plc Event' *) Modulo Positions : BOOL; (* interpretation of First Position, Last Position and Recorded Position as modulo positions when TRUE *) END_STRUCT END_TYPE TYPE E_Touch Probe Mode : ( TOUCHPROBEMODE_SINGLE := 1 ); END_TYPE Mode: Specifies the operation mode of the latch unit. In single mode only the first edge is recorded. Modulo Positions: If the variable "Modulo Positions" is FALSE, the axis position is interpreted in an absolute linear range from -∞ to +∞. The positions "First Position", "Last Position" and "Recorded Position" of the function block MC_Touch Probe [} 17] are then also absolute. If "Modulo Positions" is TRUE, all positions are interpreted in modulo mode in the modulo range of the axis used (e.g. 0..359.9999). At the same time this means that a defined trigger window repeats itself cyclically. See previous sections for further explanations. TE1000 Version: 1.5.3 45
## Page 46

Global constants 8 Global constants 8.1 Library version All libraries have a certain version. The version is indicated in the PLC library repository, for example. A global constant contains the information about the library version: Global_Version VAR_GLOBAL CONSTANT st Lib Version_Tc3_Drive Motion Control : ST_Lib Version; END_VAR st Lib Version_Tc3_Drive Motion Control: Version information of the Tc3_Drive Motion Control library (type: ST_Lib Version). To check whether the version you have is the version you need, use the function F_Cmp Lib Version (defined in the Tc2_System library). Compare versions All other options for comparing library versions, which you may know from Twin CAT 2, are outdated! 46 Version: 1.5.3 TE1000
## Page 47

Support and Service 9 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TE1000 Version: 1.5.3 47
## Page 48

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H.
## Page 49

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
