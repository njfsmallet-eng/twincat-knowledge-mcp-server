---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.5.2"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_SUPS_EN.pdf"
release_date: "2023-03-08"
---
Manual | EN TE1000 Twin CAT 3 | PLC Lib: Tc2_SUPS 2023-03-08 | Version: 1.5.2
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 Safety instructions............................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 Using the 1-second UPS with several PLC projects on a target system............................................. 9 4 Function blocks....................................................................................................................................... 10 4.1 CB3011........................................................................................................................................... 10 4.1.1 FB_S_UPS_CB3011........................................................................................................ 10 4.2 CX50x0........................................................................................................................................... 12 4.2.1 FB_S_UPS....................................................................................................................... 12 4.3 CX51x0........................................................................................................................................... 14 4.3.1 FB_S_UPS_CX51x0........................................................................................................ 14 4.4 CX9020-U900................................................................................................................................. 16 4.4.1 FB_S_UPS_CX9020_U900............................................................................................. 16 4.5 BAPI................................................................................................................................................ 18 4.5.1 FB_S_UPS_BAPI............................................................................................................. 18 4.6 FB_NT_Quick Shutdown.................................................................................................................. 20 5 Data types................................................................................................................................................ 22 5.1 E_S_UPS_Mode............................................................................................................................. 22 5.2 E_S_UPS_State.............................................................................................................................. 22 6 Global constants..................................................................................................................................... 23 6.1 Library version................................................................................................................................. 23 TE1000 Version: 1.5.2 3
## Page 4

Table of contents 4 Version: 1.5.2 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilization of this document as well as the communication of its contents to others without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TE1000 Version: 1.5.2 5
## Page 6

Foreword 1.2 Safety instructions Safety regulations Please note the following safety instructions and explanations! Product-specific safety instructions can be found on following pages or in the areas mounting, wiring, commissioning etc. Exclusion of liability All the components are supplied in particular hardware and software configurations appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation and drive engineering who are familiar with the applicable national standards. Description of symbols In this documentation the following symbols are used with an accompanying safety instruction or note. The safety instructions must be read carefully and followed without fail! DANGER Serious risk of injury! Failure to follow the safety instructions associated with this symbol directly endangers the life and health of persons. WARNING Risk of injury! Failure to follow the safety instructions associated with this symbol endangers the life and health of persons. CAUTION Personal injuries! Failure to follow the safety instructions associated with this symbol can lead to injuries to persons. NOTE Damage to the environment or devices Failure to follow the instructions associated with this symbol can lead to damage to the environment or equipment. Tip or pointer This symbol indicates information that contributes to better understanding. 6 Version: 1.5.2 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.5.2 7
## Page 8

Introduction 2 Introduction The library Tc2_SUPS contains functions and function blocks required for controlling the 1-second UPS (SUPS). Function blocks Name Description FB_S_UPS [} 12] Function block for controlling the 1-second UPS of CX50x0 Embedded PCs FB_S_UPS_CB3011 [} 10] Function block for controlling the 1-second UPS of PCs with CB3011 board FB_S_UPS_CX51x0 [} 14] Function block for controlling the 1-second UPS of CX51x0 Embedded PCs FB_S_UPS_CX9020_U900 [} 16] Function block for controlling the 1-second UPS of CX9020-U900 Embedded PCs FB_S_UPS_BAPI [} 18] Function block for controlling the 1-second UPS of devices with BIOS-API from version v1.15 FB_NT_Quick Shutdown [} 20] Internal function block for quick shutdown, which is used by the FB_S_UPS. 8 Version: 1.5.2 TE1000
## Page 9

Using the 1-second UPS with several PLC projects on a target system 3 Using the 1-second UPS with several PLC projects on a target system To use the 1-second UPS with several PLC projects on a target system (PC/CX), please note the following process description. The process is the same for all supported 1-second UPS devices. Only the SUPS function block for controlling the 1-second UPS is different, depending on the target platform. The PLC runtime systems communicate via process data. Process description: • Both PLC runtime systems use their own instance of the SUPS function block to check whether the voltage has failed and then write the persistent data without quick shutdown. • When the first PLC runtime system has completed the process of writing the persistent data, it notifies the second PLC runtime system. • The second PLC runtime system also writes the persistent data and at the same time waits for the notification from the first PLC runtime system. • When both PLC runtime systems have completed the writing process, the second PLC runtime system directly initiates the quick shutdown. In configurations with two or more PLC projects, only one PLC runtime system may trigger the quick shutdown. Example for CX51x0 Embedded PCs The example illustrates the application of the 1-second UPS with two PLC projects for 51x0 Embedded PCs. Download: https://infosys.beckhoff.com/content/1033/Tc Plc Lib_Tc2_SUPS/Resources/3714188299/.zip TE1000 Version: 1.5.2 9
## Page 10

Function blocks 4 Function blocks 4.1 CB3011 4.1.1 FB_S_UPS_CB3011 The function block FB_S_UPS_CB3011 can be used on PCs with a CB3011 board with 1-second UPS, in order to control the 1-second UPS from the PLC. In the event of a power failure, this enables the persistent data to be saved and/or a quick shutdown to be executed, depending on the selected mode. The default input values of the FB_S_UPS_CB3011 should be retained. The 1-second UPS does not have sufficient capacity for bridging power failures. Only the Compact Flash card can be used for data storage, in view of the fact that the UPS capacity is not sufficient for operating a hard disk. The 1-second UPS can be used only for a few seconds in the event of a power failure in order, to save persistent data. The data must be saved in the fast “persistent mode” “SPDM_2PASS”, even though this can lead to real-time violations. Make sure you configure adequate router memory for saving the persistent data. Irrespective of the mode and irrespective of whether data were saved or the quick shutdown was executed, the 1-second UPS switches off the mainboard after the discharging of the capacitors. NOTE Loss of data If other applications or the PLC keep further files open or write to them, file errors may occur if the 1-second UPS switches off the controller. Function block modes A Quick Shutdown is performed automatically in the e SUPS_Wr Persist Data_Shutdown mode [} 22] (standard setting) after the storage of the persistent data. In the e SUPS_Wr Persist Data_No Shutdown mode [} 22] only the persistent data are saved, no Quick Shutdown is performed. In e SUPS_Immediate Shutdown mode [} 22] a quick shutdown is executed immediately, without saving data. In the e SUPS_Check Power Status mode [} 22] only a check is performed as to whether a power failure has occurred. If this is the case, the function block only switches back to the Power OK state after the expiry of t Recover Time (10s). Inputs VAR_INPUT s Net ID : T_Ams Net Id:= ''; (* '' = local netid *) i PLCPort : UINT; (* PLC Runtime System for writing persistent data *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* ADS Timeout *) e Ups Mode : E_S_UPS_Mode := e SUPS_Wr Persist Data_Shutdown; (* UPS mode (w/ wo writing persistent data, w/wo shutdown) *) e Persistent Mode : E_Persistent Mode := SPDM_2PASS; (* mode for writing persistent data *) 10 Version: 1.5.2 TE1000
## Page 11

Function blocks t Recover Time : TIME := T#10s; (* ON time to recover from short power failure in mode e SUPS_Wr Persist Data_No Shutdown/e SUPS_Check Power Status *) END_VAR Name Type Description s Net ID T_Ams Net Id Ams Net Id of the controller i PLCPort UINT Port number of the PLC runtime system (851 for the first PLC runtime system, 852 for the second PLC runtime system, etc.). If you do not specify a port number, the function block then automatically determines the port of the PLC runtime system. t Timeout TIME Timeout for writing the persistent data or the quick shutdown. e Ups Mode E_S_UPS_Mode [} 22] Defines whether persistent data are to be written and whether a quick shutdown is to be executed. The default value is e SUPS_Wr Persist Data_Shutdown, i.e. a quick shutdown is executed automatically once the persistent data have been saved. e Persistent Mode E_Persistent Mode Mode for writing the persistent data. Default value is SPDM_2PASS. t Recover Time TIME Time after which the UPS returns to the Power OK state in UPS modes without quick shutdown. The t Recover Time must be greater than the maximum charging time for the UPS, otherwise the UPS may discharge too much in the event of short, consecutive power failures, which could result in its charge being insufficient for storing the persistent data. Outputs VAR_OUTPUT b Power Fail Detect : BOOL; (* TRUE while powerfailure is detected *) e State : E_S_UPS_State := e SUPS_Power OK; (* current ups state *) END_VAR Name Type Description b Power Fail Detect BOOL TRUE during power failure. FALSE if the supply voltage is present. e State E_S_UPS_State [} 22] Internal state of the function block Requirements Development environ- Target platform Hardware PLC libraries to include ment Twin CAT v3.1 B4016 ARM Panel PC with 1-second UPS Tc2_SUPS CB3011 TE1000 Version: 1.5.2 11
## Page 12

Function blocks 4.2 CX50x0 4.2.1 FB_S_UPS The function block FB_S_UPS can be used on CX50x0 Embedded PCs with 1-second UPS, in order to control the 1-second UPS from the PLC. In the event of a power failure, this enables the persistent data to be saved and/or a quick shutdown to be executed, depending on the selected mode. The default input values of the FB_S_UPS should be retained. The 1-second UPS does not have sufficient capacity for bridging power failures. Only the Compact Flash card can be used for data storage, in view of the fact that the UPS capacity is not sufficient for operating a hard disk. The 1-second UPS can be used only for a few seconds in the event of a power failure in order, to save persistent data. The data must be saved in the fast “persistent mode” “SPDM_2PASS”, even though this can lead to real-time violations. Make sure you configure adequate router memory for saving the persistent data. Irrespective of the mode and irrespective of whether data were saved or the quick shutdown was executed, the 1-second UPS switches off the mainboard after the discharging of the capacitors. NOTE Loss of data If other applications or the PLC keep further files open or write to them, file errors may occur if the 1-second UPS switches off the controller. Function block modes A Quick Shutdown is performed automatically in the e SUPS_Wr Persist Data_Shutdown mode [} 22] (standard setting) after the storage of the persistent data. In the e SUPS_Wr Persist Data_No Shutdown mode [} 22] only the persistent data are saved, no Quick Shutdown is performed. In e SUPS_Immediate Shutdown mode [} 22] a quick shutdown is executed immediately, without saving data. In the e SUPS_Check Power Status mode [} 22] only a check is performed as to whether a power failure has occurred. If this is the case, the function block only switches back to the Power OK state after the expiry of t Recover Time (10s). Application under Windows Embedded Standard 7P To protect Windows XP Embedded files on devices with 1-second UPS, either the Enhanced Write Filter (EWF) or the File Based Write Filter (FBWF) must be enabled. • If the EWF is used, the Twin CAT\Boot folder must be located on an unprotected partition (see in the registry: HKEY_LOCAL_MACHINE\SOFTWARE\Beckhoff\Twin CAT\System\Boot Prj Path). • If the FBWF is used, must the Twin CAT\Boot folder must be excluded from the protection (see Beckhoff FBWF Manager, Exclusion Settings). Beckhoff EBWF Manager: 12 Version: 1.5.2 TE1000
## Page 13

Function blocks Inputs VAR_INPUT s Net ID : T_Ams Net Id:= ''; (* '' = local netid *) i PLCPort : UINT; (* PLC Runtime System for writing persistent data *) i UPSPort : UINT := 16#4A8; (* Port for reading Power State of UPS, dafault 16#4A8 *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* ADS Timeout *) e Ups Mode : E_S_UPS_Mode := e SUPS_Wr Persist Data_Shutdown; (* UPS mode (w/ wo writing persistent data, w/wo shutdown) *) e Persistent Mode : E_Persistent Mode := SPDM_2PASS; (* mode for writing persistent data *) t Recover Time : TIME := T#10s; (* ON time to recover from short power failure in mode e SUPS_Wr Persist Data_No Shutdown/e SUPS_Check Power Status *) END_VAR Name Type Description s Net ID T_Ams Net Id Ams Net Id of the controller i PLCPort UINT Port number of the PLC runtime system (851 for the first PLC runtime system, 852 for the second PLC runtime system, etc.). If you do not specify a port number, the function block then automatically determines the port of the PLC runtime system. i UPSPort UINT Port number through which the UPS status is read. The default value is 16#4A8. t Timeout TIME Timeout for writing the persistent data or the quick shutdown. e Ups Mode E_S_UPS_Mode [} 22] Defines whether persistent data are to be written and whether a quick shutdown is to be executed. The default value is e SUPS_Wr Persist Data_Shutdown, i.e. a quick shutdown is executed automatically once the persistent data have been saved. e Persistent Mode E_Persistent Mode Mode for writing the persistent data. Default value is SPDM_2PASS. t Recover Time TIME Time after which the UPS returns to the Power OK state in UPS modes without quick shutdown. The t Recover Time must be greater than the maximum charging time for the UPS, otherwise the UPS may discharge too much in the event of short, consecutive power failures, which could result in its charge being insufficient for storing the persistent data. TE1000 Version: 1.5.2 13
## Page 14

Function blocks Outputs VAR_OUTPUT b Power Fail Detect : BOOL; (* TRUE while powerfailure is detected *) e State : E_S_UPS_State := e SUPS_Power OK; (* current ups state *) END_VAR Name Type Description b Power Fail Detect BOOL TRUE during power failure. FALSE if the supply voltage is present. e State E_S_UPS_State [} 22] Internal state of the function block Requirements Development environ- Target platform Hardware PLC libraries to include ment Twin CAT v3.1 B4016 CX50x0 1-second UPS Tc2_SUPS 4.3 CX51x0 4.3.1 FB_S_UPS_CX51x0 The function block FB_S_UPS_CX51x0 can be used on CX51x0 devices with 1-second UPS, in order to control the 1-second UPS from the PLC. In the event of a power failure, this enables the persistent data to be saved and/or a quick shutdown to be executed, depending on the selected mode. The default input values of the FB_S_UPS_CX51x0 should be retained. The 1-second UPS does not have sufficient capacity for bridging power failures. Only the Compact Flash card can be used for data storage, in view of the fact that the UPS capacity is not sufficient for operating a hard disk. The 1-second UPS can be used only for a few seconds in the event of a power failure in order, to save persistent data. The data must be saved in the fast “persistent mode” “SPDM_2PASS”, even though this can lead to real-time violations. Make sure you configure adequate router memory for saving the persistent data. Irrespective of the mode and irrespective of whether data were saved or the quick shutdown was executed, the 1-second UPS switches off the mainboard after the discharging of the capacitors. NOTE Loss of data If other applications or the PLC keep further files open or write to them, file errors may occur if the 1-second UPS switches off the controller. Function block modes A Quick Shutdown is performed automatically in the e SUPS_Wr Persist Data_Shutdown mode [} 22] (standard setting) after the storage of the persistent data. In the e SUPS_Wr Persist Data_No Shutdown mode [} 22] only the persistent data are saved, no Quick Shutdown is performed. 14 Version: 1.5.2 TE1000
## Page 15

Function blocks In e SUPS_Immediate Shutdown mode [} 22] a quick shutdown is executed immediately, without saving data. In the e SUPS_Check Power Status mode [} 22] only a check is performed as to whether a power failure has occurred. If this is the case, the function block only switches back to the Power OK state after the expiry of t Recover Time (10s). Application under Windows Embedded Standard 7P To protect Windows XP Embedded files on devices with 1-second UPS, either the Enhanced Write Filter (EWF) or the File Based Write Filter (FBWF) must be enabled. • If the EWF is used, the Twin CAT\Boot folder must be located on an unprotected partition (see in the registry: HKEY_LOCAL_MACHINE\SOFTWARE\Beckhoff\Twin CAT\System\Boot Prj Path). • If the FBWF is used, must the Twin CAT\Boot folder must be excluded from the protection (see Beckhoff FBWF Manager, Exclusion Settings). Beckhoff EBWF Manager: Inputs VAR_INPUT s Net ID : T_Ams Net Id:= ''; (* '' = local netid *) i PLCPort : UINT; (* PLC Runtime System for writing persistent data *) i UPSPort : UINT := 16#588; (* Port for reading Power State of UPS *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* ADS Timeout *) e Ups Mode : E_S_UPS_Mode := e SUPS_Wr Persist Data_Shutdown; (* UPS mode (w/ wo writing persistent data, w/wo shutdown) *) e Persistent Mode : E_Persistent Mode := SPDM_2PASS; (* mode for writing persistent data *) t Recover Time : TIME := T#10s; (* ON time to recover from short power failure in mode e SUPS_Wr Persist Data_No Shutdown/e SUPS_Check Power Status *) END_VAR TE1000 Version: 1.5.2 15
## Page 16

Function blocks Name Type Description s Net ID T_Ams Net Id Ams Net ID of the controller i PLCPort UINT Port number of the PLC runtime system (851 for the first PLC runtime system, 852 for the second PLC runtime system, etc.). If you do not specify a port number, the function block then automatically determines the port of the PLC runtime system. i UPSPort UINT Port number through which the UPS status is read. The default value is 16#588 t Timeout TIME Timeout for writing the persistent data or the quick shutdown e Ups Mode E_S_UPS_Mode [} 22] The e Ups Mode defines whether persistent data are to be written and whether a quick shutdown is to be performed. The default value is e SUPS_Wr Persist Data_Shutdown, i.e. a quick shutdown is executed automatically once the persistent data have been saved. e Persistent Mode E_Persistent Mode Mode for writing the persistent data. Default value is SPDM_2PASS. t Recover Time TIME Time after which the UPS returns to the Power OK state in UPS modes without quick shutdown. The t Recover Time must be greater than the maximum charging time for the UPS, otherwise the UPS may discharge too much in the event of short, consecutive power failures, which could result in its charge being insufficient for storing the persistent data. Outputs VAR_OUTPUT b Power Fail Detect : BOOL; (* TRUE while powerfailure is detected *) e State : E_S_UPS_State := e SUPS_Power OK; (* current ups state *) END_VAR Name Type Description b Power Fail Detect BOOL TRUE during power failure. FALSE if the supply voltage is present. e State E_S_UPS_State [} 22] Internal state of the function block Requirements Development environ- Target platform Hardware PLC libraries to include ment Twin CAT v3.1 B4016 CX51x0 1-second UPS Tc2_SUPS 4.4 CX9020-U900 4.4.1 FB_S_UPS_CX9020_U900 16 Version: 1.5.2 TE1000
## Page 17

Function blocks The function block FB_S_UPS_CX9020_U900 can be used on CX9020-U900 devices with 1-second UPS, in order to control the 1-second UPS from the PLC. In the event of a power failure, this enables the persistent data to be saved and/or a quick shutdown to be executed, depending on the selected mode. The default input values of the FB_S_UPS_CX9020_U900 should be retained. The 1-second UPS does not have sufficient capacity for bridging power failures. Only the Compact Flash card can be used for data storage, in view of the fact that the UPS capacity is not sufficient for operating a hard disk. The 1-second UPS can be used only for a few seconds in the event of a power failure in order, to save persistent data. The data must be saved in the fast “persistent mode” “SPDM_2PASS”, even though this can lead to real-time violations. Make sure you configure adequate router memory for saving the persistent data. Irrespective of the mode and irrespective of whether data were saved or the quick shutdown was executed, the 1-second UPS switches off the mainboard after the discharging of the capacitors. NOTE Loss of data If other applications or the PLC keep further files open or write to them, file errors may occur if the 1-second UPS switches off the controller. Function block modes A Quick Shutdown is performed automatically in the e SUPS_Wr Persist Data_Shutdown mode [} 22] (standard setting) after the storage of the persistent data. In the e SUPS_Wr Persist Data_No Shutdown mode [} 22] only the persistent data are saved, no Quick Shutdown is performed. In e SUPS_Immediate Shutdown mode [} 22] a quick shutdown is executed immediately, without saving data. In the e SUPS_Check Power Status mode [} 22] only a check is performed as to whether a power failure has occurred. If this is the case, the function block only switches back to the Power OK state after the expiry of t Recover Time (10s). Inputs VAR_INPUT s Net ID : T_Ams Net Id:= ''; (* '' = local netid *) i PLCPort : UINT; (* PLC Runtime System for writing persistent data *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* ADS Timeout *) e Ups Mode : E_S_UPS_Mode := e SUPS_Wr Persist Data_Shutdown; (* UPS mode (w/ wo writing persistent data, w/wo shutdown) *) e Persistent Mode : E_Persistent Mode := SPDM_2PASS; (* mode for writing persistent data *) t Recover Time : TIME := T#10s; (* ON time to recover from short power failure in mode e SUPS_Wr Persist Data_No Shutdown/e SUPS_Check Power Status *) END_VAR TE1000 Version: 1.5.2 17
## Page 18

Function blocks Name Type Description s Net ID T_Ams Net Id Ams Net ID of the controller i PLCPort UINT Port number of the PLC runtime system (851 for the first PLC runtime system, 852 for the second PLC runtime system, etc.). If you do not specify a port number, the function block then automatically determines the port of the PLC runtime system. t Timeout TIME Timeout for writing the persistent data or the quick shutdown e Ups Mode E_S_UPS_Mode [} 22] Defines whether persistent data are to be written and whether a quick shutdown is to be executed. The default value is e SUPS_Wr Persist Data_Shutdown, i.e. a quick shutdown is executed automatically once the persistent data have been saved. e Persistent Mode E_Persistent Mode Mode for writing the persistent data. Default value is SPDM_2PASS. t Recover Time TIME Time after which the UPS reverts to the Power OK status in the event of UPS modes without shutdown. t Recover Time must be somewhat longer than the maximum holding time of the UPS in order to ensure that the capacitors are fully charged. Outputs VAR_OUTPUT b Power Fail Detect : BOOL; (* TRUE while powerfailure is detected *) e State : E_S_UPS_State := e SUPS_Power OK; (* current ups state *) END_VAR Name Type Description b Power Fail Detect BOOL TRUE during power failure. FALSE if the supply voltage is present. e State E_S_UPS_State [} 22] Internal state of the function block Requirements Development environ- Target platform Hardware PLC libraries to include ment Twin CAT v3.1 B4016 CX9020-U900 1-second UPS Tc2_SUPS 4.5 BAPI 4.5.1 FB_S_UPS_BAPI The function block FB_S_UPS_BAPI can be used on devices with 1-second UPS and with BIOS-API from version v1.15, in order to control the 1-second UPS from the PLC. When the function block is first called, the data for accessing the 1-second UPS are determined via BIOS- API. This process takes several cycles. This is followed by cyclic testing for power failure. When the persistent data are written next, the access data for the PLC are saved persistently, so that during subsequent boot operations the check for power failures can take place immediately after the PLC start. 18 Version: 1.5.2 TE1000
## Page 19

Function blocks In the event of a power failure the charge state of the 1-second UPS is checked every 50 ms, every 200 ms if voltage is present and the capacity is less than 90%, and every second if voltage is present and the capacity is more than 90%. This also takes place via BIOS-API access. In the event of a power failure the function block FB_S_UPS_BAPI can be used to save the persistent data and/or execute a quick shutdown, depending on the selected mode. The default input values of the FB_S_UPS_BAPI should be retained. The 1-second UPS does not have sufficient capacity for bridging power failures. Only the Compact Flash/ CFast card/Micro SD can be used for data storage, in view of the fact that the UPS capacity is not sufficient for operating a hard disk. The 1-second UPS can be used only for a few seconds in the event of a power failure in order, to save persistent data. The data must be saved in the fast “persistent mode” “SPDM_2PASS”, even though this can lead to real-time violations. Make sure you configure adequate router memory for saving the persistent data. Irrespective of the mode and irrespective of whether data were saved or the quick shutdown was executed, the 1-second UPS switches off the mainboard after the discharging of the capacitors. NOTE Loss of data If other applications or the PLC keep further files open or write to them, file errors may occur if the 1-second UPS switches off the controller. Function block modes A Quick Shutdown is performed automatically in the e SUPS_Wr Persist Data_Shutdown mode [} 22] (standard setting) after the storage of the persistent data. In the e SUPS_Wr Persist Data_No Shutdown mode [} 22] only the persistent data are saved, no Quick Shutdown is performed. In e SUPS_Immediate Shutdown mode [} 22] a quick shutdown is executed immediately, without saving data. In the e SUPS_Check Power Status mode [} 22] only a check is performed as to whether a power failure has occurred. If this is the case, the function block only switches back to the Power OK state after the expiry of t Recover Time (10s). Inputs VAR_INPUT s Net ID : T_Ams Net Id:= ''; (* '' = local netid *) i PLCPort : UINT; (* PLC Runtime System for writing persistent data *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* ADS Timeout *) e Ups Mode : E_S_UPS_Mode := e SUPS_Wr Persist Data_Shutdown; (* UPS mode (w/ wo writing persistent data, w/wo shutdown) *) e Persistent Mode : E_Persistent Mode := SPDM_2PASS; (* mode for writing persistent data *) t Recover Time : TIME := T#10s; (* ON time to recover from short power failure in mode e SUPS_Wr Persist Data_No Shutdown/e SUPS_Check Power Status *) END_VAR TE1000 Version: 1.5.2 19
## Page 20

Function blocks Name Type Description s Net ID T_Ams Net Id Ams Net ID of the controller i PLCPort UINT Port number of the PLC runtime system (851 for the first PLC runtime system, 852 for the second PLC runtime system, etc.). If you do not specify a port number, the function block then automatically determines the port of the PLC runtime system. t Timeout TIME Timeout for writing the persistent data or the quick shutdown e Ups Mode E_S_UPS_Mode [} 22] Defines whether persistent data are to be written and whether a quick shutdown is to be executed. The default value is e SUPS_Wr Persist Data_Shutdown, i.e. a quick shutdown is executed automatically once the persistent data have been saved. e Persistent Mode E_Persistent Mode Mode for writing the persistent data. Default value is SPDM_2PASS. t Recover Time TIME Time after which the UPS reverts to the Power OK status in the event of UPS modes without shutdown. t Recover Time must be somewhat longer than the maximum holding time of the UPS in order to ensure that the capacitors are fully charged. Outputs VAR_OUTPUT b Power Fail Detect : BOOL; (* TRUE while powerfailure is detected *) e State : E_S_UPS_State; (* current ups state *) n Capacity : BYTE; (* actual capacity of UPS *) b Busy : BOOL; (* TRUE: function block is busy *) b Error : BOOL; (* FALSE: function block has error *) n Err ID : UDINT; (* FB error ID *) END_VAR Name Type Description b Power Fail Detect BOOL TRUE during power failure. FALSE if the supply voltage is present. e State E_S_UPS_State [} 22] Internal state of the function block n Capacity BYTE Current charge state of the capacitors in percent (0..100%) b Busy BOOL TRUE, as long as the function block is active. b Error BOOL FALSE if an error has occurred. n Err ID UDINT Error number Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1 B4020.32 Platforms that support the BIOS Tc2_SUPS API from v1.15 4.6 FB_NT_Quick Shutdown NOTE Loss of data The function block FB_NT_Quick Shutdown is used internally by the various FB_S_UPS blocks. It must not be used independently, because this could result in data loss! 20 Version: 1.5.2 TE1000
## Page 21

Function blocks The function block FB_NT_Quick Shutdown can be used to trigger an immediate reboot, without stopping Twin CAT or the Windows operating system. Inputs VAR_INPUT NETID : T_Ams Net Id; START : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description NETID T_Ams Net Id Ams Net ID of the controller START BOOL Rising edge leads to immediate reboot of the controller. TMOUT TIME Timeout time Outputs VAR_OUTPUT BUSY : BOOL; ERR : BOOL; ERRID : UDINT; END_VAR Name Type Description BUSY BOOL Quick shutdown is executed. ERR BOOL Becomes TRUE, as soon as an error occurs. ERRID UDINT Supplies the error number when the ERR output is set. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.0.0 PC or CX (x86), Tc2_SUPS (Version: 3.3.3.0) 1-Second UPS TE1000 Version: 1.5.2 21
## Page 22

Data types 5 Data types 5.1 E_S_UPS_Mode Data type Description e SUPS_Wr Persist Data_Sh Write persistent data and then quick shutdown. utdown e SUPS_Wr Persist Data_No Only write the persistent data (no quick shutdown). Shutdown e SUPS_Immediate Shutdow Quick shutdown only (no writing of persistent data) n e SUPS_Check Power Status Only determine status (does not write persistent data nor perform quick shutdown). 5.2 E_S_UPS_State Data type Description e SUPS_Power OK In all modes: supply voltage is OK. e SUPS_Power Failure In all modes: supply voltage faulty (applied for one cycle only) e SUPS_Write Persistent Dat In e SUPS_Wr Persist Data_Shutdown mode: writing is active for persistent a data. In e SUPS_Wr Persist Data_No Shutdown mode: writing is active for persistent data. e SUPS_Quick Shutdown In e SUPS_Wr Persist Data_Shutdown mode: quick shutdown is active. In e SUPS_Immediate Shutdown: quick shutdown is active. e SUPS_Wait For Recover In e SUPS_Wr Persist Data_No Shutdown mode: wait for voltage recovery. In e SUPS_Check Power Status mode: wait for voltage recovery. e SUPS_Wait For Power OFF In e SUPS_Wr Persist Data_Shutdown mode: wait for the UPS to perform shut down. In e SUPS_Immediate Shutdown mode: wait for the UPS to perform shutdown. 22 Version: 1.5.2 TE1000
## Page 23

Global constants 6 Global constants 6.1 Library version All libraries have a certain version. The version is indicated in the PLC library repository, for example. A global constant contains the information about the library version: Global_Version VAR_GLOBAL CONSTANT st Lib Version_Tc2_SUPS : ST_Lib Version; END_VAR Name Type Description st Lib Version_Tc2 ST_Lib Version Version information of the Tc2_SUPS library (type: _SUPS ST_Lib Version) To check whether the version you have is the version you need, use the function F_Cmp Lib Version (defined in the Tc2_System library). All other options for comparing library versions, which you may know from Twin CAT 2, are outdated. TE1000 Version: 1.5.2 23
## Page 25

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
