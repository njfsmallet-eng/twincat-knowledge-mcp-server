---
title: "TF8040_TC3_Building_Automation_EN"
product: "TF8040"
category: "Building_Automation"
tags: ["AUTOMATION", "BUILDING"]
language: "EN"
document_type: "Manual"
version: "1.14.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF8040_TC3_Building_Automation_EN.pdf"
release_date: "2025-05-26"
---
Manual | EN TF8040 Twin CAT 3 | Building Automation 2025-05-26 | Version: 1.14.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 2.1 Target groups.................................................................................................................................... 8 2.2 Requirement profile........................................................................................................................... 8 2.3 Installation......................................................................................................................................... 8 2.4 Licensing......................................................................................................................................... 11 2.5 System requirements...................................................................................................................... 13 2.6 Energy efficiency............................................................................................................................. 14 3 Concepts.................................................................................................................................................. 15 3.1 User roles........................................................................................................................................ 15 3.2 Communication............................................................................................................................... 16 3.3 System structure............................................................................................................................. 17 3.4 ADS communication within the templates....................................................................................... 18 3.5 Room automation............................................................................................................................ 21 3.5.1 Shell model...................................................................................................................... 23 3.5.2 Room functions................................................................................................................ 23 3.6 Base framework.............................................................................................................................. 30 3.6.1 Objects............................................................................................................................. 32 3.6.2 Project structure............................................................................................................... 38 3.6.3 DPAD............................................................................................................................... 42 3.7 PLC................................................................................................................................................. 52 3.7.1 Control and regulation mechanisms................................................................................. 52 3.7.2 Fast task for serial communication................................................................................... 54 3.8 HMI.................................................................................................................................................. 54 3.8.1 Generic............................................................................................................................. 54 3.8.2 Trending........................................................................................................................... 55 3.8.3 Feedback......................................................................................................................... 60 3.8.4 Ba Object.......................................................................................................................... 60 3.8.5 Ba Template...................................................................................................................... 61 3.8.6 Ba Interface....................................................................................................................... 62 4 Tutorials................................................................................................................................................... 64 4.1 PLC................................................................................................................................................. 64 4.1.1 Starting a project.............................................................................................................. 64 4.2 HMI.................................................................................................................................................. 71 4.2.1 Starting a project.............................................................................................................. 71 4.2.2 Generic HMI..................................................................................................................... 77 5 Examples................................................................................................................................................. 87 5.1 Concept examples.......................................................................................................................... 88 5.1.1 HMI................................................................................................................................... 88 5.2 Template samples........................................................................................................................... 94 TF8040 Version: 1.14.0 3
## Page 4

Table of contents 5.2.1 HMI................................................................................................................................... 94 5.2.2 PLC.................................................................................................................................. 96 6 Programming........................................................................................................................................... 98 6.1 PLC................................................................................................................................................. 98 6.1.1 General............................................................................................................................ 98 6.1.2 Libraries........................................................................................................................... 98 6.1.3 PLC project templates.................................................................................................... 693 6.1.4 Templates...................................................................................................................... 696 6.2 HMI.............................................................................................................................................. 1120 6.2.1 Tc Hmi Ba...................................................................................................................... 1120 7 Tools..................................................................................................................................................... 1285 7.1 Building Automation Site Explorer............................................................................................... 1285 7.2 Symbol Explorer.......................................................................................................................... 1303 7.2.1 Introduction.................................................................................................................. 1303 7.2.2 Definitions.................................................................................................................... 1303 7.2.3 User interface............................................................................................................... 1303 7.2.4 Getting started.............................................................................................................. 1316 7.2.5 Filter, search and replace............................................................................................. 1322 7.2.6 Command Line Interface.............................................................................................. 1326 7.2.7 Workflows..................................................................................................................... 1327 7.2.8 Extensions.................................................................................................................... 1339 7.2.9 Examples of regular expressions................................................................................. 1344 7.3 Template Repository................................................................................................................... 1344 8 Appendix.............................................................................................................................................. 1351 8.1 Third-party components.............................................................................................................. 1351 8.2 Support and Service.................................................................................................................... 1351 4 Version: 1.14.0 TF8040
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS®, and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. TF8040 Version: 1.14.0 5
## Page 6

Foreword 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.14.0 TF8040
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF8040 Version: 1.14.0 7
## Page 8

Overview 2 Overview In order to meet the high demands of building automation, such as comfort, energy efficiency, low investment and operating costs, and a fast return on investment, it is essential to have a consistent, coordinated control system for the automation of all technical systems. With Twin CAT 3 Building Automation, Beckhoff has developed a software product that reduces engineering time and integrates all essential functions for all technical systems of modern building automation. Extensive software libraries and tools continue the idea of the modular Beckhoff automation toolkit at the software level. The new software suite essentially comprises three basic functions: Twin CAT 3 BA PLC Libraries [} 98]: Basic functions for all technical systems. Twin CAT 3 BA PLC Templates [} 696]: Function templates for all technical systems. Twin CAT 3 BA Tools [} 1285]: Software tools to optimize the implementation of building automation projects in terms of data processing, commissioning, adjustment and maintenance. By using the function Twin CAT 3 Building Automation, all PLC programs, including the central heating plant, the air conditioning plant and the room automation functions can be programmed with Twin CAT PLC Control and are then available as function blocks within the building automation libraries. The PID controllers, the sequence controllers and the sequence linkers required for the Twin CAT 3 Building Automation library (Tc3_BA) can be found in the pre-installed library Tc3_BA_Common. The functions and controllers required for the Twin CAT 3 Building Automation library (Tc3_BA2) can be found in the pre-installed library Tc3_BA2_Common. 2.1 Target groups This software is intended for building automation system partners of Beckhoff Automation Gmb H & Co. KG. The system partners operate in the field of building automation and are concerned with the installation, commissioning, expansion, maintenance and service of measurement, control and regulating systems for the technical equipment of buildings. 2.2 Requirement profile The user requires basic knowledge of the following. • Twin CAT 3 • Programming knowledge in IEC61131-3 • PC and network knowledge • Structure and properties of the Beckhoff Embedded PC and its Bus Terminal system • Knowledge of heating, ventilation, air conditioning and sanitary systems as well as room automation • Relevant safety regulations for building technical equipment 2.3 Installation The following section describes how to install the Twin CAT 3 Function for Windows-based operating systems. ü The Twin CAT 3 Function setup file was downloaded from the Beckhoff website. 1. Run the setup file as administrator. To do this, select the command Run as administrator in the context menu of the file. 8 Version: 1.14.0 TF8040
## Page 9

Overview ð The installation dialog opens. 2. Accept the end user licensing agreement and click Next. 3. Enter your user data. TF8040 Version: 1.14.0 9
## Page 10

Overview 4. If you want to install the full version of the Twin CAT 3 Function, select Complete as installation type. If you want to install the Twin CAT 3 Function components separately, select Custom. 5. Select Next, then Install to start the installation. ð A dialog box informs you that the Twin CAT system must be stopped to proceed with the installation. 10 Version: 1.14.0 TF8040
## Page 11

Overview 6. Confirm the dialog with Yes. 7. Select Finish to exit the setup. ð The Twin CAT 3 Function has been successfully installed. 2.4 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. TF8040 Version: 1.14.0 11
## Page 12

Overview 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 12 Version: 1.14.0 TF8040
## Page 13

Overview 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. 2.5 System requirements Requirements The TF8040 consists of several software components with different system requirements. PLC libraries The PLC libraries contained in TF8040 require Twin CAT version >= 3.1.4024.35 and run on the following operating systems: • Windows 10 • Windows CE A TF8020 license is required to use the PLC libraries. Tools The tools included in the TF8040 run on the Windows 10 operating system. TF8040 Version: 1.14.0 13
## Page 14

Overview Site Explorer also requires the . NET Desktop Runtime > v6.0. Tc Hmi Ba Here you will find the system requirements for Tc Hmi Ba [} 1121]. 2.6 Energy efficiency The influence of building automation and building management is described in DIN EN ISO 52120-1:2019-12. This DIN EN ISO 52120 standard contains a structured list of building automation and technical building management functions that have an impact on the energy efficiency of buildings. The functions of DIN EN ISO 52120 are categorized and listed in a structured manner according to technical systems and so-called Building Automation and Control (BAC) functions. A factor-based method makes it easy to estimate the impact of these BA functions on the overall energy efficiency of a building. The application of this simplified procedure shows that energy savings of 30% are possible using the methods listed therein. Twin CAT 3 Building Automation offers functions as described in DIN EN ISO 52120. This makes it possible to estimate the potential energy savings through the use of plant and room automation with Twin CAT 3 Building Automation. Templates for plant and room functions in TF8040 facilitate the planning, execution and subsequent operation of buildings. An essential prerequisite for the implementation of an energy efficient and sustainable building automation system is the integration of the building automation system. Plant and room automation with all its technical systems must be integrated into one system. The templates from TF8040 Twin CAT 3 Building Automation implement the energy efficiency functions described in the DIN EN ISO 52120 standard. 14 Version: 1.14.0 TF8040
## Page 15

Concepts 3 Concepts This chapter contains introductory information to help you get started with Twin CAT 3 Building Automation. Concepts serve as drafts and suggestions for project planning of a building automation system with Twin CAT 3 Building Automation. 3.1 User roles The base framework of the PLC does not know any users, but only roles. Therefore, the further description deals with the meaning of the roles. An application (e.g. Tc Hmi Ba [} 1120]) defines users and then assigns them a corresponding role. According to the role of a logged-in user, functions are made available in the application or not. Roles Different access rights are provided for different users: Role Description Guest Lowest access permissions. Users cannot change parameters and can only read current values that are in the Tc3_XBA [} 99] under VAR_INPUT CONSTANT PERSISTENT. Recommended for standard accesses without user login (e.g. generally accessible control panels). Basic Restricted access permissions. Users can view rudimentary parameters and hardly change any values. Recommended for operators with little knowledge of the system. Advanced Extended access rights. Users have insight into various parameters and e.g. authorization to change setpoints or timer programs. Recommended for operators with basic plant knowledge and instruction to supervise these plants. Expert Full access rights. Recommended for commissioning and for service personnel, as more in-depth interventions (e.g. adjustment of controller parameters) are also possible. Internal For Beckhoff support only. The user's access area is evaluated at different points in the application to enable or hide certain functions. Adjustment of access rights from the PLC It is possible to define access rights from the PLC. However, this only works initially, i.e. not at runtime, and then refers to all objects that have this property. To do this, an instance of FB_BA_Param [} 159] is created in a suitable part of the program, preferably in MAIN, and pre-initialized with the corresponding write and read rights. The initialization is sufficient - there is no further call in the actual program part. Sample: In the following sample, the read and write rights are to be changed for two parameters: • Acknowledge (b Acknowledge Rm): Read from Basic role, write from Expert role. • Default Value (b Default Value, f Default Value, n Default Value): Read from Internal role, write from Advanced role. TF8040 Version: 1.14.0 15
## Page 16

Concepts This adjustment requires the instantiation of a FB_BA_Param [} 159], here called Parameters, which is structured as follows: Parameters : FB_BA_Param := (Def Read Access := F_BA_Parameter Roles Builder() . Set(E_BA_Parameter.e Acknowledge Rm, E_BA_Role.e Basic) . Set(E_BA_Parameter.e Default Value, E_BA_Role.e Internal) . Build(), Def Write Access := F_BA_Parameter Roles Builder() . Set(E_BA_Parameter.e Acknowledge Rm, E_BA_Role.e Expert) . Set(E_BA_Parameter.e Default Value, E_BA_Role.e Advanced) . Build()); The Def Read Access and Def Write Access properties each represent an array of the various parameters with the associated roles as minimum access and are only used to change the roles, which are, however, already predefined. The Set methods change the minimum access role (E_BA_Role [} 99]) for a specific parameter (E_BA_Parameter [} 108]). A Set method must be added for each parameter whose access right is to be changed. The parameterization of the properties is completed by calling the Build method. This applies to both the Def Read Access read access property and the Def Write Access write access property. The above implementation changes the read and write access of all objects that have the properties b Acknowledge Rm and Default Value (b Default Value, f Default Value, n Default Value). It is also possible to change only the read or only the write access; the change does not have to be made in pairs. Using the example of an AV object, the change in the Site Explorer is as follows: 3.2 Communication The communication protocols OPC UA; Modbus TCP; MQTT; and ADS are all used together to transfer information relating to the values of symbols and structures of the PLC. In contrast to BACnet, they do not describe any standardized communication objects, meaning that the structure of the data in many projects is very specific and individual. Independent of BACnet, Twin CAT TF8040 is also very helpful for such projects, as the Tc3_BA2 [} 267] basic library contains a large number of function blocks that are required for a building automation project regardless of the communication protocol used. The BACnet communication protocol has become the global standard for building automation. In contrast to the other protocols, BACnet provides a very detailed standard with its objects and services. 16 Version: 1.14.0 TF8040
## Page 17

Concepts Twin CAT Building Automation makes use of the object-oriented structure of BACnet. The library Tc3_XBA [} 99] contains a framework called the base framework [} 30]. It is used to map a project structure [} 38] and numerous other generic functions. The Site Server within the PLC organizes the ADS communication to the Twin CAT HMI. The Site API is the counterpart of the Site Sever and realizes the generic representations in the HMI. The Site Explorer service tool also communicates with the automation stations using the Site API via ADS. 3.3 System structure The Beckhoff Industrial PCs meet all requirements with regard to the automation of heating, ventilation and air conditioning as well as room automation [} 21]. The large portfolio of Beckhoff Industrial PCs results in excellent scalability of the building automation system. The high industrial quality standard guarantees high system availability and investment security. TF8040 Version: 1.14.0 17
## Page 18

Concepts All PCs are programmed with Twin CAT Engineering TE1000 regardless of their use. By using the Twin CAT functions TF8020 BACnet and TF8040 Building Automation, all industrial PCs in the Beckhoff portfolio become a powerful automation station for building automation. (The Twin CAT function TF8040 is currently not available for the small controllers of the CX7xxx series). The choice of processor allows the automation station to be adapted to the requirements of the automation station to be configured with fine granularity in terms of its computing power. The design of the industrial PC is also freely selectable. The embedded PCs from the CX series are ideal for this purpose. Bus terminals (K-bus) or Ether CAT Terminals (E-bus) can be attached on the right-hand side of the embedded PC. Depending on the version of the embedded PC, it can be equipped with a DVI-I interface. A control panel can be connected if required. The industrial PC can be used as an automation station for a control cabinet with local operation via a touch panel. The function TF2000 HMI server must then be installed on the IPC. Very powerful ultra-compact PCs are available for higher-level tasks within the automation system, such as the MBE (management and operating unit). The Twin CAT HMI can thus act not only as a local control of an IPC, but also as a web HMI for a large number of automation stations. Whether it is plant or room automation, the same hardware and software is used in all applications. Interoperability of all building automation components is therefore ensured. 3.4 ADS communication within the templates Twin CAT Building Automation offers a simple concept for data distribution within a building automation network. Within this concept, the Building Controller serves as a central data distributor. It should consist of a powerful IPC. 18 Version: 1.14.0 TF8040
## Page 19

Concepts The following data is recorded, calculated and provided within the Building Controller. Weather data • Outside temperature • Precipitation report • Dew point temperature • Air pressure • Air humidity • Brightness • Global radiation • Wind speed • Wind direction global events • Burglary • Fire global setting parameters • Frost setpoint • Frost protection limit value • damped value of the outside temperature • heating enable of the unattenuated outside temperature • heating enable of the attenuated outside temperature global time schedule with the active energy levels • Protection or Economy or Pre Comfort or Comfort Setpoints of the energy levels • Protection Heating • Economy Heating • Pre Comfort Heating • Comfort Heating TF8040 Version: 1.14.0 19
## Page 20

Concepts • Protection Cooling • Economy Cooling • Pre Comfort Cooling • Comfort Cooling Operation modes • Default (standard) • Night watchman tour • Cleaning mode Sun protection for the entire building • Positioning telegram resulting from the user functions: fire, burglary, icing, ◦ Position ◦ Angle ◦ Priority • Enabling the thermal automatic (global radiation-dependent) • Enabling the twilight automatic (depending on outside light) • Central reset of manual operation of all blind actuators Sun protection selective per facade • Positioning telegram resulting from the user functions: ◦ Position ◦ Storm protection (depending on wind direction) ◦ Maintenance ◦ Thermal automatic (global) ◦ Position or slat angle with active sun protection ◦ Enabling the sun protection dependent on outside light and sun position In the building controller, all data-providing templates write their data to the Site GVL [} 1116]. The data is transferred from this data pool of the Site GVL [} 1116] to the clients via ADS. The data is distributed according to technical system. Building automation in general: Weather data, global events and global setting parameters for HVAC systems are generated in the function block FB_BA_Building Automation Server and written to the Site GVL [} 1116]. The function block FB_BA_Ads Com Server publishes this data via ADS. In a client, this data is in turn received via a Subscriber and written into the local Site GVL [} 1116] of the automation station. Doors,Gates,Windows,Sun protection Facade data and global sun protection data are generated in the function block FB_BA_DGWSPServer and written to the Site GVL [} 1116]. The function block FB_BA_Ads Com Server_DGWS publishes this data via ADS. In a client, this data is in turn received via a Subscriber and written into the local Site GVL [} 1116] of the automation station. Room automation Room automation data, e.g. global room temperature setpoints and energy levels, are generated in the function block FB_BA_Room Automation Server and written to the Site GVL [} 1116]. 20 Version: 1.14.0 TF8040
## Page 21

Concepts The function block FB_BA_Room Automation Client receives this data and writes it to the local Site GVL [} 1116] of the automation station. 3.5 Room automation Room automation is integrated into the automation level. The automation stations for room automation in Twin CAT Building Automation also consist of Beckhoff IPCs. The choice and number of Beckhoff IPCs depends heavily on the building automation requirements. Due to the extraordinarily high computing power of the IPCs, it is possible to automate very large areas up to an entire floor with a single IPC. Sensors and actuators at field level can be recorded using remote fieldbus couplers. This reduces the cabling effort and also the fire load. Subsystems such as DALI for illumination can also be integrated into the fieldbus couplers and distributed throughout the floor. TF8040 Version: 1.14.0 21
## Page 22

Concepts If necessary, a floor can be divided into several areas. The areas are then each controlled by a smaller, separate IPC. 22 Version: 1.14.0 TF8040
## Page 23

Concepts 3.5.1 Shell model The VDI 3813 shell model is used to explain room automation in TF8040. The shell model describes levels within which the room functions [} 23], consisting of sensor, user or actuator functions, are used. The user and sensor functions of one shell affect the actuators of all enclosed shells. Thus, the position of a user function in the shell model determines the subset of actuators on which this user function acts. Example: A schedule for central control of all the lights on a floor, e.g. for cleaning an office, is positioned in the Floor shell. If the cleaning operation has to be planned separately in the sub-areas of the floor, for example if there are individual tenant areas in which the cleaning operation is carried out separately, a schedule must be placed for each area. 3.5.2 Room functions The functions of a room are divided into sensor, application and actuator functions. The signals from the sensors and actuators are either recorded or output directly by a terminal or integrated via a fieldbus system. The interface or communication of the sensor and actuator functions with the application functions of the room is always identical. This allows the room application functions to remain the same regardless of the fieldbus system selected. When using fieldbus systems for room automation, the measuring signals of the sensors or the control commands of the actuators are integrated by incorporating the corresponding fieldbus terminal. Room automation functions according to VDI 3813: TF8040 Version: 1.14.0 23
## Page 24

Concepts The room sensor functions not only serve the application functions of a technical system, but are also processed by the application functions of illumination, sun protection and room air condition control. The presence monitoring of a room, which is used for the automation of the three technical systems mentioned above, is particularly representative of this. The type of application functions for the technical systems illumination and sun protection depend heavily on the use of the room. These should be determined early in the design process by the building automation designer in conjunction with the building operator. 3.5.2.1 Lighting The lighting functions within TF8040 are based on the shell model [} 23] from the VDI 3813 standard for room automation. There can be one or more room functions [} 23] in each shell of the lighting controller model. A user function of the light sends a telegram to control the lights. TYPE ST_BA_Lighting : STRUCT {attribute 'parameter Unit':= '%'} f Lgt Val : REAL {attribute 'parameter Unit':= 'K'} f Lgt T : REAL; b Actv : BOOL; e Prio : E_BA_Lighting Prio; n Evt Inc : ULINT; END_STRUCT END_TYPE A control value for the light intensity in % and the light temperature in Kelvin is transmitted within the telegram. The telegram also contains the variables b Actv and e Prio. To decide which of the functions in a shell has priority, each light telegram is given a priority e Prio. A telegram selector of type FB_BA_Lighting Tgm Sel4 [} 310] /FB_BA_Lighting Tgm Sel8 [} 310] decides which of the telegrams is passed through to the next inner shell if there are several light functions in a shell. Global lighting functions [} 25] with high priorities are positioned in the building, floor and area shells. These lighting functions are implemented within the templates FB_BA_Building Lighting [} 917] and FB_BA_Floor Lighting [} 919]. Global lighting functions [} 25] In the Zone/Room shell (local lighting functions [} 26]), the respective application function that meets the room's illumination requirements is selected. If there are several lighting groups in a room, a separate application function is placed for each one. 24 Version: 1.14.0 TF8040
## Page 25

Concepts The sensor and user functions of the building shell are located in the Building Controller automation station. The functions of the shells floor to segment are located in the Floor Controller. Further details on this can be found in the ADS communication chapter within the templates [} 18] The overall functionality of the lighting controllers is determined by the selection and position of the lighting functions in the shell model. The lighting concept is very individual and strongly dependent on the use of the building. 3.5.2.1.1 Global lighting functions In addition to the functions within the room, luminaires are controlled by higher-level application functions. These must be adapted to the requirements for the operation of the building and determined in the planning phase. Possible global lighting functions can be: • Burglary A connection between the BA system and the burglary alarm system triggers a global command that switches on the illumination throughout the building. The implementation of this lighting function can be found in the template FB_BA_Building Lighting [} 917]. • Fire The illumination is switched on by a connection between the BA system and the fire alarm system. The implementation of this lighting function can be found in the template FB_BA_Building Lighting [} 917]. • Maintenance mode When maintenance mode is triggered via the management and operating device (MBE) or Twin CAT 3 HMI, illumination is switched on in a specific area of the building. The implementation of this lighting function can be found in the template FB_BA_Floor Lighting [} 919]. • Night watchman tour. The illumination is switched on and dimmed to a certain value during the security staff's tours. Operation can be carried out via a time schedule or manually. The implementation of this lighting function is located in the template FB_BA_Floor Lighting [} 919]. TF8040 Version: 1.14.0 25
## Page 26

Concepts 3.5.2.1.2 Local lighting functions The application functions of the illumination in the room depend very much on the use or type of room. The following application functions for illumination are available as templates in Twin CAT 3 Building Automation. All application functions relate to one or more luminaires. • Lighting group With the lighting group application function, switchable or dimmable lighting devices can be switched on and off or dimmed. The lighting group can be operated via light switches, room control units or via graphical operation using Twin CAT 3 HMI. This lighting function is implemented in the template FB_BA_Light Group Switch [} 903]. • Automatic light The automatic light application function switches the room lighting on automatically when the room is occupied. Natural illumination by daylight is not taken into account. The light is only switched via presence detection. The function is particularly useful for energy-saving lighting in rooms with insufficient daylight, such as corridors or sanitary rooms. This lighting function is implemented in the template FB_BA_Light Group Presence [} 900]. • Constant light regulation The constant light regulation application function automatically controls the room lighting or parts of it during occupancy so that it does not fall below a set minimum illuminance. This ensures high-contrast work with minimal energy consumption. While the on-delay and off-delay settings can be used to control switching on before the minimum light level is reached or switching off after the minimum light level is reached, a change in the occupancy status results in undelayed switching. Override by a push button or graphical operation via Twin CAT 3 HMI stops the constant light regulation. Instead, the input value of the push button or the Twin CAT 3 HMI is passed on to the luminaires. This light function is implemented in the template FB_BA_Light Group Constant [} 894]. 3.5.2.2 Sun protection The sun protection functions are based on the VDI 3813 shell model. 26 Version: 1.14.0 TF8040
## Page 27

Concepts There can be one or more sun protection application functions in each shell of the sun protection model. Each application function generates a positioning telegram for the sun protection actuators. All positioning telegrams (ST_BA_Sun Bld [} 274]) of a shell are evaluated by a telegram selector. The telegram with the highest priority is forwarded to the inner shell. TYPE ST_BA_Sun Bld : STRUCT f Pos : REAL; f Angl : REAL; b Man Up : BOOL; b Man Dwn : BOOL; b Man Mod : BOOL; b Actv : BOOL; e Prio : E_BA_Sun Bld Prio; n Evt Inc : UDINT; END_STRUCT END_TYPE A control value for the position of the blind in % and a slat angle in degrees are transmitted within the telegram. The telegram also contains the variables b Actv and e Prio. Global user functions of the sun protection system operate in the Building, Floor and Area shells. Global sun protection [} 28] The room user functions work in the Room shell. Local sun protection [} 28] The overall functionality of the sun protection system is determined by the choice and position of the sun protection functions in the shell model. The functions of the outer shell for the building affect all the building's sun protection actuators. The functions of the inner shells only apply to the corresponding subset of the sun protection actuators that are located within the shells they enclose. The sun protection actuators themselves are located in the innermost shell segment. TF8040 Version: 1.14.0 27
## Page 28

Concepts 3.5.2.2.1 Global sun protection In addition to the local sun protection functions, there are other application functions in the system from which global positioning commands are sent to the sun protection actuators. The following sun protection functions are located in the building level of the shell model. The functions are implemented in the template FB_BA_Building Sunprotection [} 937]. • Fire In the event of a fire, all the blinds in a building are raised. • Storm protection The storm protection function prevents external sun protection devices from being damaged by wind. • Icing protection The risk of the blinds icing up is predicted by combining the measured values for outside temperature and precipitation. To protect the blinds from mechanical damage, they move up when there is a risk of icing and remain there until a predicted icing time has elapsed. There is one instance of the template FB_BA_Facade [} 940] for each facade of the building. The template contains functions and calculations related to a facade. • Maintenance To check that all the blinds on a facade are fully functional and correctly positioned, it is possible to raise and lower all the blinds on a facade synchronously using the maintenance function. In the case of facade cleaning, the blinds of a facade can all be raised and blocked in this position. • Global thermal automatic The global thermal automatic has the same function as the local thermal automatic within the rooms. However, it controls all the blinds on a facade in the same way, so that a uniform image of all the blinds on a facade is created during longer periods of absence, e.g. at weekends. The global thermal automatic uses the measured room temperature value of a reference room. • Communication error In the event of communication problems within the BA network, it is not ensured that the positioning telegrams are passed through to the sun protection actuators with a high priority. The blinds are then raised for safety reasons. 3.5.2.2.2 Local sun protection The application functions can vary depending on the use and technical equipment of a room. In the TF8040 sun protection templates, one or more groups of external venetian blinds or blinds are assumed. The templates of the sun protection functions always refer to a group of blinds which are controlled in parallel. Function blocks for the integration of roller shutters are also available. All room-related sun protection functions are located in the template FB_BA_Sunblind Zone [} 964]. The room functions for a blind group are: • Sun protection with lamella setpoint tracing Sun protection primarily serves as glare protection. The position of the slats is cyclically adjusted to the current position of the sun. As a result, every room is supplied with the best possible daylight despite the prevention of direct sunlight. The energy consumption for the artificial illumination of a room is kept as low as possible. The sun protection also prevents the room from overheating due to solar radiation, thus reducing the energy required for cooling. The sun protection is activated when someone is present in the room. • Thermal automatic With the help of thermal automatic, the sun protection is used in unoccupied rooms to support heating or cooling by selectively allowing or blocking solar heat input. This prevents overheating in summer and reduces the load on the heating system in winter. The thermal automatic processes the room temperature and room temperature setpoint sensor function. 28 Version: 1.14.0 TF8040
## Page 29

Concepts • Twilight automatic The twilight automatic function can be used to position sun protection devices depending on the outdoor brightness. This function allows, for example, the sun protection to be closed during the night, e.g. to reduce cooling through the windows or to reduce the building's light emissions and prevent unwanted views into the building from outside. • Manual control The automatic functions of the sun protection system can be manually overridden using a push button, a room control unit that can be integrated via fieldbus, or a graphical control panel via Twin CAT 3 HMI. 3.5.2.3 Air conditioning The room air conditioning functions are based on the shell model from the VDI 3813 standard for room automation. There is a timer program in the Building shell. This timer program describes the periods during which the rooms in the building are in Protection mode, Economy mode, Pre-Comfort or Comfort mode. The operation modes of the buildings are also referred to as energy levels. The longer the building is unoccupied, the further the energy level can be reduced. If the building is not used for a very long time, it can be put into Protection mode. In winter, the room temperature is reduced or increased to a frost protection setpoint and in summer to an overheating protection setpoint. For longer regular periods of absence, e.g. at weekends or during the night, the Economy energy level is planned. TF8040 Version: 1.14.0 29
## Page 30

Concepts With the Pre-Comfort level, the setpoints are raised to such an extent that they can be reached for Comfort mode in the short term. The setpoints for the Comfort level can be changed slightly if necessary using a local setpoint adjuster in the room. The central generation and distribution of the room temperature setpoints for the entire building are contained in the building controller, see sketch ADS communication within the templates [} 18]. 3.6 Base framework The base framework in Twin CAT 3 Building Automation is an essential property and basis of TF8040. The base framework contains functions that run in the background of a TF8040 solution in the PLC. The functions of the base framework are part of the Tc3_XBA [} 99] library. The base framework is very useful when implementing a BA project (building automation project). This chapter explains these functions. Creation of the project structure (PS) A building automation project is usually organized in levels. The levels start with the property or the location, for example. Further levels can be the building, the systems it contains, the associated aggregates and, finally, the data points it contains. The most important task of the base framework is to map the structure of a project in Twin CAT. The project structure is a system consisting of folders and the objects they contain. For large projects with a large number of objects, this project structure is an important basis for designing a project sustainably and clearly. The image shows a project structure created using the base framework in the Site Explorer [} 1285]. The project structure is mapped in the Site Explorer tool, in the BACnet configuration and in a generic navigation of the Twin CAT HMI. 30 Version: 1.14.0 TF8040
## Page 31

Concepts The benefits of the base framework, which generates the project structure in a clear form in the HMI, the BACnet and also in the BACnet MBE, are very great. Everything from commissioning, parameterization, operation via HMI, subsequent maintenance and connection to a BACnet MBE is facilitated by the project structure. The creation of a project structure is described in the chapter Project structure [} 38]. DPAD(user address key) Another significant advantage is the processing of a user address key (BAS). All levels of the project structure described above are given a name and a descriptive text. The base framework of TF8040 can concatenate the object names and the description texts of the levels and generate the names and descriptions of the BACnet objects from them. In Twin CAT 3 Building Automation, the BAS is also referred to as DPAD Datapoint Addressing Description. Detailed information can be found in the chapter DPAD [} 42]. Events The base framework records the events of the objects within the project structure. A collection of events including all sub-elements is created at each level of the project structure. A function block called FB_BA_Plant Lock [} 135] can be used for plant shutdowns without having to program a collective error message. The acknowledgement and resetting of events is also organized by the base framework. A reset or acknowledgement command is automatically passed through to the objects from the top level of the project structure down to the lowest level of the project structure. The processing of events is described in more detail in the Events [} 32] documentation. TF8040 Version: 1.14.0 31
## Page 32

Concepts Counting events Each folder or view object is able to collect status information such as Out Of Service, In Alarm, Overridden etc. from all subordinate objects and output their number. The Event Condition Count method counts the pending events of objects at the respective level of the project structure. 3.6.1 Objects Objects are the elementary components of the base framework. An object offers various properties. All objects in Twin CAT 3 Building Automation refer to the objects of the Twin CAT Function TF8020 BACnet. 3.6.1.1 Events The base framework of Twin CAT 3 Building Automation and the objects it contains offer extensive functions for processing events. In TF8040, an event always refers to an object. Events occur when an object assumes an abnormal or faulty state. Event-capable objects in Twin CAT 3 Building Automation have the b Event output for further processing of the event within the Twin CAT program. Example:FB_BA_AI The state of an object is described with the Event State. Possible event states are: State Description e Normal The state of the object is normal. e Fault The state of the object is faulty. e Offnormal The state of the object is abnormal. e Low Limit The upper limit value of an analog object has been exceeded. e High Limit The value has fallen below the lower limit of an analog object. Display of events Events are displayed in the event list of the Site Explorer [} 1285] and the Tc Hmi Ba [} 1120]. The events are also transmitted to BACnet clients via the BACnet server if required. The display of an event depends on the following properties: • Event type • Alarm mode • Acknowledge and reset state This results in the following possibilities for displaying an event (illustration using the example of an alarm event): 32 Version: 1.14.0 TF8040
## Page 33

Concepts Designation Figure Description Hidden No event is pending. Indicated* The event is not (no longer) pending, but is indicated for information purposes until it is acknowledged. Past and The event is not (no longer) pending. However, it has already acknowledged** been acknowledged but not yet reset. Past** The event is not (no longer) pending. However, it was neither acknowledged nor reset. Pending and An event is pending and has been acknowledged. acknowledged Pending The event is pending. * Only possible with alarm mode standard! ** Only possible with extended alarm mode! The following representations result for each event type: State Alarm Fault Maintenance Notification Miscellaneous Hidden - - - - - Indicated Past, Acknowledged Past Pending, Acknowledged Pending Event controllers Critical events often require a control response, such as shutting down a ventilation system after a fire damper fails. The desired control functionality is parameterized with the lock functionalities of the event-enabled objects. For this purpose, the events within the levels in the project structure [} 30] are summarized and evaluated using the function block FB_BA_Plant Lock [} 135]. Parameterizing events An event can have different requirements with regard to its display, its control processing and its acknowledgement and resetting. Most of these properties are not parameterized on the object itself, but with the event class FB_BA_EC [} 218] assigned to the object. An event is called active as soon as it is no longer in the Normal state (Hidden). Acknowledging and resetting The user can interact with active events. He has the following options (depending on the configured alarm mode): TF8040 Version: 1.14.0 33
## Page 34

Concepts With the function block FB_BA_Event Observer [} 134] it is possible to carry out a collective acknowledgement or reset of all events within the project structure. Which objects are acknowledged or reset depends on the position of the FB_BA_Event Observer [} 134] in the project structure. In general, all objects that are located in the same folder or a subfolder in the project structure are acknowledged or reset. • Acknowledging Signals (e.g. to maintenance staff) a perceived event. In terms of understanding, it should be possible to deduce that a corresponding action is now required. The acknowledgement is therefore for information purposes. • Reset In extended alarm mode, an event (or an object) must not only be acknowledged, but also reset in order to restore an already passed event to the normal state. Resetting therefore prevents the occurrence of undefined states (e.g. uncontrolled restarting of systems) and thus provides additional safety. Lock priorities Define the priority for disabling events that, for example, have the desired effect on the FB_BA_Plant Lock [} 135]. • Local medium Enables a local shutdown of medium* priority. • Local high Enables a local shutdown of higher** priority. • Medium Enables a higher-level shutdown* of medium priority. • High Enables a higher-level shutdown** of higher priority. * Used for system-safe program sections. ** Used for personnel-safe program sections. 3.6.1.2 Command Several control or positioning commands of an object to be commanded have an influence on the output value Present Value. All commands are stored in an array. The command with the highest priority determines the result at the output of the object. A priority can be given a value between 1 and 16. The highest priority has the value 1. The following objects in Twin CAT 3 Building Automation are objects to be commanded and thus have a priority array. 34 Version: 1.14.0 TF8040
## Page 35

Concepts FB Type Description FB_BA_BO_Raw BO Binary output with external declaration of variables for hardware mapping. FB_BA_BO BO Binary. FB_BA_BO_IO BO Binary output with internal declaration of variables for hardware mapping. FB_BA_AO_Raw AO Analog output with external declaration of variables for hardware mapping. FB_BA_AO AO Analog. FB_BA_AO_IO AO Analog output with internal declaration of variables for hardware mapping. FB_BA_MO_Raw MO Multi State output with external declaration of the variables for hardware mapping. FB_BA_MO MO Multi State output. FB_BA_MO_IO MO Multi State output with internal declaration of variables for hardware mapping. FB_BA_BV BV Binary Value object. FB_BA_MV MV Multistate Value object. FB_BA_AV AV Analog Value object. For an entry to be made in the priority array of an object, the associated enable input b En... must be TRUE on the function block. The Manual Remote priority is not activated by means of an input at the function block, but by writing to a parameter variable. The object is commanded either via the BACnet protocol, e.g. from an MBE, or from Twin CAT via ADS. The following priorities are predefined at the objects by Twin CAT Building Automation: Name Description Symbol release Symbol value Default Prio Safety Personal safety b En Safety *Val Sfty 1 Critical Plant safety b En Crit *Val Critical 3 Man Loc Local manual override (LVB) b En Man Loc *Val Man Loc 7 Manual Rm Manual override from a distance b En Manual Rm *Val Manual Rm 8 (MBE) Pgm Program control b En Pgm *Val Pgm 15 Depending on whether the object type is Analog, Binary or Multi State, the value of a command is a REAL, BOOL or UDINT. Changing priorities The priorities can be changed in the variable list BA_BACnet_Param. TF8040 Version: 1.14.0 35
## Page 36

Concepts 36 Version: 1.14.0 TF8040
## Page 37

Concepts The active priority is displayed at the output of all objects to be commanded by means of the variable e Active Prio. TF8040 Version: 1.14.0 37
## Page 38

Concepts Variables Name Type Description b En Safety BOOL Enabling the "Safety" priority. f Val Safety REAL Analog value for the "Safety" priority. b Val Safety BOOL Binary value for the "Safety" priority. n Val Safety INT Integer value for the "Safety" priority. b En Critical BOOL Enabling the "Critical" priority. f Val Critical REAL Analog value for the "Critical" priority. b Val Critical BOOL Binary value for the "Critical" priority. n Man Critical INT Integer value for the "Critical" priority. b En Man Local BOOL Enabling the "Manual Local" priority. f Val Man Local REAL Analog value for the "Manual Local" priority. b Val Man Local BOOL Binary value for the "Manual Local" priority. n Man Local INT Integer value for the "Manual Local" priority. b En Manual Rm BOOL Enabling the "Manual Remote" priority. f Val Manual Rm REAL Analog value for the "Manual Remote" priority. b Val Manual Rm BOOL Binary value for the "Manual Remote" priority. n Manual Rm INT Integer value for the "Manual Remote" priority. b En Pgm BOOL Enabling the "Program" priority. f Val Pgm REAL Analog value for the "Program" priority. b Val Pgm BOOL Binary value for the "Program" priority. n Pgm INT Integer value for the "Program" priority. 3.6.2 Project structure This section describes how to create a project structure, as shown in the following illustration. 38 Version: 1.14.0 TF8040
## Page 39

Concepts Initialization of the project structure begins in the MAIN program of the automation station. The first step is to determine how many levels are to be mapped in the project. The project structure is not only used to organize a project, but also to process a BAS (user address key). The levels of the project structure are therefore described with the initialization of the function block FB_BA_Careless DPAD. The function block is called in the MAIN program of the automation station. A more detailed description of BAS processing can be found in the chapter DPAD [} 42]. The graphics in this description refer to the standard TF8040 PLC. The building, floor, technical systems, plant, aggregate and function levels are generated within the sample PLC. The initialization of the project structure (PS) is started in MAIN. A level within the project structure is represented by a folder. A folder is created by an instance of the function block FB_BA_View [} 241]. There may be further subfolders or objects within a folder. Objects are created using the function blocks from the chapter Objects [} 191] of the Tc3_XBA [} 99] library. TF8040 Version: 1.14.0 39
## Page 40

Concepts The project structure is edited by creating and concatenating folders. The concatenation is done by assigning a parent to each folder within the FB_BA_View [} 241]. The parent is assigned by transferring the symbol name of the next higher FB_BA_View [} 241] in the project structure to the variable i Parent. The sample shows that the levels Building to Trade are created in the MAIN program. There are the trades Heat supply systems, Automation, General, Ventilation system and Room automation. 40 Version: 1.14.0 TF8040
## Page 41

Concepts The parent of all trades is F01. This creates the five subfolders for the trades below the F01 floor folder. One method of creating a level of the project structure is to call a FB_BA_View [} 241] directly in the Main program. In our sample, this is implemented with the Building and Floor levels. In the function blocks for the trades Heat supply systems, Automation, General, Ventilation systems and Room automation, the folders are created by calling a function block, which also represents a folder. However, these folders are created because the function blocks ACE, BAG, ACS, HTG and Rome all inherit from the function block FB_BA_View [} 241]. This is done with the EXTENDS operator. Here is a sample of the function block Heating supply systems. The function block FB_BA_Heating is a folder and at the same time an FB within which all plants of this trade, e.g. heating circuits, can be called. This mechanism of creating folders by inheriting from FB_BA_View [} 241] continues down to the deepest structures of the project structure. In the case of heating circuit HTC01, which is called within FB HTG, the parent of the function block is the one in which HTC01 itself is called. In this case, the parent of the heating circuit is initialized with the THIS^ operator. TF8040 Version: 1.14.0 41
## Page 42

Concepts This rule continues through to the heating circuit aggregates and the objects they contain. Please note the following when creating the project structure: • The concatenation of all folders and objects of the PS must be closed. • All mechanisms of the base framework will not work otherwise! • All function blocks that map a folder within the project structure and in turn call function blocks from sublevels must inherit from FB_BA_View [} 241]. • The FB_BA_View [} 241] must be called with the Super^ operator at the beginning of the function block. • The execution order in the CFC must be observed. • All function blocks whose parent is the function block within which it is called must receive the parameter THIS^ as parent. • All function blocks from the template Repository with parameters must be called within the declaration area of VAR_INPUT_CONSTANT. 3.6.3 DPAD All objects within the TF8040 project structure are given a name and a description text. A common practice in building automation is to name the objects according to a user address key (BAS). Depending on the complexity of the project-specific BAS, TF8040 offers various options for processing the BAS. The BAS is referred to as DPAD (Data Point Addressing Description) in Twin CAT 3 Building Automation. Generic generation Generic generation [} 43] of Object Name and Description with the DPAD (Data Point Addressing Description). This method is suitable for a project in which the BAS can be generated from a concatenation of the levels of the project structure. This requires that the order of the levels in the project structure matches the order of the BAS text concatenations. Individual texts for e.g. circuit diagram pages, device identification from the circuit diagram etc. can only be processed with greater effort due to the generic approach of DPAD. With the DPAD mechanism, it should be noted that the initial texts of the objects are only transferred to the persistent data of the controller in the first cycle of the controller. The initial data is only reloaded after an overall reset of the controller. As the concatenation mechanism accesses the persistent data, changes do not take effect even after the texts have been concatenated again. Editing with the Symbol Explorer The Symbol Explorer [} 42] is an excellent tool for editing data. All control parameters, including texts, can be conveniently edited using special lists. It is possible to export the data to a csv file, edit it and then load it back into the controller. 3.6.3.1 Editing with the Symbol Explorer In some projects, there are specifications for the user address key that cannot be optimally realized with the DPAD algorithm. As an alternative to the DPAD algorithm, the name and description texts of the objects can also be edited using the Ba Extension of the Symbol Explorer. 42 Version: 1.14.0 TF8040
## Page 43

Concepts 3.6.3.2 Generic generation During the generic generation of the DPAD, the texts of the levels of the base framework are automatically concatenated together. Complete object names and object descriptions are created from the names and descriptions of the objects and folders from the project structure. Here is an example to explain the mechanism: The illustration shows the measured value (MV) of the return temperature sensor (TRt) from heating circuit 01 HTC01. An instance of the function block FB_FB_BA_Careless DPAD is required for the generic generation of the DPAD. It is recommended to call the function block right at the beginning in MAIN. The number of levels, the type of separators and the character width of the indexes are defined in the initialization of the DPAD function block. It is important that the number of initialized levels of the DPAD matches those of the project structure. The indexes are mostly used for naming the aggregate and function levels of the data point. In the initialization sample, two digits (00 to 99) are provided for each index. The concatenation algorithm of the DPAD function block only recognizes the texts that are to be concatenated if they are defined as placeholders {} within the curly brackets. Placeholders are very variable and versatile. A more detailed description of the placeholders can be found in the chapter: Object description texts There are two methods for specifying the initialization texts for the object name and the description: Direct writing of name and description Sample: s Objectname := 'Sample name'; TF8040 Version: 1.14.0 43
## Page 44

Concepts s Description := 'Sample description'; Use of placeholders One variant for initializing these texts is the use of placeholders. These are usually defined in the FB_init of the template (in this sample FB_BA_H_Htg Cir01 [} 975]). Only texts initialized in placeholders {} are concatenated to the other levels of the project structure by the DPAD algorithm. The following samples show how the concatenation of texts can be influenced by placeholders. All of the following DPAD initialization samples refer to the name of the pump in the heating circuit. Object names and descriptions are described directly in these samples without the use of labels. Name concatenated and fixed index Pu.s Object Name := '{Pu{Idx=99}}'; = B-F01-HTG-HTC01-Pu99 Description text with object index Pu.s Description := '{Pump{Idx}}'; = B-Floor 01-Heat supply systems–Heating Circuit – Pump99 Name concatenated and automatic index Pu.s Object Name := '{Pu} '; = B-F01-HTG-HTC01-Pu04 Entry point for concatenation defined by !{} and Object Index {Idx} activated Pu.s Description := '!{Pump{Idx}}'; = Pump04 Name concatenated without index Pu.s Object Name := '{Pu01{! Idx}}'; = B-F01-HTG-HTC01-Pu01 Pu.s Description:= '{Pump01}'; = B-Floor 01-Heat supply systems-Heating-Circuit– Pump01 User-defined name Pu.s Object Name := '{123M1{! Idx}}'; = B-F01-HTG-HTC01-123M1 Pu.s Description:= '{Pump 123M1}'; = B-Floor 01-Heat supply systems–Heating Circuit– Pump123M1 Name not concatenated and fixed index Pu.s Object Name := Pu{Idx=99}'; = Pu99 Transfer of the object index to the description text Pu.s Description:='Pump{Idx}'; = Pump99 Name not concatenated and fixed index Pu.s Object Name :='Pu{Idx=99}'; = Pu99 Defined own index in the description text 44 Version: 1.14.0 TF8040
## Page 45

Concepts Pu.s Description :='Pumpe{Idx=123}'; = Pumpe123 Name not concatenated and Instance ID of object Pu.s Object Name :='Pu{Inst ID}'; = Pu201 Pu.s Description:='Pump{Inst ID}'; = Pump201 Name not concatenated and automatic Pu.s Object Name:='Pu'; = Pu04 Pu.s Description:='Pump{Idx}'; = Pump04 Name not concatenated without index Pu.s Object Name := 'Pu{! Idx}'; = Pu Pu.s Description := 'Pump'; = Pump Labels for defining names and descriptions Labels are another option for initializing the texts of names and descriptions of objects. A label is the paired summary of the texts for the name and description of an object. Initialization is carried out with the function block FB_BA_Label. The function block FB_BA_Label2x is to be used if the texts of the levels aggregate and function of the data point are to be initialized together. In Twin CAT 3 Building Automation, the labels are stored in a list of global variables. Within the Twin CAT 3 Building Automation templates, they are used to initialize the text variables s Objectname and s Description. TF8040 Version: 1.14.0 45
## Page 46

Concepts The label lists are available for naming aggregates (Lbl Aggregates_xx), general control functions (Lbl Controll_xx) and function names (Lbl Function_xx). The lists with the ending _EN contain labels in English and the lists with the ending _DE contain labels in German. For the choice of language, the language that is not desired must be commented out before compiling the controller for the first time. DPAD mode For each level of the project structure, the DPAD mode can be used to determine whether and which texts are to be taken into account in the concatenation. In the following sample, the explanation is based on a ventilation system from the Twin CAT 3 Building Automation template repository. The main aggregates of the ventilation system, the heater (Pre Htr), the energy recovery (ERC) and the cooler (Col), each have their own function block, within which all components or sub-aggregates are called. The main aggregates are not part of the levels in the DPAD. In the definition of the DPAD, the levels for the sub-aggregates and functions are defined directly after the Plant level. This means that there is one more level in the PLC than there is in the DPAD. The heater level must therefore be excluded when generating the object names. This is done with the DPAD mode and the following initialization. 46 Version: 1.14.0 TF8040
## Page 47

Concepts The e Include Description setting is selected for the heater. The description text of the heater is thus concatenated and the name of the heater is excluded when generating the object names. The result of this parameterization can be seen in the Site Explorer. The symbol path (1) has 7 levels, which means that the description text (2) and the object name (3) also have 7 levels, whereby one level is not displayed for the object name. In the description text (2) of the flow temperature sensor of the air heater, the description text 'Pre Heater' is included and excluded in the object name (3). TF8040 Version: 1.14.0 47
## Page 48

Concepts 3.6.3.3 Object description texts Object description texts are used to create a unique name for all objects in the project structure [} 38]. (This is called DPAD [} 42] or BAS (user address key)) Each level within the project structure is given a name and a description text. The concatenation of the partial names from the project structure results in the name and description text of an object. Concatenated texts are created using placeholders or labels. The following object parameters are summarized as texts: • Object Name • Description The texts of a object [} 32] are generated automatically only if a placeholder is included. This is typically the case when the PLC starts for the first time. Since from now on all texts have a defined value (which is also saved persistently), they will no longer be generated again! From this point on, texts can only be changed by the user! Labels A Label FB (e.g. in a GVL) can be used in the declaration of one or more objects [} 32] to generate its texts automatically. A distinction is made between the following label types: • Simple labels (FB_BA_Label) Provide the possibility to define texts for general use. This means that simple labels can be reused in all objects, but also in further labels. • Dual labels (FB_BA_Label2x) Provides the option of defining the equipment identifier of an object. This means that both aggregate and function information can then be described. Any (simple or dual) label can be assigned to each object [} 32]. 48 Version: 1.14.0 TF8040
## Page 49

Concepts Each view [} 32] should be assigned a simple label which is interpreted as aggregate information. Function information is not supported by views. Programming Placeholder Placeholders represent a value that will be generated later. For example, the Object Name and Description parameters are initialized with standard placeholders as follows: • s Object Name : T_Max String := '{}'; • s Description : T_Max String := '{}'; During object initialization, the text generation mechanism analyses a text for defined placeholders. Only if a valid placeholder exists, the mechanism can replace it with an automatically generated text. On the other hand, a manually defined text would have replaced a placeholder and would not be overwritten. As soon as the texts are generated, variables no longer contain placeholders. Even if the device is restarted and parameters (persistent variables) have been saved, the current texts remain (automatically generated, manually defined or even changed by an operator at runtime) and are not overwritten by the text generation mechanism. Purpose of use • Substitute A placeholder (here an index) is substituted for a value: s Description := '{Idx}' • Defining A placeholder (here an index) is used to define a specific value: s Description := '{Idx=10}' Indexing • Automatic indexing Automatic indexing is set in the project template for objects in the last two levels of the project structure. This means that the Object Name parameter also receives a consecutive index number in addition to a defined name. Indices (e.g. for aggregates) are automatically appended after the text. While indices for the Object Name parameter are normally always generated, Description indices appear depending on the current setting. • Manual indexing Indexing can be specified using placeholders and their corresponding index attributes. Manually defined indices (regardless of the purpose) are always displayed in the generated text. A given index is also automatically used for parameters of subsequent objects [} 32] if they do not also explicitly define an index. Sample: As an index of 10 is defined for Pump1, index 11 is automatically used for Pump2. Pump1 : FB_BA_View := (i Label:=Some Label, s Object Name := '{Idx=10}'); Pump2 : FB_BA_View := (i Label:=Some Label); Manually assigned indices must be assigned carefully as they are not validated by the mechanism! TF8040 Version: 1.14.0 49
## Page 50

Concepts Concatenation The texts of an object [} 32] are concatenated with texts of parent objects [} 30] under certain conditions: • Parent settings [} 241] • Settings in the DPAD-FB [} 42] used • Manual overwriting using index attributes • Global settings [} 284] • Placeholder with concatenation prohibition Use cases • Use case 1 A placeholder refers to a specific parameter. Sample: Initialization of the Object Name s Object Name := '{}' • Use case 2 A placeholder represents another parameter. In this case, the placeholder must be addressed with its corresponding abbreviation. Sample: s Description := '{} - ID {Inst ID}'. Parameter Parameter Shortcut Event Transition Text Evt Trans Present Value Pr Val Device Type Dev Type Instance ID Inst ID Object Name Obj Name Description Descr Attributes Attributes are typically used in the application (for example, in a template [} 696]) because the application- specific details are known there, but not the operator-specific details. Attributes Shortcut Type Aggregate Index Idx Unsigned number Function Index Idx Unsigned number • Index attributes Whether an index refers to an aggregate or a function depends on the order. ◦ A stand-alone index refers to the function. ◦ Two indices refer to the aggregate (index 1) and the function (index 2) Syntax • Placeholder: {} • Placeholder that overwrites a parameter value (e.g. s Object Name := '{My Value}'): {Value} • Placeholder, as a representing attribute (e.g. s Description:= '{Idx}'): {Attribute} {Attribute1,Attribute(n),...} • Placeholder, as defining attribute (e.g. s Description:= '{Idx=10}'): {Attribute=Value} {Attribute1=Value,Attribute(n)=Value,...} 50 Version: 1.14.0 TF8040
## Page 51

Concepts • Placeholder, as a defining attribute which overwrites a parameter value (e.g. s Description:= '{Pump{Idx=10}}'): {Value{Attribute=Value}} • Placeholder with multiple attributes: {Placeholder{Attribute1=Value,Attribute2=Value}} • Placeholder, as a representing parameter (e.g. s Description:= '{} {Inst ID}'): {Parameter} • Placeholder that denies concatenation with parent elements. The entry point of the concatenation is defined. From this point on, only placeholders of the child elements are concatenated: !{} • Placeholder that denies certain attributes (switching off attributes): {Value{! Attribute}} Samples Parameter Object Name with defined placeholder (concatenates automatically generated values): s Object Name := '{}' Concatenates parameter Object Name with overwritten value: s Object Name := '{AAA01_BB01}' Concatenates parameter Description with placeholders and predefined additional information that is not replaced: s Description := '{} North' Concatenates parameter Description with a placeholder and extends a substitute index attribute (the index value of the Object Name is transferred): s Description := '{Idx}' Concatenated parameter Object Name with placeholder including defining index attribute: s Object Name := '{Idx=10}' Concatenated parameter Object Name with placeholder including substitute (aggregate) and defined (function) index attribute: s Object Name := '{Idx,Idx=10}' Concatenated parameter Description with overwritten value and a defined (function) index attribute: s Description := '{Pump{Idx=5}}' Concatenated parameter Description with placeholder and a substitute parameter: s Description := '{} - ID {Inst ID}' Object Name with default placeholder but without concatenation (concatenation denied): s Object Name := '!{}' Concatenated parameter Object Name with overwritten value, but without index attribute (attribute denied): s Description := '{PU{! Idx}}' Error messages Name Text Description [T23] Internal error on parsing Defining placeholder values and placeholder "...": Defined value and attributes at the same time is not attributes at once! allowed, because a Defined value prevents attributes from being applied. Generating texts The following sequence is used to decide how a placeholder is replaced: TF8040 Version: 1.14.0 51
## Page 52

Concepts 1. Overwrite texts If defined, a manually initialized title is used: fb Sensor : FB_BA_AO_IO := (s Object Name:='Tmp03', s Description:='Temperature sensor 3'); 2. Labels If titles are not overwritten, a label can be applied: Some Label : FB_BA_Label := (s Name:='PU', s Description:='Pumpe'); Pump : FB_BA_View := (i Label:=Some Label); 3. Symbol Name If nothing is defined, the following default values are used: ◦ Object Name receives the information from the symbolpath. ◦ Description receives the information from the symbolname. Samples Initialization by means of labels Transfer of the texts defined in the label to objects [} 32]. {region 'Labels in GVL "My Labels"'} MV : FB_BA_Label := (s Name:='MW', s Description:='Messwert'); TFl : FB_BA_Label := (s Name:='TFL', s Description:='Vorlauftemperatur'); TRt : FB_BA_Label := (s Name:='TRL', s Description:='Rücklauftemperatur'); Pre Htr : FB_BA_Label := (s Name:='LE', s Description:='Lufterhitzer'); TFl_MV : FB_BA_Label2x := (i Aggregate:=TFl, i Function:=MV); TRt_MV : FB_BA_Label2x := (i Aggregate:=TRt, i Function:=MV); {endregion} {region 'Objects in some program'} Pre Htr : FB_BA_View := ( i Label:=My Labels. Pre Htr); TFl : FB_BA_AI_Raw := (i Parent:=Pre Htr, i Label:=My Labels. TFl_MV); TRt : FB_BA_AI_Raw := (i Parent:=Pre Htr, i Label:=My Labels. TRt_MV); {endregion} 3.7 PLC 3.7.1 Control and regulation mechanisms This chapter explains the general relationships between open-loop and closed-loop control. 3.7.1.1 Scheduler Timing control of building and room automation systems is an important part of building automation. The targeted use of schedules can optimize the efficiency of the building and the comfort for the users. If, for example, a heating system is controlled by a schedule, the room temperature can be adapted to the times of use, thus saving heating energy when the building is not in use. The implementation of schedules with TF8040 is described in this chapter. Planning In general, there are several ways to set a schedule. Weekly planning First, there is the weekly schedule. This is the schedule that applies every week, so it describes a general week. It is set by the parameter a Week [} 256] of the function blocks FB_BA_Sched A [} 222], FB_BA_Sched B [} 223] and FB_BA_Sched M [} 225]. 52 Version: 1.14.0 TF8040
## Page 53

Concepts Exceptions The weekly schedule that applies during standard weeks, or normal operation, of the building must always be modified by exceptions. Examples of such exceptions would be: • Vacation • Public holidays • Meeting room booking • etc. The exceptions that can be defined for a schedule are divided into two categories. Local exceptions The local exceptions of a schedule are exceptions that apply only to that explicit schedule. I.e. they have no effect on other schedules and are set directly on the schedule object. They are parameterized via the parameter a Exception [} 256] of the function blocks FB_BA_Sched A [} 222], FB_BA_Sched B [} 223] and FB_BA_Sched M [} 225]. The exceptions can be configured as follows: • Date: An exception can be defined on a specific date. On this date you can then set what should happen at what time. For example, the heating might not be turned down at 5pm that day, as in the weekly schedule, but at 8pm, due to a meeting. • Date range: Exceptions can be set over a complete date range. If, for example, the building is not planned to be used in a certain week due to company vacations, it can be set that the weekly schedule is overwritten in such a way that the building does not switch to comfort mode at the set operating times during the defined time, thus saving energy. • Week and day: In addition to a date range, recurring exceptions can also be defined on specific weeks on specific days. This allows exceptions such as "every second Wednesday of the month" to be implemented. Global exceptions Global exceptions are defined in the same way by date, date range and week and day. However, as the name suggests, these exceptions do not apply to a specific schedule, but globally. Global exceptions are defined via calendar objects, which are then passed to specific schedules via the parameter a Calendar [} 256]. Such a calendar could, for example, define the school vacations in the respective state. Thus, all schedules in a school could be overwritten during the vacations. Programming The operation of schedules and their exceptions should be understood at this point and programming will now be discussed. Weekly schedule The parameter a Week [} 256] is an array and therefore it is quite complicated to parameterize it manually. To make it easier for the user, the parameter builder F_BA_Weekly Schedule Builder [} 189] is provided for this purpose. The use of this parameter builder is described in its documentation. Local exceptions The parameter a Exception [} 256] is an array and therefore it is quite complicated to parameterize it manually. To make it easier for the user, the parameter builder F_BA_Exception Schedule Builder [} 181] is provided for this purpose. The use of this parameter builder is described in its documentation. Global exceptions TF8040 Version: 1.14.0 53
## Page 54

Concepts The parameter a Calendar [} 256] is an array and therefore it is quite complicated to parameterize it manually. To make it easier for the user, the parameter builder F_BA_Schedule Calendar Builder [} 188] is provided for this purpose. The use of this parameter builder is described in its documentation. 3.7.2 Fast task for serial communication Various bus systems, such as DALI, MBus or En Ocean®, are used in building automation. Many of these systems are integrated by Beckhoff hardware and are based on serial communication. Communication with the serial hardware often requires a task that is processed in a significantly shorter time than the PLC task in which the normal application runs. In addition, the fast task must have a higher priority than the PLC task. This relationship is well described in the Introduction to serial communication: Within TF8040, the following components currently require a fast task for processing serial information: • the Thies weather station, which is based on standard serial communication at 9600 bps (see Integration Thies weather station [} 1097]). • the DALI function blocks, which are based on the TC3_DALI library. The integration of communication is described in the following chapter (see DALI communication [} 868]). 3.8 HMI 3.8.1 Generic The creation of an HMI for a building automation system can be very complex and only parts of an HMI can be reused in different projects. Often the budget available for an HMI is also limited. For this reason, it is worthwhile using an HMI that already generates certain parts generically. This generic is possible with the TF8040 Building Automation solution. This means the Tc3_XBA [} 99] library for the PLC and the Ba Site-Extension [} 1262] for the HMI. The goal of TF8040 is for the integrator to develop his system at only one central point - the PLC. Due to the way in which systems are implemented with TF8040 and the resulting structures, it is possible to derive generic functions for the HMI. For more information, see the documentation for Generic HMI [} 77]. Project structure The generic functions within Tc Hmi Ba are based on the project structure [} 38], which is established in the PLC by a child/parent relationship. With this structure it is possible to derive a generic navigation [} 77] through all objects on a controller. Further information on the project structure [} 38] can be found in the documentation. Events The events of all linked controllers can be collected and displayed centrally in an event list [} 1166]. This function also results from the engineering in the PLC and does not require any further configuration in the HMI. 54 Version: 1.14.0 TF8040
## Page 55

Concepts Trending In addition, the generic design makes it possible to implement various trend functions without having to configure them separately for the HMI. For more information, see the documentation on Trending [} 55]. 3.8.2 Trending Trends can be used and managed in the HMI. The functions described here can only be used with the generic functions [} 77] of Tc Hmi Ba. Trend collections Displaying individual trend curves is often not sufficient, as they are difficult to compare in this way. For this reason there is an option to create trend collections in order to compare the trend curves in a chart. Configurator The configurator can be opened via the menu in the Parameter window [} 1170] of a view and then only displays objects from this level. In addition, it can also be opened via the menu of Project Navigation Textual [} 1167]. TF8040 Version: 1.14.0 55
## Page 56

Concepts Creating trend collections Trend collections are created with the configurator. After assigning a name, the trendable objects can be added to the trend collection via the checkboxes. The menu offers the option to select the objects to be displayed. • Trendable object: Displays all trendable objects (e.g. FB_BA_AV). • Trend object: Displays all trend objects (FB_BA_Trend). A Trendable object must be assigned to a trend object for use in the trend. The state for this can be viewed and also changed in the menu of the Parameter window [} 1170]. If an assignment has not yet been made at the time of selection, this is done automatically by confirming the query with OK. 56 Version: 1.14.0 TF8040
## Page 57

Concepts Subsequently, the trend can be activated directly with OK. When the trend collection is complete, it will be available in the trend collection view after confirming the dialog. Observing trend collections The created trend collections can be viewed and added in the trend collection view. This can be called up in two ways. 1. By calling the function Open Trend Collection View [} 1258]. 2. From the Project Navigation Textual [} 1167]. When the dialog is opened for the first time, an overview appears. A trend collection can be selected from it and then displayed in a Trend Control [} 1175]. TF8040 Version: 1.14.0 57
## Page 58

Concepts The organization is done in tabs and allows you to quickly switch between the different trend collections. Additional trend collections can be added via the menu. Further actions are available in the menu for managing the trend collection. • Remove collection from view: Removes the trend collection in the active tab from the view (it will not be deleted). • Edit collection: Opens the configurator to edit the trend collection in the active tab. 58 Version: 1.14.0 TF8040
## Page 59

Concepts • New trend collection: Creates a new trend collection. At this point, all objects of the project structure are displayed. The first call may therefore take some time. • Delete collection: Opens the trend collection view. The selected trend collection is permanently deleted. Live Trends If the behavior of a value is to be observed only briefly and not assigned to a trend object, it is possible to create a live trend via the menu of the object in the Parameter window [} 1170]. This action is only available if the object itself is trendable (e.g. FB_BA_MV [} 237]) or is a view with trendable objects. After pressing the button, the live trend opens, which records either only one trendable object or all trendable objects of the view in a FIFO memory. The functions in the menu are similar to those of the Trend Control [} 1175]. NOTICE Loss of data When the window is closed, the recorded data is lost. The menu contains two additional actions: • Reset: Deletes all recorded values. • Pause: Pauses the recording of new values. TF8040 Version: 1.14.0 59
## Page 60

Concepts 3.8.3 Feedback In some Tc Hmi Ba controls [} 1122] a so-called feedback is used. The feedback should help to be able to give the user a feedback, if a BV is written, but the confirmation (feedback) of the PLC is still pending, for example. Accordingly, the Tc Hmi Ba controls always display only the feedback value (e.g. State Feedback of the Checkbox), which ensures that the current value is always displayed in the HMI. Changing the value of State has no effect on the display in the HMI, as only the value of State Feedback is displayed. Procedure The procedure using the example of the checkbox [} 1135] is as follows: 1. Write value by marking the checkbox 2. Value is written to the State symbol 3. Display of the loading animation 4. Response of the PLC: Hiding the loading animation There are only two possible outputs. a. Value of symbol linked to State Feedback changes to the same value written to State. b. Value of State Feedback does not change. 3.8.4 Ba Object The Ba Site-Extension [} 1262] provides the Tc Hmi with the structure of the PLC in a special form. Ba Objects are created from this, which can then be linked to the Ba Object attribute from the BA category of a Tc Hmi Ba control [} 1122]. Create binding Call up the action to create Binding from the menu. Select symbol. 60 Version: 1.14.0 TF8040
## Page 61

Concepts Symbol is assigned. Ba Object A Ba Object is the representation of an object from the project structure [} 38] of a PLC based on TF8040. The Tc Hmi Ba controls generically use the data and functions from the Ba Objects that they need for their work. Further information can be found in the Ba Object handling [} 1227] documentation. 3.8.5 Ba Template Tc Hmi Ba templates are Tc Hmi Ba controls [} 1122] that directly represent a TF8040 standard PLC template in the Tc Hmi. Ba Template Description Tc Hmi Ba templates are available for almost all TF8040 standard PLC templates. The scope of functions includes a validation of the linked Ba Object [} 60] using the Ba Template Description. It defines the symbol names including hierarchy in the delivery state, which a Tc Hmi Ba template requires in Ba Object. In case of changed symbol names [} 1229], due to project specific peculiarities, the new name can be communicated to the Tc Hmi Ba template via the attribute Ba Template Description from the BA category. The default values of the Ba Template Description, as well as the expected data types can be found in the tooltip of the dialog for setting the Ba Template Description. TF8040 Version: 1.14.0 61
## Page 62

Concepts Further information can be found in the Ba Template handling [} 1227] documentation. Using nested Ba Objects If the Ba Objects, e.g. for the command of a motor, are not on the level provided by default, but in a lower level, these nested objects can be accessed with the following syntax. My View::Motor::Cmd 3.8.6 Ba Interface Tc Hmi Ba controls [} 1122] that support the Ba Interface can also be used without the Ba Site and TF8040 PLC templates. Functionality and behavior may vary. For more information, see the documentation for Ba Interface Handler [} 1245]. Use The Ba Interface attribute from the Ba Data category requires a Tc Hmi symbol. Without specification of structure and content by a TF8040 PLC template, the assignment of the variables for the control must be done via the attribute Ba Interface Symbol Names from the category Ba Data. Sample Explanation using the sample of a self-created PLC function block FB_Simple Light for toggling a light. The state-variable b State is stored in a structure. FUNCTION_BLOCK FB_Simple Light VAR_INPUT b Toggle : BOOL; END_VAR 62 Version: 1.14.0 TF8040
## Page 63

Concepts VAR_OUTPUT st Feedback : Light Feedback; END_VAR This is to be used by the Tc Hmi Ba control Light [} 1203]. For this purpose, the symbol of the function block is transferred to the Ba Interface attribute and then the variables are assigned via the Ba Interface Symbol Names attribute. Using nested symbols Nested symbols can be accessed with the following syntax. st Feedback::b State TF8040 Version: 1.14.0 63
## Page 64

Tutorials 4 Tutorials Below are some tutorials to help you get started with TF8040. Getting started PLC Creating a Twin CAT PLC project [} 64]. HMI Creating a Tc Hmi Ba project [} 71]. Video tutorials Getting started with TF8040 is made even easier with a series of video tutorials. The videos are available on the Beckhoff website. Filter: Industry -> Building automation 4.1 PLC Chapter with instructions for programming PLC applications. 4.1.1 Starting a project This chapter describes how to start a project. Procedure The procedure described here includes all settings that are relevant for a functioning project. When using the TF8040 PLC project templates [} 693] individual steps are already prepared accordingly. Updating the runtime If the runtime on the target device is not up-to-date, it should be updated accordingly: XAR Install current XAR on full Windows systems. Image Install current image on the other systems (e.g. Windows Compact 7). Creating a Twin CAT project • Create new Solution. 64 Version: 1.14.0 TF8040
## Page 65

Tutorials Adding a PLC project • Add matching PLC project template [} 693]: Choose Target System • To proceed with the project settings, you must first select a controller as the target system. TF8040 Version: 1.14.0 65
## Page 66

Tutorials For more information refer to the chapter Choose Target System. Project settings After the target system is selected, you can proceed with the project settings. System Real-time • Reading the existing hardware configuration: • Selecting a core: If there are several cores to choose from, the last core is recommended, since the load generated by the operating system tends to be small there. 66 Version: 1.14.0 TF8040
## Page 67

Tutorials NOTICE Do not use isolated cores. • Configuring the router memory The memory should generally be set to 200 MB: A restart of the operating system (on the target device) is required to apply the setting. Tasks Settings for the PLC task: • Recommended cycle time: 45 ms TF8040 Version: 1.14.0 67
## Page 68

Tutorials PLC The settings described below are not necessary if a PLC project template [} 693] is used. Libraries If no template is used, the following libraries must be added to the PLC project. • Tc3_BA2_Common • Tc3_BACnet Rev14 • Tc3_BA2 68 Version: 1.14.0 TF8040
## Page 69

Tutorials In the standard PLC-BA template [} 693] all necessary libraries are already loaded automatically. I/O The procedure proposed here refers to the steps required to make the TF8040 function operational in combination with BACnet on the desired hardware. Further steps for setting up the hardware are not be discussed in detail here. BACNet • Add BACnet device: • Select the appropriate network adapter: The adapter is set in the BACnet device under the Adapter tab: TF8040 Version: 1.14.0 69
## Page 70

Tutorials • Linking the BACnet adapter with the AMS Net ID: This step is only possible once the project has been compiled without errors. Selection of the BACnet adapter to be used: • Adding the BACnet server: License Twin CAT 3 standard licenses are tied to a unique system ID of a Twin CAT 3 license dongle (or IPC). 70 Version: 1.14.0 TF8040
## Page 71

Tutorials Standard licenses are chargeable: The license price depends on the hardware platform level. More detailed information is described in the information system (see Licensing). • Determine the license status. • To start it is possible to activate a trial license. This unlocks all functions for 7 days. Adapt the PLC template Adapt the used PLC project template [} 693] according to the recommended procedure [} 693]. Continue The PLC project is now set up and project planning can be started. 4.2 HMI Chapter with instructions for creating an HMI project. 4.2.1 Starting a project Description The following section describes how to create and start a Tc Hmi Ba project. By using Tc Hmi Ba project templates [} 1275] individual steps can already be prepared accordingly. Procedure Installing the Twin CAT 3 HMI For the creation of Tc Hmi Ba projects the Twin CAT 3 HMI Engineering is required. Note the system requirements. Further information can be found in the documentation for Twin CAT 3 HMI (TE2000). After installation, the project template for a standard HMI should be available in all development environments selected during setup (Tc Xae Shell, Visual Studio 2019, etc.). TF8040 Version: 1.14.0 71
## Page 72

Tutorials Installing TF8040 To use Tc Hmi Ba projects, the Tc Hmi and TF8040 must be installed. Among other things, the TF8040 setup includes the Nu Get packages, which will be discussed in more detail later. Create a new Tc Hmi project Create a new Twin CAT HMI project on the start page or via File > New > Project under the category Twin CAT HMI. During project creation there may be a Windows security alert because the engineering server is accessing the network. Please allow the access request accordingly. The created project should now have the following structure: 72 Version: 1.14.0 TF8040
## Page 73

Tutorials Installing Nu Get packages Specific controls for building automation are not included in the standard scope of the Tc Hmi toolbox. To be able to use them in the created project, the Nu Get package Beckhoff. Twin CAT. HMI. Controls must be installed. The procedure for doing this is as follows: • Open the Nu Get package management The correct package source Twin CAT Building Automation must be selected in the top right corner of the Package Manager. The selection is only available if TF8040 including the Tc Hmi option (standard) has been installed. • Install Beckhoff. Twin CAT. HMI. BA. Controls TF8040 Version: 1.14.0 73
## Page 74

Tutorials The packages Beckhoff. Twin CAT. HMI. BA. Framework [} 1242] and Beckhoff. Twin CAT. HMI. BA. Icons [} 1231] are also installed during the installation. After installing the Nu Get packages, the project tree should look like this. 74 Version: 1.14.0 TF8040
## Page 75

Tutorials If the Desktop.view and the toolbox are open, the following controls should now be available: TF8040 Version: 1.14.0 75
## Page 76

Tutorials Further information can be found in the respective documentation [} 1122] of the individual controls. Use The available controls can be used to create visualizations as well as User Controls. The usage thus corresponds to the standard controls of the Tc Hmi. 76 Version: 1.14.0 TF8040
## Page 77

Tutorials Generic functions If you want to use the TF8040 as a complete solution with all the advantages during engineering, please continue with the chapter Generic functions [} 77]. 4.2.2 Generic HMI Description The following describes how the generic functionalities of Tc Hmi Ba are used to minimize the development work for the HMI. As a prerequisite, see the chapter Starting a project [} 71]. Procedure Please note the system requirements [} 1121] of the Ba Site-Extension. Furthermore, a PLC is required that was created with the libraries from TF8040 and is already active. Description of required terms [} 32]. Preparing the server Before starting to create the visualization with generic functions, the server must be prepared. Installation Ba Site-Extension To support the generic functionalities it is necessary to install the Nu Get package Beckhoff. Twin CAT. HMI. BA. Ba Site [} 1262]. After installation the project tree should look like this: TF8040 Version: 1.14.0 77
## Page 78

Tutorials Configuration Ba Site-Extension Open the configuration page of the Ba Site-Extension. In the opened window all settings for the Ba Site-Extension can be made. 78 Version: 1.14.0 TF8040
## Page 79

Tutorials For more information about configuration and functions, see the server extension documentation [} 1262]. IFP01 is created by default in the Runtimes entry. Enter the respective data for the active PLC at Ams Net Id and Port. Enter the respective details for the active PLC at Ams Net Id and Port. No change of the settings is required if the PLC is running locally on the development computer. Afterwards the runtime has to be activated and the dialog has to be confirmed. Now in the Twin CAT HMI Configuration the PLC should have been successfully created in the server extension. TF8040 Version: 1.14.0 79
## Page 80

Tutorials The runtime is then listed at All Symbols in the opened window. If no HMI project is selected in the project tree, the display in the Twin CAT HMI Configuration remains empty. A mapping for the runtime has also been created already. The mapping is listed under Mapped Symbols. 80 Version: 1.14.0 TF8040
## Page 81

Tutorials Note the requirements for the necessary mappings [} 1264] for the generic functionalities. The configuration of the server is now complete. Using generic controls The generic controls can only be used with the Ba Site-Extension. A small selection is briefly described below. Further information can be found in the respective documentation of the individual controls. Project navigation The quickest way to get started with the HMI is to use the Project Navigation Textual control. It is located in the BA | General category of the toolbox. If the control was placed on the Desktop.view, it should look like this: TF8040 Version: 1.14.0 81
## Page 82

Tutorials Open the Properties window. 82 Version: 1.14.0 TF8040
## Page 83

Tutorials The content of the Properties window always depends on the current selection. To see the properties of the project navigation, the control must be selected on the Desktop.view. If the attribute Ba Object is linked to the project structure (Top node) of the runtime, this control can be used to navigate through the entire project structure. TF8040 Version: 1.14.0 83
## Page 84

Tutorials The Live-View should now look like this: 84 Version: 1.14.0 TF8040
## Page 85

Tutorials Ui Icon The Ui Icon [} 1159] can be used for various applications. It is also located in the BA | General category of the toolbox. Like all controls from Tc Hmi Ba, the Ui Icon has the attribute Ba Object. Any Ba View or any Ba Object can be linked to this. Again, the Project Structure of the runtime (see above) serves as an example. In Live View, the Ui Icon then looks like this: It displays the active events of the linked view/object and enables opening of a window that contains the generic navigation from above. TF8040 Version: 1.14.0 85
## Page 86

Tutorials The same functionalities are thus available from this window. 86 Version: 1.14.0 TF8040
## Page 87

Examples 5 Examples Examples of all features from TF8040. Downloads • TF8040 https://infosys.beckhoff.com/content/1033/TF8040_TC3_Building Automation/Resources/ 18733784075.zip Contains ◦ Samples of PLC (templates [} 96]) ◦ Samples of HMI (concept [} 88], templates [} 94]) Configuration PLC Individual settings within the TF8040-Concept-Samples-PLC-Solution must be adapted to the hardware used. The settings affect the Project settings and the I/O. All necessary steps are described in Starting a project [} 64]. Individual settings that have already been made do not need to be taken into account any further. HMI Preparing the PLC To run the HMI, the PLC must be configured and started. Installing the Twin CAT HMI To load the sample project, the Twin CAT 3 HMI Engineering must first be downloaded and installed. Further information on the required steps can be found in the documentation for the Twin CAT 3 HMI Engineering in the section Installation. Download Once the PLC is activated and running, the sample solution can be opened. License development system In order for the HMI samples to be executable, the TC3 HMI server license of the TF2000 must be licensed on the target system. Server configuration No further configuration is necessary if the runtime is activated on the PC on which the HMI project is also started. If not, the configuration must be adjusted. The procedure for this is described in the tutorial Generic HMI [} 77]. TF8040 Version: 1.14.0 87
## Page 88

Examples Please note the general comments. Further information • PLC programming [} 98] 5.1 Concept examples The samples in this package show the concept of TF8040 on the part of the PLC and HMI. The chapter presents the approaches for creating a TF8040 project. Different Ba Object types and the procedure for implementing an HMI are also shown. The samples reference the downloads [} 87]. 5.1.1 HMI Explanation of the sample project TF8040-Concept-Samples-HMI. For more information on the required steps, refer to the sample documentation in the HMI [} 87] section. Contents The individual sample pages of the project are described below. It is advisable to open the live view in order to be able to follow the execution more easily. 88 Version: 1.14.0 TF8040
## Page 89

Examples Header The header is provided with various functions (from left to right). • Logo • Responsive navigation • User settings and further information • Event list • Building information • Outdoor temperature • Date and time Further information on the functions can be found in the documentation for the header [} 1281]. Project navigation The generic project navigation was defined as the start page of the visualization. The content of the Live- View should look like this after the start: TF8040 Version: 1.14.0 89
## Page 90

Examples In the project navigation, you can navigate through the project structure and display the parameters of individual views or objects. For more information on project navigation, see the documentation for Project Navigation Textual [} 1167]. The following pages are located under the entry Content\Samples. Basic Components This page displays all controls that are stored in the BA | Common toolbox category. The controls are not linked to variables from the PLC. Further information can be found in the documentation for controls [} 1122]. 90 Version: 1.14.0 TF8040
## Page 91

Examples Ba Objects On this page, a corresponding control is stored for each primitive data type (Analog, Binary and Multistate). The controls are connected to objects from the PLC and the values are written to the PLC and read again. The following information is displayed per line: • The Description of the object. • The value of the object (writable or read-only). • Button to open the project navigation of the object (only one entry is visible, because single objects are concerned). Event The simulation of the different event types is possible on this page. TF8040 Version: 1.14.0 91
## Page 92

Examples The respective event can be activated via the checkboxes and the behavior can be observed in the event list below. A Ui Icon to display the events is also positioned on the page. The view containing the sample events is linked to both the event list and the Ui Icon. Therefore, no events outside the view are displayed on this page. Trend This page shows the trend control for displaying various trend curves. In this case, the complete project structure was linked to the control. This filters the project structure for all available trends and displays them. You can select and deselect trends on the right-hand side. For more information, see the documentation on Trend [} 1175]. Schedule The schedule displays the current schedule and the weekly schedule. The Calendar tab contains the entries from the linked calendar references and the local exceptions. The buttons at the bottom of the page allow you to switch to other schedule types. In addition, the alignment and accuracy of the schedule can be set. 92 Version: 1.14.0 TF8040
## Page 93

Examples For more information, see the documentation on the Schedule [} 1171]. Room Automation The following list shows the available controls for room automation: Control Description Sunblind [} 1210] Displays and controls the position and angle of a sunblind. Light [} 1203] Displays and controls the brightness value of a lamp (dimmable or on / off). Heating Cooling Displays and controls the air conditioning of a room. [} 1200] Window [} 1214] Shows and controls the position of a window (percentage or open/close). Room Control This control can combine all of the above controls. [} 1206] The controls are for demonstration purposes only and are therefore not linked to variables from the PLC. TF8040 Version: 1.14.0 93
## Page 94

Examples Color Picker On this page, Color Picker is shown in its different versions. Further information can be found in the documentation for the Color Picker [} 1137] 5.2 Template samples The samples in this package are intended to show different templates in the PLC and HMI and how to use them. 5.2.1 HMI Explanation of the sample project TF8040 Template Samples HMI. For more information on the required steps, refer to the sample documentation in the HMI [} 87] section. 94 Version: 1.14.0 TF8040
## Page 95

Examples Components The individual sample pages of the project are described below. The open live view shows many errors. This is because objects in the PLC signal an error if no physical inputs are connected. Project navigation The generic navigation [} 1167] is displayed on the content of this page. Systems Heating circuit Displays a heating circuit. Ventilation and air-conditioning technology Displays a ventilation system. TF8040 Version: 1.14.0 95
## Page 96

Examples Room Displays a sample room. 5.2.2 PLC Explanation of the procedure for starting the sample project TF8040 Template Samples PLC and its contents. 96 Version: 1.14.0 TF8040
## Page 97

Examples Contents The individual templates used in the project are described below. Heating circuit Use of the template FB_BA_Htg Cir01 [} 975]. Ventilation system Use of the template FB_BA_AHU_1st_10 [} 810]. Room sample Use of the template FB_BA_Room Sample1 [} 931]. TF8040 Version: 1.14.0 97
## Page 98

Programming 6 Programming For new projects we strongly recommend to use the version 5 of TF8040! 6.1 PLC 6.1.1 General General information about PLC programming with Twin CAT. Offline Regions Different parameters are intended for different use cases. For easier assignment, parameters are declared within the following regions: Region Description Fixed Parameters Parameter variables for configuration, which can be adjusted for an initialization [} 264]. After an object has been initialized, the variable is no longer designed for changes at runtime! Variable parameters Parameter variables for configuration, which can be adjusted arbitrarily (i.e. also at runtime). Operational Parameters Parameter variables for operation, which can be adjusted by the user as desired (i.e. also at runtime). Fixed Variables To be considered by the application as the Fixed Parameters region. However, variables are only provided for the integrator within the Twin CAT environment! They are not accessible from clients (e.g. Site Explorer [} 1285] or Tc Hmi Ba [} 1120]). Output-Properties Indicates variables that are not made externally accessible by means of VAR_OUTPUT but by a corresponding FB property. In order not to overload a function block with respect to its interface, rarely used variables are implemented in the form of properties. Online Checking The log window should be checked after loading the PLC. If no error messages appear, the program is ready for operation. In this way, a defined initial state is established. 6.1.2 Libraries Twin CAT Building Automation consists of several PLC libraries. 98 Version: 1.14.0 TF8040
## Page 99

Programming These are already available in the system installation and are also supplied with Twin CAT Building Automation: • Tc3_BACnet Rev14 ◦ BACnet function blocks • Tc3_BA2_Common ◦ Basic functions required by Twin CAT Building Automation as well as TF8020 BACnet. Further libraries are exclusively included in the installation of Twin CAT Building Automation: • Tc3_BA2 [} 267] ◦ Application function blocks of the building automation for systems and room automation ◦ basic mathematical functions ◦ basic logical functions • Tc3_XBA [} 99] ◦ Base framework ◦ Site Server for communication with the Site Explorer and the Twin CAT HMI ◦ Objects 6.1.2.1 Tc3_XBA The PLC library Tc3_XBA is an essential element of the Twin CAT Function TF8040. The most important component of this library is the base framework including the site server. 6.1.2.1.1 DUTs 6.1.2.1.1.1 Enumerations 6.1.2.1.1.1.1 E_BA_Role TYPE E_BA_Role : ( Undefined := 0, e Guest := 1, e Basic := 2, e Advanced := 3, e Expert := 4, e Internal := 5, e Locked := 6 ) BYTE; END_TYPE Name Description e Guest Read access of the Present Value for all users. e Basic Read access to a few properties for a limited number of users e Advanced Access for advanced users e Expert Access for experts e Internal Access for service employees e Locked No access 6.1.2.1.1.1.2 Communication 6.1.2.1.1.1.2.1 E_BA_Com State TYPE E_BA_Com State : ( Invalid := 0, Error := 1, TF8040 Version: 1.14.0 99
## Page 100

Programming e Unused := 10, e Initialization := 11, e Operation := 12 ) BYTE; END_TYPE Name Description Invalid No significance for the user. Error A problem has occurred and the object has been excluded from execution. e Unused The communication object is not used by any other object. e Initialization The object is initialized. e Operation The object is in operation. 6.1.2.1.1.1.3 Control 6.1.2.1.1.1.3.1 E_BA_State Loop Sync E_BA_State Loop Sync shows the state of the synchronization of FB_BA_Loop Sync [} 165]. TYPE E_BA_State Loop Sync : ( e Ok := 1, e Err Action := 2, e Err Damp Constant := 3, e Err Derivative Constant := 4, e Err Integral Constant := 5, e Err Max Output Rm := 6, e Err Min Output Rm := 7, e Err Neutral Zone := 8, e Err Op Mode := 9, e Err Proportional Constant := 10 ) UDINT; END_TYPE Name Description e Ok Synchronization is error-free. e Err Action Synchronization of e Action Rm faulty. e Err Damp Constant Synchronization of n Damp Constant faulty. e Err Derivative Constant Synchronization of f Derivative Constant faulty. e Err Integral Constant Synchronization of f Integral Constant faulty. e Err Max Output Rm Synchronization of f Max Output Rm faulty. e Err Min Output Rm Synchronization of f Min Output Rm faulty. e Err Neutral Zone Synchronization of f Err Neutral Zone faulty. e Err Op Mode Synchronization of e Op Mode faulty. e Err Proportional Constant Synchronization of f Proportional Constant faulty. 6.1.2.1.1.1.4 DPAD 6.1.2.1.1.1.4.1 E_BA_Concat DPADMode TYPE E_BA_Concat DPADMode : ( Invalid := 0, e None := 1, e Entry Point := 2, e Parent := 3 ) BYTE; END_TYPE 100 Version: 1.14.0 TF8040
## Page 101

Programming Name Description Invalid No significance for the user. e None The event is not present. e Entry Point Linking the instance to a defined entry point, e.g. plant. e Parent Linking the instance to the parent. 6.1.2.1.1.1.4.2 E_BA_DPADMode TYPE E_BA_DPADMode : ( Invalid := 0, Undefined := 1, e Exclude := 2, e Include := 3, e Include Object Name := 4, e Include Description := 5, ) BYTE; END_TYPE Name Description Invalid No significance for the user. e Exclude No application of the object name and description. e Include Application of the object name and description. e Include Object Name Application of the object name. e Include Description Application of the Description. 6.1.2.1.1.1.5 Events 6.1.2.1.1.1.5.1 E_BA_Acknowledge Mode TYPE E_BA_Acknowledge Mode : ( e Single := 1, e Entire := 2 ); END_TYPE Name Description e Single Acknowledges only the next upcoming event transition. e Entire Acknowledge all unacknowledged event transitions by a single acknowledgement. 6.1.2.1.1.1.5.2 E_BA_Alarm Mode Describes the alarm mode of event-enabled objects. TYPE E_BA_Alarm Mode : ( Undefined := 0, User Defined := 1, e Simple := 2, e Standard := 3, e Extended := 4 ) BYTE; END_TYPE TF8040 Version: 1.14.0 101
## Page 102

Programming Name Description Undefined No function User Defined User-defined pattern Bit combination [TO-OFFNORMAL | TO-FAULT | TO-NORMAL] ACK_REQUIRED x | x | x EVENT_ENABLED x | x | x According to BACnet, any combination of the Acknowledge Required bits (0 or 1) can be used. The Event Notification can be either an event or an alarm Acknowledgement: for each state transition (TO-OFFNORMAL, TO-NORMAL and TO-FAULT) it can be defined whether an acknowledgement is necessary or not. e Simple Neither incoming nor outgoing alarms need to be acknowledged. e Standard Only incoming, but not outgoing alarms need to be acknowledged. Acknowledgement but no reset of the alarm is required. e Extended Both acknowledgement and reset of the alarm are requested. Depending on the acknowledgement mode, a simple acknowledgement may be sufficient to trigger the reset. 6.1.2.1.1.1.5.3 E_BA_Event Condition TYPE E_BA_Event Condition : ( Invalid := 0, // Separated in event-types (See "E_BA_Event Type"): e Type Alarm := TO_BYTE(E_BA_Event Type.e Alarm), e Type Disturb := TO_BYTE(E_BA_Event Type.e Disturb), e Type Maintenance := TO_BYTE(E_BA_Event Type.e Maintenance), e Type Notification := TO_BYTE(E_BA_Event Type.e Notification), e Type Other := TO_BYTE(E_BA_Event Type.e Other), // Separated in object-states (See "ST_Object State Flags"): e Flag Overridden := 6, e Flag Out Of Service := 7, e Flag Fault := 8, e Flag Active Event := 9, // Separated in priorities (See "E_Priority"): e Prio Life Safety := 10, e Prio Critical := 11, e Prio Manual Local := 12, e Prio Manual Remote := 13, // Separated in lock-priorities (See "E_BA_Lock Priority"): e Lock Prio Local Medium := 14, e Lock Prio Local High := 15, e Lock Prio Medium := 16, e Lock Prio High := 17, // Other: e Event Icon Displayed := 18, ) BYTE; END_TYPE 6.1.2.1.1.1.5.4 E_BA_Event Icon State TYPE E_BA_Event Icon State : ( Invalid := 0, e None := 1, e Indicated := 2, e Gone Acked := 3, e Gone := 4, e Present Acked := 5, e Present := 6, ) BYTE; END_TYPE 102 Version: 1.14.0 TF8040
## Page 103

Programming Name Description e None The event is not present. e Indicated The event is not (no longer) present, but is indicated for information purposes until it is acknowledged*. e Gone Acked The event is not present (anymore). However, it has already been acknowledged but not yet reset**. e Gone An event is not present (anymore). However, it was neither acknowledged nor reset*. e Pesent Acked An event is present and has been acknowledged. e Present An event is present. * Only possible with alarm mode standard! ** Only possible with extended alarm mode! 6.1.2.1.1.1.5.5 E_BA_Event Type TYPE E_BA_Event Type : ( Invalid := 0, e Alarm := 1, e Disturb := 2, e Maintenance := 3, e Notification := 4, e Other := 5, ) BYTE; END_TYPE TF8040 Version: 1.14.0 103
## Page 104

Programming Type Symbol in the Twin CAT HMI E_BA_Event Type Alarm e Alarm Fault e Disturb Maintenance e Maintenance Notification e Notification Miscellaneous e Other 6.1.2.1.1.1.5.6 E_BA_Object State Flags TYPE E_BA_Object State Flags: ( e Out Of Service := 1, e Overridden := 2, ) BYTE; END_TYPE 6.1.2.1.1.1.6 Groups 6.1.2.1.1.1.6.1 E_BA_AVal Calc Mode TYPE E_BA_AVal Calc Mode : ( e Undefined := 0, e Min := 1, e Max := 2, e Average := 3 ) BYTE; END_TYPE 104 Version: 1.14.0 TF8040
## Page 105

Programming 6.1.2.1.1.1.6.2 E_BA_BVal Calc Mode TYPE E_BA_BVal Calc Mode : ( e Undefined := 0, e And := 1, e Or := 2, e XOr := 3 ) BYTE; END_TYPE 6.1.2.1.1.1.6.3 E_BA_MVal Calc Mode TYPE E_BA_MVal Calc Mode : ( e Undefined := 0, e Min := 1, e Max := 2 ) BYTE; END_TYPE 6.1.2.1.1.1.7 Objects 6.1.2.1.1.1.7.1 E_BA_Object Purpose TYPE E_BA_Object Purpose : ( Undefined := 0, e Internal := 1, e Structurize := 2, e Descriptive := 3, e General := 10, e Operation := 11, e Value := 12, e Input := 13, e Output := 14, e Management := 20, e Aggregate := 21 ) BYTE; END_TYPE Name Description e Internal Internal management functions (e.g. Event Class objects) e Structurize Organization of the project structure (see Structured View Objects in TF8020) e Descriptive Descriptive information (e.g. project object) e Operation Operative value (setpoint, display value) e Value Value e Input Physical input value e Output Physical output value e Management Manages referenced objects (plant, control, ...) 6.1.2.1.1.1.7.2 Loop 6.1.2.1.1.1.7.2.1 E_BA_Loop Seq State TYPE E_BA_Loop Seq State : ( Invalid := 0, e No Sequence := 1, e Inactive := 2, e Waiting := 3, e Active := 4, e Passed := 5 ) BYTE; END_TYPE TF8040 Version: 1.14.0 105
## Page 106

Programming Name Description Invalid No significance for the user. e No Sequence No sequence active e Inactive Controller inactive e Waiting Waiting for tokens. e Active Operational (The current instance has the token.) e Passed The instance is at the maximum and has passed the token. 6.1.2.1.1.1.7.2.2 E_BA_Seq Direction TYPE E_BA_Seq Direction : ( Invalid := 0, e No Sequence := 1, e Left_to_Right := 2, e Middle_to_Left Or Right := 3, e Right_to_Left := 4 ) BYTE; END_TYPE Name Description e No Sequence No sequence active e Left_to_Right The sequence starts at the loop on the left side, the token moves to the next loops. e Middle_to_Left Or Right Sequence starts in the middle, the token is passed to the next OR previous loop (depending on the control direction of the sequence). e Right_to_Left The sequence starts at the loop on the right side, the token moves to the previous loops. 6.1.2.1.1.1.7.2.3 E_BA_Seq State TYPE E_BA_Seq State : ( Invalid := 0, e Inactive := 1, e Determine Token := 2, e Operation := 3 ) BYTE; END_TYPE Name Description Invalid No significance for the user. e Inactive No enabling a sequenced control. e Determine Token Search of the token to determine the active loop object. e Operation The object is in operation. 6.1.2.1.1.1.7.3 Plant Ctrl 6.1.2.1.1.1.7.3.1 E_BA_Aggregate Ignore Flags TYPE E_BA_Aggregate Ignore Flags : ( None := 0, All := 2#1111_1111, Delay := (e Delay Step Down OR e Delay Step Up), e Processes := 2#0000_0001, e Events := 2#0000_0010, e Delay Step Down := 2#0000_0100, e Delay Step Up := 2#0000_1000 ) BYTE; END_TYPE 106 Version: 1.14.0 TF8040
## Page 107

Programming Name Description e Processes Ignores processes of an aggregate. e Events Ignore the events of an aggregate. e Delay Step Down Ignores a step-down delay from the aggregate. e Delay Step Up Ignores a step-up delay from the aggregate. 6.1.2.1.1.1.8 Parameters 6.1.2.1.1.1.8.1 E_BA_Attribute TYPE E_BA_Attribute : ( Invalid := 0, e Index := 1 ) BYTE; END_TYPE 6.1.2.1.1.1.8.2 E_BA_Commissioning State TYPE E_BA_Commissioning State : ( Invalid := 0, e Unknown := 1, e Checked := 2, e Defect IO := 3, e Defect Wiring := 4, e Defect Device := 5, e Defect Other := 6 ) BYTE; END_TYPE Name Description Invalid No significance for the user. e Unknown State unknown e Checked Checked e Defect IO Input or output defective e Defect Wiring Line defective e Defect Device Field device defective e Defect Other Other defect 6.1.2.1.1.1.8.3 E_BA_Param COVMode TYPE E_BA_Param COVMode : ( Invalid := 0, e None := 1, e Standard := 2, e Manual := 3, e Prioritized := 4 ) BYTE; END_TYPE Name Description Invalid No significance for the user. e None COV display of the parameter is inactive. e Standard COV display of the parameter is evaluated periodically (depending on the load). e Manual COV display is executed, but the changed values must be read or written manually. e Prioritized COV display of the parameter is evaluated in each PLC cycle. TF8040 Version: 1.14.0 107
## Page 108

Programming 6.1.2.1.1.1.8.4 E_BA_Parameter Possible properties of a BACnet object. TYPE E_BA_Parameter : ( Invalid := 0, e Configurate := 1, e Toggle Mode := 2, e Step Delay := 3, e COVIncrement := 4, e Action := 5, e Min Off Time := 6, e Min On Time := 7, e State Change Count := 8, e State Change Time := 9, e State Change Reset Point := 10, e Active Time Elapsed := 11, e Active Time Reset Point := 12, e Instruction Text := 13, e Acked Transitions := 14, e Acknowledge Rm := 15, e En Plant Lock := 16, e Alarm Value := 17, e Alarm Values := 18, e Fault Values := 19, e Time Delay := 20, e Low Limit := 21, e High Limit := 22, e Limit Deadband := 23, e Event Detection Enable := 24, e Event Enable := 25, e Event Class ID := 26, e Event Transition Text := 29, e Event State := 30, e Status Flags := 31, e Reliability := 32, e Enable := 33, e Out Of Service := 34, e Inactive Text := 35, e Active Text := 36, e State Text := 37, e State Count := 38, e Unit := 39, e Present Value := 40, e Default Value := 41, e Tag := 42, e Assign As Trend Reference := 43, e Device Type := 44, e Polarity := 45, e Mapping Mode := 46, e Feedback Mapping Mode := 47, e Feedback Polarity := 48, e Overridden Polarity := 49, e Scale Offset := 50, e Resolution := 51, e Feedback Value := 52, e Raw Value := 53, e Raw Feedback := 54, e Raw Override := 55, e Raw State := 56, e Terminal := 57, e Sensor := 58, e Address := 59, e Commissioning State := 60, e Symbol Path := 61, e Symbol Name := 62, e Instance ID := 63, e Object Name := 64, e Description := 65, e Object Type := 66, e Purpose := 67, e Node Type := 68, e Priority Array := 69, e Active Priority := 70, e Project Info := 71, e Operator Info := 72, e Technical Staff Info := 73, e Engineer Info := 74, e Date List := 75, 108 Version: 1.14.0 TF8040
## Page 109

Programming e Event Type := 76, e Alarm Mode := 77, e Priority := 78, e Acknowledge Required := 79, e Setpoint := 80, e Controlled Value := 81, e Ctrl Deviation := 82, e Proportional Constant := 83, e Integral Constant := 84, e Derivative Constant := 85, e Damp Constant := 86, e Output Unit := 87, e Op Mode := 88, e Neutral Zone := 89, e Synchronized Loop := 90, e Min Output := 91, e Max Output := 92, e Week := 93, e Exception List := 94, e Referenced Param := 95, e Buffer Size := 96, e Log Buffer := 97, e Logging Type := 98, e Log Interval := 99, e Start Time := 100, e Stop Time := 101, e Stop On Full := 102, e Notification Threshold := 103, e Record Count := 104, e Total Record Count := 105 ) BYTE; END_TYPE 6.1.2.1.1.1.8.5 E_BA_Param Purpose TYPE E_BA_Param Purpose : ( Invalid := 0, e Unique := 1, e Individual := 2, e Individual Setting := 3, e Setting := 4, e Operational := 5, e State := 6 ) BYTE; END_TYPE Name Description Invalid No significance for the user. e Unique Unique parameter value that should not be used by multiple objects. e Individual Individual parameter per object instance. e Individual Setting Individual setting per object instance. e Setting General setting 6.1.2.1.1.1.8.6 E_BA_Param Sync Mode TYPE E_BA_Param Sync Mode : ( Invalid := 0, e Default := 1, e Initial Write := 3, e Status Flags := 4, e Event Transitions := 5, e Event Transition Bits := 6, e Beta Buffered := 7 ) BYTE; END_TYPE Name Description e Initial Write The parameter is initialized by a single write command. TF8040 Version: 1.14.0 109
## Page 110

Programming 6.1.2.1.1.1.9 Priority 6.1.2.1.1.1.9.1 E_BA_Lock Priority TYPE E_BA_Lock Priority : ( Invalid := 0, e No Lock := 1, e Local Medium := 2, e Local High := 3, e Medium := 4, e High := 5 ) BYTE; END_TYPE Name Description Invalid No significance for the user. e Nolock No locking e Local Medium The event of an object triggers a switching action by means of the FB_BA_Plant Lock [} 135], which is located in the same level within the basic structure. The level of priority is "Medium" and generally refers to a technical fault or to the safety of a plant. e Local High The event of an object triggers a switching action by means of the FB_BA_Plant Lock [} 135], which is located in the same level within the basic structure. The level of priority is "High" and generally refers to an alarm or life safety. e Medium The event of an object triggers a switching action. It is reported to all FB_BA_Plant Lock [} 135] that are located in the levels of the basic frame above. The priority is "Medium" and generally refers to a technical fault or to the safety of a plant. e High The event of an object triggers a switching action. It is reported to all FB_BA_Plant Lock [} 135] that are located in the levels of the basic frame above. The priority is "High" and generally refers to an alarm or the safety of life. 6.1.2.1.1.1.9.2 E_BA_Priority TYPE E_BA_Priority : ( Invalid := 0, e Default := 1, e Program := 2, e Manual Remote := 3, e Manual Local := 4, e Critical := 5, e Life Safety := 6, ) BYTE; END_TYPE Name Description Invalid No significance for the user. e Default Default setting if no priority is selected. e Program Control by the program. e Manual Remote Manual override by parameters. e Manual Local Manual override, e.g. via switch. e Critical Settings for the operation of critical parts of the plant e Life Safety 110 Version: 1.14.0 TF8040
## Page 111

Programming 6.1.2.1.1.1.10 References 6.1.2.1.1.1.10.1 E_BA_Assign Ref Mode Determination of an object as a reference in a related (e.g. trend) object. TYPE E_BA_Assign Ref Mode : ( e None := 1, e Assign Now := 2, e Init By Profile := 3 ) BYTE; END_TYPE Name Description e Assign Now Assign reference immediately e Init By Profile Assign reference when initializing the object, provided it is enabled in the associated object profile. 6.1.2.1.1.1.11 Supplements 6.1.2.1.1.1.11.1 E_BA_Supplement Type TYPE E_BA_Supplement Type : ( Invalid := 0, All := 1, e PLC := 10, e BACnet := 11, ) BYTE; END_TYPE 6.1.2.1.1.1.12 Types 6.1.2.1.1.1.12.1 E_BA_Node Type TYPE E_BA_Node Type : ( Invalid := 0, Automatic := 1, {region 'Default'} e Unknown := 10, e Other := 11, e General := 12, {endregion} {region 'Location'} e Location := 13, e Building := 14, e Building Element := 15, e Information Focus := 16, e Control Cabinet := 17, e Trade := 18, e Floor := 19, e Room := 20, e Plant := 21, {endregion} {region 'Equipment'} e Component := 22, e Aggregate := 23, e Function := 24 {endregion} ) BYTE; END_TYPE Name Description Invalid No significance for the user. Automatic The system chooses a meaningful node type. TF8040 Version: 1.14.0 111
## Page 112

Programming 6.1.2.1.1.1.12.2 E_BA_Object Type TYPE E_BA_Object Type : ( Invalid := 0, Undefined := 1, {region 'Analog'} e Analog Input := 10, e Analog Output := 11, e Analog Value := 12, {endregion} {region 'Binary'} e Binary Input := 15, e Binary Output := 16, e Binary Value := 17, {endregion} {region 'Multistate'} e Multistate Input := 20, e Multistate Output := 21, e Multistate Value := 22, {endregion} {region 'Misc'} e Object := 25, e Structured View := 26, e Project := 27, e Event Class := 28, e Calendar := 29, e Schedule := 30, e Loop := 31, e Trend := 32, {endregion} ) BYTE; END_TYPE 6.1.2.1.1.1.13 Functional 6.1.2.1.1.1.13.1 E_BA_Node Type Target The enumeration describes the relative reference to an object. Sample In the following project structure: • the ventilation Ventilation System 1 is a system • the air heater Pre Htr is an aggregate • the pump Pump is an aggregate • the command Cmd is a function In relation to the system Ventilation System 1: • the air heater Pre Htr is the first aggregate • the pump Pump is the last aggregate • the command Cmd is the function TYPE E_BA_Node Type Target : ( Invalid := 0, e First Aggregate := 1, e Last Aggregate := 2, e Function := 3 ) BYTE; END_TYPE 112 Version: 1.14.0 TF8040
## Page 113

Programming Name Description Invalid No significance for the user. e First Aggregate Refers to the first aggregate in relation to an object. e Last Aggregate Refers to the last aggregate in relation to an object. e Function Refers to the function in relation to an object. 6.1.2.1.1.1.13.2 E_BA_Project State TYPE E_BA_Project State : ( Invalid := 0, Error := 1, e Prepare := 10, e Pre Init := 11, e Validate Objects := 12, e Reference Init := 13, e Object Finish Init := 14, e Project Init := 15, e First Op Cycle := 16, e Operation := 17 ) BYTE; END_TYPE 6.1.2.1.1.1.13.3 E_BA_Object State TYPE E_BA_Project State : ( Invalid := 0, Error := 1, Idle := 2, e Prepare := 10, e Pre Init1 := 11, e Pre Init2 := 12, e Synchronize State := 13, e Instance Init1 := 14, e Instance Init2 := 15, e Instance Init3 := 16, e Instance Init4 := 17, e Com Init Device := 18, e Com Init Object := 19, e Prepare Supplement := 20, e Wait For Supplement Init := 21, e Supplement Inst Init := 22, e Supplement Init := 23, e Post Init := 23, e Wait For Project := 24, e Operation := 25 ) BYTE; END_TYPE 6.1.2.1.1.1.13.4 E_BA_Process Signal Source TYPE E_BA_Object Type : ( Invalid := 0, e Var Input := 1, e Parameter := 2 ) BYTE; END_TYPE 6.1.2.1.1.1.13.5 E_BA_Subscriber State TYPE E_BA_Subscriber State : ( Invalid := 0, e Init := 1, e Init Subscription := 2, e Reading := 3, e Ready := 4, e Suppressing := 5, e Error := 6, TF8040 Version: 1.14.0 113
## Page 114

Programming ) BYTE; END_TYPE 6.1.2.1.1.1.13.6 E_BA_Init State The enumeration describes the state of the initialization. Syntax {attribute 'qualified_only'} TYPE E_BA_Init State : ( Invalid := 0, e Pre Init Instance := 1, e Init Instance Param := 2, e Init Instance Dependency := 3, e Post Init Instance := 4, e Init Com Device := 5, e Pre Init Supplement := 6, e Post Init Supplement Inst := 7, e Post Init Supplement := 8, e Pre First Execute := 9, e Post First Execute := 10 ) BYTE; END_TYPE Name Description e Pre Init Instance Pre-initialization of the instance. e Init Instance Param Initialization of the instance parameters. e Init Instance Dependency Initialization of instance dependencies. e Post Init Instance Post-initialization of the instance. e Init Com Device Initialization of the Com Device. e Pre Init Supplement Pre-initialization of supplements. e Post Init Supplement Inst Completion of the initialization of an instance part of a supplement. e Post Init Supplement Initialization of supplements is complete. e Pre First Execute Before the first execution. e Post First Execute After the first execution. 6.1.2.1.1.2 Types 6.1.2.1.1.2.1 ST_BA_Object Attributes TYPE ST_BA_Object Attributes : STRUCT s Parent : REFERENCE TO STRING; s Label : REFERENCE TO STRING; s Profile : REFERENCE TO STRING; e Data Class : E_BA_Data Class := E_BA_Data Class. Invalid; e Purpose : E_BA_Object Purpose := E_BA_Object Purpose. Undefined; END_STRUCT END_TYPE 6.1.2.1.1.2.2 ST_BA_Subject Attributes TYPE ST_BA_Subject Attributes : STRUCT s Identifier : T_BA_Med String; n Index : UDINT(1 .. 1000000) := 1; n Hash : DWORD; END_STRUCT END_TYPE 114 Version: 1.14.0 TF8040
## Page 115

Programming 6.1.2.1.1.2.3 DPAD 6.1.2.1.1.2.3.1 ST_BA_DPAD_Identifier TYPE ST_BA_DPAD_Identifier: STRUCT e Mode : E_BA_DPADMode := E_BA_DPADMode.e Include; e Node Type : E_BA_Node Type; n Index Digits : UINT := XBA_Param.n DPAD_Def Index Digits; {attribute 'Tc Encoding':='UTF-8'} s Separator_Object Name : T_BA_Short String := XBA_Param.s DPAD_Object Name_Def Separator; {attribute 'Tc Encoding':='UTF-8'} s Separator_Description : T_BA_Short String := XBA_Param.s DPAD_Description_Def Separator; END_STRUCT END_TYPE 6.1.2.1.1.2.4 Events 6.1.2.1.1.2.4.1 ST_BA_Event Icon TYPE ST_BA_Event Icon : STRUCT e Event Type : E_BA_Event Type := E_BA_Event Type. Invalid; e State : E_BA_Event Icon State := E_BA_Event Icon State. Invalid; END_STRUCT END_TYPE 6.1.2.1.1.2.4.2 ST_BA_Events Per Icon Image TYPE ST_BA_Events Per Icon Image : STRUCT e Most Priorised State : E_BA_Event Icon State := E_BA_Event Icon State. Invalid; n Count : UDINT; END_STRUCT END_TYPE Name Type Description e Most Priorised State E_BA_Event Icon State Highest priority icon state with one or more active events. [} 102] n Count UDINT Number of active events depending on the highest prioritized icon state. 6.1.2.1.1.2.4.3 T_BA_Event Condition Flags TYPE T_BA_Event Condition Flags : ARRAY[E_BA_Event Condition. First .. E_BA_Event Condition. Last] OF BOOL ; END_TYPE 6.1.2.1.1.2.4.4 T_BA_Event Transitions TYPE T_BA_Event Transitions : ARRAY[E_BA_Event Transition. First .. E_BA_Event Transition. Last] OF BOOL; END_TYPE 6.1.2.1.1.2.4.5 T_BA_Event Transition Text TYPE T_BA_Event Transition Text : ARRAY [E_BA_Event Transition. First .. E_BA_Event Transition. Last] OF S TRING(BA_Param.n Event Transition Text_Length); END_TYPE 6.1.2.1.1.2.4.6 History 6.1.2.1.1.2.4.6.1 ST_BA_Event History Entry TYPE ST_BA_Event History Entry : STRUCT i Object : I_BA_Event Object; n Event Increment : UINT; dt Time Stamp : DT; TF8040 Version: 1.14.0 115
## Page 116

Programming st Event : ST_BA_Event Icon; e Reliability : E_BA_Reliability; st State Flags : ST_BA_Status Flags; e Lock Priority : E_BA_Lock Priority; END_STRUCT END_TYPE 6.1.2.1.1.2.5 Info 6.1.2.1.1.2.5.1 ST_BA_Com Stat TYPE ST_BA_Com Stat : STRUCT n Req : UDINT; n Bad Rsp : UDINT; n Good Rsp : UDINT; END_STRUCT END_TYPE Name Type Description n Req UDINT Requests received n Bad Rsp UDINT Requests that generated an ADS error in response. n Good Rsp UDINT Requests that did not generate an ADS error in response. 6.1.2.1.1.2.5.2 ST_BA_Contact Info TYPE ST_BA_Contact Info : STRUCT {attribute 'Tc Encoding':='UTF-8'} s Name : STRING; {attribute 'Tc Encoding':='UTF-8'} s Phone : STRING; {attribute 'Tc Encoding':='UTF-8'} s Mail : STRING; {attribute 'Tc Encoding':='UTF-8'} s Website : STRING; END_STRUCT END_TYPE 6.1.2.1.1.2.5.3 ST_BA_Cum Obj State TYPE ST_BA_Cum Obj State : STRUCT n Pending Init : UDINT n Operational : UDINT; n Error : UDINT; END_STRUCT END_TYPE Name Type Description n Pending Init UDINT Number of objects to be initialized. n Operational UDINT Number of objects ready for operation (initialization completed). n Error UDINT Number of objects in error state (initialization failed). 6.1.2.1.1.2.5.4 ST_BA_Device Info TYPE ST_BA_Device Info : STRUCT s Ams Net ID : T_Ams Net Id; dt Now : DT; st Site Server : ST_BA_Com Stat; st Site Client : ST_BA_Com Stat; END_STRUCT END_TYPE 116 Version: 1.14.0 TF8040
## Page 117

Programming 6.1.2.1.1.2.5.5 ST_BA_Project Info TYPE ST_BA_Project Info : STRUCT {attribute 'Tc Encoding':='UTF-8'} s Title : STRING; {attribute 'Tc Encoding':='UTF-8'} s Description : STRING; {attribute 'Tc Encoding':='UTF-8'} s Location : STRING; END_STRUCT END_TYPE 6.1.2.1.1.2.5.6 ST_BA_Runtime Info TYPE ST_BA_Runtime Info : STRUCT n Task Count : UDINT; n Online Changes : UDINT; b Persistent Data Valid : BOOL; dt Compile Time : DT; s Namespace : STRING; END_STRUCT END_TYPE 6.1.2.1.1.2.5.7 ST_BA_Supplement Info TYPE ST_BA_Supplement Info : STRUCT PLC : ST_BA_Spl Info_PLC; BACnet : ST_BA_Spl Info_BACnet; END_STRUCT END_TYPE 6.1.2.1.1.2.5.8 ST_BA_Task Info TYPE ST_BA_Task Info : STRUCT {attribute 'parameter Unit':= 'ms'} n Cycle Time : UDINT; n Cycle Count : UDINT; n Priority : UINT; n ADSPort : UINT; END_STRUCT END_TYPE 6.1.2.1.1.2.5.9 ST_BA_Version Info TYPE ST_BA_Version Info : STRUCT {attribute 'Ba Guid':='00000001-0001-0001-0150-000000000003'} {attribute 'Tc Encoding':='UTF-8'} Tc3_XBA : STRING(23); {attribute 'Ba Guid':='00000001-0001-0001-0151-000000000004'} {attribute 'Tc Encoding':='UTF-8'} Tc3_BA2_Common : STRING(23); {attribute 'Ba Guid':='00000001-0001-0001-0170-000000000004'} {attribute 'Tc Encoding':='UTF-8'} Tc3_BACnet Rev14 : STRING(23); {attribute 'Ba Guid':='00000001-0000-0000-0200-000000000200'} {attribute 'Tc Encoding':='UTF-8'} s BACnet_Stack : STRING(23); {attribute 'Ba Guid':='00000001-0000-0000-0201-000000000300'} n BACnet_Revision : DINT; {attribute 'Ba Guid':='00000001-0001-0001-0001-000000000001'} {attribute 'Tc Encoding':='UTF-8'} Project : STRING(23); END_STRUCT END_TYPE TF8040 Version: 1.14.0 117
## Page 118

Programming 6.1.2.1.1.2.5.10 Supplements 6.1.2.1.1.2.5.10.1 ST_BA_Spl Info_BACnet TYPE ST_BA_Spl Info_BACnet EXTENDS ST_BA_Base Supplement Info : STRUCT s Ams Net ID : T_Ams Net Id; t Ams Port : T_Ams Port; n Device ID : UDINT; e Device Status : E_BACnet_Device Status; b Is Operational : BOOL; e Error ID : E_BACnet_Error; n Local Objects : UDINT; END_STRUCT END_TYPE 6.1.2.1.1.2.5.10.2 ST_BA_Spl Info_PLC TYPE ST_BA_Spl Info_PLC EXTENDS ST_BA_Base Supplement Info : STRUCT st Local Objects : ST_BA_Cum Obj State; END_STRUCT END_TYPE 6.1.2.1.1.2.5.10.3 [Base] 6.1.2.1.1.2.5.10.3.1 ST_BA_Base Supplement Info TYPE ST_BA_Base Supplement Info : STRUCT b Is Enabled : BOOL; END_STRUCT END_TYPE 6.1.2.1.1.2.6 Objects 6.1.2.1.1.2.6.1 ST_BA_Object Identifier The ST_BA_Object Identifier structure contains the instance ID of the object types. TYPE ST_BA_Object Identifier : STRUCT e Object Type : E_BA_Object Type := E_BA_Object Type. Invalid; n Instance ID : UDINT := 0; END_STRUCT END_TYPE 6.1.2.1.1.2.6.2 Loop 6.1.2.1.1.2.6.2.1 ST_BA_Seq Stand By Info TYPE ST_BA_Seq Stand By Info : STRUCT n En Count : UINT; i First En : I_BA_Loop Seq; i Last En : I_BA_Loop Seq; i First Dmd : I_BA_Loop Seq; i Last Dmd : I_BA_Loop Seq; i Last Reverse : I_BA_Loop Seq; i First Direct : I_BA_Loop Seq; n Action Invert Count : UINT; n Direct Count : UINT; n Reverse Count : UINT; i Active : I_BA_Loop Seq; END_STRUCT END_TYPE 118 Version: 1.14.0 TF8040
## Page 119

Programming Name Type Description n En Count UINT Count of released instances. i First En I_BA_Loop Seq Reference of the first released loop object. i Last En I_BA_Loop Seq Reference of the last released loop object. i First Dmd I_BA_Loop Seq Reference of the first requested loop object. i Last Dmd I_BA_Loop Seq Reference of the last requested loop object. i Last Reverse I_BA_Loop Seq Reference of the last loop object with indirect control direction. i First Direct I_BA_Loop Seq Reference of the first loop object with direct control direction. n Action Invert Count UINT Counter of the instances that reverse the control direction. n Direct Count UINT Counter of instances with direct control direction n Reverse Count UINT Counter of instances with indirect control direction. i Active I_BA_Loop Seq Reference with the current token. 6.1.2.1.1.2.6.3 Trend 6.1.2.1.1.2.6.3.1 ST_BA_Trend Settings TYPE ST_BA_Trend Settings : STRUCT b Enable : BOOL := FALSE; e Logging Type : E_BA_Logging Type := E_BA_Logging Type.e Polled; {attribute 'parameter Unit':= 's'} n Log Interval : UDINT := BA_Param.n Trend_Def Log Interval; END_STRUCT END_TYPE 6.1.2.1.1.2.6.4 Value 6.1.2.1.1.2.6.4.1 ST_BA_Event Object Value TYPE ST_BA_Event Object Value EXTENDS ST_BA_Object Value : STRUCT b Event : BOOL; END_STRUCT END_TYPE 6.1.2.1.1.2.6.4.2 ST_BA_Object Value TYPE ST_BA_Object Value : STRUCT u Present Value : U_BA_Class Value; END_STRUCT END_TYPE 6.1.2.1.1.2.6.4.3 ST_BA_Sched Value TYPE ST_BA_Sched Value EXTENDS ST_BA_Object Value : STRUCT u Predicted Value : U_BA_Class Value; END_STRUCT END_TYPE 6.1.2.1.1.2.6.4.4 ST_BA_Trend Value TYPE ST_BA_Trend Value EXTENDS ST_BA_Event Object Value : STRUCT n Record Count : UDINT; n Total Record Count : UDINT; END_STRUCT END_TYPE TF8040 Version: 1.14.0 119
## Page 120

Programming 6.1.2.1.1.2.7 Parameter 6.1.2.1.1.2.7.1 ST_BA_Limit Param TYPE ST_BA_Limit Param : STRUCT b Enable : BOOL; f Value : REAL; END_STRUCT END_TYPE 6.1.2.1.1.2.7.2 ST_BA_Object Parameter TYPE ST_BA_Object Parameter : STRUCT {region 'Reference'} i Object : I_BA_Object := 0; st Object : ST_BA_Object Identifier; {endregion} {region 'Parameter'} e Parameter : E_BA_Parameter := E_BA_Parameter.e Present Value; {endregion} END_STRUCT END_TYPE 6.1.2.1.1.2.7.3 ST_BA_Step Delay Param TYPE ST_BA_Step Delay Param : STRUCT {attribute 'parameter Unit':= 's'} n Down : UDINT; {attribute 'parameter Unit':= 's'} n Up : UDINT; END_STRUCT END_TYPE 6.1.2.1.1.2.7.4 ST_BA_Time Delay Param TYPE ST_BA_Time Delay Param : STRUCT {attribute 'parameter Unit':= 's'} n To Abnormal : UDINT; {attribute 'parameter Unit':= 's'} n To Normal : UDINT; END_STRUCT END_TYPE 6.1.2.1.1.2.7.5 T_BA_Med String TYPE T_BA_Med String : STRING(64); END_TYPE 6.1.2.1.1.2.7.6 T_BA_Short String TYPE T_BA_Short String : STRING(12); END_TYPE 6.1.2.1.1.2.7.7 T_BA_Small String TYPE T_BA_Small String : STRING(32); END_TYPE 6.1.2.1.1.2.7.8 Calendar 6.1.2.1.1.2.7.8.1 T_BA_Calendar Date List TYPE T_BA_Calendar Date List : ARRAY[1 .. XBA_Param.n Cal_Entry Count] OF ST_BA_Calendar Entry; END_TYPE 120 Version: 1.14.0 TF8040
## Page 121

Programming 6.1.2.1.1.2.7.9 Multistate 6.1.2.1.1.2.7.9.1 T_BA_State Text TYPE T_BA_State Text : STRING(XBA_Param.n State Text_Length); END_TYPE 6.1.2.1.1.2.7.9.2 T_BA_State Text Array TYPE T_BA_State Text Array : ARRAY[1 .. XBA_Param.n Multistate_State Count] OF T_BA_State Text; END_TYPE 6.1.2.1.1.2.7.10 References 6.1.2.1.1.2.7.10.1 ST_BA_Attribute Info Describes details for defined attributes. TYPE ST_BA_Attribute Info : STRUCT s Shortcut : T_BA_Short String; e Data Type : E_BA_Data Type := E_BA_Data Type. Invalid; END_STRUCT END_TYPE 6.1.2.1.1.2.7.10.2 ST_BA_Sync Info TYPE ST_BA_Sync Info : STRUCT b Changed : BOOL; END_STRUCT END_TYPE 6.1.2.1.1.2.7.10.3 U_BA_Param Ref TYPE U_BA_Param Ref : UNION fb1P : POINTER TO FB_BA_1Param Ref; fb2P : POINTER TO FB_BA_2Param Ref; fb3P : POINTER TO FB_BA_3Param Ref; fb4P : POINTER TO FB_BA_4Param Ref; fb5P : POINTER TO FB_BA_5Param Ref; fb Arr P : POINTER TO FB_BA_Array Param Ref; fb En P : POINTER TO FB_BA_En Param Ref; fb Prio P : POINTER TO FB_BA_Prio Param Ref; END_UNION END_TYPE 6.1.2.1.1.2.7.11 Scheduler 6.1.2.1.1.2.7.11.1 ST_BA_Sched Calendar The ST_BA_Sched Calendar structure describes a calendar reference from an exception (Exception Schedule). TYPE ST_BA_Sched Calendar : STRUCT i Ref Calendar : I_BA_Object; a Entry : ARRAY[1 .. XBA_Param.n Sched_Entry Count] OF ST_BA_Sched Entry; END_STRUCT END_TYPE 6.1.2.1.1.2.7.11.2 ST_BA_Sched Exception The ST_BA_Sched Exception structure describes a calendar set of exceptions (Exception Schedule). TYPE ST_BA_Sched Exception : STRUCT e Type : E_BA_Date Val Choice := E_BA_Date Val Choice. Invalid; TF8040 Version: 1.14.0 121
## Page 122

Programming u Date : U_BA_Date Val; a Entry : T_BA_Sched Exception Entry List; END_STRUCT END_TYPE 6.1.2.1.1.2.7.11.3 T_BA_Sched Calendar The type declaration combines individual exceptions into an array for the exception scheduler. TYPE T_BA_Sched Calendar : ARRAY[1 .. XBA_Param.n Sched_Calendar Count] OF ST_BA_Sched Calendar; END_TYP E 6.1.2.1.1.2.7.11.4 T_BA_Sched Exception Entry List The type declaration combines individual exceptions into an array for the exception scheduler. TYPE T_BA_Sched Exception Entry List : ARRAY[1 .. XBA_Param.n Sched_Entry Count] OF ST_BA_Sched Entry; END _TYPE 6.1.2.1.1.2.7.11.5 T_BA_Sched Exception List The type declaration combines individual exceptions into an array for the exception scheduler. TYPE T_BA_Sched Exception List : ARRAY[1 .. XBA_Param.n Sched_Exception Count] OF ST_BA_Sched Exception; END_TYPE 6.1.2.1.1.2.7.11.6 T_BA_Sched Week The type declaration combines individual scheduler entries into an array for a weekly scheduler. TYPE T_BA_Sched Week : ARRAY[E_BA_Weekday. First .. E_BA_Weekday. Last, 1 .. XBA_Param.n Sched_Entry Coun t] OF ST_BA_Sched Entry; END_TYPE 6.1.2.1.1.2.7.12 Trend 6.1.2.1.1.2.7.12.1 T_BA_Trend Log Buffer TYPE T_BA_Trend Log Buffer : ARRAY [1 .. XBA_Param.n Trend_Buffer Size] OF ST_BA_Trend Entry; END_TYPE 6.1.2.1.1.2.8 Stepped 6.1.2.1.1.2.8.1 ST_BA_Active Info TYPE ST_BA_Active Info : STRUCT i Reference : I_BA_Object; {attribute 'Tc Encoding':='UTF-8'} s Symbol Name : REFERENCE TO STRING; {attribute 'Tc Encoding':='UTF-8'} s Description : REFERENCE TO T_Max String; i Blocking Process : I_BA_Process; END_STRUCT END_TYPE 6.1.2.1.1.2.8.2 ST_BA_Plant Aggregate Reference TYPE ST_BA_Plant Aggregate Reference : STRUCT i Reference : I_BA_Aggregate; a Agg Mode : ARRAY [1 .. XBA_Param.n Plant Ctrl_Op Mode Count] OF UDINT; {region 'Step Conditions'} b Wait For Processes : BOOL := FALSE; b Wait For Events : BOOL := FALSE; t Delay Step Down : TIME; t Delay Step Up : TIME; {endregion} END_STRUCT END_TYPE 122 Version: 1.14.0 TF8040
## Page 123

Programming Name Type Description b Wait For Processes BOOL Active processes that are taken into account when approaching steps. b Wait For Events BOOL Events of this (and a higher) lock priority, which are taken into account when changing steps. 6.1.2.1.1.2.8.3 ST_BA_Plant Operation TYPE ST_BA_Plant Operation : STRUCT a Op Mode : ARRAY [1 .. XBA_Param.n Plant Ctrl_Op Mode Count] OF UDINT; a Priority : ARRAY [1 .. XBA_Param.n Plant Ctrl_Op Mode Count] OF E_BA_Priority := [ XBA_ Param.n Plant Ctrl_Op Mode Count(E_BA_Priority.e Default) ]; a Ignore Flags : ARRAY [1 .. XBA_Param.n Plant Ctrl_Op Mode Count] OF E_BA_Aggregate Ignore Flags := [ XBA _Param.n Plant Ctrl_Op Mode Count(E_BA_Aggregate Ignore Flags. None) ]; a Aggregates : ARRAY [1 .. XBA_Param.n Plant Ctrl_Aggregate Count] OF ST_BA_Plant Aggregate Reference; END_STRUCT END_TYPE 6.1.2.1.1.2.9 Supplements 6.1.2.1.1.2.9.1 ST_BA_Supplement Ref TYPE ST_BA_Supplement Ref : STRUCT i Instance : I_BA_Supplement Object; e Type : E_BA_Supplement Type := E_BA_Supplement Type. Invalid; END_STRUCT END_TYPE 6.1.2.1.1.2.9.2 BACNet 6.1.2.1.1.2.9.2.1 ST_BA_BACnet_Prop Sync Info TYPE ST_BA_BACnet_Prop Sync Info : STRUCT e Property : E_BACnet Prop Identifier; e Sync Mode : E_BA_Param Sync Mode := E_BA_Param Sync Mode. Invalid; END_STRUCT END_TYPE 6.1.2.1.1.2.10 Universal 6.1.2.1.1.2.10.1 Sequence 6.1.2.1.1.2.10.1.1 ST_BA_Seq Link Data and command structure between the individual sequence controllers FB_BA_Seq Ctrl [} 168] and the function block FB_BA_Sequence Link Base [} 171]. TYPE ST_BA_Seq Link : STRUCT arr Seq Link Data : ARRAY[1.. BA_Param.n Max Seq Ctrl] OF ST_BA_Seq Link Data; f E : REAL; n Actv Seq Ctrl : UDINT; b Sync : BOOL; b En Seq Link : BOOL; END_STRUCT END_TYPE TF8040 Version: 1.14.0 123
## Page 124

Programming Name Type Description arr Seq Link Data ST_BA_Seq Link Data Data and commands of the individual sequence controllers [} 124] f E REAL Control deviation Direct: f E = f X - f W Indirect: f E = f W - f X n Actv Seq Ctrl UDINT Number of the active sequence controller. b Sync BOOL Pulse - synchronization b En Seq Link BOOL Enable b En of the FB_BA_Sequence Link Base 6.1.2.1.1.2.10.1.2 ST_BA_Seq Link Data This structure contains the data and commands of the individual FB_BA_Seq Ctrl [} 168] sequence controllers. TYPE ST_BA_Seq Link Data : STRUCT f Y : REAL; f YMin : REAL; f YMax : REAL; f W : REAL; f X : REAL; f E : REAL; n Actv Seq Ctrl : UDINT; n My Num : UDINT; e Actn : E_BA_Action; b Seq Ctrl Operable : BOOL; b Watchdog : BOOL; b Seq Num Multiple : BOOL; b En : BOOL; b Is Actv Seq Ctrl : BOOL; END_STRUCT END_TYPE Name Type Description f Y REAL Control value f YMin REAL Minimum control value f YMax REAL Maximum control value f W REAL Setpoint f X REAL Actual value f E REAL Control deviation Direct: f E = f X - f W Indirect: f E = f W - f X n Actv Seq Ctrl UDINT Number of the active sequence controller. n My Num UDINT My number in the sequence e Actn E_BA_Action Controller control direction b Seq Ctrl Operable BOOL Sequence controller is ready to operate. b Watchdog BOOL Watchdog is set at each PLC cycle in each sequence controller and reset after evaluation in the sequence link. b Seq Num Multiple BOOL Sequence number assigned several times in the sequence controllers. b En BOOL Enable the sequence controller. b Is Actv Seq Ctrl BOOL Active sequence controller 6.1.2.1.2 GVLs 6.1.2.1.2.1 XBA_Globals VAR_GLOBAL {region 'General'} Diag : FB_BA_Diagnosis; 124 Version: 1.14.0 TF8040
## Page 125

Programming Top : FB_BA_Top View; {endregion} {region 'Indicators'} n Inc Obj Initial : UINT := 1; n Inc Obj Active Priority : UINT := 1; n Inc Obj Status : UINT := 1; n Inc Event : UDINT := 1; n Inc Event Config : UINT := 1; {endregion} END_VAR VAR_GLOBAL CONSTANT {region 'Constants'} {region 'General'} n Inst Id_Auto : UDINT := BACnet_Globals.n BACnet Inst Id_Auto; guid Undefined : GUID := (Data1:=16#0, Data2:=16#0, Data3:=16#0, Data4:=[16#0 ,16#0,16#0,16#0,16#0,16#0,16#0,16#0]); n No Active Prio : UDINT := 16#FFFFFFFF; {endregion} {region 'Text generation'} s Placeholder Sign_Open : STRING(1) := '{'; s Placeholder Sign_Close : STRING(1) := '}'; s Placeholder Sign_Delimiter : STRING(1) := ','; s Placeholder Sign_Deny Concat : STRING(1) := '!'; s Placeholder_Empty : STRING(2) := CONCAT(s Placeholder Sign_Open, s Placeholder Sign_Cl ose); st Undefined Identifier : ST_BA_Object Identifier := (e Object Type:=E_BA_Object Type. Undefi ned, n Instance ID:=0); {endregion} {region 'Event'} //Acknowledgement a Ack Flags_None : T_BA_Event Transitions := F_BA_Event Transition(FALSE, FALSE, FA LSE); // Pre-defined indicator filters: a Ind Filter_None : T_BA_Event Condition Flags := [ E_BA_Event Condition. Count(TRUE) ]; a Ind Filter_Evt All : T_BA_Event Condition Flags := [ E_BA_Event Type. Count(TRUE) ]; a Ind Filter_Evt : ARRAY[E_BA_Event Type. First .. E_BA_Event Type. Last] OF T_BA_Eve nt Condition Flags := [ (* e Alarm *) [ TRUE, FALSE, FALSE, FALSE, FALSE ], (* e Disturb *) [ FALSE, TRUE, FALSE, FALSE, FALSE ], (* e Maintenance *) [ FALSE, FALSE, TRUE, FALSE, FALSE ], (* e Notification *) [ FALSE, FALSE, FALSE, TRUE, FALSE ], (* e Other *) [ FALSE, FALSE, FALSE, FALSE, TRUE ] ]; {endregion} {endregion} END_VAR TF8040 Version: 1.14.0 125
## Page 126

Programming Name Type Description Diag FB_BA_Diagnosis Provides information about the project and offers information and diagnosis options: • Current system time • Set cycle times • Libraries and BACnet drivers used • Number of BACnet objects • State of the Publishers and Subscribers • Project structure output • Output of the current present and historical events. Top FB_BA_Top View Root object or top object of the project structure. Collects information of all children objects. n Inc Obj Initial UINT Indicates that properties of an object [} 32] have changed, which usually change only rarely. n Inc Obj Active Priority UINT Indicates that the active priority of an object [} 32] has changed. n Inc Obj Status UINT Indicates that the status of an object [} 32] has changed. n Inc Event UINT Indicates the change of an event [} 32]. n Inc Event Config UINT Indicates that the event configuration [} 32] of an object [} 32] has changed. n Inst Id_Auto UDINT Indicates that a valid instance ID must be generated automatically. guid Undefined GUID Undefined system ID n No Active Prio UDINT Value of the constant indicates that no priority is active. s Placeholder Sign_O STRING(1) Start character for a placeholder. pen s Placeholder Sign_Cl STRING(1) End character for a placeholder. ose s Placeholder Sign_D STRING(1) Separator for placeholder attributes. elimiter s Placeholder Sign_D STRING(1) Characters for placeholders not to be concatenated. eny Concat s Placeholder_Empty STRING(2) Empty placeholders. st Undefined Identifier ST_BA_Object Identifier Value representing an undefined object [} 32] reference. [} 118] a Ack Flags_None T_BA_Event Transitions Value, which represents no active Acknowledge Required flags. [} 115] a Ind Filter_None T_BA_Event Condition Flags Value, after which no event conditions [} 102] are filtered. [} 115] a Ind Filter_Evt All T_BA_Event Condition Flags Value, to filter all event conditions [} 102]. [} 115] a Ind Filter_Evt T_BA_Event Condition Flags Value, to filter selected event types (Grouped by event types). [} 115] 6.1.2.1.2.2 XBA_Param VAR_GLOBAL CONSTANT {region 'Supplement-Management'} b Enable BACnet : BOOL := TRUE; n Enabled Supplements : INT(0..2) := 1; {endregion} {region 'Communication-Management'} {IF defined (Ba Debug)} 126 Version: 1.14.0 TF8040
## Page 127

Programming n Com_BACnet RM_IOCount : DINT := 100; {ELSE} n Com_BACnet RM_IOCount : DINT := 0; {END_IF} {endregion} {region 'Site service'} b Site Server_Enable : BOOL := TRUE; n Site Server_Buffer Size : UINT := 8192; n Site Server_Session Timeout : TIME := T#15S; n Site Client_Buffer Size : UINT := 1024; t Site Client_Read Timeout : TIME := T#5S; {endregion} {region 'Project settings'} {region 'General'} {IF defined (Ba Debug)} e Language : E_BA_Language := E_BA_Language.e German; {ELSE} e Language : E_BA_Language := E_BA_Language.e English; {END_IF} b Utf8Auto Convert : BOOL := TRUE; {endregion} {region 'DPAD'} n DPAD_Levels : UINT := 10; n DPAD_Def Index Digits : UINT := 2; {attribute 'Tc Encoding':='UTF-8'} s DPAD_Object Name_Def Separator : T_BA_Short String := '_'; {attribute 'hide'} e DPAD_Object Name_Man Ovr Concat Mode : E_BA_Concat DPADMode := E_BA_Concat DPADMode.e None; {attribute 'Tc Encoding':='UTF-8'} s DPAD_Description_Def Separator : T_BA_Short String := ' - '; {attribute 'hide'} e DPAD_Description_Man Ovr Concat Mode : E_BA_Concat DPADMode := E_BA_Concat DPADMode.e None; b DPAD_Description_Explicit Index : BOOL := TRUE; {endregion} {endregion} {region 'Event'} {region 'Management'} e Evt Mgmt_Ack Mode : E_BA_Acknowledge Mode := E_BA_Acknowledge Mode.e Single {attribute 'Tc Encoding':='UTF-8'} s Evt Mgmt_Ack Msg Internal : STRING := 'Built-in acknowledgement.'; {attribute 'Tc Encoding':='UTF-8'} s Evt Mgmt_Ack Msg Remote : STRING := 'Acknowledged by remote user.'; {attribute 'Tc Encoding':='UTF-8'} s Evt Mgmt_Ack Msg PLC : STRING := 'Acknowledged by PLC.'; {endregion} {region 'Alarm-Mode settings'} a Ack Flags_Simple : T_BA_Event Transitions := [ TRUE, TRUE, FALSE ]; a Ack Flags_Standard : T_BA_Event Transitions := [ TRUE, TRUE, FALSE ]; a Ack Flags_Extended : T_BA_Event Transitions := [ TRUE, TRUE, TRUE ]; a Event En_Simple : T_BA_Event Transitions := [ TRUE, TRUE, FALSE ]; a Event En_Standard : T_BA_Event Transitions := [ TRUE, TRUE, FALSE ]; a Event En_Extended : T_BA_Event Transitions := [ TRUE, TRUE, TRUE ]; {endregion} n Event History_Entry Count : INT := 2048; n Event Transition Text_Length : DINT := 24; a Event Transition Text : T_BA_Event Transition Text := [ 'To Offnormal', 'To Fault' , 'To Normal' ]; {endregion} {region 'Event-List'} n Event List_Entry Count : DINT := 512; {endregion} {region 'Parameters'} {region 'General'} n Inst ID_Auto Generate Offset : UDINT := 100 n State Text_Length : DINT := 40; n Tag_Length : DINT := 8; a Def Read Access : ARRAY [E_BA_Parameter. First .. E_BA_Parameter. Last] OF E _BA_Role := [E_BA_Parameter. Count(0)]; a Def Write Access : ARRAY [E_BA_Parameter. First .. E_BA_Parameter. Last] OF E TF8040 Version: 1.14.0 127
## Page 128

Programming _BA_Role := [E_BA_Parameter. Count(0)]; {endregion} {region 'Multistate'} n Multistate_State Count : DINT := 20; {endregion} {region 'Local'} {region 'Hardware'} f Input_Def Resolution : REAL := 0.1; f Input_Def Scale Offset : REAL := 0; f Output_Def Resolution : REAL := 0.00305185; f Output_Def Scale Offset : REAL := 0; e Input_Def Sensor : E_BA_Measuring Element := E_BA_Measuring Element.e NI1000; {endregion} {region 'Event config'} f Def Limit Deadband : REAL := 0.0; n Def Time Delay_To Abnormal : UDINT := 1; n Def Time Delay AO_To Abnormal : UDINT := 1; n Def Time Delay BO_To Abnormal : UDINT := 30; n Def Time Delay MO_To Abnormal : UDINT := 30; {endregion} {region 'Value'} f Def COVIncrement : REAL := 0.1; {endregion} {region 'Plant Control'} n Plant Ctrl_Op Mode Count : DINT := 16; n Plant Ctrl_Aggregate Count : DINT := 16; {endregion} {region 'Sequence Link'} n Seq Link_Ref Count : DINT := 16; {endregion} {region 'Sequence'} n Max Seq Ctrl : USINT := 8 {endregion} {region 'Collector'} n Collect_Ref Count : DINT := 16; {endregion} {region 'Loop'} n Loop_Def Op Mode : E_BA_PIDMode := E_BA_PIDMode.e P1ID; {endregion} {region 'Trend'} n Trend_Buffer Size : UDINT := 500; st Trend_Def Start Time : ST_BA_Date Time := (); st Trend_Def Stop Time : ST_BA_Date Time := (); b Trend_Def Stop On Full : BOOL := FALSE; n Trend_Def Log Interval : UDINT := 900; n Trend_Def Notification Threshold : UDINT := 50; e Trend_Def Logging Type : E_BA_Logging Type := E_BA_Logging Type.e Polled; {endregion} {region 'Calendar'} n Cal_Entry Count : DINT := 24; {endregion} {region 'Scheduler'} n Sched_Entry Count : DINT := 6; n Sched_Calendar Count : DINT := 3; n Sched_Exception Count : DINT := 24; {endregion} {endregion} {region 'Simulation'} n Sim_AISen_Def Damp Constant : UDINT := 20; {endregion} {endregion} {region 'Publish and Subscribe'} {region 'Subscribers'} t Sub_Read Tolerance : TIME := T#0S; b Sub_Clear On Read Error : BOOL := FALSE; t Sub_Def Read Interval : TIME := T#30S; {endregion} {endregion} {region 'Groups'} n Group Cmd_Ref Count : DINT := 5; n Group Dsp_Ref Count : DINT := 5; n Group Val_Ref Count : DINT := 5; {endregion} END_VAR 128 Version: 1.14.0 TF8040
## Page 129

Programming Name Type Description b Site Server_Enable BOOL Disables / enables the Site Server on the automation station. n Site Server_Buffer Si UINT Defines the size of the Site Server communication buffer. ze n Site Server_Session TIME Defines the maximum duration [s] of a session until it is Timeout terminated by the server after inactivity. n Site Client_Buffer Si UINT Defines the size of the communication buffer from the Site ze Client. t Site Client_Read Tim TIME Defines the maximum duration [s] of read requests of the eout Site Client until they are aborted with a timeout. e Language E_BA_Language Language used within the PLC, for example to format Current values. b Utf8Auto Convert BOOL Automatically applies UTF-8 encoding to strings. n DPADLevels UINT Sets the maximum number of levels in DPAD [} 42]. n DPAD_Def Index Di UINT Sets the number of digits for indexing levels in DPAD gits [} 42]. s DPAD_Object Nam T_BA_Short String [} 120] Sets the separator for separating object names. e_Def Separator e DPAD_Object Nam E_BA_Concat DPADMode Default to concatenate strings when an object name has e_Man Ovr Concat Mo been manually overwritten. [} 100] de s DPAD_Description T_BA_Short String [} 120] Sets the separator for separating descriptions. _Def Separator e DPAD_Description E_BA_Concat DPADMode Default for concatenate strings when a description has _Man Ovr Concat Mod been manually overwritten. [} 100] e b DPAD_Description BOOL Conditions under which an index should be displayed in _Explicit Index the parameter Description. • FALSE displays the index automatically if > 1. • TRUE displays the index only if it is explicitly defined (placeholder). e Evt Mgmt_Ack Mode E_BA_Acknowledge Mode Behavior when acknowledging events [} 32]. [} 101] s Evt Mgmt_Ack Msg I STRING Text for displaying integrated acknowledgement functions nternal (for internal functions). s Evt Mgmt_Ack Msg R STRING Text for displaying acknowledgement functions by external emote access. s Evt Mgmt_Ack Msg P STRING Text for displaying acknowledgement functions by PLC LC logic. a Ack Flags_Simple T_BA_Event Transitions Defines the transitions [} 32] to be confirmed for the [} 115] "Simple" alarm mode. a Ack Flags_Standard T_BA_Event Transitions Defines the transitions [} 32] to be confirmed for the [} 115] "Standard" alarm mode. a Ack Flags_Extende T_BA_Event Transitions Defines the transitions [} 32] to be confirmed for the d [} 115] "Advanced" alarm mode. a Event En_Simple T_BA_Event Transitions Defines transition states [} 32] to be taken into account for [} 115] the "Simple" alarm mode. a Event En_Standard T_BA_Event Transitions Defines transition states [} 32] to be taken into account for [} 115] the "Standard" alarm mode. a Event En_Extended T_BA_Event Transitions Defines transition states [} 32] to be taken into account for [} 115] the "Advanced" alarm mode. TF8040 Version: 1.14.0 129
## Page 130

Programming Name Type Description n Event History_Entry INT Maximum number of entries in the event history. Count n Event Transition Tex DINT Maximum number of letters in the event transition t_Length parameter. a Event Transition Tex T_BA_Event Transition Text Default value for the event transition text. t [} 115] n Event List_Entry Co DINT Maximum number of entries displayed in event lists. unt n Inst ID_Auto Genera DINT Initial value for autogeneration of instance IDs. te Offset n State Text_Length DINT Maximum number of characters in the State Text parameter. n Tag_Length DINT Maximum amount of letters in the Tag parameter. a Def Read Access E_BA_Parameter [} 108] Possibility to customize default access rights for read access to parameters. a Def Write Access E_BA_Parameter [} 108] Possibility to customize default access rights for write access to parameters. n Multistate_State Co DINT Sets the number of states for multi-state values. unt f Input_Def Resolutio REAL Default value for the Resolution parameter of inputs. n f Input_Def Scale Offs REAL Default value for the Offset parameter of inputs. et f Output_Def Resoluti REAL Default value for the Resolution parameter of outputs. on f Output_Def Scale Off REAL Default value for the Offset parameter of outputs. set e Input_Def Sensor E_BA_Measuring Element Selection of the sensor with the special input type FB_BA_AI_IOEx [} 193]. f Def Limit Deadband REAL Default value for the Dead band limit parameter. n Def Time Delay_To A UDINT Default value for the parameter Time delay of transitions to bnormal abnormal states. n Def Time Delay AO_ UDINT Default value for the Time Delay parameter of transitions To Abnormal to abnormal states of analog outputs. n Def Time Delay BO_ UDINT Default value for the Time Delay parameter of transitions To Abnormal to abnormal states of binary outputs. n Def Time Delay MO_ UDINT Default value for the Time Delay parameter of transitions To Abnormal to abnormal states of multi-stage outputs. f Def COVIncrement REAL Default value for the COV increment parameter. n Plant Ctrl_Op Mode DINT Sets the maximum number of plant operation modes of Count FB_BA_Plant Ctrl function blocks. n Plant Ctrl_Aggregat DINT Sets the maximum number of aggregate [} 42] references e Count of FB_BA_Plant Ctrl function blocks. n Seq Link_Ref Count DINT Maximum number of controller references in a sequence linker. n Max Seq Ctrl USINT The global parameter specifies the number of sequence controllers. It limits the data and command structure arr Seq Link Data within the structure ST_BA_Seq Link [} 123]. The value must not be less than 1. n Collect_Ref Count DINT Sets the maximum number of references of FB_BA_Collector function blocks. e Loop_Def Op Mode E_BA_PIDMode Default value for the Operation mode parameter. n Trend_Buffer Size UDINT Number of entries in a trend buffer. 130 Version: 1.14.0 TF8040
## Page 131

Programming Name Type Description st Trend_Def Start Tim ST_BA_Date Time Default value for the Start time parameter. e st Trend_Def Stop Tim ST_BA_Date Time Default value for the Stop time parameter. e b Trend_Def Stop On F BOOL FALSE, Ring buffer; TRUE, Fixed memory that does not ull store anything when the buffer is full. n Trend_Def Log Inter UDINT Default value for the Logging interval parameter. val n Trend_Def Notificati UDINT Default value for the Notification threshold parameter. on Threshold n Cal_Entry Count DINT Number of entries in a calendar object. n Sched_Entry Count DINT Number of entries on a weekday ('T_BA_Sched Week' [} 122]) or an exception ('ST_BA_Sched Calendar' [} 121] / 'ST_BA_Sched Exception' [} 121]). n Sched_Calendar Co DINT Number of calendar references ('T_BA_Sched Calendar unt [} 122]'). n Sched_Exception C DINT Number of exceptions ('T_BA_Sched Exception List' [} 122]). ount n Sim_AISen_Def Da UDINT Default value for the parameter Damping constant. mp Constant t Sub_Read Toleranc TIME Default value for the Read tolerance parameter. e b Sub_Clear On Read BOOL Default value for the Reset on read errors parameter. Error t Sub_Def Read Interv TIME Default value for the Read interval parameter. al n Group Cmd_Ref Co DINT Number of references. unt n Group Dsp_Ref Cou DINT Number of references. nt n Group Val_Ref Coun DINT Number of references. t 6.1.2.1.2.3 BACNet 6.1.2.1.2.3.1 XBA_BACnet Param The list contains globally valid parameters with which basic settings relating to BACnet can be made in TF8040: VAR_GLOBAL CONSTANT {region 'Objects'} {region 'Local'} {region 'Event Config'} s Event Message Text Format : STRING := '{Descr} - {Evt Trans}'; {endregion} {endregion} {region 'Remote'} {region 'Analog Output'} f RM_AO_Write Increment : REAL := 0.0; {endregion} {region 'Structured View'} e View_Subordinate Annotation Mode : E_BACnet_Annotation Title := E_BACnet_Annotation Title.e Sy mbol Name; {endregion} {endregion} {endregion} {region 'Priorities'} a Priority : ARRAY[E_BA_Priority. First .. E_BA_Priority. Last] OF E_BA Cnet_Priority := [ TF8040 Version: 1.14.0 131
## Page 132

Programming (* e Program *) E_BACnet_Priority.e P15, (* e Manual Remote *) E_BACnet_Priority.e P8, (* e Manual Local *) E_BACnet_Priority.e P7, (* e Critical *) E_BACnet_Priority.e P3, (* e Life Safety *) E_BACnet_Priority.e P1 ]; {endregion} {region 'Translation'} a Node Type : ARRAY[E_BA_Node Type. First .. E_BA_Node Type. Last] OF E_B ACnet_Node Type := [ (* e Unknown *) E_BACnet_Node Type.e Unknown, (* e Other *) E_BACnet_Node Type.e Other, (* e General *) E_BACnet_Node Type.e Organizational, (* e Location *) E_BACnet_Node Type.e Organizational, (* e Building *) E_BACnet_Node Type.e Organizational, (* e Building Element *) E_BACnet_Node Type.e Organizational, (* e Information Focus *) E_BACnet_Node Type.e Organizational, (* e Control Cabinet *) E_BACnet_Node Type.e Organizational, (* e Trade *) E_BACnet_Node Type.e Organizational, (* e Floor *) E_BACnet_Node Type.e Organizational, (* e Room *) E_BACnet_Node Type.e Organizational, (* e Plant *) E_BACnet_Node Type.e Organizational, (* e Aggregate *) E_BACnet_Node Type.e Equipment, (* e Function *) E_BACnet_Node Type.e Functional ]; a Notify Type : ARRAY[E_BA_Event Type. First .. E_BA_Event Type. Last] OF E_BACnet_Notify Type := [ (* e Alarm *) E_BACnet_Notify Type.e Alarm, (* e Disturb *) E_BACnet_Notify Type.e Alarm, (* e Maintenance *) E_BACnet_Notify Type.e Notify Event, (* e Notification *) E_BACnet_Notify Type.e Notify Event, (* e Other *) E_BACnet_Notify Type.e Notify Event ]; a Event State : ARRAY[E_BA_Event State. First .. E_BA_Event State. Last] O F E_BACnet_Event State := [ (* e Normal *) E_BACnet_Event State.e Normal, (* e Fault *) E_BACnet_Event State.e Fault, (* e Offnormal *) E_BACnet_Event State.e Offnormal, (* e Low Limit *) E_BACnet_Event State.e Low Limit, (* e High Limit *) E_BACnet_Event State.e High Limit ]; {endregion} END_VAR 132 Version: 1.14.0 TF8040
## Page 133

Programming Name Type Description s Event Message Text STRING A message text for the Twin CAT HMI BA as well as for a Format BACnet client is made up of different strings. The last part of the string is the Event Trasition Text. The texts for the various event transitions are in a list called Txt Event_EN or Txt Event_DE. These lists are created when a TF8040 Sample PLC is created. The front part of the message can consist of various texts. For example, from the Object Description. The s Event Message Text Format string can be used to determine the format or composition of the Event Message Text. It is made up of texts and placeholders. Placeholders and free text such as a separator can be arranged one after the other. Placeholder: {Obj Name} = Objectname {Descr} = Description {Inst ID} = Instance ID {Evt Trans} = Event Taransition In the following sample, the Objectdescription is placed in front of the Event Transition Text. The hyphen is used to place a separator between the two placeholders. s Event Message Text Format :='{Descr} - {Evt Trans}; f RM_AO_Write Incre REAL Threshold value that must be exceeded to output a value ment change at the analog output. e View_Subordinate E_BACnet_Annotation Titl Property which is used to display a child object in the Annotation Mode e Subordinate List of the corresponding parent view object. a Priority ARRAY[E_BA_Priority Defines the assignment of BACnet priorities from the [} 110]. First .. Tc3_BACnet Rev14 library in the priority array. E_BA_Priority. Last] OF E_BACnet_Priority a Node Type ARRAY[E_BA_Node Type Conversion table for the Node Type property between the [} 111]. First .. Tc2_XBA library and the Tc3_BACnet Rev14 library. E_BA_Node Type. Last] OF E_BACnet_Node Type a Notify Type ARRAY[E_BA_Event Type Conversion table for the Notify Type property between the [} 103]. First .. Tc2_XBA library and the Tc3_BACnet Rev14. E_BA_Event Type. Last] OF E_BACnet_Notify Type a Event State ARRAY[E_BA_Event State Conversion table for the Event State property between the . First .. Tc2_XBA library and the Tc3_BACnet Rev14. E_BA_Event State. Last] OF E_BACnet_Event State TF8040 Version: 1.14.0 133
## Page 134

Programming 6.1.2.1.3 POUs 6.1.2.1.3.1 Function Blocks 6.1.2.1.3.1.1 Events 6.1.2.1.3.1.1.1 FB_BA_Event Observer The function block is used to evaluate alarms/events in the project structure and acknowledge them. Access to the project structure with a parent/child relationship takes place via an assignment to the property Parent. Syntax FUNCTION_BLOCK FB_BA_Event Observer VAR_INPUT b Ack : BOOL; END_VAR VAR_OUTPUT b Has Events : BOOL; b Has Unack Events : BOOL; END_VAR Inputs Name Type Description b Ack BOOL The signal for acknowledging alarms / events is applied to the input. Outputs Name Type Description b Has Events BOOL Display that events are pending. b Has Unack Events BOOL Display that unacknowledged events are pending. Properties Name Type Access Description Parent I_BA_View Get, Set Access to the project structure (base framework) is realized via an assignment to the property. If no assignment is made, the basis of the base framework is accessed. This means that all events / alarms are evaluated and their acknowledgement can be triggered accordingly. In addition, a warning is output to the error list of the TC3 development environment. Valid BOOL Get Indicates that a valid assignment is present at the interface i Parent (parent). 134 Version: 1.14.0 TF8040
## Page 135

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.2.1.3.1.1.2 FB_BA_Plant Lock The events of the objects often signal a relevant malfunction, which requires targeted switching operations to be performed on aggregates or plants. In large plants, there are often a large number of events, which then frequently have to be combined into a collective message. To keep the programming effort for generating collective messages as low as possible, a lock priority can be determined at each event-capable object. All four lock priorities are collected at each level of the project structure [} 38] and passed up from the lowest level of the project structure to the top level. If required, they are displayed by the instance of a function block FB_BA_Plant Lock and interconnected with other function blocks for the control of plant and aggregate units. Four lock priorities are used to differentiate the object events in order to trigger different reactions. • Local medium Enables a local shutdown of of medium priority. • Local high Enables a local shutdown of of higher priority. • Medium Enables a higher-level shutdown of of medium priority. • High Enables a higher-level shutdown of of higher priority. Medium priority is used for technically relevant faults that affect the safety of plants. High priority can be used for faults where the safety of people is at risk. The local faults should be used, for example, to switch off aggregates. The non-local ones should be used to shut down equipment. The image below is intended to explain this relationship: The effects of different lock priorities of the fault input DST are as follows: Dst.e En Plant Lock Cmd.b Present Val Cmd.e Active Prio Op Mode. Alm Shut Off Local Medium False Critical False Local High False Safety False Medium False Critical Safety High False Safety Safety TF8040 Version: 1.14.0 135
## Page 136

Programming Illustration FUNCTION_BLOCK FB_BA_Plant Lock VAR_OUTPUT b Prio High : BOOL; b Prio Medium : BOOL; b Prio Local High : BOOL; b Prio Local Medium : BOOL; END_VAR VAR {region 'Fixed Variables'} i Parent : I_BA_View; {endregion} END_VAR 136 Version: 1.14.0 TF8040
## Page 137

Programming Outputs Name Type Description b Prio Local High BOOL The output signals a global event with a high priority. b Prio Medium BOOL The output signals a global event with a medium priority. b Prio Local High BOOL The output signals a local event with a high priority. b Prio Local Medium BOOL The output signals a local event with a medium priority. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.2 Reference 6.1.2.1.3.1.2.1 Publish and Subscribe Publisher and Subscriber provide a way to easily exchange information. • Publishers provide information. • Subscribers subscribe to information from a referenced Publisher in order to make it available in a specific program section (e.g. template). Regardless of where Publishers and Subscribers are implemented (e.g. on different PLCs), information is exchanged in a uniform manner. Sample 1 Application of Publisher and Subscriber to specific functions and objects. Each function block can be used as Publisher. Function blocks that can subscribe to the desired data types serve as Subscribers. To do this, the unique object name of the Publisher and its AMS Net ID must be specified on the Subscriber. Sample 2 TF8040 Version: 1.14.0 137
## Page 138

Programming Application of Publisher and Subscriber for any data types. The FB_BA_Raw Publisher [} 139] can be used to make information of different sizes available to the FB_BA_Raw Subscriber [} 158]. As in the previous sample, the object name and the AMS Net ID must be specified on the Subscriber. As indicated in the sample, this configuration takes place once in FB_init of FB_BA_Raw Subscriber [} 158]. If there are several instances of an object with the same symbol name, it is necessary to specify the complete symbol name of the object in the parameter s Subject. Sample 3 In the sample, the faults of two heating circuit pumps are to be published and subscribed to separately. Within the heating circuits, the pumps Pu and the published binary objects of the fault Dst have the same name. The parameter is therefore published from both templates in the same way. 138 Version: 1.14.0 TF8040
## Page 139

Programming Subscribing is done separately, you only need to ensure that the symbol path for the event to be subscribed to is specified correctly. 6.1.2.1.3.1.2.1.1 Publisher Function blocks for local or cross-control publishing of information. 6.1.2.1.3.1.2.1.1.1 FB_BA_Raw Publisher Function block for providing any information. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Publisher TF8040 Version: 1.14.0 139
## Page 140

Programming Syntax VAR_INPUT b En Publish : BOOL; x Data : ANY; END_VAR Inputs Name Type Description b En Publish BOOL Variable for enabling variables or data sets via ADS. x Data ANY Data to be published. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.2.1.2 Subscriber Function blocks for subscribing to local or cross-control information. 6.1.2.1.3.1.2.1.2.1 Objects This folder offers objects that make it possible to subscribe to published object information either within the controller or across controllers. 6.1. Analog 2.1. 3.1. 2.1. 2.1. 1 Function blocks for subscribing to analog objects. 6.1. FB_BA_Sub AI 2.1. 3.1. 2.1. 2.1. 1.1 The function block allows to subscribe to an analog input object. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub Evt A Syntax FUNCTION_BLOCK FB_BA_Sub AI EXTENDS FB_BA_Sub Evt A VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; 140 Version: 1.14.0 TF8040
## Page 141

Programming t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; f Present Value : REAL; b Event : BOOL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. f Present Value REAL Current analog output value of the object. b Event BOOL The output is TRUE if an event or error has occurred. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. FB_BA_Sub APrio 2.1. 3.1. 2.1. 2.1. 1.2 The function block enables subscribing to an analog input object with a priority array. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub Evt A Syntax FUNCTION_BLOCK FB_BA_Sub APrio EXTENDS FB_BA_Sub Evt A VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; TF8040 Version: 1.14.0 141
## Page 142

Programming END_VAR VAR_OUTPUT b Error : BOOL; f Present Value : REAL; b Event : BOOL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. f Present Value REAL Current analog output value of the object. b Event BOOL The output is TRUE if an event or error has occurred. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. FB_BA_Sub AV_Op 2.1. 3.1. 2.1. 2.1. 1.3 The function block allows to subscribe to an analog value object [} 202] to display an analog value. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub A Syntax FUNCTION_BLOCK FB_BA_Sub AV_Op EXTENDS FB_BA_Sub A VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR 142 Version: 1.14.0 TF8040
## Page 143

Programming VAR_OUTPUT b Error : BOOL; f Present Value : REAL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. f Present Value REAL Current analog output value of the object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. Binary 2.1. 3.1. 2.1. 2.1. 2 Function blocks for subscribing to binary objects. 6.1. FB_BA_Sub BI 2.1. 3.1. 2.1. 2.1. 2.1 The function block allows to subscribe to a binary input object. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub Evt B TF8040 Version: 1.14.0 143
## Page 144

Programming Syntax FUNCTION_BLOCK FB_BA_Sub BI EXTENDS FB_BA_Sub Evt B VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; b Present Value : BOOL; b Event : BOOL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. b Present Value BOOL Current binary output value of the object. b Event BOOL The output is TRUE if an event or error has occurred. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. FB_BA_Sub BPrio 2.1. 3.1. 2.1. 2.1. 2.2 The function block allows to subscribe to a binary input object with a priority array. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub Evt B 144 Version: 1.14.0 TF8040
## Page 145

Programming Syntax FUNCTION_BLOCK FB_BA_Sub BPrio EXTENDS FB_BA_Sub Evt B VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; b Present Value : BOOL; b Event : BOOL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. b Present Value BOOL Current binary output value of the object. b Event BOOL The output is TRUE if an event or error has occurred. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. FB_BA_Sub BV_Op 2.1. 3.1. 2.1. 2.1. 2.3 The function block allows to subscribe to a binary value object [} 216] to display a binary value. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub B TF8040 Version: 1.14.0 145
## Page 146

Programming Syntax FUNCTION_BLOCK FB_BA_Sub BV_Op EXTENDS FB_BA_Sub B VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; b Present Value : BOOL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. b Present Value BOOL Current binary output value of the object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. Misc 2.1. 3.1. 2.1. 2.1. 3 Function blocks for subscribing to sophisticated objects. 6.1. FB_BA_Sub Cal 2.1. 3.1. 2.1. 2.1. 3.1 The function block allows to subscribe to a calendar object. Inheritance hierarchy FB_BA_Base 146 Version: 1.14.0 TF8040
## Page 147

Programming FB_BA_Subscriber FB_BA_Sub B Syntax FUNCTION_BLOCK FB_BA_Sub Cal EXTENDS FB_BA_Sub B VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; b Present Value : BOOL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. b Present Value BOOL Current binary output value of the object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. FB_BA_Sub Loop 2.1. 3.1. 2.1. 2.1. 3.2 The function block allows to subscribe to of a loop object. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub A TF8040 Version: 1.14.0 147
## Page 148

Programming Syntax FUNCTION_BLOCK FB_BA_Sub Loop EXTENDS FB_BA_Sub A VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; f Present Value : REAL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. f Present Value REAL Current analog output value of the object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. FB_BA_Sub Sched A 2.1. 3.1. 2.1. 2.1. 3.3 The function block allows to subscribe to an analog scheduler object. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber Syntax FUNCTION_BLOCK FB_BA_Sub Sched A EXTENDS FB_BA_Subscriber VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; 148 Version: 1.14.0 TF8040
## Page 149

Programming b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; f Present Value : REAL; f Predicted Value : REAL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs VAR_OUTPUT b Error : BOOL; f Present Value : REAL; f Predicted Value : REAL; END_VAR Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. f Present Value REAL Current analog output value of the object. f Predicted Value REAL Value that is assumed after the next switching. Properties Name Type Access Description Unit E_BA_Unit Get Unit. Methods Name Description Get Data [} 149] Contains the subscribed data. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. Get Data 2.1. 3.1. 2.1. 2.1. 3.3. 1 TF8040 Version: 1.14.0 149
## Page 150

Programming The method saves subscribed data of a Publisher. Syntax METHOD Get Data VAR_OUTPUT p Data : PVOID; n Size : DINT; END_VAR Outputs Name Type Description p Data p Data Pointer to the subscribed data. n Size DINT Size of the subscribed data. 6.1. FB_BA_Sub Sched B 2.1. 3.1. 2.1. 2.1. 3.4 The function block allows to subscribe to a binary scheduler object. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber Syntax FUNCTION_BLOCK FB_BA_Sub Sched B EXTENDS FB_BA_Subscriber VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; b Present Value : BOOL; b Predicted Value : BOOL; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. 150 Version: 1.14.0 TF8040
## Page 151

Programming Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. b Present Value BOOL Current binary output value of the object. b Predicted Value BOOL Value that is assumed after the next switching. Properties Name Type Access Description Active Text STRING Get Active text Inactive Text STRING Get Inactive text Methods Name Description Get Data [} 151] Contains the subscribed data. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. Get Data 2.1. 3.1. 2.1. 2.1. 3.4. 1 The method saves subscribed data of a Publisher. Syntax METHOD Get Data VAR_OUTPUT p Data : PVOID; n Size : DINT; END_VAR Outputs Name Type Description p Data p Data Pointer to the subscribed data. n Size DINT Size of the subscribed data. TF8040 Version: 1.14.0 151
## Page 152

Programming 6.1. FB_BA_Sub Sched M 2.1. 3.1. 2.1. 2.1. 3.5 The function block allows to subscribe to a multi-state scheduler object. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber Syntax FUNCTION_BLOCK FB_BA_Sub Sched M EXTENDS FB_BA_Subscriber VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; n Present Value : UDINT; n Predicted Value : UDINT; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. n Present Value UDINT Analog output value. n Predicted Value UDINT Value that is assumed after the next switching. Properties Name Type Access Description State Count UDINT Get Number of possible states. State Text T_BA_State Text Ar Get Output of the state text. ray [} 121] 152 Version: 1.14.0 TF8040
## Page 153

Programming Methods Name Description Get Data [} 153] Contains the subscribed data. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. Get Data 2.1. 3.1. 2.1. 2.1. 3.5. 1 The method saves subscribed data of a Publisher. Syntax METHOD Get Data VAR_OUTPUT p Data : PVOID; n Size : DINT; END_VAR Outputs Name Type Description p Data p Data Pointer to the subscribed data. n Size DINT Size of the subscribed data. 6.1. FB_BA_Sub Trend 2.1. 3.1. 2.1. 2.1. 3.6 The function block allows to subscribe to a trend object. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber Syntax FUNCTION_BLOCK FB_BA_Sub Trend EXTENDS FB_BA_Subscriber VAR_INPUT s Target : T_BA_Med String; TF8040 Version: 1.14.0 153
## Page 154

Programming t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; b Event : BOOL; n Record Count : UDINT; n Total Record Count : UDINT; END_VAR Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. b Event BOOL The variable signals an abnormal event of an object. The type of event, e.g. an alarm, a maintenance message, etc., is described within the event class associated with the object. n Record Count UDINT Number of records. n Total Record Count UDINT Absolute number of records. Properties Name Type Access Description Enable BOOL Get, Set Enable of the subscription. Methods Name Description Get Data [} 154] Contains the subscribed data. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. Get Data 2.1. 3.1. 2.1. 2.1. 3.6. 1 154 Version: 1.14.0 TF8040
## Page 155

Programming The method saves subscribed data of a Publisher. Syntax METHOD Get Data VAR_OUTPUT p Data : PVOID; n Size : DINT; END_VAR Outputs Name Type Description p Data p Data Pointer to the subscribed data. n Size DINT Size of the subscribed data. 6.1. Multistate 2.1. 3.1. 2.1. 2.1. 4 Function blocks for subscribing to multi-state objects. 6.1. FB_BA_Sub MI 2.1. 3.1. 2.1. 2.1. 4.1 The function block allows to subscribe to a multi-state input object. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub Evt M Syntax FUNCTION_BLOCK FB_BA_Sub BV_Op EXTENDS FB_BA_Sub Evt M VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; n Present Value : UDINT; b Event : BOOL END_VAR TF8040 Version: 1.14.0 155
## Page 156

Programming Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. n Present Value UDINT Analog output value. b Event BOOL The output is TRUE if an event or error has occurred. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. FB_BA_Sub MPrio 2.1. 3.1. 2.1. 2.1. 4.2 The function block allows to subscribe to a multi-state value object with a priority array. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub M Syntax FUNCTION_BLOCK FB_BA_Sub BV_Op EXTENDS FB_BA_Sub M VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; n Present Value : UDINT; b Event : BOOL END_VAR 156 Version: 1.14.0 TF8040
## Page 157

Programming Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. n Present Value UDINT Analog output value. b Event BOOL The output is TRUE if an event or error has occurred. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1. FB_BA_Sub MV_Op 2.1. 3.1. 2.1. 2.1. 4.3 The function block allows to subscribe to a multi-state value object [} 239] to display a multi-state value. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber FB_BA_Sub M Syntax FUNCTION_BLOCK FB_BA_Sub BV_Op EXTENDS FB_BA_Sub M VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; END_VAR VAR_OUTPUT b Error : BOOL; n Present Value : UDINT; END_VAR TF8040 Version: 1.14.0 157
## Page 158

Programming Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. n Present Value UDINT Analog output value. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.2.1.2.2 FB_BA_Raw Subscriber Function block for subscribing to any information. Inheritance hierarchy FB_BA_Base FB_BA_Subscriber Syntax FUNCTION_BLOCK FB_BA_Raw Subscriber EXTENDS FB_BA_Subscriber VAR_INPUT s Target : T_BA_Med String; t Read Interval : TIME; t Read Tolerance : TIME; b Clear On Read Error : BOOL; x Data : _System. Any Type; END_VAR VAR_OUTPUT b Error : BOOL; END_VAR 158 Version: 1.14.0 TF8040
## Page 159

Programming Inputs Name Type Description s Target T_BA_Med String [} 120] AMS Net Id of the Publisher. t Read Interval TIME Read interval [s]. t Read Tolerance TIME Waiting time until a pending error is output [ms]. b Clear On Read Error BOOL If TRUE, the data is deleted if an error occurs. x Data ANY Read data. Outputs Name Type Description b Error BOOL Displays the current error state of the subscription. Details can be found in the corresponding error message in the event of an error. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.3 Accessories 6.1.2.1.3.1.3.1 FB_BA_Param The function block enables configuration of the properties contained in the global variable list XBA_Param [} 126]. Existing limitations that apply to the writing of parameters are observed (see also Regions [} 98]). For example, the writing of fixed parameters at runtime is rejected. Parameters for the configuration of compiler time values cannot be changed at runtime! Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.3.2 Event Subscriber The Event Subscribers enable generic subscription to events. This allows you to respond to various events (such as in the project or on local objects) at a central location by overwriting the respective events within the methods provided. The possible events are offered as a method and the call is made as required. Notes on using the Event Subscriber It should be noted that the use of these function blocks can affect system performance. Depending on the programmed logic, the On Object State Change method, for example, may run too slowly. This can lead to cycle overruns. TF8040 Version: 1.14.0 159
## Page 160

Programming 6.1.2.1.3.1.3.2.1 FB_BA_Project Event Subscriber The Subscriber function block offers the possibility to respond to project-wide events. Within the method, the user can describe and output information about the project state. Method Name Description On Project State Changed Change of the project state. [} 160] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.3.2.1.1 On Project State Changed The method is called when the project state has changed. Syntax METHOD PROTECTED On Project State Changed VAR_INPUT e State : E_BA_Project State; END_VAR Inputs Name Type Description e State E_BA_Project State [} 113] State to which the project has changed. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.3.2.2 FB_BA_Local Object Event Subscriber The Subscriber function block offers the possibility to respond to events in local objects. 160 Version: 1.14.0 TF8040
## Page 161

Programming Methods Name Description On BACnet Object State Change Change the state of a BACnet object. d [} 161] On Init State Change [} 161] Changing the initialization state of an object. On Init Instance Id [} 162] Change the instance ID of an object. On Event Change [} 162] Change of an event within an object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.3.2.2.1 On BACnet Object State Changed The method is called when the initialization state of a BACnet object changes. Syntax METHOD PROTECTED On BACnet Object State Changed VAR_INPUT i Object : I_BA_Object; fb BACnet Object : POINTER TO FB_BACnet_Base Object; t State : TCOM_STATE; END_VAR Inputs Name Type Description i Object I_BA_Object Interface to the context object. fb BACnet Object POINTER TO Supplement specific BACnet object of the context object. FB_BACnet_Base Object t State TCOM_STATE New state of the BACnet object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.3.2.2.2 On Init State Change The method is called when the initialization state of an object changes. TF8040 Version: 1.14.0 161
## Page 162

Programming Syntax METHOD PROTECTED On Init State Change VAR_INPUT i Object : I_BA_Object; e State : E_BA_Init State; END_VAR Inputs Name Type Description i Object I_BA_Object Interface to the context object. [} 264] e State E_BA_Init State [} 114] New state after initialization. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.3.2.2.3 On Init Instance Id The method can be used to assign a specific value to the instance ID of an object. Otherwise, the instance IDs are generated continuously. Each instance ID may only be assigned once. Syntax METHOD PROTECTED On Init Instance Id VAR_INPUT i Object : I_BA_Object; END_VAR Inputs Name Type Description i Object I_BA_Object Interface to the context object. [} 264] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.3.2.2.4 On Event Change The method is called when an object generates an event, or when a generated object changes or is deleted. 162 Version: 1.14.0 TF8040
## Page 163

Programming Syntax METHOD PROTECTED On Event Change VAR_INPUT i Object : I_BA_Object; END_VAR Inputs Name Type Description i Object I_BA_Object Interface to the context object. [} 264] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.1.4 System 6.1.2.1.3.1.4.1 FB_BA_Set BACnet Adapter Time The function block FB_BA_Set BACnet Adapter Time can be used to set the local BACnet system time of a Twin CAT system. Syntax FUNCTION_BLOCK FB_BA_Set BACnet Adapter Time VAR_INPUT b Trig : BOOL; st Date Time : ST_BA_Date Time; END_VAR VAR_OUTPUT b Success : BOOL; b Error : BOOL; END_VAR Inputs Name Type Description b Trig BOOL On a rising edge the content of the st Date Time structure is written to the local BACnet system time of the Twin CAT system. st Date Time ST_BA_Date Time Time specification which is written to the local BACnet system time. Outputs Name Type Description b Success BOOL The time specification st Date Time was successfully written to the target system. The variable is TRUE for one cycle. b Error BOOL Error while writing the BACnet system time. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.56 Tc3_XBA from v5.6.1.0 TF8040 Version: 1.14.0 163
## Page 164

Programming 6.1.2.1.3.1.4.2 FB_BA_Get BACnet Adapter Time The function block FB_BA_Get BACnet Adapter Time can be used to determine the local BACnet system time of a Twin CAT system. Internally, an internal software clock is implemented by means of the function block "RTC_EX2" (Extended Real Time Clock). This software clock is initialized with the BACnet system time and output by the two structures st Date Time and st Time Struct. The function block should be called in every PLC cycle, so that the current time can be calculated. Syntax FUNCTION_BLOCK FB_BA_Get BACnet Adapter Time VAR_INPUT b Trig : BOOL; {attribute 'parameter Unit':= 'ms'} n Ti Auto : UDINT; END_VAR VAR_OUTPUT b Success : BOOL; st Date Time : ST_BA_Date Time; st Time Struct : TIMESTRUCT; b Error : BOOL; END_VAR Inputs Name Type Description b Trig BOOL A rising edge at this input determines the local BACnet system time of a Twin CAT system. n Ti Auto UDINT Based on this time information, the local BACnet system time of a Twin CAT system is regularly determined automatically. The time specification must be greater than or equal to 500ms. Outputs Name Type Description b Success BOOL The system time was read successfully from the target system. The variable is TRUE for one cycle. st Date Time ST_BA_Date Time Current BACnet system time of a Twin CAT system. st Time Struct TIMESTRUCT Current BACnet system time of a Twin CAT system. b Error BOOL Error while reading the BACnet system time. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.56 Tc3_XBA from v5.6.1.0 164 Version: 1.14.0 TF8040
## Page 165

Programming 6.1.2.1.3.1.5 Control 6.1.2.1.3.1.5.1 FB_BA_Loop Sync The function block FB_BA_Loop Sync is used for parameter synchronization for two controllers of type FB_BA_Loop [} 220]. This function block can be used, for example, to calibrate master controllers that are used to generate the supply air setpoints for an air conditioning system. The following parameters of the FB_BA_Loop [} 220] are synchronized: • e Op Mode • e Action Rm • f Proportional Constant • f Integral Constant • f Derivative Constant • f Max Output Rm • f Min Output Rm • n Damp Constant • f Neutral Zone Error detection The error messages listed below are detected by the FB_BA_Loop Sync. The error messages are output in the Twin CAT 3 development environment in the "Error list" window. This can be activated under the menu item View. The error texts are output via the property Err Text and the output s Err Text. In addition, the messages are displayed by the enum e Err State. TF8040 Version: 1.14.0 165
## Page 166

Programming Error messages Message text German Message text English Explanation 'Synchronisation e Action Rm 'Synchronization e Action Rm faulty' Possibly the wrong synchronization fehlerhaft' can be triggered by the input e Action Pgm. This input overwrites the VAR_INPUT CONSTANT variable e Action Rm to be monitored when occupied. 'Synchronisation n Damp Constant 'Synchronization n Damp Constant It is possible that the wrong fehlerhaft' faulty' synchronization was triggered by the input e Action Pgm. This input overwrites the VAR_INPUT CONSTANT variable e Action Rm to be monitored when occupied. 'Synchronisation 'Synchronization f Derivative Constant fehlerhaft' f Derivative Constant faulty' 'Synchronisation f Integral Constant 'Synchronization f Integral Constant fehlerhaft' faulty' 'Synchronisation f Max Output Rm 'Synchronization f Max Output Rm Possibly the wrong synchronization fehlerhaft' faulty' can be triggered by the input f Max Output Pgm. This input overwrites the VAR_INPUT CONSTANT variable f Max Output Rm to be monitored when occupied. 'Synchronisation f Min Output Rm 'Synchronization f Min Output Rm Possibly the wrong synchronization fehlerhaft' faulty' can be triggered by the input f Min Output Pgm. This input overwrites the VAR_INPUT CONSTANT variable f Min Output Rm to be monitored when occupied. 'Synchronisation f Neutral Zone 'Synchronization f Neutral Zone fehlerhaft' faulty' 'Synchronisation e Op Mode 'Synchronization e Op Mode faulty' fehlerhaft' 'Synchronisation 'Synchronization f Proportional Constant fehlerhaft' f Proportional Constant faulty' Syntax FUNCTION_BLOCK FB_BA_Loop Sync VAR_OUTPUT b Err : BOOL; s Err Text : T_Max String; e Err State : E_BA_State Loop Sync; END_VAR VAR_IN_OUT Loop01 : FB_BA_Loop; Loop02 : FB_BA_Loop; END_VAR 166 Version: 1.14.0 TF8040
## Page 167

Programming Outputs Name Type Description b Err BOOL The output indicates when an error has occurred during synchronization. s Err Text T_Max String The variable shows the state of synchronization in text form [} 166]. e Err State E_BA_State Loop Sync The enumeration shows the state of the synchronization. [} 100] / Inputs Outputs Name Type Description Loop1 FB_BA_Loop [} 220] Reference to controller no. 1 of the parameter adjustment. Loop2 FB_BA_Loop [} 220] Reference to controller no. 2 of the parameter adjustment. Properties Name Type Access Description Err Text T_Max String Get The property Err Text displays the error texts from s Err Text. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.56 Tc3_XBA from v5.6.1.0 TF8040 Version: 1.14.0 167
## Page 168

Programming 6.1.2.1.3.1.6 Sequence 6.1.2.1.3.1.6.1 FB_BA_Seq Ctrl PID sequence controller as part of a sequence. On receipt of the enable b En = TRUE, the higher-level control block FB_BA_Sequence Link Base [} 171] is informed that the sequence controller is ready for operation for sequence control. The data exchange between the sequence controllers FB_BA_Seq Ctrl and the control block FB_BA_Sequence Link Base [} 171] takes place via the structure st Seq Link [} 123]. Output value f Present Value The function block determines the resulting value at the output f Present Value depending on the enables b En and st Sequence Link.b En Seq Link, the control direction e Action Pgm / e Action Rm and the sequence number n Actv Seq Ctrl / n My Num. 168 Version: 1.14.0 TF8040
## Page 169

Programming b En st Se- e Action Pgm/e Ac- n Actv Seq Ctrl/ f Present Value quence Link.b En Se- tion Rm n My Num q Link TRUE FALSE E_BA_Action.e Reve f Max Output Pgm / rse f Max Output Rm TRUE FALSE E_BA_Action.e Direc f Min Output Pgm / t f Min Output Rm FALSE FALSE 0 TRUE TRUE E_BA_Action.e Reve n Actv Seq Ctrl > f Min Output Pgm / rse n My Num f Min Output Rm TRUE TRUE E_BA_Action.e Reve n Actv Seq Ctrl < f Max Output Pgm / rse n My Num f Max Output Rm TRUE TRUE E_BA_Action.e Direc n Actv Seq Ctrl < f Min Output Pgm / t n My Num f Min Output Rm TRUE TRUE E_BA_Action.e Direc n Actv Seq Ctrl > f Max Output Pgm / t n My Num f Max Output Rm TRUE TRUE n Actv Seq Ctrl = FB_BA_Loop.f Prese n My Num nt Value Error detection The error messages listed below are detected by FB_BA_Seq Ctrl. The x in the text messages stands for a numerical specification of a sequence controller. The error messages are output in the "Error list" window in the Tc3 development environment. This can be activated under the menu item View. The error texts are output via the properties Error Param Max Seq Ctrl and Error Seq Num Multiple. Globaler Parameter Tc3_BA2. BA_Param.n Max Seq Ctrl < 1 This message is the only one that disables sequence control. German English Globaler Parameter Global parameter Tc3_BA2. BA_Param.n Max Seq Ctrl Tc3_BA2. BA_Param.n Max Seq Ctrl < 1 < 1 Sequenznummer n My Num = x mehrfach vergeben Sequence number n My Num = x assigned multiple times Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Loop [} 220] Syntax FUNCTION_BLOCK FB_BA_Seq Ctrl EXTENDS FB_BA_Loop VAR_INPUT n My Num : UDINT; END_VAR VAR_OUTPUT f E : REAL; b Seq Actv : BOOL; n Actv Seq Ctrl : UDINT; b Is Actv Seq Ctrl : BOOL; b Err : BOOL; END_VAR TF8040 Version: 1.14.0 169
## Page 170

Programming VAR_IN_OUT st Seq Link : ST_BA_Seq Link; END_VAR Inputs Name Type Description n My Num UDINT My number in the sequence. This number may only be present once in a sequence control. An internal limitation only allows values from 1 - XBA_Param.n Max Seq Ctrl [} 126]. Outputs Name Type Description f E REAL Displays the control deviation of the sequence controller. This depends on the control direction of the sequence controller. E_BA_Action.e Direct -> f E = f X-f W E_BA_Action.e Reverse -> f E = f W-f X b Seq Actv BOOL The sequence controller is implemented in the control sequence. n Actv Seq Ctrl UDINT Number of the active sequence controller. b Is Actv Seq Ctrl BOOL Indicates that the sequence controller is the active one in the sequence control. The property Is Actv Seq Ctrl also displays this message. b Err BOOL Indicates that an error has been detected. More detailed information is shown in the properties Error Param Max Seq Ctrl and Seq Num Multiple. Further explanations on error analysis can be found at Error detection [} 169]. / Inputs Outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] Data and command structure between the individual sequence controllers FB_BA_Seq Ctrl [} 168] and the function block FB_BA_Sequence Link Base [} 171]. 170 Version: 1.14.0 TF8040
## Page 171

Programming Properties Name Type Access Description Actv Seq Ctrl UDINT Get The property shows the number of the active sequence controller. Error Param Max Seq T_Max String Get The property displays the following text in case of Ctrl error: "Global parameter Tc3_BA2. BA_Param.n Max Seq Ctrl < 1", see BA_Param.n Max Seq Ctrl [} 284]. The global parameter must be adjusted in any case, because due to the wrong parameterization the sequence stops. Seq Num Multiple T_Max String Get The property displays the following text in case of error: "Sequence number n My Num = x assigned multiple times". A check of the displayed sequence number is necessary because it has been assigned several times in the sequence. Is Actv Seq Ctrl BOOL Get The sequence controller is the active one in the sequence control. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.56 Tc3_XBA from v5.6.1.0 6.1.2.1.3.1.6.2 FB_BA_Sequence Link Base This function block represents the higher-level connection of a sequence control. Data exchange sequence control The data exchange between the sequence controllers FB_BA_Seq Ctrl [} 168] and the FB_BA_Sequence Link Base takes place via the structure st Seq Link [} 123]. TF8040 Version: 1.14.0 171
## Page 172

Programming Start behavior of the sequence A TRUE signal at input b En activates the entire sequence control. The function block will initially activate the sequence controller that is known at n Num Start Ctrl. All other sequence controller base their output value [} 168] on the ranking of the active controller. If the sequence controller specified at n Num Start Ctrl is not ready for operation, the enum e No Start Ctrl Found defines the procedure to find a new start controller. This ensures that the sequence always starts. Switching in the sequence If a sequence controller reaches its maximum or minimum value, the system switches to the next controller in the sequence depending on the control direction, provided that the actual value falls below or exceeds the setpoint of the next controller. 4 cases are distinguished: • The still active controller has a direct control direction (cooling, E_BA_Action.e Direct) and is at its maximum value: The next higher controller is selected in the ranking order if the actual value exceeds the setpoint of this controller. • The still active controller has a direct control direction (cooling, E_BA_Action.e Direct) and is at its minimum value: The next lower controller in the ranking order is selected if the actual value falls below the setpoint of this controller. • The still active controller has an indirect control direction (heating, E_BA_Action.e Reverse) and is at its maximum value: The next lower controller in the ranking order is selected if the actual value falls below the setpoint of this controller. • The still active controller has an indirect control direction (heating, E_BA_Action.e Reverse) and is at its minimum value: The next higher controller is selected in the ranking order if the actual value exceeds the setpoint of this controller. 172 Version: 1.14.0 TF8040
## Page 173

Programming Switching to another sequence controller can be delayed by specifying the time n Swi Over Ti. Operational readiness of the sequence controllers If a controller loses its operational readiness in the sequence (missing enable b En), it is no longer available for the entire sequence. If this is not the previously active controller, a temperature change may occur, depending on which control value this controller has output, which is compensated by the controller sequence, if possible. However, if it is the active sequence controller, the enumeration e No Enable Seq Ctrl defines the procedure to find a new, active sequence controller. If a sequence controller obtains its operational readiness in the running process, the controller is added to the sequence. Depending on the control direction E_BA_Action and its own sequence number n My Num it will be placed in the controller sequence and output its minimum or maximum value. The resulting temperature change is compensated by the controller sequence, if possible. Error detection The error messages listed below are detected by FB_BA_Sequence Link Base. The x in the text messages stands for a numerical specification of a sequence controller. The error messages are output in the "Error list" window in the Tc3 development environment. This can be activated under the menu item View. Output of the error texts via the property State Text. The enumeration e State additionally displays the messages. Globaler Parameter Tc3_BA2. BA_Param.n Max Seq Ctrl < 1 This message is the only one that disables sequence control. German English Der nächste Sequenzsollwert ist kleiner als sein Next sequence setpoint is smaller than its Vorgänger: x predecessor: x Globaler Parameter Global parameter Tc3_BA2. BA_Param.n Max Seq Ctrl Tc3_BA2. BA_Param.n Max Seq Ctrl < 1 < 1 Mehrfache Wirkrichtung "e Actn" in der Multiple direction of action "e Actn" of the sequence Sequenzsteuerung controller Startsequenzregler ist nicht freigegeben: Start sequence controller is not enabled: n Num Start Ctrl = x n Num Start Ctrl = x Kein Sequenzregler ist betriebsbereit No sequence controller is operational Sequenznummer mehrfach vergeben: x Sequence number assigned multiple times: x Syntax FUNCTION_BLOCK FB_BA_Sequence Link Base VAR_INPUT b En : BOOL; n Num Start Ctrl : UDINT; {attribute 'parameter Unit':= 's'} n Swi Over Ti : UDINT(0..1800); END_VAR VAR_OUTPUT b Seq Ctrl Operational : BOOL; n Actv Seq Ctrl : UDINT; f Actv Seq Ctrl_Y : REAL; f Actv Seq Ctrl_X : REAL; f Actv Seq Ctrl_W : REAL; b Actv Seq Ctrl Is Max Limit : BOOL; b Actv Seq Ctrl Is Min Limit : BOOL; b Err : BOOL; e State : E_BA_State Seq Link; {attribute 'parameter Unit':= 's'} TF8040 Version: 1.14.0 173
## Page 174

Programming n Rem Ti Swi Ovr Ti : UDINT; END_VAR VAR_IN_OUT st Seq Link : ST_BA_Seq Link; END_VAR VAR_INPUT CONSTANT f Hys : REAL := 0.2; e No Start Ctrl Found : E_BA_No Start Ctrl Found := E_BA_No Start Ctrl Found.e Last Acti on Reverse; e No Enable Seq Ctrl : E_BA_No Enable Seq Ctrl := E_BA_No Enable Seq Ctrl.e Next Action ; END_VAR Inputs Name Type Description b En BOOL Sequence control is activated when the function block is enabled. However, the sequence controllers must first be enabled. n Num Start Ctrl UDINT Ordinal number of the sequence controller, which should be the start controller when the sequence is activated. An internal limitation allows only values from 1 - BA_Param.n Max Seq Ctrl [} 284]. n Swi Over Ti UDINT Switching to another sequence controller can be delayed by the time specification. An internal limitation only allows values from 0 - 1800 seconds. Outputs Name Type Description b Seq Ctrl Operational BOOL The sequence control is ready to operate or is in operation. n Actv Seq Ctrl UDINT The output variable shows the number of the active sequence controller. f Actv Seq Ctrl_Y REAL Control value of the active sequence controller. f Actv Seq Ctrl_X REAL Actual value of the active sequence controller. f Actv Seq Ctrl_W REAL Setpoint of the active sequence controller. b Actv Seq Ctrl Is Max Li BOOL The upper output limit of the active sequence controller mit has been reached. If it has not yet been advanced to the next sequence controller, b Actv Seq Ctrl Is Max Limit is not set to FALSE until f Actv Seq Ctrl_Y has fallen below (f Actv Seq Ctrl_Y - f Hys). b Actv Seq Ctrl Is Min Li BOOL The lower output limit of the active sequence controller has mit been reached. If it has not yet been advanced to the next sequence controller, b Actv Seq Ctrl Is Min Limit is not set to FALSE until f Actv Seq Ctrl_Y has risen above (f Actv Seq Ctrl_Y + f Hys). b Err BOOL Indicates that an error has been detected. More detailed information is provided by the property State Text. In addition, the enum e State displays further information. Further explanations on error analysis can be found at Error detection [} 173]. e State E_BA_State Seq Link The enumeration shows the state of the FB_BA_Sequence Link Base and the sequence control. n Rem Ti Swi Ovr Ti UDINT Countdown of switching to the next sequence controller [s]. 174 Version: 1.14.0 TF8040
## Page 175

Programming / Inputs Outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] Data and command structure between the individual sequence controllers FB_BA_Seq Ctrl [} 168] and the function block FB_BA_Sequence Link Base [} 171]. Inputs CONSTANT Name Type Description f Hys REAL This hysteresis value sets a hysteresis around the upper and lower output limit b Actv Seq Ctrl Is Max Limit / b Actv Seq Ctrl Is Min Limit of the active sequence controller. An internal limitation only allows values from 0 - 2. e No Start Ctrl Found E_BA_No Start Ctrl Found If during the running process the active sequence controller loses its operational readiness, then the enumeration defines the procedure to find a new, active sequence controller. e No Enable Seq Ctrl E_BA_No Enable Seq Ctrl If the start controller at the input n Num Start Ctrl is not available or enabled, the enumeration defines the procedure to find a new start controller. TF8040 Version: 1.14.0 175
## Page 176

Programming Properties 176 Version: 1.14.0 TF8040
## Page 177

Programming Name Type Access Description First Actv Seq Ctrl UDINT Get The property shows the number of the first sequence controller ready for operation. First Actv Seq Ctrl Wit UDINT Get The property shows the number of the first h Action Direct sequence controller ready for operation with the control direction E_BA_Action.e Direct. Last Actv Seq Ctrl UDINT Get The property shows the number of the last sequence controller ready for operation. Last Actv Seq Ctrl Wit UDINT Get The property shows the number of the last sequence h Action Reverse controller ready for operation with the control direction E_BA_Action.e Reverse. Next Action Actv Seq UDINT Get Depending on the control direction of the active Ctrl sequence controller n Actv Seq Ctrl the next sequence controller ready for operation is displayed here. Cooling/Direct control direction: next sequence controller ready for operation with the Cooling/Direct control direction (after 5 would come 6 or higher). If none is found, then E_BA_No Enable Seq Ctrl.e Last Seq Num is implemented. Heating/reverse control direction: previous operational sequence controller with heating/reverse control direction (after 5 would come 4 or lower). If none is found, then E_BA_No Enable Seq Ctrl.e First Seq Num is implemented. Next Actv Seq Ctrl UDINT Get The property shows the number of the next sequence controller ready for operation after the last active one (after 5 would come 6 or higher). Previous Actv Seq Ctr UDINT Get The property shows the number of the previous l sequence controller ready for operation after the last active one (after 5 would come 4 or lower). Actv Seq Ctrl UDINT Get The property shows the number of the active sequence controller, see n Actv Seq Ctrl. Actv Seq Ctrl_Control REAL Get The property shows the control value of the active Value sequence controller, see f Actv Seq Ctrl_Y. Actv Seq Ctrl_Is Max L BOOL Get The property indicates that the upper output limit of imit the active sequence controller has been reached, see b Actv Seq Ctrl Is Max Limit. Actv Seq Ctrl_Is Min Li BOOL Get The property indicates that the lower output limit of mit the active sequence controller has been reached, see b Actv Seq Ctrl Is Min Limit. Error Param Max Seq T_Max String Get The property displays the following text in case of Ctrl error: "Global parameter Tc3_BA2. BA_Param.n Max Seq Ctrl < 1", see BA_Param.n Max Seq Ctrl [} 284]. The global parameter must be adjusted in any case, because due to the wrong parameterization the sequence stops. Error Start Seq Ctrl No T_Max String Get The property displays the following text in case of t Operable error: "Start sequence controller is not enabled: n Num Start Ctrl = x". A check of the start sequence controller, which was specified with the input variable n Num Start Ctrl, is required. TF8040 Version: 1.14.0 177
## Page 178

Programming Name Type Access Description Multi Direction Action T_Max String Get The property displays the following text in case of Seq Ctrl error: Multiple direction of action "e Actn" of the sequence controller: x. Multiple direction of action of the sequence controller. It always looks from the sequence controller with the smallest number to the next largest one. It is possible to change the direction of action. Next Seq Sp Is Smalle T_Max String Get The property displays the following text in case of r error: "Next sequence setpoint is smaller than its predecessor: x". A check of the setpoints of the sequence controllers according to ascending order is required. No Seq Ctrl Is Operati T_Max String Get The property displays the following text in case of an onal error: "No sequence controller is operational". A check of the operational readiness of the sequence controllers is required. Seq Num Multi T_Max String Get The property displays the following text in case of error: "Sequence number assigned multiple times: x". A check of the displayed sequence number is necessary because it has been assigned several times in the sequence. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.56 Tc3_XBA from v5.6.1.0 6.1.2.1.3.2 Functions 6.1.2.1.3.2.1 Parameter 6.1.2.1.3.2.1.1 Builder Using builders simplifies the initialization of complex parameters. Operating principle The functions offer the possibility of initializing individual values. Parameter-specific methods are provided for this purpose, such as methods for creating a calendar [} 120]: The benefits are: • Self-explanatory notation • Highly flexible • Equally applicable in declaration and implementation code See also: Examples 178 Version: 1.14.0 TF8040
## Page 179

Programming 6.1.2.1.3.2.1.1.1 F_BA_Calendar Builder The function provides methods that simplify the initialization of calendars [} 120]: Methods Name Description Append Date [} 180] Adds a date. Append Date Range [} 179] Adds a date range. Append Week NDay [} 181] Adds a specific day of the week within a month. See also: Samples Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.2.1.1.1.1 Management 6.1. Build 2.1. 3.2. 1.1. 1.1. 1 The method outputs the contents of a date list [} 120]. 6.1.2.1.3.2.1.1.1.2 Value 6.1. Append Date Range 2.1. 3.2. 1.1. 1.2. 1 TF8040 Version: 1.14.0 179
## Page 180

Programming The method adds a defined period to the initialized calendar. Illustration METHOD Append Date Range : I_BA_Calendar Builder VAR_INPUT n From Year : UINT(1900 .. 2155); e From Month : E_BA_Month := E_BA_Month. Unspecified; n From Day : UINT(1 .. 31); n To Year : UINT(1900 .. 2155); e To Month : E_BA_Month := E_BA_Month. Unspecified; n To Day : UINT(1 .. 31); END_VAR Inputs Name Type Description n From Year UINT Start year from 1900 to 2155. e From Month E_BA_Month Start month n From Day UINT Start day of a month from 1 to 31. n To Year UINT End year from 1900 to 2155. e To Month E_BA_Month End month n To Day UINT End day of a month from 1 to 31. 6.1. Append Date 2.1. 3.2. 1.1. 1.2. 2 The method appends a date value to the initialized calendar. Illustration METHOD Append Date : I_BA_Calendar Builder VAR_INPUT n Year : UINT(1900 .. 2155); e Month : E_BA_Month := E_BA_Month. Unspecified; n Day : UINT(1 .. 31); END_VAR Inputs Name Type Description n Year UINT Year from 1900 to 2155. e Month E_BA_Month Month n Day UINT Day of a month from 1 to 31. 180 Version: 1.14.0 TF8040
## Page 181

Programming 6.1. Append Week NDay 2.1. 3.2. 1.1. 1.2. 3 The method appends a defined day to the initialized calendar, in a given week of a month, in a given month. Illustration METHOD Append Week NDay : I_BA_Calendar Builder VAR_INPUT e Weekday : E_BA_Weekday := E_BA_Weekday. Invalid; e Week Of Month : E_BA_Week := E_BA_Week. Invalid; e Month : E_BA_Month := E_BA_Month. Invalid; END_VAR Inputs Name Type Description e Weekday E_BA_Weekday Day of the week e Week Of Month E_BA_Week Week within a month. e Month E_BA_Month Month 6.1.2.1.3.2.1.1.2 F_BA_Exception Schedule Builder The function provides methods that simplify the initialization of exception calendars: Methods Name Description Append Date [} 182] Adds a date. See also: Samples Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 TF8040 Version: 1.14.0 181
## Page 182

Programming 6.1.2.1.3.2.1.1.2.1 Management 6.1. Build 2.1. 3.2. 1.1. 2.1. 1 The method outputs the content Exception calendar [} 122]. 6.1.2.1.3.2.1.1.2.2 Value 6.1. Append Date Range 2.1. 3.2. 1.1. 2.2. 1 The method adds a defined period to the initialized calendar. Illustration METHOD Append Date Range : I_BA_Calendar Builder VAR_INPUT n From Year : UINT(1900 .. 2155); e From Month : E_BA_Month := E_BA_Month. Unspecified; n From Day : UINT(1 .. 31); n To Year : UINT(1900 .. 2155); e To Month : E_BA_Month := E_BA_Month. Unspecified; n To Day : UINT(1 .. 31); END_VAR Inputs Name Type Description n From Year UINT Start year from 1900 to 2155. e From Month E_BA_Month Start month n From Day UINT Start day of a month from 1 to 31. n To Year UINT End year from 1900 to 2155. e To Month E_BA_Month End month n To Day UINT End day of a month from 1 to 31. 6.1. Append Date 2.1. 3.2. 1.1. 2.2. 2 182 Version: 1.14.0 TF8040
## Page 183

Programming The method appends a date value to the initialized calendar. Illustration METHOD Append Date : I_BA_Calendar Builder VAR_INPUT n Year : UINT(1900 .. 2155); e Month : E_BA_Month := E_BA_Month. Unspecified; n Day : UINT(1 .. 31); END_VAR Inputs Name Type Description n Year UINT Year from 1900 to 2155. e Month E_BA_Month Month n Day UINT Day of a month from 1 to 31. 6.1. Append Week NDay 2.1. 3.2. 1.1. 2.2. 3 The method appends a defined day to the initialized calendar, in a given week of a month, in a given month. Illustration METHOD Append Week NDay : I_BA_Calendar Builder VAR_INPUT e Weekday : E_BA_Weekday := E_BA_Weekday. Invalid; e Week Of Month : E_BA_Week := E_BA_Week. Invalid; e Month : E_BA_Month := E_BA_Month. Invalid; END_VAR Inputs Name Type Description e Weekday E_BA_Weekday Day of the week e Week Of Month E_BA_Week Week within a month. e Month E_BA_Month Month 6.1.2.1.3.2.1.1.3 F_BA_Parameter Roles Builder The function provides methods that simplify the initialization of parameter roles: TF8040 Version: 1.14.0 183
## Page 184

Programming See also: FB_BA_Param [} 159] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.2.1.1.3.1 Management 6.1. Build 2.1. 3.2. 1.1. 3.1. 1 The method outputs the content of the possible BACnet Properties [} 108] according to the user role [} 99]. 6.1.2.1.3.2.1.1.3.2 Value 6.1. Set 2.1. 3.2. 1.1. 3.2. 1 The method provided a BACnet property depending on the user role. Illustration METHOD Set : I_BA_Param Role Builder VAR_INPUT e Param : E_BA_Parameter; e Access : E_BA_Role; END_VAR Inputs Name Type Description e Param E_BA_Parameter [} 108] BACnet property. e Access E_BA_Role [} 99] Definition of access rights. 184 Version: 1.14.0 TF8040
## Page 185

Programming 6.1. Set All 2.1. 3.2. 1.1. 3.2. 2 The method provided all BACnet properties depending on the user role. Illustration METHOD Set All : I_BA_Param Role Builder VAR_INPUT e Access : E_BA_Role; END_VAR Inputs Name Type Description e Access E_BA_Role [} 99] Definition of access rights. 6.1. Set Range 2.1. 3.2. 1.1. 3.2. 3 The method provided several BACnet properties depending on the user role. Illustration METHOD Set Range : I_BA_Param Role Builder VAR_INPUT e Param From : E_BA_Parameter; e Param To : E_BA_Parameter; e Access : E_BA_Role; END_VAR Inputs Name Type Description e Param From E_BA_Parameter [} 108] First BACnet Property. e Param To E_BA_Parameter [} 108] Last BACnet Property. e Access E_BA_Role [} 99] Definition of access rights. 6.1.2.1.3.2.1.1.4 F_BA_Plant Operation Builder The function provides methods that simplify the initialization of the plant operation: TF8040 Version: 1.14.0 185
## Page 186

Programming Methods Name Description Add Aggregate [} 186] Adds an aggregate. Add Operation Mode [} 187] Adds an operation mode. See also: FB_BA_Plant Ctrl [} 480] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.2.1.1.4.1 Management 6.1. Build 2.1. 3.2. 1.1. 4.1. 1 The method outputs the operating state [} 123] of the plant. 6.1.2.1.3.2.1.1.4.2 Value 6.1. Add Aggregate 2.1. 3.2. 1.1. 4.2. 1 186 Version: 1.14.0 TF8040
## Page 187

Programming The method defines the behavior of aggregates. Illustration METHOD Add Aggregate : I_BA_Plant Operation Builder VAR_INPUT i Ref : I_BA_Aggregate; b Wait For Processes : BOOL := FALSE; b Wait For Events : BOOL := FALSE; t Delay Step Down : TIME; t Delay Step Up : TIME; END_VAR Inputs Name Type Description i Ref I_BA_Aggregate Reference to the corresponding aggregate. b Wait For Processes BOOL Active processes are taken into account when switching. b Wait For Events BOOL Events of this (and higher) lock priority are taken into account when switching. t Delay Step Down TIME Delay in step-down. t Delay Step Up TIME Delay in step-up. 6.1. Add Operation Mode 2.1. 3.2. 1.1. 4.2. 2 The method defines an operation mode for the plant operation. Illustration METHOD Add Operation Mode : I_BA_Plant Operation Mode Builder VAR_INPUT n Op Mode : UDINT; e Prio : E_BA_Priority; e Ignore : E_BA_Aggregate Ignore Flags := E_BA_Aggregate Ignore Flags. None; END_VAR Inputs Name Type Description n Op Mode UDINT Operation mode. e Prio E_BA_Priority [} 110] Priority e Ignore E_BA_Aggregate Ignore Fla Defines the switching conditions. gs [} 106] TF8040 Version: 1.14.0 187
## Page 188

Programming 6.1.2.1.3.2.1.1.5 F_BA_Schedule Calendar Builder The function provides methods that simplify the initialization of schedules: Methods Name Description Append Reference [} 188] Adds a reference to a calendar. See also: Samples Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.2.1.1.5.1 Management 6.1. Build 2.1. 3.2. 1.1. 5.1. 1 The method outputs the content of a schedule [} 122]. 6.1.2.1.3.2.1.1.5.2 Value 6.1. Append Reference 2.1. 3.2. 1.1. 5.2. 1 The method passes a calendar reference. 188 Version: 1.14.0 TF8040
## Page 189

Programming Illustration METHOD Append Reference : I_BA_Schedule Calendar Entry Builder VAR_INPUT i Calendar : I_BA_Object; END_VAR Inputs Name Type Description i Calendar I_BA_Object Calendar reference. 6.1.2.1.3.2.1.1.6 F_BA_Weekly Schedule Builder The function provides methods that simplify the initialization of weekly time schedules: Methods Name Description Set Day Range [} 190] Sets the days when the calendar is active. See also: Samples Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.2.1.1.6.1 Management 6.1. Build 2.1. 3.2. 1.1. 6.1. 1 The method outputs the content of a weekly schedule [} 122]. TF8040 Version: 1.14.0 189
## Page 190

Programming 6.1.2.1.3.2.1.1.6.2 Value 6.1. Set All Days 2.1. 3.2. 1.1. 6.2. 1 The method defines all days of the week for the weekly schedule. 6.1. Set Day 2.1. 3.2. 1.1. 6.2. 2 The method defines a specific day of the week for the weekly schedule. Illustration METHOD Set Day : I_BA_Weekly Entry Builder VAR_INPUT e Day : E_BA_Weekday; END_VAR Inputs Name Type Description e Day E_BA_Weekday Selected day of the week 6.1. Set Day Range 2.1. 3.2. 1.1. 6.2. 3 The method defines a period over several days for the weekly schedule. Illustration METHOD Set Day Range : I_BA_Weekly Entry Builder VAR_INPUT e Day From : E_BA_Weekday; e Day To : E_BA_Weekday; END_VAR 190 Version: 1.14.0 TF8040
## Page 191

Programming Inputs Name Type Description e Day From E_BA_Weekday First day of the period. e Day To E_BA_Weekday Last day of the period. 6.1.2.1.3.3 Objects 6.1.2.1.3.3.1 Local The following chapter provides information about the local server objects. 6.1.2.1.3.3.1.1 Analog Description of the analog function blocks. 6.1.2.1.3.3.1.1.1 FB_BA_AI The function block represents an analog input. It is used to map a measured value within the project structure by means of an analog input object. The measured value must already exist as a scaled value within the controller. When using this function block, the measuring signal comes, for example, from a fieldbus and not from a bus terminal. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] TF8040 Version: 1.14.0 191
## Page 192

Programming FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base AI [} 243] Syntax FUNCTION_BLOCK FB_BA_AI EXTENDS FB_BA_Base AI VAR_INPUT f Val : REAL; e Rlbty : E_BA_Reliability; END_VAR Inputs Name Type Description f Val REAL Scaled, analog input value. e Rlbty E_BA_Reliability Availability or reliability of a value. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.1.2 FB_BA_AI_IO The function block represents the object for an analog input. It is used to map a measured value within the project structure. The process variables for linking the function block to the bus terminal are available within the function block. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] 192 Version: 1.14.0 TF8040
## Page 193

Programming FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base AI [} 243] Syntax FUNCTION_BLOCK FB_BA_AI_IO EXTENDS FB_BA_Base AI IMPLEMENTS I_BA_Raw AI VAR {region 'Raw I/O'} n Raw State AT %I* : USINT; n Raw Data In AT %I* : INT; {endregion} END_VAR VAR Name Type Description n Raw State USINT Variable for linking the status information of a terminal. n Raw Data In INT Variable for linking the raw data of an analog input terminal. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.1.3 FB_BA_AI_IOEx The function block represents the object of an analog input. The process variables for linking the function block to the bus terminal are created within the function block. The function block also enables configuration of the analog input terminal. The function block FB_BA_KL32xx is used for this purpose. TF8040 Version: 1.14.0 193
## Page 194

Programming Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base AI [} 243] Syntax FUNCTION_BLOCK FB_BA_AI_IOEx EXTENDS FB_BA_Base AI VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Sensor : E_BA_Measuring Element := BA_Param.f Input_Def Sensor; {endregion} END_VAR VAR_INPUT CONSTANT {region 'Operational Parameters'} b Configurate : BOOL := TRUE; {endregion} END_VAR VAR {region 'Output-Properties'} s Terminal Type : STRING; {endregion} END_VAR VAR {region 'I/O'} n Raw State AT %I* : USINT; n Raw Data In AT %I* : INT; n Raw Ctrl AT %Q* : USINT; n Raw Data Out AT %Q* : INT; i Src IO : I_BA_Raw AI; {endregion} END_VAR Inputs CONSTANT PERSISTENT Name Type Description e Sensor E_BA_Measuring Element This input is used to set the sensor. The setting is made by selecting the type in the enumeration. Inputs CONSTANT Name Type Description b Configurate BOOL Start of the terminal configuration. VAR Name Type Description s Terminal Type STRING Indicates the type of bus terminal used. n Raw State USINT Variable for linking the status information of a terminal. n Raw Data In INT Variable for linking the raw data of an analog input terminal. n Raw Ctrl USINT Variable for linking with the control information of a terminal. n Raw Data Out INT Variable for linking the output value of the PLC with the process image of an output terminal. 194 Version: 1.14.0 TF8040
## Page 195

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.1.4 FB_BA_AI_Raw The function block represents the object of an analog input. It has input variables for connecting the process values of the terminal. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base AI [} 243] Syntax FUNCTION_BLOCK FB_BA_AI_Raw EXTENDS FB_BA_Base AI VAR_INPUT n Raw State : USINT; n Raw Val : INT; END_VAR TF8040 Version: 1.14.0 195
## Page 196

Programming Inputs Name Type Description n Raw State USINT Variable for linking the status information of a terminal. n Raw Val INT Raw value Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.1.5 FB_BA_AO The function block is used to map a control output within the project structure. When using this function block, the control signal is not output to a terminal, but to a fieldbus, for example. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] 196 Version: 1.14.0 TF8040
## Page 197

Programming FB_BA_Com Event Object [} 260] FB_BA_Base AO [} 245] Syntax FUNCTION_BLOCK FB_BA_AO EXTENDS FB_BA_Base AO VAR_INPUT e Rlbty : E_BA_Reliability; b Raw Ovrrd : BOOL; END_VAR Inputs Name Type Description e Rlbty E_BA_Reliability Availability or reliability of a value. b Raw Ovrrd BOOL The feedback of a switch contained in a terminal can be connected to this variable for mechanical override of an output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.1.6 FB_BA_AO_IO TF8040 Version: 1.14.0 197
## Page 198

Programming The function block represents an analog output object within the base framework. The variables for linking the control output to the terminal are declared within the function block. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base AO [} 245] Syntax FUNCTION_BLOCK FB_BA_AO_IO EXTENDS FB_BA_Base AO IMPLEMENTS I_BA_Raw AO VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Overridden Polarity : E_BA_Polarity := E_BA_Polarity.e Normal; {endregion} END_VAR VAR {region 'Raw I/O'} b Raw Overridden AT %I* : BOOL; n Raw State AT %I* : USINT; n Raw Data Out AT %Q* : INT; {endregion} END_VAR Inputs CONSTANT PERSISTENT Name Type Description e Overriden Polarity E_BA_Polarity Output terminals with mechanical priority operation report the state of their switches back to the controller. With this enumeration the polarity of the switch feedback can be parameterized. VAR Name Type Description b Raw Overridden BOOL Variable for detecting an override from the outside. n Raw State USINT Variable for linking the status information of a terminal. n Raw Data Out INT Variable for linking the output value of the PLC with the process image of an output terminal. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 198 Version: 1.14.0 TF8040
## Page 199

Programming 6.1.2.1.3.3.1.1.7 FB_BA_AO_Raw The function block represents an analog output object within the base framework. The variable n Raw Val is used to link the control value with the process image of the terminal. It has a priority array and can therefore be commanded [} 34]. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base AO [} 245] Syntax FUNCTION_BLOCK FB_BA_AO_Raw EXTENDS FB_BA_Base AO VAR_INPUT b Raw Overridden : BOOL; END_VAR TF8040 Version: 1.14.0 199
## Page 200

Programming VAR_OUTPUT n Raw Val : INT; END_VAR Inputs Name Type Description b Raw Overridden BOOL To this variable can be connected the feedback of a switch contained in a terminal, for the mechanical override of an output. Outputs Name Type Description n Raw Val INT The variable is used to link the raw value of an object with the process image of the input or output terminal. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.1.8 FB_BA_AV The function block represents an analog Value object. It has a priority array and can be commanded [} 34]. 200 Version: 1.14.0 TF8040
## Page 201

Programming Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] Syntax FUNCTION_BLOCK FB_BA_AV EXTENDS FB_BA_Event Object Ex IMPLEMENTS I_BA_Analog Prio Object, I_BA_Any Value VAR_INPUT b En Sfty : BOOL; f Val Sfty : REAL; b En Crit : BOOL; f Val Crit : REAL; b En Man Loc : BOOL; f Val Man Loc : REAL; b En Pgm : BOOL; f Val Pgm : REAL; END_VAR VAR_OUTPUT f Present Value : REAL; e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} f Default Value : REAL; b En Out Of Service : BOOL; e Unit : E_BA_Unit:= E_BA_Unit. Invalid; f COVIncrement : REAL := BA_Param.f Def COVIncrement; st Low Limit : ST_BA_Limit Param; st High Limit : ST_BA_Limit Param; f Limit Deadband : REAL := BA_Param.f Def Limit Deadband; {endregion} {region 'Operational Parameters'} b En Manual Rm : BOOL; f Val Manual Rm : REAL; {endregion} END_VAR Inputs Name Type Description b En Sfty BOOL Enabling the "Safety" priority. f Val Sfty REAL Analog value for the "Safety" priority. b En Crit BOOL Enabling the "Critical" priority. f Val Crit REAL Analog value for the "Critical" priority. b En Man Loc BOOL Enabling the "Manual Local" priority. f Val Man Loc REAL Analog value for the "Manual Local" priority. b En Pgm BOOL Enabling the "Program" priority. f Val Pgm REAL Analog value for the "Program" priority. Outputs Name Type Description f Present Value REAL Current analog output value of the object. e Active Prio E_BA_Priority [} 110] Active priority TF8040 Version: 1.14.0 201
## Page 202

Programming Inputs CONSTANT PERSISTENT Name Type Description f Default Value REAL Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. b En Out Of Service BOOL This variable sets an object out of service. It is thus Out Of Service. e Unit E_BA_Unit Unit of the input or output value of an analog object. f COVIncrement REAL The variable specifies the minimum change in present value that will cause a COV notification to be issued to subscribed COV clients. This property is required if COV reporting is supported by this object. st Low Limit ST_BA_Limit Param [} 120] Parameterization of the lower limit value monitoring of an analog object. The variable b Enable must be TRUE to enable limit value monitoring. The variable f Value is used to parameterize the lower limit value. st High Limit ST_BA_Limit Param [} 120] Parameterization of the upper limit value monitoring of an analog object. The variable b Enable must be TRUE to enable limit value monitoring. The variable f Value is used to parameterize the upper limit value. f Limit Deadband REAL Dead band or hysteresis for the values High Limit and Low Limit of the limit value monitoring of an analog object. b En Manual Rm BOOL Enabling the "Manual Remote" priority. f Val Manual Rm REAL Analog value for the "Manual Remote" priority. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.1.9 FB_BA_AV_Op The function block represents an analog Value object. It is used to display or enter an analog value. If the input variable f Value Pgm is linked, then the function block automatically recognizes that it is used to display the connected value. In the other case, it is used to enter a setpoint, for example. Inheritance hierarchy FB_BA_Base 202 Version: 1.14.0 TF8040
## Page 203

Programming FB_BA_Base Publisher FB_BA_Object [} 264] Syntax FUNCTION_BLOCK FB_BA_AV_Op EXTENDS FB_BA_Object IMPLEMENTS I_BA_Analog Op Object, I_BA_Any Value VAR_INPUT f Value Pgm : REAL; END_VAR VAR_OUTPUT f Present Value : REAL; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Unit : E_BA_Unit := E_BA_Unit. Invalid; f COVIncrement : REAL := BA_Param.f Def COVIncrement; {endregion} {region 'Operational Parameters'} f Value Rm : REAL; {endregion} END_VAR VAR {region 'Interface'} e Value Source : E_BA_Process Signal Source; {endregion} END_VAR Inputs Name Type Description f Value Pgm Real Output values of the analog object for the "Program" priority. Outputs Name Type Description f Present Value REAL Current analog output value of the object. Inputs CONSTANT PERSISTENT Name Type Description e Unit E_BA_Unit Unit of the input or output value of an analog object. f COVIncrement REAL The variable specifies the minimum change in present value that will cause a COV notification to be issued to subscribed COV clients. This property is required if COV reporting is supported by this object. f Value Rm REAL Variable for overwriting an analog object from the HMI. VAR Name Type Description e Value Source E_BA_Process Signal Source The variable indicates whether an object of the type FB_BA_..._OP serves as a display or input object. [} 113] e Var Input = 1 The object is used to display a value. The value is passed to the object at an input within the PLC. e Parameter = 2 The object is used to enter a parameter that can be changed by a BACnet client or the Twin CAT HMI. TF8040 Version: 1.14.0 203
## Page 204

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.2 Binary Below you will find the description of the binary function blocks. 6.1.2.1.3.3.1.2.1 FB_BA_BI The function block FB_BA_BI represents a binary input object within the base framework. The variables for linking the input to the terminal are available as input variables on the function block. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base BI [} 248] Illustration FUNCTION_BLOCK FB_BA_BI EXTENDS FB_BA_Base BI VAR_INPUT b Val : BOOL; e Rlbty : E_BA_Reliability; END_VAR 204 Version: 1.14.0 TF8040
## Page 205

Programming Inputs Name Type Description b Val BOOL Binary value e Rlbty E_BA_Reliability Availability or reliability of a value. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.2.2 FB_BA_BI_IO The function block FB_BA_BI_IO represents a binary input object within the base framework. The variables for linking the input to the terminal are declared within the function block. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base BI [} 248] FB_BA_BI [} 204] Illustration VAR {region 'Raw I/O'} b Raw Val AT %I* : BOOL; {endregion} TF8040 Version: 1.14.0 205
## Page 206

Programming Name Type Description b Raw Val BOOL Variable for linking the input value to the terminal. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.2.3 FB_BA_BI_Raw The function block FB_BA_BI_Raw generates a binary input object within the basic framework. The variable b Raw Val is used to link the binary input to the terminal. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base BI [} 248] Illustration FUNCTION_BLOCK FB_BA_BI_Raw EXTENDS FB_BA_Base BI VAR_INPUT b Raw Val : BOOL; END_VAR 206 Version: 1.14.0 TF8040
## Page 207

Programming Inputs Name Type Description b Raw Val BOOL Raw value Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.2.4 FB_BA_BO The function block FB_BA_BO represents a binary output object within the base framework. The variables for linking the control output to the terminal are available as input or output variables on the function block. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] TF8040 Version: 1.14.0 207
## Page 208

Programming FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base BO [} 250] Illustration FUNCTION_BLOCK FB_BA_BO EXTENDS FB_BA_Base BO VAR_INPUT e Rlbty : E_BA_Reliability; b Raw Ovrrd : BOOL; b En Fdbck : BOOL; b Raw Val Fdbck : BOOL; END_VAR Inputs Name Type Description e Rlbty E_BA_Reliability Availability or reliability of a value. b Raw Ovrrd BOOL The feedback of a switch contained in a terminal can be connected to this variable for mechanical override of an output. b En Fdbck BOOL Variable for starting the monitoring of the feedback at the binary output. b Raw Val Fdbck BOOL The variable corresponds to the value of the current feedback. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 208 Version: 1.14.0 TF8040
## Page 209

Programming 6.1.2.1.3.3.1.2.5 FB_BA_BO_IO The function block FB_BA_BO_IO represents a binary output object within the base framework. The variables for linking the switching output to the terminal are declared within the function block. The feedback control of the binary output is automatically activated if the variable b Raw Val Feedback is linked to the process image of a terminal. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base BO [} 250] Illustration FUNCTION_BLOCK FB_BA_BO_IO EXTENDS FB_BA_Base BO IMPLEMENTS I_BA_Raw BO VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Feedback Polarity : E_BA_Polarity := E_BA_Polarity.e Normal; e Overridden Polarity : E_BA_Polarity := E_BA_Polarity.e Normal; TF8040 Version: 1.14.0 209
## Page 210

Programming {endregion} END_VAR VAR {region 'Raw I/O'} b Raw Overridden AT %I* : BOOL; b Raw Val Feedback AT %I* : BOOL; b Raw Val AT %Q* : BOOL; {endregion} END_VAR Inputs Constant Persistent Name Type Description e Feedback Polarity E_BA_Polarity Variable for parameterizing the polarity of the binary operating feedback of an output. e Overriden Polarity E_BA_Polarity Output terminals with mechanical priority operation report the state of their switches back to the controller. With this enumeration the polarity of the switch feedback can be parameterized. VAR Name Type Description b Raw Overridden BOOL Variable for detecting an override from the outside. b Raw Val Feedback BOOL Activation of feedback control after linking with the bus terminal. b Raw Val BOOL Variable for linking the output value to the terminal. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 210 Version: 1.14.0 TF8040
## Page 211

Programming 6.1.2.1.3.3.1.2.6 FB_BA_BO_Raw The function block FB_BA_BO_Raw represents a binary output object within the base framework. The variable b Raw Val is used to link the switching command with the process image of the terminal. The object has a priority array and can therefore be commanded [} 34]. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base BO [} 250] Illustration FUNCTION_BLOCK FB_BA_BO_Raw EXTENDS FB_BA_Base BO VAR_INPUT b Raw Ovrrd : BOOL; TF8040 Version: 1.14.0 211
## Page 212

Programming b En Fdbk : BOOL; b Raw Val Fdbk : BOOL; END_VAR VAR_OUTPUT b Raw Val : BOOL; END_VAR Inputs Name Type Description b Raw Ovrrd BOOL The feedback of a switch contained in a terminal can be connected to this variable for mechanical override of an output. b En Fdbck BOOL Variable for starting the monitoring of the feedback at the binary output. b Raw Val Fdbck BOOL The variable corresponds to the value of the current feedback. Outputs Name Type Description b Raw Val BOOL Value of the binary output for linking to the process image of the terminal. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 212 Version: 1.14.0 TF8040
## Page 213

Programming 6.1.2.1.3.3.1.2.7 FB_BA_BV The function block FB_BA_BV represents a binary value object. It has a priority array and can therefore be commanded [} 34]. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] Illustration FUNCTION_BLOCK FB_BA_BV EXTENDS FB_BA_Event Object Ex IMPLEMENTS I_BA_Binary Prio Object, I_BA_Any Value VAR_INPUT b En Sfty : BOOL; b Val Sfty : BOOL; b En Crit : BOOL; b Val Crit : BOOL; b En Man Loc : BOOL; b Val Man Loc : BOOL; b En Pgm : BOOL; b Val Pgm : BOOL; END_VAR VAR_OUTPUT b Present Value : BOOL; e Active Prio : E_BA_Priority; END_VAR TF8040 Version: 1.14.0 213
## Page 214

Programming VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} n Minimum Off Time : UDINT; n Minimum On Time : UDINT; b Default Value : BOOL; b En Out Of Service : BOOL; s Inactive Text : T_BA_State Text; s Active Text : T_BA_State Text; b Alarm Value : BOOL := TRUE; n State Change Count : UDINT; n Active Time Elapsed : UDINT; {endregion} {region 'Operational Parameters'} b En Manual Rm : BOOL; b Val Manual Rm : BOOL; {endregion} END_VAR VAR {region 'Output-Properties'} st State Change Time : ST_BA_Date Time; st State Change Reset Point : ST_BA_Date Time; st Active Time Reset Point : ST_BA_Date Time; {endregion} END_VAR Inputs Name Type Description b En Sfty BOOL Enabling the "Safety" priority. b Val Sfty BOOL Binary value for the "Safety" priority. b En Crit BOOL Enabling the "Critical" priority. b Val Crit BOOL Binary value for the "Critical" priority. b En Man Loc BOOL Enabling the "Manual Local" priority. b Val Man Loc BOOL Binary value for the "Manual Local" priority. b En Pgm BOOL Enabling the "Program" priority. b Val Pgm BOOL Binary value for the "Program" priority. Outputs Name Type Description b Present Value BOOL Current binary output value of the object. e Active Prio E_BA_Priority [} 110] Active priority 214 Version: 1.14.0 TF8040
## Page 215

Programming Inputs CONSTANT PERSISTENT Name Type Description n Minimum Off Time UDINT Minimum time [s] in which the Present_Value should remain in the INACTIVE state after a write operation to Present_Value has assumed the INACTIVE state. This can be used to implement protection against too fast restarting. n Minimum On Time UDINT Minimum time [s] in which the Present_Value is to remain in the ACTIVE state after a write operation to Present_Value has assumed the ACTIVE state. This can be used to implement protection against premature, renewed switch-off b Default Value BOOL Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. b En Out Of Service BOOL This variable sets an object out of service. It is thus Out Of Service. s Inactive Text T_BA_State Text [} 121] Text output when the object is inactive. s Active Text T_BA_State Text [} 121] Text output when the object is active. b Alarm Value BOOL Value in the event of an alarm. n State Change Count UDINT The variable indicates how often the state of the Present_Value has changed since the date and the last reset. n Active Time Elapsed UDINT Time [s] in which the Present_Value of the object had the value ACTIVE. The time is valid from the last reset by the property Time_Of_Active_Time_Reset. b En Manual Rm BOOL Enabling the "Manual Remote" priority. b Val Manual Rm BOOL Binary value for the "Manual Remote" priority. VAR Name Type Description st State Change Time ST_BA_Date Time This property shows the time of the last state change. The state change refers to the Present_Value of the object. st State Change Reset ST_BA_Date Time Shows the date and time from which the counting of state Point changes started. st Active Time Reset P ST_BA_Date Time Indicates the time when the recording of the object's oint switch-on times started. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 TF8040 Version: 1.14.0 215
## Page 216

Programming 6.1.2.1.3.3.1.2.8 FB_BA_BV_Op The function block FB_BA_BV_Op represents a binary value object. It is used to display or input a binary value. If the input variable b Value Pgm is linked, then the function block automatically recognizes that it is used to display the connected value. In the other case, it is used to enter a binary value. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] Illustration FUNCTION_BLOCK FB_BA_AV_Op EXTENDS FB_BA_Object IMPLEMENTS I_BA_Analog Op Object, I_BA_Any Value VAR_INPUT b Value Pgm : BOOL; END_VAR VAR_OUTPUT b Present Value : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Unit : E_BA_Unit := E_BA_Unit. Invalid; f COVIncrement : REAL := BA_Param.f Def COVIncrement; {endregion} {region 'Operational Parameters'} f Value Rm : REAL; {endregion}; END_VAR VAR {region 'Interface'} e Value Source : E_BA_Process Signal Source := E_BA_Process Signal Source. Invalid; {endregion} END_VAR Inputs Name Type Description b Value Pgm BOOL Value of a binary object for the "Program" priority. Outputs Name Type Description b Present Value BOOL Current binary output value of the object. 216 Version: 1.14.0 TF8040
## Page 217

Programming Inputs CONSTANT PERSISTENT Name Type Description e Unit E_BA_Unit Unit of the input or output value of an analog object. f COVIncrement REAL The variable specifies the minimum change in present value that will cause a COV notification to be issued to subscribed COV clients. This property is required if COV reporting is supported by this object. f Value Rm REAL Variable for overwriting an analog object from the HMI. VAR Name Type Description e Value Source E_BA_Process Signal Source The variable indicates whether an object of the type FB_BA_..._OP serves as a display or input object. [} 113] e Var Input = 1 The object is used to display a value. The value is passed to the object at an input within the PLC. e Parameter = 2 The object is used to enter a parameter that can be changed by a BACnet client or the Twin CAT HMI. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.3 Misc Description of the objects Calendar, Event-Class, Controller, Scheduler and Trend. 6.1.2.1.3.3.1.3.1 FB_BA_Cal The function block FB_BA_Cal represents a calendar within the project structure. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] Illustration FUNCTION_BLOCK FB_BA_Cal EXTENDS FB_BA_Object IMPLEMENTS I_BA_Cal VAR_OUTPUT b Present Value : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} a Date List : T_BA_Calendar Date List; TF8040 Version: 1.14.0 217
## Page 218

Programming {endregion} END_VAR VAR_INPUT CONSTANT {region 'Variable Parameters'} b Write Date List : BOOL; {endregion} END_VAR Outputs Name Type Description b Present Value BOOL Current binary output value of the object. Inputs CONSTANT PERSISTENT Name Type Description a Date List T_BA_Calendar Date List Date list. [} 120] Inputs CONSTANT Name Type Description b Write Date List BOOL Enable to write to a date list. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.17 Tc3_BA2 from v4.8.9.0 6.1.2.1.3.3.1.3.2 FB_BA_EC The function block FB_BA_EC represents an event class (cf. notification class) within the project structure of TF8040. The detection of an event and the object-internal reporting (intrinsic reporting) is located in the event-enabled objects. The subsequent distribution of the events to the event clients, on the other hand, is not executed in the objects, but in the event class. Each event-enabled object is assigned an event class. One or more objects can be assigned to an event class. 218 Version: 1.14.0 TF8040
## Page 219

Programming The event class describes properties of an event. All objects assigned to this event class get these properties. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] Illustration FUNCTION_BLOCK FB_BA_EC EXTENDS FB_BA_Object IMPLEMENTS I_BA_Event Class VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} a Priority : ARRAY[E_BA_Event Transition. First .. E_BA_Event Transition. Last] OF UDIN T; {endregion} {region 'Fixed Parameters'} e Event Type : E_BA_Event Type := E_BA_Event Type.e Other; e Alarm Mode : E_BA_Alarm Mode := E_BA_Alarm Mode. Invalid; a Acknowledge Required : T_BA_Event Transitions; {endregion} END_VAR Inputs CONSTANT PERSISTENT Name Type Description a Priority ARRAY The variable specifies the priority with which the event [E_BA_Event Transition. Fi class notifications are transmitted. The priorities range rst.. E_BA_Event Transition from 0 to 255 inclusive. A lower number means a higher . Last] OF UDINT priority. e Event Type E_BA_Event Type [} 103] This parameter is used to describe an event in more detail. The type of the event also describes the representation in the Twin CAT HMI [} 1120]. e Alarm Mode E_BA_Alarm Mode [} 101] The requirements regarding the acknowledgement and resetting of events are not parameterized on the objects, but on the event classes. Three standard alarm modes are available: The acknowledgement refers to incoming alarms and the reset to outgoing alarms. The alarm mode in Twin CAT Building Automation determines whether an event (or an object) must be acknowledged and / or reset. TF8040 Version: 1.14.0 219
## Page 220

Programming The default behavior of individual alarm modes can be adjusted by means of global parameters [} 126]. This may be necessary if, for example, operators require compliance with certain specifications. All settings are carefully preset. Changes have a significant effect on the event behavior of an object and should be implemented with caution! Name Type Description a Acknowledge Requi T_BA_Event Transitions Acknowledgement required. red [} 115] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.3.3 FB_BA_Loop The function block FB_BA_Loop represents a PID controller within the project structure of TF8040. Functional diagram The controller can be operated either in parallel structure or with upstream P part. This is specified by the input e Op Mode. Upstream P part: e Op Mode := E_BA_PIDMode. e P1ID Parallel structure: e Op Mode := E_BA_PIDMode. e PID 220 Version: 1.14.0 TF8040
## Page 221

Programming Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] Illustration FUNCTION_BLOCK FB_BA_Loop EXTENDS FB_BA_Object IMPLEMENTS I_BA_Loop VAR_INPUT b En : BOOL; f Setpoint : REAL; f Ctrl Val : REAL; e Action Pgm : E_BA_Action; f Min Output Pgm : REAL; f Max Output Pgm : REAL; b En Sync : BOOL; f Val Sync : REAL; END_VAR VAR_OUTPUT f Present Value : REAL; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Output Unit : E_BA_Unit := E_BA_Unit.e Other_Percent; f COVIncrement : REAL := BA_Param.f Def COVIncrement; e Op Mode : E_BA_PIDMode := BA_Param.n Loop_Def Op Mode; e Action Rm : E_BA_Action := E_BA_Action.e Direct; f Neutral Zone : REAL:= 0; f Min Output Rm : REAL:= 0; f Max Output Rm : REAL:= 100; f Proportional Constant : REAL; f Integral Constant : REAL; f Derivative Constant : REAL := 0; n Damp Constant : UDINT; st Step Delay : ST_BA_Step Delay Param; {endregion} END_VAR VAR {region 'Output-Properties'} f Ctrl Deviation : REAL; {endregion} END_VAR VAR {region 'Hardware'} e Action Source : E_BA_Process Signal Source; e Min Max Output Source : E_BA_Process Signal Source; {endregion} END_VAR Inputs Name Type Description b En BOOL Activation of the function block. f Setpoint REAL Setpoint f Ctrl Val REAL Feedback of the control value for calculating the control deviation from the setpoint. e Action Pgm E_BA_Action Setting the control direction. f Min Output Pgm REAL Lower controller output limit. f Max Output Pgm REAL Upper controller output limit. b En Sync BOOL Enable synchronization. f Val Sync REAL Synchronization value. After a positive edge at b En Sync this value is written to f Present Value. TF8040 Version: 1.14.0 221
## Page 222

Programming Outputs Name Type Description f Present Value REAL Current analog output value of the object. Inputs CONSTANT PERSISTENT Name Type Description e Output Unit E_BA_Unit Output unit f COVIncrement REAL Step size of the Present Value that triggers a COV Notification. e Op Mode E_BA_PIDMode Pre- or parallel-set P part. e Action Rm E_BA_Action Control direction f Neutral Zone REAL Neutral zone f Min Output Rm REAL Minimum output value due to external override. f Max Output Rm REAL Maximum output value due to external override. f Proportional Consta REAL Proportional constant. nt f Integral Constant REAL Integral constant. f Derivative Constant REAL Derivative constant. n Damp Constant UDINT Damping constant. VAR Name Type Description f Ctrl Deviation REAL Control deviation e Action Source E_BA_Process Signal Source Definition of whether the control direction is to be treated as a variable or as a parameter. [} 113] e Min Max Output Sour E_BA_Process Signal Source Definition whether the output source is to be treated as a ce variable or as a parameter. [} 113] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.3.4 FB_BA_Sched A The function block FB_BA_Sched A represents an analog scheduler within the project structure of TF8040. 222 Version: 1.14.0 TF8040
## Page 223

Programming Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Base Sched [} 256] Illustration FUNCTION_BLOCK FB_BA_Sched A EXTENDS FB_BA_Base Sched IMPLEMENTS I_BA_Sched A VAR_OUTPUT f Present Value : REAL; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Fixed Parameters'} f Default Value : REAL; {endregion} {region 'Variable Parameters'} e Unit : E_BA_Unit:= E_BA_Unit. Invalid; {endregion} END_VAR Outputs Name Type Description f Present Value REAL Current analog output value of the object. Inputs CONSTANT PERSISTENT Name Type Description f Default Value REAL Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. e Unit E_BA_Unit Unit of the input or output value of an analog object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.3.5 FB_BA_Sched B The FB_BA_Sched B function block represents a binary scheduler within the TF8040 project structure. TF8040 Version: 1.14.0 223
## Page 224

Programming Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Base Sched [} 256] Illustration FUNCTION_BLOCK FB_BA_Sched B EXTENDS FB_BA_Base Sched IMPLEMENTS I_BA_Sched B VAR_OUTPUT b Present Value : BOOL; b Predicted Value : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Fixed Parameters'} b Default Value : BOOL; {endregion} {region 'Variable Parameters'} s Inactive Text : T_BA_State Text; s Active Text : T_BA_State Text; {endregion} END_VAR Outputs Name Type Description b Present Value BOOL Current binary output value of the object. b Predicted Value BOOL Value that is assumed after the next switching. Inputs CONSTANT PERSISTENT Name Type Description b Default Value BOOL Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. s Inactive Text T_BA_State Text [} 121] Text output when the object is inactive. s Active Text T_BA_State Text [} 121] Text output when the object is active. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 224 Version: 1.14.0 TF8040
## Page 225

Programming 6.1.2.1.3.3.1.3.6 FB_BA_Sched M The function block FB_BA_Sched M represents a multi-state scheduler within the project structure of TF8040. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Base Sched [} 256] Illustration FUNCTION_BLOCK FB_BA_Sched M EXTENDS FB_BA_Base Sched IMPLEMENTS I_BA_Sched M VAR_OUTPUT n Present Value : UDINT; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Fixed Parameters'} a State Text : T_BA_State Text Array; n Default Value : UDINT := 1; {endregion} END_VAR VAR {region 'Output-Properties'} n State Count : UDINT; {endregion} END_VAR Outputs Name Type Description n Present Value UDINT Current value for multi-stage outputs. Inputs CONSTANT PERSISTENT Name Type Description a State Text T_BA_State Text Array The array is used to declare the state texts of a multi-state object. [} 121] n Default Value UDINT Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. TF8040 Version: 1.14.0 225
## Page 226

Programming VAR Name Type Description n State Count UDINT Number of states of a multi-state object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.3.7 FB_BA_Trend The function block FB_BA_Trend represents a trend within the project structure of TF8040. Information about inherited elements FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] Illustration FUNCTION_BLOCK FB_BA_Trend EXTENDS FB_BA_Event Object IMPLEMENTS I_BA_Trend VAR_OUTPUT n Record Count : UDINT; n Total Record Count : UDINT; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Fixed Parameters'} n Buffer Size : UDINT := BA_Param.n Trend_Buffer Size; {endregion} {region 'Variable Parameters'} a Log Buffer : T_BA_Trend Log Buffer; b Enable : BOOL; st Start Time : ST_BA_Date Time := BA_Param.st Trend_Def Start Time; st Stop Time : ST_BA_Date Time := BA_Param.st Trend_Def Stop Time; b Stop On Full : BOOL := BA_Param.b Trend_Def Stop On Full; n Log Interval : UDINT := BA_Param.n Trend_Def Log Interval; n Notification Threshold : UDINT := BA_Param.n Trend_Def Notification Threshold; 226 Version: 1.14.0 TF8040
## Page 227

Programming e Logging Type : E_BA_Logging Type := BA_Param.e Trend_Def Logging Type; st Referenced Param : ST_BA_Object Parameter; {endregion} END_VAR VAR_OUTPUT Name Type Description n Record Count UDINT Number of records. n Total Record Count UDINT Absolute number of records. VAR_INPUT CONSTANT PERSISTENT Name Type Description n Buffer Size UDINT Size of the buffer. a Log Buffer ST_BA_Trend Entry Ring buffer for values with timestamp. b Enable BOOL Recording enable. st Start Time ST_BA_Date Time Start time. st Stop Time ST_BA_Date Time Stopping time. b Stop On Full BOOL A TRUE stops the recording when the buffer is full. n Log Interval UDINT Interval for saving the parameters. n Notification Thresho UDINT Limit value at which notifications are triggered. ld e Logging Type E_BA_Logging Type Setting the type of saving. st Referenced Param ST_BA_Object Parameter Parameter object. [} 120] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.3.8 FB_BA_Project The function block provides the ability to describe the project in more detail using optional information. The information provided can be accessed by clients (e.g. HMI or Site Explorer) and processed accordingly (e.g. as a project-related information overview of contact persons, etc.). The general diagnostic functions (see XBA_Globals. Diag [} 124]) are also referenced. TF8040 Version: 1.14.0 227
## Page 228

Programming This function block may only be instantiated once in the project. The instance ID always corresponds to that of the BACnet device, even if a different ID has been pre-initialized. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] Syntax FUNCTION_BLOCK FB_BA_Project EXTENDS FB_BA_Object VAR_INPUT CONSTANT {region 'Project'} st Project : ST_BA_Project Info; {endregion} {region 'Contact'} st Operator : ST_BA_Contact Info; st Technical Staff : ST_BA_Contact Info; st Engineer : ST_BA_Contact Info; {endregion} END_VAR Inputs Name Type Description st Project ST_BA_Project Info [} 117] Further information on the project (name, description, location). st Operator ST_BA_Contact Info [} 116] Contact information of the operator (name, telephone number, e-mail address, web pages). st Technical Staff ST_BA_Contact Info [} 116] Contact information of the technical staff (name, telephone number, e-mail address, web pages). st Engineer ST_BA_Contact Info [} 116] Contact information of the integrator (name, telephone number, e-mail address, web pages). Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.2.1.3.3.1.4 Multistate Reporting, switching and processing of multi-state values. 228 Version: 1.14.0 TF8040
## Page 229

Programming 6.1.2.1.3.3.1.4.1 FB_BA_MI The function block FB_BA_MI represents the Multi-State_Input object. The Multi-State_Input object specifies an object type whose object properties represent externally visible characteristics of a data point for multiple binary inputs. The object is derived from physical or virtual data points, e.g. the limit messages of several analog inputs or analog values or from a mathematical calculation. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base MI [} 253] Illustration FUNCTION_BLOCK FB_BA_MI EXTENDS FB_BA_Base MI VAR_INPUT n Val : UDINT := 1; e Rlbt : E_BA_Reliability; END_VAR Inputs Name Type Description n Val UDINT Scaled, analog input value. e Rlbty E_BA_Reliability Availability or reliability of a value. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 TF8040 Version: 1.14.0 229
## Page 230

Programming 6.1.2.1.3.3.1.4.2 FB_BA_MI_IO The function block FB_BA_MI_IO represents the Multi-State_Input object. The Multi-State_Input object specifies an object type whose object properties represent externally visible characteristics of a data point for multiple binary inputs. The object is derived from physical or virtual data points, e.g. the limit messages of several analog inputs or analog values or from a mathematical calculation. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base MI [} 253] Illustration FUNCTION_BLOCK FB_BA_MI_IO EXTENDS FB_BA_Base MI IMPLEMENTS I_BA_Raw MI VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} n Default Value : UDINT := 1; {endregion} END_VAR VAR {region 'Raw I/O'} st Raw Val AT %I* : ST_BA_Byte; {endregion} END_VAR Inputs CONSTANT PERSISTENT Name Type Description n Default Value UDINT Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. 230 Version: 1.14.0 TF8040
## Page 231

Programming VAR Name Type Description st Raw Val ST_BA_Byte Structure variable for linking to the process image. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.4.3 FB_BA_MI_Raw The function block FB_BA_MI_Raw represents the Multi-State_Input object. The Multi-State_Input object specifies an object type whose object properties represent externally visible characteristics of a data point for multiple binary inputs. The object is derived from physical or virtual data points, e.g. the limit messages of several analog inputs or analog values or from a mathematical calculation. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base MI [} 253] Illustration FUNCTION_BLOCK FB_BA_MI_Raw EXTENDS FB_BA_Base MI VAR_INPUT n Raw Val : UDINT; END_VAR TF8040 Version: 1.14.0 231
## Page 232

Programming Inputs Name Type Description n Raw Val UDINT Raw value Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.4.4 FB_BA_MO The function block FB_BA_MO represents the Multi-State_Output object. It has a priority array and can therefore be commanded (see Commanding objects). The Multi-State_Output object specifies an object type whose object properties represent externally visible characteristics of a data point for multiple binary outputs, connected by arbitrary binary logic. The object is derived from physical or virtual data points, e.g. for "active/inactive" states of several binary outputs or the value of an analog output. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] 232 Version: 1.14.0 TF8040
## Page 233

Programming FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base MO [} 254] Illustration FUNCTION_BLOCK FB_BA_MO EXTENDS FB_BA_Base MO VAR_INPUT e Rlbty : E_BA_Reliability; b Raw Ovrrd : BOOL; b En Fdbck : BOOL; n Raw Val Fdbck : UDINT; END_VAR Inputs Name Type Description e Rlbty E_BA_Reliability Availability or reliability of a value. b Raw Ovrrd BOOL The feedback of a switch contained in a terminal can be connected to this variable for mechanical override of an output. b En Fdbck BOOL Variable for starting the monitoring of the feedback at the binary output. n Raw Val Fdbck UDINT Raw value feedback. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 TF8040 Version: 1.14.0 233
## Page 234

Programming 6.1.2.1.3.3.1.4.5 FB_BA_MO_IO The function block FB_BA_MO_IO represents the Multi-State_Output object. It has a priority array and can therefore be commanded (see Commanding objects). The Multi-State_Output object specifies an object type whose object properties represent externally visible characteristics of a data point for multiple binary outputs, connected by arbitrary binary logic. The object is derived from physical or virtual data points, e.g. for "active/inactive" states of several binary outputs or the value of an analog output. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base MO [} 254] Illustration FUNCTION_BLOCK FB_BA_MO_IO EXTENDS FB_BA_Base MO IMPLEMENTS I_BA_Raw MO VAR {region 'Raw I/O'} st Raw Val AT %Q* : ST_BA_Byte; st Raw Val Feedback AT %I* : ST_BA_Byte; {endregion} END_VAR 234 Version: 1.14.0 TF8040
## Page 235

Programming VAR Name Type Description st Raw Val ST_BA_Byte Raw value for output to a bus terminal. st Raw Val Feedback ST_BA_Byte Feedback input of the raw value (optional). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.4.6 FB_BA_MO_Raw The function block FB_BA_MO_Raw represents the Multi-State_Output object. It has a priority array and can therefore be commanded (see Commanding objects). The Multi-State_Output object specifies an object type whose object properties represent externally visible characteristics of a data point for multiple binary outputs, connected by arbitrary binary logic. The object is derived from physical or virtual data points, e.g. for "active/inactive" states of several binary outputs or the value of an analog output. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] TF8040 Version: 1.14.0 235
## Page 236

Programming FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] FB_BA_Base MO [} 254] Illustration FUNCTION_BLOCK FB_BA_MO_Raw EXTENDS FB_BA_Base MO VAR_INPUT b En Feedback : BOOL; n Raw Val Feedback : UDINT; END_VAR VAR_OUTPUT n Raw Val : UDINT; END_VAR Inputs Name Type Description b En Fdbck BOOL Variable for starting the monitoring of the feedback at the binary output. n Raw Val Fdbck UDINT Raw value feedback. Outputs Name Type Description n Raw Val UDINT The variable is used to link the raw value of an object with the process image of the input or output terminal. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 236 Version: 1.14.0 TF8040
## Page 237

Programming 6.1.2.1.3.3.1.4.7 FB_BA_MV The function block FB_BA_MV represents the Multi-State_Value object. It has a priority array and can therefore be commanded (see Commanding objects). The Multi-State_Value object specifies an object type whose properties represent externally visible characteristics of a virtual data point for a "Multi-State Value". The Multi-State_Value has no I/O hardware in the associated Device object, it is stored in memory. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] Illustration FUNCTION_BLOCK FB_BA_MV EXTENDS FB_BA_Event Object Ex IMPLEMENTS I_BA_Multistate Prio Object, I_BA_Any Va lue VAR_INPUT b En Sfty : BOOL; n Val Sfty : UDINT := 1; b En Crit : BOOL; n Val Crit : UDINT := 1; b En Man Loc : BOOL; n Val Man Loc : UDINT := 1; b En Pgm : BOOL; n Val Pgm : UDINT := 1; END_VAR VAR_OUTPUT n Present Value : UDINT := 1; e Active Prio : E_BA_Priority; END_VAR TF8040 Version: 1.14.0 237
## Page 238

Programming VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} n Default Value : UDINT:= 1; b En Out Of Service : BOOL; {endregion} {region 'Fixed Parameters'} a State Text : T_BA_State Text Array; a Alarm Values : ARRAY[1 .. BA_Param.n Multistate_State Count] OF UDINT; a Fault Values : ARRAY[1 .. BA_Param.n Multistate_State Count] OF UDINT; {endregion} {region 'Operational Parameters'} b En Manual Rm : BOOL; n Val Manual Rm : UDINT:= 1; {endregion} END_VAR VAR {region 'Output-Properties'} n State Count : UDINT; {endregion} END_VAR Inputs Name Type Description b En Sfty BOOL Enabling the "Safety" priority. n Val Sfty UDINT Analog value for the "Safety" priority. b En Crit BOOL Enabling the "Critical" priority. n Val Crit UDINT Analog value for the "Critical" priority. b En Man Loc BOOL Enabling the "Manual Local" priority. n Val Man Loc UDINT Analog value for the "Manual Local" priority. b En Pgm BOOL Enabling the "Program" priority. n Val Pgm UDINT Analog value for the "Program" priority. Outputs Name Type Description n Present Value UDINT Current value for multi-stage outputs. e Active Prio E_BA_Priority [} 110] Active priority Inputs CONSTANT PERSISTENT Name Type Description n Default Value UDINT Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. b En Out Of Service BOOL This variable sets an object out of service. It is thus Out Of Service. a State Text T_BA_State Text Array The array is used to declare the state texts of a multi-state object. [} 121] a Alarm Values ARRAY Within the array the states of the multi-state object are [1.. BA_Param.n Multistate described for which an alarm is present. _State Count] OF UDINT a Fault Values ARRAY Within the array the states of the multi-state object are [1.. BA_Param.n Multistate described where an error is present. _State Count] OF UDINT b En Manual Rm BOOL Enabling the "Manual Remote" priority. n Val Manual Rm UDINT Variable for writing a value to the "Manual Remote" priority. 238 Version: 1.14.0 TF8040
## Page 239

Programming VAR Name Type Description n State Count UDINT Number of states of a multi-state object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.4.8 FB_BA_MV_Op The function block FB_BA_MV_Op represents a multi-state value object. It is used to display or input a multi-state value. If something is connected to the input variable n Value Pgm, then the object automatically recognizes that it is used to display a value. Otherwise it is used to enter a multi-state value. The Multi-State_Value object specifies an object type whose properties represent externally visible characteristics of a virtual data point for a "Multi-State Value". The Multi-State_Value has no I/O hardware in the associated Device object, it is stored in memory. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] Illustration FUNCTION_BLOCK FB_BA_MV_Op EXTENDS FB_BA_Object IMPLEMENTS I_BA_Multistate Op Object, I_BA_Any Value VAR_INPUT n Value Pgm : UDINT; END_VAR VAR_OUTPUT n Present Value : UDINT := 1; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} n Default Value : UDINT := 1; e Toggle Mode : E_BA_Toggle Mode := E_BA_Toggle Mode.e Switch; {endregion} {region 'Fixed Parameters'} a State Text : T_BA_State Text Array; {endregion} {region 'Operational Parameters'} n Value Rm : UDINT := 1; {endregion} END_VAR VAR {region 'Output-Properties'} n State Count : UDINT; {endregion} TF8040 Version: 1.14.0 239
## Page 240

Programming END_VAR VAR {region 'Interface'} e Value Source : E_BA_Process Signal Source; {endregion} END_VAR Inputs Name Type Description n Value Pgm UDINT Value of a multi-state object for the "Program" priority. Outputs Name Type Description n Present Value UDINT Current value for multi-stage outputs. Inputs CONSTANT PERSISTENT Name Type Description n Default Value UDINT Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. e Toggle Mode E_BA_Toggle Mode Enumeration for defining how the output value b Present Value of an object is generated depending on the input b Value Pgm. a State Text T_BA_State Text Array The array is used to declare the state texts of a multi-state object. [} 121] n Value Rm UDINT Variable for writing an object from the HMI. VAR Name Type Description n State Count UDINT Number of states of a multi-state object. e Value Source E_BA_Process Signal Source The variable indicates whether an object of the type FB_BA_..._OP serves as a display or input object. [} 113] e Var Input = 1 The object is used to display a value. The value is passed to the object at an input within the PLC. e Parameter = 2 The object is used to enter a parameter that can be changed by a BACnet client or the Twin CAT HMI. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 240 Version: 1.14.0 TF8040
## Page 241

Programming 6.1.2.1.3.3.1.5 Structurize 6.1.2.1.3.3.1.5.1 FB_BA_View The function block FB_BA_View is used to create a folder within the project structure. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] Illustration FUNCTION_BLOCK FB_BA_View EXTENDS FB_BA_Object IMPLEMENTS I_BA_View VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Node Type : E_BA_Node Type := E_BA_Node Type. Automatic; {endregion} END_VAR VAR_INPUT CONSTANT {region 'Operational Parameters'} b Acknowledge Rm : BOOL; {endregion} END_VAR VAR {region 'Sub Init'} e DPADMode : E_BA_DPADMode := E_BA_DPADMode. Undefined; {endregion} {region 'Events'} fb Active Events : FB_BA_Event Indicator; {endregion} END_VAR Inputs CONSTANT PERSISTENT Name Type Description e Node Type E_BA_Node Type [} 111] The variable Node Type describes the folder level within the project structure. Inputs CONSTANT Name Type Description b Acknowledge Rm BOOL Input for local acknowledgement of the events of an object. TF8040 Version: 1.14.0 241
## Page 242

Programming VAR Name Type Description e DPADMode E_BA_DPADMode [} 101] The variable influences the project structure integrated generation of the user address key. To create the project structure it is mandatory to establish an integrated parent / child relationship within the Twin CAT project. This means that all instances of the function block FB_BA_View must be told from whom they originate. However, the number of levels within the Twin CAT program or symbol path often differs from the number of levels in the user address key. Often there are more levels in the symbol path of the Twin CAT project than in the user address key. It may therefore be necessary to exclude some levels from the concatenation of texts for the generic generation of object names and description texts. This is possible with the enumeration e DPADMode. fb Active Events FB_BA_Event Indicator Gives information about events of all objects of a View object. Methods Name Description On Object Event Change Change of an event in a sub-object. [} 242] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.5.1.1 On Object Event Change The method is called when the event of a subordinate object changes. The user can respond to the changes in this method. Syntax METHOD PROTECTED On Object Event Change VAR_INPUT i Object : I_BA_Event Object; b Notify Parents : BOOL := TRUE; END_VAR 242 Version: 1.14.0 TF8040
## Page 243

Programming Inputs Name Type Description i Object I_BA_Event Object Interface to the context object. [} 264] b Notify Parents BOOL Enable for forwarding the event to the next higher-level object. This enable must be transferred to the basic function block. Sample: SUPER^. On Object Event Change(i Object, TRUE); Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.6 Base These objects form the basis of the previously described function blocks. They inherit the local function blocks. 6.1.2.1.3.3.1.6.1 FB_BA_Base AI The function block FB_BA_Base AI is the base of all analog input objects. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] TF8040 Version: 1.14.0 243
## Page 244

Programming Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Base AI EXTENDS FB_BA_Com Event Object IMPLEMENTS I_BA_Analog In Object, I_ BA_Any Value VAR_OUTPUT f Present Value : REAL; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} f Resolution : REAL := BA_Param.f Input_Def Resolution; f Scale Offset : REAL := BA_Param.f Input_Def Scale Offset; b En Out Of Service : BOOL; e Unit : E_BA_Unit := E_BA_Unit. Invalid; f COVIncrement : REAL := BA_Param.f Def COVIncrement; st Low Limit : ST_BA_Limit Param; st High Limit : ST_BA_Limit Param; f Limit Deadband : REAL := BA_Param.f Def Limit Deadband; {endregion} END_VAR Outputs Name Type Description f Present Value REAL Current analog output value of the object. Inputs CONSTANT PERSISTENT Name Type Description f Resolution [} 126] REAL Resolution of an analog signal for scaling a measured value. f Scale Offset [} 126] REAL Scaling offset b En Out Of Service BOOL This variable sets an object out of service. It is thus Out Of Service. e Unit E_BA_Unit Unit of the input or output value of an analog object. f COVIncrement REAL The variable specifies the minimum change in present value that will cause a COV notification to be issued to subscribed COV clients. This property is required if COV reporting is supported by this object. st Low Limit ST_BA_Limit Param [} 120] Parameterization of the lower limit value monitoring of an analog object. The variable b Enable must be TRUE to enable limit value monitoring. The variable f Value is used to parameterize the lower limit value. st High Limit ST_BA_Limit Param [} 120] Parameterization of the upper limit value monitoring of an analog object. The variable b Enable must be TRUE to enable limit value monitoring. The variable f Value is used to parameterize the upper limit value. f Limit Deadband REAL Dead band or hysteresis for the values High Limit and Low Limit of the limit value monitoring of an analog object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 244 Version: 1.14.0 TF8040
## Page 245

Programming 6.1.2.1.3.3.1.6.2 FB_BA_Base AO The function block FB_BA_Base AO represents the object of an analog output. It is the base of all analog outputs. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Base AO EXTENDS FB_BA_Com Event Object IMPLEMENTS I_BA_Analog Out Object, I _BA_Any Value VAR_INPUT b En Sfty : BOOL; f Val Sfty : REAL; b En Crit : BOOL; f Val Crit : REAL; b En Man Loc : BOOL; f Val Man Loc : REAL; b En Pgm : BOOL; f Val Pgm : REAL; END_VAR VAR_OUTPUT f Present Value : REAL; TF8040 Version: 1.14.0 245
## Page 246

Programming e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} f Resolution : REAL := BA_Param.f Output_Def Resolution; f Scale Offset : REAL := BA_Param.f Output_Def Scale Offset; f Default Value : REAL; b En Out Of Service : BOOL; e Unit : E_BA_Unit := E_BA_Unit. Invalid; f COVIncrement : REAL := BA_Param.f Def COVIncrement; st Low Limit : ST_BA_Limit Param; st High Limit : ST_BA_Limit Param; f Limit Deadband : REAL := BA_Param.f Def Limit Deadband; {endregion} {region 'Operational Parameters'} b En Manual Rm : BOOL; f Val Manual Rm : REAL; {endregion} END_VAR Inputs Name Type Description b En Sfty BOOL Enabling the "Safety" priority. f Val Sfty REAL Analog value for the "Safety" priority. b En Crit BOOL Enabling the "Critical" priority. f Val Crit REAL Analog value for the "Critical" priority. b En Man Loc BOOL Enabling the "Manual Local" priority. f Val Man Loc REAL Analog value for the "Manual Local" priority. b En Pgm BOOL Enabling the "Program" priority. f Val Pgm REAL Analog value for the "Program" priority. Outputs Name Type Description f Present Value REAL Current analog output value of the object. e Active Prio E_BA_Priority [} 110] Active priority 246 Version: 1.14.0 TF8040
## Page 247

Programming Inputs CONSTANT PERSISTENT Name Type Description f Resolution [} 126] REAL Resolution of an analog signal for scaling a measured value. f Scale Offset [} 126] REAL Scaling offset f Default Value REAL Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. b En Out Of Service BOOL This variable sets an object out of service. It is thus Out Of Service. e Unit E_BA_Unit Unit of the input or output value of an analog object. f COVIncrement REAL The variable specifies the minimum change in present value that will cause a COV notification to be issued to subscribed COV clients. This property is required if COV reporting is supported by this object. st Low Limit ST_BA_Limit Param [} 120] Parameterization of the lower limit value monitoring of an analog object. The variable b Enable must be TRUE to enable limit value monitoring. The variable f Value is used to parameterize the lower limit value. st High Limit ST_BA_Limit Param [} 120] Parameterization of the upper limit value monitoring of an analog object. The variable b Enable must be TRUE to enable limit value monitoring. The variable f Value is used to parameterize the upper limit value. f Limit Deadband REAL Dead band or hysteresis for the values High Limit and Low Limit of the limit value monitoring of an analog object. b En Manual Rm BOOL Enabling the "Manual Remote" priority. f Val Manual Rm REAL Analog value for the "Manual Remote" priority. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 TF8040 Version: 1.14.0 247
## Page 248

Programming 6.1.2.1.3.3.1.6.3 FB_BA_Base BI The function block FB_BA_Base BI generates a binary input object. It is the base of all binary input objects. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Base BI EXTENDS FB_BA_Com Event Object IMPLEMENTS I_BA_Binary In Object, I_ BA_Any Value VAR_OUTPUT b Present Value : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} b En Out Of Service : BOOL; s Inactive Text : T_BA_State Text; s Active Text : T_BA_State Text; b Alarm Value : BOOL := TRUE; e Polarity : E_BA_Polarity := E_BA_Polarity.e Normal; n State Change Count : UDINT; n Active Time Elapsed : UDINT; {endregion} END_VAR VAR {region 'Output-Properties'} st State Change Time : ST_BA_Date Time; st State Change Reset Point : ST_BA_Date Time; st Active Time Reset Point : ST_BA_Date Time; {endregion} END_VAR 248 Version: 1.14.0 TF8040
## Page 249

Programming Outputs Name Type Description b Present Value BOOL Current binary output value of the object. Inputs CONSTANT PERSISTENT Name Type Description b En Out Of Service BOOL This variable sets an object out of service. It is thus Out Of Service. s Inactive Text T_BA_State Text [} 121] Text output when the object is inactive. s Active Text T_BA_State Text [} 121] Text output when the object is active. b Alarm Value BOOL Value in the event of an alarm. e Polarity E_BA_Polarity The polarity describes the dependency between the value resulting from the evaluation of the Priority_Array and the value that is output at the output of the controller. If the polarity is normal then the result of the Priority_Array is directly forwarded to the output of the controller. With reverse polarity the output is negated. n State Change Count UDINT The variable indicates how often the state of the Present_Value has changed since the date and the last reset. n Active Time Elapsed UDINT Time [s] in which the Present_Value of the object had the value ACTIVE. The time is valid from the last reset by the property Time_Of_Active_Time_Reset. VAR Name Type Description st State Change Time ST_BA_Date Time This property shows the time of the last state change. The state change refers to the Present_Value of the object. st State Change Reset ST_BA_Date Time Shows the date and time from which the counting of state Point changes started. st Active Time Reset P ST_BA_Date Time Indicates the time when the recording of the object's oint switch-on times started. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 TF8040 Version: 1.14.0 249
## Page 250

Programming 6.1.2.1.3.3.1.6.4 FB_BA_Base BO The function block FB_BA_Base BO represents a binary output object. It is the base for all other binary outputs. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Base BO EXTENDS FB_BA_Com Event Object IMPLEMENTS I_BA_Binary Out Object, I _BA_Any Value VAR_INPUT b En Sfty : BOOL; b Val Sfty : BOOL; b En Crit : BOOL; b Val Crit : BOOL; b En Man Loc : BOOL; b Val Man Loc : BOOL; b En Pgm : BOOL; b Val Pgm : BOOL; END_VAR 250 Version: 1.14.0 TF8040
## Page 251

Programming VAR_OUTPUT b Present Value : BOOL; e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} n Minimum Off Time : UDINT; n Minimum On Time : UDINT; b Default Value : BOOL; b En Out Of Service : BOOL; s Inactive Text : T_BA_State Text; s Active Text : T_BA_State Text; e Polarity : E_BA_Polarity := E_BA_Polarity.e Normal; n State Change Count : UDINT; n Active Time Elapsed : UDINT; {endregion} {region 'Operational Parameters'} b En Manual Rm : BOOL; b Val Manual Rm : BOOL; {endregion} END_VAR VAR {region 'Output-Properties'} st State Change Time : ST_BA_Date Time; st State Change Reset Point : ST_BA_Date Time; st Active Time Reset Point : ST_BA_Date Time; {endregion} END_VAR Inputs Name Type Description b En Sfty BOOL Enabling the "Safety" priority. b Val Sfty BOOL Binary value for the "Safety" priority. b En Crit BOOL Enabling the "Critical" priority. b Val Crit BOOL Binary value for the "Critical" priority. b En Man Loc BOOL Enabling the "Manual Local" priority. b Val Man Loc BOOL Binary value for the "Manual Local" priority. b En Pgm BOOL Enabling the "Program" priority. b Val Pgm BOOL Binary value for the "Program" priority. Outputs Name Type Description b Present Value BOOL Current binary output value of the object. e Active Prio E_BA_Priority [} 110] Active priority TF8040 Version: 1.14.0 251
## Page 252

Programming Inputs CONSTANT PERSISTENT Name Type Description n Minimum Off Time UDINT Minimum time [s] in which the Present_Value should remain in the INACTIVE state after a write operation to Present_Value has assumed the INACTIVE state. This can be used to implement protection against too fast restarting. n Minimum On Time UDINT Minimum time [s] in which the Present_Value is to remain in the ACTIVE state after a write operation to Present_Value has assumed the ACTIVE state. This can be used to implement protection against premature, renewed switch-off b Default Value BOOL Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. b En Out Of Service BOOL This variable sets an object out of service. It is thus Out Of Service. s Inactive Text T_BA_State Text [} 121] Text output when the object is inactive. s Active Text T_BA_State Text [} 121] Text output when the object is active. e Polarity E_BA_Polarity The polarity describes the dependency between the value resulting from the evaluation of the Priority_Array and the value that is output at the output of the controller. If the polarity is normal then the result of the Priority_Array is directly forwarded to the output of the controller. With reverse polarity the output is negated. n State Change Count UDINT The variable indicates how often the state of the Present_Value has changed since the date and the last reset. n Active Time Elapsed UDINT Time [s] in which the Present_Value of the object had the value ACTIVE. The time is valid from the last reset by the property Time_Of_Active_Time_Reset. b Val Manual Rm BOOL Binary value for the "Manual Remote" priority. b En Manual Rm BOOL Enabling the "Manual Remote" priority. VAR Name Type Description st State Change Time ST_BA_Date Time This property shows the time of the last state change. The state change refers to the Present_Value of the object. st State Change Reset ST_BA_Date Time Shows the date and time from which the counting of state Point changes started. st Active Time Reset P ST_BA_Date Time Indicates the time when the recording of the object's oint switch-on times started. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 252 Version: 1.14.0 TF8040
## Page 253

Programming 6.1.2.1.3.3.1.6.5 FB_BA_Base MI The FB_BA_Base MI function block generates a multi-state input object. It is the base of all multi-state input objects. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Base MI EXTENDS FB_BA_Com Event Object IMPLEMENTS I_BA_Multistate In Object , I_BA_Any Value VAR_OUTPUT n Present Value : UDINT := 1; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Mapping Mode : E_BA_Byte Mapping Mode := E_BA_Byte Mapping Mode.e Index1N; b En Out Of Service : BOOL; {endregion} {region 'Fixed Parameters'} a State Text : T_BA_State Text Array; a Alarm Values : ARRAY[1 .. BA_Param.n Multistate_State Count] OF UDINT; a Fault Values : ARRAY[1 .. BA_Param.n Multistate_State Count] OF UDINT; {endregion} END_VAR VAR {region 'Output-Properties'} n State Count : UDINT; {endregion} END_VAR Outputs Name Type Description n Present Value UDINT Analog output value. TF8040 Version: 1.14.0 253
## Page 254

Programming Inputs CONSTANT PERSISTENT Name Type Description e Mapping Mode E_BA_Byte Mapping Mode Mode for configuring the terminal link. b En Out Of Service BOOL This variable sets an object out of service. It is thus Out Of Service. a State Text T_BA_State Text Array The array is used to declare the state texts of a multi-state object. [} 121] a Alarm Values ARRAY Within the array the states of the multi-state object are [1.. BA_Param.n Multistate described for which an alarm is present. _State Count] OF UDINT a Fault Values ARRAY Within the array the states of the multi-state object are [1.. BA_Param.n Multistate described where an error is present. _State Count] OF UDINT VAR Name Type Description n State Count UDINT Number of states of a multi-state object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.6.6 FB_BA_Base MO The function block FB_BA_Base MO represents a multi-level output. 254 Version: 1.14.0 TF8040
## Page 255

Programming Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] FB_BA_Com Event Object [} 260] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Base MO EXTENDS FB_BA_Com Event Object IMPLEMENTS I_BA_Multistate Out Objec t, I_BA_Any Value VAR_INPUT b En Sfty : BOOL; n Val Sfty : UDINT := 1; b En Crit : BOOL; n Val Crit : UDINT := 1; b En Man Loc : BOOL; n Val Man Loc : UDINT := 1; b En Pgm : BOOL; n Val Pgm : UDINT := 1; END_VAR VAR_OUTPUT n Present Value : UDINT := 1; e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Mapping Mode : E_BA_Byte Mapping Mode := E_BA_Byte Mapping Mode.e Index1N; e Feedback Mapping Mode : E_BA_Byte Mapping Mode := E_BA_Byte Mapping Mode.e Index1N; n Default Value : UDINT := 1; b En Out Of Service : BOOL; {endregion} {region 'Fixed Parameters'} a State Text : T_BA_State Text Array; {endregion} {region 'Operational Parameters'} b En Manual Rm : BOOL; n Val Manual Rm : UDINT := 1; {endregion} END_VAR VAR {region 'Output-Properties'} n State Count : UDINT; {endregion} END_VAR Inputs Name Type Description b En Sfty BOOL Enabling the "Safety" priority. n Val Sfty UDINT Analog value for the "Safety" priority. n Val Crit UDINT Analog value for the "Critical" priority. b En Crit BOOL Enabling the "Critical" priority. b En Man Loc BOOL Enabling the "Manual Local" priority. n Val Man Loc UDINT Analog value for the "Manual Local" priority. b En Pgm BOOL Enabling the "Program" priority. n Val Pgm UDINT Analog value for the "Program" priority. TF8040 Version: 1.14.0 255
## Page 256

Programming Outputs Name Type Description n Present Value UDINT Analog output value. e Active Prio E_BA_Priority [} 110] Active priority Inputs CONSTANT PERSISTENT Name Type Description e Mapping Mode E_BA_Byte Mapping Mode Mode for configuring the terminal link. e Feedback Mapping E_BA_Byte Mapping Mode Structure for mapping the feedback inputs. Mode n Default Value UDINT Value that is assumed if all 16 priorities of the Priority_Array of a commandable object have no entry or are NULL. b En Out Of Service BOOL This variable sets an object out of service. It is thus Out Of Service. a State Text T_BA_State Text Array The array is used to declare the state texts of a multi-state object. [} 121] b En Manual Rm BOOL Enabling the "Manual Remote" priority. n Val Manual Rm UDINT Variable for writing a value to the "Manual Remote" priority. VAR Name Type Description n State Count UDINT Number of states of a multi-state object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.6.7 FB_BA_Base Sched The function block FB_BA_Base Sched forms the base for scheduler function blocks. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher 256 Version: 1.14.0 TF8040
## Page 257

Programming FB_BA_Object [} 264] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Base Sched EXTENDS FB_BA_Object IMPLEMENTS I_BA_Base Sched VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} n Predict Time : UDINT; a Week : T_BA_Sched Week; a Calendar : T_BA_Sched Calendar; a Exception : T_BA_Sched Exception List; {endregion} END_VAR VAR_INPUT CONSTANT {region 'Variable Parameters'} b Write Weekly : BOOL; b Write Exception : BOOL; {endregion} END_VAR Inputs CONSTANT PERSISTENT Name Type Description n Predict Time UDINT Calculated time value. a Week T_BA_Sched Week [} 122] Weekly scheduler. a Calendar T_BA_Sched Calendar Calendar. [} 122] a Exception T_BA_Sched Exception List List of exception conditions. [} 122] Inputs CONSTANT Name Type Description b Write Weekly BOOL Writes weekly. b Write Exception BOOL Writes time exceptions. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.6.8 FB_BA_Base State MV The function block FB_BAState MV enables the display of states. Each referenced object is seen as state. It is represented as multi-state object. The state texts of this multi-state object are automatically the names of all commanded references. The Present Value is automatically the highest active state, or reference. TF8040 Version: 1.14.0 257
## Page 258

Programming Abstract The FB serves as a base (ABSTRACT) for providing described functionalities for inheriting FBs. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Base State MV EXTENDS FB_BA_Object IMPLEMENTS I_BA_Multistate Object VAR_INPUT CONSTANT PERSISTENT {region 'Fixed Parameters'} e State Text Determination Mode : E_BA_Node Type Target := E_BA_Node Type Target.e Function; a State Text : T_BA_State Text Array; {endregion} END_VAR VAR {region 'Informational'} st Active Info : ST_BA_Active Info; {endregion} {region 'Output-Properties'} n Present Value : UDINT := 1; n State Count : UDINT; {endregion} END_VAR Inputs CONSTANT PERSISTENT Name Type Description e State Text Determin E_BA_Node Type Target Defines the reference to the object whose description is ation Mode displayed to represent the state. [} 112] a State Text T_BA_State Text Array The array is used to declare the state texts of a multi-state object. [} 121] VAR Name Type Description st Active Info ST_BA_Active Info [} 122] Description of the object. n Present Value UDINT Current value for multi-stage outputs. n State Count UDINT Number of states of a multi-state object. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 258 Version: 1.14.0 TF8040
## Page 259

Programming 6.1.2.1.3.3.1.6.9 FB_BA_Base Step MV The function block FB_BA_Base Step MV enables the processing of steps. Each referenced object is seen as a step and can be commanded accordingly. The Present Value is automatically the current step, or the current reference, commanded by this object. Abstract The FB serves as a base (ABSTRACT) for providing described functionalities for inheriting FBs. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Base State MV [} 257] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Base Step MV EXTENDS FB_BA_Base State MV VAR_OUTPUT s Step : STRING; b On : BOOL; END_VAR Outputs Name Type Description s Step STRING Current commanded step. b On BOOL Indicates operation. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 TF8040 Version: 1.14.0 259
## Page 260

Programming 6.1.2.1.3.3.1.6.10 FB_BA_Com Event Object The function block FB_BA_Com Event Object contains the basic properties or functions for recording, displaying, forwarding, acknowledging and resetting the events of an object. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] FB_BA_Event Object Ex [} 263] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Com Event Object EXTENDS FB_BA_Event Object Ex IMPLEMENTS I_BA_Com Object VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e Commissioning State : E_BA_Commissioning State := E_BA_Commissioning State.e Unknown; {endregion} END_VAR Inputs CONSTANT PERSISTENT Name Type Description e Commissioning Stat E_BA_Commissioning State Parameterization of the commissioning state of an object. e [} 107] The settings of the commissioning state for the objects are made with the Site Explorer tool. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 260 Version: 1.14.0 TF8040
## Page 261

Programming 6.1.2.1.3.3.1.6.11 FB_BA_Event Object The function block FB_BA_Event Object extends the basic functionalities of a BACnet object by the properties of the object-internal notification (Intrinsic Reporting). Here, notifications and alarm messages are generated by the BACnet object itself and forwarded to a notification class. In this object the corresponding events must be enabled. This is done via the property Event_Enable. Each event (TO_OFFNORMAL, TO_FAULT and TO_NORMAL) can be enabled individually. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Event Object EXTENDS FB_BA_Object IMPLEMENTS I_BA_Event Object, I_BA_Eve nt Value VAR_OUTPUT b Event : BOOL; e Event State : E_BA_Event State; END_VAR VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} b Event Detection Enable : BOOL := TRUE; n Event Class ID : UDINT; a Event Transition Text : T_BA_Event Transition Text := BA_Param.a Event Transition Text; {endregion} END_VAR VAR_INPUT CONSTANT {region 'Operational Parameters'} b Acknowledge Rm : BOOL; {endregion} END_VAR VAR {region 'Output-Properties'} e Event Type : E_BA_Event Type := E_BA_Event Type. Invalid; e Alarm Mode : E_BA_Alarm Mode := E_BA_Alarm Mode. Invalid; e Reliability : E_BA_Reliability; e Event Transition : E_BA_Event Transition := E_BA_Event Transition. Invalid; {endregion} END_VAR VAR {region 'Event'} st State Flags : ST_BA_Status Flags; st Acked Transitions : ST_BA_Event Transitions; a Event Enable : T_BA_Event Transitions; {endregion} END_VAR TF8040 Version: 1.14.0 261
## Page 262

Programming Outputs Name Type Description b Event BOOL The variable signals an abnormal event of an object. The type of event, e.g. an alarm, a maintenance message, etc., is described within the event class associated with the object. e Event State E_BA_Event State The variable describes the state of an event. Inputs CONSTANT PERSISTENT Name Type Description b Event Detection Ena BOOL The variable indicates whether intrinsic reporting is ble enabled in the object. It must be TRUE to activate. It controls whether the events are taken into account within further processing, e.g. in event lists. n Event Class ID UDINT This property specifies the instance of the event class to be used for event notification distribution (see Events [} 32]) a Event Transition Tex T_BA_Event Transition Text The array contains three strings, which are the base for the t message texts of the events [} 115] TO_OFFNORMAL, TO_FAULT and TO_NORMAL represent. The message texts are stored in the list Txt Event_EN or Txt Event_DE. Depending on the language selection, the English or German text list is installed when TF8040 is installed. The message texts are concatenated with other strings to a message in TF8040. Inputs CONSTANT Name Type Description b Acknowledge Rm BOOL Input for local acknowledgement of the events of an object. 262 Version: 1.14.0 TF8040
## Page 263

Programming VAR Name Type Description e Event Type E_BA_Event Type [} 103] Event type. e Alarm Mode E_BA_Alarm Mode [} 101] Definition of how to deal with an alarm. e Reliability E_BA_Reliability This variable indicates whether the value of the Present_Value property is reliable (NO_FAULT_DETECTED), otherwise it represents the reason (e.g. short circuit, missing sensor, etc.). e Event Transition E_BA_Event Transition Mapping of the BACnet data type BACnet Event Transition Bits. st State Flags ST_BA_Status Flags Mapping of the BACnet property Status_Flags. st Acked Transitions ST_BA_Event Transitions Mapping of the BACnet Properties Acked_Transitions. a Event Enable T_BA_Event Transitions Inside the array there are three event-enable bits. This allows the detection of the TO_OFFNORMAL, TO_FAULT [} 115] and TO_NORMAL state changes on the object to be selectively suppressed. a Event Enable[1] = TO_OFFNORMAL a Event Enable[2] = TO_FAULT a Event Enable[3] = TO_NORMAL Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.6.12 FB_BA_Event Object Ex The function block FB_BA_Event Object Ex extends the basic functionalities of a BACnet object by the property object internal notification (Intrinsic Reporting). Here, notifications and alarm messages are generated by the BACnet object itself and forwarded to a notification class. In addition, the object is extended by the property of a time delay (st Time Delay) of the event processing (e En Plant Lock). Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Event Object [} 261] TF8040 Version: 1.14.0 263
## Page 264

Programming Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Event Object Ex EXTENDS FB_BA_Event Object IMPLEMENTS I_BA_Event Object Ex VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} e En Plant Lock : E_BA_Lock Priority := E_BA_Lock Priority.e No Lock; st Time Delay : ST_BA_Time Delay Param := F_BA_Time Delay(BA_Param.n Def Time Delay_To Abnormal, 0); {endregion} END_VAR Inputs CONSTANT PERSISTENT Name Type Description e En Plant Lock E_BA_Lock Priority [} 110] The enumeration can be used to parameterize various switching actions related to the event of an object. In the event of a fire damper malfunction, for example, it may be necessary to shut down the associated ventilation system (see Plant Lock). st Time Delay ST_BA_Time Delay Param The structure can be used to delay the object's event algorithm for the TO_OFFNORMAL and TO_NORMAL [} 120] state change. In the standard PLC PLC BA-Template is the list BA2_Param. In it, the delay times for TO_OFFNORMAL and TO_NORMAL are pre-initialized with one second each by means of the two variables n Def Time Delay_To Abnormal and n Def Time Delay_To Normal. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 6.1.2.1.3.3.1.6.13 FB_BA_Object The function block FB_BA_Object represents the basis for the development of further objects. These objects must be called cyclically in the project, here the suspension of calls ( e.g. within IF conditions) prevents a correct initialization. Objects should be declared in a VAR or VAR_INPUT CONSTANT area. Persistent declaration areas must be avoided! Within inherited FBs the base FB must be called with "SUPER^()"! Initialization While an object is initialized, it passes through several states in succession: • All objects initialize until "E_BA_Object State.e Wait For Init" 264 Version: 1.14.0 TF8040
## Page 265

Programming • Then Top gives the sign to continue object initialization • All objects continue until "E_BA_Object State.e Wait For Project" • Top starts the project when all objects are set to "E_BA_Object State.e Wait For Project". • All objects now go to "E_BA_Object State.e Operation" • Top signals for one more cycle "E_BA_Project State.e First Op Cycle" • Then the project also goes into "E_BA_Project State.e Operation" Inheritance hierarchy FB_BA_Base Publisher FB_BA_Object [} 264] Illustration FUNCTION_BLOCK ABSTRACT FB_BA_Object EXTENDS FB_BA_Base Publisher IMPLEMENTS I_BA_Object, I_BACnet_Ob ject Owner VAR_INPUT CONSTANT PERSISTENT {region 'Fixed Parameters'} n Instance ID : UDINT; s Device Type : T_BA_Small String := XBA_Globals.s Placeholder_Empty; e Assign As Trend Ref : E_BA_Assign Ref Mode := E_BA_Assign Ref Mode.e Init By Profile; {endregion} {region 'Variable Parameters'} s Object Name : T_Max String := XBA_Globals.s Placeholder_Empty; s Description : T_Max String := XBA_Globals.s Placeholder_Empty; s Tag : STRING(XBA_Param.n Tag_Length); {endregion} END_VAR VAR PERSISTENT {region 'General'} s Inst Object Name : STRING; s Inst Description : STRING; {endregion} END_VAR VAR {region 'Fixed Variables'} i Parent : I_BA_View; i Label : I_BA_Label; i Profile : I_BA_Profile; {endregion} {region 'Sub Init'} e Object Type : E_BA_Object Type := E_BA_Object Type.e Object; st Attributes : ST_BA_Object Attributes; {endregion} END_VAR VAR {region 'General'} n Level : UINT := 0; // Current hierarchy level according to root object (which has t level 0) e State : E_BA_Object State := E_BA_Object State. First; s Fmt Present Value : STRING;// Present value in a formated string {endregion} END_VAR TF8040 Version: 1.14.0 265
## Page 266

Programming Inputs CONSTANT PERSISTENT Name Type Description n Instance ID UDINT This property is a numeric code, for identifying the object. It must be unambiguous inside the device. s Device Type T_BA_Small String [} 120] This property is a text description of the physical device connected to the analog output. e Assign As Trend Ref E_BA_Assign Ref Mode Reference mode. [} 111] s Description T_Max String This property represents a description text for the object. In the base framework of TF8040, each level can receive a substring. The substrings of the levels are concatenated by the DPAD mechanism so that the complete name of the object is created by means of this algorithm (see DPAD [} 42]). s Tag STRING This property represents an additional description text for the object. The string s Tag can be applied user-specific or project- specific. To enter the control cabinet device identification, for example. Inputs PERSISTENT Name Type Description s Inst Object Name STRING Object name of the instance. s Inst Description STRING Instance description. VAR Name Type Description i Parent I_BA_Parent Parent object interface. i Label I_BA_Label Interface description. i Profile I_BA_Profile Profile interface. e Object Type E_BA_Object Type [} 112] Selection of the object type. st Attributes ST_BA_Object Attributes Attribute definition. [} 114] n Level UINT Current hierarchical level according to the base object (level 0). e State E_BA_Subscriber State Evaluation of the subscriber state. [} 113] s Fmt Present Value STRING Current value in a formatted string. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.35 Tc3_XBA from v5.3.0.0 266 Version: 1.14.0 TF8040
## Page 267

Programming 6.1.2.2 Tc3_BA2 6.1.2.2.1 DUTs 6.1.2.2.1.1 Enumerations 6.1.2.2.1.1.1 Room Automation 6.1.2.2.1.1.1.1 Heating Cooling 6.1.2.2.1.1.1.1.1 E_BA_Medium TYPE E_BA_Medium : ( Invalid := 0, e No Medium := 1, e Heat Medium := 2, e Cool Medium := 3 ); END_TYPE Name Description e No Medium No medium. e Heat Medium Heating medium. e Cool Medium Cooling medium. 6.1.2.2.1.1.1.1.2 E_BA_Pipe Sys TYPE E_BA_Pipe Sys : ( Invalid := 0, e2Pipe := 1, e4Pipe := 2 ); END_TYPE Name Description e2Pipe Two-pipe system means that heating and cooling media are used alternatively in one pipe system. e4Pipe In the four-pipe system, the heating and cooling media have a separate pipe system. 6.1.2.2.1.1.1.2 Lighting 6.1.2.2.1.1.1.2.1 E_BA_Light Activation Mode The activation and deactivation of the light control functions can be done in two different ways: fully automatic or semi-automatic. TYPE E_BA_Light Activation Mode : ( e Full Automatic, e Semi Automatic ) BYTE; END_TYPE TF8040 Version: 1.14.0 267
## Page 268

Programming Name Description e Full Automatic Fully automatic: The light control function is activated by detected presence and deactivated by absence of presence. Button presses can also activate the function. e Semi Automatic Semi-automatic: Activation of the light control function only by pressing a button; it is automatically deactivated when not occupied. 6.1.2.2.1.1.1.2.2 E_BA_Lighting Prio The enumeration contains the different priorities of the light control functions. Not all priorities must necessarily be used in a project. TYPE E_BA_Lighting Prio: ( e None := 0, e Fire := 1, e Comm Error := 2, e Burglary := 3, e Maintenance := 4, e Manual Actuator := 5, e Manual Group := 6, e Cleaning := 8, e Night Watch := 9, e All Off := 10, e All On := 11, e Scene1 := 12, e Constant Light Control := 13, e Automatic Light := 14, e Scene2 := 16, e Scene3 := 17 ) BYTE; END_TYPE Name Description e None The light control does not assume any function. e Fire Fire alarm e Comm Error Behavior of the lighting in the error state, for example, communication interruption. e Burglary Burglary e Maintenance Maintenance e Manual Actuator Manual function e Manual Group Hand group function e Cleaning Building cleaning e Night Watch Night watchman tour e All Off Central off e All On Central on e Scene1 Scene 1 e Constant Light Control Constant light control e Automatic Light Automatic light e Scene2 Scene 2 e Scene3 Scene 3 6.1.2.2.1.1.1.3 Sun Protection 6.1.2.2.1.1.1.3.1 E_BA_Pos Mod Enumerator for the definition of the positioning mode. 268 Version: 1.14.0 TF8040
## Page 269

Programming TYPE E_BA_Pos Mod : ( Invalid := 0, e Fix := 1, e Tab := 2, e Max Indc := 3 ) BYTE; END_TYPE Name Description e Fix The blind height is a fixed value, which is set at function block FB_BA_Sun Prtc [} 396] via the value f Fix Pos [%]. e Tab The height positioning takes place with the help of a table of 6 interpolation points, 4 of which are parameterizable. A blind position is then calculated from these points by linear interpolation, depending on the position of the sun (see FB_BA_Bld Pos Entry [} 340]). e Max Indc The positioning takes place with specification of the maximum desired incidence of light. 6.1.2.2.1.1.1.3.2 E_BA_Shd Obj Type Enumerator for selecting the shading object type. TYPE E_BA_Shd Obj Type : ( Invalid := 0, e Tetragon := 1, e Globe := 2 ) BYTE; END_TYPE Name Description e Tetragon Object type is a rectangle. e Globe Object type is a ball. 6.1.2.2.1.1.1.3.3 E_BA_Sun Bld Prio TYPE E_BA_Sun Bld Prio : ( Invalid := 0, e Fire := 1, e Storm := 2, e Ice := 3, e Comm Error := 4, e Burglary := 5, e Maintenance := 6, e Referencing := 7, e Manual Actuator := 8, e Manual Group := 9, e All Down := 10, e All Up := 11, e Scene1 := 12, e Facade Thermo Automatic := 13, e Facade Twilight Automatic := 14, e Park Position := 15, e Scene2 := 16, e Scene3 := 17, e Sun Protection := 18, e Group Thermo Auto := 19, e Group Twi Light Auto := 20 ) BYTE; END_TYPE TF8040 Version: 1.14.0 269
## Page 270

Programming Name Description e Fire Fire alarm e Storm Storm case e Ice Icing up e Comm Error Behavior of the lighting in the error state, for example, communication interruption. e Burglary Burglary e Maintenance Maintenance e Referencing Central referencing e Manual Actuator Manual function e Manual Group Hand group function e All Down Central down e All Up Central up e Scene1 Scene 1 e Facade Thermo Automatic Facade wide thermal automatic e Facade Twilight Automatic Facade wide twilight automatic e Park Position Parking position e Scene2 Scene 2 e Scene3 Scene 3 e Sun Protection Sun protection in case of presence. e Group Thermo Auto Group or zone-wide thermal automatic. e Group Twi Light Auto Group or zone-wide twilight automatic. 6.1.2.2.1.1.2 Universal 6.1.2.2.1.1.2.1 E_BA_Ant Blkg Mode TYPE E_BA_Ant Blkg Medium : ( e Off := 1, e External Request := 2, e Off Time := 3 ) UDINT; END_TYPE Name Description e Off Deactivation of the function block e External Request External request operation mode is active. e Off Time Minimum switch-off time operation mode is active. 6.1.2.2.1.1.2.2 E_BA_Mdlt Enum for the regulation of a drive or aggregate. {attribute 'qualified_only'} TYPE E_BA_Mdlt : ( e Off := 1, e On := 2, e Min := 3, e Max := 4 ) UDINT; END_TYPE 270 Version: 1.14.0 TF8040
## Page 271

Programming Name Description e Off Switch off the drive. e On Switching on the drive. e Min Minimum power step of the drive. e Max Maximum power step of the drive. 6.1.2.2.1.1.2.3 Control 6.1.2.2.1.1.2.3.1 E_BA_State PIDControl Sync E_BA_State PIDControl Sync shows the state of the synchronization of FB_BA_PIDControl Sync [} 424]. TYPE E_BA_State PIDControl Sync : ( e Ok := 1, e Err Action := 2, e Err Damp Constant := 3, e Err Derivative Constant := 4, e Err Integral Constant := 5, e Err Max Output := 6, e Err Min Output := 7, e Err Neutral Zone := 8, e Err Op Mode := 9, e Err Proportional Constant := 10 ) UDINT; END_TYPE Name Description e OK Synchronization is error-free. e Err Action Incorrect synchronization of the VAR_INPUT CONSTANT variable e Action at FB_BA_PIDControl [} 420]. e Err Damp Constant Incorrect synchronization of the VAR_INPUT CONSTANT variable n Damp Constant at FB_BA_PIDControl [} 420]. e Err Derivative Constant Incorrect synchronization of the VAR_INPUT CONSTANT variable f Derivative Constant at FB_BA_PIDControl [} 420]. e Err Integral Constant Incorrect synchronization of the VAR_INPUT CONSTANT variable f Integral Constant on FB_BA_PIDControl [} 420]. e Err Max Output Incorrect synchronization of the VAR_INPUT CONSTANT variable f Max Output at FB_BA_PIDControl [} 420]. e Err Min Output Incorrect synchronization of the VAR_INPUT CONSTANT variable f Min Output at FB_BA_PIDControl [} 420]. e Err Neutral Zone Incorrect synchronization of the VAR_INPUT CONSTANT variable f Neutral Zone at FB_BA_PIDControl [} 420]. e Err Op Mode Incorrect synchronization of the VAR_INPUT CONSTANT variable e Op Mode at FB_BA_PIDControl [} 420]. e Err Proportional Constant Incorrect synchronization of the VAR_INPUT CONSTANT variable f Proportional Constant on FB_BA_PIDControl [} 420]. 6.1.2.2.1.1.2.4 Schedule 6.1.2.2.1.1.2.4.1 E_BA_Ctrl Fct The FB_BA_Optimized On and FB_BA_Optimized Off optimization functions perform different internal calculations depending on whether the system to be controlled is a heating or cooling system. {attribute 'qualified_only'} TYPE E_BA_Ctrl Fct : ( e Ctrl Fct_Off := 0, e Ctrl Fct_Heating := 1, TF8040 Version: 1.14.0 271
## Page 272

Programming e Ctrl Fct_Cooling := 2 ); END_TYPE Name Description e Ctrl Fct_Off No selection made. The optimization function will not start. e Ctrl Fct_Heating The optimization function considers the heating mode. e Ctrl Fct_Cooling The optimization function considers the cooling mode. 6.1.2.2.1.2 Types 6.1.2.2.1.2.1 Room Automation 6.1.2.2.1.2.1.1 Heating Cooling Functions 6.1.2.2.1.2.1.1.1 ST_BA_Sp Rm T Room temperature setpoints. TYPE ST_BA_Sp Rm T : STRUCT f Prtc Htg : REAL := 12.0; f Eco Htg : REAL := 15.0; f Pre Cmf Htg : REAL := 19.0; f Cmf Htg : REAL := 21.0; f Prtc Col : REAL := 40.0; f Eco Col : REAL := 35.0; f Pre Cmf Col : REAL := 28.0; f Cmf Col : REAL := 24.0; END_STRUCT END_TYPE The values in the structure are defined with the preset values. Name Type Description f Prtc Htg REAL Protection Heating f Eco Htg REAL Economy Heating f Pre Cmf Htg REAL Pre-Comfort Heating f Cmf Htg REAL Comfort Heating f Prtc Col REAL Protection Cooling f Eco Col REAL Economy Cooling f Pre Cmf Col REAL Pre-Comfort Cooling f Cmf Col REAL Comfort Cooling 6.1.2.2.1.2.1.2 Lighting 6.1.2.2.1.2.1.2.1 ST_BA_Lighting TYPE ST_BA_Lighting : STRUCT {attribute 'parameter Unit':= '%'} f Lgt Val : REAL {attribute 'parameter Unit':= 'K'} f Lgt T : REAL; b Actv : BOOL; e Prio : E_BA_Lighting Prio; n Evt Inc : ULINT; END_STRUCT END_TYPE 272 Version: 1.14.0 TF8040
## Page 273

Programming Name Type Description f Lgt Val REAL Transferred light value [%] in absolute value control mode. f Lgt T REAL Transferred light temperature [K]. b Actv BOOL The sender of the telegram is active. This bit is only evaluated by the priority control. e Prio E_BA_Lighting Prio [} 268] Priority of the active telegram. This enumeration is only evaluated by the priority control. n Evt Inc ULINT Telegram counter. With each new telegram, no matter which function block on the same controller triggers it, this counter is incremented by one. With telegrams of the same priority, the one with the higher counter "wins". 6.1.2.2.1.2.1.3 Sun Protection 6.1.2.2.1.2.1.3.1 ST_BA_Bld Pos Tab Structure of the interpolation point entries for the height adjustment of the blind. TYPE ST_BA_Bld Pos Tab: STRUCT a Sun Elv : ARRAY[0..5] OF REAL; a Pos : ARRAY[0..5] OF REAL; b Vld : BOOL; END_STRUCT END_TYPE Name Type Description a Sun Elv / a Pos REAL The 6 interpolation points that are transferred, wherein the array elements 0 and 5 represent the automatically generated edge elements mentioned above. b Vld BOOL Validity flag for the function block FB_BA_Sun Prtc. It is set to TRUE by the function block FB_BA_Bld Pos Entry if the data entered correspond to the validity criteria described. 6.1.2.2.1.2.1.3.2 ST_BA_Fcd Elem List entry for a facade element (window). TYPE ST_BA_Fcd Elem: STRUCT f Wdw Wdth : REAL; f Wdw Hght : REAL; a Cnr : ARRAY [1..4] OF ST_BA_Cnr; n Grp : DINT; b Vld : BOOL; END_STRUCT END_TYPE Name Type Description f Wdw Wdth REAL Width of the window [m]. f Wdw Hght REAL Height of the window [m]. a Cnr ST_BA_Cnr [} 273] Coordinates of the window corners and information as to whether this corner point is in the shade. n Grp DINT Specification of the group to which the window belongs. b Vld BOOL Plausibility of the entered data: b Vld = TRUE: data are plausible. 6.1.2.2.1.2.1.3.3 ST_BA_Cnr Information about window corners. TF8040 Version: 1.14.0 273
## Page 274

Programming TYPE ST_BA_Cnr : STRUCT f X : REAL; f Y : REAL; b Shdd : BOOL; END_STRUCT END_TYPE Name Type Description f X REAL X-coordinate of the window (on the facade). f Y REAL Y-coordinate of the window (on the facade). b Shdd BOOL Information whether this corner point is shaded: b Shdd = TRUE: corner point is shaded. 6.1.2.2.1.2.1.3.4 ST_BA_Sun Bld Structure of the blind positioning telegram. TYPE ST_BA_Sun Bld : STRUCT f Pos : REAL; f Angl : REAL; b Man Up : BOOL; b Man Dwn : BOOL; b Man Mod : BOOL; b Actv : BOOL; e Prio : E_BA_Sun Bld Prio; n Evt Inc : UDINT; END_STRUCT END_TYPE Name Type Description f Pos REAL Transferred blind height [%]. f Angl REAL Transferred slat position [°]. b Man Up BOOL Manual command: blind up. b Man Dwn BOOL Manual command: blind down. b Man Mod BOOL TRUE: Manual mode is active. FALSE: Automatic mode is active. b Actv BOOL Priority control FB_BA_Sun Bld Prio Swi4 [} 383], FB_BA_Sun Bld Prio Swi8 [} 384], FB_BA_Sun Bld Tgm Sel4 [} 390], FB_BA_Sun Bld Tgm Sel8 [} 391] evaluated. The sun protection actuators FB_BA_Sun Bld Actr [} 374] and FB_BA_Rol Bld Actr [} 365] ignore it. e Prio E_BA_Sun Bld Prio [} 269] Telegram priority. This enumeration is only evaluated by the priority control. n Evt Inc EDINT Telegram counter. With each new telegram, no matter which function block on the same controller triggers it, this counter is incremented by one. With telegrams of the same priority, the one with the higher counter "wins". 6.1.2.2.1.2.1.3.5 ST_BA_Shd Obj List entry for a shading object. TYPE ST_BA_Shd Obj : STRUCT f P1x : REAL; f P1y : REAL; f P1z : REAL; f P2x : REAL; f P2y : REAL; f P2z : REAL; f P3x : REAL; f P3y : REAL; f P3z : REAL; f P4x : REAL; 274 Version: 1.14.0 TF8040
## Page 275

Programming f P4y : REAL; f P4z : REAL; f Mx : REAL; f My : REAL; f Mz : REAL; f Rads : REAL; n Beg Mth : USINT; n End Mth : USINT; e Type : E_BA_Shd Obj Type; b Vld : BOOL; END_STRUCT END_TYPE Name Type Description f P1x…f P4z REAL Corner coordinates. Of importance only if the element is a rectangle. f Mx…f Mz REAL Center coordinates. Of importance only if the element is a sphere. f Rads REAL Radius of the ball. Of importance only if the element is a sphere. n Beg Mth USINT Beginning of the shading period (month). n End Mth USINT End of the shading period (month). e Type E_BA_Shd Obj Type [} 269] Object type b Vld BOOL Plausibility of the data: b Vld = TRUE: data are plausible. Remark about the shading period: The entries for the months may not be 0 or greater than 12, otherwise all combinations are possible. Examples: Start=1, End=1: shading in January. Start=1, End=5: shading from the beginning of January to the end of May. Start=11, End=5: shading from the beginning of November to the end of May (the following year). 6.1.2.2.1.2.1.3.6 ST_BA_Sun Bld Scn Table entry for a blind scene. TYPE ST_BA_Sun Bld Scn: STRUCT f Pos : REAL; f Angl : REAL; END_STRUCT END_TYPE Name Type Description f Pos REAL Blind height [%] f Angl REAL Slat angle [°] 6.1.2.2.1.2.2 Universal 6.1.2.2.1.2.2.1 Aggregates 6.1.2.2.1.2.2.1.1 ST_BA_Multistate The command structure is used to control multi-level aggregates and contains the priorities Safety, Critical and Program. TYPE ST_BA_Multistate: STRUCT b En Sfty : BOOL; TF8040 Version: 1.14.0 275
## Page 276

Programming n Val Sfty : UDINT; b En Crit : BOOL; n Val Crit : UDINT; b En Pgm : BOOL; n Val Pgm : UDINT; END_STRUCT END_TYPE Name Type Description b En Sfty BOOL Enable for writing the "Safety" priority. n Val Sfty UDINT Value of the "Safety" priority to be written. b En Crit BOOL Enable for writing the "Critical" priority. n Val Crit UDINT Value of the "Critical" priority to be written. b En Pgm BOOL Enable for writing the "Program" priority. n Val Pgm UDINT Value of the "Program" priority to be written. 6.1.2.2.1.2.2.1.2 ST_BA_Analog TYPE ST_BA_Analog : STRUCT b En Sfty : BOOL; f Val Sfty : REAL; b En Crit : BOOL; f Val Crit : REAL; b En Pgm : BOOL; f Val Pgm : REAL; END_STRUCT END_TYPE Name Type Description b En Sfty BOOL Enable for writing the "Safety" priority. f Val Sfty REAL Value of the "Safety" priority to be written. b En Crit BOOL Enable for writing the "Critical" priority. f Val Crit REAL Value of the "Critical" priority to be written. b En Pgm BOOL Enable for writing the "Program" priority. f Val Pgm REAL Value of the "Program" priority to be written. 6.1.2.2.1.2.2.1.3 ST_BA_Mdlt The command structure is used to control modulating aggregates and contains the priorities "Safety", "Critical" and "Program". TYPE ST_BA_Mdlt : STRUCT b En Sfty : BOOL; e Val Sfty : E_BA_Mdlt; b En Crit : BOOL; e Val Crit : E_BA_Mdlt; b En Pgm : BOOL; e Val Pgm : E_BA_Mdlt; END_STRUCT END_TYPE Name Type Description b En Sfty BOOL Enable for writing the "Safety" priority. e Val Sfty E_BA_Mdlt [} 270] Enum of the "Safety" priority to be written. b En Crit BOOL Enable for writing the "Critical" priority. e Val Crit E_BA_Mdlt [} 270] Enum of the priority "Critical" to be written. b En Pgm BOOL Enable for writing the "Program" priority. e Val Pgm E_BA_Mdlt [} 270] Enum of priority "Program" to be written. 276 Version: 1.14.0 TF8040
## Page 277

Programming 6.1.2.2.1.2.2.1.4 ST_BA_Binary The command structure is used to control binary aggregates and contains the priorities Safety, Critical and Program. TYPE ST_BA_Binary: STRUCT b En Sfty : BOOL; b Val Sfty : BOOL; b En Crit : BOOL; b Val Crit : BOOL; b En Pgm : BOOL; b Val Pgm : BOOL; END_STRUCT END_TYPE Name Type Description b En Sfty BOOL Enable for writing the "Safety" priority. b Val Sfty BOOL Value of the "Safety" priority to be written. b En Crit BOOL Enable for writing the "Critical" priority. b Val Crit BOOL Value of the "Critical" priority to be written. b En Pgm BOOL Enable for writing the "Program" priority. b Val Pgm BOOL Value of the "Program" priority to be written. 6.1.2.2.1.2.2.1.5 ST_BA_Step Data and command structure between the individual step sequence function blocks FB_BA_Step Binary / FB_BA_Step Mdlt and the control block of the step sequence FB_BA_Step Ctrl Agg16. Illustration TYPE ST_BA_Step: STRUCT n Step : UDINT; n Rem Sec On : UDINT; n Rem Sec Off : UDINT; b En Up : BOOL; b En Down : BOOL; b Rdy Up : BOOL; b Rdy Down : BOOL; b Up : BOOL; b Down : BOOL; END_STRUCT END_TYPE TF8040 Version: 1.14.0 277
## Page 278

Programming Name Type Description n Step UDINT Display in which step the step sequence control is located. n Rem Sec On UDINT Countdown Switch-on of the next step [s]. The associated timing element is integrated in the step sequence function blocks FB_BA_Step Binary [} 473] / FB_BA_Step Mdlt [} 475]. n Rem Sec Off UDINT Countdown Switch-off of the next step [s]. The associated timing element is integrated in the step sequence function blocks FB_BA_Step Binary [} 473] / FB_BA_Step Mdlt [} 475]. b En Up BOOL Indicates that the step has its release. b En Down BOOL The variable indicates that the active step is in the off state. After the switch-off delay n Rem Sec Off has elapsed, the step is switched off as well as b En Down and the next step in the falling switch-off sequence becomes the active one. b Rdy Up BOOL After expiration of the start-up delay n Rem Sec On and a TRUE at the feedback b Fdb of the step sequence function block, b Rdy Up is set and the next step is activated. b Rdy Down BOOL After the switch-off delay n Rem Sec Off has expired, b Rdy Down is set for one cycle and the step is switched off. b Up BOOL A TRUE means an increasing switch-on sequence of the aggregates from 1 to 16. b Down BOOL A TRUE means a decreasing switch-off sequence from the highest, active aggregate towards 0. 6.1.2.2.1.2.2.1.6 ST_BA_Priority En The command structure contains the releases of the plant and the priorities "Safety", "Critical" and "Program". Illustration TYPE ST_BA_Priority En: STRUCT b Plt : BOOL; b En Sfty : BOOL; b En Crit : BOOL; b En Pgm : BOOL; END_STRUCT END_TYPE Name Type Description b Plt BOOL Release plant. b En Sfty BOOL Enable for writing the "Safety" priority. b En Crit BOOL Enable for writing the "Critical" priority. b En Pgm BOOL Enable for writing the "Program" priority. 6.1.2.2.1.2.2.2 Plant Control 6.1.2.2.1.2.2.2.1 ST_BA_Aggregate The aggregate structure is used for bidirectional communication between the connected aggregate FB_BA_Aggregate [} 478] and the plant control FB_BA_Plant Control [} 480]. The structure contains the switching values, the plant profile and the current step of the step sequence control. The plant control receives feedback from the aggregate for the step sequence control. 278 Version: 1.14.0 TF8040
## Page 279

Programming Syntax TYPE ST_BA_Aggregate: STRUCT n Step : UDINT; n Prio : UDINT; n Profile : UDINT; f Value : REAL; n Value : UDINT; b Value : BOOL; b Up : BOOL; b Down : BOOL; b Watchdog : BOOL; b Fdb Up : BOOL; b Fdb Down : BOOL; END_STRUCT END_TYPE Name Type Description n Step UDINT Indicates the current step of the step sequence control. n Prio UDINT Shows the active priority of the profile. n Profile UDINT Indicates which profile is active. f Value REAL Transmits the analog switching value to the aggregate. n Value UDINT Transmits the numerical switching value to the aggregate. b Value BOOL Transmits the Boolean switching value to the aggregate. b Up BOOL Indicates that the sequence of the step sequence control is in the rising state. b Down BOOL Indicates that the sequence of the step sequence control is in the falling state. b Watchdog BOOL Bidirectional monitoring of communication between the aggregate and the plant control. If an aggregate is not present within the step sequence control, the step sequence control cannot run into this step. b Fdb Up BOOL Feedback "Up" from the respective aggregate to the plant control. b Fdb Down BOOL Feedback "Down" of the respective aggregate to the plant control. 6.1.2.2.1.2.2.2.2 ST_BA_Profile Description The parameterization structure is used to describe a profile within FB_BA_Plant Control [} 480]. Syntax TYPE ST_BA_Profile Description: STRUCT s Description : T_Max String; n Prio : UDINT; END_STRUCT END_TYPE Name Type Description s Description T_Max String The plant profile in question in plain text. For display purposes only. n Prio UDINT The priority is used to command all aggregates of a plant. The priority is transferred from the plant control program FB_BA_Plant Control [} 480] within the ST_BA_Aggregate [} 278] to the aggregates and output at the function block FB_BA_Aggregate [} 478]. Within the aggregate templates, this priority is used to command the objects. TF8040 Version: 1.14.0 279
## Page 280

Programming 6.1.2.2.1.2.2.2.3 ST_BA_Profile Parameter The parameterization structure is used within the plant control FB_BA_Plant Control [} 480] for the parameterization of the parameters of a step or an aggregate. The structure contains the binary, numerical and analog switching value for the aggregate, the delay times and the enable for the use of the feedback signals from the aggregates. Syntax TYPE ST_BA_Plant Control_Param Set: STRUCT s Step : T_Max String; s Profile : T_Max String; f Delay Up : REAL; f Delay Down : REAL; f Value : REAL; n Value : UDINT; b Value : BOOL; b En Fdb Up : BOOL; b En Fdb Down : BOOL; END_STRUCT END_TYPE Name Type Description s Step T_Max String The plant step in question in plain text. The content of the text is specified via the arr Step Description parameter structure in the function block FB_BA_Plant Control [} 480]. s Profile T_Max String The profile in question in plain text. The content of the text is specified via the arr Profile Description structure in the function block FB_BA_Plant Control [} 480]. f Delay Up REAL Time specification of the start-up delay [s,ms]. The time specification is only taken into account within the plant control for upshifting if it is > 0. f Delay Down REAL Time specification of switch-off delay [s,ms]. The time specification is only taken into account within the plant control for downshifting if it is > 0. f Value REAL Analog switching value for the aggregate. n Value UDINT Numerical switching value for the aggregate. b Value BOOL Binary switching value for the aggregate. b En Fdb Up BOOL A TRUE means that the feedback from the aggregate is used in the step "Up". b En Fdb Down BOOL A TRUE means that the feedback from the aggregate is used in the step "Down". 6.1.2.2.1.2.2.3 Sequence 6.1.2.2.1.2.2.3.1 ST_BA_PIDControl Sequence Data and command structure between the individual sequence controllers FB_BA_PIDControl Sequence and the control block FB_BA_PIDControl Sequence Link [} 489]. Syntax TYPE ST_BA_PIDControl Sequence : STRUCT arr Seq Link Data : ARRAY[1.. MAX(1,BA_Param.n Max Seq Ctrl)] OF ST_BA_PIDControl Sequence Data; f E : REAL; n Actv Seq Ctrl : UDINT; b Sync : BOOL; b En Seq Link : BOOL; END_STRUCT END_TYPE 280 Version: 1.14.0 TF8040
## Page 281

Programming Name Type Description arr Seq Link Data ARRAY[1.. MAX(1,BA_Para This field of the ST_BA_PIDControl Sequence Data structure displays the data and commands of the individual m.n Max Seq Ctrl sequence controllers. [} 284])] OF ST_BA_PIDControl Sequenc This field is limited by the global parameter BA_Param.n Max Seq Ctrl. e Data [} 281] f E REAL Displays the control deviation of the active sequence controller. This depends on the control direction of the respective sequence controller. E_BA_Action.e Direct -> f E = f X-f W E_BA_Action.e Reverse -> f E = f W-f X n Actv Seq Ctrl UDINT Number of the active sequence controller. b Sync BOOL A synchronization pulse has been triggered on one of the sequence controllers. This pulse makes the sequence controller the active one in the sequence. b En Seq Link BOOL This variable shows b En of the function block FB_BA_PIDControl Sequence Link [} 489]. 6.1.2.2.1.2.2.3.2 ST_BA_PIDControl Sequence Data This structure contains the data and commands of the individual sequence controllers FB_BA_PIDControl Sequence [} 486]. Syntax TYPE ST_BA_PIDControl Sequence Data : STRUCT f Y : REAL; f YMin : REAL; f YMax : REAL; f W : REAL; f X : REAL; f E : REAL; n Actv Seq Ctrl : UDINT; n My Num : UDINT; e Actn : E_BA_Action; b Seq Ctrl Operable : BOOL; b Watchdog : BOOL; b Seq Num Multiple : BOOL; b En : BOOL; b Is Actv Seq Ctrl : BOOL; END_STRUCT END_TYPE TF8040 Version: 1.14.0 281
## Page 282

Programming Name Type Description f Y REAL Control value f YMin REAL Minimum control value f YMax REAL Maximum control value f W REAL Setpoint f X REAL Process value f E REAL Displays the control deviation of the sequence controller. This depends on the control direction of the respective sequence controller. E_BA_Action.e Direct -> f E = f X-f W E_BA_Action.e Reverse -> f E = f W-f X n Actv Seq Ctrl UDINT Number of the active sequence controller. n My Num UDINT My number in the sequence. e Actn E_BA_Action Controller control direction b Seq Ctrl Operable BOOL The sequence controller is ready to operate. b Watchdog BOOL The watchdog is set at each PLC cycle in each sequence controller and reset after evaluation in the sequence link. b Seq Num Multiple BOOL Indicates that the own sequence number n My Num has been assigned multiple times to sequence controllers. b En BOOL Input Enable sequence controller b Is Actv Seq Ctrl BOOL Indicates that the sequence controller is the active one in the sequence. 6.1.2.2.1.2.2.4 Schedule 6.1.2.2.1.2.2.4.1 ST_BA_Temp Change Function For an outside temperature f Outside Temp, this structure contains the expected temperature change f Room Temp Change when switching on(FB_BA_Optimized On) or switching off(FB_BA_Optimized Off) a heating or cooling system. TYPE ST_BA_Temp Change Function : STRUCT f Outside Temp : ARRAY[1.. FB_BA_Optimization Base.n Opt On Off_Max Nodes] OF REAL; f Room Temp Change : ARRAY[1.. FB_BA_Optimization Base.n Opt On Off_Max Nodes] OF REAL; END_STRUCT END_TYPE Name Type Description f Outside Temp REAL The considered outside temperature interpolation points of the optimization function in °C. f Room Temp Change REAL The expected room temperature change values in K/min associated with the outside temperatures. 6.1.2.2.1.2.2.4.2 T_BA_Schedule Week The type declaration includes a weekly schedule. The first part of the two-dimensional array specifies the days of the week, the second part the schedule entries, see ST_BA_Sched Entry. The number of schedule entries is limited by the global parameter BA_Param.n Schedule Entry Count, see BA_Param [} 284]. TYPE T_BA_Schedule Week : ARRAY[E_BA_Weekday. First.. E_BA_Weekday. Last, 1.. MAX(1,BA_Param.n Schedule Entry C ount)] OF ST_BA_Sched Entry; END_TYPE 282 Version: 1.14.0 TF8040
## Page 283

Programming 6.1.2.2.1.2.2.4.3 T_BA_Schedule Exception List The type declaration contains a field of 24 schedule exception profiles, see ST_BA_Schedule Exception [} 283]. This field is limited by the global parameter BA_Param.n Schedule Exception Count, see BA_Param [} 284]. TYPE T_BA_Schedule Exception List : ARRAY[1 .. BA_Param.n Schedule Exception Count] OF ST_BA_Schedule Excepti on; END_TYPE 6.1.2.2.1.2.2.4.4 T_BA_Schedule Exception Entry List The type declaration contains 6 schedule entries for an exception profile, see ST_BA_Sched Entry. This field is limited by the global parameter BA_Param.n Schedule Entry Count, see BA_Param [} 284]. TYPE T_BA_Schedule Exception Entry List : ARRAY[1 .. BA_Param.n Schedule Entry Count] OF ST_BA_Sched Entry; END_TYPE 6.1.2.2.1.2.2.4.5 ST_BA_Schedule Exception The structure represents a schedule exception profile. TYPE ST_BA_Schedule Exception : STRUCT e Type : E_BA_Date Val Choice := E_BA_Date Val Choice. Invalid; u Date : U_BA_Date Val; a Entry : T_BA_Schedule Exception Entry List; END_STRUCT END_YPE Name Type Description e Type E_BA_Date Val Choice Specification of the time period type for the exception profile entry. You can choose from 3 options (Simple date, Date range, Week and day). u Date U_BA_Date Val Specification of the date value for the specified period type e Type. a Entry T_BA_Schedule Exception E List of schedule entries for an exception profile entry. ntry List [} 283] 6.1.2.2.2 GVLs 6.1.2.2.2.1 BA_Globals The global variable list contains value flags. VAR_GLOBAL {region 'Room-Automation'} n Evt Inc Light : ULINT; n Evt Inc Sun Bld : UDINT; {endregion} {region 'Constants'} {region 'General'} n No Active Prio : UDINT := 16#FFFFFFFF; // Value of the constant indicates that no priority is acti ve {endregion} {endregion} END_VAR TF8040 Version: 1.14.0 283
## Page 284

Programming Name Type Description n Evt Inc Light ULINT Counter light telegrams. Telegrams of certain function blocks, e.g. FB_BA_Lighting Evt [} 309] are instantiated more often in a building. If they send telegrams of the same priority, it is desirable that the last one sent is valid. To do this, these function blocks increment the global counter n Evt Inc Light. Telegram selectors of type FB_BA_Lighting Tgm Sel4/ FB_BA_Lighting Tgm Sel8 [} 310] evaluate this counter and accept the last telegram sent. n Evt Inc Sun Bld UDINT Same functionality as n Evt Inc Light, only for sun protection. The telegram selectors are here: FB_BA_Sun Bld Tgm Sel4/ FB_BA_Sun Bld Tgm Sel8 [} 310]. n No Active Prio UDINT The value of the constant indicates that no priority is active. 6.1.2.2.2.2 BA_Param The global parameter list contains general parameters to initialize objects. VAR_GLOBAL CONSTANT {region 'Sun Protection'} n Sun Prt_Max Sun Bld Scn : USINT := 20; n Sun Prt_Max Row Fcd : UINT := 10; n Sun Prt_Max Column Fcd : UINT := 20; n Sun Prt_Max Shd Obj : UINT := 20; {attribute 'parameter Unit' := 'Byte'} n Sun Prt_Max Data File Size : UDINT := 100000; {endregion} {region 'Universal'} {region 'Sequence'} n Max Seq Ctrl : USINT := 8; {endregion} {region 'Plant Control'} n Max Priority : UDINT := 16; n Max Aggregate : UDINT := 16; n Number Of Op Modes : UDINT := 24; 284 Version: 1.14.0 TF8040
## Page 285

Programming {endregion} {endregion} {region 'Objects'} {region 'Schedule'} n Schedule Entry Count : UDINT := 6; n Schedule Calendar Count : UDINT := 3; n Schedule Exception Count : UDINT := 24; {endregion} {endregion} END_VAR Name Type Description n Sun Prt_Max Sun Bld USINT Maximum set of scenes that can be administered by a Scn FB_BA_Sun Bld Scn. n Sun Prt_Max Row Fc UINT Maximum number of floors that can be monitored by the d shading correction (horizontal orientation of windows). n Sun Prt_Max Colum UINT Maximum number of axes that can be monitored by the n Fcd shading correction (vertical alignment of windows). n Sun Prt_Max Shd Ob UINT Maximum number of shading objects that cast shadows on j a facade. n Sun Prt_Max Data Fil UDINT Maximum file size [byte] for Excel lists to be read by the e Size function blocks FB_BA_Rd Fcd Elem Lst and FB_BA_Rd Shd Obj Lst. n Max Seq Ctrl USINT The global parameter specifies the number of sequence controllers. It limits the data and command structure arr Seq Link Data within the structure ST_BA_Seq Link [} 123]. The value must not be less than 1. n Max Priority UDINT The global parameter specifies the maximum number of priorities within the plant control FB_BA_Plant Control [} 480]. The value must not be less than 1. n Max Aggregates UDINT The global parameter specifies the maximum number of aggregates within the plant control FB_BA_Plant Control [} 480]. The value must not be less than 1. n Number Of Op Mode UDINT The global parameter specifies the maximum number of s operation modes within the plant controller FB_BA_Plant Control [} 480]. The value must not be less than 1. n Schedule Entry Cou UDINT The global parameter specifies the maximum number of nt schedule entries, e.g. for a weekday T_BA_Schedule Week [} 282] or exception entry T_BA_Schedule Exception Entry List [} 283]. The value must not be less than 1. n Schedule Exception UDINT The global parameter specifies the maximum number of Count exception entries, e.g. T_BA_Schedule Exception List [} 283]. The value must not be less than 1. TF8040 Version: 1.14.0 285
## Page 286

Programming 6.1.2.2.3 POUs 6.1.2.2.3.1 Function Blocks 6.1.2.2.3.1.1 Air Conditioning 6.1.2.2.3.1.1.1 FB_BA_Frst Prtc The function block FB_BA_Frst Prtc is used for frost monitoring of a heating coil in an air conditioning system. A frost risk is present, if the input b Frst is TRUE. The frost alarm must be linked in the plant program such that the plant is switched off immediately, the heater valve opens, and the heater pump is switched on. If there is risk of frost, the output b On is set, and n T1 (seconds) is started. If the frost risk remains (b Frst = TRUE) after n T1 has elapsed, b On remains set. It can only be reset at input b Rst. If the frost alarm ceases due to activation of the heating coil within the time n T1 (b Frst = FALSE), the plant automatically restarts. For the plant restart b On becomes FALSE, and at output b HWRst a pulse for acknowledgement of a latching circuit in the control cabinet is issued. With the restart a second monitoring period n T2 (seconds) is initiated. If another frost alarm occurs within this period, the plant is permanently locked. b On remains set until the frost alarm has been eliminated and b Rst has been acknowledged. In a scenario where frost alarms recur with time offsets that are greater than n T2, theoretically the plant would keep restarting automatically. In order to avoid this, the restarts within the function block are counted. The parameter n Alm Cnt can be used to set the number of possible automatic restart between 0 and 4. An acknowledgement at input b Rst resets the alarm memory within the function block to zero. Example: t0 = frost alarm at input b Frst, alarm message at output b On, start of timer T1 (n T1 [s]) t1 = frost alarm off, resetting of b On, output of hardware pulse, start of timer T2 (n T2 [s]), plant restart t2 = further frost alarm within T2, alarm message at b On, start of timer T1, locking of the frost alarm t3 = frost alarm off. t4 = acknowledgement of the alarm at b Rst, resetting of b On. 286 Version: 1.14.0 TF8040
## Page 287

Programming Inputs VAR_INPUT b Frst : BOOL; n T1 : UDINT; n T2 : UDINT; n Alm Cnt : UDINT; b Rst : BOOL; END_VAR Name Type Description b Frst BOOL Connection for frost events on the air and water side. n T1 UDINT Timer for restart delays [s]. Internally limited to a minimum value of 0. n T2 UDINT Timer monitoring time [s]. Internally limited to a minimum value of 0. n Alm Cnt UDINT Maximum number of automatic plant restarts without reset. Internally limited to values between 0 and 4. b Rst BOOL Resetting and acknowledgement of the frost alarm. Outputs VAR_OUTPUT b On : BOOL; b HWRst : BOOL; n Rem Ti1 : UDINT; n Rem Ti2 : UDINT; b Alm Lck : BOOL; n Sta Cnt : UDINT; END_VAR TF8040 Version: 1.14.0 287
## Page 288

Programming Name Type Description b On BOOL Frost alarm active b HWRst BOOL Output of a pulse for acknowledgement of the frost protection hardware n Rem Ti1 UDINT Time remaining to plant restart after frost alarm. n Rem Ti2 UDINT Remaining monitoring time. b Alm Lck BOOL Alarm lock - stored alarm. n Sta Cnt UDINT Status counter – current number of unacknowledged false starts. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.1.2 FB_BA_HX This function block FB_BA_HX is used to calculate the dew point temperature, the specific enthalpy and the absolute humidity. The temperature, the relative humidity and the barometric air pressure are required for the calculation of these parameters. Enthalpy is a measure of the energy of a thermodynamic system. Inputs VAR_INPUT f T : REAL; f Hum Rel : REAL; f AP : REAL; END_VAR Name Type Description f T REAL Temperature [°C]. f Hum Rel REAL Relative humidity [%] f AP REAL Hydrostatic air pressure at 1013.25 h Pa. Outputs VAR_OUTPUT f Hum Abs : REAL; f Dew Pnt : REAL; f E : REAL; f DHA : REAL; f Spec V : REAL; f TWet : REAL; END_VAR 288 Version: 1.14.0 TF8040
## Page 289

Programming Name Type Description f Hum Abs REAL Absolute humidity g water per kg dry air [g/Kg]. f Dew Pnt REAL Dew point temperature [°C] f E REAL Enthalpy [k J/kg] f DHA REAL Density of moist air ρ [kg mixture/m³] f Spec V REAL Specific volume [m³/kg] f TWet REAL Wet bulb temperature [°C] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.1.3 FB_BA_Ngt Col This function block FB_BA_Ngt Col is used to cool down rooms that have been heated up during the day with cool outside air at night. The summer night cooling function serves to improve the quality of the air and to save electrical energy. Electrical energy for cooling is saved during the first hours of the next summer day. The start conditions for the summer night cooling are defined by parameterizing the FB_BA_Ngt Col function block. The function block can be used to open motor-driven windows or to switch air conditioning systems to summer night cooling mode outside their normal hours of operation. Switching conditions The following conditions must be met for activation of summer night cooling: • The function block itself is enabled (b En = TRUE). • The outside temperature is not too low (f TOts > f TOts Lo Lmt). • The outside temperature is sufficiently low compared to the room temperature (f TRm - f TOts) > f Swi On Diff T. • The room temperature is high enough to justify activating summer night cooling. f TRm > f Sp Rm + f TRm Hys. Under the following conditions the summer night cooling is disabled: • The function block itself is disabled (b En = FALSE). • The outside temperature is too low f TOts < (f TOts Lo Lmt - 0.5). • The outside temperature is too high compared to the room temperature (f TRm - f TOts) < f Swi Off Diff T. • The room temperature is lower than the setpoint. f TRm ≤ f Sp Rm. Inputs VAR_INPUT b En : BOOL; f TOts : REAL; f TRm : REAL; f Sp Rm : REAL; f TOts Lo Lmt : REAL; TF8040 Version: 1.14.0 289
## Page 290

Programming f TOts Hys : REAL; f TRm Hys : REAL; f Swi On Diff T : REAL; f Swi Off Diff T : REAL; END_VAR Name Type Description b En BOOL Enable function block. f TOts REAL Outside temperature [°C] f TRm REAL Room temperature [°C] f Sp Rm REAL Room temperature setpoint f TOts Lo Lmt REAL Lower outside temperature limit [°C]; prevents excessive cooling. f TOts Hys REAL Hysteresis for minimum outside temperature [°K]. This hysteresis, which at the lower end is internally limited to 0.5 K, is intended to prevent b Q from switching, if the outside temperature fluctuates precisely around the value of r TOts Lo Lmt. f TRm Hys REAL Hysteresis for the room temperature [K]. This hysteresis, which at the lower end is internally limited to 0.5 K, is intended to prevent unnecessary switching of b Q, if the room temperature fluctuates precisely around the setpoint r Sp Rm. f Swi On Diff T REAL Difference between the room temperature and the outside temperature, from which summer night cooling is enabled [K]. f Swi Off Diff T REAL Difference between the room temperature and the outside temperature, from which summer night cooling is locked [K]. An internal check is carried out to ensure that the difference between (f Swi On Diff T - f Swi Off Diff T) > 0.5. Outputs VAR_OUTPUT b Q : BOOL; END_VAR Name Type Description b Q BOOL Summer night cooling On Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.1.4 FB_BA_Rcv Monit 290 Version: 1.14.0 TF8040
## Page 291

Programming The function block FB_BA_Rcv Monit is used to calculate the efficiency of an energy recovery system. The function block requires the following measured temperature values to calculate the efficiency (the so- called heat recovery coefficient): • Outside air temperature f TOts • Exhaust air temperature f TExh • Air temperature of the energy recovery system in the supply air duct (alternatively: in the extract air duct) f TAft Rcv The function block logs the temperature values every 10 seconds and forms minutely averages from 6 consecutive values. The results are used to check whether the plant has reached a "stable" state. • This is the case when the recorded temperatures of outside air, exhaust air and air after energy recovery are almost constant, i.e. none the 6 individual values deviate by more than 0.5 K from the respective average value. • The temperature difference between outside air and exhaust air is at least 5 K. If this is the case, this measuring cycle is acknowledged with a TRUE signal at output b Stbl Op, and the calculated efficiency is output at f Effc. If the state is not "stable", a FALSE signal appears at output b Stbl Op, and f Effc is set to 0. In any case, each measuring and analysis cycle is marked as completed with a trigger (a TRUE signal lasting one PLC cycle) at b New Val. Enable (b En) and Reset (b Rst) The function block is only active if a TRUE signal is present at b En. Otherwise its execution stops, and all outputs are set to FALSE or 0.0. An active measuring and evaluation cycle can be terminated at any time by a TRUE signal at b Rst. All outputs are set to FALSE or 0.0, and the measuring cycle restarts automatically. Selection of the temperature value "after recovery" (b Sns Rcv TExh) A FALSE entry at b Sns Rcv TExh means that the temperature measurement after the heat recovery in the supply air duct is used for calculating the efficiency. To use the temperature measurement after the heat recovery in the exhaust air duct, TRUE must be applied at b Sns Rcv TExh. Limit value exceeded (f Contr Var, f Lmt Effc, b Lmt Rchd) A limit violation has occurred, if the calculated efficiency is less than the specified limit value r Lmt Effc, and at the same time the control value for the heat recovery is at 100%. For this purpose, the manipulated variable must be connected to the input f Contr Var. The limit violation message can be delayed by an entry at n Lmt Vio Dly_sec [s]: If the two criteria, violation and override, are present for longer than n Lmt Vio Dly _sec [s], this is indicated by a TRUE signal at b Lmt Rchd. A warning message that has occurred disappears if a complete measuring cycle provides "good" values or if there is a rising edge at b Rst or if the function block is deactivated. This warning message only occurs if the plant is in a stable operation mode (b Stbl Op=TRUE). Taking into account the temperature increase of the exhaust air due to the fan motor (f TInc Fan) It is possible that the outlet air is warmed by a fan motor, resulting in distortion of the measurement. This temperature increase can be specified through f TInc Fan. Internally, the measured outlet air temperature is then reduced by this value. TF8040 Version: 1.14.0 291
## Page 292

Programming Inputs VAR_INPUT b En : BOOL; b Rst : BOOL; f Contr Var : REAL; f TOts : REAL; f TExh : REAL; f TAft Rcv : REAL; b Sns Rcv TExh : BOOL; f TInc Fan : REAL; f Lmt Effc : REAL; n Lmt Vio Dly : UDINT; END_VAR Name Type Description b En BOOL Enable function block. b Rst BOOL Reset - all determined values are deleted. f Contr Var REAL Control value for the heat recovery, i.e. the actual value. f TOts REAL Outside temperature [°C] f TExh REAL Exhaust air temperature [°C] f TAft Rcv REAL Temperature after energy recovery b Sns Rcv TExh BOOL Temperature at the measuring point after energy recovery: FALSE -> in the supply air duct (Supply Air) - TRUE -> in the exhaust air duct (Exhaust Air). f TInc Fan REAL Temperature increase due to fan. f Lmt Effc REAL Limit value efficiency n Lmt Vio Dly UDINT Limit violation delay [s]. Internally limited to a minimum value of 0. Outputs VAR_OUTPUT b New Val : BOOL; f Effc : REAL; b Lmt Rchd : BOOL; b Stbl Op : BOOL; END_VAR Name Type Description b New Val BOOL Output trigger for new value f Effc f Effc REAL Efficiency b Lmt Rchd BOOL Limit value reached b Stbl Op BOOL Stable operation Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.1.5 FB_BA_Sp Sup Vis 292 Version: 1.14.0 TF8040
## Page 293

Programming Function block FB_BA_Sp Sup Visdient for processing and checking the lower and upper setpoint of a supply air humidity or temperature control. Checks and limits for the setpoints The function block limits the setpoints. The following two tables show which parameters are checked and what the response is in the event of an error. Checking Action f Sp Lo > f Sp Hi Last valid values of f Sp Lo and f Sp Hi are used. f Sp Min >= f Sp Max Last valid values of f Sp Min and f Sp Max are used. f Sp Hi > f Sp Max f Pr Sp Hi = f Sp Max f Sp Lo < f Sp Min f Pr Sp Lo = f Sp Min Checking b Err Action f Sp Min >= f Sp Max TRUE f Sp Err = ((f Sp Min + f Sp Max) / 2) f Sp Hi < f Sp Min f Pr Sp Hi = f Pr Sp Lo = f Pr Rcv = f Sp Lo > f Sp Max f Sp Err The difference between the setpoints describes an energy-neutral zone. With supply air control, no heating or cooling would take place within the neutral zone. The checked and possibly limited setpoints are output at the function block output as f Pr Sp Hi und f Pr Sp Lo (Present Setpoint). Setpoint for heat recovery For a heat recovery system, the setpoint f Sp Rcv is calculated either from the average of the upper and lower setpoints, f Sp Hi and f Sp Lo or as a function of the control direction of the heat recovery system. The method is defined by the input variable b Slcn Sp Rcv: b Slcn Sp Rcv f Sp Rcv TRUE Average of f Sp Lo and f Sp Hi FALSE Depends on control direction, defined through input b Act Rcv If the setpoint is defined depending on the control direction, the following applies: b Act Rcv Control direction f Sp Rcv TRUE direct (cooling) f Sp Hi FALSE indirect (heating) f Sp Lo TF8040 Version: 1.14.0 293
## Page 294

Programming Heat recovery Inputs VAR_INPUT b En : BOOL; f Sp Hi : REAL; f Sp Lo : REAL; f Sp Max : REAL; f Sp Min : REAL; b Actn Rcv : BOOL; b Slcn Sp Rcv : BOOL; END_VAR Name Type Description b En BOOL Function block enable. If b En = FALSE, all output parameters are 0.0. f Sp Hi REAL Upper setpoint input value to be checked. f Sp Lo REAL Lower setpoint input value to be checked. f Sp Max REAL Maximum setpoint f Sp Min REAL Minimum setpoint. b Actn Rcv BOOL Direction of action of the downstream heat recovery. b Slcn Sp Rcv BOOL Setpoint selection of the downstream heat recovery system. Outputs VAR_OUTPUT f Pr Sp Hi : REAL; f Pr Sp Lo : REAL; f Sp Rcv : REAL; b Err : BOOL; s Err Descr : T_MAXSTRING; END_VAR Name Type Description f Pr Sp Hi REAL Output value for the upper setpoint. f Pr Sp Lo REAL Output value for the lower setpoint. f Sp Rcv REAL Output value for the resulting heat recovery setpoint. b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description 294 Version: 1.14.0 TF8040
## Page 295

Programming Error description 01: Warning: The setpoints are not in a logical order: Either (f Sp Min >= f Sp Max) OR (f Sp Hi < f Sp Min) OR (f Sp Lo > f Sp Max) Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.2 Domestic Hot Water 6.1.2.2.3.1.2.1 FB_BA_DHW2P This function block FB_BA_DHW2P controls the charging (heating) of a hot water tank via an on-off controller. Tank heating is activated at input b En. If tank heating is active the output b Ld is TRUE. The variable f Sp is used to transfer the setpoint for the service water temperature to the function block. A minimum selection is connected to the input f TMin, a maximum selection of all temperature sensors of the hot water tank is connected to the input f TMax. Due to the temperature stratification in the hot water tank, the top sensor is generally the one with the highest temperature and the bottom one with the lowest. The tank can be charged in two ways via the variables b Kep Ful: b Kep Ful = FALSE Charging is requested if f TMax falls below the value of f Sp-f Sp Hys. The charge request is disabled if f TMin is above the setpoint for f Sp. Due to the fact that the sensor at the top generally measures the highest temperature, the heating is not switched on until the hot water tank has been discharged. TF8040 Version: 1.14.0 295
## Page 296

Programming b Kep Ful = TRUE Charging is requested if f TMin falls below the value of f Sp-f Sp Hys. The charge request is disabled once f TMin is above the setpoint again. Selecting the minimum of all tank temperatures ensures that the coldest point of the tank is used for control purposes. Recharging takes place when the tank is no longer full. Inputs VAR_INPUT b En : BOOL; f Sp : REAL; f Sp Hys : REAL; f TMax : REAL; f TMin : REAL; b Kep Ful : BOOL; END_VAR Name Type Description b En BOOL Enable boiler charging f Sp REAL Service water temperature setpoint [°C]. f Sp Hys REAL Hysteresis, recommended 1°K to 5°K. f TMax REAL Maximum selection of all tank temperatures [°C]. f TMin REAL Minimum selection of all tank temperatures [°C]. b Kep Ful BOOL Control temperature selection: FALSE = f TMax is used to request b Ld, f TMin to switch off. TRUE = f TMin alone controls the switching on/off of b Ld. Outputs VAR_OUTPUT b Ld : BOOL; f Sp Out : REAL; END_VAR Name Type Description b Ld BOOL Enable charging mode. f Sp Out REAL Setpoint forwarding to charging circuit: f Sp Out = f Sp (input) if the function block is enabled. f Sp Out = 0 if the function block is not enabled. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 296 Version: 1.14.0 TF8040
## Page 297

Programming 6.1.2.2.3.1.2.2 FB_BA_Lgl Prev This function block FB_BA_Lgl Prev is used for disinfection of the service water and for killing off Legionella. Disinfection mode is activated at input b En Lgl Prev via a timer program. It is advisable to run the disinfection at least once per week (during the night). The temperature should be at least 70 °C. The activation interval at b En Lgl Prev must be adequately long. The output b Ld activates the storage tank charging. For hot water tanks with several temperature sensors, a min selection of all sensors must be connected to f TMin. If f TMin exceeds the value of f Sp, a monitoring timer with a time of n Ti_sec [s] is started. If the minimum tank temperature f TMin remains above f Sp - f Sp Hys while the timer is active, the tank was heated adequately. If circulation is active, the output b Ld must be linked to enabling of the circulation pump, to ensure that the water pipe within the service water system is included in the disinfection. If the temperature has fallen below f Sp -f Sp Hys during the disinfection process, this process must be restarted and run until the time n Ti has fully elapsed. If disinfection is successful, output b Ld is reset. If the disinfection process was incomplete during the function block activation (b En Lgl Prev), this is indicated with the output b Alm. The output must be reset with b Rst. Explanation of the diagram: t0 Start of the legionella program and switching of output b Ld. Heating of the hot water tank. TF8040 Version: 1.14.0 297
## Page 298

Programming t1 The tank has reached the temperature f Sp. The timer for the heating time is started. t2 The minimum tank temperature has fallen below f Sp -f Sp Hys. The timer for the heating time is reset. t3 The temperature exceeds f Sp again, and the heating timer is started again. t4 The minimum tank temperature was above the limit f Sp - f Sp Hys over the period n Ti ; the disinfection was successful. b Ld is reset, and the hot water tank switches back to normal operation. Inputs VAR_INPUT b En Lgl Prev : BOOL; f TMin : REAL; f Sp : REAL; f Sp Hys : REAL; n Ti : UDINT; b Rst : BOOL; END_VAR Name Type Description b En Lgl Prev BOOL Enabling of disinfection operation via a timer program. f TMin REAL Minimum tank temperature [°C]. Minimum selection of temperature sensors at the top and bottom. f Sp REAL Setpoint for disinfection [°C] f Sp Hys REAL Temperature difference [°K] lower limit; always calculated absolute. n Ti UDINT Monitoring period [s]. b Rst BOOL Resetting of the legionella alarm. Outputs VAR_OUTPUT b Ld : BOOL; f Sp Out : REAL; n RTi : UDINT; n Sta : UDINT; b Alm : BOOL; END_VAR Name Type Description b Ld BOOL Anti-legionella mode active. f Sp Out REAL Setpoint forwarding to charging circuit: f Sp (input) if the function block is activated 0 if the function block is not activated n RTi UDINT Countdown timer disinfection mode. n Sta UDINT Disinfection program status: 1. Disinfection operation was successful. 2. Disinfection completed successfully. After the disinfection, and to reactivate legionella prevention, b En Lgl Prev must be FALSE. 3. Disinfection operation active. 4. Disinfection not successfully. Alarm is pending. 5. Disinfection not successfully, the alarm was acknowledged. 6. Restart of the controller or no legionella mode has been requested yet. b Alm BOOL The temperature setpoint was not reached consistently over the interval n Ti, so that adequate disinfection is not guaranteed. 298 Version: 1.14.0 TF8040
## Page 299

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3 Room Automation 6.1.2.2.3.1.3.1 Heating Cooling Functions 6.1.2.2.3.1.3.1.1 FB_BA_Fnct Sel The function block FB_BA_Fnct Sel is used to enable heating or cooling operation in a room. The type of distribution network plays a major role here: If it is a two-pipe system, all the rooms in the system can only ever be either heated or cooled. In a four-pipe system, on the other hand, the air conditioning of the rooms can be based on demand, i.e. one part of the rooms can be heated and the other cooled by the same system. The function block used for each room, as already mentioned, selects its controllers, depending on which type of piping system is available: Two-pipe network The two-pipe system is selected when e Pipe Sys.e2Pipe is set at the input of the function block. Since all rooms served by the plant can only either be heated or cooled, the choice is specified centrally for all rooms via the input e Medium. If e Medium is FALSE, the room heating controller is selected. If the input is TRUE the cooling controller is selected. The controller enable states b En Htg and b En Col are always issued with a delay of n Chg Ovr Dly [s]. In other words, heating cannot be enabled until the cooling enable state b En Col for n Chg Ovr Dly is FALSE, and vice versa. In addition to the elapsing of this changeover time, the system checks that the output from controller to be switched off is 0.0. This is done by feedback at the inputs f Ctrl Val Htg and f Ctrl Val Col. In this way, a drastic change from heating to cooling and vice versa is avoided. Four-pipe network The four-pipe system is selected when e Pipe Sys.e4Pipe is set at the input of the function block. In this case, the choice of controller can be different for the individual rooms as required, based on the room temperature f Rm T and the setpoints f Sp Htg for heating and f Sp Col for cooling. If the room temperature exceeds the cooling setpoint, the cooling controller is enabled (b En Col), if it falls below the heating setpoint, the heating controller is enabled (b En Htg). If the temperature is between the two setpoints, both controllers are switched off (energy-neutral zone). Here too, the output of the controller enable states b En Htg and b En Col is delayed by n Chg Ovr Dly [s] (see two-pipe network). In addition to the elapsing of this changeover time, the system checks that the output from controller to be switched off is 0.0. This is done by feedback at the inputs f Ctrl Val Htg and f Ctrl Val Col. In this way, a drastic change from heating to cooling and vice versa is avoided, if the changeover time is inadequate. Dew point sensor (b Dew Pnt) In both systems (two- and four-pipe) the dew point sensor has the task of deactivating cooling immediately, if required. TF8040 Version: 1.14.0 299
## Page 300

Programming Program sequence The function block can have 3 possible states: 1. Waiting for heating or cooling enable 2. Heating enable 3. Cooling enable In the first step, the function block waits for compliance with the conditions required for heating or cooling: Heating Cooling Output cooling controller = 0 (f Ctrl Val Col) Output heating controller = 0 (f Ctrl Val Htg) Room temperature (f Rm T) < setpoint heating Room temperature (f Rm T) > setpoint cooling (f Sp Col) (f Sp Htg) Cooling controller enable (b En Col) is FALSE over at Heating controller enable (b En Htg) is FALSE over at least the changeover time n Chg Ovr Dly [s] least the changeover time n Chg Ovr Dly [s] Four-pipe system is selected (e Pipesys = Four-pipe system is selected (e Pipesys = E_BA_Pipe Sys.4Pipe) or two-pipe system is selected E_BA_Pipe Sys.e4Pipe) or two-pipe system is and heating medium is available (e Pipesys = selected and cooling medium is aveilable (e Pipesys = E_BA_Pipe Sys.2Pipe AND b Medium = FALSE) E_BA_Pipe Sys.e2Pipe AND b Medium = TRUE) The dew point sensor does not trigger (b Dew Pnt = TRUE) If a chain of conditions is met, the function block switches to the respective state (heating or cooling) and remains in this state until the corresponding controller issues 0 at the function block input (f Ctrl Val Htg/ f Ctrl Val Col). This ensures that only one controller is active at any one time, even if a high heating controller output, for example, would call for a brief cooling intervention (overshoot). Heating or cooling continues until there is no longer a demand. There are 3 exceptions, for which heating or cooling is immediately interrupted: 1. In the two-pipe system (e Pipe Sys = E_BA_Pipe Sys.2Pipe) heating is active (b En Htg), but the system has been switched to cooling medium (e Medium = E_BA_Medium.e Cool Medium) 2. In the two-pipe system (e Pipe Sys = E_BA_Pipe Sys.2Pipe) cooling is active (b En Col), but the system has been switched to heating medium (e Medium = E_BA_Medium.e Heat Medium) 3. The dew point sensor was triggered (b Dew Pnt=TRUE) in cooling mode (two or four-pipe system) In these cases the heating or cooling enable states are canceled, and the plant switches to standby. If one of the two controller is enabled and the corresponding controller does not react, i.e. it remains at "0" for the time n Chg Ovr Dly [s], the function block automatically returns to the first step "Wait for heating or cooling enable". This is an emergency function in case a temperature sensor jumps and a wrong selection is made, which then cannot be fulfilled by the selected controller. An example would be if at PLC start a sensor function outputs 0°, thus heating is selected and the sensor function then assumes a temperature value that requires the cooling controller due to a programmed PLC start delay. Without this emergency function, it would be waited in vain for the heating controller to assume a value greater than "0". Demand message (e Reqd Medium) To notify the plant of the current demand for heating or cooling, a demand ID is issued at the function block output, i.e. for each room, depending on the actual and set temperature. These can be collected and evaluated centrally. The evaluation always takes place, irrespective of the network type (two- or four-pipe). e Reqd Medium Medium Room temperature 1 No medium is requested f Rm T > f Sp Htg AND f Rm T < f Sp Col 2 Heating medium is requested f Rm T < f Sp Htg 3 Cooling medium is requested f Rm T > f Sp Col 300 Version: 1.14.0 TF8040
## Page 301

Programming Error handling The heating setpoint must not be greater than or equal to the cooling setpoint, since this would result in temperature range with simultaneous heating and cooling demand. However, since the function block only issues one enable state at a time (i.e. heating or cooling), the case is harmless from a plant engineering perspective. In this case only a warning message is issued (b Err = TRUE, s Err Descr = warning message); the function block does not interrupt its cycle. Inputs VAR_INPUT e Pipe Sys : E_BA_Pipe Sys; e Medium : E_BA_Medium; b Dew Pnt : BOOL; f Rm T : REAL; f Sp Htg : REAL; f Sp Col : REAL; f Ctrl Val Htg : REAL; f Ctrl Val Col : REAL; n Chg Ovr Del : UDINT; END_VAR Name Type Description e Pipe Sys E_BA_Pipe Sys [} 267] Pipe system (2Pipe, 4Pipe) of the plant. e Medium E_BA_Medium [} 267] Selection of the medium for the entire two-pipe network (No Medium, Heat Medium, Cool Medium). b Dew Pnt BOOL Dew point sensor: if b Dew Pnt = FALSE, then the cooling controller is locked. f Rm T REAL Room temperature f Sp Htg REAL Calculated setpoint of the supply air temperature for the heater. f Sp Col REAL Calculated setpoint of the supply air temperature for the cooler. f Ctrl Val Htg REAL Current output value of the heating controller. Used internally as switching criterion from heating to cooling: f Ctrl Val Htg must be 0. f Ctrl Val Col REAL Current output value of the cooling controller. Used internally as switching criterion from cooling to heating: f Ctrl Val Col must be 0. n Chg Ovr Del UDINT Switchover delay [s] from heating to cooling or vice versa. Internally limited to a minimum value of 0. Outputs VAR_OUTPUT b En Htg : BOOL; b En Col : BOOL; e Reqd Medium : E_BA_Medium; n Rem Ti Chg Ovr Dly Htg : UDINT; n Rem Ti Chg Ovr Dly Col : UDINT; b Err : BOOL; s Err Descr : T_MAXSTRING; END_VAR TF8040 Version: 1.14.0 301
## Page 302

Programming Name Type Description b En Htg BOOL Heating controller enable. b En Col BOOL Cooling controller enable. e Reqd Medium E_BA_Medium [} 267] Requested medium (see Determination of needs). n Rem Ti Chg Ovr Dly H UDINT Countdown [s] for switchover delay from cooling to tg heating. n Rem Ti Chg Ovr Dly C UDINT Countdown [s] for switchover delay from heating to ol cooling. b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description Error description 01: Warning: The setpoint Heating is higher than or equal to the setpoint Cooling Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.1.2 FB_BA_Rm TAdj The function block FB_BA_Rm TAdj is used for user adjustment of the room temperature setpoint. It shifts the setpoints at the input of a function block depending on an offset r Rm TAdj, as shown in the following diagram. At the input f Rm TAdj, the value of a resistance potentiometer or a bus-compatible field device, for example, can be used for the setpoint correction. 302 Version: 1.14.0 TF8040
## Page 303

Programming If the set value f Rm TAdj is greater than zero, room temperature heating is desired: The Comfort Heating value is raised by the value f Rm TAdj. At the same time, the values for Comfort Cooling and Pre Comfort Cooling are increased. If the value r Rm TAdj is less than zero, a lower room temperature is requested. Analogous to the heating case, the values for Comfort Cooling, Comfort Heating and Pre Comfort Heating are now reduced by the value r Rm TAdj. Auto-correction The temperature adjustment is intended for small corrections of the values. Although it is possible to enter any input values, a heating system will only work in a meaningful manner if the setpoints have ascending values in the following order: TF8040 Version: 1.14.0 303
## Page 304

Programming • Protection Heating • Economy Heating • Precomfort Heating • Comfort Heating • Comfort Cooling • Precomfort Cooling • Economy Cooling • Protection Cooling Auto-correction works according to the following principle: Starting with the value Economy Heating, the system checks whether this value is smaller than the lower value of Protection Heating. If this is the case, the value for Economy Heating is adjusted to match the value for Protection Heating. The system then checks whether the value for Precomfort Heating is less than Economy Heating and so on, until the value for Protection Cooling is compared with the value for Economy Cooling. If one or several values were corrected, this is indicated with a TRUE signal at output b Val Corr. Inputs VAR_INPUT f Rm TAdj : REAL; st Sp : ST_BA_Sp Rm T; END_VAR Name Type Description f Rm TAdj REAL Room temperature offset value. st Sp ST_BA_Sp Rm T [} 272] Input structure for the setpoints. Outputs VAR_OUTPUT b Val Corr : BOOL; f Pr Prtc Htg : REAL; f Pr Eco Htg : REAL; f Pr Pre Cmf Htg : REAL; f Pr Cmf Htg : REAL; f Pr Prtc Col : REAL; f Pr Eco Col : REAL; f Pr Pre Cmf Col : REAL; f Pr Cmf Col : REAL; st Pr Sp : ST_BA_Sp Rm T; END_VAR Name Type Description b Val Corr BOOL Autocorrection for the values was performed, see above. f Pr Prtc Htg REAL Resulting "Protection Heating" setpoint. f Pr Eco Htg REAL Resulting setpoint "Economy Heating". f Pr Pre Cmf Htg REAL Resulting setpoint "Pre Comfort Heating". f Pr Cmf Col REAL Resulting setpoint "Comfort Cooling". f Pr Pre Cmf Col REAL Resulting setpoint "Pre Comfort Cooling". f Pr Eco Col REAL Resulting setpoint Economy Cooling. f Pr Prtc Col REAL Resulting setpoint "Protection Cooling". st Pr Sp ST_BA_Sp Rm T [} 272] Consolidated output of the resulting values in a structure. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 304 Version: 1.14.0 TF8040
## Page 305

Programming 6.1.2.2.3.1.3.1.3 FB_BA_Sp Rm T The function block FB_BA_Sp Rm T assigns setpoints for cooling and heating operation to each of the energy levels Protection, Economy, Pre Comfort and Comfort. The following graphics illustrates the behavior of the function block; the entered values should be regarded as examples: TF8040 Version: 1.14.0 305
## Page 306

Programming The parameter f Shift Htg is applied to the Comfort and Precomfort values for the heating mode as central setpoint shift. In addition, winter compensation f Win Cpsn is applied. Similarly, the following applies for the cooling mode: The parameter f Shift Col is applied to the Comfort and Precomfort values. In addition, the summer compensation value f Sum Cpsn is applied. 306 Version: 1.14.0 TF8040
## Page 307

Programming Auto-correction The temperature adjustment is intended for small corrections of the values. Although it is possible to enter any input values, a heating system will only work in a meaningful manner if the setpoints have ascending values in the following order: • Protection Heating • Economy Heating • Precomfort Heating • Comfort Heating • Comfort Cooling • Precomfort Cooling • Economy Cooling • Protection Cooling Auto-correction works according to the following principle: Starting with the value Economy Heating, the system checks whether this value is smaller than the lower value of Protection Heating. If this is the case, the value for Economy Heating is adjusted to match the value for Protection Heating. The system then checks whether the value for Precomfort Heating is less than Economy Heating and so on, until the value for Protection Cooling is compared with the value for Economy Cooling. If one or several values were corrected, this is indicated with a TRUE signal at output b Val Corr. Inputs VAR_INPUT f Prtc Htg : REAL; f Eco Htg : REAL; f Pre Cmf Htg : REAL; f Cmf Htg : REAL; f Cmf Col : REAL; f Pre Cmf Col : REAL; f Eco Col : REAL; f Prtc Col : REAL; f Shift Htg : REAL; f Shift Col : REAL; f Sum Cpsn : REAL; f Wr Win Cpsn : REAL; END_VAR Name Type Description f Prtc Htg REAL Basic setpoint "Protection Heating". f Eco Htg REAL Basic setpoint "Economy Heating". f Pre Cmf Htg REAL Basic setpoint "Pre Comfort Heating". f Cmf Htg REAL Basic setpoint "Comfort Heating". f Cmf Col REAL Basic setpoint "Comfort Cooling". f Pre Cmf Col REAL Basic setpoint "Pre Comfort Cooling". f Eco Co REAL Basic setpoint "Economy Cooling". f Prtc Col REAL Basic setpoint "Protection Cooling". f Shift Htg REAL Setpoint value shift "Heating". f Shift Col REAL Setpoint value shift "Cooling". f Sum Cpsn REAL Value Summer compensation. f Win Cpsn REAL Value Winter compensation. Outputs VAR_OUTPUT b Val Corr : BOOL; f Pr Prtc Htg : REAL; f Pr Eco Htg : REAL; f Pr Pre Cmf Htg : REAL; f Pr Cmf Htg : REAL; f Pr Cmf Col : REAL; TF8040 Version: 1.14.0 307
## Page 308

Programming f Pr Pre Cmf Col : REAL; f Pr Eco Col : REAL; f Pr Prtc Col : REAL; st Pr Sp : ST_BA_Sp Rm T; END_VAR Name Type Description b Val Corr BOOL Autocorrection for the values was performed, see above. f Pr Prtc Htg REAL Resulting "Protection Heating" setpoint. f Pr Eco Htg REAL Resulting setpoint "Economy Heating". f Pr Pre Cmf Htg REAL Resulting setpoint "Pre Comfort Heating". f Pr Cmf Col REAL Resulting setpoint "Comfort Cooling". f Pr Pre Cmf Col REAL Resulting setpoint "Pre Comfort Cooling". f Pr Eco Col REAL Resulting setpoint Economy Cooling. f Pr Prtc Col REAL Resulting setpoint "Protection Cooling". st Pr Sp ST_BA_Sp Rm T [} 272] Consolidated output of the resulting values in a structure. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.2 Lighting 6.1.2.2.3.1.3.2.1 FB_BA_Light Actr Analog The function block FB_BA_Light Actr Analog is used to control an analog light actuator. The output is in 0...100% and converted accordingly in 0...32767 (positive integer range). The function block is thus suitable for use with the dimmer terminals (e.g. KL2751, KL2761). Function If the function block is not enabled (b En = FALSE ) the outputs f Actl Lgt Val = 0 and i Actl Lgt Val = 0. In the enabled state the light brightness value of the input telegram (st Lighting Cmd.f Lgt Val) is passed directly to the output f Actl Lgt Val. The same value multiplied by 327.65 is given to the output i Actl Lgt Val. Inputs VAR_INPUT b En : BOOL; st Lighting Cmd : ST_BA_Lighting; END_VAR Name Type Description b En BOOL Enabling the function block and activation of the function. st Lighting Cmd ST_BA_Lighting [} 272] Light control telegram Outputs VAR_OUTPUT i Actl Lgt Val : INT; f Actl Lgt Val : REAL;; END_VAR 308 Version: 1.14.0 TF8040
## Page 309

Programming Name Type Description i Actl Lgt Val INT Current light value in positive integer range (0...32767). f Actl Lgt Val REAL Current light value in percent [%]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.2.2 FB_BA_Lighting Evt The function block FB_BA_Lighting Evt is used to set the light value and the color temperature at any event. It can be used, for example, to switch the lights during the night watchman tour or for building cleaning. If the function block is enabled via the input b En, the active flag in the light control telegram (b Actv in st Lighting) is set at output st Lighting. The values entered at the input variables f Lgt Val for the light value [%] and f Lgt T for the light temperature [K] are passed on in this telegram. If the function is no longer active by resetting b En, the active flag in the light control telegram st Lighting is reset and the values for brightness and color temperature are set to "0". With a telegram selection block (e.g. FB_BA_Lighting Tgm Sel8) a function of lower priority can take over the control by resetting. The priority (E_BA_Lighting Prio) of the output telegram can be defined via the parameter e Prio (VAR_INPUT CONSTANT PERSISTENT). It is preset to e Manual Actuator. Information about inherited elements The function block inherits from the internal base class FB_BA_Base Lighting Evt, which contains a telegram counter for determining the last command sent. Inputs VAR_INPUT b En : BOOL; f Lgt Val : REAL; f Lgt T : REAL; END_VAR Name Type Description b En BOOL A TRUE signal on this input activates the function block and transfers the entered setpoints together with the active flag in the light setting telegram ST_BA_Lighting [} 272]. A FALSE signal resets the active flag again and sets the light value to zero. f Lgt Val REAL Light value [%] f Lgt T REAL Light temperature [K] Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : E_BA_Lighting Prio := E_BA_Lighting Prio.e Scene1; END_VAR Name Type Description e Prio E_BA_Lighting Prio [} 268] Priority E_BA_Lighting Prio of the telegram, preset to e Scene1. TF8040 Version: 1.14.0 309
## Page 310

Programming Outputs VAR_OUTPUT st Lighting : ST_BA_Lighting; b Actv : BOOL; END_VAR Name Type Description st Lighting ST_BA_Lighting [} 272] Light setting telegram b Actv BOOL Active Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.2.3 FB_BA_Lighting Tgm Sel8 / FB_BA_Lighting Tgm Sel4 The function of the blocks is explained at FB_BA_Lighting Tgm Sel8 as an example The function blocks are used for priority control for up to 4 or up to 8 lighting control telegrams (st Lighting_Prio1 ... st Lighting_Prio4, or st Lighting_Prio1 ... st Lighting_Prio8) of type ST_BA_Lighting. The active telegram with the highest priority is output at the output st Lighting. "Active" means that the variable b Actv is set within the structure of the positioning telegram. The priority is stored within the telegram structure as e Prio, whereby the lower the value of e Prio, the higher the priority. For telegrams with the same priority, the last changed one (last writer wins) is valid, determined by the variable n Evt Inc. This function block is to be programmed in such a way that one of the applied telegrams is always active. If a telegram is not active, an empty telegram is output at the output, i.e. f Lgt Val = 0, f Lgt T = 0, b Dim Up = FALSE, b Dim Dwn = FALSE, b Dim Mod = FALSE, b Actv = FALSE. Inputs VAR_INPUT st Lighting Tgm_1 : ST_BA_Lighting; st Lighting Tgm_2 : ST_BA_Lighting; st Lighting Tgm_3 : ST_BA_Lighting; st Lighting Tgm_4 : ST_BA_Lighting; st Lighting Tgm_5 : ST_BA_Lighting; st Lighting Tgm_6 : ST_BA_Lighting; st Lighting Tgm_7 : ST_BA_Lighting; st Lighting Tgm_8 : ST_BA_Lighting; END_VAR Name Type Description st Lighting Tgm_N ST_BA_Lighting [} 272] Telegram inputs 310 Version: 1.14.0 TF8040
## Page 311

Programming Outputs VAR_OUTPUT st Lighting : ST_BA_Lighting; n Num Actv Tgm : UINT; e Prio Actv Tgm : E_BA_Lighting Prio; END_VAR Name Type Description st Lighting ST_BA_Lighting [} 272] Resulting telegram n Num Actv Tgm UINT Indicates which input results, e.g. if st Lighting Tgm_3 is passed, n Num Actv Tgm = 3. If n Num Actv Tgm = 0, no telegram is active. e Prio Actv Tgm E_BA_Lighting Prio [} 268] This output indicates the priority of the active telegram. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.2.4 FB_BA_Light Ctrl The function block is a universal block for the implementation of various lighting functions. It is used to control one or more lights. It enables the illumination to be controlled manually via a switch or room control unit or the automatic control of a lighting group by means of presence detection. By connecting the function block accordingly, it can be used for the following functions: • Automatic light presence-dependent • Manual switching of illumination with dimming function • Combination of automatic light via presence and manual control. Automatic illumination via presence can be combined with manual operation of the illumination via the inputs b Swi, b Swi Up, b Swi Dwn, b On, b Off. The last state change of one of the inputs mentioned is then valid. If the illumination is switched on via presence detection at the input b Prc, the illumination can be switched off or changed via the inputs b Swi, b Swi Up or b Swi Dwn. The manual intervention is valid until a falling edge at b Prc. If there is another rising edge at the input b Prc, the illumination is switched on again in automatic mode. TF8040 Version: 1.14.0 311
## Page 312

Programming However, the illumination is only switched on automatically via b Prc if the automatic lighting system is in fully automatic mode. However, the illumination is only switched on automatically via b Prc if the automatic lighting system is in fully automatic mode. If the current control value of the illumination is the result of manual operation, the function block is in manual mode. This is displayed at the b Manual Mode output. If the current control value of the illumination is the result of a positive or negative edge at input b Prc, the illumination is in automatic mode b Automatic Mode = TRUE. The current control value for the lighting group is output at output f Out from 0% to 100%. Inputs VAR_INPUT b Swi : BOOL; b Swi Up : BOOL; b Swi Dwn : BOOL; b On : BOOL; b Off : BOOL; f Set Val : REAL; b Set Val : BOOL; b Rst : BOOL; b Prc : BOOL; n Swi Ovr Ti : UDINT := 250; n Swi Ti : UDINT := 2; n Dim Ti : UDINT := 5; n Pre Off Ramp Ti : UDINT := 10; f On Val : REAL := 100; f Pre Off Val : REAL := 20; n Pre Off Dly : UDINT := 20; b Mem Mod : BOOL; e Lgt Act Mod : E_BA_Light Activation Mode; f Ref Lgt Val : REAL := -1; END_VAR 312 Version: 1.14.0 TF8040
## Page 313

Programming Name Type Description b Swi BOOL A short press of the button at the input deactivates the illumination if it is currently switched on. If the illumination is off, it is switched on by a short press of the button. A long press of the button causes the lights in the light group to brighten or dim. b Swi Up BOOL A short press of the button switches the illumination on. A long press of the button will cause the lights to become brighter. b Swi Dwn BOOL A short press of the button switches the illumination off. A long press of the button dims the lights. b On BOOL Regardless of the current state of the illumination, the light is switched to 100% by an edge at the input. b Off BOOL Regardless of the current state of the illumination, the light is switched to 0% by an edge at the input. f Set Val REAL Manual pre-set value. The value at the input f Set Val is taken over as light output value by a rising edge at b Set Val. b Set Val BOOL Takeover of the manual preset value. b Rst BOOL This input resets the manual and automatic operation of the function block. This switches off the illumination. The output f Out follows a switch-off ramp. See f Pre Off Val, n Pre Off Dly and n Pre Off Ramp T. b Prc BOOL Presence signal input. If the function block is in fully automatic mode, a rising edge can enable the function via this input and a falling edge can disable it. The light is switched on or off. In semi-automatic mode, only a falling edge at this input disables the function block. n Swi Ovr Ti UDINT Time [ms] for differentiating between short and long button presses. n Swi Ti UDINT Ramp for the switching functions in seconds, related to a dimming from 0 to 100%. n Dim Ti UDINT Ramp for the dimming functions in seconds, related to a dimming from 0 to 100%. n Pre Off Ramp Ti UDINT Ramp used to drive to a base value f Pre Off Val before switching off. f On Val REAL Switch-on value if the "Memory mode" option is not selected via the b Mem Mod input. f Pre Off Val / REAL / UDINT Base value and hold time at this value before switching off n Pre Off Dly the overall function. If the current light value already falls below the base value, this function is not active and it is switched off immediately. b Mem Mod BOOL Memory mode: When the light is switched on in manual mode, the light assumes the value that the function had before it was last switched off. If the "Memory-Mode" is not active, the switch-on value is defined via f On Val Man. e Lgt Act Mod E_BA_Light Activation Mod Activation mode of the light control function. e [} 267] Fully automatic: The light control function is activated by detected presence and deactivated by absence of presence. Button presses can also activate the function. Semi-automatic: Activation of the light control function only by pressing a button; it is automatically deactivated when not occupied. TF8040 Version: 1.14.0 313
## Page 314

Programming Name Type Description f Ref Lgt Val REAL Light value of a single light actuator representing the light zone. This input is used to assess whether in manual mode the next button press switches on or off, or from which value dimming is to take place. This input is pre-initialized with "-1". If it is not assigned, this is recognized and it is assumed that this function is the only one for controlling the lights. Thus, the output value f Out is used as the light value to assess the next switching actions. Outputs VAR_OUTPUT f Out : REAL; b Automatic Mode : BOOL; b Manual Mode : BOOL; END_VAR Name Type Description f Out REAL Light output value, 0...100%. b Automatic Mode BOOL The function block was activated via a rising edge at the presence input, which is only possible in "Fully automatic" activation mode. b Manual Mode BOOL The function block was activated or overridden by a button (b On, b Swi, b Swi Up, b Swi Dwn) or by setting to a value (f Set Val Man/b Set Val Man). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.2.5 FB_BA_Light Ctrl Value This function block is used to determine a switch-on value (0..100%) for constant light regulation so that it starts with a brightness close to the setpoint and the light does not have to be adjusted for a long time. Function The functions of this function block are only available if it is enabled with a TRUE signal at b En. Otherwise, the output f On Value assumes the default value at the input f On Val Default. If f On Val Default is not connected, it is set to 50 by initialization. Teach-in In the enabled state (b En = TRUE), the function block can be taught-in. A step sequence is started with a rising edge at b Teach. The light is first switched off via the light control telegram st Teach Lighting. Then wait for the time n Brtns Adj Ti in seconds so that the light sensor can correctly detect the lighting conditions. The brightness value that is read in via the input f Brtns is saved. The light is now set to 100% and n Brtns Adj Ti is waited for in seconds 314 Version: 1.14.0 TF8040
## Page 315

Programming again. The difference between the recorded brightness value and the stored value is the possible gain due to artificial light and is stored as a persistent output variable f Brtns Gain. The light value is set to 0 again at the end of the routine. The light control telegram st Teach Lighting is only active during this teach-in phase and has a high priority with e Prio := E_BA_Lighting Prio.e Maintenance over the manual or automatic commands that do not represent an alarm. This function block therefore fulfills the condition of being parallel to the constant light regulation - the respective telegrams can ultimately be routed via a priority switch. In addition, the b Teaching output is set during the teaching phase. This can be used to query light sensors that do not output a continuous signal more quickly, thereby shortening the teaching process. Principle of operation If the function block is enabled (b En = TRUE) and has been taught at least once so that the output value f Brtns Gain has assumed a value greater than zero, an input value f On Value is calculated continuously: The difference between the setpoint and actual value, f SP to f Brtns, is compared to the gain from the artificial light f Brtns Gain using the rule of three. This results in the necessary percentage brightness gain. This is added to the current light value present at the f Ref Lgt Val input. A function block that has not been taught in is recognized by the fact that the output f Brtns Gain is still at 0. In this case, the default value f On Val Default is output even if the function block is enabled (b En = TRUE). f Ref Lgt Val Light value of a single light actuator representing the light zone. With the actual brightness value and setpoint as well as the determined brightness gain f Brtns Gain, only the percentage increase required to start the constant light regulation close to the setpoint can be determined. If the current light value is known, the absolute switch-on value results from the sum. In most applications, the light value will be 0% before switching on. However, with lighting controllers using priorities, it is possible for a lighting group to be controlled by a lower priority before constant light regulation is switched on and is therefore already at a certain level. It is therefore important to know the current light control value. Inputs VAR_INPUT b En : BOOL; b Teach : BOOL; f Brtns : REAL; f SP : REAL; n Brtns Adj Ti : UDINT := 5; f On Val Default : REAL = 50; f Ref Lgt Val : REAL; END_VAR TF8040 Version: 1.14.0 315
## Page 316

Programming Name Type Description b En BOOL A TRUE signal at this input enables the function block. If the function block has not yet been taught in, i.e. the brightness gain determined at output f Brtns Gain is still 0, the default value f On Value is permanently assumed at output f On Val Default. This value is also set if the function block is not enabled (b En = FALSE). b Teach BOOL A rising edge at this input starts the teaching process. f Brtns REAL Input for the measured brightness value. f SP REAL Input for the brightness setpoint. n Brtns Adj Ti UDINT Waiting time in seconds that is waited during the teaching process after a light change in order to receive a correct value from the light sensor. f On Val Default REAL Standard output value [0..100%] that is passed through at output f On Val if the function block is either not enabled (b En = FALSE) or not taught-in (f Brtns Gain = 0). f Ref Lgt Val REAL Light value [%] of a single light actuator representing the light zone. Outputs VAR_OUTPUT f On Value : REAL; b Teaching : BOOL; st Teach Lighting : ST_BA_Lighting; END_VAR Name Type Description f On Value REAL Determined switch-on value. If the function block is not enabled or not taught-in, the default value f On Val Default is output here. b Teaching BOOL A TRUE signal at this output indicates that the teaching process is active. st Teach Lighting ST_BA_Lighting [} 272] Light control telegram with the pre-set priority E_BA_Lighting Prio.e Maintenance. Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : BYTE := E_BA_Lighting Prio.e Maintenance; END_VAR Name Type Description e Prio E_BA_Lighting Prio [} 268] Priority of the telegram, pre-set to E_BA_Lighting Prio.e Maintenance. PERSISTENT outputs VAR_OUTPUT PERSISTENT f Brtns Gain : REAL; END_VAR Name Type Description f Brtns Gain REAL Determined brightness gain. This value is related to the difference from a brightness (f Brtns) at a light value of 0% to a brightness at a light value of 100%. 316 Version: 1.14.0 TF8040
## Page 317

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.55 Tc3_BA2 from v5.3.19.0 6.1.2.2.3.1.3.2.6 FB_BA_Light Ctrl Const This function block is a constant light regulation with manual override. It can be in the following operating states as described in VDI 3813 sheet 2: • Disabled: Outputs b Control Mode = FALSE and b Manual Mode = FALSE • Control mode: Outputs b Control Mode = TRUE and b Manual Mode = FALSE • Manual override: Outputs b Control Mode = FALSE and b Manual Mode = TRUE In the active states (control mode, manual override), the light output value f Out can assume any values from 0...100 %, in the non-active state it is fixed at 0 %. The distinction between "active" and "not active" is important when several light control functions access actuators in alternation. This makes the function block suitable for interaction with other lighting functions in a priority selection in which the output f Out is regarded as a valid control value depending on the operating status outputs. The light control function works with an input for the brightness state of a reference lamp due to the possible interaction with other light control functions. If several lighting functions control the same lamp or the same lighting group independently of each other by priority control, the function block does not know whether it is the active one. With the help of the reference input, however, it is always possible to synchronize to the current value before each switching action and to assess before a toggle action whether the light should be switched on or off in the next step. If it is ensured that the function is the only one that controls the light, the input is not to be assigned. It is pre- initialized with the value -1, which indicates to the function block that the input is not linked. TF8040 Version: 1.14.0 317
## Page 318

Programming However, this also means that it is not possible to delete an input link online without distorting the functioning of the function block! Function From the non-activated state, this function block operates in two steps: Short button presses at b Swi, b Swi Up or b Swi Down as well as rising edges at b On, b Set Ctrl Mod or b Prc initially switch the function to control mode. However, the presence signal input b Prc is only active in full automatic mode. The operation mode fully automatic or semi-automatic can be parameterized at the input (e Mode [} 267]). Switch-on behavior The light control is first switched to the value f On Val Ctrl. The switching of the light takes place with a ramp, which is specified at n Swi Ti in seconds related to 0...100%. If the selected light value is reached, the control remains at this value for the time n Brtns Adj Ti [s] so that the light sensor detects the correct value. Already during this waiting time, the function can be switched to manual override. Control behavior The control now attempts to maintain this setpoint: If the daylight incidence increases, the light control value at the output f Out is reduced. If the total brightness becomes weaker, the light control value is increased. The change also follows a ramp, which is specified at n Ramp Ti in seconds related to 0...100%. The constant light control is a simple I-controller. To prevent the ramp block from constantly specifying new light values, a hysteresis range can be specified at the f Hys input. The constant light regulation controls the output up or down until the measured brightness reaches or slightly exceeds or falls below the target value. The light is then considered as adjusted. Only when the measured brightness exceeds or falls below the setpoint by f Hys/2, it is readjusted again. The range and unit of the hysteresis depend on the light sensor. Minimum value of the control Changes in the lower brightness range are often perceived as annoying. It can therefore be useful to limit the light control to a minimum control value and then switch off the light completely when the outdoor brightness is very high. If the control has reached its minimum control value f Min Val and is to regulate down further, it remains at the minimum value for the time n Off Dly [s] and then switches to the output value 0. The measured brightness value is stored before and after switching. The difference resulting from this is the brightness gain by switching on to the minimum value. The new threshold for switching on again is now the control setpoint minus the brightness gain. If the measured brightness reaches or falls below this threshold value for the time n On Dly [s], the light is switched on again and then controlled to the setpoint. The choice of this threshold value is illustrated in the following diagram: 318 Version: 1.14.0 TF8040
## Page 319

Programming 1. The measured brightness f Brtns initially moves within the tolerance limits around the setpoint f SP. Towards the end of this phase, the brightness exceeds the tolerance range. 2. The light control dims the light (control value f Out) until the light setpoint is reached or the light level falls just below in the PLC cycle. The measured light value f Brtns can therefore be slightly below the setpoint, but this is accepted in order to avoid continuous readjustment. 3. The measured brightness f Brtns is again within the tolerance limits, as in phase 1. 4. It is controlled again, this time to the minimum output control value, which brings the total measured brightness back into the tolerance range. 5. The measured brightness increases again due to outdoor brightness and exceeds the tolerance range. 6. The measured brightness f Brtns remains above the tolerance range, the internal time n Off Dly [s] expires. 7. The light is switched off (f Out = 0). The difference between the measured brightness before and after switching off is recorded internally as a brightness gain by switching on the light to the minimum control value. The new threshold that must now be undershot is the control setpoint minus the brightness gain. The choice of this threshold is based on the following considerations: • Switching the light on again must not result in the measured brightness subsequently being above the tolerance range again, as this could result in the light continuously being switched on and off. • This threshold is realistic, i.e. > 0: at the start of phase 5, the outdoor brightness was already so high that the control was set to the minimum value. Before the light is switched off in phase 7, more outdoor brightness was added. In the diagram it is clear that the new threshold is reached when the increase in outdoor brightness from the start of phase 5 to the end of phase 6 has passed again – a realistic scene. To be on the safe side, however, an internal check is made not only for falling below the threshold value but also for reaching it (less than or equal to). 1. The threshold value is undershot for the time n On Dly [s]. 2. The light is again first switched to the minimum value and then dimmed up until the measured brightness corresponds to the setpoint f SP. 3. The measured brightness f Brtns is again within the tolerance limits around the setpoint f SP. Manual override From the control mode the following actions let the function change to the manual mode (outputs b Control Mode = FALSE and b Manual Mode = TRUE): • Short button presses at the inputs b Swi, b Swi Up and b Swi Dwn switch the light on and off alternately. • With b On and b Off, targeted switching on or off occurs. TF8040 Version: 1.14.0 319
## Page 320

Programming • A long button press at the input b Swi alternately dims the light up and down. Dimming takes place via a ramp, which is specified at n Dim Ti in seconds related to 0...100%. • A long button press on the input b Swi Up dims the light up specifically. Dimming takes place via a ramp, which is specified at n Dim Ti in seconds related to 0...100%. • A long button press at the input b Swi Dwn dims the light down specifically. Dimming takes place via a ramp, which is specified at n Dim Ti in seconds related to 0...100%. • A change to the input f Set Val Man. This value is then adopted as the new light output value. "Off" in manual mode means that the overall function is still active! A positive edge at b Rst Man Mod or b Set Ctrl Mod switches from manual override back to control mode. Memory mode If memory mode is enabled at input b Mem Mod, the value that the function block had before the last manual switch-off is stored internally. This value is then adopted the next time the system is switched on in manual mode. If memory mode is disabled, switching on in manual mode always takes place with the value f On Val Man. Disabling the function From control mode or manual mode, two events cause the function to change to the disabled state (outputs b Control Mode = FALSE and b Manual Mode = FALSE): • a falling edge at the input b Prc. • a TRUE signal at input b Rst. This input is intended for central deactivation of the function block or in case there is no occupancy sensor. On deactivation, a ramp n Pre Off Ramp Ti (in seconds related to 100% to 0%) is used to dim down to a base value f Pre Off Val. This value represents the time n Pre Off Dly [s] at the output before switching off. The function block is then deactivated. During the switch-off phase, the function block can be enabled again to return to normal operation. Enabling takes place via short button presses on b Swi, b Swi Up or b Swi Down and rising edges on b On or b Prc. However, the presence signal input b Prc is only active in full automatic mode. If the light output value before deactivation is already smaller than the mentioned base value, the switch-off routine is skipped and switched off immediately. Inputs VAR_INPUT b Swi : BOOL; b Swi Up : BOOL; b Swi Dwn : BOOL; b On : BOOL; b Off : BOOL; f Set Val Man : REAL; b Set Val Man : BOOL; b Set Ctrl Mod : BOOL; b Rst Man Mod : BOOL; b Rst : BOOL; b Prc : BOOL; f Brtns : REAL; f SP : REAL; f Hys : REAL := 50; n Swi Ovr Ti : UDINT := 250; n Swi Ti : UDINT := 2; n Dim Ti : UDINT := 5; n Ramp Ti : UDINT := 60; n Pre Off Ramp Ti : UDINT := 10; n Brtns Adj Ti : UDINT := 5; f On Val Ctrl : REAL := 50; f On Val Man : REAL := 100; f Pre Off Val : REAL := 20; n Pre Off Dly : UDINT := 20; 320 Version: 1.14.0 TF8040
## Page 321

Programming f Min Val : REAL; n Min Off Dly : UDINT := 300; n Min On Dly : UDINT := 300; b Mem Mod : BOOL; e Lgt Act Mod : E_BA_Light Activation Mode; f Ref Lgt Val : REAL := -1; END_VAR TF8040 Version: 1.14.0 321
## Page 322

Programming Name Type Description b Swi BOOL If the constant light control function block is not yet active, a short button press first switches the control on, then further signals cause the function block to switch to the manual mode and the following applies: short button press: on / off, long button press: alternately dimming up or down. b Swi Up BOOL If the constant light control function block is not yet active, a short button press first switches the control on, then further signals cause the function block to switch to the manual mode and the following applies: short button press: on / off, long button press: selective dimming up. b Swi Dwn BOOL If the constant light control function block is not yet active, a short button press first switches the control on, then further signals cause the function block to switch to the manual mode and the following applies: short button press: on / off, long button press: selective dimming down. b On BOOL If the constant light control function block is not yet active, a TRUE signal first switches on the control, then this input only refers to switching on in manual mode. b Off BOOL Switches the light off, the constant light control function block is still in manual mode. If the constant light control function block was previously in control mode, it is now in manual mode. f Set Val Man REAL Manual pre-set value. The values at input f Set Val Man are adopted as the light output value by a rising edge at b Set Val Man. When the function block is set, it switches directly to manual mode, regardless of whether it was previously in control mode or in the disabled state. b Set Val Man BOOL Adoption of the manual pre-set value, see f Set Val Man. b Set Ctrl Mod BOOL A rising edge puts the function block directly into control mode, regardless of whether it was previously in the deactivated state or in manual mode. b Rst Man Mod BOOL This input allows the constant light control function block to switch back to automatic mode if it is in manual mode. b Rst BOOL This input switches off the constant light control function block. The shutdown is done by ramping and dwell time on a base light value, see below: f Pre Off Val, n Pre Off Dly and n Pre Off Ramp T. b Prc BOOL Presence signal input. If the constant light control function block is configured in fully automatic mode, a rising edge can activate the function via this input if it was not previously activated and a falling edge can disable it. In semi-automatic mode, only a falling edge at this input disables the constant light function block. "Activating" here means that the function is switched on in manual mode (outputs b Control Mode = TRUE and b Manual Mode = FALSE). Deactivating means: the function is not active in manual or control mode (outputs b Control Mode = FALSE and b Manual Mode = FALSE). f Brtns REAL Current brightness for constant light automatic: Range and unit depend on the light sensor. f SP REAL Brightness setpoint for the constant light automatic: An adjustment with f Brtns Sen is aimed at. The range and unit therefore depend on the light sensor. 322 Version: 1.14.0 TF8040
## Page 323

Programming Name Type Description f Hys REAL Constant light automatic: Hysteresis band. The constant light regulation controls the output up or down until the measured brightness reaches or slightly exceeds or falls below the target value. The light is then considered as adjusted. Only when the measured brightness exceeds or falls below the setpoint by f Hys/2, it is readjusted again. The range and unit depend on the used light sensor, see above: f Brtns SP and f Brtns Sen. n Swi Ovr Ti UDINT Time [ms] for differentiating between short and long button presses. n Swi Ti UDINT Ramp for the switching functions in seconds, related to a dimming from 0 to 100%. n Dim Ti UDINT Ramp for the dimming functions in seconds, related to a dimming from 0 to 100%. n Ramp Ti UDINT Control ramp of the constant light automatic in seconds, related to a dimming from 0 to 100%. n Pre Off Ramp Ti UDINT Ramp used to drive to a base value f Pre Off Val before switching off. n Brtns Adj Ti UDINT Waiting time [s] after switching on the light for the light sensor to detect the correct value. f On Val Ctrl REAL Switch-on value for control operation, this should be activated with the function previously switched off. f On Val Man REAL Switch-on value of the manual function, if "Memory mode" is not selected via the parameter e Operational Mode. f Pre Off Val / REAL / UDINT Base value and hold time at this value before switching off n Pre Off Dly the overall function. If the current light value already falls below the base value, this function is not active and it is switched off immediately. f Min Val REAL Constant light automatic: Minimum output value. If this value has fallen below internally (i.e. it is bright enough that no artificial light is needed), the constant light regulation switches the light off after n Off Dly [s] has elapsed. If the light is switched off and the controller detects a light demand above the minimum value again, the controller switches the light on again after n On Dly [s] to initially f Min Val. n Min Off Dly UDINT Constant light automatic: Switch-off waiting time in seconds, see f Min Val. n Min On Dly UDINT Constant light automatic: Switch-on waiting time in seconds, see f Min Val. b Mem Mod BOOL Memory mode: When the light is switched on in manual mode, the light assumes the value that the function had before it was last switched off. If the "Memory-Mode" is not active, the switch-on value is defined via f On Val Man. e Lgt Act Mod E_BA_Light Activation Mod Activation mode of the light control function. e [} 267] Fully automatic: The light control function is activated by detected presence and deactivated by absence of presence. Button presses can also activate the function. Semi-automatic: Activation of the light control function only by pressing a button; it is automatically deactivated when not occupied. TF8040 Version: 1.14.0 323
## Page 324

Programming Name Type Description f Ref Lgt Val REAL Light value of a single light actuator representing the light zone. This input is used to assess whether in manual mode the next button press switches on or off, or from which value dimming is to take place. This input is pre-initialized with "-1". If it is not assigned, this is recognized and it is assumed that this function is the only one for controlling the lights. Thus, the output value f Out is used as the light value to assess the next switching actions. Outputs VAR_OUTPUT f Out : REAL; b Control Mode : BOOL; b Manual Mode : BOOL; b Adjusting : BOOL; n Rem Timin Off : UDINT; n Rem Timin On : UDINT; END_VAR Name Type Description f Out REAL Light output value, 0...100%. b Control Mode BOOL Indicates whether the function block is operating in control mode. b Manual Mode BOOL Indicates whether or not the function block is working. b Adjusting BOOL The constant light control function block is in regulation mode. This signal can be used to query light sensors, which do not operate in analog mode but via communication, more frequently and thus achieve a more favorable control behavior. n Rem Ti Min Off UDINT Control output: The control output is at the minimum value and the timer runs until switching to "0%". This output shows the remaining seconds. n Rem Ti Min On UDINT Control output: The constant light regulation has switched off the light due to sufficient ambient light, but now light is required again and the timer runs down until it is switched on again. This output shows the remaining seconds. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.55 Tc3_BA2 from v5.3.19.0 324 Version: 1.14.0 TF8040
## Page 325

Programming 6.1.2.2.3.1.3.3 Sun Protection 6.1.2.2.3.1.3.3.1 Overview of shading correction 6.1.2.2.3.1.3.3.2 Shading correction: Basic principles and definitions The shading correction can be used in conjunction with the automatic sun function or lamella setpoint tracing. The function checks whether a window or a window group that is assigned to a room, for example, is temporarily placed in the shade by surrounding buildings or parts of its own building. Sun protection for windows that stand in the shadow of surrounding buildings or trees is not necessary and may even be disturbing under certain circumstances. On the basis of data entered regarding the facade and its TF8040 Version: 1.14.0 325
## Page 326

Programming surroundings, the shading correction determines which parts of the front are in the shade. Hence, it is then possible to decide whether the sun protection should be active for individual windows or window groups. Apart from the current position of the sun, the shading of the individual windows depends on three things: • the orientation of the facade • the position of the windows • the positioning of the shading objects The following illustrations are intended to describe these interrelationships and to present the parameters to be entered. Orientation of the facade Observation from above A two-dimensional coordinate system is required for observing the shadow cast on the facade, which is why the x- and y-axis were placed on the facade. The zero point is thereby at the bottom left on the base, as if one were regarding the facade from the front. For the calculation of the shading objects the Z component is then also added. Its axis points from away the facade and has the same zero point as the X and Y axis. In the northern hemisphere, the horizontal sun position (azimuth angle) is determined from the north direction by definition. The facade orientation is likewise related to north, wherein the following applies to the line of sight from a window in the facade: Line of sight Facade orientation North β=0° East β=90° South β=180° West β=270° In the southern hemisphere is the sun path is reversed: Although it also rises in the east, ad midday it is in the north. The facade orientation is adjusted to this path: Line of sight Facade orientation South β=0° East β=90° North β=180° West β=270° For convenience, the other explanations refer to the northern hemisphere. The calculations for the southern hemisphere are analogous. When the function block FB_BA_Shd Corr [} 585] (shading correction) is parameterized they are activated through a boolean input, b South The following two illustrations are intended to further clarify the position of the point of origin P as well as the 0 orientation of the coordinate system: 326 Version: 1.14.0 TF8040
## Page 327

Programming Observation from the side The angle of elevation (height of the sun) can be represented using this illustration: by definition this is 0° at sunrise (horizontal incidence of light) and can reach maximally 90°, but this applies only to places within the Tropic of Cancer and the Tropic of Capricorn. Observation from the front Here, the position of the point of origin, P , at the bottom left base point of the facade is once more very 0 clear. Beyond that the X-Y orientation is illustrated, which is important later for the entry of the window elements. Position of the windows The position of the windows is defined by the specification of their bottom left corner in relation to the facade coordinate system. Since a window lies flat on the facade, the entry is restricted to the X and Y coordinates. TF8040 Version: 1.14.0 327
## Page 328

Programming In addition, the window width and the window height have to be specified. The position of each window corner on the facade is determined internally from the values entered. A window is considered to be in the shade if all corners lie in the shade. Positioning of the shading objects When describing the shading objects, distinction is made between angular objects (building, column) and objects that are approximately spherical (e.g. trees). Angular objects can be subdivided into square shadow- casting facades according to their shadows, noting which cast the main shadow throughout the day: 328 Version: 1.14.0 TF8040
## Page 329

Programming Morning/noon In the morning and around noon, the shadow is mainly cast by the sides S and S . S and S do not have to 1 4 2 3 be considered, unless they are higher. TF8040 Version: 1.14.0 329
## Page 330

Programming Afternoon/evening In the afternoon and evening, the total shade can be determined solely through S and S . In this case it is 1 2 therefore sufficient to specify S S and S as shadow casters. The entry is made on the basis of the four 1, 2 4 corners or their coordinates in relation to the zero point of the facade: In this sketch only the upper points, P and P , are illustrated due to the plan view. The lower point P lies 2 3 1 underneath P and P lies underneath P . 2 4 3 330 Version: 1.14.0 TF8040
## Page 331

Programming The input of shadow-casting ball elements is done by entering the center of the ball and its radius: Ball elements A "classification" of the ball element as in the case of the angular building is of course unnecessary, since the shadow cast by a ball changes only its direction, but not its size. TF8040 Version: 1.14.0 331
## Page 332

Programming 6.1.2.2.3.1.3.3.3 Overview of automatic sun protection 332 Version: 1.14.0 TF8040
## Page 333

Programming 6.1.2.2.3.1.3.3.4 Sun protection: Basic principles and definitions The direct incidence of daylight is regarded as disturbing by persons in rooms. On the other hand, however, people perceive natural light to be more pleasant in comparison with artificial light. Two options for glare protection are to be presented here: • Slat adjustment • Height adjustment Lamella setpoint tracing A blind with lamellas that can be adjusted offers the option of intelligent sun protection here. The position of the lamellas is cyclically adapted to the current position of the sun, so that no direct daylight enters through the blinds, but as much diffuse daylight can be utilized as possible. The illustration shows that diffuse light can still enter from underneath, whereas no further direct daylight, or theoretically only a single ray, can enter. The following parameters are necessary for the calculation of the lamella angle: • the current sun elevation (elevation angle) • the sun position, i.e. the azimuth angle • the facade orientation • the lamella width • the lamella spacing Effective elevation angle If the blind is viewed in section as above, the angle of incidence does not depend solely on the sun elevation, but also on the direction of the sun: • If the facade orientation and the sun position (azimuth) are the same, i.e. the sunlight falls directly onto the facade, the effective light incidence angle is the same as the current elevation angle. • However, if the sunlight falls at an angle onto the facade as seen from the sun direction, the effective angle is larger for the same elevation angle. This relationship can easily be illustrated with a set square positioned upright on the table: Viewed directly from the side you can see a triangle with two 45° angles and one 90° angle. If the triangle is rotated, the side on the table appears to become shorter and the two original 45° angles change. The triangle appears to be getting steeper. We therefore refer to the "effective elevation angle", which describes the proportion of light that falls directly onto the blind. The following three images illustrate the relationship between the effective elevation angle and the blind dimensions, and how the resulting lamella angle λ changes during the day: TF8040 Version: 1.14.0 333
## Page 334

Programming More detailed information on this topic can be found in the chapter Effective elevation angle [} 338]. 334 Version: 1.14.0 TF8040
## Page 335

Programming Height adjustment With a high position of the sun at midday, the direct rays of sunlight do not penetrate into the full depth of the room. If direct rays of sunlight in the area of the window sill are regarded as uncritical, the height of the sun protection can be adapted automatically in such a way that the rays of sunlight only ever penetrate into the room up to an uncritical depth. In order to be able to calculate at any time the appropriate blind height that guarantees that the incidence of sunlight does not exceed a certain value, the following values are necessary. Required for the calculation of the respective blind height: • Height of the sun (elevation) • Window height • Distance between the window and the floor The following illustration shows where these parameters are to be classified: TF8040 Version: 1.14.0 335
## Page 336

Programming Influence of the facade inclination In both of the methods of sun protection described, it was assumed that the facade and thus the windows are perpendicular to the ground. In the case of an inclined facade, however, the incidence of light changes such that this influence will also be taken into account. The facade inclination is defined as follows: 336 Version: 1.14.0 TF8040
## Page 337

Programming TF8040 Version: 1.14.0 337
## Page 338

Programming 6.1.2.2.3.1.3.3.4.1 Effective elevation angle This chapter describes the relationship between the incidence of sunlight on the facade and the elevation angle. 338 Version: 1.14.0 TF8040
## Page 339

Programming Case 1 shows a typical incidence of sunlight on a south-facing facade at midday. The sun is high compared to the morning and evening. The green shaded triangle represents the elevation angle ԑ. Seen from the direction of the sun (azimuth), only the orthogonal component has a direct effect on the facade! In this case, the elevation angle ԑ is therefore equal to the effective elevation angle ԑ or the profile angle for eff the calculation. Case 2 shows a typical incidence of sunlight at midday on a south-facing facade, but lower. The green shaded triangle represents the elevation angle ԑ, which is smaller compared to case 1. Here too, the elevation angle ԑ is equal to the effective elevation angle ԑ or the profile angle for the eff calculation. Case 3 shows a typical incidence of sunlight on a south-facing facade in the evening. The elevation angle is the same as in case 2, so case 3 is the continuation of case 1 on the same day. The green shaded triangle from case 2 (building in profile) is now tilted forwards. However, it represents the orthogonal lighting component. The elevation angle for this component is visibly larger than in case 2, where the sun shines orthogonally onto the facade. 6.1.2.2.3.1.3.3.5 List of shading elements The data of all shading objects (building components, trees, etc.) per facade are stored in a field of structure elements of type ST_BA_Shd Obj [} 274] within the program. The shading correction FB_BA_Shd Corr [} 366] reads the information from this list. The management function block FB_BA_Shd Obj Entry [} 370] reads and writes it as input/output variable. It is therefore advisable to declare this list globally: VAR_GLOBAL a Shd Obj : ARRAY[1.. BA_Param.n Sun Prt_Max Shd Obj] OF ST_BA_Shd Obj; END_VAR The variable n Sun Prt_Max Shd Obj represents the upper limit of the available elements and is defined as a global constant within the program library: VAR_GLOBAL CONSTANT n Sun Prt_Max Shd Obj : UINT := 20; END_VAR 6.1.2.2.3.1.3.3.6 List of facade elements The data of all windows (facade elements) per facade are saved within the program in a field of structure elements of the type ST_BA_Fcd Elem [} 273]. The management function block FB_BA_Fcd Elem Entry [} 345] and the shading correction FB_BA_Shd Corr [} 366] read and write to this list (the latter sets the shading information); they access this field as input/ output variables. It is therefore advisable to declare this list globally: VAR_GLOBAL a Fcd Elem : ARRAY[1.. BA_Param.n Sun Prt_Max Row Fcd, 1.. BA_Param.n Sun Prt_Max Column Fcd] OF ST_BA_Fcd E lem; END_VAR The variables n Sun Prt_Max Column Fcd and n Sun Prt_Max Row Fcd define the upper limit of the available elements and are declared as global constants within the program library: TF8040 Version: 1.14.0 339
## Page 340

Programming VAR_GLOBAL CONSTANT n Sun Prt_Max Row Fcd : UINT := 10; n Sun Prt_Max Column Fcd : UINT := 20; END_VAR 6.1.2.2.3.1.3.3.7 FB_BA_Bld Pos Entry The function block FB_BA_Bld Pos Entry serves for the input of interpolation points for the function block FB_BARSun Protection Ex [} 396], if this should be operated in the height positioning mode with the help of a table (see E_BARPos Mode). In addition to the operation modes "Fixed blind height" and "Maximum light incidence", the function block FB_BA_Sun Prtc [} 396] also offers the possibility to control the blind height in relation to the sun elevation by means of table entries. By entering several interpolation points, the blind height relative to the respective sun position is calculated by linear interpolation. However, since incorrectly entered values can lead to malfunctions in FB_BA_Sun Prtc [} 396], this function block is to be preceded by the function block FB_BA_Bld Pos Entry. Four interpolation points can be parameterized on this function block, whereby a missing entry is evaluated as a zero entry. The function block does not sort the values entered independently, but instead ensures that the positions of the sun entered in the respective interpolation points are entered in ascending order. Unintentional erroneous entries are noticed faster as a result. The values chosen for f Sun Elv1 ... f Sun Elv4 must be unique, for example, the following situation must be avoided: [ f Sun Elv1 = 10 ; f Pos1 = 50] and simultaneously [f Sun Elv2 = 10 ; f Pos2 = 30 ]. This would mean that there would be two different target values for one and the same value, which does not allow a unique functional correlation to be established. In addition, the entries for the position of the sun and blind height must lie within the valid range. Mathematically this means that the following conditions must be satisfied: • f Sun Elv1 < f Sun Elv2 < f Sun Elv3 < f Sun Elv4 - (values ascending and not equal) • 0 ≤ f Sun Elv ≤ 90 ([°] - scope source values) • 0 ≤ f Pos ≤ 100 (in percent - scope target values) The function block checks the entered values for these conditions and issues an error message if they are not met. In addition, the control value b Vld of ST_BA_Bld Pos Tab [} 273] is set to FALSE. Furthermore, the function block independently ensures that the boundary areas are filled out: Internally, another interpolation point is set at f Sun Elv = 0 with f Pos1 and another one above f Sun Elv4 at f Sun Elv = 90 with f Pos4. This ensures that a sensible target value exists for all valid input values 0 ≤f Sun Elv ≤ 90 without the user having to assign an entry for f Sun Elv = 0 and f Sun Elv = 90: 340 Version: 1.14.0 TF8040
## Page 341

Programming The actual number of interpolation points transferred to the function block FB_BA_Sun Prtc [} 396] thus increases to 6, see ST_BA_Bld Pos Tab [} 273]. The interpolation of the values takes place in the glare protection function block. Inputs VAR_INPUT f Sun Elv1 : REAL; f Pos1 : REAL; f Sun Elv2 : REAL; f Pos2 : REAL; f Sun Elv3 : REAL; f Pos3 : REAL; f Sun Elv4 : REAL; f Pos4 : REAL; END_VAR Name Type Description f Sun Elv1 REAL Position of the sun at the first interpolation point [°] (0...90). f Pos1 REAL Blind position (degree of closure) at the first interpolation point [%] (0…100). f Sun Elv2 REAL Position of the sun at the second interpolation point [°] (0...90). f Pos2 REAL Blind position (degree of closure) at the second interpolation point [%] (0…100). f Sun Elv3 REAL Position of the sun at the third interpolation point [°] (0...90). f Pos3 REAL Blind position (degree of closure) at the third interpolation point [%] (0…100). f Sun Elv4 REAL Position of the sun at the fourth interpolation point [°] (0...90). f Pos4 REAL Blind position (degree of closure) at the fourth interpolation point [%] (0…100). TF8040 Version: 1.14.0 341
## Page 342

Programming Outputs VAR_OUTPUT st Bld Pos Tab : ST_BA_Bld Pos Tab; b Err : BOOL; s Err Descr : T_MAXSTRING; END_VAR Name Type Description st Bld Pos Tab ST_BA_Bld Pos Tab [} 273] Transfer structure of the interpolation points b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description Error description 01: Error: The x-values (elevation values) in the table are either not listed in ascending order, or they are duplicated. 02: Error: An elevation value that was entered is outside the valid range of 0°...90°. 03: Error: A position value that was entered is outside the valid range of 0%...100%. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.8 FB_BA_Calc Sun Pos The function block FB_BA_Calc Sun Pos is used to calculate the position of the sun by specifying the date, time, longitude and latitude. The position of the sun for a given point in time can be calculated according to common methods with a defined accuracy. The present function block is sufficient for applications with moderate requirements. As the basis for this, the SUNAE algorithm was used, which represents a favorable compromise between accuracy and computing effort. The position of the sun at a fixed observation point is normally determined by specifying two angles. One angle indicates the height above the horizon; 0° means that the sun is in the horizontal plane of the location; a value of 90° means that the is perpendicular to the observer. The other angle indicates the direction at which the sun is positioned. The SUNAE algorithm is used to distinguish whether the observer is standing on the northern hemisphere (longitude > 0 degrees) or on the southern hemisphere (longitude < 0 degrees) of the earth. If the observation point is in the northern hemisphere is, then a value of 0° is assigned for the northern sun direction and it then runs in the clockwise direction around the compass, i.e. 90° is east, 180° is south, 270° is west etc. If the point of observation is in the southern hemisphere, then 0° corresponds to the southern direction and it then runs in the counter clockwise direction, i.e. 90° is east, 180° is north, 270° is west etc. 342 Version: 1.14.0 TF8040
## Page 343

Programming The time has to be specified as UTC, Universal Time Coordinated (previously referred to as GMT, Greenwich Mean Time). The latitude is the northerly or southerly distance of a location on the Earth’s surface from the equator, in degrees [°]. The latitude can assume values between 0° (at the equator) and ±90° (at the poles). A positive sign thereby indicates a northern direction and a negative sign a southern direction. The longitude is an angle that can assume values up to ±180° starting from the prime meridian 0° (an artificially determined North-South line). A positive sign indicates a longitude in an eastern direction and a negative sign in a western direction. Examples: Location Longitude Latitude Sydney, Australia 151.2° -33.9° New York, USA -74.0° 40.7° London, England -0.1° 51.5° Moscow, Russia 37.6° 55.7° Beijing, China 116.3° 39.9° Dubai, United Arab Emirates 55.3° 25.4° Rio de Janeiro, Brazil -43.2° -22.9° Hawaii, USA -155.8° 20.2° Verl, Germany 8.5° 51.9° If the function block FB_BA_Calc Sun Pos returns a negative value for the sun elevation f Sun Elv, the sun is invisible. This can be used to determine sunrise and sunset. Inputs VAR_INPUT f Deg Lngd : REAL; f Deg Latd : REAL; t UTC : TIMESTRUCT; END_VAR Name Type Description f Deg Lngd REAL Longitude [°] f Deg Latd REAL Latitude [°] t UTC TIMESTRUCT Current time as Coordinated Universal Time. The function block FB_BA_Get Time [} 402] can be used to read this time from a target system. TF8040 Version: 1.14.0 343
## Page 344

Programming Outputs VAR_OUTPUT f Sun Azm : REAL; f Sun Elv : REAL; END_VAR Name Type Description f Sun Azm REAL Sun direction (northern hemisphere: 0° north ... 90° east ... 180° south ... 270° west ... / southern hemisphere: 0° south ... 90° east ... 180° north ... 270° west ...). f Sun Elv REAL Sun elevation (0° horizontal ... 90° perpendicular). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.9 FB_BA_Calc Sunrise Sunset The FB_BA_Calc Sunrise Sunset function block is used to calculate the sunrise and sunset by specifying the longitude, latitude, reference meridian and time. The earth is divided into several time zones. Each time zone is associated with a reference meridian. Reference meridian for some of the time zones: Time zone Reference meridian Time GMT (Greenwich Mean λ = 0° GMT + 0h GMT Time) CET (Central European λ = 15° GMT + 1h CET Time) CEST (Central European λ = 30° GMT + 2h CEST Summer Time) Inputs VAR_INPUT f Degree Of Longitude : REAL := 8.5; f Degree Of Latitude : REAL := 51.9; f Reference Meridian : REAL; d Current Date : DATE; END_VAR 344 Version: 1.14.0 TF8040
## Page 345

Programming Name Type Description f Degree Of Longitude REAL Longitude in degrees. Eastern longitudes are positive, western longitudes are negative. This input is internally limited to -180°...180°. Nevertheless, an error is displayed at the b Err output if an entry is made outside these limits. f Degreeof Latitude REAL Latitude in degrees. Northern latitudes are positive, southern latitudes are negative. This input is internally limited to -66.55°...66.55°. Nevertheless, an error is displayed at output b Err if an entry is made outside these limits. Info: -66.55° and 66.55° are the latitudes of the Artic and Antarctic Circle. Beyond these limits, the sun may never rise or set on certain days. A statement about sunrise and sunset is then not possible. f Reference Meridian TIMESTRUCT Reference meridian of the time zone. Eastern meridians are positive, western meridians are negative. As the reference meridian refers to longitude, this input is also limited to -180°...180°. Nevertheless, an error is displayed at the b Err output if an entry is made outside these limits. d Current Date DATE Current date. Outputs VAR_OUTPUT tod Sunrise : TOD; tod Sunset : TOD; b Err : BOOL; s Err Descr : T_Max String; END_VAR Name Type Description tod Sunrise TOD Sunrise. Output of hour and minute. tod Sunset TOD Sunset. Output of hour and minute. b Err BOOL Result verification for the entered values. s Err Descr T_Max String Contains the description of the error that has the highest internal priority. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.1.3.3.10 FB_BA_Fcd Elem Entry TF8040 Version: 1.14.0 345
## Page 346

Programming The function block FB_BA_Fcd Elem Entry is used to manage all facade elements (windows) of a facade, which is globally stored in a List of facade elements [} 339]. It is intended to facilitate inputting element information - not least with regard to using the TC3 PLC HMI. A schematic representation of the objects with description of the coordinates is shown in Shading correction: principles and definitions [} 325]. The facade elements are declared in the global variables as a two-dimensional field above the window columns and rows: VAR_GLOBAL a Fcd Elem : ARRAY[1.. Param.n Sun Prt_Max Column Fcd, 1.. Param.n Sun Prt_Max Row Fcd] OF ST_BA_Fcd Elem; END_VAR Each individual element arr Fcd Elem[x,y] carries the information for one facade element (ST_BA_Fcd Elem [} 273]). The information includes the group assignment, the dimensions (width, height) and the coordinates of the corners. The function block thereby accesses this field directly via the IN-OUT variable a Fcd Elem. Note: The fact that the coordinates of corners C2 to C4 are output values arises from the fact that they are formed from the input parameters and are to be available for use in a visualization: All data in [m]! f Cnr2X = f Cnr1X f Cnr2Y = f Cnr1Y + f Wdw Hght (window height) f Cnr3X = f Cnr1X + f Wdw Wdth (window width) f Cnr3Y = f Cnr2Y f Cnr4X = f Cnr1X + f Wdw Wdth (window width) f Cnr4Y = f Cnr1Y The function block is used in three steps: • Read • Change • Write Read With the entries at n Column and n Row the corresponding element is selected from the list, a Fcd Elem[n Column, n Row]. A rising edge on b Rd reads the following data from the list element: 346 Version: 1.14.0 TF8040
## Page 347

Programming • n Grp group membership, • f Cnr1X x-coordinate of corner point 1 [m] • f Cnr1Y y-coordinate of corner point 1 [m] • f Wdw Wdth window width [m] • f Wdw Hght window height [m] These are then assigned to the corresponding input variables of the function block, which uses them to calculate the coordinates of corners C2-C4 as output variables in accordance with the correlation described above. It is important here that the input values are not overwritten in the reading step. Hence, all values can initially be displayed in a visualization. Change In a next program step the listed input values can then be changed. The values entered are constantly checked for plausibility. The output b Err indicates whether the values are valid (b Err=FALSE). If the values are invalid, a corresponding error message is issued at output s Err Descr. See also "Error (b Err=TRUE)" below. Write With a positive edge at b Wrt the parameterized data are written into the field of the array a Fcd Elem dependent on n Row and n Column, regardless of whether they represent valid values or not. The element structure ST_BA_Fcd Elem [} 273] therefore also contains a plausibility bit b Vld, which forwards precisely this information to the function block FB_BA_Shd Corr [} 366] to prevent miscalculations. This approach is to be regarded only as a proposal. It is naturally also possible to parameterize the function block quite normally in one step and to write the values entered to the corresponding list element with a rising edge on b Wrt. Error (b Err=TRUE) The function block FB_BA_Shd Corr [} 366], which assesses whether all windows in a group are shaded, will only perform its task if all windows in the examined group have valid entries. This means: • n Grp must be greater than 0 • f Cnr1X must be greater than or equal to 0.0 • f Cnr1Y must be greater than or equal to 0.0 • f Wdw Wdth must be greater than 0 • f Wdw Hght must be greater than 0 If one of these criteria is not met, it is interpreted as incorrect input, and the error output b Err is set at the function block output of FB_BA_Fcd Elem Entry. Within the window element ST_BA_Fcd Elem [} 273] the plausibility bit b Vld is set to FALSE. If, on the other hand, all entries of a facade element are zero, it is regarded as a valid, intentionally omitted facade element: TF8040 Version: 1.14.0 347
## Page 348

Programming In the case of a facade of 6x4 windows, the elements window (2.1), window (3.5) and window (4.4) would be empty elements here. Inputs VAR_INPUT n Column : UDINT; n Row : UDINT; b Wrt : BOOL; b Rd : BOOL; n Grp : UDINT; f Cnr1X : REAL; f Cnr1Y : REAL; f Wdw Wdth : REAL; f Wdw Hght : REAL; END_VAR 348 Version: 1.14.0 TF8040
## Page 349

Programming Name Type Description n Column UDINT Column index of the selected component on the facade. This refers to the selection of a field element of the array stored in the IN-OUT variable a Fcd Elem. n Row UDINT ditto row index. n Row and n Column must not be zero! This is due to the field definition, which always starts with 1; see above. b Rd BOOL With a positive edge at this input, the information of the selected element, a Fcd Elem[n Column, n Row] is read into the function block and assigned to the input variables n Grp to f Wdw Hght. The resulting output variables are f Cnr2X to f Cnr4Y. If data are already present on the inputs n Grp to f Wdw Hght at time of reading, then the data previously read are immediately overwritten with these data. b Wrt BOOL A positive edge writes the entered as well as calculated values into the selected field element a Fcd Elem[n Column, n Row]. n Grp UDINT Group membership. Internally limited to a minimum value of 0. f Cnr1X REAL X-coordinate of corner point 1 [m] f Cnr1Y REAL Y-coordinate of corner point 1 [m] f Wdw Wdth REAL Window width [m] f Wdw Hght REAL Window height [m] Outputs VAR_OUTPUT f Cnr2X : REAL; f Cnr2Y : REAL; f Cnr3X : REAL; f Cnr3Y : REAL; f Cnr4X : REAL; f Cnr4Y : REAL; b Err : BOOL; s Err Desc : T_MAXSTRING; END_VAR Name Type Description f Cnr2X REAL X-coordinate determined for corner point 2 of the window [m] (see function description [} 346]) f Cnr2Y REAL Y-coordinate determined for corner point 2 of the window [m] (see function description [} 346]) f Cnr3X REAL X-coordinate determined for corner point 3 of the window [m] (see function description [} 346]) f Cnr2Y REAL Y-coordinate determined for corner point 3 of the window [m] (see function description [} 346]) f Cnr4X REAL X-coordinate determined for corner point 4 of the window [m] (see function description [} 346]) f Cnr2Y REAL Y-coordinate determined for corner point 4 of the window [m] (see function description [} 346]) b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description TF8040 Version: 1.14.0 349
## Page 350

Programming Error description 01: Error: Index error! n Column and/or n Row are outside the permissible limits 1... n Sun Prt_Max Column Fcd or 1... n Sun Prt_Max Row Fcd. See list of facade elements. 02: Error: The group index is 0, but at the same time another entry of the facade element is not zero. Only if all entries of a facade element are zero is it considered to be a valid, deliberately omitted facade component, otherwise it is interpreted as an incorrect entry. Note: Group entries less than zero are internally limited to zero. 03: Error: The X-component of the first corner point (Corner1) is less than zero. 04: Error: The Y-component of the first corner point (Corner1) is less than zero. 05: Error: The window width is less than or equal to zero. 06: Error: The window height is less than or equal to zero. / Inputs/Outputs VAR_IN_OUT a Fcd Elem : ARRAY[1.. Param.n Sun Prt_Max Column Fcd, 1.. Param.n Sun Prt_Max Row Fcd] OF ST_BA_Fcd Elem; END_VAR Name Type Description a Fcd Elem ARRAY OF List of facade elements [} 339] ST_BA_Fcd Elem [} 273] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.11 FB_BA_In Rng Azm This function block FB_BA_In Rng Azm checks whether the current azimuth angle (horizontal position of the sun) lies within the limits entered. As can be seen in the overview [} 332], the function block provides an additionally evaluation as to whether the sun protection of a window group should be activated. Therefore the observations in the remainder of the text always apply to one window group. The sun incidence azimuth angle on a smooth facade will always be facade orientation-90°... facade orientation+90°. 350 Version: 1.14.0 TF8040
## Page 351

Programming If the facade has lateral projections, however, this range is limited. This limitation can be checked with the help of this function block. However, the position of the window group on the facade also plays a role. If it lies centrally, this gives rise to the following situation (the values are only examples): The values change for a group at the edge: TF8040 Version: 1.14.0 351
## Page 352

Programming The beginning of the range f Stt Rng may thereby be larger than the end f End Rng; it is then regarded beyond 0°: Example f Azm 10.0° f Stt Rng 280.0° f End Rng 20.0° b Out TRUE However, the range regarded may not be greater than 180° or equal to 0° – this would be unrealistic. Such entries result in an error on the output b Err – the test output b Out is then additionally set to FALSE. Inputs VAR_INPUT f Azm : REAL; f Stt Rng : REAL; f End Rng : REAL; END_VAR Name Type Description f Azm REAL Current azimuth angle f Stt Rng REAL Start of range [°] f End Rng REAL End of range [°]. Outputs VAR_OUTPUT b Out : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING; END_VAR Name Type Description b Out BOOL The facade element is in the sun if the output is TRUE. b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description Error description 01: Error: f Stt Rng or f End Rng less than 0° or greater than 360°. 02: Error: The difference between f Stt Rng and f End Rng is greater than 180°. This range is too large for analyzing the insolation on a facade. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.12 FB_BA_In Rng Elv 352 Version: 1.14.0 TF8040
## Page 353

Programming This function block FB_BA_In Rng Elv checks whether the current elevation angle (vertical position of the sun) lies within the limits entered. As can be seen in the overview [} 332], the function block provides an additionally evaluation as to whether the sun protection of a window group should be activated. Therefore the observations in the remainder of the text always apply to one window group. A normal vertical facade is irradiated by the sun at an angle of elevation of 0° to maximally 90°. If the facade has projections, however, this range is limited. This limitation can be checked with the help of this function block. However, the position of the window group on the facade also plays a role. If it lies in the lower range, this gives rise to the following situation (the values are only examples): TF8040 Version: 1.14.0 353
## Page 354

Programming The values change for a group below the projection: 354 Version: 1.14.0 TF8040
## Page 355

Programming The lower observation limit, f Lo Lmt, may thereby not be greater than or equal to the upper limit, f Hi Lmt. Such entries result in an error on the output b Err – the test output b Out is then additionally set to FALSE. Inputs VAR_INPUT f Elv : REAL; f Lo Lmt : REAL; f Hi Lmt : REAL; END_VAR Name Type Description f Elv REAL Current elevation angle f Lo Lmt REAL Lower limit value [°] f Hi Lmt REAL Upper limit value [°] Outputs VAR_OUTPUT b Out : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING; END_VAR Name Type Description b Out BOOL The facade element is in the sun if the output is TRUE. b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description Error description 01: Error: f Hi Lmt less than or equal to f Lo Lmt. 02: Error: f Lo Lmt is less than 0° or f Hi Lmt is greater than 90°. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.13 FB_BA_Rd Fcd Elem Lst With the help of the function block FB_BA_Rd Fcd Elem Lst, data for facade elements (windows) can be imported from a pre-defined Excel table in csv format into the List of facade elements [} 339]. In addition the imported data are checked for plausibility and errors are written to a log file. The following example shows the Excel table with the entries of the window elements. All text fields are freely writable. Important are the fields marked in green. Each row there identifies a data set. The following rules are to be observed: • A data set must always start with a '@'. • The indices Index Column and Index Row must lie within the defined limits, see List of facade elements [} 339]. These indices directly describe the facade element in the list a Fcd Elem to which the data from the set are saved. • Window width and window height must be greater than zero TF8040 Version: 1.14.0 355
## Page 356

Programming • The corner coordinates P1x and P1y must be greater than or equal to zero. • Each window element must be assigned to a group 1...255. • For system-related reasons the total size of the table may not exceed 65534 bytes. • This must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". It is not necessary to describe all window elements that would be possible by definition or declaration. Before the new list is read in, the function block deletes the entire old list in the program. All elements that are not described by entries in the Excel table then have pure zero entries and are thus marked as non-existent and also non-evaluable, since the function block for shading correction, FB_BA_Shd Corr [} 366], does not accept elements with the group entry '0'. 356 Version: 1.14.0 TF8040
## Page 357

Programming Log file Each time the reading function block is restarted, the log file is rewritten and the old contents are deleted. If there is no log file, it will be automatically created first. The log file then contains either an OK message or a list of all errors that have occurred. Errors connected with the opening, writing or closing of the log file itself cannot be written at the same time. Therefore, always note the output s Err Descr of the reading function block that indicates the last error code. Since the log file is always closed last during the reading process, a corresponding alarm is ensured in the event of an error. Program sample In this sample the variable b Init is initially set to TRUE when the PLC starts. Hence, the input b Stt on the function block fb Read Facade Element List receives a once-only rising edge that triggers the reading process. The file Facade Elements.csv is read, which is located in the folder C:∖Projekte∖. The log file "Logfile.txt" is then saved in the same folder. If this log file does not yet exist it will be created, otherwise the existing contents are overwritten. Reading and writing take place on the same computer on which the PLC is located. This is defined by the input t Net ID = '' (=local). All data are written to the list a Fcd Elem declared in the program. The output b Busy is set to TRUE during reading and writing. The last file handling error that occurred is displayed at s Err Descr; b Err is then TRUE. If an error is detected in the data set, this is displayed at b Err Data Set and described in more detail in the log file. The number of found and read data rows is displayed at n Amt Sets Rd for verification purposes. The errors marked were "built into" the following Excel list. This gives rise to the log file shown: TF8040 Version: 1.14.0 357
## Page 358

Programming The first error is in data set 2 and is an index error, since "0" is not permitted. The next error in data set 6 was found after validation of the data with the internally used function block FB_BA_Shd Obj Entry [} 370] and allocated an error description. The third and the fourth errors likewise occurred after the internal validation. Important here it that the data set numbers (in this case 22 and 24) do not go by the numbers entered in the list, but by the actual sequential numbers: only 30 data sets were read in here. Inputs VAR_INPUT b Stt : BOOL; s Data File : STRING; s Log File : STRING; t Net Id : T_Ams Net Id; END_VAR 358 Version: 1.14.0 TF8040
## Page 359

Programming Name Type Description b Stt BOOL A TRUE edge on this input starts the reading process. s Data File STRING Contains the path and file name for the data file to be opened. This must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". If the file is opened with a simple text editor, the values must be separated by semicolons. Example of an entry: s Data File:= 'C:∖Projekte∖Facade Elements.csv' s Log File STRING ditto log file for the accumulating errors. This file is overwritten each time the function block is activated, so that only current errors are contained. t Net Id T_Ams Net ID A string can be entered here with the AMS Net ID of the Twin CAT computer on which the files are to be written/ read. For the local computer an empty string may be specified. The data can be saved only on the control computer itself and on the computers that are connected by ADS to the control computer. Links to local hard disks in this computer are possible, but not to connected network hard drives. / Inputs/Outputs VAR_IN_OUT a Fcd Elem : ARRAY[1.. BA_Param.n Sun Prt_Max Column Fcd, 1.. BA_Param.n Sun Prt_Max Row Fcd] OF ST_BA_Fcd Elem ; END_VAR Name Type Description a Fcd Elem ARRAY OF List of facade elements [} 339] ST_BA_Fcd Elem [} 273] Outputs VAR_OUTPUT b Busy : BOOL; n Amt Sets Rd : UDINT; b Err : BOOL; s Err Descr : T_MAXSTRING; b Err Data Set : BOOL; END_VAR Name Type Description b Busy BOOL This output is TRUE as long as elements are being read from the file. a Amt Sets Rd UDINT Number of data sets read b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description TF8040 Version: 1.14.0 359
## Page 360

Programming Error description 01: File handling error: Opening the log file - the ADS error number is stated. 02: File handling error: Opening the data file - the ADS error number is stated. 03: File handling error: Reading the data file - the ADS error number is stated. 04: Error: During reading of the data file it was determined that the file is too large (number of bytes larger than n Max Data File Size) 05: File handling error: Writing the log file - the ADS error number is stated. 06: File handling error: Closing the data file - the ADS error number is stated. 07: File handling error: Writing to the log file (OK message if no errors were detected) - the ADS error number is stated. 08: File handling error: Closing the log file - the ADS error number is stated. Name Type Description b Err Data Set BOOL This output is set to TRUE, if the read data sets are faulty. Further details are entered in the log file. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.14 FB_BA_Rd Shd Obj Lst With the help of the function block FB_BA_Rd Shd Obj Lst, data for shading objects can be imported from a pre-defined Excel table in csv format into the list of shading objects [} 339]. In addition the imported data are checked for plausibility and errors are written to a log file. The following example shows the Excel table with the entries of the window elements. All text fields are freely writable. The fields marked in green are important; each line in these fields identifies a data set. The columns G to J have a different meaning depending on whether the type rectangle or sphere is concerned. The columns K to M are to be left empty in the case of spheres. With regard to the rectangle coordinates, only the relevant data are entered and the remainder are internally calculated (see FB_BA_Shd Obj Entry [} 370]). The following rules are to be observed: • A data set must always start with a '@'. • The month entries must not be 0 and not be greater than 12, all other combinations are possible. Examples: Start=1, End=1: Shading in January. Start=1, End=5: Shading from the beginning of January to the end of May. Start=11, End=5: Shading from the beginning of November to the end of May (of the following year). • The z-coordinates P1z and P3z or Mz must be greater than zero. • The radius must be greater than zero. • For system-related reasons the total size of the table may not exceed 65534 bytes. • The table must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". It is not necessary to describe all shading objects that are possible per facade. Only those contained in the list ultimately take effect. 360 Version: 1.14.0 TF8040
## Page 361

Programming Log file Each time the reading function block is restarted, the log file is rewritten and the old contents are deleted. If there is no log file, it will be automatically created first. The log file then contains either an OK message or a list of all errors that have occurred. Errors connected with the opening, writing or closing of the log file itself cannot be written at the same time. Therefore, always note the output s Err Descr of the reading function block that indicates the last error code. Since the log file is always closed last during the reading process, a corresponding alarm is ensured in the event of an error. TF8040 Version: 1.14.0 361
## Page 362

Programming Program sample In this sample the variable b Init is initially set to TRUE when the PLC starts. Hence, the input b Stt on the function block fb Read Shading Objects receives a once-only rising edge that triggers the reading process. The file Shading Objects.csv is read, which is located in the folder C:∖Projekte∖. The log file Logfile.txt is then saved in the same folder. If this log file does not yet exist it will be created, otherwise the existing contents are overwritten. Reading and writing take place on the same computer on which the PLC is located. This is defined by the input t Net ID = '' (=local). All data are written to the list a Shd Obj declared in the program. The output b Busy is set to TRUE during reading and writing. The last file handling error that occurred is displayed at s Err Descr; b Err is then TRUE. If an error is detected in the data set, this is displayed at b Err Data Set and described in more detail in the log file. The number of found and read data rows is displayed at n Amt Sets Rd for verification purposes. The errors marked were built into the following Excel list. This gives rise to the log file shown: 362 Version: 1.14.0 TF8040
## Page 363

Programming The first error is in data set 3 and is a type error, since "2" is not defined. The next error in data set 6 was found after validation of the data with the internally used function block FB_BA_Shd Obj Entry [} 370] and allocated an error description. The third error likewise occurred after the internal validation. Please note that the missing coordinates are filled in as follows: f P2x = f P1x; f P2z = f P1z; f P4x = f P3x; f P4y = f P1y; f P4z = f P3z; Error messages complaining about the equality of two points must be checked against these equations. Important here it that the data set number (in this case 11) does not go by the numbers entered in the list, but by the actual sequential number: only 16 data sets were read in here. Inputs VAR_INPUT b Stt : BOOL; s Data File : STRING; s Log File : STRING; t Net Id : T_Ams Net Id; END_VAR TF8040 Version: 1.14.0 363
## Page 364

Programming Name Type Description b Stt BOOL A TRUE edge on this input starts the reading process. s Data File STRING Contains the path and file name for the data file to be opened. This must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". If the file is opened with a simple text editor, the values must be separated by semicolons. Example of an entry: s Data File:= 'C:∖Projekte∖Facade Elements.csv' s Log File STRING ditto log file for the accumulating errors. This file is overwritten each time the function block is activated, so that only current errors are contained. t Net Id T_Ams Net ID A string can be entered here with the AMS Net ID of the Twin CAT computer on which the files are to be written/ read. For the local computer an empty string may be specified. The data can be saved only on the control computer itself and on the computers that are connected by ADS to the control computer. Links to local hard disks in this computer are possible, but not to connected network hard drives. / Inputs/Outputs VAR_IN_OUT a Shd Obj: ARRAY[1.. BA_Param.n Sun Prt_Max Shd Obj] OF ST_BA_Shd Obj; END_VAR Name Type Description a Shd Obj ARRAY OF List of shading objects [} 339] ST_BA_Shd Obj [} 274] Outputs VAR_OUTPUT b Busy : BOOL; n Amt Sets Rd : UDINT; b Err : BOOL; s Err Descr : T_MAXSTRING; b Err Data Set : BOOL; END_VAR Name Type Description b Busy BOOL This output is TRUE as long as elements are being read from the file. a Amt Sets Rd UDINT Number of data sets read b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description Error description 01: File handling error: Opening the log file - the ADS error number is stated. 02: File handling error: Opening the data file - the ADS error number is stated. 03: File handling error: Reading the data file - the ADS error number is stated. 04: Error: During reading of the data file it was determined that the file is too large (number of bytes larger than n Max Data File Size) 05: File handling error: Writing the log file - the ADS error number is stated. 06: File handling error: Closing the data file - the ADS error number is stated. 07: File handling error: Writing to the log file (OK message if no errors were detected) - the ADS error number is stated. 08: File handling error: Closing the log file - the ADS error number is stated. 364 Version: 1.14.0 TF8040
## Page 365

Programming Name Type Description b Err Data Set BOOL This output is set to TRUE, if the read data sets are faulty. Further details are entered in the log file. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.15 FB_BA_Rol Bld Actr The function block FB_BA_Rol Bld Actr is used to position a roller blind via two outputs: Up and Down. The roller blind can be driven to any desired position with the positioning telegram st Sun Bld [} 274]. In addition, the positioning telegram st Sun Bld [} 274] also contains manual commands with which the roller blind can be moved individually to certain positions. These manual commands are controlled by the function block FB_BA_Sun Bld Swi [} 388]. The current height position is not read by an additional encoder, but is determined internally by the runtime of the roller blind. The two different runtime parameters n Ti Up(runtime roller blind up [ms]) and n Ti Dwn (runtime roller blind down [ms]) take account of the different travel characteristics. The function block fundamentally controls the roller blind via the information from the positioning telegram st Sun Bld [} 274]. If automatic mode is active (b Man Mod=FALSE), the current position is always approached, and changes are immediately taken into account. In manual mode (b Man Mod=TRUE) the commands b Man Up and b Man Dwn control the roller blind. Referencing Safe referencing refers to a situation when the roller blind is upwards-controlled for longer than its complete travel-up time. The position is then always "0". Since a roller blind positioning without encoder is always error-prone by nature, it is important to reference automatically as often as possible: every time the position "0" is to be approached, the roller blind first moves up normally with continuous position calculation. Once the calculated position value 0% is reached, the output b Up continues to be held for the complete travel-up time + 5 s. The referencing process can be interrupted by a manual "down" command or by repositioning. After a plant restart, the function block executes a reference run. Inputs VAR_INPUT b En : BOOL; st Sun Bld : ST_BA_Sunblind; n Ti Up : UDINT; n Ti Dwn : UDINT; END_VAR TF8040 Version: 1.14.0 365
## Page 366

Programming Name Type Description b En BOOL Enable input for the function block. As long as this input is TRUE, the actuator function block accepts and executes commands as described above. A FALSE signal on this input resets the control outputs b Up and b Dwn and the function block remains in a state of rest. st Sun Bld ST_BA_Sun Bld [} 274] Positioning telegram n Ti Up UDINT Complete time for driving up [ms] n Ti Dwn UDINT Complete time for driving down [ms] Outputs VAR_OUTPUT b Up : BOOL; b Dwn : BOOL; f Actl Pos : REAL; b Ref : BOOL; n Ref Ti : UDINT; b Busy : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING END_VAR Name Type Description b Up BOOL Roller blind control output up b Dwn BOOL Roller blind control output down f Actl Pos READ Current position in percent. b Ref BOOL The roller blind is in referencing mode, i.e. the output b Up is set for the complete travel-up time + 5s. Only a manual "down" command can move the roller blind in the opposite direction and terminate this mode. n Ref Ti UDINT Referencing countdown display [s] b Busy BOOL A positioning or a referencing procedure is in progress. b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description Error description 01: Error: The total travel-up or travel-down time (n Ti Up / n Ti Dwn) is zero. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.16 FB_BA_Shd Corr The function block FB_BA_Shd Corr is used to assess the shading of a group of windows on a facade. 366 Version: 1.14.0 TF8040
## Page 367

Programming The function block FB_BA_Shd Corr calculates whether a window group lies in the shadow of surrounding objects. The result, which is output at the output b Grp Not Shdd, can be used to assess whether sun protection makes sense for this window group. The function block thereby accesses two lists, which are to be defined: • The parameters that describe the shading elements that are relevant to the facade on which the window group is located. This list of shading objects [} 339] is used as input variable a Shd Obj for the function block, since the information is read only. • The data of the elements (window) of the facade in which the group to be regarded is located. This list of facade elements [} 339] is accessed via the IN/OUT variable a Fcd Elem, since not only the window coordinates are read, but the function block FB_BA_Shd Corr also stores the shading information for each window corner in this list. In this way, the information can also be used in other parts of the application program. On the basis of the facade orientation (f Fcd Ortn), the direction of the sun (f Azm) and the sun elevation (f Elv), a calculation can be performed for each corner of a window to check whether this lies in a shaded area. A window group is considered to be completely shaded if all corners are shaded. In the northern hemisphere, the following applies for the facade orientation (looking out of the window): Viewing direction Facade orientation North β=0° East β=90° South β=180° West β=270° The function block performs its calculations only if the sun is actually shining on the facade. Considering the drawing presented in the introduction, this is the case if: Facade orientation < azimuth angle < facade orientation + 180° In addition, a calculation is also not required, if the sun has not yet risen, i.e. the sun elevation is below 0°. In both cases the output b Fcd Sunlit is set to FALSE. The situation is different for the southern hemisphere. The following applies to the facade orientation (looking out the window): TF8040 Version: 1.14.0 367
## Page 368

Programming Viewing direction Facade orientation South β=0° East β=90° North β=180° West β=270° The internal calculation or the relationship between facade and sunbeam also changes: To distinguish between the situation in the northern and southern hemisphere, set the input parameter b South to FALSE (northern hemisphere) or TRUE (southern hemisphere) Inputs VAR_INPUT t Ti Actl : TIMESTRUCT; f Fcd Ortn : REAL; f Azm : REAL; f Elv : REAL; n Grp ID : DINT; b South : BOOL; a Shd Obj : ARRAY[1.. BA_Param.n Sun Prt_Max Shd Obj] OF ST_BA_Shd Obj; END_VAR 368 Version: 1.14.0 TF8040
## Page 369

Programming Name Type Description t Ti Actl TIMESTRUCT Input of the current time - local time in this case, since this time takes into account the shaded months. If the UTC time (or GMT) is used, the month may change in the middle of the day, depending on the location on the earth. f Fcd Ortn REAL Facade orientation, see illustration above. f Azm REAL Direction of the sun at the time of observation [°] f Elv REAL Sun elevation at the time of observation [°] n Grp ID UDINT Window group regarded. The group 0 is reserved here for unused window elements (see FB_BA_Fcd Elem Entry [} 345]). A 0-entry would lead to an error output (b Err=TRUE). The function block is then not executed any further and b Grp Not Shdd is set to FALSE. b South BOOL FALSE: Calculations refer to conditions in the northern hemisphere - TRUE: in the southern hemisphere a Shd Obj ARRAY OF List of shading objects [} 339]. ST_BA_Shd Obj [} 274] / Inputs/Outputs VAR_IN_OUT a Fcd Elem : ARRAY[1.. BA_Param.n Sun Prt_Max Column Fcd, 1.. BA_Param.n Sun Prt_Max Row Fcd] OF ST_BA_Fcd Elem ; END_VAR Name Type Description a Fcd Elem ARRAY OF List of facade elements [} 339] ST_BA_Fcd Elem [} 273] Outputs VAR_OUTPUT b Grp Not Shdd : BOOL; b Fcd Sunlit : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING; END_VAR Name Type Description b Grp Not Shdd BOOL Is TRUE as long as the window group is not calculated as shaded. b Fcd Sunlit BOOL This output is set to TRUE if the sun is shining on the facade. See description above. b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description Error description 01: Error: Index error window group (group of facade elements): Index is less than or equal to 0. 02: Error: A facade element is invalid. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 369
## Page 370

Programming 6.1.2.2.3.1.3.3.17 FB_BA_Shd Obj Entry The function block FB_BA_Shd Obj Entry serves for the administration of all shading elements in a facade, which are globally saved in a list of shading elements [} 339]. It is intended to facilitate the input of the element information - also with regard to the use of the visualization. A schematic representation of the objects with description of the coordinates is shown in Shading correction: principles and definitions [} 325]. The shading elements are declared in the global variables: VAR_GLOBAL arr Shd Obj : ARRAY[1.. BA_Param.n Sun Prt.n Max Shd Obj] OF ST_BA_Shd Obj; END_VAR Each individual element a Shd Obj[1] to a Shd Obj [n Max Shd Obj] carries the information for one shading element (ST_BA_Shd Obj [} 274]). This information consists of the selected type of shading (rectangle or sphere) and the respectively associated coordinates. For a rectangle, these are the corner points (f P1x, f P1y, f P1z), (f P2x, f P2y, f P2z), (f P3x, f P3y, f P3z) and (f P4x, f P4y, f P4z) for a sphere this are the center point (f Mx, f My, f Mz) and the radius f Rads. In addition, the phase of the shading can be defined via the inputs n Beg Mth and n End Mth, which is important in the case of objects such as trees that bear no foliage in winter. The function block thereby directly accesses the field of this information via the IN-OUT variable a Shd Obj. Note: The fact that the rectangle coordinates f P2x, f P2z, f P4x, f P4y and f P4z are output values results from the fact that they are formed from the input parameters: f P2x = f P1x; f P2z = f P1z; f P4x = f P3x; f P4y = f P1y; f P4z = f P3z; That limits the input of a rectangle to the extent that the lateral edges stand vertically on the floor (f P2x = f P1x and f P4x = f P3x), that the rectangle has no inclination (f P2z = f P1z and f P4z = f P3z) and can only have a different height "upwards", i.e. in the positive y-direction (f P4y = f P1y). The function block is used in three steps: • Read • Change • Write Read Selection of the element from the list a Shd Obj[n Id] is based on the entry at n Id. A rising edge on b Rd reads the data. These values are assigned to the input and output variables of the function block. These are the input values f P1x, f P1y, f P1z, f P2y, f P3x, f P3y, f P3z, f Mx, f My, f Mz, f Rads, the object enumerator e Type and the output values f P2x, f P2z, f P4x, f P4y and f P4z. It is important here that the input values are not overwritten in the reading step. Hence, all values can initially be displayed in a visualization. 370 Version: 1.14.0 TF8040
## Page 371

Programming Change In a next program step the listed input values can then be changed. If a rectangle is preselected at input e Type via the value "e Object Type Tetragon", the output values f P2x, f P2z, f P4x, f P4y, and f P4z result from the rectangle coordinates that were entered (see above). The values entered are constantly checked for plausibility. The output b Err indicates whether the values are valid (b Err=FALSE). If the value is invalid, a corresponding error message is output at output s Err Descr . If a rectangle is defined, only the inputs f P1x, f P1y, f P1z, f P2y, f P3x, f P3y and f P3z must be written to, the inputs f Mx, f My, f Mz and f Rads need not be linked. For a sphere definition, only f Mx, f My, f Mz and f Rads have to be described; the rectangle coordinates can remain unlinked Write The parameterized data are written to the list element with the index ni Id upon a positive edge on b Wrt , regardless of whether they represent valid values or not. The element structure ST_BA_Shd Obj [} 274] therefore contains a plausibility bit b Vld, which forwards precisely this information to the function block FB_BA_Shd Corr [} 366] to prevent miscalculations. This approach is to be regarded only as a proposal. It is also possible to parameterize the function block quite normally in one step and to write the values entered to the corresponding list element with a rising edge on b Wrt. Inputs VAR_INPUT n Id : UDINT; b Rd : BOOL; b Wrt : BOOL; f P1x : REAL; f P1y : REAL; f P1z : REAL; f P2y : REAL; f P3x : REAL; f P3y : REAL; f P3z : REAL; f Mx : REAL; f My : REAL; f Mz : REAL; f Rads : REAL; n Beg Mth : UDINT; n End Mth : UDINT; e Type : E_BA_Shd Obj Type; END_VAR TF8040 Version: 1.14.0 371
## Page 372

Programming Name Type Description n Id UDINT Index of the selected element. This refers to the selection of a field element of the array stored in the IN-OUT variable a Shd Obj. The variable n Id must not be zero! This is due to the field definition, which starts with 1. However, an incorrect input is recognized and displayed as such at b Err/s Err Descr. b Rd BOOL The information of the selected element, a Shd Obj[n Id], is read into the function block with a positive edge at this input and assigned to the input variables f P1x to e Type and the output variables f P2x to f P4z. If at this time data have already been applied to the inputs f P1x to e Type, the previously read data are immediately overwritten with these. b Wrt BOOL A positive edge writes the values applied to inputs f P1x to e Type and the values determined and assigned to outputs f P2x to f P4z to the selected field element a Shd Obj[n Id]. f P1x REAL X-coordinate of point 1 of the shading element (rectangle) [m]. f P1y REAL Y-coordinate of point 1 of the shading element (rectangle) [m]. f P1z REAL Z-coordinate of point 1 of the shading element (rectangle) [m]. f P2y REAL Y-coordinate of point 2 of the shading element (rectangle) [m]. f P3x REAL X-coordinate of point 3 of the shading element (rectangle) [m]. f P3y REAL Y-coordinate of point 3 of the shading element (rectangle) [m]. f P3z REAL Z-coordinate of point 3 of the shading element (rectangle) [m]. f Mx REAL X-coordinate of the center of the shading element (ball) [m]. f My REAL Y-coordinate of the center of the shading element (ball) [m]. f Mz REAL Z-coordinate of the center of the shading element (ball) [m]. f Rads REAL Radius of the shading element (ball) [m]. n Beg Mth UDINT Beginning of the shading period (month). n End Mth UDINT End of the shading period (month). e Type E_BA_Shd Obj Type [} 269] Selected element type: rectangle or sphere. Remark about the shading period: The month entries must not be 0 and not be greater than 12, all other combinations are possible. Examples: Start=1, End=1: shading in January. Start=1, End=5: shading from the beginning of January to the end of May. Start=11, End=5: shading from the beginning of November to the end of May (of the following year). / Inputs/Outputs VAR_IN_OUT a Shd Obj: ARRAY[1.. BA_Param.n Sun Prt_Max Shd Obj] OF ST_BA_Shd Obj; END_VAR 372 Version: 1.14.0 TF8040
## Page 373

Programming Name Type Description a Shd Obj ARRAY OF List of shading objects [} 339] ST_BA_Shd Obj [} 274] Outputs VAR_OUTPUT f P2x : REAL; f P2z : REAL; f P4x : REAL; f P4y : REAL; f P4z : REAL; b Err : BOOL; s Err Descr : T_MAXSTRING; END_VAR Name Type Description f P2x REAL Determined X-coordinate of point 2 of the shading element (rectangle) [m] (see "Note [} 370]" above). f P2Z REAL Determined Z-coordinate of point 2 of the shading element (rectangle) [m] (see "Note [} 370]" above) f P4x REAL Determined X-coordinate of point 4 of the shading element (rectangle) [m] (see "Note [} 370]" above). f P4y REAL Determined Y-coordinate of point 4 of the shading element (rectangle) [m] (see "Note [} 370]" above). f P4z REAL Determined Z-coordinate of point 4 of the shading element (rectangle) [m] (see "Note [} 370]" above). b Err BOOL Contains the error description. s Err Descr T_MAXSTRING Contains the error description Error description 01: Error: The input n Id is outside the permissible limits 1...n Max Shd Obj. 02 Error: The sum of the angles of the rectangle is not 360°. This means that the corners are not in the order P1, P2, P3 and P4 but rather P1, P3, P2 and P4. This results in a crossed-over rectangle. 03: Error: The corners of the rectangle are not in the same plane. 04: Error: The z-component of P1 is less than zero. This corner would thus lie behind the facade. 05: Error: The z-component of P3 is less than zero. This corner would thus lie behind the facade. 06: Error: P1 is equal to P2. The object entered is thus not a rectangle. 07: Error: P1 is equal to P3. The object entered is thus not a rectangle. 08: Error: P1 is equal to P4. The object entered is thus not a rectangle. 09: Error: P2 is equal to P3. The object entered is thus not a rectangle. 10: Error: P2 is equal to P4. The object entered is thus not a rectangle. 11: Error: P3 is equal to P4. The object entered is thus not a rectangle. 12: Error: The radius entered is zero. 13: Error: The z-component of the ball center is less than zero. This point would thus lie behind the facade. 14: Error: Error object type e Type - neither rectangle nor ball. 15: Error: Month input error. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 373
## Page 374

Programming 6.1.2.2.3.1.3.3.18 FB_BA_Sun Bld Actr The function block FB_BA_Sun Bld Actr is used to position a blind via two outputs: Up and Down. The blind can be driven to any desired (height) position and slat angle via the positioning telegram st Sun Bld [} 274]. In addition, the positioning telegram st Sun Bld [} 274] also contains manual commands with which the blind can be moved individually to certain positions. These manual commands are controlled by the function block FB_BA_Sun Bld Swi [} 388]. The current height position and the slat angle are not read in by an additional encoder, but determined internally by the travel time of the blind. The calculation is based on the following travel profile (regarded from the highest and lowest position of the blind): Downward travel profile: More detailed explanations of the terms "backlash" and "turning" are given here in the downward movement: The blind normally describes its downward movement with the slat low point directed outwards, as in fig. 3). If the blind is in an initial position with the low point directed inwards (i.e. after the conclusion of an upward movement), then a certain time elapses after a new downward movement begins before the slats start to turn from the "inward low point" to the "outward low point". During this time the slat angle does not change; the blind only drives downward (fig.1 and fig. 2). This time is an important parameter for the movement calculation and is entered in the function block under n Bck Lsh Ti Dwn [ms]. Since it is not known at any point after a blind movement of any length whether backlash has already taken effect, the backlash of the downward movement or its travel time can be measured most reliably if the blind was first raised fully. A further important parameter is the time interval of the subsequent turning of the slats from the "Inward low point" to the "Outward low point". This time should be entered as n Turn Ti Dwn [ms] at the function block. 374 Version: 1.14.0 TF8040
## Page 375

Programming Upward travel profile: More detailed explanations of the terms "backlash" and "turning" are given here in the upward movement: The circumstances are similar to the downward movement described above: The blind normally describes its upward movement with the slat low point directed inwards, as in fig. 3). If the blind is in an initial position with the low point directed outwards (i.e. after the conclusion of a downward movement), then a certain time elapses after a new upward movement begins before the slats start to turn from the "Outward low point" to the "Inward low point". During this time the slat angle does not change; the blind only drives upward (fig. 1 and fig. 2). Also this time is an important parameter for the movement calculation and is entered in the function block under n Bck Lsh Ti Up [ms]. Since it is not known at any point after a blind movement of any length whether backlash has already taken effect, the backlash of the upward movement or its travel time can be measured most reliably if the blind was first driven fully downward. A further important parameter is the time interval of the subsequent turning of the slats from the "Outward low point" to the "Inward low point". This time should be entered as n Turn Ti Up [ms] at the function block. Parameterization For the calculation of the (height) position and the slat angle, the following times now have to be determined for both the upward and downward movement: • the backlash duration (n Bck Lsh Ti Up / n Bck Lsh Ti Dwn [ms]) • the turning duration (n Turn Ti Up / n Turn Ti Dwn [ms]) • the total travel time (n Ti Up / n Ti Dwn [ms]) Furthermore the following are required for the calculation: • the highest slat angle after turning upwards (f Angl Lmt Up [°]) • the lowest slat angle after turning downwards (f Angl Lmt Dwn [°]) The slat angle λ is defined by a notional straight line through the end points of the slat to the horizontal. TF8040 Version: 1.14.0 375
## Page 376

Programming Functioning As a rule, the function block controls the blind based on the information from the positioning telegram st Sun Bld [} 689]. If automatic mode is active (b Man Mod = FALSE), then the current position and slat angle are always driven to, wherein changes are immediately accounted for. The height positioning takes priority: First the entered height and afterwards the slat angle are driven to. For reasons of the simplicity the position error due to the angle movement is disregarded. In manual mode (b Man Mod = TRUE), the blind is controlled by the commands b Man Up and b Man Dwn. An automatic movement command is triggered whenever a change from manual to automatic mode occurs. Referencing Secure referencing is ensured if the blind is driven upward for longer than its complete travel-up time. The position is then in any case "0" and the lamella angle is at its maximum. Since a blind positioning without encoder is naturally always error-prone, it is important to reference automatically as often as possible: every time the position "0" is to be approached (the angle does not matter), the blind first moves up normally with continuous position calculation. Once the calculated position value 0% is reached, the output b Up continues to be held for the complete up time + 5 s. The referencing process can be interrupted by a manual "down" command or by repositioning. After a plant restart, the function block executes a reference run. Target accuracy Since the function block determines the blind position solely via travel times, the cycle time of the PLC task plays a crucial role for positioning accuracy. If the switching time for a slat angle range of -70° to 10° is 1 second, for example, the accuracy at a cycle time of 50 ms is +/-4°. Inputs VAR_INPUT b En : BOOL; st Cmd : ST_BA_Sun Bld; n Ti Up : UDINT; n Ti Dwn : UDINT; n Turn Ti Up : UDINT; n Turn Ti Dwn : UDINT; n Bck Lsh Ti Up : UDINT; n Bck Lsh Ti Dwn : UDINT; f Angl Lmt Up : REAL; f Angl Lmt Dwn : REAL; END_VAR 376 Version: 1.14.0 TF8040
## Page 377

Programming Name Type Description b En BOOL Enable input for the function block. As long as this input is TRUE, the actuator function block accepts and executes commands as described above. A FALSE signal on this input resets the control outputs b Up and b Dwn and the function block remains in a state of rest. st Cmd ST_BA_Sun Bld [} 274] Positioning telegram n Ti Up UDINT Complete time for driving up [ms] n Ti Dwn UDINT Complete time for driving down [ms]. n Turn Ti Up UDINT Time for turning the slats in the upward direction [ms]. n Turn Ti Dwn UDINT Time for turning the slats in the downward direction [ms]. n Bck Lsh Ti Up UDINT Time to traverse the backlash in the upward direction [ms]. This input is internally limited to a minimum value of 0. n Bck Lsh Ti Dwn UDINT Time to traverse the backlash in the downward direction [ms]. This input is internally limited to a minimum value of 0. f Angl Lmt Up REAL Highest position of the slats [°]. This position is reached once the blind has moved to the top position. The slat angle λ, as defined above, is then typically greater than zero. Name Type Description f Angl Lmt Dwn REAL Lowest position of the slats [°]. This position is reached once the blind has moved to the bottom position. The slat angle λ, as defined above, is then typically less than zero. TF8040 Version: 1.14.0 377
## Page 378

Programming Outputs VAR_OUTPUT b Up : BOOL; b Dwn : BOOL; f Actl Pos : REAL; f Actl Angl : REAL; b Ref : BOOL; n Ref Ti : UDINT; b Busy : BOOL; b Err : BOOL; s Err Desc : T_MAXSTRING; END_VAR Name Type Description b Up BOOL Control output for blind up b Dwn BOOL Control output for blind down f Actl Pos REAL Current position in percent f Actl Angl REAL Current lamella angle [°] b Ref BOOL The blind is in referencing mode, i.e. the output b Up is set for the complete travel-up time + 5s. Only a manual "down" command can move the blind in the opposite direction and terminate this mode. n Ref Ti UDINT Referencing countdown display [s] b Busy BOOL A positioning or a referencing procedure is in progress. b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description Error description 01: Error: Up/down timer = 0. 02: Error: Turning timer = 0. 03: Error: Lamella angle limits: the upper limit is less than or equal to the lower limit (f Angl Lmt Up <= f Angl Lmt Dwn). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.19 FB_BA_Sun Bld Evt The function block FB_BA_Sun Bld Evt is used for position and angle specification at any event. It can be used, for example, in order to drive to a parking position or to drive the blind upward for maintenance. The function is enabled via the input b En. If this is the case, the active flag b Actv is set in the positioning telegram st Sun Bld [} 274] at the output and the values f Pos entered at the In-Out variables for the blind height [%] and f Angl for the lamella angle [°] are forwarded in this telegram. If the function is no longer active due to the resetting of b En, then the active flag in the positioning telegram st Sun Bld [} 274] is reset and the positions for height and angle are set to "0". The priority function block (e.g. FB_BA_Sun Bld Prio Swi4 [} 599]) enables a function with lower priority to take over the control by resetting. 378 Version: 1.14.0 TF8040
## Page 379

Programming Inputs VAR_INPUT b En : BOOL; f Pos : REAL; f Angl : REAL; END_VAR Name Type Description b En BOOL A TRUE signal on this input activates the function block and transfers the entered setpoints together with the active flag in the positioning telegram ST_BA_Sun Bld [} 274]. A FALSE signal resets the active flag again and sets position and angle to zero. f Pos REAL Height position of the blind [%] in case of activation. f Angl REAL Lamella angle of the blind [°] in case of activation. Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : E_BA_Sun Bld Prio := E_BA_Sun Bld Prio.e Scene1; END_VAR Name Type Description e Prio E_BA_Sun Bld Prio [} 269] Priority of the active telegram. Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; END_VAR Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output structure of the blind positions. b Actv BOOL Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 274] and is solely used to indicate whether the function block sends an active telegram. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.20 FB_BA_Sun Bld Ice Prtc The function block FB_BA_Sun Bld Ice Prtc deals with direction-independent anti-icing. Weather protection has the highest priority for blind control (see Overview [} 332]) and should ensure that the blind is not damaged by ice. TF8040 Version: 1.14.0 379
## Page 380

Programming Impending icing up is detected when the measured outside temperature f Ots T falls below the frost limit value f Frst T while at the same time rain is detected on b Rain Sns. This event is saved internally and remains active until it is ensured that the ice has melted again. In addition, the outside temperature must have exceeded the frost limit value for the entered deicing time n Deice Ti [s]. For safety reasons the icing event is persistently saved, i.e. also beyond a PLC failure. Thus, if the controller fails during the icing up or deicing period, the blind is considered to be newly iced up when then the controller restarts and the deicing timer starts from the beginning again. If there is a risk of icing, the blind is moved to the protection position specified by f Pos Prot (height position [%]) and f Angl Prot (lamella angle [°]). Inputs VAR_INPUT b En : BOOL; f Ots T : REAL; b Rain Sns : BOOL; f Frst T : REAL; n Deice Ti : UDINT; f Pos Prot : REAL; f Angl Prot : REAL; END_VAR Name Type Description b En BOOL A TRUE signal on this input activates the function block and transfers the entered setpoints together with the active flag in the positioning telegram ST_BA_Sun Bld [} 274]. A FALSE signal resets the active flag again and sets position and angle to zero. b Actv is FALSE. This means that another function takes over control of the blind via the priority controller. f Ots T REAL Outside temperature [°C] b Rain Sns BOOL Input for a rain sensor. f Frst T REAL Icing up temperature limit value [°] Celsius. This value may not be greater than 0. Otherwise an error is output. n Deice Ti UDINT Time until the deicing of the blind after icing up [s]. After that the ice alarm is reset. f Pos Prot REAL Height position of the blind [%] in the case of protection. f Angl Prot REAL Lamella angle of the blind [°] in the case of protection. Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : E_BA_Sun Bld Prio := E_BA_Sun Bld Prio.e Ice; END_VAR Name Type Description e Prio E_BA_Sun Bld Prio [} 269] Priority of the active telegram. Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; b Ice Alm : BOOL; n Rem Ti Ice Alm : UDINT; END_VAR 380 Version: 1.14.0 TF8040
## Page 381

Programming Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output structure of the blind positions. b Actv BOOL Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 274] and is solely used to indicate whether the function block sends an active telegram. b Ice Alm BOOL Indicates the icing up alarm. n Rem Ti Ice Alm UDINT In the case of impending icing up (b Ice Alm = TRUE), this second counter is set to the deicing time. As soon as the temperature lies above the frost point entered (f Frst T), the remaining number of seconds until the 'all-clear' signal is given (b Ice Alm = FALSE) is displayed here. This output is 0 as long as no countdown of the time is taking place. If an error occurs, this automatic control is disabled and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.21 FB_BA_Sun Bld Pos Dly This function block delays changes in position based on automatic commands. If an event, e.g. weather protection, results in too many blind drives being started at the same time, fuses may be triggered by motor starting current peaks. It is therefore advisable to start the blind drives slightly staggered, in order to avoid excessive overall current values. This function block relays automatic commands from the input telegram st In [} 274] to the output telegram st Out [} 274] with a delay. A distinction is made between three cases 1. the blind position f Pos has changed in automatic mode (b Man Mode = FALSE in telegram st In) 2. the lamella angle f Angl has changed in automatic mode (b Man Mode = FALSE in telegram st In) 3. manual mode has just been exited, i.e. automatic mode has just become active (falling edge b Man Mode in telegram st In) The output telegram st Out is always a direct copy of the input telegram st In. In these three cases, however, the output telegram st Out is fixed for the time of n Dly [ms]. This ensures that the blind controlled via the function block FB_BA_Sun Bld Actr [} 374] is kept at its position during the delay period. Each further change based on the criteria mentioned above within the delay time restarts the timer. However, a change to manual in the input telegram (b Man Mode = TRUE) cancels the delay timer immediately. The (manual) telegram is passed on without delay. In this way, only automatic telegrams are delayed. Application Preferably directly before the blind actuator function block: TF8040 Version: 1.14.0 381
## Page 382

Programming Inputs VAR_INPUT st In : ST_BA_Sunblind; n Dly : UDINT; END_VAR Name Type Description st In ST_BA_Sun Bld [} 274] Input positioning telegram. n Dly UDINT Delay time of the active bit in the positioning telegram [ms]. Outputs VAR_OUTPUT st Out : ST_BA_Sunblind; n Rem Ti Dly : UDINT; END_VAR Name Type Description st Out ST_BA_Sun Bld [} 274] Output positioning telegram. n Rem Ti Dly UDINT Display output for elapsed delay time [s]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.22 FB_BA_Sun Bld Pos HMI The function block FB_BA_Sun Bld Pos HMI is used for position and angle specification via a user interface. With each rising edge at b Start an active positioning telegram with the target position f Pos and the slat angle f Angl is output at st Sun Bld. The input b Rst Man Fnct is used to reset the output telegram. The telegram is described as follows: st Sun Bld.b Actv := FALSE; st Sun Bld.f Pos := 0.0; st Sun Bld.f Angl := 0.0; The input b Rst Man Fnct has a static effect: as long as it is TRUE, the output telegram is set to the values mentioned above. 382 Version: 1.14.0 TF8040
## Page 383

Programming In addition, the function block output b Actv is set to FALSE. This is to indicate whether an active telegram is output. Inputs VAR_INPUT f Pos : REAL; f Angl : REAL; b Start : BOOL; b Rst Man Fnct : BOOL; END_VAR Name Type Description f Pos REAL Input of the target position f Angl REAL Input of the slat angle b Start BOOL A rising edge at this input outputs an active telegram with the entered target position f Pos and the slat angle f Angl. b Rst Man Fnct BOOL A TRUE at this input deletes the telegram at the output (st Sun Bld.b Actv = FALSE, b Actv = FALSE, st Sun Bld.f Pos = 0, st Sun Bld.f Angl = 0) and no new values are passed through. The output b Actv then also goes to FALSE. Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : E_BA_Sun Bld Prio := E_BA_Sun Bld Prio.e Manual Actuator; END_VAR Name Type Description e Prio E_BA_Sun Bld Prio [} 269] Priority of the output telegram. Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; END_VAR Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. b Actv BOOL Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 274] and is solely used to indicate whether the function block sends an active telegram. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.23 FB_BA_Sun Bld Prio Swi4 The function block FB_BA_Sun Bld Prio Swi4 is used for priority control for up to 4 positioning telegrams (st Sun Bld_Prio1 ... st Sun Bld_Prio4) of type ST_BA_Sun Bld [} 274] from different control function blocks. TF8040 Version: 1.14.0 383
## Page 384

Programming The telegram on st Sun Bld_Prio1 has the highest priority and that on st Sun Bld_Prio4 the lowest. The active telegram with the highest priority is output at st Sun Bld. Active means that the variable b Actv is set within the structure of the positioning telegram. This function block is to be programmed in such a way that one of the applied telegrams is always active. If no telegram is active, an empty telegram is output, i.e. f Pos = 0, f Angl = 0, b Man Up = FALSE, b Man Dwn = FALSE, b Man Mod = FALSE, b Actv = FALSE. Since the blind function block FB_BA_Sun Bld Actr [} 374] or the roller blind function block FB_BA_Rol Bld Actr [} 365] does not take account of the flag b Actv, this telegram would be interpreted as movement command to position "0", i.e. fully open. The absence of an active telegram therefore does not represent a safety risk for the blind. Inputs VAR_INPUT st Sun Bld_Prio1 : ST_BA_Sun Bld; st Sun Bld_Prio2 : ST_BA_Sun Bld; st Sun Bld_Prio3 : ST_BA_Sun Bld; st Sun Bld_Prio4 : ST_BA_Sun Bld; END_VAR Name Type Description st Sun Bld_Prio N ST_BA_Sun Bld [} 274] Positioning telegrams available for selection. st Sun Bld_Prio1 has the highest priority and st Sun Bld_Prio4 the lowest. Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; n Actv Prio : UDINT; END_VAR Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. n Actv Prio UDINT Active positioning telegram. If none is active, "0" is output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.24 FB_BA_Sun Bld Prio Swi8 The function block FB_BA_Sun Bld Prio Swi8 is used for priority control for up to 8 positioning telegrams (st Sun Bld_Prio1 ... st Sun Bld_Prio8) of type ST_BA_Sun Bld [} 274] from different control function blocks. The telegram on st Sun Bld_Prio1 has the highest priority and that on st Sun Bld_Prio8 the lowest. The active telegram with the highest priority is output at st Sun Bld. Active means that the variable b Actv is set within the structure of the positioning telegram. This function block is to be programmed in such a way that one of the applied telegrams is always active. If no telegram is active, an empty telegram is output, i.e. f Pos = 0, f Angl = 0, b Man Up = FALSE, b Man Dwn = FALSE, b Man Mod = FALSE, b Actv = FALSE. Since the blind function block FB_BA_Sun Bld Actr [} 374] or the 384 Version: 1.14.0 TF8040
## Page 385

Programming roller blind function block FB_BA_Rol Bld Actr [} 365] does not take account of the flag b Actv, this telegram would be interpreted as movement command to position "0", i.e. fully open. The absence of an active telegram therefore does not represent a safety risk for the blind. Inputs VAR_INPUT st Sun Bld_Prio1 : ST_BA_Sun Bld; st Sun Bld_Prio2 : ST_BA_Sun Bld; st Sun Bld_Prio3 : ST_BA_Sun Bld; st Sun Bld_Prio4 : ST_BA_Sun Bld; st Sun Bld_Prio5 : ST_BA_Sun Bld; st Sun Bld_Prio6 : ST_BA_Sun Bld; st Sun Bld_Prio7 : ST_BA_Sun Bld; st Sun Bld_Prio8 : ST_BA_Sun Bld; END_VAR Name Type Description st Sun Bld_Prio N ST_BA_Sun Bld [} 274] Positioning telegrams available for selection. st Sun Bld_Prio1 has the highest priority and st Sun Bld_Prio8 the lowest. Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; n Actv Prio : UDINT; END_VAR Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. n Actv Prio UDINT Active positioning telegram. If none is active, "0" is output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.25 FB_BA_Sun Bld Scn The function block FB_BA_Sun Bld Scn represents an extension of the manual operation FB_BA_Sun Bld Sw [} 388] by a scene memory and a call function. The blind actuator FB_BA_Sun Bld Actr [} 374] or the roller blind actuator FB_BA_Rol Bld Actr [} 365] can thus be controlled in manual operation mode and can also drive directly to previously saved positions (scenes). Up to 21 scenes can be saved. TF8040 Version: 1.14.0 385
## Page 386

Programming Operation In manual mode, the function block controls the blind function block FB_BA_Sun Bld Actr [} 374] or the roller blind function block FB_BA_Rol Bld Actr [} 365] via the command inputs b Up and b Dwn; b Up has priority. The commands are passed on to the respective commands b Man Up and b Man Dwn of the positioning telegram [} 274]. If a command input is activated for longer than the entered time n Swi Ovr Ti [ms], the corresponding control command latches. Activating a command input again releases this latch. A rising edge on b Sav Scn saves the current position and lamella angle in the scene selected in n Slcd Scn. This procedure is possible at any time, even during active positioning. A rising edge at b Cl Scn calls the scene that is present at input n Slcd Scn. This scene call can be interrupted by manual commands to b Up and b Dwn. Manual control and scene positioning are each carried out with the priority that is preselected under e Prio. If the function is no longer active due to the resetting of b En, then the active flag in the positioning telegram st Sun Bld [} 274] is reset and the positions for height and angle are set to "0". The priority function block (e.g. FB_BA_Sun Bld Prio Swi4) enables a function with lower priority to take over the control by resetting. Linking to the blind function block Like the "normal" manual mode function block FB_BA_Sun Bld Swi [} 388], the scene selection function block can be connected either via an upstream priority control FB_BA_Sun Bld Prio Swi4 or FB_BA_Sun Bld Prio Swi8, or directly via the blind function block. The connection is established via the positioning telegram ST_BA_Sunbld [} 274]. Furthermore the scene function block requires the current positions from the blind function block for the reference blind: Use of a priority controller: Direct connection: 386 Version: 1.14.0 TF8040
## Page 387

Programming Inputs VAR_INPUT b En : BOOL; b Up : BOOL; b Dwn : BOOL; n Swi Ovr Ti : UDINT; n Slcd Scn : UDINT; b Cl Scn : BOOL; b Sav Scn : BOOL; f Sp Pos : REAL; f Sp Angl : REAL; END_VAR Name Type Description b En BOOL The function block has no function if this input is FALSE. 0 is output for the position and the angle in the positioning telegram ST_BA_Sunbld [} 274] - b Man Mod and b Actv are set to FALSE. For a connection with priority controller this means that another functionality takes over control of the blind. Conversely, a direct connection allows the blind to drive directly to the 0 position, i.e. fully up, since the actuator function block does not evaluate the bit b Actv itself. b Up BOOL Command input for blind up. b Dwn BOOL Command input for blind down. n Swi Ovr Ti UDINT Time [ms] until the corresponding manual command in the positioning telegram ST_BA_Sunbld [} 274] switches to latching mode, if the command input is activated permanently. Internally limited to a minimum value of 0. n Slcd Scn UDINT Selected scene which should either be saved (b Sav Scn) or called (b Cl Scn). Internally limited to a minimum value from 0 to BA_Param.n Sun Prt_Max Sun Bld Scn [} 284] b Cl Scn BOOL Call selected scene b Sav Scn BOOL Save selected scene f Sp Pos REAL Set position [%] that is to be saved in the selected scene. This must be linked to the actual position of the actuator function block FB_BA_Sun Bld Actr or FB_BA_Rol Bld Actr of the reference blind/roller blind, in order to be able to save a position that was previously approached manually. Internally limited to values between 0 and 100. f Sp Angl REAL ditto slat angle [°] Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : E_BA_Sun Bld Prio := E_BA_Sun Bld Prio.e Scene1; END_VAR Name Type Description e Prio E_BA_Sun Bld Prio [} 269] Priority of the active telegram. / Inputs/Outputs VAR_IN_OUT a Sun Bld Scn : ARRAY[0.. BA_Param.n Sun Prt_Max Sun Bld Scn] OF ST_BA_Sun Bld Scn; END_VAR Name Type Description a Sun Bld Scn ARRAY OF Table with the scene entries ST_BA_Sun Bld Scn [} 275] TF8040 Version: 1.14.0 387
## Page 388

Programming Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; f Actl Scn Pos : REAL; f Actl Scn Angl : REAL; END_VAR Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. b Actv BOOL Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 274] and is solely used to indicate whether the function block sends an active telegram. f Actl Scn Pos REAL Indicates the saved relative blind height position [%] for the currently selected scene. f Actl Scn Angl REAL ditto slat angle [°] If an error occurs, this automatic control is disabled and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.26 FB_BA_Sun Bld Swi With the help of the function block FB_BA_Sun Bld Swi the blind actuator FB_BA_Sun Bld Actr [} 374] or the roller blind actuator FB_BA_Rol Bld Actr [} 365] can be controlled in manual operation mode. The connection takes place via the positioning telegram ST_BA_Sunbld [} 274] either directly or with an additional priority control. Operation In manual mode, the function block controls the blind function block FB_BA_Sun Bld Actr [} 374] or the roller shutter function block FB_BA_Rol Bld Actr [} 365] via the command inputs b Up and b Dwn; b Up has priority. The commands are passed on to the respective commands b Man Up and b Man Dwn of the positioning telegram. If a command input is activated that is longer than the entered time n Swi Ovr Ti [ms], then the corresponding control command latches. Activating a command input again releases this latch. If the function block is activated by input b En = TRUE, bit b Actv is set immediately in the positioning telegram. The function block uses this to indicate its priority over low priorities at the priority switch (see ....). At the same time, the bit b Man Mod is set in the positioning telegram to notify the connected actuator function blocks that they should respond to manual commands. If the function block is deactivated by b En = FALSE, both bits, b Actv and b Man Mod, are set to FALSE again. 388 Version: 1.14.0 TF8040
## Page 389

Programming Linking to the blind function block The manual mode function block can be connected either via an upstream priority control FB_BA_... or directly at the blind function block. The connection is established via the positioning telegram ST_BA_Sunbld [} 274]. Use of a priority controller: Direct connection: Inputs VAR_INPUT b En : BOOL; b Up : BOOL; b Dwn : BOOL; n Swi Ovr Ti : UDINT; END_VAR Name Type Description b En BOOL The function block has no function if this input is FALSE. 0 is output for the position and the angle in the positioning telegram ST_BA_Sunbld [} 274] - b Man Mod and b Actv are set to FALSE. For a connection with priority controller this means that another functionality takes over control of the blind. Conversely, a direct connection allows the blind to drive directly to the 0 position, i.e. fully up, since the actuator function block does not evaluate the bit b Actv itself. b Up BOOL Command input for blind up. b Dwn BOOL Command input for blind down. n Swi Ovr Ti UDINT Time [ms] until the corresponding manual command in the positioning telegram ST_BA_Sunbld [} 274] switches to latching mode, if the command input is activated permanently. Internally limited to a minimum value of 0. TF8040 Version: 1.14.0 389
## Page 390

Programming Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : E_BA_Sun Bld Prio := E_BA_Sun Bld Prio.e Manual Actuator; END_VAR Name Type Description e Prio E_BA_Sun Bld Prio [} 269] Priority of the active telegram. Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; END_VAR Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. b Actv BOOL Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 274] and is solely used to indicate whether the function block sends an active telegram. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.27 FB_BA_Sun Bld Tgm Sel4 The function block FB_BA_Sun Bld Tgm Sel4 is used for priority control for up to 4 positioning telegrams (st Sun Bld_Prio1 ... st Sun Bld_Prio4) of type ST_BA_Sun Bld [} 274] from different control function blocks. The active telegram with the highest priority is output at st Sun Bld. Active means that the variable b Actv is set within the structure of the positioning telegram. The priority is stored within the telegram structure as e Prio. The smaller the value of e Prio, the higher the priority. For telegrams with the same priority, the last changed one (last writer wins) is valid, determined by the variable n Evt Inc Sun Bld in the global variable list BA_Globals [} 283]. This function block is to be programmed in such a way that one of the applied telegrams is always active. If a telegram is not active, an empty telegram is output at the output: f Pos = 0, f Angl = 0, b Man Up = FALSE, b Man Dwn = FALSE, b Man Mod = FALSE, b Actv = FALSE; Since the blind function block FB_BA_Sun Bld Actr [} 374] or the roller blind function block FB_BA_Rol Bld Actr [} 365] does not take account of the flag b Actv, this telegram would be interpreted as movement command to position "0", i.e. fully open. The absence of an active telegram therefore does not represent a safety risk for the blind. 390 Version: 1.14.0 TF8040
## Page 391

Programming Inputs VAR_INPUT st Sun Bld Tgm_1 : ST_BA_Sun Bld; st Sun Bld Tgm_2 : ST_BA_Sun Bld; st Sun Bld Tgm_3 : ST_BA_Sun Bld; st Sun Bld Tgm_4 : ST_BA_Sun Bld; END_VAR Name Type Description st Sun Bld Tgm_1… ST_BA_Sun Bld [} 274] Telegram inputs st Sun Bld Tgm_4 Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; n Num Actv Tgm : UINT; e Prio Actv Tgm : E_BA_Sun Bld Prio; END_VAR Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. n Num Actv Tgm UINT Indicates which input is valid, e.g. if st Sun Bld Tgm_3 is passed, n Num Actv Tgm = 3. If n Num Actv Tgm = 0, no telegram is active. e Prio Actv Tgm E_BA_Sun Bld Prio [} 269] This output indicates the priority of the active telegram. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.28 FB_BA_Sun Bld Tgm Sel8 The function block FB_BA_Sun Bld Tgm Sel8 is used for priority control for up to 8 positioning telegrams (st Sun Bld_Prio1 ... st Sun Bld_Prio8) of type ST_BA_Sun Bld [} 274] from different control function blocks. The active telegram with the highest priority is output at st Sun Bld. Active means that the variable b Actv is set within the structure of the positioning telegram. The priority is stored within the telegram structure as e Prio. The smaller the value of e Prio, the higher the priority. For telegrams with the same priority, the last changed telegram (last writer wins) is valid, determined by the counter variable n Evt Inc Light in the global variable list BA_Globals [} 283]. This function block is to be programmed in such a way that one of the applied telegrams is always active. If a telegram is not active, an empty telegram is output at the output: f Pos = 0, f Angl = 0, b Man Up = FALSE, b Man Dwn = FALSE, b Man Mod = FALSE, b Actv = FALSE; TF8040 Version: 1.14.0 391
## Page 392

Programming Since the blind function block FB_BA_Sun Bld Actr [} 374] or the roller blind function block FB_BA_Rol Bld Actr [} 365] does not take account of the flag b Actv, this telegram would be interpreted as movement command to position "0", i.e. fully open. The absence of an active telegram therefore does not represent a safety risk for the blind. Inputs VAR_INPUT st Sun Bld Tgm_1 : ST_BA_Sun Bld; st Sun Bld Tgm_2 : ST_BA_Sun Bld; st Sun Bld Tgm_3 : ST_BA_Sun Bld; st Sun Bld Tgm_4 : ST_BA_Sun Bld; st Sun Bld Tgm_5 : ST_BA_Sun Bld; st Sun Bld Tgm_6 : ST_BA_Sun Bld; st Sun Bld Tgm_7 : ST_BA_Sun Bld; st Sun Bld Tgm_8 : ST_BA_Sun Bld; END_VAR Name Type Description st Sun Bld Tgm_1… ST_BA_Sun Bld [} 274] Telegram inputs st Sun Bld Tgm_8 Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; n Num Actv Tgm : UINT; e Prio Actv Tgm : E_BA_Sun Bld Prio; END_VAR Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. n Num Actv Tgm UINT Indicates which input is valid, e.g. if st Sun Bld Tgm_3 is passed, n Num Actv Tgm = 3. If n Num Actv Tgm = 0, no telegram is active. e Prio Actv Tgm E_BA_Sun Bld Prio [} 269] This output indicates the priority of the active telegram. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.29 FB_BA_Sun Bld Twi Lgt Auto The function block FB_BA_Sun Bld Twi Lgt Auto controls the blind when the outdoor brightness has fallen below a limit value. The twilight automatic works with a value and a time hysteresis: If the outdoor brightness value f Brtns [lx] falls below the value f Actv Val [lx] for the time n Actv Dly [s], then the function block is active and will provide the blind positions f Pos Twi Lgt (height [%]) and f Angl Twi Lgt (slat angle [°]) specified at the input variables at the output in the positioning telegram ST_BA_Sunbld [} 274]. Conversely, if the outdoor brightness exceeds 392 Version: 1.14.0 TF8040
## Page 393

Programming the value f Dctv Val[lx] for the time n Dctv Dly [s], the automatic function is no longer active. The active flag in the positioning telegram ST_BA_Sunbld [} 274] is reset and the positions for height and angle are set to "0". A function with a lower priority can then take over control. Inputs VAR_INPUT b En : BOOL; f Brtns : REAL; f Actv Val : REAL; f Dctv Val : REAL; n Actv Dly : UDINT; n Dctv Dly : UDINT; f Pos Twi Lgt : REAL; f Angl Twi Lgt : REAL; END_VAR Name Type Description b En BOOL The function block has no function if this input is FALSE. 0 is output for the position and the angle in the positioning telegram ST_BA_Sun Bld [} 274] - b Man Mod and b Actv are set to FALSE. This means that another function takes over control of the blind via the priority controller. Conversely, a direct connection allows the blind to drive directly to the 0 position, i.e. fully up, since the actuator function block does not evaluate the bit b Actv itself. f Brtns REAL Outdoor brightness [lx]. f Actv Val REAL Activation limit value [lx]. The value f Actv Val is internally limited to values from 0 to f Dctv Val. f Dctv Val REAL Deactivation limit value [lx]. Internally limited to a minimum value of 0. n Actv Dly UDINT Activation delay [s]. Internally limited to a minimum value of 0. n Dctv Dly UDINT Deactivation delay [s]. Internally limited to a minimum value of 0. f Pos Twi Lgt REAL Vertical position of the blind [%] if the twilight automatic is active. Internally limited to values between 0 and 100. f Angl Twi Lgt REAL Lamella angle of the blind [°] if the twilight automatic is active Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : E_BA_Sun Bld Prio := E_BA_Sun Bld Prio.e Group Twi Light Auto; END_VAR Name Type Description e Prio E_BA_Sun Bld Prio [} 269] Priority of the active telegram. Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; n Rem Ti Actv : UDINT; n Rem Ti Dctv : UDINT; END_VAR TF8040 Version: 1.14.0 393
## Page 394

Programming Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. b Actv BOOL Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 274] and is solely used to indicate whether the function block sends an active telegram. n Rem Ti Actv UDINT Shows the time remaining [s] after falling below the switch value f Actv Val until automatic mode is activated. This output is 0 as long as no countdown of the time is taking place. n Rem Ti Dctv UDINT Shows the time remaining [s] after exceeding of the switch value f Dctv Val until automatic mode is disabled. This output is 0 as long as no countdown of the time is taking place. If an error occurs, this automatic control is disabled and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.30 FB_BA_Sun Bld Wnd Prtc The function block FB_BA_Sun Bld Wnd Prtc deals with the direction-dependent wind protection. The weather protection has the highest priority in the blind controller (see overview [} 332]) and is intended to ensure that the blind is not damaged by ice or wind. If the measured wind speed lies above the value f Wnd Spd Strm On for the time n Dly Strm On [s], then it is assumed that a storm is directly impending. Only if the wind speed falls below the value f Wnd Spd Strm Off for the time n Dly Strm Off [s] is the storm considered to have abated and the driving of the blind considered to be safe. For safety reasons the storm event is also persistently saved. Thus, if the controller fails during a storm, the sequence timer is started again from the beginning when the controller is restarted. In wind hazard cases, the blind is moved to the protection position specified by f Pos Prot (height position [%]) and f Angl Prot (slat angle [°]). Inputs VAR_INPUT b En : BOOL; f Wnd Spd : REAL; f Wnd Spd Strm On : REAL; f Wnd Spd Strm Off : REAL; n Dly Strm On : UDINT; n Dly Strm Off : UDINT; 394 Version: 1.14.0 TF8040
## Page 395

Programming f Pos Prot : REAL; f Angl Prot : REAL; END_VAR Name Type Description b En BOOL The function block has no function if this input is FALSE. 0 is output for the position and the angle in the positioning telegram ST_BA_Sunbld [} 274] - b Man Mod and b Actv are set to FALSE. For a connection with priority controller this means that another functionality takes over control of the blind. f Wnd Spd REAL Wind speed. The unit of the entry is arbitrary, but it is important that no value is smaller than 0 and that the values become larger with increasing speed. f Wnd Spd Strm On REAL Wind speed limit value for the activation of the storm alarm. This value may not be smaller than 0 and must lie above the value for the deactivation. Otherwise an error is output. The unit of the entry must be the same as that of the input f Wnd Spd. A value greater than this limit value triggers the alarm after the entered time n Dly Strm On. f Wnd Spd Strm Off REAL Wind speed limit value for the deactivation of the storm alarm. This value may be not smaller than 0 and must lie below the value for the activation. Otherwise an error is output. The unit of the entry must be the same as that of the input f Wnd Spd. A value smaller than or equal to this limit value resets the alarm after the entered time n Dly Strm Off. n Dly Strm On UDINT Time delay until the storm alarm is triggered [s]. n Dly Strm Off UDINT Time delay until the storm alarm is reset [s]. f Pos Prot REAL Height position of the blind [%] in the case of protection. f Angl Prot REAL Slat angle of the blind [°] in the case of protection Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : E_BA_Sun Bld Prio := E_BA_Sun Bld Prio.e Storm; END_VAR Name Type Description e Prio E_BA_Sun Bld Prio [} 269] Priority of the active telegram. Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; b Strm Alm : BOOL; n Rem Ti Strm Detc : UDINT; n Rem Ti Strm Alm : UDINT; END_VAR TF8040 Version: 1.14.0 395
## Page 396

Programming Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. b Actv BOOL Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 274] and is solely used to indicate whether the function block sends an active telegram. b Strm Alm BOOL Indicates the storm alarm n Rem Ti Strm Detc UDINT In an uncritical case this second counter constantly indicates the alarm delay time n Dly Strm On. If the measured wind speed f Wnd Spd is above the activation limit value f Wnd Spd Strm On, the seconds to the alarm are counted down. This output is 0 as long as no countdown of the time is taking place. n Rem Ti Strm Alm UDINT As soon as the storm alarm is initiated, this second counter initially constantly indicates the deactivation time delay of the storm alarm n Dly Strm Off. If the measured wind speed f Wnd Spd falls below the deactivation limit value f Wnd Spd Strm Off, the seconds to the all-clear signal (b Strm Alm=FALSE) are counted down. This output is 0 as long as no countdown of the time is taking place If an error occurs, this automatic control is disabled and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.3.3.31 FB_BA_Sun Prtc The function block FB_BA_Sun Prtc is used for glare protection with the aid of a slatted blind. Glare protection is realized through variation of the slat angle and positioning of the blind height. The slat angle is set as a function of the sun position such that direct glare is prevented, while letting as much natural light through as possible. Three different operation modes are available for varying the blind height. 396 Version: 1.14.0 TF8040
## Page 397

Programming 1. When sun protection is active, the blind moves to a fixed height. The height value is specified with the variable f Fix Pos. 2. The blind position is varied as a function of the position of the sun. The position is specified in the table (ST_BA_Bld Pos Tab [} 273]). See also description of FB_BA_Bld Pos Entry [} 561]. 3. The high of the blind is calculated based on the window geometry such that the sun's rays reach a specified depth in the room. The incidence depth of the sun's rays is defined with the variable f Max Lgt Indc. In order to avoid excessive repositioning of the slat angle, the variable n Pos Intval [min] can be used to specify a time interval, within which the slat angle is not adjusted. In order to avoid glare, the angle is always changed sufficiently for the respective time interval. The following conditions must be met for positioning the blind and setting the slat angle. • 1. The input b En must be TRUE. • 2. The sun must have risen. (elevation > 0) • 3. The function block is parameterized correctly (b Err = False) Inputs VAR_INPUT b En : BOOL; t UTC : TIMESTRUCT; n Pos Intval : UDINT; f Deg Lngd : REAL; f Deg Latd : REAL; f Fcd Ortn : REAL; f Fcd Angl : REAL; f Lam Wdth : REAL; f Lam Dstc : REAL; f Fix Pos : REAL; f Max Lgt Indc : REAL; f Wdw Hght : REAL; f Dstc Wdw Flr : REAL; st Bld Pos Tab : ST_BA_Bld Pos Tab; e Pos Mod : E_BA_Pos Mod := E_BA_Pos Mod.e Fix; END_VAR Name Type Description b En BOOL If this input is set to FALSE, the positioning is inactive, i.e. the active bit (b Actv) is reset in the positioning structure st Sun Bld of the type ST_BA_Sun Bld [} 274] and the function block itself remains in a standstill mode. If on the other hand the function block is activated, then the active bit is TRUE and the function block outputs its control values (f Pos, f Angl) in the positioning structure at the appropriate times. st UTC TIMESTRUCT Input of current time as UTC - Coordinated Universal Time (previously referred to as GMT, Greenwich Mean Time) (see TIMESTRUCT). The function block FB_BA_Get Time [} 618] can be used to read this time from a target system. A jump of more than 300 seconds leads to immediate repositioning, if the blind is in the sun and glare protection is active, based on the above criteria. This functionality was added to ensure a reproducible program execution. Name Type Description n Pos Intval UDINT Positioning interval in minutes - time between two blind position outputs. Valid range: 1 min...720 min. f Deg Lngd REAL Longitude [°]. Valid range: - 180°...180°. f Deg Latd REAL Latitude [°]. Valid range: - 90°...90°. f Fcd Ortn REAL Facade orientation [°]. TF8040 Version: 1.14.0 397
## Page 398

Programming In the northern hemisphere, the following applies for the facade orientation (looking out of the window): Viewing direction Facade orientation North β=0° East β=90° South β=180° West β=270° The following applies for the southern hemisphere: Viewing direction Facade orientation South β=0° East β=90° North β=180° West β=270° Name Type Description f Fcd Angl REAL Facade inclination [°] (see Facade inclination [} 336]). f Lam Wdth REAL Width of the lamellas in mm (see sketch [} 333]). f Lam Dstc REAL Lamella spacing in mm (see sketch [} 333]). f Fix Pos REAL Fixed (constant) blind height [0...100%]. Applies if e Pos Mod = e Pos Mod Fix (see E_BA_Pos Mod [} 685]). f Max Lgt Indc REAL Maximum desired light incidence in mm measured from the outside of the wall (see height adjustment [} 558]). The parameters f Wdw Hght and f Dstc Wdw Flr are used to calculate how high the blinds must be, depending on the position of the sun, such that the incidence of light does not exceed the value f Max Lgt Indc. Applies if e Pos Mod = e Pos Mode Max Incidence (see E_BA_Pos Mod). f Wdw Hght REAL Window height in mm for the calculation of the blind height if the mode "maximum desired incidence of light" is selected. f Dstc Wdw Flr REAL Distance between the floor and the window sill in mm for the calculation of the blind height if the mode "maximum desired incidence of light" is selected. st Bld Pos Tab ST_BA_Bld Pos Tab [} 273] Table of 6 interpolation points, 4 of which are parameterizable, from which a blind position is then given in relation to the position of the sun by linear interpolation. Applies if e Pos Mod = e Pos Mod Fix (see E_BA_Pos Mod). For a more detailed description please refer to FB_BA_Bld Pos Entry [} 561]. e Pos Mod E_BA_Pos Mod Selection of the positioning mode Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Prio : E_BA_Sun Bld Prio := E_BA_Sun Bld Prio.e Sun Protection; f Angl Lmt Up : REAL; END_VAR Name Type Description e Prio E_BA_Sun Bld Prio [} 269] Priority of the active telegram. f Angl Lmt Up REAL Slats do not need to be opened above 0°. 398 Version: 1.14.0 TF8040
## Page 399

Programming Outputs VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; b Err : BOOL; s Error Descr : T_MAXSTRING; END_VAR Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Output telegram, for the position and angle of the lamella. b Actv BOOL Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 274] and is solely used to indicate whether the function block sends an active telegram. b Err BOOL In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr T_MAXSTRING Contains the error description Error description 01: Error: The duration of the positioning interval is less than or equal to zero, or it exceeds 720 min. 02: Error: The value entered for the longitude is not in the valid range of -180°...180°. 03: Error: The value entered for the latitude is not in the valid range of -90°...90°. 04: Error: The value entered for the facade inclination f Fcd Angl is outside the valid range of -90°..90°. 05: Error: The value for the slat spacing (f Lam Dstc) is greater than or equal to the value for the slat width (f Lam Wdth). This does not represent a "valid" blind, since the slats cannot close fully. Mathematically, this would lead to errors. 06: Error: The value entered for the slat width f Lam Wdth is zero. 07: Error: The value entered for the slat spacing f Lam Dstc is zero. 08: Error: The value entered for the fixed blind height (f Fix Pos) is greater than 100 or less than 0. At the same time, positioning "fixed blind height" is selected - e Pos Mod = e Pos Mod Fix. 09: Error: The "Values valid" bit (b Vld) in the st Bld Pos Tab positioning table is not set - invalid values, see FB_BA_Bld Pos Entry. At the same time, "Table" positioning is selected – e Pos Mod = e Pos Mod Tab. 10: Error: The value entered for the maximum required light incidence f Max Lgt Indc is less than or equal to zero. At the same time, "maximum light incidence" is selected – e Pos Mod = e Pos Mod Max Indc. 11: Error: The value entered for the window height f Wdw Hght is less than or equal to zero. At the same time, "maximum light incidence" is selected – e Pos Mod = e Pos Mod Max Indc. 12: Error: The distance between lower window edge and floor f Dstc Wdw Flr that was entered is less than zero. At the same time, "maximum light incidence" is selected – e Pos Mod = e Pos Mod Max Indc. 13: Error: An invalid positioning mode is entered at input e Pos Mod. If an error occurs, this automatic control is disabled and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 399
## Page 400

Programming 6.1.2.2.3.1.4 System 6.1.2.2.3.1.4.1 FB_BA_Cnvt Ti St The function block FB_BA_Cnvt Ti St can be used to combine the individual components of a time structure into a single structure. The function block does not check for incorrect entries, such as an hour entry of 99. It makes sense to check this in the connected function blocks, which have to check the time structure in any case. The limit values are shown as part of the variable explanations. Inputs VAR_INPUT n Year : WORD; n Month : WORD; n Day : WORD; n Hour : WORD; n Minute : WORD; n Second : WORD; n Milliseconds : WORD; END_VAR Name Type Description n Year WORD The year (1970...2106). n Month WORD The month (1...12). n Day WORD The day of the month (1...31). n Hour WORD The hour (0...23). n Minute WORD The minute (0...59). n Second WORD The second (0...59). n Milliseconds WORD The millisecond (0...999). Outputs VAR_OUTPUT b New Data : BOOL; t Ti : TIMESTRUCT; END_VAR Name Type Description b New Data BOOL The output is TRUE in the cycle in which the input variables have changed. t Ti TIMESTRUCT Output time structure Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 400 Version: 1.14.0 TF8040
## Page 401

Programming 6.1.2.2.3.1.4.2 FB_BA_Ext Ti St The function block FB_BA_Ext Ti St resolves a time structure into the different components, so that it can be used for time conditions, for example. Inputs VAR_INPUT t Ti : TIMESTRUCT; END_VAR Name Type Description t Ti TIMESTRUCT Input time structure VAR_OUTPUT VAR_OUTPUT n Year : WORD; n Month : WORD; n Day Of Week : WORD; n Day : WORD; n Hour : WORD; n Minute : WORD; n Second : WORD; n Milliseconds : WORD; END_VAR Name Type Description n Year WORD The year (1970...2106). n Month WORD The month (1...12). n Day Of Week WORD The day of the week (0 (Sun)...0 (Sat)). n Day WORD The day of the month (1...31). n Hour WORD The hour (0...23). n Minute WORD The minute (0...59). n Second WORD The second (0...59). n Milliseconds WORD The millisecond (0...999). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 401
## Page 402

Programming 6.1.2.2.3.1.4.3 FB_BA_Get Time The function block FB_BA_Get Time can be used to implement an internal clock (Real Time Clock RTC) in the Twin CAT PLC. When the function block is enabled via b En, the RTC clock is initialized with the current NT system time. One system cycle of the CPU is used to calculate the current RTC time. The function block must be called once per PLC cycle in order for the current time to be calculated. Internally, an instance of the function blocks NT_Get Time, FB_Get Time Zone Information and RTC_EX2 is called in the function block. The time is output at the outputs t Sys Ti for the read system time and t Utc Ti for the Coordinated Universal Time (UTC). This is determined internally from the system time and the time zone. If the system time and/or the time zone was entered incorrectly, the UTC time will also be wrong. The system time is read cyclically via the timer to be set (n Upd RTC [sec]); it is used to synchronize the internal RTC clock. The time information (time zone, time shift relative to UTC, summer/winter time) is read in the same cycle. The output n Rem Ti Upd indicates the seconds remaining to the next read cycle. The time structures that are output, dt Sys Ti and dt Utc, can be resolved with the aid of the function block FB_BA_Ext Ti St into the components day, month, hour, minute etc. Information on the read/wait cycle During the read cycle, the outputs b Rdy Sys Ti and b Rdy Ti Zo Info change to FALSE, and the enumerator e Ti ZId shows 0 = e Time Zone ID_Unknown. If the read operation was successful, the outputs switch back to TRUE or show the respective information for summer or winter time, if available. If the read operation was unsuccessful - internally the system waits for a response for 5 seconds - the outputs remain at FALSE or 0, and another wait cycle is started before the next read cycle. Although the internal RTC clock is not synchronized in the event of an error and may still show the right time, the time information may be wrong, and therefore also the UTC time. Errors during the read cycle will, any case, show up in b Err and s Err Descr. The countdown output n Rem Ti Upd is not restarted until the wait cycle starts. Inputs VAR_INPUT b En : BOOL; t Net Id : T_Ams Net Id;; n Upd Rtc : UDINT; b Upd Rtc : BOOL; END_VAR 402 Version: 1.14.0 TF8040
## Page 403

Programming Name Type Description b En BOOL Enables the function block. If b En = TRUE, then the RTC clock is initialized with the NT system time. t Net Id T_Ams Net ID This parameter can be used to specify the Ams Net ID of the Twin CAT computer, whose NT system time is to be read as timebase. For the local computer an empty string may be specified. n Upd Rtc UDINT Time specification [s] with which the RTC clock is regularly synchronized with the NT system time. Internally this value is limited to a minimum of 5 seconds, in order to ensure correct processing of the internal function blocks. b Upd Rtc BOOL In parallel with the time n Upd Rtc, the RTC clock can be synchronized via a positive edge at this input Outputs VAR_OUTPUT b Rdy Sys Ti : BOOL; b Rdy Ti Zo Info : BOOL; b Rdy RTC : BOOL; n Rem Ti Upd : UDINT; t Sys Ti : TIMESTRUCT; t UTC : TIMESTRUCT; dt Sys Ti : DT; dt UTC : DT; n Current Time_ms : UDINT e Ti ZId : E_Time Zone ID; b Err : BOOL; s Err Descr : T_MAXSTRING; END_VAR TF8040 Version: 1.14.0 403
## Page 404

Programming Name Type Description b Rdy Sys Ti BOOL The system time was read successfully from the target system. b Rdy Ti Zo Info BOOL The additional time information (time zone, time shift relative to UTC and summer/winter time) was read successfully. b Rdy RTC BOOL This output is set if the function block has been initialized at least once. If this output is set, then the values for date, time and milliseconds at the outputs are valid. n Rem Ti Upd UDINT Countdown to next synchronization/update of the time information. t Sys Ti TIMESTRUCT System time of the read target system. The time structure can be resolved with the aid of the function block FB_BA_Ext Ti St into its components: day, month, hour, minute etc. Info: If the function block is not enabled (b En = FALSE), the output st Sys Ti and its subelements (day month, etc.) show 0. t UTC TIMESTRUCT Coordinated Universal Time. This is determined internally from the system time and the time information read from the target system. The time structure can be resolved with the aid of the function block FB_BA_Ext Ti St into its components: day, month, hour, minute etc. Info: If the function block is not enabled (b En=FALSE), the output t UTC and its subelements (day month, etc.) show 0. dt Sys Ti / dt UTC DT Same as st Sys Ti/ st UTC, but in DATE-AND-TIME format: year-month-day-hour-minute-seconds. Info: If the function block is not enabled (b En = FALSE), the outputs dt Sys Ti and dt UTC each display DT#1970-01-01-00:00, since this is the lower limit and it corresponds to the zeros in the structure representation of dt Sys Ti / dt UTC. n Current Time UDINT Current time of day [ms] e Ti ZId E_Time Zone ID Enumerator for summer/winter time information. b Err BOOL This output is switched to TRUE if the parameters entered are erroneous. s Err Descr T_MAXSTRING Contains the error description Error description 01: Warning: ADS error when reading the time (NT_Get Time). The ADS error number is stated. 02: Warning: ADS error when reading the time zone information (FB_Get Time Zone Information). The ADS error number is stated. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.4.4 FB_BA_Set Time 404 Version: 1.14.0 TF8040
## Page 405

Programming The local NT system time and the date of a Twin CAT system can be set with the function block FB_BA_Set Time (the local NT system time is shown in the taskbar). The system time is specified via the structure t Sys Ti. Internally, an instance of the function block NT_Set Local Time from the Tc Utilities library is called in the function block. The local NT system time can also be synchronized with a reference time with the aid of the SNTP protocol. More information can be found in the Beckhoff Information System under: Beckhoff Information System > Embedded PC > Operating systems > CE > SNTP: Simple Network Time Protocol Inputs VAR_INPUT b Set : BOOL; t Net Id : T_Ams Net Id; t Sys Ti : TIMESTRUCT; n Ti Out : UDINT; END_VAR Name Type Description b Set BOOL Activation of the function block with a rising edge. t Net Id T_Ams Net ID This parameter can be used to specify the Ams Net ID of the Twin CAT computer, whose local NT system time is to be set. If applicable, an empty string s Net Id := ''; can be specified for the local computer. t Sys Ti TIMESTRUCT Structure with the new local NT system time. If the time is not available as structure, it is advisable to use the function block FB_BA_Cnvt Ti St [} 400], which brings the subvariables of date and time in a structure together. n Ti Out UDINT Indicates the timeout time [s], which must not be exceeded during execution. TF8040 Version: 1.14.0 405
## Page 406

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING; END_VAR Name Type Description b Busy BOOL If the function block is activated via a rising edge at b Set, this output is set and remains set until feedback occurs. b Err BOOL This output is set to TRUE, if either the system time to be transferred is incorrect or an ADS error occurs during the transfer. s Err Descr T_MAXSTRING Contains the error description Error description 01: Error: Error range exceeded year 02: Error: Error range exceeded month 03: Error: Error range exceeded day of the month 04: Error: Error range exceeded hour 05: Error: Error range exceeded minute 06: Error: Error range exceeded second 07: Error: Error range exceeded millisecond 08: Warning: An ADS error occurred while setting the time (NT_Set Local Time). The ADS error number is stated. Time specification limits The created time structure st Sys Ti is internally checked for limits (see TIMESTRUCT). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5 Universal 6.1.2.2.3.1.5.1 Actuators 6.1.2.2.3.1.5.1.1 FB_BA_Actuator_3Point The function block FB_BA_Actuator_3Point is used to control a 3-point actuator, e.g. a 3-point damper or a 3-point valve. The command for opening the actuator is connected to output b Open. The command for closing the actuator is connected to output b Close. In automatic mode (n Op Mode = 0) the control commands of b Cmd Open and b Cmd Close are forwarded directly to the outputs b Open and b Close. 406 Version: 1.14.0 TF8040
## Page 407

Programming The n Op Mode input is used to determine the operation mode of the 3-point actuator: • 0 = Automatic • 1 = Stop (b Open = b Close = FALSE) • 2 = Close • 3 = Open Inputs VAR_INPUT b En : BOOL; b Auto Open : BOOL; b Auto Close : BOOL; n Op Mode : UDINT END_VAR Name Type Description b En BOOL General enable of the function block. b Auto Open BOOL Command to open the actuator b Auto Close BOOL Command to close the actuator. n Op Mode UDINT Select operation mode (0 = Automatic, 1 = Stop (b Open = b Close = FALSE), 2 = Close, 3 = Open). Outputs VAR_OUTPUT b Open : BOOL; b Close : BOOL; END_VAR Name Type Description b Open BOOL Open control output b Close BOOL Close control output Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.1.2 FB_BA_Anlg3Pnt The function block FB_BA_Anlg3Pnt is intended for control of three-point actuators for valves or dampers. A continuous control signal for positioning an actuator is converted into the binary commands for opening and closing. If the deviation between the position setpoint f In and the calculated actual position value f Pos of the actuator is greater than the set threshold f Hys / 2, the function block starts to correct the position by switching the outputs b Opn or b Cls, depending on the amount of the control deviation: TF8040 Version: 1.14.0 407
## Page 408

Programming b Opn b Cls f In - f Pos > f Hys / 2 TRUE FALSE f In - f Pos < - f Hys / 2 FALSE TRUE If the function block reaches an end position f Out = 0 or f Out = 100 through a corresponding input value f In, the corresponding switching output remains permanently set in order to safely reach this end position at the valve or damper: b Opn b Cls f Out = 0 FALSE permanently TRUE f Out = 100 permanently TRUE FALSE Any deactivation of the continuous signal must be implemented by the user through external programming. The input f In is automatically limited internally to the range of 0...100 %. This also applies to the inputs f Hys and f Ref Val. The travel times n Ti Cls as well as n Ti Opn are both limited downwards to 10 (milliseconds). A rising edge at b Ref triggers a referencing command (setting the calculated actual position to f Ref Val). If the drive has limit switches, these can also be detected directly by means of a digital input and used for referencing at b Ref. Inputs VAR_INPUT f In : REAL; f Hys : REAL; n Ti Cls : UDINT; n Ti Opn : UDINT; b Ref : BOOL; f Ref Val : REAL; b Close Init : BOOL; END_VAR Name Type Description f In REAL Setpoint for the actuator position [0…100 %]. Internally limited to values between 0 and 100. f Hys REAL Hysteresis for the actuator position [0…100 %]. Internally limited to values between 0 and 100. n Ti Cls UDINT Run time of the actuator from open to closed [ms]. Internally limited to values between 0 and 100. n Ti Opn UDINT Run time of the actuator from closed to open [ms]. Internally limited to values between 0 and 100. b Ref BOOL Edge references the internal position memory of the drive to value of f Ref Val [0…100 %]. f Ref Val REAL Value for referencing the actuator with b Ref [0…100 %]. Internally limited to values between 0 and 100. b Close Init BOOL If this input is TRUE, output b Cls is TRUE for the time udi Ti Opn_ms. Outputs VAR_OUTPUT b Cls : BOOL; b Opn : BOOL; f Pos : REAL; END_VAR Name Type Description b Cls BOOL Output for closing the actuator. b Opn BOOL Output for opening the actuator. f Pos REAL Current calculated actuator position [0…100 %]. 408 Version: 1.14.0 TF8040
## Page 409

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.1.3 FB_BA_Ant Blkg This function block FB_BA_Ant Blkg prevents blocking of pumps or actuators after prolonged idle periods by issuing a switch-on pulse. Generally, a pulse output only occurs if the function block at b En is enabled. The maximum idle period before such a pulse is issued is determined by the value of the variable n Off Min. For logging the idle time, the input b Fdb must be linked to the operating feedback from the aggregate. The length of the pulse is parameterized with the variable n Impl Lngt. For this function the operation mode E_BA_Ant Blkg Mode.e Off Time must be set. The input b Ext Req should be used if the blocking protection pulse is to be issued cyclically based on a schedule, rather than depending on the idle times. A rising edge at b Ext Req immediately triggers output of a pulse to b Q. For this function the operation mode E_BA_Ant Blkg Mode.e External Request must be set. Inputs VAR_INPUT b En : BOOL; b Fdb : BOOL; b Ext Req : BOOL; b Lock : BOOL; n Off Min : UDINT; n Impl Lngt : UDINT; END_VAR TF8040 Version: 1.14.0 409
## Page 410

Programming Name Type Description b En BOOL b En is the general enable of the function block. If b En is FALSE, the message output b Q is also FALSE. b Fdb BOOL Input for connecting the feedback signal of a motor or valve. This input is only considered in the operation mode E_BA_Ant Blkg Mode.e Off Time. b Ext Req BOOL Active in the E_BA_Ant Blkg Mode.e External Request operation mode. External request for a pulse, for example from a schedule. With a rising edge the blocking protection pulse is started. b Lock BOOL Active in the operation modes E_BA_Ant Blkg Mode.e External Request or E_BA_Ant Blkg Mode.e Off Time. To prevent that e.g. the pump and the valve of a heater get a pulse at the same time, the output of the pulse is always suppressed until b Lock is FALSE again. If b Lock becomes TRUE during the output of a blocking protection pulse, then the blocking protection pulse is interrupted. After b Lock is FALSE again, the blocking protection pulse is restarted. n Off Min UDINT Minimum switch-off time of the actuator without movement of the motor or valve [s]. n Impl Lngt UDINT Length of the blocking protection pulse [s] at b Q. Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT e Mode : E_BA_Ant Blkg Mode := E_BA_Ant Blkg Mode.e Off Time; END_VAR Name Type Description e Mode E_BA_Ant Blkg Mode Input that specifies the operation mode of the function block E_BA_Ant Blkg Mode.e Off - the operation mode e Off is similar to the input b En. If this operation mode is active, the pulse output b Q is FALSE. E_BA_Ant Blkg Mode.e External Request - External request for a pulse, for example from a schedule. With a rising edge the blocking protection pulse is started. E_BA_Ant Blkg Mode.e Off Time - Minimum switch-off time of the actuator without movement of the motor or valve (b Fdb = FALSE). After the timer has expired, the blocking protection pulse is started. Outputs VAR_OUTPUT b Q : BOOL; n Rem Off Min : UDINT; n Rem Impl Lngt : UDINT; END_VAR Name Type Description b Q BOOL Output for the blocking protection pulse. n Rem Off Min UDINT Remaining time [s] before the next pulse is issued in the absence of movement. n Rem Impl Lngt UDINT Remaining residual time [s] of the pulse at b Q. 410 Version: 1.14.0 TF8040
## Page 411

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.1.4 FB_BA_Motor1St The function block FB_BA_Motor1St is used to control 1-step motors. The input b En is used for enabling the function block. The input n Op Mode is used to set the operation mode of the motor: • 0 = Automatic • 1 = Manual off • 2 = Manual on In automatic mode (n Op Mode = 0) the motor can be operated via inputb Auto (b Auto = b Q =TRUE). The collection of all possible malfunctions of a motor is connected to b Dst. Inputs VAR_INPUT b En : BOOL; b Auto : BOOL; b Dst : BOOL; n Op Mode : UDINT; END_VAR Name Type Description b En BOOL Enable motor. b Auto Open BOOL Actuator request in automatic mode (n Op Mode = 0). b Dst BOOL Input for collecting the possible motor malfunctions. n Op Mode UDINT Selection of the operation mode (0 = Automatic, 1 = Manual off, 2 = Manual on). Outputs VAR_OUTPUT b Q : BOOL; END_VAR Name Type Description b Q BOOL Control output Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 411
## Page 412

Programming 6.1.2.2.3.1.5.1.5 FB_BA_Motor2St The function block FB_BA_Motor2St is used to control 2-step motors. The input b En is used for enabling the function block. The input n Op Mode is used to set the operation mode of the motor: • 0 = Automatic • 1 = Manual off • 2 = Manual step 1 • 3 = Manual step 2 In automatic mode (n Op Mode = 0) the desired step can be set via the inputs b Auto St1 (step 1) and b Auto St2 (step 2). The collection of all possible malfunctions of a motor is connected to b Dst. Inputs VAR_INPUT b En : BOOL; b Auto St1 : BOOL; b Auto St2 : BOOL; b Dst : BOOL; n Op Mode : UDINT; END_VAR Name Type Description b En BOOL Enable motor b Auto St1 BOOL Request of the actuator to step 1 in automatic mode (n Op Mode = 0). b Auto St2 BOOL Request of the actuator to step 2 in automatic mode (n Op Mode = 0). b Dst BOOL Input for collecting the possible motor malfunctions. n Op Mode UDINT Selection of the operation mode (0 = Automatic, 1 = Manual off, 2 = Manual step 1, 3 = Manual step 2). Outputs VAR_OUTPUT b Q1 : BOOL; b Q2 : BOOL; END_VAR Name Type Description b Q1 BOOL Control output step 1 b Q2 BOOL Control output step 2 Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 412 Version: 1.14.0 TF8040
## Page 413

Programming 6.1.2.2.3.1.5.1.6 FB_BA_Motor Stp Ctrl The function block FB_BA_Motor Stp Ctrl is used to control multi-stage drives. The program always starts at level 1 and, depending on the requirements of n Value, switches step by step to the next higher level. Switching up and down into the individual steps is influenced by the 3 time specifications n Step Up Dly, n Step Dwn Dly and n Chang Over Time. In case of a restart or by removing the enable, a restart of the drive is inhibited for the time period of (n Out * n Step Dwn Dly). This time course is indicated by the output variable n Rem Release. Internally the last active state of n Out is persistently stored for the calculation of the blocking time. Example Error handling The limitation of the input value n Num Of Stp is monitored and corrected internally. n Num Of Stp < 1 is adjusted to the value 1 and a detailed description is output via the Error Description property. n Num Of Stp > 9 is adjusted to the value 9 and a detailed description is output via the Error Description property. In addition, a warning message is output in the Error List window of the Twin CAT programming tool. The limitation of the input value n Value is monitored and corrected internally. n Value < 1 is adjusted to the value 1 and via the property Error Description a detailed description is output. n Value > 9 is adjusted to the value 9 and via the property Error Description a detailed description is output. In addition, a warning message is output in the Error List window of the Twin CAT programming tool. TF8040 Version: 1.14.0 413
## Page 414

Programming Inputs VAR_INPUT b En : BOOL; n Value : UDINT; END_VAR Name Type Description b En BOOL General enable of the function block. If b En is FALSE, then all output variables are FALSE or have the value 0. n Value UDINT Step to be controlled from 1 to 9. n Value Request 1 Off 2 b Step01 3 b Step02 4 b Step03 5 b Step04 6 b Step05 7 b Step06 8 b Step07 9 b Step08 Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT n Step Up Dly : UDINT := 3000; n Step Dwn Dly : UDINT := 1000; n Chang Over Time : UDINT := 100; n Num Of Stp : UDINT := 4; END_VAR Name Type Description n Step Up Dly UDINT Minimum switch-on time of the respective step [ms]. n Step Dwn Dly UDINT Switch-back time or switch-off time of the steps [ms]. n Chang Over Time UDINT Time delay for the changeover phase when switching up [ms] between the steps in order to protect the motor windings. During this time, all outputs are FALSE and n Out = 1. n Num Of Stp UDINT Input of the number of steps required. The input is limited to a range from 1 to 9. Outputs VAR_OUTPUT n Out : UDINT; b Step01 : BOOL; b Step02 : BOOL; b Step03 : BOOL; b Step04 : BOOL; b Step05 : BOOL; b Step06 : BOOL; b Step07 : BOOL; b Step08 : BOOL; n Rem Step Up Dly : UDINT; n Rem Step Dwn Dly : UDINT; n Rem Chang Over Time : UDINT; n Rem Release : UDINT; END_VAR 414 Version: 1.14.0 TF8040
## Page 415

Programming Name Type Description n Out UDINT Output of the currently valid step from 1 to 9. b Step0N BOOL Output of step N depending on the stepped output signal n Out. n Rem Step Up Dly UDINT Remaining time of the minimum switch-on time of the respective step [ms]. n Rem Step Dwn Dly UDINT Remaining time of the switch-back time or switch-off time of the steps [ms]. Rem Chang Over Tim UDINT Remaining time of the changeover time when switching up e and down [ms]. n Rem Release UDINT Remaining time of the internal blocking of the function block after a restart or by removing the enable b En [ms]. Properties Name Type Access Description Error Description T_Max String Get Issues a detailed description of errors, see error handling [} 413]. Number Of Steps UDINT Get Outputs the current or corrected value of the number of steps. In the error case of n Num Of Stp there is a detailed description of the error at error handling [} 413]. Step STRING Get Output of the current step depending on n Out. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.1.7 FB_BA_PWM The function block FB_BA_PWM calculates from an analog input signal r In (0...100 %, internally fixed) and the period duration n Prd [s] a switch-on and a switch-off time f Act Ti Onand f Act Ti Off [s]. The following relationships apply: • 100% at the input of a switch-on time f Act Ti On of the total period n Prd and a switch-off time f Act Ti Off of 0 s • 0 % at the input of a switch-on time f Act Ti On of 0 s and a switch-off time f Act Ti Off of the total period duration n Prd. In addition, there is the possibility to limit the switching time downwards via n Min Swi Ti [s] to avoid damage to drives by too short actuating pulses. This behavior is only valid for 0> f In >100! If f In = 0 or 100, the output b Q remains deleted or set. After the period time has elapsed, the current input signal is evaluated again. If it is still set to 0 or 100, there is no change of state of b Q. TF8040 Version: 1.14.0 415
## Page 416

Programming Switching characteristics 1. A FALSE signal at input b En disables the function block and sets b Q to FALSE. Only the switch-on and switch-off times are continuously calculated and displayed at the outputs f Act Ti On /f Act Ti Off [s]. 2. A rising edge at input b En enables the function block: It will initially jump to a decision step. Depending on the previous state of the switching output b Q, the switching step is now accessed. However, if the input f In is set to 0, an immediate jump occurs to the Off step (b Q=FALSE), or to the On step if f In=100 (b Q=TRUE), irrespective of the previous state of b Q. The minimum switching time is deactivated for these two cases. 3. A countdown timer with the current calculated starting value runs in the respective active step (ON or OFF), which is based on the pulse/pause ratio. The on- or off-step is completed with the calculated time, irrespective of whether the pulse/pause ratio changes in the meantime. The respective countdown is displayed at the outputs n Rem Ti On / n Rem Ti Off in full seconds. 4. Completion of the on- or off-step is followed by a jump back to the decision step (point 2). Inputs VAR_INPUT b En : BOOL; f In : REAL; n Prd : UDINT; n Min Swi Ti : UDINT; END_VAR Name Type Description b En BOOL Activation of pulse width modulation. f In REAL Input signal, internally limited to 0...100%. n Prd UDINT Period time[s]. Internally limited to a minimum value of 0. n Min Swi Ti UDINT Minimum switch-on time [s], to avoid too short pulses. Internally limited to values between 0 and n Prd. Outputs VAR_OUTPUT b Q : BOOL; b Lmt Swi Ti : BOOL; f Act Ti On : REAL; f Act Ti Off : REAL; n Rem Ti On : UDINT; n Rem Ti Off : UDINT; END_VAR Name Type Description b Q BOOL PWM output. b Lmt Swi Ti BOOL Information output to indicate that the input signal is so low that the minimum switch-on time is used as limit. f Act Ti On REAL Information output: calculated switch-on time [s]. f Act Ti Off REAL Information output: calculated switch-off time [s]. n Rem Ti On UDINT Switch-on timer countdown [s]. n Rem Ti Off UDINT Switch-off timer countdown [s]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 416 Version: 1.14.0 TF8040
## Page 417

Programming 6.1.2.2.3.1.5.2 Control 6.1.2.2.3.1.5.2.1 FB_BA_Cont Stp The function block FB_BA_Cont Stp determines the resulting control steps of a multi-level aggregate, depending on the continuous input signal f In. TF8040 Version: 1.14.0 417
## Page 418

Programming n Ac- n Nu- f Swi O f Swi O n Rem n Rem b Q01 b Q02 b Q03 b Q04 b Q05 b Q06 b Q07 b Q08 tive St m Of- n ff Ti D- Ti Dly- ep Step ly On Off 0 0 f Swi O f Swi O n Dly O FALS FALS FALS FALS FALS FALS FALS FALS n01 n01 - n01 E E E E E E E E f Hys01 1 > = 1 f Swi O f Swi O n Dly O n Dly Of TRUE FALS FALS FALS FALS FALS FALS FALS n02 n01 - n02 f01 E E E E E E E f Hys01 2 > = 2 f Swi O f Swi O n Dly O n Dly Of TRUE TRUE FALS FALS FALS FALS FALS FALS n03 n02 - n03 f02 E E E E E E f Hys02 3 > = 3 f Swi O f Swi O n Dly O n Dly Of TRUE TRUE TRUE FALS FALS FALS FALS FALS n04 n03 - n04 f03 E E E E E f Hys03 4 > = 4 f Swi O f Swi O n Dly O n Dly Of TRUE TRUE TRUE TRUE FALS FALS FALS FALS n05 n04 - n05 f04 E E E E f Hys04 5 > = 5 f Swi O f Swi O n Dly O n Dly Of TRUE TRUE TRUE TRUE TRUE FALS FALS FALS n06 n05 - n06 f05 E E E f Hys05 6 > = 6 f Swi O f Swi O n Dly O n Dly Of TRUE TRUE TRUE TRUE TRUE TRUE FALS FALS n07 n06 - n07 f06 E E f Hys06 7 > = 7 f Swi O f Swi O n Dly O n Dly Of TRUE TRUE TRUE TRUE TRUE TRUE TRUE FALS n08 n07 - n08 f07 E f Hys07 8 8 f Swi O f Swi O n Dly Of TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE n08 n08 - f08 f Hys08 Inputs VAR_INPUT b En : BOOL; f In : REAL; f Swi On01 : REAL; 418 Version: 1.14.0 TF8040
## Page 419

Programming f Swi On02 : REAL; f Swi On03 : REAL; f Swi On04 : REAL; f Swi On05 : REAL; f Swi On06 : REAL; f Swi On07 : REAL; f Swi On08 : REAL; END_VAR Name Type Description b En BOOL General enable of the function block. If b En is FALSE, all message outputs b Q0N are also FALSE. f In REAL Continuous input value from which the switching states are derived. f Swi On0N REAL Switch-on point step 0N. Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT f Hys01 : REAL := 5; f Hys02 : REAL := 5; f Hys03 : REAL := 5; f Hys04 : REAL := 5; f Hys05 : REAL := 5; f Hys06 : REAL := 5; f Hys07 : REAL := 5; f Hys08 : REAL := 5; n Dly On01 : UDINT; n Dly Off01 : UDINT; n Dly On02 : UDINT; n Dly Off02 : UDINT; n Dly On03 : UDINT; n Dly Off03 : UDINT; n Dly On04 : UDINT; n Dly Off04 : UDINT; n Dly On05 : UDINT; n Dly Off05 : UDINT; n Dly On06 : UDINT; n Dly Off06 : UDINT; n Dly On07 : UDINT; n Dly Off07 : UDINT; n Dly On08 : UDINT; n Dly Off08 : UDINT; n Num Of Stp : UDINT := 4; END_VAR Name Type Description f Hys0N REAL Absolute value hysteresis step 0N. n Dly On0N UDINT Start-up delay step 0N. n Dly Off0N UDINT Switch-off delay step 0N. n Num Of Stp UDINT Input of the number of steps required. The input is limited to a range from 0 to 8. Outputs VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; b Q05 : BOOL; b Q06 : BOOL; b Q07 : BOOL; b Q08 : BOOL; n Active Step : UDINT; f Swi On : REAL; f Swi Off : REAL; n Rem Ti Dly On : UDINT; n Rem Ti Dly Off : UDINT; END_VAR TF8040 Version: 1.14.0 419
## Page 420

Programming Name Type Description b Q0N BOOL Shows state step 0N. The step can only be active when the preceding steps are TRUE. TRUE = ON; FALSE = OFF n Active Step UDINT Indicates how many steps are switched on. f Swi On REAL Indicates the next switch-on point. f Swi Off REAL Indicates the next switch-off point. n Rem Ti Dly On UDINT If the switch-on point for switching to the next step is reached, the remaining time of the start-up delay is displayed here. n Rem Ti Dly Off UDINT If the switch-off point for switching down to the next step is reached, the remaining time of the switch-off delay is displayed here. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.2.2 FB_BA_PIDControl The function block FB_BA_PIDCtrl is a universal PID controller. The controller is divided internally into two consecutive parts: • the controller itself, illustrated in the functional diagrams below as P, I and D part with an output limitation. • a deadband element (neutral zone) that applies a hysteresis to the output changes of the controller. Operation mode "Upstream P part": (e Op Mode = E_BA_PIDMode.e P1ID) 420 Version: 1.14.0 TF8040
## Page 421

Programming "Parallel structure" operation mode: (e Op Mode = E_BA_PIDMode.e PID ) Control direction With e Action = E_BA_Action.e Reverse, the control direction of the controller is reversed so that a control deviation of less than 0 causes a positive change in the control value. This is achieved by a negative calculation of the control deviation: e Action f E (control deviation) Control direction E_BA_Action.e Direct f Ctrl Val-f Setpoint (actual value- direct (cooling) setpoint) E_BA_Action.e Reverse f Setpoint-f Ctrl Val (setpoint - actual indirect (heating) value) Passive behavior (b En = FALSE) The outputs are set as follows: f Present Value 0.0 The internal values for the P, I, and D parts are set to 0, also the values for the I and D parts of the preceding cycle. In case of a restart the control value is thus calculated in the first cycle without past values. Active behavior (b En = TRUE) In the first cycle, the I and D parts are calculated without historical values, as already mentioned. Anti-Reset-Windup If the I part is active, the controller ensures that it is retained, if the controller output r Y is about to move beyond the limits f Min Output oder f Max Output. A preliminary calculation of the controller output takes place inside the controller in every cycle. Anti-reset windup at min limit If the precalculation is smaller than the lower output limit f Min Output, the I part is prevented from falling further and is limited to the value of the last PLC cycle. However, an increase in the I part remains possible. Anti-reset windup at max limit On the other hand, if the precalculation is greater than the upper limit f Max Output, the I part is prevented from increasing further and is also limited to the value of the last PLC cycle. In this case, a drop in the I part remains possible. TF8040 Version: 1.14.0 421
## Page 422

Programming Synchronizations There are several cases where controller output must not only be limited, but also synchronized to a new value by manipulating the I part (if not active, then the D part or the P part). These cases are prioritized because of the potential for simultaneity: Prio Description Conditions Comments 1 Synchronization via Controller enabled - b En A positive signal on b En Sync sets the I part b En Sync/f Val Sync = TRUE so that the control value assumes the value f Val Sync. If b En and b En Sync are set at the same time, this method can be used to set an initial value from which the controller "sets off". If the I part is not active, the D part is set accordingly. Note that only the rising edge of b En Sync is evaluated internally as this is a Set action. A TRUE signal must be applied again to the input b En Sync for renewed synchronization, for instance with a transfer value. 2 Range synchronization Controller enabled – b En If the lower range limit has changed and the f Min Output = TRUE precalculated controller output is now smaller than f Min Output then f Min Output <> synchronization is performed to f Min Output. f Min Output_1 (last Cycle) f Y_Test < f Min Output 3 Range synchronization Controller enabled – b En If the upper range limit has changed and the f Max Output = TRUE precalculated controller output is now greater than f Max Output, then f Max Output <> synchronization is performed to f Max Output f Max Output_1 (last Cycle) f Y_Test > f Max Output 4 Synchronization with Controller enabled – b En It is synchronized so that the output holds reversal of the control = TRUE the value BEFORE the reversal: direction f Present Value = f Present Value_1 (last cycle) e Action <> e Action_1 (last cycle) 5 Anti-Reset-Windup Controller enabled – b En see Anti-Reset-Windup = TRUE Neutral zone A value of f Neutral Zone > 0.0 enables the function of the neutral zone (deadband). A value equal to zero deactivates the deadband element and the values at the input are passed directly through. If, for the active controller, the change at the input of the element in a PLC cycle is smaller than f Neutral Zone / 2 in comparison with the previous PLC cycle, then the output is held at the value of the previous cycle until the change is larger than or equal to f Neutral Zone / 2. This function is intended to avoid an unnecessarily large number of actuating pulses. Syntax VAR_INPUT b En : BOOL; f Setpoint : REAL; f Ctrl Val : REAL; b En Sync : BOOL; f Val Sync : REAL; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Category':='Config'} e Op Mode : E_BA_PIDMode := E_BA_PIDMode.e PID; {attribute 'parameter Category':='Deadband'} f Neutral Zone : REAL := 0.0; {attribute 'parameter Category':='Config'} e Action : E_BA_Action := E_BA_Action.e Reverse; 422 Version: 1.14.0 TF8040
## Page 423

Programming {attribute 'parameter Category':='Config'} f Min Output : REAL := 0; {attribute 'parameter Category':='Config'} f Max Output : REAL := 100; {attribute 'parameter Category':='Config'} f Proportional Constant : REAL := 3; {attribute 'parameter Category':='Config'} {attribute 'parameter Unit':= 's,ms'} f Integral Constant : REAL; {attribute 'parameter Category':='Config'} {attribute 'parameter Unit':= 's,ms'} f Derivative Constant : REAL; {attribute 'parameter Category':='Config'} {attribute 'parameter Unit':= 's'} n Damp Constant : UDINT; END_VAR VAR_OUTPUT f Present Value : REAL; END_VAR Inputs Name Type Description b En BOOL Enabling the controller f Setpoint REAL Setpoint of the controlled system f Ctrl Val REAL Actual value of the controlled system b En Sync BOOL Synchronizes the controller to the value of f Val Sync. f Val Sync REAL Synchronization value. The value f Val Sync is internally limited to values from f Min Output to f Max Output. Inputs CONSTANT PERSISTENT Name Type Description e Op Mode E_BA_PIDMode Mode of operation of the controller: PID mode or P-ID mode. f Neutral Zone REAL Dead zone e Action E_BA_Action Control direction of the controller f Min Output TIME Lower controller output limit [%]. The value f Min Output is limited at the top by f Max Output. f Max Output TIME Upper controller output limit [%]. f Proportional Consta REAL Controller gain. Only affects the P part. Internally limited to a nt minimum value of 0. f Integral Constant REAL Integral action time of the I part [s,ms]. A null value at this parameter disables the I part. f Derivative Constant REAL Rate time of the D part [s,ms]. A null value at this parameter disables the D part. n Damp Constant UDINT Damping time of the D part [s]. Outputs Name Type Description f Present Value REAL Control value. Range limited by f YMin and f YMax. TF8040 Version: 1.14.0 423
## Page 424

Programming Properties Name Type Access Description Anti Reset Windup BOOL Get The controller is in anti-reset windup status. Control Deviation REAL Get Control deviation Is Max Limit BOOL Get The controller output f Present Value is at the upper output limit f Max Output. Is Min Limit BOOL Get The controller output f Present Value is at the lower output limit f Min Output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.56 Tc3_BA2 from v5.4.2.0 6.1.2.2.3.1.5.2.3 FB_BA_PIDControl Sync The function block FB_BA_PIDControl Sync is used for parameter synchronization for 2 controllers of type FB_BA_PIDControl [} 420]. This function block can be used, for example, to calibrate master controllers that are used to generate the supply air setpoints for an air conditioning system. The following parameters of the FB_BA_PIDControl [} 420] are synchronized: • e Op Mode • e Action Rm • f Proportional Constant • f Integral Constant • f Derivative Constant • f Max Output Rm • f Min Output Rm • n Damp Constant • f Neutral Zone Error detection The error messages listed below are detected by the FB_BA_PIDControl Sync. The error messages are output in the Twin CAT 3 development environment in the "Error list" window. This can be activated under the menu item View. The error texts are output via the property Err Text and the output s Err Text. In addition, the messages are displayed by the enum e Err State. 424 Version: 1.14.0 TF8040
## Page 425

Programming Error messages Message text German Message text English 'Synchronisation e Action fehlerhaft' 'Synchronization e Action faulty' 'Synchronisation n Damp Constant fehlerhaft' 'Synchronization n Damp Constant faulty' 'Synchronisation f Derivative Constant fehlerhaft' 'Synchronization f Derivative Constant faulty' 'Synchronisation f Integral Constant fehlerhaft' 'Synchronization f Integral Constant faulty' 'Synchronisation f Max Output fehlerhaft' 'Synchronization f Max Output faulty' 'Synchronisation f Min Output fehlerhaft' 'Synchronization f Min Output faulty' 'Synchronisation f Neutral Zone fehlerhaft' 'Synchronization f Neutral Zone faulty' 'Synchronisation e Op Mode fehlerhaft' 'Synchronization e Op Mode faulty' 'Synchronisation f Proportional Constant fehlerhaft' 'Synchronization f Proportional Constant faulty' Syntax FUNCTION_BLOCK FB_BA_Loop Sync VAR_OUTPUT b Err : BOOL; s Err Text : T_Max String; e Err State : E_BA_State PIDControl Sync; END_VAR VAR_IN_OUT PID01 : FB_BA_PIDControl; PID02 : FB_BA_PIDControl; END_VAR Outputs Name Type Description b Err BOOL The output indicates when an error has occurred during synchronization. s Err Text T_Max String The variable shows the state of synchronization in text form [} 425]. e Err State E_BA_State PIDControl Sync The enumeration shows the state of the synchronization. [} 271] / Inputs Outputs Name Type Description Loop1 FB_BA_PIDControl [} 420] Reference to controller no. 1 of the parameter adjustment. Loop2 FB_BA_PIDControl [} 420] Reference to controller no. 2 of the parameter adjustment. Properties Name Type Access Description Err Text T_Max String Get The property Err Text displays the error texts from s Err Text. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.56 Tc3_BA2 from v5.4.2.0 TF8040 Version: 1.14.0 425
## Page 426

Programming 6.1.2.2.3.1.5.3 General Control Functions 6.1.2.2.3.1.5.3.1 FB_BA_DMUX_XX Demultiplexer function blocks exist for different variable types (BOOL, INT, LREAL, REAL, USINT, UINT, UDINT and DINT) and in different output values (4, 8, 12 and 16), but they all have the same functionality. The function block FB_BA_DMUX_LR16 is described as an example. The function block FB_BA_DMUX_XX outputs in the activated state (b En= TRUE) the value at input f In to the output f Q01..f Q16 whose number is entered at input n Sel. All other outputs are set to 0 (for boolean demultiplexers to FALSE). Example: Inputs Outputs b En = TRUE f Q01 = 0.0 n Sel = 5 f Q02 = 0.0 f In = 32.5 f Q03 = 0.0 f Q04 = 0.0 f Q05 = 32.5 f Q06 = 0.0 f Q07 = 0.0 f Q08 = 0.0 f Q09 = 0.0 f Q10 = 0.0 f Q11 = 0.0 f Q12 = 0.0 f Q13 = 0.0 f Q14 = 0.0 f Q15 = 0.0 f Q16 = 0.0 If the value entered at n Sel is greater than the number of outputs, the value of f In is output at the "highest" output: 426 Version: 1.14.0 TF8040
## Page 427

Programming Inputs Outputs b En = TRUE f Q01 = 0.0 n Sel = 25 f Q02 = 0.0 f In = 32.5 f Q03 = 0.0 f Q04 = 0.0 f Q05 = 0.0 f Q06 = 0.0 f Q07 = 0.0 f Q08 = 0.0 f Q09 = 0.0 f Q10 = 0.0 f Q11 = 0.0 f Q12 = 0.0 f Q13 = 0.0 f Q14 = 0.0 f Q15 = 0.0 f Q16 = 32.5 If b En = FALSE, 0.0 is output at all outputs, or FALSE for boolean demultiplexers. Inputs VAR_INPUT b En : BOOL; n Sel : UDINT; f In : LREAL; END_VAR Name Type Description b En BOOL Activation of the block function n Sel UDINT Number of the output f Q01...f Q16, which is to assume the value of input f In. f In LREAL Value to be output. Outputs VAR_OUTPUT f Q01 : LREAL; f Q02 : LREAL; f Q03 : LREAL; f Q04 : LREAL; f Q05 : LREAL; f Q06 : LREAL; f Q07 : LREAL; f Q08 : LREAL; f Q09 : LREAL; f Q10 : LREAL; f Q11 : LREAL; f Q12 : LREAL; f Q13 : LREAL; f Q14 : LREAL; f Q15 : LREAL; f Q16 : LREAL; END_VAR Name Type Description f Q01...f Q16 LREAL Value outputs TF8040 Version: 1.14.0 427
## Page 428

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.3.2 FB_BA_MMUX_XX The function block FB_BA_MMUX_XX activates an input value on the output, depending on a selector and the corresponding input selector condition. Multiplexer function blocks exist for different variable types (BOOL, INT, LREAL, REAL, USINT, UINT, UDINT and DINT) and in different input values (4, 8, 12, 16 and 24), but they all have the same functionality. The function block FB_BA_MMUX_R16 is described as an example. The function block switches one of the input values r Valxx to the output f Val in the activated state (b En = TRUE) depending on a selector n Sel and the corresponding input selector condition n Enxx. If several input selector conditions n En01...n En16 are equal and the selector n Sel matches a condition, then the input value f Val01...f Val16 of the lowest active selector condition is switched to the output f Val. n En01 is the lowest, n En16 the highest selector condition. 428 Version: 1.14.0 TF8040
## Page 429

Programming The output variable b Q indicates that the selector n Sel matches an input selector condition n Enxx. The output variable n Actv Prio indicates the active selector condition. If no selector condition is active, f Repl Val is output to f Val. b Q is then FALSE and n Actv Prio indicates a 255. Sample: Inputs Output Variable Value Variable Value b En TRUE b Q TRUE n Sel 5 f Val 1.123 n En01 4 n Actv Prio 7 f Val01 123 n En02 f Val02 n En03 3 f Val03 321 n En04 f Val04 n En05 8 f Val05 345 n En06 f Val06 n En07 5 f Val07 1.123 n En08 f Val08 n En09 5 f Val09 5.4321 n En10 f Val10 n En11 f Val11 n En12 f Val12 n En13 f Val13 n En14 f Val14 n En15 f Val15 n En16 f Val16 f Repl Val If no active priority is present, then the value of the global constant BA_Globals.n No Active Prio [} 283] is output at the output n Actv Prio. Inputs VAR_INPUT b En : BOOL; n Sel : UDINT; n En01 : UDINT := BA_Globals.n No Actv Prio; f Val01 : REAL; n En02 : UDINT := BA_Globals.n No Actv Prio; TF8040 Version: 1.14.0 429
## Page 430

Programming f Val02 : REAL; n En03 : UDINT := BA_Globals.n No Actv Prio; f Val03 : REAL; n En04 : UDINT := BA_Globals.n No Actv Prio; f Val04 : REAL; n En05 : UDINT := BA_Globals.n No Actv Prio; f Val05 : REAL; n En06 : UDINT := BA_Globals.n No Actv Prio; f Val06 : REAL; n En07 : UDINT := BA_Globals.n No Actv Prio; f Val07 : REAL; n En08 : UDINT := BA_Globals.n No Actv Prio; f Val08 : REAL; n En09 : UDINT := BA_Globals.n No Actv Prio; f Val09 : REAL; n En10 : UDINT := BA_Globals.n No Actv Prio; f Val10 : REAL; n En11 : UDINT := BA_Globals.n No Actv Prio; f Val11 : REAL; n En12 : UDINT := BA_Globals.n No Actv Prio; f Val12 : REAL; n En13 : UDINT := BA_Globals.n No Actv Prio; f Val13 : REAL; n En14 : UDINT := BA_Globals.n No Actv Prio; f Val14 : REAL; n En15 : UDINT := BA_Globals.n No Actv Prio; f Val15 : REAL; n En16 : UDINT := BA_Globals.n No Actv Prio; f Val16 : REAL; f Repl Val : REAL; END_VAR Name Type Description b En BOOL Activation of the block function n Sel UDINT Selector. Internally limited to values between 0 and 4294967294. n En01…n En16 UDINT Input values to select from. f Repl Val REAL Substitute value, if no input selector condition is active. Outputs VAR_OUTPUT b Q : BOOL; f Val : REAL; n Actv Prio : UDINT; END_VAR Name Type Description b Q BOOL TRUE if the selector n Sel matches an input selector condition n Enxx. f Val REAL Value of the selected input selector condition. n Actv Prio UDINT Indicates which input selector condition is active. If no active priority is present, then the value of the global constant BA_Globals.n No Active Prio is output at the output n Actv Prio. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 430 Version: 1.14.0 TF8040
## Page 431

Programming 6.1.2.2.3.1.5.3.3 FB_BA_MUX_XX Multiplexer function blocks exist for different variable types (BOOL, INT, LREAL, REAL, USINT, UINT, UDINT and DINT) and in different input values (4, 8, 12 and 16), but they all have the same functionality. The function block FB_BA_MUX_LR16 is described as an example. The function block FB_BA_MUX_XX outputs in the activated state (b En=TRUE) that input value f In01..f In16 at output f Q whose number is entered at input n Sel. Example: Inputs Output b En = TRUE f Q = 16.5 n Sel = 5 f In01 = 15.9 f In02 = 32.5 f In03 = 17.4 f In04 = 5.84 f In05 = 9.56 f In06 = 16.5 f In07 = 32,781 f In08 = 25.4 f In09 = 44.5 f In10 = 66.1 f In11 = 45.5 f In12 = 83.3 f In13 = 54.56 f In14 = 33.8 f In15 = 98.5 f In16 = 71.3 If the entered value at n Sel is greater than the number of inputs, the "highest" input is output at f Q: TF8040 Version: 1.14.0 431
## Page 432

Programming Inputs Output b En = TRUE f Q = 2.3 n Sel = 25 f In01 = 15.9 f In02 = 32.5 f In03 = 17.4 f In04 = 5.84 f In05 = 9.56 f In06 = 16.5 f In07 = 32,781 f In08 = 25.4 f In09 = 44.5 f In10 = 66.1 f In11 = 45.5 f In12 = 83.3 f In13 = 54.56 f In14 = 33.8 f In15 = 98.5 f In16 = 71.3 If b En=FALSE, 0.0 is output at output f Q or FALSE for boolean multiplexers. Inputs VAR_INPUT b En : BOOL; n Sel : UDINT; f In01 : LREAL; f In02 : LREAL; f In03 : LREAL; f In04 : LREAL; f In05 : LREAL; f In06 : LREAL; f In07 : LREAL; f In08 : LREAL; f In09 : LREAL; f In10 : LREAL; f In11 : LREAL; f In12 : LREAL; f In13 : LREAL; f In14 : LREAL; f In15 : LREAL; f In16 : LREAL; END_VAR Name Type Description b En BOOL Activation of the block function n Sel UDINT Number of the input, whose value is to be output at f Q. f01...f16 LREAL Input values to select from. Outputs VAR_OUTPUT f Q : LREAL; END_VAR Name Type Description f Q LREAL Value of the selected input. 432 Version: 1.14.0 TF8040
## Page 433

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.3.4 FB_BA_Prio Swi_XX The priority switches exist for different variable types (BOOL, INT, LREAL, REAL, USINT, UINT, UDINT and DINT) and in different output values (4, 8, 12 and 16 or 24), but they all have the same functionality. The function block FB_BA_Prio Swi_LR08 is described as an example. Priority switches are available for selecting different values. At output f Val the value with the highest priority is applied whose input b Enxx is TRUE. Example: Inputs Outputs b En01 FALSE b Q TRUE f Val01 32.5 f Val 5.84 b En02 FALSE n Actv Prio 3 f Val02 17.4 b En03 TRUE f Val03 5.84 b En04 TRUE f Val04 9.56 b En05 FALSE f Val05 16.5 b En06 TRUE f Val06 32.781 b En07 FALSE f Val07 25.4 b En08 TRUE f Val08 44.5 If none of the priorities is enabled, the output b Q switches to FALSE. 0 is output at the outputs f Val and n Actv Prio. For a boolean priority switch, FALSE is then output at b Val. TF8040 Version: 1.14.0 433
## Page 434

Programming Inputs Outputs b En01 FALSE b Q FALSE f Val01 32.5 f Val 0.0 b En02 FALSE n Actv Prio 0 f Val02 17.4 b En03 FALSE f Val03 5.84 b En04 FALSE f Val04 9.56 b En05 FALSE f Val05 16.5 b En06 FALSE f Val06 32.781 b En07 FALSE f Val07 25.4 b En08 FALSE f Val08 44.5 If no active priority is present, then the value of the global constant n No Active Prio [} 124] is output at the output n Actv Prio. Inputs VAR_INPUT b En01 : BOOL; f Val01 : LREAL; b En02 : BOOL; f Val02 : LREAL; b En03 : BOOL; f Val03 : LREAL; b En04 : BOOL; f Val04 : LREAL; b En05 : BOOL; f Val05 : LREAL; b En06 : BOOL; f Val06 : LREAL; b En07 : BOOL; f Val07 : LREAL; b En08 : BOOL; f Val08 : LREAL; END_VAR Name Type Description b En01...b En08 BOOL Enabling the priority value f Val01...f Val08 LREAL Priority value Outputs VAR_OUTPUT b Q : BOOL; f Val : LREAL; n Actv Prio : UDINT; END_VAR Name Type Description b Q BOOL Output to indicate whether a priority is enabled. f Val LREAL Output of the value of the current (highest) priority that is enabled. n Actv Prio UDINT Current (highest) priority that is enabled. 434 Version: 1.14.0 TF8040
## Page 435

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.3.5 FB_BA_Blink The function block FB_BA_Blink is an oscillator with adjustable pulse and pause time, n Ti On and n Ti Off [ms]. It is enabled with a TRUE signal at b En and starts with the pulse phase. n Ti Next Swi is a countdown [s] to the next change of b Q. Inputs VAR_INPUT b En : BOOL; n Ti On : UDINT; n Ti Off : UDINT; END_VAR Name Type Description b En BOOL Function block enable n Ti On UDINT Pulse time [ms] n Ti Off UDINT Pause time [ms] Outputs VAR_OUTPUT b Q : BOOL; n Ti Next Swi : UDINT; END_VAR Name Type Description b Q BOOL Oscillator output n Ti Next Swi UDINT Countdown to next change of b Q [s] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 435
## Page 436

Programming 6.1.2.2.3.1.5.3.6 FB_BA_FIFO04 The function block FB_BA_FIFO04 enables sequential control of up to four units, with automatic switching of the switch-on sequence based on operating hours. The function block is available in two versions: for a sequence of four or eight [} 437] units. Units with fewer operating hours take precedence in the sequence over units with more operating hours. A rising edge at b Chg forces a sequence change. The units with the fewest operating hours are set to the top of the FIFO and thus given priority for switching on. In the sequence only units are entered, which are enabled at inputs b En01..b En04. n Num indicates the number of requested units. The operating hours of the units are entered at inputs n Actv Ti01 to n Actv Ti04. If all these inputs are set to a constant value of zero, the sequence change is controlled cyclically, depending on b Chg. The first unit is removed from the FIFO, the other units are advanced, and the first unit is appended at the end of the FIFO again. As a result is an alternating sequence of units. Inputs VAR_INPUT b En : BOOL; n Num : UDINT; b Chg : BOOL; b En01 : BOOL; b En02 : BOOL; b En03 : BOOL; b En04 : BOOL; n Actv Ti01 : UDINT; n Actv Ti02 : UDINT; n Actv Ti03 : UDINT; n Actv Ti04 : UDINT; END_VAR Name Type Description b En BOOL Function block enable n Num UDINT Number of aggregates b Chg BOOL Force sequence change b En01...b En04 BOOL Enable aggregate 1...enable aggregate 4. n Actv Ti01...n Actv Ti0 UDINT Operating hours aggregate 1...operating hours aggregate 4 4. Outputs VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; n Next On : UDINT; n Next Off : UDINT; a FIFO : ARRAY [1..4] OF UDINT; n Num Of En : UDINT; END_VAR 436 Version: 1.14.0 TF8040
## Page 437

Programming Name Type Description b Q01...b Q04 BOOL Switches aggregate 1...4. n Next On UDINT Number of the aggregate that is switched on next. n Next Off UDINT Number of the aggregate which will be switched off next. a FIFO ARRAY OF UDINT FIFO buffer as a field. n Num Of En UDINT Number of devices, depending on the individual enable states. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.3.7 FB_BA_FIFO08 The function block FB_BA_FIFO08 enables a sequence control of up to eight aggregates with automatic change of the switch-on sequence according to operating hours. The function block is available in two versions: for a sequence of four [} 436] and of eight aggregates. Aggregates with fewer operating hours take precedence in the sequence over units with more operating hours. A rising edge at b Chg forces a sequence change. The aggregates with the lowest operating hours are set to the front in the FIFO and thus switched on with priority. In the following, only aggregates are entered which are enabled at the inputs b En01...b En08. n Num specifies the number of requested aggregates. The operating hours of the aggregates are entered at the inputs n Actv Ti01 to n Actv Ti08. If these inputs are all constantly set to zero, the sequence change is only cyclically controlled depending on b Chg. In this case, the first aggregate always falls out of the FIFO, the others are moved forwards, and the first aggregate is attached again at the end of the FIFO. As a result is an alternating sequence of aggregates. Inputs VAR_INPUT b En : BOOL; n Num : UDINT; b Chg : BOOL; b En01 : BOOL; b En02 : BOOL; b En03 : BOOL; b En04 : BOOL; b En05 : BOOL; b En06 : BOOL; TF8040 Version: 1.14.0 437
## Page 438

Programming b En07 : BOOL; b En08 : BOOL; n Actv Ti01 : UDINT; n Actv Ti02 : UDINT; n Actv Ti03 : UDINT; n Actv Ti04 : UDINT; n Actv Ti05 : UDINT; n Actv Ti06 : UDINT; n Actv Ti07 : UDINT; n Actv Ti08 : UDINT; EN_VAR Name Type Description b En BOOL Function block enable n Num UDINT Number of aggregates b Chg BOOL Force sequence change b En01...b En08 BOOL Enable aggregate 1...enable aggregate 8. n Actv Ti01...n Actv Ti0 UDINT Operating hours aggregate 1...operating hours aggregate 8 8. Outputs VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; b Q05 : BOOL; b Q06 : BOOL; b Q07 : BOOL; b Q08 : BOOL; n Next On : UDINT; n Next Off : UDINT; a FIFO : ARRAY [1..8] OF UDINT; n Num Of En : UDINT; END_VAR Name Type Description b Q01...b Q08 BOOL Switches aggregate 1...8. n Next On UDINT Number of the aggregate that is switched on next. n Next Off UDINT Number of the aggregate which will be switched off next. a FIFO ARRAY OF UDINT FIFO buffer as a field. n Num Of En UDINT Number of devices, depending on the individual enable states. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 438 Version: 1.14.0 TF8040
## Page 439

Programming 6.1.2.2.3.1.5.3.8 FB_BA_Step Ctrl08 The function block FB_BA_Step Ctrl08 is used for issuing sequential control commands. A typical application for this function block is startup of an air conditioning system. b En is used for general enable of the function block. If b En = FALSE, all outputs from b Q01 to b Q08 are set to FALSE. The control sequence starts at input b Evt01. Once the timer n Dly On01 (see Parameters) has elapsed, the corresponding output b Q01 is set. Further steps are activated after a rising edge at the inputs b Evt02 to b Evt08, in each case delayed via the timers n Dly On02 to n Dly On08. If b Evt01 becomes FALSE once the control chain is up and running, the control sequence switches back in reverse order. The switching off of the outputs is delayed by the timers n Dly Off01 to n Dly Off08, see parameters. The outputs b Up and b Dwn indicate whether the control chain is in ascending or descending state. The variable n Actv Evt indicates the current step of the control chain. "0" means the step sequence is not active. The output n Rem Ti Dly On indicates the time remaining to the next step during up-switching of the control chain. The output n Rem Ti Dly Off indicates the time remaining to the next lower step during down-switching of the control chain. TF8040 Version: 1.14.0 439
## Page 440

Programming Sample • t0 step sequence switch-on • t1 switch on step 1 n Dly On01 = t1 - t0 • t2 event enable step 2, switch on step 2, n Dly On02 = 0 • t3 event enable step 3, switch on step 3, n Dly On03 = 0 • t4 event enable step 4, switch on step 4, n Dly On04 = 0 • t5 event enable step 5, switch on step 5, n Dly On05 = 0 • t6 disable the step sequence, disable step 5, disable step 4; n Dly Off05 = 0, n Dly Off04 = 0 • t7 switch off step 3, n Dly Off03 = t7 -t6 • t8 switch off step 2, n Dly Off02 = t8 -t7 • t9 switch off step 1, n Dly Off01 = t9 -t8 Inputs VAR_INPUT b En : BOOL; b Evt01 : BOOL; n Dly On01 : UDINT; n Dly Off01 : UDINT; b Evt02 : BOOL; n Dly On02 : UDINT; n Dly Off02 : UDINT; b Evt03 : BOOL; n Dly On03 : UDINT; n Dly Off03 : UDINT; b Evt04 : BOOL; n Dly On04 : UDINT; n Dly Off04 : UDINT; b Evt05 : BOOL; n Dly On05 : UDINT; n Dly Off05 : UDINT; b Evt06 : BOOL; n Dly On06 : UDINT; n Dly Off06 : UDINT; 440 Version: 1.14.0 TF8040
## Page 441

Programming b Evt07 : BOOL; n Dly On07 : UDINT; n Dly Off07 : UDINT; b Evt08 : BOOL; n Dly On08 : UDINT; n Dly Off08 : UDINT; END_VAR Name Type Description b En BOOL Function block enable b Evt01…08 BOOL Switch-on command for steps 1 to 8. n Dly On01…08 UDINT Start-up delay for output b Q01…08 [s] n Dly Off01…08 UDINT Switch-off delay for output b Q01…08 [s] Outputs VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; b Q05 : BOOL; b Q06 : BOOL; b Q07 : BOOL; b Q08 : BOOL; b Up : BOOL; b Dwn : BOOL; n Actv Evt : UDINT; n Rem Ti Dly On : UDINT; n Rem Ti Dly Off : UDINT; END_VAR Name Type Description b Q01...b Q08 BOOL Step 1 to 8 On b Up BOOL Control chain is in ascending state. b Dwn BOOL Control chain is in descending state. n Actv Evt UDINT Active step, display 0...8, "0" means not active step sequence. n Rem Ti Dly On UDINT Time remaining to up-switching to the next step [s]. n Rem Ti Dly Off UDINT Time remaining to down-switching to the previous step [s]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 441
## Page 442

Programming 6.1.2.2.3.1.5.3.9 FB_BA_Step Ctrl12 The function block FB_BA_Step Ctrl12 is used for output sequential control commands. A typical application for this function block is startup of an air conditioning system. b En is used for general enable of the function block. If b En = FALSE, all outputs from b Q01 to b Q12 are set to FALSE. The control sequence starts at input b Evt01. Once the timer n Dly On01 (see Parameters) has elapsed, the corresponding output b Q01 is set. Further steps are activated after a rising edge at the inputs b Evt02 to b Evt12, in each case delayed via the timers n Dly On02 to n Dly On12. If b Evt01 becomes FALSE once the control chain is up and running, the control sequence switches back in reverse order. The switching off of the outputs is delayed by the timers n Dly Off01 to n Dly Off12, see parameters. The outputs b Up and b Dwn indicate whether the control chain is in ascending or descending state. The variable n Actv Evt indicates the current step of the control chain. "0" means the step sequence is not active. The output n Rem Ti Dly On indicates the time remaining to the next step during up-switching of the control chain. The output n Rem Ti Dly Off indicates the time remaining to the next lower step during down-switching of the control chain. 442 Version: 1.14.0 TF8040
## Page 443

Programming Sample • t0 step sequence switch-on • t1 switch on step 1 n Dly On01 = t1 - t0 • t2 event enable step 2, switch on step 2, n Dly On02 = 0 • t3 event enable step 3, switch on step 3, n Dly On03 = 0 • t4 event enable step 4, switch on step 4, n Dly On04 = 0 • t5 event enable step 5, switch on step 5, n Dly On05 = 0 • t6 disable the step sequence, disable step 5, disable step 4; n Dly Off05 = 0, n Dly Off04 = 0 • t7 switch off step 3, n Dly Off03 = t7 -t6 • t8 switch off step 2, n Dly Off02 = t8 -t7 • t9 switch off step 1, n Dly Off01 = t9 -t8 Inputs VAR_INPUT b En : BOOL; b Evt01 : BOOL; n Dly On01 : UDINT; n Dly Off01 : UDINT; b Evt02 : BOOL; n Dly On02 : UDINT; n Dly Off02 : UDINT; b Evt03 : BOOL; n Dly On03 : UDINT; n Dly Off03 : UDINT; b Evt04 : BOOL; n Dly On04 : UDINT; n Dly Off04 : UDINT; b Evt05 : BOOL; n Dly On05 : UDINT; n Dly Off05 : UDINT; b Evt06 : BOOL; n Dly On06 : UDINT; n Dly Off06 : UDINT; TF8040 Version: 1.14.0 443
## Page 444

Programming b Evt07 : BOOL; n Dly On07 : UDINT; n Dly Off07 : UDINT; b Evt08 : BOOL; n Dly On08 : UDINT; n Dly Off08 : UDINT; b Evt09 : BOOL; n Dly On09 : UDINT; n Dly Off09 : UDINT; b Evt10 : BOOL; n Dly On10 : UDINT; n Dly Off10 : UDINT; b Evt11 : BOOL; n Dly On11 : UDINT; n Dly Off11 : UDINT; b Evt12 : BOOL; n Dly On12 : UDINT; n Dly Off12 : UDINT; END_VAR Name Type Description b En BOOL Function block enable b Evt01…012 BOOL Switch-on command for steps 1 to 12. n Dly On01…12 UDINT Start-up delay for output b Q01…12 [s] n Dly Off01…12 UDINT Switch-off delay for output b Q01…12 [s] Outputs VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; b Q05 : BOOL; b Q06 : BOOL; b Q07 : BOOL; b Q08 : BOOL; b Q09 : BOOL; b Q10 : BOOL; b Q11 : BOOL; b Q12 : BOOL; b Up : BOOL; b Dwn : BOOL; n Actv Evt : UDINT; n Rem Ti Dly On : UDINT; n Rem Ti Dly Off : UDINT; END_VAR Name Type Description b Q01...b Q12 BOOL Step 1 to 12 On b Up BOOL Control chain is in ascending state. b Dwn BOOL Control chain is in descending state. n Actv Evt UDINT Active step, display 0...12, "0" means not active step sequence. n Rem Ti Dly On UDINT Time remaining to up-switching to the next step [s]. n Rem Ti Dly Off UDINT Time remaining to down-switching to the previous step [s]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 444 Version: 1.14.0 TF8040
## Page 445

Programming 6.1.2.2.3.1.5.3.10 FB_BA_FIFO04_XX The function block FB_BA_FIFO04_XX is used to evaluate the Fi Fo memory from FB_BA_FIFO04 [} 436]. The inputs are linked according to the FIFO table to the corresponding outputs of the function block FB_BA_FIFO04_BOOL or FB_BA_FIFO04_REAL. Example: In the sample the array contains: 4,3,1,2,0,0,0,0. The following result is output in FB_BA_FIFO04_REAL: f In01 on output f Val04 f In02 on output f Val03 f In03 on output f Val01 f In04 on output f Val02 Inputs VAR_INPUT a FIFO : Array [1..4] OF UDINT; f In01…f In04 : REAL; END_VAR Name Type Description a FIFO ARRAY OF UDINT Contains the assignment table with a maximum of eight values. The first value indicates where the first input was copied to, the second value where the second input was copied to and so on. No assignment takes place with "0". f In01…f In04 REAL Setpoints to be linked. Outputs VAR_OUTPUT f Val01…f Val04 : REAL; END_VAR Name Type Description f Val01…f Val04 REAL Actuator setpoint, input value linked according to FIFO table. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 445
## Page 446

Programming 6.1.2.2.3.1.5.3.11 FB_BA_FIFO08_XX The function block FB_BA_FIFO08_XX is used to evaluate the Fi Fo memory from FB_BA_FIFO08 [} 437]. The inputs are linked according to the FIFO table to the corresponding outputs of the function block FB_BA_FIFO08_BOOL or FB_BA_FIFO08_REAL. Example: In the sample the array contains: 4,3,1,2,0,0,0,0. The following result is output in FB_BA_FIFO08_REAL: f In01 on output f Val04 f In02 on output f Val03 f In03 on output f Val01 f In04 on output f Val02 Inputs VAR_INPUT a FIFO : Array [1..8] OF UDINT; f In01…f In08 : REAL; END_VAR Name Type Description a FIFO ARRAY OF UDINT Contains the assignment table with a maximum of eight values. The first value indicates where the first input was copied to, the second value where the second input was copied to and so on. No assignment takes place with "0". f In01…f In08 REAL Setpoints to be linked. Outputs VAR_OUTPUT f Val01…f Val08 : REAL; END_VAR Name Type Description f Val01…f Val08 REAL Actuator setpoint, input value linked according to FIFO table. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 446 Version: 1.14.0 TF8040
## Page 447

Programming 6.1.2.2.3.1.5.3.12 Last Writer Wins 6.1.2.2.3.1.5.3.12.1 FB_BA_Last Writer Wins_R04 The function block switches the input value f Inxx at output f Q that changed last. The output n Act Input shows which input is currently being output. As long as nothing changes on the function block (the PLC has just started) and all inputs are set to "0", "0" is also output at the outputs f Q and n Act Input. If several inputs change simultaneously in a PLC cycle, the input with the lower ordinal number has priority, e.g.: f In01 before f In02. Inputs VAR_INPUT a FIFO : Array [1..8] OF UDINT; f In01…f In08 : REAL; END_VAR Name Type Description f In01…f In04 REAL Input values. Outputs VAR_OUTPUT f Q : REAL; n Act Input : USINT; END_VAR Name Type Description f Q REAL Output value. n Act Input USINT Indicates which input value is currently being output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.55 Tc3_BA2 from v5.3.19.0 TF8040 Version: 1.14.0 447
## Page 448

Programming 6.1.2.2.3.1.5.4 Hysteresis 2-Point-Control 6.1.2.2.3.1.5.4.1 FB_BA_Cont4Stp01 The function block FB_BA_Cont4Stp01 determines the resulting control steps of a multi-stage aggregate depending on the input signal. Four switch-on thresholds and four hystereses can be parameterized. Diagram 01 Control direction of parameter b Actn = FALSE = Reverse = Heating 448 Version: 1.14.0 TF8040
## Page 449

Programming n Stp n Num Of- f Swi On f Swi Off n Rem Ti n Rem Ti b Q01 b Q02 b Q03 b Q04 Stp Dly On Dly Off 0 0 f Swi On01 f Swi On01 n Dly On0 0 FALSE FALSE FALSE FALSE - f Hys01 1 1 >= 1 f Swi On02 f Swi On01 n Dly On0 n Dly Off0 TRUE FALSE FALSE FALSE - f Hys01 2 1 2 >= 2 f Swi On03 f Swi On02 n Dly On0 n Dly Off0 TRUE TRUE FALSE FALSE - f Hys02 3 2 3 >= 3 f Swi On04 f Swi On03 n Dly On0 n Dly Off0 TRUE TRUE TRUE FALSE - f Hys03 4 3 4 >= 4 f Swi On04 f Swi On04 0 n Dly Off0 TRUE TRUE TRUE TRUE - f Hys04 4 Diagram 02 Control direction parameter b Actn = TRUE = Direct = Cooling TF8040 Version: 1.14.0 449
## Page 450

Programming n Stp n Num Of- f Swi On f Swi Off n Rem Ti n Rem Ti b Q01 b Q02 b Q03 b Q04 Stp Dly On Dly Off 0 0 f Swi On01 f Swi On01 n Dly On0 0 FALSE FALSE FALSE FALSE + f Hys01 1 1 >= 1 f Swi On02 f Swi On01 n Dly On0 n Dly Off0 TRUE FALSE FALSE FALSE + f Hys01 2 1 2 >= 2 f Swi On03 f Swi On02 n Dly On0 n Dly Off0 TRUE TRUE FALSE FALSE + f Hys02 3 2 3 >= 3 f Swi On04 f Swi On03 n Dly On0 n Dly Off0 TRUE TRUE TRUE FALSE + f Hys03 4 3 4 4 f Swi On04 f Swi On04 0 n Dly Off0 TRUE TRUE TRUE TRUE + f Hys04 4 Diagram 03 Timing of the switch-on and switch-off delays At time t1 f In jumps from f Swi On01 to f Swi On04 At time t2 f In jumps from f Swi On04 to f Swi On01 - f Hys01 450 Version: 1.14.0 TF8040
## Page 451

Programming Inputs VAR_INPUT b En : BOOL; f In : REAL; f Swi On01 : REAL f Hys01 : REAL; n Dly On01 : UDINT; n Dly Off01 : UDINT; f Swi On02 : REAL; f Hys02 : REAL; n Dly On02 : UDINT; n Dly Off02 : UDINT; f Swi On03 : REAL; f Hys03 : REAL; n Dly On03 : UDINT; n Dly Off03 : UDINT; f Swi On04 : REAL; f Hys04 : REAL; n Dly On04 : UDINT; n Dly Off04 : UDINT; n Num Of Stp : UDINT; b Actn : BOOL; END_VAR TF8040 Version: 1.14.0 451
## Page 452

Programming Name Type Description b En BOOL General enable of the function block. If b En is FALSE, all outputs are set to 0. f In REAL Input value, from which the switching state is derived. f Swi On01 REAL Switch-on point step 01 f Hys01 REAL Absolute value hysteresis step 01 n Dly On01 UDINT Start-up delay step 01 n Dly Off01 UDINT Switch-off delay step 01 f Swi On02 REAL Switch-on point step 02 f Hys02 REAL Absolute value hysteresis step 02 n Dly On02 UDINT Start-up delay step 02 n Dly Off02 UDINT Switch-off delay step 02 f Swi On03 REAL Switch-on point step 03 f Hys03 REAL Absolute value hysteresis step 03 n Dly On03 UDINT Start-up delay step 03 n Dly Off03 UDINT Switch-off delay step 03 f Swi On04 REAL Switch-on point step 04 f Hys04 REAL Absolute value hysteresis step 04 n Dly On04 UDINT Start-up delay step 04 n Dly Off04 UDINT Switch-off delay step 04 n Num Of Stp UDINT Input of the number of steps required. The input is limited from 0 to 4. b Actn BOOL Input variable with which the control direction of the step switch is determined. TRUE = Direct = Cooling; FALSE = Reverse = Heating Outputs VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; n Stp : UDINT; f Swi On : REAL; f Swi Off : REAL; n Rem Ti Dly On : UDINT; n Rem Ti Dly Off : UDINT; END_VAR 452 Version: 1.14.0 TF8040
## Page 453

Programming Name Type Description b Q01 BOOL Display of status step 01 TRUE = ON; FALSE = OFF n Stp >= 1 b Q02 BOOL Display of status step 02 TRUE = ON; FALSE = OFF n Stp >= 2 b Q03 BOOL Display of status step 03 TRUE = ON; FALSE = OFF n Stp >= 3 b Q04 BOOL Display of status step 04 TRUE = ON; FALSE = OFF n Stp >= 4 n Stp UDINT Shows the current step of the step switch f Swi On REAL Shows the next switch-on point f Swi Off REAL Shows the next switch-off point n Rem Ti Dly On UDINT If the switch-on point for switching to the next level is met, the progress of the switch-on delay time is displayed here. n Rem Ti Dly Off UDINT If the switch-off point for switching down to the next level is met, the progress of the switch-off delay time is displayed here. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.5 Mathematics 6.1.2.2.3.1.5.5.1 FB_BA_En Avrg0X The function block calculates the arithmetic average from the enabled input values. The function block is available for the variants of 2, 4 and 8 input values. The following documentation refers to the FB_BA_En Avrg04. Inputs VAR_INPUT b En01…b En04 : BOOL; f Val01…f Val04 : REAL; END_VAR TF8040 Version: 1.14.0 453
## Page 454

Programming Name Type Description b En01…b En04 BOOL General enable of an average calculation. If b En0x = FALSE, the corresponding input value is not included for averaging. f Val01…f Val04 REAL The values from which the average value is to be calculated are applied to the variables f Val0 to f Val0x. Outputs VAR_OUTPUT f Avg Val : REAL; f Min Val : REAL; f Max Val : REAL; n Actv Cnt : UDINT; END_VAR Name Type Description f Avg Val REAL Calculated arithmetic average. f Min Val REAL Smallest input value. f Max Val REAL Largest input value. n Actv Cnt UDINT Number of input values considered for averaging. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.5.2 FB_BA_Multi Calc REAL32 The multi-calculation function block FB_BA_Multi Calc REAL32 exists for the variable type REAL. In enabled state (b En = TRUE), the function block determines the following from the input values a Val: • the maximum value of all inputs f Max • the input at which this maximum value is applied n Max Actv • the minimum value of all inputs f Min • the input at which this minimum value is applied n Min Actv • the average of all inputs f Avrg • the sum of all inputs f Sum • the difference between the maximum and minimum value f Diff If not all inputs are to be calculated, the number can be limited by an entry at n Num Of Elem: with n Num Of Elem= 6, for example, the calculations are performed only for the first six entries of a Val. An entry greater than 32 is automatically limited to 32, an entry less than 1 is automatically limited to 1. Sample: 454 Version: 1.14.0 TF8040
## Page 455

Programming Inputs Output b En = TRUE f Max = 32 a Val[1] = 32 n Max Actv = 1 a Val[2] = 17 f Min = 5 a Val[3] = 5 n Min Actv = 3 a Val[4] = 9 f Avrg = 18.5 a Val[5] = 16 f Sum = 111 a Val[6] = 32 f Diff = 27 a Val[7] = 25 a Val[8] = 44 n Num Of Elem = 6 If b En = FALSE, 0 is output at all outputs. Inputs VAR_INPUT b En : BOOL; a Val : ARRAY [1..???] of REAL; n Num Of Elem : UDINT; END_VAR Name Type Description b En BOOL Activation of the block function. a Val ARRAY OF REAL Field with the values to be calculated. n Num Of Elem UDINT Number of input values to be used for the calculation. Outputs VAR_OUTPUT f Max : REAL; n Max Actv : UDINT; f Min : REAL; n Min Actv : UDINT; f Avrg : REAL; f Sum : REAL; f Diff : REAL; b Err : BOOL; END_VAR Name Type Description f Max REAL Maximum value of all inputs. n Max Actv UDINT Input at which the maximum value is present. f Min REAL Minimum value of all inputs. n Min Actv UDINT Input at which the minimum value is present. f Avrg REAL Average value of all inputs f Sum REAL Sum of all inputs f Diff REAL Difference between maximum and minimum value. b Err BOOL This output is switched to TRUE if the parameters entered are erroneous. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 455
## Page 456

Programming 6.1.2.2.3.1.5.5.3 FB_BA_Chrct02 The function block FB_BA_Chrct02 represents a linear interpolation with 2 interpolation points and can be used to generate a characteristic curve. The characteristic curve is determined by the interpolation points [f X01/f Y01] and [f X02/f Y02]. The calculated output value f Calc Val is limited by f YMin or f YMax. Error handling The input values for f X0[n+1] must always be greater than from f X0[n]. In case of an error the variable b Err indicates this. The property Error Description gives out a detailed description. The input value for f YMin must not be greater than f YMax. Inputs VAR_INPUT f X : REAL; f X01 : REAL; f X02 : REAL; f Y01 : REAL; f Y02 : REAL; f YMin : REAL; f YMax : REAL; END_VAR 456 Version: 1.14.0 TF8040
## Page 457

Programming Name Type Description f X REAL Input value of the characteristic curve. f X0N REAL X-value for interpolation point PN. f Y0N REAL Y-value for interpolation point PN. f YMin REAL Lower limit of f Calc Val. The input for the lower limit is limited to the global parameter BAComn_Global.f Min Real from the Tc3_BA2_Common library. f YMax REAL Upper limit of f Calc Val. The input for the upper limit is limited to the global parameter BAComn_Global.f Max Real from the Tc3_BA2_Common library. Outputs VAR_OUTPUT f Calc Val : REAL; b Err : BOOL; END_VAR Name Type Description f Calc Val REAL Calculated output value of the characteristic curve. b Err BOOL This output is switched to TRUE if the parameters entered are erroneous. Properties Name Type Access Description Error Description T_Max String Get Issues a detailed description of errors, see error handling [} 456]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.5.4 FB_BA_Chrtc03 The function block FB_BA_Chrct03 represents a linear interpolation with 3 interpolation points and can be used to generate a characteristic curve. The characteristic curve is determined by the interpolation points [f X01/f Y01], [f X02/f Y02] and [f X03/f Y03]. The calculated output value f Calc Val is limited by f YMin or f YMax. TF8040 Version: 1.14.0 457
## Page 458

Programming Error handling The input values for f X0[n+1] must always be greater than from f X0[n]. In case of an error the variable b Err indicates this. The property Error Description gives out a detailed description. The input value for f YMin must not be greater than f YMax. Inputs VAR_INPUT f X : REAL; f X01 : REAL; f X02 : REAL; f X03 : REAL; f Y01 : REAL; f Y02 : REAL; f Y03 : REAL; f YMin : REAL; f YMax : REAL; END_VAR Name Type Description f X REAL Input value of the characteristic curve. f X0N REAL X-value for interpolation point PN. f Y0N REAL Y-value for interpolation point PN. f YMin REAL Lower limit of f Calc Val. The input for the lower limit is limited to the global parameter BAComn_Global.f Min Real from the Tc3_BA2_Common library. f YMax REAL Upper limit of f Calc Val. The input for the upper limit is limited to the global parameter BAComn_Global.f Max Real from the Tc3_BA2_Common library. Outputs VAR_OUTPUT f Calc Val : REAL; b Err : BOOL; END_VAR Name Type Description f Calc Val REAL Calculated output value of the characteristic curve. b Err BOOL This output is switched to TRUE if the parameters entered are erroneous. 458 Version: 1.14.0 TF8040
## Page 459

Programming Properties Name Type Access Description Error Description T_Max String Get Issues a detailed description of errors, see error handling [} 458]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.5.5 FB_BA_Chrct04 The function block FB_BA_Chrct04 represents a linear interpolation with 4 interpolation points and can be used to generate a characteristic curve. The characteristic curve is determined by the interpolation points [f X01/f Y01], [f X02/f Y02], [f X03/f Y03] and [f X04/f Y04]. The calculated output value f Calc Val is limited by f YMin or f YMax. Error handling The input values for f X0[n+1] must always be greater than from f X0[n]. In case of an error the variable b Err indicates this. The property Error Description gives out a detailed description. The input value for f YMin must not be greater than f YMax. TF8040 Version: 1.14.0 459
## Page 460

Programming Inputs VAR_INPUT f X : REAL; f X01 : REAL; f X02 : REAL; f X03 : REAL; f X04 : REAL; f Y01 : REAL; f Y02 : REAL; f Y03 : REAL; f Y04 : REAL; f YMin : REAL; f YMax : REAL; END_VAR Name Type Description f X REAL Input value of the characteristic curve. f X0N REAL X-value for interpolation point PN. f Y0N REAL Y-value for interpolation point PN. f YMin REAL Lower limit of f Calc Val. The input for the lower limit is limited to the global parameter BAComn_Global.f Min Real from the Tc3_BA2_Common library. f YMax REAL Upper limit of f Calc Val. The input for the upper limit is limited to the global parameter BAComn_Global.f Max Real from the Tc3_BA2_Common library. Outputs VAR_OUTPUT f Calc Val : REAL; b Err : BOOL; END_VAR Name Type Description f Calc Val REAL Calculated output value of the characteristic curve. b Err BOOL This output is switched to TRUE if the parameters entered are erroneous. Properties Name Type Access Description Error Description T_Max String Get Issues a detailed description of errors, see error handling [} 459]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 460 Version: 1.14.0 TF8040
## Page 461

Programming 6.1.2.2.3.1.5.5.6 FB_BA_Chrct07 The function block FB_BA_Chrct07 represents a linear interpolation with 7 interpolation points and can be used to generate a characteristic curve. The characteristic is determined by the interpolation points [f X01/ f Y01], [f X02/f Y02], [f X03/f Y03] … [f X07/f Y07]. The calculated output value f Calc Val is limited by f YMin or f YMax. Error handling The input values for f X0[n+1] must always be greater than from f X0[n]. In case of an error the variable b Err indicates this. The property Error Description gives out a detailed description. The input value for f YMin must not be greater than f YMax. TF8040 Version: 1.14.0 461
## Page 462

Programming Inputs VAR_INPUT f X : REAL; f X01 : REAL; f X02 : REAL; f X03 : REAL; f X04 : REAL; f X05 : REAL; f X06 : REAL; f X07 : REAL; f Y01 : REAL; f Y02 : REAL; f Y03 : REAL; f Y04 : REAL; f Y05 : REAL; f Y06 : REAL; f Y07 : REAL; f YMin : REAL; f YMax : REAL; END_VAR Name Type Description f X REAL Input value of the characteristic curve. f X0N REAL X-value for interpolation point PN. f Y0N REAL Y-value for interpolation point PN. f YMin REAL Lower limit of f Calc Val. The input for the lower limit is limited to the global parameter BAComn_Global.f Min Real from the Tc3_BA2_Common library. f YMax REAL Upper limit of f Calc Val. The input for the upper limit is limited to the global parameter BAComn_Global.f Max Real from the Tc3_BA2_Common library. Outputs VAR_OUTPUT f Calc Val : REAL; b Err : BOOL; END_VAR Name Type Description f Calc Val REAL Calculated output value of the characteristic curve. b Err BOOL This output is switched to TRUE if the parameters entered are erroneous. Properties Name Type Access Description Error Description T_Max String Get Issues a detailed description of errors, see error handling [} 461]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 462 Version: 1.14.0 TF8040
## Page 463

Programming 6.1.2.2.3.1.5.5.7 FB_BA_Chrct32 The function block FB_BA_Chrct32 represents a linear interpolation with 32 interpolation points and can be used to generate a characteristic curve. In contrast to the "smaller" interpolation function blocks FB_BA_Chrct02 [} 456], FB_BA_Chrct04 [} 459] and FB_BA_Chrct07 [} 461], and in the interest of clarity, the interpolation points are determined via field variables [a X[1]/a Y[1] to [a X[n]/a Y[n]]. The input variable n Num Of Elem determines the number of interpolation points from the field ranges a X/a Y. The calculated output value f Calc Val is limited by f YMin or f YMax. Error handling The input values for a X[n+1] must always be greater than from a X[n]. In case of an error the variable b Err indicates this. The property Error Description gives out a detailed description. The input value for f YMin must not be greater than f YMax. In case of an error the variable b Err indicates this. The property Error Description gives out a detailed description. Inputs VAR_INPUT f X : REAL; a X : ARRAY [1.. FB_BA_Chrct32.c BA_Num Of Elem] OF REAL; a Y : ARRAY [1.. FB_BA_Chrct32.c BA_Num Of Elem] OF REAL; n Num Of Elem : DINT(2..32); f YMin : REAL; f YMax : REAL; END_VAR TF8040 Version: 1.14.0 463
## Page 464

Programming Name Type Description f X REAL Input value of the characteristic curve. a X ARRAY OF REAL X-value for the interpolation points. a Y ARRAY OF REAL Y-value for the interpolation points. n Num Of Elem DINT Number of interpolation points. Internally limited to the range 2 ... 32. f YMin REAL Lower limit of f Calc Val. The input for the lower limit is limited to the global parameter BAComn_Global.f Min Real from the Tc3_BA2_Common library. f YMax REAL Upper limit of f Calc Val. The input for the upper limit is limited to the global parameter BAComn_Global.f Max Real from the Tc3_BA2_Common library. Outputs VAR_OUTPUT f Calc Val : REAL; b Err : BOOL; END_VAR Name Type Description f Calc Val REAL Calculated output value of the characteristic curve. b Err BOOL This output is switched to TRUE if the parameters entered are erroneous. Properties Name Type Access Description Error Description T_Max String Get Issues a detailed description of errors, see error handling [} 461]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.5.8 FB_BA_Ti Avrg The function block FB_BA_Ti Avrg calculates the average from a sequence of past input values. The function acquires input values f In at defined time intervals n Intval and calculates the average of the acquired values. After each time interval, a new average value f Out is available. The values to be averaged are written to a FIFO memory. This memory is limited to a maximum of 512 entries n Num Of Elem. After the time interval n Intval has elapsed, a new value is written to the memory and then the average value is formed. If the entries of the FIFO memory = n Num Of Elem, the oldest entry is deleted so that a new value is included for the average calculation. 464 Version: 1.14.0 TF8040
## Page 465

Programming Interval n Nu- f In FIFO memory f Out f Max f Min m Of Elem 1 5 2 2 / 1 2 2 2 2 5 4 (4+2) / 2 3 4 2 3 5 5 (5+4+2) / 3 3.667 5 2 4 5 6 (6+5+4+2) / 4 4.25 6 2 5 5 7 (7+6+5+4+2) / 5 4.8 7 2 6 5 9 (9+7+6+5+4) / 5 6.2 8 2 7 5 14 (14+9+7+6+5) / 5 8.2 14 2 8 5 1 (1+14+9+7+6) / 5 7.4 14 1 9 5 -4 (-4+1+14+9+7) / 5 5.4 14 -4 10 5 -12 ((-12)+(-4)+1+14+9) / 5 1.6 14 -12 Inputs VAR_INPUT b En : BOOL; f In : REAL; n Intval : UDINT; n Num Of Elem : UDINT; END_VAR Name Type Description b En BOOL Enables the function block. FALSE means that the output variables have the value 0 and the content of the FIFO memory is deleted. f In REAL Field with the values to be calculated. n Int Val UDINT Time interval [s] for writing new values into the FIFO. Internally limited to a value between 1 and 2147483. n Num Of Elem UDINT Size of the FIFO buffer. A change resets the previous averaging. Internally limited to a value between 1 and 512. Outputs Ausgänge f Out : REAL; f Max : REAL; f Min : REAL; END_VAR Name Type Description f Out REAL Calculated average f Max REAL Largest value in the FIFO buffer f Min REAL Smallest value in the FIFO buffer Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 465
## Page 466

Programming 6.1.2.2.3.1.5.5.9 FB_BA_Multi Calc REAL08 The function block FB_BA_Multi Calc REAL08 calculates the following values from the 8 input values f01...f08 in the enabled state(b En = TRUE): 1. the maximum value of all inputs f Max 2. the input at which this maximum value is applied n Max Actv 3. the minimum value of all inputs f Min 4. the input at which this minimum value is applied n Min Actv 5. the average of all inputs f Avrg 6. the sum of all inputs f Sum 7. the difference between the maximum and minimum value f Diff If not all inputs are used for the calculation, the number can be limited via an entry at n Num: n Num = 6, for example, can be used to limit the calculations to inputs f01...f06. Any entry greater than 8 is automatically limited to 8, any entry less than 1 is automatically set to 1. Sample: Inputs Output b En = TRUE f Max = 32 f01 = 32 n Max Actv = 1 f02 = 17 f Min = 5 f03 = 5 n Min Actv = 3 f04 = 9 f Avrg = 18.5 f05 = 16 f Sum = 111 f06 = 32 f Diff = 27 f07 = 25 f08 = 44 n Num = 6 Inputs VAR_INPUT b En : BOOL; f01…f08 : REAL; n Num : USINT(1..8); END_VAR Name Type Description b En BOOL Activation of the block function. f01...f08 REAL Input values to be used for the calculation. n Num USINT Number of input values to be used for the calculation. 466 Version: 1.14.0 TF8040
## Page 467

Programming Outputs VAR_OUTPUT f Max : REAL; n Max Actv : USINT; f Min : REAL; n Min Actv : USINT; f Avrg : REAL; f Sum : REAL; f Diff : REAL; END_VAR Name Type Description f Max REAL Maximum value of all inputs. n Max Actv USINT Input at which the maximum value is present. f Min REAL Minimum value of all inputs. n Min Actv UDSNT Input at which the minimum value is present. f Avrg REAL Average value of all inputs f Sum REAL Sum of all inputs f Diff REAL Difference between maximum and minimum value. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.1.5.6 Monitoring Functions 6.1.2.2.3.1.5.6.1 FB_BA_Fdb Ctrl Binary The function block FB_BA_Fdb Ctrl Binary is used for feedback monitoring of an actuator by means of digital feedback. Application examples of the function block are, for example, an operation feedback monitoring, a process feedback monitoring or the run monitoring of a drive by means of limit switches. The function block monitors a limit switch in two steps, for example. Step 1 includes monitoring while the actuator is moving. Step 2 includes monitoring of the opened state of the actuator. Step 1: If a TRUE is present at the input b Actuator, then the travel time of the actuator n Fdb Delay/ n Rem Ti Fdb Delay expires. If no TRUE is present at input b Switch within this time, this is indicated via output b Q. If b Switch becomes TRUE within the time n Fdb Delay, step 1 is complete and step 2 becomes active. Step 2: b Actuator and b Switch are TRUE. If b Actuator becomes FALSE, step 1 becomes active again. If b Switch becomes FALSE and within the time n Interruption Delay/n Rem Ti Interruption Delay is not TRUE again, this is indicated via the output b Q. In addition, the idle position of the actuator is monitored. That is, if b Actuator is not active and the feedback signal b Switch indicates a TRUE, then after the time n Fdb Delay has elapsed, the output b Q is set to TRUE. b Q signals that the monitoring of the feedback signal has a fault. TF8040 Version: 1.14.0 467
## Page 468

Programming Inputs VAR_INPUT b En : BOOL; b Actuator : BOOL; b Switch : BOOL; n Fdb Delay : UDINT; n Interruption Delay : UDINT; END_VAR Name Type Description b En BOOL General enable of the function block. If b En is FALSE, the message output b Q is also FALSE. b Actuator BOOL The switching actuator output of the aggregate to be monitored is connected to this input. b Switch BOOL Used to connect the feedback signal, e.g. of a differential pressure switch, flow monitor or limit switch. n Fdb Delay UDINT Response delay [s] of the monitoring function when the actuator is started. The input of the time is limited to the global parameter BAComn_Global.udi Max Sec In Milli from the Tc3_BA2_Common library (see BAComn_Global). n Interruption Delay UDINT Delay time (e.g. of a limit switch) in the open state in [s]. The input of the time is limited to the global parameter BAComn_Global.udi Max Sec In Milli from the Tc3_BA2_Common library, see (BAComn_Global). Outputs VAR_OUTPUT b Q : BOOL; n Rem Ti Fdb Delay : UDINT; n Rem Ti Interruption Delay : UDINT; END_VAR Name Type Description b Q BOOL b Q is used to signal that the monitoring of the feedback signal indicates a fault. n Rem Ti Fdb Delay UDINT Remaining time [s] until output b Q is set. The default comes from n Fdb Delay. n Rem Ti Interruption D UDINT Remaining time [s] until output b Q is set. The default elay comes from n Interruption Delay. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.6.2 FB_BA_Fixed Limit Ctrl This function block FB_BA_Fixed Limit Ctrl is used to monitor a fixed value. A tolerance range is defined around the value f In to be monitored. The tolerance range results from an upper limit f High Limit and a lower limit f Low Limit. 468 Version: 1.14.0 TF8040
## Page 469

Programming If the value f In exceeds the upper limit value of the tolerance range, then the output b High Limit is set. A response delay of the output b High Limit can be parameterized with the time variable n Delay. If the value f In falls below the lower limit value of the tolerance range, then the output b Low Limit is set. A response delay of the output b Low Limit can be parameterized with the time variable n Delay. If f Low Limit > f High Limit, then internally f Low Limit is corrected to f High Limit. Inputs VAR_INPUT b En : BOOL; f High Limit : REAL := 32; f Low Limit : REAL := 16; f In : REAL; n Delay : UDINT; END_VAR Name Type Description b En BOOL General enable of the function block. If b En is FALSE, the message outputs b High Limit and b Low Limit are also FALSE. f High Limit REAL Default upper limit. f Low Limit REAL Default lower limit. f In REAL Input value to be monitored. n Delay UDINT Response delay [s] of the outputs b High Limit/b Low Limit. The input of the time is limited to the global parameter BAComn_Global.udi Max Sec In Milli from the Tc3_BA2_Common library (see BAComn_Global). Outputs VAR_OUTPUT b High Limit : BOOL; b Low Limit : BOOL; n Rem Ti Delay : UDINT; END_VAR Name Type Description b High Limit BOOL Upper limit value reached. b Low Limit BOOL Lower limit value reached. n Rem Ti Delay UDINT Remaining time after exceeding a limit value until one of the outputs b High Limit or b Low Limit is set. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.6.3 FB_BA_Sliding Limit Ctrl The function block FB_BA_Sliding Limit Ctrl is used to monitor a sliding setpoint. The input b En is used for general enabling of the function block. TF8040 Version: 1.14.0 469
## Page 470

Programming To check the function of a control system, the actual value is compared with the setpoint of the controlled system. If the deviation between the setpoint and the actual value is within the tolerance range f Hys, then the control system is OK. If the actual value deviates from the setpoint by an amount outside this tolerance range over an extended period, the timer n Delay is started. After the timer has expired, if the control deviation remains, either the output b Low Limit or b High Limit TRUE of the function block outputs a message. Inputs VAR_INPUT b En : BOOL; f W : REAL; f X : REAL; f Hys : REAL; n Delay : UDINT; ENDVAR Name Type Description b En BOOL General enable of the function block. If b En is FALSE, the message outputs b High Limit and b Low Limit are also FALSE. f W REAL Setpoint f X REAL Actual value f Hys REAL Hysteresis n Delay UDINT Response delay [s] of the outputs b High Limit/b Low Limit. The input of the time is limited to the global parameter BAComn_Global.udi Max Sec In Milli from the Tc3_BA2_Common library (see BAComn_Global). Outputs VAR_OUTPUT b High Limit : BOOL; b Low Limit : BOOL; f High Limit : REAL; f Low Limit : REAL; n Rem Ti Delay : UDINT; END_VAR 470 Version: 1.14.0 TF8040
## Page 471

Programming Name Type Description b High Limit BOOL Upper limit value reached. b Low Limit BOOL Lower limit value reached. f High Limit REAL Output of the upper limit value. f High Limit = f W + (f Hys / 2) f Low Limit REAL Output of the lower limit value. f Low Limit = f W - (f Hys / 2) n Rem Ti Delay UDINT Remaining time after exceeding a limit value until one of the outputs b High Limit or b Low Limit is set. The default comes from n Delay. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.7 Step Control 6.1.2.2.3.1.5.7.1 FB_BA_Step Ctrl Agg16 The function block FB_BA_Step Ctrl Agg16 represents the higher-level control unit of a step sequence control of aggregates. The control unit FB_BA_Step Ctrl Agg16 can be used to sequentially switch on (st Agg01 > st Agg02 > st Agg03 > st Agg04 ... st Agg16) or switch off (st Agg16 > st Agg15 > st Agg14 > st Agg13 ... st Agg01) individual aggregates of a plant in a specific order. Data exchange between the receive blocks of the step sequence control (FB_BA_Step Binary [} 473], FB_BA_Step Mdlt [} 475]) and the control unit FB_BA_Step Ctrl Agg16 takes place via the data and command structures st Aggxx. TF8040 Version: 1.14.0 471
## Page 472

Programming Illustration FUNCTION_BLOCK FB_BA_Step Ctrl Agg16 VAR_INPUT b En Up Down : BOOL; n Num Of Agg : UDINT; END_VAR VAR_OUTPUT n Step : UDINT; b Up : BOOL; b Down : BOOL; n Rem Sec Step On : UDINT; n Rem Sec Step Off : UDINT; END_VAR VAR_IN_OUT st Agg01-16 : ST_BA_Step; END_VAR 472 Version: 1.14.0 TF8040
## Page 473

Programming Inputs Name Type Description b En Up Down BOOL A rising edge means an increasing switch-on sequence of the aggregates from 1 to 16. FALSE means a decreasing switch-off sequence from the highest, active aggregate towards 0. 0 means that no aggregate of the step sequence control is active. n Num Of Agg UDINT Input of the number of aggregates of the step sequence control. A limit only allows values from 1 - 16. Outputs Name Type Description n Step UDINT Display in which step the step sequence control is located. 0 means that no aggregate of the step sequence control is active. b Up BOOL Indicates that the sequence of the step sequence control is in the rising state. b Down BOOL Indicates that the sequence of the step sequence control is in the falling state. n Rem Sec Step Up UDINT Countdown switching to the next higher level [s]. n Rem Sec Step Down UDINT Countdown switching to the next lower level [s]. / Inputs Outputs Name Type Description st Agg01-16 ST_BA_Step [} 277] Data and command structure between the individual sequence controllers FB_BA_Seq Ctrl [} 168] and the function block FB_BA_Sequence Link Base. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.7.2 FB_BA_Step Binary The function block is part of a step sequence control. It communicates via the data and command structure st Step with the higher-level control unit of the step sequence control FB_BA_Step Ctrl Agg16 [} 471]. The command structure st Priority En contains the plant enable and the priorities. The command structure st Cmd controls the connected aggregate. TF8040 Version: 1.14.0 473
## Page 474

Programming Switch-on conditions of the connected aggregate Step enabling condition within the step sequence Switch-off conditions of the active aggregate within the step sequence Illustration FUNCTION_BLOCK FB_BA_Step Binary VAR_INPUT st Priority En : ST_BA_Priority En; b Val : BOOL; b Fdb : BOOL; n Dly On : UDINT; n Dly Off : UDINT; END_VAR VAR_OUTPUT st Cmd : ST_BA_Binary; n Rem Sec Step Up : UDINT; 474 Version: 1.14.0 TF8040
## Page 475

Programming n Rem Sec Step Down : UDINT; END_VAR VAR_IN_OUT st Step : ST_BA_Step; END_VAR Inputs Name Type Description st Priority En ST_BA_Priority En [} 278] The command structure includes the plant enable and the priorities "Safety", "Critical" and "Program". b Val BOOL Switch-on value for the connected aggregate. b Fdb BOOL Feedback of the connected aggregate. The feedback is required for switching to the next step. b Fdb is only considered if the aggregate is the active one in the step sequence control. n Dly On UDINT Time specification of start-up delay [s]. The time specification is required for switching to the next step. n Dly Off UDINT Time specification of switch-off delay [s]. The time specification is needed to switch off the active step. Outputs Name Type Description st Cmd ST_BA_Binary [} 277] The command structure st Cmd transmits the enables and switching values of the priorities to the connected aggregate. n Rem Sec Step Up UDINT Countdown switching to the next higher level [s]. n Rem Sec Step Down UDINT Countdown switching to the next lower level [s]. / Inputs Outputs Name Type Description st Step ST_BA_Step [} 277] Data and command structure between the step sequence function block FB_BA_Step Binary and the control block of the step sequence FB_BA_Step Ctrl Agg16 [} 471]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.1.5.7.3 FB_BA_Step Mdlt The function block is part of a step sequence control. It communicates via the data and command structure st Step with the higher-level control unit of the step sequence control FB_BA_Step Ctrl Agg16 [} 471]. The command structure st Priority En contains the plant enable and the priorities. TF8040 Version: 1.14.0 475
## Page 476

Programming The command structure st Cmd controls the connected aggregate. Switch-on condition of the connected aggregate Step enabling condition within the step sequence 476 Version: 1.14.0 TF8040
## Page 477

Programming Switch-off condition of the active aggregate within the step sequence Inputs Name Type Description st Priority En ST_BA_Priority En [} 278] The command structure includes the plant enable and the priorities "Safety", "Critical" and "Program". e Val E_BA_Mdlt [} 270] Switch-on value for the connected aggregate. b Fdb BOOL Feedback of the connected aggregate. The feedback is required for switching to the next step. b Fdb is only considered if the aggregate is the active one in the step sequence control. n Dly On UDINT Time specification of start-up delay [s]. The time specification is required for switching to the next step. n Dly Off UDINT Time specification of switch-off delay [s]. The time specification is needed to switch off the active step. Outputs Name Type Description st Cmd ST_BA_Mdlt [} 276] The command structure st Cmd transmits the enables and switching values of the priorities to the connected aggregate. n Rem Sec Step Up UDINT Countdown switching to the next higher level [s]. n Rem Sec Step Down UDINT Countdown switching to the next lower level [s]. / Inputs Outputs Name Type Description st Step ST_BA_Step [} 277] Data and command structure between the step sequence function block FB_BA_Step Binary and the control block of the step sequence FB_BA_Step Ctrl Agg16 [} 471]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 TF8040 Version: 1.14.0 477
## Page 478

Programming 6.1.2.2.3.1.5.8 Plant Control 6.1.2.2.3.1.5.8.1 FB_BA_Aggregate The aggregate function block represents a receive block of a step sequence controller. It communicates via the data and command structure st Aggregate with the higher-level plant control unit of the step sequence control FB_BA_Plant Control [} 480]. The function block is used to evaluate the structure st Aggregate. The result is output at the inputs and outputs of the function block. Syntax FUNCTION_BLOCK FB_BA_Aggregate VAR_INPUT b Fdb Up : BOOL; b Fdb Down : BOOL; END_VAR VAR_OUTPUT arr Priorities : ARRAY [0.. BA_Param.n Max Priority] OF BOOL; n Prio : UDINT; b Priority Active : BOOL; b Value : BOOL; n Value : UDINT; f Value : REAL; END_VAR VAR_IN_OUT st Aggregate : ST_BA_Aggregate; END_VAR Inputs Name Type Description b Fdb Up BOOL A feedback from the aggregate is applied to the input. It is used within the step sequence control to switch up to the next higher step. The feedback is transmitted to the plant control unit via the data and command structure st Aggregate. b Fdb Down BOOL A feedback from the aggregate is applied to the input. It is used to switch down to the next lower step. The feedback is transmitted to the plant control unit via the data and command structure st Aggregate. 478 Version: 1.14.0 TF8040
## Page 479

Programming Outputs Name Type Description arr Priorities BOOL The binary array outputs the enables of the priorities. Only one priority is active at a time. n Prio indicates which one it is. n Prio UDINT Indicates which priority is active. b Priority Active BOOL One priority is enabled. b Value BOOL Binary switching value for the aggregate. n Value UDINT Multi-stage switching value for the aggregate. f Value REAL Analog control value for the aggregate. / Inputs Outputs Name Type Description st Aggregate ST_BA_Aggregate [} 278] The aggregate structure is used for bidirectional communication between the connected aggregate FB_BA_Aggregate and the plant control FB_BA_Plant Control [} 480]. TF8040 Version: 1.14.0 479
## Page 480

Programming Properties Name Type Access Description Down BOOL Get Indicates that the sequence of the step sequence control is in the falling state. Op Mode UDINT Get Displays the current operation mode of the plant control. Prio UDINT Get Indicates which priority is the active one in the plant control. Step UDINT Get Indicates the current step of the plant control. Up BOOL Get Indicates that the sequence of the step sequence control is in the rising state. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.55 Tc3_BA2 from v5.3.19.0 6.1.2.2.3.1.5.8.2 FB_BA_Plant Control The function block realizes the sequential start-up of a plant. When starting, the aggregates are switched on one after the other in a specific order. When switching off the plant, the aggregates are switched off in reverse order. The steps of the start sequence and the profiles with the specific releases of individual aggregates result in a switching matrix. 480 Version: 1.14.0 TF8040
## Page 481

Programming Switching matrix The plant steps are shown in the column framed vertically in red. TF8040 Version: 1.14.0 481
## Page 482

Programming The start sequence of the plant begins with the element [1] ERC, energy recovery. The element [2] Pre Heater Pre Rinse, etc. follows. The starting sequence of the aggregates is the same for all plant profiles. The horizontal green framed area contains the descriptions of the plant profiles. The profiles can be used to command aggregates with regard to project-specific requirements. Each plant profile has its own step sequence within which the aggregates are commanded. The input variable n Profile determines the plant profile or the column in the control matrix. The area highlighted in yellow contains the command for the ERC (energy recovery) aggregate for the Auto profile (normal operation). As this is the binary release of the aggregate, b Value = TRUE. Multi-stage aggregates can be commanded with the variable n Value and continuous aggregates with the variable f Value. The blue framed field contains variables for parameterization of the start sequence. These parameters can be used to define different timers and conditions for switching the start sequence up and down for each profile. In this sample, b En Fdb Up = TRUE. This means that feedback from the aggregate Pre Heater is expected before the start sequence switches up and the next aggregate with the index [3] Dmp Ou A (outside air damper) switches on. The start of the sequence is activated depending on the input variable b Start. A rising edge at b Start begins commanding the aggregate with the index [1] and continues with the start process until the highest level of switching sequences is reached. In the picture, the start of the sequence in the Auto profile is illustrated with the green arrow and contains 8 switching sequences. A falling edge at b Start triggers the shutdown of the start sequence in reverse order. This is shown in the picture by the red arrow. If b Start becomes FALSE (falling edge) during the start process, the sequence runs down again from the currently active step to the complete shutdown of all aggregates. This is shown in the picture by the red arrow. NOTICE Locking the aggregates If a changeover is made from one profile to another during upward or downward travel, the commands for the new profiles are issued directly to the aggregates until the plant step n Step. The aggregates above the current sequence (> n Step) receive the following commands: b Value = FALSE, n Value = 0 and f Value = 0.0 Necessary interlocks regarding the switch-on and switch-off sequence are therefore not always guaranteed. External interlocking of the aggregates must therefore be used to ensure that no critical switching states occur. Alternatively, the active operation mode can first be completely shut down in its sequence before switching to a new profile using n Profile. Syntax FUNCTION_BLOCK FB_BA_Plant Ctrl VAR_INPUT b Start : BOOL; n Profile : UDINT; END_VAR VAR_INPUT CONSTANT PERSISTENT arr Step Description : ARRAY [1.. MAX(1,BA_Param.n Max Aggregate)] OF T_Max String; arr Profile Description : ARRAY [1.. MAX(1,BA_Param.n Max Profile)] OF ST_BA_Profiel Description; arr Profile Parameter : ARRAY [1.. MAX(1,BA_Param.n Max Profile),1.. MAX(1,BA_Param.n Max Aggregate)] OF ST_BA_Profile Parameter; END_VAR VAR_OUTPUT n Step : UDINT; b Up : BOOL; b Down : BOOL; n Rem Ti Up : UDINT; n Rem Ti Down : UDINT; END_VAR 482 Version: 1.14.0 TF8040
## Page 483

Programming VAR_IN_OUT arr Aggregate : ARRAY [1.. MAX(1,BA_Param.n Max Aggregate)] OF ST_BA_Aggregate; END_VAR Inputs Name Type Description b Start BOOL A rising edge starts the sequence. On a falling edge, the sequence is run down in reverse order. n Profile UDINT The current, valid profile is transferred to the control matrix via the input. Inputs CONSTANT PERSISTENT Name Type Description arr Step Description ARRAY The plain text of the plant steps is specified in the array. [1.. MAX(1,BA_Param.n Ma This information is purely for display purposes. x Aggregate [} 284])] OF The red framed area in the switching matrix indicates this. T_Max String Initialization plain text plant steps, see sample 1. arr Profile Description ARRAY The profiles of the control matrix are defined in the array. [1.. MAX(1,BA_Param.n Ma The green framed area in the switching matrix indicates x Profile [} 284])] OF this. ST_BA_Profile Description Initialization of the profile description, see sample 2. [} 279] arr Profile Parameter ARRAY The two-dimensional array contains all the parameters for [1.. MAX(1,BA_Param.n Ma commanding the aggregates and parameterization of the step sequences. Each element of the array contains the x Profile profile parameter structure. [} 284]),1.. MAX(1,BA_Para m.n Max Aggregate In the switching matrix, the orange and blue framed area indicates a part of the array. [} 284])] OF ST_BA_Profile Parameter Initialization of the parameters for the Auto profile, see sample 3. [} 280] Samples Sample 1: Initialization plain text plant steps Sample 2: Initialization of the profile description TF8040 Version: 1.14.0 483
## Page 484

Programming Sample 3: Initializing the parameters for the Auto profile The first index of the array stands for the profile n Profile, the second for the step in the start sequence or for the aggregate. 484 Version: 1.14.0 TF8040
## Page 485

Programming TF8040 Version: 1.14.0 485
## Page 486

Programming Outputs Name Type Description n Step UDINT The variable indicates which step the sequence is in. n Step = 0 means that no aggregate of the step sequence control is active. b Up BOOL Indicates that the sequence of the step sequence control is in the rising state. b Down BOOL Indicates that the sequence of the step sequence control is in the falling state. n Rem Ti Up UDINT Countdown switching to the next level [s]. n Rem Ti Down UDINT Countdown switching off the active level [s]. / Inputs Outputs Name Type Description arr Aggregates ST_BA_Aggregate [} 278] The array contains a bidirectional data and command structure for each aggregate. The order of the aggregates in the switching matrix is determined by the connection order of the structures. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.55 Tc3_BA2 from v5.3.19.0 6.1.2.2.3.1.5.9 Sequence 6.1.2.2.3.1.5.9.1 FB_BA_PIDControl Sequence PID sequence controller as part of a sequence. On receipt of the enable b En = TRUE, the higher-level control block FB_BA_Sequence Link Base [} 171] is informed that the sequence controller is ready for operation for sequence control. The data exchange between the sequence controllers FB_BA_Seq Ctrl and the control block FB_BA_Sequence Link Base [} 171] takes place via the structure st Seq Link [} 123]. 486 Version: 1.14.0 TF8040
## Page 487

Programming Output value f Present Value The function block determines the resulting value at the output f Present Value depending on the enables b En and st Sequence Link.b En Seq Link, the control direction e Action Pgm / e Action Rm and the sequence number n Actv Seq Ctrl / n My Num. b En st Se- e Action Pgm/e Ac- n Actv Seq Ctrl/ f Present Value quence Link.b En Se- tion Rm n My Num q Link TRUE FALSE E_BA_Action.e Reve f Max Output Pgm / rse f Max Output Rm TRUE FALSE E_BA_Action.e Direc f Min Output Pgm / t f Min Output Rm FALSE FALSE 0 TRUE TRUE E_BA_Action.e Reve n Actv Seq Ctrl > f Min Output Pgm / rse n My Num f Min Output Rm TRUE TRUE E_BA_Action.e Reve n Actv Seq Ctrl < f Max Output Pgm / rse n My Num f Max Output Rm TRUE TRUE E_BA_Action.e Direc n Actv Seq Ctrl < f Min Output Pgm / t n My Num f Min Output Rm TRUE TRUE E_BA_Action.e Direc n Actv Seq Ctrl > f Max Output Pgm / t n My Num f Max Output Rm TRUE TRUE n Actv Seq Ctrl = FB_BA_Loop.f Prese n My Num nt Value Error detection The error messages listed below are detected by FB_BA_Seq Ctrl. The x in the text messages stands for a numerical specification of a sequence controller. The error messages are output in the "Error list" window in the Tc3 development environment. This can be activated under the menu item View. The error texts are output via the properties Error Param Max Seq Ctrl and Error Seq Num Multiple. Globaler Parameter Tc3_BA2. BA_Param.n Max Seq Ctrl < 1 This message is the only one that disables sequence control. German English Globaler Parameter Global parameter Tc3_BA2. BA_Param.n Max Seq Ctrl Tc3_BA2. BA_Param.n Max Seq Ctrl < 1 < 1 Sequenznummer n My Num = x mehrfach vergeben Sequence number n My Num = x assigned multiple times Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_Loop [} 220] Syntax FUNCTION_BLOCK FB_BA_Seq Ctrl EXTENDS FB_BA_Loop VAR_INPUT n My Num : UDINT; END_VAR VAR_OUTPUT TF8040 Version: 1.14.0 487
## Page 488

Programming f E : REAL; b Seq Actv : BOOL; n Actv Seq Ctrl : UDINT; b Is Actv Seq Ctrl : BOOL; b Err : BOOL; END_VAR VAR_IN_OUT st Seq Link : ST_BA_Seq Link; END_VAR Inputs Name Type Description n My Num UDINT My number in the sequence. This number may only be present once in a sequence control. An internal limitation only allows values from 1 - XBA_Param.n Max Seq Ctrl [} 126]. Outputs Name Type Description f E REAL Displays the control deviation of the sequence controller. This depends on the control direction of the sequence controller. E_BA_Action.e Direct -> f E = f X-f W E_BA_Action.e Reverse -> f E = f W-f X b Seq Actv BOOL The sequence controller is implemented in the control sequence. n Actv Seq Ctrl UDINT Number of the active sequence controller. b Is Actv Seq Ctrl BOOL Indicates that the sequence controller is the active one in the sequence control. The property Is Actv Seq Ctrl also displays this message. b Err BOOL Indicates that an error has been detected. More detailed information is shown in the properties Error Param Max Seq Ctrl and Seq Num Multiple. Further explanations on error analysis can be found at Error detection [} 487]. / Inputs Outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] Data and command structure between the individual sequence controllers FB_BA_Seq Ctrl [} 168] and the function block FB_BA_Sequence Link Base [} 171]. 488 Version: 1.14.0 TF8040
## Page 489

Programming Properties Name Type Access Description Actv Seq Ctrl UDINT Get The property shows the number of the active sequence controller. Error Param Max Seq T_Max String Get The property displays the following text in case of Ctrl error: "Global parameter Tc3_BA2. BA_Param.n Max Seq Ctrl < 1", see BA_Param.n Max Seq Ctrl [} 284]. The global parameter must be adjusted in any case, because due to the wrong parameterization the sequence stops. Seq Num Multiple T_Max String Get The property displays the following text in case of error: "Sequence number n My Num = x assigned multiple times". A check of the displayed sequence number is necessary because it has been assigned several times in the sequence. Is Actv Seq Ctrl BOOL Get The sequence controller is the active one in the sequence control. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.56 Tc3_BA2 from v5.4.2.0 6.1.2.2.3.1.5.9.2 FB_BA_PIDControl Sequence Link This function block represents the higher-level connection of a sequence control. Data exchange sequence control The data exchange between the sequence controllers FB_BA_Seq Ctrl [} 168] and the FB_BA_Sequence Link Base takes place via the structure st Seq Link [} 123]. TF8040 Version: 1.14.0 489
## Page 490

Programming Start behavior of the sequence A TRUE signal at input b En activates the entire sequence control. The function block will initially activate the sequence controller that is known at n Num Start Ctrl. All other sequence controller base their output value [} 168] on the ranking of the active controller. If the sequence controller specified at n Num Start Ctrl is not ready for operation, the enum e No Start Ctrl Found defines the procedure to find a new start controller. This ensures that the sequence always starts. Switching in the sequence If a sequence controller reaches its maximum or minimum value, the system switches to the next controller in the sequence depending on the control direction, provided that the actual value falls below or exceeds the setpoint of the next controller. 4 cases are distinguished: • The still active controller has a direct control direction (cooling, E_BA_Action.e Direct) and is at its maximum value: The next higher controller is selected in the ranking order if the actual value exceeds the setpoint of this controller. • The still active controller has a direct control direction (cooling, E_BA_Action.e Direct) and is at its minimum value: The next lower controller in the ranking order is selected if the actual value falls below the setpoint of this controller. • The still active controller has an indirect control direction (heating, E_BA_Action.e Reverse) and is at its maximum value: The next lower controller in the ranking order is selected if the actual value falls below the setpoint of this controller. • The still active controller has an indirect control direction (heating, E_BA_Action.e Reverse) and is at its minimum value: The next higher controller is selected in the ranking order if the actual value exceeds the setpoint of this controller. Switching to another sequence controller can be delayed by specifying the time n Swi Over Ti. Operational readiness of the sequence controllers If a controller loses its operational readiness in the sequence (missing enable b En), it is no longer available for the entire sequence. 490 Version: 1.14.0 TF8040
## Page 491

Programming If this is not the previously active controller, a temperature change may occur, depending on which control value this controller has output, which is compensated by the controller sequence, if possible. However, if it is the active sequence controller, the enumeration e No Enable Seq Ctrl defines the procedure to find a new, active sequence controller. If a sequence controller obtains its operational readiness in the running process, the controller is added to the sequence. Depending on the control direction E_BA_Action and its own sequence number n My Num, it will be placed in the controller sequence and output its minimum or maximum value. The resulting temperature change is compensated by the controller sequence, if possible. Error detection The error messages listed below are detected by FB_BA_Sequence Link Base. The x in the text messages stands for a numerical specification of a sequence controller. The error messages are output in the "Error list" window in the Tc3 development environment. This can be activated under the menu item View. Output of the error texts via the property State Text. The enumeration e State additionally displays the messages. Global parameter Tc3_BA2. BA_Param.n Max Seq Ctrl < 1 This message is the only one that disables sequence control. German English Der nächste Sequenzsollwert ist kleiner als sein Next sequence setpoint is smaller than its Vorgänger: x predecessor: x Globaler Parameter Global parameter Tc3_BA2. BA_Param.n Max Seq Ctrl Tc3_BA2. BA_Param.n Max Seq Ctrl < 1 < 1 Mehrfache Wirkrichtung "e Actn" in der Multiple direction of action "e Actn" of the sequence Sequenzsteuerung controller Startsequenzregler ist nicht freigegeben: Start sequence controller is not enabled: n Num Start Ctrl = x n Num Start Ctrl = x Kein Sequenzregler ist betriebsbereit No sequence controller is operational Sequenznummer mehrfach vergeben: x Sequence number assigned multiple times: x Syntax FUNCTION_BLOCK FB_BA_Sequence Link Base VAR_INPUT b En : BOOL; n Num Start Ctrl : UDINT; {attribute 'parameter Unit':= 's'} n Swi Over Ti : UDINT(0..1800); END_VAR VAR_OUTPUT b Seq Ctrl Operational : BOOL; n Actv Seq Ctrl : UDINT; f Actv Seq Ctrl_Y : REAL; f Actv Seq Ctrl_X : REAL; f Actv Seq Ctrl_W : REAL; b Actv Seq Ctrl Is Max Limit : BOOL; b Actv Seq Ctrl Is Min Limit : BOOL; b Err : BOOL; e State : E_BA_State Seq Link; {attribute 'parameter Unit':= 's'} n Rem Ti Swi Ovr Ti : UDINT; END_VAR VAR_IN_OUT st Seq Link : ST_BA_Seq Link; END_VAR VAR_INPUT CONSTANT f Hys : REAL := 0.2; e No Start Ctrl Found : E_BA_No Start Ctrl Found := E_BA_No Start Ctrl Found.e Last Acti TF8040 Version: 1.14.0 491
## Page 492

Programming on Reverse; e No Enable Seq Ctrl : E_BA_No Enable Seq Ctrl := E_BA_No Enable Seq Ctrl.e Next Action ; END_VAR Inputs Name Type Description b En BOOL Sequence control is activated when the function block is enabled. However, the sequence controllers must first be enabled. n Num Start Ctrl UDINT Ordinal number of the sequence controller, which should be the start controller when the sequence is activated. An internal limitation allows only values from 1 - BA_Param.n Max Seq Ctrl [} 284]. n Swi Over Ti UDINT Switching to another sequence controller can be delayed by the time specification. An internal limitation only allows values from 0 - 1800 seconds. Outputs Name Type Description b Seq Ctrl Operational BOOL The sequence control is ready to operate or is in operation. n Actv Seq Ctrl UDINT The output variable shows the number of the active sequence controller. f Actv Seq Ctrl_Y REAL Control value of the active sequence controller. f Actv Seq Ctrl_X REAL Actual value of the active sequence controller. f Actv Seq Ctrl_W REAL Setpoint of the active sequence controller. b Actv Seq Ctrl Is Max Li BOOL The upper output limit of the active sequence controller mit has been reached. If it has not yet been advanced to the next sequence controller, b Actv Seq Ctrl Is Max Limit is not set to FALSE until f Actv Seq Ctrl_Y has fallen below (f Actv Seq Ctrl_Y - f Hys). b Actv Seq Ctrl Is Min Li BOOL The lower output limit of the active sequence controller has mit been reached. If it has not yet been advanced to the next sequence controller, b Actv Seq Ctrl Is Min Limit is not set to FALSE until f Actv Seq Ctrl_Y has risen above (f Actv Seq Ctrl_Y + f Hys). b Err BOOL Indicates that an error has been detected. More detailed information is provided by the property State Text. In addition, the enum e State displays further information. Further explanations on error analysis can be found at Error detection [} 491]. e State E_BA_State Seq Link The enumeration shows the state of the FB_BA_Sequence Link Base and the sequence control. n Rem Ti Swi Ovr Ti UDINT Countdown of switching to the next sequence controller [s]. 492 Version: 1.14.0 TF8040
## Page 493

Programming / Inputs Outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] Data and command structure between the individual sequence controllers FB_BA_Seq Ctrl [} 168] and the function block FB_BA_Sequence Link Base [} 489]. Inputs CONSTANT Name Type Description f Hys REAL This hysteresis value sets a hysteresis around the upper and lower output limit b Actv Seq Ctrl Is Max Limit / b Actv Seq Ctrl Is Min Limit of the active sequence controller. An internal limitation only allows values from 0 - 2. e No Start Ctrl Found E_BA_No Start Ctrl Found If during the running process the active sequence controller loses its operational readiness, then the enumeration defines the procedure to find a new, active sequence controller. e No Enable Seq Ctrl E_BA_No Enable Seq Ctrl If the start controller at the input n Num Start Ctrl is not available or enabled, the enumeration defines the procedure to find a new start controller. TF8040 Version: 1.14.0 493
## Page 494

Programming Properties 494 Version: 1.14.0 TF8040
## Page 495

Programming Name Type Access Description First Actv Seq Ctrl UDINT Get The property shows the number of the first sequence controller ready for operation. First Actv Seq Ctrl Wit UDINT Get The property shows the number of the first h Action Direct sequence controller ready for operation with the control direction E_BA_Action.e Direct. Last Actv Seq Ctrl UDINT Get The property shows the number of the last sequence controller ready for operation. Last Actv Seq Ctrl Wit UDINT Get The property shows the number of the last sequence h Action Reverse controller ready for operation with the control direction E_BA_Action.e Reverse. Next Action Actv Seq UDINT Get Depending on the control direction of the active Ctrl sequence controller n Actv Seq Ctrl the next sequence controller ready for operation is displayed here. Cooling/Direct control direction: next sequence controller ready for operation with the Cooling/Direct control direction (after 5 would come 6 or higher). If none is found, then E_BA_No Enable Seq Ctrl.e Last Seq Num is implemented. Heating/reverse control direction: previous operational sequence controller with heating/reverse control direction (after 5 would come 4 or lower). If none is found, then E_BA_No Enable Seq Ctrl.e First Seq Num is implemented. Next Actv Seq Ctrl UDINT Get The property shows the number of the next sequence controller ready for operation after the last active one (after 5 would come 6 or higher). Previous Actv Seq Ctr UDINT Get The property shows the number of the previous l sequence controller ready for operation after the last active one (after 5 would come 4 or lower). Actv Seq Ctrl UDINT Get The property shows the number of the active sequence controller, see n Actv Seq Ctrl. Actv Seq Ctrl_Control REAL Get The property shows the control value of the active Value sequence controller, see f Actv Seq Ctrl_Y. Actv Seq Ctrl_Is Max L BOOL Get The property indicates that the upper output limit of imit the active sequence controller has been reached, see b Actv Seq Ctrl Is Max Limit. Actv Seq Ctrl_Is Min Li BOOL Get The property indicates that the lower output limit of mit the active sequence controller has been reached, see b Actv Seq Ctrl Is Min Limit. Error Param Max Seq T_Max String Get The property displays the following text in case of Ctrl error: "Global parameter Tc3_BA2. BA_Param.n Max Seq Ctrl < 1", see BA_Param.n Max Seq Ctrl [} 284]. The global parameter must be adjusted in any case, because due to the wrong parameterization the sequence stops. Error Start Seq Ctrl No T_Max String Get The property displays the following text in case of t Operable error: "Start sequence controller is not enabled: n Num Start Ctrl = x". A check of the start sequence controller, which was specified with the input variable n Num Start Ctrl, is required. TF8040 Version: 1.14.0 495
## Page 496

Programming Name Type Access Description Multi Direction Action T_Max String Get The property displays the following text in case of Seq Ctrl error: Multiple direction of action "e Actn" of the sequence controller: x. Multiple direction of action of the sequence controller. It always looks from the sequence controller with the smallest number to the next largest one. It is possible to change the direction of action. Next Seq Sp Is Smalle T_Max String Get The property displays the following text in case of r error: "Next sequence setpoint is smaller than its predecessor: x". A check of the setpoints of the sequence controllers according to ascending order is required. No Seq Ctrl Is Operati T_Max String Get The property displays the following text in case of an onal error: "No sequence controller is operational". A check of the operational readiness of the sequence controllers is required. Seq Num Multi T_Max String Get The property displays the following text in case of error: "Sequence number assigned multiple times: x". A check of the displayed sequence number is necessary because it has been assigned several times in the sequence. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.56 Tc3_BA2 from v5.4.2.0 6.1.2.2.3.1.5.10 Schedule 6.1.2.2.3.1.5.10.1 Base 6.1.2.2.3.1.5.10.1.1 FB_BA_Schedule Base The basic schedule represents the parameterization and evaluation of the derived schedule function blocks FB_BA_Schedule Analog [} 512], FB_BA_Schedule Binary [} 513] and FB_BA_Schedule Multistate [} 512]. The function block contains the actual schedule entries for 24 exception days and 7 weekdays. The schedule entries for the 24 exception days are parameterized in the a Exception list. The schedule entries for the 7 days of the week are parameterized in the a Week list. The three derived schedule function blocks FB_BA_Schedule Analog [} 512], FB_BA_Schedule Binary [} 513] and FB_BA_Schedule Multistate [} 512] have identical functionality - they differ only in the data type of the switching values, see example initializations. Different data types cannot be mixed within a schedule function block. 496 Version: 1.14.0 TF8040
## Page 497

Programming Determination of the resulting switching command All schedule entries active at a specific time are summarized in an internal priority matrix. From these schedule entries, the one with the highest switching time determines the switching value at one of the derived function blocks FB_BA_Schedule Analog [} 512], FB_BA_Schedule Binary [} 513] or FB_BA_Schedule Multistate [} 512]. The schedule entries are evaluated cyclically. A schedule command is only valid for one day at a time (until midnight). Either a new switching command is defined from midnight or the default value of the derived schedule function blocks is output at the Present Value. The basic schedule determines the resulting switching command entry Present Value according to the following criteria: An active exception profile with an active schedule entry has priority over a weekly timer; the weekly timer is then not taken into account. If an active exception profile does not have a schedule entry, the weekly timer is automatically added. This entry is equivalent to an active exception profile with an active schedule entry. The weekly timer only comes into play if no exception profile is active and determines the Present Value based on active schedule entries. If the weekly timer does not have an active schedule entry either, the default value = Present Value. Samples of configuration in connection with other Schedule function blocks [} 498]. Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT {region 'Variable Parameters'} {attribute 'parameter Category':='Value'} a Week : T_BA_Schedule Week; {attribute 'parameter Category':='Value'} a Exception : T_BA_Schedule Exception List; {endregion} END_VAR Name Type Description a Week T_BA_Schedule Week The weekly program a Week contains a daily profile for each day of the week (Monday to Sunday). [} 282] A profile consists of the following properties: • List of schedule entries Sample declarations can be found attached [} 498]. a Exception T_BA_Schedule Exception Li The a Exception list contains 24 schedule exception profiles. st [} 283] A profile consists of the following properties: • Period types (Simple date, Date range, Week and day) • Date value • List of schedule entries Sample declarations can be found attached [} 498]. TF8040 Version: 1.14.0 497
## Page 498

Programming Properties Name Type Access Definition Description location Exception T_BA_Schedule Exc Get / Set Public The Exception property enables read and write access to the exception entries of the eption List [} 283] schedule. Week T_BA_Schedule We Get / Set Public The Week property enables read and write access to the weekly program of the ek [} 282] schedule. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.2.0 6.1. Samples for initializations 2.2. 3.1. 5.1 0.1. 1.1 Weekly schedule/week for FB_BA_Schedule Binary [} 513] From Monday to Sunday, a function is switched on at 6:00. It is switched off every day at 18:00. If this function was switched on externally after 18:00, it is switched off again at 0:00. // Monday Schedule.a Week[E_BA_Weekday.e Monday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,1].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,2].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Monday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,3].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Second := 0; // Tuesday Schedule.a Week[E_BA_Weekday.e Tuesday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Tuesday,1].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Tuesday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Tuesday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Tuesday,2].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Tuesday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Tuesday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Tuesday,3].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Tuesday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,3].st Time.n Second := 0; // Wednesday Schedule.a Week[E_BA_Weekday.e Wednesday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Wednesday,1].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Wednesday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Wednesday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Wednesday,2].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Wednesday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Wednesday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,2].st Time.n Second := 0; 498 Version: 1.14.0 TF8040
## Page 499

Programming Schedule.a Week[E_BA_Weekday.e Wednesday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Wednesday,3].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Wednesday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,3].st Time.n Second := 0; // Thursday Schedule.a Week[E_BA_Weekday.e Thursday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Thursday,1].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Thursday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Thursday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Thursday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Thursday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Thursday,2].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Thursday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Thursday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Thursday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Thursday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Thursday,3].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Thursday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Thursday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Thursday,3].st Time.n Second := 0; // Friday Schedule.a Week[E_BA_Weekday.e Friday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Friday,1].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Friday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Friday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Friday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Friday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Friday,2].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Friday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Friday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Friday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Friday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Friday,3].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Friday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Friday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Friday,3].st Time.n Second := 0; // Saturday Schedule.a Week[E_BA_Weekday.e Saturday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Saturday,1].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Saturday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Saturday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Saturday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Saturday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Saturday,2].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Saturday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Saturday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Saturday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Saturday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Saturday,3].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Saturday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Saturday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Saturday,3].st Time.n Second := 0; // Sunday Schedule.a Week[E_BA_Weekday.e Sunday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Sunday,1].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Sunday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Sunday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Sunday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Sunday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Sunday,2].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Sunday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Sunday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Sunday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Sunday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Sunday,3].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Sunday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Sunday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Sunday,3].st Time.n Second := 0; Weekly schedule for FB_BA_Schedule Multistate [} 512] From Monday to Sunday, the value 2 is set at 23:00 and 0:00, but the value 1 is set at 5:00. // Monday Schedule.a Week[E_BA_Weekday.e Monday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,1].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Hour := 23; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Minute := 0; TF8040 Version: 1.14.0 499
## Page 500

Programming Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,2].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Monday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,3].u Value.udi Val := 1; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Hour := 5; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Second := 0; // Tuesday Schedule.a Week[E_BA_Weekday.e Tuesday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Tuesday,1].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Tuesday,1].st Time.n Hour := 23; Schedule.a Week[E_BA_Weekday.e Tuesday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Tuesday,2].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Tuesday,2].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Tuesday,3].u Value.udi Val := 1; Schedule.a Week[E_BA_Weekday.e Tuesday,3].st Time.n Hour := 5; Schedule.a Week[E_BA_Weekday.e Tuesday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,3].st Time.n Second := 0; // Wednesday Schedule.a Week[E_BA_Weekday.e Wednesday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Wednesday,1].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Wednesday,1].st Time.n Hour := 23; Schedule.a Week[E_BA_Weekday.e Wednesday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Wednesday,2].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Wednesday,2].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Wednesday,3].u Value.udi Val := 1; Schedule.a Week[E_BA_Weekday.e Wednesday,3].st Time.n Hour := 5; Schedule.a Week[E_BA_Weekday.e Wednesday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,3].st Time.n Second := 0; // Thursday Schedule.a Week[E_BA_Weekday.e Thursday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Thursday,1].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Thursday,1].st Time.n Hour := 23; Schedule.a Week[E_BA_Weekday.e Thursday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Thursday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Thursday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Thursday,2].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Thursday,2].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Thursday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Thursday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Thursday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Thursday,3].u Value.udi Val := 1; Schedule.a Week[E_BA_Weekday.e Thursday,3].st Time.n Hour := 5; Schedule.a Week[E_BA_Weekday.e Thursday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Thursday,3].st Time.n Second := 0; // Friday Schedule.a Week[E_BA_Weekday.e Friday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Friday,1].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Friday,1].st Time.n Hour := 23; Schedule.a Week[E_BA_Weekday.e Friday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Friday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Friday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Friday,2].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Friday,2].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Friday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Friday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Friday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Friday,3].u Value.udi Val := 1; Schedule.a Week[E_BA_Weekday.e Friday,3].st Time.n Hour := 5; Schedule.a Week[E_BA_Weekday.e Friday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Friday,3].st Time.n Second := 0; // Saturday Schedule.a Week[E_BA_Weekday.e Saturday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Saturday,1].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Saturday,1].st Time.n Hour := 23; Schedule.a Week[E_BA_Weekday.e Saturday,1].st Time.n Minute := 0; 500 Version: 1.14.0 TF8040
## Page 501

Programming Schedule.a Week[E_BA_Weekday.e Saturday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Saturday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Saturday,2].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Saturday,2].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Saturday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Saturday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Saturday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Saturday,3].u Value.udi Val := 1; Schedule.a Week[E_BA_Weekday.e Saturday,3].st Time.n Hour := 5; Schedule.a Week[E_BA_Weekday.e Saturday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Saturday,3].st Time.n Second := 0; // Sunday Schedule.a Week[E_BA_Weekday.e Sunday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Sunday,1].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Sunday,1].st Time.n Hour := 23; Schedule.a Week[E_BA_Weekday.e Sunday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Sunday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Sunday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Sunday,2].u Value.udi Val := 2; Schedule.a Week[E_BA_Weekday.e Sunday,2].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Sunday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Sunday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Sunday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Sunday,3].u Value.udi Val := 1; Schedule.a Week[E_BA_Weekday.e Sunday,3].st Time.n Hour := 5; Schedule.a Week[E_BA_Weekday.e Sunday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Sunday,3].st Time.n Second := 0; Combination of the exception in the date range with a weekly schedule for FB_BA_Schedule Analog [} 512] This sample shows a combination of a date range in connection with a weekly timer. In the date range from March 1, 2026 to September 31, 2026, the analog value 14.0 is specified every day at 0:00. Outside this date range, the weekly schedule is active. From Monday to Friday, the value 22.0 is issued at 6:00, the value 16.0 at 18:00 and the value 14.5 at 0:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day01; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e Setember; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 0; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.r Val := 14.0; // Monday Schedule.a Week[E_BA_Weekday.e Monday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,1].u Value.r Val := 22.0; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,2].u Value.r Val := 16.0; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Monday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,3].u Value.r Val := 14.5; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Second := 0; // Tuesday Schedule.a Week[E_BA_Weekday.e Tuesday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Tuesday,1].u Value.r Val := 22.0; Schedule.a Week[E_BA_Weekday.e Tuesday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Tuesday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Tuesday,2].u Value.r Val := 16.0; TF8040 Version: 1.14.0 501
## Page 502

Programming Schedule.a Week[E_BA_Weekday.e Tuesday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Tuesday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Tuesday,3].u Value.r Val := 14.5; Schedule.a Week[E_BA_Weekday.e Tuesday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Tuesday,3].st Time.n Second := 0; // Wednesday Schedule.a Week[E_BA_Weekday.e Wednesday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Wednesday,1].u Value.r Val := 22.0; Schedule.a Week[E_BA_Weekday.e Wednesday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Wednesday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Wednesday,2].u Value.r Val := 16.0; Schedule.a Week[E_BA_Weekday.e Wednesday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Wednesday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Wednesday,3].u Value.r Val := 14.5; Schedule.a Week[E_BA_Weekday.e Wednesday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Wednesday,3].st Time.n Second := 0; // Thursday Schedule.a Week[E_BA_Weekday.e Thursday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Thursday,1].u Value.r Val := 22.0; Schedule.a Week[E_BA_Weekday.e Thursday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Thursday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Thursday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Thursday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Thursday,2].u Value.r Val := 16.0; Schedule.a Week[E_BA_Weekday.e Thursday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Thursday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Thursday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Thursday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Thursday,3].u Value.r Val := 14.5; Schedule.a Week[E_BA_Weekday.e Thursday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Thursday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Thursday,3].st Time.n Second := 0; // Friday Schedule.a Week[E_BA_Weekday.e Friday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Friday,1].u Value.r Val := 22.0; Schedule.a Week[E_BA_Weekday.e Friday,1].st Time.n Hour := 6; Schedule.a Week[E_BA_Weekday.e Friday,1].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Friday,1].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Friday,2].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Friday,2].u Value.r Val := 16.0; Schedule.a Week[E_BA_Weekday.e Friday,2].st Time.n Hour := 18; Schedule.a Week[E_BA_Weekday.e Friday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Friday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Friday,3].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Friday,3].u Value.r Val := 14.5; Schedule.a Week[E_BA_Weekday.e Friday,3].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Friday,3].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Friday,3].st Time.n Second := 0; Exception Date The following samples show possible variants for the date exception of a schedule with a binary schedule entry. Variant 01 The exception date is always active. Switching on at 6:00 and switching off at 18:00 every day. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 255; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; 502 Version: 1.14.0 TF8040
## Page 503

Programming Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 02 For the entire year 2025, switching on at 6:00 and switching off at 18:00 every day. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 125; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 03 In February, switching on at 6:00 and switching off at 18:00 every day. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 255; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month.e February; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 04 Switching on at 6:00 and switching off at 18:00 on the 29th of every month. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 255; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 05 Switching on at 6:00 and switching off at 18:00 every Monday. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 255; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; TF8040 Version: 1.14.0 503
## Page 504

Programming Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 06 On March 29, switching on at 6:00 and switching off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 255; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 07 In 2025, always switching on at 6:00 and switching off at 18:00 on the 29th of each month. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 125; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 08 The 29th of a month must be a Monday to switch on at 6:00 and to switch off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 255; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 09 In April 2025, switching on at 6:00 and switching off at 18:00 every day. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 125; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month.e April; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; 504 Version: 1.14.0 TF8040
## Page 505

Programming Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 10 In April, switching on at 6:00 and switching off at 18:00 every Monday. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 255; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month.e April; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 11 In 2030, switching on at 6:00 and switching off at 18:00 every Monday. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 130; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 12 On May 29, 2030, switching on at 6:00 and switching off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 130; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month.e May; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 13 In 2030, switching on at 6:00 and switching off at 18:00 every Monday in May. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 130; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month.e May; TF8040 Version: 1.14.0 505
## Page 506

Programming Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 14 In 2030, the 29th of the month must be a Monday to switch on at 6:00 and to switch off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 130; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 15 April 29 must be a Monday to switch on at 6:00 and switch off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 255; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month.e April; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 16 February 28, 2025 would have to be a Monday to switch on at 6:00 and to switch off at 18:00. The function block checks whether the switch on condition is correct. Since February 28, 2025 is on a Friday, the weekday e Day Of Week will be corrected to Friday, so that on Friday, February 28, 2025 it will be switched on at 6:00 and switched off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date; Schedule.a Exception[1].u Date.st Date.n Year := 125; Schedule.a Exception[1].u Date.st Date.e Month := E_BA_Month.e February; Schedule.a Exception[1].u Date.st Date.n Day := E_BA_Day.e Day28; Schedule.a Exception[1].u Date.st Date.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; 506 Version: 1.14.0 TF8040
## Page 507

Programming Exception Week and Day/Week NDay The following samples show possible variants for the exception week and exception day with a binary schedule entry. Variant 01 The Week NDay exception is always active. Switching on at 6:00 and switching off at 18:00 every day. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Week NDay; Schedule.a Exception[1].u Date.st Week NDay.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Week NDay.e Week Of Month := E_BA_Week. Unspecified; Schedule.a Exception[1].u Date.st Week NDay.e Weekday := E_BA_Weekday. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 02 In August, switching on at 6:00 and switching off at 18:00 every day. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Week NDay; Schedule.a Exception[1].u Date.st Week NDay.e Month := E_BA_Month.e August; Schedule.a Exception[1].u Date.st Week NDay.e Week Of Month := E_BA_Week. Unspecified; Schedule.a Exception[1].u Date.st Week NDay.e Weekday := E_BA_Weekday. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 03 On days 8-14 of each month, switching on at 6:00 and switching off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Week NDay; Schedule.a Exception[1].u Date.st Week NDay.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Week NDay.e Week Of Month := E_BA_Week.e Week2; Schedule.a Exception[1].u Date.st Week NDay.e Weekday := E_BA_Weekday. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 04 Every Monday, switching on at 6:00 and switching off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Week NDay; Schedule.a Exception[1].u Date.st Week NDay.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Week NDay.e Week Of Month := E_BA_Week. Unspecified; Schedule.a Exception[1].u Date.st Week NDay.e Weekday := E_BA_Weekday.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; TF8040 Version: 1.14.0 507
## Page 508

Programming Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 05 On days 29-31 in March, switching on at 6:00 and switching off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Week NDay; Schedule.a Exception[1].u Date.st Week NDay.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Week NDay.e Week Of Month := E_BA_Week.e Week5; Schedule.a Exception[1].u Date.st Week NDay.e Weekday := E_BA_Weekday. Unspecified; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 06 On every Monday in March, switching on at 6:00 and switching off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Week NDay; Schedule.a Exception[1].u Date.st Week NDay.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Week NDay.e Week Of Month := E_BA_Week. Unspecified; Schedule.a Exception[1].u Date.st Week NDay.e Weekday := E_BA_Weekday.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 07 One of the days 29-31 of a month must be a Monday to switch on at 6:00 and to switch off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Week NDay; Schedule.a Exception[1].u Date.st Week NDay.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Week NDay.e Week Of Month := E_BA_Week.e Week5; Schedule.a Exception[1].u Date.st Week NDay.e Weekday := E_BA_Weekday.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Variant 08 One of the days 1-7 in March must be a Monday to switch on at 6:00 and to switch off at 18:00. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Week NDay; Schedule.a Exception[1].u Date.st Week NDay.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Week NDay.e Week Of Month := E_BA_Week.e Week1; Schedule.a Exception[1].u Date.st Week NDay.e Weekday := E_BA_Weekday.e Monday; Schedule.a Exception[1].a Entry[1].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[1].st Time.n Hour := 6; Schedule.a Exception[1].a Entry[1].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[1].st Time.n Second := 0; Schedule.a Exception[1].a Entry[1].u Value.b Val := TRUE; Schedule.a Exception[1].a Entry[2].e State := E_BA_Sched Entry State.e Value; Schedule.a Exception[1].a Entry[2].st Time.n Hour := 18; 508 Version: 1.14.0 TF8040
## Page 509

Programming Schedule.a Exception[1].a Entry[2].st Time.n Minute := 0; Schedule.a Exception[1].a Entry[2].st Time.n Second := 0; Schedule.a Exception[1].a Entry[2].u Value.b Val := FALSE; Autocorrection initializations In the event of incorrect initialization, an autocorrection takes place within the function block. The following samples show possible initializations for autocorrection. Date Range Sample 01 Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 255; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 255; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day. Unspecified; Automatic correction because no specific period is specified. Schedule.a Exception[1].e Type := E_BA_Date Val Choice. Invalid; Sample 02 Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 127; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e Setember; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day.e Monday; Automatic correction, the date ranges are swapped and the weekdays are corrected. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e Setember; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day30; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day.e Wednesday; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 127; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day.e Wednesday; Sample 03 Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 125; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day.e Tuesday; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e Setember; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day. Unspecified; Automatic correction. The weekdays are adjusted if incorrect. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 125; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e Setember; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day.e Tuesday; TF8040 Version: 1.14.0 509
## Page 510

Programming Sample 04 Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 222; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := 123; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := 126; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := 222; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 220; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := 121; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := 145; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := 127; Automatic correction, the highest valid entries are used for year, month and day - 31.12.2100. The day of the week is adjusted to the resulting date. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 200; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e December; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day.e Friday; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 200; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e December; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day.e Friday; Sample 05 Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 124; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e February; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e February; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day30; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day. Unspecified; Automatic correction, the days of the month are adjusted. The day of the week is adjusted to the resulting date. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 124; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e February; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day.e Thursday; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e February; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day28; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day.e Saturday; Sample 06 Schedule.a Week[E_BA_Weekday.e Monday,1].e State := E_BA_Sched Entry State. Invalid; Schedule.a Week[E_BA_Weekday.e Monday,1].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Hour := 30; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Minute := 120; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Second := 124; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Hundredths := 124; Schedule.a Week[E_BA_Weekday.e Monday,2].e State := E_BA_Sched Entry State.e Undefined; Schedule.a Week[E_BA_Weekday.e Monday,2].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Hour := 11; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Minute := 12; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Second := 13; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Hundredths := 14; Schedule.a Week[E_BA_Weekday.e Monday,3].e State := E_BA_Sched Entry State.e Null; Schedule.a Week[E_BA_Weekday.e Monday,3].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Hour := 255; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Minute := 255; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Second := 255; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Hundredths := 255; Schedule.a Week[E_BA_Weekday.e Monday,4].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,4].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Monday,4].st Time.n Hour := 99; Schedule.a Week[E_BA_Weekday.e Monday,4].st Time.n Minute := 111; Schedule.a Week[E_BA_Weekday.e Monday,4].st Time.n Second := 222; Schedule.a Week[E_BA_Weekday.e Monday,4].st Time.n Hundredths := 100; 510 Version: 1.14.0 TF8040
## Page 511

Programming Automatic correction, sorting in the weekly schedule according to the order shown in the entries: E_BA_Sched Entry State.e Value > E_BA_Sched Entry State.e Null > E_BA_Sched Entry State.e Undefined. E_BA_Sched Entry State. Invalid becomes E_BA_Sched Entry State.e Undefined. The times will be adjusted. Schedule.a Week[E_BA_Weekday.e Monday,1].e State := E_BA_Sched Entry State.e Value; Schedule.a Week[E_BA_Weekday.e Monday,1].u Value.b Val := TRUE; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Hour := 23; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Minute := 59; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Second := 59; Schedule.a Week[E_BA_Weekday.e Monday,1].st Time.n Hundredths := 99; Schedule.a Week[E_BA_Weekday.e Monday,2].e State := E_BA_Sched Entry State.e Null; Schedule.a Week[E_BA_Weekday.e Monday,2].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Hour := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Minute := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Second := 0; Schedule.a Week[E_BA_Weekday.e Monday,2].st Time.n Hundredths := 0; Schedule.a Week[E_BA_Weekday.e Monday,3].e State := E_BA_Sched Entry State.e Undefined; Schedule.a Week[E_BA_Weekday.e Monday,3].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Hour := 255; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Minute := 255; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Second := 255; Schedule.a Week[E_BA_Weekday.e Monday,3].st Time.n Hundredths := 255; Schedule.a Week[E_BA_Weekday.e Monday,4].e State := E_BA_Sched Entry State.e Undefined; Schedule.a Week[E_BA_Weekday.e Monday,4].u Value.b Val := FALSE; Schedule.a Week[E_BA_Weekday.e Monday,4].st Time.n Hour := 255; Schedule.a Week[E_BA_Weekday.e Monday,4].st Time.n Minute := 255; Schedule.a Week[E_BA_Weekday.e Monday,4].st Time.n Second := 255; Schedule.a Week[E_BA_Weekday.e Monday,4].st Time.n Hundredths := 255; Sample 07 Schedule.a Exception[1].e Type := E_BA_Date Val Choice. Invalid; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 127; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e Setember; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day.e Monday; Automatic correction, the date range is swapped and the days of the week are corrected. Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e Setember; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day30; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day.e Wednesday; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 127; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day.e Wednesday; Sample 08 Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 125; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day. Unspecified; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e Setember; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day. Unspecified; Automatic correction, the days of the week are adjusted Schedule.a Exception[1].e Type := E_BA_Date Val Choice.e Date Range; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Year := 125; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Month := E_BA_Month.e March; Schedule.a Exception[1].u Date.st Date Range.st Date From.n Day := E_BA_Day.e Day31; Schedule.a Exception[1].u Date.st Date Range.st Date From.e Day Of Week := E_BA_Week Day.e Monday; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Year := 126; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Month := E_BA_Month.e Setember; Schedule.a Exception[1].u Date.st Date Range.st Date To.n Day := E_BA_Day.e Day29; Schedule.a Exception[1].u Date.st Date Range.st Date To.e Day Of Week := E_BA_Week Day.e Tuesday; TF8040 Version: 1.14.0 511
## Page 512

Programming 6.1.2.2.3.1.5.10.2 FB_BA_Schedule Multistate The function block FB_BA_Schedule Multistate represents a numerical schedule. It consists essentially of the base class FB_BA_Schedule Base [} 496]. The function block uses the base class to determine the numerical output value. If the output value n Present Value is not determined within the base class, n Default Value = n Present Value. Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT {region 'Fixed Parameters'} {attribute 'parameter Category':='Value'} n Default Value : UDINT; {endregion} END_VAR Name Type Description n Default Value UDINT The default value n Default Value is active in the following cases: n Present Value = n Default Value if the output value n Present Value is not determined within the base class FB_BA_Schedule Base [} 496]. Outputs VAR_OUTPUT n Present Value : UDINT; END_VAR Name Type Description n Present Value UDINT Current value It consists essentially of the base class FB_BA_Schedule Base [} 496]. The numerical output value for n Present Value is determined within the base class. If the output value n Present Value is not determined within the base class, n Default Value = n Present Value. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.1.5.10.3 FB_BA_Schedule Analog The function block FB_BA_Schedule Analog represents an analog schedule. It consists essentially of the base class FB_BA_Schedule Base [} 496]. The function block uses the base class to determine the analog output value. If the output value f Present Value is not determined within the base class, f Default Value = f Present Value. 512 Version: 1.14.0 TF8040
## Page 513

Programming Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT {region 'Fixed Parameters'} {attribute 'parameter Category':='Value'} f Default Value : REAL; {endregion} END_VAR Name Type Description f Default Value REAL The default value f Default Value is active in the following cases: f Present Value = f Default Value if the output value f Present Value is not determined within the base class FB_BA_Schedule Base [} 496]. Outputs VAR_OUTPUT f Present Value : REAL; END_VAR Name Type Description f Present Value REAL Current value It consists essentially of the base class FB_BA_Schedule Base [} 496]. The numerical output value for f Present Value is determined within the base class. If the output value f Present Value is not determined within the base class, f Default Value = f Present Value. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.1.5.10.4 FB_BA_Schedule Binary The function block FB_BA_Schedule Binary represents a binary schedule. It consists essentially of the base class FB_BA_Schedule Base [} 496]. The function block uses the base class to determine the binary output value. If the output value b Present Value is not determined within the base class, b Default Value = b Present Value. Inputs CONSTANT PERSISTENT VAR_INPUT CONSTANT PERSISTENT {region 'Fixed Parameters'} {attribute 'parameter Category':='Value'} b Default Value : BOOL; {endregion} END_VAR TF8040 Version: 1.14.0 513
## Page 514

Programming Name Type Description b Default Value BOOL The default value b Default Value is active in the following cases: b Present Value = b Default Value if the output value b Present Value is not determined within the base class FB_BA_Schedule Base [} 496]. Outputs VAR_OUTPUT b Present Value : BOOL; END_VAR Name Type Description b Present Value BOOL Current value It consists essentially of the base class FB_BA_Schedule Base [} 496]. The numerical output value for b Present Value is determined within the base class. If the output value b Present Value is not determined within the base class, b Default Value = b Present Value. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.2.0 6.1.2.2.3.2 Functions 6.1.2.2.3.2.1 Universal 6.1.2.2.3.2.1.1 Priority 6.1.2.2.3.2.1.1.1 F_BA_Binary Crit The function of return type ST_BA_Binary [} 277] enables writing to the priority "Critical" of the return type of the function. In the function table you can see which states are output at the return type of the function. b En Crit F_BA_Bina- F_BA_Bina- F_BA_Bina- F_BA_Bina- F_BA_Bina- F_BA_Bina- ry Sfty- ry Sfty- ry Sfty- ry Sfty- ry Sfty- ry Sfty- Crit.b En Sfty Crit.b Val Sfty Crit.b En Crit Crit.b Val Crit Crit.b En Pgm Crit.b Val Pgm FALSE st Cmd.b En Sft st Cmd.b Val Sft st Cmd.b En Crit st Cmd.b Val Cri st Cmd.b En Pg st Cmd.b Val Pg y y t m m TRUE st Cmd.b En Sft st Cmd.b Val Sft b En Crit b Val Crit st Cmd.b En Pg st Cmd.b Val Pg y y m m Syntax FUNCTION F_BA_Binary Crit : ST_BA_Binary VAR_INPUT b En Crit : BOOL; 514 Version: 1.14.0 TF8040
## Page 515

Programming b Val Crit : BOOL; st Cmd : ST_BA_Binary; END_VAR Inputs Name Type Description b En Crit BOOL Enable for writing the priority "Critical" of the return type ST_BA_Binary [} 277]. b Val Crit BOOL Value of the priority "Critical" of the return type ST_BA_Binary [} 277] to be written if b En Crit has the value TRUE. st Cmd ST_BA_Binary [} 277] The command structure st Cmd transmits the enables and switching values of the priorities to the connected aggregate. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.2.1.1.2 F_BA_Binary Sfty The function of return type ST_BA_Binary [} 277] enables writing to the priority "Safety" of the return type of the function. In the function table you can see which states are output at the return type of the function. b En Sfty F_BA_Bina- F_BA_Bina- F_BA_Bina- F_BA_Bina- F_BA_Bina- F_BA_Bina- ry Sfty- ry Sfty- ry Sfty- ry Sfty- ry Sfty- ry Sfty- Crit.b En Sfty Crit.b Val Sfty Crit.b En Crit Crit.b Val Crit Crit.b En Pgm Crit.b Val Pgm FALSE st Cmd.b En Sft st Cmd.b Val Sft st Cmd.b En Crit st Cmd.b Val Cri st Cmd.b En Pg st Cmd.b Val Pg y y t m m TRUE b En Sfty b Val Sfty st Cmd.b En Crit st Cmd.b Val Cri st Cmd.b En Pg st Cmd.b Val Pg t m m Syntax FUNCTION F_BA_Binary Sfty : ST_BA_Binary VAR_INPUT b En Sfty : BOOL; b Val Sfty : BOOL; st Cmd : ST_BA_Binary; END_VAR Inputs Name Type Description b En Sfty BOOL Enable for writing the priority "Safety" of the return type ST_BA_Binary [} 277]. b Val Sfty BOOL Value of the priority "Safety" of the ST_BA_Binary [} 277] return type to be written if b En Crit has the value TRUE. st Cmd ST_BA_Binary [} 277] The command structure st Cmd transmits the enables and switching values of the priorities to the connected aggregate. TF8040 Version: 1.14.0 515
## Page 516

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.2.1.1.3 F_BA_Binary Sfty Crit The function of return type ST_BA_Binary [} 277] enables writing to the priorities "Safety" and "Critical" of the return type of the function. In the function table you can see which states are output at the return type of the function. b En Sfty b En Crit F_BA_Bina- F_BA_Bina- F_BA_Bina- F_BA_Bina- F_BA_Bina- F_BA_Bina- ry Sfty- ry Sfty- ry Sfty- ry Sfty- ry Sfty- ry Sfty- Crit.b En S- Crit.b Val S- Crit.b En Crit Crit.b Val- Crit.b En Pg Crit.b Val Pg fty fty Crit m m FALSE FALSE st Cmd.b En S st Cmd.b Val st Cmd.b En C st Cmd.b Val st Cmd.b En P st Cmd.b Val fty Sfty rit Crit gm Pgm TRUE FALSE b En Sfty b Val Sfty st Cmd.b En C st Cmd.b Val st Cmd.b En P st Cmd.b Val rit Crit gm Pgm FALSE TRUE st Cmd.b En S st Cmd.b Val b En Crit b Val Crit st Cmd.b En P st Cmd.b Val fty Sfty gm Pgm TRUE TRUE b En Sfty b Val Sfty st Cmd.b En C st Cmd.b Val st Cmd.b En P st Cmd.b Val rit Crit gm Pgm Syntax FUNCTION F_BA_Binary Sfty Crit : ST_BA_Binary VAR_INPUT b En Sfty : BOOL; b Val Sfty : BOOL; b En Crit : BOOL; b Val Crit : BOOL; st Cmd : ST_BA_Binary; END_VAR Inputs Name Type Description b En Sfty BOOL Enable for writing the priority "Safety" of the return type ST_BA_Binary [} 277]. b Val Sfty BOOL Value of the priority "Safety" of the ST_BA_Binary [} 277] return type to be written if b En Crit has the value TRUE. b En Crit BOOL Enable for writing the priority "Critical" of the return type ST_BA_Binary [} 277]. b Val Crit BOOL Value of the priority "Critical" of the return type ST_BA_Binary [} 277] to be written if b En Crit has the value TRUE. st Cmd ST_BA_Binary [} 277] The command structure st Cmd transmits the enables and switching values of the priorities to the connected aggregate. 516 Version: 1.14.0 TF8040
## Page 517

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.2.1.1.4 F_BA_Mdlt Crit The function of return type ST_BA_Mdlt [} 276] enables writing to the priority "Critical" of the return type of the function. In the function table you can see which states are output at the return type of the function. b En Crit F_BA_Mdlt Cr F_BA_Mdlt Cr F_BA_Mdlt Cr F_BA_Mdlt Cr F_BA_Mdlt Cr F_BA_Mdlt Cr it.b En Sfty it.e Val Sfty it.b En Crit it.e Val Crit it.b En Pgm it.e Val Pgm FALSE st Cmd.b En Sft st Cmd.e Val Sft st Cmd.b En Crit st Cmd.e Val Cri st Cmd.b En Pg st Cmd.e Val Pg y y t m m TRUE st Cmd.b En Sft st Cmd.e Val Sft b En Crit e Val Crit st Cmd.b En Pg st Cmd.e Val Pg y y m m Syntax FUNCTION F_BA_Mdlt Crit : ST_BA_Mdlt VAR_INPUT b En Crit : BOOL; e Val Crit : E_BA_Mdlt; st Cmd : ST_BA_Mdlt; END_VAR Inputs Name Type Description b En Crit BOOL Enable for writing the "Critical" priority of the return type ST_BA_Mdlt [} 276]. e Val Crit E_BA_Mdlt [} 270] Value of the priority "Critical" of the return type ST_BA_Mdlt [} 276] to be written if b En Crit has the value TRUE. st Cmd ST_BA_Mdlt [} 276] The command structure st Cmd is used to control modulating aggregates. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.2.1.1.5 F_BA_Mdlt Sfty The function of return type ST_BA_Mdlt [} 276] enables writing to the priority "Safety" of the return type of the function. In the function table you can see which states are output at the return type of the function. TF8040 Version: 1.14.0 517
## Page 518

Programming b En Sfty F_BA_Mdlt S- F_BA_Mdlt S- F_BA_Mdlt S- F_BA_Mdlt S- F_BA_Mdlt S- F_BA_Mdlt S- fty.b En Sfty fty.e Val Sfty fty.b En Crit fty.e Val Crit fty.b En Pgm fty.e Val Pgm FALSE st Cmd.b En Sft st Cmd.e Val Sft st Cmd.b En Crit st Cmd.e Val Cri st Cmd.b En Pg st Cmd.e Val Pg y y t m m TRUE b En Sfty e Val Sfty st Cmd.b En Crit st Cmd.e Val Cri st Cmd.b En Pg st Cmd.e Val Pg t m m Syntax FUNCTION F_BA_Mdlt Sfty : ST_BA_Mdlt VAR_INPUT b En Sfty : BOOL; e Val Sfty : E_BA_Mdlt; st Cmd : ST_BA_Mdlt; END_VAR Inputs Name Type Description b En Sfty BOOL Enable for writing the priority "Safety" of the return type ST_BA_Mdlt [} 276]. e Val Sfty E_BA_Mdlt [} 270] Value of the priority "Safety" of the return type ST_BA_Mdlt [} 276] to be written if b En Crit has the value TRUE. st Cmd ST_BA_Mdlt [} 276] The command structure st Cmd is used to control modulating aggregates. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.2.1.1.6 F_BA_Mdlt Sfty Crit The function of return type ST_BA_Mdlt [} 276] enables writing to the priorities "Safety" and "Critical" of the return type of the function. In the function table you can see which states are output at the return type of the function. b En Sfty b En Crit F_BA_Mdlt F_BA_Mdlt F_BA_Mdlt F_BA_Mdlt F_BA_Mdlt F_BA_Mdlt Crit.b En S- Crit.e Val S- Crit.b En Crit Crit.e Val- Crit.b En Pg Crit.e Val Pg fty fty Crit m m FALSE FALSE st Cmd.b En S st Cmd.e Val st Cmd.b En C st Cmd.e Val st Cmd.b En P st Cmd.e Val fty Sfty rit Crit gm Pgm FALSE TRUE st Cmd.b En S st Cmd.e Val b En Crit e Val Crit st Cmd.b En P st Cmd.e Val fty Sfty gm Pgm TRUE FALSE b En Sfty e Val Sfty st Cmd.b En C st Cmd.e Val st Cmd.b En P st Cmd.e Val rit Crit gm Pgm TRUE TRUE b En Sfty e Val Sfty st Cmd.b En C st Cmd.e Val st Cmd.b En P st Cmd.e Val rit Crit gm Pgm 518 Version: 1.14.0 TF8040
## Page 519

Programming Syntax FUNCTION F_BA_Mdlt Sfty : ST_BA_Mdlt VAR_INPUT b En Sfty : BOOL; e Val Sfty : E_BA_Mdlt; b En Crit : BOOL; e Val Crit : E_BA_Mdlt; st Cmd : ST_BA_Mdlt; END_VAR Inputs Name Type Description b En Sfty BOOL Enable for writing the priority "Safety" of the return type ST_BA_Mdlt [} 276]. e Val Sfty E_BA_Mdlt [} 270] Value of the priority "Safety" of the return type ST_BA_Mdlt [} 276] to be written if b En Crit has the value TRUE. b En Crit BOOL Enable for writing the "Critical" priority of the return type ST_BA_Mdlt [} 276]. e Val Crit E_BA_Mdlt [} 270] Value of the priority "Critical" of the return type ST_BA_Mdlt [} 276] to be written if b En Crit has the value TRUE. st Cmd ST_BA_Mdlt [} 276] The command structure st Cmd is used to control modulating aggregates. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.22 Tc3_BA2 from v5.2.5.0 6.1.2.2.3.2.2 Conversion 6.1.2.2.3.2.2.1 Temperature conversion function Temperature conversion functions between Kelvin, Celsius, Réaumur and Fahrenheit. Overview Kelvin [K] Degrees Celsius Degrees Réaumur Degrees Fahren- [°C] [°R] heit [°F] Absolute zero 0 -273.15 -218.52 -459.67 Melting point 273.15 0 0 32 Boiling point 373.15 100 80 212 (The melting and boiling points refer to pure water) Conversion rules Kelvin [K] Degrees Celsius Degrees Réaumur Degrees Fahren- [°C] [°R] heit [°F] X = Kelvin [K] - = X − 273.15 °C = 4/5(X − 273.15) -459.67 [°R] Degrees Celsius [°C] = x + 273.15 K - 0 32 Degrees Réaumur 100 - 212 [°R] Degrees Fahrenheit - [°F] TF8040 Version: 1.14.0 519
## Page 520

Programming 6.1.2.2.3.2.2.2 F_BA_Celsius To Fahrenheit The function F_BA_Celsius To Fahrenheit of return type LREAL is used to convert a temperature value in degrees Celsius to a temperature value in degrees Fahrenheit. Syntax FUNCTION F_BA_Celsius To Fahrenheit : LREAL VAR_INPUT f X : LREAL; END_VAR Inputs Name Type Description f X LREAL Input value in degrees Celsius. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.2.2.3 F_BA_Celsius To Kelvin The function F_BA_Celsius To Kelvin of the return type REAL is used to convert a temperature value in degrees Celsius to a temperature value in Kelvin. Syntax FUNCTION F_BA_Celsius To Kelvin : REAL VAR_INPUT f X : REAL; END_VAR Inputs Name Type Description f X REAL Input value in degrees Celsius. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.2.2.4 F_BA_Celsius To Reaumur The function F_BA_Celsius To Reaumur of return type REAL is used to convert a temperature value in degrees Celsius to a temperature value in degrees Réaumur. Syntax FUNCTION F_BA_Celsius To Reaumur : REAL VAR_INPUT f X : REAL; END_VAR 520 Version: 1.14.0 TF8040
## Page 521

Programming Inputs Name Type Description f X REAL Input value in degrees Celsius. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.2.2.5 F_BA_Fahrenheit To Celsius The function F_BA_Fahrenheit To Celsius of return type REAL is used to convert a temperature value in degrees Fahrenheit to a temperature value in degrees Celsius. Syntax FUNCTION F_BA_Fahrenheit To Celsius : REAL VAR_INPUT f X : REAL; END_VAR Inputs Name Type Description f X REAL Input value in degrees Fahrenheit. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.2.2.6 F_BA_Fahrenheit To Kelvin The function F_BA_Fahrenheit To Kelvin of the return type REAL is used to convert a temperature value in degrees Fahrenheit to a temperature value in Kelvin. Syntax FUNCTION F_BA_Fahrenheit To Kelvin : REAL VAR_INPUT f X : REAL; END_VAR Inputs Name Type Description f X REAL Input value in degrees Fahrenheit. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 TF8040 Version: 1.14.0 521
## Page 522

Programming 6.1.2.2.3.2.2.7 F_BA_Fahrenheit To Reaumur The function F_BA_Fahrenheit To Reaumur of return type REAL is used to convert a temperature value in degrees Fahrenheit to a temperature value in degrees Réaumur. Syntax FUNCTION F_BA_Fahrenheit To Reaumur : REAL VAR_INPUT f X : REAL; END_VAR Inputs Name Type Description f X REAL Input value in degrees Fahrenheit. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.2.2.8 F_BA_Kelvin To Celsius The function F_BA_Kelvin To Celsius of return type REAL is used to convert a temperature value in Kelvin to a temperature value in degrees Celsius. Syntax FUNCTION F_BA_Kelvin To Celsius : REAL VAR_INPUT f X : REAL; END_VAR Inputs Name Type Description f X REAL Input value in Kelvin. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.2.2.9 F_BA_Kelvin To Fahrenheit The function F_BA_Kelvin To Fahrenheit of the return type REAL is used to convert a temperature value in Kelvin to a temperature value in degrees Fahrenheit. Syntax FUNCTION F_BA_Kelvin To Fahrenheit : REAL VAR_INPUT f X : REAL; END_VAR 522 Version: 1.14.0 TF8040
## Page 523

Programming Inputs Name Type Description f X REAL Input value in Kelvin. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.2.2.10 F_BA_Kelvin To Reaumur The function F_BA_Kelvin To Reaumur of return type REAL is used to convert a temperature value in Kelvin to a temperature variable in degrees Réaumur. Syntax FUNCTION F_BA_Kelvin To Reaumur : REAL VAR_INPUT f X : REAL; END_VAR Inputs Name Type Description f X REAL Input value in Kelvin. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.2.2.11 F_BA_Reaumur To Celsius The function F_BA_Reaumur To Celsius of return type REAL is used to convert a temperature value in degrees Réaumur to a temperature value in degrees Celsius. Syntax FUNCTION F_BA_Reaumur To Celsius : REAL VAR_INPUT f X : REAL; END_VAR Inputs Name Type Description Fx REAL Input value in degrees Réaumur. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 TF8040 Version: 1.14.0 523
## Page 524

Programming 6.1.2.2.3.2.2.12 F_BA_Reaumur To Fahrenheit The function F_BA_Reaumur To Fahrenheit of the return type REAL is used to convert a temperature value in degrees Réaumur to a temperature value in degrees Fahrenheit. Syntax FUNCTION F_BA_Reaumur To Fahrenheit : REAL VAR_INPUT f X : REAL; END_VAR Inputs Name Type Description Fx REAL Input value in degrees Réaumur. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.2.3.2.2.13 F_BA_Reaumur To Kelvin The function F_BA_Reaumur To Kelvin of the return type REAL is used to convert a temperature value in degrees Réaumur to a temperature value in Kelvin. Syntax FUNCTION F_BA_Reaumur To Kelvin : REAL VAR_INPUT f X : REAL; END_VAR Inputs Name Type Description f X REAL Input value in degrees Réaumur. Prerequisites Development environment Required PLC library Twin CAT from v3.1.4024.62 Tc3_BA2 from v5.5.14.0 6.1.2.3 Archive 6.1.2.3.1 Tc2_BA This library was imported from Twin CAT 2 because of its proven functionalities from the TS8040 supplement. Therefore, the documentation is identical, except for the function blocks concerning BACnet (see Tc_BA). The BACnet specific function blocks can now be found in the library Tc2_BACnet Rev12. 524 Version: 1.14.0 TF8040
## Page 525

Programming 6.1.2.3.2 Tc3_BA This library is used for the maintenance and servicing of existing projects. For new projects please use the library Tc3_BA2. 6.1.2.3.2.1 POUs 6.1.2.3.2.1.1 Air conditioning equipment Function blocks Name Description FB_BA_Frst Prtc [} 525] Monitoring of frost alarm and emergency heating FB_BA_HX [} 527] Calculation of dew point temperature, specific enthalpy and absolute humidity FB_BA_Ngt Col [} 528] Summer night cooling FB_BA_Rcv Monit [} 529] Function block for calculating the efficiency of an energy recovery system FB_BA_SPSupvis [} 532] Function block for processing and checking the lower and upper setpoint of a supply air humidity or temperature control 6.1.2.3.2.1.1.1 FB_BA_Frst Prtc The function block is used for frost monitoring of a heating coil in an air conditioning system. A frost risk is present, if the input b Frst is TRUE. The frost alarm must be linked in the plant program such that the plant is switched off immediately, the heater valve opens, and the heater pump is switched on. If there is risk of frost, the output b On is set, and udi T1_sec (seconds) is started. If the frost risk remains (b Frst=TRUE) after udi T1_sec has elapsed, b On remains set. It can only be reset at input b Rst. If the frost alarm ceases due to activation of the heating coil within the time udi T1_sec (b Frst=FALSE), the plant automatically restarts. For the plant restart b On becomes FALSE, and at output b HWRst a pulse for acknowledgement of a latching circuit in the control cabinet is issued. With the restart a second monitoring period udi T2_sec (seconds) is initiated. If another frost alarm occurs within this period, the plant is permanently locked. b On remains set until the frost alarm has been eliminated and b Rst has been acknowledged. In a scenario where frost alarms recur with time offsets that are greater than udi T2_sec, theoretically the plant would keep restarting automatically. In order to avoid this, the restarts within the function block are counted. The parameter udi Alm Cnt can be used to set the number of possible automatic restart between 0 and 4. An acknowledgement at input b Rst resets the alarm memory within the function block to zero. TF8040 Version: 1.14.0 525
## Page 526

Programming Sample: t0 = frost alarm at input b Frst, alarm message at output b On, start of timer T1 (udi T1_sec [s]) t1 = frost alarm off, resetting of b On, output of hardware pulse, start of timer T2 (udi T2_sec [s]), plant restart t2 = further frost alarm within T2, alarm message at b On, start of timer T1, locking of the frost alarm t3 = frost alarm off. t4 = acknowledgement of the alarm at b Rst, resetting of b On. VAR_INPUT b Frst : BOOL; udi T1_sec : UDINT; udi T2_sec : UDINT; udi Alm Cnt : UDINT; b Rst : BOOL; b Frst: Connection for frost events on the air and water side. udi T1_sec: Timer for restart delays [s]. Internally limited to a minimum value of 0. udi T2_sec: Timer monitoring time [s]. Internally limited to a minimum value of 0. udi Alm Cnt: Maximum number of automatic plant restarts without reset. Internally limited to values between 0 and 4. b Rst: Resetting and acknowledgement of the frost alarm. VAR_OUTPUT b On : BOOL; b HWRst : BOOL; udi Rem Ti1_sec : UDINT; udi Rem Ti2_sec : UDINT; b Alm Lck : BOOL; udi Sta Cnt : UDINT; b On: Frost alarm active. b HWRst: Output of a pulse for acknowledgement of the frost protection hardware. udi Rem Ti1_sec: Time remaining to plant restart after frost alarm. udi Rem Ti2_sec: Remaining monitoring time. b Alm Lck: Alarm lock - stored alarm. 526 Version: 1.14.0 TF8040
## Page 527

Programming udi Sta Cnt: Status counter – current number of unacknowledged false starts. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.1.2 FB_BA_HX This function block is used to calculate the dew point temperature, the specific enthalpy and the absolute humidity. The temperature, the relative humidity and the barometric pressure are required for calculating these parameters. The enthalpy is a measure for the energy of a thermodynamic system. VAR_INPUT r T : REAL; r Hum Rel : REAL; r AP : REAL; r T: Temperature [°C]. r Hum Rel: Relative humidity [%]. r AP: Hydrostatic air pressure at 1013.25 h Pa. VAR_OUTPUT lr Hum Abs : LREAL; lr Dew Pnt : LREAL; lr E : LREAL; lr DHA : LREAL; lr Spec V : LREAL; lr TWet : LREAL; lr Hum Abs: Absolute humidity g water per kg dry air [g/Kg]. lr Dew Pnt: Dew point temperature [°C]. lr E: Enthalpy [k J/kg]. lr DHA: Density of moist air ρ [kg mixture/m³]. lr Spec V: Specific volume [m³/kg]. lr TWet: Wet bulb temperature [°C]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 527
## Page 528

Programming 6.1.2.3.2.1.1.3 FB_BA_Ngt Col With this function block, rooms that were heated up on the day before can be cooled down during the night using cool outside air. The summer night cooling function serves to improve the quality of the air and to save electrical energy. Electrical energy for cooling is saved during the first hours of the next summer day. The start conditions for the summer night cooling are defined by parameterizing the FB_BA_Ngt Col function block. The function block can be used to open motor-driven windows or to switch air conditioning systems to summer night cooling mode outside their normal hours of operation. The following conditions must be met for activation of summer night cooling: • The function block itself is enabled (b En=TRUE). • The outside temperature is not too low (r TOts > r TOts Lo Lmt). • The outside temperature is sufficiently low compared with the room temperature (r TRm - r TOts) > r Swi On Diff T. • The room temperature is high enough to justify activating summer night cooling. r TRm > r Sp Rm + r TRm Hys. Under the following conditions the summer night cooling is disabled: • The function block itself is disabled (b En = FALSE). • The outside temperature is too low (r TOts < r TOts Lo Lmt). • The outside temperature is too high compared with the room temperature (r TRm - r TOts) < r Swi Off Diff T. • The room temperature is lower than the setpoint. r TRm≤r Sp Rm. VAR_INPUT b En : BOOL; r TOts : REAL; r TRm : REAL; r Sp Rm : REAL; r TOts Lo Lmt : REAL; r TOts Hys : REAL; r TRm Hys : REAL; r Swi On Diff T : REAL; r Swi Off Diff T : REAL; b En: Enable function block. r TOts: Outside temperature [°C]. r TRm: Outside temperature [°C]. r Sp Rm: Room temperature setpoint. r TOts Lo Lmt: Lower outside temperature limit [°C]; prevents excessive cooling. r TOts Hys: Hysteresis for minimum outside temperature [K]. This hysteresis, which at the lower end is internally limited to 0.5 K, is intended to prevent jitter in b Q, if the outside temperature fluctuates precisely around the value of r TOts Lo Lmt. 528 Version: 1.14.0 TF8040
## Page 529

Programming r TRm Hys: Hysteresis for the room temperature [K]. This hysteresis, which at the lower end is internally limited to 0.5 K, is intended to prevent unnecessary fluctuation of b Q, if the room temperature fluctuates precisely around the setpoint r Sp Rm. r Swi On Diff T: Difference between the room temperature and the outside temperature, from which summer night cooling is enabled [K]. r Swi Off Diff T: Difference between the room temperature and the outside temperature, from which summer night cooling is locked [K]. VAR_OUTPUT b Q : BOOL; b Q: Summer night cooling on. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.1.4 FB_BA_Rcv Monit The function block is used for calculating the efficiency of an energy recovery system. The function block requires the following measured temperature values for calculating the efficiency (heat recovery rate): • Outside air temperature r TOts • Exhaust air temperature r TExh • Air temperature of the energy recovery system in the inlet air duct (alternatively: in the outlet air duct) r TAft Rcv TF8040 Version: 1.14.0 529
## Page 530

Programming The function block logs the temperature values every 10 seconds and forms minutely averages from 6 consecutive values. The results are used to check whether the plant has reached a "stable" state. • This is the case when the recorded temperatures of outside air, exhaust air and air after energy recovery are almost constant, i.e. none the 6 individual values deviate by more than 0.5 K from the respective mean value. • The temperature difference between outside air and exhaust air is at least 5 K. If this is the case, this measuring cycle is acknowledged with a TRUE signal at output b Stbl Op, and the calculated efficiency is output at r Effc. If the state is not "stable", a FALSE signal appears at output b Stbl Op, and r Effc is set to 0. In any case, each measuring and analysis cycle is marked as completed with a trigger (a TRUE signal lasting one PLC cycle) at b New Val. Enable (b En) and Reset (b Rst) The function block is only active if a TRUE signal is present at b En. Otherwise its execution stops, and all outputs are set to FALSE or 0.0. An active measuring and evaluation cycle can be terminated at any time by a TRUE signal at b Rst. All outputs are set to FALSE or 0.0, and the measuring cycle restarts automatically. Selection of the temperature value "after recovery" (b Sns Rcv TExh) A FALSE entry at b Sns Rcv TExh means that the temperature measurement after the heat recovery in the supply air duct is used for calculating the efficiency. To use the temperature measurement after the heat recovery in the exhaust air duct, TRUE must be applied at b Sns Rcv TExh. Limit violation (r Contr Var, r Lmt Effc, b Lmt Rchd) A limit violation has occurred, if the calculated efficiency is less than the specified limit value r Lmt Effc, and at the same time the control value for the heat recovery is at 100%. To this end the control value must be linked to input r Contr Var. The limit violation message can be delayed by an entry at udi Lmt Vio Dly_sec [s]: If the two criteria, violation and override, are met for longer than udi Lmt Vio Dly _sec [s], this is indicated with a TRUE signal at b Lmt Rchd. A warning message, which may have occurred, is canceled if a complete measuring cycle provides "good" values, or with a rising edge at b Rst or deactivation of the function block. 530 Version: 1.14.0 TF8040
## Page 531

Programming This warning message only occurs if the plant is in a stable operating mode (b Stbl Op=TRUE). Taking into account the temperature increase of the outlet air due to the fan motor (r TInc Fan) It is possible that the outlet air is warmed by a fan motor, resulting in distortion of the measurement. This temperature increase can be specified through r TInc Fan. Internally, the measured outlet air temperature is then reduced by this value. VAR_INPUT b En : BOOL; b Rst : BOOL; r Contr Var : REAL; r TOts : REAL; r TExh : REAL; r TAft Rcv : REAL; b Sns Rcv TExh : BOOL; r TInc Fan : REAL; r Lmt Effc : REAL; udi Lmt Vio Dly_sec : DINT; b En: Function block enable. b Rst: Reset - all determined values are deleted. r Contr Var: Control value for the heat recovery, i.e. the actual value. r TOts: Outside temperature. r TExh: Exhaust air temperature. r TAft Rcv: Temperature after energy recovery. b Sns Rcv TExh: Temperature at the measuring point after energy recovery: FALSE -> in inlet air duct (Supply Air) - TRUE -> in outlet air duct (Exhaust Air). r TInc Fan: Temperature increase due to fan. r Lmt Effc: Limit value efficiency. udi Lmt Vio Dly_sec: Limit violation delay [s]. Internally limited to a minimum value of 0. VAR_OUTPUT b New Val : BOOL; r Effc : REAL; b Lmt Rchd : BOOL; b Stbl Op : BOOL; b New Val: Output trigger for new value r Effc. r Effc: Efficiency b Lmt Rchd: Limit value reached b Stbl Op: Stable operation. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 531
## Page 532

Programming 6.1.2.3.2.1.1.5 FB_BA_Sp Supvis Function block for processing and checking the lower and upper setpoint of an inlet air humidity or temperature control. Checking and limitation of the setpoints The function block limits the setpoints. The following two tables show which parameters are checked and what the response is in the event of an error. Checking Action r Sp Lo > r Sp Hi last valid values of r Sp Lo and r Sp Hi are used r Sp Min >= r Sp Max last valid values of r Sp Min and r Sp Max are used r Sp Hi > r Sp Max r Pr Sp Hi = r Sp Max r Sp Lo < r Sp Min r Pr Sp Lo = r Sp Min Checking b Err Action r Sp Min >= r Sp Max TRUE r Sp Err = ((r Sp Min + r Sp Max) / 2) r Sp Hi < r Sp Min r Pr Sp Hi = r Pr Sp Lo = r Pr Rcv = r Sp Lo > r Sp Max r Sp Err The difference between the setpoints describes an energy-neutral zone. With inlet air control, no heating or cooling would take place within the neutral zone. The checked and, if necessary, limited setpoints are output at the function block output as r Pr Sp Hi and r Pr Sp Lo (Present Setpoint). Setpoint for heat recovery For heat recovery, the setpoint r Sp Rcv is optionally calculated from the mean value of the upper and lower setpoint, r Sp Hi and r Sp Lo, or depending on the control direction of the heat recovery system. The method is defined through the input variable b Slcn Sp Rcv: 532 Version: 1.14.0 TF8040
## Page 533

Programming b Slcn Sp Rcv r Sp Rcv TRUE Mean value of r Sp Lo and r Sp Hi FALSE Depends on direction of action, defined through input b Act Rcv If the setpoint is defined depending on the direction of action, the following applies: b Act Rcv Control direction r Sp Rcv TRUE direct (cooling) r Sp Hi FALSE indirect (heating) r Sp Lo Heat recovery VAR_INPUT b En : BOOL; r Sp Hi : REAL; r Sp Lo : REAL; r Sp Max : REAL; r Sp Min : REAL; b Actn Rcv : BOOL; b Slcn Sp Rcv : BOOL; b En: function block enable. If b En = FALSE, all output parameters are 0.0. r Sp Hi: Upper setpoint input value to be checked. r Sp Lo: Lower setpoint input value to be checked. r Sp Max: Maximum setpoint. r Sp Min: Minimum setpoint. b Actn Rcv: Direction of action of the downstream heat recovery. b Slcn Sp Rcv: Setpoint selection of the downstream heat recovery system. VAR_OUTPUT r Pr Sp Hi : REAL; r Pr Sp Lo : REAL; r Sp Rcv : REAL; b Err : BOOL; s Err Descr : T_MAXSTRING; r Pr Sp Hi: Output value for the upper setpoint. TF8040 Version: 1.14.0 533
## Page 534

Programming r Pr Sp Lo: Output value for the lower setpoint. r Sp Rcv: Output value for the resulting heat recovery setpoint. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Warning: The setpoints are not in a logical order: Either (r Sp Min >= r Sp Max) OR (r Sp Hi < r Sp Min) OR (r Sp Lo > r Sp Max) Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2 Room automation 6.1.2.3.2.1.2.1 Heating, cooling Function blocks Name Description FB_BA_Fnct Sel [} 534] Function selection (heating and/or cooling) in two- or four-pipe network. FB_BA_Rm TAdj [} 537] Adjustment of the room temperature setpoint. FB_BA_Sp Rm T [} 540] Adjustment of the room temperature setpoint 6.1.2.3.2.1.2.1.1 FB_BA_Fnct Sel The function block is used for enabling heating or cooling mode in a room. The distribution network type plays a significant role: In a two-pipe system, all rooms served by the plant can either be heated or cooled at the same time. In a four-pipe system, the room conditioning can be demand-based, i.e. some rooms can be heated, while other rooms can be cooled by the same plant. The function block used for each room, as already mentioned, selects its controllers, depending on which type of piping system is available: Two-pipe network The two-pipe system is selected if the function block has a FALSE entry at input b Pipe Sys. Since all rooms served by the plant can only either be heated or cooled, the choice is specified centrally for all rooms via the input b Medium. If b Medium is FALSE, the room heating controller is selected. If the input is TRUE the cooling controller is selected. The controller enable states b En Htg and b En Col are always issued with a 534 Version: 1.14.0 TF8040
## Page 535

Programming delay of udi Chg Ovr Dly_sec [s]. In other words, heating cannot be enabled until the cooling enable state b En Col for udi Chg Ovr Dly_sec is FALSE, and vice versa. In addition to the elapsing of this changeover time, the system checks that the output from controller to be switched off is 0.0. This is based on feedback at the inputs r Ctrl Val Htg and r Ctrl Val Col. In this way, a drastic change from heating to cooling and vice versa is avoided. Four-pipe network The four-pipe system is selected if the function block has a TRUE entry at input b Pipe Sys. In this case, the choice of controller can be different for the individual rooms as required, based on the room temperature r Rm T and the setpoints r Sp Htg for heating and r Sp Col for cooling. If the room temperature exceeds the cooling setpoint, the cooling controller is activated (b En Col), if it falls below the heating setpoint, the heating controller is activated (b En Htg). If the temperature is between the two setpoints, both controllers are switched off (energy-neutral zone). Here too, the output of the controller enable states b En Htg and b En Col is delayed by udi Chg Ovr Dly_sec [s] (see two-pipe network). In addition to the elapsing of this changeover time, the system checks that the output from controller to be switched off is 0.0. This is based on feedback at the inputs r Ctrl Val Htg and r Ctrl Val Col. In this way, a drastic change from heating to cooling and vice versa is avoided, if the changeover time is inadequate. Dew-point monitor (b Dew Pnt) In both systems (two- and four-pipe) the dew-point monitor has the task of deactivating cooling immediately, if required. Program sequence The function block can have 3 possible states: 1. Waiting for heating or cooling enable 2. Heating enable 3. Cooling enable In the first step, the function block waits for compliance with the conditions required for heating or cooling: Heating Cooling Cooling controller output = 0 (r Ctrl Val Col) Heating controller output = 0 (r Ctrl Val Htg) Room temperature (r Rm T) < heating setpoint Room temperature (r Rm T) > cooling setpoint (r Sp Htg) (r Sp Col) Cooling controller enable (b En Col) is FALSE over at Heating controller enable (b En Htg) is FALSE over at least the changeover time udi Chg Ovr Dly_sec [s] least the changeover time udi Chg Ovr Dly_sec [s] Four-pipe system is selected (b Pipesys=TRUE) Four-pipe system is selected (b Pipesys=TRUE) OR two-pipe system is selected and heating medium OR two-pipe system is selected and cooling medium is available (b Pipe Sys=FALSE AND is available (b Pipe Sys=FALSE AND b Medium=FALSE) b Medium=TRUE) The dew-point monitor does not respond (b Dew Pnt=TRUE) If a chain of conditions is met, the function block switches to the respective state (heating or cooling) and remains in this state until the corresponding controller issues 0 at the function block input (r Ctrl Val Htg/ r Ctrl Val Col). This ensures that only one controller is active at any one time, even if a high heating controller output, for example, would call for a brief cooling intervention (overshoot). Heating or cooling continues until there is no longer a demand. There are 3 exceptions, for which heating or cooling is immediately interrupted: 1. A two-pipe system (b Pipe Sys=FALSE) is in heating mode (b En Htg), but a switch to cooling medium occurred b Medium=TRUE 2. A two-pipe system (b Pipe Sys=FALSE) is in cooling mode (b En Col), but a switch to heating medium occurred b Medium=FALSE 3. The dew-point monitor was triggered (b Dew Pnt=TRUE) in cooling mode (two- or four-pipe system) In these cases the heating or cooling enable states are canceled, and the plant switches to standby. TF8040 Version: 1.14.0 535
## Page 536

Programming Demand message (udireqd Medium) To notify the plant of the current demand for heating or cooling, a demand ID is issued at the function block output, i.e. for each room, depending on the actual and set temperature. These can be collected and evaluated centrally. The evaluation always takes place, irrespective of the network type (two- or four-pipe). udi Reqd Medium Medium Room temperature 1 No medium is requested r Rm T > r Sp Htg AND r Rm T < r Sp Col 2 Heating medium is requested r Rm T < r Sp Htg 3 Cooling medium is requested r Rm T > r Sp Col Error handling The heating setpoint must not be greater than or equal to the cooling setpoint, since this would result in temperature range with simultaneous heating and cooling demand. However, since the function block only issues one enable state at a time (i.e. heating or cooling), the case is harmless from a plant engineering perspective. In this case only a warning message is issued (b Err=TRUE, s Err Descr=warning message); the function block does not interrupt its cycle. VAR_INPUT b Pipe Sys : BOOL; b Medium : BOOL; b Dew Pnt : BOOL; r Rm T : REAL; r Sp Htg : REAL; r Sp Col : REAL; r Ctrl Val Htg : REAL; r Ctrl Val Col : REAL; udi Chg Ovr Del_sec : UDINT; b Pipe Sys: In two-pipe system b Pipe Sys is FALSE, in four-pipe systems it is TRUE. b Medium: Current supply of the whole two-pipe network with cooling or heating medium. If heating medium is active, b Medium is FALSE. b Dew Pnt: Dew-point monitor: If b Dew Pnt = FALSE, the cooling controller is locked. r TRm: Room temperature. r Sp Htg: Heating setpoint. r Sp Col: Cooling setpoint. r Ctrl Val Htg: Current output value of the heating controller. Used internally as switching criterion from heating to cooling: r Ctrl Val Htg must be 0. r Ctrl Val Col: Current output value of the cooling controller. Used internally as switching criterion from cooling to heating: r Ctrl Val Col must be 0. udi Chg Ovr Del_sec: Switchover delay [s] from heating to cooling or vice versa. Internally limited to a minimum value of 0. VAR_OUTPUT b En Htg : BOOL; b En Col : BOOL; udi Reqd Medium : UDINT; udi Rem Ti Chg Ovr Dly Htg_sec : UDINT; udi Rem Ti Chg Ovr Dly Col_sec : UDINT; b Err : BOOL; s Err Descr : T_MAXSTRING; b En Htg: Heating controller enable. b En Col: Cooling controller enable. udi Reqd Medium: 536 Version: 1.14.0 TF8040
## Page 537

Programming udi Reqd Medium Medium Room temperature 1 No medium is requested r Rm T > r Sp Htg AND r Rm T < r Sp Col 2 Heating medium is requested r Rm T < r Sp Htg 3 Cooling medium is requested r Rm T > r Sp Col udi Rem Ti Chg Ovr Dly Htg_sec: Countdown [s] for switchover delay from cooling to heating. udi Rem Ti Chg Ovr Dly Col_sec: Countdown [s] for switchover delay from heating to cooling. b Err: In case of a fault, e.g. if warning stages are active, this output is set to TRUE. s Err Descr: Contains the error description. Error description 01: Warning: The heating setpoint is higher than or equal to the cooling setpoint Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.1.2 FB_BA_Rm TAdj The function block FB_BA_Rm TAdj is used for user adjustment of the room temperature setpoint. It shifts the setpoints at the input of a function block depending on an offset r Rm TAdj, as shown in the following diagram. At the r Rm TAdj input, the value of a resistance potentiometer or a bus-capable field device can be used for the setpoint correction. TF8040 Version: 1.14.0 537
## Page 538

Programming If the set value r Rm TAdj is greater than zero, room heating is requested: The Comfort Heating value is increased by r Rm TAdj. At the same time, the values for Comfort Cooling and Pre Comfort Cooling are increased. If the value r Rm TAdj is less than zero, a lower room temperature is requested. Analog to the heating case, the values for Comfort Cooling, Comfort Heating and Pre Comfort Heating are now reduced by the value r Rm TAdj. Auto-correction The temperature adjustment is intended for small corrections of the values. Although it is possible to enter any input values, a heating system will only work in a meaningful manner if the setpoints have ascending values in the following order: 538 Version: 1.14.0 TF8040
## Page 539

Programming • Protection Heating • Economy Heating • Precomfort Heating • Comfort Heating • Comfort Cooling • Precomfort Cooling • Economy Cooling • Protection Cooling Auto-correction works according to the following principle: Starting with the value Economy Heating, the system checks whether this value is smaller than the lower value of Protection Heating. If this is the case, the value for Economy Heating is adjusted to match the value for Protection Heating. The system then checks whether the value for Precomfort Heating is less than Economy Heating and so on, until the value for Protection Cooling is compared with the value for Economy Cooling. If one or several values were corrected, this is indicated with a TRUE signal at output b Val Corr. VAR_INPUT r Rm TAdj : REAL; st Sp : ST_BA_Sp Rm T; r Rm TAdj: Room temperature offset value. st Sp: Input structure for the setpoints (see ST_BA_Sp Rm T [} 688]). VAR_OUTPUT b Val Corr : BOOL; r Pr Prtc Htg : REAL; r Pr Eco Htg : REAL; r Pr Pre Cmf Htg : REAL; r Pr Cmf Htg : REAL; r Pr Prtc Col : REAL; r Pr Eco Col : REAL; r Pr Pre Cmf Col : REAL; r Pr Cmf Col : REAL; st Pr Sp : ST_BA_Sp Rm T; b Val Corr: Autocorrection for the values was performed, see above. r Pr Prtc Htg: Resulting Protection Heating setpoint. r Pr Eco Htg: Resulting Economy Heating setpoint. r Pr Pre Cmf Htg: Resulting Pre Comfort Heating setpoint. r Pr Cmf Htg: Resulting Comfort Heating setpoint. r Pr Cmf Col: Resulting Comfort Cooling setpoint. r Pr Pre Cmf Col: Resulting Pre Comfort Cooling setpoint. r Pr Eco Col: Resulting Economy Cooling setpoint. r Pr Prtc Col: Resulting Protection Cooling setpoint. st Pr Sp: Consolidated output of the resulting values in a structure (see ST_BA_Sp Rm T [} 688]). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 539
## Page 540

Programming 6.1.2.3.2.1.2.1.3 FB_BA_Sp Rm T The function block FB_BA_Sp Rm T assigns setpoints for cooling and heating operation to each of the energy levels Protection, Economy, Pre Comfort and Comfort. The following graphics illustrates the behavior of the function block; the entered values should be regarded as examples: 540 Version: 1.14.0 TF8040
## Page 541

Programming The parameter r Shift Htg is applied to the Comfort and Precomfort values for the heating mode as central setpoint shift. In addition, winter compensation r Win Cpsn is applied. Similarly, the following applies for the cooling mode: The parameter r Shift Col is applied to the Comfort and Precomfort values. In addition, the summer compensation value r Sum Cpsn is applied. TF8040 Version: 1.14.0 541
## Page 542

Programming Auto-correction The setpoint shift is intended for small corrections of the values. Although it is possible to enter any input values, a heating system will only work in a meaningful manner if the setpoints have ascending values in the following order: • Protection Heating • Economy Heating • Precomfort Heating • Comfort Heating • Comfort Cooling • Precomfort Cooling • Economy Cooling • Protection Cooling Auto-correction works according to the following principle: Starting with the value Economy Heating, the system checks whether this value is smaller than the lower value of Protection Heating. If this is the case, the value for Economy Heating is adjusted to match the value for Protection Heating. The system then checks whether the value for Precomfort Heating is less than Economy Heating and so on, until the value for Protection Cooling is compared with the value for Economy Cooling. If one or several values were corrected, this is indicated with a TRUE signal at output b Val Corr. VAR_INPUT r Sum Cpsn : REAL; r Wr Win Cpsn : REAL; r Sum Cpsn: Summer compensation value r Win Cpsn: Winter compensation value VAR_OUTPUT b Val Corr : BOOL; r Pr Prtc Htg : REAL; r Pr Eco Htg : REAL; r Pr Pre Cmf Htg : REAL; r Pr Cmf Htg : REAL; r Pr Cmf Col : REAL; r Pr Pre Cmf Col : REAL; r Pr Eco Col : REAL; r Pr Prtc Col : REAL; st Pr Sp : ST_BA_Sp Rm T; b Val Corr: Autocorrection: At least one of the resulting setpoints was adjusted such that the values continue to monotonically increase. r Pr Prtc Htg: Resulting Protection Heating setpoint. r Pr Eco Htg: Resulting Economy Heating setpoint. r Pr Pre Cmf Htg: Resulting Pre Comfort Heating setpoint. r Pr Cmf Htg: Resulting Comfort Heating setpoint. r Pr Cmf Col: Resulting Comfort Cooling setpoint. r Pr Pre Cmf Col: Resulting Pre Comfort Cooling setpoint. r Pr Eco Col: Resulting Economy Cooling setpoint. r Pr Prtc Col: Resulting Protection Cooling setpoint. st Pr Sp: Consolidated output of the resulting values in a structure (see ST_BA_Sp Rm T [} 688]). 542 Version: 1.14.0 TF8040
## Page 543

Programming VAR_INPUT_CONSTANT_PERSISTENT (Parameter) r Shift Col : REAL := 0; r Shift Htg : REAL := 0; r Prtc Col : REAL := 35; r Eco Col : REAL := 28; r Pre Cmf Col : REAL := 25; r Cmf Col : REAL := 23; r Cmf Htg : REAL := 21; r Pre Cmf Htg : REAL := 18; r Eco Htg : REAL := 14; r Prtc Htg : REAL := 6; r Shift Col: Cooling setpoint value shift. r Shift Htg: Heating setpoint value shift. r Prtc Col: Basic Protection Cooling setpoint. r Eco Col: Basic Economy Cooling setpoint. r Pre Cmf Col: Basic Pre Comfort Cooling setpoint. r Cmf Col: Basic Comfort Cooling setpoint. r Cmf Htg: Basic Comfort Heating setpoint. r Pre Cmf Htg: Basic Pre Comfort Heating setpoint. r Eco Htg: Basic Economy Heating setpoint. r Prtc Htg: Basic Protection Heating setpoint. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.2 Lighting Function blocks Name Description FB_BA_Toggle [} 543] Switching of lamps. 6.1.2.3.2.1.2.2.1 FB_BA_Toggle The function block is used to switch an actuator on or off. The input b En is used for enabling the function block. A positive edge at the input b On results in setting of output b Q. The output is reset by a rising edge at the b Off input. If a rising edge is presented to b Toggle, the output is negated; i.e., if On it goes Off, and if Off it goes On. VAR_INPUT b En : BOOL; b On : BOOL; b Off : BOOL; b Toggle : BOOL; TF8040 Version: 1.14.0 543
## Page 544

Programming b En: Function block enable. b On: Switches the output on. b Off: Switches the output off. b Toggle: Negates the current output state. VAR_OUTPUT b Q : BOOL; b Q: Control output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3 Shading Overview of shading correction [} 546] Shading correction: Basic principles and definitions [} 546] Overview of automatic sun protection [} 554] Sun protection: Basic principles and definitions [} 556] List of shading elements [} 561] List of facade elements [} 561] 544 Version: 1.14.0 TF8040
## Page 545

Programming Function blocks Name Description FB_BA_Bld Pos Entry [} 561] Sun protection function: Input of blind positions. FB_BA_Calc Sun Pos [} 563] Calculation of sun position FB_BA_Fcd Elem Entry [} 565] Shading correction: Input of facade elements per function block. FB_BA_In Rng Azm [} 570] Verification of valid sun position and sun direction range (azimuth angle) FB_BA_In Rng Elv [} 572] Verification of valid sun position and sun elevation range (elevation angle) FB_BA_Rd Fcd Elem Lst [} 575] Shading correction: Input of facade elements via data list (csv). FB_BA_Rd Shd Obj Lst [} 579] Shading correction: Input of shading objects via data list (csv). FB_BA_Rol Bld Actr [} 583] Roller shutter actuator FB_BA_Shd Corr [} 585] Shading correction function block FB_BA_Shd Obj Entry [} 588] Shading correction: Input of shading objects per function block. FB_BA_Sun Bld Actr [} 591] Blind actuator FB_BA_Sun Bld Evt [} 596] Output of a specified blind position and angle in percent FB_BA_Sun Bld Ice Prtc [} 597] Anti-icing FB_BA_Sun Bld Pos Dly [} 598] Switch-on delay for blinds/groups of blinds FB_BA_Sun Bld Prio Swi4 [} 599] Priority control, 4 inputs FB_BA_Sun Bld Prio Swi8 [} 600] Priority control, 8 inputs FB_BA_Sun Bld Scn [} 601] Manual operation with scene selection and programming FB_BA_Sun Bld Swi [} 604] Manual operation FB_BA_Sun Bld Twi Lgt Auto [} 606] Automatic twilight function FB_BA_Sun Bld Wnd Prtc [} 607] Protection against wind damage FB_BA_Sun Prtc [} 609] Sun protection function, see Overview of automatic sun protection (shading correction) TF8040 Version: 1.14.0 545
## Page 546

Programming 6.1.2.3.2.1.2.3.1 Overview of shading correction 6.1.2.3.2.1.2.3.2 Shading correction: Basic principles and definitions The shading correction can be used in conjunction with the automatic sun function or louvre adjustment. The function checks whether a window or a window group that is assigned to a room, for example, is temporarily placed in the shade by surrounding buildings or parts of its own building. Sun shading for windows that stand in the shadow of surrounding buildings or trees is not necessary and may even be disturbing under certain circumstances. On the basis of data entered regarding the facade and its surroundings, the shading correction determines which parts of the front are in the shade. Hence, it is then possible to decide whether the sun protection should be active for individual windows or window groups. Apart from the current position of the sun, the shading of the individual windows depends on three things: • the orientation of the facade 546 Version: 1.14.0 TF8040
## Page 547

Programming • the position of the windows • the positioning of the shading objects The following illustrations are intended to describe these interrelationships and to present the parameters to be entered. Orientation of the facade Observation from above For the pure observation of the shadow thrown on the facade, a two-dimensional coordinate system is ultimately required, therefore the X and Y axis were placed on the facade. The zero point is thereby at the bottom left on the base, as if one were regarding the facade from the front. For the calculation of the shading objects the Z component is then also added. Its axis points from away the facade and has the same zero point as the X and Y axis. In the northern hemisphere, the horizontal sun position (azimuth angle) is determined from the north direction by definition. The facade orientation is likewise related to north, wherein the following applies to the line of sight from a window in the facade: Line of sight Facade orientation North β=0° East β=90° South β=180° West β=270° In the southern hemisphere is the sun path is the other way round: Although it also rises in the east, ad midday it is in the north. The facade orientation is adjusted to this path: Line of sight Facade orientation South β=0° East β=90° North β=180° West β=270° For convenience, the other explanations refer to the northern hemisphere. The calculations for the southern hemisphere are analogous. When the function block FB_BA_Shd Corr [} 585] (shading correction) is parameterized they are activated through a boolean input, b South The following two illustrations are intended to further clarify the position of the point of origin P as well as the 0 orientation of the coordinate system: TF8040 Version: 1.14.0 547
## Page 548

Programming Observation from the side The angle of elevation (height of the sun) can be represented using this illustration: by definition this is 0° at sunrise (horizontal incidence of light) and can reach maximally 90°, but this applies only to places within the Tropic of Cancer and the Tropic of Capricorn. Observation from the front Here, the position of the point of origin, P , at the bottom left base point of the facade is once more very 0 clear. Beyond that the X-Y orientation is illustrated, which is important later for the entry of the window elements. Position of the windows The position of the windows is defined by the specification of their bottom left corner in relation to the facade coordinate system. Since a window lies flat on the facade, the entry is restricted to the X and Y coordinates. 548 Version: 1.14.0 TF8040
## Page 549

Programming In addition, the window width and the window height have to be specified. The position of each window corner on the facade is determined internally from the values entered. A window is considered to be in the shade if all corners lie in the shade. Positioning of the shading objects When describing the shading objects, distinction is made between angular objects (building, column) and objects that are approximately spherical (e.g. trees). Angular objects can be subdivided into rectangular shadow-casting facades depending on their shadow projection; you should consider which surfaces cast the main shadows over the day: TF8040 Version: 1.14.0 549
## Page 550

Programming Morning/noon In the morning and around noon, the shadow is mainly cast by the sides S and S . S and S do not have to 1 4 2 3 be considered, unless they are higher. 550 Version: 1.14.0 TF8040
## Page 551

Programming Afternoon/evening In the afternoon and evening, the total shade can be determined solely through S and S . In this case it is 1 2 therefore sufficient to specify S S and S as shadow casters. The entry is made on the basis of the four 1, 2 4 corners or their coordinates in relation to the zero point of the facade: TF8040 Version: 1.14.0 551
## Page 552

Programming In this sketch only the upper points, P and P , are illustrated due to the plan view. The lower point P lies 2 3 1 underneath P and P lies underneath P . 2 4 3 The input of shadow-casting ball elements is done by entering the center of the ball and its radius: Ball elements 552 Version: 1.14.0 TF8040
## Page 553

Programming A "classification" of the ball element as in the case of the angular building is of course unnecessary, since the shadow cast by a ball changes only its direction, but not its size. TF8040 Version: 1.14.0 553
## Page 554

Programming 6.1.2.3.2.1.2.3.3 Overview of automatic sun protection 554 Version: 1.14.0 TF8040
## Page 555

Programming TF8040 Version: 1.14.0 555
## Page 556

Programming 6.1.2.3.2.1.2.3.4 Sun protection: Basic principles and definitions The direct incidence of daylight is regarded as disturbing by persons in rooms. On the other hand, however, people perceive natural light to be more pleasant in comparison with artificial light. Two options for glare protection are to be presented here: • Louvre adjustment • Height adjustment Lamella setpoint tracing A blind with lamellas that can be adjusted offers the option of intelligent sun protection here. The position of the lamellas is cyclically adapted to the current position of the sun, so that no direct daylight enters through the blinds, but as much diffuse daylight can be utilized as possible. The illustration shows that diffuse light can still enter from underneath, whereas no further direct daylight, or theoretically only a single ray, can enter. The following parameters are necessary for the calculation of the lamella angle: • the current sun elevation (elevation angle) • the sun position, i.e. the azimuth angle • the facade orientation • the lamella width • the lamella spacing Effective elevation angle If the blind is viewed in section as above, the angle of incidence does not depend solely on the sun elevation, but also on the direction of the sun: • If the facade orientation and the sun position (azimuth) are the same, i.e. the sunlight falls directly onto the facade, the effective light incidence angle is the same as the current elevation angle. • However, if the sunlight falls at an angle onto the facade as seen from the sun direction, the effective angle is larger for the same elevation angle. This relationship can easily be illustrated with a set square positioned upright on the table: Viewed directly from the side you can see a triangle with two 45° angles and one 90° angle. If the triangle is rotated, the side on the table appears to become shorter and the two original 45° angles change. The triangle appears to be getting steeper. We therefore refer to the "effective elevation angle", which describes the proportion of light that falls directly onto the blind. The following three images illustrate the relationship between the effective elevation angle and the blind dimensions, and how the resulting lamella angle λ changes during the day: 556 Version: 1.14.0 TF8040
## Page 557

Programming TF8040 Version: 1.14.0 557
## Page 558

Programming Height adjustment With a high position of the sun at midday, the direct rays of sunlight do not penetrate into the full depth of the room. If direct rays of sunlight in the area of the window sill are regarded as uncritical, the height of the sun protection can be adapted automatically in such a way that the rays of sunlight only ever penetrate into the room up to an uncritical depth. In order to be able to calculate at any time the appropriate blind height that guarantees that the incidence of sunlight does not exceed a certain value, the following values are necessary. Required for the calculation of the respective blind height: • Sun elevation • Window height • Distance between the window and the floor The following illustration shows where these parameters are to be classified: 558 Version: 1.14.0 TF8040
## Page 559

Programming Influence of the facade inclination In both of the methods of sun protection described, it was assumed that the facade and thus the windows are perpendicular to the ground. In the case of an inclined facade, however, the incidence of light changes such that this influence will also be taken into account. The facade inclination is defined as follows: TF8040 Version: 1.14.0 559
## Page 560

Programming 560 Version: 1.14.0 TF8040
## Page 561

Programming 6.1.2.3.2.1.2.3.5 List of shading elements The data of all shading objects (building components, trees, etc.) per facade are stored in a field of structure elements of type ST_BA_Shd Obj [} 688] within the program. The shading correction FB_BA_Shd Corr [} 585] reads the information from this list. The management function block FB_BA_Shd Obj Entry [} 588] reads and writes it as input/output variable. It is therefore advisable to declare this list globally: VAR_GLOBAL arr Shd Obj : ARRAY[1..g BA_c Max Shd Obj] OF ST_BA_Shd Obj; END_VAR The variable g BA_c Max Shd Obj represents the upper limit of the available elements and is defined as a global constant within the program library: VAR_GLOBAL CONSTANT g BA_c Max Shd Obj : INT := 20; END_VAR 6.1.2.3.2.1.2.3.6 List of facade elements The data of all windows (facade elements) per facade are saved within the program in a field of structure elements of the type ST_BA_Fcd Elem [} 687]. The management function block FB_BA_Fcd Elem Entry [} 565] and the shading correction FB_BA_Shd Corr [} 585] read and write to this list (the latter sets the shading information); they access this field as input/ output variables. It is therefore advisable to declare this list globally: VAR_GLOBAL arr Fcd Elem : ARRAY[1..ui Max Row Fcd, 1..ui Max Column Fcd] OF ST_BA_Fcd Elem; END_VAR The variables ui Max Column Fcd and ui Max Row Fcd define the upper limit of the available elements and are declared as global constants within the program library: VAR_GLOBAL CONSTANT ui Max Row Fcd : UINT :=10; ui Max Column Fcd : UINT :=20; END_VAR 6.1.2.3.2.1.2.3.7 FB_BA_Bld Pos Entry This function block is used for entering interpolation points for the function block FB_BA_Sun Prtc [} 609], if this function block is operated in height positioning mode with the aid of a table, see E_BA_Pos Mod [} 685]. In addition to the operating modes "Fixed shutter height" and "Maximum incidence of light", the function block FB_BA_Sun Prtc [} 609] also offers the possibility to control the shutter height in relation to the position of the sun by means of table entries. By entering several interpolation points, the shutter height relative to the respective sun position is calculated by linear interpolation. However, since incorrectly entered values can lead to malfunctions in FB_BA_Sun Prtc [} 609], this function block is to be preceded by the function block TF8040 Version: 1.14.0 561
## Page 562

Programming FB_BA_Bld Pos Entry. Four interpolation points can be parameterized on this function block, whereby a missing entry is evaluated as a zero entry. The function block does not sort the values entered independently, but instead ensures that the positions of the sun entered in the respective interpolation points are entered in ascending order. Unintentional erroneous entries are noticed faster as a result. The values chosen for r Sun Elv1 .. r Sun Elv4 must be unique; for example, the following situation must be avoided: [ r Sun Elv1 = 10 ; r Pos1 = 50] and at the same time [r Sun Elv2 = 10 ; r Pos2 = 30 ]. This would mean that there would be two different target values for one and the same value, which does not allow a unique functional correlation to be established. On top of that the entries for the position of the sun and shutter height must lie within the valid range. Mathematically this means that the following conditions must be satisfied: • r Sun Elv1 < r Sun Elv2 < r Sun Elv3 < r Sun Elv4 - (values ascending and not equal) • 0 ≤ r Sun Elv ≤ 90 ( [°] - scope source values) • 0 ≤ r Pos ≤ 100 (in percent - scope target values) The function block checks the entered values for these conditions and issues an error message if they are not met. In addition, the value b Valid of ST_BA_Bld Pos Tab [} 686] is set to FALSE. Furthermore the function block independently ensures that the boundary areas are filled out: Internally, a further interpolation point is set at r Sun Elv = 0 with r Bld Pos1 and another one above r Sun Elv4 at r Sun Elv = 90 with r Bld Pos4. This ensures that a meaningful target value is available for all valid input values 0 ≤ r Sun Elv ≤ 90, without the user having to enter r Sun Elv = 0 and r Sun Elv = 90: This increases the actual number of interpolation points transferred to the function block FB_BA_Sun Prtc [} 609] to 6; see ST_BA_Bld Pos Tab [} 686]. The interpolation of the values takes place in the glare protection function block. VAR_INPUT r Sun Elv1 : REAL; r Pos1 : REAL; r Sun Elv2 : REAL; r Pos2 : REAL; r Sun Elv3 : REAL; r Pos3 : REAL; r Sun Elv4 : REAL; r Pos4 : REAL; r Sun Elv1: Sun position at the first interpolation point (0°..90°). 562 Version: 1.14.0 TF8040
## Page 563

Programming r Pos1: Blind position (degree of closure) at the first interpolation point (0%..100%). r Sun Elv2: Sun position at the second interpolation point (0°..90°). r Pos2: Blind position (degree of closure) at the second interpolation point (0%..100%). r Sun Elv3: Sun position at the third interpolation point (0°..90°). r Pos3: Blind position (degree of closure) at the third interpolation point (0%..100%). r Sun Elv4: Sun position at the fourth interpolation point (0°..90°). r Pos4: Blind position (degree of closure) at the fourth interpolation point (0%..100%). VAR_OUTPUT st Bld Pos Tab : ST_BA_Bld Pos Tab; b Err : BOOL; s Err Descr : T_MAXSTRING; st Bld Pos Tab: Transfer structure of the interpolation points, see ST_BA_Bld Pos Tab [} 686]. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: The x-values (elevation values) in the table are either not listed in ascending order, or they are duplicated. 02: Error: An elevation value that was entered is outside the valid range of 0°..90°. 03: Error: An position value that was entered is outside the valid range of 0°...100%. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.8 FB_BA_Calc Sun Pos Calculation of sun position based on the date, time, longitude and latitude. The position of the sun for a given point in time can be calculated according to common methods with a defined accuracy. For applications with moderate requirements, the present function block is sufficient. As the basis for this, the SUNAE algorithm was used, which represents a favorable compromise between accuracy and computing effort. The position of the sun at a fixed observation point is normally determined by specifying two angles. One angle indicates the height above the horizon; 0° means that the sun is in the horizontal plane of the location; a value of 90° means that the is perpendicular to the observer. The other angle indicates the direction at which the sun is positioned. The SUNAE algorithm is used to distinguish whether the observer is standing on the northern hemisphere (longitude > 0 degrees) or on the southern hemisphere (longitude < 0 degrees) of the earth. If the observation point is in the northern hemisphere is, then a value of 0° is assigned for the northern sun direction and it then runs in the clockwise direction around the compass, i.e. 90° is east, 180° is south, 270° is west etc. If the point of observation is in the southern hemisphere, then 0° corresponds to the southern direction and it then runs in the counter clockwise direction, i.e. 90° is east, 180° is north, 270° is west etc. TF8040 Version: 1.14.0 563
## Page 564

Programming The time has to be specified as coordinated world time (UTC, Universal Time Coordinated, previously referred to as GMT, Greenwich Mean Time). The latitude is the northerly or southerly distance of a location on the Earth’s surface from the equator, in degrees [°]. The latitude can assume a value from 0° (at the equator) to ±90° (at the poles). A positive sign thereby indicates a northern direction and a negative sign a southern direction. The longitude is an angle that can assume values up to ±180° starting from the prime meridian 0° (an artificially determined North-South line). A positive sign indicates a longitude in an eastern direction and a negative sign in a western direction. Examples: Location Longitude Latitude Sydney, Australia 151.2° -33.9° New York, USA -74.0 40.7° London, England -0.1° 51.5° Moscow, Russia 37.6° 55.7° Peking, China 116.3° 39.9° Dubai, United Arab Emirates 55.3° 25.4° Rio de Janeiro, Brazil -43.2° -22.9° Hawaii, USA -155.8° 20.2° Verl, Germany 8.5° 51.9° If the function block FB_BA_Calc Sun Pos returns a negative value for the solar altitude r Sun Elv, the sun is invisible. This can be used to determine sunrise and sunset. VAR_INPUT r Deg Lngd : REAL; r Deg Latd : REAL; st UTC : TIMESTRUCT; r Deg Lngd: Longitude [°]. r Deg Latd: Latitude [°]. st UTC: Input of the current time as coordinated world time (see TIMESTRUCT). The function block FB_BA_Get Time [} 618] can be used to read this time from a target system. VAR_OUTPUT r Sun Azm : REAL; r Sun Elv : REAL; 564 Version: 1.14.0 TF8040
## Page 565

Programming r Sun Azm: Direction of the sun (northern hemisphere: 0° north ... 90° east ... 180° south ... 270° west ... / southern hemisphere: 0° south ... 90° east ... 180° north ... 270° west ...). r Sun Elv: Height of the sun (0° horizontal - 90° vertical). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.9 FB_BA_Fcd Elem Entry This function block serves the administration of all facade elements (windows) in a facade, which are saved globally in a list of facade elements [} 561]. It is intended to facilitate inputting element information - not least with regard to using the TC3 PLC HMI. A schematic illustration of the objects with description of the coordinates is given in Shading correction: principles and definitions [} 546]. The facade elements are declared in the global variables as a two-dimensional field above the window columns and rows: VAR_GLOBAL arr Fcd Elem : ARRAY[1.. Param.ui Max Column Fcd, 1.. Param.ui Max Row Fcd] OF ST_BA_Fcd Elem; END_VAR Each element arr Fcd Elem[x,y] contains the information for an individual facade element (ST_BA_Fcd Elem [} 687]). The information includes the group affiliation, the dimensions (width, height) and the coordinates of the corners. The function block thereby accesses this field directly via the IN-OUT variable arr Fcd Elem. Note: The fact that the coordinates of corners C2 to C4 are output values arises from the fact that they are formed from the input parameters and are to be available for use in a visualization: TF8040 Version: 1.14.0 565
## Page 566

Programming All entries in [m]! r Cnr2X = r Cnr1X r Cnr2Y = r Cnr1Y + r Wdw Hght (window hight) r Cnr3X = r Cnr1X + r Wdw Wdth (window width) r Cnr3Y = r Cnr2Y r Cnr4X = r Cnr1X + r Wdw Wdth (window width) r Cnr4Y = r Cnr1Y The function block is used in three steps: • Read • Change • Write Read The entries udi Column and udi Row are used to select the corresponding element from the list, arr Fcd Elem[udi Column, udi Row]. A rising edge on b Rd reads the following data from the list element: • usi Grp group membership, • r Cnr1X x-coordinate of corner point 1 [m] • r Cnr1Y y-coordinate of corner point 1 [m] • r Wdw Wdth window width [m] • r Wdw Hght window height [m] These are then assigned to the corresponding input variables of the function block, which uses them to calculate the coordinates of corners C2-C4 as output variables in accordance with the correlation described above. It is important here that the input values are not overwritten in the reading step. Hence, all values can initially be displayed in a visualization. 566 Version: 1.14.0 TF8040
## Page 567

Programming Change In a next program step the listed input values can then be changed. The values entered are constantly checked for plausibility. The output b Err indicates whether the values are valid (b Err=FALSE). If the values are invalid, a corresponding error message is issued at output s Err Descr. See also "Error (b Err=TRUE)" below. Write The parameterized data are written to the list element with the index n Id upon a rising edge on b Wrt, regardless of whether they represent valid values or not. The element structure ST_BA_Fcd Elem [} 687] therefore also contains a plausibility bit b Vld, which forwards precisely this information to the function block FB_BA_Shd Corr [} 585] to prevent miscalculations. This approach is to be regarded only as a proposal. It is naturally also possible to parameterize the function block quite normally in one step and to write the values entered to the corresponding list element with a rising edge on b Wrt. Error (b Err=TRUE) The function block FB_BA_Shd Corr [} 585], which judges whether all windows in a group are shaded, will only perform its task if all windows in the examined group have valid entries. This means: • usi Grp must be greater than 0 • r Cnr1X must greater than or equal to 0.0 • r Cnr1Y must greater than or equal to 0.0 • r Wdw Wdth must be greater than 0 • r Wdw Hght must be greater than 0 If one of these criteria is not met, it is interpreted as incorrect input, and the error output b Err is set at the function block output of FB_BA_Fcd Elem Entry. Within the window element ST_BA_Fcd Elem [} 687], the plausibility bit b Vld is set to FALSE. If on the other hand all entries of a facade element are zero, it is regarded as a valid, deliberately omitted facade element: TF8040 Version: 1.14.0 567
## Page 568

Programming In the case of a facade of 6x4 windows, the elements window (2.1), window (3.5) and window (4.4) would be empty elements here. VAR_INPUT udi Column : UDINT; udi Row : UDINT; b Wrt : BOOL; b Rd : BOOL; udi Grp : UDINT; r Cnr1X : REAL; r Cnr1Y : REAL; r Wdw Wdth : REAL; r Wdw Hght : REAL; udi Column: Column index of the selected component on the facade. This refers to the selection of a field element of the array stored in the IN-OUT variable arr Fcd Elem. udi Row: ditto. row index. udi Row and udi Column must not be zero! This is due to the field definition, which always starts with 1; see above. 568 Version: 1.14.0 TF8040
## Page 569

Programming b Rd: A positive edge at this input causes the information of the selected element, arr Fcd Elem[udi Column,udi Row], to be read into the function block and assigned to the input variables di Grp to r Wdw Hght. The resulting output variables are r Cnr2X to r Cnr4Y. If data are already present on the inputs di Grp to r Wdw Hght at time of reading, then the data previously read are immediately overwritten with these data. b Wrt: A positive edge writes the entered and calculated values into the selected field element arr Fcd Elem[udi Column, udi Row]. udi Grp: Group membership. Internally limited to a minimum value of 0. r Cnr1X: X-coordinate of corner point 1 [m]. r Cnr1Y: Y-coordinate of corner point 1 [m]. r Wdw Wdth: Window width [m]. r Wdw Hght: Window height [m]. VAR_OUTPUT r Cnr2X : REAL; r Cnr2Y : REAL; r Cnr3X : REAL; r Cnr3Y : REAL; r Cnr4X : REAL; r Cnr4Y : REAL; b Err : BOOL; s Err Desc : T_MAXSTRING; r Cnr2X: Calculated X-coordinate of corner point 2 of the window [m]. See "Note [} 565]" above. r Cnr2Y: Calculated Y-coordinate of corner point 2 of the window [m]. See "Note [} 565]" above. r Cnr3X: Calculated X-coordinate of corner point 3 of the window [m]. See "Note [} 565]" above. r Cnr3Y: Calculated Y-coordinate of corner point 3 of the window [m]. See "Note [} 565]" above. r Cnr4X: Calculated X-coordinate of corner point 4 of the window [m]. See "Note [} 565]" above. r Cnr4Y: Calculated Y-coordinate of corner point 4 of the window [m]. See "Note [} 565]" above. b Err: Result verification for the entered values. s Err Desc: Contains the error description. Error description 01: Error: Index error! udi Column and/or udi Row are outside the permitted limits, 1.. ui Max Column Fcd and 1.. ui Max Column Fcd, respectively. See list of facade elements. 02: Error: The group index is 0, but at the same time another entry of the facade element is not zero. Only if all entries of a facade element are zero is it considered to be a valid, deliberately omitted facade component, otherwise it is interpreted as an incorrect entry. NOTE: Group entries less than zero are internally limited to zero. 03: Error: The X-component of the first corner point (Corner1) is less than zero. 04: Error: The Y-component of the first corner point (Corner1) is less than zero. 05: Error: The window width is less than or equal to zero. 06: Error: The window height is less than or equal to zero. VAR_IN_OUT arr Fcd Elem : ARRAY[1.. Param.ui Max Column Fcd, 1.. Param.ui Max Row Fcd] OF ST_BA_Fcd Elem; arr Fcd Elem: List of facade elements (see List of facade elements [} 561]). TF8040 Version: 1.14.0 569
## Page 570

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.10 FB_BA_In Rng Azm This function block checks whether the current azimuth angle (horizontal position of the sun) lies within the limits entered. As can be seen in the overview [} 554], the function block provides an additionally evaluation as to whether the sun shading of a window group should be activated. Therefore the observations in the remainder of the text always apply to one window group. A smooth facade is always irradiated by the sun at an azimuth angle of Facade orientation-90° to Facade orientation+90°. If the facade has lateral projections, however, this range is limited. This limitation can be checked with the help of this function block. However, the position of the window group on the facade also plays a role. If it lies centrally, this gives rise to the following situation (the values are only examples): 570 Version: 1.14.0 TF8040
## Page 571

Programming The values change for a group at the edge: The start of the range r Stt Rng may be greater than the end r End Rng, in which case values beyond 0° are considered: Sample r Azm 10.0° r Stt Rng 280.0° r End Rng 20.0° b Out TRUE However, the range regarded may not be greater than 180° or equal to 0° – this would be unrealistic. Such entries result in an error on the output b Err – the test output b Out is then additionally set to FALSE. VAR_INPUT r Azm : REAL; r Stt Rng : REAL; r End Rng : REAL; r Azm: Current azimuth angle. r Stt Rng: Start of range [°]. TF8040 Version: 1.14.0 571
## Page 572

Programming r End Rng: End of range [°]. VAR_OUTPUT b Out : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING; b Out: The facade element is in the sun if the output is TRUE. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: r Stt Rng or r End Rng less than 0° or greater than 360°. 02: Error: The difference between r Stt Rng and r End Rng is greater than 180°. This range is too large for analyzing the insolation on a facade. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.11 FB_BA_In Rng Elv This function block checks whether the current angle of elevation (vertical position of the sun) lies within the limits entered. As can be seen in the overview [} 554], the function block provides an additionally evaluation as to whether the sun shading of a window group should be activated. Therefore the observations in the remainder of the text always apply to one window group. A normal vertical facade is irradiated by the sun at an angle of elevation of 0° to maximally 90°. 572 Version: 1.14.0 TF8040
## Page 573

Programming If the facade has projections, however, this range is limited. This limitation can be checked with the help of this function block. However, the position of the window group on the facade also plays a role. If it lies in the lower range, this gives rise to the following situation (the values are only examples): TF8040 Version: 1.14.0 573
## Page 574

Programming The values change for a group below the projection: 574 Version: 1.14.0 TF8040
## Page 575

Programming The lower observation limit, r Lo Lmt, may thereby not be greater than or equal to the upper limit, r Hi Lmt. Such entries result in an error on the output b Err – the test output b Out is then additionally set to FALSE. VAR_INPUT r Elv : REAL; r Lo Lmt : REAL; r Hi Lmt : REAL; r Elv: Current elevation angle [°]. r Lo Lmt: Lower limit value [°]. r Hi Lmt: Upper limit value [°]. VAR_OUTPUT b Out : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING; b Out: The facade element is in the sun b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: r Hi Lmt less than or equal to r Lo Lmt. 02: Error: r Lo Lmt is less than 0° or r Hi Lmt is greater than 90°. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.12 FB_BA_Rd Fcd Elem Lst With the help of this function block, data for facade elements (windows) can be imported from a pre-defined Excel table in csv format into the list of facade elements [} 561]. In addition the imported data are checked for plausibility and errors are written to a log file. The following example shows the Excel table with the entries of the window elements. All text fields are freely writable. The fields marked in green are important; each line in these fields identifies a data set. The following rules are to be observed: • A data set must always start with a '@'. • The indices Index Column and Index Row must lie within the defined limits, see List of facade elements [} 561]. These indices directly describe the facade element in the list arr Fcd Elem to which the data from the set are saved. • Window width and window height must be greater than zero • The corner coordinates P1x and P1y must be greater than or equal to zero. • Each window element must be assigned to a group 1..255. • For system-related reasons the total size of the table may not exceed 65534 bytes. • This must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". TF8040 Version: 1.14.0 575
## Page 576

Programming It is not necessary to describe all window elements that would be possible by definition or declaration. Before the new list is read in, the function block deletes the entire old list in the program. All elements that are not described by entries in the Excel table then have pure zero entries and are thus marked as non-existent and also non-evaluable, since the function block for shading correction, FB_BA_Shd Corr [} 585], does not accept elements with the group entry '0'. Log file Each time the reading function block is restarted, the log file is rewritten and the old contents are deleted. If there is no log file, it will be automatically created first. The log file then contains either an OK message or a list of all errors that have occurred. Errors connected with the opening, writing or closing of the log file itself 576 Version: 1.14.0 TF8040
## Page 577

Programming cannot be written at the same time. Therefore, always note the output s Err Descr of the reading function block that indicates the last error code. Since the log file is always closed last during the reading process, a corresponding alarm is ensured in the event of an error. Program sample In this sample the variable b Init is initially set to TRUE when the PLC starts. Hence, the input b Stt of the function block fb Read Facade Element List receives a once-only rising edge that triggers the reading process. The file "Facade Elements.csv" is read, which is located in the folder "C:\Projects\". The log file "Logfile.txt" is then saved in the same folder. If this log file does not yet exist it will be created, otherwise the existing contents are overwritten. Reading and writing take place on the same computer on which the PLC is located. This is defined by the input s Net ID = '' (=local). All data are written to the list arr Fcd Elem declared in the program. During reading and writing the output b Busy is set to TRUE. The last file handling error that occurred is displayed at s Err Descr; b Err is TRUE. If an error is detected in the data set, this is displayed at b Err Data Set and described in more detail in the log file. The number of found and read data rows is displayed at udi Amt Sets Rd for verification purposes. The errors marked were "built into" the following Excel list. This gives rise to the log file shown: TF8040 Version: 1.14.0 577
## Page 578

Programming The first error is in data set 2 and is an index error, since "0" is not permitted. The next error in data set 6 was found after validation of the data with the internally used function block FB_BA_Shd Obj Entry [} 588] and allocated an error description. The third and the fourth errors likewise occurred after the internal validation. Important here is that the data set numbers (in this case 22 and 24) do not go by the numbers entered in the list, but by the actual sequential numbers: only 30 data sets were read in here. VAR_INPUT b Stt : BOOL; s Data File : STRING; s Log File : STRING; s Net Id : T_Ams Net Id; b Stt: A TRUE edge on this input starts the reading process. s Data File: Contains the path and file name for the data file to be opened. This must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". If the file is opened with a simple text editor, the values must be separated by semicolons. Example of an entry: s Data File:= 'C:∖Projekte∖Facade Elements.csv' s Log File: ditto. Log file for the accumulating errors. This file is overwritten each time the function block is activated, so that only current errors are contained. s Net Id: A string can be entered here with the AMS Net ID of the Twin CAT computer on which the files are to be written/read. An empty string can be specified for the local computer (see T_Ams Net Id). 578 Version: 1.14.0 TF8040
## Page 579

Programming The data can be saved only on the control computer itself and on the computers that are connected by ADS to the control computer. Links to local hard disks in this computer are possible, but not to connected network hard drives. VAR_OUTPUT b Busy : BOOL; udi Amt Sets Rd : UDINT; b Err : BOOL; s Err Descr : T_MAXSTRING; b Err Data Set : BOOL; b Busy: This output is TRUE as long as elements are being read from the file. udi Amt Sets Rd: Number of data sets read. b Err: This output is switched to TRUE, if a file write or read error has occurred. s Err Descr: Contains the error description. Error description 01: File handling error: Opening the log file - the ADS error number is stated. 02: File handling error: Open the data file - the ADS error number is stated. 03: File handling error: Reading the data file - the ADS error number is stated. 04: Error: During reading of the data file it was determined that the file is too large (number of bytes larger than udi Max Data File Size) 05: File handling error: Writing to the log file - the ADS error number is stated. 06: File handling error: Closing the data file - the ADS error number is stated. 07: File handling error: Writing to the log file (OK message if no errors were detected) - the ADS error number is stated. 08: File handling error: Closing the log file - the ADS error number is stated. b Err Data Set: This output is set to TRUE, if the read data sets are faulty. Further details are entered in the log file. VAR_IN_OUT arr Fcd Elem : ARRAY[1.. Param.ui Max Column Fcd, 1.. Param.ui Max Row Fcd] OF ST_BA_Fcd Elem; arr Fcd Elem: List of facade elements [} 561]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.13 FB_BA_Rd Shd Obj Lst With the help of this function block, data for shading objects can be imported from a pre-defined Excel table in csv format into the list of shading objects [} 561]. In addition the imported data are checked for plausibility and errors are written to a log file. TF8040 Version: 1.14.0 579
## Page 580

Programming The following example shows the Excel table with the entries of the window elements. All text fields are freely writable. The fields marked in green are important; each line in these fields identifies a data set. The columns G to J have a different meaning depending on whether the type rectangle or ball is concerned. The columns K to M are to be left empty in the case of balls. With regard to the rectangle coordinates, only the relevant data are entered and the remainder are internally calculated, see FB_BA_Shd Obj Entry [} 588]. The following rules are to be observed: • A data set must always start with a '@'. • The monthly entries must not be 0 or greater than 12; all other combinations are possible. Examples: Start=1, End=1: shading in January. Start=1, End=5: shading from the beginning of January to the end of May. Start=11, End=5: shading from the beginning of November to the end of May (the following year). • Window width and window height must be greater than zero • The z-coordinates P1z and P3z or Mz must be greater than zero. • The radius must be greater than zero. • For system-related reasons the total size of the table may not exceed 65534 bytes. • This must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". Is not necessary to describe all shading objects that are possible per facade. Only those contained in the list ultimately take effect. Log file Each time the reading function block is restarted, the log file is rewritten and the old contents are deleted. If there is no log file, it will be automatically created first. The log file then contains either an OK message or a list of all errors that have occurred. Errors connected with the opening, writing or closing of the log file itself cannot be written at the same time. Therefore, always note the output s Err Descr of the reading function block that indicates the last error code. Since the log file is always closed last during the reading process, a corresponding alarm is ensured in the event of an error. 580 Version: 1.14.0 TF8040
## Page 581

Programming Program sample In this sample the variable b Init is initially set to TRUE when the PLC starts. Hence, the input b Stt on the function block fb Read Shading Objects receives a once-only rising edge that triggers the reading process. The file "Shading Objects.csv" is read, which is located in the folder "C:\Projects\". The log file "Logfile.txt" is then saved in the same folder. If this log file does not yet exist it will be created, otherwise the existing contents are overwritten. Reading and writing take place on the same computer on which the PLC is located. This is defined by the input s Net ID = '' (=local). All data are written to the list arr Shd Obj declared in the program. During reading and writing the output b Busy is set to TRUE. The last file handling error that occurred is displayed at s Err Descr; b Err is TRUE. If an error is detected in the data set, this is displayed at b Err Data Set and described in more detail in the log file. The number of found and read data rows is displayed at udi Amt Sets Rd for verification purposes. The errors marked were built into the following Excel list. This gives rise to the log file shown: TF8040 Version: 1.14.0 581
## Page 582

Programming The first error is in data set 3 and is a type error, since "2" is not defined. The next error in data set 6 was found after validation of the data with the internally used function block FB_BA_Shd Obj Entry [} 588] and allocated an error description. The third error likewise occurred after the internal validation. Important here it that the data set number (in this case 11) does not go by the number entered in the list, but by the actual sequential number: only 16 data sets were read in here. VAR_INPUT b Stt : BOOL; s Data File : STRING; s Log File : STRING; s Net Id : T_Ams Net Id;; b Stt: A TRUE edge on this input starts the reading process. s Data File: Contains the path and file name for the data file to be opened. This must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". If the file is opened with a simple text editor, the values must be separated by semicolons. Example of an entry: s Data File:= 'C:∖Projects∖Shading Objects.csv' s Log File: ditto. Log file for the accumulating errors. This file is overwritten each time the function block is activated, so that only current errors are contained. s Net Id: A string can be entered here with the AMS Net ID of the Twin CAT computer on which the files are to be written/read. An empty string can be specified for the local computer (see T_Ams Net Id). The data can be saved only on the control computer itself and on the computers that are connected by ADS to the control computer. Links to local hard disks in this computer are possible, but not to connected network hard drives. VAR_OUTPUT b Busy : BOOL; udi Amt Sets Rd : UDINT; b Err : BOOL; s Err Descr : T_MAXSTRING; b Err Data Set : BOOL; 582 Version: 1.14.0 TF8040
## Page 583

Programming b Busy: This output is TRUE as long as elements are being read from the file. udi Amt Sets Rd: Number of data sets read. b Err: This output is switched to TRUE, if a file write or read error has occurred. s Err Descr: Contains the error description. Error description 01: File handling error: Opening the log file - the ADS error number is stated. 02: File handling error: Open the data file - the ADS error number is stated. 03: File handling error: Reading the data file - the ADS error number is stated. 04: Error: During reading of the data file it was determined that the file is too large (number of bytes larger than udi Max Data File Size) 05: File handling error: Writing to the log file - the ADS error number is stated. 06: File handling error: Closing the data file - the ADS error number is stated. 07: File handling error: Writing to the log file (OK message if no errors were detected) - the ADS error number is stated. 08: File handling error: Closing the log file - the ADS error number is stated. b Err Data Set: This output is set to TRUE, if the read data sets are faulty. Further details are entered in the log file. VAR_IN_OUT arr Shd Obj: ARRAY[1.. Param.ui Max Shd Obj] OF ST_BA_Shd Obj; arr Shd Obj: List of shading objects [} 561]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.14 FB_BA_Rol Bld Actr This function block is used to position a roller shutter over two outputs: up and down. The positioning telegram st Sun Bld [} 689] can be used to move the roller shutter to any position. In addition, the positioning telegram st Sun Bld [} 689] offers manual commands, which can be used to move the roller shutter to particular positions. These manual commands are controlled by the function block FB_BA_Sun Bld Swi [} 604]. Structure of the blind positioning telegram st Sun Bld [} 689]. TYPE ST_BA_Sun Bld: STRUCT r Pos : REAL; r Angl : REAL; b Man Up : BOOL; b Man Dwn : BOOL; b Man Mod : BOOL; TF8040 Version: 1.14.0 583
## Page 584

Programming b Actv : BOOL; END_STRUCT END_TYPE The current height position is not read in by an additional encoder; it is determined internally by the runtime of the roller shutter. The two runtime parameters udi Ti Up (roller shutter travel-up time [ms]) and udi Ti Dwn (roller shutter travel- down time [ms]) take account of the different movement characteristics. As a rule, the function block controls the roller shutter based on the information from the positioning telegram st Sun Bld [} 689]. If automatic mode is active (b Man Mod=FALSE), the roller shutter always moves to the current position; changes are reflected immediately. In manual mode (b Man Mod=TRUE), the roller shutter is controlled by the commands b Man Up and b Man Dwn. Referencing Safe referencing refers to a situation when the roller shutter is upwards-controlled for longer than its complete travel-up time. The position is then always "0". Since roller shutter positioning without encoder is always error-prone, it is important to use automatic referencing whenever possible: Whenever "0" is specified as the target position, the roller shutter initially moves upwards normally, based on continuous position calculation. Once the calculated position value 0% is reached, the output b Up continues to be held for the complete travel-up time + 5s. For reasons of flexibility there are now two possibilities to interrupt the referencing procedure: Until the calculated 0% position is reached, a change in position continues to be assumed and executed. Once this 0% position is reached, the roller shutter can still be moved with the manual "travel-down" command. These two sensible restrictions make it necessary for the user to ensure that the roller shutter is referenced safely whenever possible. After a system restart, the function block executes a reference run. Completion of the initial referencing is indicated through a TRUE signal at output b Init Ref Cmpl. The initial referencing can also be terminated through a manual "travel-down" command. VAR_INPUT b En : BOOL; st Sun Bld : ST_BA_Sunblind; udi Ti Up_ms : UDINT; udi Ti Dwn_ms : UDINT; b En: Enable input for the function block. As long as this input is TRUE, the actuator function block accepts and executes commands as described above. A FALSE signal on this input resets the control outputs b Up and b Dwn and the function block remains in a state of rest. st Sun Bld: Positioning telegram, see ST_BA_Sun Bld [} 689]. udi Ti Up_ms: Complete time for driving up [ms]. udi Ti Dwn_ms: Complete time for driving down in ms. b Up : BOOL; b Dwn : BOOL; r Actl Pos : REAL; b Ref : BOOL; udi Ref Ti_sec : UDINT; b Init Ref Compl : BOOL; b Busy : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING; b Up: Control output roller blind up. b Dwn: Control output roller blind down. r Actl Pos: Current position in percent. b Ref: The roller blind is referencing, i.e. the output b Up is set for the complete travel-up time + 5 s. Only a manual "down" command can move the roller blind in the opposite direction and terminate this mode. udi Ref Ti_sec: Referencing countdown display [s]. 584 Version: 1.14.0 TF8040
## Page 585

Programming b Init Ref Compl: Initial referencing process complete. b Busy: A positioning or a referencing procedure is in progress. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: The total travel-up or travel-down time (udi Ti Up_ms/udi Ti Dwn_ms) is zero. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.15 FB_BA_Shd Corr The function block is used to assess the shading of a group of windows on a facade. The function block FB_BA_Shd Corr calculates whether a window group lies in the shadow of surrounding objects. The result, which is output at the output b Grp Not Shdd, can be used to judge whether sun shading makes sense for this window group. The function block thereby accesses two lists, which are to be defined: • The parameters that describe the shading elements that are relevant to the facade on which the window group is located. This list of shading objects [} 561] is used as input variable arr Shd Obj for the function block, since the information is read only. • The data of the elements (window) of the facade in which the group to be regarded is located. This list of facade elements [} 561] is accessed via the IN/OUT variable arr Fcd Elem, since not only the window coordinates are read, but the function block FB_BA_Shd Corr also stores the shading information for each window corner in this list. In this way, the information can also be used in other parts of the application program. On the basis of the facade orientation (r Fcd Ortn), the direction of the sun (r Azm) and the height of the sun (r Elv), a calculation can be performed for each corner of a window to check whether this lies in a shaded area. A window group is considered to be completely shaded if all corners are shaded. In the northern hemisphere, the following applies for the facade orientation (looking out of the window): Line of sight Facade orientation North β=0° East β=90° South β=180° West β=270° The function block performs its calculations only if the sun is actually shining on the facade. Considering the drawing presented in the introduction, this is the case if: Facade orientation < azimuth angle < facade orientation + 180° TF8040 Version: 1.14.0 585
## Page 586

Programming In addition, a calculation is also not required, if the sun has not yet risen, i.e. the solar elevation is below 0°. In both cases the output b Fcd Sunlit is set to FALSE. The situation is different for the southern hemisphere. The following applies to the facade orientation (looking out the window): Line of sight Facade orientation South β=0° East β=90° North β=180° West β=270° The internal calculation or the relationship between facade and sunbeam also changes: 586 Version: 1.14.0 TF8040
## Page 587

Programming To distinguish between the situation in the northern and southern hemisphere, set the input parameter b South to FALSE (northern hemisphere) or TRUE (southern hemisphere) VAR_INPUT st Ti Actl : TIMESTRUCT; r Fcd Ortn : REAL; r Azm : REAL; r Elv : REAL; di Grp ID : DINT; b South : BOOL; arr Shd Obj : ARRAY[1.. Param.ui Max Shd Obj] OF ST_BA_Shd Obj; st Ti Actl: Input of the current time - local time in this case, since this time takes into account the shaded months. If the UTC time (or GMT) is used, the month may change in the middle of the day, depending on the location on the earth (see TIMESTRUCT). r Fcd Ortn: Facade orientation, see illustration above. r Azm: Direction of the sun at the time of observation [°]. r Elv: Solar altitude at the time of observation [°]. di Grp Id: Window group regarded. The group 0 is reserved here for unused window elements, see FB_BA_Fcd Elem Entry [} 565]. A 0-entry would lead to an error output (b Err=TRUE). The function block is then not executed any further and b Grp Not Shdd is set to FALSE. b South: FALSE: Calculations refer to conditions in the northern hemisphere - TRUE: In the southern hemisphere arr Shd Obj: List of shading objects [} 561]. VAR_OUTPUT b Grp Not Shdd : BOOL; b Fcd Sunlit : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING b Grp Not Shdd: Is TRUE as long as the window group is not calculated as shaded. b Fcd Sunlit: This output is set to TRUE if the sun is shining on the facade. See description above. TF8040 Version: 1.14.0 587
## Page 588

Programming b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: The index of the window group usi Grp Id under consideration is 0. 02: Error: An element of the facade list is invalid. This is specified in the error description s Err Descr as arr Fcd Elem[n Column,n Row]. VAR_IN_OUT arr Fcd Elem : ARRAY[1.. Param.ui Max Column Fcd, 1.. Param.ui Max Row Fcd] OF ST_BA_Fcd Elem; arr Fcd Elem: List of facade elements [} 561]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.16 FB_BA_Shd Obj Entry This function block serves for the administration of all shading elements in a facade, which are globally saved in a list of shading elements [} 561]. It is intended to facilitate the input of the element information - also with regard to the use of the visualization. A schematic representation of the objects with description of the coordinates is shown in Shading correction: Principles and definitions [} 546]. The shading elements are declared in the global variables: VAR_GLOBAL arr Shd Obj : ARRAY[1.. Param.ui Max Shd Obj] OF ST_BA_Shd Obj; END_VAR Each individual element arr Shd Obj[1] to arr Shd Obj [ui Max Shd Obj] carries the information for one shading element (ST_BA_Shd Obj [} 688]). This information consists of the selected type of shading (rectangle or sphere) and the respectively associated coordinates. For a rectangle, these are the corner points (r P1x, r P1y, r P1z), (r P2x, r P2y, r P2z), (r P3x, r P3y, r P3z) and (r P4x, r P4y, r P4z) for a sphere this are the center point (r Mx, r My, r Mz) and the radius r Rads. In addition, the phase of the shading can be defined via the inputs udi Beg Mth and udi End Mth, which is important in the case of objects such as trees that bear no foliage in winter. The function block thereby directly accesses the field of this information via the IN-OUT variable arr Shd Obj. 588 Version: 1.14.0 TF8040
## Page 589

Programming Note: The fact that the rectangle coordinates r P2x, r P2z, r P4x, r P4y, and r P4z are output values results from the fact that they are formed from the input parameters: r P2x = r P1x; r P2z = r P1z; r P4x = r P3x; r P4y = r P1y; r P4z = r P3z; That limits the input of a rectangle to the extent that the lateral edges stand vertically on the floor (r P2x = r P1x and r P4x = r P3x), that the rectangle has no inclination (r P2z = r P1z and r P4z = r P3z) and can only have a different height "upwards", i.e. in the positive y-direction (r P4y = r P1y). The function block is used in three steps: • Read • Change • Write Read Selection of the element from the list arr Shd Obj[i Id] is based on the entry at udi Id. A rising edge on b Rd reads the data. These values are assigned to the input and output variables of the function block. These are the input values r P1x, r P1y, r P1z, r P2y, r P3x, r P3y, r P3z, r Mx, r My, r Mz, r Rads and the object enumerator e Type and the output values r P2x, r P2z, r P4x, r P4y and r P4z. It is important here that the input values are not overwritten in the reading step. Hence, all values can initially be displayed in a visualization. Change In a next program step the listed input values can then be changed. If a rectangle is preselected at input e Type [} 685] via the value "e Object Type Tetragon", the output values r P2x, r P2z, r P4x, r P4y and r P4z result from the rectangle coordinates that were entered (see above). The values entered are constantly checked for plausibility. The output b Err indicates whether the values are valid (b Err=FALSE). If the value is invalid, a corresponding error message is issued at output s Err Descr. If a rectangle is defined, only the inputs r P1x, r P1y, r P1z, r P2y, r P3x, r P3y and r P3z have to be described; the inputs r Mx, r My, r Mz and r Rads do not have to be linked. For a sphere definition, only r Mx, r My, r Mz and r Rads have to be described; the rectangle coordinates can remain unlinked Write The parameterized data are written to the list element with the index udi Id upon a rising edge on b Wrt, regardless of whether they represent valid values or not. The element structure ST_BA_Shd Obj [} 688] therefore contains a plausibility bit b Vld, which forwards precisely this information to the function block FB_BA_Shd Corr [} 585] to prevent miscalculations. This approach is to be regarded only as a proposal. It is naturally also possible to parameterize the function block quite normally in one step and to write the values entered to the corresponding list element with a rising edge on b Wrt. VAR_INPUT udi Id : UDINT; b Rd : BOOL; b Wrt : BOOL; r P1x : REAL; r P1y : REAL; r P1z : REAL; r P2y : REAL; r P3x : REAL; r P3y : REAL; r P3z : REAL; r Mx : REAL; r My : REAL; r Mz : REAL; r Rads : REAL; udi Beg Mth : UDINT; udi End Mth : UDINT; e Type : E_BA_Shd Obj Type; TF8040 Version: 1.14.0 589
## Page 590

Programming udi Id: Index of the selected element. This refers to the selection of a field element of the array saved in the IN-OUT variable arr Shd Obj. The variable udi Id must not be zero! This is due to the field definition, which starts with 1. However, an incorrect input is recognized and displayed as such at b Err/s Err Descr. b Rd: The information of the selected element, arr Shd Obj[udi Id], is read into the function block with a positive edge at this input and assigned to the input variables r P1x to e Type and the output variables r P2x to r P4z. If data are already present on the inputs r P1x to e Type at this time, then the data previously read are immediately overwritten with these data. b Wrt: A positive edge writes the values applied to the inputs r P1x to e Type and the values determined and assigned to the outputs r P2x to r P4z to the selected field element arr Shd Obj[udi Id]. r P1x: X-coordinate of point 1 of the shading element (rectangle) [m]. r P1y: Y-coordinate of point 1 of the shading element (rectangle) [m]. r P1z: Z-coordinate of point 1 of the shading element (rectangle) [m]. r P2y: Y-coordinate of point 2 of the shading element (rectangle) [m]. r P3x: X-coordinate of point 3 of the shading element (rectangle) [m]. r P3y: Y-coordinate of point 3 of the shading element (rectangle) [m]. r P3z: Z-coordinate of point 3 of the shading element (rectangle) [m]. r Mx: X-coordinate of the center of the shading element (ball) [m]. r My: Y-coordinate of the center of the shading element (ball) [m]. r Mz: Z-coordinate of the center of the shading element (ball) [m]. r Rads: Radius of the shading element (ball) [m]. udi Beg Mth: Beginning of the shading period (month). udi End Mth: End of the shading period (month). e Type: Selected type of element: Rectangle or sphere (see E_BA_Shd Obj Type [} 685]). Remark about the shading period: The entries for the months may not be 0 or greater than 12, otherwise all combinations are possible. Examples: Start=1, End=1: shading in January. Start=1, End=5: shading from the beginning of January to the end of May. Start=11, End=5: shading from the beginning of November to the end of May (the following year). VAR_OUTPUT r P2x : REAL; r P2z : REAL; r P4x : REAL; r P4y : REAL; r P4z : REAL; b Err : BOOL; s Err Descr : T_MAXSTRING; r P2x: Calculated X-coordinate of point 2 of the shading element (rectangle) [m]. See "Note [} 588]" above. r P2z: Calculated Z-coordinate of point 2 of the shading element (rectangle) [m]. See "Note [} 588]" above. r P4x: Calculated X-coordinate of point 4 of the shading element (rectangle) [m]. See "Note [} 588]" above. r P4y: Calculated Y-coordinate of point 4 of the shading element (rectangle) [m]. See "Note [} 588]" above. r P4z: Calculated Z-coordinate of point 4 of the shading element (rectangle) [m]. See "Note [} 588]" above. 590 Version: 1.14.0 TF8040
## Page 591

Programming b Err: Result of the plausibility check for the values entered. For a rectangle, the internal angle is 360° and the points are in a plane in front of the facade under consideration. In the case of a ball the center must likewise lie in front of the facade and the radius must be greater than zero. s Err Descr: Contains the error description. Error description 01: Error: The input udi Id is outside the permissible limits 1..ui Max Shd Obj. 02 Error: The sum of the angles of the rectangle is not 360°. This means that the corners are not in the order P1, P2, P3 and P4 but rather P1, P3, P2 and P4. This results in a crossed-over rectangle. 03: Error: The corners of the square are not on the same level. 04: Error: The z-component of P1 is less than zero. This corner would thus lie behind the facade. 05: Error: The z-component of P3 is less than zero. This corner would thus lie behind the facade. 06: Error: P1 is equal to P2. The object entered is thus not a rectangle. 07: Error: P1 is equal to P3. The object entered is thus not a rectangle. 08: Error: P1 is equal to P4. The object entered is thus not a rectangle. 09: Error: P2 is equal to P3. The object entered is thus not a rectangle. 10: Error: P2 is equal to P4. The object entered is thus not a rectangle. 11: Error: P3 is equal to P4. The object entered is thus not a rectangle. 12: Error: The radius entered is zero. 13: Error: The z-component of the ball center is less than zero. This point would thus lie behind the facade. 14: Error: Error object type e Type - neither rectangle nor ball. 15: Error: Month input error. VAR_IN_OUT arr Shd Obj : ARRAY[1.. Param.ui Max Shd Obj] OF ST_BA_Shd Obj; arr Shd Obj: List of shading objects [} 561]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.17 FB_BA_Sun Bld Actr This function block is used for positioning of a louvered blind via two outputs: drive up and drive down. The blind can be driven to any desired (height) position and louvre angle via the positioning telegram st Sun Bld [} 689]. On top of that, the positioning telegram st Sun Bld [} 689] also contains manual commands with which the blind can be moved individually to certain positions. These manual commands are controlled by the function block FB_BA_Sun Bld Swi [} 604]. Structure of the blind positioning telegram st Sun Bld [} 689]. TF8040 Version: 1.14.0 591
## Page 592

Programming TYPE ST_BA_Sun Bld: STRUCT r Pos : REAL; r Angl : REAL; b Man Up : BOOL; b Man Dwn : BOOL; b Man Mod : BOOL; b Actv : BOOL; END_STRUCT END_TYPE The current height position and the louvre angle are not read in by an additional encoder, but determined internally by the travel time of the blind. The calculation is based on the following travel profile (regarded from the highest and lowest position of the blind): Downward travel profile: More detailed explanations of the terms "backlash" and "turning" are given here in the downward movement: The blind normally describes its downward movement with the louvre low point directed outwards, as in fig. 3). If the blind is in an initial position with the low point directed inwards (i.e. after the conclusion of an upward movement), then a certain time elapses after a new downward movement begins before the louvres start to turn from the "inward low point" to the "outward low point". During this time the louvre angle does not change; the blind only drives downward (fig.1 and fig. 2). This time is an important parameter for the movement calculation and is entered in the function block under udi Bck Lsh Ti Dwn_ms [ms]. Since it is not known at any point after a blind movement of any length whether backlash has already taken effect, the backlash of the downward movement or its travel time can be measured most reliably if the blind was first raised fully. A further important parameter is the time interval of the subsequent turning of the louvres from the "Outward low point" to the "Inward low point". This time should be entered as udi Turn Ti Dwn_ms [ms] at the function block. 592 Version: 1.14.0 TF8040
## Page 593

Programming Upward travel profile: More detailed explanations of the terms "backlash" and "turning" are given here in the upward movement: The circumstances are similar to the downward movement described above: The blind normally describes its upward movement with the louvre low point directed inwards, as in fig. 3). If the blind is in an initial position with the low point directed outwards (i.e. after the conclusion of a downward movement), then a certain time elapses after a new upward movement begins before the louvres start to turn from the "Outward low point" to the "Inward low point". During this time the louvre angle does not change; the blind only drives upward (fig. 1 and fig. 2). Also this time is an important parameter for the movement calculation and is entered in the function block under udi Bck Lsh Ti Up_ms [ms]. Since it is not known at any point after a blind movement of any length whether backlash has already taken effect, the backlash of the upward movement or its travel time can be measured most reliably if the blind was first driven fully downward. A further important parameter is the time interval of the subsequent turning of the louvres from the "Outward low point" to the "Inward low point". This time should be entered as udi Turn Ti Up_ms [ms] at the function block. Parameterization For the calculation of the (height) position and the louvre angle, the following times now have to be determined for both the upward and downward movement: • the travel time of the backlash (udi Bck Lsh Ti Up_ms / udi Bck Lsh Ti Dwn_ms [ms]) • the turning duration (udi Turn Ti Up_ms / udi Turn Ti Dwn_ms [ms]) • the total travel time (udi Ti Up_ms / udi Ti Dwn_ms [ms]) Furthermore the following are required for the calculation: • the highest louvre angle after turning upwards (r Angl Lmt Up [°]) • the lowest louvre angle after turning downwards (r Angl Lmt Dwn [°]) The louvre angle λ is defined by a notional straight line through the end points of the louvre to the horizontal. TF8040 Version: 1.14.0 593
## Page 594

Programming Functioning As a rule, the function block controls the blind based on the information from the positioning telegram st Sun Bld [} 689]. If automatic mode is active (b Man Mod=FALSE), then the current position and louvre angle are always driven to, wherein changes are immediately accounted for. The height positioning takes priority: First the entered height and afterwards the louvre angle are driven to. For reasons of the simplicity the position error due to the angle movement is disregarded. In manual mode (b Man Mod=TRUE), the blind is controlled by the commands b Man Up and b Man Dwn. An automatic movement command is triggered whenever a change from manual to automatic mode occurs. Referencing Secure referencing is ensured if the blind is driven upward for longer than its complete drive-up time. The position is then in any case "0" and the louvre angle is at its maximum. Since blind positioning without an encoder is naturally always susceptible to error, it is important to automatically reference as often as possible: each time the "0" position is to be driven to (the angle is unimportant), the blind initially drives upward quite normally with continuous position calculation. Once the calculated position value 0% is reached, the output b Up continues to be held for the complete travel-up time + 5 s. For reasons of flexibility, there are two ways to interrupt the referencing process: Until the calculated 0% position is reached, a change in position continues to be assumed and executed. Once this 0% position is reached, the blind can still be moved with the manual "travel-down" command. These two sensible limitations make it necessary for the user to ensure that the blind is securely referenced as often as possible. After a system restart, the function block executes a reference run. Completion of the initial referencing is indicated through a TRUE signal at output b Init Ref Cmpl. The initial referencing can also be terminated through a manual "travel-down" command. Target accuracy Since the function block determines the blind position solely via run times, the cycle time of the PLC task plays a crucial role for positioning accuracy. If the switching time for a louvre angle range of -70° to 10° is 1 second, for example, the accuracy at a cycle time of 50 ms is +/-4°. VAR_INPUT b En : BOOL; st Sunbld : ST_BA_Sun Bld; udi Ti Up_ms : UDINT; udi Ti Dwn_ms : UDINT; udi Turn Ti Up_ms : UDINT; udi Turn Ti Dwn_ms : UDINT; udi Bck Lsh Ti Up_ms : UDINT; udi Bck Lsh Ti Dwn_ms : UDINT; r Angl Lmt Up : REAL; r Angl Lmt Dwn : REAL; b En: Enable input for the function block. As long as this input is TRUE, the actuator function block accepts and executes commands as described above. A FALSE signal on this input resets the control outputs b Up and b Dwn and the function block remains in a state of rest. st Sunbld: Positioning telegram, (see ST_BA_Sun Bld [} 689]). 594 Version: 1.14.0 TF8040
## Page 595

Programming udi Ti Up_ms: Complete time for driving up [ms]. udi Ti Dwn_ms: Complete time for driving down [ms]. udi Turn Ti Up_ms: Time for turning the louvres in the upward direction [ms]. udi Turn Ti Dwn_ms: Time for turning the louvres in the downward direction [ms]. udi Bck Lsh Ti Up_ms: Time to traverse the backlash in the upward direction [ms]. This input is internally limited to a minimum value of 0. udi Bck Lsh Ti Dwn_ms: Time to traverse the backlash in the downward direction [ms]. This input is internally limited to a minimum value of 0. r Angl Lmt Up: Highest position of the louvres [°]. This position is reached once the blind has moved to the top position. The louvre angle λ, as defined above, is then typically greater than zero. r Angl Lmt Dwn: Lowest position of the louvres [°]. This position is reached once the blind has moved to the bottom position. The louvre angle λ, as defined above, is then typically less than zero. VAR_OUTPUT b Up : BOOL; b Dwn : BOOL; r Actl Pos : REAL; r Actl Angl : REAL; b Ref : BOOL; udi Ref Ti_sec : UDINT; b Init Ref Compl : BOOL; TF8040 Version: 1.14.0 595
## Page 596

Programming b Busy : BOOL; b Err : BOOL; s Err Desc : T_MAXSTRING; b Up: Control output for blind up. b Dwn: Control output for blind down. r Actl Pos: Current position in percent. r Actl Angl: Current louvre angle [°]. b Ref: The blind is referencing, i.e. the output b Up is set for the complete travel-up time + 5s. Only a manual "down" command can move the blind in the opposite direction and terminate this mode. udi Ref Ti_sec: Referencing countdown display [s]. b Init Ref Compl: Initial referencing process complete. b Busy: A positioning or a referencing procedure is in progress. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Desc: Contains the error description. Error description 01: Error: Up/Down timer = 0. 02: Error: Turning timer = 0. 03: Error: Louvre angle limits: The upper limit is less than or equal to the lower limit (r Angl Lmt Up<=r Angl Lmt Dwn). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.18 FB_BA_Sun Bld Evt This function block serves to preset the position and angle for any desired event. It can be used, for example, in order to drive to a parking position or to drive the blind upward for maintenance. The function is activated via the input b En. If this is the case, the active flag in the positioning telegram (b Actv in st Sun Bld) at output st Sun Bld [} 689] is set, and the values entered for the In/Out variables r Pos for the blind height [%] and r Angl the louvre angle [°] are passed on in this telegram. If the function is no longer active due to the resetting of b En, then the active flag in the positioning telegram st Sun Bld [} 689] is reset and the positions for height and angle are set to "0". The priority function block (e.g. FB_BA_Sun Bld Prio Swi4 [} 599]) enables a function with lower priority to take over the control by resetting. VAR_INPUT b En : BOOL; r Pos : REAL; r Angl : REAL; b En: A TRUE signal on this input activates the function block and transfers the entered setpoint values together with the active flag in the positioning telegram ST_BA_Sun Bld [} 689]. A FALSE signal resets the active flag again and sets position and angle to zero. r Pos: Height position of the blind [%] in case of activation. 596 Version: 1.14.0 TF8040
## Page 597

Programming r Angl: Louvre angle of the blind [°] in case of activation. VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; b Actv: Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 689] and is solely used to indicate whether the function block sends an active telegram. st Sun Bld: Output structure of the blind positions, see ST_BA_Sun Bld [} 689] Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.19 FB_BA_Sun Bld Ice Prtc The function block FB_BA_Sun Bld Ice Prtc deals with direction-independent anti-freezing. The weather protection has the highest priority in the blind controller (see overview [} 554]) and is intended to ensure that the blind is not damaged by ice or wind. Impending icing up is detected by the fact that, during precipitation detection at b Rain Sns, the measured outside temperature r Ots T is below the frost limit r Frst T. This event is saved internally and remains active until it is ensured that the ice has melted again. In addition, the outside temperature must have exceeded the frost limit value for the entered deicing time udi Deice Ti_sec [s]. For safety reasons the icing event is persistently saved, i.e. also beyond a PLC failure. Thus, if the controller fails during the icing up or deicing period, the blind is considered to be newly iced up when then the controller restarts and the deicing timer starts from the beginning again. If there is a risk of icing, the blind is moved to the protective position specified by r Pos Prot (height position in percent) and r Angl Prot (louvre angle [°]). VAR_INPUT b En : BOOL; r Ots T : REAL; b Rain Sns : BOOL; r Frst T : REAL; udi Deice Ti_sec : UDINT; r Pos Prot : REAL; r Angl Prot : REAL; b En: The function block has no function if this input is FALSE. In the positioning telegram ST_BA_Sunbld [} 689] 0 is output for the position and the angle, and b Actv is FALSE. This means that another function takes over control of the blind via the priority controller. r Ots T: Outside temperature [°C]. b Rain Sns: Input for a rain sensor. r Frst T: Icing up temperature limit value [°] Celsius. This value may not be greater than 0. Otherwise an error is output. TF8040 Version: 1.14.0 597
## Page 598

Programming udi Deice Ti_sec: Time until the deicing of the blind after icing up [s]. After that the icing up alarm is reset. r Pos Prot: Height position of the blind [%] in the case of protection. r Angl Prot: Louvre angle of the blind [°] in the case of protection. VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; b Ice Alm : BOOL; udi Rem Ti Ice Alm_sec : UDINT; st Sun Bld: Output structure of the blind positions, see ST_BA_Sun Bld [} 689]. b Actv: Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 689] and is solely used to indicate whether the function block sends an active telegram. b Ice Alm: Indicates the icing up alarm. udi Rem Ti Ice Alm_sec: In the case of impending icing up (b Ice Alm=TRUE), this second counter is set to the deicing time. As soon as the temperature lies above the frost point entered (r Frst T), the remaining number of seconds until the 'all-clear' signal is given (b Ice Alm=FALSE) are indicated here. This output is 0 as long as no countdown of the time is taking place. If an error occurs, this automatic control is deactivated, and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.20 FB_BA_Sun Bld Pos Dly This function block delays changes in position based on automatic commands. If an event, e.g. weather protection, results in too many blind drives being started at the same time, fuses may be triggered by motor starting current peaks. It is therefore advisable to start the blind drives slightly staggered, in order to avoid excessive total current values. This function block relays automatic commands from the input telegram st In [} 689] to the output telegram st Out [} 689] with a delay. A distinction is made between three cases 1. the blind position r Pos has changed in automatic mode (b Man Mode=FALSE in telegram st In) 2. the louvre angle r Angl has changed in automatic mode (b Man Mode=FALSE in telegram st In) 3. manual mode has just been exited, i.e. automatic mode has just become active (falling edge b Man Mode in telegram st In) The output telegram st Out is always a direct copy of the input telegram st In. In these three cases, however, the output telegram st Out is set for the time udi Dly_ms [ms]. This ensures that the blind controlled via the function block FB_BA_Sun Bld Actr [} 591] is kept at its position during the delay period. Each further change based on the criteria mentioned above within the delay time restarts the timer. 598 Version: 1.14.0 TF8040
## Page 599

Programming However, a change to manual in the input telegram (b Man Mode = TRUE) cancels the delay timer immediately. The (manual) telegram is passed on without delay. In this way, only automatic telegrams are delayed. Application Preferably directly before the blind actuator function block: VAR_INPUT st In : ST_BA_Sunblind; udi Dly_ms : UDINT; st In: Input positioning telegram, see ST_BA_Sun Bld [} 689]. udi Dly_ms: Delay time of the active bit in the positioning telegram [ms]. VAR_OUTPUT st Out : ST_BA_Sunblind; udi Rem Ti Dly_sec : UDINT; st Out: Output positioning telegram, see ST_BA_Sun Bld [} 689]. udi Rem Ti Dly_sec: Display output for elapsed delay time [s]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.21 FB_BA_Sun Bld Prio Swi4 The function block is used for priority control for up to 4 positioning telegrams (st Sun Bld_Prio1 ... st Sun Bld_Prio4) of type ST_BA_Sun Bld [} 689]. Structure of the blind positioning telegram ST_BA_Sunbld [} 689]. TYPE ST_BA_Sun Bld: STRUCT r Pos : REAL; r Angl : REAL; b Man Up : BOOL; b Man Dwn : BOOL; b Man Mod : BOOL; TF8040 Version: 1.14.0 599
## Page 600

Programming b Actv : BOOL; END_STRUCT END_TYPE Up to 4 positioning telegrams from different control function blocks can be applied to this function block. The telegram on st Sun Bld_Prio1 has the highest priority and that on st Sun Bld_Prio4 the lowest. The active telegram with the highest priority is output at the output st Sun Bld. "Active" means that the variable b Actv is set within the structure of the positioning telegram. This function block is to be programmed in such a way that one of the applied telegrams is always active. If no telegram is active, an empty telegram is output, i.e. r Pos=0, r Angl=0, b Man Up=FALSE, b Man Dwn=FALSE, b Man Mod=FALSE, b Actv=FALSE. Since the blind function block FB_BA_Sun Bld Actr [} 591] or the roller blind function block FB_BA_Rol Bld Actr [} 583] does not take account of the flag b Actv, this telegram would be interpreted as movement command to position "0", i.e. fully open. The absence of an active telegram therefore does not represent a safety risk for the blind. VAR_INPUT st Sun Bld_Prio1 : ST_BA_Sun Bld; st Sun Bld_Prio2 : ST_BA_Sun Bld; st Sun Bld_Prio3 : ST_BA_Sun Bld; st Sun Bld_Prio4 : ST_BA_Sun Bld; st Sun Bld_Prio1..st Sun Bld_Prio4: Positioning telegrams available for selection. st Sun Bld_Prio1 has the highest priority and st Sun Bld_Prio4 the lowest. VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; udi Actv Prio : UDINT; st Sun Bld: Resulting positioning telegram. udi Actv Prio: Active positioning telegram. If none is active, "0" is output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.22 FB_BA_Sun Bld Prio Swi8 The function block is used for priority control for up to 8 positioning telegrams (st Sun Bld_Prio1 ... st Sun Bld_Prio8) of type ST_BA_Sun Bld [} 689]. Structure of the blind positioning telegram ST_BA_Sunbld [} 689]. TYPE ST_BA_Sun Bld: STRUCT r Pos : REAL; r Angl : REAL; b Man Up : BOOL; b Man Dwn : BOOL; b Man Mod : BOOL; b Actv : BOOL; END_STRUCT END_TYPE 600 Version: 1.14.0 TF8040
## Page 601

Programming Up to 8 positioning telegrams from different control function blocks can be applied to this function block. The telegram on st Sun Bld_Prio1 has the highest priority and that on st Sun Bld_Prio8 the lowest. The active telegram with the highest priority is output at the output st Sun Bld. "Active" means that the variable b Actv is set within the structure of the positioning telegram. This function block is to be programmed in such a way that one of the applied telegrams is always active. If no telegram is active, an empty telegram is output, i.e. r Pos=0, r Angl=0, b Man Up=FALSE, b Man Dwn=FALSE, b Man Mod=FALSE, b Actv=FALSE. Since the blind function block FB_BA_Sun Bld Actr [} 591] or the roller blind function block FB_BA_Rol Bld Actr [} 583] does not take account of the flag b Actv, this telegram would be interpreted as movement command to position "0", i.e. fully open. The absence of an active telegram therefore does not represent a safety risk for the blind. VAR_INPUT st Sun Bld_Prio1 : ST_BA_Sun Bld; st Sun Bld_Prio2 : ST_BA_Sun Bld; st Sun Bld_Prio3 : ST_BA_Sun Bld; st Sun Bld_Prio4 : ST_BA_Sun Bld; st Sun Bld_Prio5 : ST_BA_Sun Bld; st Sun Bld_Prio6 : ST_BA_Sun Bld; st Sun Bld_Prio7 : ST_BA_Sun Bld; st Sun Bld_Prio8 : ST_BA_Sun Bld; st Sun Bld_Prio1..st Sun Bld_Prio8: Positioning telegrams available for selection. st Sun Bld_Prio1 has the highest priority and st Sun Bld_Prio8 the lowest. VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; udi Actv Prio : UDINT; st Sun Bld: Resulting positioning telegram. udi Actv Prio: Active positioning telegram. If none is active, "0" is output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.23 FB_BA_Sun Bld Scn This function block represents an extension of the manual controller FB_BA_Sun Bld Swi [} 604] by a scene memory and a call function. The blind control FB_BA_Sun Bld Actr [} 591] or the roller blind control FB_BA_Rol Bld Actr [} 583] can be active in manual mode and also directly target previously stored positions (scenes). Up to 21 scenes can be saved. Structure of the blind positioning telegram ST_BA_Sunbld [} 689]. TYPE ST_BA_Sun Bld: STRUCT r Pos : REAL; r Angl : REAL; b Man Up : BOOL; b Man Dwn : BOOL; TF8040 Version: 1.14.0 601
## Page 602

Programming b Man Mod : BOOL; b Actv : BOOL; END_STRUCT END_TYPE Operation In manual mode, the function block controls the blind function block FB_BA_Sun Bld Actr [} 591] or the roller shutter function block FB_BA_Rol Bld Actr [} 583] via the command inputs b Up and b Dwn; b Up has priority. The commands are passed on to the respective commands b Man Up and b Man Dwn of the positioning telegram. If a command input is activated that is longer than the entered time udi Swi Ovr Ti_ms [ms], then the corresponding control command latches. Activating a command input again releases this latch. A rising edge on b Sav Scn saves the current position and louvre angle in the scene selected in udi Slcd Scn . This procedure is possible at any time, even during active positioning. The selected scene is called with b Cl Scn, i.e. the saved position and angle values are driven to. If the function block is activated by input b En=TRUE, bit b Actv is set immediately in the positioning telegram. The function block uses this to notify a priority switch (FB_BA_Sun Bld Prio Swi4 [} 599] or FB_BA_Sun Bld Prio Swi8 [} 600]) of its priority over lower priorities. If the command "Call Scene" is not active (b Cl Scn =TRUE), the bit b Man Mod is also set in the positioning telegram to notify the connected actuator function blocks that they should respond to manual commands. If the function block is deactivated by b En=FALSE, both bits, b Actv and b Man Mod, are set to FALSE again. Linking to the blind function block Like the "normal" manual mode function block FB_BA_Sun Bld Swi [} 604], the scene selection function block can be connected either via an upstream priority control FB_BA_Sun Bld Prio Swi4 [} 599] or FB_BA_Sun Bld Prio Swi8 [} 600], or directly via the blind function block. The connection is established via the positioning telegram ST_BA_Sunbld [} 689]. Furthermore the scene function block requires the current positions from the blind function block for the reference blind: Use of a priority controller: Direct connection: 602 Version: 1.14.0 TF8040
## Page 603

Programming VAR_INPUT b En : BOOL; b Up : BOOL; b Dwn : BOOL; udi Swi Ovr Ti_ms : UDINT; udi Slcd Scn : UDINT; b Cl Scn : BOOL; b Sav Scn : BOOL; r Sp Pos : REAL; r Sp Angl : REAL; b En: The function block has no function if this input is FALSE. In the positioning telegram ST_BA_Sunbld [} 689], 0 is output for the position and the angle - b Man Mod and b Actv are FALSE. For a connection with priority controller this means that another functionality takes over control of the blind. Conversely, a direct connection allows the blind to drive directly to the 0 position, i.e. fully up, since the actuator function block does not evaluate the bit b Actv itself. b Up: Command input for blind up. b Dwn: Command input for blind down. udi Swi Ovr Ti_ms: Time [ms] until the corresponding manual command in the positioning telegram ST_BA_Sunbld [} 689] switches to latching mode, if the command input is activated permanently. Internally limited to a minimum value of 0. udi Slcd Scn: Selected scene which should either be saved (b Sav Scn) or called (b Cl Scn). Internally limited to a minimum value of 0 to c Max Sun Bld Scn. b Cl Scn: Call selected scene. b Sav Scn: Save selected scene. r Sp Pos: Set position [%] that is to be saved in the selected scene. This must be linked to the actual position of the actuator function block FB_BA_Sun Bld Actr [} 591] or FB_BA_Rol Bld Actr [} 583] of the reference blind/ roller shutter, in order to be able to save a position that was previously approached manually. Internally limited to values between 0 and 100. r Sp Angl: ditto. Louvre angle [°]. VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; r Actl Scn Pos : REAL; r Actl Scn Angl : REAL; st Sun Bld: Positioning telegram, see ST_BA_Sun Bld [} 689]. b Actv: Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 689] and is solely used to indicate whether the function block sends an active telegram. r Actl Scn Pos: Indicates the saved relative blind height position [%] for the currently selected scene. r Actl Scn Angl: ditto. Louvre angle [°]. If an error occurs, this automatic control is deactivated, and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. VAR_IN_OUT arr Sun Bld Scn : ARRAY[0.. Param.usi Max Sun Bld Scn] OF ST_BA_Sun Bld Scn; arr Sun Bld Scn: Table with the scene entries of the type ST_BA_Sun Bld Scn [} 690]. TF8040 Version: 1.14.0 603
## Page 604

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.24 FB_BA_Sun Bld Swi This function block can be used to control the blind FB_BA_Sun Bld Actr [} 591] or roller shutter FB_BA_Rol Bld Actr [} 583] in manual mode. The connection takes place via the positioning telegram ST_BA_Sunbld [} 689] either directly or with an additional priority controller. Structure of the blind positioning telegram ST_BA_Sunbld [} 689]. TYPE ST_BA_Sun Bld: STRUCT r Pos : REAL; r Angl : REAL; b Man Up : BOOL; b Man Dwn : BOOL; b Man Mod : BOOL; b Actv : BOOL; END_STRUCT END_TYPE Operation In manual mode, the function block controls the blind function block FB_BA_Sun Bld Actr [} 591] or the roller shutter function block FB_BA_Rol Bld Actr [} 583] via the command inputs b Up and b Dwn; b Up has priority. The commands are passed on to the respective commands b Man Up and b Man Dwn of the positioning telegram. If a command input is activated that is longer than the entered time udi Swi Ovr Ti_ms [ms], then the corresponding control command latches. Activating a command input again releases this latch. If the function block is activated by input b En=TRUE, bit b Actv is set immediately in the positioning telegram. The function block uses this to notify a priority switch (FB_BA_Sun Bld Prio Swi4 [} 599] or FB_BA_Sun Bld Prio Swi8 [} 600]) of its priority over lower priorities. At the same time, the bit b Man Mod is set in the positioning telegram to notify the connected actuator function blocks that they should respond to manual commands. If the function block is deactivated by b En=FALSE, both bits, b Actv and b Man Mod, are set to FALSE again. Linking to the blind function block The manual mode function block can be connected either via an upstream priority control FB_BA_Sun Bld Prio Swi4 [} 599] or FB_BA_Sun Bld Prio Swi8 [} 600], or directly at the blind function block. The connection is established via the positioning telegram ST_BA_Sunbld [} 689]. 604 Version: 1.14.0 TF8040
## Page 605

Programming Use of a priority controller: Direct connection: VAR_INPUT b En : BOOL; b Up : BOOL; b Dwn : BOOL; udi Swi Ovr Ti_ms : UDINT; b En: The function block has no function if this input is FALSE. In the positioning telegram ST_BA_Sunbld [} 689], 0 is output for the position and the angle - b Man Mod and b Actv are FALSE. For a connection with priority controller this means that another functionality takes over control of the blind. Conversely, a direct connection allows the blind to drive directly to the 0 position, i.e. fully up, since the actuator function block does not evaluate the bit b Actv itself. b Up: Command input for blind up. b Dwn: Command input for blind down. udi Swi Ovr Ti_ms: Time [ms] until the corresponding manual command in the positioning telegram ST_BA_Sunbld [} 689] switches to latching mode, if the command input is activated permanently. Internally limited to a minimum value of 0. VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; st Sun Bld: Positioning telegram, see ST_BA_Sun Bld [} 689]. b Actv: Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 689] and is solely used to indicate whether the function block sends an active telegram. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 605
## Page 606

Programming 6.1.2.3.2.1.2.3.25 FB_BA_Sun Bld Twi Lgt Auto This function block controls the blind when the outdoor brightness has fallen below a limit value. The automatic twilight function operates with both a value hysteresis and a temporal hysteresis: If the outdoor brightness value r Brtns [lux] falls below the value r Actv Val [lux] for the time udi Actv Dly_sec [s], the function block is active and will provide the blind positions r Pos Twi Lgt (height [%]) and r Angl Twi Lgt (louvre angle [°]) specified for the input variables at the output in the positioning telegram ST_BA_Sunbld [} 689]. If the outdoor brightness exceeds the value r Actv Val [lux] for the time udi Dctv Dly_sec [s], automatic mode is no longer active. The active flag in the positioning telegram ST_BA_Sunbld [} 689] is reset and the positions for height and angle are set to "0". A function with a lower priority can then take over control. VAR_INPUT b En : BOOL; r Brtns : REAL; r Actv Val : REAL; r Dctv Val : REAL; udi Actv Dly_sec : UDINT; udi Dctv Dly_sec : UDINT; r Pos Twi Lgt : REAL; r Angl Twi Lgt : REAL; b En: The function block has no function if this input is FALSE. In the positioning telegram ST_BA_Sunbld [} 689] 0 is output for the position and the angle, and b Actv is FALSE. This means that another function takes over control of the blind via the priority controller. r Brtns: Outdoor brightness [lx]. r Actv Val: Activation limit value [lx]. The value r Actv Val is internally limited to values from 0 to r Dctv Val. r Dctv Val: Deactivation limit value [lx]. Internally limited to a minimum value of 0. udi Actv Dly_sec: Activation delay [s]. Internally limited to a minimum value of 0. udi Dctv Dly_sec: Deactivation delay [s]. Internally limited to a minimum value of 0. r Pos Twi Lgt: Vertical position of the blind [%] if the automatic twilight function is active. Internally limited to values between 0 and 100. r Angl Twi Lgt: Louvre angle of the blind [°] if the automatic twilight function is active. VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; udi Rem Ti Actv_sec : UDINT; udi Rem Ti Dctv_sec : UDINT; st Sun Bld: Output structure of the blind positions, see ST_BA_Sun Bld [} 689]. b Actv: Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 689] and is solely used to indicate whether the function block sends an active telegram. udi Rem Ti Actv_sec: Shows the time remaining [s] after falling below the switching value r Actv Val until automatic mode is activated. This output is 0 as long as no countdown of the time is taking place. 606 Version: 1.14.0 TF8040
## Page 607

Programming udi Rem Ti Dctv_sec: Shows the time remaining [s] after exceeding of the switching value r Dctv Val until automatic mode is disabled. This output is 0 as long as no countdown of the time is taking place. If an error occurs, this automatic control is deactivated, and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.2.3.26 FB_BA_Sun Bld Wnd Prtc The function block FB_BA_Sun Bld Wnd Prtc deals with the direction-dependent wind protection. The weather protection has the highest priority in the blind controller (see overview [} 554]) and is intended to ensure that the blind is not damaged by ice or wind. If the measured wind speed is above the value r Wnd Spd Strm On for the time udi Dly Strm On_sec [s], it is assumed that high winds are imminent. The storm is regarded as having subsided, so that the blind can be moved safely, once the wind speed falls below the value r Wnd Spd Strm Off for the time udi Dly Strm Off_sec [s]. For safety reasons the storm event is also persistently saved. Thus, if the controller fails during a storm, the sequence timer is started again from the beginning when the controller is restarted. If there is a risk of high wind, the blind is moved to the protection position specified by r Pos Prot (height position in percent) and r Angl Prot (louvre angle [°]). VAR_INPUT b En : BOOL; r Wnd Spd : REAL; r Wnd Spd Strm On : REAL; r Wnd Spd Strm Off : REAL; udi Dly Strm On_sec : UDINT; udi Dly Strm Off_sec : UDINT; r Pos Prot : REAL; r Angl Prot : REAL; b En: The function block has no function if this input is FALSE. In the positioning telegram ST_BA_Sunbld [} 689] 0 is output for the position and the angle, and b Actv is FALSE. This means that another function takes over control of the blind via the priority controller. r Wnd Spd: Wind speed. The unit of entry is arbitrary, but it is important that no value is smaller than 0 and that the values become larger with increasing speed. r Wnd Spd Strm On: Wind speed limit value for the activation of the storm alarm. This value may be not smaller than 0 and must lie above the value for the deactivation. Otherwise an error is output. The unit of entry must be the same as that of the input r Wnd Spd. A value greater than this limit value triggers the alarm after the specified time udi Dly Strm On_sec. TF8040 Version: 1.14.0 607
## Page 608

Programming r Wnd Spd Strm Off: Wind speed limit value for the deactivation of the storm alarm. This value may be not smaller than 0 and must lie below the value for the activation. Otherwise an error is output. The unit of entry must be the same as that of the input r Wnd Spd. A value smaller than or equal to this limit value resets the alarm after the specified time udi Dly Strm Off_sec. udi Dly Strm On_sec: Time delay until the storm alarm is triggered [s]. udi Dly Strm Off_sec: Time delay until the storm alarm is reset [s]. r Pos Prot: Height position of the blind [%] in the case of protection. r Angl Prot: Louvre angle of the blind [°] in the case of protection. VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; b Strm Alm : BOOL; udi Rem Ti Strm Detc_sec : UDINT; udi Rem Ti Strm Alm_sec : UDINT; st Sun Bld: Output structure of the blind positions, see ST_BA_Sun Bld [} 689]. b Actv: Corresponds to the boolean value b Actv in the blind telegram ST_BA_Sun Bld [} 689] and is solely used to indicate whether the function block sends an active telegram. b Strm Alm: Indicates the storm alarm. udi Rem Ti Strm Detc_sec: In the non-critical case, this second counter continuously shows the alarm delay time udi Dly Strm On_sec. If the measured wind speed r Wnd Spd is above the activation limit value r Wnd Spd Strm On, the seconds to the alarm are counted down. This output is 0 as long as no countdown of the time is taking place. udi Rem Ti Strm Alm_sec: As soon as the storm alarm is initiated, this second counter initially constantly indicates the deactivation time delay of the storm alarm udi Dly Strm Off_sec. If the measured wind speed r Wnd Spd falls below the deactivation limit value r Wnd Spd Strm Off, the seconds to the all-clear signal (b Strm Alm=FALSE) are counted down. This output is 0 as long as no countdown of the time is taking place. If an error occurs, this automatic control is deactivated, and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 608 Version: 1.14.0 TF8040
## Page 609

Programming 6.1.2.3.2.1.2.3.27 FB_BA_Sun Prtc The function block is used for glare protection with the aid of a slatted blind. Glare protection is realized through variation of the louvre angle and positioning of the blind height. The louvre angle is set as a function of the sun position such that direct glare is prevented, while letting as much natural light through as possible. Three different operating modes are available for varying the blind height. 1. When sun protection is active, the blind moves to a fixed height. The height value is specified with the variable r Fix Pos. 2. The blind position is varied as a function of the sun position. The position is specified in the table (ST_BA_Bld Pos Tab [} 686]). See also description of FB_BA_Bld Pos Entry [} 561]. 3. The high of the blind is calculated based on the window geometry such that the sun's rays reach a specified depth in the room. The incidence depth of the sun's rays is defined with the variable r Max Lgt Indc. In order to avoid excessive repositioning of the louvre angle, the variable udi Pos Intval_min can be used to specify a time interval, within which the louvre angle is not adjusted. In order to avoid glare, the angle is always changed sufficiently for the respective time interval. The following conditions must be met for positioning the blind and setting the louvre angle. • 1. The input b En must be TRUE. • 2. The sun must have risen. (elevation > 0) • 3. The function block is parameterized correctly (b Err=FALSE) VAR_INPUT b En : BOOL; st UTC : TIMESTRUCT; udi Pos Intval_min : UDINT; r Deg Lngd : REAL; r Deg Latd : REAL; r Fcd Ortn : REAL; r Fcd Angl : REAL; r Lam Wdth : REAL; r Lam Dstc : REAL; r Fix Pos : REAL; r Max Lgt Indc : REAL; r Wdw Hght : REAL; r Dstc Wdw Fr : REAL; st Bld Pos Tab : ST_BA_Bld Pos Tab; e Pos Mod : E_BA_Pos Mod; TF8040 Version: 1.14.0 609
## Page 610

Programming b En: If this input is set to FALSE the positioning is inactive, i.e. the active bit (b Actv) is reset in the positioning structure st Sun Bld of the type ST_BA_Sunbld [} 689] and the function block itself remains in a standstill mode. If on the other hand the function block is activated, then the active bit is TRUE and the function block outputs its control values (r Pos, r Angl) in the positioning structure at the appropriate times. st UTC: Input of current time as coordinated world time (UTC - Universal Time Coordinated, previously referred to as GMT, Greenwich Mean Time) (see TIMESTRUCT). The function block FB_BA_Get Time [} 618] can be used to read this time from a target system. A jump of more than 300 seconds leads to immediate repositioning, if the blind is in the sun and glare protection is active, based on the above criteria. This functionality was added to ensure a reproducible program execution. udi Pos Intval_min: Positioning interval in minutes - time between two blind position outputs. Valid range: 1 min...720 min. r Deg Lngd: Longitude [°]. Valid range: - 180°...180°. r Deg Latd: Latitude [°]. Valid range: - 90°...90°. r Fcd Ortn: Facade orientation [°]: In the northern hemisphere, the following applies for the facade orientation (looking out of the window): Line of sight Facade orientation North β=0° East β=90° South β=180° West β=270° The following applies for the southern hemisphere: Line of sight Facade orientation South β=0° East β=90° North β=180° West β=270° r Fcd Angl: Facade inclination [°]. See facade inclination [} 559]. r Lam Wdth: Width of the louvres in mm, see Louvre adjustment [} 556]. r Lam Dstc: Louvre spacing in mm, see Louvre adjustment [} 556]. r Fix Pos: Fixed (constant) shutter height [0..100%]. Applies if e Pos Mod = e Pos Mod Fix (see enumerator E_BA_Pos Mod [} 685]). r Max Lgt Indc: Maximum desired light incidence in mm measured from the outside of the wall (see Height adjustment [} 558]). The parameters r Wdw Hght and r Dstc Wdw Flr are used to calculate how high the blinds must be, depending on the position of the sun, such that the incidence of light does not exceed the value r Max Lgt Indc. Applies if e Pos Mod = e Pos Mode Max Incidence (see enumerator E_BA_Pos Mod [} 685]). r Wdw Hght: Window height in mm for the calculation of the shutter height if the mode "maximum desired incidence of light" is selected. r Dstc Wdw Flr: Distance between the floor and the window sill in mm for the calculation of the shutter height if the mode "maximum desired incidence of light" is selected. st Bld Pos Tab: Table of 6 interpolation points, 4 of which are parameterizable, from which a blind position is then given in relation to the position of the sun by linear interpolation. Applies if e Pos Mod = e Pos Mod Fix (see enumerator E_BA_Pos Mod [} 685]). For a more detailed description please refer to FB_BA_Bld Pos Entry [} 561]. 610 Version: 1.14.0 TF8040
## Page 611

Programming e Pos Mod: Selection of the positioning mode, see enumerator E_BA_Pos Mod [} 685]. VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Actv : BOOL; b Err : BOOL; s Error Descr : T_MAXSTRING; st Sun Bld: Output structure of the blind positions, see ST_BA_Sun Bld [} 689] b Actv: The function block is in active state, i.e. no error is pending, the function block is enabled, and the sun position is in the specified facade area (the facade is sunlit). b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: The duration of the positioning interval is less than or equal to zero, or it exceeds 720 min. 02: Error: The longitude entered is not within the valid range from -180°..180°. 03: Error: The latitude entered is not within the valid range from -90°..90°. 04: Error: The value entered for the facade inclination r Fcd Angl is outside the valid range of -90°..90°. 05: Error: The value for the louvre spacing (r Lam Dstc) is greater than or equal to the value for the louvre width (r Lam Wdth). This does not represent a "valid" blind, since the louvres cannot close fully. Mathematically, this would lead to errors. 06: Error: The value entered for the louvre width r Lam Wdth is zero. 07: Error: The value entered for the louvre spacing r Lam Dstc is zero. 08: Error: The value entered for the fixed blind height (r Fix Pos) is greater than 100 or less than 0. At the same time, "fixed blind height" positioning is selected - e Pos Mod=e Pos Mod Fix. 09: Error: The bit "values valid" (b Vld) in the positioning table st Bld Pos Tab is not set - invalid values: see FB_BA_Bld Pos Entry. At the same time, "Table" positioning is selected - e Pos Mod=e Pos Mod Tab. 10: Error: The value entered for the maximum required light incidence r Max Lgt Indc is less than or equal to zero. At the same time, "maximum light incidence" is selected - e Pos Mod=e Pos Mod Max Indc. 11: Error: The value entered for the window height r Wdw Hght is less than or equal to zero. At the same time, "maximum light incidence" is selected - e Pos Mod=e Pos Mod Max Indc. 12: Error: The distance between lower window edge and floor r Dstc Wdw Flr that was entered is less than zero. At the same time, "maximum light incidence" is selected - e Pos Mod=e Pos Mod Max Indc. 13: Error: An invalid positioning mode is entered at input e Pos Mod. If an error occurs, this automatic control is deactivated, and the position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.3 Provision of hot water Function blocks Name Description FB_BA_DHW2P [} 612] Charge control for a hot water tank via an on-off controller. FB_BA_Lgl Prev [} 614] Function block for disinfecting service water and destroying legionella. TF8040 Version: 1.14.0 611
## Page 612

Programming 6.1.2.3.2.1.3.1 FB_BA_DHW2P This function block controls the heating of a hot water tank via an on-off controller. Tank heating is activated at input b En. If tank heating is active the output b Ld is TRUE. The variable r Sp is used to transfer the setpoint for the hot water temperature to the function block. At input r TMin a minimum selection of all temperature sensors for the hot water tank is connected, at input r TMax a maximum selection of all temperature sensors. Due to the thermal stratification in the hot water tank, the sensor at the top is generally the one showing the highest temperature, the one at the bottom the lowest. The tank can be charged in two ways via the variables b Kep Ful: b Kep Ful = FALSE Charging is requested if r TMax falls below the value of r Sp-r Sp Hys. The charge request is disabled if r TMin is above the setpoint of r Sp. Due to the fact that the sensor at the top generally measures the highest temperature, the heating is not switched on until the hot water tank has been discharged. b Kep Ful = TRUE Charging is requested if r TMin falls below the value of r Sp-r Sp Hys. The charge request is disabled once r TMin is above the setpoint again. Selecting the minimum of all tank temperatures ensures that the coldest point of the tank is used for control purposes. Recharging takes place when the tank is no longer full. 612 Version: 1.14.0 TF8040
## Page 613

Programming VAR_INPUT b En : BOOL; r Sp : REAL; r Sp Hys : REAL; r TMax : REAL; r TMin : REAL; b Kep Ful : BOOL; b En: Enable boiler charging. r Sp: Service water temperature setpoint [°C]. r Sp Hys: Hysteresis, recommended 1°K to 5°K. r TMax: Maximum selection of all tank temperatures [°C]. r TMin: Minimum selection of all tank temperatures [°C]. b Kep Ful: Control temperature selection: FALSE = r TMax is used to request b Ld, r TMin to switch off TRUE = r TMin alone controls switching on/off of b Ld VAR_OUTPUT b Ld : BOOL; r Sp Out : REAL; b Ld: Enable charging mode. r Sp Out: Setpoint transfer to charging circuit: • r Sp Out = r Sp (input) if the function block is enabled • r Sp Out = 0 if the function block is not enabled Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 613
## Page 614

Programming 6.1.2.3.2.1.3.2 FB_BA_Lgl Prev This function block is used for disinfection of the service water and for killing off Legionella. Disinfection mode is activated at input b En Lgl Prev via a timer program. It is advisable to run the disinfection at least once per week (during the night). The temperature should be at least 70 °C. The activation interval at b En Lgl Prev must be adequately long. The output b Ld activates tank heating. For hot water tanks with several temperature sensors, a minimum selection feature for all sensors must be connected at r TMin. If r TMin exceeds the value of r Sp, a monitoring timer is started with a time of udi Ti_sec [s]. If the minimum tank temperature r TMin remains above r Sp -r Sp Hys while the timer is active, the tank was heated adequately. If circulation is active, the output b Ld must be linked to enabling of the circulation pump, to ensure that the water pipe within the service water system is included in the disinfection. If the temperature has fallen below r Sp-r Sp Hys during the disinfection process, the process must be restarted and run until the time udi Ti_sec has fully elapsed. If the disinfection was successful, the output b Ld is reset. If the disinfection process was incomplete during the function block activation (b En Lgl Prev), this is indicated with the output b Alm. The output must be reset with b Rst. 614 Version: 1.14.0 TF8040
## Page 615

Programming Explanation of the diagram: t0 Start of the legionella program and switching of output b Ld. Heating of the hot water tank. t1 The tank has reached the temperature r Sp. The timer for the heating time is started. t2 The minimum tank temperature has fallen below r Sp -r Sp Hys. The timer for the heating time is reset. t3 The temperature exceeds r Sp again, and the heating timer is started again. t4 The Minimum tank temperature was above the limit r Sp-r Sp Hys over the period udi Ti_sec; the disinfection was successful. b Ld is reset, and the hot water tank switches back to normal operation. VAR_INPUT b En Lgl Prev : BOOL; r TMin : REAL; r Sp : REAL; r Sp Hys : REAL; udi Ti_sec : UDINT; b Rst : BOOL; b En Lgl Prev: Enabling of disinfection operation via a timer program. r TMin: Minimum tank temperature [°C]. Minimum selection of temperature sensors at the top and bottom. r Sp: Setpoint for disinfection [°C]. r Sp Hys: Temperature difference [K] lower limit; always calculated absolute. udi Ti_sec: Monitoring period [s]. b Rst: Resetting of the legionella alarm; VAR_OUTPUT b Ld : BOOL; r Sp Out : REAL; udi RTi : UDINT; udi Sta : UDINT; b Ld: Anti-legionella mode active. r Sp Out: Setpoint transfer to charging circuit: • r Sp (input) if the function block is enabled • 0 if the function block is not enabled udi RTi: Disinfection mode timer countdown. udi Sta: Disinfection program status: 1. The disinfection operation was successful. 2. The disinfection was completed successfully. After the disinfection, and to reactivate legionella prevention, b En Lgl Prev must be FALSE. 3. The disinfection operation is active. 4. Disinfection was not successful. Alarm is pending. 5. Disinfection was not successful, the alarm was acknowledged. 6. Controller restart, or legionella mode has not yet been requested. b Alm: The temperature setpoint was not reached consistently over via the interval udi Ti_sec, so that adequate disinfection is not guaranteed. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 615
## Page 616

Programming 6.1.2.3.2.1.4 System Function blocks Name Description FB_BA_Cnvt Ti St [} 616] Conversion year, month, day, hour, minute and second in time structure FB_BA_Ext Ti St [} 617] Conversion time structure in year, month, day, hour, minute and second FB_BA_Get Time [} 618] Internal clock with time information - can be synchronized with system time FB_BA_Set Time [} 620] Setting the system time FB_BA_Wrt Persist Dat [} 621] Writes persistent data 6.1.2.3.2.1.4.1 FB_BA_Cnvt Ti St The function block FB_BA_Cnvt Ti St can be used to consolidate the different components of a time structure. The function block does not check for incorrect entries, such as an hour entry of 99. It makes sense to check this in the connected function blocks, which have to check the time structure in any case. The limit values are shown as part of the variable explanations. VAR_INPUT w Year : WORD; w Month : WORD; w Day : WORD; w Hour : WORD; w Minute : WORD; w Second : WORD; w Milliseconds : WORD; w Year: The year (1970..2106). w Month: The month (1..12). w Day: The day of the month (1..31). w Hour: The hour (0..23). w Minute: The minutes (0..59). w Second s: The seconds (0..59). w Millisecond: The milliseconds (0..999). VAR_OUTPUT st Ti : TIMESTRUCT; st Ti: Output time structure (see TIMESTRUCT) 616 Version: 1.14.0 TF8040
## Page 617

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.4.2 FB_BA_Ext Ti St The function block FB_BA_Ext Ti St resolves a time structure into the different components, so that it can be used for time conditions, for example. VAR_INPUT st Ti : TIMESTRUCT; st Ti: Input time structure (see TIMESTRUCT) VAR_OUTPUT w Year : WORD; w Month : WORD; w Day Of Week : WORD; w Day : WORD; w Hour : WORD; w Minute : WORD; w Second : WORD; w Milliseconds : WORD; w Year: The year (1970..2106). w Month: The month (1..12). w Day Of Week: The day of the week (0(Sun)..0(Sat)). w Day: The day of the month (1..31). w Hour: The hour (0..23). w Minute: The minutes (0..59). w Second: The seconds (0..59). w Milliseconds: The milliseconds (0..999). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 617
## Page 618

Programming 6.1.2.3.2.1.4.3 FB_BA_Get Time With this function block an internal clock (Real Time Clock RTC) can be implemented in the Twin CAT PLC. When the function block is enabled via b En, the RTC clock is initialized with the current NT system time. One system cycle of the CPU is used to calculate the current RTC time. The function block must be called once per PLC cycle in order for the current time to be calculated. Within the function block, an instance of the function blocks NT_Get Time, FB_Get Time Zone Information and RTC_EX2 is called. The time is output at the outputs st Sys Ti for the read system time and st Utc for the Coordinated Universal Time (UTC). This is determined internally from the system time and the time zone. If the system time and/or the time zone was entered incorrectly, the UTC time will also be wrong. The system time is read cyclically via the timer to be set udi Upd RTC_sec [s]; it is used to synchronize the internal RTC clock. The time information (time zone, time shift relative to UTC, summer/winter time) is read in the same cycle. The output udi Rem Ti Upd_sec indicates the seconds remaining to the next read cycle. The time structures that are output, st Sys Ti and st Utc, can be resolved with the aid of the function block FB_BA_Ext Ti St [} 617] into the components day, month, hour, minute etc. Notes regarding read/wait cycle During the read cycle, the outputs b Rdy Sys Ti and b Rdy Ti Zo Info change to FALSE, and the enumerator e Ti ZId shows 0 = e Time Zone ID_Unknown. If the read operation was successful, the outputs switch back to TRUE or show the respective information for summer or winter time, if available. If the read operation was unsuccessful - internally the system waits for a response for 5 seconds - the outputs remain at FALSE or 0, and another wait cycle is started before the next read cycle. Although the internal RTC clock is not synchronized in the event of an error and may still show the right time, the time information may be wrong, and therefore also the UTC time. Errors during the read cycle will, any case, show up in b Err and s Err Descr. The countdown output udi Rem Ti Upd_sec is not restarted until the wait cycle starts. VAR_INPUT b En : BOOL; s Net Id : T_Ams Net Id;; udi Upd Rtc_sec : UDINT; b Upd Rtc : BOOL; b En: Enables the function block. If b En = TRUE, then the RTC clock is initialized with the NT system time. s Net Id: This parameter can be used to specify the Ams Net ID (see T_Ams Net Id) of the Twin CAT computer whose NT system time is to be read as timebase. If it is to be run on the local computer, an empty string can be entered. udi Upd Rtc_sec: Time specification [s] with which the RTC clock is regularly synchronized with the NT system time. Internally this value is limited to a minimum of 5 seconds, in order to ensure correct processing of the internal function blocks. b Upd Rtc: In parallel with the time udi Upd Rtc_sec, the RTC clock can be synchronized via a positive edge at this input. 618 Version: 1.14.0 TF8040
## Page 619

Programming VAR_OUTPUT b Rdy Sys Ti : BOOL; b Rdy Ti Zo Info : BOOL; b Rdy RTC : BOOL; udi Rem Ti Upd_sec : UDINT; st Sys Ti : TIMESTRUCT; st UTC : TIMESTRUCT; dt Sys Ti : DT; dt UTC : DT; udi Current Time_ms : UDINT e Ti ZId : E_Time Zone ID; b Err : BOOL; s Err Descr : T_MAXSTRING; b Rdy Sys Ti: The system time was read successfully from the target system. b Rdy Ti Zo Info: The additional time information (time zone, time shift relative to UTC and summer/winter time) was read successfully. b Rdy RTC: This output is set if the function block has been initialized at least once. If this output is set, then the values for date, time and milliseconds at the outputs are valid. udi Rem Ti Upd_sec: Countdown to next synchronization/update of the time information. st Sys Ti: System time of the read target system (see TIMESTRUCT). The time structure can be resolved with the aid of the function block FB_BA_Ext Ti St [} 617] into its components: day, month, hour, minute etc. If the function block is not enabled (b En=FALSE), the output st Sys Ti and its subelements (day month, etc.) show 0. st UTC: Coordinated world time (see TIMESTRUCT). This is determined internally from the system time and the time information read from the target system. The time structure can be resolved with the aid of the function block FB_BA_Ext Ti St [} 617] into its components: day, month, hour, minute etc. If the function block is not enabled (b En=FALSE), the output st UTC and its subelements (day month, etc.) show 0. dt Sys Ti / dt UTC: As st Sys Ti / st UTC, but in DATE-AND-TIME format: year-month-day-hours-minutes- seconds. Note: If the function block is not enabled (b En=FALSE), the outputs dt Sys Ti and dt UTC show DT#1970-01-01-00:00, since this is the lower limit, which corresponds to the zeros in the structure representation of st Sys Ti / st UTC. udi Current Time_ms: Current time of day in ms. e Ti ZId: Enumerator for summer/winter time information (see E_Time Zone ID). b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Warning: ADS error when reading the time (FB NT_Get Time). The ADS error number is stated. 02: Warning: ADS error when reading the time zone information (FB_Get Time Zone Information). The ADS error number is stated. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 619
## Page 620

Programming 6.1.2.3.2.1.4.4 FB_BA_Set Time The function block FB_BA_Set Time can be used to set the local NT system time and the date for a Twin CAT system (the local NT system time is shown in the taskbar). The system time is specified via the structure st Sys Ti. Internally, an instance of the function block NT_Set Local Time from the Tc Utilities library is called in the function block. The local NT system time can also be synchronized with a reference time with the aid of the SNTP protocol. For further information please refer to the Beckhoff Information System under: Beckhoff Information System > Embedded-PC > Operating systems > CE > SNTP: Simple Network Time Protocol VAR_INPUT b Set : BOOL; s Net Id : T_Ams Net Id; st Sys Ti : TIMESTRUCT; udi Ti Out_sec : UDINT; b Set: Activation of the function block with a rising edge. s Net Id: This parameter can be used to specify the Ams Net ID of the Twin CAT computer, whose local NT system time is to be set. An empty string s Net Id := ''; can also be specified for the local computer (see T_Ams Net Id). st Sys Ti: Structure with the new local NT system time (see TIMESTRUCT). If the time is not available as structure, it is advisable to use the function block FB_BA_Cnvt Ti St [} 616], which brings the subvariables of date and time in a structure together. udi Ti Out_sec: Indicates the timeout time [s], which must not be exceeded during execution. 620 Version: 1.14.0 TF8040
## Page 621

Programming VAR_OUTPUT b Busy : BOOL; b Error : BOOL; s Error Descr : T_MAXSTRING; b Busy: If the function block is activated via a rising edge at b Set, this output is set and remains set until feedback occurs. b Err: This output is set to TRUE, if either the system time to be transferred is incorrect or an ADS error occurs during the transfer. s Err Descr: Contains the error description. Error description 01: Error: Error: range exceeded year 02: Error: Error: range exceeded month 03: Error: Error: range exceeded day of the month 04: Error: Error: range exceeded hour 05: Error: Error: range exceeded minute 06: Error: Error: range exceeded second 07: Error: Error: range exceeded millisecond 08: Warning: An ADS error occurred while setting the time (FB NT_Set Local Time). The ADS error number is stated. Time specification limits The time structure st Utc Ti that was created is internally checked for limits (see TIMESTRUCT) Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.4.5 FB_BA_Wrt Persist Dat When activated, the function block FB_BA_Wrt Persist Dat first saves the persistent data in the Port_xxx.bootdata file. It is not necessary to explicitly specify the port or runtime system at which the PLC is located; this is determined internally. Once the data has been written, the content of the file Port_xxx.bootdata is copied to the backup file Port_xxx.bootdata-old. Thus both files are always synchronized. In case the original file with the persistent data is not readable, the backup copy, which is then read, contains the same data. In any case, the checkmark "Clear Invalid Persistent Data" must be removed (see Description of persistent data handling under Twin CAT 3 [} 622]) The function block can be started in two ways: Via a positive edge at input b Stt, if the function block is not in the set start-up phase. Initially once the start-up phase is completed after a reset or Twin CAT restart. The duration is set at udi Init Stt Dly_sec in seconds. If "0" is entered there, the duration of the start-up phase is 0 and an initial execution of the function block is skipped. TF8040 Version: 1.14.0 621
## Page 622

Programming No commands are accepted at b Stt during the start-up phase. If errors occur while reading, writing, opening or closing the files, this is indicated by a corresponding error message at b Err/s Err Descr. After an internally fixed waiting time of two seconds, the function block automatically attempts to execute the command (read, write, open or close) again. It is therefore advisable to keep an eye on the error outputs or to evaluate them. It is also important to note whether the backup file for the persistent data was loaded during the Twin CAT restart or after a reset. This indicates that the original file cannot be read and that the memory card of the controller is defective. It can be queried for each runtime system with the Boolean assignment of Twin CAT_System Info Var List._App Info. Old Boot Data (see Plc App System Info). Sample in ST: Sample in CFC: NOTICE File handle conflict Make sure that only this function block and only one instance of it accesses the persistent data. If several function blocks open a file and do not close it again, unforeseen file handle conflicts can occur which cannot be intercepted. The persistent data will then no longer be updated in the xxx.bootdata file. Description of persistent data handling under Twin CAT 3 Twin CAT saves the persistent data for each runtime system in a file during each orderly shutdown, i.e. when switching from Run to Config or Stop mode. The file name consists of the ADS port name of the runtime system with the file extension .bootdata, e.g.: Port_851.bootdata and is stored in the Twin CAT directory under Twin CAT\3.1\Boot\PLC. When the system is restarted, i.e. when switching to run mode, this file is read and then saved as Port_xxx.bootdata-old. If the file Port_xxx.bootdata-old already exists, it is overwritten. The original file Port_xxx.bootdata then no longer exists. It is created again automatically when switching to Stop mode or by the function block FB_Write Persistent Data from the TC2_Utilities library. This behavior applies to each runtime system; each system has its own files with persistent data. If the file is defective when the Twin CAT system is restarted, the system automatically accesses the backup file Port_xxx.bootdata-old. However, this behavior only applies if the Clear Invalid Persistent Data checkmark is unchecked in the runtime settings. If it is checked and the original file is defective, no data will be read. 622 Version: 1.14.0 TF8040
## Page 623

Programming The Port_xxx.bootdata-old backup file is also used when the controller is de-energized. In this case, too, the current persistent data is not stored in Port_xxx.bootdata. When the system is restarted, only the old data is available, unless a more up-to-date file was created by the FB_Write Persistent Data function block before the system was switched off. TF8040 Version: 1.14.0 623
## Page 624

Programming VAR_INPUT b Stt : BOOL; udi Init Stt Dly_sec : UDINT; b Stt: A rising edge at this input starts the function block if it is not in the start-up phase. 624 Version: 1.14.0 TF8040
## Page 625

Programming udi Init Stt Dly_sec: Start-up phase after a reset or Twin CAT restart. The duration is set in seconds. Once the start-up phase has elapsed, the function block is automatically started once. No commands are accepted at b Stt during the start-up phase. If "0" is set at udi Init Stt Dly_sec, the start-up phase is skipped. This input is preconfigured with 10 s. VAR_OUTPUT b Busy : BOOL; udi Rem Ti Init Stt Dly_sec : UDINT; b Err : BOOL; s Err Descr : T_Max String; b Busy: The function block is being executed. udi Rem Ti Init Stt Dly_sec: Countdown of the set startup phase. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: The number of the ADS port issued by the PLC is "0“ 02: Warning: Error when writing the persistent data via the internal function block FB_Write Persistent Data. Additionally its error number. 03: Warning: Error when opening the backup file (xxx.bootdata-old) via the internal function block FB_File Open. Additionally its error number. 04: Warning: Error when reading the original file (xxx.bootdata) via the internal function block FB_File Read. Additionally its error number 05: Warning: Error when writing to the backup file (xxx.bootdata-old) via the internal function block FB_File Write. Additionally its error number. 06: Warning: Error when closing the original file (xxx.bootdata) via the internal function block FB_File Close. Additionally its error number. 07: Warning: Error when closing the backup file (xxx.bootdata-old) via the internal function block FB_File Close. Additionally its error number. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5 Universal 6.1.2.3.2.1.5.1 Actuators Function blocks Name Description FB_BA_Actuator_3Point [} 626] Control of three-point dampers or valves FB_BA_Anlg3Pnt [} 627] Analog value for three-point converters FB_BA_Ant Blkg [} 628] Blocking protection for pump or actuators FB_BA_Motor1St [} 629] Control of single-speed drives FB_BA_Motor2St [} 630] Control of two-speed drives FB_BA_PWM [} 631] Pulse width modulation function block TF8040 Version: 1.14.0 625
## Page 626

Programming 6.1.2.3.2.1.5.1.1 FB_BA_Actuator_3Point The function block is used to control a 3-point actuator, e.g. a 3-point flap or a 3-point valve. The command for opening the actuator is connected to output b Open. The command for closing the actuator is connected to output b Close. In automatic mode (udi Op Mode=0) the control commands of b Cmd Open and b Cmd Close are forwarded directly to the outputs b Open and b Close. The udi Op Mode input is used to determine the operating mode of the 3-point actuator: • 0 = Automatic • 1 = Stop (b Open = b Close = FALSE) • 2 = Close • 3 = Open VAR_INPUT b En : BOOL; b Auto Open : BOOL; b Auto Close : BOOL; udi Op Mode : UDINT b En: General enable of the function block. b Auto Open: Command to open the actuator. b Auto Close: Command to close the actuator. udi Op Mode: Select operating mode (0 = Automatic, 1 = Stop (b Open = b Close = FALSE), 2 = Close, 3 = Open) VAR_OUTPUT b Open : BOOL; b Close : BOOL; b Open: Open control output. b Close: Close control output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 626 Version: 1.14.0 TF8040
## Page 627

Programming 6.1.2.3.2.1.5.1.2 FB_BA_Anlg3Pnt The function block is intended for control of three-point actuators for valves or dampers. A continuous control signal for positioning an actuator is converted into binary commands for opening and closing. If the deviation between the set position value r In and the calculated actual position value r Pos of the actuator exceeds the set threshold value r Hys/2, the function block starts to correct the position by switching the outputs b Opn or b Cls, depending on the magnitude of the control deviation: b Opn b Cls r In - r Pos > r Hys/2 TRUE FALSE r In - r Pos < - r Hys/2 FALSE TRUE If the function block reaches an end position r Out=0 or r Out=100 through a corresponding input value r In, the corresponding switching output remains permanently set in order to safely reach this end position at the valve or damper: b Opn b Cls r Out = 0 FALSE permanently TRUE r Out = 100 permanently TRUE FALSE Any deactivation of the continuous signal must be implemented by the user through external programming. The input r In is automatically limited to the range 0..100% internally. This also applies to the entries r Hys and r Ref Val. The travel times udi Ti Cls_ms and udi Ti Opn_ms both have a lower limit value of 10 (milliseconds). A rising edge at b Ref triggers a referencing command (the calculated actual position is set to r Ref Val). If the drive has limit switches, they can be sampled directly via the digital input and used for referencing at b Ref. VAR_INPUT r In : REAL; r Hys : REAL; udi Ti Cls_ms : UDINT; udi Ti Opn_ms : UDINT; b Ref : BOOL; r Ref Val : REAL; b Close Init : BOOL; r In: Setpoint for the actuator position [0 - 100%]. Internally limited to values between 0 and 100. r Hys: Hysteresis for the actuator position [0 - 100%]. Internally limited to values between 0 and 100. udi Ti Cls_ms: Run time of the actuator from open to closed [ms]. Internally limited to values between 0 and 100. udi Ti Opn_ms: Run time of the actuator from closed to open [ms]. Internally limited to values between 0 and 100. b Ref: Edge references the internal position memory of the drive to value of r Ref Val [0 - 100%]. TF8040 Version: 1.14.0 627
## Page 628

Programming r Ref Val: Value for referencing the actuator with b Ref [0 - 100%]. Internally limited to values between 0 and 100. b Close Init: If this input is TRUE, output b Cls is TRUE for the time udi Ti Opn_ms VAR_OUTPUT b Cls : BOOL; b Opn : BOOL; r Pos : REAL; b Cls: Output for closing the actuator. b Opn: Output for opening the actuator. r Pos: Current calculated actuator position [0 - 100%]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.1.3 FB_BA_Ant Blkg This function block prevents pumps or actuators from blocking after long periods without movement by outputting a switch-on pulse. The maximum duration of the standstill until a pulse is output is determined by the value of udi Ti Off Min_sec. For logging the idle time, the input b Fdb must be linked to the operating feedback from the aggregate. The length of the pulse is parameterized with udi Ti Impl Lngt_sec. The input b Exe should be used if the anti- blocking protection pulses are to be issued cyclically based on a schedule, rather than depending on the idle times. A rising edge at b Exe immediately triggers output of a pulse to b Q. Generally, a pulse output only occurs if the function block at b En is enabled. VAR_INPUT b En : BOOL; b Fdb : BOOL; b Exe : BOOL; udi Ti Off Min_sec : UDINT; udi Ti Impl Lngt_sec : UDINT; b En: Enable of the function block. b Fdb: Input for connecting the feedback signal of a motor or valve. b Exe: Rising edge forces a pulse output. udi Ti Off Min_sec: Minimum switch-off time [s]: a pulse is issued once the time udi Ti Off Min_sec has elapsed without movement of the aggregate. udi Ti Impl Lngt_sec: Length of the anti-blocking protection pulse [s] at b Q. VAR_OUTPUT b Q : BOOL; udi RTi Off Min_sec : UDINT; udi RTi Impl Lngt_sec : UDINT; b Q: Pulse output. 628 Version: 1.14.0 TF8040
## Page 629

Programming udi RTi Off Min_sec: Remaining time [s] before the next pulse is issued in the absence of movement. udi Ti Impl Lngt_sec: Remaining residual time [s] of the pulse at b Q. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.1.4 FB_BA_Motor1St Function block for controlling a simple single-stage motor. The input b En is used for general enabling of the motor. The input udi Op Mode is used to set the operating mode of the motor: • 0 = Automatic • 1 = Manual off • 2 = Manual on In automatic mode (udi Op Mode= 0) the motor can be operated via the input b Auto (b Auto = b Q = TRUE). The collection of all possible malfunctions of a motor is connected to b Dst. VAR_INPUT b En : BOOL; b Auto : BOOL; b Dst : BOOL; udi Op Mode : UDINT; b En: Enable motor. b Auto: Request of the actuator in automatic mode (udi Op Mode = 0). b Dst: Input for collecting the possible motor malfunctions. udi Op Mode: Select the operating mode (0 = Automatic, 1 = Manual off, 2 = Manual on). VAR_OUTPUT b Q : BOOL; b Q: Control output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 629
## Page 630

Programming 6.1.2.3.2.1.5.1.5 FB_BA_Motor2St Function block for controlling a simple two-stage motor. The input b En is used for general enabling of the motor. The input udi Op Mode is used to set the operating mode of the motor: • 0 = Automatic • 1 = Manual off • 2 = Manual stage 1 • 3 = Manual stage 2 In automatic mode (udi Op Mode= 0) the desired stage can be set via the inputs b Auto St1 (stage 1) and b Auto St2 (stage 2. The collection of all possible malfunctions of a motor is connected to b Dst. VAR_INPUT b En : BOOL; b Auto St1 : BOOL; b Auto St2 : BOOL; b Dst : BOOL; udi Op Mode : UDINT; b En: Enable motor. b Auto St1: Request of the actuator at stage 1 in automatic mode (udi Op Mode= 0). b Auto St2: Request of the actuator at stage 2 in automatic mode (udi Op Mode= 0). b Dst: Input for collecting the possible motor malfunctions. udi Op Mode: Select the operating mode (0 = Automatic, 1 = Manual off, 2 = Manual stage 1, 3 = Manual stage 2). VAR_OUTPUT b Q1 : BOOL; b Q2 : BOOL; b Q1: Control output stage 1. b Q2: Control output stage 2. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 630 Version: 1.14.0 TF8040
## Page 631

Programming 6.1.2.3.2.1.5.1.6 FB_BA_PWM The function block calculates switch-on and switch-off times rr Act Ti On_sec and r Act Ti Off_sec [s] from an analog input signal r In (0..100%, internally limited) and the period udi Prd_sec [s]. The following relationships apply: • 100% at the input of a switch-on time r Act Ti On_sec of the total period udi Prd_sec and a switch-off time r Act Ti Off_sec of 0 s • 0% at the input of a switch-on time r Act Ti On_sec of 0 s and a switch-off time r Act Ti Off_sec of the total period udi Prd_sec. In addition, udi Min Swi Ti_sec [s] can be used to set a lower limit for the switching time, in order to prevent damage to drives caused by too short actuating pulses. This behavior is only valid for 0>r In>100! If r In=0 or 100, the output b Q remains deleted or set. After the period time has elapsed, the current input signal is evaluated again. If it is still set to 0 or 100, there is no change of state of b Q. Switching characteristics 1. A FALSE signal at input b En disables the function block and sets b Q to FALSE. Only the switch-on and switch-off times are continuously calculated and displayed at the outputs r Act Ti On_sec/ r Act Ti Off_sec [s]. 2. A rising edge at input b En enables the function block: It will initially jump to a decision step. Depending on the previous state of the switching output b Q, the switching step is now accessed. However, if the input r In is set to 0, an immediate jump occurs to the Off step (b Q=FALSE), or to the On step if r In=100 (b Q=TRUE), irrespective of the previous state of b Q. The minimum switching time is deactivated for these two cases. 3. A countdown timer with the current calculated starting value runs in the respective active step (ON or OFF), which is based on the pulse/pause ratio. The on- or off-step is completed with the calculated time, irrespective of whether the pulse/pause ratio changes in the meantime. The respective countdown is displayed at the outputs udi Rem Ti On_sec/udi Rem Ti Off_sec in full seconds. 4. Completion of the on- or off-step is followed by a jump back to the decision step (point 2). VAR_INPUT b En : BOOL; r In : REAL; udi Prd_sec : UDINT; udi Min Swi Ti_sec : UDINT; b En: Activation of pulse width modulation. r In: Input signal, internally limited to 0..100%. udi Prd_sec: Period time[s]. Internally limited to a minimum value of 0. udi Min Swi Ti_sec: Minimum switch-on time [s], to avoid too short pulses. Internally limited to values between 0 and udi Prd_sec.. VAR_OUTPUT b Q : BOOL; b Lmt Swi Ti : BOOL; r Act Ti On_sec : REAL; r Act Ti Off_sec : REAL; udi Rem Ti On_sec : UDINT; udi Rem Ti Off_sec : UDINT; TF8040 Version: 1.14.0 631
## Page 632

Programming b Q: PWM output. b Lmt Swi Ti: Information output to indicate that the input signal is so low that the minimum switch-on time is used as limit. r Act Ti On_sec: Information output: Calculated switch-on time. r Act Ti Off_sec: Information output: Calculated switch-off time. udi Rem Ti On_sec: Switch-on timer countdown. udi Rem Ti Off_sec: Switch-off timer countdown. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.2 Analog inputs/outputs Function blocks Name Description FB_BA_AI [} 632] Acquisition of analog input signals FB_BA_AO [} 635] Control of analog actuators with integrated scaling function FB_BA_KL32xx Config Parameterization of the connected sensor type on an input channel from the PLC 6.1.2.3.2.1.5.2.1 FB_BA_AI The function block is used for measured data processing and terminal configuration of all standard K-bus analog input terminals. Terminal configuration The first step when using this function block is to select the corresponding terminal type e Terminal. Correct functioning of the function block is only guaranteed if the terminal selected with the e Terminal variable matches the terminal actually inserted and linked. With the terminals for resistance temperature measurement of type KL3208_0010 and KL320x_0000, the 632 Version: 1.14.0 TF8040
## Page 633

Programming temperature sensor used at the terminal input is additionally selected with the enumeration e Sensor. A rising edge at b Configurate writes the terminal settings to the terminal using the variables TO_usi Ctrl and TO_i Data Out. Measured value scaling At the analog input terminals of types: KL300x, KL306x, KL3132_0000, KL3162_0000, KL3172_0000, KL3172_0500, KL3172_1000, KL3182_0000, KL3404, KL3464, KL3408, KL3468, the raw value TI_i Data In of the terminal is scaled by the internal function block FB_BA_Chrct02 [} 670]. (See diagram). The parameterization of the scaling function is carried out using parameters X(01/02) and Y(01/02). A signal offset that may be required for measured value correction can be parameterized with the variable r Offset. r Smoothing Factor attenuates the scaled measurement signal, including the offset. Signal flow: Scaling: With the temperature measurement terminals of types KL3208_0010 and KL320x_0000, the measuring signal is not scaled within the function block, but directly in the terminal. Attenuation of excessively fluctuating measuring signals takes place with the factor r Smoothing Factor. If an error is detected at the terminal, such as b Short Circuit or b Wire Brake, the last valid value is output until the error is eliminated at the output of the function block. Signal flow: TF8040 Version: 1.14.0 633
## Page 634

Programming Measuring range monitoring The variables r High Limit and r Low Limit are used to monitor the measured value r Val at the output of the function block for compliance with a valid range. If the measured value r Val is above r High Limit or below r Low Limit, this is displayed at the outputs b High Limit or b Low Limit. Measuring range monitoring is deactivated if the input variable b En Limit Ctrl is FALSE or if an error (e.g. short circuit) is detected by means of the terminal status TI_usi State. The response of the measuring range monitoring can be delayed by the variable udi Delay Limit Ctrl_sec. VAR_INPUT TI_usi State : USINT; TI_i Data In : INT; e Terminal : E_BA_TERMINAL_KL; e Sensor : E_BA_SENSOR; b Configurate : BOOL; r X01 : REAL; r X02 : REAL; r Y01 : REAL; r Y02 : REAL; r Offset : REAL; r Smoothing Factor : REAL; udi Decimal Place : UDINT(1..6); b En Limit Ctrl : BOOL; r High Limit : REAL; r Low Limit : REAL; udi Delay Limit Ctrl_sec : UDINT; TI_usi State: Linking with the corresponding status byte of the Bus Terminal in the I/O area of the program. TI_i Data In: Linking with the corresponding raw data (Data In) of the Bus Terminal in the I/O area of the program (0..32767). e Terminal: Selection of the respective Bus Terminal (see E_BA_Terminal_KL). e Sensor: Selection of the sensor type (see E_BA_Sensor). b Configurate: A rising edge starts the configuration of the Bus Terminal. r X01: x-value for the interpolation point P1. r X02: x-value for the interpolation point P2. r Y01: y-value for the interpolation point P1. r Y02: y-value for the interpolation point P2. r Offset: Offset. r Smoothing Factor: attenuation factor. Internally limited to between 1 and 10000. udi Decimal Place: Specifies the decimal places for the value r Val. Preset to 1. b En Limit Ctrl: Enable limit value monitoring. r High Limit: Upper limit value. r Low Limit: Lower limit value. udi Delay Limit Ctrl_sec: Time delay until limit value monitoring is activated. 634 Version: 1.14.0 TF8040
## Page 635

Programming VAR_OUTPUT TO_usi Ctrl : USINT; TO_i Data Out : INT; r Val : REAL; b Wire Break : BOOL; b Short Circuit : BOOL; b High Limit : BOOL; b Low Limit : BOOL; b Err : BOOL; s Err Descr : T_MAXSTRING; TO_usi Ctrl: Linking with the corresponding control byte of the Bus Terminal in the I/O area of the program. TO_i Data Out: Linking with the corresponding raw data (Data Out) of the Bus Terminal in the I/O area of the program. r Val: Scaled output value. b Wire Break: Broken wire at the sensor. b Short Circuit: Short-circuit at the sensor. b High Limit: Upper limit value exceeded. b Low Limit: Value below lower limit. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: Incorrect scaling parameter r X01/r X02/r Y01/r Y02 02: Error: Check the terminal configuration KL32xx e Terminal/e Sensor/TI_usi State/TI_i Data In/TO_usi Ctrl/ IO_i Data Out Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.2.2 FB_BA_AO The function block FB_BA_AO is used for output and scaling of an analog output. The input value at r X is converted into an output value from 0 to 32767 or 0-10 Volt or 4-20 m A by means of a linear equation. TF8040 Version: 1.14.0 635
## Page 636

Programming The operating mode is set via the input udi Op Mod: • 0 = Automatic • 1 = Manual In automatic mode (udi Op Mod= 0) the input value r X is passed on. In manual mode (udi Op Mod= 1) the input value r XManual is passed on. VAR_INPUT r X : REAL; r X01 : REAL; r X02 : REAL; r Y01 : REAL; r Y02 : REAL; udi Op Mod : UDINT(0..1); r XManual : REAL; r X: Input value of the process in automatic mode. r X01: x-value for the interpolation point P1. r X02: x-value for the interpolation point P2. r Y01: y-value for the interpolation point P1. r Y02: y-value for the interpolation point P2. udi Op Mod: Selection of the operating mode (0 = Automatic, 1 = Manual). r XManual: Input value for manual operation. VAR_OUTPUT r Y : REAL; TO_i Y : INT; 636 Version: 1.14.0 TF8040
## Page 637

Programming r Y: Output signal as floating point number. TO_i Y: Output signal as integer value for linking to the output value of the bus terminal in the I/O section of the program. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.3 General control functions Function blocks Name Description FB_BA_DMUX_XX [} 637] Demultiplexer function blocks FB_BA_MMUX_XX [} 640] The function blocks activate an input value on the output, depending on a selector and the corresponding input selector condition FB_BA_MUX_XX [} 643] Multiplexer function blocks FB_BA_Prio Swi_XX [} 645] Priority switch FB_BA_Blink [} 647] Simple oscillator function block FB_BA_FIFO04 [} 648] Sequential control of up to four units FB_BA_FIFO08 [} 650] Sequential control of up to eight units FB_BA_Step Ctrl08 [} 652] Step sequence function block, 8 steps FB_BA_Step Ctrl12 [} 655] Step sequence function block, 12 steps FB_BA_FIFO04_XX [} 658] FB_BA_FIFO08_XX [} 659] 6.1.2.3.2.1.5.3.1 FB_BA_DMUX_XX Demultiplexer function blocks exist for different variable types (BOOL, INT, LREAL, REAL, USINT, UINT, UDINT and DINT) and in different output parameters (4, 8, 12 and 16), but they all have the same functionality. The function block FB_BA_DMUX_LR16 is described as an example. TF8040 Version: 1.14.0 637
## Page 638

Programming In active state (b En=TRUE), the function block outputs the value at input lr In at the output (lr Q01..lr Q16) whose number is entered at input udi Sel. All other outputs are set to 0 (for boolean demultiplexers to FALSE). Example: Inputs Outputs b En = TRUE lr Q01 = 0.0 udi Sel = 5 lr Q02 = 0.0 lr In = 32.5 lr Q03 = 0.0 lr Q04 = 0.0 lr Q05 = 32.5 lr Q06 = 0.0 lr Q07 = 0.0 lr Q08 = 0.0 lr Q09 = 0.0 lr Q10 = 0.0 lr Q11 = 0.0 lr Q12 = 0.0 lr Q13 = 0.0 lr Q14 = 0.0 lr Q15 = 0.0 lr Q16 = 0.0 If the value entered at udi Sel is greater than the number of outputs, the value of lr In is output at the "highest" output: Inputs Outputs b En = TRUE lr Q01 = 0.0 udi Sel = 25 lr Q02 = 0.0 r In = 32.5 lr Q03 = 0.0 lr Q04 = 0.0 lr Q05 = 0.0 lr Q06 = 0.0 lr Q07 = 0.0 lr Q08 = 0.0 lr Q09 = 0.0 lr Q10 = 0.0 lr Q11 = 0.0 lr Q12 = 0.0 lr Q13 = 0.0 lr Q14 = 0.0 lr Q15 = 0.0 lr Q16 = 32.5 If b En = FALSE, 0.0 is output at all outputs, or FALSE for boolean demultiplexers. VAR_INPUT b En : BOOL; udi Sel : UDINT; r In : LREAL; b En: Activation of the block function. 638 Version: 1.14.0 TF8040
## Page 639

Programming udi Sel: Number of the output (lr Q00...lr Q16), which is to take on the value of input lr In. lr In: Value to be output. VAR_OUTPUT lr Q00 : LREAL; lr Q01 : LREAL; lr Q02 : LREAL; lr Q03 : LREAL; lr Q04 : LREAL; lr Q05 : LREAL; lr Q06 : LREAL; lr Q07 : LREAL; lr Q08 : LREAL; lr Q09 : LREAL; lr Q10 : LREAL; lr Q11 : LREAL; lr Q12 : LREAL; lr Q13 : LREAL; lr Q14 : LREAL; lr Q15 : LREAL; lr Q16 : LREAL; lr Q00...lr Q16: Value outputs. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 639
## Page 640

Programming 6.1.2.3.2.1.5.3.2 FB_BA_MMUX_XX The function block activates an input value on the output, depending on a selector and the corresponding input selector condition. Multiplexer function blocks exist for different variable types (BOOL, INT, LREAL, REAL, USINT, UINT, UDINT and DINT) and in different input parameters (4, 8, 12, 16 and 24), but they all have the same functionality. The function block FB_BA_MMUX_R16 is described as an example. In active state (b En=TRUE), the function block activates one of the input values r Valxx at output r Val, depending on a selector udi Sel and the corresponding input selector condition udi Enxx. If several input selector conditions udi En01...udi En16 are identical and the selector udi Sel matches a condition, the input value r Val01...r Val16 of the lowest active selector condition is activated at output r Val. udi En01 is the lowest selector condition, udi En16 the highest. The output variable b Q indicates that the selector udi Sel matches the input selector condition udi Enxx. The output variable udi Actv Prio indicates the active selector condition. 640 Version: 1.14.0 TF8040
## Page 641

Programming If no selector condition is active, r Repl Val is output at r Val. b Q is then FALSE and udi Actv Prio shows 255. Example: Inputs Output Variable Value Variable Value b En TRUE b Q TRUE udi Sel 5 r Val 1.123 udi En01 4 udi Actv Prio 7 r Val01 123 udi En02 r Val02 udi En03 3 r Val03 321 udi En04 r Val04 udi En05 8 r Val05 345 udi En06 r Val06 udi En07 5 r Val07 1.123 udi En08 r Val08 udi En09 5 r Val09 5.4321 udi En10 r Val10 udi En11 r Val11 udi En12 r Val12 udi En13 r Val13 udi En14 r Val14 udi En15 r Val15 udi En16 r Val16 r Repl Val If no priority is active, the value of the global constant Const.udi No Actv Prio [} 692] is output at udi Actv Prio. VAR_INPUT b En : BOOL; udi Sel : UDINT; udi En01 : UDINT := Const.udi No Actv Prio; r Val01 : REAL; udi En02 : UDINT := Const.udi No Actv Prio; r Val02 : REAL; udi En03 : UDINT := Const.udi No Actv Prio; r Val03 : REAL; udi En04 : UDINT := Const.udi No Actv Prio; TF8040 Version: 1.14.0 641
## Page 642

Programming r Val04 : REAL; udi En05 : UDINT := Const.udi No Actv Prio; r Val05 : REAL; udi En06 : UDINT := Const.udi No Actv Prio; r Val06 : REAL; udi En07 : UDINT := Const.udi No Actv Prio; r Val07 : REAL; udi En08 : UDINT := Const.udi No Actv Prio; r Val08 : REAL; udi En09 : UDINT := Const.udi No Actv Prio; r Val09 : REAL; udi En10 : UDINT := Const.udi No Actv Prio; r Val10 : REAL; udi En11 : UDINT := Const.udi No Actv Prio; r Val11 : REAL; udi En12 : UDINT := Const.udi No Actv Prio; r Val12 : REAL; udi En13 : UDINT := Const.udi No Actv Prio; r Val13 : REAL; udi En14 : UDINT := Const.udi No Actv Prio; r Val14 : REAL; udi En15 : UDINT := Const.udi No Actv Prio; r Val15 : REAL; udi En16 : UDINT := Const.udi No Actv Prio; r Val16 : REAL; r Repl Val : REAL; b En: Activation of the block function. udi Sel: Selector. Internally limited to values between 0 and 4294967294. udi En01..udi En16: Input selector condition. The input variables are pre-initialized to the value 255. r Val01...r Val16: Input values to select from. r Repl Val: Substitute value, if no input selector condition is active VAR_OUTPUT b Q : BOOL; r Val : REAL; udi Actv Prio : UDINT; b Q: TRUE, if the selector udi Sel matches an input selector condition udi Enxx. r Val: Value of the selected input selector condition. udi Actv Prio: Indicates which input selector condition is active. If no priority is active, the value of the global constant Const.udi No Actv Prio [} 692] is output at udi Actv Prio. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 642 Version: 1.14.0 TF8040
## Page 643

Programming 6.1.2.3.2.1.5.3.3 FB_BA_MUX_XX Multiplexer function blocks exist for different variable types (BOOL, INT, LREAL, REAL, USINT, UINT, UDINT and DINT) and in different input parameters (4, 8, 12 and 16), but they all have the same functionality. The function block FB_BA_MUX_LR16 is described as an example. In active state (b En=TRUE), the function block outputs the input value (lr In01..lr In16) at output lr Q, whose number is entered at input udi Sel. Example: TF8040 Version: 1.14.0 643
## Page 644

Programming Inputs Output b En = TRUE lr Q = 16.5 udi Sel = 5 lr In01 = 15.9 lr In02 = 32.5 lr In03 = 17.4 lr In04 = 5.84 lr In05 = 9.56 lr In06 = 16.5 lr In07 = 32.781 lr In08 = 25.4 lr In09 = 44.5 lr In10 = 66.1 lr In11 = 45.5 lr In12 = 83.3 lr In13 = 54.56 lr In14 = 33.8 lr In15 = 98.5 lr In16 = 71.3 If the value entered at udi Sel is greater than the number of inputs, the "highest-ranking" input is output at lr Q: Inputs Output b En = TRUE lr Q = 2.3 udi Sel = 25 lr In01 = 15.9 lr In02 = 32.5 lr In03 = 17.4 lr In04 = 5.84 lr In05 = 9.56 lr In06 = 16.5 lr In07 = 32.781 lr In08 = 25.4 lr In09 = 44.5 lr In10 = 66.1 lr In11 = 45.5 lr In12 = 83.3 lr In13 = 54.56 lr In14 = 33.8 lr In15 = 98.5 lr In16 = 71.3 If b En=FALSE, 0.0 is output at lr Q, or FALSE for boolean multiplexers. VAR_INPUT b En : BOOL; udi Sel : UDINT; lr In00 : LREAL; lr In01 : LREAL; lr In02 : LREAL; lr In03 : LREAL; lr In04 : LREAL; lr In05 : LREAL; lr In06 : LREAL; lr In07 : LREAL; 644 Version: 1.14.0 TF8040
## Page 645

Programming lr In08 : LREAL; lr In09 : LREAL; lr In10 : LREAL; lr In11 : LREAL; lr In12 : LREAL; lr In13 : LREAL; lr In14 : LREAL; lr In15 : LREAL; lr In16 : LREAL; b En: Activation of the block function. udi Sel: Number of the input, whose value is to be output at lr Q. lr00...lr16: Input values to select from. VAR_OUTPUT lr Q : LREAL; lr Q: Value of the selected input. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.3.4 FB_BA_Prio Swi_XX The priority switches exist for different variable types (BOOL, INT, LREAL, REAL, USINT, UINT, UDINT and DINT) and in different output sizes (4, 8, 12 and 16 or 24), but they all have the same functionality. The function block FB_BA_Prio Swi_LR08 is described as an example. Priority switches are available for selecting different values. At output lr Val the value with the highest priority is applied whose input b Enxx is TRUE. Example: TF8040 Version: 1.14.0 645
## Page 646

Programming Inputs Outputs b En01 FALSE b Q TRUE lr Val01 32.5 lr Val 5.84 b En02 FALSE udi Actv Prio 3 lr Val02 17.4 b En03 TRUE lr Val03 5.84 b En04 TRUE lr Val04 9.56 b En05 FALSE lr Val05 16.5 b En06 TRUE lr Val06 32.781 b En07 FALSE lr Val07 25.4 b En08 TRUE lr Val08 44.5 If none of the priorities is enabled, the output b Q switches to FALSE. 0 is output at lr Val and udi Actv Prio. For a boolean priority switch, FALSE is then output at b Val. Inputs Outputs b En01 FALSE b Q FALSE lr Val01 32.5 lr Val 0.0 b En02 FALSE udi Actv Prio 0 lr Val02 17.4 b En03 FALSE lr Val03 5.84 b En04 FALSE lr Val04 9.56 b En05 FALSE lr Val05 16.5 b En06 FALSE lr Val06 32.781 b En07 FALSE lr Val07 25.4 b En08 FALSE lr Val08 44.5 If no priority is active, the value of the global constant Constudi No Actv Prio is output at udi Actv Prio. VAR_INPUT b En01 : BOOL; lr Val01 : LREAL; b En02 : BOOL; lr Val02 : LREAL; b En03 : BOOL; lr Val03 : LREAL; b En04 : BOOL; lr Val04 : LREAL; b En05 : BOOL; lr Val05 : LREAL; b En06 : BOOL; lr Val06 : LREAL; b En07 : BOOL; 646 Version: 1.14.0 TF8040
## Page 647

Programming lr Val07 : LREAL; b En08 : BOOL; lr Val08 : LREAL; b En01...b En08: Enabling the priority value. lr Val01...lr Val08: Priority value. VAR_OUTPUT b Q : BOOL; lr Val : LREAL; udi Actv Prio : UDINT; b Q: Output to indicate whether a priority is enabled. lr Val: Output of the value of the current (highest) priority that is enabled. udi Actv Prio: Current (highest) priority that is enabled. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.3.5 FB_BA_Blink This function block is an oscillator with adjustable pulse and pause time, udi Ti On_ms and udi Ti Off_ms [ms]. It is enabled with a TRUE signal at b En and starts with the pulse phase. udi Ti Next Swi_sec is a countdown [s] to the next change of b Q. VAR_INPUT b En : BOOL; udi Ti On_ms : UDINT; udi Ti Off_ms : UDINT; b En: Function block enable. udi Ti On_ms: pulse time [ms]. udi Ti Off_ms: pause time [ms]. VAR_OUTPUT b Q : BOOL; udi Ti Next Swi_sec : UDINT; TF8040 Version: 1.14.0 647
## Page 648

Programming b Q: Oscillator output. udi Ti Next Swi_sec: Countdown to next change of b Q [s]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.3.6 FB_BA_FIFO04 The function block FB_BA_FIFO04 enables sequential control of up to four units, with automatic switching of the switch-on sequence based on operating hours. The function block is available in two versions: for a sequence of four or eight [} 650] units. Units with fewer operating hours take precedence in the sequence over units with more operating hours. A rising edge at b Chg forces a sequence change. The units with the fewest operating hours are set to the top of the FIFO and thus given priority for switching on. In the sequence only units are entered that are enabled at inputs b En01..b En04. udi Num indicates the number of requested units. The operating hours of the units are entered at inputs udi Actv Ti01_h to udi Actv Ti04_h. If all these inputs are set to a constant value of zero, the sequence change is controlled cyclically, depending on b Chg. The first unit is removed from the FIFO, the other units are advanced, and the first unit is appended at the end of the FIFO again. As a result is an alternating sequence of units. If more units are requested at input udi Num than are available at inputs b En01 to b En04, this is indicated with TRUE at b Err. Error handling If more units are requested at input udi Num than are available at inputs b En01 to b En04, this is indicated with TRUE at b Err. VAR_INPUT b En : BOOL; udi Num : UDINT; b Chg : BOOL; b En01 : BOOL; b En02 : BOOL; b En03 : BOOL; b En04 : BOOL; udi Actv Ti01_h : UDINT; udi Actv Ti02_h : UDINT; udi Actv Ti03_h : UDINT; udi Actv Ti04_h : UDINT; b En: Enables the function block. udi Num: Number of units. 648 Version: 1.14.0 TF8040
## Page 649

Programming b Chg: Force sequence change. b En01...b En04: Enable unit 1...enable unit 4. udi Actv Ti01_h...udi Actv Ti04_h: Operating hours unit 1...operating hours unit 4. VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; udi Next On : UDINT; udi Next Off : UDINT; arr FIFO : ARRAY [1..4] OF UDINT; udi Num Of En : UDINT; b Err : BOOL; s Err Desc : STRING; b Q01...b Q04: Switches unit 1..4. udi Next On: Number of the unit that is switched on next. udi Next Off: Number of the unit that is switched on next. arr FIFO: FIFO buffer as a field. udi Num Of En: Number of devices, depending on the individual enable states. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Desc: Contains the error description. Error description 01: Warning: More than 4 devices are entered at input udi Num. The number is limited to the number enabled at inputs b En01..b En04. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 649
## Page 650

Programming 6.1.2.3.2.1.5.3.7 FB_BA_FIFO08 The function block FB_BA_FIFO08 enables sequential control of up to eight units, with automatic switching of the switch-on sequence based on operating hours. The function block is available in two versions: for a sequence of four [} 648] or eight units. Units with fewer operating hours take precedence in the sequence over units with more operating hours. A rising edge at b Chg forces a sequence change. The units with the fewest operating hours are set to the top of the FIFO and thus given priority for switching on. In the sequence only units are entered that are enabled at inputs b En01..b En08. udi Num indicates the number of requested units. The operating hours of the units are entered at inputs udi Actv Ti01_h to udi Actv Ti08_h. If all these inputs are set to a constant value of zero, the sequence change is controlled cyclically, depending on b Chg. The first unit is removed from the FIFO, the other units are advanced, and the first unit is appended at the end of the FIFO again. As a result is an alternating sequence of units. If more units are requested at input udi Num than are available at inputs b En01 to b En08, this is indicated with TRUE at b Err. Error handling If more units are requested at input udi Num than are available at inputs b En01 to b En08, this is indicated with TRUE at b Err. VAR_INPUT b En : BOOL; udi Num : UDINT; b Chg : BOOL; b En01 : BOOL; b En02 : BOOL; b En03 : BOOL; b En04 : BOOL; b En05 : BOOL; b En06 : BOOL; b En07 : BOOL; b En08 : BOOL; udi Actv Ti01_h : UDINT; udi Actv Ti02_h : UDINT; udi Actv Ti03_h : UDINT; udi Actv Ti04_h : UDINT; udi Actv Ti05_h : UDINT; 650 Version: 1.14.0 TF8040
## Page 651

Programming udi Actv Ti06_h : UDINT; udi Actv Ti07_h : UDINT; udi Actv Ti08_h : UDINT; b En: Enables the function block. udi Num: Number of units. b Chg: Force sequence change. b En01...b En08: Enable unit 1...enable unit 8. udi Actv Ti01_h...udi Actv Ti08_h: Operating hours unit 1...operating hours unit 8. VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; b Q05 : BOOL; b Q06 : BOOL; b Q07 : BOOL; b Q08 : BOOL; udi Next On : UDINT; udi Next Off : UDINT; arr FIFO : ARRAY [1..8] OF UDINT; udi Num Of En : UDINT; b Err : BOOL; s Err Descr : STRING; b Q01...b Q08: Switches unit 1..8. udi Next On: Number of the unit that is switched on next. udi Next Off: Number of the unit that is switched on next. arr FIFO: FIFO buffer as a field. udi Num Of En: Number of devices, depending on the individual enable states. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Warning: More than 8 devices are entered at input udi Num. The number is limited to the number enabled at inputs b En01..b En08. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 651
## Page 652

Programming 6.1.2.3.2.1.5.3.8 FB_BA_Step Ctrl08 The function block is used for issuing sequential control commands. A typical application for this function block is startup of an air conditioning system. b En is used for general enable of the function block. If b En = FALSE, all outputs of b Q01 to b Q08 are set to FALSE. The control sequence starts at input b Evt01. Once the timer udi Dly On01_sec (see Parameters) has elapsed, the corresponding output b Q01 is set. Further stages are activated after a rising edge at the inputs b Evt02 to b Evt08, in each case delayed via the timers udi Dly On02_sec to udi Dly On08_sec. If b Evt01 becomes FALSE once the control chain is up and running, the control sequence switches back in reverse order. Switching off of the outputs is delayed by the timers udi Dly Off01_sec to udi Dly Off08_sec; see Parameters. The outputs b Up and b Dwn indicate whether the control chain is in ascending or descending state. The variable udi Actv Evt indicates the current step of the control chain. "0" means the step sequence is not active. The output udi Rem Ti Dly On_sec indicates the time remaining to the next step during up-switching of the control chain. The output udi Rem Ti Dly Off_sec indicates the time remaining to the next lower step during down-switching of the control chain. 652 Version: 1.14.0 TF8040
## Page 653

Programming Example • t0 step sequence switch-on • t1 switch on step 1 udi Dly On01_sec = t1 - t0 • t2 event enable step 2, switch on step 2, udi Dly On02_sec = 0 • t3 event enable step 3, switch on step 3, udi Dly On03_sec = 0 • t4 event enable step 4, switch on step 4, udi Dly On04_sec = 0 • t5 event enable step 5, switch on step 5, udi Dly On05_sec = 0 • t6 disable the step sequence, disable step 5, disable step 4; udi Dly Off05_sec = 0, udi Dly Off04_sec = 0 • t7 disable step 3, udi Dly Off03_sec = t7 -t6 • t8 disable step 2, udi Dly Off02_sec = t8 -t7 • t9 disable step 1, udi Dly Off01_sec = t9 -t8 VAR_INPUT b En : BOOL; b Evt01 : BOOL; udi Dly On01_sec : UDINT; udi Dly Off01_sec : UDINT; b Evt02 : BOOL; udi Dly On02_sec : UDINT; udi Dly Off02_sec : UDINT; b Evt03 : BOOL; udi Dly On03_sec : UDINT; udi Dly Off03_sec : UDINT; b Evt04 : BOOL; udi Dly On04_sec : UDINT; udi Dly Off04_sec : UDINT; b Evt05 : BOOL; udi Dly On05_sec : UDINT; udi Dly Off05_sec : UDINT; b Evt06 : BOOL; udi Dly On06_sec : UDINT; udi Dly Off06_sec : UDINT; b Evt07 : BOOL; udi Dly On07_sec : UDINT; TF8040 Version: 1.14.0 653
## Page 654

Programming udi Dly Off07_sec : UDINT; b Evt08 : BOOL; udi Dly On08_sec : UDINT; udi Dly Off08_sec : UDINT; b En: Enable function block. b Evt01..08: Switch-on command for steps 1 to 8. udi Dly On01..08_sec: Switch-on delay for output b Q01 .. 08 [s]. udi Dly Off01..08_sec: Switch-off delay for output b Q01 .. 08 [s]. VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; b Q05 : BOOL; b Q06 : BOOL; b Q07 : BOOL; b Q08 : BOOL; b Up : BOOL; b Dwn : BOOL; udi Actv Evt : UDINT; udi Rem Ti Dly On_sec : UDINT; udi Rem Ti Dly Off_sec : UDINT; b Q01..08: Step 1 to 8 On. b Up: Control chain is in ascending state. b Dwn: Control chain is in descending state. udi Actv Evt: Active step, display 0..8; "0" represents an active step sequence. udi RTi Dly On: Time remaining to up-switching to the next step [s]. udi RTi Dly Off: Time remaining to down-switching to the previous step [s]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 654 Version: 1.14.0 TF8040
## Page 655

Programming 6.1.2.3.2.1.5.3.9 FB_BA_Step Ctrl12 The function block is used for issuing sequential control commands. A typical application for this function block is startup of an air conditioning system. b En is used for general enable of the function block. If b En = FALSE, all outputs of b Q01 to b Q12 are set to FALSE. The control sequence starts at input b Evt01. Once the timer udi Dly On01_sec (see Parameters) has elapsed, the corresponding output b Q01 is set. Further stages are activated after a rising edge at the inputs b Evt02 to b Evt12, in each case delayed via the timers udi Dly On02_sec to udi Dly On12_sec. If b Evt01 becomes FALSE once the control chain is up and running, the control sequence switches back in reverse order. Switching off of the outputs is delayed by the timers udi Dly Off01_sec to udi Dly Off12_sec; see Parameters. The outputs b Up and b Dwn indicate whether the control chain is in ascending or descending state. The variable udi Actv Evt indicates the current step of the control chain. "0" means the step sequence is not active. The output udi Rem Ti Dly On_sec indicates the time remaining to the next step during up-switching of the control chain. The output udi Rem Ti Dly Off_sec indicates the time remaining to the next lower step during down-switching of the control chain. TF8040 Version: 1.14.0 655
## Page 656

Programming Example • t0 step sequence switch-on • t1 switch on step 1 udi Dly On01_sec = t1 - t0 • t2 event enable step 2, switch on step 2, udi Dly On02_sec = 0 • t3 event enable step 3, switch on step 3, udi Dly On03_sec = 0 • t4 event enable step 4, switch on step 4, udi Dly On04_sec = 0 • t5 event enable step 5, switch on step 5, udi Dly On05_sec = 0 • t6 disable the step sequence, disable step 5, disable step 4; udi Dly Off05_sec = 0, udi Dly Off04_sec = 0 • t7 disable step 3, udi Dly Off03_sec = t7 -t6 • t8 disable step 2, udi Dly Off02_sec = t8 -t7 • t9 disable step 1, udi Dly Off01_sec = t9 -t8 VAR_INPUT b En : BOOL; b Evt01 : BOOL; udi Dly On01_sec : UDINT; udi Dly Off01_sec : UDINT; b Evt02 : BOOL; udi Dly On02_sec : UDINT; udi Dly Off02_sec : UDINT; b Evt03 : BOOL; udi Dly On03_sec : UDINT; udi Dly Off03_sec : UDINT; b Evt04 : BOOL; udi Dly On04_sec : UDINT; udi Dly Off04_sec : UDINT; b Evt05 : BOOL; udi Dly On05_sec : UDINT; udi Dly Off05_sec : UDINT; b Evt06 : BOOL; udi Dly On06_sec : UDINT; udi Dly Off06_sec : UDINT; b Evt07 : BOOL; udi Dly On07_sec : UDINT; 656 Version: 1.14.0 TF8040
## Page 657

Programming udi Dly Off07_sec : UDINT; b Evt08 : BOOL; udi Dly On08_sec : UDINT; udi Dly Off08_sec : UDINT; b Evt09 : BOOL; udi Dly On09_sec : UDINT; udi Dly Off09_sec : UDINT; b Evt10 : BOOL; udi Dly On10_sec : UDINT; udi Dly Off10_sec : UDINT; b Evt11 : BOOL; udi Dly On11_sec : UDINT; udi Dly Off11_sec : UDINT; b Evt12 : BOOL; udi Dly On12_sec : UDINT; udi Dly Off12_sec : UDINT; b En: Enable function block. b Evt01..12: Switch-on command for steps 1 to 12. udi Dly On01..12_sec: Switch-on delay for output b Q01 .. 12 [s]. udi Dly Off01..12_sec: Switch-off delay for output b Q01 .. 12 [s]. VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; b Q05 : BOOL; b Q06 : BOOL; b Q07 : BOOL; b Q08 : BOOL; b Q09 : BOOL; b Q10 : BOOL; b Q11 : BOOL; b Q12 : BOOL; b Up : BOOL; b Dwn : BOOL; udi Actv Evt : UDINT; udi Rem Ti Dly On_sec : UDINT; udi Rem Ti Dly Off_sec : UDINT; b Q01..12: Step 1 to 12 On. b Up: Control chain is in ascending state. b Dwn: Control chain is in descending state. udi Actv Evt: Active step, display 0..12; "0" represents an active step sequence. udi RTi Dly On: Time remaining to up-switching to the next step [s]. udi RTi Dly Off: Time remaining to down-switching to the previous step [s]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 657
## Page 658

Programming 6.1.2.3.2.1.5.3.10 FB_BA_FIFO04_XX This function block is used to evaluate the Fi Fo memory from FB_BA_FIFO04 [} 648]. The inputs are linked according to the FIFO table to the corresponding outputs of the function block FB_BA_FIFO04_BOOL or FB_BA_FIFO04_REAL. Sample: In the sample the array contains: 4,3,1,2,0,0,0,0. The following result is output in FB_BA_FIFO04_REAL: r In01 at output r Val04 r In02 at output r Val03 r In03 at output r Val01 r In04 at output r Val02 VAR_INPUT arr FIFO : Array [1..4] OF UDINT; r In01 - r In04 : REAL; a FIFO: Contains the assignment table with a maximum of eight values. The first value indicates where the first input was copied to, the second value where the second input was copied to and so on. No assignment takes place with "0". r In01 – r In04: Setpoints to be linked. VAR_OUTPUT r Val01 - r Val04 : REAL; r Val01 – r Val04: Actuator setpoint, input value linked according to FIFO table. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 658 Version: 1.14.0 TF8040
## Page 659

Programming 6.1.2.3.2.1.5.3.11 FB_BA_FIFO08_XX This function block is used to evaluate the Fi Fo memory from FB_BA_FIFO08 [} 650]. The inputs are linked according to the FIFO table to the corresponding outputs of the function block FB_BA_FIFO08_BOOL or FB_BA_FIFO08_REAL. Sample: In the sample the array contains: 4,3,1,2,0,0,0,0. The result output in FB_BA_FIFO08_REAL is r In01 at output r Val04 r In02 at output r Val03 r In03 at output r Val01 r In04 at output r Val02 . VAR_INPUT arr FIFO : Array [1..8] OF UDINT; r In01 - r In08 : REAL; a FIFO: Contains the assignment table with a maximum of eight values. The first value indicates where the first input was copied to, the second value where the second input was copied to and so on. No assignment takes place with "0". r In01 – r In08: Setpoints to be linked. VAR_OUTPUT r Val01 - r Val08 : REAL; r Val01 – r Val08: Actuator setpoint, input value linked according to FIFO table. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 659
## Page 660

Programming 6.1.2.3.2.1.5.4 Hysteresis, 2-point control Function blocks Name Description FB_BA_Cont4Stp01 [} 660] Step switch with four stages FB_BA_Swi2P [} 665] Two-point switch FB_BA_Swi Hys2P [} 667] Two-point switch with one switching point 6.1.2.3.2.1.5.4.1 FB_BA_Cont4Stp01 The function block determines the resulting switching stages of a multi-level unit, depending on the input signal. Four switch-on thresholds and four hysteresis values can be parameterized. Diagram 01 Control direction of parameter b Actn = FALSE = Reverse = Heating 660 Version: 1.14.0 TF8040
## Page 661

Programming udi Stp udi Nu- r Swi On r Swi Off udi- udi- b Q01 b Q02 b Q03 b Q04 m Of Stp Rem Ti D- Rem Ti D- ly On_sec ly Off_sec 0 0 r Swi On01 r Swi On01 udi Dly On 0 FALSE FALSE FALSE FALSE - r Hys01 01_sec 1 >= 1 r Swi On02 r Swi On01 udi Dly On udi Dly Off TRUE FALSE FALSE FALSE - r Hys01 02_sec 01_sec 2 >= 2 r Swi On03 r Swi On02 udi Dly On udi Dly Off TRUE TRUE FALSE FALSE - r Hys02 03_sec 02_sec 3 >= 3 r Swi On04 r Swi On03 udi Dly On udi Dly Off TRUE TRUE TRUE FALSE - r Hys03 04_sec 03_sec 4 >= 4 r Swi On04 r Swi On04 0 udi Dly Off TRUE TRUE TRUE TRUE - r Hys04 04_sec Diagram 02 Control direction parameter b Actn = TRUE = Direct = Cooling TF8040 Version: 1.14.0 661
## Page 662

Programming udi Stp udi Nu- r Swi On r Swi Off udi- udi- b Q01 b Q02 b Q03 b Q04 m Of Stp Rem Ti D- Rem Ti D- ly On_sec ly Off_sec 0 0 r Swi On01 r Swi On01 udi Dly On 0 FALSE FALSE FALSE FALSE + r Hys01 01_sec 1 >= 1 r Swi On02 r Swi On01 udi Dly On udi Dly Off TRUE FALSE FALSE FALSE + r Hys01 02_sec 01_sec 2 >= 2 r Swi On03 r Swi On02 udi Dly On udi Dly Off TRUE TRUE FALSE FALSE + r Hys02 03_sec 02_sec 3 >= 3 r Swi On04 r Swi On03 udi Dly On udi Dly Off TRUE TRUE TRUE FALSE + r Hys03 04_sec 03_sec 4 4 r Swi On04 r Swi On04 0 udi Dly Off TRUE TRUE TRUE TRUE + r Hys04 04_sec Diagram 03 Timing of the switch-on and switch-off delays At time t1, r In jumps from r Swi On01 to r Swi On04 662 Version: 1.14.0 TF8040
## Page 663

Programming At time t2, r In jumps from r Swi On04to r Swi On01 - r Hys01 VAR_INPUT b En : BOOL; r In : REAL; r Swi On01 : REAL r Hys01 : REAL; udi Dly On01_sec : UDINT; udi Dly Off01_sec : UDINT; r Swi On02 : REAL; r Hys02 : REAL; udi Dly On02_sec : UDINT; udi Dly Off02_sec : UDINT; r Swi On03 : REAL; r Hys03 : REAL; udi Dly On03_sec : UDINT; udi Dly Off03_sec : UDINT; r Swi On04 : REAL; r Hys04 : REAL; udi Dly On04_sec : UDINT; udi Dly Off04_sec : UDINT; udi Num Of Stp : UDINT; b Actn : BOOL; b En: General enable of the function block. If b En is FALSE, all outputs are set to 0. r In: Input value, from which the switching state is derived. r Swi On01: Switch-on point stage 01 r Hys01: Absolute value hysteresis stage 01 udi Dly On01_sec: Switch-on delay stage 01 udi Dly Off01_sec: Switch-off delay stage 01 r Swi On02: Switch-on point stage 02 r Hys02: Absolute value hysteresis stage 02 udi Dly On02_sec: Switch-on delay stage 02 udi Dly Off02_sec: Switch-off delay stage 02 TF8040 Version: 1.14.0 663
## Page 664

Programming r Swi On03: Switch-on point stage 03 r Hys03: Absolute value hysteresis stage 03 udi Dly On03_sec: Switch-on delay stage 03 udi Dly Off03_sec: Switch-off delay stage 03 r Swi On04: Switch-on point stage 04 r Hys04: Absolute value hysteresis stage 04 udi Dly On04_sec: Switch-on delay stage 04 udi Dly Off04_sec: Switch-off delay stage 04 udi Num Of Stp: Number of stages that are required. The input is limited to a range from 0 to 4 b Actn: Input variable used to determine the control direction of the step switch. TRUE = direct = cooling; FALSE = reverse = heating VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; udi Stp : UDINT; r Swi On : REAL; r Swi Off : REAL; udi Rem Ti Dly On_sec : UDINT; udi Rem Ti Dly Off_sec : UDINT; b Q01: Display of status step 01 TRUE = ON; FALSE = OFF udi Stp >= 1 b Q02: Display of status step 02 TRUE = ON; FALSE = OFF udi Stp >= 2 b Q03: Display of status step 03 TRUE = ON; FALSE = OFF udi Stp >= 3 b Q04: Display of status step 04 TRUE = ON; FALSE = OFF udi Stp >= 4 udi Stp: Shows the current step of the step switch r Swi On: Shows the next switch-on point r Swi Off: Shows the next switch-off point udi Rem Ti Dly On_sec: If the switch-on point for switching to the next level is met, the progress of the switch- on delay time is displayed here. udi Rem Ti Dly Off_sec: If the switch-off point for switching down to the next level is met, the progress of the switch-off delay time is displayed here. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 664 Version: 1.14.0 TF8040
## Page 665

Programming 6.1.2.3.2.1.5.4.2 FB_BA_Swi2P The function block FB_BA_Swi2P is a two-point switch with one switch-on point and one switch-off point. A general function block enable can be implemented at input b En. The output b Q is FALSE as long as b En is FALSE. The control direction of the function block depends on the relative position of the switch-on/switch-off points. If the switch-on point is greater than the switch-off point, the control direction is direct/synchronous (cooling mode). Is the switch-off point is greater than the switch-on point, the control direction is indirect/reversed (heating mode). TF8040 Version: 1.14.0 665
## Page 666

Programming VAR_INPUT b En : BOOL; r In : REAL; r On : REAL; r Off : REAL; udi Dly On_sec : UDINT; udi Dly Off_sec : UDINT; b En: General enable of the function block. r In: Input value. r On: Switch-on point. r Off: Switch-off point. udi Dly On_sec: Switch-on delay. udi Dly Off_sec: Switch-off delay. VAR_OUTPUT b Q : BOOL; udi Rem Ti Dly On_sec : UDINT; udi Rem Ti Dly Off_sec : UDINT; b Q: Control output. udi Rem Ti Dly On_sec: Remaining time of the switch-on delay. udi Rem Ti Dly Off_sec: Remaining time of the switch-off delay. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 666 Version: 1.14.0 TF8040
## Page 667

Programming 6.1.2.3.2.1.5.4.3 FB_BA_Swi Hys2P The function block FB_BA_Swi Hys2P is a two-point switch with adjustable hysteresis and hysteresis offset. A general function block enable can be implemented at input b En. If the function block is locked, the output b Q is FALSE. The setpoint for the two-point switch is connected at input r Sp. The control direction of the function block depends on the input variable b Actn. The active switching points result from the setpoint, the hysteresis and the hysteresis offset. They are output at r Swi Hi and r Swi Lo. • The upper switching point results from r Sp + r Hys/2 + r Hys Offs. • The lower switching point results from r Sp + r Hys/2 + r Hys Offs. If b Actn TRUE, the result is direct/synchronous control direction (cooling mode). If b Actn is FALSE, the result is indirect/reversed control direction (heating mode). TF8040 Version: 1.14.0 667
## Page 668

Programming VAR_INPUT b En : BOOL; r In : REAL; r Sp : REAL; r Hys : REAL; r Hys Offs : REAL; udi Dly On_sec : UDINT; udi Dly Off_sec : UDINT; b Actn : BOOL; b En: General enable of the function block. r In: Input value. r Sp: Setpoint input. r Hys: Hysteresis. r Hys Offs: Hysteresis offset. udi Dly On_sec: Switch-on delay udi Dly Off_sec: Release delay b Actn: Control direction. VAR_OUTPUT b Q : BOOL; r Swi Hi : REAL; r Swi Lo : REAL; udi Rem Ti Dly On_sec : UDINT; udi Rem Ti Dly Off_sec : UDINT; b Q: Output. r Swi Hi: Upper switching point. r Swi Lo: Lower switching point. udi Rem Ti Dly On_sec: Time remaining before switching on. udi Rem Ti Dly Off_sec: Time remaining before switching off. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.5 Mathematical functions Function blocks Name Description FB_BA_Multi Calc_XX [} 669] Multi-calculation function blocks FB_BA_Chrct02 [} 670] Linear interpolation for 2 interpolation points FB_BA_Chrct04 [} 671] Linear interpolation for 4 interpolation points FB_BA_Chrct07 [} 673] Linear interpolation for 7 interpolation points FB_BA_Chrct32 [} 674] Linear interpolation for 32 interpolation points FB_BA_Ti Avrg [} 676] Arithmetic mean value over time 668 Version: 1.14.0 TF8040
## Page 669

Programming 6.1.2.3.2.1.5.5.1 FB_BA_Multi Calc_XX The multi-calculation function blocks exist for the variable types LREAL and REAL, although they all have the same functionality. The function block FB_BA_R08 is described as an example. In enabled state (b En=TRUE), the function block determines the following from the 8 input values r01...r08: • the maximum value of all inputs r Max • the input at which this maximum value occurs udi Min Actv • the minimum value of all inputs r Min • the input at which this minimum value occurs udi Min Actv • the mean value of all inputs r Avrg • the sum of all inputs r Sum • the difference between the maximum and minimum value r Diff If not all inputs are used for the calculation, the number can be limited via an entry at udi Num: udi Num=6, for example, can be used to limit the calculations to inputs r01 to r06. Any entry greater than 8 is automatically limited to 8, any entry less than 1 is automatically set to 1. Sample: Inputs Output b En = TRUE r Max = 32 r01 = 32 udi Max Actv = 1 r02 = 17 r Min = 5 r03 = 5 udi Min Actv = 3 r04 = 9 r Avrg = 18.5 r05 = 16 r Sum = 111 r06 = 32 r Diff = 27 r07 = 25 r08 = 44 udi Num = 6 If b En=FALSE, 0 is output at all outputs. VAR_INPUT b En : BOOL; r01 : REAL; r02 : REAL; r03 : REAL; r04 : REAL; r05 : REAL; r06 : REAL; r07 : REAL; r08 : REAL; udi Num : UDINT; b En: Activation of the block function. r01...r08: Input values to be used for the calculation. TF8040 Version: 1.14.0 669
## Page 670

Programming udi Num: Number of input values to be used for the calculation. VAR_OUTPUT r Max : REAL; udi Max Actv : UDINT; r Min : REAL; udi Min Actv : UDINT; r Avrg : REAL; r Sum : REAL; r Diff : REAL; r Max: Maximum value of all inputs. udi Max Actv: Input at which the maximum value is present. r Min: Minimum value of all inputs. udi Min Actv: Input at which the minimum value is present. r Avrg: Mean value of all inputs. r Sum: Sum of all inputs. r Diff: Difference between maximum and minimum value. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.5.2 FB_BA_Chrct02 The function block FB_BA_Chrct02 represents a linear interpolation with 2 interpolation points and can be used to generate a characteristic curve. The characteristic curve is determined by the interpolation points [r X1/r Y1] and [r X2/r Y2]. If the input variable b Lmt is TRUE, r Y is limited by r Y01 and r Y02. If b Lmt is FALSE, r Y is not limited. 670 Version: 1.14.0 TF8040
## Page 671

Programming Error handling The input values for r X[n+1] must always be at least 0.0000001 greater than the values for r X[n]. In the event of an error the variable s Err Descr indicates that at one point of the characteristic curve the values are not monotonically increasing. VAR_INPUT r X : REAL; r X01 : REAL; r X02 : REAL; r Y01 : REAL; r Y02 : REAL; b Lmt : BOOL; r X: Input value of the characteristic curve. r X01: X-value for interpolation point P1. r X02: X-value for interpolation point P2. r Y01: Y-value for interpolation point P1. r Y02: Y-value for interpolation point P2. b Lmt: Limit for the output value r Y. VAR_OUTPUT r Y : REAL; b Err : BOOL; s Err Descr : T_MAXSTRING; r Y: Calculated output value of the characteristic curve. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: r X01 must not be equal to r X02. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.5.3 FB_BA_Chrct04 The function block FB_BA_Chrct04 represents a linear interpolation with 4 interpolation points and can be used to generate a characteristic curve. The characteristic curve is determined by the interpolation points [r X1/r Y1] to [r X4/r Y4]. If the input variable b Lmt is TRUE, r Y is limited by r Y01 and r Y04. If b Lmt is FALSE, r Y is not limited. TF8040 Version: 1.14.0 671
## Page 672

Programming Error handling The input values for r X[n+1] must always be at least 0.0000001 greater than the values for r X[n]. In the event of an error the variable s Err Descr indicates that at one point of the characteristic curve the values are not monotonically increasing. VAR_INPUT r X : REAL; r X01 : REAL; r X02 : REAL; r X03 : REAL; r X04 : REAL; r Y01 : REAL; r Y02 : REAL; r Y03 : REAL; r Y04 : REAL; b Lmt : BOOL; r X: Input value of the characteristic curve. r X01: X-value for interpolation point P1. r X02: X-value for interpolation point P2. r X03: X-value for interpolation point P3. r X04: X-value for interpolation point P4. r Y01: Y-value for interpolation point P1. r Y02: Y-value for interpolation point P2. r Y03: Y-value for interpolation point P3. r Y04: Y-value for interpolation point P4. b Lmt: Limit for the output value r Y. VAR_OUTPUT r Y : REAL; b Err : BOOL; s Err Descr : T_MAXSTRING; r Y: Calculated output value of the characteristic curve. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: at the specified element. The sequence must always be r X01 > r X02 > r Xn or r X01 < r X02 < r Xn. 672 Version: 1.14.0 TF8040
## Page 673

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.5.4 FB_BA_Chrct07 The function block FB_BA_Chrct07 represents a linear interpolation with 7 interpolation points and can be used to generate a characteristic curve. The characteristic curve is determined by the interpolation points [r X1/r Y1] to [r X7/r Y7]. If the input variable b Lmt is TRUE, r Y is limited by r Y01 and r Y07. If b Lmt is FALSE, r Y is not limited. Error handling The input values for r X[n+1] must always be at least 0.0000001 greater than the values for r X[n]. In the event of an error the variable s Err Descr indicates that at one point of the characteristic curve the values are not monotonically increasing. VAR_INPUT r X : REAL; r X01 : REAL; r X02 : REAL; r X03 : REAL; r X04 : REAL; r X05 : REAL; r X06 : REAL; r X07 : REAL; r Y01 : REAL; r Y02 : REAL; r Y03 : REAL; TF8040 Version: 1.14.0 673
## Page 674

Programming r Y04 : REAL; r Y05 : REAL; r Y06 : REAL; r Y07 : REAL; b Lmt : BOOL; r X: Input value of the characteristic curve. r X01: X-value for interpolation point P1. r X02: X-value for interpolation point P2. r X03: X-value for interpolation point P3. r X04: X-value for interpolation point P4. r X05: X-value for interpolation point P5. r X06: X-value for interpolation point P6. r X07: X-value for interpolation point P7. r Y01: Y-value for interpolation point P1. r Y02: Y-value for interpolation point P2. r Y03: Y-value for interpolation point P3. r Y04: Y-value for interpolation point P4. r Y05: Y-value for interpolation point P5. r Y06: Y-value for interpolation point P6. r Y07: Y-value for interpolation point P7. b Lmt: Limit for the output value r Y. VAR_OUTPUT r Y : REAL; b Err : BOOL; s Err Descr : T_MAXSTRING; r Y: Calculated output value of the characteristic curve. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: at the specified element. The sequence must always be r X01 > r X02 > r Xn or r X01 < r X02 < r Xn. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.5.5 FB_BA_Chrct32 674 Version: 1.14.0 TF8040
## Page 675

Programming The function block FB_BA_Chrct32 represents a linear interpolation with up to 32 interpolation points and can be used to generate a characteristic curve. In contrast to the "smaller" interpolation function blocks FB_BA_Chrct02 [} 670], FB_BA_Chrct04 [} 671] and FB_BA_Chrct07 [} 673], and in the interest of clarity, the interpolation points are determined via field variables [arr X[1]/arr Y[1] to [arr X[n]/arr Y[n]]. If the input variable b Lmt is TRUE, r Y is limited by arr Y[1] and arr Y[n]. If b Lmt is FALSE, r Y is not limited. Error handling The input values for r X[n+1] must always be at least 0.0000001 greater than the values for r X[n]. In the event of an error the variable s Err Descr indicates that at one point of the characteristic curve the values are not monotonically increasing. The parameter for the number of interpolation points, di Num Of Elem, must be in the range 2..32. VAR_INPUT r X : REAL; arr X : ARRAY [1.. FB_BA_Chrct32.c BA_Num Of Elem] OF REAL; arr Y : ARRAY [1.. FB_BA_Chrct32.c BA_Num Of Elem] OF REAL; di Num Of Elem : DINT(2..32); b Lmt : BOOL; r X: Input value of the characteristic curve arr X: Field with the X-values for the interpolation points. arr Y: Field with the Y-values for the interpolation points. n Num Of Elem: Number of interpolation points. Internally limited to values between 2 and 32. b Lmt: Limitation of the output value r Y. VAR_OUTPUT r Y : REAL; b Err : BOOL; s Err Descr : T_MAXSTRING; r Y: Calculated output value of the characteristic curve. b Err: This output is switched to TRUE if the parameters entered are erroneous. s Err Descr: Contains the error description. Error description 01: Error: at the specified element. The sequence must always be r X01 > r X02 > r Xn or r X01 < r X02 < r Xn. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 675
## Page 676

Programming 6.1.2.3.2.1.5.5.6 FB_BA_Ti Avrg The function block FB_BA_Ti Avrg calculates the arithmetic mean value of an analog value that was logged over a certain period. Discrete values are written into a FIFO buffer. udi Intval_sec specifies the time interval [s] over which the values are logged and written into the FIFO. Values are written if the input b En is TRUE. The variable udi Num Of Elem is used to determine the size of the FIFO buffer. It is limited to 1..512. The function block can be used for calculating an hourly mean outside temperature over a day, for example. In this case udi Num Of Elem would be 24 and udi Intval_sec would be 3600 seconds. b En is the general enable of the function block. If b En = FALSE, the FIFO buffer within the function block is deleted completely, and no data are recorded. Example: udi Num Of Elem = 5 First cycle Second cycle Third cycle Fourth cycle r In r Out r In r Out r In r Out r In r Out t0 2 2/1 = 2 6 (4+6+7+7+6)/5 = 1 (7+6+5+4+1)/5 = 3 r In = 3 6 4.6 t1 4 (2+4)/2 = 3 5 (6+7+7+6+5)/5 = 2 (6+5+4+1+2)/5 = 1.5 r In = 1.5 6.25 3.6 t2 6 (2+4+6)/3 = 4 4 (7+7+6+5+4)/5 = 4 (5+4+1+2+4)/5 = 5.8 3.2 t3 7 (2+4+6+7)/4 = 2 (7+7+6+5+4)/5 5 (4+1+2+4+5)/5 = 4.75 =5.8 3.2 t4 7 (2+4+6+7+7)/5 = 1 (7+7+6+5+4)/5 4 (1+2+4+5+4)/5 = 5.2 =5.8 3.2 VAR_INPUT b En : BOOL; r In : REAL; udi Intval_sec : UDINT; udi Num Of Elem : UDINT; b En: Enables the function block. r In: Input value for averaging. udi Int Val_SEC: Time interval [s] for writing new values into the FIFO. Internally limited to a value between 1 and 2147483. udi Num Of Elem: Size of the FIFO buffer. A change resets the previous averaging. Internally limited to a value between 1 and 512. VAR_OUTPUT r Out : REAL; r Max : REAL; r Min : REAL; r Out: Calculated mean value. r Max: Largest value in the FIFO buffer. r Min: Smallest value in the FIFO buffer. 676 Version: 1.14.0 TF8040
## Page 677

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.6 Monitoring functions Function blocks Name Description FB_BA_Fdb Ctrl Binary [} 678] Feedback monitoring of an actuator by means of digital feedback. FB_BA_Fixed Limit Ctrl [} 677] Limit value monitoring of a fixed value. FB_BA_Sliding Limit Ctrl [} 679] Sliding limit value monitoring. 6.1.2.3.2.1.5.6.1 FB_BA_Fixed Limit Ctrl Function block for monitoring a fixed limit value. The input b En is used for enabling the function block. A tolerance range is defined around the value r In to be monitored. The tolerance range results from an upper limit value r In High Limit and a lower limit value r In Low Limit. If the value r In exceeds the upper limit value of the tolerance range, then the output b High Limit becomes TRUE. A response delay of the output b High Limit must be parameterized with the timer udi Delay_sec. If the value r In falls below the lower limit of the tolerance range, output b Low Limit becomes TRUE. A response delay of the output b Low Limit must be parameterized with the timer udi Delay_sec. VAR_INPUT b En : BOOL; r High Limit : REAL := 32; r Low Limit : REAL := 16; r In : REAL; udi Delay_sec : UDINT; b En: Function block enable. r High Limit: Default upper limit value, preset to 32. r Low Limit: Default lower limit value, preset to 16. r In: Input value to be monitored. udi Delay_sec: Output response delay [s]. Internally limited to values between 0 and Const.udi Ti Sec [} 692]. VAR_OUTPUT b High Limit : BOOL; b Low Limit : BOOL; udi Rem Ti Delay_sec : UDINT; b High Limit: Upper limit value reached. TF8040 Version: 1.14.0 677
## Page 678

Programming b Low Limit: Lower limit value reached. udi Rem Ti Delay_sec: Time remaining after a limit value has been exceeded until either the output b High Limit or b Low Limit responds. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.6.2 FB_BA_Fdb Ctrl Binary The function block is used for feedback monitoring of an actuator by means of digital feedback. Application examples of the function block are, for example, an operation feedback monitoring, a process feedback monitoring or the run monitoring of a drive by means of limit switches. The input b En is used for enabling the function block. If b En is FALSE, the message output b Q will always be FALSE. The switching actuator output of the unit to be monitored is connected to the input b Actuator. The b Switch input is used to connect the feedback signal (e.g. differential pressure switch, flow monitor or limit switch). By means of the timer udi Fdb Delay_sec [s] a response delay of the feedback control after the start of the unit is set. The second timer udi Interruption Delay_sec [s] serves for a response delay of the feedback control after reaching the final state. VAR_INPUT b En : BOOL; b Actuator : BOOL; b Switch : BOOL; udi Fdb Delay_sec : UDINT; udi Interruption Delay_sec : UDINT; b En: Function block enable. b Actuator: Feedback of the switching output. b Switch: Feedback signal from the process. udi Fdb Delay_sec: Response delay [s] of the monitoring function when the actuator is started. Internally limited to values between 0 and Const.udi Ti Sec [} 692]. udi Interruption Delay_sec: Response delay [s] of the monitoring function when the actuator has already been started successfully (e.g. pressure fluctuations when monitoring the running of a fan). Internally limited to values between 0 and Const.udi Ti Sec [} 692]. VAR_OUTPUT b Q : BOOL; udi Rem Ti Fdb Delay : UDINT; udi Rem Ti Interruption Delay : UDINT; b Q: Output an error message if the feedback signal is not present within the parameterized time of udi Fdb Delay_sec, or the feedback signal has been interrupted longer than after udi Interruption Delay_sec. udi Rem Ti Fdb Delay: Remaining time [s] until output b Err Opn is set. 678 Version: 1.14.0 TF8040
## Page 679

Programming udi Rem Ti Interruption Delay: Remaining time [s] until output b Err Swi is set. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.6.3 FB_BA_Sliding Limit Ctrl Function block for monitoring a floating setpoint. The input b En is used for enabling the function block. To check the function of a control system, the actual value is compared with the setpoint of the controlled system. If the deviation of setpoint and actual value is within the tolerance range r Hys, then the control is OK. If the actual value deviates from the setpoint by an amount outside this tolerance range over a longer period of time, the timer udi Delay_sec is started. After the timer has expired, if the control deviation is permanent, either the output b Low Limit or b High Limit TRUE of the function block outputs a message. TF8040 Version: 1.14.0 679
## Page 680

Programming VAR_INPUT b En : BOOL; r W : REAL; r X : REAL; r Hys : REAL; udi Delay_sec : UDINT; b En: Function block enable. r W: Setpoint. r X: Actual value. r Hys: Hysteresis. udi Delay_sec: Output response delay [s]. Internally limited to values between 0 and Const.udi Ti Sec [} 692]. VAR_OUTPUT b High Limit : BOOL; b Low Limit : BOOL; r High Limit : REAL; r Low Limit : REAL; udi Rem Ti Delay_sec : UDINT; b High Limit: Upper limit value reached. b Low Limit: Lower limit value reached. r High Limit: Output of the upper limit value. r Low Limit: Output of the lower limit value. udi Rem Ti Delay_sec: Time remaining after a limit value has been exceeded until either the output b High Limit or b Low Limit responds. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.7 Ramps, filters, controllers Function blocks Name Description FB_BA_Fltr PT1 [} 680] First order filter FB_BA_Ramp Lmt [} 681] Ramp limitation FB_BA_Seq Ctrl Sequence controller (function block in Tc3_BA_Common) FB_BA_Seq Link Sequence linker (function block in Tc3_BA_Common) FB_BA_PIDCtrl PID controller (function block in Tc3_BA_Common) 6.1.2.3.2.1.5.7.1 FB_BA_Fltr PT1 First order filter. 680 Version: 1.14.0 TF8040
## Page 681

Programming When the function block is first called (system start), the output r Out is automatically set (once) to the input r In. VAR_INPUT r In : REAL; udi Damp Const_sec : UDINT; b Set Actl : BOOL; r In: Input signal udi Damp Const_sec: Filter time constant [s]. Internally limited to values between 0 and 86400. b Set Actl: A rising edge at this input sets the output value r Out to the input value r In. VAR_OUTPUT r Out : REAL; r Out: Filtered output signal. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.7.2 FB_BA_Ramp Lmt The function block limits the increase or decrease speed of an input signal. An increase of r In results in the output r Out to be limited to the slope of (r Hi-r Lo)/udi Ti Up. A decrease of r In results in the output r Out to be limited to the slope of (r Hi-r Lo)/udi Ti Up. TF8040 Version: 1.14.0 681
## Page 682

Programming VAR_INPUT b En : BOOL; b En Ramp : BOOL; r In : REAL; r Hi : REAL; r Lo : REAL; udi Ti Up_sec : UDINT; udi Ti Dwn_sec : UDINT; b En: Enable function block if FALSE, in which case r Out = 0.0. b En Ramp: Enable ramp limitation if FALSE, in which case r Out = r In. r In: Input value of the ramp function r Hi: Upper interpolation point for calculating the ramps. r Lo: Lower interpolation point for calculating the ramps. r Hi must be greater than r Lo, otherwise an error is output! udi Ti Up_sec: Rise time [s]. udi Ti Dwn_sec: Fall time [s] VAR_OUTPUT r Out : REAL; r Out: Output signal, slope-limited through the ramps Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 682 Version: 1.14.0 TF8040
## Page 683

Programming 6.1.2.3.2.1.5.8 Calendar Function blocks Name Description FB_BA_Scheduler Weekly XXCh [} 683] Weekly scheduler FB_BA_Calender XXCh [} 684] Yearly scheduler 6.1.2.3.2.1.5.8.1 FB_BA_Scheduler Weekly XXCh Weekly timer with 1, 7 or 28 timer channels. The function block FB_BA_Scheduler Weekly07Ch is described as an example. The function block is used to enter a total of up to 7 switch-on periods. Each switch-on period can be assigned an switch-on time [hh:mm:ss] and a switch-off time [hh:mm:ss]. The variables b Monday to b Sunday can be used to select on which days of the week the switch-on period should be active. A switch-on period is only active if the variable b En of the channel is set to TRUE. For irregular but recurring events, the variable b Reset After On can be set to TRUE. This will automatically reset the enable of channel b En to FALSE after the event has finished. To facilitate data entry, a rising edge at b All Active sets b En and all days of the week (b Monday to b Sunday) to TRUE. The function block is only active if a TRUE signal is present at b En. For demand-dependent switch-on optimization, switching on of the output b Q can be brought forward by the time of the variable udi Predict Time_sec. The switch-on and switch-off points of a channel must be in the same year. The switch-off point must not be earlier than the switch-on point. Otherwise the switch-off point is automatically corrected and set to the same value as the switch-on point. If the switch-on point is equal to the switch-off point, the channel remains off. VAR_INPUT b En : BOOL; st Sys Ti : TIMESTRUCT; udi Predict Time_sec : UDINT; b En: General function block enable. st Sys Ti: Structure with the local NT system time (see TIMESTRUCT). udi Predict Time_sec: Precalculated switch-on time. Internally limited to values between 0 and 43200. VAR_OUTPUT b Q : BOOL; b Q: Switching output VAR_IN_OUT arr Channel: ARRAY [1..c BA_Num Of Channels] OF ST_BA_Scheduler Weekly Channel; arr Channel: Weekly scheduler; with the single-channel function block, the name of the variable is st Channel (see ST_BA_Scheduler Weekly Channel [} 691]). Internally limited to the respective number of possible channels via the variable c BA_Num Of Channels. TF8040 Version: 1.14.0 683
## Page 684

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.1.5.8.2 FB_BA_Calender XXCh Yearly scheduler with 1, 7 or 28 channels. The function block FB_BA_Calender07Ch is described as an example. This function block is used to enter periods such as school holidays or company holidays. The function block is enabled by the input variable b Enable. The input st Ssy Ti is linked to the current system time. If the time switching condition is fulfilled, output b Q is set. Within the calendar, a time period is described by a switch-on date [day, month, hour, minute] and a switch- off date [day, month, hour, minute]. A switch-on period is only active if the variable b En of the channel is set to TRUE. For irregular but recurring periods, the variable b Reset After On can be set to TRUE. The enable parameter b En is then automatically reset to FALSE after the time has elapsed. The switch-on and switch-off points of a channel must be in the same year. The switch-off point must not be earlier than the switch-on point. Otherwise the switch-off point is automatically corrected and set to the same value as the switch-on point. If the switch-on point is equal to the switch-off point, the channel remains off. VAR_INPUT b En : BOOL; st Sys Ti : TIMESTRUCT; b En: General function block enable. st Sys Ti: Structure with the local NT system time (see TIMESTRUCT). VAR_IN_OUT arr Channel: ARRAY [1..7] OF ST_BA_Calendar Channel; arr Channel: Yearly scheduler; with the single-channel function block, the name of the variable is st Channel (see ST_BA_Calender Channel [} 690]). Internally limited to the respective number of possible channels via the variable c BA_Num Of Channels. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 684 Version: 1.14.0 TF8040
## Page 685

Programming 6.1.2.3.2.2 DUTs 6.1.2.3.2.2.1 Enums Enumerations Name Description E_BA_Pos Mod [} 685] Enumerator for the definition of the positioning mode. E_BA_Shd Obj Type [} 685] Enumerator for selecting the shading object type. E_BA_Sensor Enumerator for selecting a sensor type for measuring analog values. E_BA_Terminal_KL Enumerator for selecting the respective Bus Terminal. 6.1.2.3.2.2.1.1 E_BA_Pos Mod Enumerator for the definition of the positioning mode. TYPE E_BA_Pos Mod : ( Pos Mod Fix:= 0, Pos Mod Tab, Pos Mod Max Indc ); END_TYPE Pos Mod Fix: The shutter height is a fixed value, which is set at function block FB_BA_Sun Prtc [} 609] via the value lr Fix Pos [%]. Pos Mod Tab: The height positioning takes place with the help of a table of 6 interpolation points, 4 of which are parameterizable. A blind position in relation to the position of the sun is then calculated from these points by linear interpolation. For a more detailed description please refer to FB_BA_Bld Pos Entry [} 561]. Pos Mod Max Indc: The positioning takes place with specification of the maximum desired incidence of light. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.1.2 E_BA_Shd Obj Type Enumerator for selecting the shading object type. TYPE E_BA_Shd Obj Type : ( Obj Type Tetragon := 0, Obj Type Globe ); END_TYPE Obj Type Tetragon: Object type is a rectangle. Obj Type Globe: Object type is a ball. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 685
## Page 686

Programming 6.1.2.3.2.2.2 Structures Structures Name Description ST_BA_Bld Pos Tab [} 686] Structure of the interpolation point entries for the height adjustment of the blind. ST_BA_Cnr [} 686] Information about window corners. ST_BA_Fcd [} 687] Facade-specific data for activating the automatic functions. ST_BA_Fcd Elem [} 687] List entry for a facade element (window). ST_BA_Shd Obj [} 688] List entry for a shading object ST_BA_Sp Rm T [} 688] Room temperature setpoints. ST_BA_Sunbld [} 689] Structure of the blind positioning telegram. ST_BA_Sun Bld Scn [} 690] Table entry for a blind scene. ST_BA_Calender Channel [} 690] Input of calendar entries. ST_BA_Scheduler Weekly Channel [} 691] Input of time switch entries. 6.1.2.3.2.2.2.1 ST_BA_Bld Pos Tab Structure of the interpolation point entries for the height adjustment of the blind. TYPE ST_BA_Bld Pos Tab: STRUCT r Sun Elv : ARRAY[0..5] OF REAL; r Pos : ARRAY[0..5] OF REAL; b Vld : BOOL; END_STRUCT END_TYPE r Sun Elv / r Pos: The 6 interpolation points that are transferred, wherein the array elements 0 and 5 represent the automatically generated edge elements mentioned above. b Vld: Validity flag for the function block FB_BA_Sun Prtc [} 609]. It is set to TRUE by the function block FB_BA_Bld Pos Entry [} 561] if the data entered correspond to the validity criteria described. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.2.2 ST_BA_Cnr Information about window corners. TYPE ST_BA_Cnr : STRUCT r X : REAL; r Y : REAL; b Shdd : BOOL; END_STRUCT END_TYPE r X: X-coordinate of the window (on the facade). r Y: Y-coordinate of the window (on the facade). b Shdd: Information as to whether this corner is in the shade: b Shdd=TRUE: Corner is in the shade. 686 Version: 1.14.0 TF8040
## Page 687

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.2.3 ST_BA_Fcd Facade-specific data at room level for activating the automatic functions. TYPE ST_BA_Fcd: STRUCT r Sun Prtc Angl : REAL; r Sun Prtc Pos : REAL; r Fcd Th Auto Pos : REAL; r Fcd Th Auto Angl : REAL; b Fcd Th Auto En : BOOL; b Th Auto En : BOOL; b Twi Lgt Auto En : BOOL; b Sun Prtc En : BOOL; END_STRUCT END_TYPE r Sun Prtc Angl: Sun protection: Current calculated position [%] for the blinds. r Sun Prtc Pos: Sun protection: Current calculated louvre angle [°] for the blinds. r Fcd Th Auto Pos: Thermo-automatic function for whole facade: Currently valid position [%] for the blinds (heating or cooling position). r Fcd Th Auto Angl: Thermo-automatic function for whole facade: Currently valid louvre angle [°] for the blinds (heating or cooling position). b Fcd Th Auto En: Thermo-automatic function for whole facade enabled. b Th Auto En: Thermo-automatic function enabled. b Twi Lgt Auto En: Automatic twilight function enabled. b Sun Prtc En: Automatic sun protection enabled. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.2.4 ST_BA_Fcd Elem List entry for a facade element (window). TYPE ST_BA_Fcd Elem: STRUCT r Wdw Wdth : REAL; r Wdw Hght : REAL; st Cnr : ARRAY [1..4] OF ST_BA_Cnr; di Grp : DINT; b Vld : BOOL; END_STRUCT END_TYPE r Wdw Wdth: Width of the window. r Wdw Hght: Height of the window. st Cnr: Coordinates of the window corners and information as to whether this corner point is in the shade; see ST_BA_Cnr [} 686]. b Vld: Plausibility of the data entered: b Vld=TRUE: Data are plausible. di Grp: Group membership of the element. TF8040 Version: 1.14.0 687
## Page 688

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.2.5 ST_BA_Shd Obj List entry for a shading object. TYPE ST_BA_Shd Obj : STRUCT r P1x : REAL; r P1y : REAL; r P1z : REAL; r P2x : REAL; r P2y : REAL; r P2z : REAL; r P3x : REAL; r P3y : REAL; r P3z : REAL; r P4x : REAL; r P4y : REAL; r P4z : REAL; r Mx : REAL; r My : REAL; r Mz : REAL; r Rads : REAL; di Beg Mth : USINT; di End Mth : USINT; e Type : E_BA_Shd Obj Type; b Vld : BOOL; END_STRUCT END_TYPE r P1x .. r P4z: Corner coordinates. Of importance only if the element is a square. r Mx .. r Mz: Center coordinates. Of importance only if the element is a ball. r Rads: Radius of the ball. Of importance only if the element is a ball. di Beg Mth: Beginning of the shading period (month). di End Mth: End of the shading period (month). e Type: Object type, see E_BA_Shd Obj Type [} 685]. b Vld: Plausibility of the data: b Vld=TRUE: Data are plausible. Remark about the shading period: The entries for the months may not be 0 or greater than 12, otherwise all combinations are possible. Examples: Start=1, End=1: shading in January. Start=1, End=5: shading from the beginning of January to the end of May. Start=11, End=5: shading from the beginning of November to the end of May (the following year). Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.2.6 ST_BA_Sp Rm T Room temperature setpoints. 688 Version: 1.14.0 TF8040
## Page 689

Programming TYPE ST_BA_Sp Rm T : STRUCT r Prtc Htg : REAL := 12.0; r Eco Htg : REAL := 15.0; r Pre Cmf Htg : REAL := 19.0; r Cmf Htg : REAL := 21.0; r Prtc Col : REAL := 40.0; r Eco Col : REAL := 35.0; r Pre Cmf Col : REAL := 28.0; r Cmf Col : REAL := 24.0; END_STRUCT END_TYPE The values in the structure are defined with the preset values. The variables have the following meaning: r Prtc Htg: Protection Heating. r Eco Htg: Economy Heating. r Pre Cmf Htg: Pre-Comfort Heating. r Cmf Htg: Comfort Heating. r Prtc Col: Protection Cooling. r Eco Col: Economy Cooling. r Pre Cmf Col: Pre-Comfort Cooling. r Cmf Col: Comfort Cooling. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.2.7 ST_BA_Sunbld Structure of the blind positioning telegram. TYPE ST_BA_Sun Bld: STRUCT r Pos : REAL; r Angl : REAL; b Man Up : BOOL; b Man Dwn : BOOL; b Man Mod : BOOL; b Actv : BOOL; END_STRUCT END_TYPE r Pos: Transferred shutter height [%]. r Angl: Transferred louvre position [°]. b Man Up: Manual command: blind up. b Man Dwn: Manual command: blind down. b Man Mod: TRUE: Manual mode is active. FALSE: Automatic mode is active. b Actv: The sender of the telegram is active. This bit is only evaluated by the priority control FB_BA_Sun Bld Prio Swi4 [} 599] or FB_BA_Sun Bld Prio Swi8 [} 600]. The sun protection actuators FB_BA_Sun Bld Actr [} 591] and FB_BA_Rol Bld Actr [} 583] ignore it. TF8040 Version: 1.14.0 689
## Page 690

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.2.8 ST_BA_Sun Bld Scn Table entry for a blind scene. TYPE ST_BA_Sun Bld Scn: STRUCT r Pos : REAL; r Angl : REAL; END_STRUCT END_TYPE r Pos: Shutter height [%]. r Angl: Louvre position [°]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.2.9 ST_BA_Calender Channel Structure for entering calendar entries. TYPE ST_BA_Calendar Channel: STRUCT udi On_Day : UDINT(1..31); udi On_Month : UDINT(1..12); udi On_hh : UDINT(0..23); udi On_mm : UDINT(0..59); udi Off_Day : UDINT(1..31); udi Off_Month : UDINT(1..12); udi Off_hh : UDINT(0..23); udi Off_mm : UDINT(0..59); b En : BOOL; b Reset After On : BOOL; b Q : BOOL; END_STRUCT END_TYPE udi On_Day: Switch-on point for day. udi On_Month: Switch-on point for month. udi On_hh: Switch-on point for hour. udi On_mm: Switch-on point for minute. udi Off_Day: Switch-off point for day. udi Off_Month: Switch-off point for month. udi Off_hh: Switch-off point for hour. udi Off_mm: Switch-off point for minute. b En: TRUE -> Enable channel, FALSE -> b Q = FALSE b Reset After On: One-time and non-recurring switching-on. b Q: Channel status output. 690 Version: 1.14.0 TF8040
## Page 691

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.2.2.10 ST_BA_Scheduler Weekly Channel Structure for entering time switch entries. TYPE ST_BA_Scheduler Weekly Channel: STRUCT udi On_hh : UDINT(0..23); udi On_mm : UDINT(0..59); udi On_ss : UDINT(0..59); udi Off_hh : UDINT(0..23); udi Off_mm : UDINT(0..59); udi Off_ss : UDINT(0..59); b All Active : BOOL; b En : BOOL; b Monday : BOOL; b Tuesday : BOOL; b Wednesday : BOOL; b Thursday : BOOL; b Friday : BOOL; b Saturday : BOOL; b Sunday : BOOL; b Reset After On : BOOL; b Q : BOOL; END_STRUCT END_TYPE udi On_hh: Switch-on point for hour. udi On_mm: Switch-on point for minute. udi On_ss: Switch-on point for second. udi Off_hh: Switch-off point for hour. udi Off_mm: Switch-off point for minute. udi Off_ss: Switch-off point for second. b All Active: Activation of the timer condition for all weekdays. b En: TRUE -> Enable channel, FALSE -> b Q = FALSE. b Monday: Switch-on point for Monday. b Tuesday: Switch-on point for Tuesday. b Wednesday: Switch-on point for Wednesday. b Thursday: Switch-on point for Thursday. b Friday: Switch on point for Friday. b Saturday: Switch-on point for Saturday. b Sunday: Switch-on point for Sunday. b Reset After On: One-time and non-recurring switching-on. b Q: Channel status output. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 TF8040 Version: 1.14.0 691
## Page 692

Programming 6.1.2.3.2.3 GVLs 6.1.2.3.2.3.1 Constants Global constants VAR_GLOBAL CONSTANT r Cls Zero : REAL := 0.00001; udi No Actv Prio : UDINT := 4294967295; udi Ti Sec : UDINT := 4294967295; w SUNDAY : WORD := 0; w MONDAY : WORD := 1; w TUESDAY : WORD := 2; w WEDNESDAY : WORD := 3; w THURSDAY : WORD := 4; w FRIDAY : WORD := 5; w SATURDAY : WORD := 6; Time Value24h_ms : UDINT := 86400000; END_VAR r Cls Zero: Reference value to avoid division by zero. udi No Actv Prio: The value of the constants indicates that no priority is active. udi Ti Sec: Constant for specifying a time in seconds. w SUNDAY: Constant value for Sunday. w MONDAY: Constant value for Monday. w TUESDAY: Constant value for Tuesday. w WEDNESDAY: Constant value for Wednesday. w THURSDAY: Constant value for Thursday. w FRIDAY: Constant value for Friday. w SATURDAY: Constant value for Saturday. Time Value24h_ms: Time value for 24 hours in milliseconds. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.2.3.2.3.2 Parameter Global parameters VAR_GLOBAL CONSTANT usi Max Sun Bld Scn : USINT := 20; ui Max Row Fcd : UINT := 10; ui Max Column Fcd : UINT := 20; ui Max Shd Obj : UINT := 20; udi Max Data File Size : UDINT := 100000; END_VAR usi Max Sun Bld Scn: Maximum number of scenes that are processed by the function block FB_BA_Sun Bld Scn [} 601]. ui Max Row Fcd: Maximum number of floors for which the shading correction applies (horizontal arrangement of windows). 692 Version: 1.14.0 TF8040
## Page 693

Programming ui Max Column Fcd: Maximum number of axes for which the shading correction applies (vertical arrangement of windows). ui Max Shd Obj: Maximum number of shading objects that cast shadows on the facade. udi Max Data File Size: Maximum file size for the Excel list (in bytes), which is read by the function blocks FB_BA_Rd Fcd Elem Lst [} 575] and FB_BA_Rd Shd Obj Lst [} 579]. Requirements Development environment Required PLC library Twin CAT from v3.1.4024.7 Tc3_BA from v1.1.6.0 6.1.3 PLC project templates 6.1.3.1 Standard PLC BA template The standard PLC BA template is a PLC template for a standard TF8040 project. With the standard PLC BA template all necessary libraries and project settings are loaded for an easy start with TF8040. The template is very suitable for making a start with a TF8040 project. Structure The standard project template contains all necessary declarations, FB calls and libraries for the first commissioning of a TF8040 controller. Template for a Building Automation PLC project with the following basic content: Settings • Task ◦ PLC cycle time: 45 ms References • Tc3_BA2 • Tc3_BA2_Common • Tc3_BACnet Rev14 Programs • MAIN ◦ FB_BA_DPAD Contains preconfigured levels for small projects. ◦ Project structure [} 38] Contains declarations and FB calls for: - Control cabinet - Device Templates Contains all the templates required for compiling the project template without errors. TF8040 Version: 1.14.0 693
## Page 694

Programming Structure in the solution tree • References All the libraries required for a TF8040 project are loaded here. • MAIN POU The standard project structure is called in the MAIN POU. This template provides a project structure as an application example with eight levels based on an example from VDI 3814. 694 Version: 1.14.0 TF8040
## Page 695

Programming • Templates All templates required to get started are located in this folder. They enable error-free compilation of the PLC project template. Further templates for the implementation of project-specific applications can be found in the Template Repository [} 1344]. • PLC task The cycle time of the PLC task is set to 45 ms and should not be set smaller for performance reasons. Project-specific programming • Control Once the project can be compiled without errors, the preparations are complete. • Import templates TF8040 Version: 1.14.0 695
## Page 696

Programming Project-specific programming begins with the integration of templates from the Template Repository [} 1344]. Now start with the project-specific programming. 6.1.4 Templates With the templates, Beckhoff provides users of Twin CAT 3 Building Automation with a large systems toolkit. The use of templates facilitates project planning and increases the quality of project execution. Overview of technical systems Category Name Description Templates for Technical system Air conditioning, automation control, building automation, room technical systems automation [} 708] Universal templates Universal [} 981] Aggregate, dampers, motor, pump, sensor, controller, smoke detector, valve, weather station Each template is available in 2 different configurations regarding the connection to the I/O process level, see I/O mapping. This documentation refers to the RAW variant. 6.1.4.1 DUTs 6.1.4.1.1 Enumerations 6.1.4.1.1.1 Building 6.1.4.1.1.1.1 E_BA_Building Mode The enumeration describes the current state of the building depending on the daily schedule. TYPE E_BA_Building Mode : ( e Default := 1, e Night Watch := 2, e Cleaning := 3 ) UDINT; END_TYPE Name Description e Default Standard (day) operation. e Night Watch Night watchman tour e Cleaning Building cleaning 6.1.4.1.1.2 Plant 6.1.4.1.1.2.1 AC 6.1.4.1.1.2.1.1 E_BA_AC_Seq Number_H Sequence number controller where the order of the sequence numbers are taken into account. TYPE E_BA_AC_Seq Number_H : ( e Humidifier := 1, e Dehumidifier := 2, e Off := 3 ) UDINT; END_TYPE 696 Version: 1.14.0 TF8040
## Page 697

Programming Name Description e Humidifier Sequence number humidifier. e Dehumidifier Sequence number dehumidifier. e Off No sequence controller active. 6.1.4.1.1.2.1.2 E_BA_AC_Seq Number_T Sequence number controller where the order of the sequence numbers are taken into account. TYPE E_BA_AC_Seq Number_T : ( e Re Heater := 1, e Pre Heater := 2, e Mixed Air := 3, e Energy Recovery := 4, e Cooler := 5, e Off := 6 ) UDINT; END_TYPE Name Description e Re Heater Sequence number reheater. e Pre Heater Sequence number preheater. e Mixed Air Sequence number mixed air. e Energy Recovery Sequence number energy recovery. e Cooler Sequence number cooler. e Off No sequence controller active. 6.1.4.1.1.2.1.3 E_BA_AC_Op Mod02 TYPE E_BA_AC_Op Mod01 : ( Invalid := 0, e Off := 1, e Step1 := 2, e Step2 := 3, e Step3 := 4, e Emergency := 5, e Frost := 6, e Smoke Extraction Program := 7, e Smoke Extraction Supply Air := 8, e Smoke Extraction Exhaust Air := 9, e Fire := 10, e Night Cooling := 11, e Cool Down Protection := 12, e Over Heating Protection := 13, e Alarm := 14, e Forced Ventilation := 15, e Central Switch Off := 16 ) UDINT; END_TYPE TF8040 Version: 1.14.0 697
## Page 698

Programming Name Description e Off Plant step Off. e Step1 Zone 1 e Step2 Zone 2 e Step3 Zone 3 e Emergency Emergency e Frost Frost e Smoke Extraction Programm Smoke extraction program e Smoke Extraction Supply Air Smoke extraction supply air e Smoke Extraction Exhaust Air Smoke extraction exhaust air e Fire Fire alarm e Night Cooling Night cooling e Cool Down Protection Support operation, cooling protection e Over Heating Protection Overheating protection e Alarm Fault e Forced Ventilation Forced ventilation e Central Switch Off Central shutdown 6.1.4.1.1.2.1.4 E_BA_AC_Plant Step01 Plant steps in the start program of an air conditioning system TYPE E_BA_AC_Plant Step01 : ( e Off := 1, e Erc := 2, e Pre Rinse := 3, e Damper Ou A := 4, e Fan Supply Air := 5, e Damper Exh A := 6, e Fan Extract Air := 7, e Cooler := 8, e Reheater := 9, e Mixed Air := 10, e Enabling Temperature Control := 11, e Enabling Humidity Control := 12, e On := 13 ) UDINT; END_TYPE Name Description e Off Plant step Off. e Erc Plant step Energy recovery. e Pre Rinse Pant step Pre-rinse. e Damper Ou A Plant step Exhaust air damper. e Fan Supply Air Plant step Supply air fan. e Damper Exh A Plant step External air damper. e Fan Extract Air Plant step Exhaust air fan. e Cooler Plant step Cooler. e Re Heater Plant step Reheater. e Mixed Air Plant step Mixed air. e Enabling Temperature Contro Plant step Enabling temperature control. l e Enabling Humidity Control Plant step Enabling humidity control. e On On 698 Version: 1.14.0 TF8040
## Page 699

Programming 6.1.4.1.1.2.1.5 E_BA_AC_Sel Sp Erc TYPE E_BA_AC_Sel Sp Erc : ( e Action := 1, //E_BA_Action.e Direct = Sp Col, E_BA_Action.e Reverse = Sp Htg, e Average Htg Col := 2 ) UDINT; END_TYPE 6.1.4.1.1.2.1.6 E_BA_AC_Op Mod01 TYPE E_BA_AC_Op Mod01 : ( Invalid := 0, e Off := 1, e On := 2, e Emergency := 3, e Frost := 4, e Smoke Extraction Program := 5, e Smoke Extraction Supply Air := 6, e Smoke Extraction Exhaust Air := 7, e Fire := 8, e Night Cooling := 9, e Cool Down Protection := 10, e Over Heating Protection := 11, e Alarm := 12, e Forced Ventilation := 13, e Central Switch Off := 14 ) UDINT; END_TYPE Name Description e Off Plant step Off. e On On e Emergency Emergency e Frost Frost e Smoke Extraction Programm Smoke extraction program e Smoke Extraction Supply Air Smoke extraction supply air e Smoke Extraction Exhaust Air Smoke extraction exhaust air e Fire Fire alarm e Night Cooling Night cooling e Cool Down Protection Support operation, cooling protection e Over Heating Protection Overheating protection e Alarm Fault e Forced Ventilation Forced ventilation e Central Switch Off Central shutdown 6.1.4.1.1.3 Universal 6.1.4.1.1.3.1 E_BA_Conversion_k Factor The enumeration shows the unit of the conversation factor. {attribute 'qualified_only'} TYPE E_BA_Conversion_k Factor : ( e_Pa := 0, e_h Pa := 1, e_mbar := 2, e_mm_HG := 3, e_in_HG := 4, e_mm_WS := 5, e_psi := 6, e_inches_H2O := 7 ) UDINT; END_TYPE TF8040 Version: 1.14.0 699
## Page 700

Programming 6.1.4.1.1.3.2 E_BA_On Off The enumeration shows the operation modes On and Off. TYPE E_BA_On Off : ( e Off := 1, e On := 2 ) UDINT; END_TYPE Name Description e Off Plant step Off. e On On 6.1.4.1.1.3.3 E_BA_Energy Lvl Ex The enumeration is used to represent the four building energy levels. A reduced variant without the "Precomfort" level is represented by E_BA_Energy Lvl [} 700]. TYPE E_BA_Energy Lvl Ex : ( e Protection := 1, e Economy := 2, e Pre Comfort := 3, e Comfort := 4 ) UDINT; END_TYPE Name Description e Protection "Protection" energy level. e Economy "Economy" energy level. e Pre Comfort "Precomfort" energy level. e Comfort "Comfort" energy level. 6.1.4.1.1.3.4 E_BA_Energy Lvl The enumeration is used to represent the building energy level. In contrast to E_BA_Energy Lvl Ex [} 700], this reduced enumeration does not contain the "Precomfort" state. TYPE E_BA_Energy Lvl : ( e Protection := 1, e Economy := 2, e Comfort := 3 ) UDINT; END_TYPE Name Description e Protection Protection energy level. e Economy Economy energy level. e Comfort Comfort energy level. 6.1.4.1.1.3.5 E_BA_Energy Lvl A The enumeration is used to represent the building energy level. The "Automatic" state is also listed, which allows automatic operation to be viewed. In contrast to E_BA_Energy Lvl Ex A [} 701], this reduced enumeration does not contain the "Precomfort" state. TYPE E_BA_Energy Lvl A : ( e Automatic := 1, e Protection := 2, e Economy := 3, 700 Version: 1.14.0 TF8040
## Page 701

Programming e Comfort := 4 ) UDINT; END_TYPE Name Description e Automatic Automatic e Protection Protection energy level. e Economy Economy energy level. e Comfort Comfort energy level. 6.1.4.1.1.3.6 E_BA_Energy Lvl Ex A The enumeration is used to represent the four building energy levels. The "Automatic" state is also listed, which allows automatic operation to be viewed. A reduced variant without the "Precomfort" level is represented by E_BA_Energy Lvl A [} 700]. TYPE E_BA_Energy Lvl Ex A : ( e Automatic := 1, e Protection := 2, e Economy := 3, e Pre Comfort := 4, e Comfort := 5 ) UDINT; END_TYPE Name Description e Automatic Automatic e Protection Protection energy level. e Economy Economy energy level. e Pre Comfort Precomfort energy level. e Comfort Comfort energy level. 6.1.4.1.2 Types 6.1.4.1.2.1 Actuator 6.1.4.1.2.1.1 ST_BA_Sunblind Actuator Feedback This structure contains feedback information from a sunblind actuator for a room (zone) user function. Syntax TYPE ST_BA_Sunblind Actuator Feedback: STRUCT b Referencing : BOOL; b Err : BOOL; e Prio : BYTE; f Position : REAL; f Angle : REAL; f Angl Lmt Up : REAL; f Angl Lmt Dwn : REAL; END_STRUCT END_TYPE TF8040 Version: 1.14.0 701
## Page 702

Programming Name Type Description b Referencing BOOL The sunblind function or the controlled actuator is currently referencing. b Err BOOL The sunblind function or the controlled actuator is in an error state. e Prio BYTE Current priority of the telegram that controls the sunblind actuator. f Position REAL Current position of the drive. f Angle REAL Currently approached angle of the lamellas. f Angl Lmt Up REAL Upper limit value [} 965] of the lamella position for further use in connection with the HMI. f Angl Lmt Dwn REAL Lower limit value [} 965] of the lamella position for further use in connection with the HMI. 6.1.4.1.2.1.2 ST_BA_Light Actuator Feedback This structure contains feedback information from a light actuator for a room (zone) user function. Syntax TYPE ST_BA_Light Actuator Feedback: STRUCT b Initializing : BOOL; b Err : BOOL; e Prio : BYTE; f Light Value : REAL; f Light Temperature : REAL; END_STRUCT END_TYPE Name Type Description b Initializing BOOL The light function or the controlled actuator is being initialized. b Err BOOL The light function or the controlled actuator is in an error state. e Prio BYTE Current priority of the telegram that controls the light actuator. f Light Value REAL Current light value of the actuator. f Light Temperature REAL Current color temperature of the actuator. 6.1.4.1.2.2 Building 6.1.4.1.2.2.1 ST_BA_Building Lighting This structure is used as a transmit telegram to transmit building-specific enables and information concerning light control to other controllers. Syntax TYPE ST_BA_Building Lighting: STRUCT st Lighting : ST_BA_Lighting; b Global Reset : BOOL; END_STRUCT END_TYPE 702 Version: 1.14.0 TF8040
## Page 703

Programming Name Type Description st Lighting ST_BA_Lighting [} 272] Resulting lighting telegram of the building related to the highest priority. This can include the following criteria: fire or burglary (see FB_BA_Building Lighting [} 917]). b Global Reset BOOL Global reset of the lighting functions. 6.1.4.1.2.2.2 ST_BA_Building Alarms This structure serves as a transmit telegram to transmit building-specific alarms to other controllers. Syntax TYPE ST_BA_Building Alarms : STRUCT b Burglary : BOOL; b Fire Alert : BOOL; b Central Off : BOOL; b Forced Ventilation : BOOL; b Smoke Extraction : BOOL; END_STRUCT END_TYPE Name Type Description b Burglary BOOL Burglar alarm b Fire Alert BOOL Fire alarm b Central Off BOOL Central off - command b Forced Ventilation BOOL Forced ventilation b Smoke Extraction BOOL Smoke extraction 6.1.4.1.2.2.3 ST_BA_Building Sunblind This structure is used as a transmit telegram to transmit building-specific alarms, releases and information concerning blind control to other controllers. Syntax TYPE ST_BA_Building Sunblind : STRUCT st Sun Bld : ST_BA_Sun Bld; b Global Th Auto_Release : BOOL; b Global Twi Lgt Auto_Release : BOOL; b Global Reset Man Mode : BOOL; n Sun Prtc_Position Interval : UDINT; END_STRUCT END_TYPE Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Resulting positioning telegram from the building-wide alarms: fire, burglary or icing. b Global Th Auto_Rele BOOL Global release criterion for the thermal automatic. ase b Global Twi Lgt Auto_ BOOL Global release criterion for the twilight automatic. Release b Global Reset Man M BOOL Global reset of the manual functions. ode n Sun Prtc_Position Int UDINT Positioning interval of the lamella setpoint tracing when erval using the automatic sun protection. TF8040 Version: 1.14.0 703
## Page 704

Programming 6.1.4.1.2.3 Facade 6.1.4.1.2.3.1 ST_BA_Facade This structure serves as a transmit telegram, for the transmission of facade-specific data to other controllers. Syntax TYPE ST_BA_Facade : STRUCT st Sun Bld : ST_BA_Sun Bld; f Sun Prtc_Position : REAL; f Sun Prtc_Angle : REAL; b Th Auto_Release : BOOL; b Twi Lgt Auto_Release : BOOL; b Sun Prtc_State : BOOL; END_STRUCT END_TYPE Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Resulting blind telegram of the facade, related to the highest priority. This may include the following criteria: • Burglary, fire or ice • Storm shelter • Maintenance • Thermal automatic facade • Facade twilight automatic • Facade parking position f Sun Prtc_Position REAL Current sun protection position [%]. f Sun Prtc_Angle REAL Current slat angle [°]. b Th Auto_Release BOOL Enabling the thermal automatic for the zone / group control. b Twi Lgt Auto_Releas BOOL Enabling the twilight automatic for the zone / group control. e b Sun Prtc_State BOOL The sun protection is activated when it exceeds a certain switch-on value for a certain switch-on time. Conversely, it is switched off if it falls below a certain switch-off value over a certain switch-off time. 6.1.4.1.2.4 General 6.1.4.1.2.4.1 ST_BA_General Settings This structure contains general weather parameters. Syntax TYPE ST_BA_General Settings : STRUCT f Frost Protection Setpoint : REAL; f TWth : REAL; f TWth Low Limit : REAL; b TWth Low Limit : BOOL; f TWth Damped : REAL; b TWth Damped Low Limit : BOOL; END_STRUCT END_TYPE 704 Version: 1.14.0 TF8040
## Page 705

Programming Name Type Description f Frost Protection Setp REAL Frost protection setpoint, e.g. for heating circuits in oint protection mode. f TWth REAL Current value of the outside temperature. f TWth Low Limit REAL Lower limit value of the outside temperature. Below this value, all frost protection functions in HVAC systems are activated. b TWth Low Limit BOOL The variable is TRUE if the outside temperature is below the value of f TWth Low Crit. f TWth Damped REAL Current value of the damped outside temperature. b TWth Damped Low Li BOOL The variable is TRUE if the damped outside temperature is mit below the value of f TWth Low Crit. 6.1.4.1.2.5 Weather Station 6.1.4.1.2.5.1 ST_BA_Weather Station This structure serves as a standard transmit telegram for the data of a weather station. Syntax TYPE ST_BA_Building Alarms : STRUCT b Disturb : BOOL; f Latitude : REAL; f Longitude : REAL; f Sun Azimuth : REAL; f Sun Elevation : REAL; b Rain : BOOL; st Date Time : TIMESTRUCT; f Outside Temperature : REAL; f Dew Point Temperature : REAL; f Pressure Abs : REAL; f Pressure Rel : REAL; f Humidity Abs : REAL; f Humidity Rel : REAL; f Brightness North : REAL; f Brightness East : REAL; f Brightness South : REAL; f Brightness West : REAL; f Dawn : REAL; f Global Radiation : REAL; f Wind Direction : REAL; f Wind Speed : REAL; END_STRUCT END_TYPE TF8040 Version: 1.14.0 705
## Page 706

Programming Name Type Description b Disturb BOOL The weather station reports a malfunction. f Latitude REAL Latitude of the installation site [°] f Longitude REAL Longitude of the installation site [°] f Sun Azimuth REAL Current position of the sun [°] f Sun Elevation REAL Current sun elevation [°] b Rain BOOL Rain sensor st Date Time TIMESTRUCT Date / Time f Outside Temperatur REAL Temperature [°C] e f Dew Point Temperat REAL Dew point temperature [°C] ure f Pressure Abs REAL Absolute air pressure [h Pa] f Pressure Rel REAL Relative air pressure [h Pa] f Humidity Abs REAL Absolute humidity [g/m³] f Humidity Rel REAL Relative humidity [%r F] f Brightness North REAL Light sensor north [k Lux] f Brightness East REAL Light sensor east [k Lux] f Brightness South REAL Light sensor south [k Lux] f Brightness West REAL Light sensor west [k Lux] f Dawn REAL Dawn [Lux] f Global Radiation REAL Global radiation [W/m²] f Wind Direction REAL Wind direction [°] f Wind Speed REAL Wind speed [m/s] 6.1.4.1.2.5.2 ST_BA_WSC11Data This structure is used to transfer the data of a Thies WSC11 weather station. Syntax TYPE ST_BA_WSC11Data : STRUCT st Status : ST_BA_WSC11Status; f Case Temperature : REAL; f Latitude : REAL; f Longitude : REAL; f Sun Azimuth : REAL; f Sun Elevation : REAL; b Rain : BOOL; st Date Time : TIMESTRUCT; s Time Format : STRING(7); f Outside Temperature : REAL; f Dew Point Temperature : REAL; f Pressure Abs : REAL; f Pressure Rel : REAL; f Humidity Abs : REAL; f Humidity Rel : REAL; f Brightness North : REAL; f Brightness East : REAL; f Brightness South : REAL; f Brightness West : REAL; f Dawn : REAL; f Global Radiation : REAL; f Wind Direction : REAL; f Wind Speed : REAL; END_STRUCT END_TYPE 706 Version: 1.14.0 TF8040
## Page 707

Programming Name Type Description st Status ST_BA_WSC11Status Status variable of the WSC11 [} 707] f Case Temperature REAL Housing internal temperature of the WSC11 [°C] f Latitude REAL Latitude of the installation site [°] f Longitude REAL Longitude of the installation site [°] f Sun Azimuth REAL Current position of the sun [°] f Sun Elevation REAL Current sun elevation [°] b Rain BOOL Rain sensor st Date Time TIMESTRUCT Date / Time s Time Format STRING(7) Specification of the time format f Outside Temperatur REAL Temperature [°C] e f Dew Point Temperat REAL Dew point temperature [°C] ure f Pressure Abs REAL Absolute air pressure [h Pa] f Pressure Rel REAL Relative air pressure [h Pa] f Humidity Abs REAL Absolute humidity [g/m³] f Humidity Rel REAL Relative humidity [%r F] f Brightness North REAL Light sensor north [k Lux] f Brightness East REAL Light sensor east [k Lux] f Brightness South REAL Light sensor south [k Lux] f Brightness West REAL Light sensor west [k Lux] f Dawn REAL Dawn [Lux] f Global Radiation REAL Global radiation [W/m²] f Wind Direction REAL Wind direction [°] f Wind Speed REAL Wind speed [m/s] 6.1.4.1.2.5.3 ST_BA_WSC11Status This structure is used to transfer the status of a Thies WSC11. Syntax TYPE ST_BA_WSC11Status : STRUCT b Dew Protection : BOOL; b Sensor Drying Period : BOOL; b Invalid RMC_Telegramm : BOOL; b Invalid GPS_Time : BOOL; b Invalid Data AD_Converter : BOOL; b Invalid Data Pressure Sensor : BOOL; b Invalid Data Brightness Sensor North : BOOL; b Invalid Data Brightness Sensor East : BOOL; b Invalid Data Brightness Sensor South : BOOL; b Invalid Data Brightness Sensor West : BOOL; b Invalid Data Twilight Sensor : BOOL; b Invalid Data Solar Radiation Sensor : BOOL; b Invalid Data Outside Temperature Sensor : BOOL; b Invalid Data Rain Sensor : BOOL; b Invalid Data Wind Speed Sensor : BOOL; b Invalid Data Wind Direction Sensor : BOOL; b Invalid Data Humidity Sensor : BOOL; b Latest Restart By Watchdog Reset : BOOL; b Invalid EEPROM_Parameters : BOOL; b Default EEPROM_Parameters : BOOL; b Latest Restart With New Firmware : BOOL; END_STRUCT END_TYPE The following descriptions refer to a TRUE at the respective parameter. TF8040 Version: 1.14.0 707
## Page 708

Programming Name Type Description b Dew Protection BOOL Rain sensor: dew protection active. b Sensor Drying Perio BOOL Rain sensor: drying phase of the sensor surface. d b Invalid RMC_Telegr BOOL GPS data: no valid RMC telegram received. amm b Invalid GPS_Time BOOL RTC data from GPS receiver: time from GPS receiver are invalid. b Invalid Data AD_Con BOOL Values from the analog-to-digital converter are invalid. verter b Invalid Data Pressur BOOL Air pressure: measured value from pressure sensor is e Sensor invalid. b Invalid Data Brightne BOOL Measured value from light sensor north is invalid. ss Sensor North b Invalid Data Brightne BOOL Measured value from light sensor east is invalid. ss Sensor East b Invalid Data Brightne BOOL Measured value from light sensor south is invalid. ss Sensor South b Invalid Data Brightne BOOL Measured value from light sensor west is invalid. ss Sensor West b Invalid Data Twilight BOOL Measured value of twilight is invalid. Sensor b Invalid Data Solar Ra BOOL Measured value from global radiation sensor is invalid. diation Sensor b Invalid Data Outside BOOL Measured value from air temperature sensor is invalid. Temperature Sensor b Invalid Data Rain Se BOOL Measured value from rain sensor is invalid. nsor b Invalid Data Wind Sp BOOL Measured value from wind speed sensor is invalid. eed Sensor b Invalid Data Wind Dir BOOL Measured value from wind direction sensor is invalid. ection Sensor b Invalid Data Humidit BOOL Measured values from humidity sensor are invalid (relative y Sensor humidity, absolute humidity, dew point temperature). b Latest Restart By Wa BOOL Last restart by watchdog reset. tchdog Reset b Invalid EEPROM_P BOOL Internal EEPROM parameters are invalid. arameters b Default EEPROM_P BOOL Internal EEPROM parameters contain the default values. arameters b Latest Restart With N BOOL Last restart was with new firmware. ew Firmware 6.1.4.2 POUs This chapter describes the function blocks contained in the template repository. 6.1.4.2.1 Trade Templates from the individual technical systems. 708 Version: 1.14.0 TF8040
## Page 709

Programming 6.1.4.2.1.1 Air Conditioning 6.1.4.2.1.1.1 FB_BA_Air Conditioning The function block serves as a call template for plants for the Air conditioning systems. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Air Conditioning EXTENDS FB_BA_View VAR_INPUT CONSTANT AHU01 : FB_BA_AHU_1st_10; END_VAR Inputs CONSTANT Name Type Description AHU01 FB_BA_AHU_1st_10 [} 810] The plant template is an air conditioning ventilation system and essentially consists of the following parts: • Plant control with the different operation modes and setpoints • Temperature control of sequence elements • Night cooling • Pressure-controlled supply and extract air fans • Thermal air treatment using air heaters, coolers and energy recovery by means of plate heat exchangers • External and extract air damper with spring return actuator and end position control • External and extract air filters with analog differential pressure monitoring Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 709
## Page 710

Programming 6.1.4.2.1.1.2 Aggregates 6.1.4.2.1.1.2.1 Cooler 6.1.4.2.1.1.2.1.1 Temperature 6.1.4.2.1.1.2.1.1.1 FB_BA_AC_Col TSu ACtrl The template represents the supply air temperature control of a cooler with the sequence controller Ctrl. The sequence controller is enabled via the input variable b En. The sequence controllers are enabled for sequence control using the st Seq Link data and command structure. This is indicated by the variable b Seq Actv. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_Col TSu ACtrl EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f Sp TSu A : REAL; f TSu A : REAL; b Sync : BOOL; f Sync : REAL; END_VAR VAR_OUTPUT f Y : REAL; b Is Active : BOOL; b Seq Actv : BOOL; END_VAR VAR_IN_OUT 710 Version: 1.14.0 TF8040
## Page 711

Programming st Seq Link : ST_BA_Seq Link; END_VAR VAR_INPUT CONSTANT Ctrl : FB_BA_Seq Ctrl; END_VAR Inputs Name Type Description b En BOOL Enable for the frequency controller Ctrl. f Sp TSu A REAL Setpoint of the supply air temperature. f TSu A REAL Measured value of the supply air temperature. b Sync BOOL Pulse for synchronization of the sequence controller Ctrl. f Sync REAL Value for the synchronization of the sequence controller Ctrl. Outputs Name Type Description f Y REAL Control value output b Is Active BOOL The sequence controller is the active one in the sequence control. b Seq Actv BOOL The sequence controller is implemented in the control sequence. Inputs/outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] The data and command structure is the link between the supply air temperature sequence controller Ctrl and the supply air temperature sequence controller TSeq Link of an air conditioning system. Inputs CONSTANT Name Type Description Ctrl FB_BA_Seq Ctrl [} 168] The supply air temperature sequence controller Ctrl is the core of this template. It is responsible for the supply air temperature control of the cooler. The sequence controller is also part of the supply air temperature sequence control of an air conditioning system, see sample FB_BA_AC_Seq T [} 778]. The data exchange within this sequence control takes place via the data and command structure st Seq Link. The global variable E_BA_AC_Seq Number_T.e Cooler [} 697] gives the sequence controller its sequence number within the temperature sequence control. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 711
## Page 712

Programming 6.1.4.2.1.1.2.1.1.2 FB_BA_AC_Col T_01 The template represents the open-loop and closed-loop control of a cold water air cooler without dehumidification control. The main tasks of the template are: • Control of the supply air temperature, see TSu ACtrl • Enable the cooler pump, see Pu • Control of the cooler valve, see Vlv • Collecting and evaluating safety-relevant faults using the Plant Lock • To be part of the step sequence control of an air conditioning system, see Aggregates Principle diagram 01 The diagram shows the intended use of the template with the plant elements involved. Principle diagram 02 The diagram shows the integration of the template within a plant. 712 Version: 1.14.0 TF8040
## Page 713

Programming The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_Col T_01 EXTENDS FB_BA_View VAR_INPUT f Sp TSu A : REAL; f TSu A : REAL; b Sync TSu ACtrl : BOOL; f Sync TSu ACtrl : REAL; END_VAR VAR_OUTPUT TF8040 Version: 1.14.0 713
## Page 714

Programming b Cmd : BOOL; f Present Value : REAL; b Active Seq Ctrl : BOOL; END_VAR VAR_IN_OUT st TSeq Link : ST_BA_Seq Link; st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Category' := 'Behaviour'} f Hys Pu On : REAL := 5.0; {attribute 'parameter Category' := 'Behaviour'} f Hys Pu Off : REAL := 1.0; END_VAR VAR_INPUT CONSTANT TFl : FB_BA_Sensor Analog; TRt : FB_BA_Sensor Analog; TSu ACtrl : FB_BA_AC_Col TSu ACtrl; Vlv : FB_BA_Vlv; Pu : FB_BA_Pu1st; Plant Lock : FB_BA_Plant Lock; Aggregate : FB_BA_Aggregate; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; Prio Swi Val : FB_BA_Prio Swi_B04; Hys Pu : FB_BA_Swi2P; END_VAR Inputs Name Type Description f Sp TSu A REAL Setpoint of the supply air temperature f TSu A REAL Measured value of the supply air temperature b Sync TSu ACtrl BOOL Input for synchronization of the supply air sequence controller in the function block TSu ACtrl. f Sync TSu ACtrl REAL Synchronization value for the supply air sequence controller in the function block TSu ACtrl. Outputs Name Type Description b Cmd BOOL Current switching status of the single-stage pump f Present Value REAL Current value of the cooler valve b Active Seq Ctrl BOOL Indicates that the sequence controller of the cooler is the active one in the sequence control. Inputs/outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] The data and command structure is the link between the supply air temperature sequence controller Ctrl and the supply air temperature sequence controller TSeq Link of an air conditioning system. st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. 714 Version: 1.14.0 TF8040
## Page 715

Programming Inputs CONSTANT PERSISTENT Name Type Description f Hys Pu On REAL Upper switching point of the hysteresis to switch on the pump. f Hys Pu Off REAL Lower switching point of the hysteresis to switch off the pump. Inputs CONSTANT Name Type Description TFl FB_BA_Sensor Analog The function block represents the flow temperature sensor. [} 1087] TRt FB_BA_Sensor Analog The function block represents the return temperature sensor. [} 1087] TSu ACtrl FB_BA_AC_Col TSu ACtrl The function block represents the supply air temperature control of the cooler and is part of the temperature [} 710] sequence control of an air conditioning system. The control signal is forwarded to the valve Vlv. Vlv FB_BA_Vlv [} 1092] The function block represents the valve. Pu FB_BA_Pu1st [} 1074] The function block represents the cooler pump. Plant Lock FB_BA_Plant Lock [} 135] When the function block is called, the relevant faults of the event-enabled objects are collected and output at this and lower levels of the template. These relevant faults cause specific switching actions via the variables b Prio Sfty and b Prio Crit in the template. The parameterization of the lock priority of the event- enabled objects can be found in the FB_init of this template. Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. Prio Swi Val FB_BA_Prio Swi_B04 [} 433] The priority switch Prio Swi Val determines the switching conditions and enables for the supply air temperature control TSu ACtrl using the aggregate function block Aggregate and the global variable list Priority [} 1119]. Hys Pu FB_BA_Swi2P The two-position switch Hys Pu switches the pump Pu on and off depending on the valve position f Present Value and the switching points of the hysteresis f Hys Pu On/ f Hys Pu Off. TF8040 Version: 1.14.0 715
## Page 716

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.2.1.1.3 FB_BA_AC_Col T_02 The template represents the open-loop and closed-loop control of a cold water air cooler without dehumidification control. The main tasks of the template are: • Control of the supply air temperature, see TSu ACtrl • Control of the cooler valve, see Vlv • Collecting and evaluating safety-relevant faults using the Plant Lock • To be part of the step sequence control of an air conditioning system, see Aggregates Principle diagram 01 The diagram shows the intended use of the template with the plant elements involved. 716 Version: 1.14.0 TF8040
## Page 717

Programming Principle diagram 02 The diagram shows the integration of the template within a plant. The initialization of the template takes place within the method FB_Init. Block diagram TF8040 Version: 1.14.0 717
## Page 718

Programming Syntax FUNCTION_BLOCK FB_BA_AC_Col T_02 EXTENDS FB_BA_View VAR_INPUT f Sp TSu A : REAL; f TSu A : REAL; b Sync TSu ACtrl : BOOL; f Sync TSu ACtrl : REAL; END_VAR VAR_OUTPUT f Present Value : REAL; b Active Seq Ctrl : BOOL; END_VAR VAR_IN_OUT st TSeq Link : ST_BA_Seq Link; st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT TFl : FB_BA_Sensor Analog; TRt : FB_BA_Sensor Analog; TSu ACtrl : FB_BA_AC_Col TSu ACtrl; Vlv : FB_BA_Vlv; Plant Lock : FB_BA_Plant Lock; Aggregate : FB_BA_Aggregate; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; Prio Swi Val : FB_BA_Prio Swi_B04; END_VAR Inputs Name Type Description f Sp TSu A REAL Setpoint of the supply air temperature f TSu A REAL Measured value of the supply air temperature b Sync TSu ACtrl BOOL Input for synchronization of the supply air sequence controller in the function block TSu ACtrl. f Sync TSu ACtrl REAL Synchronization value for the supply air sequence controller in the function block TSu ACtrl. Outputs Name Type Description f Present Value REAL Current value of the cooler valve. b Active Seq Ctrl BOOL Indicates that the sequence controller of the cooler is the active one in the sequence control. Inputs/outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] The data and command structure is the link between the supply air temperature sequence controller Ctrl and the supply air temperature sequence controller TSeq Link of an air conditioning system. st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. 718 Version: 1.14.0 TF8040
## Page 719

Programming Inputs CONSTANT Name Type Description TFl FB_BA_Sensor Analog The function block represents the flow temperature sensor. [} 1087] TRt FB_BA_Sensor Analog The function block represents the return temperature sensor. [} 1087] TSu ACtrl FB_BA_AC_Col TSu ACtrl The function block represents the supply air temperature control of the cooler and is part of the temperature [} 710] sequence control of an air conditioning system. The control signal is forwarded to the valve Vlv. Vlv FB_BA_Vlv [} 1092] The function block represents the valve. Plant Lock FB_BA_Plant Lock [} 135] When the function block is called, the relevant faults of the event-enabled objects are collected and output at this and lower levels of the template. These relevant faults cause specific switching actions via the variables b Prio Sfty and b Prio Crit in the template. The parameterization of the lock priority of the event- enabled objects can be found in the FB_init of this template. Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. Prio Swi Val FB_BA_Prio Swi_B04 [} 433] The priority switch Prio Swi Val determines the switching conditions and enables for the supply air temperature control TSu ACtrl using the aggregate function block Aggregate and the global variable list Priority [} 1119]. 6.1.4.2.1.1.2.2 Damper 6.1.4.2.1.1.2.2.1 FB_BA_AC_Dmp2P The aggregate template represents the control of a two-point damper with integrated monitoring of both end positions. TF8040 Version: 1.14.0 719
## Page 720

Programming Typical applications of the template are the fresh air and exhaust air dampers of an air conditioning system. An essential component of the damper control is the template FB_BA_Actuator Cmd [} 986] The damper is integrated into the system control program of the ventilation system using the function block Aggregate. Each template is available in 2 different configurations regarding the connection to the I/O process level, see I/O mapping. This documentation refers to the RAW variant. The initialization of the template takes place within the method FB_Init. Block diagram Principle diagram 01 The diagram shows the intended use of the template with the plant elements involved. 720 Version: 1.14.0 TF8040
## Page 721

Programming Principle diagram 02 The diagram shows the integration of the template within a plant. Syntax FUNCTION_BLOCK FB_BA_AC_Dmp2P EXTENDS FB_BA_Actuator Cmd VAR_INPUT b Fan : BOOL; END_VAR VAR_OUTPUT b Swi Opn : BOOL; b Swi Cls : BOOL; END_VAR VAR_IN_OUT st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT Swi Opn : FB_BA_BI_Raw; Swi Cls : FB_BA_BI_Raw; Monit Open : FB_BA_Fdb Binary; Monit Close : FB_BA_Fdb Binary; Aggregate : FB_BA_Aggregate; END_VAR VAR Prio Swi Fan : FB_BA_Prio Swi_B04; END_VAR Inputs Name Type Description b Fan BOOL The "Fan On" input signal is used within a ventilation and air conditioning system to protect the connected damper. As long as the input signal "Fan On" is TRUE, the priority "Critical" is enabled on the priority switch Prio Swi Fan within the template and the damper is switched on. TF8040 Version: 1.14.0 721
## Page 722

Programming Outputs Name Type Description b Swi Opn BOOL End position "open" of the damper has been reached. b Swi Cls BOOL End position "closed" of the damper has been reached. Inputs/outputs Name Type Description st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. Inputs CONSTANT Name Type Description Swi Opn FB_BA_BI_Raw [} 206] Binary input object is used to process the Open limit switch. Swi Cls FB_BA_BI_Raw [} 206] Binary input object is used to process the limit switch Closed. Monit Opn FB_BA_Fdb Ctrl Binary The template monitors the end position “open” of the damper. [} 467] Monit Cls FB_BA_Fdb Ctrl Binary The template monitors the end position “Closed” of the damper. [} 467] Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. Variables Name Type Description Prio Swi Fan FB_BA_Prio Swi_B04 [} 433] The priority switch Prio Swi Fan uses the aggregate function block Aggregate and the input variable b Fan to determine the enable conditions and switch-on values for the priority critical of the damper. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 722 Version: 1.14.0 TF8040
## Page 723

Programming 6.1.4.2.1.1.2.3 ERC 6.1.4.2.1.1.2.3.1 FB_BA_AC_Erc TSu ACtrl The template represents the supply air temperature control of an energy recovery system with the sequence controller Ctrl. The sequence controller is enabled via the input variable b En. If the control direction of the energy recovery system is indirect (heating mode) and the air conditioning system is in dehumidification mode b Dehumf at the same time, energy recovery is blocked. The sequence controllers are enabled for sequence control using the st Seq Link data and command structure. This is indicated by the variable b Seq Actv. Control direction The control direction of the sequence controller Ctrl is selected based on a comparison of the outside temperature with the extract air temperature. If the outside temperature is lower than the extract air temperature, the control direction of the sequence controller Ctrl is indirect (heating mode), see E_BA_Action. If the outside temperature is higher than the extract air temperature, the control direction of the sequence controller Ctrl is direct (cooling mode), see E_BA_Action. TF8040 Version: 1.14.0 723
## Page 724

Programming The initialization of the template takes place within the method FB_Init. 724 Version: 1.14.0 TF8040
## Page 725

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_Erc TSu ACtrl EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f Sp TSu A : REAL; f TSu A : REAL; b Sync : BOOL; f Sync : REAL; b Dehumf : BOOL; f TExt A : REAL; f TWth : REAL; END_VAR VAR_OUTPUT f Y : REAL; e Action : E_BA_Action; b Is Active : BOOL; b Seq Actv : BOOL; END_VAR VAR_IN_OUT st Seq Link : ST_BA_Seq Link; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Category' := 'Behaviour'} f Hys Action On : REAL := 0.25; {attribute 'parameter Category' := 'Behaviour'} TF8040 Version: 1.14.0 725
## Page 726

Programming f Hys Action Off : REAL := -0.25; END_VAR VAR_INPUT CONSTANT Ctrl : FB_BA_Seq Ctrl; END_VAR VAR Hys Action : FB_BA_Swi2P; END_VAR Inputs Name Type Description b En BOOL Enable for the frequency controller Ctrl. f Sp TSu A REAL Setpoint of the supply air temperature. f TSu A REAL Measured value of the supply air temperature. b Sync BOOL Pulse for synchronization of the sequence controller Ctrl. f Sync REAL Value for the synchronization of the sequence controller Ctrl. b Dehumf BOOL Indicates with a TRUE that the air conditioning system is in dehumidification mode. f TExt A REAL Measured value extract air temperature f TWth REAL Measured value weather temperature Outputs Name Type Description f Y REAL Control value output e Action E_BA_Action The output of the control direction of the supply air controller Ctrl is required within an air conditioning system for the setpoint strategy. b Is Active BOOL The sequence controller is the active one in the sequence control. b Seq Actv BOOL The sequence controller is implemented in the control sequence. Inputs/outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] The data and command structure is the link between the supply air temperature sequence controller Ctrl and the supply air temperature sequence controller TSeq Link of an air conditioning system. Inputs CONSTANT PERSISTENT Name Type Description f Hys Action On REAL Upper switching point of the hysteresis Hys Action to determine the control direction of the supply air controller Ctrl. f Hys Action Off REAL Lower switching point of the hysteresis Hys Action to determine the control direction of the supply air controller Ctrl. 726 Version: 1.14.0 TF8040
## Page 727

Programming Inputs CONSTANT Name Type Description Ctrl FB_BA_Seq Ctrl [} 168] The supply air temperature sequence controller Ctrl is the core of this template. It is responsible for the supply air temperature control of the cooler. The sequence controller is also part of the supply air temperature sequence control of an air conditioning system, see sample FB_BA_AC_Seq T [} 778]. The data exchange within this sequence control takes place via the data and command structure st Seq Link. The global variable E_BA_AC_Seq Number_T.e Energy Recovery [} 697] gives the sequence controller its sequence number within the temperature sequence control. Variables Name Type Description Hys Action FB_BA_Swi2P The two-position switch determines the control direction of the sequence controller depending on the outside temperature f TWth and the extract air temperature f TExt A and the switching points of the hysteresis f Hys Action On/ f Hys Action Off. If the subtraction of the outside temperature f TWth and the extract air temperature f TExt A > f Hys Action On, then the output of the function block Hys Action is TRUE. The control direction of the sequence controller Ctrl is therefore direct and energy recovery is in cooling mode. If the subtraction of the outside temperature f TWth and the extract air temperature f TExt A < f Hys Action Off, then the output of the function block Hys Action is FALSE. The control direction of the sequence controller Ctrl is therefore indirect and energy recovery is in heating mode. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.2.3.2 Plate 6.1.4.2.1.1.2.3.2.1 FB_BA_AC_Erc Pl_01 TF8040 Version: 1.14.0 727
## Page 728

Programming The template represents the open-loop and closed-loop control of an energy recovery system with plate heat exchanger. The main tasks of the template are: • Control of the supply air temperature • Minimum limitation of exhaust air temperature • Anti-icing of the heat exchanger by means of a differential pressure sensor above the heat exchanger • Control of a bypass damper system • Collecting and evaluating safety-relevant faults using the Plant Lock • To be part of the step sequence control of an air conditioning system, see Aggregates The exhaust air minimum limiter TExh ACtrl and the frost protection program Ice Prtc Diff Prss Ctrl limit the control value of the temperature sequence controller TSu ACtrl of the energy recovery system via a minimum selection to prevent the heat exchanger from icing up. Principle diagram 01 The diagram shows the intended use of the template with the plant elements involved. 728 Version: 1.14.0 TF8040
## Page 729

Programming Principle diagram 02 The diagram shows the integration of the template within a plant. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 729
## Page 730

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_Erc Pl_01 EXTENDS FB_BA_View VAR_INPUT f Sp TSu A : REAL; f TSu A : REAL; b Sync TSu ACtrl : BOOL; f Sync TSu ACtrl : REAL; b Dehumf : BOOL; f TExh A : REAL; f TExt A : REAL; f TWth : REAL; END_VAR VAR_OUTPUT f Present Value : REAL; e Action : E_BA_Action; b Active Seq Ctrl : BOOL; END_VAR VAR_IN_OUT st TSeq Link : ST_BA_Seq Link; st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT TSu ACtrl : FB_BA_AC_Pre Htr TSu ACtrl; TExh ACtrl : FB_BA_PID_Sp; Dmp : FB_BA_Actuator Analog; Diff Prss Sensor : FB_BA_Sensor Analog; Damping : FB_BA_Filter PT1; Ice Prtc Diff Prss Ctrl : FB_BA_PID_Sp; Plant Lock : FB_BA_Plant Lock; Aggregate : FB_BA_Aggregate; END_VAR VAR b Prio Sfty : BOOL; 730 Version: 1.14.0 TF8040
## Page 731

Programming b Prio Crit : BOOL; Prio Swi Val : FB_BA_Prio Swi_B04; END_VAR Inputs Name Type Description f Sp TSu A REAL Setpoint of the supply air temperature f TSu A REAL Measured value of the supply air temperature b Sync TSu ACtrl BOOL Pulse for synchronization of the sequence controller TSu ACtrl. f Sync TSu ACtrl REAL Value for the synchronization of the supply air sequence controller TSu ACtrl. b Dehumf BOOL Input dehumidification mode active. This state has an effect on the sequence control in the supply air temperature control TSu ACtrl template. f TExh A REAL Measured value exhaust air temperature f TExt A REAL Measured value extract air temperature f TWth REAL Measured value weather temperature Outputs Name Type Description f Present Value REAL Current value of the bypass damper system e Action E_BA_Action The output of the control direction of the supply air controller TSu ACtrl is required within an air conditioning system for the setpoint strategy. b Active Seq Ctrl BOOL The sequence controller TSu ACtrl is the active one in the sequence control. Inputs/outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] The data and command structure is the link between the supply air temperature sequence controller Ctrl and the supply air temperature sequence controller TSeq Link of an air conditioning system. st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. TF8040 Version: 1.14.0 731
## Page 732

Programming Inputs CONSTANT Name Type Description TSu ACtrl FB_BA_AC_Pre Htr TSu ACtrl The function block represents the supply air temperature control of energy recovery and is part of the temperature [} 746] sequence control of an air conditioning system. The control signal is forwarded to the analog control of damper Dmp via a minimum selection. TExh ACtrl FB_BA_PID_Sp [} 1035] The function block represents the exhaust air temperature control for the anti-icing of the plate heat exchanger. Dmp FB_BA_Actuator Analog The function block is used to control the analog damper of the plate heat exchanger. [} 982] Diff Prss Sensor FB_BA_Sensor Analog The analog input object represents a differential pressure sensor above the heat exchanger. This is the control [} 1087] variable for the differential pressure control Ice Prtc Diff Prss Ctrl. Damping FB_BA_Filter PT1 [} 1003] The function block is used to damp the differential pressure sensor Diff Prss Sensor. Ice Prtc Diff Prss Ctrl FB_BA_PID_Sp [} 1035] The function block represents the differential pressure control for the anti-icing of the heat exchanger. Plant Lock FB_BA_Plant Lock [} 135] When the function block is called, the relevant faults of the event-enabled objects are collected and output at this and lower levels of the template. These relevant faults cause specific switching actions via the variables b Prio Sfty and b Prio Crit in the template. The parameterization of the lock priority of the event- enabled objects can be found in the FB_init of this template. Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the Safety lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. b Prio Crit BOOL The variable is an evaluation of the Critical lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. Prio Swi Val FB_BA_Prio Swi_B04 [} 433] The priority switch Prio Swi Val determines the switching conditions and enables for the supply air temperature control TSu ACtrl and the differential pressure control for anti-icing Ice Prtc Diff Prss Ctrl using the aggregate function block Aggregate and the global variable list Priority [} 1119]. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 732 Version: 1.14.0 TF8040
## Page 733

Programming 6.1.4.2.1.1.2.3.2.2 FB_BA_AC_Erc Pl_02 The template represents the open-loop and closed-loop control of an energy recovery system with a plate heat exchanger. The main tasks of the template are: • Control of the supply air temperature • Minimum limitation of exhaust air temperature • Anti-icing of the heat exchanger by means of a differential pressure monitor above the heat exchanger • Control of a damper • Control of a bypass damper • Collecting and evaluating safety-relevant faults using the Plant Lock • To be part of the step sequence control of an air conditioning system, see Aggregates The exhaust air minimum limiter TExh ACtrl and the frost protection program Ice Prtc Ramp limit the control value of the temperature sequence controller TSu ACtrl of the energy recovery system via a minimum selection to prevent the heat exchanger from icing up. Principle diagram 01 The diagram shows the intended use of the template with the plant elements involved. TF8040 Version: 1.14.0 733
## Page 734

Programming Principle diagram 02 The diagram shows the integration of the template within a plant. The initialization of the template takes place within the method FB_Init. 734 Version: 1.14.0 TF8040
## Page 735

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_Erc Pl_02 EXTENDS FB_BA_View VAR_INPUT f Sp TSu A : REAL; f TSu A : REAL; b Sync TSu ACtrl : BOOL; f Sync TSu ACtrl : REAL; b Dehumf : BOOL; f TExh A : REAL; f TExt A : REAL; f TWth : REAL; END_VAR VAR_OUTPUT f Present Value : REAL; e Action : E_BA_Action; b Active Seq Ctrl : BOOL; END_VAR VAR_IN_OUT st TSeq Link : ST_BA_Seq Link; END_VAR VAR_INPUT CONSTANT TSu ACtrl : FB_BA_AC_Pre Htr TSu ACtrl; TExh ACtrl : FB_BA_PID_Sp; Diff Prss Swi : FB_BA_Sensor Binary; Ice Prtc Ramp : FB_BA_PID_Sp; Dmp : FB_BA_Actuator Analog; By Dmp : FB_BA_Actuator Analog; TF8040 Version: 1.14.0 735
## Page 736

Programming Plant Lock : FB_BA_Plant Lock; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; Prio Swi Val : FB_BA_Prio Swi_B04; Inv : FB_BA_Chrct02; END_VAR Inputs Name Type Description f Sp TSu A REAL Setpoint of the supply air temperature f TSu A REAL Measured value of the supply air temperature b Sync TSu ACtrl BOOL Pulse for synchronization of the sequence controller TSu ACtrl. f Sync TSu ACtrl REAL Value for the synchronization of the supply air sequence controller TSu ACtrl. b Dehumf BOOL Input dehumidification mode active. This state has an effect on the sequence control in the supply air temperature control TSu ACtrl template. f TExh A REAL Measured value exhaust air temperature f TExt A REAL Measured value extract air temperature f TWth REAL Measured value weather temperature Outputs Name Type Description f Present Value REAL Current value of the bypass damper system e Action E_BA_Action The output of the control direction of the supply air controller TSu ACtrl is required within an air conditioning system for the setpoint strategy. b Active Seq Ctrl BOOL The sequence controller TSu ACtrl is the active one in the sequence control. Inputs/outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] The data and command structure is the link between the supply air temperature sequence controller Ctrl and the supply air temperature sequence controller TSeq Link of an air conditioning system. st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. 736 Version: 1.14.0 TF8040
## Page 737

Programming Inputs CONSTANT Name Type Description TSu ACtrl FB_BA_AC_Pre Htr TSu ACtrl The function block represents the supply air temperature control of energy recovery and is part of the temperature [} 746] sequence control of an air conditioning system. The control signal is forwarded to the analog control of damper Dmp via a minimum selection. TExh ACtrl FB_BA_PID_Sp [} 1035] The function block represents the exhaust air temperature control for the anti-icing of the plate heat exchanger. Diff Prss Swi FB_BA_Sensor Binary The binary input object represents a differential pressure monitor above the heat exchanger. This is used for anti- [} 1088] icing and activates the ramp function Ice Prtc Ramp. Ice Prtc Ramp FB_BA_Ramp Limit Increase The function block represents the anti-icing of the plate heat exchanger using an increasing ramp function. This [} 1040] function is activated by means of the differential pressure monitor Diff Prss Swi. Dmp FB_BA_Actuator Analog The function block is used to control the analog damper of the plate heat exchanger. [} 982] By Dmp FB_BA_Actuator Analog The function block is used to control the analog bypass damper of the plate heat exchanger. [} 982] Plant Lock FB_BA_Plant Lock [} 135] When the function block is called, the relevant faults of the event-enabled objects are collected and output at this and lower levels of the template. These relevant faults cause specific switching actions via the variables b Prio Sfty and b Prio Crit in the template. The parameterization of the lock priority of the event- enabled objects can be found in the FB_init of this template. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the Safety lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. b Prio Crit BOOL The variable is an evaluation of the Critical lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. Prio Swi Val FB_BA_Prio Swi_B04 [} 433] The priority switch Prio Swi Val determines the switching conditions and enables for the supply air temperature control TSu ACtrl and the differential pressure control for anti-icing Ice Prtc Diff Prss Ctrl using the aggregate function block Aggregate and the global variable list Priority [} 1119]. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 737
## Page 738

Programming 6.1.4.2.1.1.2.3.3 Rotation 6.1.4.2.1.1.2.3.3.1 FB_BA_AC_Erc Rot_01 The template represents the open-loop and closed-loop control of an energy recovery system with a rotary heat exchanger. The main tasks of the template are: • Control of the supply air temperature • Minimum limitation of exhaust air temperature • Anti-icing of the heat exchanger by means of a differential pressure monitor • Control of the rotary heat exchanger motor • Collecting and evaluating safety-relevant faults using the Plant Lock • To be part of the step sequence control of an air conditioning system, see Aggregates The exhaust air minimum limiter TExh ACtrl and the frost protection program Ice Prtc Ramp limit the control value of the temperature sequence controller TSu ACtrl of the energy recovery system via a minimum selection to prevent the heat exchanger from icing up. Principle diagram 01 The diagram shows the intended use of the template with the plant elements involved. 738 Version: 1.14.0 TF8040
## Page 739

Programming Principle diagram 02 The diagram shows the integration of the template within a plant. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 739
## Page 740

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_Erc Rot_01 EXTENDS FB_BA_View VAR_INPUT f Sp TSu A : REAL; f TSu A : REAL; b Sync TSu ACtrl : BOOL; f Sync TSu ACtrl : REAL; b Dehumf : BOOL; f TExh A : REAL; f TExt A : REAL; f TWth : REAL; END_VAR VAR_OUTPUT f Present Value : REAL; e Action : E_BA_Action; b Active Seq Ctrl : BOOL; END_VAR VAR_IN_OUT st TSeq Link : ST_BA_Seq Link; st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT TSu ACtrl : FB_BA_AC_Pre Htr TSu ACtrl; TExh ACtrl : FB_BA_PID_Sp; Diff Prss Swi : FB_BA_Sensor Binary; Ice Prtc Ramp : FB_BA_Ramp Limit Increase; Motor : FB_BA_Mot Mdlt; Plant Lock : FB_BA_Plant Lock; 740 Version: 1.14.0 TF8040
## Page 741

Programming Aggregate : FB_BA_Aggregate; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; Prio Swi Val : FB_BA_Prio Swi_B04; END_VAR Inputs Name Type Description f Sp TSu A REAL Setpoint of the supply air temperature f TSu A REAL Measured value of the supply air temperature b Sync TSu ACtrl BOOL Pulse for synchronization of the sequence controller TSu ACtrl. f Sync TSu ACtrl REAL Value for the synchronization of the supply air sequence controller TSu ACtrl. b Dehumf BOOL Input dehumidification mode active. This state has an effect on the sequence control in the supply air temperature control TSu ACtrl template. f TExh A REAL Measured value exhaust air temperature f TExt A REAL Measured value extract air temperature f TWth REAL Measured value weather temperature Outputs Name Type Description f Present Value REAL Current value of the bypass damper system e Action E_BA_Action The output of the control direction of the supply air controller TSu ACtrl is required within an air conditioning system for the setpoint strategy. b Active Seq Ctrl BOOL The sequence controller TSu ACtrl is the active one in the sequence control. Inputs/outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] The data and command structure is the link between the supply air temperature sequence controller Ctrl and the supply air temperature sequence controller TSeq Link of an air conditioning system. st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. TF8040 Version: 1.14.0 741
## Page 742

Programming Inputs CONSTANT Name Type Description TSu ACtrl FB_BA_AC_Pre Htr TSu ACtrl The function block represents the supply air temperature control of energy recovery and is part of the temperature [} 746] sequence control of an air conditioning system. The control signal is forwarded to the analog control of damper Dmp via a minimum selection. TExh ACtrl FB_BA_PID_Sp [} 1035] The function block represents the exhaust air temperature control for the anti-icing of the plate heat exchanger. Diff Prss Swi FB_BA_Sensor Binary The binary input object represents a differential pressure monitor above the heat exchanger. This is used for anti- [} 1088] icing and activates the ramp function Ice Prtc Ramp. Ice Prtc Ramp FB_BA_Ramp Limit Increase The function block represents the anti-icing of the rotary heat exchanger using an increasing ramp function. This [} 1040] function is activated by means of the differential pressure monitor Diff Prss Swi. Motor FB_BA_Mot Mdlt [} 1070] The function block is used to control a frequency converter. This then controls the motor of the rotary heat exchanger. Plant Lock FB_BA_Plant Lock [} 135] When the function block is called, the relevant faults of the event-enabled objects are collected and output at this and lower levels of the template. These relevant faults cause specific switching actions via the variables b Prio Sfty and b Prio Crit in the template. The parameterization of the lock priority of the event- enabled objects can be found in the FB_init of this template. Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the Safety lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. b Prio Crit BOOL The variable is an evaluation of the Critical lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. Prio Swi Val FB_BA_Prio Swi_B04 [} 433] The priority switch Prio Swi Val determines the switching conditions and enables for the supply air temperature control TSu ACtrl and the differential pressure control for anti-icing Ice Prtc Diff Prss Ctrl using the aggregate function block Aggregate and the global variable list Priority [} 1119]. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 742 Version: 1.14.0 TF8040
## Page 743

Programming 6.1.4.2.1.1.2.4 Fan 6.1.4.2.1.1.2.4.1 FB_BA_AC_Fan Ctl The aggregate template represents the control and regulation of a pressure-controlled fan. Typical applications for this template are the supply and exhaust air fans of an air conditioning system with variable volume flow rate. The basic template FB_BA_Mot Ctl [} 1066] is extended by two binary inputs for detecting an additional fault and a maintenance switch. The input b Damper Open prevents the fan from starting when the damper is closed. The pressure-controlled fan is integrated into the control program of the air conditioning system using the function block Aggregate and the inputs and outputs structure st Aggregate [} 278]. Each template is available in 2 different configurations regarding the connection to the I/O process level, see I/O mapping. This documentation refers to the RAW variant. The initialization of the template takes place within the method FB_Init. Principle diagram 01 The diagram shows the intended use of the template with the plant elements involved. Principle diagram 02 The diagram shows the integration of the template within a plant. TF8040 Version: 1.14.0 743
## Page 744

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_Fan Ctl EXTENDS FB_BA_Mot Ctl VAR_INPUT b Damper Open : BOOL; END_VAR VAR_IN_OUT st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT Th Ovrld : FB_BA_BI_Raw; Mntn Swi : FB_BA_BI_Raw; Aggregate : FB_BA_Aggregate; END_VAR VAR Prio Swi Damper : FB_BA_Prio Swi_UDI04; END_VAR 744 Version: 1.14.0 TF8040
## Page 745

Programming Inputs Name Type Description b Damper Open BOOL The input signal "Damper open" is used within a air conditioning system to protect the connected damper. As long as the input signal "Damper open" is not TRUE, the priority "Critical" is enabled on the priority switch Prio Swi Damper within the template and the fan is switched off. Inputs/outputs Name Type Description st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. Inputs CONSTANT Name Type Description Th Ovrld FB_BA_BI_Raw [} 206] The binary input object is used to process the "Thermal overload" fault. Mntn Swi FB_BA_BI_Raw [} 206] The binary input object is used to process a maintenance switch. Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. Variables Name Type Description Prio Swi Damper FB_BA_Prio Swi_UDI04 The priority switch Prio Swi Damper uses the aggregate function block Aggregate and the input variable [} 433] b Damper Open to determine the enable conditions and switch-on values for the priority "Critical" of the fan. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 TF8040 Version: 1.14.0 745
## Page 746

Programming 6.1.4.2.1.1.2.5 Pre Heater 6.1.4.2.1.1.2.5.1 FB_BA_AC_Pre Htr TSu ACtrl The template represents the supply air temperature control of a preheater in a ventilation system. The supply air controller Ctrl is the core of the template. It is integrated into a supply air temperature control sequence. The sequence controller is enabled using the input variable b En and the variable st Seq Link.b En Seq Link of the data and command structure st Seq Link. In dehumidification mode b Dehumf, the sequence controller Ctrl is disabled and thus removed from the sequence control. The sequence controllers are enabled for sequence control via the data and command structure st Seq Link. This is indicated by the variable b Seq Actv. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Actuator Analog EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f Sp TSu A : REAL; f TSu A : REAL; b Sync : BOOL; f Sync : REAL; b Dehumf : BOOL; b Reset Dehumf : BOOL; END_VAR VAR_OUTPUT 746 Version: 1.14.0 TF8040
## Page 747

Programming f Y : REAL; b Is Active : BOOL; b Seq Actv : BOOL; END_VAR VAR_IN_OUT st Seq Link : ST_BA_Seq Link; END_VAR VAR_INPUT CONSTANT Ctrl : FB_BA_Seq Ctrl; END_VAR VAR sr Dehumf : SR; ftrig De Hum : F_TRIG; rtrig Sync : R_TRIG; Prio Swi Sync : FB_BA_Prio Swi_R04; END_VAR Inputs Name Type Description b En BOOL Enable the sequence controller Ctrl. f Sp TSu A REAL Setpoint of the supply air temperature. f TSu A REAL Measured value of the supply air temperature. b Sync BOOL Pulse for synchronization of the sequence controller Ctrl. f Sync REAL Value for the synchronization of the sequence controller Ctrl. b Dehumf BOOL Input to set the dehumidification mode on the RS flip-flop sr Dehumf. b Reset Dehumf BOOL Input to reset the dehumidification mode on the RS flip-flop sr Dehumf. Outputs Name Type Description f Y REAL Control value output control valve. b Is Active BOOL The sequence controller is the active one in the sequence control. b Seq Actv BOOL The sequence controller is implemented in the control sequence. Inputs/outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] The data and command structure st Seq Link is the link between the supply air temperature sequence controller Ctrl and the supply air temperature sequence control TSeq Link [} 778] of an air conditioning system. TF8040 Version: 1.14.0 747
## Page 748

Programming Inputs CONSTANT Name Type Description Ctrl FB_BA_Seq Ctrl The supply air temperature sequence controller Ctrl is the core of this template. It is responsible for the supply air temperature control of the preheater. The sequence controller is also part of the supply air temperature sequence control of an air conditioning system. The data exchange within this sequence control takes place via the data and command structure st Seq Link. The global variable E_BA_AC_Seq Number_T.e Pre Heater [} 697] gives the sequence controller its sequence number within the temperature sequence control. Variables Name Type Description sr Dehumf SR Setting the RS flip-flop sr Dehumf indicates that dehumidification mode is active within the air conditioning system. The sequence controller Ctrl is no longer enabled. The RS flip-flop sr Dehumf is reset via the input b Reset Dehumf. ftrig De Hum F_TRIG A falling edge at input CLK of the function block ftrig De Hum synchronizes the sequence controller Ctrl to the value 0. The falling edge is triggered by resetting the dehumidification mode on the RS flip-flop sr Dehumf. rtrig Sync R_TRIG On a rising edge at input CLK of the function block rtrig Sync, the sequence controller Ctrl is synchronized to the value of f Sync. Prio Swi Sync FB_BA_Prio Swi_R04 [} 433] The priority switch prioritizes the synchronization of the sequence controller Ctrl Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.2.5.2 FB_BA_AC_Pre Htr The template represents the open-loop and closed-loop control of a hot water air heater. 748 Version: 1.14.0 TF8040
## Page 749

Programming The main tasks of the template are: • Control of the supply air temperature (TSu ACtrl). • Control of the return temperature (TRt Ctrl). • Frost monitoring on the air side with frost protection thermostat (Frost Thermostat). • Frost monitoring air side with analog frost protection sensor (TFrost). • Enable the heater pump (Pu). • Control of the heater valve (Vlv). • Collecting and evaluating safety-relevant faults using the Plant Lock • To be part of the step sequence control of an air conditioning system, see Aggregates A maximum choice of control signals from the temperature sequence controller TSu ACtrl and the frost protection functions TFrost Prtc Ctrl Air / TRt Ctrl prevent the hot water air heater from icing up. The initialization of the template takes place within the method FB_Init. Principle diagram 01 The principle diagram shows the intended use of the template with the plant elements involved. TF8040 Version: 1.14.0 749
## Page 750

Programming Principle diagram 02 The diagram shows the integration of the template within a plant. 750 Version: 1.14.0 TF8040
## Page 751

Programming TF8040 Version: 1.14.0 751
## Page 752

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_Pre Htr EXTENDS FB_BA_View VAR_INPUT f Sp TSu A : REAL; f TSu A : REAL; b Sync TSu ACtrl : BOOL; f Sync TSu ACtrl : REAL; b Dehumf : BOOL; b Skip Pre Rinse : BOOL; f TWth : REAL; b TWth Low Limit : BOOL; b Reset Dehumf : BOOL; END_VAR VAR_OUTPUT b Cmd : BOOL; f Present Value : REAL; 752 Version: 1.14.0 TF8040
## Page 753

Programming b Frost : BOOL; b Pre Rinse Ready : BOOL; b Active Seq Ctrl : BOOL; END_VAR VAR_IN_OUT st TSeq Link : ST_BA_Seq Link; st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Category' := 'Behaviour'} f Hys Pu On : REAL := 5.0; {attribute 'parameter Category' := 'Behaviour'} f Hys Pu Off : REAL := 1.0; END_VAR VAR_INPUT CONSTANT TFl : FB_BA_Sensor Analog; TRt : FB_BA_Sensor Analog; TSu ACtrl : FB_BA_AC_Pre Htr TSu ACtrl; TRt Ctrl : FB_BA_AC_TRt Ctrl; TFrost : FB_BA_Sensor Analog; TFrost Prtc Ctrl Air : FB_BA_PID_Sp; Frost Thermostat : FB_BA_Sensor Binary; Vlv : FB_BA_Vlv; Pu : FB_BA_Pu1st; Plant Lock : FB_BA_Plant Lock; Aggregate : FB_BA_Aggregate; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; Prio Swi Val : FB_BA_Prio Swi_B04; Hys Pu : FB_BA_Swi2P; Sync TSu ACtrl : FB_BA_RFTrig; Sync Seq Ctrl Is Active : FB_BA_RFTrig; Prio Swi Sync : FB_BA_Prio Swi_R04; END_VAR Inputs Name Type Description f Sp TSu A REAL Setpoint of the supply air temperature f TSu A REAL Measured value of the supply air temperature b Sync TSu ACtrl BOOL Input for synchronization of the supply air sequence controller in the function block TSu ACtrl. f Sync TSu ACtrl REAL Synchronization value for the supply air sequence controller in the function block TSu ACtrl. b Dehumf BOOL Input dehumidification mode active. This state has an effect on the sequence control in the supply air temperature control TSu ACtrl template. b Skip Pre Rinse BOOL Input to skip the pre-rinse process in the function block TRt Ctrl. f TWth REAL Measured value weather temperature b TWth Low Limit BOOL The variable indicates that the outside temperature has fallen below the lower limit value. The following actions are triggered when the outside temperature falls below a critical value: • Heater pump activation, forced pump operation • Enabling the return temperature control in the function block TRt Ctrl • During plant start-up, pre-rinse mode is active in the function block TRt Ctrl b Reset Dehumf BOOL Input to reset the dehumidification mode in the template TSu ACtrl. TF8040 Version: 1.14.0 753
## Page 754

Programming Outputs Name Type Description b Cmd BOOL Current switching status of the single-stage pump. f Present Value REAL Current control value of the heater valve. b Frost BOOL Frost protection active display. The message is triggered either by the frost protection thermostat Frost Thermostat or by falling below the lower limit value of the analog frost protection sensor TFrost. The signal Frost protection active triggers the plant operation mode Frost protection in the template FB_BA_AC_Op Mod1St_Prio [} 763]. b Pre Rinse Ready BOOL Display, pre-rinse process has reached set temperature. This signal is used as a switching condition for the step sequence control of a ventilation system. b Active Seq Ctrl BOOL Indicates that the sequence controller TSu ACtrl is the active one in the sequence control. Inputs/outputs Name Type Description st Seq Link ST_BA_Seq Link [} 123] The data and command structure is the link between the supply air temperature sequence controller Ctrl and the supply air temperature sequence controller TSeq Link of an air conditioning system. st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. Inputs CONSTANT PERSISTENT Name Type Description f Hys Pu On REAL Upper switching point of the hysteresis to switch on the pump. f Hys Pu Off REAL Lower switching point of the hysteresis to switch off the pump. 754 Version: 1.14.0 TF8040
## Page 755

Programming Inputs CONSTANT Name Type Description TFl FB_BA_Sensor Analog The function block represents the flow temperature sensor. [} 1087] TRt FB_BA_Sensor Analog The function block represents the return temperature sensor. [} 1087] TSu ACtrl FB_BA_AC_Pre Htr TSu ACtrl The function block represents the supply air temperature control of a preheater and is part of the temperature [} 746] sequence control of an air conditioning system. The control signal is forwarded to the heater valve Vlv via a maximum selection. TRt Ctrl FB_BA_AC_TRt Ctrl [} 756] The function block represents the open-loop and closed- loop control of the return temperature of a hot water air heater. The control signal is forwarded to the heater valve Vlv via a maximum selection. TFrost FB_BA_Sensor Analog The function block represents a frost protection sensor on the air side. [} 1087] TFrost Prtc Ctrl Air FB_BA_PID_Sp [} 1035] The function block represents the analog frost protection monitoring on the air side of the preheater. The control signal is forwarded to the heater valve Vlv via a maximum selection. Frost Thermostat FB_BA_Sensor Binary The function block represents a frost protection thermostat. [} 1088] Vlv FB_BA_Vlv [} 1092] The function block represents the heater valve. Pu FB_BA_Pu1st [} 1074] The function block represents the heater pump. Plant Lock FB_BA_Plant Lock [} 135] When the function block is called, the relevant faults of the event-enabled objects are collected and output at this and lower levels of the template. These relevant faults cause specific switching actions via the variables b Prio Sfty and b Prio Crit in the template. The event-enabled objects of the template that trigger faults with b Prio Crit are listed below. TRt. MV, TFrost. MV, Frost Thermostat. Input, Pu. Dst The parameterization of the lock priority of the event- enabled objects can be found in the FB_init of this template. Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. TF8040 Version: 1.14.0 755
## Page 756

Programming Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the event-enabled objects in the project structure and causes targeted switching actions in the template when a relevant fault is triggered. Prio Swi Val FB_BA_Prio Swi_B04 [} 433] The priority switch uses the command structure st Cmd to determine the enable conditions for the supply air temperature control TSu ACtrl and for the pre-rinse process of the return air temperature control TRt Ctrl. Hys Pu FB_BA_Swi2P The two-position switch switches the heater pump on and off depending on the valve position f Present Value and the switching point of the hysteresis f Hys Pu On/f Hys Pu Off. Sync TSu ACtrl FB_BA_RFTrig A rising edge at the input b Value of the function block synchronizes the supply air temperature control TSu ACtrl to the value of f Sync TSu ACtrl. Sync Seq Ctrl Is Active FB_BA_RFTrig The variable TSu ACtrl.b Seq Actv indicates that the sequence control is active. This rising edge triggers a pulse at the input b Value of the function block Sync Seq Ctrl Is Active. If the sequence controller of the preheater is the active one in the sequence control b Active Seq Ctrl and the lower limit of the outside temperature b TWth Low Limit is active, the pulse of Sync Seq Ctrl Is Active triggers a synchronization of the supply air temperature controller TSu ACtrl to the value of the valve position Vlv.f Mdlt. Prio Swi Sync FB_BA_Prio Swi_R04 [} 433] The priority switch prioritizes the synchronization of the supply air temperature control TSu ACtrl. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.2.5.3 FB_BA_AC_TRt Ctrl The template is used for open-loop and closed-loop control of the return temperature of a hot water air heater. To prevent frost damage, the heating coil of the ventilation system is first preheated with warm water when the outside temperature is low. To do this, the flip-flop rs Pre Rinse Active is first set in the template FB_BA_AC_TRt Ctrl. The return temperature controller Ctrl receives the pre-rinse setpoint from the setpoint curve Pre Rinse Sp via the selector. To prevent the heating coil from overheating during preheating, the pre-rinse setpoint is varied by 756 Version: 1.14.0 TF8040
## Page 757

Programming the characteristic curve Pre Rinse Sp depending on the outside temperature. When the desired return temperature is reached, the hysteresis module Pre Rinse Hys switches on. The flip-flop rs Pre Rinse Ready is then set. The system start program FB_BA_AC_Plant Cmd_AHU_1st_10 [} 786] is informed via the output b Pre Rinse Ready that it can continue with the next step, e.g. Opening the outdoor air damper. The flip-flop rs Pre Rinse Active remains set so that the pre-rinse setpoint is still present at the return temperature controller. If the system start program has switched on the fans and enabled the supply air temperature control in its subsequent steps, the flip-flop rs Pre Rinse Active is reset using the input b Seq Active. The pre-rinse process is now complete. For permanent frost protection operation of the heating coil during system operation and system standstill, the return temperature controller receives the reduced setpoint of the AV object Sp TRt W. The output b Q of the function block Pre Rinse Delay becomes TRUE if the pre-rinse process is started and the pre-rinse setpoint is not reached after a delay time has elapsed. The fault is reported using the BV object Pre Rinse Dst. The initialization of the template takes place within the method FB_Init. Block diagram TF8040 Version: 1.14.0 757
## Page 758

Programming Syntax FUNCTION_BLOCK FB_BA_Actuator Analog EXTENDS FB_BA_View VAR_INPUT b En Pre Rinse : BOOL; f TRt : REAL; b TWth Low Limit : BOOL; f TWth : REAL; b Skip Pre Rinse : BOOL; b Seq Active : BOOL; END_VAR VAR_OUTPUT f Y : REAL; b Pre Rinse Active : BOOL; b Pre Rinse Ready : BOOL; b Pre Rinse Dstb : BOOL; END_VAR VAR_INPUT CONSTANT Sp TRt W : FB_BA_AV_Op; Pre Rinse Delay : FB_BA_Dly On; Pre Rinse Dst : FB_BA_BV; Pre Rinse Sp : FB_BA_Scale_02; Ctrl : FB_BA_Loop; END_VAR VAR rtrig Pre Rinse : R_TRIG; rs Pre Rinse Ready : RS; rs Pre Rinse Active : RS; Pre Rinse Hys : FB_BA_Swi2P; END_VAR Inputs Name Type Description b En Pre Rinse BOOL Enabling the pre-rinse process. f TRt REAL Measured value of the return temperature of the hot water air heater. b TWth Low Limit BOOL The variable indicates that the outside temperature has fallen below the lower limit value. This state is used to enable the return temperature controller Ctrl. f TWth REAL Current value of the outside temperature. b Skip Pre Rinse BOOL Input for skipping the pre-rinse process. b Seq Active BOOL This input is used to inform the controller that the supply air temperature control of the ventilation has gone into operation or that the supply air temperature sequence controller has been enabled. Outputs Name Type Description f Y REAL Control value output of the return temperature controller Ctrl. b Pre Rinse Active BOOL Display, pre-rinse process active. b Pre Rinse Ready BOOL Display, pre-rinse process has reached set temperature. This signal is used as a switching condition for the step sequence control of a ventilation system, see sample FB_BA_AC_Plant Cmd_AHU_1st_10. b Pre Rinse Dstb BOOL Display, pre-rinse process faulty. 758 Version: 1.14.0 TF8040
## Page 759

Programming Inputs CONSTANT Name Type Description Sp TRt W FB_BA_AV_Op [} 202] The analog value object is used to enter the return temperature setpoint when there is a risk of frost or low outside temperatures. Pre Rinse Delay FB_BA_Dly On [} 1054] The template represents a start-up delay and triggers the message "Pre-rinse process faulty" at the object Pre Rinse Dst if the result of the pre-rinse hysteresis Pre Rinse Hys is not achieved. Pre Rinse Dst FB_BA_BV [} 213] The binary object displays the message "Pre-rinse process faulty". Pre Rinse Sp FB_BA_Scale_02 [} 1042] Template for calculating the pre-rinse setpoint as a function of the outside temperature f TWth for return temperature control during system start-up. Ctrl FB_BA_Loop [} 220] PID controller for controlling the return temperature of the heating coil. Variables Name Type Description rtrig Pre Rinse R_TRIG rtrig Pre Rinse activates the pre-rinse at the RS flip-flop rs Pre Rinse Active by a rising edge at input CLK. rs Pre Rinse Ready RS Setting the RS flip-flop indicates that the pre-rinse process has reached its set temperature. rs Pre Rinse Active RS The pre-rinse process is activated by setting the RS flip- flop. Pre Rinse Hys FB_BA_Swi2P The result of the pre-rinse hysteresis Pre Rinse Hys indicates that the pre-rinse process has reached its set temperature. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.3 General 6.1.4.2.1.1.3.1 FB_BA_AC_En Prio The template represents the system enable and the enable of the priorities Safty, Critcial and Program of an air conditioning system. The multiplexers Prio Swi Plt, Prio Swi Sfty, Prio Swi Crit and Prio Swi Pgm use the plant operation mode e Op Mode to define the system enable for activating the step sequence control of a system and enabling the priorities "Safety", "Critcial" and "Program", see command structure st Priority En. TF8040 Version: 1.14.0 759
## Page 760

Programming e Opmode Value Operation System sta- st Priori- st Priori- st Priori- st Priori- mode tus ty En.bp LT ty En.b En S- ty En.b En- ty En.b Pgm fty Crit E_BA_AC_ 1 Off Plant FALSE FALSE FALSE TRUE Op Mod01.e shutdown Off E_BA_AC_ 2 On Plant startup TRUE FALSE FALSE TRUE Op Mod01.e On E_BA_AC_ 3 Emergency Plant FALSE FALSE TRUE FALSE Op Mod01.e shutdown Emergency E_BA_AC_ 4 Frost Plant FALSE FALSE TRUE FALSE Op Mod01.e shutdown Frost E_BA_AC_ 5 Smoke Plant startup TRUE TRUE FALSE FALSE Op Mod01.e extraction Smoke Extra program ction Progra m E_BA_AC_ 6 Smoke Plant startup TRUE TRUE FALSE FALSE Op Mod01.e extraction Smoke Extra supply air ction Supply Air E_BA_AC_ 7 Smoke Plant startup TRUE TRUE FALSE FALSE Op Mod01.e extraction Smoke Extra exhaust air ction Exhaus t Air E_BA_AC_ 8 Fire Plant FALSE TRUE FALSE FALSE Op Mod01.e shutdown Fire E_BA_AC_ 9 Night Plant startup TRUE FALSE FALSE TRUE Op Mod01.e cooling Night Coolin g E_BA_AC_ 10 Support Plant startup TRUE FALSE FALSE TRUE Op Mod01.e operation, Cool Down Pr cooling otection protection E_BA_AC_ 11 Overheating Plant startup TRUE FALSE FALSE TRUE Op Mod01.e protection Over Heating Protection E_BA_AC_ 12 Fault Plant FALSE FALSE TRUE FALSE Op Mod01.e shutdown Alarm E_BA_AC_ 13 Forced Plant startup TRUE FALSE TRUE FALSE Op Mod01.e ventilation Forced Ventil ation E_BA_AC_ 14 Central Plant FALSE FALSE TRUE FALSE Op Mod01.e shutdown shutdown Central Switc h Off 760 Version: 1.14.0 TF8040
## Page 761

Programming The initialization of the template takes place within the method FB_Init. Block diagram Principle diagram The diagram shows the integration of the template within a plant. TF8040 Version: 1.14.0 761
## Page 762

Programming Syntax FUNCTION_BLOCK FB_BA_AC_En Prio VAR_INPUT e Op Mode : E_BA_AC_Op Mod01; END_VAR VAR_OUTPUT st Priority En : ST_BA_Priority En; END_VAR VAR Prio Swi Plt : FB_BA_MMUX_B24; Prio Swi Sfty : FB_BA_MMUX_B08; Prio Swi Crit : FB_BA_MMUX_B08; Prio Swi Pgm : FB_BA_MMUX_B08; END_VAR Inputs Name Type Description e Op Mode E_BA_AC_Op Mod01 Input of the current operation mode e Op Mode. [} 699] Outputs Name Type Description st Priority En ST_BA_Priority En [} 278] Output of the current command structure st Priority En. This includes the system enable for the step sequence control of an air conditioning system and the associated enables for the priorities "Safety", "Critical" and "Program". 762 Version: 1.14.0 TF8040
## Page 763

Programming Variables Name Type Description Prio Swi Plt FB_BA_MMUX_B24 [} 428] The multiplexer uses the plant operation mode e Op Mode to define the system enable for controlling the aggregates of a plant. Prio Swi Sfty FB_BA_MMUX_B08 [} 428] The multiplexer uses the plant operation mode e Op Mode to define the enable of the priority "Safety" for controlling the aggregates of a plant. Prio Swi Crit FB_BA_MMUX_B08 [} 428] The multiplexer uses the plant operation mode e Op Mode to define the enable of the priority "Critical" for controlling the aggregates of a plant. Prio Swi Pgm FB_BA_MMUX_B08 [} 428] The multiplexer uses the plant operation mode e Op Mode to define the enable of the priority "Program" for controlling the aggregates of a plant. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.3.2 FB_BA_AC_Op Mod1St The template represents the operation mode of an air conditioning system. The priority switch Prio Swi Op Mod prioritizes various events or commands such as fire alarms, requests from the time schedule or requests from the plant selector switch and writes a resulting operation mode or system status to the variable e Op Mode [} 699]. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 763
## Page 764

Programming Block diagram Principle diagram The diagram shows the integration of the template within a plant. 764 Version: 1.14.0 TF8040
## Page 765

Programming Syntax FUNCTION_BLOCK FB_BA_AC_Op Mod1St EXTENDS FB_BA_View VAR_INPUT b Sm Extt : BOOL; b Fire Detc : BOOL; b Forc Vent : BOOL; b Emg Off : BOOL; b Frst : BOOL; b Cent Swi Off : BOOL; b Alm Shut Off : BOOL; b Ngt Col : BOOL; b Col Dwn Prtc : BOOL; b Ovr Htg Prtc : BOOL; END_VAR VAR_OUTPUT e Op Mode : E_BA_AC_Op Mod01; END_VAR VAR_INPUT CONSTANT Op Mod Man : FB_BA_MV_Op; Sched : FB_BA_Sched M; Op Mod Pr : FB_BA_MV_Op; END_VAR VAR Prio Swi Op Mod : FB_BA_Prio Swi_UDI24; END_VAR Inputs Name Type Description b Sm Extt BOOL Smoke extraction of the plant requested b Fire Detc BOOL Fire alarm message from fire alarm center b Force Vent BOOL Forced ventilation request b Emg Off BOOL Emergency stop b Frst BOOL Frost protection program active b Cent Swi Off BOOL Central switch-off b Alm Shut Off BOOL Collective error message - shut down plant b Ngt Col BOOL Request from the summer night cooling program (see FB_BA_AC_Sum Ngt Col [} 783]) b Col Dwn Prtc BOOL Request program cooling protection b Ovr Htg Prtc BOOL Request program overheating protection Outputs Name Type Description e Op Mode E_BA_AC_Op Mod01 Output of the current operation mode e Op Mode [} 699] Inputs CONSTANT Name Type Description Op Mod Man FB_BA_MV_Op [} 239] The Multistate-Value object represents an operating modes switch with the operating modes Auto, Manual-Off and Manual-On. Sched FB_BA_Sched M [} 225] Schedule object (automatic) for the "Building Energy Level". Op Mod Pr FB_BA_MV_Op [} 239] The Multistate-Value object indicates the state of the currently valid plant operation mode. TF8040 Version: 1.14.0 765
## Page 766

Programming Variables Name Type Description Prio Swi Op Mod FB_BA_Prio Swi_UDI24 The priority switch determines the current operation mode e Op Mode from the pending events or commands of the [} 433] plant. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.3.3 FB_BA_AC_Op Mod Agg Binary The template serves as a link between steps within the step sequence control of an air conditioning system. The function block Step is the core of the template and represents the binary receive block of a step sequence controller. The connected aggregate receives its commands via the command structure st Cmd. The data exchange to the control block of the step sequence control (Step Ctrl Agg) takes place via the data and command structure st Step. The four multiplexers Op Mod Val, Delay On, Delay Off and Ignore Fdb define the switch-on and switch-off conditions of the plant step based on the plant operation mode e Op Mode. Each of these multiplexers has an array to be parameterized for the output value of the multiplexers (arr Op Mod Val, arr Ignore Delay On Val, arr Ignore Delay Off Val, arr Ignore Fdb Val). The resulting values of the multiplexers b Val, _b Fdb, n Delay On and n Delay Off are transmitted to the receive block of the step sequence controller Step, see block diagram part 02. The parameterization of the arrays can be found in an air conditioning system in the methods below the example template FB_BA_AC_Plant Cmd_AHU_1st_10 [} 786], see Methods. Block diagram Part 01 766 Version: 1.14.0 TF8040
## Page 767

Programming Part 02 TF8040 Version: 1.14.0 767
## Page 768

Programming Syntax FUNCTION_BLOCK FB_BA_AC_Op Mod Agg Binary VAR_INPUT st Priority En : ST_BA_Priority En; e Op Mode : E_BA_AC_Op Mod01; b Fdb : BOOL; f Dly On : REAL; f Dly Off : REAL; END_VAR VAR_OUTPUT 768 Version: 1.14.0 TF8040
## Page 769

Programming st Cmd : ST_BA_Binary; n Rem Sec Step Up : UDINT; n Rem Sec Step Down : UDINT; END_VAR VAR_IN_OUT st Step : ST_BA_Step; END_VAR VAR_INPUT CONSTANT Op Mod Val : FB_BA_MMUX_B16; Delay On : FB_BA_MMUX_B16; Delay Off : FB_BA_MMUX_B16; Ignore Fdb : FB_BA_MMUX_B16; Step : FB_BA_Step Binary; END_VAR VAR_INPUT CONSTANT PERSISTENT b Init : BOOL := TRUE; arr Op Mod Val : ARRAY [1..16] OF BOOL; arr Ignore Delay On Val : ARRAY [1..16] OF BOOL; arr Ignore Delay Off Val : ARRAY [1..16] OF BOOL; arr Ignore Fdb Val : ARRAY [1..16] OF BOOL; END_VAR VAR b Val : BOOL; _b Fdb : BOOL; n Delay On : UDINT; n Delay Off : UDINT; END_VAR Inputs Name Type Description st Priority En ST_BA_Priority En [} 278] Input of the current command structure st Priority En. This includes the system enable for the step sequence control of an air conditioning system and the associated enables for the priorities "Safety", "Critical" and "Program". e Op Mode E_BA_AC_Op Mod01 Input of the current operation mode. [} 699] b Fdb BOOL Feedback from the connected aggregate of the step sequence controller. The feedback is required for switching to the next step. b Fdb is only considered if the aggregate is the active one in the step sequence control. By parameterizing the individual elements of the array arr Ignore Fdb Val with a TRUE, the feedback from the aggregate can be ignored for the different operation modes e Op Mode. f Dly On REAL Time specification of the start-up delay [s]. The time specification is required for switching to the next step. By parameterizing the individual elements of the array arr Ignore Delay On Val with a TRUE, the start-up delay of the step can be ignored for the different operation modes e Op Mode. f Dly Off REAL Time specification of switch-off delay [s]. The time specification is needed to switch off the active step. By parameterizing the individual elements of the array arr Ignore Delay Off Val with a TRUE, the switch-off delay of the step can be ignored for the different operation modes e Op Mode. TF8040 Version: 1.14.0 769
## Page 770

Programming Outputs Name Type Description st Cmd ST_BA_Binary [} 277] The command structure st Cmd transmits the enables and switching values of the priorities to the connected aggregate. n Rem Sec Step Up UDINT Countdown to switch on the next step [s]. n Rem Sec Step Down UDINT Countdown to switching off the active step [s]. Inputs/outputs Name Type Description st Step ST_BA_Step [} 277] Data and command structure between the step sequence function block FB_BA_Step Binary and the control block of the step sequence FB_BA_Step Ctrl Agg16 [} 471]. Inputs CONSTANT Name Type Description Op Mod Val FB_BA_MMUX_B16 [} 428] The multiplexer determines the switch-on value of the connected aggregate. The resulting value is sent to the output b Val. Delay On FB_BA_MMUX_B16 [} 428] The multiplexer and the connected network of functions determine the switching delay to the next step. The resulting value is sent to the output n Delay On. Delay Off FB_BA_MMUX_B16 [} 428] The multiplexer and the connected network of functions determine the switch-off delay of the current step. The resulting value is sent to the output n Delay Off. Ignore Fdb FB_BA_MMUX_B16 [} 428] The multiplexer and the connected network of functions determine the feedback of the aggregate. The resulting value is sent to the output _b Fdb. Step FB_BA_Step Binary [} 473] The function block represents the binary receive block of a step sequence controller and controls the connected aggregate via the command structure st Cmd. The data exchange to the control block of the step sequence control (FB_BA_Step Ctrl Agg16 [} 471]) takes place via the data and command structure st Step. 770 Version: 1.14.0 TF8040
## Page 771

Programming Inputs CONSTANT PERSISTENT Name Type Description b Init BOOL The variable is used to initialize the arrays arr Op Mod Val, arr Ignore Delay On Val, arr Ignore Delay Off Val, arr Ignore Fdb Val in the methods below the template FB_BA_AC_Plant Cmd_AHU_1st_10 [} 786]. After starting the controller, the variable is set to FALSE after a PLC cycle and this state is saved persistently. arr Op Mod Val ARRAY [1..16] OF BOOL By parameterizing the individual elements of the array, the switch-on value of the connected aggregate can be defined on the step sequence function block for the different operation modes e Op Mode. arr Ignore Delay On Va ARRAY [1..16] OF BOOL By parameterizing the individual elements of the array with l a TRUE, the switching delay to the next step within the step sequence control can be ignored for the different operation modes e Op Mode. arr Ignore Delay Off Va ARRAY [1..16] OF BOOL By parameterizing the individual elements of the array with l a TRUE, the switch-off delay of the current step within the step sequence control can be ignored for the different operation modes e Op Mode. arr Ignore Fdb Val ARRAY [1..16] OF BOOL By parameterizing the individual elements of the array with a TRUE, the feedback from the aggregate b Fdb can be ignored for the different operation modes e Op Mode. Variables Name Type Description b Val BOOL The variable is the result of the operation mode e Op Mode, the multiplexer Op Mod Val and the array arr Op Mod Val. b Val defines the switch-on value at the step sequence function block Step. _b Fdb BOOL The variable is the result of the operation mode e Op Mode, the multiplexer Ignore Fdb and the array arr Ignore Fdb Val. _b Fdb defines the switching condition to the next step in the step sequence function block Step. n Delay On UDINT The variable is the result of the operation mode e Op Mode, the multiplexer Delay On and the array arr Ignore Delay On Val. n Delay On defines the switching delay to the next step on the step sequence function block Step. n Delay Off UDINT The variable is the result of the operation mode e Op Mode, the multiplexer Delay Off and the array arr Ignore Delay Off Val. n Delay Off defines the switch-off delay of the current step on the step sequence function block Step. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 771
## Page 772

Programming 6.1.4.2.1.1.3.4 FB_BA_AC_Op Mod Agg Mdlt The template serves as a link between the steps within the step sequence control of an air conditioning system. The function block Step is the core of the template and represents the binary receive block of a step sequence controller. The connected aggregate receives its commands via the command structure st Cmd. The data exchange to the control block of the step sequence control (Step Ctrl Agg) takes place via the data and command structure st Step. The 4 multiplexers Op Mod Val, Delay On, Delay Off and Ignore Fdb define the switch-on and switch-off conditions of the system step based on the plant operation mode e Op Mode. Each of these multiplexers has an array to be parameterized for the output value of the multiplexers (arr Op Mod Val, arr Ignore Delay On Val, arr Ignore Delay Off Val, arr Ignore Fdb Val). The resulting values of the multiplexers e Val, _b Fdb, n Delay On and n Delay Off are transmitted to the receive block of the step sequence controller Step, see block diagram part 02. The parameterization of the arrays can be found in an air conditioning system in the methods below the example template FB_BA_AC_Plant Cmd_AHU_1st_10 [} 786], see Methods. Block diagram Part 01 772 Version: 1.14.0 TF8040
## Page 773

Programming Part 02 TF8040 Version: 1.14.0 773
## Page 774

Programming 774 Version: 1.14.0 TF8040
## Page 775

Programming Principle diagram Syntax FUNCTION_BLOCK FB_BA_AC_Op Mod Agg Mdlt VAR_INPUT st Priority En : ST_BA_Priority En; e Op Mode : E_BA_AC_Op Mod01; b Fdb : BOOL; f Dly On : REAL; f Dly Off : REAL; END_VAR VAR_OUTPUT st Cmd : ST_BA_Mdlt; n Rem Sec Step Up : UDINT; n Rem Sec Step Down : UDINT; END_VAR VAR_IN_OUT st Step : ST_BA_Step; END_VAR VAR_INPUT CONSTANT Op Mod Val : FB_BA_MMUX_UDI16; Delay On : FB_BA_MMUX_B16; Delay Off : FB_BA_MMUX_B16; Ignore Fdb : FB_BA_MMUX_B16; Step : FB_BA_Step Mdlt; END_VAR VAR_INPUT CONSTANT PERSISTENT b Init : BOOL := TRUE; arr Op Mod Val : ARRAY [1..16] OF E_BA_Mdlt; arr Ignore Delay On Val : ARRAY [1..16] OF BOOL; arr Ignore Delay Off Val : ARRAY [1..16] OF BOOL; arr Ignore Fdb Val : ARRAY [1..16] OF BOOL; END_VAR VAR e Val : E_BA_Mdlt; _b Fdb : BOOL; n Delay On : UDINT; n Delay Off : UDINT; END_VAR TF8040 Version: 1.14.0 775
## Page 776

Programming Inputs Name Type Description st Priority En ST_BA_Priority En [} 278] Input of the current command structure st Priority En. This includes the system enable for the step sequence control of an air conditioning system and the associated enables for the priorities "Safety", "Critical" and "Program". e Op Mode E_BA_AC_Op Mod01 Input of the current operation mode. [} 699] b Fdb BOOL Feedback from the connected aggregate of the step sequence controller. The feedback is required for switching to the next step. b Fdb is only considered if the aggregate is the active one in the step sequence control. By parameterizing the individual elements of the array arr Ignore Fdb Val with a TRUE, the feedback from the aggregate can be ignored for the different operation modes e Op Mode. f Dly On REAL Time specification of the start-up delay [s]. The time specification is required for switching to the next step. By parameterizing the individual elements of the array arr Ignore Delay On Val with a TRUE, the start-up delay of the step can be ignored for the different operation modes e Op Mode. f Dly Off REAL Time specification of switch-off delay [s]. The time specification is needed to switch off the active step. By parameterizing the individual elements of the array arr Ignore Delay Off Val with a TRUE, the switch-off delay of the step can be ignored for the different operation modes e Op Mode. Outputs Name Type Description st Cmd ST_BA_Binary [} 277] The command structure st Cmd transmits the enables and switching values of the priorities to the connected aggregate. n Rem Sec Step Up UDINT Countdown to switch on the next step [s]. n Rem Sec Step Down UDINT Countdown to switching off the active step [s]. Inputs/outputs Name Type Description st Step ST_BA_Step [} 277] Data and command structure between the step sequence function block FB_BA_Step Binary and the control block of the step sequence FB_BA_Step Ctrl Agg16 [} 471]. 776 Version: 1.14.0 TF8040
## Page 777

Programming Inputs CONSTANT Name Type Description Op Mod Val FB_BA_MMUX_B16 [} 428] The multiplexer determines the switch-on value of the connected aggregate. The resulting value is sent to the output b Val. Delay On FB_BA_MMUX_B16 [} 428] The multiplexer and the connected network of functions determine the switching delay to the next step. The resulting value is sent to the output n Delay On. Delay Off FB_BA_MMUX_B16 [} 428] The multiplexer and the connected network of functions determine the switch-off delay of the current step. The resulting value is sent to the output n Delay Off. Ignore Fdb FB_BA_MMUX_B16 [} 428] The multiplexer and the connected network of functions determine the feedback of the aggregate. The resulting value is sent to the output _b Fdb. Step FB_BA_Step Binary [} 473] The function block represents the binary receive block of a step sequence controller and controls the connected aggregate via the command structure st Cmd. The data exchange to the control block of the step sequence control (FB_BA_Step Ctrl Agg16 [} 471]) takes place via the data and command structure st Step. Inputs CONSTANT PERSISTENT Name Type Description b Init BOOL The variable is used to initialize the arrays arr Op Mod Val, arr Ignore Delay On Val, arr Ignore Delay Off Val, arr Ignore Fdb Val in the methods below the template FB_BA_AC_Plant Cmd_AHU_1st_10 [} 786]. After starting the controller, the variable is set to FALSE after a PLC cycle and this state is saved persistently. arr Op Mod Val ARRAY [1..16] OF BOOL By parameterizing the individual elements of the array, the switch-on value of the connected aggregate can be defined on the step sequence function block for the different operation modes e Op Mode. arr Ignore Delay On Va ARRAY [1..16] OF BOOL By parameterizing the individual elements of the array with l a TRUE, the switching delay to the next step within the step sequence control can be ignored for the different operation modes e Op Mode. arr Ignore Delay Off Va ARRAY [1..16] OF BOOL By parameterizing the individual elements of the array with l a TRUE, the switch-off delay of the current step within the step sequence control can be ignored for the different operation modes e Op Mode. arr Ignore Fdb Val ARRAY [1..16] OF BOOL By parameterizing the individual elements of the array with a TRUE, the feedback from the aggregate b Fdb can be ignored for the different operation modes e Op Mode. TF8040 Version: 1.14.0 777
## Page 778

Programming Variables Name Type Description b Val BOOL The variable is the result of the operation mode e Op Mode, the multiplexer Op Mod Val and the array arr Op Mod Val. b Val defines the switch-on value at the step sequence function block Step. _b Fdb BOOL The variable is the result of the operation mode e Op Mode, the multiplexer Ignore Fdb and the array arr Ignore Fdb Val. _b Fdb defines the switching condition to the next step in the step sequence function block Step. n Delay On UDINT The variable is the result of the operation mode e Op Mode, the multiplexer Delay On and the array arr Ignore Delay On Val. n Delay On defines the switching delay to the next step on the step sequence function block Step. n Delay Off UDINT The variable is the result of the operation mode e Op Mode, the multiplexer Delay Off and the array arr Ignore Delay Off Val. n Delay Off defines the switch-off delay of the current step on the step sequence function block Step. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.3.5 FB_BA_AC_Seq T The template represents the start and control of the supply air temperature sequence control of an air conditioning (HVAC) system. The initialization of the template takes place within the method FB_Init. Start behavior of the sequence On startup of the air-conditioning plant the system determines whether to start with the heating, cooling or heat recovery sequence. The start sequence is selected depending on the plant operation mode e Op Mode and the outside temperature f TWth. The result of the network at the input n Num Start Ctrl of the function block Seq Link determines the start controller of the control sequence. If the sequence controller specified at n Num Start Ctrl is not ready for operation, the parameter enum e No Start Ctrl Found of the function block Seq Link is used to define the procedure for finding a new start controller. This ensures that the sequence always starts. Control of the sequence control Only one element of the sequence can be controlling. If a regulating sequence controller reaches its maximum or minimum value (Ymax,Ymin), the next controller in the sequence is switched to depending on the control direction. 778 Version: 1.14.0 TF8040
## Page 779

Programming Switching to another sequence controller can be delayed by specifying the time n Swi Over Ti of the function block Seq Link. The order of the temperature control sequences is specified by the globally defined enumeration variable E_BA_Seq Number_T [} 697]. TF8040 Version: 1.14.0 779
## Page 780

Programming Block diagram 780 Version: 1.14.0 TF8040
## Page 781

Programming Principle diagram plant Syntax FUNCTION_BLOCK FB_BA_AC_Seq T EXTENDS FB_BA_View VAR_INPUT b En : BOOL; e Op Mode : E_BA_AC_Op Mod01; f TWth : REAL; END_VAR VAR_OUTPUT b Sum Lmt : BOOL; b Win Lmt : BOOL; n Actv Seq Ctrl : UDINT; END_VAR VAR_IN_OUT st TSeq Link : ST_BA_Seq Link; END_VAR VAR_INPUT CONSTANT Wth TLmt Sum : FB_BA_AV_Op; Wth TLmt Win : FB_BA_AV_Op; Seq Link : FB_BA_Sequence Link Base; Actv Seq Ctrl : FB_BA_MV_Op; END_VAR VAR Wth TLmt Win Hys : FB_BA_Swi2P; Wth TLmt Sum Hys : FB_BA_Swi2P; Start Seq : FB_BA_Prio Swi_UDI08; END_VAR Inputs Name Type Description b En BOOL Activation of the supply air temperature sequence control. e Op Mode E_BA_AC_Op Mod01 The plant operation mode is used for the selection of the start sequence controller. [} 699] f TWth REAL Input for the weather temperature. TF8040 Version: 1.14.0 781
## Page 782

Programming Outputs Name Type Description b Sum Lmt BOOL The output variable indicates that the ventilation system starts with the cooling sequence. b Win Lmt BOOL The output variable indicates that the ventilation system starts with the heating sequence. n Actv Seq Ctrl UDINT The output variable shows the number of the active sequence controller. Inputs/outputs Name Type Description st TSeq Link ST_BA_Seq Link [} 123] Data and command structure between the individual sequence controllers FB_BA_Seq Ctrl of the temperature control sequence (preheater, energy recovery, cooler) and the control block Seq Link. Inputs CONSTANT Name Type Description Wth TLmt Sum FB_BA_AV_Op [} 202] AV object for input of an outside temperature limit value from which the air-conditioning plant starts in the heating sequence. Wth TLmt Win FB_BA_AV_Op [} 202] AV object for input of an outside temperature limit value from which the air-conditioning plant starts in the cooling sequence Seq Link FB_BA_Sequence Link Base The function block Seq Link H is the core of the template FB_BA_AC_Seq T. The sequence linker is connected to [} 171] the supply air controllers of the sequence via the data structure st TSeq Link [} 123]. It is the central control element, and responsible for switching between the sequence controllers and starting of the control sequence. Actv Seq Ctrl FB_BA_MV_Op [} 239] The MV object indicates the currently active sequence controller. 782 Version: 1.14.0 TF8040
## Page 783

Programming Variables Name Type Description Wth TLmt Win Hys FB_BA_Swi2P Two-position switch which generates the binary switching signal for b Win Lmt based on the weather temperature f TWth and the winter weather temperature limit value Wth TLmt Win. Wth TLmt Sum Hys FB_BA_Swi2P Two-position switch which generates the binary switching signal for b Win Lmt based on the weather temperature f TWth and the limit value weather temperature summer Wth TLmt Sum. Start Seq FB_BA_Prio Swi_UDI08 The priority switch is used to select the start sequence. [} 433] Prio 1: b EN01 In the overheating protection E_BA_AC_Op Mod01.e Over Heating Protection, the cooling sequence (E_BA_AC_Seq Number.e Cooler) is always started. Prio 2: b EN02 In the cool-down protection mode E_BA_AC_Op Mod01.e Cool Down Protection, the heating sequence (E_BA_AC_Seq Number.e Pre Heater) is always started. Prio 4: b EN04 The upstream function block Wth TLmt Win Hys checks whether the actual outside temperature is below the critical value of AV object Wth TLmt Sum. If this is the case, the air- conditioning system starts with the sequence controller of the preheater (E_BA_AC_Seq Number.e Pre Heater). Prio 5: b EN05 The upstream function block Wth TLmt Sum Hys checks whether the actual outside temperature is above the value of AV object Wth TLmt Sum. If this is the case, the air conditioning system starts with the sequence controller of the cooler (E_BA_AC_Seq Number.e Cooler). Prio 8: b EN08 In the transitional periods between winter and summer, the inputs of Start Seq.b En04 and Start Seq.b En05 are FALSE on account of the weather. In this case, priority 8 applies to the priority switch, meaning that the air-conditioning system is started in the energy recovery sequence (E_BA_AC_Seq Number.e Energy Recovery). Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.3.6 FB_BA_AC_Sum Ngt Col TF8040 Version: 1.14.0 783
## Page 784

Programming The template represents a night cooling function for ventilation systems. It is used to cool down rooms that have been heated up during the day with cool outside air at night. The summer night cooling function serves to improve the quality of the air and to save electrical energy. Electrical energy for cooling is saved during the first hours of the next summer day. The initialization of the template takes place within the method FB_Init. Block diagram Principle diagram 784 Version: 1.14.0 TF8040
## Page 785

Programming Syntax FUNCTION_BLOCK FB_BA_AC_Sum Ngt Col EXTENDS FB_BA_View VAR_INPUT f TRm : REAL; f Sp Rm : REAL; f TWth : REAL; END_VAR VAR_OUTPUT b Q : BOOL; END_VAR VAR_INPUT CONSTANT Wth TLo Lmt : FB_BA_AV_Op; Rm THys : FB_BA_AV_Op; Swi On Diff T : FB_BA_AV_Op; Swi Off Diff T : FB_BA_AV_Op; Q : FB_BA_BV_Op; Sched : FB_BA_Sched M; END_VAR VAR Ngt Col Fnct : FB_BA_Ngt Col; END_VAR Inputs Name Type Description f TRm REAL Input measured value room temperature. f Sp Rm REAL Input setpoint room temperature. f TWth REAL Input for the weather temperature. Outputs Name Type Description b Q BOOL Summer night cooling switched on. Inputs CONSTANT Name Type Description Wth TLo Lmt FB_BA_AV_Op [} 202] Input of the value for the lower outside temperature. The value is intended to prevent excessive cooling. Rm THys FB_BA_AV_Op [} 202] Input of the room temperature hysteresis. Swi On Diff T FB_BA_AV_Op [} 202] Switch-on value Temperature difference between the room temperature and the outside temperature [K]. Swi Off Diff T FB_BA_AV_Op [} 202] Switch-off value Temperature difference between the room temperature and the outside temperature [K]. Q FB_BA_BV_Op [} 216] The BV object indicates that night cooling is switched on. Sched FB_BA_Sched M [} 225] The schedule object can be used to define periods in which night cooling is enabled. Variables Name Type Description Ngt Col Fct FB_BA_Ngt Col [} 289] The function block is the core of the template and includes the actual control process of the night cooling program. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 785
## Page 786

Programming 6.1.4.2.1.1.3.7 FB_BA_AC_Plant Cmd_AHU_1st_10 The template represents the plant command of an air conditioning system without humidification and dehumidification. The function block Plant Control is the core of the plant command system. It serves as a higher-level plant control unit for the connected aggregates. The corresponding switch-on or switch-off commands and their priority are determined for each aggregate according to the specified plant operation mode e Op Mode and the information in the control matrix of the Plant Control unit. The bidirectional communication to the aggregates of the air conditioning system takes place via the array arr Aggregate, see Principle diagram plant. The parameterization of the control matrix is done in the methods below this template. The initialization of the template takes place within the method FB_Init. 786 Version: 1.14.0 TF8040
## Page 787

Programming Block diagram TF8040 Version: 1.14.0 787
## Page 788

Programming Principle diagram plant Syntax FUNCTION_BLOCK FB_BA_AC_Plant Cmd_AHU_1st_10 EXTENDS FB_BA_View VAR_INPUT e Op Mode : E_BA_AC_Op Mod01; END_VAR VAR_OUTPUT e Plt Stp : E_BA_AC_Plant Step01; b Step Ctrl Up : BOOL; b Step Ctrl Down : BOOL; END_VAR VAR_IN_OUT arr Aggregate : ARRAY [1.. MAX(1,BA_Param.n Max Aggregate)] OF ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT Dmp Dly Cls : FB_BA_AV_Op; Su AFan Dly On : FB_BA_AV_Op; Ext AFan Dly On : FB_BA_AV_Op; Temp Ctrl Dly On : FB_BA_AV_Op; Plt Stp : FB_BA_MV_Op; Plant Control : FB_BA_Plant Control; END_VAR VAR_INPUT CONSTANT PERSISTENT b Init : BOOL := TRUE; 788 Version: 1.14.0 TF8040
## Page 789

Programming END_VAR VAR MMux Start : FB_BA_MMUX_B16; MMux Profile : FB_BA_MMUX_UDI16; MMux Plt Stp : FB_BA_MMUX_UDI16; END_VAR Inputs Name Type Description e Op Mode E_BA_AC_Op Mod01 Input of the current operation mode e Op Mode, see [} 699] template FB_BA_AC_Op Mod1St [} 763]. Outputs Name Type Description e Plt Stp E_BA_AC_Plant Step01 Output of the current plant step of the air conditioning system. [} 698] b Step Ctrl Up BOOL Indicates that the order of the step sequence control is in the rising state. b Step Ctrl Down BOOL Indicates that the order of the step sequence control is in the falling state. Inputs/outputs Name Type Description arr Aggregates ARRAY The array contains a bidirectional data and command [1.. MAX(1,BA_Param.n Ma structure for each aggregate. x Aggregate [} 284])] OF When the step sequence control is switched up or down, ST_BA_Aggregate [} 278] the switching command determined for each aggregate is transferred via the bidirectional communication structure arr Aggregate. Feedback from the aggregates for switching the step sequence control up or down is transmitted to the Plant Control via the communication structure. Inputs CONSTANT Name Type Description Dmp Dly Cls FB_BA_AV_Op [} 202] AV object for entering the value to delay the closing of the dampers during shutdown of the air conditioning plant, to take into account the overrun time of the fans during plant shutdown. Su AFan Dly On FB_BA_AV_Op [} 202] AV object for entering a value for the start-up delay of the supply air fan when the air conditioning plant is switched on. Ext AFan Dly On FB_BA_AV_Op [} 202] AV object for entering a value for the start-up delay of the extract air fan when the air conditioning plant is switched on. Temp Ctrl Dly On FB_BA_AV_Op [} 202] AV object for entering a value for delayed temperature control enable. Plt Stp FB_BA_MV_Op [} 239] The MV object shows the current step of the plant's step sequence control. Plant Control FB_BA_Plant Control The function block represents the higher-level plant control of a step sequence control of aggregates. The function [} 480] block ensures that the individual aggregates of a plant are switched on or off sequentially one after the other in a certain order. TF8040 Version: 1.14.0 789
## Page 790

Programming Inputs CONSTANT PERSISTENT Name Type Description b Init BOOL The variable is used to call the initialization methods for the control matrix in the Call Init [} 790] method. After starting the controller, the variable is set to FALSE after a PLC cycle and this state is saved persistently. Variables Name Type Description MMux Start FB_BA_MMUX_B16 [} 428] The multiplexer uses the plant operation mode e Op Mode to define whether the air conditioning system is started or stopped. MMux Profile FB_BA_MMUX_UDI16 The multiplexer uses the plant operation mode e Op Mode to define the control profile of the Plant Control. [} 428] MMux Plt Stp FB_BA_MMUX_UDI16 The multiplexer evaluates the steps of the step sequence control and transfers them to the MV object Plt Stp for [} 428] display at management level. Methods Name Definition location Description Call Init [} 790] Local Calling the initialization methods for parameterization of the control matrix of the plant control unit. Profile Description [} 791] Local Used to initialize the parameter array arr Profile Description of the plant control unit. Profile Parameter0x [} 791] Local Initialization of a part of the multidimensional profile parameter array arr Profile Parameter of the control unit. Step Description [} 792] Local Used to initialize the parameter array arr Step Description of the plant control unit. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.1.3.7.1 Call Init The method is used to call the initialization methods for the parameterization of the control matrix of the Plant Control unit. 790 Version: 1.14.0 TF8040
## Page 791

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.1.3.7.2 Profile Description The method is used to initialize the parameter array arr Profile Description of the Plant Control unit. Each element of the array represents a profile. Accordingly, the names of the profiles are assigned in this method and the associated priority n Prio is defined. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.1.3.7.3 Profile Parameter0x The method is used to initialize a part of the multidimensional profile parameter array arr Profile Parameter of the Plant Control [} 480] unit. This description is representative of all eight methods of this type. The first element of the array of the Profile Parameter01 method represents the "Auto" plant profile. The first element of the array of the Profile Parameter02 method represents the "Night Cooling" plant profile. The first element of the array of the Profile Parameter03 method represents the "Cool Down Protection" plant profile. The first element of the array of the Profile Parameter04 method represents the "Over Heating Protection" plant profile. The first element of the array of the Profile Parameter05 method represents the "Forced Ventilation" plant profile. The first element of the array of the Profile Parameter06 method represents the "Critical Off" plant profile. TF8040 Version: 1.14.0 791
## Page 792

Programming The first element of the array of the Profile Parameter07 method represents the "Smoke Extraction Program" plant profile. The first element of the array of the Profile Parameter08 method represents the "Life Safety Off" plant profile. The second element stands for the steps within the step sequence control. The switching values for the aggregates (b Value, n Value, f Value), the delay times for the step sequence control (f Delay Up, f Delay Down) and the releases for the use of the process feedback of the aggregates in the step (b En Fdb Up, b En Fdb Down) are parameterized. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.1.3.7.4 Step Description The method is used to initialize the parameter array arr Step Description of the Plant Control unit. The plain text of the plant steps is defined in the parameter array. This information is purely for display purposes. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.1.4 Setpoint 6.1.4.2.1.1.4.1 Temperature 6.1.4.2.1.1.4.1.1 FB_BA_AC_Sp TRm_02 The template is a setpoint program for an air conditioning system. It serves as a setpoint program for an extract air/supply air cascade with a separate room temperature setpoint for heating and cooling mode, including summer and winter compensation. There are two basic room temperature setpoints (Sp Htg Y1, Sp Col Y1), with an energy-neutral zone between the lower setpoint (heating mode) and the upper setpoint (cooling mode). An outside temperature-dependent offset of the basic room temperature setpoints is realized via two curve functions (summer/winter compensation). 792 Version: 1.14.0 TF8040
## Page 793

Programming The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 793
## Page 794

Programming Block diagram 794 Version: 1.14.0 TF8040
## Page 795

Programming Principle diagram01 Principle diagram02 Syntax FUNCTION_BLOCK FB_BA_AC_Sp TRm_02 EXTENDS FB_BA_View VAR_INPUT f TWth : REAL; END_VAR VAR_OUTPUT f Sp Htg : REAL; f Sp Col : REAL; END_VAR VAR_INPUT CONSTANT Sp Col X1 : FB_BA_AV_Op; Sp Col X2 : FB_BA_AV_Op; Sp Col Y1 : FB_BA_AV_Op; Sp Col Y2 : FB_BA_AV_Op; Sp Htg X1 : FB_BA_AV_Op; Sp Htg X2 : FB_BA_AV_Op; Sp Htg Y1 : FB_BA_AV_Op; Sp Htg Y2 : FB_BA_AV_Op; Sp Htg : FB_BA_AV_Op; Sp Col : FB_BA_AV_Op; END_VAR VAR TF8040 Version: 1.14.0 795
## Page 796

Programming Sp Col Scale : FB_BA_Chrct02; Sp Htg Scale : FB_BA_Chrct02; END_VAR Inputs CONSTANT Name Type Description f TWth REAL Current value of the outside temperature. Outputs Name Type Description f Sp Htg REAL Calculated setpoint of the supply air temperature for the heater. f Sp Col REAL Calculated setpoint of the supply air temperature for the cooler. Inputs CONSTANT Name Type Description Sp Col X1 FB_BA_AV_Op [} 202] Input of the value for interpolation point X1 of the summer compensation for the cooling setpoint. Sp Col X2 FB_BA_AV_Op [} 202] Input of the value for interpolation point X2 of the summer compensation for the cooling setpoint. Sp Col Y1 FB_BA_AV_Op [} 202] Input of the value for interpolation point Y1 of the summer compensation for the cooling setpoint. Sp Col Y1 is the base cooling setpoint. Sp Col Y2 FB_BA_AV_Op [} 202] Input of the value for interpolation point Y2 of the summer compensation for the cooling setpoint. Sp Htg X1 FB_BA_AV_Op [} 202] Input of the value for interpolation point X1 of the winter compensation for the heating setpoint. Sp Htg X2 FB_BA_AV_Op [} 202] Input of the value for interpolation point X2 of the winter compensation for the heating setpoint. Sp Htg Y1 FB_BA_AV_Op [} 202] Input of the value for interpolation point Y1 of the winter compensation for the heating setpoint. Sp Htg Y1 is the base heating setpoint. Sp Htg Y2 FB_BA_AV_Op [} 202] Input of the value for interpolation point Y2 of the winter compensation for the heating setpoint. Sp Htg FB_BA_AV_Op [} 202] Analog value object for displaying the calculated room temperature setpoint heating. Sp Col FB_BA_AV_Op [} 202] Analog value object for displaying the calculated room temperature setpoint cooling. 796 Version: 1.14.0 TF8040
## Page 797

Programming Variables Name Type Description Sp Col Scale FB_BA_Chrct02 [} 456] The function block calculates the characteristic cooling setpoint curve (summer compensation) for the current room temperature as a function of the outside temperature. Sp Htg Scale FB_BA_Chrct02 [} 456] The function block calculates the characteristic heating setpoint curve (winter compensation) for the current room temperature as a function of the outside temperature. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.1.4.1.2 FB_BA_AC_Sp TSu A_01 The template generates the supply air temperature setpoint of an air conditioning system, including summer and winter compensation. The supply air temperature setpoint is determined by the function block Scale [} 459] depending on the outside temperature. The supply air temperature sequence control is enabled with the variable b On by evaluating the receive block of the step sequence control Aggregate. The setpoint linked to the variables f Sp Htg, f Sp Col and f Sp Erc is transferred to the supply air controllers of the aggregates heater, cooler and energy recovery. TF8040 Version: 1.14.0 797
## Page 798

Programming Principle diagram 01 Principle diagram 02 The initialization of the template takes place within the method FB_Init. 798 Version: 1.14.0 TF8040
## Page 799

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_Sp TSu A_01 EXTENDS FB_BA_View VAR_INPUT f TWth : REAL; END_VAR VAR_OUTPUT f Sp Htg : REAL; f Sp Col : REAL; f Sp Erc : REAL; b On : BOOL; END_VAR VAR_IN_OUT st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT X1 : FB_BA_AV_Op; X2 : FB_BA_AV_Op; X3 : FB_BA_AV_Op; X4 : FB_BA_AV_Op; Y1 : FB_BA_AV_Op; Y2_3 : FB_BA_AV_Op; Y4 : FB_BA_AV_Op; Sp : FB_BA_AV_Op; Aggregate : FB_BA_Aggregate; END_VAR VAR Prio Swi Val : FB_BA_Prio Swi_UDI04; Mux Cmd : FB_BA_MMUX_B04; Scale : FB_BA_Chrct04; END_VAR TF8040 Version: 1.14.0 799
## Page 800

Programming Inputs Name Type Description f TWth REAL Current value of the outside temperature. Outputs Name Type Description f Sp Htg REAL Calculated setpoint of the supply air temperature for the heater. f Sp Col REAL Calculated setpoint of the supply air temperature for the cooler. f Sp Erc REAL Calculated setpoint of the supply air temperature. for energy recovery. b On BOOL The output shows the resulting result of the multiplexer Mux Cmd. This is further processed within the ventilation system and is used to enable the supply air temperature sequence control. Inputs/outputs Name Type Description st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. Inputs CONSTANT Name Type Description X1 FB_BA_AV_Op [} 202] Input of the value for interpolation point X1. X2 FB_BA_AV_Op [} 202] Input of the value for interpolation point X2. X3 FB_BA_AV_Op [} 202] Input of the value for interpolation point X3. X4 FB_BA_AV_Op [} 202] Input of the value for interpolation point X4. Y1 FB_BA_AV_Op [} 202] Input of the value for interpolation point Y1. Y2_3 FB_BA_AV_Op [} 202] Input of the value for interpolation point Y2/Y3. Y4 FB_BA_AV_Op [} 202] Input of the value for interpolation point Y4. Sp FB_BA_AV_Op [} 202] Output of the calculated, simple supply air temperature setpoint. This is output via the f Sp Htg, f Sp Col and f Sp Erc outputs. Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. 800 Version: 1.14.0 TF8040
## Page 801

Programming Variables Name Type Description b Prio Swi Val FB_BA_Prio Swi_UDI04 The priority switch Prio Swi Val [} 433] uses the command [} 433] structure st Cmd to determine the modulation command for the multiplexers Mux Cmd and Mux Mdlt. Mux Cmd FB_BA_MMUX_B04 [} 428] The multiplexer Mux Cmd [} 428] determines the current switch value from the command of the priority switch Prio Swi Val. The resulting output is sent to the binary output object b On. Scale FB_BA_Chrct04 [} 459] The function block calculates the supply air temperature setpoint depending on the outside temperature. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.4.1.3 FB_BA_AC_TCas Ctrl_01 The template is used for room temperature control by means of room-supply air cascade. It consists of a master controller for calculating the supply air temperature setpoint for the aggregates heater, cooler and energy recovery. The supply air temperature sequence control is enabled with the variable b On by evaluating the receive block of the step sequence control Aggregate. TF8040 Version: 1.14.0 801
## Page 802

Programming Principle diagram01 Principle diagram02 The initialization of the template takes place within the method FB_Init. 802 Version: 1.14.0 TF8040
## Page 803

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_TCas Ctrl_01 EXTENDS FB_BA_View VAR_INPUT f Sp TRm : REAL; f TRm : REAL; END_VAR VAR_OUTPUT f Sp Htg : REAL; f Sp Col : REAL; f Sp Erc : REAL; f Max : REAL; f Min : REAL; TF8040 Version: 1.14.0 803
## Page 804

Programming b On : BOOL; END_VAR VAR_IN_OUT st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT Sp Htg : FB_BA_AV_Op; Sp Col : FB_BA_AV_Op; Sp Erc : FB_BA_AV_Op; Ctrl : FB_BA_Loop; Aggregate : FB_BA_Aggregate; END_VAR VAR Prio Swi Val : FB_BA_Prio Swi_UDI04; Mux Cmd : FB_BA_MMUX_B04; Mux Sp Htg : FB_BA_MMUX_R04; Mux Sp Col : FB_BA_MMUX_R04; Mux Sp Erc : FB_BA_MMUX_R04; END_VAR Inputs CONSTANT Name Type Description f Sp TRm REAL Input variable for the room temperature setpoint. f TRm REAL Input variable to which the room temperature is applied. The room temperature is the control value of the PID master controller Ctrl. If no room temperature is available, the outlet air temperature of a ventilation system can be used as control value. Outputs Name Type Description f Sp Htg REAL Calculated setpoint of the supply air temperature for the heater. f Sp Col REAL Calculated setpoint of the supply air temperature for the cooler. f Sp Erc REAL Calculated setpoint of the supply air temperature. for energy recovery. f Max REAL Upper value of the controller output limitation. f Min REAL Lower value of the controller output limitation. b On BOOL The output shows the resulting result of the multiplexer Mux Cmd. This is further processed within the ventilation system and is used to enable the supply air temperature sequence control. Inputs/outputs Name Type Description st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. 804 Version: 1.14.0 TF8040
## Page 805

Programming Inputs CONSTANT Name Type Description Sp Htg FB_BA_AV_Op [} 202] Analog value object for displaying the calculated room temperature setpoint heating. Sp Col FB_BA_AV_Op [} 202] Analog value object for displaying the calculated room temperature setpoint cooling. Sp Erc FB_BA_AV_Op [} 202] Analog value object for displaying the calculated supply air temperature setpoint Energy recovery. Ctrl FB_BA_Loop [} 220] The LOOP object serves as a master controller for a room temperature control by means of a room-supply air cascade. It provides the supply air temperature setpoint. Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. Variables Name Type Description Prio Swi Val FB_BA_Prio Swi_UDI04 The priority switch uses the command structure st Cmd to determine the modulation command for the multiplexer [} 433] Mux Cmd. Mux Cmd FB_BA_MMUX_B04 [} 428] The multiplexer determines the current switching command from the modulation command of the priority switch Prio Swi Val. The resulting output is sent to the output b On. The multiplexer defines the enabling conditions of the PID master controller Ctrl. Mux Sp Htg FB_BA_MMUX_R04 [} 428] The multiplexer defines the setpoint heating f Sp Htg depending on the priority switch Prio Swi Val. Mux Sp Col FB_BA_MMUX_R04 [} 428] The multiplexer defines the cooling setpoint f Sp Col depending on the priority switch Prio Swi Val. Mux Sp Erc FB_BA_MMUX_R04 [} 428] The multiplexer defines the setpoint energy recovery f Sp Erc depending on the priority switch Prio Swi Val. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.1.4.1.4 FB_BA_AC_TCas Ctrl_02 The template is used for room temperature control by means of room-supply air cascade. TF8040 Version: 1.14.0 805
## Page 806

Programming It consists of two master controllers for calculating the supply air temperature setpoints for the heater and cooler aggregates. Each of the two master controllers receives a separate setpoint. The setpoint of the master controller for the heating function is below the setpoint of the master controller for cooling. There is an energy-neutral zone between the two setpoints. In addition, it determines the supply air temperature setpoint for energy recovery depending on its control direction. The supply air temperature sequence control is enabled with the variable b On by evaluating the receive block of the step sequence control Aggregate. Principle diagram01 Principle diagram02 The initialization of the template takes place within the method FB_Init. 806 Version: 1.14.0 TF8040
## Page 807

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_AC_TCas Ctrl_02 EXTENDS FB_BA_View VAR_INPUT f Sp Rm Htg : REAL; f Sp Rm Col : REAL; f TRm : REAL; e Action : E_BA_Action := E_BA_Action.e Direct; END_VAR VAR_OUTPUT f Sp Htg : REAL; f Sp Col : REAL; f Sp Erc : REAL; f Max : REAL; f Min : REAL; b On : BOOL; END_VAR VAR_IN_OUT TF8040 Version: 1.14.0 807
## Page 808

Programming st Aggregate : ST_BA_Aggregate; END_VAR VAR_INPUT CONSTANT Sp Htg : FB_BA_AV_Op; Sp Col : FB_BA_AV_Op; Sp Erc : FB_BA_AV_Op; Sel Sp Erc : FB_BA_MV_Op; Ctrl Htg : FB_BA_Loop; Ctrl Col : FB_BA_Loop; Loop Sync : FB_BA_Loop Sync; Aggregate : FB_BA_Aggregate; END_VAR VAR Prio Swi Val : FB_BA_Prio Swi_UDI04; Mux Cmd : FB_BA_MMUX_B04; Mux Sp Htg : FB_BA_MMUX_R04; Mux Sp Col : FB_BA_MMUX_R04; Mux Sp Erc : FB_BA_MMUX_R04; END_VAR Inputs Name Type Description f Sp Rm Htg REAL Input variable for the setpoint room temperature Heating [} 792]. f Sp Rm Col REAL Input variable for the setpoint room temperature Cooling. [} 792] f TRm REAL Input variable to which the room temperature is applied. The room temperature is the control value of the PID master controller Ctrl. If no room temperature is available, the outlet air temperature of a ventilation system can be used as control value. e Action E_BA_Action Input variable to which the control direction for the energy recovery is applied. The setpoint for the energy recovery is determined depending on the control direction. Outputs Name Type Description f Sp Htg REAL Calculated setpoint of the supply air temperature for the heater. f Sp Col REAL Calculated setpoint of the supply air temperature for the cooler. f Sp Erc REAL Calculated setpoint of the supply air temperature. for energy recovery. f Max REAL Upper value of the controller output limitation. f Min REAL Lower value of the controller output limitation. b On BOOL The output shows the resulting result of the multiplexer Mux Cmd. This is further processed within the ventilation system and is used to enable the supply air temperature sequence control. Inputs/outputs Name Type Description st Aggregate ST_BA_Aggregate [} 278] Bidirectional aggregate structure via which the enables and switching values are transmitted to the evaluation function block of the step sequence control Aggregate. The aggregate structure transmits the recorded feedback signals up and down to the central plant control. 808 Version: 1.14.0 TF8040
## Page 809

Programming Inputs CONSTANT Name Type Description Sp Htg FB_BA_AV_Op [} 202] Analog value object for displaying the calculated room temperature setpoint heating. Sp Col FB_BA_AV_Op [} 202] Analog value object for displaying the calculated room temperature setpoint cooling. Sp Erc FB_BA_AV_Op [} 202] Analog value object for displaying the calculated supply air temperature setpoint Energy recovery. Sel Sp Erc FB_BA_MV_Op [} 239] The Multistate value object is used to select the strategy setpoint energy recovery. E_BA_AC_Sel Sp Erc.e Action [} 699]: = 1: Depends on the control direction, defined by input e Erc Action. E_BA_AC_Sel Sp Erc.e Average Htg Col [} 699]:= 2: Average of input variables f Sp Htg and f Sp Col. Ctrl Htg FB_BA_Loop [} 220] The LOOP object serves as a master controller for a room temperature control by means of a room-supply air cascade. It provides the supply air temperature setpoint for heating. Ctrl Col FB_BA_Loop [} 220] The LOOP object serves as a master controller for a room temperature control by means of a room-supply air cascade. It provides the supply air temperature setpoint for cooling. Loop Sync FB_BA_Loop Sync [} 165] The function block synchronizes the parameters for the two master controllers Ctrl Htg/Ctrl Col. Aggregates FB_BA_Aggregate [} 478] The aggregate function block represents a receive block of a step sequence controller. Within the function block, the aggregate structure st Aggregate is evaluated and integrated into the template using the inputs and outputs. Variables Name Type Description Prio Swi Val FB_BA_Prio Swi_UDI04 The priority switch uses the command structure st Cmd to determine the modulation command for the multiplexer [} 433] Mux Cmd. Mux Cmd FB_BA_MMUX_B04 [} 428] The multiplexer determines the current switching command from the modulation command of the priority switch Prio Swi Val. The resulting output is sent to the output b On. The multiplexer defines the enabling conditions of the PID master controller Ctrl. Mux Sp Htg FB_BA_MMUX_R04 [} 428] The multiplexer defines the setpoint heating f Sp Htg depending on the priority switch Prio Swi Val. Mux Sp Col FB_BA_MMUX_R04 [} 428] The multiplexer defines the cooling setpoint f Sp Col depending on the priority switch Prio Swi Val. Mux Sp Erc FB_BA_MMUX_R04 [} 428] The multiplexer defines the setpoint energy recovery f Sp Erc depending on the priority switch Prio Swi Val. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 809
## Page 810

Programming 6.1.4.2.1.1.5 Plants 6.1.4.2.1.1.5.1 FB_BA_AHU_1st_10 Template of an air conditioning system. The main components of the template are: • Plant control and start program • Supply air temperature sequence control • Room temperature cascade control • Summer night cooling • Pressure control of the supply and extract air fan • Thermal air treatment using air heaters, coolers and energy recovery by means of plate heat exchangers • External and exhaust air damper with spring return actuator and end position monitor • External and extract air filters with analog differential pressure monitoring The initialization of the template takes place within the method FB_Init. 810 Version: 1.14.0 TF8040
## Page 811

Programming Block diagram TF8040 Version: 1.14.0 811
## Page 812

Programming Plant diagram 812 Version: 1.14.0 TF8040
## Page 813

Programming Switch-on sequence of the aggregates of the plant Within Plant Cmd, a step sequence controller sequentially controls the switching on and off of the aggregates one after the other. When switching from aggregate to aggregate, predefined delay times and feedback from the aggregates are taken into account. The order of the aggregates is determined by the ordinal number of the individual elements of the bidirectional array arr Aggregate. Step Stages of plant start-up Aggregate Function blocks 00 E_BA_AC_Plant Step01.e Off Plant Off 01 E_BA_AC_Plant Step01.e Erc Energy recovery Erc 02 E_BA_AC_Plant Step01.e Pre Rinse Prerinsing of the hot water Pre Htr air heater 03 E_BA_AC_Plant Step01.e Damper Ou A Outside air damper Ou ADmp 04 E_BA_AC_Plant Step01.e Fan Supply Air Supply air fan Su AFan 05 E_BA_AC_Plant Step01.e Damper Exh A Exhaust air damper Exh ADmp 06 E_BA_AC_Plant Step01.e Fan Extract Air Extract air fan Ext AFan 07 E_BA_AC_Plant Step01.e Cooler Cold water air cooler Col 08 E_BA_AC_Plant Step01.e On Room supply air cascade, TCas Ctrl plant On If the plant has reached step 08 E_BA_AC_Plant Step01.e On, the supply air temperature sequence control TSeq Link is enabled when the cascade control TCas Ctrl is switched on. TF8040 Version: 1.14.0 813
## Page 814

Programming Starting up the plant in cold weather When the system is switched on in cold weather, the step sequence control of the Plant Cmd command includes the plant step Pre Rinse of the preheater E_BA_AC_Plant Step01.e Pre Rinse. In this step, the return temperature control of the hot water air heater is activated. This procedure is intended to prevent the freezing of the hot water air heater during the plant start-up. Fault shutdown The plant switches off at: • Fire alarm • Frost alarm In the event of a frost alarm, the Pre Htr hot water air heater remains in the frost protection position even when the plant is switched off! • Fan faults (feedback monitoring, thermoelectric overload, maintenance switch) • Incorrect position of the outside and exhaust air damper. • Filter blockages The following table lists the event-capable objects of the template that can trigger relevant Plant Lock faults. The parameterization of these events can be found in FB_init. Function block e En Plant Lock Function block b Prio High b Prio Medium TSu A. MV E_BA_Lock Priority.e Medium x Filt Ou AMonit. Dst Main Alar E_BA_Lock Priority.e Medium x m Ou ADmp. Monit Open. Dst E_BA_Lock Priority.e Medium x Su AFan. Dst E_BA_Lock Priority.e Medium x Su AFan. Th Ovrld E_BA_Lock Priority.e Medium x Su AFan. Mntn Swi E_BA_Lock Priority.e Medium x Su ADiff Prss Monit. Dst E_BA_Lock Priority.e Medium x Exh ADmp. Monit Open. Dst E_BA_Lock Priority.e Medium x Ext AFan. Dst E_BA_Lock Priority.e Medium x Ext AFan. Th Ovrld E_BA_Lock Priority.e Medium x Ext AFan. Mntn Swi E_BA_Lock Priority.e Medium x Ext ADiff Prss Monit. Dst E_BA_Lock Priority.e Medium x Pre Htr. TRt. MV E_BA_Lock Priority.e Medium x Pre Htr. TFrost. MV E_BA_Lock Priority.e Medium x Pre Htr. Frost Thermostat. Inp E_BA_Lock Priority.e Medium x Plant Lock ut Pre Htr. Pu. Dst E_BA_Lock Priority.e Medium x The parameterization of the lock priority of the event-enabled objects can be found in the FB_init of this template. 814 Version: 1.14.0 TF8040
## Page 815

Programming Temperature control In this plant template a simple room air supply air cascade is realized as control strategy. The setpoints for the plant are generated in the templates Sp TRm / TCas Ctrl and forwarded to the sequence controllers within the templates Pre Htr, Col and Erc. TF8040 Version: 1.14.0 815
## Page 816

Programming Sequence control The number of sequence controllers in the control sequence varies and depends on the number of aggregates in the ventilation system. The PID sequence controllers, which contribute to increasing the supply air temperature, are arranged on the left of the control sequence. The controllers of the aggregates that cool down the supply air temperature are located on the right. Several heating or cooling aggregates can be integrated into the control sequence. Only one PID controller is active at any one time in the sequence control. All others remain at the value of their maximum or minimum control value. The sequence control TSeq Link is enabled when b On is received from the cascade control TCas Ctrl. The start sequence controller with which the plant starts up is determined depending on the weather temperature Site.st General Settings.f TWth [} 1116] or the operation mode Op Mod. The st TSeq Link data structure is used to transmit the plant enable and the number of the start controller to the sequence controllers of the Pre Htr air heater, Col air cooler and Erc energy recovery unit. The ventilation system in the sequence diagram is equipped with an air heater, an energy recovery unit and an air cooler. All aggregates are integrated into a sequence controller for continuous control of the supply air temperature TSu A at very low outdoor temperatures in winter through to high outdoor temperatures in summer. The sequence on the left starts with the control range of the Pre Htr air heater. At low outside temperatures, the output of the air heater is increased until the supply air temperature TSu A has reached its setpoint. 816 Version: 1.14.0 TF8040
## Page 817

Programming If the outside temperature TOu A rises, the sequence controller TSu ACtrl of the Pre Htr air heater reduces its actuating variable until it reaches the lower limit of its control range. If the setpoint of the supply air temperature TCas Ctrl is still not reached, the sequence controller TSu ACtrl of the air heater Pre Htr switches to the sequence controller TSu ACtrl of the energy recovery Erc. The behavior of the energy recovery Erc depends on the ratio of the weather temperature Site.st General Settings.f TWth [} 1116] and the extract air temperature TExt A. If the weather temperature Site.st General Settings.f TWth [} 1116] is lower than the extract air temperature TExt A, energy recovery recovers heat energy from the extract air and transfers it to the outside air. The red characteristic curve is then activated in the control sequence. The control direction of the sequence controller TSu ACtrl is therefore indirect (heating mode). In summer, the extract air temperature is often lower than the weather temperature. The energy flow of the energy recovery Erc is then inverted. The heat from the outside air is transferred to the exhaust air TExh A and the supply air temperature is reduced as a result. In this operating case, the sequence follows the blue characteristic curve. The control direction of the sequence controller TSu ACtrl is therefore direct (cooling mode). At high outside temperatures, if the recovery capacity of the Erc is not sufficient to cool the outside air Ou A down far enough, the sequence controller TSu ACtrl of the energy recovery Erc switches on to the sequence controller TSu ACtrl of the cooler Col. This increases the capacity of the cooler until the setpoint of the supply air temperature is reached. Filter monitoring The outside and extract air filters are monitored via the function blocks Filt Ou AMonit and Filt Ext AMonit with the analog differential pressure sensors Diff Prss Ou AFilt / Diff Prss Ext AFilt. The filter monitors are enabled when b On is received from the cascade control TCas Ctrl. Night cooling Night cooling can be controlled via the function block Sum Ngt Col. Syntax FUNCTION_BLOCK FB_BA_AHU_1st_10 EXTENDS FB_BA_View VAR_INPUT CONSTANT TOu A : FB_BA_Sensor Analog; TExh A : FB_BA_Sensor Analog; TSu A : FB_BA_Sensor Analog; TExt A : FB_BA_Sensor Analog; TRm : FB_BA_Sensor Analog; Diff Prss Ou AFilt : FB_BA_Sensor Analog; Filt Ou AMonit : FB_BA_Hys_21; Diff Prss Ext AFilt : FB_BA_Sensor Analog; Filt Ext AMonit : FB_BA_Hys_21; Ou ADmp : FB_BA_AC_Dmp2P; Su APrss : FB_BA_Sensor Analog; Su ADiff Prss : FB_BA_Sensor Analog; Su AFan : FB_BA_AC_Fan Ctl; Su ADiff Prss Monit : FB_BA_Fdb Analog; Exh ADmp : FB_BA_AC_Dmp2P; Ext APrss : FB_BA_Sensor Analog; Ext ADiff Prss : FB_BA_Sensor Analog; Ext AFan : FB_BA_AC_Fan Ctl; Ext ADiff Prss Monit : FB_BA_Fdb Analog; Pre Htr : FB_BA_AC_Pre Htr; Erc : FB_BA_AC_Erc Pl_02; Col : FB_BA_AC_Col T_02; Sp TRm : FB_BA_Scale_04_Y2_3; TCas Ctrl : FB_BA_AC_TCas Ctrl_01; Sum Ngt Col : FB_BA_AC_Sum Ngt Col; Op Mod : FB_BA_AC_Op Mod1St; En Prio : FB_BA_AC_En Prio; TF8040 Version: 1.14.0 817
## Page 818

Programming Plant Lock : FB_BA_Plant Lock; Plant Cmd : FB_BA_AC_Plant Cmd_AHU_1st_10; TSeq Link : FB_BA_AC_Seq T; st TSeq Link : ST_BA_Seq Link; arr Aggregate : ARRAY [1.. BA_Param.n Max Aggregate] OF ST_BA_Aggregate; END_VAR 818 Version: 1.14.0 TF8040
## Page 819

Programming VAR_INPUT CONSTANT TF8040 Version: 1.14.0 819
## Page 820

Programming Name Type Description TOu A FB_BA_Sensor Analog Represents the outside air temperature [} 1087] TExh A FB_BA_Sensor Analog Represents the exhaust air temperature [} 1087] TSu A FB_BA_Sensor Analog Represents the supply air temperature [} 1087] TExt A FB_BA_Sensor Analog Represents the extract air temperature [} 1087] TRm FB_BA_Sensor Analog Represents the room temperature [} 1087] Diff Prss Ou AFilt FB_BA_Sensor Analog Analog differential pressure via the outside air filter [} 1087] Filt Ou AMonit FB_BA_Hys_21 [} 1010] Analog monitoring of the outside air filter. The filter monitoring uses the analog differential pressure Diff Prss Ou AFilt and can trigger both a pre-alarm and a main alarm. Diff Prss Ext AFilt FB_BA_Sensor Analog Analog differential pressure via the extract air filter [} 1087] Filt Ext AMonit FB_BA_Hys_21 [} 1010] Analog monitoring of the extract air filter. Filter monitoring uses the analog differential pressure Filt Ext AMonit and can trigger both a pre-alarm and a main alarm. Ou ADmp FB_BA_AC_Dmp2P [} 719] Activation of the outside air damper with a spring return actuator and end position monitor. Su APrss FB_BA_Sensor Analog Supply air pressure [} 1087] Su ADiff Prss FB_BA_Sensor Analog Differential pressure via the supply air fan [} 1087] Su AFan FB_BA_AC_Fan Ctl [} 743] Activation and control of the speed-controlled supply air fan. Su ADiff Prss Monit FB_BA_Fdb Analog [} 1016] Analog differential pressure monitoring via the supply air fan. Differential pressure monitoring uses the Su ADiff Prss analog differential pressure sensor and can trigger a plant shutdown alarm. Exh ADmp FB_BA_AC_Dmp2P [} 719] Control of the exhaust air damper with a spring return actuator and end position monitor. Ext APrss FB_BA_Sensor Analog Extract air pressure. The extract air pressure is the controlled variable of the [} 1087] pressure controller of the extract air fan Ext AFan. Ext ADiff Prss FB_BA_Sensor Analog Differential pressure via the extract air fan [} 1087] Ext AFan FB_BA_AC_Fan Ctl [} 743] Control and regulation of the speed-controlled extract air fan. Ext ADiff Prss Monit FB_BA_Fdb Analog [} 1016] Analog differential pressure monitoring via the extract air fan. Differential pressure monitoring uses the analog differential pressure sensor Ext ADiff Prss and can trigger a plant shutdown alarm. Pre Htr FB_BA_AC_Pre Htr [} 748] Activation and control of a hot water air heater. The function block is regarded as an aggregate and is part of the temperature sequence control of this plant due to its implemented sequence controller. 820 Version: 1.14.0 TF8040
## Page 821

Programming Name Type Description Erc FB_BA_AC_Erc Pl_02 [} 733] Activation and control of a plate heat exchanger for the energy recovery of a ventilation system. The function block is considered as an aggregate and is part of the temperature sequence control of this plant due to its implemented sequence controller. Col FB_BA_AC_Col T_02 [} 716] Activation and control of a temperature-controlled cold water air cooler. The function block is considered as an aggregate and is part of the temperature sequence control of this plant due to its implemented sequence controller. Sp TRm FB_BA_Scale_04_Y2_3 Setpoint program for supply air temperature control with a supply air temperature setpoint, including summer/winter [} 1048] compensation via a characteristic curve. TCas Ctrl FB_BA_AC_TCas Ctrl_01 Room temperature control by means of room-supply air cascade. It consists of a master controller for setpoint [} 801] calculation for heating, cooling and energy recovery. Sum Ngt Col FB_BA_AC_Sum Ngt Col Night cooling control [} 783] Op Mod FB_BA_AC_Op Mod1St The function block is used to switch on the plant. It represents the choice of plant operation mode, a timer [} 763] program and a plant selector switch. En Prio FB_BA_AC_En Prio [} 759] Defines the plant release for controlling the step sequence control of a plant and the release of the priorities "Safety", "Critcial" and "Program" based on the plant operation mode Op Mod. These releases are transferred to Plant Cmd. Plant Lock FB_BA_Plant Lock [} 135] When the function block is called, the relevant faults of the event-enabled objects are collected and output at this and lower levels of the plant. These relevant faults trigger the operation mode Fault E_BA_AC_Op Mod01.e Alarm in the operation mode program Op Mod. As a result, the air conditioning system is shut down. A list of the faults that shut down the plant can be found under Fault shutdowns. Plant Cmd FB_BA_AC_Plant Cmd_AHU The function block represents the plant command of the aggregates and functions of this air conditioning system. _1st_10 [} 786] The integrated step sequence controller fixes the order in which the individual aggregates of the plant are switched on or off sequentially one after the other. TSeq Link FB_BA_AC_Seq T [} 778] Represents the start and control of the supply air temperature sequence control. st TSeq Link ST_BA_Seq Link [} 123] Data and command structure between the individual sequence controllers of the temperature control sequence Pre Htr, Col, Erc and the supply air temperature sequence control TSeq Link. arr Aggregates ST_BA_Aggregate [} 278] The array contains a bidirectional data and command structure for each aggregate. When the step sequence controller is switched up or down, the switching command determined for each aggregate is transferred via the bidirectional communication structure arr Aggregate. Feedback from the aggregates for switching the step sequence control up or down is transmitted to the plant control unit via the communication structure. TF8040 Version: 1.14.0 821
## Page 822

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.2 Automation Control 6.1.4.2.1.2.1 FB_BA_Automation Control The template contains basic functions and project information relevant for an automation station. In the sub-template FB_BA_Device [} 830] information about the project and diagnostic options are offered. A parameterization of the BACnet device and general BACnet parameters takes place. Below FB_BA_Device there are two possibilities to integrate the BACnet system time or the local NT system time of the Twin CAT system. The sub-template FB_BA_Evt Groups AMEV2017 [} 844] provides event classes (notification classes) for the intrinsic reporting. The sub-template FB_BA_Control Cabinet [} 829] is used to collect and display control cabinet messages. An evaluation of the alarms of the automation station takes place and a central acknowledgement can be triggered. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Automation Control EXTENDS FB_BA_View VAR_INPUT CONSTANT Device : FB_BA_Device; Evt Groups : FB_BA_Evt Groups AMEV2017; Cabinet : FB_BA_Control Cabinet; END_VAR 822 Version: 1.14.0 TF8040
## Page 823

Programming VAR_INPUT CONSTANT Name Type Description Device FB_BA_Device [} 830] Information about the project and diagnostic options are offered in the template. A parameterization of the BACnet device and general BACnet parameters takes place. Below FB_BA_Device there are two possibilities to integrate the BACnet system time or the local NT system time of the Twin CAT system. Evt Groups FB_BA_Evt Groups AMEV20 The template provides event classes (notification classes) for intrinsic reporting. 17 [} 844] Cabinet FB_BA_Control Cabinet The template is used to collect and display control cabinet messages. An evaluation of the alarms of the automation [} 829] station takes place and a central acknowledgement can be triggered. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.2.2 Control Cabinet 6.1.4.2.1.2.2.1 FB_BA_Control Cabinet Basic Ext The template is used to control a collective error signal lamp and to acknowledge or reset alarms by means of a push button. All alarms in the PLC are acknowledged, reset and output via the function block FB_BA_Event Observer [} 134] used in the template. The resulting collective alarm is used in the template Lamp Fault [} 986] to control a collective error signal lamp. In case of a new, unacknowledged alarm or event, the signal lamp is flashing. If only acknowledged alarms are present, the lamp is permanently on (new value message). To acknowledge and reset an alarm, the acknowledge button must be pressed twice. If the acknowledgement and reset should be done with a button press, then in the GVL BA_Param the value of e Evt Mgmt_Ack Mode.e Single must be changed to e Evt Mgmt_Ack Mode.e Entire. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 823
## Page 824

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Control Cabinet Basic Ext EXTENDS FB_BA_View VAR_INPUT CONSTANT Lamp Fault : FB_BA_Actuator Cmd; Ack Button : FB_BA_Combination BI_BV; Event Observer : FB_BA_Event Observer; END_VAR VAR b Has Event : BOOL; b Has Unack Event : BOOL; b Trig Rst Swi : BOOL; b Trig Rst Button : BOOL; END_VAR 824 Version: 1.14.0 TF8040
## Page 825

Programming VAR_INPUT CONSTANT Name Type Description Lamp Fault FB_BA_Actuator Cmd The template is used to control a collective error signal lamp. [} 986] Ack Button FB_BA_Combination BI_BV The template contains a binary input for connecting the acknowledgement button as well as a binary Value object [} 1084] for remote triggering of an acknowledgement from the management level. Event Observer FB_BA_Event Observer The function block Event Observer realizes the evaluation of all alarms / events of the project structure (base [} 134] framework) and their acknowledgement. The connection to the project structure is made by initializing the property Parent of the template FB_BA_Event Observer. In this template an assignment to the base object FB_BA_Top View of the project structure/ base framework is implemented at the property. VAR Name Type Description b Has Event BOOL This variable indicates that an alarm is present in the project. b Has Unack Event BOOL This variable indicates that there are unacknowledged alarms in the project. b Trig Rst Swi BOOL Display of the acknowledgement signal from the BV object Input (see FB_BA_Combination BI_BV). b Trig Rst Button BOOL Display of the acknowledgement signal from the BV object Value (see FB_BA_Combination BI_BV). Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.2.2.2 FB_BA_Control Cabinet Basic The template is used to control a collective error signal lamp, to acknowledge or reset alarms by means of a push button and to reset hardware in the control cabinet by outputting a momentary pulse. All alarms in the PLC are acknowledged, reset and output via the function block FB_BA_Event Observer [} 134] used in the template. The resulting collective alarm is used in the template Lamp Fault [} 986] to control a collective error signal lamp. In case of a new, unacknowledged alarm or event, the signal lamp is flashing. If only acknowledged alarms are present, the lamp is permanently on (new value message). A momentary pulse for resetting hardware, is output via the function block Rst Hw [} 986]. This is extended to two seconds by the timing element tp Reset Hw. In this way, relay switching within the control cabinet is reliably acknowledged by a sufficiently long pulse. TF8040 Version: 1.14.0 825
## Page 826

Programming To acknowledge and reset an alarm, the acknowledge button must be pressed twice. If the acknowledgement and reset should be done with a button press, then in the GVL BA_Param the value of e Evt Mgmt_Ack Mode.e Single must be changed to e Evt Mgmt_Ack Mode.e Entire. The initialization of the template takes place within the method FB_Init. 826 Version: 1.14.0 TF8040
## Page 827

Programming Block diagram TF8040 Version: 1.14.0 827
## Page 828

Programming Syntax FUNCTION_BLOCK FB_BA_Control Cabinet Basic EXTENDS FB_BA_View VAR_INPUT CONSTANT Lamp Fault : FB_BA_Actuator Cmd; Ack Button : FB_BA_Combination BI_BV; Rst Hw : FB_BA_Actuator Cmd; Event Observer : FB_BA_Event Observer; END_VAR VAR b Has Event : BOOL; b Has Unack Event : BOOL; Blink : FB_BA_Blink; tp Reset Hw : TP; b Trig Rst Swi : BOOL; b Trig Rst Button : BOOL; END_VAR VAR_INPUT CONSTANT Name Type Description Lamp Fault FB_BA_Actuator Cmd The template is used to control a collective error signal lamp. [} 986] Ack Button FB_BA_Combination BI_BV The template contains a binary input for connecting the acknowledgement button as well as a binary Value object [} 1084] for remote triggering of an acknowledgement from the management level. Rst Hw FB_BA_Actuator Cmd The template can be used to wipe in relay circuits (e.g. frost protection relay). [} 986] Event Observer FB_BA_Event Observer The function block Event Observer realizes the evaluation of all alarms / events of the project structure (base [} 134] framework) and their acknowledgement. The connection to the project structure is made by initializing the property Parent of the template FB_BA_Event Observer. In this template an assignment to the base object FB_BA_Top View of the project structure/ base framework is implemented at the property. VAR Name Type Description b Has Event BOOL This variable indicates that an alarm is present in the project. b Has Unack Event BOOL This variable indicates that there are unacknowledged alarms in the project. Blink FB_BA_Blink [} 435] The function block generates a blink pulse. This blink pulse is written to the global variable BA2_Param.b Blink. tp Reset Hw TP The timing element extends the acknowledgement pulse for interfacing relay circuits (e.g. frost protection relay). b Trig Rst Swi BOOL Display of the acknowledgement signal from the BV object Input (see FB_BA_Combination BI_BV). b Trig Rst Button BOOL Display of the acknowledgement signal from the BV object Value (see FB_BA_Combination BI_BV). Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 828 Version: 1.14.0 TF8040
## Page 829

Programming 6.1.4.2.1.2.2.3 FB_BA_Control Cabinet The template is used to collect and display control cabinet messages such as fuses, overcurrent protection devices, power recovery relays, etc. It mainly consists of 3 BI objects for displaying fuses. The template serves as a template and should be adapted to the respective circumstances. The base class FB_BA_Control Cabinet Basic [} 825] accesses the base framework. It evaluates the alarms of the automation station and a central acknowledgement can be triggered. The initialization of the template takes place within the method FB_Init. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_View [} 241] FB_BA_Control Cabinet Basic [} 825] Block diagram Syntax FUNCTION_BLOCK FB_BA_Control Cabinet EXTENDS FB_BA_Control Cabinet Basic VAR_INPUT CONSTANT Fuse01 : FB_BA_Sensor Binary; Fuse02 : FB_BA_Sensor Binary; Fuse03 : FB_BA_Sensor Binary; END_VAR TF8040 Version: 1.14.0 829
## Page 830

Programming VAR_INPUT CONSTANT Name Type Description Fuse01 FB_BA_Sensor Binary The template contains a binary input for connecting a fuse message. [} 1088] Fuse02 FB_BA_Sensor Binary The template contains a binary input for connecting a fuse message. [} 1088] Fuse03 FB_BA_Sensor Binary The template contains a binary input for connecting a fuse message. [} 1088] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.2.3 Device 6.1.4.2.1.2.3.1 FB_BA_Device The template includes several basic functions. The function block FB_BA_Project Ex provides information about the project and offers information and diagnostic options. It triggers the persistent storage of data. A partial parameterization of the BACnet Device takes place via the function block FB_BA_Project Ex. The template FB_BA_Trend Logging contains various Trendlog objects. The function block FB_BA_Parameter [} 833] is used to parameterize global parameter lists of the library Tc3_XBA [} 99]. Within the Time Settings folder there are two possibilities to integrate the BACnet system time or the local NT system time of the Twin CAT system. The initialization of the template takes place within the method FB_Init. 830 Version: 1.14.0 TF8040
## Page 831

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Settings EXTENDS FB_BA_View VAR_INPUT CONSTANT Trend : FB_BA_Trend Logging; Project : FB_BA_Project Ex; Parameter : FB_BA_Parameter; END_VAR VAR ton Dly Start PLC : TON; END_VAR Inputs CONSTANT Name Type Description Trend FB_BA_Trend Logging Calling the Trendlog objects. [} 1056] Project FB_BA_Project Ex [} 841] The function block provides information about the project and offers information and diagnostic options. It also stores the persistent data. It has the input b Wrt Prs On Power Fail, which stores the persistent data in case of an edge and is intended for linking a UPS function block. Furthermore, it is used to parameterize the object name and the object description of the BACnet Device object (server). Parameter FB_BA_Parameter [} 833] Within the function block global parameter lists of the libraries Tc3_XBA [} 99], Tc3_BACnet Rev14, Tc3_BA2_Common and Tc3_BA2 [} 267] are parameterized. TF8040 Version: 1.14.0 831
## Page 832

Programming Variables Name Type Description ton Dly Start PLC TON The timing element sets the global variable b Dly Start PLC [} 1118] delayed after a PLC restart. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.2.3.2 BACnet Settings 6.1.4.2.1.2.3.2.1 FB_BACnet_Rcp List The sample shows the parameterization of the recipient list of the message/event class objects. This sample must be adapted to the project in question. Syntax FUNCTION_BLOCK FB_BACnet_Rcp List VAR b Write : BOOL ; // Recipient list to write (to all event classes): a Recipient List : T_BACnet_Recipient List := [( n Process Id := 10000, st Valid Days := F_BACnet_Valid Days(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE), st From Time := F_BA_To STTime(T#0H), st To Time := F_BA_To STTime(T#23H59M59S), b Issue Confirmed := FALSE, st Event Transitions := F_BACnet_Event Transition Bits(TRUE, TRUE, TRUE), st Recipient := F_BACnet_Device Recipient(n Device Instance:=1445709) ),( n Process Id := 30100, st Valid Days := F_BACnet_Valid Days(TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE), st From Time := F_BA_To STTime(T#0H), st To Time := F_BA_To STTime(T#23H59M59S), b Issue Confirmed := TRUE, st Event Transitions := F_BACnet_Event Transition Bits(TRUE, TRUE, TRUE), st Recipient := F_BACnet_Ethernet Recipient(n IPAddress1:=192,168,10,200, n Port:=47808 , n Network Nr:=444) ),( n Process Id := 40100, st Valid Days := F_BACnet_Valid Days(TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE), st From Time := F_BA_To STTime(T#0H), st To Time := F_BA_To STTime(T#23H59M59S), b Issue Confirmed := TRUE, st Event Transitions := F_BACnet_Event Transition Bits(TRUE, TRUE, TRUE), st Recipient := F_BACnet_Ethernet Recipient(n IPAddress1:=192,168,15,200, n Port:=47808 , n Network Nr:=555) )]; END_VAR VAR b Result : BOOL; _i Obj : I_BA_Object; _fb BACnet Obj : POINTER TO FB_BACnet_Base Object; _h Res : HRESULT; END_VAR Implementation part IF (XBA_Globals. Top. Project State = E_BA_Project State.e First Op Cycle) THEN b Write := TRUE; END_IF 832 Version: 1.14.0 TF8040
## Page 833

Programming IF (b Write) THEN b Write := FALSE; // Iterate over all event class objects: _i Obj := 0; WHILE (F_BA_Iterate Object Index(_i Obj, E_BA_Object Type.e Event Class)) DO // Receive internal BACnet object from BA object: IF (NOT _i Obj. Get BACnet Object(fb Object=>_fb BACnet Obj)) THEN _i Obj. Log Msg. Show(ADSLOG_MSGTYPE_ERROR, 'RL09', 'Failed to receive internal BACnet object!', T RUE); ELSE // Write recipient list: _h Res := _fb BACnet Obj^. Write Property Recipient List(a Recipient List); IF (FAILED(_h Res)) THEN ; // Do some error handling (An error message has already been logged here). END_IF END_IF END_WHILE END_IF Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.2.3.2.2 FB_BA_Parameter The function block contains the function block FB_BA_Param in the declaration part of the method FB_init. This is used to parameterize the global variable lists XBA_BACnet Param and XBA_Param [} 126] of the library Tc3_XBA [} 99]. In the implementation part of the method FB_init various parameterizations are listed for this purpose. The initialization of the template takes place within the method FB_Init. A call of the FB_BA_Param is not necessary due to the internal attributes {attribute 'no_explicit_call' := 'No need to call this FB.'} and {attribute 'Tc Ignore Persistent'}, see FB_BA_Param [} 159]! There is also a commented out example in the template, which contains the parameterization of the recipient list of the message/event class objects. This sample must be adapted to the project in question. Syntax FUNCTION_BLOCK FB_BA_Parameter VAR // Recipient : FB_BACnet_Rcp List; END_VAR Implementation part // Recipient list to write (to all event classes): // Recipient(); Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 833
## Page 834

Programming 6.1.4.2.1.2.3.3 Time Settings 6.1.4.2.1.2.3.3.1 FB_BA_BACnet Time_TO_Sys Time The template reads the BACnet system time at regular intervals and writes it to the local NT system time of the Twin CAT system. The NT system time is read at regular intervals and the time information is mapped in the PLC to local and global variables [} 1117]. Block diagram 834 Version: 1.14.0 TF8040
## Page 835

Programming Syntax FUNCTION_BLOCK FB_BA_BACnet Time_TO_Sys Time VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Unit':= 's'} Get Local Sys Time_n Ti Auto : UDINT := 60; END_VAR VAR_INPUT CONSTANT Set Sys Time Local : FB_BA_Set Time; Get Local Sys Time : FB_BA_Get Time; Get BACnet Adapter Time : FB_BACnet_Get Adapter Time; END_VAR VAR Get BACnet Adapter Time_w Year : WORD; Get BACnet Adapter Time_w Month : WORD; Get BACnet Adapter Time_w Day Of Week : WORD; Get BACnet Adapter Time_w Day : WORD; Get BACnet Adapter Time_w Hour : WORD; Get BACnet Adapter Time_w Minute : WORD; Get BACnet Adapter Time_w Second : WORD; Get BACnet Adapter Time_w Milliseconds : WORD; END_VAR Inputs CONSTANT PERSISTENT Name Type Description Get Local Sys Time_n UDINT Based on this time information, the local NT system time of Ti Auto a Twin CAT system is regularly determined. Inputs CONSTANT Name Type Description Set Sys Time Local FB_BA_Set Time The locally determined BACnet system time (Get BACnet Adapter Time) is written to the local NT system time of the Twin CAT system using the function block Set Sys Time Local. Get Local Sys Time FB_BA_Get Time The function block Get Local Sys Time determines the local NT system time of the Twin CAT system. The determined time is transferred to the global variable lists Sys Time [} 1117]. Get BACnet Adapter T FB_BACnet_Get Adapter T The function block Get BACnet Adapter Time determines the ime ime local BACnet system time. Important parameters are explained below. TF8040 Version: 1.14.0 835
## Page 836

Programming VAR Name Type Description Get BACnet Adapter T WORD Year specification of the BACnet system time. ime_w Year Get BACnet Adapter T WORD Month specification of the BACnet system time. ime_w Month Get BACnet Adapter T WORD Indication of the day of the week of the BACnet system ime_w Day Of Week time. Get BACnet Adapter T WORD Indication of the day in the month of the BACnet system ime_w Day time. Get BACnet Adapter T WORD Hour specification of the BACnet system time. ime_w Hour Get BACnet Adapter T WORD Minute specification of the BACnet system time. ime_w Minute Get BACnet Adapter T WORD Seconds specification of the BACnet system time. ime_w Second Get BACnet Adapter T WORD Milliseconds specification of the BACnet system time. ime_w Milliseconds Parameter of Get BACnet Adapter Time These parameters are used to configure time synchronization. Name Type Description Get BACnet Adapter T BOOL A rising edge at this input determines the local BACnet ime.b Trig system time of a Twin CAT system. Get BACnet Adapter T UDINT The local BACnet system time of a Twin CAT system is ime.n Ti Auto automatically determined on a regular basis using this time specification from the parameter menu. The time specification must be greater than or equal to 500ms. The default value is 1800s. Get BACnet Adapter T fb Adapter The function block fb Adapter represents a BACnet device. ime.fb Adapter This is pre-initialized to the local BACnet device of the Twin CAT system under Devices. Get BACnet Adapter T BOOL The system time was read successfully from the target ime.b Success system. The variable is TRUE for one cycle. Get BACnet Adapter T ST_BA_Date Time Current BACnet system time of a Twin CAT system. ime.st Date Time Get BACnet Adapter T TIMESTRUCT Current BACnet system time of a Twin CAT system. ime.st Time Struct Get BACnet Adapter T BOOL Error while reading the BACnet system time. ime.b Error Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.2.3.3.2 FB_BA_External Sys Time The template reads the NT system time of an external Twin CAT system at regular intervals. 836 Version: 1.14.0 TF8040
## Page 837

Programming If the readout was successful, then the external system time is written to the local NT system time of the Twin CAT system and the local BACnet system time of the Twin CAT system. The two local system times are read out at regular intervals and mapped to local and global variables in the PLC. TF8040 Version: 1.14.0 837
## Page 838

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_External Sys Time VAR_INPUT CONSTANT PERSISTET s External Ams Net Id : T_Ams Net Id := ''; 838 Version: 1.14.0 TF8040
## Page 839

Programming {attribute 'parameter Unit':= 's'} Get Ext Sys Time_n Ti Auto : UDINT := 600; {attribute 'parameter Unit':= 's'} Get Local Sys Time_n Ti Auto : UDINT := 60; END_VAR VAR_INPUT CONSTANT Get Ext Sys Time : FB_BA_Get Time; Set Sys Time Local : FB_BA_Set Time; Set BACnet Adapter Time : FB_BACnet_Set Adapter Time; Get Local Sys Time : FB_BA_Get Time; Get BACnet Adapter Time : FB_BACnet_Get Adapter Time; END_VAR VAR Get Ext Sys Time_b Sync : BOOL; Get Ext Sys Time_rtrig Sync : R_TRIG; Get BACnet Adapter Time_w Year : WORD; Get BACnet Adapter Time_w Month : WORD; Get BACnet Adapter Time_w Day Of Week : WORD; Get BACnet Adapter Time_w Day : WORD; Get BACnet Adapter Time_w Hour : WORD; Get BACnet Adapter Time_w Minute : WORD; Get BACnet Adapter Time_w Second : WORD; Get BACnet Adapter Time_w Milliseconds : WORD; END_VAR Inputs CONSTANT PERSISTENT Name Type Description s External Ams Net Id T_Ams Net Id The Ams Net Id of the Twin CAT computer whose NT system time is to be read is specified here. Get BACnet Adapter T UDINT Based on this time information, the local BACnet system ime_n Ti Auto time of a Twin CAT system is regularly determined automatically. Get Local Sys Time_n UDINT Based on this time information, the local NT system time of Ti Auto a Twin CAT system is regularly determined. Inputs CONSTANT Name Type Description Get Ext Sys Time FB_BA_Get Time The function block Get Ext Sys Time determines the external NT system time of a Twin CAT system. Set Sys Time Local FB_BA_Set Time The locally determined BACnet system time (Get BACnet Adapter Time) is written to the local NT system time of the Twin CAT system using the function block Set Sys Time Local. Set BACnet Adapter Ti FB_BACnet_Set Adapter Ti The function block Set BACnet Adapter Time can set both me me the local BACnet system time of a Twin CAT system (Set BACnet Adapter Time.b Trig Sync Local) and, by triggering a broadcast command (Set BACnet Adapter Time.b Trig Sync Broadcast), all BACnet system times of a network. Important parameters are explained below. Get Local Sys Time FB_BA_Get Time The function block Get Local Sys Time determines the local NT system time of the Twin CAT system. The determined time is transferred to the global variable lists Sys Time [} 1117]. Get BACnet Adapter T FB_BACnet_Get Adapter T The function block "Get BACnet Adapter Time" determines ime ime the local BACnet system time. Important parameters are explained below. TF8040 Version: 1.14.0 839
## Page 840

Programming VAR Name Type Description Get Ext Sys Time_b Sy BOOL The variable triggers the writing of the external system nc time to the local NT system time of the Twin CAT system and the local BACnet system time of the Twin CAT system. Get Ext Sys Time_rtrig R_TRIG The function block generates a rising edge after Sync successfully reading the external system time Get Ext Sys Time and passes this on to Get Ext Sys Time_b Sync. Get BACnet Adapter T WORD Year specification of the BACnet system time. ime_w Year Get BACnet Adapter T WORD Month specification of the BACnet system time. ime_w Month Get BACnet Adapter T WORD Indication of the day of the week of the BACnet system ime_w Day Of Week time. Get BACnet Adapter T WORD Indication of the day in the month of the BACnet system ime_w Day time. Get BACnet Adapter T WORD Hour specification of the BACnet system time. ime_w Hour Get BACnet Adapter T WORD Minute specification of the BACnet system time. ime_w Minute Get BACnet Adapter T WORD Seconds specification of the BACnet system time. ime_w Second Get BACnet Adapter T WORD Milliseconds specification of the BACnet system time. ime_w Milliseconds Parameter of Set BACnet Adapter Time These parameters are used to configure time synchronization. Name Type Description Set BACnet Adapter Ti BOOL On a rising edge at this input, the content of the structure me.b Trig Sync Local Set BACnet Adapter Time.st Date Time is written to the local BACnet system time of the Twin CAT system. Set BACnet Adapter Ti BOOL On a rising edge at this input, the content of the me.b Trig Sync Broadc Set BACnet Adapter Time.st Date Time structure is written to ast all BACnet system times of a network as well as the local BACnet system time of the Twin CAT system. Set BACnet Adapter Ti ST_BA_Date Time Time specification which is written to the local BACnet me.st Date Time system time. Set BACnet Adapter Ti fb Adapter The function block fb Adapter represents a BACnet device. me.fb Adapter This is pre-initialized to the local BACnet device of the Twin CAT system under Devices. Set BACnet Adapter Ti BOOL The system time was read successfully from the target me.b Success system. The variable is TRUE for one cycle. Set BACnet Adapter Ti BOOL Error while reading the BACnet system time. me.b Error Parameter of Get BACnet Adapter Time These parameters are used to configure time synchronization. 840 Version: 1.14.0 TF8040
## Page 841

Programming Name Type Description Get BACnet Adapter T BOOL A rising edge at this input determines the local BACnet ime.b Trig system time of a Twin CAT system. Get BACnet Adapter T UDINT The local BACnet system time of a Twin CAT system is ime.n Ti Auto automatically determined on a regular basis using this time specification from the parameter menu. The time specification must be greater than or equal to 500ms. The default value is 1800s. Get BACnet Adapter T fb Adapter The function block fb Adapter represents a BACnet device. ime.fb Adapter This is pre-initialized to the local BACnet device of the Twin CAT system under Devices. Get BACnet Adapter T BOOL The system time was read successfully from the target ime.b Success system. The variable is TRUE for one cycle. Get BACnet Adapter T ST_BA_Date Time Current BACnet system time of a Twin CAT system. ime.st Date Time Get BACnet Adapter T TIMESTRUCT Current BACnet system time of a Twin CAT system. ime.st Time Struct Get BACnet Adapter T BOOL Error while reading the BACnet system time. ime.b Error Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.2.3.4 Project 6.1.4.2.1.2.3.4.1 FB_BA_Project Ex This template is derived from the basic function block FB_BA_Project [} 227]. It provides the project version number for information purposes and ensures that persistent data is saved. The writing of persistent data has 2 modes: • Normal state of the system: Commissioning is complete and the system is running. The persistent data is written at a fixed interval t Prs Data_Default Period, pre-set to 30 minutes. This protects the memory card. Parameterizing t Prs Data_Default Period below 10 minutes resets this value to 30 minutes as a precaution. • Commissioning mode: By automatically detecting an online change, the system switches to commissioning mode and the persistent data is now saved at shorter intervals. The interval t Prs Data_Comissioning Period, which is pre-set to 10 minutes, applies here. Parameterizing t Prs Data_Comissioning Period below 30 seconds resets this value to 5 minutes as a precaution. TF8040 Version: 1.14.0 841
## Page 842

Programming If no online change is detected after a fixed DETECT_COMISSIONING_DURATION time of 60 minutes, the routine returns to normal operation. Syntax FUNCTION_BLOCK FB_BA_Project Ex EXTENDS FB_BA_Project VAR_INPUT CONSTANT PERSISTENT t Prs Data_Default Period : TIME := T#30M; t Prs Data_Comissioning Period : TIME := T#10M; END_VAR VAR_INPUT CONSTANT b Prs Data_Manual Write Data : BOOL; END_VAR VAR_INPUT b Wrt Prs On Power Fail : BOOL; END_VAR VAR_OUTPUT n Prs Data Written : UINT; END_VAR Inputs CONSTANT PERSITENT Name Type Description t Prs Data_Default Per TIME Storage interval in normal state. iod t Prs Data_Comission TIME Storage interval in commissioning state. ing Period Inputs CONSTANT Name Type Description b Prs Data_Manual Wr BOOL This variable can be set to TRUE for commissioning purposes. ite Data This triggers a one-time saving of the persistent variables. Inputs Name Type Description b Wrt Prs On Power Fai BOOL Input variable for linking with a UPS function block l Outputs Name Type Description n Prs Data Written UINT Counter output for the executed write cycles. Requirements Development environment Necessary function Twin CAT from v3.1.4024.62 TF8040 | Twin CAT Building Automation from V5.9.0.0 6.1.4.2.1.2.4 Event Classes 6.1.4.2.1.2.4.1 FB_BA_Evt Groups The template provides a group of notification classes. 842 Version: 1.14.0 TF8040
## Page 843

Programming The initialization of the template takes place within the method FB_Init. Notification class matrix Event category Meaning Priority Notifica- NC object Sample tion EC object class Hazard notification Danger to life 00 - 29 EC_ID. N Life Safety. EC Fire alarm, robbery (Life Safety) C10 Hazard notification Safety message 30 - 59 EC_ID. N Safety Msg. EC Burglary, unauthorized entry (Property Safety) C20 Alarm message Message 60 - 89 EC_ID. N Alarm Msg. EC Safety temperature limiter indicates system C30 (STB), safety pressure limiter failure or requires (SDB), excess temperature immediate of water heating (WWB), intervention. safety valves, main pumps, V-belt monitors, frequency converters, refrigeration systems, voltage failure, etc. Fault message Message 90 - 119 EC_ID. N Fault Msg. EC Temperature monitor (TW), indicates C40 pressure monitor (DW), abnormal temperature monitoring of operating state. heat exchanger (WT) and WWB, motor protection, elevator collective error message, mains pressures, etc. Maintenance Indication of 120 - 149 EC_ID. N Maintenance Msg Operating hours, tank level, message maintenance C50 01. EC repair switch, etc. activity or similar. Maintenance Indication of 120 - 149 EC_ID. N Maintenance Msg Filter end reached, filter dirty, message maintenance C51 02. EC etc. activity or similar. System message Fault message 150 - 219 EC_ID. N System Msg. EC Device malfunction, battery from the GA C60 message, communication system. interruption, etc. Manual Manual 220 EC_ID. N Manual Op. EC Manual intervention intervention intervention C70 Subject to Other messages 221 - 255 EC_ID. N Other Msg. EC Operating state change, confirmation C80 operation modes, trend memory full, etc. Syntax FUNCTION_BLOCK FB_BA_Evt Groups EXTENDS FB_BA_View VAR_INPUT CONSTANT Life Safety : FB_BA_Evt Category; Safety Msg : FB_BA_Evt Category; Alarm Msg : FB_BA_Evt Category; Fault Msg : FB_BA_Evt Category; Maintenance Msg01 : FB_BA_Evt Category; Maintenance Msg02 : FB_BA_Evt Category; System Msg : FB_BA_Evt Category; Manual Op : FB_BA_Evt Category; Other Msg : FB_BA_Evt Category; END_VAR TF8040 Version: 1.14.0 843
## Page 844

Programming VAR_INPUT CONSTANT Name Type Description Life Safety FB_BA_Evt Category [} 1002]The template calls the "Danger to life" event category. Safety Msg FB_BA_Evt Category [} 1002]The template calls the "Danger message, safety message" event category. Alarm Msg FB_BA_Evt Category [} 1002]The template calls the "Alarm message" event category. Fault Msg FB_BA_Evt Category [} 1002]The template calls the "Fault message" event category. Maintenance Msg01 FB_BA_Evt Category [} 1002]The template calls the event category "Maintenance message". Maintenance Msg02 FB_BA_Evt Category [} 1002]The template calls the event category "Maintenance message". System Msg FB_BA_Evt Category [} 1002]The template calls the event category "System message". Manual Op FB_BA_Evt Category [} 1002]The template calls the event category "Manual intervention". Other Msg FB_BA_Evt Category [} 1002]The template calls the event category "Other messages". Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.2.4.2 FB_BA_Evt Groups AMEV2017 The template generates the notification classes according to the requirements of the AMEV (Arbeitskreis Maschinen- und Elektrotechnik staatlicher und kommunaler Verwaltungen, Working Group Mechanical and Electrical Engineering of Public and Municipal Administrations). The initialization of the template takes place within the method FB_Init. 844 Version: 1.14.0 TF8040
## Page 845

Programming Block diagram TF8040 Version: 1.14.0 845
## Page 846

Programming Notification class list Event category Meaning Priority Notifica- NC object Example tion EC object class Hazard notification Danger to life 00 - 29 EC_ID. N Life Safety. EC Fire alarm, robbery (Life Safety) C10 Hazard notification Safety message 30 - 59 EC_ID. N Safety Msg. EC Burglary, unauthorized entry (Property Safety) C20 Alarm message Message 60 - 89 EC_ID. N Alarm Msg. EC Safety temperature limiter indicates system C30 (STB), safety pressure limiter failure or requires (SDB), excess temperature immediate of water heating (WWB), intervention. safety valves, main pumps, V-belt monitors, frequency converters, refrigeration systems, voltage failure, etc. Fault message Message 90 - 119 EC_ID. N Fault Msg. EC Temperature monitor (TW), indicates C40 pressure monitor (DW), abnormal temperature monitoring of operating state. heat exchanger (WT) and WWB, motor protection, elevator collective error message, mains pressures, etc. Maintenance Indication of 120 - 149 EC_ID. N Maintenance Msg Operating hours, tank level, message maintenance C50 01. EC repair switch, etc. activity or similar. Maintenance Indication of 120 - 149 EC_ID. N Maintenance Msg Filter end reached, filter dirty, message maintenance C51 02. EC etc. activity or similar. System message Fault message 150 - 219 EC_ID. N System Msg. EC Device malfunction, battery from the GA C60 message, communication system. interruption, etc. Manual message Manual 220 EC_ID. N Manual Op. EC Manual intervention intervention C70 Subject to Other messages 221 - 255 EC_ID. N Other Msg. EC Operating state change, confirmation C80 operation modes, trend memory full, etc. Syntax FUNCTION_BLOCK FB_BA_Evt Groups AMEV2017 EXTENDS FB_BA_View VAR_INPUT CONSTANT Life Safety : FB_BA_Evt Category; Safety Msg : FB_BA_Evt Category; Alarm Msg : FB_BA_Evt Category; Fault Msg : FB_BA_Evt Category; Maintenance Msg01 : FB_BA_Evt Category; Maintenance Msg02 : FB_BA_Evt Category; System Msg : FB_BA_Evt Category; Manual Op : FB_BA_Evt Category; Other Msg : FB_BA_Evt Category; END_VAR 846 Version: 1.14.0 TF8040
## Page 847

Programming VAR_INPUT CONSTANT Name Type Description Life Safety FB_BA_Evt Category [} 1002]The template calls the "Danger to life" event category. Safety Msg FB_BA_Evt Category [} 1002]The template calls the "Danger message, safety message" event category. Alarm Msg FB_BA_Evt Category [} 1002]The template calls the "Alarm message" event category. Fault Msg FB_BA_Evt Category [} 1002]The template calls the "Fault message" event category. Maintenance Msg01 FB_BA_Evt Category [} 1002]The template calls the event category "Maintenance message". Maintenance Msg02 FB_BA_Evt Category [} 1002]The template calls the event category "Maintenance message". System Msg FB_BA_Evt Category [} 1002]The template calls the event category "System message". Manual Op FB_BA_Evt Category [} 1002]The template calls the event category "Manual intervention". Other Msg FB_BA_Evt Category [} 1002]The template calls the event category "Other messages". Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3 Building Automation Templates for cross-system functions. 6.1.4.2.1.3.1 Communication 6.1.4.2.1.3.1.1 FB_BA_Ads Com Server_Basic The purpose of the template is to read data and parameters assigned to the "General Building Automation" trade from the global variable list Site [} 1116] and make them available within the BA network via FB_BA_Raw Publisher [} 139]. The counter-block that receives this data as a client is FB_BA_Ads Com Client_Basic [} 848]. Block diagram TF8040 Version: 1.14.0 847
## Page 848

Programming Syntax FUNCTION_BLOCK FB_BA_Ads Com Server VAR_INPUT CONSTANT Weather Station : FB_BA_Raw Publisher; General Settings : FB_BA_Raw Publisher; Building Alarms : FB_BA_Raw Publisher; END_VAR VAR_INPUT CONSTANT Name Type Description Weather Station FB_BA_Raw Publisher The publisher Weather Station publishes the structure of [} 139] the weather station data Site.st Weather Station. [} 1116] General Settings FB_BA_Raw Publisher The publisher General Settings publishes the structure of [} 139] the weather parameters Site.st Settings [} 1116], which are created in the template FB_BA_Weather Data [} 862]. Building Alarms FB_BA_Raw Publisher The publisher Building Alarms publishes the structure of the [} 139] building-wide alarms Site.st Building Alarms [} 1116], which are created in the templates FB_BA_Burglar Alarm System and FB_BA_Fire Alarm System. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.3.1.2 FB_BA_Ads Com Client_Basic The template reads global data assigned to the "General building automation" trade from another controller, which makes this data available with the counter-block FB_BA_Ads Com Server_Basic [} 847]. The information read is copied to the global variable list Site [} 1116]. The initialization of the template takes place within the method FB_Init. Block diagram 848 Version: 1.14.0 TF8040
## Page 849

Programming Syntax FUNCTION_BLOCK FB_BA_Ads Com Client EXTENDS FB_BA_View VAR_INPUT CONSTANT Weather Station : FB_BA_Raw Subscriber; Weather Station Error : FB_BA_BV_Error State; General Settings : FB_BA_Raw Subscriber; General Settings Error : FB_BA_BV_Error State; Building Alarms : FB_BA_Raw Subscriber; Building Alarms Error : FB_BA_BV_Error State; END_VAR VAR_INPUT CONSTANT Name Type Description Weather Station FB_BA_Raw Subscriber The subscriber accesses the Twin CAT network structure Weather Station and saves the data in the created structure [} 158] st Weather Station of the GVL Site [} 1116]. Weather Station Error FB_BA_BV_Error State Binary object indicating communication failure of the subscriber Weather Station. [} 1030] General Settings FB_BA_Raw Subscriber The subscriber accesses the Twin CAT network structure General Settings and saves the data in the created [} 158] structure st General Settings of the GVL Site [} 1116]. General Settings Erro FB_BA_BV_Error State Binary object indicating communication failure of the r subscriber General Settings. [} 1030] Building Alarms FB_BA_Raw Subscriber The subscriber accesses the Twin CAT network structure Building Alarms and saves the data in the created structure [} 158] st Building Alarms of the GVL Site [} 1116]. Building Alarms Error FB_BA_BV_Error State Binary object indicating communication failure of the subscriber Building Alarms. [} 1030] Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.3.2 Global Events And Settings 6.1.4.2.1.3.2.1 FB_BA_Building Alarms This template summarizes building-specific safety criteria and makes them available in a globally declared structure st Building Alarms (see global variable list Site [} 1116]). The criteria in detail are: 1. Fire alarm (Fire Alert): this alarm is read in directly via a binary input object. 2. Burglar alarm (Bgly/Burglary): this alarm is read in directly via a binary input object. 3. Central switch-off (Cent Swi Off), actually no alarm. This input object makes it possible, for example, to reset manual flags building-wide or to switch off lights at this central point. 4. Forced ventilation (Forced Venilation): in this template on reserve, to trigger forced ventilation. 5. Smoke extraction (Smoke Extraction): in this template on reserve, to trigger a smoke extraction operation. TF8040 Version: 1.14.0 849
## Page 850

Programming The initialization of the template takes place within the method FB_Init. Illustration FUNCTION_BLOCK FB_BA_Building Alarms EXTENDS FB_BA_View VAR_INPUT CONSTANT Fire Alert : FB_BA_BI_IO; Bgly : FB_BA_BI_IO; Cent Swi Off : FB_BA_BV_Op; END_VAR Inputs CONSTANT Name Type Description Fire Alert FB_BA_BI_IO [} 205] Binary input object "Fire alert". Bgly FB_BA_BI_IO [} 205] Binary input object "Burglary". Cent Swi Off FB_BA_BV_Op [} 216] Binary input object "Central switch off". Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.2.2 FB_BA_Building Mode Selection of building mode based on a schedule (Sched) and manual intervention (Op Mod Man). The manual intervention has the following modes (Op Mod Man): Value Meaning 1 Automatic mode 2 manual selection Default 3 manual selection Nightwatch 4 manual selection Cleaning If Automatic mode is selected, the function block De Mux Man Mod sets the output b Q01. Since this output is not connected to the Prio Swi , the manual mode on the Prio Swi is disabled and the schedule Sched is active. This can assume the following values: Value Meaning 1 Default 2 Nightwatch 3 Cleaning The currently selected building mode is then displayed via the function block Op Mod Pr and made available via Publisher. The initialization of the template takes place within the method FB_Init. 850 Version: 1.14.0 TF8040
## Page 851

Programming Illustration FUNCTION_BLOCK FB_BA_Building Mode EXTENDS FB_BA_View VAR_INPUT CONSTANT Op Mod Man : FB_BA_MV_Op; Op Mod Pr : FB_BA_MV_Op; Sched : FB_BA_Sched M; END_VAR VAR De Mux Man Mod : FB_BA_DMUX_B04; De Mux Sched : FB_BA_DMUX_B04; Prio Swi : FB_BA_Prio Swi_UDI08; END_VAR Inputs CONSTANT Name Type Description Op Mod Man FB_BA_MV_Op [} 239] The Multistate-Value object represents an operating modes switch with the operating modes Auto, Manual-Off and Manual-On. Op Mod Pr FB_BA_MV_Op [} 239] The Multistate-Value object indicates the state of the currently valid plant operation mode. Sched FB_BA_Sched M [} 225] Schedule object (automatic) for the "Building Energy Level". Variables Name Type Description De Mux Man Mode FB_BA_DMUX_B04 [} 637] Conversion of the multistate value of the manual selection to a binary output. De Mux Sched FB_BA_DMUX_B04 [} 426] Conversion of the multistate value of the schedule to a binary output. Prio Swi FB_BA_Prio Swi_UDI08 Prioritizing reconversion of the states to a resulting multistate or enumeration value for the building energy [} 433] level. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.2.3 FB_BA_Events And Settings The template represents the plant level. It is used for the preparation and distribution of global data, which is required system- or building-wide for the control and regulation of the system and room automation. The function block FB_BA_Building Alarms [} 849] is used to record global events that are required in a building or property at all automation stations of the system. The function block FB_BA_Weather Parameter is used for the global provision of weather-specific parameters and setpoints. The function block FB_BA_Building Mode [} 850] is used for the global provision of building operating modes. The global building data is stored in the GVL site [} 1116]. TF8040 Version: 1.14.0 851
## Page 852

Programming The initialization of the template takes place within the method FB_Init. Block diagram Illustration FUNCTION_BLOCK FB_BA_Building Global EXTENDS FB_BA_View VAR_INPUT f TWth : REAL; END_VAR VAR_INPUT CONSTANT Build Alm : FB_BA_Building Alarms; Build Mode : FB_BA_Building Mode; Wth Param : FB_BA_Weather Parameter; END_VAR Inputs Name Type Description f TWth REAL Current value of the outside temperature. Inputs CONSTANT Name Type Description Build Alm FB_BA_Building Alarms Template for the building alarms. [} 849] Build Mode FB_BA_Building Mode Template for the building operation modes. [} 850] Wth Param FB_BA_Weather Parameter Template for the evaluation of the outside temperature. [} 863] 852 Version: 1.14.0 TF8040
## Page 853

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.3 Weather Station 6.1.4.2.1.3.3.1 FB_BA_Weatherstation_Draft This template represents a programming template for a weather station for which no prepared template is available. To the objects Dstb ... Sun Elv the values of the existing weather station are to be linked, if available, as well as the time. There is no object for the time of the type TIMESTRUCT, here the placeholder variable must be replaced. This is only for error-free translation of the base project. The respective values f Present Value are combined in a globally declared variable structure st Weatherstation (see Site [} 1116]). TF8040 Version: 1.14.0 853
## Page 854

Programming The initialization of the template takes place within the method FB_Init. Syntax FUNCTION_BLOCK FB_BA_Weather Station_Draft EXTENDS FB_BA_View VAR_INPUT CONSTANT Dstb : FB_BA_BI; Rain : FB_BA_BI; Wth T : FB_BA_AI; Dew Pt T : FB_BA_AI; Prss Abs : FB_BA_AI; Prss Rel : FB_BA_AI; Hum Abs : FB_BA_AI; Hum Rel : FB_BA_AI; Brightness : FB_BA_AI; Dawn : FB_BA_AI; Glob Radn : FB_BA_AI; Wnd Dir : FB_BA_AI; Wnd Spd : FB_BA_AI; Latd : FB_BA_AI; 854 Version: 1.14.0 TF8040
## Page 855

Programming Lngt : FB_BA_AI; Sun Azm : FB_BA_AI; Sun Elv : FB_BA_AI; END_VAR VAR st Date Time_PLACEHOLDER : TIMESTRUCT; END_VAR Inputs CONSTANT Name Type Description Dstb FB_BA_BI [} 204] The weather station reports a malfunction. Rain FB_BA_BI [} 204] Rain sensor. Wth T FB_BA_AI [} 191] Outside temperature [°C]. Dew Pt T FB_BA_AI [} 191] Dew point temperature [°C]. Prss Abs FB_BA_AI [} 191] Absolute air pressure [h Pa]. Prss Rel FB_BA_AI [} 191] Relative air pressure [h Pa]. Hum Abs FB_BA_AI [} 191] Absolute humidity [g/m3]. Hum Rel FB_BA_AI [} 191] Relative Absolute Humidity [g/m3]. Brightness_N FB_BA_AI [} 191] Directional light sensor north [Lux]. Brightness_S FB_BA_AI [} 191] Directional light sensor south [Lux]. Brightness_E FB_BA_AI [} 191] Directional light sensor east [Lux]. Brightness_W FB_BA_AI [} 191] Directional light sensor west [Lux]. Dawn FB_BA_AI [} 191] Dawn [Lux]. Glob Radn FB_BA_AI [} 191] Global radiation [W/m²]. Wnd Dir FB_BA_AI [} 191] Wind direction [°]. Wnd Spd FB_BA_AI [} 191] Wind speed [m/s] Latd FB_BA_AI [} 191] Latitude of the installation site [°]. Lngt FB_BA_AI [} 191] Longitude of the installation site [°]. Sun Azm FB_BA_AI [} 191] Current position of the sun [°]. Sun Elv FB_BA_AI [} 191] Current sun elevation [°]. Variables Name Type Description st Date Time_PLACE TIMESTRUCT Placeholder variable: instead of this variable, a suitable HOLDER time structure can be linked, which provides the current time via the weather station. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.3.2 FB_BA_Weatherstation_Thies TF8040 Version: 1.14.0 855
## Page 856

Programming This template prepares the data which are read from a Thies weather station via the function block FB_BA_Thies WSC11 [} 1114] and makes them available in a globally declared variable structure st Weatherstation (see global variable list Site [} 1116]). In addition, the hardware connection is established in this template via the variables st Raw Data In and st Raw Data Out. A detailed description of the integration of the weather station [} 1097] can be found here. The initialization of the template takes place within the method FB_Init. Syntax FUNCTION_BLOCK FB_BA_Weather Station_Thies EXTENDS FB_BA_View VAR_INPUT CONSTANT Serial Comm Rst : FB_BA_Bv_OP; Wth St Rst : FB_BA_Bv_OP; Serial Comm Err : FB_BA_BV; Dstb : FB_BA_BV; Rain : FB_BA_BI; Wth T : FB_BA_AI; Dew Pt T : FB_BA_AI; Prss Abs : FB_BA_AI; Prss Rel : FB_BA_AI; Hum Abs : FB_BA_AI; Hum Rel : FB_BA_AI; Brightness_N : FB_BA_AI; Brightness_S : FB_BA_AI; Brightness_E : FB_BA_AI; Brightness_W : FB_BA_AI; Dawn : FB_BA_AI; Glob Radn : FB_BA_AI; Wnd Dir : FB_BA_AI; Wnd Spd : FB_BA_AI; Latd : FB_BA_AI; Lngt : FB_BA_AI; Sun Azm : FB_BA_AI; Sun Elv : FB_BA_AI; END_VAR VAR Thies WSC11 : FB_BA_Thies WSC11; b Reset Weather Station : BOOL; b Reset Serial Communication : BOOL; Data Conversion : FB_BA_Thies Data; ton Serial Comm Err : TON; ton Dstb : TON; st Raw Data In AT %I* : KL6In Data22B; st Raw Data Out AT %Q* : KL6Out Data22B; fb Serial Ctrl : Serial Line Control; fb KL6Configuration : KL6configuration; st Tx Buff : Com Buffer; st Rx Buff : Com Buffer; b Serial Config Error : BOOL; n Serial Config Error ID : UDINT; b Serial Comm Error : BOOL; n Serial Comm Error ID : UDINT; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Unit':= 's'} n Serial Comm Err Delay : UDINT := 10; {attribute 'parameter Unit':= 's'} n Dstb Delay : UDINT := 10; END_VAR 856 Version: 1.14.0 TF8040
## Page 857

Programming Inputs CONSTANT Name Type Description Serial Comm Rst FB_BA_Bv_OP [} 216] Restart the serial communication if it is permanently faulty due to a configuration error or during operation. Wth St Rst FB_BA_Bv_OP [} 216] Restarting the weather station itself if it is permanently faulty. Here the PLC routine is restarted starting with the configuration and subsequent cyclic query. A hardware reset is not performed. Serial Comm Err FB_BA_BV [} 213] Message requiring acknowledgement: Serial communication or configuration permanently faulty. Dstb FB_BA_BV [} 213] The weather station reports a malfunction. Rain FB_BA_BI [} 204] Rain sensor. Wth T FB_BA_AI [} 191] Outside temperature [°C]. Dew Pt T FB_BA_AI [} 191] Dew point temperature [°C]. Prss Abs FB_BA_AI [} 191] Absolute air pressure [h Pa]. Prss Rel FB_BA_AI [} 191] Relative air pressure [h Pa]. Hum Abs FB_BA_AI [} 191] Absolute humidity [g/m3]. Hum Rel FB_BA_AI [} 191] Relative Absolute Humidity [g/m3]. Brightness_N FB_BA_AI [} 191] Directional light sensor north [Lux]. Brightness_S FB_BA_AI [} 191] Directional light sensor south [Lux]. Brightness_E FB_BA_AI [} 191] Directional light sensor east [Lux]. Brightness_W FB_BA_AI [} 191] Directional light sensor west [Lux]. Dawn FB_BA_AI [} 191] Dawn [Lux]. Glob Radn FB_BA_AI [} 191] Global radiation [W/m²]. Wnd Dir FB_BA_AI [} 191] Wind direction [°]. Wnd Spd FB_BA_AI [} 191] Wind speed [m/s] Latd FB_BA_AI [} 191] Latitude of the installation site [°]. Lngt FB_BA_AI [} 191] Longitude of the installation site [°]. Sun Azm FB_BA_AI [} 191] Current position of the sun [°]. Sun Elv FB_BA_AI [} 191] Current sun elevation [°]. TF8040 Version: 1.14.0 857
## Page 858

Programming Variables Name Type Description Thies WSC11 FB_BA_Thies WSC11 Function block for unloading the data from the Thies WSC11 [} 1114] b Reset Weather Stati BOOL Reset weather station. on b Reset Serial Commu BOOL Reset serial communication. nication Data Conversion FB_BA_Thies Data [} 1115] Converts the Thies weather station data into project- specific data. Example brightness: conversion from k Lux to Lux, because only this unit is supported by BACnet. ton Serial Comm Err TON Error delay communication error. ton Dstb TON Error delay weather station error st Raw Data In KL6In Data22B Input raw values from the serial terminal. st Raw Data Out KL6In Data22B Output raw values to the serial terminal. fb Serial Ctrl Serial Line Control Communication block to the serial terminal. Runs in the fast task under the Fast Cycle method. fb KL6Configuration KL6configuration Configuration block to the serial terminal. Runs in the fast task under the Fast Cycle method. This is used to set the serial parameters (baud rate, etc), but not the process image (see Thies weather station [} 1097]). st Tx Buff Com Buffer Communication variable between the fb Serial Ctrl of the fast task and the Thies WSC11 of the normal PLC task. st Rx Buff Com Buffer Communication variable between the fb Serial Ctrl of the fast task and the Thies WSC11 of the normal PLC task. b Serial Config Error BOOL Configuration error of the serial communication. n Serial Config Error ID UDINT Error number. b Serial Comm Error BOOL Communication error of the serial communication. n Serial Comm Error ID UDINT Error number. Inputs CONSTANT PERSISTENT Name Type Description n Serial Comm Err Del UDINT Error delay communication error [s]. ay n Dstb Delay UDINT Error delay weather station error [s]. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.4 General 6.1.4.2.1.3.4.1 FB_BA_Building Data 858 Version: 1.14.0 TF8040
## Page 859

Programming This template at system level is used to call up sub-templates that provide building-wide data and operation modes. Typically, this template is called up in the building calculator. The initialization of the template takes place within the method FB_Init. Block diagram Syntax VAR_INPUT CONSTANT Building Mode : FB_BA_Building Mode; Building Energ Lvl : FB_BA_Building Energy Level; Building Sp Rm T : FB_BA_Building Sp Rm T; Building Light : FB_BA_Building Lighting; END_VAR VAR_INPUT CONSTANT Name Type Description Building Mode FB_BA_Building Mode The sub-template Building Mode defines the building operation mode using a schedule with manual intervention. [} 850] Building Energ Lvl FB_BA_Building Energy Leve The sub-template Building Energ Lvl defines the building energy level using a schedule with manual intervention. l [} 889] Building Sp Rm T FB_BA_Building Sp Rm T The sub-template Building Sp Rm T is used to enter the heating/cooling room temperature setpoints for the various [} 860] building energy levels. In addition, a summer and a winter compensation value for the room temperature is determined based on the outside temperature. Building Light FB_BA_Building Lighting The sub-template Building Light compiles cross-building control telegrams for the light functions. [} 917] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.4.2 FB_BA_Floor Data TF8040 Version: 1.14.0 859
## Page 860

Programming This template at system level is used to call up sub-templates that provide floor-wide data and operation modes. This template is typically called up in the floor controllers. The initialization of the template takes place within the method FB_Init. Block diagram Syntax VAR_INPUT CONSTANT Floor Lighting : FB_BA_Floor Lighting; END_VAR VAR_INPUT CONSTANT Name Type Description Floor Lighting FB_BA_Floor Lighting The sub-template calls up functions assigned to the illumination in the floor area. [} 919] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.4.3 Functions 6.1.4.2.1.3.4.3.1 FB_BA_Building Sp Rm T In this template the basic setpoints Protection Cooling ... Comfort Cooling and Protection Heating ... Comfort Heating are applied with correction values and made available as building-wide setpoints in a globally declared structure variable st Building Sp Rm T (see global variable list Site [} 1116]). The correction affects the Precomfort and Comfort values respectively, see FB_BA_Sp Rm T [} 305]. These are: • central setpoint value shift These two values, Shift Htg and Shift Col, are each added to the corresponding values for Precomfort and Comfort. 860 Version: 1.14.0 TF8040
## Page 861

Programming • weather-compensated setpoint value shift (summer or winter compensation) Using the outside temperature from the weather station data st Weather Station (see global variable list Site [} 1116]), correction values are calculated here once again, which are added to the values for Precomfort and Comfort. The calculation is performed using the interpolation function blocks FB_BA_Scale_02 [} 1042], which can be parameterized in the FB_init method. The initialization of the template takes place within the method FB_Init. Illustration FUNCTION_BLOCK FB_BA_Building Sp Rm T EXTENDS FB_BA_View VAR_INPUT CONSTANT Sum Cpsn : FB_BA_Scale_02; Win Cpsn : FB_BA_Scale_02; Prtc Htg : FB_BA_AV_Op; Eco Htg : FB_BA_AV_Op; Pre Cmf Htg : FB_BA_AV_Op; Cmf Htg : FB_BA_AV_Op; Prtc Col : FB_BA_AV_Op; Eco Col : FB_BA_AV_Op; Pre Cmf Col : FB_BA_AV_Op; Cmf Col : FB_BA_AV_Op; Shift Htg : FB_BA_AV_Op; Shift Col : FB_BA_AV_Op; END_VAR VAR Sp Rm T : FB_BA_Sp Rm T; END_VAR TF8040 Version: 1.14.0 861
## Page 862

Programming Inputs CONSTANT Name Type Description Sum Cpsn FB_BA_Scale_02 [} 1042] Value Summer compensation [K] Win Cpsn FB_BA_Scale_02 [} 1042] Value Winter compensation [K] Prtc Htg FB_BA_AV_Op [} 202] Basic setpoint Protection Heating [°C] Eco Htg FB_BA_AV_Op [} 202] Basic setpoint Economy Heating [°C] Pre Cmf Htg FB_BA_AV_Op [} 202] Basic setpoint Precomfort Heating [°C] Cmf Htg FB_BA_AV_Op [} 202] Basic setpoint Comfort Heating [°C] Prtc Col FB_BA_AV_Op [} 202] Basic setpoint Protection Cooling [°C] Eco Col FB_BA_AV_Op [} 202] Basic setpoint Economy Cooling [°C] Pre Cmf Col FB_BA_AV_Op [} 202] Basic setpoint Precomfort Cooling [°C] Cmf Col FB_BA_AV_Op [} 202] Basic setpoint Comfort Cooling [°C] Shift Htg FB_BA_AV_Op [} 202] Setpoint value shift Heating [K] Shitf Col FB_BA_AV_Op [} 202] Setpoint value shift Cooling [K] Variables Name Type Description Sp Rm T FB_BA_Sp Rm T [} 305] Function block for calculating the applied temperature setpoints. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.5 Weather Data 6.1.4.2.1.3.5.1 FB_BA_Weather Data The template is used to prepare and distribute global data that is required throughout the system or building to control and regulate the system automation. The function block FB_BA_Weather Parameter [} 863] is used for the global provision of weather-specific parameters and setpoints. The global building data is stored in the GVL Site [} 1116]. The initialization of the template takes place within the method FB_Init. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] 862 Version: 1.14.0 TF8040
## Page 863

Programming FB_BA_View [} 241] Block diagram Syntax FUNCTION_BLOCK FB_BA_Weather Data EXTENDS FB_BA_View VAR_INPUT CONSTANT Wth Param : FB_BA_Weather Parameter; END_VAR Inputs CONSTANT Name Type Description Wth Param FB_BA_Weather Parameter Sub-template for evaluating and creating weather parameters. [} 863] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.5.2 Parameter 6.1.4.2.1.3.5.2.1 FB_BA_Weather Parameter The template calculates various values from the measured value of the outside temperature, which are required system-wide for the control and regulation of heating, ventilation and air conditioning systems. TF8040 Version: 1.14.0 863
## Page 864

Programming The object Sp Frst Protec is used to enter a frost protection setpoint. The frost protection setpoint is used system-wide in all HVAC templates with a water-side frost protection. The function block TWth Low Limit Hys calculates whether the outside temperature is below the critical value of TWth Low Limit Val. Depending on the value of the variable b TWth Low Limit, the frost protection function of the HVAC systems in the building is activated. The weather-related enable of the heating systems is not dependent on the current, but on the damped outside temperature. The outside temperature is attenuated using the function block Average (formation of a sliding average value). The object TWth Damped is used to display the value of the damped outside temperature. The function block TWth Damped Low Limit Hys is used to check whether the damped outside temperature is below a value that will enable the heating systems in the building. The global weather-related enable is displayed with the object "TWth Damped Low Limit" and written to the variable b TWth Damped Low Limit for further processing in other templates. The initialization of the template takes place within the method FB_Init. Block diagram 864 Version: 1.14.0 TF8040
## Page 865

Programming Syntax FUNCTION_BLOCK FB_BA_Settings EXTENDS FB_BA_View VAR_INPUT f TWth : REAL; END_VAR VAR_OUTPUT f Sp Frst Protec : REAL; f TWth Low Limit : REAL; b TWth Low Limit : BOOL; f TWth Damped : REAL; b TWth Damped Low Limit : BOOL; END_VAR VAR_INPUT CONSTANT Sp Frst Protec : FB_BA_AV_Op; TWth Low Limit Val : FB_BA_AV_Op; TWth Low Limit : FB_BA_BV_Op; TWth Damped : FB_BA_AV_Op; TWth Damped Low Limit : FB_BA_BV_Op; END_VAR VAR TWth Low Limit Hys : FB_BA_Swi2P; Average : FB_BA_Ti Avrg; TWth Damped Low Limit Hys : FB_BA_Swi2P; END_VAR Inputs Name Type Description f TWth REAL Current value of the outside temperature. Outputs Name Type Description f Sp Frst Protec REAL Frost protection setpoint, e.g. for heating circuits in protection mode. f TWth Low Limit REAL Lower limit value of the outside temperature. Below this value, all frost protection functions in HVAC systems are activated. b TWth Low Limit BOOL The output shows the operating message Outside temperature lower limit. The variable is TRUE if the outside temperature is below the value of f TWth Low Crit. f TWth Damped REAL Current value of the damped outside temperature. b TWth Damped Low Li BOOL The output shows the operating message Outside mit temperature damped lower limit. The variable is TRUE if the damped outside temperature is below the value of f TWth Low Crit. Inputs CONSTANT Name Type Description Sp Frst Protec FB_BA_AV_Op [} 202] Analog value object for entering the frost protection setpoint, e.g. for heating circuits in protection mode. TWth Low Limit Val FB_BA_AV_Op [} 202] Analog value object for entering the lower limit value of the outside temperature. Below this value, all frost protection functions in HVAC systems are activated. TWth Low Limit FB_BA_BV_Op [} 216] Binary object displaying the Outside temperature lower limit operating message. TWth Damped FB_BA_AV_Op [} 202] Analog value object for displaying the damped outside temperature. Below this value, all frost protection functions in HVAC systems are activated. TWth Damped Low Li FB_BA_BV_Op [} 216] Binary object displaying the Outside temperature damped mit lower limit operating message. TF8040 Version: 1.14.0 865
## Page 866

Programming Variables Name Type Description TWth Low Limit Hys FB_BA_Swi2P Two-point switch which converts the outside temperature f Wth into a binary switching signal for TWth Low Limit. Average FB_BA_Ti Avrg [} 464] The Average uses the outside temperature f Wth to determine the damped outside temperature f TWth Damped. TWth Damped Low Li FB_BA_Swi2P Two-point switch which converts the damped outside mit Hys temperature f TWth Damped into a binary switching signal for TWth Damped Low Limit. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.3.6 FB_BA_Building Automation Server Call template trade "Building automation" - server version. This template at the "trade" level calls up all sub-templates whose data is ideally processed in a building calculator. In addition, an ADS server template FB_BA_Ads Com Server_Basic [} 847] makes basic data available throughout the building. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Building Automation Server EXTENDS FB_BA_View VAR_INPUT CONSTANT Ads Com Server Basic : FB_BA_Ads Com Server_Basic; Weatherstation01 : FB_BA_Weather Station_Thies; Weather Data : FB_BA_Weather Data; END_VAR 866 Version: 1.14.0 TF8040
## Page 867

Programming VAR_INPUT CONSTANT Name Type Description Ads Com Server Basic FB_BA_Ads Com Server_Basi The sub-template has the task of transmitting data and parameters within the BA network. c [} 847] Weatherstation01 FB_BA_Weather Station_Thi The sub-template is used for data exchange with a weather station type WSC11 from Thies. The suffix "01" at es [} 855] the instance name is intended to indicate that it is quite possible that a building may have multiple weather stations, which should be entered here. Weather Data FB_BA_Weather Data The sub-template is used to prepare and distribute global data that is required throughout the system or building for [} 862] the control and regulation of the system automation. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.3.7 FB_BA_Building Automation Client Call template trade "Building automation" - client version. This template at the "trade" level calls up all sub-templates whose data is ideally prepared in a floor computer. These are floor data from the Floor Data [} 859] template as well as basic data that is transmitted and read by a building computer (FB_BA_Ads Com Client_Basic [} 848]). The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Building Automation EXTENDS FB_BA_View VAR_INPUT CONSTANT Ads Com Client Basic : FB_BA_Ads Com Client_Basic; Floor Data : FB_BA_Floor Data; END_VAR TF8040 Version: 1.14.0 867
## Page 868

Programming VAR_INPUT CONSTANT Name Type Description Ads Com Client Basic FB_BA_Ads Com Client_Basi The sub-template has the task of reading data and parameters sent from other computers, ideally from the c [} 848] building computer. Floor Data FB_BA_Floor Data [} 859] The sub-template calls up further templates that provide floor-wide data and operation modes. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4 Room Automation Templates for creating room automation solutions. 6.1.4.2.1.4.1 Common 6.1.4.2.1.4.1.1 DALIFunction Blocks 6.1.4.2.1.4.1.1.1 DALI communication These instructions and the DALI templates provided refer to the application with a KL6821 in conjunction with the library TC3_DALI. Adding the library Simply adding DALI-based templates to a project does not automatically include the required TC3_DALI library. This must be inserted manually: 868 Version: 1.14.0 TF8040
## Page 869

Programming Right-click on "References" (1) and select "Add Library" (2). In the window that opens, select the library "TC3_DALI" (3) and confirm with "OK" (4). TF8040 Version: 1.14.0 869
## Page 870

Programming Communication blocks and fast task All DALI-based templates require the communication block FB_KL6821Communication, which runs in a fast communication task and establishes the connection to the DALI terminal to which the DALI line of the relevant device is connected. The exact procedure can be found in the Beckhoff Information System within the description of the TC3_DALI. One communication block must be instantiated for each DALI line. Once these have been inserted and called up in the fast task, they are available to the DALI-based templates. Linking in the project The data exchange between the communication block and the DALI-based templates takes place via an interface provided by the communication block. All DALI-based templates have implemented this interface as a parameter (VAR_INPUT CONSTANT PERSISTENT), so that only the respective communication block needs to be linked there in FB_Init. Example: Communication blocks are called up for 4 DALI lines in a fast task: DALI templates are then called up in a room template. These are pre-initialized in the FB_Init of the room template, including the link to the corresponding DALI communication block: 870 Version: 1.14.0 TF8040
## Page 871

Programming 6.1.4.2.1.4.1.1.2 FB_BA_Brtns Prc DALI This function block is used to read a combined DALI brightness and occupancy sensor. For information on the function of the DALI device used, please refer to the manufacturer's device documentation. Function The device is specified by the instance number of the presence, n Instance Presence, and the instance number of the brightness, n Instance Brightness. Added to this is the device-specific resolution, n Res Brtns. These three parameters vary from manufacturer to manufacturer. The brightness is queried cyclically (interval n Prd Query Brtns [s]). With presence, on the other hand, the device's internal notification system is used, which automatically sends a telegram as soon as presence or absence is detected. TF8040 Version: 1.14.0 871
## Page 872

Programming The DALI brightness and presence function block can be initialized via the input b Initialize with partly parameterizable (see VAR_INPUT CONSTANT PERSISTENT) and partly fixed pre-set values (see VAR CONSTANT). Syntax FUNCTION_BLOCK FB_BA_Brtns Prc DALI VAR_INPUT b En : BOOL; b Initialize : BOOL; n Prd Query Brtns : UDINT; n Adr : BYTE; n Inst Prc : BYTE; n Inst Brtns : BYTE; n Res Brtns : BYTE := 10; ip DALICommunication : Tc3_DALI. I_DALICommunication; END_VAR VAR_OUTPUT b Prc : BOOL; n Brtns : UINT; b Initializing : BOOL; b Err : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT n Deadtime : BYTE := 2; n Hold : BYTE := 90; n Report : BYTE := 60; END_VAR VAR CONSTANT n Event Filter : DWORD := 7; e Event Priority : Tc3_DALI. E_DALIEvent Priority := Tc3_DALI. E_DALIEvent Priority. Middle; e Event Scheme : Tc3_DALI. E_DALIEvent Scheme := Tc3_DALI. E_DALIEvent Scheme. Device Instance; END_VAR VAR_INPUT Name Type Description b En BOOL Enabling the function block: a TRUE signal at this input enables the function. b Initialize BOOL A positive edge at this input starts the DALI initialization routine, which transfers the set parameters to the DALI device, see FB_BA_Swi4DALI [} 880]. n Prd Query Brtns UDINT Brightness query interval in seconds. The declaration of this variable as an input is intended to enable a variable query speed. In the case of constant light regulation, for example, a slow query interval is initially sufficient until a larger deviation to be compensated is detected, at which point a shorter interval is used. A "0" at this input disables the query. n Adr BYTE DALI short address of the sensor. n Inst Prc BYTE Vendor-specific number of the presence instance to be queried. n Inst Brtns BYTE Vendor-specific number of the brightness instance to be queried. n Res Brtns BYTE Vendor-specific brightness resolution. ip DALICommunicati Tc3_DALI. I_DALICommuni Interface pointer to the DALI communication block. on cation 872 Version: 1.14.0 TF8040
## Page 873

Programming VAR_OUTPUT Name Type Description b Prc BOOL Occupancy signal output. n Brtns BOOL Measured brightness. The unit is vendor-specific. b Initializing BOOL The sensor is in the DALI initialization phase, i.e. the entered parameters are transferred to the DALI device. b Err BOOL Error output. A plain text is output in Twin CAT in the error list in the output window. VAR_INPUT CONSTANT PERSISTENT The following parameters are transferred to the DALI control gear or the DALI devices by the initialization routine. Name Type Description n Deadtime BYTE Dead time of the occupancy sensor as a multiple of 50 ms, pre-set to 2 (=100 ms). n Hold BYTE Hold time of the occupancy sensor as a multiple of 10 s, pre-set to 90 (=900 s). n Report BYTE Report time of the occupancy sensor in seconds, pre-set to 60 s. VAR CONSTANT The following parameters cannot be changed and are transferred to the DALI device by the initialization routine. Name Type Description n Event Filter DWORD DALI event filter mask for occupancy sensors. This value is set to 7 and thus queries the Occupied, Vacant and Repeat Event states. e Event Priority Tc3_DALI. E_DALIEvent Prio DALI event priority with which input notification events are rity sent by the instance of the DALI control device, set to Middle. e Event Scheme Tc3_DALI. E_DALIEvent Sche DALI event scheme. This is set to Device Instance (device/ me instance addressing with short address and instance number). Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 873
## Page 874

Programming 6.1.4.2.1.4.1.1.3 FB_BA_Light Actr DALI_Base This function block is used to control a DALI light actuator, a DALI group or DALI devices with a broadcast, whereby only the light brightness value is changed. Function Two routines are executed in the function block: • Setting the light value if it deviates from the current value. This is subjected to a hysteresis range n Hys Lgt Val, see below. • Reading the light value. This is done cyclically at the interval n Prd Query Lgt Val in seconds. The "current value" is always initially assumed to be the value that was sent without errors. The cyclic query of the read function will correct the value if a telegram is nevertheless "lost" or the control gear has been controlled in another way. This procedure ensures that, on the one hand, the DALI bus is not overloaded, but on the other hand, the actual light value is always read once. The function block is controlled via values from the light telegram st Lighting Cmd [} 272]. The control values of the light are limited to the limits that were previously transferred to the control gear or the devices by an initialization routine with other configuration parameters, see VAR_INPUT CONSTANT PERSISTENT. Initialization takes place via the input b Initialize. Fixed values are also transferred here, see VAR CONSTANT. The light value is set internally exclusively via the DALI command FB_DALI102Direct Arc Power Control. This means that the Fade Time is the time taken to dim to the new light value. This dimming time is pre-set to 0 s so that dimming ramps can be realized in the PLC alone. If group or broadcast control is selected, the control and initialization commands are directed to all devices. Read commands, on the other hand, are only sent to the reference device. Syntax FUNCTION_BLOCK FB_BA_Light Actr DALI_Base VAR_INPUT b En : BOOL; b Initialize : BOOL; st Lighting Cmd : ST_BA_Lighting; e Adr Type : Tc3_DALI. E_DALIAddress Type := Tc3_DALI. E_DALIAddress Type. Short; n Adr : BYTE; n Adr Ref Dev : BYTE; ip DALICommunication : I_DALICommunication; END_VAR VAR_OUTPUT by Actl Lgt Val : BYTE; f Actl Lgt Val : REAL; b Initializing : BOOL; b Err : BOOL; END_VAR 874 Version: 1.14.0 TF8040
## Page 875

Programming VAR_INPUT CONSTANT PERSISTENT n Hys Lgt Val : BYTE; n Prd Query Lgt Val : UDINT; n Min Level : BYTE := 126; n Max Level : BYTE := 254; n Power On Level : BYTE := 254; n System Failure Level : BYTE := 254; e Fade Time : Tc3_DALI. E_DALIFade Time := Tc3_DALI. E_DALIFade Time. Disabled; e Fade Rate : Tc3_DALI. E_DALIFade Rate := Tc3_DALI. E_DALIFade Rate. N358Steps Per Se c; END_VAR VAR CONSTANT e Extended Fade Time Base : Tc3_DALI. E_DALIExtended Fade Time Base := Tc3_DALI. E_DALIExtended Fad e Time Base. Base01; e Extended Fade Time Multiplier : Tc3_DALI. E_DALIExtended Fade Time Multiplier := Tc3_DALI. E_DALIExten ded Fade Time Multiplier. Disabled; END_VAR VAR_INPUT Name Type Description b En BOOL Enabling the function block: a TRUE signal at this input enables the function. b Initialize BOOL A positive edge at this input starts the DALI initialization routine, which transfers the set parameters to the DALI device, see FB_BA_Swi4DALI [} 880]. st Lighting Cmd ST_BA_Lighting [} 272] Light control telegram e Adr Type Tc3_DALI. E_DALIAddress T Defines whether the input n Adr contains a short address (0...63) or a group address (0...31). The input n Adr has no ype meaning if a broadcast is sent n Adr BYTE DALI short address of the sensor. n Adr Ref Dev BYTE DALI address of a reference device if group or broadcast control is selected. This reference device then represents all other controlled devices. ip DALICommunicati Tc3_DALI. I_DALICommuni Interface pointer to the DALI communication block. on cation VAR_OUTPUT Name Type Description by Actl Lgt Val BYTE Current light value in DALI format (0...254). f Actl Lgt Val REAL Current light value in percent. b Initializing BOOL The sensor is in the DALI initialization phase, i.e. the entered parameters are transferred to the DALI device. b Err BOOL Error output. A plain text is output in Twin CAT in the error list in the output window. VAR_INPUT CONSTANT PERSISTENT Name Type Description n Hys Lgt Val BYTE Hysteresis range around the light control value. A new set command is started if the setpoint n Hys Lgt Val/2 is above or below the actual value. n Prd Query Lgt Val UDINT Query interval of the light value [s]. The following parameters are transferred to the DALI control gear or the DALI devices by the initialization routine. TF8040 Version: 1.14.0 875
## Page 876

Programming Name Type Description n Min Level BYTE Minimum light control value in DALI output format (0...254). Pre-set to 126. n Max Level BYTE Maximum light control value in DALI output format (0...254). Pre-set to 254. n Power On Level BYTE Light control value when the supply voltage is applied to the control gear. Pre-set to 254. n System Failure Leve BYTE Light control value in the event of an error on the DALI bus. l Pre-set to 254. e Fade Time Tc3_DALI. E_DALIFade Time The Fade Time defines the time the current output value takes to reach the required value. The Fade Time is pre-set to "disabled", which together with the deactivated "Extended Fade Time" (VAR CONSTANT) corresponds to a fade time of 0 s. e Fade Rate Tc3_DALI. E_DALIFade Rate The Fade Rate determines the rate of change (in steps per second) of the output value. It is not decisive for the behavior of this function block. It is pre-set to 358 steps/s. VAR CONSTANT The following parameters cannot be changed and are transferred to the DALI device by the initialization routine. Name Type Description e Extended Fade Time Tc3_DALI. E_DALIExtended The Extended Fade Time is intended for very long Base dimming ramps of up to 16 minutes. It is disabled for this Fade Time Base use case. e Extended Fade Time Base designates the time base and is pre-set to the smallest value "Base01". e Extended Fade Time Tc3_DALI. E_DALIExtended e Extended Fade Time Multiplier is the multiplier for the time Multiplier base and is set to the value "Disabled". Fade Time Multiplier Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 876 Version: 1.14.0 TF8040
## Page 877

Programming 6.1.4.2.1.4.1.1.4 FB_BA_Light Actr DALI_TC This function block is used to control a DALI light actuator, a DALI group or DALI devices with a broadcast, whereby color temperature control is supported. Function Four routines are executed in the function block: • Setting the light value if it deviates from the current value. This is subjected to a hysteresis range n Hys Lgt Val, see below. • Setting the color temperature if it deviates from the current value. This is subjected to a hysteresis range f Hys Lgt T, see below. • Reading the light value. This is done cyclically at the interval n Prd Query Lgt Val in seconds. • Reading the color temperature. This is done cyclically at the interval n Prd Query Lgt T in seconds. The "current value" is always initially assumed to be the value that was sent without errors. The cyclic query of the respective read function will correct the value if a telegram is nevertheless "lost" or the control gear has been controlled in another way. This procedure ensures that, on the one hand, the DALI bus is not overloaded, but on the other hand, the actual light value is always read. The function block is controlled via values from the light telegram st Lighting Cmd [} 272]. The control values of the light and the color temperature are limited to the limits that were previously transferred to the control gear or the devices by an initialization routine with other configuration parameters, see VAR_INPUT CONSTANT PERSISTENT. Initialization takes place via the input b Initialize. Fixed values are also transferred here, see VAR CONSTANT. A color temperature setpoint of "0" is explicitly ignored. This allows telegrams to be generated that only influence the brightness, but not the color temperature previously set elsewhere. The light value is set internally exclusively via the DALI command FB_DALI102Direct Arc Power Control. This means that the Fade Time is the time taken to dim to the new light value. This dimming time is pre-set to 0 s so that dimming ramps can only be implemented in the PLC. If group or broadcast control is selected, the control and initialization commands are directed to all devices. Read commands, on the other hand, are only sent to the reference device. TF8040 Version: 1.14.0 877
## Page 878

Programming Syntax FUNCTION_BLOCK FB_BA_Light DALI_TC VAR_INPUT b En : BOOL; b Initialize : BOOL; st Lighting Cmd : ST_BA_Lighting; e Adr Type : Tc3_DALI. E_DALIAddress Type := Tc3_DALI. E_DALIAddress Type. Short; n Adr : BYTE; n Adr Ref Dev : BYTE; ip DALICommunication : Tc3_DALI. I_DALICommunication; END_VAR VAR_OUTPUT by Actl Lgt Val : BYTE; f Actl Lgt Val : REAL; f Actl Lgt T : REAL; b Initializing : BOOL; b Err : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT n Hys Lgt Val : BYTE; f Hys Lgt T : REAL; n Prd Query Lgt Val : UDINT; n Prd Query Lgt T : UDINT; n Min Level : BYTE := 126; n Max Level : BYTE := 254; n Power On Level : BYTE := 254; n System Failure Level : BYTE := 254; e Fade Time : Tc3_DALI. E_DALIFade Time := Tc3_DALI. E_DALIFade Time. Disabled; e Fade Rate : Tc3_DALI. E_DALIFade Rate := Tc3_DALI. E_DALIFade Rate. N358Steps Per Sec; f Temperature Limit Warmest : LREAL := 2700; f Temperature Limit Coolest : LREAL := 6500; f Power On Temperature : LREAL := 3000; f System Failure Temperature : LREAL := 3000; END_VAR VAR CONSTANT e Extended Fade Time Base : Tc3_DALI. E_DALIExtended Fade Time Base := Tc3_DALI. E_DALIExtended Fade T ime Base. Base01; e Extended Fade Time Multiplier : Tc3_DALI. E_DALIExtended Fade Time Multiplier := Tc3_DALI. E_DALIExtende d Fade Time Multiplier. Disabled; END_VAR VAR_INPUT Name Type Description b En BOOL Enabling the function block: a TRUE signal at this input enables the function. b Initialize BOOL A positive edge at this input starts the DALI initialization routine, which transfers the set parameters to the DALI device, see FB_BA_Swi4DALI [} 880]. st Lighting Cmd ST_BA_Lighting [} 272] Light control telegram e Adr Type Tc3_DALI. E_DALIAddress T Defines whether the input n Adr contains a short address (0...63) or a group address (0...31). The input n Adr has no ype meaning if a broadcast is sent n Adr BYTE DALI short address of the sensor. n Adr Ref Dev BYTE DALI address of a reference device if group or broadcast control is selected. This reference device then represents all other controlled devices. ip DALICommunicati Tc3_DALI. I_DALICommuni Interface pointer to the DALI communication block. on cation 878 Version: 1.14.0 TF8040
## Page 879

Programming VAR_OUTPUT Name Type Description by Actl Lgt Val BYTE Current light value in DALI format (0...254). f Actl Lgt Val REAL Current light value in percent. f Actl Lgt T REAL Current color temperature in Kelvin. b Initializing BOOL The sensor is in the DALI initialization phase, i.e. the entered parameters are transferred to the DALI device. b Err BOOL Error output. A plain text is output in Twin CAT in the error list in the output window. VAR_INPUT CONSTANT PERSISTENT Name Type Description n Hys Lgt Val BYTE Hysteresis range around the light control value. A new set command is started if the setpoint n Hys Lgt Val/2 is above or below the actual value. f Hys Lgt T REAL Hysteresis range around the color temperature default value. A new set command is started if the setpoint n Hys Lgt Val/2 is above or below the actual value. n Prd Query Lgt Val UDINT Query interval of the light value [s]. n Prd Query Lgt T UDINT Query interval of the color temperature [s]. The following parameters are transferred to the DALI control gear or the DALI devices by the initialization routine. Name Type Description n Min Level BYTE Minimum light control value in DALI output format (0...254). Pre-set to 126. n Max Level BYTE Maximum light control value in DALI output format (0...254). Pre-set to 254. n Power On Level BYTE Light control value when the supply voltage is applied to the control gear. Pre-set to 254. n System Failure Leve BYTE Light control value in the event of an error on the DALI bus. l Pre-set to 254. e Fade Time Tc3_DALI. E_DALIFade Time The Fade Time defines the time the current output value takes to reach the required value. The Fade Time is pre-set to "disabled", which together with the deactivated "Extended Fade Time" (VAR CONSTANT) corresponds to a fade time of 0 s. e Fade Rate Tc3_DALI. E_DALIFade Rate The Fade Rate determines the rate of change (in steps per second) of the output value. It is not decisive for the behavior of this function block. It is pre-set to 358 steps/s. f Temperature Limit W LREAL Lower limit of the color temperature range in Kelvin. Pre- armest set to 2700 K. f Temperature Limit C LREAL Upper limit of the color temperature range in Kelvin. Pre- oolest set to 6500 K. f Power On Temperatu LREAL Color temperature value when the supply voltage is re applied to the control gear. Pre-set to 3000 K. f System Failure Temp LREAL Color temperature value in the event of an error on the erature DALI bus. Pre-set to 3000 K. TF8040 Version: 1.14.0 879
## Page 880

Programming VAR CONSTANT The following parameters cannot be changed and are transferred to the DALI device by the initialization routine. Name Type Description e Extended Fade Time Tc3_DALI. E_DALIExtended The Extended Fade Time is intended for very long Base dimming ramps of up to 16 minutes. It is disabled for this Fade Time Base use case. e Extended Fade Time Base designates the time base and is pre-set to the smallest value "Base01". e Extended Fade Time Tc3_DALI. E_DALIExtended e Extended Fade Time Multiplier is the multiplier for the time Multiplier base and is set to the value "Disabled". Fade Time Multiplier Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.1.1.5 FB_BA_Swi4DALI This function block is used to read a DALI 4-fold push button. For information on the function of the DALI device used, please refer to the manufacturer's device documentation. Function The device itself is specified by the instance numbers of the buttons, n Inst Button1...n Inst Button4. The device's internal notification system is always used, which automatically sends a telegram as soon as a button press or release is detected. The states of the buttons are also queried cyclically. This ensures that the state of the buttons is always corrected if a telegram is "lost". The DALI push button function block can be initialized with fixed parameters via the input b Initialize, see VAR CONSTANT. Syntax FUNCTION_BLOCK FB_BA_Swi4DALI VAR_INPUT b En : BOOL; b Initialize : BOOL; n Adr : BYTE; n Inst Button1 : BYTE; n Inst Button2 : BYTE; n Inst Button3 : BYTE; n Inst Button4 : BYTE; ip DALICommunication : Tc3_DALI. I_DALICommunication; END_VAR 880 Version: 1.14.0 TF8040
## Page 881

Programming VAR_OUTPUT b Button1 : BOOL; b Button2 : BOOL; b Button3 : BOOL; b Button4 : BOOL; b Initializing : BOOL; b Err : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT n Prd Query : UDINT := 60; END_VAR VAR CONSTANT n Event Filter : DWORD := 131; e Event Priority : Tc3_DALI. E_DALIEvent Priority := Tc3_DALI. E_DALIEvent Priority. Middle; e Event Scheme : Tc3_DALI. E_DALIEvent Scheme := Tc3_DALI. E_DALIEvent Scheme. Device Instance; n Repeat Timer : UINT := 160; n Short Timer : UINT := 500; n Double Timer : UINT := 0; n Stuck Timer : BYTE := 20; END_VAR VAR_INPUT Name Type Description b En BOOL Enabling the function block: a TRUE signal at this input enables the function. b Initialize BOOL A positive edge at this input starts the DALI initialization routine, which transfers the set parameters to the DALI device, see FB_BA_Swi4DALI [} 880]. n Adr BYTE DALI short address of the push button sensor. n Inst Button1... BYTE Numbers of the push button instances to be queried. n Inst Button4 ip DALICommunicati Tc3_DALI. I_DALICommuni Interface pointer to the DALI communication block. on cation VAR_OUTPUT Name Type Description b Button1...b Button4 BOOL State of the individual push buttons (TRUE = pressed). b Initializing BOOL The sensor is in the DALI initialization phase, i.e. the entered parameters are transferred to the DALI device. b Err BOOL Error output. A plain text is output in Twin CAT in the error list in the output window. VAR_INPUT CONSTANT PERSISTENT Name Type Description n Prd Query UDINT Query interval of the switch states. This query is only used for correction if an incorrect state is detected due to a telegram error. VAR CONSTANT The following parameters cannot be changed and are transferred to the DALI device by the initialization routine. TF8040 Version: 1.14.0 881
## Page 882

Programming Name Type Description n Event Filter DWORD DALI event filter mask for occupancy sensors. This value is set to 7 and thus queries the Occupied, Vacant and Repeat Event states. e Event Priority Tc3_DALI. E_DALIEvent Prio DALI event priority with which input notification events are rity sent by the instance of the DALI control device, set to Middle. e Event Scheme Tc3_DALI. E_DALIEvent Sche DALI event scheme. This is set to Device Instance (device/ me instance addressing with short address and instance number). n Repeat Timer UINT Repeat Timer as a multiple of 20 ms. Set to 8 (=160 ms). n Short Timer UINT Short Timer as a multiple of 20 ms. Set to 25 (=500 ms). n Double Timer UINT Double Timer as a multiple of 20 ms. Set to 0 (=0 ms). This means that this value is set to the vendor-specific minimum value. n Stuck Timer BYTE Stuck Timer in seconds. Set to 20 s. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.1.2 Sensors 6.1.4.2.1.4.1.2.1 FB_BA_Switch4DALI The template is used to read a 4-fold switch. Data exchange HMI The data exchange with the HMI is realized here in the base class FB_BA_Base Switch (internal function block). The use of the following variable is visible in this template: • b Initialize Rm: Start DALI initialization routine from the HMI. Function The device itself is specified by the instance numbers of the push buttons, n Inst Button1 ... n Inst Button4. The device's internal notification system is always used, which automatically sends a telegram as soon as a button press or release is detected. The states of the buttons are also queried cyclically in the internal function block FB_BA_Swi4DALI [} 880]. This ensures that the state of the buttons is always corrected if a telegram is "lost". The DALI push button function block can be initialized with its set parameters via the input b Initialize or via the HMI (b Initialize Rm), see FB_BA_Swi4DALI [} 880]. 882 Version: 1.14.0 TF8040
## Page 883

Programming The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Switch4DALI EXTENDS FB_BA_Ext_Switch Base VAR_INPUT b En : BOOL; b Initialize : BOOL; END_VAR VAR_OUTPUT b Button1 : BOOL; b Button2 : BOOL; b Button3 : BOOL; b Button4 : BOOL; b Initializing : BOOL; b Err : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT n Adr : BYTE; n Inst Button1 : BYTE := 0; n Inst Button2 : BYTE := 1; n Inst Button3 : BYTE := 2; n Inst Button4 : BYTE := 3; ip DALICommunication : Tc3_DALI. I_DALICommunication; END_VAR VAR_INPUT CONSTANT Switch Sns : FB_BA_Swi4DALI; END_VAR VAR_INPUT Name Type Description b En BOOL Enabling the function block: a TRUE signal at this input enables the function. b Initialize BOOL A positive edge at this input starts the DALI initialization routine, which transfers the set parameters to the DALI device, see FB_BA_Swi4DALI [} 880]. TF8040 Version: 1.14.0 883
## Page 884

Programming VAR_OUTPUT Name Type Description b Button1...b Button4 BOOL State of the individual push buttons (TRUE = pressed). b Initializing BOOL The push button sensor is in the DALI initialization phase, i.e. the entered parameters are transferred to the DALI device. b Err BOOL Error output. A plain text is output in Twin CAT in the error list in the output window. VAR_INPUT CONSTANT PERSISTENT Name Type Description n Adr BYTE DALI individual address of the push button sensor. n Inst Button1...n Inst B BYTE Numbers of the push button instances to be queried. utton4 ip DALICommunicati Tc3_DALI. I_DALICommuni Interface pointer to the DALI communication block. on cation VAR_INPUT CONSTANT Name Type Description Switch Sns FB_BA_Swi4DALI [} 880] Function block for reading the push button sensor. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.1.2.2 FB_BA_Brightness Presence DALI This template is used to read a combined DALI brightness and occupancy sensor. Data exchange HMI The data exchange with the HMI is realized in the base class FB_BA_Base Brightness Presence (internal function block). The use of the following variable is visible in this template: • b Initialize Rm: Start DALI initialization routine from the HMI. Function The device itself is specified by the instance number of the presence, n Instance Presence, and the instance number of the brightness, n Instance Brightness. Added to this is the device-specific resolution, n Res Brtns. These three parameters vary from manufacturer to manufacturer. 884 Version: 1.14.0 TF8040
## Page 885

Programming The brightness is queried cyclically (interval n Prd Query Brtns [s]) in the internal function block Brightness Presence Sns [} 871]. With presence, on the other hand, the device's internal notification system is used, which automatically sends a telegram as soon as presence or absence is detected. The DALI-specific parameters of this function block (n Inst Prc, n Inst Brtns and n Res Brtns) are transferred to the relevant device via a TRUE signal to b Initialize or via the HMI via b Initialize_In. The device is addressed by naming the addressx (n Adr) and linking the communication block of the corresponding DALI line via ip DALICommunication. The function block Presence Delay [} 1025] provides a delayed signal b Presence. After the delay time has elapsed, a positive edge is also emitted at b Rst Swi, which can be used to cancel the flag circuits for light and blinds. Presence and brightness values are linked to the objects Presence and Brightness and are thus available in BACnet. Any scaling of the brightness can be carried out by parameterization of Brightness in FB_Init using the parameters f Resolution and f Scale Offset. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Brightness Presence DALI EXTENDS FB_BA_Ext_Brightness Presence_Base VAR_INPUT b En : BOOL; b Initialize : BOOL; b Reset Presence : BOOL; n Prd Query Brtns : UDINT := 1; END_VAR VAR_OUTPUT b Presence : BOOL; b Presence Delay Active : BOOL; TF8040 Version: 1.14.0 885
## Page 886

Programming b Rst Swi : BOOL; f Brightness : REAL; b Initializing : BOOL; b Err : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT n Adr : BYTE; n Instance Presence : BYTE; n Instance Brightness : BYTE; n Res Brtns : BYTE; ip DALICommunication : Tc3_DALI. I_DALICommunication; END_VAR VAR_INPUT CONSTANT Brightness Presence Sns : FB_BA_Brtns Prc DALI; Presence Delay : FB_BA_Presence Monitoring; Brightness : FB_BA_AI_RAW; Presence : FB_BA_BI_RAW; END_VAR VAR_INPUT Name Type Description b En BOOL Enabling the function block: a TRUE signal at this input enables the function. b Initialize BOOL A positive edge at this input starts the DALI initialization routine, which transfers the set parameters to the DALI device, see FB_BA_Swi4DALI [} 880]. b Reset Presence BOOL Resets the internal presence delay and thus triggers the b Rst Swi output once. n Prd Query Brtns UDINT Brightness query interval in seconds. The declaration of this variable as an input is intended to enable a variable query speed. In the case of constant light regulation, for example, a slow query interval is initially sufficient until a larger deviation to be compensated is detected, at which point a shorter interval is used. VAR_OUTPUT Name Type Description b Presence BOOL Occupancy signal output. b Presence Delay Acti BOOL This output is then set to TRUE if no more presence is ve detected and the output b Presence is only set by the internal delay. b Rst Swi BOOL Reset output for manual overrides. Is set for a PLC cycle after the internal presence delay has elapsed (see Presence Delay [} 1025]) or when a TRUE signal is received at the input b Reset Presence, f Brightness REAL Measured brightness. The unit is vendor-specific. Conversion to lux must be requested from the manufacturer if required. b Initializing BOOL The sensor is in the DALI initialization phase, i.e. the entered parameters are transferred to the DALI device. b Err BOOL Error output. A plain text is output in Twin CAT in the error list in the output window. 886 Version: 1.14.0 TF8040
## Page 887

Programming VAR_INPUT CONSTANT PERSISTENT Name Type Description n Adr BYTE DALI single address of the sensor. n Instance Presence BYTE Number of the presence instance to be queried. n Instance Brightness BYTE Number of the brightness instance to be queried. n Res Brtns BYTE Vendor-specific brightness resolution. ip DALICommunicati Tc3_DALI. I_DALICommuni Interface pointer to the DALI communication block. on cation VAR_INPUT CONSTANT Name Type Description Brightness Presence FB_BA_Brtns Prc DALI Function block for reading the DALI brightness and Sns occupancy sensor. [} 871] Presence Delay FB_BA_Presence Monitorin Universal presence monitoring template with reset inputs for delay timer and manual function. g [} 1025] Brightness FB_BA_AI_RAW [} 195] This function block is used to convert the vendor-specific raw brightness value to a desired unit, for example lux, and also to display the value in BACnet. Presence FB_BA_BI_RAW [} 206] Function block for displaying the presence state in BACnet. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.2 Communication 6.1.4.2.1.4.2.1 FB_BA_Ads Com Client_Room The template reads global data that is assigned to the "Room automation" trade from another controller, which makes this data available with the FB_BA_Ads Com Server_Room [} 888] counter-block. The information read is copied to the global variable list Site [} 1116]. The initialization of the template takes place within the method FB_Init. Block diagram TF8040 Version: 1.14.0 887
## Page 888

Programming Syntax FUNCTION_BLOCK FB_BA_Ads Com Client EXTENDS FB_BA_View VAR_INPUT CONSTANT Building Energy Level : FB_BA_Raw Subscriber; Building Energy Level Error : FB_BA_BV_Error State; Building Sp Rm T : FB_BA_Raw Subscriber; Building Sp Rm TError : FB_BA_BV_Error State; Building Lighting : FB_BA_Raw Subscriber; Building Lighting Error : FB_BA_BV_Error State; END_VAR VAR_INPUT CONSTANT Name Type Description Building Energy Level FB_BA_Raw Subscriber The subscriber accesses the Twin CAT network structure e Building Energy Level and saves the data in the created [} 158] enumeration e Building Energy Level of the GVL Site [} 1116]. Building Energy Level FB_BA_BV_Error State Binary object indicating communication failure of the Error subscriber Building Energy Level. [} 1030] Building Sp Rm T FB_BA_Raw Subscriber The subscriber accesses the Twin CAT network structure Building Sp Rm T and saves the data in the created [} 158] structure st Building Sp Rm T of the GVL Site [} 1116]. Building Sp Rm TError FB_BA_BV_Error State Binary object indicating communication failure of the subscriber Building Sp Rm T. [} 1030] Building Lighting FB_BA_Raw Subscriber The subscriber accesses the Twin CAT network structure Building Lighting and saves the data in the created [} 158] structure st Building Lighting of the GVL Site [} 1116]. Building Lighting Error FB_BA_BV_Error State Binary object indicating communication failure of the subscriber Building Lighting. [} 1030] Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.2.2 FB_BA_Ads Com Server_Room The template has the task of reading data and parameters that are assigned to the "Room automation" trade from the global variable list Site and making them available within the BA network via FB_BA_Raw Publisher [} 139]. The counter-block that receives this data as a client is FB_BA_Ads Com Client_Room [} 887]. The initialization of the template takes place within the method FB_Init. 888 Version: 1.14.0 TF8040
## Page 889

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Ads Com Server VAR_INPUT CONSTANT Building Energy Level : FB_BA_Raw Publisher; Building Sp Rm T : FB_BA_Raw Publisher; Building Lighting : FB_BA_Raw Publisher; END_VAR VAR_INPUT CONSTANT Name Type Description Building Energy Level FB_BA_Raw Publisher The publisher publishes the current building energy level [} 139] Site.e Building Energy Level [} 1116], which is created in the template FB_BA_Building Energy Level [} 889]. Building Sp Rm T FB_BA_Raw Publisher The publisher publishes the structure of the building-wide [} 139] room temperature data Site.st Building Sp Rm T [} 1116], which is created in the template FB_BA_Building Sp Rm T [} 860]. Building Lighting FB_BA_Raw Publisher The publisher publishes the structure of the building-wide [} 139] lighting data Site.st Building Lighting [} 1116], which is created in the template FB_BA_Building Lighting [} 917]. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.3 Heating Cooling Templates for heating and cooling. 6.1.4.2.1.4.3.1 FB_BA_Building Energy Level Selection of the building energy level based on a schedule (Sched) and a manual mode (Energ Lvl Man). The manual mode (Energ Lvl Man) has the following values: TF8040 Version: 1.14.0 889
## Page 890

Programming Value Meaning 1 Automatic mode 2 manual selection Protection 3 manual selection Economy 4 manual selection Precomfort 5 manual selection Comfort If Automatic mode is selected, the function block De Mux Energ Lvl sets the output b Q01. Since this output is not connected to the Prio Swi , the manual mode on the Prio Swi is disabled and the schedule Sched is active. This can assume the following values: Value Meaning 1 Protection 2 Economy 3 Precomfort 4 Comfort The currently selected energy level is then displayed via the function block Energ Lvl Pr and made available via Publisher. The initialization of the template takes place within the method FB_Init. Illustration FUNCTION_BLOCK FB_BA_Building Energy Level EXTENDS FB_BA_View VAR_INPUT CONSTANT Energ Lvl Man : FB_BA_MV_Op; Energ Lvl Pr : FB_BA_MV_Op; Sched : FB_BA_Sched M; END_VAR VAR De Mux Energ Lvl : FB_BA_DMUX_B08; De Mux Sched : FB_BA_DMUX_B04; Prio Swi : FB_BA_Prio Swi_UDI08; END_VAR Inputs CONSTANT Name Type Description Energ Lvl Man FB_BA_MV_Op [} 239] Input object Hand for the "Building Energy Level". Energ Lvl Pr FB_BA_MV_Op [} 239] Resulting mode. Sched FB_BA_Sched M [} 225] Schedule object (automatic) for the "Building Energy Level". Variables Name Type Description De Mux Energ Lvl FB_BA_DMUX_B08 [} 426] Conversion of the multistate value of the manual mode to a binary output. De Mux Sched FB_BA_DMUX_B04 [} 426] Conversion of the multistate value of the schedule to a binary output. Prio Swi FB_BA_Prio Swi_UDI08 Prioritizing reconversion of the states to a resulting multistate or enumeration value for the building energy [} 433] level. 890 Version: 1.14.0 TF8040
## Page 891

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.3.2 FB_BA_Heat Cool_PID This template is used to control a heating-cooling zone. The priority selection Energ Lvl Slcn first determines the currently valid energy level. The window contact always has priority and switches to the energy level "Protection" when the window is open. When there is a presence in the room, the "Comfort" level is always activated. The function block Rm TAdj is used for a local shift of the room temperature setpoint for the energy levels "Pre-Comfort" and "Comfort". The setpoint is shifted via a local input value f Rm TAdj or via an external value f Rm TAdj_In which is read via the base class FB_BA_Ext_Sunblind Angle (internal function block), for example via a HMI. The value that was last changed is always valid; the function block FB_BA_Last Writer Wins_R04 [} 447] is responsible for this. The room temperature value is limited to +/- f Rm TAdj Limit (predefined to 1.0 in FB_init). The instance Fnct Sel of the function block FB_BA_Fnct Sel [} 299] enables the heating or cooling controller of the temperature zone. Data exchange HMI The data exchange with the HMI is realized here in the base class FB_BA_Ext_Heat Cool Base (internal function block). The use of the following variables is visible in this template: • f Rm TAdj_In: Input room setpoint shift from the HMI. • f Rm TAdj_Out: Output of current room setpoint shift to the HMI. • f Rm TAdj Limit_Out: Output of the +/- range limits of the room setpoint shift to the HMI. • f Rm T_Out: Output of current room temperature to the HMI. • f SPHtg_Out: Output of heating setpoint to the human-machine interface. • f SPCol_Out: Output of setpoint cooling to the HMI. • f Ctrl Val Htg_Out: Output heating controller output to the HMI. • f Ctrl Val Col_Out: Output cooling controller output to the HMI. • e Actual Energy Level_Out: Output of the current energy level to the HMI. • b Err_Out: Output status "Error to Fnct Sel" to the HMI. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 891
## Page 892

Programming Block diagram 892 Version: 1.14.0 TF8040
## Page 893

Programming Syntax FUNCTION_BLOCK FB_BA_Heat Cool_PID EXTENDS FB_BA_Ext_Heat Cool Base VAR_INPUT b Prc : BOOL; b Wdw Con : BOOL; e Medium : E_BA_Medium; b Dew Pnt : BOOL; f Rm T : REAL; f Rm TAdj : REAL; st Building Sp Rm T : ST_BA_Sp Rm T; e Building Energy Level : E_BA_Energy Lvl Ex; END_VAR VAR_OUTPUT b Ctrl Htg Actv : BOOL; f Ctrl Val Htg : REAL; b Ctrl Col Actv : BOOL; f Ctrl Val Col : REAL; e Reqd Medium : E_BA_Medium; END_VAR VAR_INPUT CONSTANT PERSISTENT e Pipe Sys : E_BA_Pipe Sys; n Fnct Sel Chg Ovr Dly : UDINT; f Rm TAdj Limit : REAL; END_VAR VAR_INPUT CONSTANT Ctrl Htg : FB_BA_Loop; Ctrl Col : FB_BA_Loop; END_VAR VAR Rm TAdj : FB_BA_Rm TAdj; Energ Lvl Slcn : FB_BA_Prio Swi_UDI04; Sp Slcn Htg : FB_BA_MUX_R04; Sp Scln Col : FB_BA_MUX_R04; Fnct Sel : FB_BA_Fnct Sel; END_VAR Inputs Name Type Description b Prc BOOL Presence detection b Wdw Con BOOL Window contact (open = TRUE) e Medium E_BA_Medium [} 267] Medium present (heating or cooling medium, only important for two-pipe operation) b Dew Pnt BOOL Dew point sensor (alarm = TRUE) f Rm T BOOL Room temperature [°C] f Rm TAdj REAL Room setpoint shift [K] st Building Sp Rm T ST_BA_Sp Rm T [} 272] Structure of room setpoints (Protection Cooling.. Comfort Cooling and Protection Heating ... Comfort Heating) e Building Energy Lev E_BA_Energy Lvl Ex [} 700] Current building energy level el Outputs Name Type Description b Ctrl Htg Actv BOOL Heating controller is active f Ctrl Val Htg REAL Control value heating valve b Ctrl Col Actv BOOL Cooling controller is active f Ctrl Val Col REAL Control value cooling valve e Reqd Medium E_BA_Medium [} 267] Requested medium (heating or cooling medium) TF8040 Version: 1.14.0 893
## Page 894

Programming Inputs CONSTANT PERSISTENT Name Type Description e Pipe Sys E_BA_Pipe Sys [} 267] Selection of two or four-pipe system. n Fnct Sel Chg Ovr Dly UDINT Switchover delay [s] from heating to cooling or vice versa. f Rm TAdj Limit REAL Adjustable range [K] of the setpoint value shift f Rm TAdj : -f Rm TAdj Limit <= f Rm TAdj <= +f Rm TAdj Limit Inputs CONSTANT Name Type Description Ctrl Htg FB_BA_Loop [} 220] Heating controller Ctrl Col FB_BA_Loop [} 220] Cooling controller Variables Name Type Description Rm TAdj FB_BA_Rm TAdj [} 302] Function block that applies the sh to the corresponding setpoints and outputs them explicitly. Energ Lvl Slcn FB_BA_Prio Swi_UDI04 Prioritizing selection and conversion of the possible energy levels into a numerical value. [} 433] Sp Slcn Htg FB_BA_MUX_R04 [} 431] Selection of the heating setpoint Sp Scln Col FB_BA_MUX_R04 [} 431] Selection of the cooling setpoint Fnct Sel FB_BA_Fnct Sel [} 299] Function selection heating or cooling. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.4 Lighting 6.1.4.2.1.4.4.1 Functions 6.1.4.2.1.4.4.1.1 Zone 6.1.4.2.1.4.4.1.1.1 FB_BA_Light Group Constant One or more light actuators are combined in a light zone for simultaneous control, depending on local conditions. 894 Version: 1.14.0 TF8040
## Page 895

Programming This template represents a light zone (room) with constant light regulation and manual override. Function If fully automatic is set via the parameter e Light Activation Mode, the light function Const Lgt Ctrl [} 317] switches to control mode when presence is detected at the input b Presence. However, if semi-automatic is selected, the first press of a button on the template b Manual Switch will set the function block to control mode. Further button presses or a value specification via the HMI (f Set Light Value Man_In / Set Light Value Man_In) abort the control mode and the function block is in manual override. In this mode, the light can be switched on and off alternately via the template input b Manual Switch or dimmed up and down with a long keystroke (t>Swi Ovr Ti). The inputs b On and b Off allow the light to be switched on and off selectively, while the light value f Set Light Value Man_In is set directly via a HMI using the b Set Light Value Man_In command. The light control block [} 317] displays its current state "Control mode" or "Manual override" at the outputs b Control Mode and b Manual Mode; both outputs are not set simultaneously. These outputs are used either to generate a light output telegram with the priority e Automatic Light [} 268] via the Cnst Lgt Auto [} 309] function block or a telegram with the priority e Manual [} 268] via Man Mode [} 309]. The different telegram priority is assigned to the internal HMI variable e Actual Prio_Out on the Prio Swi [} 310] function block. For example, a HMI can be used to display a distinction between control mode and manual override. On a falling edge at the template input b Presence or by setting b Reset Room Function, the light control block is disabled, whereby, if selected, it still announces its shutdown via a switch-off ramp with a dwell time at a pre-switch-off value. Both function block outputs b Control Mode and b Manual Mode are then deleted. In addition to the internal telegrams from b Control Mode and Man Mode, the input-side st Area Lighting and st Scene are also routed to the selector (Prio Swi). Here, st Area represents the resulting telegram from the higher-level, higher-order levels (area, floor and building), while st Scene is reserved for any lighting scene to override the constant light regulation. The telegram selector (Prio Swi) forwards the telegram with the highest priority - with the same priority, the last telegram sent (last writer wins). The setpoint for constant light regulation is set using an analog object Sp Brightness [} 202]. Input st Reference Feedback Information about the controlled light actuator or the reference actuator of a group is fed back into the light control function via this input. The light value of the reference actuator is of particular importance here: If the light actuator is already controlled by another function of the same or lower priority and the template described here now "takes over" control, it must control the actuator based on its existing light value. In addition, current values and states are transmitted and can be displayed via the HMI. Data exchange HMI The data exchange with the HMI is realized here in the base class FB_BA_Ext_Light Const Ctrl (internal function block). The use of the following variables is visible in this template: • b Set Light Value Man_In: Command to switch to manual mode. • f Set Light Value Man_In: Light value to be adopted. • b Set Ctrl Mod_In: Command to switch to constant light control mode. • e Light Activation Mode_In: Activation mode of the light control function [} 317] from the HMI (fully automatic or semi-automatic). The mode selected via the HMI is saved persistently. • f Light Value_Out: Output of percentage light value to the HMI. • b Light On_Out: Output information "Light On" to the HMI. • b Err_Out: Output information "Reference actuator faulty" to the HMI. • e Actual Prio_Out: Currently controlling telegram priority to the HMI. TF8040 Version: 1.14.0 895
## Page 896

Programming • b Ctrl Mod_Out: Output information "Light function is in control mode" to the HMI. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Light Group Constant EXTENDS FB_BA_Ext_Light Const Ctrl VAR_INPUT b Manual Switch : BOOL; 896 Version: 1.14.0 TF8040
## Page 897

Programming b On : BOOL; b Off : BOOL; b Reset Room Function : BOOL; b Presence : BOOL; f Brightness : REAL; st Area Lighting : ST_BA_Lighting; st Scene : ST_BA_Lighting; st Reference Feedback : ST_BA_Light Actuator Feedback; END_VAR VAR_OUTPUT st Lighting : ST_BA_Lighting; b Adjusting : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT f Hys : REAL; n Swi Ovr Ti : UDINT; n Swi Ti : UDINT; n Dim Ti : UDINT; n Ramp Ti : UDINT; n Pre Off Ramp Ti : UDINT; n Brtns Adj Ti : UDINT; f On Val Ctrl : REAL; f On Val Man : REAL; f Pre Off Val : REAL; n Pre Off Dly : UDINT; f Min Val : REAL; n Min Off Dly : UDINT; n Min On Dly : UDINT; b Memory Mode : BOOL; f Lgt T : REAL; END_VAR VAR_INPUT CONSTANT Sp Brightness : FB_BA_AV_Op; Man Mode : FB_BA_Lighting Evt := ( e Prio := E_BA_Lighting Prio.e Manual); Cnst Lgt Auto : FB_BA_Lighting Evt := ( e Prio := E_BA_Lighting Prio.e Automatic Light); END_VAR VAR Const Lgt Ctrl : FB_BA_Light Ctrl Const; Prio Swi : FB_BA_Lighting Tgm Sel4; END_VAR TF8040 Version: 1.14.0 897
## Page 898

Programming Inputs Name Type Description b Manual Switch BOOL If the constant light control function block is not yet active, a short button press first switches the control on, then further signals cause the function block to switch to the manual mode and the following applies: short button press: on / off, long button press: alternately dimming up or down. b On BOOL If the constant light control function block is not yet active, a TRUE signal first switches on the control, then this input only refers to switching on in manual mode. b Off BOOL Switches the light off, the constant light control function block is still in manual mode. If the constant light control function block was previously in control mode, it is now in manual mode. b Reset Room Functio BOOL This input switches off the constant light control function n block. Switch-off takes place via a ramp and dwell time on a basic light value, see parameters: f Pre Off Val, n Pre Off Dly and n Pre Off Ramp T. b Presence BOOL Presence signal input. If the constant light control block is configured in fully automatic mode, a rising edge can switch the function on and a falling edge can switch it off via this input. In semi-automatic mode, only a falling edge at this input switches off the constant light control block. f Brightness REAL Current brightness for constant light automatic: Range and unit depend on the light sensor. st Area Lighting ST_BA_Lighting [} 272] Resulting telegram from the higher levels (area, floor and building), which is formed in the function block FB_BA_Area Lighting [} 920]. st Scene ST_BA_Lighting [} 272] Reserved telegram input for scene control. st Reference Feedbac ST_BA_Light Actuator Feed Feedback input of the controlled light actuator or the guide k light of the controlled group. back [} 702] Outputs Name Type Description st Lighting ST_BA_Lighting [} 272] Resulting output program. b Adjusting BOOL The constant light control function block is in regulation mode. This signal can be used to query light sensors, which do not operate in analog mode but via communication, more frequently and thus achieve a more favorable control behavior. 898 Version: 1.14.0 TF8040
## Page 899

Programming Inputs CONSTANT PERSISTENT Name Type Description f Hys REAL Constant light automatic: Hysteresis band. The constant light regulation controls the output up or down until the measured brightness reaches or slightly exceeds or falls below the target value. The light is then considered as adjusted. Only when the measured brightness exceeds or falls below the setpoint by f Hys/2, it is readjusted again. The range and unit depend on the used light sensor, see above: f Brtns SP and f Brtns Sen. Pre-set to 50 in FB_Init. n Swi Ovr Ti UDINT Distinction time [ms] between short and long button press. Pre-set to 250 ms in FB_Init. n Swi Ti UDINT Ramp for the switching functions in seconds, related to a dimming from 0 to 100%. Pre-set to 2 s in FB_Init. n Dim Ti UDINT Ramp for the dimming functions in seconds, related to a dimming from 0 to 100%. Pre-set to 10 s in FB_Init. n Ramp Ti UDINT Control ramp of the constant light automatic in seconds, related to a dimming from 0 to 100%. Pre-set to 60 s in FB_Init. n Pre Off Ramp Ti UDINT Ramp used to drive to a base value f Pre Off Val before switching off. Pre-set to 2 s in FB_Init. n Brtns Adj Ti UDINT Waiting time in seconds after switching on the light for the light sensor to detect the correct value. f On Val Ctrl REAL Switch-on value for control operation, this should be activated with the function previously switched off. Pre-set to 50% in FB_Init. f On Val Man REAL Switch-on value of the manual function, if "Memory mode" is not selected via the parameter e Operational Mode. Pre- set to 100% in FB_Init. f Pre Off Val / REAL / UDINT Base value and hold time at this value before switching off n Pre Off Dly the overall function. If the current light value already falls below the base value, this function is not active and it is switched off immediately. Pre-set to 4% and 10 s in FB_Init. f Min Val REAL Constant light automatic: Minimum output value. If this value has fallen below internally (i.e. it is bright enough that no artificial light is needed), the constant light control switches the light off after n Off Dly (in seconds) has elapsed. If the light is switched off and the control detects the need for light above the minimum value again, the control switches the light on again after n On Dly (in seconds) to initially f Min Val. Pre-set to 4% in FB_Init n Min Off Dly UDINT Constant light automatic: Switch-off waiting time in seconds, see f Min Val. Pre-set to 300 s in FB_Init. n Min On Dly UDINT Constant light automatic: Switch-on waiting time in seconds, see f Min Val. Pre-set to 300 s in FB_Init. b Memory Mode BOOL Memory mode: When the light is switched on in manual mode, the light assumes the value that the function had before it was last switched off. If the "Memory-Mode" is not active, the switch-on value is defined via f On Val Man. Pre- set to FALSE in FB_Init. f Lgt T REAL Light temperature: Pre-set to 3000 K in FB_Init. TF8040 Version: 1.14.0 899
## Page 900

Programming Inputs CONSTANT Name Type Description Sp Brightness FB_BA_AV_Op [} 202] Analog input object: Setpoint of the control [lx]. Man Mode FB_BA_Lighting Evt [} 309] Telegram generator for the light values in manual mode (b Manual Mode = TRUE). The priority is pre-set to e Manual Actuator. Cnst Lgt Auto FB_BA_Lighting Evt [} 309] Telegram generator for the light values in control mode (b Control Mode = TRUE). The priority is pre-set to e Constant Light Control. VAR Name Type Description Const Lgt Ctrl FB_BA_Light Ctrl Const Constant light control block. [} 317] Prio Swi FB_BA_Lighting Tgm Sel4 Telegram selection. [} 310] Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.4.1.1.2 FB_BA_Light Group Presence One or more light actuators are combined in a light zone for simultaneous control, depending on local conditions. This template represents a light zone (room) that is only switched via presence. Typical applications are sanitary areas or interior corridors. Function A rising edge at b Presence switches the light on via the internal light control block Light Switch [} 311]. The output b Automatic Mode changes to TRUE and the light value is output via the function block Light Event [} 309] as the telegram ST_BA_Lighting [} 272]. On a falling edge at b Presence, the light is first dimmed to a minimum value via a ramp (if parameterized, see FB_BA_Light Ctrl [} 311]) and then switched off. The output b Autmatic Mode changes to FALSE and the light telegram is deactivated on the function block Light Event [} 309]. A rising edge at input b Reset Room Function can be used to achieve premature switch-off and deactivation. Input st Reference Feedback Information about the controlled light actuator or the reference actuator of a group is fed back into the light control function via this input. 900 Version: 1.14.0 TF8040
## Page 901

Programming The light value of the reference actuator is of particular importance here: If the light actuator is already controlled by another function of the same or lower priority and the template described here now "takes over" control, it must control the actuator based on its existing light value. In addition, current values and states are transmitted and can be displayed via the HMI. Data exchange HMI The data exchange with the HMI is realized here in the base class FB_BA_Ext_Light Base (internal function block). The use of the following variables is visible in this template: • b Light On_Out: Output information "Light On" to the HMI. • b Err_Out: Output information "Reference actuator faulty" to the HMI. • e Actual Prio_Out: Currently controlling telegram priority to the HMI. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Light Group Presence EXTENDS FB_BA_Ext_Light Base VAR_INPUT b Reset Room Function : BOOL; b Presence : BOOL; st Area Lighting : ST_BA_Lighting; st Scene : ST_BA_Lighting; st Reference Feedback : ST_BA_Light Actuator Feedback; END_VAR VAR_OUTPUT st Lighting : ST_BA_Lighting; END_VAR VAR_INPUT CONSTANT PERSISTENT n Swi Ti : UDINT; TF8040 Version: 1.14.0 901
## Page 902

Programming n Pre Off Ramp Ti : UDINT; f On Val : REAL; f Pre Off Val : REAL; n Pre Off Dly : UDINT; f Lgt T : REAL; END_VAR VAR_INPUT CONSTANT PERSISTENT Light Event : FB_BA_Lighting Evt :=( e Prio:= E_BA_Lighting Prio.e Simple); END_VAR VAR Light Switch : FB_BA_Light Ctrl; Prio Swi : FB_BA_Lighting Tgm Sel4; END_VAR Inputs Name Type Description b Reset Room Functio BOOL This input switches off the light function block Light Switch - n it is then no longer active (output b Autmatic Mode/ b Manual Mode = FALSE). Switch-off takes place via a ramp and dwell time on a basic light value, see parameters: f Pre Off Val, n Pre Off Dly and n Pre Off Ramp T. b Presence BOOL Presence signal input. A rising edge switches the light on and a falling edge switches it off. Switching on and off via presence is accompanied by activation and deactivation of the light function block [} 311]. st Area Lighting ST_BA_Lighting [} 272] Resulting telegram from the higher levels (area, floor and building), which is formed in the function block FB_BA_Area Lighting [} 920]. st Scene ST_BA_Lighting [} 272] Reserved telegram input for scene control. st Reference Feedbac ST_BA_Light Actuator Feed Feedback input of the controlled light actuator or the guide k light of the controlled group. back [} 702] Outputs Name Type Description st Lighting ST_BA_Lighting [} 272] Resulting output program. Inputs CONSTANT PERSISTENT Name Type Description n Swi Ti UDINT Ramp for the switching functions in seconds, related to a dimming from 0 to 100%. Pre-set to 2 s in FB_Init. n Pre Off Ramp Ti UDINT Ramp used to drive to a base value f Pre Off Val before switching off. Pre-set to 2 s in FB_Init. f On Val REAL Switch-on value. Pre-set to 100% in FB_Init. f Pre Off Val / REAL / UDINT Base value and hold time at this value before switching off n Pre Off Dly the overall function. If the current light value already falls below the base value, this function is not active and it is switched off immediately. Pre-set to 4% and 10 s in FB_Init. f Lgt T REAL Light temperature: Pre-set to 3000 K in FB_Init. Inputs CONSTANT Name Type Description Light Event FB_BA_Lighting Evt [} 309] Telegram generator for the light values. The priority is pre- set to e Manual Actuator. 902 Version: 1.14.0 TF8040
## Page 903

Programming VAR Name Type Description Light Switch FB_BA_Light Ctrl [} 311] Light control block. Prio Swi FB_BA_Lighting Tgm Sel4 Telegram selection. [} 310] Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.4.1.1.3 FB_BA_Light Group Switch One or more light actuators are combined in a light zone for simultaneous control, depending on local conditions. This template represents a light zone (room) which is only operated via switches. Function The light can be switched on and off alternately via the template input b Manual Switch using the control block Light Switch [} 311] or dimmed up and down with a long button press (t > Swi Ovr Ti). The inputs b On and b Off allow the light to be switched on and off selectively, while the light value f Set Light Value Man_In is set directly via a HMI using the b Set Light Value Man_In command. Switched by manual commands (not presence), the light function block FB_BA_Light Ctrl [} 311] normally works in such a way that it is always active and indicates this at the output b Manual Mode. This is due to the fact that the user may want to switch off the light in a targeted manner and this must not lead to a situation where the function block becomes inactive and a lower priority light telegram switches the actuators. Normally, a falling edge at presence input b Prc deactivates the function. As this is not possible without presence detection, the light function is preceded by a logic that sends a trigger pulse to the reset input b Rst when 0% is reached at the light output and thus deactivates the light control input anyway. Alternatively, deactivation can also be carried out via the template input b Reset Room Function. If the light is switched on, the function block Light Event [} 309] is activated by b Manual Mode = TRUE and a light telegram [} 272] with the set light value is output. In addition to the internal telegram from Light Event, the input-side telegrams st Area Lighting and st Scene are also routed to a selector (Prio Swi). Here, st Area represents the resulting telegram from the higher levels (area, floor and building), while st Scene is reserved for any lighting scene to override the constant light regulation. The telegram selector (Prio Swi) forwards the telegram with the highest priority - with the same priority, the last telegram sent (last writer wins). Input st Reference Feedback TF8040 Version: 1.14.0 903
## Page 904

Programming Information about the controlled light actuator or the reference actuator of a group is fed back into the light control function via this input. The light value of the reference actuator is of particular importance here: If the light actuator is already controlled by another function of the same or lower priority and the template described here now "takes over" control, it must control the actuator based on its existing light value. In addition, current values and states are transmitted and can be displayed via the HMI. Data exchange HMI The data exchange with the HMI is realized here in the base class FB_BA_Ext_Light Ctrl (internal function block). The use of the following variables is visible in this template: • f Set Light Value Man_In: Light value to be set via the HMI. • b Set Light Value Man_In: Command from the HMI that the above light value is to be set. • b Light On_Out: Output information "Light On" to the HMI. • f Light Value_Out: Output information light value to the HMI. • b Err_Out: Output information "Reference actuator faulty" to the HMI. • e Actual Prio_Out: Currently controlling telegram priority to the HMI. The initialization of the template takes place within the method FB_Init. 904 Version: 1.14.0 TF8040
## Page 905

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Light Group Switch EXTENDS FB_BA_Ext_Light Ctrl VAR_INPUT b Manual Switch : BOOL; b On : BOOL; b Off : BOOL; b Reset Room Function : BOOL; st Area Lighting : ST_BA_Lighting; st Scene : ST_BA_Lighting; st Reference Feedback : ST_BA_Light Actuator Feedback; END_VAR VAR_OUTPUT st Lighting : ST_BA_Lighting; END_VAR VAR_INPUT CONSTANT PERSISTENT n Swi Ovr Ti : UDINT; n Swi Ti : UDINT; n Dim Ti : UDINT; n Pre Off Ramp Ti : UDINT; f On Val : REAL; f Pre Off Val : REAL; n Pre Off Dly : UDINT; b Memory Mode : BOOL; e Light Activation Mode : E_BA_Light Activation Mode; f Lgt T : REAL; END_VAR VAR_INPUT CONSTANT Light Event : FB_BA_Lighting Evt :=( e Prio:= E_BA_Lighting Prio.e Simple); END_VAR VAR TF8040 Version: 1.14.0 905
## Page 906

Programming Light Switch : FB_BA_Light Ctrl; Prio Swi : FB_BA_Lighting Tgm Sel4; rt Zero : R_TRIG; b Rst : BOOL; END_VAR Inputs Name Type Description b Manual Switch BOOL Short button presses at this input switch the light on and off. Long button presses (t > Swi Ovr Ti) cause the light to dim up and down. b On BOOL Switches the light on and activates the light control block [} 920]. b Off BOOL Switches the light off. Due to an additional circuit that sends a trigger pulse to the b Rst input when 0% is reached on the light control block [} 920], the block is also deactivated at the same time. b Reset Room Functio BOOL This input switches off the light function block Light Switch - n it is then no longer active (output b Autmatic Mode/ b Manual Mode = FALSE). Switch-off takes place via a ramp and dwell time on a basic light value, see parameters: f Pre Off Val, n Pre Off Dly and n Pre Off Ramp T. st Area Lighting ST_BA_Lighting [} 272] Resulting telegram from the higher levels (area, floor and building), which is formed in the function block FB_BA_Area Lighting [} 920]. st Scene ST_BA_Lighting [} 272] Reserved telegram input for scene control. st Reference Feedbac ST_BA_Light Actuator Feed Feedback input of the controlled light actuator or the guide k light of the controlled group. back [} 702] Outputs Name Type Description st Lighting ST_BA_Lighting [} 272] Resulting output program. 906 Version: 1.14.0 TF8040
## Page 907

Programming Inputs CONSTANT PERSISTENT Name Type Description n Swi Ovr Ti UDINT Distinction time [ms] between short and long button press. Pre-set to 250 ms in FB_Init. n Swi Ti UDINT Ramp for the switching functions in seconds, related to a dimming from 0 to 100%. Pre-set to 2 s in FB_Init. n Dim Ti UDINT Ramp for the dimming functions in seconds, related to a dimming from 0 to 100%. Pre-set to 10 s in FB_Init. n Pre Off Ramp Ti UDINT Ramp used to drive to a base value f Pre Off Val before switching off. Pre-set to 2 s in FB_Init. f On Val REAL Switch-on value. Pre-set to 100% in FB_Init. f Pre Off Val / REAL / UDINT Base value and hold time at this value before switching off n Pre Off Dly the overall function. If the current light value already falls below the base value, this function is not active and it is switched off immediately. Pre-set to 4% and 10 s in FB_Init. b Memory Mode BOOL When the light is switched on in manual mode, the light assumes the value that the function had before it was last switched off. If the "Memory-Mode" is not active, the switch-on value is defined via f On Val Man. Pre-set to FALSE in FB_Init. e Light Activation Mod E_BA_Light Activation Mod Selection of the automatic lighting function: e e [} 267] • Semi-automatic: Activation of the light control function only by pressing a button; it is automatically deactivated when not occupied. • Fully automatic: The light function can be activated either by presence detection or by pressing a button; it is automatically deactivated if there is no presence. f Lgt T REAL Light temperature: Pre-set to 3000 K in FB_Init. Inputs CONSTANT Name Type Description Light Event FB_BA_Lighting Evt [} 309] Telegram generator for the light values. The priority is pre- set to e Manual Actuator. VAR Name Type Description Light Switch FB_BA_Light Ctrl [} 311] Light control block. Prio Swi FB_BA_Lighting Tgm Sel4 Telegram selection. [} 310] rt Zero R_TRIG Trigger that is activated by the light output value "0". b Rst BOOL Internal variable for deactivating the overall function. A valid light control telegram st Lighting is no longer output. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 TF8040 Version: 1.14.0 907
## Page 908

Programming 6.1.4.2.1.4.4.1.1.4 FB_BA_Light Group Switch Presence One or more light actuators are combined in a light zone for simultaneous control, depending on local conditions. This template represents a light zone (room) that is operated both via switches and occupancy sensors. Function The light can be switched on and off alternately via the template input b Manual Switch using the control block Light Switch or dimmed up and down with a long button press (t > Swi Ovr Ti). The inputs b On and b Off allow the light to be switched on and off selectively, while the light value f Set Light Value Man_In is set directly via a HMI using the b Set Light Value Man_In command. If fully automatic mode is set via the parameter e Light Activation Mode, the light switches on automatically when presence is detected at the input b Presence and switches off automatically on a falling edge. However, if semi-automatic mode is selected, the presence input is only used to switch off. The light control block distinguishes whether it has been activated or overridden manually or by presence. In the first case, the output b Automatic Mode is set, in the second case b Manual Mode; both outputs are not set at the same time. These outputs are used either to generate a light output telegram with the priority e Automatic Light [} 268] via the function block Auto Mode [} 309] or a telegram with the priority e Manual [} 268] via Man Mode [} 309]. The different telegram priority is assigned to the internal HMI variable e Actual Prio_Out on the Prio Swi function block. For example, an HMI can be used to display a distinction between automatic or manual/manual override. On a falling edge at the template input b Presence or by setting b Reset Room Function, the light control block is deactivated, whereby, if selected, it still announces its switch-off via a switch-off ramp with a dwell time at a pre-switch-off value. Both function block outputs b Automatic Mode and b Manual Mode are then deleted. In addition to the internal telegrams from Auto Mode and Man Mode, the input-side st Area Lighting and st Scene are also routed to the selector (Prio Swi). Here, st Area represents the resulting telegram from the higher levels (area, floor and building), while st Scene is reserved for any lighting scene to override the constant light regulation. The telegram selector (Prio Swi) forwards the telegram with the highest priority - with the same priority, the last telegram sent (last writer wins). Input st Reference Feedback Information about the controlled light actuator or the reference actuator of a group is fed back into the light control function via this input. The light value of the reference actuator is of particular importance here: If the light actuator is already controlled by another function of the same or lower priority and the template described here now "takes over" control, it must control the actuator based on its existing light value. In addition, current values and states are transmitted and can be displayed via the HMI. Data exchange HMI The data exchange with the HMI is realized here in the base class FB_BA_Ext_Light Ctrl (internal function block). The use of the following variables is visible in this template: 908 Version: 1.14.0 TF8040
## Page 909

Programming • f Set Light Value Man_In: Light value to be set via the HMI. • b Set Light Value Man_In: Command from the HMI that the above light value is to be set. • b Light On_Out: Output information "Light On" to the HMI. • f Light Value_Out: Output information light value to the HMI. • b Err_Out: Output information "Reference actuator faulty" to the HMI. • e Actual Prio_Out: Currently controlling telegram priority to the HMI. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Light Group Switch EXTENDS FB_BA_Ext_Light Ctrl VAR_INPUT b Manual Switch : BOOL; b On : BOOL; b Off : BOOL; b Reset Room Function : BOOL; b Presence : BOOL; st Area Lighting : ST_BA_Lighting; st Scene : ST_BA_Lighting; st Reference Feedback : ST_BA_Light Actuator Feedback; END_VAR VAR_OUTPUT st Lighting : ST_BA_Lighting; END_VAR VAR_INPUT CONSTANT PERSISTENT TF8040 Version: 1.14.0 909
## Page 910

Programming n Swi Ovr Ti : UDINT; n Swi Ti : UDINT; n Dim Ti : UDINT; n Pre Off Ramp Ti : UDINT; f On Val : REAL; f Pre Off Val : REAL; n Pre Off Dly : UDINT; b Memory Mode : BOOL; e Light Activation Mode : E_BA_Light Activation Mode; f Lgt T : REAL; END_VAR VAR_INPUT CONSTANT Man Mode : FB_BA_Lighting Evt :=( e Prio:= E_BA_Lighting Prio.e Manual); Auto Mode : FB_BA_Lighting Evt :=( e Prio:= E_BA_Lighting Prio.e Automatic Light); END_VAR VAR Light Switch : FB_BA_Light Ctrl; Prio Swi : FB_BA_Lighting Tgm Sel4; END_VAR Inputs Name Type Description b Manual Switch BOOL Short button presses at this input switch the light on and off. Long button presses (t > Swi Ovr Ti) cause the light to dim up and down. b On BOOL Switches the light on and activates the light control block [} 920]. b Off BOOL Switches the light off. Due to an additional circuit that sends a trigger pulse to the b Rst input when 0% is reached on the light control block [} 920], the block is also deactivated at the same time. b Reset Room Functio BOOL This input switches off the light function block Light Switch - n it is then no longer active (output b Autmatic Mode/ b Manual Mode = FALSE). Switch-off takes place via a ramp and dwell time on a basic light value, see parameters: f Pre Off Val, n Pre Off Dly and n Pre Off Ramp T. b Presence BOOL Presence signal input. If fully automatic is selected via the parameter e Light Activation Mode [} 267], the light function block [} 311] is activated as "automatic" with a rising edge (output b Automatic Mode = TRUE), provided it was not previously set to manual/manual override (output b Manual Mode = TRUE). A falling edge deactivates the light control block (output b Automatic Mode=FALSE, b Maual Mode=FALSE). st Area Lighting ST_BA_Lighting [} 272] Resulting telegram from the higher levels (area, floor and building), which is formed in the function block FB_BA_Area Lighting [} 920]. st Scene ST_BA_Lighting [} 272] Reserved telegram input for scene control. st Reference Feedbac ST_BA_Light Actuator Feed Feedback input of the controlled light actuator or the guide k light of the controlled group. back [} 702] Outputs Name Type Description st Lighting ST_BA_Lighting [} 272] Resulting output program. 910 Version: 1.14.0 TF8040
## Page 911

Programming Inputs CONSTANT PERSISTENT Name Type Description n Swi Ovr Ti UDINT Distinction time [ms] between short and long button press. Pre-set to 250 ms in FB_Init. n Swi Ti UDINT Ramp for the switching functions in seconds, related to a dimming from 0 to 100%. Pre-set to 2 s in FB_Init. n Dim Ti UDINT Ramp for the dimming functions in seconds, related to a dimming from 0 to 100%. Pre-set to 10 s in FB_Init. n Pre Off Ramp Ti UDINT Ramp used to drive to a base value f Pre Off Val before switching off. Pre-set to 2 s in FB_Init. f On Val REAL Switch-on value. Pre-set to 100% in FB_Init. f Pre Off Val / REAL / UDINT Base value and hold time at this value before switching off n Pre Off Dly the overall function. If the current light value already falls below the base value, this function is not active and it is switched off immediately. Pre-set to 4% and 10 s in FB_Init. b Memory Mode BOOL When the light is switched on in manual mode, the light assumes the value that the function had before it was last switched off. If the "Memory-Mode" is not active, the switch-on value is defined via f On Val Man. Pre-set to FALSE in FB_Init. e Light Activation Mod E_BA_Light Activation Mod Selection of the automatic lighting function: e e [} 267] • Semi-automatic: Activation of the light control function only by pressing a button; it is automatically deactivated when not occupied. • Fully automatic: The light function can be activated either by presence detection or by pressing a button; it is automatically deactivated if there is no presence. f Lgt T REAL Light temperature: Pre-set to 3000 K in FB_Init. Inputs CONSTANT Name Type Description Man Mode FB_BA_Lighting Evt [} 309] Telegram generator for the light values. The priority is pre- set to e Manual Actuator. Auto Mode FB_BA_Lighting Evt [} 309] Telegram generator for the light values if the function block has been activated via the occupancy sensor and is not (yet) manually overridden. The priority is pre-set to e Automatic Light. VAR Name Type Description Light Switch FB_BA_Light Ctrl [} 311] Light control block. Prio Swi FB_BA_Lighting Tgm Sel4 Telegram selection. [} 310] Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 TF8040 Version: 1.14.0 911
## Page 912

Programming 6.1.4.2.1.4.4.1.1.5 FB_BA_Light Group Daylight This template represents a daylight-dependent light control that automatically switches on and off depending on occupancy. It is intended for corridors and passageways. An upstream, optimizing switch-on function FB_BA_Light Ctrl Value [} 314] ensures the specification of a light switch-on value that switches the downstream constant light regulation close to the desired setpoint. As soon as the light is switched on via occupancy, it is automatically readjusted according to the setpoint. Function In contrast to the FB_BA_Light Group Constant [} 894] template (constant light regulation), only the control mode of the function block FB_BA_Light Ctrl Const [} 317] is used here. It is not necessary to manually override the constant light regulation for corridors and passageways, which is why there is no switch input. If manual switch-on is nevertheless required, the switch should be treated as an occupancy sensor and not linked to the inputs b Swi, b Swi Up or b Swi Dwn, as these trigger the override without control. A rising edge at b Presence activates the function block and it is set directly to the switch-on value optimized by FB_BA_Light Ctrl Value [} 314]. On a falling edge at the template input b Presence or by setting b Reset Room Function, the light control block is disabled, whereby, if selected, it still announces its shutdown via a switch-off ramp with a dwell time at a pre-switch-off value. The function is then inactive and the output b Control Mode is deleted. In addition to the internal telegrams from Light Event and On Value (teach-in function), the input-side st Area Lighting and st Scene are also routed to the selector (Prio Swi). Here, st Area represents the resulting telegram from the higher levels (area, floor and building), while st Scene is reserved for any lighting scene to override the constant light regulation. The On Value.st Teach Lighting telegram is only active during the teach-in process of On Value (FB_BA_Light Ctrl Value [} 314]). The telegram selector (Prio Swi) forwards the telegram with the highest priority - with the same priority, the last telegram sent (last writer wins). The setpoint for constant light regulation is set using an analog object Sp Brightness [} 202]. Input st Reference Feedback Information about the controlled light actuator or the reference actuator of a group is fed back into the light control function via this input. The light value of the reference actuator is of particular importance here: If the light actuator is already controlled by another function of the same or lower priority and the template described here now "takes over" control, it must control the actuator based on its existing light value. The light preset block f On Value also requires information on the current light value of the controlled group. Since it can only determine the increase in brightness itself, it can only specify the increase on the current light value - the absolute value is the sum of the current light value and the increase. In addition, current values and states are transmitted and can be displayed via the HMI. 912 Version: 1.14.0 TF8040
## Page 913

Programming Data exchange HMI The data exchange with the HMI is realized here in the base class FB_BA_Ext_Light Base (internal function block). The use of the following variables is visible in this template: • b Light On_Out: Output information "Light On" to the HMI. • b Err_Out: Output information "Reference actuator faulty" to the HMI. • e Actual Prio_Out: Currently controlling telegram priority to the HMI. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 913
## Page 914

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Light Group Daylight EXTENDS FB_BA_Ext_Light Base VAR_INPUT b Reset Room Function : BOOL; b Presence : BOOL; b Teach On Value : BOOL; f Brightness : REAL; st Area Lighting : ST_BA_Lighting; st Scene : ST_BA_Lighting; st Reference Feedback : ST_BA_Light Actuator Feedback; END_VAR VAR_OUTPUT st Lighting : ST_BA_Lighting; 914 Version: 1.14.0 TF8040
## Page 915

Programming b Adjusting : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT f Hys : REAL; n Ramp Ti : UDINT; n Pre Off Ramp Ti : UDINT; n Brtns Adj Ti : UDINT; f Pre Off Val : REAL; n Pre Off Dly : UDINT; f Min Val : REAL; n Min Off Dly : UDINT; n Min On Dly : UDINT; f Lgt T : REAL; END_VAR VAR_INPUT CONSTANT Sp Brightness : FB_BA_AV_Op; On Value : FB_BA_Light Ctrl Value := ( e Prio := E_BA_Lighting Prio.e Maintenance); Light Event : FB_BA_Lighting Evt := ( e Prio := E_BA_Lighting Prio.e Simple); END_VAR VAR Const Lgt Ctrl : FB_BA_Light Ctrl Const; Prio Swi : FB_BA_Lighting Tgm Sel4; END_VAR Inputs Name Type Description b Reset Room Functio BOOL This input switches off the constant light control function n block. Switch-off takes place via a ramp and dwell time on a basic light value, see parameters: f Pre Off Val, n Pre Off Dly and n Pre Off Ramp T. b Presence BOOL Presence signal input. In the template, the constant light control block is preconfigured in fully automatic mode so that a rising edge at this input switches the function on and a falling edge switches the function off. b Teach On Value BOOL Starts the teach-in process on the function block FB_BA_Light Ctrl Value [} 314]. A light control telegram with priority e Maintenance is used to switch the light once to 0% and once to 100%. Due to the high priority of the telegram (e Maintenance), manual and automatic telegrams on the priority switch Prio Swi are overridden. f Brightness REAL Current brightness for constant light automatic: Range and unit depend on the light sensor. st Area Lighting ST_BA_Lighting [} 272] Resulting telegram from the higher levels (area, floor and building), which is formed in the function block FB_BA_Area Lighting [} 920]. st Scene ST_BA_Lighting [} 272] Reserved telegram input for scene control. st Reference Feedbac ST_BA_Light Actuator Feed Feedback input of the controlled light actuator or the guide k light of the controlled group. back [} 702] Outputs Name Type Description st Lighting ST_BA_Lighting [} 272] Resulting output program. b Adjusting BOOL The constant light control block is in regulation mode or the switch-on function is in teach-in mode. This signal can be used to query light sensors, which do not operate in analog mode but via communication, more frequently and thus achieve a more favorable control behavior. TF8040 Version: 1.14.0 915
## Page 916

Programming Inputs CONSTANT PERSISTENT Name Type Description f Hys REAL Constant light automatic: Hysteresis band. The constant light regulation controls the output up or down until the measured brightness reaches or slightly exceeds or falls below the target value. The light is then considered as adjusted. Only when the measured brightness exceeds or falls below the setpoint by f Hys/2, it is readjusted again. The range and unit depend on the used light sensor, see above: f Brtns SP and f Brtns Sen. Pre-set to 50 in FB_Init. n Ramp Ti UDINT Control ramp of the constant light automatic in seconds, related to a dimming from 0 to 100%. Pre-set to 60 s in FB_Init. n Pre Off Ramp Ti UDINT Ramp used to drive to a base value f Pre Off Val before switching off. Pre-set to 2 s in FB_Init. n Brtns Adj Ti UDINT Waiting time in seconds after switching on the light for the light sensor to detect the correct value. Is used both by the light preset function On Value and by the light control block Const Lgt Ctrl. f Pre Off Val / REAL / UDINT Base value and hold time at this value before switching off n Pre Off Dly the overall function. If the current light value already falls below the base value, this function is not active and it is switched off immediately. Pre-set to 4% and 10 s in FB_Init. f Min Val REAL Constant light automatic: Minimum output value. If this value has fallen below internally (i.e. it is bright enough that no artificial light is needed), the constant light control switches the light off after n Off Dly (in seconds) has elapsed. If the light is switched off and the control detects the need for light above the minimum value again, the control switches the light on again after n On Dly (in seconds) to initially f Min Val. Pre-set to 4% in FB_Init n Min Off Dly UDINT Constant light automatic: Switch-off waiting time in seconds, see f Min Val. Pre-set to 300 s in FB_Init. n Min On Dly UDINT Constant light automatic: Switch-on waiting time in seconds, see f Min Val. Pre-set to 300 s in FB_Init. f Lgt T REAL Light temperature: Pre-set to 3000 K in FB_Init. Inputs CONSTANT Name Type Description Sp Brightness FB_BA_AV_Op [} 202] Analog input object: Setpoint of the control [lx]. On Value FB_BA_Light Ctrl Value Optimizing switch-on function [} 314] Light Event FB_BA_Lighting Evt [} 309] Telegram generator for the light values. The priority is pre- set to e Manual Actuator. 916 Version: 1.14.0 TF8040
## Page 917

Programming VAR Name Type Description Const Lgt Ctrl FB_BA_Light Ctrl Const Constant light control block. [} 317] Prio Swi FB_BA_Lighting Tgm Sel4 Telegram selection. [} 310] Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.4.1.2 Building 6.1.4.2.1.4.4.1.2.1 FB_BA_Building Lighting This template compiles cross-building control telegrams for the light functions. The "fire" and "burglary" alarms are usually recorded in the building controller (FB_BA_Fire Alarm System and FB_BA_Burglar Alarm System). From there, they are sent with other information via the communication server (FB_BA_Ads Com Server_Basic [} 847]) to the floor controllers, where they are received in the counter-block FB_BA_Ads Com Client_Basic [} 848] and made available centrally in the local variable list Site [} 1116]. The fire and burglary alarms can each trigger a separate light telegram via the Fire Alert and Burglary Event function blocks [} 309]. The telegrams are routed to a priority function block Prio Swi [} 310]. In addition to the alarms, a global reset of the light functions is provided in this template. On the one hand, it consists of manual triggering via a Global Reset [} 216] input object, which is parameterized in FB_Init as a push button and on the other hand, a trigger signal is generated when the building energy level "Protection" or "Economy" is reached, which is intended to signal "Absence". The resulting light telegram from Prio Swi and the global reset "Light" are made available via the st Building Lighting [} 702] structure in the local variable list Site [} 1116]. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 917
## Page 918

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Building Lighting EXTENDS FB_BA_View VAR_INPUT CONSTANT PERSISTENT f Lgt Val_Fire Alert : REAL; f Lgt T_Fire Alert : REAL; f Lgt Val_Burglary : REAL; f Lgt T_Burglary : REAL; END_VAR VAR_INPUT CONSTANT Fire Alert : FB_BA_Lighting Evt := ( e Prio := E_BA_Lighting Prio.e Fire); Burglary : FB_BA_Lighting Evt := ( e Prio := E_BA_Lighting Prio.e Burglary); Global Reset : FB_BA_BV_Op; END_VAR VAR rt Reset By Energ Lvl : R_TRIG; Prio Swi : FB_BA_Lighting Tgm Sel4; END_VAR VAR_INPUT CONSTANT PERSISTENT Name Type Description f Lgt Val_Fire Alert REAL Input light value [%] in case of fire. Pre-set to 100% in FB_Init. f Lgt T_Fire Alert REAL Input light temperature [K] in case of fire. Pre-set to 4000 K in FB_Init. f Lgt Val_Burglary REAL Input light value [%] in case of burglary. Pre-set to 100% in FB_Init. f Lgt T_Burglary REAL Enter the light temperature [K] in case of burglary. Pre-set to 4000 K in FB_Init. 918 Version: 1.14.0 TF8040
## Page 919

Programming VAR_INPUT CONSTANT Name Type Description Fire Alert FB_BA_Lighting Evt [} 309] Event telegram block for the fire alarm. Burglary FB_BA_Lighting Evt [} 309] Event telegram block for the burglary alarm. Global Reset FB_BA_BV_Op [} 216] Binary input object: Operating option to reset the light functions. This object is parameterized as non-latching in FB_Init, i.e. it generates a TRUE pulse. VAR Name Type Description rt Reset By Energ Lvl R_TRIG Triggers the reset signal generated from the energy levels. Prio Swi FB_BA_Lighting Tgm Sel4 Telegram selection block for the light telegrams. [} 310] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.4.1.3 Floor 6.1.4.2.1.4.4.1.3.1 FB_BA_Floor Lighting This template is used to implement various light functions at floor level. It has a very simple design and can be expanded as required. The resulting building light telegram from the local variable list Site [} 1116] is routed to the Prio Swi [} 310] priority function block, which provides further inputs for light telegrams from schedules, for example. The resulting telegram is sent to the inputs of the function blocks Area Lighting[1] and Area Lighting[2]. Their output telegrams are routed back to the local variable list Site [} 1116]. The lighting area block [} 920] contains exemplary schedules and manual controls. The function blocks listed there can be copied and amended or reduced for this template. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 919
## Page 920

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Floor Lighting EXTENDS FB_BA_View VAR_INPUT CONSTANT Area Lighting : ARRAY[1.. BA2_Param.n Max Number Of Areas] OF FB_BA_Area Lighting; END_VAR VAR Prio Swi Light : FB_BA_Lighting Tgm Sel4; END_VAR Inputs CONSTANT Name Type Description Area Lighting FB_BA_Area Lighting Lighting area block with telegram functions that affect the area within a floor. [} 920] VAR Name Type Description Prio Swi Light FB_BA_Lighting Tgm Sel4 Telegram selection block for the light telegrams. [} 310] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.4.1.4 Area 6.1.4.2.1.4.4.1.4.1 FB_BA_Area Lighting Selection of lighting operation for an area based on a schedule (Sched) and manual operation (Op Mod Man). 920 Version: 1.14.0 TF8040
## Page 921

Programming The manual operation has the following modes: Value Meaning 1 Automatic mode. 2 Manual selection Night watchman tour. 3 Manual selection Building cleaning. 4 Manual selection Maintenance. 5 Manual selection User-defined 1. 6 Manual selection User-defined 2. If Automatic mode is selected, the function block De Mux Man Mod sets the output b Q01. Since this output is not connected to the Prio Swi, the manual mode on the Prio Swi is disabled and the schedule Sched is active. This can assume the following values: Value Meaning 1 Default. 2 Night watchman tour. 3 Building cleaning. 4 User-defined 1. 5 User-defined 2. The currently selected lighting mode e Area Mode, which is of the same type as the building mode [} 696], is then displayed via the Op Mod Pr function block. One of the Event function blocks [} 309] is enabled based on the currently valid lighting mode. All possible light telegrams are routed to the priority function block Prio Swi in addition to the floor telegram st Floor on the input side. The resulting telegram is available to the room templates at the st Area output. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 921
## Page 922

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Area Lighting EXTENDS FB_BA_View VAR_INPUT st Floor : ST_BA_Lighting; END_VAR VAR_OUTPUT 922 Version: 1.14.0 TF8040
## Page 923

Programming st Area : ST_BA_Lighting; END_VAR VAR_INPUT CONSTANT Op Mod Man : FB_BA_MV_Op; Op Mod Pr : FB_BA_MV_Op; Sched : FB_BA_Sched M; Lgt Val Night Watch : FB_BA_AV_Op; Lgt TNight Watch : FB_BA_AV_Op; Night Watch : FB_BA_Lighting Evt := ( e Prio := E_BA_Lighting Prio.e Night Watch); Lgt Val Cleaning : FB_BA_AV_Op; Lgt TCleaning : FB_BA_AV_Op; Cleaning : FB_BA_Lighting Evt := ( e Prio := E_BA_Lighting Prio.e Cleaning); Lgt Val Maintenance : FB_BA_AV_Op; Lgt TMaintenance : FB_BA_AV_Op; Maintenance : FB_BA_Lighting Evt := ( e Prio := E_BA_Lighting Prio.e Maintenance); Lgt Val User Defined1 : FB_BA_AV_Op; Lgt TUser Defined1 : FB_BA_AV_Op; User Defined1 : FB_BA_Lighting Evt := ( e Prio := 10); Lgt Val User Defined2 : FB_BA_AV_Op; Lgt TUser Defined2 : FB_BA_AV_Op; User Defined2 : FB_BA_Lighting Evt := ( e Prio := 10); END_VAR VAR De Mux Man Mod : FB_BA_DMUX_B08; De Mux Sched : FB_BA_DMUX_B08; Area Mode : FB_BA_Prio Swi_UDI16; e Area Mode : E_BA_Building Mode; Prio Swi : FB_BA_Lighting Tgm Sel8; END_VAR Inputs Name Type Description st Floor ST_BA_Lighting [} 272] Light control telegram from the higher level "Floor". Outputs Name Type Description st Area ST_BA_Lighting [} 272] Resulting light control telegram from this template, which represents the "Area" level. TF8040 Version: 1.14.0 923
## Page 924

Programming Inputs CONSTANT Name Type Description Op Mod Man FB_BA_MV_Op [} 239] Manual input object for the building mode. Op Mod Pr FB_BA_MV_Op [} 239] Resulting mode Sched FB_BA_Sched M [} 225] Schedule object (automatic) for the building mode. Lgt Val Night Watch FB_BA_AV_Op [} 202] Input object for the night watchman tour light value. Lgt TNight Watch FB_BA_AV_Op [} 202] Input object for the light temperature night watchman tour. Night Watch FB_BA_Lighting Evt [} 309] Event function block Night watchman tour. Lgt Val Cleaning FB_BA_AV_Op [} 202] Input object for the building cleaning light value. Lgt TCleaning FB_BA_AV_Op [} 202] Input object for the building cleaning light temperature. Cleaning FB_BA_Lighting Evt [} 309] Event function block Building cleaning. Lgt Val Maintenance FB_BA_AV_Op [} 202] Input object for the maintenance light value. Lgt TMaintenance FB_BA_AV_Op [} 202] Input object for the maintenance light temperature. Maintenance FB_BA_Lighting Evt [} 309] Event gunction block Maintenance. Lgt Val User Defined1 FB_BA_AV_Op [} 202] Input object for the "User-defined1" light value. Lgt TUser Defined1 FB_BA_AV_Op [} 202] Input object for the "User-defined1" light temperature. User Defined1 FB_BA_Lighting Evt [} 309] Event function block "User-defined1". Lgt Val User Defined2 FB_BA_AV_Op [} 202] Input object for the "User-defined2" light value. Lgt TUser Defined2 FB_BA_AV_Op [} 202] Input object for the "User-defined2" light temperature. User Defined2 FB_BA_Lighting Evt [} 309] Event function block "User-defined2". VAR Name Type Description De Mux Man Mod FB_BA_DMUX_B08 [} 426] Conversion of the multistate value of the manual selection to a binary output. De Mux Sched FB_BA_DMUX_B08 [} 426] Conversion of the multistate value of the schedule to a binary output. Area Mode FB_BA_Prio Swi_UDI16 Prioritizing reconversion of the states to a resulting multistate or enumeration value for lighting operation in the [} 433] building area. e Area Mode E_BA_Building Mode Currently valid lighting operation in building area. [} 696] Prio Swi FB_BA_Lighting Tgm Sel8 Telegram selection block for the light telegrams. [} 310] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 924 Version: 1.14.0 TF8040
## Page 925

Programming 6.1.4.2.1.4.4.2 Actuators 6.1.4.2.1.4.4.2.1 FB_BA_Light Analog This template is used to control an analog light actuator. The core element is the analog output function block FB_BA_AO_Raw [} 199], which provides the light value in BACnet and also converts the light value from 0 to 100 % to 0 to 32767. The allocated variable n Lgt Val enables a direct link to a dimmer terminal (KL2751, KL2761). The function block ignores the color temperature when controlling the light actuator. The template has a feedback structure st Feedback [} 702]. If the programmed light actuator is an individual actuator or the reference actuator of a group, this feedback telegram must be linked to the controlling room (zone) user function in order to obtain information about the state of the actuator. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Light Analog EXTENDS FB_BA_View VAR_INPUT b En : BOOL; st Lighting Cmd : ST_BA_Lighting; END_VAR VAR_OUTPUT f Actual Light Value : REAL; e Actual Light Prio : BYTE; st Feedback : ST_BA_Light Actuator Feedback; END_VAR VAR_INPUT CONSTANT Actual Light Value : FB_BA_AO_Raw; TF8040 Version: 1.14.0 925
## Page 926

Programming END_VAR VAR n Lgt Val AT %Q* : INT; END_VAR Inputs Name Type Description b En BOOL Enabling the function block. st Lighting Cmd ST_BA_Lighting [} 272] Resulting telegram from the higher-level zone (room). Outputs Name Type Description f Actual Light Value REAL Current light value in percent. e Actual Light Prio BYTE Current priority of the command telegram st Lighting Cmd. st Feedback ST_BA_Light Actuator Feed Feedback telegram for linking to the controlling room (zone) application function. In this way, information about back [} 702] the state of the light actuator is fed back into the application function. Inputs CONSTANT Name Type Description Actual Light Value FB_BA_AO_Raw [} 199] Function block for converting the percentage light value to the value range 0..32767 and for simultaneous display in BACnet. VAR Name Type Description n Lgt Val INT Output variable for linking with the dimmer terminal. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.4.2.2 FB_BA_Light DALI_Base This template is used to control a DALI light actuator, a DALI group or DALI devices with a broadcast, whereby only the light brightness value is changed. 926 Version: 1.14.0 TF8040
## Page 927

Programming The core is the light control block Light Actr [} 874]. This establishes the connection to a DALI luminaire (or group) and converts changes in the light telegram st Lighting Cmd into DALI control signals. In addition, input b Initialize can be used to initialize the DALI luminaire (or group) with the parameters set on the function block (minimum value, maximum value, etc.). It should be noted that if the light control value is changed in the command telegram, the output values by Actl Lgt Val and f Actl Lgt Val initially correspond to this control value. Internally, however, in the function block FB_BA_Light Actr DALI_Base [} 874], the actual light value is queried cyclically. This ensures that the true state of the DALI luminaire is displayed without placing an unnecessary load on the DALI bus. The function block ignores the color temperature when controlling the light actuator. The current light value is made available in BACnet via an analog object FB_BA_AV_Op [} 202]. The template has a feedback structure st Feedback [} 702]. If the programmed light actuator is an individual actuator or the reference actuator of a group, this feedback telegram must be linked to the controlling room (zone) user function in order to obtain information about the state of the actuator. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Light DALI_Base EXTENDS FB_BA_View VAR_INPUT b En : BOOL; st Lighting Cmd : ST_BA_Lighting; b Initialize : BOOL; END_VAR VAR_OUTPUT b Initializing : BOOL; b Err : BOOL; f Actual Light Value : REAL; e Actual Light Prio : BYTE; st Feedback : ST_BA_Light Actuator Feedback; END_VAR VAR_INPUT CONSTANT PERSISTENT e Adr Type : Tc3_DALI. E_DALIAddress Type := Tc3_DALI. E_DALIAddress Type. Short; n Adr : BYTE; n Adr Ref Dev : BYTE; ip DALICommunication : Tc3_DALI. I_DALICommunication; TF8040 Version: 1.14.0 927
## Page 928

Programming END_VAR VAR_INPUT CONSTANT Light Actr : FB_BA_Light Actr DALI_Base; Actual Light Value : FB_BA_AV_Op; END_VAR Inputs Name Type Description b En BOOL Enabling the function block: A TRUE signal activates the function. st Lighting Cmd ST_BA_Lighting [} 272] Command telegram from the higher-level zone (room). b Initialize BOOL A positive edge at this input starts the DALI initialization routine, which transfers the set parameters to the control gears (see FB_BA_Light Actr DALI_Base [} 874]). Outputs Name Type Description b Initializing BOOL The light actuator or the actuators are in the DALI initialization phase, i.e. the entered parameters are transferred to the controlled control gears. b Err BOOL Error output. A plain text is output in Twin CAT in the error list in the output window. f Actual Light Value REAL Current light value in percent. e Actual Light Prio E_BA_Lighting Prio [} 268] Current priority of the command telegram st Lighting Cmd. st Feedback ST_BA_Light Actuator Feed Feedback telegram for linking to the controlling room (zone) application function. In this way, information about back [} 702] the state of the light actuator is fed back into the application function. Inputs CONSTANT PERSISTENT Name Type Description e Adr Type Tc3_DALI. E_DALIAddress T Selection of the control type: individual, group or broadcast control, pre-set to individual control. ype n Adr BYTE DALI address of the actuator or group. n Adr Ref Dev BYTE DALI address of a reference device if group or broadcast control is selected. This reference device then represents all other controlled devices. ip DALICommunicati Tc3_DALI. I_DALICommuni Interface pointer to the DALI communication block. on cation Inputs CONSTANT Name Type Description Light Actr FB_BA_Light Actr DALI_Base Light control block without color temperature control. [} 874] Actual Light Value FB_BA_AV_Op [} 202] Function block for displaying the percentage light value in BACnet. 928 Version: 1.14.0 TF8040
## Page 929

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.4.2.3 FB_BA_Light DALI_TC This template is used to control a DALI light actuator, a DALI group or DALI devices with a broadcast, whereby color temperature control is supported. The core is the light control block Light Actr [} 877]. This establishes the connection to a DALI luminaire (or group) and converts changes in the light telegram st Lighting Cmd into DALI control signals. In addition, input b Initialize can be used to initialize the DALI luminaire (or group) with the parameters set on the function block (minimum value, maximum value, etc.). It should be noted that if the light control value or the color temperature is changed in the command telegram, the output values by Actl Lgt Val, f Actl Lgt Val and f Actl Lgt T initially correspond to these control values. Internally, however, in the function block FB_BA_Light Actr DALI_TC [} 877], the actual light value and the actual color temperature are queried cyclically. This ensures that the true state of the DALI luminaire is displayed without placing an unnecessary load on the DALI bus. The current light value is made available in BACnet via an analog object FB_BA_AV_Op [} 202], while the current color temperature is only displayed as a template output. The template has a feedback structure st Feedback [} 702]. If the programmed light actuator is an individual actuator or the reference actuator of a group, this feedback telegram must be linked to the controlling room (zone) user function in order to obtain information about the state of the actuator. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 929
## Page 930

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Light DALI_TC EXTENDS FB_BA_View VAR_INPUT b En : BOOL; st Lighting Cmd : ST_BA_Lighting; b Initialize : BOOL; END_VAR VAR_OUTPUT b Initializing : BOOL; b Err : BOOL; f Actual Light Value : REAL; f Actual Light Temperature : REAL; e Actual Light Prio : BYTE; st Feedback : ST_BA_Light Actuator Feedback; END_VAR VAR_INPUT CONSTANT PERSISTENT e Adr Type : Tc3_DALI. E_DALIAddress Type := Tc3_DALI. E_DALIAddress Type. Short; n Adr : BYTE; n Adr Ref Dev : BYTE; ip DALICommunication : Tc3_DALI. I_DALICommunication; END_VAR VAR_INPUT CONSTANT Light Actr : FB_BA_Light Actr DALI_Base; Actual Light Value : FB_BA_AV_Op; END_VAR Inputs Name Type Description b En BOOL Enabling the function block: A TRUE signal activates the function. st Lighting Cmd ST_BA_Lighting [} 272] Command telegram from the higher-level zone (room). b Initialize BOOL A positive edge at this input starts the DALI initialization routine, which transfers the set parameters to the control gears (see FB_BA_Light Actr DALI_Base [} 874]). 930 Version: 1.14.0 TF8040
## Page 931

Programming Outputs Name Type Description b Initializing BOOL The light actuator or the actuators are in the DALI initialization phase, i.e. the entered parameters are transferred to the controlled control gears. b Err BOOL Error output. A plain text is output in Twin CAT in the error list in the output window. f Actual Light Value REAL Current light value in percent. f Actual Light Tempera REAL Current color temperature in Kelvin. ture e Actual Light Prio E_BA_Lighting Prio [} 268] Current priority of the command telegram st Lighting Cmd. st Feedback ST_BA_Light Actuator Feed Feedback telegram for linking to the controlling room (zone) user function. In this way, information about the back [} 702] state of the light actuator is fed back into the application function. Inputs CONSTANT PERSISTENT Name Type Description e Adr Type Tc3_DALI. E_DALIAddress T Selection of the control type: individual, group or broadcast control, pre-set to individual control. ype n Adr BYTE DALI address of the actuator or group. n Adr Ref Dev BYTE DALI address of a reference device if group or broadcast control is selected. This reference device then represents all other controlled devices. ip DALICommunicati Tc3_DALI. I_DALICommuni Interface pointer to the DALI communication block. on cation Inputs CONSTANT Name Type Description Light Actr FB_BA_Light Actr DALI_Base Light control block without color temperature control. [} 874] Actual Light Value FB_BA_AV_Op [} 202] Function block for displaying the percentage light value in BACnet. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.5 Room Samples Possible room templates. 6.1.4.2.1.4.5.1 FB_BA_Room Sample1 TF8040 Version: 1.14.0 931
## Page 932

Programming This template represents a simple room with a heating/cooling controller, a sun protection zone function with two blinds and a sun protection zone function with two DALI lights. The room is also controlled and monitored by a DALI occupancy sensor, which also provides the room brightness. DALI control As this room template is an example with DALI components, it requires a fast task with a DALI communication block. The data exchange with the DALI devices then takes place via an interface and is predefined in FB_Init, here using the example of the brightness and occupancy sensor: Brtns Prc Sns.i Parent := THIS^; Brtns Prc Sns.i Label := Lbl Ctl_Brightness Presence Sensor; Brtns Prc Sns.e DPADMode := E_BA_DPADMode.e Include; Brtns Prc Sns.n Adr := 11; Brtns Prc Sns.n Instance Presence := 1; Brtns Prc Sns.n Instance Brightness := 0; Brtns Prc Sns.n Res Brtns := 10; Brtns Prc Sns.ip DALICommunication := DALICommunication.fb KL6821Communication; In the last line, the DALI communication block is assigned to the communication interface pointer of the brightness and occupancy sensor. This sample implements the function block fb KL6821Communication in the program DALICommunication: The program DALICommunication must be called in a fast task - instructions can be found in the chapter: Fast task for serial communication [} 54]. 932 Version: 1.14.0 TF8040
## Page 933

Programming Brightness and occupancy sensors The function block FB_BA_Brightness Presence DALI [} 884] represents DALI devices that can read both brightness and presence. The function block instructions describe that the presence is output event-driven, but the brightness is read in intervals of the adjustable duration n Prd Query Brtns [s]. In this sample, a short duration n Polling Interval Fast and a long duration n Polling Interval Normal are specified: the short duration is intended for the brightness adaptation of a constant light regulation if it receives a readjustment order (Light Zone Constant.b Adjusting), the long duration is then used in normal operation to avoid further loading of the DALI bus. Heating and cooling controller The core of the heating and cooling function is the function block FB_BA_Heat Cool_PID [} 891]. The global variable list Site [} 1116] informs the function block whether heating or cooling mode is active (e Heat Cool Medium), which temperatures apply for which energy level (st Building Sp Rm T) and which energy level is currently valid building-wide (e Building Energy Level). In general, the full heating and cooling output in the Comfort energy level should only be available when people are present. This is reported to the function block via the room's occupancy sensor at the b Prc input. Two window contacts Wdw Con1 and Wdw Con2 monitor the heating/cooling. These contacts are designed to supply a TRUE signal when the window is closed. If one of the windows is opened, the function block FB_BA_Heat Cool_PID [} 891] receives a TRUE signal at the b Wdw Con input and switches internally to the Protection energy level so as not to control unnecessarily against the outside temperature. Like the window contacts, the Dew Point Sensor is designed according to the quiescent current principle. In the critical case, it will output a FALSE signal, which is negated and sent as TRUE to the b Dew Pnt input of the FB_BA_Heat Cool_PID [} 891]. This immediately ends and locks the cooling mode. An analog sensor Rm TSen provides the room temperature to the control system; the room temperature setpoint can be changed within small limits via a setpoint generator Rm TAdj. The pre-set values for f Rm TAdj Min and f Rm TAdj Max in FB_Init are -5K and 5K. The room temperature adjustment is only effective if the Comfort or Precomfort energy level is present, see FB_BA_Rm TAdj [} 302]. Blind control In this sample, a zone function block FB_BA_Sunblind Zone is predefined for the blind controller, which controls 2 blind actuator function blocks FB_BA_Sun Bld [} 970] in parallel. The zone function block bundles the entire generation of automatic commands, manual control and the link to a visualization (HMI). The blind actuator function blocks only contain the travel profiles and the link to the hardware. Each blind or blind group that is to be controlled individually therefore requires a zone function block. The zone function block receives data such as storm protection and anti-icing or sun protection and thermal automatic via the st Facade input. It is thus assigned to a specific facade. If it were a corner room with blinds of different orientations, a further zone function block would have to be added. Via the occupancy sensor input b Prc Detc, to which the brightness and occupancy sensor is linked, the function block decides whether the sun protection can be active (occupancy) or whether the thermal automatic can be active (non-occupancy). The thermal automatic also needs to know the room temperature and the building's current setpoint in order to use the sun's radiant heat or protect against it with the help of the blinds. Sun protection and thermal automatic can also generally be deselected within the FB_BA_Sunblind Zone. The inputs b Sunbld Swi Up and b Sunbld Swi Dwn are declared here as simple variables and it is up to the user to link them to his application. TF8040 Version: 1.14.0 933
## Page 934

Programming To assess the status of the blind group and to display it in a visualization, a blind actuator must be selected as a reference. Its output st Feedback must be connected to the input st Reference Feedback of the zone function block. In the case of a single blind, the blind itself is the reference actuator. Light control Similar to the blinds, the core of the lighting system is a zone function block that combines the generation of higher-level commands (building, floor, area) with local manual operation and the control and display of a possible visualization. The actuator function blocks merely represent the control of the lamps, which can be directly via a bus terminal or via a protocol (DALI). Here, too, each actuator to be controlled individually requires a zone function block. A reference actuator whose output st Feedback must be linked to the input st Reference Feedback of the zone function block must also be selected to assess the status of a group. In the case of a single lamp, this itself is the reference actuator. In this sample, the light zone is a constant light regulation FB_BA_Light Group Constant [} 894]. If fully automatic is selected, the FB_BA_Brightness Presence DALI [} 884] brightness and presence function block can activate constant light regulation via the b Prc Detc input. If presence is no longer detected, the lighting controllers are reset via the b Reset Room Function input. The automatic function, or its local manual override, is then no longer active and light telegrams of lower priority from the building, floor or area arriving at the st Area Lighting input, can take over the lighting controllers. The f Brightness input receives the measured luminous intensity of the brightness sensor for light control. The b Light Swi input is declared here as a simple variable and it is up to the user to link it to his application. The initialization of the template takes place within the method FB_Init. Block diagram The https://infosys.beckhoff.com/content/1033/TF8040_TC3_Building Automation/Resources/ 18447665419.zip can be downloaded if required. Syntax FUNCTION_BLOCK FB_BA_Room Sample1 EXTENDS FB_BA_View VAR_INPUT st Facade : ST_BA_Facade; st Area Lighting : ST_BA_Lighting; END_VAR VAR_INPUT CONSTANT PERSISTENT f Rm TAdj Min : REAL; f Rm TAdj Max : REAL; f Lgt T : REAL; n Polling Interval Fast : UDINT; n Polling Interval Normal : UDINT; END_VAR VAR_INPUT CONSTANT Brtns Prc Sns : FB_BA_Brightness Presence DALI; Ctrl : FB_BA_Heat Cool_PID; Vlv Htg : FB_BA_Actuator Analog; Vlv Col : FB_BA_Actuator Analog; Wdw Con1 : FB_BA_Sensor Binary; Wdw Con2 : FB_BA_Sensor Binary; Dew Point Sensor : FB_BA_Sensor Binary; Rm TSen : FB_BA_Sensor Analog; Rm TAdj : FB_BA_Sensor Analog; Sun Bld Zone : FB_BA_Sunblind Zone; Sun Bld1 : FB_BA_Sun Bld; Sun Bld2 : FB_BA_Sun Bld; Light Zone Constant : FB_BA_Light Group Constant; Light1 : FB_BA_Light DALI_TC; Light2 : FB_BA_Light DALI_TC; END_VAR 934 Version: 1.14.0 TF8040
## Page 935

Programming VAR b Sunbld Swi Up : BOOL; b Sunbld Swi Dwn : BOOL; b Light Swi : BOOL; Rm TAvg : FB_BA_En Avrg02; b Initialize Sensor : BOOL; END_VAR Inputs Name Type Description st Facade ST_BA_Facade [} 704] Facade-specific blind data and telegrams. st Area Lighting ST_BA_Lighting [} 272] Resulting light telegram from the building, the floor and finally the area (prioritization). Inputs CONSTANT PERSISTENT Name Type Description f Rm TAdj Min REAL Minimum value of the temperature setpoint shift, predefined to -5K. f Rm TAdj Max REAL Minimum value of the temperature setpoint shift, predefined to 5K. f Lgt T REAL Fixed light temperature of the constant light regulation, predefined at 3000K. n Polling Interval Fast UDINT Fast polling interval of the brightness sensor, predefined to 1 s. n Polling Interval Norm UDINT Slow polling interval of the brightness sensor, predefined al to 15 s. TF8040 Version: 1.14.0 935
## Page 936

Programming Inputs CONSTANT Name Type Description Brtns Prc Sns FB_BA_Brightness Presence Reading and evaluation function block for a DALI brightness and occupancy sensor. DALI [} 884] Ctrl FB_BA_Heat Cool_PID Heating-cooling control block. [} 891] Vlv Htg FB_BA_Actuator Analog Analog output object heating valve. [} 982] Vlv Col FB_BA_Actuator Analog Analog output object cooling valve. [} 982] Wdw Con1 FB_BA_Sensor Binary Binary input object window contact. [} 1088] Wdw Con2 FB_BA_Sensor Binary Binary input object window contact. [} 1088] Dew Point Sensor FB_BA_Sensor Binary Binary input object dew point sensor. [} 1088] Rm TSen FB_BA_Sensor Analog Analog input object room temperature sensor. [} 1087] Rm TAdj FB_BA_Sensor Analog Analog input object setpoint adjustment. [} 1087] Sun Bld Zone FB_BA_Sunblind Zone Function block blind-specific zone functions. [} 964] Sun Bld1 FB_BA_Sun Bld [} 970] Actuator function block for a blind. Sun Bld2 FB_BA_Sun Bld [} 970] Actuator function block for a blind. Light Zone Constant FB_BA_Light Group Constan Light zone function block of a constant light regulation. t [} 894] Light1 FB_BA_Light DALI_TC Actuator function block for a DALI light. [} 929] Light2 FB_BA_Light DALI_TC Actuator function block for a DALI light. [} 929] VAR Name Type Description b Sunbld Swi Up BOOL Variable for the "Blinds manually open" button assignment. b Sunbld Swi Dwn BOOL Variable for the "Blinds manually down" button assignment. b Light Swi BOOL Variable for "Switch light manually" button assignment. b Initialize Sensor BOOL Variable for reinitializing the DALI brightness and occupancy sensor. Prerequisites Development environment Necessary function Twin CAT from v3.1.4024.64 TF8040 | Twin CAT Building Automation from V5.10.1.0 6.1.4.2.1.4.6 Sun Protection Templates for creating a custom sun protection. 936 Version: 1.14.0 TF8040
## Page 937

Programming 6.1.4.2.1.4.6.1 Functions 6.1.4.2.1.4.6.1.1 Building 6.1.4.2.1.4.6.1.1.1 FB_BA_Building Sunprotection This template collects cross-building criteria for the blind functions, which are then further used in the facade instances of the FB_BA_Facade [} 940]. These are in detail: • resulting telegram building alarms • Protection telegram Fire The template FB_BA_Building Alarms [} 849] supplies the information "Fire alarm" via a globally declared structure variable st Building Alarms (see global variable list Site [} 1116]). If this alarm is active, the blinds are raised completely via a FB_BA_Sun Bld Evt [} 378]. • Protection telegram Burglar The template FB_BA_Building Alarms [} 849] supplies the information "burglar alarm" via a globally declared structure variable st Building Alarms (see global variable list Site [} 1116]). If this alarm is active, the blinds are raised completely via a FB_BA_Sun Bld Evt [} 378]. This makes the burglar less hidden from view from the outside. • Protection telegram icing An imminent icing is detected by the fact that during a precipitation detection the measured outside temperature is below the frost limit value - this is specified here by the object Sp Ice and is pre-set to -2 °C. If the outside temperature exceeds the frost limit value for the time specified at the object Deice Ti, frost protection is canceled again. In the case of the icing alarm, a telegram is output at the function block FB_BA_Sun Bld Ice Prtc [} 379], which causes the blinds to be raised completely. • Thermal automatic As a rule, a weather station does not measure the global heat radiation depending on the direction. Therefore, it makes sense to define a switch-on and a switch-off threshold per building. The objects Global Th Auto Val On and Global Th Auto Val Off define these threshold values in W/m² and form the building-wide release of the thermal automatic via a hysteresis switch (object Global Th Auto Rlse). • Twilight automatic The twilight, which defines only a short period during the day, is also defined across buildings: the four direction-dependent brightness values of the weather station are averaged and assigned the threshold values Global Twi Lgt Auto Val On and Global Twi Lgt Auto Val Off. • Sun protection The interval for repositioning the lamellas in the sun protection functions is specified here for the entire building. • Reset of the manual functions A building-wide criterion for the reset of the manual functions is defined here. It is based on the building schedule of energy levels, which give an inference of absence. Alternatively, a binary input object is available. The above protection telegrams are combined on a priority switch FB_BA_Sun Bld Tgm Sel4 [} 390] to a resulting telegram. This is made available at the end of the template with the building-specific sun protection data in a globally declared variable structure st Building Sun Blind (see global variable list Site [} 1116]). The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 937
## Page 938

Programming Syntax FUNCTION_BLOCK FB_BA_Building Sunprotection EXTENDS FB_BA_View VAR_INPUT CONSTANT Fire Alert : FB_BA_Sun Bld Evt := (e Prio:=E_BA_Sun Bld Prio.e Fire); Burglary : FB_BA_Sun Bld Evt := (e Prio:=E_BA_Sun Bld Prio.e Burglary); Ice Protection : FB_BA_Ice Protection; Global Th Auto Rlse : FB_BA_Hys_03; Global Twi Lgt Auto Rlse : FB_BA_Hys_03; Sun Prtc Pos Intval : FB_BA_AV_Op_SP; Global Reset Man Mode : FB_BA_BV_Op_Val; END_VAR VAR Building Alarms : FB_BA_Sun Bld Tgm Sel4; Global Twi Lgt Auto Val On Off : FB_BA_Swi2P; rt Man Reset Energ Lvl : R_TRIG; END_VAR Inputs CONSTANT Name Type Description Fire Alert FB_BA_Sun Bld Evt [} 378] Telegram block for the fire alarm: lets the blind raise completely. Burglary FB_BA_Sun Bld Evt [} 378] Telegram block for burglary: lets the blind raise completely. Ice Protection FB_BA_Ice Protection Sub-template for presentation of the ice protection. [} 939] Global Th Auto Rlse FB_BA_Hys_03 [} 1008] Hysteresis template for the presentation of the global automatic thermal release due to global radiation. Contains limit values, delays and a binary object for display. Global Twi Lgt Auto Rls FB_BA_Hys_03 [} 1008] Hysteresis template for the presentation of the global e automatic twilight release based on the average brightness. Contains limit values, delays and a binary object for display. Sun Prtc Pos Intval FB_BA_AV_Op_SP [} 1029] Analog input object: Readjustment interval of the lamella angle [min]. Global Reset Man Mo FB_BA_BV_Op_Val [} 1031] Binary input object: Operating option for resetting manual de functions. Variables Name Type Description Building Alarms FB_BA_Sun Bld Tgm Sel4 Priority selection block. [} 390] Global Twi Lgt Auto Val FB_BA_Swi2P Hysteresis block for switching off the twilight automatic On Off (global criterion). rt Man Reset Energ Lvl R_TRIG Trigger reset of the manual function for the criterion energy level (continuous signal). Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 938 Version: 1.14.0 TF8040
## Page 939

Programming 6.1.4.2.1.4.6.1.1.2 FB_BA_Ice Protection Sub-template ice protection. The function block FB_BA_Ice Protection implements the icing protection. If the temperature falls below the freezing point entered on the SPIce object and the weather station transmits precipitation via the variable list Site [} 1116] (Site.st Weather Station.b Rain), the icing condition is given and the blinds are raised completely. The alarm is only canceled when the outside temperature exceeds the icing temperature again for a deicing time (in seconds) set on the Deice Ti object. The telegram is then no longer active. To ensure that current temperature values are available at the start of the program, the activation of the icing alarm function block is initially delayed by 10 s. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Ice Protection EXTENDS FB_BA_View VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Ice Prtc Actv : BOOL; END_VAR VAR_INPUT CONSTANT Sp Ice : FB_BA_AV_Op; Deice Ti : FB_BA_AV_Op; Ice Alert : FB_BA_BV; Sun Bld Ice Prtc : FB_BA_Sun Bld Ice Prtc; END_VAR VAR ton Initial Wait : TON; END_VAR TF8040 Version: 1.14.0 939
## Page 940

Programming Outputs Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Ice protection telegram. b Ice Prtc Actv BOOL Control output "Ice protection active". Inputs CONSTANT Name Type Description Sp Ice FB_BA_AV_Op [} 202] Input limit value for icing [°C]. Deice Ti FB_BA_AV_Op [} 202] Enter de-icing time [s]. Ice Alert FB_BA_BV [} 213] Display object Status ice protection. Sun Bld Ice Prtc FB_BA_Sun Bld Ice Prtc Ice protection for the lamellas. [} 379] Variables Name Type Description ton Initial Wait TON Initial function block enable delay. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.6.1.2 Facade 6.1.4.2.1.4.6.1.2.1 FB_BA_Facade This template compiles the sun protection telegrams that are valid for an entire facade. The telegrams are largely formed in sub-templates in the main part, then passed to a telegram selector FB_BA_Sun Bld Tgm Sel8 [} 391] and supplemented by the resulting alarm telegram from the building data (fire, burglary or icing). The passed telegram from the selector is placed on the output structure st Facade together with the enables from the thermal and twilight automatic and the current sun protection data - the priority of the telegram is displayed in the sub-template Facade Information [} 946]. Telegrams The following telegrams are available at the telegram selector [} 391] Sun Bld Tgm Result, sorted by input: • Protection telegram communication error (Comm Error) The global variable list Site [} 1116] also contains the error states of the subscribers, which can only change to TRUE if the corresponding subscriber is actually used. In the event of a subscriber failure or a weather station malfunction, the blinds are raised as a precaution. • Protection telegram Storm (Wind Protection [} 957]) • Positioning telegram Maintenance (Maintenance [} 947]) 940 Version: 1.14.0 TF8040
## Page 941

Programming • Positioning telegram for facade thermal automatic (Thermo Automatic [} 953]) • Positioning telegram for twilight automatic (Twilight Automatic [} 956]) • Positioning telegram park position (Park Position [} 948]) • Alarm telegram fire/burglary/icing This telegram (Site.st Building Sun Blind.st Sun Bld) is usually created on the building controller in the template FB_BA_Building Sunprotection [} 937] and placed on the Site variable list [} 1116]. It contains the building-wide telegrams for icing, burglary and fire. Sun protection calculation Sun protection is calculated separately for each facade. This is done in the sub-template Sun Protection [} 950]. The calculated values are placed on the output structure st Facade [} 704] together with the enables from the thermal and twilight automatic. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 941
## Page 942

Programming Block diagram 942 Version: 1.14.0 TF8040
## Page 943

Programming Syntax FUNCTION_BLOCK FB_BA_Facade EXTENDS FB_BA_View VAR_INPUT f Ref Rm T : REAL; f Ref Rm TCol : REAL; f Ref Rm THtg : REAL; END_VAR VAR_OUTPUT st Facade : ST_BA_Facade; END_VAR VAR_INPUT CONSTANT PERSISTENT f Fcd Ortn : REAL; f Fcd Angl : REAL; f Lam Wdth : REAL; f Lam Dstc : REAL; f Azm Stt Rng : REAL; f Azm End Rng : REAL; f Elv Lo Lmt : REAL; f Elv Hi Lmt : REAL; END_VAR VAR_INPUT CONSTANT Comm Error : FB_BA_Sun Bld Evt :=(e Prio:=E_BA_Sun Bld Prio.e Comm Error); Wind Protection : FB_BA_Facade_Wind Protection; Maintenance : FB_BA_Facade_Maintenance; Thermo Automatic : FB_BA_Facade_Thermo Automatic; Twilight Automatic : FB_BA_Facade_Twilight Automatic; Park Position : FB_BA_Facade_Park Position; Sun Protection : FB_BA_Facade_Sun Protection; Facade Information : FB_BA_Facade_Information; END_VAR VAR In Rng Azm : FB_BA_In Rng Azm; In Rng Elv : FB_BA_In Rng Elv; b Fcd In Sun : BOOL; Sun Bld Tgm Result : FB_BA_Sun Bld Tgm Sel8; END_VAR Inputs Name Type Description f Ref Rm T REAL Room temperature of the reference room for the facade- wide thermal automatic. f Ref Rm TCol REAL Room temperature setpoint cooling of the reference room for the facade-wide thermal automatic. f Ref Rm THtg REAL Room temperature setpoint heating of the reference room for the facade-wide thermal automatic. Outputs Name Type Description st Facade ST_BA_Facade [} 704] Output structure of the collected facade data. TF8040 Version: 1.14.0 943
## Page 944

Programming Inputs CONSTANT PERSISTENT Name Type Description f Fcd Ortn REAL Facade orientation northern hemisphere: north=0°, east=90°, south=180°, west=270°, in the southern hemisphere applies: south=0°, east=90°, north=180°, west=270°. f Fcd Angl REAL Inclination of the facade [°]. Inclined downwards, the angle is smaller, upwards it is greater than zero. f Lam Wdth REAL Lamella width [mm]. f Lam Dstc REAL Lamella spacing [mm]. f Azm Stt Rng / REAL The facade is considered to be illuminated by the sun f Azm End Rng when the position of the sun is +/-90° of the facade orientation. With f Azm Stt Rng / f Azm End Rng the range can be restricted. f Elv Lo Lmt / REAL The facade is considered to be illuminated by the sun f Elv Hi Lmt when the sun elevation is between 0 and 90°. With f Elv Lo Lmt / f Elv Hi Lmt the range can be restricted. Inputs CONSTANT Name Type Description Comm Error FB_BA_Sun Bld Evt [} 378] Telegram block for the communication error Wind Protection FB_BA_Facade_Wind Prote Sub-template storm protection ction [} 957] Maintenance FB_BA_Facade_Maintenan Sub-template maintenance ce [} 947] Thermo Automatic FB_BA_Facade_Thermo Aut Sub-template thermal automatic omatic [} 953] Twilight Automatic FB_BA_Facade_Twilight Aut Sub-template twilight automatic omatic [} 956] Park Position FB_BA_Facade_Park Positio Sub-template park position n [} 948] Sun Protection FB_BA_Facade_Sun Protecti Sub-template sun protection on [} 950] Facade Information FB_BA_Facade_Informatio Sub-template facade information n [} 946] Variables Name Type Description In Rng Azm FB_BA_In Rng Azm [} 350] Sun direction within the defined limits In Rng Elv FB_BA_In Rng Elv [} 352] Sun elevation within the defined limits b Fcd In Sun BOOL Facade in the position of the sun Sun Bld Tgm Result FB_BA_Sun Bld Tgm Sel8 Telegram selection block for the resulting blind telegram of the facade [} 391] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 944 Version: 1.14.0 TF8040
## Page 945

Programming 6.1.4.2.1.4.6.1.2.2 FB_BA_Facade Subscr This template is used to receive the facade data of the type ST_BA_Facade [} 704] and is typically used in the floor controllers. It represents an extension of FB_BA_Subscriber: In case of communication failure, the sunblinds telegram st Sunbld is overwritten within the facade data with an active telegram position 0%. Syntax FUNCTION_BLOCK FB_BA_Facade Subscr EXTENDS FB_BA_Subscriber VAR_OUTPUT st Data : ST_BA_Facade; END_VAR VAR _fb High Prio : FB_BA_Sun Bld Evt := (e Prio := E_BA_Sun Bld Prio.e Comm Error); END_VAR Outputs Name Type Description st Data ST_BA_Facade [} 704] Read facade telegram, overwritten in case of error. Variables Name Type Description _fb High Prio FB_BA_Sun Bld Evt [} 378] Telegram block which activates a high-priority (e Prio := E_BA_Sun Bld Prio.e Comm Error) telegram with position 0% in the event of faulty communication and thus allows the blind to be raised completely. Methods Name Description Get Data [} 945] Determines the address and size of the output telegram. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1. Get Data 4.2. 1.4. 6.1. 2.2. 1 Internally used method that determines the address and size of the output telegram. TF8040 Version: 1.14.0 945
## Page 946

Programming Syntax VAR_OUTPUT p Data : PVOID; n Size : DINT; END_VAR Outputs Name Type Description p Data p Data Pointer to the subscribed data. n Size DINT Size of the subscribed data. 6.1.4.2.1.4.6.1.2.3 FB_BA_Facade_Information Sub-template facade information. This template displays the priority of the current sun protection telegram in BACnet. As the enumeration of the priorities starts with "0", but the texts of the MV object start with "1" (see FB_Init), a one must be added to the enumeration. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Facade_Information EXTENDS FB_BA_View VAR_INPUT st Facade Result : ST_BA_Sun Bld; END_VAR VAR_INPUT CONSTANT Fcd Actv Prio : FB_BA_MV_Op; END_VAR Inputs Name Type Description st Facade Result ST_BA_Sun Bld [} 274] Resulting telegram from the higher-level facade template [} 940]. Inputs CONSTANT Name Type Description Fcd Actv Prio FB_BA_MV_Op [} 239] Function block for displaying the current telegram priority in BACnet. 946 Version: 1.14.0 TF8040
## Page 947

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.6.1.2.4 FB_BA_Facade_Maintenance Sub-template Maintenance position. This function allows you to enter a position and an angle for maintenance work via objects and activate the corresponding sun protection telegram, which is then available to the higher-level facade template [} 940] at the st Sunblind output. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Facade_Maintenance EXTENDS FB_BA_View VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Mntn Actv : BOOL; END_VAR VAR_INPUT CONSTANT Mntn En : FB_BA_BV_Op; Mntn Pos : FB_BA_AV_Op; Mntn Angl : FB_BA_AV_Op; Mntn Event : FB_BA_Sun Bld Evt := (e Prio:=E_BA_Sun Bld Prio.e Maintenance); END_VAR TF8040 Version: 1.14.0 947
## Page 948

Programming Outputs Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Maintenance telegram. b Mntn Actv BOOL Control output "Maintenance active". Inputs CONSTANT Name Type Description Mntn En FB_BA_BV_Op [} 216] Function block for activating the maintenance telegram. Mntn Pos FB_BA_AV_Op [} 202] Function block for entering the position. Mntn Angl FB_BA_AV_Op [} 202] Function block for entering the angle. Mntn Event FB_BA_Sun Bld Evt [} 378] Function block for telegram generation. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.6.1.2.5 FB_BA_Facade_Park Position Sub-template Park position. This function allows you to enter a park position and a park angle and activate the corresponding sun protection telegram, which is then available to the higher-level facade template [} 940] at the st Sunblind output. The initialization of the template takes place within the method FB_Init. 948 Version: 1.14.0 TF8040
## Page 949

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Facade_Park Position EXTENDS FB_BA_View VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Park Pos Event : BOOL; END_VAR VAR_INPUT CONSTANT Fcd Park En : FB_BA_BV_Op; Fcd Park Pos : FB_BA_AV_Op; Fcd Park Angl : FB_BA_AV_Op; Fcd Park Pos Event : FB_BA_Sun Bld Evt := (e Prio:=E_BA_Sun Bld Prio.e Park Position); END_VAR Outputs Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Parking position telegram. b Park Pos Event BOOL Control output "Parking position enabled". Inputs CONSTANT Name Type Description Fcd Park En FB_BA_BV_Op [} 216] Function block for activating the maintenance telegram. Fcd Park Pos FB_BA_AV_Op [} 202] Function block for entering the position. Fcd Park Angl FB_BA_AV_Op [} 202] Function block for entering the angle. Fcd Park Pos Event FB_BA_Sun Bld Evt [} 378] Function block for telegram generation. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 TF8040 Version: 1.14.0 949
## Page 950

Programming 6.1.4.2.1.4.6.1.2.6 FB_BA_Facade_Sun Protection Sub-template Automatic sun protection. This template calls up a sun protection function with fixed position and lamella setpoint tracing. In the upper part, the brightness for the facade under consideration is first interpolated using the facade orientation (north = 0°, east = 90°, south = 180°, west = 270°) and the 4 light sensors (Brtns Cardinal interpolation). As the glare effect of the sun also depends on the height of the sun, 7 brightness values are used for the switch-on and switch-off threshold of the sun protection. These are defined as AV objects and describe threshold values at 0°, 15°, 30°, 45°, 60°, 75° and 90° sun elevation. The switch-on and switch-off thresholds are each interpolated with a function block FB_BA_Chrct07 [} 461] based on the current sun elevation. The calculated threshold values for On and Off are each made available via an AV object in BACnet. In the subsequent section, a hysteresis block generates the actual enable for the sun protection function. The actual value used for this is the interpolated brightness based on the cardinal points. In addition, a time delay of the limit values is programmed to take account of a rapid change in brightness. Enabling sun protection function block is restricted by the criterion "b Fcd In Sun" (facade is in the sun area) and then indicated in BACnet via a BV object. The global data for the sun protection function - date/time, positioning interval, longitude and latitude of the property - comes from the local variable list Site [} 1116], while facade orientation, facade inclination, lamella width and lamella spacing come as inputs from the higher-level FB_BA_Facade [} 940] as parameters. The determined blind angle and position are indicated as analog objects in BACnet. The initialization of the template takes place within the method FB_Init. 950 Version: 1.14.0 TF8040
## Page 951

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Facade_Sun Protection EXTENDS FB_BA_View VAR_INPUT b Fcd In Sun : BOOL; f Fcd Ortn : REAL; f Fcd Angl : REAL; f Lam Wdth : REAL; f Lam Dstc : REAL; END_VAR VAR_OUTPUT st Sunbld : ST_BA_Sun Bld; b Sun Prtc Actv : BOOL; TF8040 Version: 1.14.0 951
## Page 952

Programming END_VAR VAR_INPUT CONSTANT Sun Prtc Val On00deg : FB_BA_AV_Op; Sun Prtc Val On15deg : FB_BA_AV_Op; Sun Prtc Val On30deg : FB_BA_AV_Op; Sun Prtc Val On45deg : FB_BA_AV_Op; Sun Prtc Val On60deg : FB_BA_AV_Op; Sun Prtc Val On75deg : FB_BA_AV_Op; Sun Prtc Val On90deg : FB_BA_AV_Op; Sun Prtc Val Off00deg : FB_BA_AV_Op; Sun Prtc Val Off15deg : FB_BA_AV_Op; Sun Prtc Val Off30deg : FB_BA_AV_Op; Sun Prtc Val Off45deg : FB_BA_AV_Op; Sun Prtc Val Off60deg : FB_BA_AV_Op; Sun Prtc Val Off75deg : FB_BA_AV_Op; Sun Prtc Val Off90deg : FB_BA_AV_Op; Sun Prtc Val On Calc : FB_BA_AV_Op; Sun Prtc Val Off Calc : FB_BA_AV_Op; Sun Prtc Dly On : FB_BA_AV_Op; Sun Prtc Dly Off : FB_BA_AV_Op; Sun Prtc State : FB_BA_BV_Op; Sun Prtc Pos : FB_BA_AV_Op; Sun Prtc Angl : FB_BA_AV_Op; Sun Prtc : FB_BA_Sun Prtc; END_VAR VAR a Brtns Direction : ARRAY[1..32] OF REAL :=[0.0, 90.0, 180.0, 270.0, 360.0]; a Brtns At Direction : ARRAY[1..32] OF REAL; Brtns Cardinal Interpolation : FB_BA_Chrct32; Sun Prtc Val On : FB_BA_Chrct07; Sun Prtc Val Off : FB_BA_Chrct07; Sun Prtc Val On Off : FB_BA_Swi2P; END_VAR Inputs Name Type Description b Fcd In Sun BOOL The facade is located in the sun area in relation to the current sun elevation and sun direction. This criterion is generated in the higher-level FB_BA_Facade [} 940]. f Fcd Ortn REAL Facade orientation northern hemisphere: north=0°, east=90°, south=180°, west=270°, in the southern hemisphere applies: south=0°, east=90°, north=180°, west=270°. f Fcd Angl REAL Inclination of the facade [°]. Inclined downwards, the angle is smaller, upwards it is greater than zero. f Lam Wdth REAL Lamella width [mm]. f Lam Dstc REAL Lamella spacing [mm]. Outputs Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Parking position telegram. b Sun Prtc Actv BOOL Control output "Sun protection active". 952 Version: 1.14.0 TF8040
## Page 953

Programming Inputs CONSTANT Name Type Description Sun Prtc Val On00deg FB_BA_AV_Op [} 202] Brightness thresholds for sun protection On [lx] for … elevations of 0°, 15°, 30°, 45°, 60°, 75° and 90°. Sun Prtc Val On90deg Sun Prtc Val Off00deg FB_BA_AV_Op [} 202] Brightness thresholds for sun protection Off [lx] for … elevations of 0°, 15°, 30°, 45°, 60°, 75° and 90°. Sun Prtc Val Off90deg Sun Prtc Val On Calc FB_BA_AV_Op [} 202] Calculated brightness threshold value for sun protection On [lx] for display in BACnet. Sun Prtc Val Off Calc FB_BA_AV_Op [} 202] Calculated brightness threshold value for sun protection Off [lx] for display in BACnet. Sun Prtc Dly On FB_BA_AV_Op [} 202] Delay sun protection on [s]. Sun Prtc Dly Off FB_BA_AV_Op [} 202] Delay sun protection off [s]. Sun Prtc State FB_BA_BV_Op [} 216] Display object state sun protection. This object indicates whether the release of the sun protection on the part of the facade is given. Whether the blinds actually assume the sun protection position depends on criteria within the room zones (e.g. presence). Sun Prtc Pos FB_BA_AV_Op [} 202] Calculated sun protection position [%] for display in BACnet. Sun Prtc Angl FB_BA_AV_Op [} 202] Calculated sun protection angle [°] for display in BACnet. Sun Prtc FB_BA_Sun Prtc [} 396] Calculation block for sun protection. Variables Name Type Description a Brtns Direction ARRAY[1..32] OF REAL Preset field of cardinal points for weighting the brightness. a Brtns At Direction ARRAY[1..32] OF REAL Input field for the brightness related to the above mentioned cardinal points. Brtns Cardinal Interpo FB_BA_Chrct32 [} 463] Calculation block for brightness. lation Sun Prtc Val On FB_BA_Chrct07 [} 461] Calculation block for the elevation-dependent brightness threshold On. Sun Prtc Val Off FB_BA_Chrct07 [} 461] Calculation block for the elevation-dependent brightness threshold Off. Sun Prtc Val On Off FB_BA_Swi2P Hysteresis block for switching on/off the sun protection. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.6.1.2.7 FB_BA_Facade_Thermo Automatic Sub-template facade-wide thermal automatic. TF8040 Version: 1.14.0 953
## Page 954

Programming A facade-wide thermal automatic needs the temperature of a reference room as well as its heating and cooling setpoint. This data is specified via the input variables f Ref Rm T, f Ref Rm TCol and f Ref Rm THtg. Four conditions must be met for the facade thermal automatic to become active: • the building must be unoccupied, this is determined on the basis of the currently valid energy level. • the global radiation-dependent release from the template FB_BA_Building Sunprotection [} 937] must be given. This criterion is routed to the local variable list Site [} 1116] and is read from there (Site.st Building Sun Blind.b Global Th Auto_Release). • the facade must be exposed to the sun (b Fcd In Sun). • the facade-wide thermal automatic is selected via the Fcd Th Auto En object. If these conditions are met, the blind moves alternately to cooling position (objects Fcd Th Auto Col Pos and Fcd Th Auto Col Angl) if the reference temperature exceeds the cooling value or to position 0 if the heating value is fallen below. The thermal automatic can be selected and deselected via the Fcd Th Auto En object. The initialization of the template takes place within the method FB_Init. Block diagram 954 Version: 1.14.0 TF8040
## Page 955

Programming Syntax FUNCTION_BLOCK FB_BA_Facade_Thermo Automatic EXTENDS FB_BA_View VAR_INPUT b Fcd In Sun : BOOL; f Ref Rm T : REAL; f Ref Rm TCol : REAL; Reff Rm THtg : REAL; END_VAR VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Th Auto Event : BOOL; END_VAR VAR_INPUT CONSTANT Fcd Th Auto En : FB_BA_BV_Op; Fcd Th Auto Col Pos : FB_BA_AV_Op; Fcd Th Auto Col Angl : FB_BA_AV_Op; Fcd Th Auto Event : FB_BA_Sun Bld Evt :=(e Prio:=E_BA_Sun Bld Prio.e Facade Thermo Automatic); END_VAR VAR Fcd Th Auto Htg Col : FB_BA_Swi2P; b Fcd Th Auto_Enable : BOOL; f Fcd Th Auto_Position : REAL; f Fcd Th Auto_Angle : REAL; END_VAR Inputs Name Type Description b Fcd In Sun BOOL The facade is located in the sun area in relation to the current sun elevation and sun direction. This criterion is generated in the higher-level FB_BA_Facade [} 940]. f Ref Rm T REAL Room temperature of the reference room for the facade- wide thermal automatic. f Ref Rm TCol REAL Room temperature setpoint cooling of the reference room for the facade-wide thermal automatic. Ref Rm THtg REAL Room temperature setpoint heating of the reference room for the facade-wide thermal automatic. Outputs Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Thermal automatic telegram. b Th Auto Event BOOL Control output "facade-wide thermal automatic active". Inputs CONSTANT Name Type Description Fcd Th Auto En FB_BA_BV_Op [} 216] Facade thermal automatic enable. Fcd Th Auto Col Pos FB_BA_AV_Op [} 202] Facade thermal automatic cooling position Position [%]. Fcd Th Auto Col Angl FB_BA_AV_Op [} 202] Facade thermal automatic cooling position Angle [°]. Fcd Th Auto Event FB_BA_Sun Bld Evt [} 378] Telegram block for facade thermal automatic. Variables Name Type Description Fcd Th Auto Htg Col FB_BA_Swi2P Hysteresis block for heating/cooling changeover for facade thermal automatic. b Fcd Th Auto_Enable BOOL Enable thermal automatic. f Fcd Th Auto_Position REAL Thermal automatic Position [%]. f Fcd Th Auto_Angle REAL Thermal automatic Angle [°]. TF8040 Version: 1.14.0 955
## Page 956

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.6.1.2.8 FB_BA_Facade_Twilight Automatic Sub-template facade-wide twilight automatic. This function is designed to be active only when no one is present to prevent unnecessary light from escaping the building. Three conditions must be met for the facade automatic to become active: • the building must be unoccupied, this is determined on the basis of the currently valid energy level. • the brightness-dependent release from the template FB_BA_Building Sunprotection [} 937] must be given. This criterion is routed to the local variable list Site [} 1116] and is read from there (Site.st Building Sun Blind.b Global Twi Lgt Auto_Release). • the facade-wide twilight automatic is selected via the Fcd Twi Lgt Auto En object. If it is enabled and selected via the Fcd Twi Lgt Auto En object, the blinds will be lowered completely in the event of twilight. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Facade_Twilight Automatic EXTENDS FB_BA_View VAR_INPUT END_VAR VAR_OUTPUT st Sun Bld : ST_BA_Sun Bld; b Twi Lgt Auto Event : BOOL; END_VAR VAR_INPUT CONSTANT 956 Version: 1.14.0 TF8040
## Page 957

Programming Fcd Twi Lgt Auto En : FB_BA_BV_Op; Fcd Twi Lgt Auto Event : FB_BA_Sun Bld Evt :=(e Prio:=E_BA_Sun Bld Prio.e Facade Twilight Automatic); END_VAR Outputs Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Twilight automatic telegram. b Twi Lgt Auto Event BOOL Control output "facade-wide twilight automatic active". Inputs CONSTANT Name Type Description Fcd Twi Lgt Auto En FB_BA_BV_Op [} 216] Function block for activating the twilight automatic telegram. Fcd Twi Lgt Auto Event FB_BA_Sun Bld Evt [} 378] Function block for telegram generation. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.6.1.2.9 FB_BA_Facade_Wind Protection Sub-template Storm protection. The data for storm protection - wind speed and wind direction - is first transferred from the weather station template [} 855] to the local variable list Site [} 1116] together with other weather data. From there, they are available as • Site.st Weather Station.f Wind Speed • Site.st Weather Station.f Wind Direction in this template. In the upper part of the function, the switch-on and switch-off thresholds for activation are weighted according to the wind direction. The array tables Storm On Interpolation for the switch-on threshold and Storm Off Interpolation for the switch-off threshold provide limit values for different wind directions are available in 30° steps. The idea behind this is that a direct wind impact on the facade is weighted more heavily (lower limit value) than if the wind comes from the side (higher limit value). As this template is delivered universally, i.e. for all facade directions, the switch-on threshold for all wind directions is predefined at 12 m/s (strong wind) and the switch-off threshold at 8 m/s in FB_Init. The values can be refined as required. It should also be noted that the limit values are actually unitless and must be selected according to the weather station: if the weather station outputs the wind speed in km/h, the values in the order of 40 km/h for switching on and 28 km/h for switching off are more appropriate. TF8040 Version: 1.14.0 957
## Page 958

Programming The function block FB_BA_Sun Bld Wnd Prtc [} 394] implements storm protection. The current wind speed from the variable list Site [} 1116] and the weighted switch-on and switch-off thresholds are sent to it. It also has inputs for a switch-on and switch-off delay, which can be set via the input objects Dly Strm On [} 202] and Dly Strm Off [} 202]. Both values are limited to 60 s in this template. The binary display object Wnd Prtc State [} 216] is used to display the status of the storm protection in BACnet. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Facade_Wind Protection EXTENDS FB_BA_View VAR_OUTPUT st Sunbld : ST_BA_Sun Bld; b Wnd Prtc : BOOL; f Wnd Spd Storm On : REAL; f Wnd Spd Storm Off : REAL; END_VAR VAR_INPUT CONSTANT PERSISTENT a Wnd Spd Lmt Storm On : ARRAY[1..32] OF REAL; a Wnd Spd Lmt Storm Off : ARRAY[1..32] OF REAL; END_VAR VAR_INPUT CONSTANT Dly Strm On : FB_BA_AV_Op; 958 Version: 1.14.0 TF8040
## Page 959

Programming Dly Strm Off : FB_BA_AV_Op; Wnd Prtc State : FB_BA_BV_Op; Sun Bld Wnd Prtc : FB_BA_Sun Bld Wnd Prtc; END_VAR VAR a Storm Direction : ARRAY[1..32] OF REAL :=[0.0, 30.0, 60.0, 90.0, 120.0, 150.0, 180.0, 210 .0, 240.0, 270.0, 300.0, 330.0, 360.0]; Storm On Interpolation : FB_BA_Chrct32; Storm Off Interpolation : FB_BA_Chrct32; END_VAR Outputs Name Type Description st Sun Bld ST_BA_Sun Bld [} 274] Storm protection telegram. b Wnd Prtc BOOL Control output "Storm protection active". f Wnd Spd Storm On REAL Calculated value limit value storm detection. f Wnd Spd Storm Off REAL Calculated value limit value Storm abated. Inputs CONSTANT PERSISTENT Name Type Description a Wnd Spd Lmt Storm ARRAY[1..32] OF REAL a Wnd Spd Lmt Storm On[01] … a Wnd Spd Lmt Storm On[13]: On These values define the interpolation curve for the direction-dependent switch-on threshold of the storm detection. Here a Wnd Spd Lmt Storm On[01] applies to the wind direction at 0° (north). The other field elements represent the interpolation points in 30° steps. The unit of the values selected in FB_Init is m/s. If the weather station provides the wind speed in a different unit, the values must be selected accordingly. Only 13 values are described for the interpolation of the wind direction. The corresponding function block is parameterized accordingly. a Wnd Spd Lmt Storm ARRAY[1..32] OF REAL a Wnd Spd Lmt Storm Off[01] .. a Wnd Spd Lmt Storm Off[13]: Off These values define the interpolation curve for the direction-dependent switch-off threshold of the storm detection. Here a Wnd Spd Lmt Storm Off[01] applies to the wind direction at 0° (north). The other field elements represent the interpolation points in 30° steps. The unit of the values selected in FB_Init is m/s. If the weather station provides the wind speed in a different unit, the values must be selected accordingly. Only 13 values are described for the interpolation of the wind direction. The corresponding function block is parameterized accordingly. Inputs CONSTANT Name Type Description Dly Strm On FB_BA_AV_Op [} 202] Delay value for storm detection [s]. Dly Strm Off FB_BA_AV_Op [} 202] Delay value storm abated [s]. Wnd Prtc State FB_BA_BV_Op [} 216] Display object state storm protection. Sun Bld Wnd Prtc FB_BA_Sun Bld Wnd Prtc Triggering and telegram block for storm protection. [} 394] TF8040 Version: 1.14.0 959
## Page 960

Programming Variables Name Type Description a Storm Direction ARRAY[1..32] OF REAL Pre-set field of cardinal points for weighting the storm limits. Storm On Interpolatio FB_BA_Chrct32 [} 463] Calculation block for the limit value storm detection. n Storm Off Interpolatio FB_BA_Chrct32 [} 463] Calculation block for the limit value Storm abated. n Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.6.1.3 Zone 6.1.4.2.1.4.6.1.3.1 FB_BA_Rollerblind Zone In a blind zone, one or more blinds are combined for simultaneous control, depending on the local conditions. The template bundles the predefined data of the facades and decides on the basis of a zone presence detection and local selection and deselection which functionality is active. Together with the resulting telegram of high-priority functions from the facade, these functionalities are placed on a telegram selector at the end of the template. This then uses the priority to decide which telegram in the higher-level room template is passed on to the blinds. Functions • Manual function The zone template contains a manual function that enables manual control of the blind via the key functions b Swi Up/b Swi Dwn. The switchover time to latching, n Swi Over Ti [ms], is pre-parameterized to 250 ms. The manual function is deleted via the input b Rst Man Fnct (inherited from the base class FB_BA_Ext_Sunblind Position (internal function block)). • Thermal automatic Thermal automatic is considered active if it is selected locally (parameter b Th Auto Slcn), if no presence is detected (input b Prc Detc) and the facade template FB_BA_Facade [} 940] has determined the release for this building side. If it is active, the positioning is decided on the basis of the room temperature (input f Room Temp Sen) and the building setpoints for heating and cooling: If the room temperature is above the building value for comfort cooling, the blinds move to a predefinable position. If, on the other hand, the temperature drops below the value for comfort heating, the blinds will open completely. • Automatic sun protection In contrast to the thermal automatic, the automatic sun protection is only active when presence is detected (input b Prc Detc). It must also be selected locally (parameter b Sun Prtc Slcn) and be enabled by the facade template, among other things by the direction-dependent brightness. The blind position is also determined in the facade. 960 Version: 1.14.0 TF8040
## Page 961

Programming • Twilight automatic The twilight automatic is enabled in the facade on the basis of the brightness values. If the automatic for the zone is selected (input b Twi Lgt Auto Slcn) the blind moves to a predefined position in case of twilight (parameter f Twi Lgt Auto Pos). Input st Reference Feedback Information about the controlled blind actuator or the reference actuator of a group is fed back into the blind control function via this input. These are the position details and status of the reference actuator. Data exchange HMI The data exchange with the HMI is realized here in the base class FB_BA_Ext_Sunblind Position (internal function block). The use of the following variables is visible in this template: • b Reset Manual_In: Command from the HMI to delete the manual function. • f Sunblind Position_Out: Output information position to the HMI. • b Opened_Out: Output information "Blind completely open" to the HMI. • b Closed_Out: Output information "Blind completely closed" to the HMI. • b Err_Out: Output information "Reference actuator faulty" to the HMI. • e Actual Prio_Out: Currently controlling telegram priority to the HMI. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 961
## Page 962

Programming Block diagram 962 Version: 1.14.0 TF8040
## Page 963

Programming Syntax FUNCTION_BLOCK FB_BA_Rollerblind Zone EXTENDS FB_BA_Ext_Sunblind Position VAR_INPUT f Room Temp Sen : REAL; b Prc Detc : BOOL; b Swi Up : BOOL; b Swi Dwn : BOOL; b Rst Man Fnct : BOOL; st Building Sp Rm T : ST_BA_Sp Rm T; st Facade : ST_BA_Facade; st Scene : ST_BA_Sunbld; st Reference Feedback : ST_BA_Sunblind Actuator Feedback; END_VAR VAR_OUTPUT st Sun Bld Out : ST_BA_Sun Bld; END_VAR VAR_INPUT CONSTANT PERSISTENT b Th Auto Slcn : BOOL; f Th Auto Col Pos : REAL; b Sun Prtc Slcn : BOOL; b Twi Lgt Auto Slcn : BOOL; f Twi Lgt Auto Pos : REAL; n Swi Over Ti : UDINT; END_VAR VAR_INPUT CONSTANT Man Swi : FB_BA_Sun Bld Swi := (e Prio:= E_BA_Sun Bld Prio.e Manual Group); Th Auto : FB_BA_Sun Bld Evt := (e Prio:= E_BA_Sun Bld Prio.e Group Thermo Auto); Sun Prtc : FB_BA_Sun Bld Evt : = (e Prio:= E_BA_Sun Bld Prio.e Sun Protection); Twi Lgt Auto : FB_BA_Sun Bld Evt := (e Prio:= E_BA_Sun Bld Prio.e Group Twi Light Auto); END_VAR VAR Th Auto Swi : FB_BA_Swi2P; Prio Swi : FB_BA_Sun Bld Tgm Sel8; En Sun Bld Swi : SR; END_VAR Inputs Name Type Description f Room Temp Sen REAL Room temperature sensor [°C]. b Prc Detc BOOL Presence detection. b Swi Up BOOL Key function Blind "up". b Swi Dwn BOOL Key function Blind "down". b Rst Man Fnct BOOL Deletion input for the blind manual flag. st Building Sp Rm T ST_BA_Sp Rm T [} 272] Structure of room setpoints (Protection Cooling.. Comfort Cooling and Protection Heating ... Comfort Heating). st Facade ST_BA_Facade [} 704] Structure of the facade data (facade telegrams, releases for twilight and thermal automatic, etc.) st Scene ST_BA_Sunbld [} 274] Reserved telegram input for scene control. st Reference Feedbac ST_BA_Sunblind Actuator F Feedback input of the controlled blind actuator or the k reference actuator of the controlled group. eedback [} 701] Outputs Name Type Description st Sun Bld Out ST_BA_Sunbld [} 274] Resulting zone telegram. TF8040 Version: 1.14.0 963
## Page 964

Programming Inputs CONSTANT PERSISTENT Name Type Description b Th Auto Slcn BOOL Thermal automatic enable. f Th Auto Col Pos REAL Thermal automatic cooling position [%]. b Sun Prtc Slcn BOOL Shading automatic enable. b Twi Lgt Auto Slcn BOOL Twilight automatic enable. f Twi Lgt Auto Pos REAL Twilight automatic cooling position [%]. n Swi Over Ti UDINT Push button function of the zone: Switchover time [ms] from jogging to latching mode. Inputs CONSTANT Name Type Description Man Swi FB_BA_Sun Bld Swi [} 388] Group (zone) push button block. Th Auto FB_BA_Sun Bld Evt [} 378] Telegram block for group (zone) thermal automatic. Sun Prtc FB_BA_Sun Bld Evt [} 378] Telegram block for group (zone) shading automatic. Twi Lgt Auto FB_BA_Sun Bld Evt [} 378] Telegram block for group (zone) twilight automatic. Variables Name Type Description Th Auto Swi FB_BA_Swi2P Hysteresis block for heating/cooling changeover for group (zone) thermal automatic. Prio Swi FB_BA_Sun Bld Tgm Sel8 Selection of the resulting telegram. [} 391] En Sun Bld Swi SR Enable/reset switching. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.6.1.3.2 FB_BA_Sunblind Zone In a blind zone, one or more blinds are combined for simultaneous control. The template FB_BA_Sunblind Zone bundles the predefined data of the facades and decides on the basis of a zone presence detection and local selection and deselection which functionality is active. Together with the resulting telegram of high-priority functions from the facade, these functionalities are placed on a telegram selector at the end of the template. This then uses the priority to decide which telegram in the higher-level room template is passed on to the blinds. Functions 964 Version: 1.14.0 TF8040
## Page 965

Programming • Manual function The zone template contains a manual function that enables manual control of the blind via the key functions b Swi Up/b Swi Dwn. The switchover time to latching, n Swi Over Ti [ms], is pre-parameterized to 250 ms. The manual function is deleted via input b Rst Man Fnct. • Thermal automatic Thermal automatic is considered active if it is selected locally (parameter b Th Auto Slcn), if no presence is detected (input b Prc Detc) and the facade template FB_BA_Facade [} 940] has determined the enable for this building side. If it is active, the positioning is decided on the basis of the room temperature (input f Room Temp Sen) and the building setpoints for heating and cooling: If the room temperature is above the building value for comfort cooling, the blinds move to a predefinable position. If, on the other hand, the temperature drops below the value for comfort heating, the blinds will open completely. • Automatic sun protection In contrast to the thermal automatic, the automatic sun protection is only active when presence is detected (input b Prc Detc). It must also be selected locally (parameter b Sun Prtc Slcn) and be enabled by the facade template, among other things by the direction-dependent brightness. The blind position and angle are also determined in the facade. • Twilight automatic The twilight automatic is enabled in the facade on the basis of the brightness values. If the automatic for the zone is selected (input b Twi Lgt Auto Slcn) the blind moves to a predefined position in case of twilight (parameter f Twi Lgt Auto Pos/f Twi Lgt Auto Angl). Input st Reference Feedback Information about the controlled blind actuator or the reference actuator of a group is fed back into the blind control function via this input. These are the position details and status of the reference actuator. Data exchange HMI The data exchange with the HMI is realized here in the base class FB_BA_Ext_Sunblind Angle (internal function block). The use of the following variables is visible in this template: • b Reset Manual_In: Command from the HMI to delete the manual function. • f Sunblind Position_Out: Output information position to the HMI. • f Sunblind Angle_Degree: Output information angle in degrees to the HMI. • b Opened_Out: Output information "Blind completely open" to the HMI. • b Closed_Out: Output information "Blind completely closed" to the HMI. • b Err_Out: Output information "Reference actuator faulty" to the HMI. • e Actual Prio_Out: Currently controlling telegram priority to the HMI. • f Angl Lmt Up: Upper lamella angle of the reference actuator. • f Angl Lmt Dwn: Lower lamella angle of the reference actuator. The HMI is used to specify the lamella angles to be controlled in 0% (lamella at upper limit position f Angl Lmt Up) to 100% (lamella at lower limit position f Angl Lmt Dwn), with 50% being the zero position (0° = lamella horizontal). It must be ensured that the upper lamella angle is greater than 0° and the lower lamella angle is less than 0° at this point in order to be able to carry out the calculation correctly. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 965
## Page 966

Programming Block diagram 966 Version: 1.14.0 TF8040
## Page 967

Programming Syntax FUNCTION_BLOCK FB_BA_Sunblind Zone EXTENDS FB_BA_Ext_Sunblind Angle VAR_INPUT f Room Temp Sen : REAL; b Prc Detc : BOOL; b Swi Up : BOOL; b Swi Dwn : BOOL; b Rst Man Fnct : BOOL; st Building Sp Rm T : ST_BA_Sp Rm T; st Facade : ST_BA_Facade; st Scene : ST_BA_Sunbld; st Reference Feedback : ST_BA_Sunblind Actuator Feedback; END_VAR VAR_OUTPUT st Sun Bld Out : ST_BA_Sun Bld; END_VAR VAR_INPUT CONSTANT PERSISTENT b Th Auto Slcn : BOOL; f Th Auto Col Pos : REAL; f Th Auto Col Angl : REAL; b Sun Prtc Slcn : BOOL; b Twi Lgt Auto Slcn : BOOL; f Twi Lgt Auto Pos : REAL; f Twi Lgt Auto Angl : REAL; n Swi Over Ti : UDINT; END_VAR VAR_INPUT CONSTANT Man Swi : FB_BA_Sun Bld Swi := (e Prio:= E_BA_Sun Bld Prio.e Manual Group); Th Auto : FB_BA_Sun Bld Evt := (e Prio:= E_BA_Sun Bld Prio.e Group Thermo Auto); Sun Prtc : FB_BA_Sun Bld Evt := (e Prio:= E_BA_Sun Bld Prio.e Sun Protection); Twi Lgt Auto : FB_BA_Sun Bld Evt := (e Prio:= E_BA_Sun Bld Prio.e Group Twi Light Auto); END_VAR VAR Th Auto Swi : FB_BA_Swi2P; Prio Swi : FB_BA_Sun Bld Tgm Sel8; En Sun Bld Swi : SR; END_VAR Inputs Name Type Description f Roomtemp Sen REAL Room temperature sensor [°C]. b Prc Detc BOOL Presence detection. b Swi Up BOOL Local push button "up". b Swi Dwn BOOL Local push button "down". b Rst Man Fnct BOOL Input for resetting all internal manual functions, both those via the inputs b Swi Up/b Swi Dwn, and external control (e.g. HMI). st Building Sp Rm T ST_BA_Sp Rm T [} 272] Structure of room setpoints (Protection Cooling.. Comfort Cooling and Protection Heating ... Comfort Heating). st Facade ST_BA_Facade [} 704] Facade-specific blind data and telegrams. st Scene ST_BA_Sunbld [} 274] Reserved telegram input for scene control. st Reference Feedbac ST_BA_Sunblind Actuator F Feedback input of the controlled blind actuator or the k reference actuator of the controlled group. eedback [} 701] Outputs Name Type Description st Sun Bld Out ST_BA_Sun Bld [} 274] resulting zone telegram. TF8040 Version: 1.14.0 967
## Page 968

Programming Inputs CONSTANT PERSISTENT Name Type Description b Th Auto Slcn BOOL Thermal automatic enable. f Th Auto Col Pos REAL Thermal automatic cooling position [%]. f Th Auto Col Angl REAL Thermal automatic cooling angle [°]. b Sun Prtc Slcn BOOL Shading automatic enable. b Twi Lgt Auto Slcn BOOL Twilight automatic enable. f Twi Lgt Auto Pos REAL Twilight automatic position [%]. f Twi Lgt Auto Angl REAL Twilight automatic position [°]. n Swi Over Ti UDINT Changeover time [ms] of the manual switch Sun Bld Swi for latching. Inputs CONSTANT Name Type Description Man Swi FB_BA_Sun Bld Swi [} 388] Group (zone) push button block. Th Auto FB_BA_Sun Bld Evt [} 378] Telegram block for group (zone) thermal automatic. Sun Prtc FB_BA_Sun Bld Evt [} 378] Telegram block for group (zone) shading automatic. Twi Lgt Auto FB_BA_Sun Bld Evt [} 378] Telegram block for group (zone) twilight automatic. VAR Name Type Description Th Auto Swi FB_BA_Swi2P Hysteresis block for heating/cooling changeover for group (zone) thermal automatic. Prio Swi FB_BA_Sun Bld Tgm Sel8 Selection of the resulting telegram. [} 391] En Sun Bld Swi SR Activation memory of the above mentioned function block. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.6.2 Actuators 6.1.4.2.1.4.6.2.1 FB_BA_Rol Bld This template is used to control a blind actuator without slat adjustment. The resulting diagram from the zone st Sun Bld Cmd is routed via a drive delay FB_BA_Sun Bld Pos Dly [} 381]. 968 Version: 1.14.0 TF8040
## Page 969

Programming This delays all automatic telegrams and is intended to ensure that, in the event of global control of blinds (e.g. fire alarm), not all blinds move at the same time and thus the breakaway starting current of the motors remains limited. The current blind position is made available in BACnet via an analog object FB_BA_AV_Op [} 202]. The template has a feedback structure st Feedback [} 701] at the output. If the programmed blind actuator is an individual actuator or the reference actuator of a group, this feedback telegram must be linked to the controlling room (zone) user function in order to obtain information about the state of the actuator. The initialization of the template takes place within the method FB_Init. Syntax FUNCTION_BLOCK FB_BA_Rol Bld EXTENDS FB_BA_View VAR_INPUT b En : BOOL; st Sun Bld Cmd : ST_BA_Sun Bld; END_VAR VAR_OUTPUT b Referencing : BOOL; n Reference Timer : UDINT; b Err : BOOL; f Actual Position : REAL; e Actual Sunblind Prio : BYTE; st Feedback : ST_BA_Sunblind Actuator Feedback; END_VAR VAR_INPUT CONSTANT PERSISTENT n Swi Over Ti : UDINT; n Positioning Delay : UDINT; n Ti Up : UDINT; n Ti Dwn : UDINT; END_VAR VAR_INPUT CONSTANT Actual Position : FB_BA_AV_Op; END_VAR VAR Positioning Delay : FB_BA_Sun Bld Pos Dly; Rol Bld Actr : FB_BA_Rol Bld Actr; b Cmd Up AT %Q* : BOOL; b Cmd Down AT %Q* : BOOL; END_VAR Inputs Name Type Description b En BOOL Enable the function block function. st Sun Bld Cmd ST_BA_Sun Bld [} 274] Resulting telegram from the higher-level zone (room). Outputs Name Type Description b Referencing BOOL Blind is being referenced. n Reference Timer UDINT Elapsed referencing time [s]. b Err BOOL The internal function block FB_BA_Rol Bld Actr is parameterized incorrectly. f Actual Position REAL Current position (calculated). e Actual Sunblind Prio BYTE Current priority with which the blind actuator is controlled. st Feedback ST_BA_Sunblind Actuator F Feedback telegram for linking to the controlling room (zone) user function. In this way, information about the eedback [} 701] state of the blind actuator is fed back to the user function. TF8040 Version: 1.14.0 969
## Page 970

Programming Inputs CONSTANT PERSISTENT Name Type Description n Swi Over Ti UDINT Changeover time [ms] of the manual switch Sun Bld Swi for latching. n Positioning Delay UDINT Transmission delay of the zone telegrams [ms] to distribute and limit breakaway starting currents in time. n Ti Up UDINT Complete time for driving up [ms]. n Ti Dwn UDINT Complete time for driving down [ms]. Inputs CONSTANT Name Type Description Actual Position FB_BA_AV_Op [} 202] Function block for displaying the position [%] in BACnet. Variables Name Type Description Positioning Delay FB_BA_Sun Bld Pos Dly Delay of telegrams from the zone (group) to avoid high breakaway starting currents due to simultaneity. [} 381] Rol Bld Actr FB_BA_Rol Bld Actr [} 365] Function block for controlling a blind without slat adjustment. b Cmd Up BOOL Output variable command "up". b Cmd Down BOOL Output variable command "down". Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.6.2.2 FB_BA_Sun Bld This template is used to control a blind actuator with slat adjustment. The resulting diagram from the zone st Sun Bld Cmd is routed via a drive delay FB_BA_Sun Bld Pos Dly [} 381]. This delays all automatic telegrams and is intended to ensure that, in the event of global control of blinds (e.g. fire alarm), not all blinds move at the same time and thus the breakaway starting current of the motors remains limited. The current blind position and the current angle are made available in BACnet via two analog objects FB_BA_AV_Op [} 202]. The template has a feedback structure st Feedback [} 701] at the output. 970 Version: 1.14.0 TF8040
## Page 971

Programming If the programmed blind actuator is an individual actuator or the reference actuator of a group, this feedback telegram must be linked to the controlling room (zone) user function in order to obtain information about the state of the actuator. The initialization of the template takes place within the method FB_Init. Syntax FUNCTION_BLOCK FB_BA_Sun Bld EXTENDS FB_BA_View VAR_INPUT b En : BOOL; st Sun Bld Cmd : ST_BA_Sun Bld; END_VAR VAR_OUTPUT b Referencing : BOOL; n Reference Timer : UDINT; b Err : BOOL; f Actual Position : REAL; f Actual Angle : REAL; e Actual Sunblind Prio : BYTE; st Feedback : ST_BA_Sunblind Actuator Feedback; END_VAR VAR_INPUT CONSTANT PERSISTENT n Swi Over Ti : UDINT; n Positioning Delay : UDINT; n Ti Up : UDINT; n Ti Dwn : UDINT; n Turn Ti Up : UDINT; n Turn Ti Dwn : UDINT; n Bck Lsh Ti Up : UDINT; n Bck Lsh Ti Dwn : UDINT; f Angl Lmt Up : REAL; f Angl Lmt Dwn : REAL; END_VAR VAR_INPUT CONSTANT Actual Position : FB_BA_AV_Op; Actual Angle : FB_BA_AV_Op; END_VAR VAR Positioning Dly : FB_BA_Sun Bld Pos Dly; Sun Bld Actr : FB_BA_Sun Bld Actr; b Cmd Up AT %Q* : BOOL; b Cmd Down AT %Q* : BOOL; END_VAR Inputs Name Type Description b En BOOL Enable the function block function. st Sun Bld Cmd ST_BA_Sun Bld [} 274] Resulting telegram from the higher-level zone (room). Outputs Name Type Description b Referencing BOOL Blind is being referenced. n Reference Timer UDINT Elapsed referencing time [s]. b Err BOOL The internal function block FB_BA_Sun Bld Actr is parameterized incorrectly. f Actual Position REAL Current position (calculated). f Actual Angle REAL Current angle (calculated). e Actual Sunblind Prio BYTE Current priority with which the blind actuator is controlled. st Feedback ST_BA_Sunblind Actuator F Feedback telegram for linking to the controlling room (zone) user function. In this way, information about the eedback [} 701] state of the blind actuator is fed back to the user function. TF8040 Version: 1.14.0 971
## Page 972

Programming Inputs CONSTANT PERSISTENT Name Type Description n Swi Over Ti UDINT Changeover time [ms] of the manual switch Sun Bld Swi for latching. n Positioning Delay UDINT Transmission delay of the zone telegrams [ms] to distribute and limit breakaway starting currents in time. n Ti Up UDINT Complete time for driving up [ms]. n Ti Dwn UDINT Complete time for driving down [ms]. n Turn Ti Up UDINT Time for turning the slats in the upward direction [ms]. n Turn Ti Dwn UDINT Time for turning the slats in the downward direction [ms]. n Bck Lsh Ti Up UDINT Time to traverse the backlash in the upward direction [ms]. n Bck Lsh Ti Dwn UDINT Time to traverse the backlash in the downward direction [ms]. f Angl Lmt Up REAL Highest position of the slats [°]. f Angl Lmt Dwn REAL Lowest position of the slats [°]. This position is reached once the blind has moved to the bottom position. Inputs CONSTANT Name Type Description Actual Position FB_BA_AV_Op [} 202] Function block for displaying the position [%] in BACnet. Actual Angle FB_BA_AV_Op [} 202] Function block for displaying the angle [°] in BACnet. Variables Name Type Description Positioning Delay FB_BA_Sun Bld Pos Dly Delay of telegrams from the zone (group) to avoid high breakaway starting currents due to simultaneity. [} 381] Sun Bld Actr FB_BA_Sun Bld Actr [} 374] Function block for controlling a blind. b Cmd Up BOOL Output variable command "up". b Cmd Down BOOL Output variable command "down". Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.4.7 FB_BA_Room Automation Client Call template trade "Room automation" - client version. This template at the "trade" level calls up all sub-templates whose data is ideally prepared in a floor computer. On the one hand, this is data to be assigned to the "room automation" trade, which is transmitted and read by a building computer (FB_BA_Ads Com Client_Room [} 887]), and on the other hand, this template contains the calls of all rooms. 972 Version: 1.14.0 TF8040
## Page 973

Programming The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Room Automation Client EXTENDS FB_BA_View VAR_INPUT CONSTANT Ads Com Client Room : FB_BA_Ads Com Client_Room; Sample Room : FB_BA_Room Sample1; END_VAR VAR_INPUT CONSTANT Name Type Description Ads Com Client Room FB_BA_Ads Com Client_Roo The sub-template has the task of reading data and parameters sent from other computers, ideally from the m [} 887] building computer. Sample Room FB_BA_Room Sample1 The sub-template represents an example room with shading, illumination and air conditioning. This room has a [} 931] shaded area within a facade whose data it receives via site.arr Facade[2]. In terms of lighting, the room is assigned to area 1, which is expressed by the receipt of site.arr Area Lighting[1]. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.4.8 FB_BA_Room Automation Server Call template trade "Room automation" - server version. TF8040 Version: 1.14.0 973
## Page 974

Programming This template at the "trade" level calls up all sub-templates whose data is ideally processed in a building calculator. In addition, room automation-specific data is made available building-wide via an ADS server template. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Room Automation Server EXTENDS FB_BA_View VAR_INPUT CONSTANT Ads Com Server Room : FB_BA_Ads Com Server_Room; Building Data : FB_BA_Building Data; END_VAR VAR_INPUT CONSTANT Name Type Description Ads Com Server Roo FB_BA_Ads Com Server_Ro The sub-template has the task of transmitting data and m parameters within the BA network. om [} 888] Building Data FB_BA_Building Data The sub-template calls up further templates that provide building-wide data and operation modes. [} 858] Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 974 Version: 1.14.0 TF8040
## Page 975

Programming 6.1.4.2.1.5 Heating System 6.1.4.2.1.5.1 Distribution 6.1.4.2.1.5.1.1 FB_BA_H_Htg Cir01 Template is used to program a static heating circuit. The main components of the template are: • Flow temperature control. • Heating curve dependent on outside temperature with night setback. • Operation mode selection. • Control of the heating circuit pump. • Control of an analog control valve. The initialization of the template takes place within the method FB_Init. Syntax FUNCTION_BLOCK FB_BA_H_Htg Cir01 EXTENDS FB_BA_View VAR_OUTPUT e Op Mod : E_BA_Energy Lvl; b Rls : BOOL; f Sp : REAL; b Pu : BOOL; f Vlv : REAL; END_VAR VAR_INPUT CONSTANT TFl : FB_BA_Sensor Analog_Raw; TRt : FB_BA_Sensor Analog_Raw; Vlv : FB_BA_Vlv; Pu : FB_BA_Pu1st; Sp : FB_BA_H_Htg Cir_Sp; Op Mod : FB_BA_H_Op Mod; Htg Lmt : FB_BA_Htg Lmt; TFl Ctrl : FB_BA_PID; Plant Lock : FB_BA_Plant Lock; END_VAR Outputs Name Type Description e Op Mod E_BA_Energy Lvl [} 700] Operation mode of the heating circuit. b Rls BOOL The variable indicates that the heating circuit is in operation. f Sp REAL Calculated setpoint of the heating characteristic curve. b Pu BOOL Enable the heating circuit pump. f Vlv REAL Calculated control value for the valve. TF8040 Version: 1.14.0 975
## Page 976

Programming Inputs CONSTANT Name Type Description TFl FB_BA_Sensor Analog The function block represents the flow temperature. [} 1087] TRt FB_BA_Sensor Analog The function block represents the return temperature. [} 1087] Vlv FB_BA_Vlv [} 1092] Control valve Pu FB_BA_Pu1st [} 1074] Heating circuit pump Sp FB_BA_H_Htg Cir_Sp The function block calculates the setpoint of the flow temperature depending on the outside temperature. Op Mod FB_BA_H_Op Mod Operation mode selection of the heating circuit (day, night, protection mode). Htg Lmt FB_BA_Htg Lmt The function block enables heating operation below a heating limit temperature. TFl Ctrl FB_BA_PID [} 1037] Return temperature sensor Plant Lock FB_BA_Plant Lock [} 135] When the function block is called, the relevant faults of the event-enabled objects are collected and output at this and lower levels of the heating circuit. These relevant faults trigger the operation mode "Fault". This switches the heating circuit to "Protection" mode. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.1.6 Doors Gates Windows Sun Protection 6.1.4.2.1.6.1 FB_BA_DGWSPServer Call template trade "Doors, gates, windows, sun protection" - server version. This template at the "trade" level calls up all sub-templates whose data is ideally processed in a building calculator. On the one hand, these are general data for the sun protection, as well as the data for all facades. In addition, trade-specific data is made available building-wide via an ADS server template. The initialization of the template takes place within the method FB_Init. 976 Version: 1.14.0 TF8040
## Page 977

Programming Block diagram TF8040 Version: 1.14.0 977
## Page 978

Programming Syntax FUNCTION_BLOCK FB_BA_DGWSPServer EXTENDS FB_BA_View VAR_INPUT CONSTANT Ads Com Server DGWS : FB_BA_Ads Com Server_DGWS; Building Sun Protection : FB_BA_Building Sunprotection; arr Facade : ARRAY[1.. BA2_Param.n Max Number Of Facades] OF FB_BA_Facade; END_VAR VAR_INPUT CONSTANT Name Type Description Ads Com Server DGW FB_BA_Ads Com Server_DG The sub-template has the task of transmitting data and S parameters within the BA network. WS [} 980] Building Sun Protectio FB_BA_Building Sunprotect The sub-template provides building-wide data and n operation modes. ion [} 937] arr Facade FB_BA_Facade [} 940] These templates of type FB_BA_Facade compile the sun protection telegrams that are valid for an entire facade. In the global parameter list BA2_Param [} 1118], 4 facades are predefined with n Max Number Of Facades, which are initialized here in FB_Init to north, east, south and west as examples. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.6.2 FB_BA_DGWSPClient Call template trade "Doors, gates, windows, sun protection" - client version. This template at the "trade" level calls up all sub-templates whose data is ideally prepared in a floor computer. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_DGWSPClient EXTENDS FB_BA_View VAR_INPUT CONSTANT Ads Com Client DGWS : FB_BA_Ads Com Client_DGWS; END_VAR 978 Version: 1.14.0 TF8040
## Page 979

Programming VAR_INPUT CONSTANT Name Type Description Ads Com Client DGW FB_BA_Ads Com Client_DG The sub-template has the task of reading data and S parameters sent from other computers, ideally from the WS [} 979] building computer. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.6.3 Communication 6.1.4.2.1.6.3.1 FB_BA_Ads Com Client_DGWS The template reads global data that is assigned to the "Doors, gates, windows, sun protection" trade from another controller that provides this data with the counter-block FB_BA_Ads Com Server_DGWS [} 980]. The information read is copied to the global variable list Site [} 1116]. The initialization of the template takes place within the method FB_Init. Block diagram TF8040 Version: 1.14.0 979
## Page 980

Programming Syntax FUNCTION_BLOCK FB_BA_Ads Com Client EXTENDS FB_BA_View VAR_INPUT CONSTANT Building Sun Blind : FB_BA_Raw Subscriber; Building Sun Blind Error : FB_BA_BV_Error State; arr Facade : ARRAY[1.. BA2_Param.n Max Number Of Facades] OF FB_BA_Facade Subscr; arr Facade Error : ARRAY[1.. BA2_Param.n Max Number Of Facades] OF FB_BA_BV_Error State; END_VAR VAR_INPUT CONSTANT Name Type Description Building Sun Blind FB_BA_Raw Subscriber The subscriber accesses the Twin CAT network structure Building Sun Blind and saves the data in the created [} 158] structure st Building Sun Blind of the GVL Site [} 1116]. Building Sun Blind Err FB_BA_BV_Error State Binary object indicating communication failure of the or subscriber Building Sun Blind. [} 1030] arr Facade FB_BA_Facade Subscr These templates receive the facade data that has been [} 945] defined or made available elsewhere via an FB_BA_Facade [} 940]. In the global parameter list BA2_Param [} 1118], 4 facades are predefined with n Max Number Of Facades, which are initialized here in FB_Init verbally to north, east, south and west. arr Facade Error FB_BA_BV_Error State Binary objects indicating communication failure of the facade subscriber. [} 1030] Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.1.6.3.2 FB_BA_Ads Com Server_DGWS The template has the task of reading data and parameters that are assigned to the "Doors, gates, windows, sun protection" trade from the global variable list Site [} 1116] and making them available within the BA network via FB_BA_Raw Publisher [} 139]. The counter-block that receives this data as a client is FB_BA_Ads Com Client_DGWS [} 979]. 980 Version: 1.14.0 TF8040
## Page 981

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Ads Com Server VAR_INPUT CONSTANT Building Sun Blind : FB_BA_Raw Publisher; arr Facade Data : ARRAY[1.. BA2_Param.n Max Number Of Facades] OF FB_BA_Raw Publisher; END_VAR VAR_INPUT CONSTANT Name Type Description Building Sun Blind FB_BA_Raw Publisher The publisher publishes the structure of the building-wide [} 139] sun protection data Site.st Building Sun Blind [} 1116], which is generated in the template FB_BA_Building Sunprotection [} 937]. arr Facade Data FB_BA_Raw Publisher The publishers arr Facade Data[1..4] publish the structures [} 139] of the building-wide valid shading data site.arr Facade[1..4] [} 1116], which is generated in the instances of the template FB_BA_Facade [} 940]. The number of facade instances depends on the building floor plan. The facade number "4" has been used here as typical. Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.2 Universal Templates for universal use in various building functions. TF8040 Version: 1.14.0 981
## Page 982

Programming 6.1.4.2.2.1 Aggregates 6.1.4.2.2.1.1 Analog 6.1.4.2.2.1.1.1 FB_BA_Actuator Analog The template is used to control analog aggregates. It essentially consists of an AO object for controlling an aggregate and the function block Plant Lock, which collects all safety-relevant faults. The initialization of the template takes place within the method FB_Init. Block diagram 982 Version: 1.14.0 TF8040
## Page 983

Programming Syntax FUNCTION_BLOCK FB_BA_Actuator Analog EXTENDS FB_BA_View VAR_INPUT st Cmd : ST_BA_Analog; END_VAR VAR_OUTPUT f Mdlt : REAL; b Dst : BOOL; e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT Mdlt : FB_BA_AO_Raw; Plant Lock : FB_BA_Plant Lock; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; END_VAR Inputs Name Type Description st Cmd ST_BA_Analog [} 276] The enables and switching values are transmitted to the template via the command structure st Cmd . The command with the highest priority is output at the analog output object Mdlt. Outputs Name Type Description f Mdlt REAL Current value of the analog output object. b Dst BOOL The variable is an evaluation of the lock priorities "Safety" and "Critical" of the project structure and indicates a triggered event. e Active Prio E_BA_Priority [} 110] Display of the active priority. Inputs CONSTANT Name Type Description Mdlt FB_BA_AO_Raw [} 199] Current value of the analog output object. Plant Lock FB_BA_Plant Lock [} 135] The function block Plant Lock collects all safety-relevant faults at this level of the project structure and triggers switching commands in the template accordingly. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the project structure. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the project structure. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 TF8040 Version: 1.14.0 983
## Page 984

Programming 6.1.4.2.2.1.1.2 FB_BA_Actuator AV The template is used to control analog aggregates. It essentially consists of an AV object for controlling an aggregate and the Plant Lock function block, which collects all safety-relevant faults. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Actuator AV EXTENDS FB_BA_View VAR_INPUT st Cmd : ST_BA_Analog; END_VAR VAR_OUTPUT f Present Value : REAL; b Dst : BOOL; e Active Prio : E_BA_Priority; END_VAR 984 Version: 1.14.0 TF8040
## Page 985

Programming VAR_INPUT CONSTANT Val : FB_BA_AV; Plant Lock : FB_BA_Plant Lock; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; END_VAR Inputs Name Type Description st Cmd ST_BA_Analog [} 276] The enables and switching values are transmitted to the template via the command structure st Cmd . The command with the highest priority is output at the analog value object Val. Outputs Name Type Description f Present Value REAL Current value of the analog value object. b Dst BOOL The variable is an evaluation of the lock priorities "Safety" and "Critical" of the project structure and indicates a triggered event. e Active Prio E_BA_Priority [} 110] Display of the active priority. Inputs CONSTANT Name Type Description Val FB_BA_AV [} 200] The analog value object determines the current control value. Plant Lock FB_BA_Plant Lock [} 135] The function block Plant Lock collects all safety-relevant faults at this level of the project structure and triggers switching commands in the template accordingly. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the project structure. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the project structure. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 985
## Page 986

Programming 6.1.4.2.2.1.2 Binary 6.1.4.2.2.1.2.1 FB_BA_Actuator Cmd The template is used to control binary aggregates. It essentially consists of a BO object for controlling an aggregate and the function block Plant Lock, which collects all safety-relevant faults. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Actuator Analog EXTENDS FB_BA_View VAR_INPUT st Cmd : ST_BA_Binary; 986 Version: 1.14.0 TF8040
## Page 987

Programming END_VAR VAR_OUTPUT b Cmd : BOOL; b Dst : BOOL; e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT Cmd : FB_BA_BO_Raw; Plant Lock : FB_BA_Plant Lock; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; END_VAR Inputs Name Type Description st Cmd ST_BA_Binary [} 277] The enables and switching values are transmitted to the template via the command structure st Cmd . The command with the highest priority is output at the binary output object Cmd. Outputs Name Type Description b Cmd BOOL Current value of the binary output object. b Dst BOOL The variable is an evaluation of the lock priorities "Safety" and "Critical" of the project structure and indicates a triggered event. e Active Prio E_BA_Priority [} 110] Display of the active priority. Inputs CONSTANT Name Type Description Cmd FB_BA_BO_Raw [} 211] The binary output object is used to output a switching command and transmit it to the I/O level. Plant Lock FB_BA_Plant Lock [} 135] The function block Plant Lock collects all safety-relevant faults at this level of the project structure and triggers switching commands in the template accordingly. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the project structure. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the project structure. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 987
## Page 988

Programming 6.1.4.2.2.1.3 Modulation 6.1.4.2.2.1.3.1 FB_BA_Actuator Mdlt The template is used to control modulating aggregates. It essentially consists of an AO object for controlling an aggregate, the priority switch Prio Swi Val for determining the modulation command, the multiplexer Mux Mdlt for determining the control value and the function block Plant Lock, which collects all safety-related faults. The initialization of the template takes place within the method FB_Init. 988 Version: 1.14.0 TF8040
## Page 989

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Actuator Mdlt EXTENDS FB_BA_View VAR_INPUT st Cmd : ST_BA_Mdlt; f Val Pgm : REAL; END_VAR TF8040 Version: 1.14.0 989
## Page 990

Programming VAR_OUTPUT f Mdlt : REAL; b Dst : BOOL; e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Category' := 'Behaviour'} f Min Modulation : REAL := 20; {attribute 'parameter Category' := 'Behaviour'} f Max Modulation : REAL := 100; END_VAR VAR_INPUT CONSTANT Mdlt : FB_BA_AO_Raw; Plant Lock : FB_BA_Plant Lock; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; Prio Swi Val : FB_BA_Prio Swi_UDI04; Mux Mdlt : FB_BA_MMUX_R04; END_VAR Inputs Name Type Description st Cmd ST_BA_Mdlt [} 276] The enables and modulation commands are transmitted to the template via the command structure st Cmd. The command with the highest priority determines the switching command at the binary output object Cmd and the control command at the analog output object Mdlt. f Val Pgm REAL The control signal for modulation command E_BA_Mdlt Cmd.e On is transmitted to the template via the input variable f Val Pgm. Outputs Name Type Description f Mdlt REAL Current value of the analog output object. b Dst BOOL The variable is an evaluation of the lock priorities "Safety" and "Critical" of the project structure and indicates a triggered event. e Active Prio E_BA_Priority [} 110] Display of the active priority. Inputs CONSTANT PERSISTENT Name Type Description f Min Modulation REAL Constant minimum value when modulation command E_BA_Mdlt Cmd.e Min is pending. f Max Modulation REAL Constant maximum value when modulation command E_BA_Mdlt Cmd.e Max is pending. Inputs CONSTANT Name Type Description Mdlt FB_BA_AO_Raw [} 199] Current value of the analog output object. Plant Lock FB_BA_Plant Lock [} 135] The function block Plant Lock collects all safety-relevant faults at this level of the project structure and triggers switching commands in the template accordingly. 990 Version: 1.14.0 TF8040
## Page 991

Programming Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the project structure. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the project structure. b Prio Swi Val FB_BA_Prio Swi_UDI04 The priority switch Prio Swi Val [} 433] uses the command [} 433] structure st Cmd to determine the modulation command for the multiplexers Mux Cmd and Mux Mdlt. Mux Mdlt FB_BA_MMUX_R04 [} 428] The multiplexer Mux Mdlt [} 428] determines the current control value from the modulation values f Val Pgm, f Min Modulation and f Max Modulation and the modulation command of the priority switch Prio Swi Val. The result is sent to the analog output object Mdlt. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.1.4 Multistate 6.1.4.2.2.1.4.1 FB_BA_Actuator MO The template is used to control multi-stage aggregates. It essentially consists of an MO object for controlling an aggregate and the function block Plant Lock, which collects all safety-relevant faults. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 991
## Page 992

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Actuator MO EXTENDS FB_BA_View VAR_INPUT st Cmd : ST_BA_Multistate; END_VAR VAR_OUTPUT n Cmd : UDINT; b Dst : BOOL; e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT Cmd : FB_BA_MO; Plant Lock : FB_BA_Plant Lock; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; END_VAR 992 Version: 1.14.0 TF8040
## Page 993

Programming Inputs Name Type Description st Cmd ST_BA_Multistate [} 275] The enables and switching values are transmitted to the template via the command structure st Cmd . The command with the highest priority is output at the multistate output object Cmd. Outputs Name Type Description n Cmd UDINT Current switch value of the multistate output object. b Dst BOOL The variable is an evaluation of the lock priorities "Safety" and "Critical" of the project structure and indicates a triggered event. e Active Prio E_BA_Priority [} 110] Display of the active priority. Inputs CONSTANT Name Type Description Cmd FB_BA_MO [} 232] The multistate output object is used to output the current switch value. Plant Lock FB_BA_Plant Lock [} 135] The function block Plant Lock collects all safety-relevant faults at this level of the project structure and triggers switching commands in the template accordingly. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the project structure. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the project structure. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.1.4.2 FB_BA_Actuator Multistate The template is used to control multi-stage aggregates. It essentially consists of an MO object for controlling an aggregate and the function block Plant Lock, which collects all safety-relevant faults. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 993
## Page 994

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Actuator Multistate EXTENDS FB_BA_View VAR_INPUT st Cmd : ST_BA_Multistate; END_VAR VAR_OUTPUT n Cmd : UDINT; b Dst : BOOL; e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT Cmd : FB_BA_MO_Raw; Plant Lock : FB_BA_Plant Lock; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; END_VAR 994 Version: 1.14.0 TF8040
## Page 995

Programming Inputs Name Type Description st Cmd ST_BA_Multistate [} 275] The enables and switching values are transmitted to the template via the command structure st Cmd . The command with the highest priority is output at the multistate output object Cmd. Outputs Name Type Description n Cmd UDINT Current switch value of the multistate output object. b Dst BOOL The variable is an evaluation of the lock priorities "Safety" and "Critical" of the project structure and indicates a triggered event. e Active Prio E_BA_Priority [} 110] Display of the active priority. Inputs CONSTANT Name Type Description Cmd FB_BA_MO_Raw [} 235] The multistate output object is used to output the current switch value. Plant Lock FB_BA_Plant Lock [} 135] The function block Plant Lock collects all safety-relevant faults at this level of the project structure and triggers switching commands in the template accordingly. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the project structure. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the project structure. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2 Control Templates for presence monitoring and scaling. 6.1.4.2.2.2.1 Analog3Point 6.1.4.2.2.2.1.1 FB_BA_Analog3Pnt The template converts a continuous control signal for the positioning of a 3-point actuator into the binary switching commands Open/Close. TF8040 Version: 1.14.0 995
## Page 996

Programming The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Analog3Pnt EXTENDS FB_BA_View VAR_INPUT f Val Pgm : REAL; END_VAR VAR_OUTPUT b Opn : BOOL; b Cls : BOOL; END_VAR VAR_INPUT CONSTANT Hys Pos : FB_BA_AV_Op; Ti Opn : FB_BA_AV_Op; Ti Cls : FB_BA_AV_Op; Pos : FB_BA_AV_Op; END_VAR VAR Anlg3Pnt : FB_BA_Anlg3Pnt; END_VAR Inputs Name Type Description f Val Pgm REAL Control value for the position of the actuator. 996 Version: 1.14.0 TF8040
## Page 997

Programming Outputs Name Type Description b Opn BOOL Output for opening the actuator. b Cls BOOL Output for closing the actuator. Inputs CONSTANT Name Type Description Hys Pos FB_BA_AV_Op [} 202] AV object for entering the hysteresis value to start the position change. Ti Opn FB_BA_AV_Op [} 202] AV object for entering the opening time value. Ti Cls FB_BA_AV_Op [} 202] AV object for entering the closing time value. Pos FB_BA_AV_Op [} 202] Display of the calculated position. VAR Name Type Description Anlg3Pnt FB_BA_Anlg3Pnt [} 407] The function block is the core of the template and intended for controlling the three-point actuator. It converts an analog positioning signal into the binary open/close commands. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.2 Anti Blocking 6.1.4.2.2.2.2.1 FB_BA_Anti Blocking The template prevents blocking of pumps or actuators after prolonged idle periods by issuing a switch-on pulse. A pulse output generally only occurs if the function block FB_BA_Ant Blkg is enabled at b En. The maximum idle period before such a pulse is issued is determined by the value of the variable n Off Min. For logging the idle time, the input b Fdb must be linked to the operating feedback from the aggregate. The length of the pulse is parameterized with the variable n Impl Lngt. For this function the operation mode E_BA_Ant Blkg Mode.e Off Time must be set (see E_BA_Ant Blkg Mode). The input b Ext Req should be used if the anti-blocking protection pulse is to be issued cyclically based on a schedule, rather than depending on the idle times. A rising edge at b Ext Req immediately triggers output of a pulse to b Q. For this function the operation mode E_BA_Ant Blkg Mode.e External Request must be set (see E_BA_Ant Blkg Mode). The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 997
## Page 998

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Ant Blkg EXTENDS FB_BA_View VAR_INPUT b Fdb : BOOL; b Ext Req : BOOL; b Lock : BOOL; END_VAR VAR_OUTPUT b Q : BOOL; END_VAR VAR_INPUT CONSTANT Idle Prd : FB_BA_AV_Op; Impulse Length : FB_BA_AV_Op; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Category':='Operation'} b En : BOOL := TRUE; END_VAR VAR Ablk Fnct : FB_BA_Ant Blkg; ton En : TON; END_VAR 998 Version: 1.14.0 TF8040
## Page 999

Programming Inputs Name Type Description b Fdb BOOL Input for connecting the feedback signal of a motor or valve. This input is only considered in the operation mode E_BA_Ant Blkg Mode.e Off Time. b Ext Req BOOL Active in the E_BA_Ant Blkg Mode.e External Request operation mode. External request for a pulse, for example from a schedule. With a rising edge the anti-blocking protection pulse is started. b Lock BOOL Active in the operation modes E_BA_Ant Blkg Mode.e External Request or E_BA_Ant Blkg Mode.e Off Time. To prevent that e.g. the pump and the valve of a heater get a pulse at the same time, the output of the pulse is always suppressed until b Lock is FALSE again. If b Lock becomes TRUE during the output of an anti- blocking protection pulse, then the anti-blocking protection pulse is interrupted. After b Lock is FALSE again, the anti- lock protection pulse is restarted. Outputs Name Type Description b Q BOOL Output of the anti-lock protection pulse. Inputs CONSTANT Name Type Description Idle Prd FB_BA_AV_Op [} 202] AV object for input of the maximum pump standstill duration until an anti-blocking protection pulse is issued. Impulse Length FB_BA_AV_Op [} 202] A rising edge at this input switches the output value f Out to the input value f In. Inputs CONSTANT PERSISTENT Name Type Description b En BOOL General enable of the template. If b En is FALSE, the message output b Q is also FALSE. Variables Name Type Description b Ablk Fnct FB_BA_Ant Blkg [} 409] The function block Ablk Fnct for the output of an anti- blocking protection pulse is the core of this template. ton En TON Start-up delay of the function after the controller has started up. TF8040 Version: 1.14.0 999
## Page 1000

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.3 Continuous Steps 6.1.4.2.2.2.3.1 FB_BA_Cont4Steps The template determines the resulting control steps of a 4-level aggregate, depending on the continuous input signal f In. The initialization of the template takes place within the method FB_Init. 1000 Version: 1.14.0 TF8040
## Page 1001

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Cont4Steps EXTENDS FB_BA_View VAR_INPUT b En : BOOL := TRUE; f In : REAL; END_VAR VAR_OUTPUT b Q01 : BOOL; b Q02 : BOOL; b Q03 : BOOL; b Q04 : BOOL; END_VAR VAR_INPUT CONSTANT Switch On01 : FB_BA_AV_Op; Switch On02 : FB_BA_AV_Op; Switch On03 : FB_BA_AV_Op; Switch On04 : FB_BA_AV_Op; Hys : FB_BA_AV_Op; Active Step : FB_BA_MV_Op; END_VAR VAR Cont Stp : FB_BA_Cont Stp; END_VAR TF8040 Version: 1.14.0 1001
## Page 1002

Programming Inputs Name Type Description b En BOOL General enable of the template. If b En is FALSE, all message outputs b Q0x are also FALSE. f In REAL Continuous input value from which the switching states are derived. Outputs Name Type Description b Q01 BOOL Shows status level 01 b Q02 BOOL Shows status level 02 b Q03 BOOL Shows status level 03 b Q04 BOOL Shows status level 04 Inputs CONSTANT Name Type Description Switch On01 FB_BA_AV_Op [} 202] AV object for entering the switch-on point step 01. Switch On02 FB_BA_AV_Op [} 202] AV object for entering the switch-on point step 02. Switch On03 FB_BA_AV_Op [} 202] AV object for entering the switch-on point step 03. Switch On04 FB_BA_AV_Op [} 202] AV object for entering the switch-on point step 04. Hys FB_BA_AV_Op [} 202] AV object for entering the hysteresis for the switch-on points. Active Step FB_BA_AV_Op [} 202] MV object for displaying how many steps are switched on. Variables Name Type Description Cont Stp FB_BA_Cont Stp [} 417] The function block determines the resulting control steps of a multi-stage aggregate depending on the continuous input signal f In and is the core of this template Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.4 Event Classes 6.1.4.2.2.2.4.1 FB_BA_Evt Category The template contains a Notification Class Object. Each BACnet object that is to generate messages by means of Intrinsic Reporting or Algorithmic Change Reporting must be assigned a Notification Class Object that contains the information for the distribution of the event messages. 1002 Version: 1.14.0 TF8040
## Page 1003

Programming The Notification Class Object defines which priorities are assigned to the event messages, whether the events require acknowledgement and which recipients should receive the messages. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Evt Category EXTENDS FB_BA_View VAR_INPUT CONSTANT EC : FB_BA_EC; END_VAR Inputs CONSTANT Name Type Description EC FB_BA_EC [} 218] Notification Class Object. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.5 Filter 6.1.4.2.2.2.5.1 FB_BA_Filter PT1 First order filter. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 1003
## Page 1004

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Filter PT1 EXTENDS FB_BA_View VAR_INPUT f In : REAL; b Sync : BOOL; END_VAR VAR_OUTPUT f Out : REAL; END_VAR VAR_INPUT CONSTANT Damping Constant : FB_BA_AV_Op; END_VAR VAR PT1 : FB_BA_Fltr PT1; END_VAR Inputs Name Type Description f In REAL Input signal. b Sync BOOL A rising edge at this input switches the output value f Out to the input value f In. Outputs Name Type Description f Out REAL Attenuated output signal. Inputs CONSTANT Name Type Description Damping Constant FB_BA_AV_Op [} 202] AV object for entering filter time constant. Variables Name Type Description PT1 FB_BA_Fltr PT1 Notification Class Object. 1004 Version: 1.14.0 TF8040
## Page 1005

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.6 Hysteresis 6.1.4.2.2.2.6.1 FB_BA_Hys_01 The template represents a hysteresis function with fixed switching points. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Hys_01 EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f In : REAL; END_VAR VAR_OUTPUT b Q : BOOL; b Dst : BOOL; END_VAR TF8040 Version: 1.14.0 1005
## Page 1006

Programming VAR_INPUT CONSTANT On : FB_BA_AV_Op; Off : FB_BA_AV_Op; Q : FB_BA_BV; END_VAR VAR Swi2P : FB_BA_Swi2P; END_VAR Inputs Name Type Description b En BOOL General enable of the function block. f In REAL Actual value Outputs Name Type Description b Q BOOL Output of the current state of the hysteresis function. b Dst BOOL Display of a fault or the BV object is active. b Dst is only active if the property b Event Detection Enable of the BV object was set to TRUE. The monitoring of the binary feedback indicates a fault. Inputs CONSTANT Name Type Description On FB_BA_AV_Op [} 202] AV object for input of the upper limit of the hysteresis function. Off FB_BA_AV_Op [} 202] AV object for input of the lower limit of the hysteresis function. Q FB_BA_BV [} 213] The binary object indicates the current state of the hysteresis function. Variables Name Type Description Swi2P FB_BA_Swi2P The function block Swi2P is the core of the hysteresis function. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.6.2 FB_BA_Hys_02 The template represents a sliding limit value monitoring with two switching points. 1006 Version: 1.14.0 TF8040
## Page 1007

Programming The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Hys_01 EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f In : REAL; f On : REAL; f Off : REAL; END_VAR VAR_OUTPUT b Q : BOOL; b Dst : BOOL; END_VAR VAR_INPUT CONSTANT On : FB_BA_AV_Op; Off : FB_BA_AV_Op; Q : FB_BA_BV; END_VAR VAR Swi2P : FB_BA_Swi2P; END_VAR Inputs Name Type Description b En BOOL General enable of the function block. f In REAL Actual value f On REAL Dynamic switch-on point f Off REAL Dynamic switch-off point TF8040 Version: 1.14.0 1007
## Page 1008

Programming Outputs Name Type Description b Q BOOL Output of the current state of the hysteresis function. b Dst BOOL Display of a fault or the BV object is active. b Dst is only active if the property b Event Detection Enable of the BV object was set to TRUE. The monitoring of the binary feedback indicates a fault. Inputs CONSTANT Name Type Description On FB_BA_AV_Op [} 202] AV object for input of the upper limit of the hysteresis function. Off FB_BA_AV_Op [} 202] AV object for input of the lower limit of the hysteresis function. Q FB_BA_BV [} 213] The binary object indicates the current state of the hysteresis function. Variables Name Type Description Swi2P FB_BA_Swi2P The function block Swi2P is the core of the hysteresis function. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.6.3 FB_BA_Hys_03 The template represents a sliding limit value monitoring with two switching points which, in contrast to FB_BA_Hys_02 [} 1006], are subject to switch-on and switch-off delays. The switch-on and switch-off thresholds as well as the time delays are entered via analog objects. The initialization of the template takes place within the method FB_Init. 1008 Version: 1.14.0 TF8040
## Page 1009

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Hys_03 EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f In : REAL; END_VAR VAR_OUTPUT b Present Value : BOOL; b Event : BOOL; END_VAR VAR_INPUT CONSTANT On : FB_BA_AV_Op; Off : FB_BA_AV_Op; Dly On : FB_BA_AV_Op; Dly Off : FB_BA_AV_Op; Q : FB_BA_BV; END_VAR VAR Swi2P : FB_BA_Swi2P; END_VAR Inputs Name Type Description b En BOOL General enable of the function block. f In REAL Process value TF8040 Version: 1.14.0 1009
## Page 1010

Programming Outputs Name Type Description b Present Value BOOL Output of the current state of the hysteresis function. b Event BOOL Display of a fault or the BV object is active. b Event is only active if the property b Event Detection Enable of the BV object was set to TRUE. The monitoring of the binary feedback indicates a fault. Inputs CONSTANT Name Type Description On FB_BA_AV_Op [} 202] AV object for input of the upper limit of the hysteresis function. Off FB_BA_AV_Op [} 202] AV object for input of the lower limit of the hysteresis function. Dly On FB_BA_AV_Op [} 202] AV object for entering the switch-on delay in seconds. Dly Off FB_BA_AV_Op [} 202] AV object for entering the switch-off delay in seconds. Q FB_BA_BV [} 213] The binary object indicates the current state of the hysteresis function. Variables Name Type Description Swi2P FB_BA_Swi2P The function block Swi2P is the core of the hysteresis function. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.6.4 FB_BA_Hys_21 The template represents two hysteresis functions with fixed switching points. It is used to monitor analog values, such as an air filter. The hysteresis function Hys Pre Alarm triggers a pre-alarm. Maintenance can take place on an air filter, for example. The hysteresis function Hys Main Alarm triggers a main alarm and can be used as a fault that results in plant shutdown. The air filter must be serviced. The initialization of the template takes place within the method FB_Init. 1010 Version: 1.14.0 TF8040
## Page 1011

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Hys_21 EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f In : REAL; END_VAR VAR_OUTPUT b Dst : BOOL; END_VAR VAR_INPUT CONSTANT TF8040 Version: 1.14.0 1011
## Page 1012

Programming Hys Pre Alarm On : FB_BA_AV_Op; Hys Pre Alarm Off : FB_BA_AV_Op; Hys Main Alarm On : FB_BA_AV_Op; Hys Main Alarm Off : FB_BA_AV_Op; Dst Pre Alarm : FB_BA_BV; Dst Main Alarm : FB_BA_BV; END_VAR VAR Hys Pre Alarm : FB_BA_Swi2P; Hys Main Alarm : FB_BA_Swi2P; END_VAR Inputs Name Type Description b En BOOL General enable of the function block. f In REAL Actual value Outputs Name Type Description b Dst BOOL Display of a fault or the BV object is active. b Dst is only active if the property b Event Detection Enable of the BV object was set to TRUE. The monitoring of the binary feedback indicates a fault. Inputs CONSTANT Name Type Description Hys Pre Alarm On FB_BA_AV_Op [} 202] AV object for entering the upper limit value of the hysteresis function Hys Pre Alarm. Hys Pre Alarm Off FB_BA_AV_Op [} 202] AV object for entering the lower limit value of the hysteresis function Hys Pre Alarm. Hys Main Alarm On FB_BA_AV_Op [} 202] AV object for entering the upper limit value of the hysteresis function Hys Main Alarm. Hys Main Alarm Off FB_BA_AV_Op [} 202] AV object for entering the lower limit value of the hysteresis function Hys Main Alarm. Dst Pre Alarm FB_BA_BV [} 213] The binary object is used to indicate the pre-alarm of the hysteresis function Hys Pre Alarm. A message is triggered via Intrinsic Reporting. Dst Main Alarm FB_BA_BV [} 213] The binary object is used to indicate the main alarm of the hysteresis function Hys Main Alarm. A message is triggered via Intrinsic Reporting. A fault that results in plant shutdown must be parameterized in the FB_init method via e En Plant Lock. Variables Name Type Description Hys Pre Alarm FB_BA_Swi2P The function block is the core of the hysteresis function pre-alarm. Hys Main Alarm FB_BA_Swi2P The function block is the core of the hysteresis function main alarm. 1012 Version: 1.14.0 TF8040
## Page 1013

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.7 Monitoring Presence monitoring. 6.1.4.2.2.2.7.1 FB_BA_Fdb Analog Ext The template is used to monitor analog values with dynamic switch values, e.g. for differential pressure monitoring of a fan. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 1013
## Page 1014

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Fdb Analog EXTENDS FB_BA_View VAR_INPUT b En : BOOL; b Command : BOOL; f In : REAL; f On : REAL := 10.0; f Off : REAL := 2.0; END_VAR VAR_OUTPUT b Dst : BOOL; END_VAR VAR_INPUT CONSTANT Switch On Value : FB_BA_AV_Op; Switch Off Value : FB_BA_AV_Op; Delay Feedback : FB_BA_AV_Op; Delay Interruption : FB_BA_AV_Op; Dst : FB_BA_BV; END_VAR VAR Fixed Limit : FB_BA_Swi2P; Fdb Ctrl : FB_BA_Fdb Ctrl Binary; END_VAR 1014 Version: 1.14.0 TF8040
## Page 1015

Programming Inputs Name Type Description b En BOOL General enable of the template. b Command BOOL The switching actuator output of the aggregate to be monitored is connected to the input. f In REAL The analog value to be monitored is connected to the input, e.g. a differential pressure sensor. f On REAL The switch-on value for Fixed Limit is connected to the input. In the case of differential pressure monitoring, a pressure value must be selected here which must not be undershot during the running process. f Off REAL The switch-off value for Fixed Limit is connected to the input. This value must be just below the switch-on value f On. Outputs Name Type Description b Dst BOOL Binary object for displaying the fault. Inputs CONSTANT Name Type Description Switch On Value FB_BA_AV_Op [} 202] Analog value object for entering the switch-on value for f On. Switch Off Value FB_BA_AV_Op [} 202] Analog value object for entering the switch-off value for f Off. Delay Feedback FB_BA_AV_Op [} 202] Analog value object for entering the time delay of the "Aggregate ready for operation" information. In the case of differential pressure monitoring, a time delay must be specified here after which it can be assumed that the system has built up the required differential pressure. Delay Interruption FB_BA_AV_Op [} 202] Analog value object for entering the delay time to trigger a fault message. The message from the differential pressure sensor can be delayed, in order to buffer pressure fluctuations. Dst FB_BA_BV [} 213] Binary object for displaying the fault. Variables Name Type Description Fixed Limit FB_BA_Swi2P Conversion of the analog value f In into a binary switching signal for Fdb Ctrl. Fdb Ctrl FB_BA_Fdb Ctrl Binary Monitoring of the binary feedback. [} 467] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 1015
## Page 1016

Programming 6.1.4.2.2.2.7.2 FB_BA_Fdb Analog The template is used to monitor analog values with fixed switch values, such as differential pressure monitoring of a fan. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Fdb Analog EXTENDS FB_BA_View VAR_INPUT b En : BOOL; b Command : BOOL; f In : REAL; END_VAR VAR_OUTPUT b Dst : BOOL; END_VAR 1016 Version: 1.14.0 TF8040
## Page 1017

Programming VAR_INPUT CONSTANT Switch On Value : FB_BA_AV_Op; Switch Off Value : FB_BA_AV_Op; Delay Feedback : FB_BA_AV_Op; Delay Interruption : FB_BA_AV_Op; Dst : FB_BA_BV; END_VAR VAR Fixed Limit : FB_BA_Swi2P; Fdb Ctrl : FB_BA_Fdb Ctrl Binary; END_VAR Inputs Name Type Description b En BOOL General enable of the template. b Command BOOL The switching actuator output of the aggregate to be monitored is connected to the input. f In REAL The analog value to be monitored is connected to the input, e.g. a differential pressure sensor. Outputs Name Type Description b Dst BOOL Binary object for displaying the fault. Inputs CONSTANT Name Type Description Switch On Value FB_BA_AV_Op [} 202] Analog value object for entering the switch-on value for Fixed Limit. In the case of differential pressure monitoring, a pressure value must be selected here which must not be undershot during the running process. Switch Off Value FB_BA_AV_Op [} 202] Analog value object for entering the switch-off value for Fixed Limit. This value must be just below the switch-on value Switch On Value. Delay Feedback FB_BA_AV_Op [} 202] Analog value object for entering the time delay of the "Aggregate ready for operation" information. In the case of differential pressure monitoring, a time delay must be specified here after which it can be assumed that the system has built up the required differential pressure. Delay Interruption FB_BA_AV_Op [} 202] Analog value object for entering the delay time to trigger a fault message. The message from the differential pressure sensor can be delayed, in order to buffer pressure fluctuations. Dst FB_BA_BV [} 213] Binary object for displaying the fault. Variables Name Type Description Fixed Limit FB_BA_Swi2P Conversion of the analog value f In into a binary switching signal for Fdb Ctrl. Fdb Ctrl FB_BA_Fdb Ctrl Binary Monitoring of the binary feedback. [} 467] TF8040 Version: 1.14.0 1017
## Page 1018

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.7.3 FB_BA_Fdb Binary The template is used to monitor binary feedback signals such as the end positions of dampers or valves. However, it can also be used for differential pressure monitoring by means of a differential pressure monitor. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Fdb Binary EXTENDS FB_BA_View VAR_INPUT b En : BOOL; b Command : BOOL; b Feedback : BOOL; END_VAR VAR_OUTPUT b Dst : BOOL; END_VAR VAR_INPUT CONSTANT Delay Feedback : FB_BA_AV_Op; Dst : FB_BA_BV; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Unit':= 's'} 1018 Version: 1.14.0 TF8040
## Page 1019

Programming n Interruption Delay : UDINT := 1; END_VAR VAR Fdb Ctrl : FB_BA_Fdb Ctrl Binary; END_VAR Inputs Name Type Description b En BOOL General enable of the template. b Command BOOL The switching actuator output of the aggregate to be monitored is connected to the input. b Feedback BOOL The feedback signal of the aggregate to be monitored is connected to the input, e.g. a differential pressure monitor, flow monitor or limit switch. Outputs Name Type Description b Dst BOOL Binary object for displaying the fault. Inputs CONSTANT Name Type Description Delay Feedback FB_BA_AV_Op [} 202] Analog value object for entering the time delay of the feedback. The travel time of the actuator can be used. In the case of differential pressure monitoring, a time delay must be specified here until the system has to built up the required differential pressure. Dst FB_BA_BV [} 213] Binary object for displaying the fault. Inputs CONSTANT PERSISTENT Name Type Description n Interruption Delay UDINT Analog value object for entering the switch-on value for Fixed Limit. In the case of differential pressure monitoring, a pressure value must be selected here which must not be undershot during the running process. Variables Name Type Description Fdb Ctrl FB_BA_Fdb Ctrl Binary Monitoring the binary feedback of the actuators. [} 467] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 1019
## Page 1020

Programming 6.1.4.2.2.2.7.4 FB_BA_Fixed Limit Ext The template represents a limit switch with dynamic limit values. A tolerance range is defined around the value f In to be monitored. The tolerance range results from a high limit value High Limit Value and a low limit value Low Limit Value. If the value f In exceeds the upper limit value of the tolerance range, then the output b High Limit is set. A response delay of the output b High Limit can be parameterized with the time variable Ti Dly. The binary object High Limit On is used to display b High Limit and can be used as a fault message object by changing the parameterization. If the value f In falls below the lower limit value of the tolerance range, then the output b Low Limit is set. A response delay of the output b Low Limit can be parameterized with the time variable Ti Dly. The binary object Low Limit On is used to display b Low Limit and can be used as a fault message object by changing the parameterization. The initialization of the template takes place within the method FB_Init. 1020 Version: 1.14.0 TF8040
## Page 1021

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Fixed Limit Ext EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f In : REAL; f High Val : REAL; f Low Val : REAL; END_VAR VAR_OUTPUT b High Limit : BOOL; b Low Limit : BOOL; END_VAR VAR_INPUT CONSTANT High Limit Value : FB_BA_AV_Op; Low Limit Value : FB_BA_AV_Op; Ti Dly : FB_BA_AV_Op; High Limit On : FB_BA_BV; Low Limit On : FB_BA_BV; END_VAR VAR Fixed Limit : FB_BA_Fixed Limit Ctrl; END_VAR TF8040 Version: 1.14.0 1021
## Page 1022

Programming Inputs Name Type Description b En BOOL General enable of the template. f In REAL The analog value to be monitored is connected to the input, e.g. a differential pressure sensor. f High Val REAL The upper limit value of the tolerance range is connected to the input. f Low Val REAL The lower limit value of the tolerance range is connected to the input. Outputs Name Type Description b High Limit BOOL The output indicates that the upper limit value of the tolerance range has been exceeded. b Low Limit BOOL The output indicates that the value has fallen below the lower limit of the tolerance range. Inputs CONSTANT Name Type Description High Limit Value FB_BA_AV_Op [} 202] Analog value object for entering the upper limit value of the tolerance range. Low Limit Value FB_BA_AV_Op [} 202] Analog value object for entering the lower limit value of the tolerance range. Ti Dly FB_BA_AV_Op [} 202] Analog value object for entering the response delay of the outputs b High Limit and b Low Limit. High Limit On FB_BA_BV [} 213] The binary object is used to display b High Limit and can be used as a fault message object by changing the parameterization. Low Limit On FB_BA_BV [} 213] The binary object is used to display b High Limit and can be used as a fault message object by changing the parameterization. Variables Name Type Description Fixed Limit FB_BA_Fixed Limit Ctrl Core of the template. [} 468] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.7.5 FB_BA_Fixed Limit The template represents a limit switch with fixed limits. 1022 Version: 1.14.0 TF8040
## Page 1023

Programming A tolerance range is defined around the value f In to be monitored. The tolerance range results from a high limit value High Limit Value and a low limit value Low Limit Value. If the value f In exceeds the upper limit value of the tolerance range, then the output b High Limit is set. A response delay of the output b High Limit can be parameterized with the time variable Ti Dly. The binary object High Limit On is used to display b High Limit and can be used as a fault message object by changing the parameterization. If the value f In falls below the lower limit value of the tolerance range, then the output b Low Limit is set. A response delay of the output b Low Limit and is to be parameterized with the time variable Ti Dly. The binary object Low Limit On is used to display b Low Limit and can be used as a fault message object by changing the parameterization. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Fixed Limit EXTENDS FB_BA_View VAR_INPUT b En : BOOL; TF8040 Version: 1.14.0 1023
## Page 1024

Programming f In : REAL; END_VAR VAR_OUTPUT b High Limit : BOOL; b Low Limit : BOOL; END_VAR VAR_INPUT CONSTANT High Limit Value : FB_BA_AV_Op; Low Limit Value : FB_BA_AV_Op; Ti Dly : FB_BA_AV_Op; High Limit On : FB_BA_BV; Low Limit On : FB_BA_BV; END_VAR VAR Fixed Limit : FB_BA_Fixed Limit Ctrl; END_VAR Inputs Name Type Description b En BOOL General enable of the template. f In REAL The analog value to be monitored is connected to the input, e.g. a differential pressure sensor. Outputs Name Type Description b High Limit BOOL The output indicates that the upper limit value of the tolerance range has been exceeded. b Low Limit BOOL The output indicates that the value has fallen below the lower limit of the tolerance range. Inputs CONSTANT Name Type Description High Limit Value FB_BA_AV_Op [} 202] Analog value object for entering the upper limit value of the tolerance range. Low Limit Value FB_BA_AV_Op [} 202] Analog value object for entering the lower limit value of the tolerance range. Ti Dly FB_BA_AV_Op [} 202] Analog value object for entering the response delay of the outputs b High Limit and b Low Limit. High Limit On FB_BA_BV [} 213] The binary object is used to display b High Limit and can be used as a fault message object by changing the parameterization. Low Limit On FB_BA_BV [} 213] The binary object is used to display b High Limit and can be used as a fault message object by changing the parameterization. Variables Name Type Description Fixed Limit FB_BA_Fixed Limit Ctrl Core of the template. [} 468] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 1024 Version: 1.14.0 TF8040
## Page 1025

Programming 6.1.4.2.2.2.7.6 FB_BA_Presence Monitoring Universal presence monitoring template with reset inputs for delay timer and manual function. Via the input b Presence a switch-off delayed occupancy signal is issued at the output b Presence State. The switch-off delay is defined by n Dly Prc [s]. After this time has elapsed, not only b Presence State is set to FALSE again, but also a TRUE pulse at output b Rst Swi. This pulse can be used to reset manual overrides, for example, on blind or light functions. If a TRUE signal is given at input b Rst Delay Timer, the delay timer is cleared and output b Presence State goes to FALSE until presence is detected again by input b Presence. A TRUE signal at input b Rst Man Mod specifically triggers output b Rst Swi. Both reset functions are important for a central shutdown, where it is assumed that no one is left in place. At the output n Countdown Presence the remaining time of the delay timer can be read in seconds for commissioning purposes. The initialization of the template takes place within the method FB_Init. Syntax FUNCTION_BLOCK FB_BA_Presence Monitoring VAR_INPUT b Presence : BOOL; b Rst Delay Timer : BOOL; b Rst Man Mod : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT n Dly Prc : UDINT; END_VAR VAR_OUTPUT b Rst Swi : BOOL; b Presence State : BOOL; n Countdown Presence : UDINT; END_VAR VAR tof Prc Detc : TOF; rt Rst Delay Timer : R_TRIG; rt Rst Man Mod : R_TRIG; ft Prc : F_TRIG; END_VAR Inputs Name Type Description b Presence BOOL The presence signal input is passed on to the output b Presence State with a switch-off delay. b Rst Delay Timer BOOL Reset input for the switch-off delay. A TRUE signal at this input resets the internal timer. b Rst Man Mode BOOL Reset input for the manual override. A TRUE signal at this input generates a positive edge at the output b Rst Swi. TF8040 Version: 1.14.0 1025
## Page 1026

Programming Inputs CONSTANT PERSISTENT Name Type Description n Dly Prc UDINT Switch-off delay time [s]. Preset to 3600 in FB_Init. Outputs Name Type Description b Rst Swi BOOL Reset output for manual overrides. b Presence State BOOL Switch-off delayed presence state. n Count Down Presen UDINT Remaining time of the delay timer in seconds. ce Variables Name Type Description tof Prc Detc TOF Switch-off delay presence. rt Rst Delay Timer R_TRIG Trigger for the reset of the timer. rt Rst Man Mod R_TRIG Trigger for the reset of the manual override. ft Prc F_TRIG Trigger for the reset of the manual override, but controlled by the omission of the presence. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.7.7 FB_BA_Sliding Limit The template represents a sliding limit value monitoring. After the start, a check is made whether the actual value f Sensor of the control is within the tolerance range between the lower limit value f Low Limit and the upper limit value f High Limit of the function block Sliding Limit. If the actual value is outside this tolerance range and the delay time Ti Dly has expired, one of the variables b High Limit or b Low Limit is set depending on whether the tolerance range has been left. The binary object High Limit On is used to display b High Limit and can be used as a fault message object by changing the parameterization. The binary object Low Limit On is used to display b Low Limit and can be used as a fault message object by changing the parameterization. The initialization of the template takes place within the method FB_Init. 1026 Version: 1.14.0 TF8040
## Page 1027

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Sliding Limit EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f Actuator : REAL; f Sensor : REAL; END_VAR VAR_OUTPUT b High Limit : BOOL; b Low Limit : BOOL; END_VAR VAR_INPUT CONSTANT Hys : FB_BA_AV_Op; Ti Dly : FB_BA_AV_Op; High Limit On : FB_BA_BV; Low Limit On : FB_BA_BV; END_VAR VAR Sliding Limit : FB_BA_Sliding Limit Ctrl; END_VAR TF8040 Version: 1.14.0 1027
## Page 1028

Programming Inputs Name Type Description b En BOOL General enable of the template. f Actuator REAL The base value of the tolerance range is connected to the input. This value can be, for example, a valve position. f Sensor REAL The analog value to be monitored is connected to the input. This value could, for example, be the feedback signal of a valve. Outputs Name Type Description b High Limit BOOL The output indicates that the upper limit value of the tolerance range has been exceeded. b Low Limit BOOL The output indicates that the value has fallen below the lower limit of the tolerance range. Inputs CONSTANT Name Type Description Hys FB_BA_AV_Op [} 202] Analog value object for entering the hysteresis of the tolerance range. Lower limit of the function block Sliding Limit: f Low Limit = f Actuator - (Hys / 2) Upper limit of the function block Sliding Limit: f High Limit = f Actuator + (Hys / 2) Ti Dly FB_BA_AV_Op [} 202] Analog value object for entering the response delay of the outputs b High Limit and b Low Limit. High Limit On FB_BA_BV [} 213] The binary object is used to display b High Limit and can be used as a fault message object by changing the parameterization. Low Limit On FB_BA_BV [} 213] The binary object is used to display b High Limit and can be used as a fault message object by changing the parameterization. Variables Name Type Description Sliding Limit FB_BA_Sliding Limit Ctrl Core of the template. [} 469] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 1028 Version: 1.14.0 TF8040
## Page 1029

Programming 6.1.4.2.2.2.8 Object 6.1.4.2.2.2.8.1 FB_BA_AV_Op_SP The template FB_BA_AV_Op_SP is used to enter a setpoint within a template at system level. It is itself a shell that represents the aggregate level and sets the internal analog object at the functional level. A label is predefined in FB_Init that describes the internal analog object [} 202] as a "setpoint"; the preselected unit is [°C]. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_AV_Op_SP EXTENDS FB_BA_View VAR_OUTPUT f Present Value : REAL; END_VAR VAR_INPUT CONSTANT SP : FB_BA_AV_Op; END_VAR Outputs Name Type Description f Present Value REAL Entered value. Inputs CONSTANT Name Type Description SP FB_BA_AV_Op [} 202] Analog value object for entering the setpoint. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 1029
## Page 1030

Programming 6.1.4.2.2.2.8.2 FB_BA_BV_Error State The template is an error state message within a template at system level. It is itself a shell that represents the aggregate level and sets the internal binary object [} 213] at the functional level. A label is predefined in FB_Init that describes the internal binary object as an "error". The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_BV_Error State EXTENDS FB_BA_View VAR_INPUT b Val Pgm : BOOL; END_VAR VAR_INPUT CONSTANT Error State : FB_BA_BV; END_VAR VAR_OUTPUT b BV_Event : BOOL; END_VAR VAR_INPUT CONSTANT Name Type Description b Val Pgm BOOL (Error) input from the program. VAR_INPUT CONSTANT Name Type Description Error State FB_BA_BV [} 213] Binary value object for displaying the error message. Outputs Name Type Description b BVEvent BOOL Binary state of the message. 1030 Version: 1.14.0 TF8040
## Page 1031

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.56 TF8040 | Twin CAT Building Automation from V5.8.0.0 6.1.4.2.2.2.8.3 FB_BA_BV_Op_Val The template FB_BA_BV_OP_Val is a switch within a template at system level. It is itself a shell that represents the aggregate level and sets the internal binary object [} 216] at the functional level. A label is predefined in FB_Init that describes the internal binary object as a "push button", the preselected function is "latching" (E_BA_Toggle Mode.e Switch). The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_BV_OP_Val EXTENDS FB_BA_View VAR_OUTPUT f Present Value : BOOL; END_VAR VAR_INPUT CONSTANT Val : FB_BA_BV_Op; END_VAR Outputs Name Type Description f Present Value REAL Binary state of the switch. Inputs CONSTANT Name Type Description Val FB_BA_BV_Op [} 216] Binary value object to represent the switch. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 TF8040 Version: 1.14.0 1031
## Page 1032

Programming 6.1.4.2.2.2.9 Operating Mode 6.1.4.2.2.2.9.1 FB_BA_Op Mod1St The template maps a single-stage plant selector switch with the operating modes Auto, Manual Off and Manual On. A plant can be switched on or off via the input b Val Pgm in the operating mode Auto. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Op Mod1St EXTENDS FB_BA_View VAR_INPUT b Val Pgm : BOOL; END_VAR VAR_INPUT CONSTANT Op Mod Man : FB_BA_MV_Op; Op Mod Pr : FB_BA_MV_Op; 1032 Version: 1.14.0 TF8040
## Page 1033

Programming END_VAR VAR_OUTPUT e Op Mod : E_BA_On Off; b Cmd : BOOL; END_VAR Inputs Name Type Description b Val Pgm BOOL A plant can be switched on or off via the input in the operating mode "Auto". Inputs CONSTANT Name Type Description Op Mod Man FB_BA_MV_Op [} 239] The Multistate-Value object represents an operating mode switch with the operating modes "Auto", "Manual Off" and "Manual On". Op Mod Pr FB_BA_MV_Op [} 239] The Multistate-Value object indicates the state of the currently valid plant operating mode. Outputs Name Type Description e Op Mod E_BA_On Off [} 700] Displays the state of the currently valid plant operating mode. b Cmd BOOL The output shows the state of the currently valid plant operating mode. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.9.2 FB_BA_Op Mod1St Ext01 The template maps a single-stage plant selector switch with the operating modes Auto, Manual Off and Manual On. The variable b Selector can be used to parameterize a plant in "Auto" mode so that the plant is switched on or off either via the input b Val Pgm or via the time schedule Sched. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 1033
## Page 1034

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Op Mod1St EXTENDS FB_BA_View VAR_INPUT b Val Pgm : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT b Selector : BOOL; END_VAR VAR_INPUT CONSTANT Op Mod Man : FB_BA_MV_Op; Sched : FB_BA_Sched M; Op Mod Pr : FB_BA_MV_Op; END_VAR VAR_OUTPUT e Op Mod : E_BA_On Off; b Cmd : BOOL; END_VAR VAR Prio Swi Op Mod : FB_BA_Prio Swi_UDI04; END_VAR 1034 Version: 1.14.0 TF8040
## Page 1035

Programming Inputs Name Type Description b Val Pgm BOOL A plant can be switched on or off via the input in the operating mode "Auto". Inputs CONSTANT Name Type Description b Selector BOOL The variable can be used to parameterize a system in the "Auto" operating mode so that the system is switched on or off either via the input b Val Pgm or via the schedule Sched. Inputs CONSTANT Name Type Description Op Mod Man FB_BA_MV_Op [} 239] The Multistate-Value object represents an operating mode switch with the operating modes "Auto", "Manual Off" and "Manual On". Sched FB_BA_Sched M [} 225] A plant can be switched on or off by the schedule in the operating mode "Auto" and the parameter b Selector = TRUE. Op Mod Pr FB_BA_MV_Op [} 239] The Multistate-Value object indicates the state of the currently valid plant operating mode. Outputs Name Type Description e Op Mod E_BA_On Off [} 700] Displays the state of the currently valid plant operating mode. b Cmd BOOL The output shows the state of the currently valid plant operating mode. Variables Name Type Description Prio Swi Op Mod FB_BA_Prio Swi_UDI04 The priority switch detects the operating modes, prioritizes them and forwards the result to Op Mod Pr. [} 433] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.10 PID 6.1.4.2.2.2.10.1 FB_BA_PID_Sp TF8040 Version: 1.14.0 1035
## Page 1036

Programming The template is a universal PID controller. The PID controller is enabled via the input variable b En. The setpoint is entered via the AV object Sp. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_PID EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f X : REAL; b Sync : BOOL; f Sync : REAL; END_VAR VAR_OUTPUT f Y : REAL; f Max : REAL; f Min : REAL; END_VAR VAR_INPUT CONSTANT Sp : FB_BA_AV_Op; Ctrl : FB_BA_Loop; END_VAR 1036 Version: 1.14.0 TF8040
## Page 1037

Programming Inputs Name Type Description b En BOOL General enable of the template f X REAL Actual value b Sync BOOL A rising edge at this input triggers synchronization of the loop object to the value of f Sync. f Sync REAL Synchronization value Outputs Name Type Description f Y REAL Control value output f Max REAL Maximum controller value f Min REAL Minimum controller value Inputs CONSTANT Name Type Description Sp FB_BA_AV_Op [} 202] Input of the setpoint Ctrl FB_BA_Loop [} 220] PID controller Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.10.2 FB_BA_PID The template is a universal PID controller. The PID controller is enabled via the input variable b En. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 1037
## Page 1038

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_PID EXTENDS FB_BA_View VAR_INPUT b En : BOOL; f W : REAL; f X : REAL; b Sync : BOOL; f Sync : REAL; END_VAR VAR_OUTPUT f Y : REAL; f Max : REAL; f Min : REAL; END_VAR VAR_INPUT CONSTANT Ctrl : FB_BA_Loop; END_VAR Inputs Name Type Description b En BOOL General enable of the template f W REAL Setpoint f X REAL Actual value b Sync BOOL A rising edge at this input triggers synchronization of the loop object to the value of f Sync. f Sync REAL Synchronization value Outputs Name Type Description f Y REAL Control value output f Max REAL Maximum controller value f Min REAL Minimum controller value 1038 Version: 1.14.0 TF8040
## Page 1039

Programming Inputs CONSTANT Name Type Description Ctrl FB_BA_Loop [} 220] PID controller Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.11 Ramp 6.1.4.2.2.2.11.1 FB_BA_Ramp Limit Decrease The template implements a falling ramp limitation from 100 to 0 and remains at this value. Ramp limitation is triggered by a rising edge at the input b Trig and specified in terms of time by Ti Down. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Ramp Limit Decrease EXTENDS FB_BA_View VAR_INPUT b En : BOOL; b Trig : BOOL; END_VAR VAR_OUTPUT f Y : REAL; TF8040 Version: 1.14.0 1039
## Page 1040

Programming END_VAR VAR_INPUT CONSTANT Ti Down : FB_BA_AV_Op; Y : FB_BA_AV_Op; END_VAR VAR Ramp Fnct : FB_BA_Ramp Lmt; rtrig Sync : R_TRIG; END_VAR Inputs Name Type Description b En BOOL General enable of the template. b Trig BOOL The ramp limitation is activated by a rising edge at this input. Outputs Name Type Description f Y REAL Output of the ramp limiting value. Inputs CONSTANT Name Type Description Ti Down FB_BA_AV_Op [} 202] AV object for entering the fall time of the ramp limitation. Y FB_BA_AV_Op [} 202] AV object for displaying the ramp limitation value. Variables Name Type Description Ramp Fnct FB_BA_Ramp Lmt The function block for the output of a ramp limitation is the core of this template. rtrig Sync R_TRIG The function block triggers a rising edge and activates the ramp limitation. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.11.2 FB_BA_Ramp Limit Increase The template implements a rising ramp limitation from 0 to 100 and remains at this value. The ramp limitation is triggered by a rising edge at the b Trig input and is timed by Ti Up. The initialization of the template takes place within the method FB_Init. 1040 Version: 1.14.0 TF8040
## Page 1041

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Ramp Limit Increase EXTENDS FB_BA_View VAR_INPUT b En : BOOL; b Trig : BOOL; END_VAR VAR_OUTPUT f Y : REAL; END_VAR VAR_INPUT CONSTANT Ti Up : FB_BA_AV_Op; Y : FB_BA_AV_Op; END_VAR VAR Ramp Fnct : FB_BA_Ramp Lmt; rtrig Sync : R_TRIG; END_VAR Inputs Name Type Description b En BOOL General enable of the template. b Trig BOOL The ramp limitation is activated by a rising edge at this input. Outputs Name Type Description f Y REAL Output of the ramp limiting value. Inputs CONSTANT Name Type Description Ti Up FB_BA_AV_Op [} 202] AV object for entering the time for the ramp limitation to rise. Y FB_BA_AV_Op [} 202] AV object for displaying the ramp limitation value. TF8040 Version: 1.14.0 1041
## Page 1042

Programming Variables Name Type Description Ramp Fnct FB_BA_Ramp Lmt The function block for the output of a ramp limitation is the core of this template. rtrig Sync R_TRIG The function block triggers a rising edge and activates the ramp limitation. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.12 Scale Templates for scaling analog values. 6.1.4.2.2.2.12.1 FB_BA_Scale_02 The template represents a linear interpolation with two interpolation points and can be used to create characteristic curves. The characteristic curve is determined by the interpolation points [X1/Y1] to [X2/Y2]. The calculated output value f Y is limited by YMin or YMax. The initialization of the template takes place within the method FB_Init. Block diagram 1042 Version: 1.14.0 TF8040
## Page 1043

Programming Syntax FUNCTION_BLOCK FB_BA_Scale_04 EXTENDS FB_BA_View VAR_INPUT f X : REAL; END_VAR VAR_OUTPUT f Y : REAL; END_VAR VAR_INPUT CONSTANT X1 : FB_BA_AV_Op; X2 : FB_BA_AV_Op; Y1 : FB_BA_AV_Op; Y2 : FB_BA_AV_Op; YMin : FB_BA_AV_Op; YMax : FB_BA_AV_Op; Y : FB_BA_AV_Op; END_VAR VAR Scale : FB_BA_Chrct02; END_VAR Inputs Name Type Description f X REAL Input value of the characteristic curve. Outputs Name Type Description f Y REAL Calculated output value of the characteristic curve. Inputs CONSTANT Name Type Description X1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X1. X2 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X2. Y1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y1. Y2 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y2. YMin FB_BA_AV_Op [} 202] The AV object is used to specify the value for the minimum limit of f Y. YMax FB_BA_AV_Op [} 202] The AV object is used to specify the value for the maximum limit of f Y. Y FB_BA_AV_Op [} 202] Output of the calculated output value of the characteristic curve. Variables Name Type Description Scale FB_BA_Chrct02 The function block represents a linear interpolation with two interpolation points and can be used to generate a characteristic curve. TF8040 Version: 1.14.0 1043
## Page 1044

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.12.2 FB_BA_Scale_03 The template represents a linear interpolation with three interpolation points and can be used to generate a characteristic curve. The characteristic curve is determined by the interpolation points [X1/Y1] to [X3/Y3]. The calculated output value f Y is limited by YMin or YMax. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Scale_04 EXTENDS FB_BA_View VAR_INPUT f X : REAL; END_VAR VAR_OUTPUT f Y : REAL; END_VAR VAR_INPUT CONSTANT X1 : FB_BA_AV_Op; 1044 Version: 1.14.0 TF8040
## Page 1045

Programming X2 : FB_BA_AV_Op; X3 : FB_BA_AV_Op; Y1 : FB_BA_AV_Op; Y2 : FB_BA_AV_Op; Y3 : FB_BA_AV_Op; YMin : FB_BA_AV_Op; YMax : FB_BA_AV_Op; Y : FB_BA_AV_Op; END_VAR VAR Scale : FB_BA_Chrct03; END_VAR Inputs Name Type Description f X REAL Input value of the characteristic curve. Outputs Name Type Description f Y REAL Calculated output value of the characteristic curve. Inputs CONSTANT Name Type Description X1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X1. X2 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X2. X3 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X3. Y1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y1. Y2 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y2. Y3 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y3. YMin FB_BA_AV_Op [} 202] The AV object is used to specify the value for the minimum limit of f Y. YMax FB_BA_AV_Op [} 202] The AV object is used to specify the value for the maximum limit of f Y. Y FB_BA_AV_Op [} 202] Output of the calculated output value of the characteristic curve. Variables Name Type Description Scale FB_BA_Chrct03 The function block represents a linear interpolation with three interpolation points and can be used to generate a characteristic curve. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 TF8040 Version: 1.14.0 1045
## Page 1046

Programming 6.1.4.2.2.2.12.3 FB_BA_Scale_04 The template represents a linear interpolation with four interpolation points and can be used to generate a characteristic curve. The characteristic curve is determined by the interpolation points [X1/Y1] to [X4/Y4]. The calculated output value f Y is limited by YMin or YMax. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Scale_04 EXTENDS FB_BA_View VAR_INPUT f X : REAL; END_VAR VAR_OUTPUT f Y : REAL; END_VAR VAR_INPUT CONSTANT X1 : FB_BA_AV_Op; X2 : FB_BA_AV_Op; X3 : FB_BA_AV_Op; 1046 Version: 1.14.0 TF8040
## Page 1047

Programming X4 : FB_BA_AV_Op; Y1 : FB_BA_AV_Op; Y2 : FB_BA_AV_Op; Y3 : FB_BA_AV_Op; Y4 : FB_BA_AV_Op; YMin : FB_BA_AV_Op; YMax : FB_BA_AV_Op; Y : FB_BA_AV_Op; END_VAR VAR Scale : FB_BA_Chrct04; END_VAR Inputs Name Type Description f X REAL Input value of the characteristic curve. Outputs Name Type Description f Y REAL Calculated output value of the characteristic curve. Inputs CONSTANT Name Type Description X1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X1. X2 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X2. X3 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X3. X4 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X4. Y1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y1. Y2 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y2. Y3 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y3. Y4 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y4. YMin FB_BA_AV_Op [} 202] The AV object is used to specify the value for the minimum limit of f Y. YMax FB_BA_AV_Op [} 202] The AV object is used to specify the value for the maximum limit of f Y. Y FB_BA_AV_Op [} 202] Output of the calculated output value of the characteristic curve. Variables Name Type Description Scale FB_BA_Chrc04 The function block represents a linear interpolation with four interpolation points and can be used to generate a characteristic curve. TF8040 Version: 1.14.0 1047
## Page 1048

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.12.4 FB_BA_Scale_04_Y2_3 The template is a setpoint program for an extract air/supply air cascade with only one room temperature setpoint, including summer and winter compensation. Setpoint program for supply air temperature control with a supply air temperature setpoint, including summer/winter compensation via a characteristic curve. The supply air temperature setpoint is determined by the function block Scale depending on the outside temperature. The initialization of the template takes place within the method FB_Init. 1048 Version: 1.14.0 TF8040
## Page 1049

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Scale_04 EXTENDS FB_BA_View VAR_INPUT f TWth : REAL; END_VAR VAR_OUTPUT f Y : REAL; END_VAR VAR_INPUT CONSTANT X1 : FB_BA_AV_Op; X2 : FB_BA_AV_Op; X3 : FB_BA_AV_Op; X4 : FB_BA_AV_Op; Y1 : FB_BA_AV_Op; Y2_3 : FB_BA_AV_Op; Y4 : FB_BA_AV_Op; Y : FB_BA_AV_Op; END_VAR VAR Scale : FB_BA_Chrct04; END_VAR Inputs Name Type Description f TWth REAL Current value of the outside temperature. Outputs Name Type Description f Y REAL Calculated setpoint for the room temperature. TF8040 Version: 1.14.0 1049
## Page 1050

Programming Inputs CONSTANT Name Type Description X1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X1. X2 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X2. X3 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X3. X4 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X4. Y1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y1. Y2_3 FB_BA_AV_Op [} 202] The AV object is used to specify the value for the interpolation points Y2/Y3. Y4 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y4. Y FB_BA_AV_Op [} 202] Output of the calculated, simple room temperature setpoint. It is output at output f Y. Variables Name Type Description Scale FB_BA_Chrct04 The function block represents a linear interpolation with four interpolation points and can be used to generate a characteristic curve. The function block calculates the setpoint curve for the current room temperature, depending on the outside temperature. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.12.5 FB_BA_Scale_07 The template represents a linear interpolation with seven interpolation points and can be used to generate a characteristic curve. The characteristic curve is determined by the interpolation points [X1/Y1] to [X7/Y7]. The calculated output value f Y is limited by YMin or YMax. The initialization of the template takes place within the method FB_Init. 1050 Version: 1.14.0 TF8040
## Page 1051

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Scale_04 EXTENDS FB_BA_View VAR_INPUT f X : REAL; END_VAR VAR_OUTPUT f Y : REAL; END_VAR VAR_INPUT CONSTANT X1 : FB_BA_AV_Op; X2 : FB_BA_AV_Op; X3 : FB_BA_AV_Op; X4 : FB_BA_AV_Op; X5 : FB_BA_AV_Op; X6 : FB_BA_AV_Op; X7 : FB_BA_AV_Op; Y1 : FB_BA_AV_Op; Y2 : FB_BA_AV_Op; Y3 : FB_BA_AV_Op; Y4 : FB_BA_AV_Op; Y5 : FB_BA_AV_Op; Y6 : FB_BA_AV_Op; Y7 : FB_BA_AV_Op; YMin : FB_BA_AV_Op; TF8040 Version: 1.14.0 1051
## Page 1052

Programming YMax : FB_BA_AV_Op; Y : FB_BA_AV_Op; END_VAR VAR Scale : FB_BA_Chrct07; END_VAR Inputs Name Type Description f X REAL Input value of the characteristic curve. Outputs Name Type Description f Y REAL Calculated output value of the characteristic curve. Inputs CONSTANT Name Type Description X1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X1. X2 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X2. X3 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X3. X4 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X4. X5 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X5. X6 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X6. X7 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point X7. Y1 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y1. Y2 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y2. Y3 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y3. Y4 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y4. Y5 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y5. Y6 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y6. Y7 FB_BA_AV_Op [} 202] The AV object is used to specify the value for interpolation point Y7. YMin FB_BA_AV_Op [} 202] The AV object is used to specify the value for the minimum limit of f Y. YMax FB_BA_AV_Op [} 202] The AV object is used to specify the value for the maximum limit of f Y. Y FB_BA_AV_Op [} 202] Output of the calculated output value of the characteristic curve. 1052 Version: 1.14.0 TF8040
## Page 1053

Programming Variables Name Type Description Scale FB_BA_Chrct07 The function block represents a linear interpolation with seven interpolation points and can be used to generate a characteristic curve. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.2.13 Time Delay 6.1.4.2.2.2.13.1 FB_BA_Dly Off The template implements a switch-off delay and can be used for the overrun control of pumps. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Dly Off EXTENDS FB_BA_View VAR_INPUT b Val : BOOL; END_VAR VAR_OUTPUT b Q : BOOL; n RT : UDINT; END_VAR VAR_INPUT CONSTANT Ti Dly : FB_BA_AV_Op; END_VAR TF8040 Version: 1.14.0 1053
## Page 1054

Programming VAR tof Dly Off : TOF; END_VAR Inputs Name Type Description b Val BOOL A falling edge activates the switch-off delay. Outputs Name Type Description b Q BOOL State of the switch-off delay. n RT UDINT Remaining time of the switch-off delay. After this time has elapsed, b Q is set to FALSE. Inputs CONSTANT Name Type Description Ti Dly FB_BA_AV_Op [} 202] AV object for entering the value of the switch-off delay. Variables Name Type Description tof Dly Off TOF The timing element is the core of this template for switch- off delay. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.13.2 FB_BA_Dly On The template implements a start-up delay. The initialization of the template takes place within the method FB_Init. 1054 Version: 1.14.0 TF8040
## Page 1055

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Dly Off EXTENDS FB_BA_View VAR_INPUT b Val : BOOL; END_VAR VAR_OUTPUT b Q : BOOL; n RT : UDINT; END_VAR VAR_INPUT CONSTANT Ti Dly : FB_BA_AV_Op; END_VAR VAR ton Dly On : TON; END_VAR Inputs Name Type Description b Val BOOL A rising edge activates the start-up delay. Outputs Name Type Description b Q BOOL State of the start-up delay. n RT UDINT Remaining time of the start-up delay. After this time has elapsed, b Q is set to TRUE. Inputs CONSTANT Name Type Description Ti Dly FB_BA_AV_Op [} 202] AV object for entering the value of the start-up delay. Variables Name Type Description tof Dly On TON The timing element is the core of this template for start-up delay. TF8040 Version: 1.14.0 1055
## Page 1056

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.2.14 Trend 6.1.4.2.2.2.14.1 FB_BA_Trend Logging The template logs the values from a data source and records them in the Trendlog memory. The connection to the Trendlog objects (data sources, e.g. FB_BA_BO_IO [} 209], FB_BA_AO_IO [} 197]) is made via references. The variable Trend Count defines the size of the field of trendlog objects. The initialization of the template takes place within the method FB_Init. Syntax FUNCTION_BLOCK FB_BA_Trend Logging EXTENDS FB_BA_View VAR_INPUT CONSTANT Trends : ARRAY[1.. TREND_COUNT] OF FB_BA_Trend; END_VAR VAR i : UDINT; END_VAR VAR CONSTANT TREND_COUNT : UDINT := 30; END_VAR Inputs CONSTANT Name Type Description Trends FB_BA_Trend [} 226] Field with 30 entries for trend log objects. Variables Name Type Description i UDINT Counter for the FOR loop to call the trendlog field Trends. Variables Name Type Description Trend Count UDINT Constant to define the set of trendlog objects to be logged. Preset to 30. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 1056 Version: 1.14.0 TF8040
## Page 1057

Programming 6.1.4.2.2.2.15 Volume Flow Determination 6.1.4.2.2.2.15.1 FB_BA_V_d P_k Factor The template is used to determine the volume flow by means of differential pressure and k-factor. The initialization of the template takes place within the method FB_Init. Syntax FUNCTION_BLOCK FB_BA_V_d P_k Factor VAR_INPUT {attribute 'parameter Unit':='Pa'} f_d P : REAL; END_VAR VAR_OUTPUT {attribute 'parameter Unit':='m³/h'} f V : REAL; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Category':='Unit'} e Conversion_k Factor : E_BA_Conversion_k Factor := E_BA_Conversion_k Factor.e_Pa; {attribute 'parameter Category':='Config'} f K : REAL := 381; END_VAR VAR f Conversion F : REAL; END_VAR VAR CONSTANT f_Pa : REAL := 1; f_h Pa : REAL := 0.1; f_mbar : REAL := 0.1; f_mm_HG : REAL := 0.086613; f_in_HG : REAL := 0.017185; f_mm_WS : REAL := 0.31933; f_psi : REAL := 0.012043; f_inches_H2O : REAL := 0.063361; END_VAR Inputs Name Type Description f_d P REAL Detection of the differential pressure [Pa]. Outputs Name Type Description f V REAL Output of the calculated volume flow [m³/h]. Inputs CONSTANT PERSISTENT Name Type Description e Conversion_k Facto E_BA_Conversion_k Factor Conversion factor for the unit of the k-factor. r [} 699] f K REAL k-factor of the fan nozzle vendor (Venturi principle). TF8040 Version: 1.14.0 1057
## Page 1058

Programming Variables Name Type Description f Conversion F REAL Indicates which conversion factor has been selected by the enumeration variable e Conversion_k Factor and is used to calculate the volume flow rate. Variables Name Type Description f_Pa REAL Conversion factor for pressure [Pa]. f_h Pa REAL Conversion factor for pressure [h Pa]. f_mbar REAL Conversion factor for pressure [mbar]. f_mm_HG REAL Conversion factor for the unit millimeter mercury column [mm HG, Torr]. f_in_HG REAL Conversion factor for the unit inch of mercury [in HG]. f_mm_WS REAL Conversion factor for the unit millimeter water column [mm WS, mm H2O]. f_psi REAL Conversion factor for pressure [psi]. f_inchesn_H2O REAL Conversion factor for the unit inch water column [in H2O]. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.3 Damper 6.1.4.2.2.3.1 2P 6.1.4.2.2.3.1.1 FB_BA_Dmp2P The template is for the control of a two-point damper with integrated monitoring of both end positions. It essentially consists of the base class FB_BA_Actuator Cmd [} 986] for controlling a binary aggregate and collecting all safety-related faults. The two templates Monit Opn and Monit Cls are used to monitor the end positions. The initialization of the template takes place within the method FB_Init. 1058 Version: 1.14.0 TF8040
## Page 1059

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Dmp2P EXTENDS FB_BA_Actuator Cmd VAR_OUTPUT b Swi Opn : BOOL; b Swi Cls : BOOL; END_VAR VAR_INPUT CONSTANT Swi Opn : FB_BA_BI_Raw; Swi Cls : FB_BA_BI_Raw; Monit Open : FB_BA_Fdb Binary; Monit Close : FB_BA_Fdb Binary; END_VAR Outputs Name Type Description b Swi Opn BOOL End position "Open" has been reached. b Swi Cls BOOL End position "Closed" has been reached. Inputs CONSTANT Name Type Description Swi Opn FB_BA_BI_Raw [} 206] Binary input object is used to process the limit switch "Open". Swi Cls FB_BA_BI_Raw [} 206] Binary input object is used to process the limit switch "Closed". Monit Open FB_BA_Fdb Binary [} 1018] The template monitors the "Open" end position. Monit Close FB_BA_Fdb Binary [} 1018] The template monitors the "Closed" end position. TF8040 Version: 1.14.0 1059
## Page 1060

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.4 Motor 6.1.4.2.2.4.1 1st 6.1.4.2.2.4.1.1 FB_BA_Mot1st The template is used for the control of a single-step motor with fault signal, e.g. a fan. It essentially consists of the base class FB_BA_Actuator Cmd [} 986] for controlling a binary aggregate and collecting all safety-related faults. The BI object Dst indicates a motor fault. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Mot1st EXTENDS FB_BA_Actuator Cmd VAR_INPUT CONSTANT Dst : FB_BA_BI_Raw; END_VAR VAR END_VAR Inputs CONSTANT Name Type Description Dst FB_BA_BI_Raw [} 206] Binary input object is used to process a fault. 1060 Version: 1.14.0 TF8040
## Page 1061

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.4.2 2st 6.1.4.2.2.4.2.1 FB_BA_Mot2st The template is used for the control of a two-step motor with fault signal, e.g. a fan. It mainly consists of the function block Stp Ctrl and the base class FB_BA_Actuator MO [} 991] for the control of a multi-stage aggregate and the collection of all safety-relevant faults. The BI objects Dst Stp01 and Dst Stp02 indicate faults in the respective steps. The two templates Moni Fdb Stp01 and Moni Fdb Stp02 are used for feedback monitoring of steps 1 + 2, Fdb Stp01 and Fdb Stp02. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 1061
## Page 1062

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Mot2st EXTENDS FB_BA_Actuator MO VAR_OUTPUT n Present Value : UDINT; b Q01 : BOOL; b Q02 : BOOL; END_VAR VAR_INPUT CONSTANT Dst Stp01 : FB_BA_BI_Raw; Dst Stp02 : FB_BA_BI_Raw; Fdb Stp01 : FB_BA_BI_Raw; Fdb Stp02 : FB_BA_BI_Raw; Moni Fdb Stp01 : FB_BA_Fdb Binary; Moni Fdb Stp02 : FB_BA_Fdb Binary; Stp Ctrl : FB_BA_Motor Stp Ctrl; END_VAR 1062 Version: 1.14.0 TF8040
## Page 1063

Programming Outputs Name Type Description n Present Value UDINT Current control step of the motor. b Q01 BOOL Variable for controlling step 1 of the motor. This variable must be linked to a bus terminal. b Q02 BOOL Variable for controlling step 2 of the motor. This variable must be linked to a bus terminal. Inputs CONSTANT Name Type Description Dst Stp01 FB_BA_BI_Raw [} 206] Binary input object is used to process the step 1 motor fault. Dst Stp02 FB_BA_BI_Raw [} 206] Binary input object is used to process the step 2 motor fault. Fdb Stp01 FB_BA_BI_Raw [} 206] Binary input object is used to process the feedback of step 1 of the motor. Fdb Stp02 FB_BA_BI_Raw [} 206] Binary input object is used to process the feedback of step 2 of the motor. Moni Fdb Stp01 FB_BA_Fdb Binary [} 1018] Template that monitors the feedback of step 1 of the motor. Moni Fdb Stp02 FB_BA_Fdb Binary [} 1018] Template that monitors the feedback of step 2 of the motor. Stp Ctrl FB_BA_Motor Stp Ctrl The function block Stp Ctrl receives the numerical switch [} 413] value from the base class FB_BA_Actuator MO [} 991] and converts the switch value into individual control steps. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.4.3 3st 6.1.4.2.2.4.3.1 FB_BA_Mot3st The template is used for the control of a three-step motor with fault signal, e.g. a fan. It mainly consists of the function block Stp Ctrl and the base class FB_BA_Actuator MO [} 991] for the control of a multi-stage aggregate and the collection of all safety-relevant faults. The BI objects Dst Stp01, Dst Stp02 and Dst Stp03 indicate faults in the respective steps. The two templates Moni Fdb Stp01, Moni Fdb Stp02 and Moni Fdb Stp03 are used for feedback monitoring of steps 1 + 2 + 3, Fdb Stp01, Fdb Stp02 and Fdb Stp03. TF8040 Version: 1.14.0 1063
## Page 1064

Programming The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Mot3st EXTENDS FB_BA_Actuator MO VAR_OUTPUT n Present Value : UDINT; b Q01 : BOOL; 1064 Version: 1.14.0 TF8040
## Page 1065

Programming b Q02 : BOOL; b Q03 : BOOL; END_VAR VAR_INPUT CONSTANT Dst Stp01 : FB_BA_BI_Raw; Dst Stp02 : FB_BA_BI_Raw; Dst Stp03 : FB_BA_BI_Raw; Fdb Stp01 : FB_BA_BI_Raw; Fdb Stp02 : FB_BA_BI_Raw; Fdb Stp03 : FB_BA_BI_Raw; Moni Fdb Stp01 : FB_BA_Fdb Binary; Moni Fdb Stp02 : FB_BA_Fdb Binary; Moni Fdb Stp03 : FB_BA_Fdb Binary; Stp Ctrl : FB_BA_Motor Stp Ctrl; END_VAR Outputs Name Type Description n Present Value UDINT Current control step of the motor. b Q01 BOOL Variable for controlling step 1 of the motor. This variable must be linked to a bus terminal. b Q02 BOOL Variable for controlling step 2 of the motor. This variable must be linked to a bus terminal. Inputs CONSTANT Name Type Description Dst Stp01 FB_BA_BI_Raw [} 206] Binary input object is used to process the step 1 motor fault. Dst Stp02 FB_BA_BI_Raw [} 206] Binary input object is used to process the step 2 motor fault. Dst Stp03 FB_BA_BI_Raw [} 206] Binary input object is used to process the step 3 motor fault. Fdb Stp01 FB_BA_BI_Raw [} 206] Binary input object is used to process the feedback of step 1 of the motor. Fdb Stp02 FB_BA_BI_Raw [} 206] Binary input object is used to process the feedback of step 2 of the motor. Fdb Stp03 FB_BA_BI_Raw [} 206] Binary input object is used to process the feedback of step 3 of the motor. Moni Fdb Stp01 FB_BA_Fdb Binary [} 1018] Template that monitors the feedback of step 1 of the motor. Moni Fdb Stp02 FB_BA_Fdb Binary [} 1018] Template that monitors the feedback of step 2 of the motor. Moni Fdb Stp03 FB_BA_Fdb Binary [} 1018] Template that monitors the feedback of step 3 of the motor. Stp Ctrl FB_BA_Motor Stp Ctrl The function block Stp Ctrl receives the numerical switch [} 413] value from the base class FB_BA_Actuator MO [} 991] and converts the switch value into individual control steps. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 TF8040 Version: 1.14.0 1065
## Page 1066

Programming 6.1.4.2.2.4.4 Control 6.1.4.2.2.4.4.1 FB_BA_Mot Ctl The template is used to control and regulate a speed-controlled motor. It mainly consists of a BO and AO object for controlling the motor (frequency converter), a BI object for displaying a fault and a PID controller for speed control. The function block Plant Lock collects all safety- relevant faults. The enables and modulation commands are transmitted to the template via the command structure st Cmd. The initialization of the template takes place within the method FB_Init. 1066 Version: 1.14.0 TF8040
## Page 1067

Programming Block diagram TF8040 Version: 1.14.0 1067
## Page 1068

Programming Syntax FUNCTION_BLOCK FB_BA_Mot Ctl EXTENDS FB_BA_View VAR_INPUT f In : REAL; st Cmd : ST_BA_Mdlt; END_VAR VAR_OUTPUT b Cmd : BOOL; f Mdlt : REAL; b Dst : BOOL; e Active Prio : E_BA_Priority; END_VAR VAR_INPUT CONSTANT Dst : FB_BA_BI_Raw; Cmd : FB_BA_BO_Raw; Mdlt : FB_BA_AO_Raw; Sp : FB_BA_AV_Op; Ctrl : FB_BA_Loop; Plant Lock : FB_BA_Plant Lock; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; Prio Swi Val : FB_BA_Prio Swi_UDI04; Mux Cmd : FB_BA_MMUX_B04; Mux Mdlt : FB_BA_MMUX_R04; f Max : REAL; f Min : REAL; END_VAR Inputs Name Type Description f In REAL The actual value for the controller Ctrl is connected to the input. st Cmd ST_BA_Mdlt [} 276] The enables and modulation commands are transmitted to the template via the command structure st Cmd. The command with the highest priority determines the switching command at the binary output object Cmd and the control command at the analog output object Mdlt. Outputs Name Type Description b Cmd BOOL Output of the switch value. f Mdlt REAL Current value of the analog output object. b Dst BOOL The variable is an evaluation of the lock priorities "Safety" and "Critical" of the project structure and indicates a triggered event. e Active Prio E_BA_Priority [} 110] Display of the active priority. 1068 Version: 1.14.0 TF8040
## Page 1069

Programming Inputs CONSTANT Name Type Description Dst FB_BA_BI_Raw [} 206] Binary input object is used to process a fault. Cmd FB_BA_BO_Raw [} 211] The binary output object is used to output a switching command and transmit it to the I/O level. Mdlt FB_BA_AO_Raw [} 199] Current value of the analog output object. Sp FB_BA_AV_Op [} 202] Entering the setpoint for the PID controller Ctrl. Ctrl FB_BA_Loop [} 220] PID controller. Plant Lock FB_BA_Plant Lock [} 135] The function block Plant Lock collects all safety-relevant faults at this level of the project structure and triggers switching commands in the template accordingly. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the project structure. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the project structure. b Prio Swi Val FB_BA_Prio Swi_UDI04 The priority switch Prio Swi Val [} 433] uses the command [} 433] structure st Cmd to determine the modulation command for the multiplexers Mux Cmd and Mux Mdlt. Mux Cmd FB_BA_MMUX_B04 [} 428] The multiplexer Mux Cmd [} 428] determines the current switch value from the command of the priority switch Prio Swi Val. The resulting output is sent to the binary output object Cmd. Mux Mdlt FB_BA_MMUX_R04 [} 428] The multiplexer Mux Mdlt [} 428] determines the current control value from the modulation values Ctrl.f Present Value, f Min, f Max and the modulation command of the priority switch Prio Swi Val. The resulting output is sent to the analog output object Mdlt. f Max REAL Maximum value of the controller, which is output when the modulation command E_BA_Mdlt Cmd.e Max is pending (see E_BA_Mdlt [} 270]). f Min REAL Minimum value of the controller, which is output when the modulation command E_BA_Mdlt Cmd.e Min is pending (see E_BA_Mdlt [} 270]). Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.4.4.2 FB_BA_Mot Ctl Ext The template is used to control and regulate a speed-controlled motor. It consists essentially of the base class FB_BA_Mot Ctl [} 1066]. TF8040 Version: 1.14.0 1069
## Page 1070

Programming The difference to the template FB_BA_Mot Ctl [} 1066] are the additional BI objects Th Ovrld and Mntn Swi. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Mot Ctl Ext EXTENDS FB_BA_Mot Ctl VAR_INPUT CONSTANT Th Ovrld : FB_BA_BI_Raw; Mntn Swi : FB_BA_BI_Raw; END_VAR Inputs CONSTANT Name Type Description Th Ovrld FB_BA_BI_Raw [} 206] The binary input object is used to process the "Thermal overload" fault. Mntn Swi FB_BA_BI_Raw [} 206] The binary input object is used to process a maintenance switch. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.4.5 Modulation 6.1.4.2.2.4.5.1 FB_BA_Mot Mdlt The template is used to control a speed-controlled motor. It mainly consists of a BO and AO object for controlling the motor (frequency converter) and a BI object for displaying a fault. The function block Plant Lock collects all safety-relevant faults. The enables and modulation commands are transmitted to the template via the command structure st Cmd. 1070 Version: 1.14.0 TF8040
## Page 1071

Programming The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Mot Ctl EXTENDS FB_BA_View VAR_INPUT st Cmd : ST_BA_Mdlt; f Val Pgm : REAL; END_VAR TF8040 Version: 1.14.0 1071
## Page 1072

Programming VAR_INPUT CONSTANT Dst : FB_BA_BI_Raw; Cmd : FB_BA_BO_Raw; Mdlt : FB_BA_AO_Raw; Plant Lock : FB_BA_Plant Lock; END_VAR VAR_INPUT CONSTANT PERSISTENT {attribute 'parameter Category' := 'Behaviour'} f Min Modulation : REAL := 20; {attribute 'parameter Category' := 'Behaviour'} f Max Modulation : REAL := 100; END_VAR VAR_OUTPUT b Cmd : BOOL; f Mdlt : REAL; b Dst : BOOL; e Active Prio : E_BA_Priority; END_VAR VAR b Prio Sfty : BOOL; b Prio Crit : BOOL; Prio Swi Val : FB_BA_Prio Swi_UDI04; Mux Cmd : FB_BA_MMUX_B04; Mux Mdlt : FB_BA_MMUX_R04; END_VAR Inputs Name Type Description st Cmd ST_BA_Mdlt [} 276] The enables and modulation commands are transmitted to the template via the command structure st Cmd. The command with the highest priority determines the switching command at the binary output object Cmd and the control command at the analog output object Mdlt. f Val Pgm REAL Control value for the control of the motor. Inputs CONSTANT Name Type Description Dst FB_BA_BI_Raw [} 206] Binary input object is used to process a fault. Cmd FB_BA_MO [} 232] The multistate output object is used to output the current switch value. Mdlt FB_BA_AO_Raw [} 199] Current value of the analog output object. Plant Lock FB_BA_Plant Lock [} 135] The function block Plant Lock collects all safety-relevant faults at this level of the project structure and triggers switching commands in the template accordingly. Inputs CONSTANT PERSISTENT Name Type Description f Min Modulation REAL Constant minimum value which is output if the modulation command E_BA_Mdlt Cmd.e Min is pending (see E_BA_Mdlt [} 270]). f Max Modulation REAL Constant maximum value which is output if the modulation command E_BA_Mdlt Cmd.e Max is pending (see E_BA_Mdlt [} 270]). 1072 Version: 1.14.0 TF8040
## Page 1073

Programming Outputs Name Type Description b Cmd BOOL Output of the switch value. f Mdlt REAL Current value of the analog output object. b Dst BOOL The variable is an evaluation of the lock priorities "Safety" and "Critical" of the project structure and indicates a triggered event. e Active Prio E_BA_Priority [} 110] Display of the active priority. Variables Name Type Description b Prio Sfty BOOL The variable is an evaluation of the "Safety" lock priority of the project structure. b Prio Crit BOOL The variable is an evaluation of the "Critical" lock priority of the project structure. b Prio Swi Val FB_BA_Prio Swi_UDI04 The priority switch Prio Swi Val [} 433] uses the command [} 433] structure st Cmd to determine the modulation command for the multiplexers Mux Cmd and Mux Mdlt. Mux Cmd FB_BA_MMUX_B04 [} 428] The multiplexer Mux Cmd [} 428] determines the current switch value from the command of the priority switch Prio Swi Val. The resulting output is sent to the binary output object Cmd. Mux Mdlt FB_BA_MMUX_R04 [} 428] The multiplexer Mux Mdlt [} 428] determines the current control value from the modulation values Ctrl.f Present Value, f Min, f Max and the modulation command of the priority switch Prio Swi Val. The resulting output is sent to the analog output object Mdlt. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.4.5.2 FB_BA_Mot Mdlt Ext The template is used to control a speed-controlled motor. It consists essentially of the base class FB_BA_Mot Mdlt [} 1070]. The difference to the template FB_BA_Mot Mdlt [} 1070] is the AV object Sp with the associated MAX selection. A minimum control value for the motor could thus be specified via the Sp object. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 1073
## Page 1074

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Mot Ctl Ext EXTENDS FB_BA_Mot Mdlt VAR_INPUT CONSTANT Sp : FB_BA_AV_Op; END_VAR Inputs CONSTANT Name Type Description Sp FB_BA_AV_Op [} 202] The AV object can be used to specify the minimum control value for the motor. A MAX selection then uses either this setpoint or the value from the input f Val Pgm of the base class FB_BA_Mot Mdlt [} 1070]. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.5 Pump 6.1.4.2.2.5.1 1st 6.1.4.2.2.5.1.1 FB_BA_Pu1st The template is used to control a single-stage pump with binary inputs and outputs. It mainly consists of the base class FB_BA_Mot1st [} 1060], the switch-off delay Dly Off [} 1053] and the anti-blocking protection function Ablk [} 997]. The pump is switched on externally by the priorities of the command structure st Cmd of the base class FB_BA_Mot1st [} 1060] or internally by the anti-blocking protection function Ablk [} 997]. The external request via the priority "program" is switched off with a delay by the template Dly Off. The initialization of the template takes place within the method FB_Init. 1074 Version: 1.14.0 TF8040
## Page 1075

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Pu1st EXTENDS FB_BA_Mot1st VAR_INPUT b Ablk Lock : BOOL; END_VAR VAR_INPUT CONSTANT Dly Off : FB_BA_Dly Off; Ablk : FB_BA_Anti Blocking; END_VAR VAR Prio Swi Pgm : FB_BA_Prio Swi_B04; ton Ablk Lock : TON; END_VAR Inputs Name Type Description b Ablk Lock BOOL A TRUE at this input variable interrupts the anti-blocking protection function Ablk [} 997]. It should be prevented that pumps and valves get an anti-blocking protection pulse at the same time. TF8040 Version: 1.14.0 1075
## Page 1076

Programming Inputs CONSTANT Name Type Description Dly Off FB_BA_Dly Off [} 1053] The template serves as a delayed pump shutdown. Ablk FB_BA_Anti Blocking Anti-blocking protection. [} 997] Variables Name Type Description Prio Swi Pgm FB_BA_Prio Swi_B04 [} 433] The priority switch Prio Swi Pgm uses the switch-off delay Dly Off, the anti-blocking protection function Ablk [} 997] and the priority program of the command structure st Cmd of the base class FB_BA_Mot1st [} 1060] to determine the current switch value for the base class FB_BA_Mot1st [} 1060]. ton Ablk Lock TON Switch-off delay of the anti-blocking protection pulse. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.5.1.2 FB_BA_Pu1st Ext The template is used to control a single-stage pump with binary inputs and outputs. It consists essentially of the base class FB_BA_Pu1st [} 1074]. The difference to the template FB_BA_Pu1st [} 1074] are the additional BI objects Th Ovrld and Mntn Swi. The initialization of the template takes place within the method FB_Init. Block diagram 1076 Version: 1.14.0 TF8040
## Page 1077

Programming Syntax FUNCTION_BLOCK FB_BA_Pu1st Ext EXTENDS FB_BA_Pu1st VAR_INPUT CONSTANT Th Ovrld : FB_BA_BI_Raw; Mntn Swi : FB_BA_BI_Raw; END_VAR Inputs CONSTANT Name Type Description Th Ovrld FB_BA_BI_Raw [} 206] The binary input object is used to process the "Thermal overload" fault. Mntn Swi FB_BA_BI_Raw [} 206] The binary input object is used to process a maintenance switch. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.5.2 Control 6.1.4.2.2.5.2.1 FB_BA_Pu Ctl The template is used to control and regulate a speed-controlled pump with analog and binary inputs and outputs. It mainly consists of the base class FB_BA_Mot Ctl [} 1066], the switch-off delay Dly Off [} 1053] and the anti-blocking protection function Ablk [} 997]. The template Flow Monit stands for the monitoring of the flow monitor Flow Swi. The pump is switched on externally by the priorities of the command structure st Cmd of the base class FB_BA_Mot Ctl [} 1066] or internally by the anti-blocking protection function Ablk [} 997]. The external request via the priority "Program" is switched off with a delay by the template Dly Off [} 1053]. The initialization of the template takes place within the method FB_Init. TF8040 Version: 1.14.0 1077
## Page 1078

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Pu Ctl EXTENDS FB_BA_Mot Ctl VAR_INPUT b Ablk Lock : BOOL; END_VAR VAR_INPUT CONSTANT Th Ovrld : FB_BA_BI_Raw Mntn Swi : FB_BA_BI_Raw; Flow Swi : FB_BA_BI_Raw; Flow Monit : FB_BA_Fdb Binary; Dly Off : FB_BA_Dly Off; Ablk : FB_BA_Anti Blocking; END_VAR VAR Prio Swi Pgm : FB_BA_Prio Swi_UDI04; ton Ablk Lock : TON; END_VAR 1078 Version: 1.14.0 TF8040
## Page 1079

Programming Inputs Name Type Description b Ablk Lock BOOL A TRUE at this input variable interrupts the anti-blocking protection function Ablk [} 997]. It should be prevented that pumps and valves get an anti-blocking protection pulse at the same time. Inputs CONSTANT Name Type Description Th Ovrld FB_BA_BI_Raw [} 206] The binary input object is used to process the "Thermal overload" fault. Mntn Swi FB_BA_BI_Raw [} 206] The binary input object is used to process a maintenance switch. Flow Swi FB_BA_BI_Raw [} 206] The binary input object is used to process a flow monitor. Flow Monit FB_BA_Fdb Binary [} 1018] Template for monitoring the flow monitor. Dly Off FB_BA_Dly Off [} 1053] The template serves as a delayed pump shutdown. Ablk FB_BA_Anti Blocking Anti-blocking protection. [} 997] Variables Name Type Description Prio Swi Pgm FB_BA_Prio Swi_UDI04 The priority switch Prio Swi Pgm uses the switch-off delay [} 433] Dly Off, the anti-lock protection function Ablk [} 997] and the priority program of the command structure st Cmd of the base class FB_BA_Mot Ctl [} 1066] to determine the current modulation value for the base class FB_BA_Mot Ctl [} 1066]. ton Ablk Lock TON Switch-off delay of the anti-blocking protection pulse. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.5.3 Modulation 6.1.4.2.2.5.3.1 FB_BA_Pu Mdlt The template is used to control a speed-controlled pump with analog and binary inputs and outputs. It mainly consists of the base class FB_BA_Mot Mdlt [} 1070], the switch-off delay Dly Off [} 1053] and the anti-blocking protection function Ablk [} 997]. The template Flow Monit stands for the monitoring of the flow monitor Flow Swi. TF8040 Version: 1.14.0 1079
## Page 1080

Programming The pump is switched on externally via the priorities of the command structure st Cmd of the base class FB_BA_Mot Mdlt [} 1070] or internally by the anti-blocking protection function Ablk [} 997]. The external request via the priority "program" is switched off with a delay by the template Dly Off [} 1053]. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Pu Mdlt EXTENDS FB_BA_Mot Mdlt VAR_INPUT b Ablk Lock : BOOL; END_VAR VAR_INPUT CONSTANT Th Ovrld : FB_BA_BI_Raw; Mntn Swi : FB_BA_BI_Raw; Flow Swi : FB_BA_BI_Raw; Flow Monit : FB_BA_Fdb Binary; Dly Off : FB_BA_Dly Off; 1080 Version: 1.14.0 TF8040
## Page 1081

Programming Ablk : FB_BA_Anti Blocking; END_VAR VAR Prio Swi Pgm : FB_BA_Prio Swi_UDI04; ton Ablk Lock : TON; END_VAR Inputs Name Type Description b Ablk Lock BOOL A TRUE at this input variable interrupts the anti-blocking protection function Ablk [} 997]. It should be prevented that pumps and valves get an anti-blocking protection pulse at the same time. Inputs CONSTANT Name Type Description Th Ovrld FB_BA_BI_Raw [} 206] The binary input object is used to process the "Thermal overload" fault. Mntn Swi FB_BA_BI_Raw [} 206] The binary input object is used to process a maintenance switch. Flow Swi FB_BA_BI_Raw [} 206] The binary input object is used to process a flow monitor. Flow Monit FB_BA_Fdb Binary [} 1018] Template for monitoring the flow monitor. Dly Off FB_BA_Dly Off [} 1053] The template serves as a delayed pump shutdown. Ablk FB_BA_Anti Blocking Anti-blocking protection. [} 997] Variables Name Type Description Prio Swi Pgm FB_BA_Prio Swi_UDI04 The priority switch Prio Swi Pgm uses the switch-off delay [} 433] Dly Off, the anti-blocking protection function Ablk [} 997] and the priority program of the command structure st Cmd of the base class FB_BA_Mot1st [} 1060] to determine the current switch value for the base class FB_BA_Mot1st [} 1060]. ton Ablk Lock TON Switch-off delay of the anti-blocking protection pulse. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.5.3.2 FB_BA_Pu Mdlt Ext TF8040 Version: 1.14.0 1081
## Page 1082

Programming The template is used to control a speed-controlled pump with analog and binary inputs and outputs. It mainly consists of the base class FB_BA_Mot Mdlt Ext [} 1073], the switch-off delay Dly Off [} 1053] and the anti- blocking protection function Ablk [} 997]. The template Flow Monit stands for the monitoring of the flow monitor Flow Swi. The pump is switched on externally via the priorities of the command structure st Cmd of the base class FB_BA_Mot Mdlt Ext [} 1073] or internally by the anti-blocking protection function Ablk [} 997]. The external request via the priority "program" is switched off with a delay by the template Dly Off [} 1053]. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Pu Mdlt EXTENDS FB_BA_Mot Mdlt VAR_INPUT b Ablk Lock : BOOL; END_VAR 1082 Version: 1.14.0 TF8040
## Page 1083

Programming VAR_INPUT CONSTANT Th Ovrld : FB_BA_BI_Raw; Mntn Swi : FB_BA_BI_Raw; Flow Swi : FB_BA_BI_Raw; Flow Monit : FB_BA_Fdb Binary; Dly Off : FB_BA_Dly Off; Ablk : FB_BA_Anti Blocking; END_VAR VAR Prio Swi Pgm : FB_BA_Prio Swi_UDI04; ton Ablk Lock : TON; END_VAR Inputs Name Type Description b Ablk Lock BOOL A TRUE at this input variable interrupts the anti-blocking protection function Ablk [} 997]. It should be prevented that pumps and valves get an anti-blocking protection pulse at the same time. Inputs CONSTANT Name Type Description Th Ovrld FB_BA_BI_Raw [} 206] The binary input object is used to process the "Thermal overload" fault. Mntn Swi FB_BA_BI_Raw [} 206] The binary input object is used to process a maintenance switch. Flow Swi FB_BA_BI_Raw [} 206] The binary input object is used to process a flow monitor. Flow Monit FB_BA_Fdb Binary [} 1018] Template for monitoring the flow monitor. Dly Off FB_BA_Dly Off [} 1053] The template serves as a delayed pump shutdown. Ablk FB_BA_Anti Blocking Anti-blocking protection. [} 997] Variables Name Type Description Prio Swi Pgm FB_BA_Prio Swi_UDI04 The priority switch Prio Swi Pgm uses the switch-off delay [} 433] Dly Off, the anti-blocking protection function Ablk [} 997] and the priority program of the command structure st Cmd of the base class FB_BA_Mot1st [} 1060] to determine the current switch value for the base class FB_BA_Mot1st [} 1060]. ton Ablk Lock TON Switch-off delay of the anti-blocking protection pulse. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.2.1.0 6.1.4.2.2.6 Sensor Templates for sensors and data acquisition. TF8040 Version: 1.14.0 1083
## Page 1084

Programming 6.1.4.2.2.6.1 FB_BA_Combination BI_BV The template is a combination of a BI and BV object. The binary input object Input logs a binary input value from a bus terminal and outputs it as a boolean process value. In addition, the process value Input is output as a rising edge b Trig BI_Pr Val. The binary value object Value represents a boolean process value. It can be parameterized as a switch or push button by the parameter E_BA_Toggle Mode. The output value of the Value object is also output as a rising edge b Trig BV_Pr Val. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Combination BI_BV EXTENDS FB_BA_View VAR_INPUT CONSTANT Input : FB_BA_BI_Raw; Value : FB_BA_BV_Op; END_VAR VAR_OUTPUT b BI_Pr Val : BOOL; b Trig BI_Pr Val : BOOL; b BV_Pr Val : BOOL; 1084 Version: 1.14.0 TF8040
## Page 1085

Programming b Trig BV_Pr Val : BOOL; END_VAR VAR Trig Input : FB_BA_RFTrig; Trig Value : FB_BA_RFTrig; END_VAR Inputs CONSTANT Name Type Description Input FB_BA_BI_Raw [} 206] Binary input object for displaying a process value. Value FB_BA_BV_Op [} 216] Binary value object for displaying a process value. It can be used as a switch or push button. Outputs Name Type Description b BI_Pr Val BOOL Current value of the binary input object Input. b Trig BI_Pr Val BOOL Current value of the output Qr of the function block Trig Input. b BV_Pr Val BOOL Current value of the binary value object Value b Trig BV_Pr Val BOOL Current value of the output Qr of the function block Trig Value. Variables Name Type Description Trig Input FB_BA_RFTrig The function block generates a rising edge from the output signal of the binary input object Input. Trig Value FB_BA_RFTrig The function block generates a rising edge from the output signal of the binary value object Value. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.6.2 FB_BA_Measured Value Cardinal This template represents at the output, in a hierarchical representation, a collection of four values, which are assigned to the cardinal points. This template can be used to display the external brightnesses for all four cardinal points on one display layer, as shown in the following graphic. TF8040 Version: 1.14.0 1085
## Page 1086

Programming The initialization of the template takes place within the method FB_Init. Syntax FUNCTION_BLOCK FB_BA_Measured Value Cardinal EXTENDS FB_BA_View VAR_INPUT f Val_N : REAL; f Val_S : REAL; f Val_E : REAL; f Val_W : REAL; END_VAR VAR_INPUT CONSTANT MV_N : FB_BA_AI; MV_S : FB_BA_AI; MV_E : FB_BA_AI; MV_W : FB_BA_AI; END_VAR VAR_OUTPUT f Present Value N : REAL; f Present Value S : REAL; f Present Value E : REAL; f Present Value W : REAL; END_VAR Inputs Name Type Description f Val_N REAL Analog input value for "North". f Val_S REAL Analog input value for "South". f Val_E REAL Analog input value for "East". f Val_W REAL Analog input value for "West". 1086 Version: 1.14.0 TF8040
## Page 1087

Programming Inputs CONSTANT Name Type Description MV_N FB_BA_AI [} 191] Analog input object for the "North" value. MV_S FB_BA_AI [} 191] Analog input object for the "South" value. MV_E FB_BA_AI [} 191] Analog input object for the "East" value. MV_W FB_BA_AI [} 191] Analog input object for the "West" value. Outputs Name Type Description f Present Value N REAL Output value for "North". f Present Value S REAL Output value for "South". f Present Value E REAL Output value for "East". f Present Value W REAL Output value for "West". Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.6.3 FB_BA_Sensor Analog The function block MV, within the template, records an analog input value from an I/O bus terminal and converts it into a real process value. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Sensor Analog EXTENDS FB_BA_View VAR_INPUT CONSTANT MV : FB_BA_AI_Raw; END_VAR TF8040 Version: 1.14.0 1087
## Page 1088

Programming VAR_OUTPUT f Present Value : REAL; b Event : BOOL; e Event State : E_BA_Event State; END_VAR Inputs CONSTANT Name Type Description MV FB_BA_AI_Raw [} 195] Analog input object for displaying a process value. Outputs Name Type Description f Present Value REAL Current value of the analog input object MV for displaying a process value. b Event BOOL A TRUE indicates that an event is pending. e Event State E_BA_Event State Outputs the event state of the analog input object MV. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.6.4 FB_BA_Sensor Binary The function block Input logs a binary input value from an I/O bus terminal and outputs it as a boolean process value. The initialization of the template takes place within the method FB_Init. Block diagram Syntax FUNCTION_BLOCK FB_BA_Sensor Binary EXTENDS FB_BA_View VAR_INPUT CONSTANT Input : FB_BA_BI_Raw; END_VAR 1088 Version: 1.14.0 TF8040
## Page 1089

Programming VAR_OUTPUT b Present Value : BOOL; END_VAR Inputs CONSTANT Name Type Description Input FB_BA_BI_Raw [} 206] Binary input object for displaying a process value. Outputs Name Type Description b Present Value BOOL Current value of the binary input object Input to display a process value. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.6.5 FB_BA_Button2Way The template is used to directly link the inputs of a dual push button. The states are represented on a hierarchy level with two objects and made available to the project via the outputs b Present Value1 and b Present Value2. This template is used, for example, for the integration of blind buttons. The initialization of the template takes place within the method FB_Init. Inheritance hierarchy FB_BA_Base FB_BA_Base Publisher FB_BA_Object [} 264] FB_BA_View [} 241] Syntax FUNCTION_BLOCK FB_BA_Button2Way EXTENDS FB_BA_VIEW VAR_INPUT END_VAR VAR_INPUT CONSTANT Swi1 : FB_BA_BI_Raw; Swi2 : FB_BA_BI_Raw; END_VAR VAR_OUTPUT b Present Value1 : BOOL; b Present Value2 : BOOL; END_VAR TF8040 Version: 1.14.0 1089
## Page 1090

Programming Inputs CONSTANT Name Type Description Swi1 FB_BA_BI_Raw [} 206] Binary input object for switch1. Swi2 FB_BA_BI_Raw [} 206] Binary input object for switch2. Outputs Name Type Description b Present Value1 BOOL Output: state switch 1. b Present Value2 BOOL Output: state switch 2. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.7 Smoke Detector 6.1.4.2.2.7.1 FB_BA_Smoke Detector_01 The template is used to display faults and warnings of a duct smoke detector. The binary output object Rst Hw can be used to reset these messages by remote release. The initialization of the template takes place within the method FB_Init. 1090 Version: 1.14.0 TF8040
## Page 1091

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Smoke Detector_01 EXTENDS FB_BA_View VAR_OUTPUT b Smoke Alarm : BOOL; b System Failure : BOOL; b Contamination : BOOL; b Air Flow : BOOL; END_VAR VAR_INPUT CONSTANT Smoke Alarm : FB_BA_BI_Raw; System Failure : FB_BA_BI_Raw; Contamination : FB_BA_BI_Raw; Air Flow : FB_BA_BI_Raw; Rst Hw : FB_BA_BO_Raw; Rst Rm : FB_BA_BV_Op; END_VAR VAR tp Reset Hw : TP; END_VAR Outputs Name Type Description b Smoke Alarm BOOL Current value of the binary input object Smoke Alarm. b System Failure BOOL Current value of the binary input object System Failure. b Contamination BOOL Current value of the binary input object Contamination. b Air Flow BOOL Current value of the binary input object Air Flow. TF8040 Version: 1.14.0 1091
## Page 1092

Programming Inputs CONSTANT Name Type Description Smoke Alarm FB_BA_BI_Raw [} 206] Binary input object is used to process a smoke alarm. System Failure FB_BA_BI_Raw [} 206] Binary input object is used to process a system fault of the duct smoke detector. Contamination FB_BA_BI_Raw [} 206] Binary input object is used to process a pollution of the duct smoke detector. Air Flow FB_BA_BI_Raw [} 206] Binary input object is used to process insufficient air flow. Rst Hw FB_BA_BO_Raw [} 211] Binary output object which triggers a remote release on the smoke detector. Rst Rm FB_BA_BV_Op [} 216] The binary value object Rst Rm triggers a remote release on the smoke detector from the management level. The Rst Rm object is initialized as a button object by the additional parameter e Toggle Mode. Variables Name Type Description tp Reset Hw TP The timing element extends the acknowledgement pulse for interfacing relay circuits (e.g. frost protection relay). Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.8 Valve 6.1.4.2.2.8.1 FB_BA_Vlv The template is used to control a continuous valve with analog inputs and outputs. It mainly consists of the base class FB_BA_Actuator Analog [} 982], the anti-blocking protection function Ablk [} 997] and the AI object Fdb for recording the position feedback from the valve. The valve is switched on externally by the priorities of the command structure st Cmd of the base class FB_BA_Actuator Analog [} 982] or internally by the anti-blocking protection function Ablk [} 997]. The initialization of the template takes place within the method FB_Init. 1092 Version: 1.14.0 TF8040
## Page 1093

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Vlv EXTENDS FB_BA_Actuator Analog VAR_INPUT b Ablk Lock : BOOL; END_VAR VAR_INPUT CONSTANT Ablk : FB_BA_Anti Blocking; Fdb : FB_BA_AI_Raw; END_VAR Inputs Name Type Description b Ablk Lock BOOL A TRUE at this input variable interrupts the anti-blocking protection function Ablk [} 997]. It should be prevented that pumps and valves get an anti-blocking protection pulse at the same time. Inputs CONSTANT Name Type Description Ablk FB_BA_Anti Blocking Anti-blocking protection. [} 997] Fdb FB_BA_AI_Raw [} 195] Analog input object for logging the position feedback of the valve. TF8040 Version: 1.14.0 1093
## Page 1094

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.8.2 FB_BA_Vlv3pt The template is used to control a three-point valve. It mainly consists of the base class FB_BA_Actuator MO [} 991], the function block Anlg3Pnt [} 407] for the analog conversion of the input signal f Val Pgm into a three-point signal and the anti-blocking protection function Ablk [} 997]. The three-point valve is switched on externally by the priorities of the command structure st Cmd of the base class FB_BA_Actuator MO [} 991] or internally by the anti-blocking protection function Ablk [} 997]. The initialization of the template takes place within the method FB_Init. 1094 Version: 1.14.0 TF8040
## Page 1095

Programming Block diagram Syntax FUNCTION_BLOCK FB_BA_Vlv3pt EXTENDS FB_BA_Actuator MO VAR_INPUT f Val Pgm : REAL; b Ablk Lock : BOOL; END_VAR VAR_OUTPUT TF8040 Version: 1.14.0 1095
## Page 1096

Programming b Open : BOOL; b Close : BOOL; END_VAR VAR_INPUT CONSTANT Anlg3Pnt : FB_BA_Analog3Pnt; Ablk : FB_BA_Anti Blocking; END_VAR VAR Prio Swi3pt : FB_BA_Prio Swi_UDI04; Prio Swi Open : FB_BA_MMUX_B04; Prio Swi Close : FB_BA_MMUX_B04; END_VAR Inputs Name Type Description f Val Pgm REAL Continuous input signal for analog conversion to a three- point signal. This can come from a PID controller and have a value from 0...100 %. b Ablk Lock BOOL A TRUE at this input variable interrupts the anti-blocking protection function Ablk [} 997]. It should be prevented that pumps and valves get an anti-blocking protection pulse at the same time. Outputs Name Type Description b Open BOOL Variable for the control Open of the 3-point valve. This variable must be linked to a bus terminal. b Close BOOL Variable for the control Close of the 3-point valve. This variable must be linked to a bus terminal. Inputs CONSTANT Name Type Description Anlg3Pnt FB_BA_Analog3Pnt [} 995] The template Anlg3Pnt converts the analog input signal f Val Pgm into a three-point signal. Ablk FB_BA_Anti Blocking Anti-blocking protection. [} 997] Variables Name Type Description Prio Swi3pt FB_BA_Prio Swi_UDI04 The priority switch Prio Swi3pt determines the current switching value for the priority "Program" of the command [} 433] structure st Cmd on the basis of the analog 3-point converter Anlg3Pnt and the anti-blocking protection function Ablk [} 997]. Prio Swi Open FB_BA_MMUX_B04 [} 428] The multiplexer Prio Swi Open receives the numeric switch value n Cmd from the base class FB_BA_Actuator MO [} 991] and converts the switch value into the 3-point signal b Open. Prio Swi Close FB_BA_MMUX_B04 [} 428] The multiplexer Prio Swi Close receives the numeric switch value n Cmd from the base class FB_BA_Actuator MO [} 991] and converts the switch value into the 3-point signal b Close. 1096 Version: 1.14.0 TF8040
## Page 1097

Programming Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.9 Weather Station Templates for data acquisition from weather stations. 6.1.4.2.2.9.1 Thies 6.1.4.2.2.9.1.1 Integration Thies weather station This manual shows the integration of a Thies weather station Compact WSC11, 4.9056.10.000, using the template "FB_BA_Weatherstation_Thies". Required hardware: • Thies Weather Station Compact WSC11, 4.9056.10.000 (ASCII format) • KL6041, preconfigured to 22 bytes process image Required additional library: • Tc2_Serial Com Adding the template: ü Click on the desired PLC project (1). 1. In the template repository, right-click on the template FB_BA_Weather Station_Thies (2) TF8040 Version: 1.14.0 1097
## Page 1098

Programming 2. Add the template (3) and (4). 1098 Version: 1.14.0 TF8040
## Page 1099

Programming 3. The following dialog with the list of additionally implemented function blocks opens. Close the dialog with OK. TF8040 Version: 1.14.0 1099
## Page 1100

Programming 4. All new PLC function blocks are now dragged into a folder Templates and can be distributed in the project if required. 1100 Version: 1.14.0 TF8040
## Page 1101

Programming ð In the standard PLC project a weather station template FB_BA_Weatherstation_Draft is already included, which contains all necessary display objects and is intended for individual linking. Adding a fast task for serial communication The serial terminal (KL6041) is configured to the following communication parameters during a PLC restart: • Baud rate: 9600 TF8040 Version: 1.14.0 1101
## Page 1102

Programming • Data bits: 8 • Parity: none • Stop bits: 1 • Handshake: RS485 HALFDUPLEX The process image must be set to 22 bytes beforehand. After that the actual communication between terminal and weather station starts. The function blocks required for this are available in the Tc2_Serial Com library and are called in the "Fast Cycle" method of the "FB_BA_Weatherstation_Thies" template. This call must be assigned to a faster task than the normal PLC cycle task. 1. Right-click POU to open the new window, select add (1) and POU (2). 1102 Version: 1.14.0 TF8040
## Page 1103

Programming 2. A window opens. Enter the name there (example MAIN_fast) (3). The POU type is a program in structured text (ST). ð In this program, the method Fast Cycle is now called. TF8040 Version: 1.14.0 1103
## Page 1104

Programming 3. Add a new item (2) by right-clicking on Tasks (1). Name it with a meaningful name, for example Fast Task (3). 1104 Version: 1.14.0 TF8040
## Page 1105

Programming ð This new task must now be set to a small cycle time. The 5 ms shown here are a recommendation ð A task reference must be created so that this task is available to the program part: TF8040 Version: 1.14.0 1105
## Page 1106

Programming 4. Right-click on the project (1), select add (2) then taskreference (3). A window opens. There, select the Task to which the reference should refer (4). ð The task reference now appears in the PLC part below. The function block that is to be called in this task can now be assigned to it. 1106 Version: 1.14.0 TF8040
## Page 1107

Programming 5. Open a dialog by right-clicking on the task Fast Task(1), select add (2) and then existing item (3). TF8040 Version: 1.14.0 1107
## Page 1108

Programming ð A window will open where you can select the call program. Adding the serial communication library Dragging in the template "FB_BA_Weather Station_Thies" does not automatically add the required serial communication library. This must be inserted manually: 1108 Version: 1.14.0 TF8040
## Page 1109

Programming Right-click on "References" (1) and select "Add Library" (2). In the window that opens, select the "Tc2_Serial Com" library (3) and confirm with "OK" (4). TF8040 Version: 1.14.0 1109
## Page 1110

Programming Creating program links The link variables for the process image of the serial terminal are located in the "FB_BA_Weather Station_Thies" template. However, just because of the implementation of the template, they are not automatically available for linking. To do this, the solution must be rebuilt once. It is important at this point that no other compilation errors occur in the program. Under "Build", select "Rebuild Solution". At this point, only the already existing PLC task has a process image. 1110 Version: 1.14.0 TF8040
## Page 1111

Programming After an error-free creation, the link variables of the template are available and the Fast Task also holds a process image area. TF8040 Version: 1.14.0 1111
## Page 1112

Programming First, all input variables of the terminal process image are marked (click on status and then press the arrow down key while holding down the shift key) (1), then right-click and select "Multi-link" (2). Link to "st Raw Data In" of the template. 1112 Version: 1.14.0 TF8040
## Page 1113

Programming The linking of the output data is done analogously. TF8040 Version: 1.14.0 1113
## Page 1114

Programming 6.1.4.2.2.9.1.2 FB_BA_Thies WSC11 Function block for cyclic reading and processing of serial data from a Thies WSC11 weather station. This function block converts the serial data into a defined structure. Syntax VAR_INPUT b Rst : BOOL; END_VAR VAR_INPUT CONSTANT PERSISTENT n Update Time : UDINT; n Config Timeout : UDINT; n Max Cycles Old Data : UDINT; n Wnd Dat Avrg Int Val : UDINT; b Wnd Spd LEDOn : BOOL; b Twi Lgt Calc Avrg : BOOL; n Wnd Dir North Offs : UDINT; n St Hgt AMSL : UDINT; n Rain Off Dly : UDINT; n Dist Msg Dly : UDINT; END_VAR VAR_OUTPUT st WSC11Data : ST_BA_WSC11Data; b Err : BOOL; s Err Descr : T_Max String; END_VAR VAR_IN_OUT TXBuffer : Com Buffer; RXBuffer : Com Buffer; END_VAR Inputs Name Type Description b Rst BOOL A rising edge at this input triggers a software reset within the weather station. 1114 Version: 1.14.0 TF8040
## Page 1115

Programming Inputs CONSTANT PERSISTENT Name Type Description n Update Time UDINT Data retrieval interval [500…60000 ms]. n Config Timeout UDINT Timeout for the configuration routine [s]. n Max Cycles Old Data UDINT Maximum number of read cycles with identical data: beyond this, it is considered an error - possibly caused by wire break. n Wnd Dat Avrg Int Val UDINT Averaging interval of wind direction and wind speed [1…10 min], 0 = off. b Wnd Spd LEDOn BOOL A TRUE indicates the event "Wind" via the blue LED on the weather station. b Twi Lgt Calc Avrg BOOL Selection of the value calculation for twilight: FALSE: the sum of the 4 light sensors is used. TRUE: the average value of the 4 light sensors is used. n Wnd Dir North Offs UDINT Offset for wind direction [0...360°]. This can be used to correct the north direction. n St Hgt AMSL UDINT Station height above sea level [0...3000 m]. n Rain Off Dly UDINT Release delay of rain detection [0…3600 s]. n Dist Msg Dly UDINT Delay of error messages [0...60 s]. Outputs Name Type Description st WSC11Data ST_BA_WSC11Data [} 706] Output of the data b Err BOOL Error s Err Descr T_Max String Textual error description Inputs/outputs Name Type Description TXBuffer / RXBuffer Com Buffer Serial data exchange with the reading function block Serial Line Control in the fast task. Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.2.2.9.1.3 FB_BA_Thies Data In this function block, data from the Thies weather station are converted so that they can be represented with BACnet objects. This concerns only the brightness values of the 4 cardinal points: while the weather station outputs these in kilolux, BACnet only provides the unit lux for the representation, therefore the values of the weather station have to be multiplied by 1000. TF8040 Version: 1.14.0 1115
## Page 1116

Programming Syntax FUNCTION_BLOCK FB_BA_Thies Data VAR_INPUT st WSC11Data : ST_BA_WSC11Data; END_VAR VAR_OUTPUT st Weather Station : ST_BA_Weather Station; END_VAR Inputs Name Type Description st WSC11Data ST_BA_WSC11Data [} 706] Data from the Thies weather station. Outputs Name Type Description st Weather Station ST_BA_Weather Station Converted data [} 705] Requirements Development environment Necessary function Twin CAT from v3.1.4024.35 TF8040 | Twin CAT Building Automation from V5.0.0.0 6.1.4.3 GVLs 6.1.4.3.1 Site The site GVL is a list of global variables which are required system-wide by all automation stations of a GA network. The data is used to control and regulate the plant and room automation. The distribution of the data within the GA network is organized by means of the templates FB_BA_Ads Com Client and FB_BA_Ads Com Server. Regardless of whether it is the server or a client of the data within the GA network, all templates that create or read data always read or write to the GVL site. Thus, the same GVL site is located in each automation station. In the clients, e.g. of a floor controller for room automation, the data within the template FB_BA_Ads Com Client is read from the server via ADS and copied to the GVL. All room automation templates then access this data from the GVL site. In the IPC, which provides the data within the GA network, the template FB_BA_Ads Com Server is called. The system topology of the TF8040 templates provides that this data is generated by an IPC within the building and distributed with the function blocks FB_BA_Raw Publisher [} 139] and FB_BA_Raw Subscriber [} 158]. Illustration VAR_GLOBAL Self_Net Id : T_BA_Med String := '127.0.0.1.1.1'; ACE01_Net Id : T_BA_Med String := Self_Net Id; ACE02_Net Id : T_BA_Med String := Self_Net Id; ACE03_Net Id : T_BA_Med String := Self_Net Id; ACE04_Net Id : T_BA_Med String := Self_Net Id; ACE05_Net Id : T_BA_Med String := Self_Net Id; General Settings_Subject : T_BA_Med String := 'General Settings'; General Settings_Net Id : T_BA_Med String := Self_Net Id; 1116 Version: 1.14.0 TF8040
## Page 1117

Programming Weather Station_Subject : T_BA_Med String := 'Weather Station'; Weather Station_Net Id : T_BA_Med String := Self_Net Id; Facade North_Net Id : T_BA_Med String := ACE01_Net Id; Facade North_Subject : T_BA_Med String := 'Fcd North. Facade Sun Blind'; Facade East_Net Id : T_BA_Med String := ACE01_Net Id; Facade East_Subject : T_BA_Med String := 'Fcd East. Facade Sun Blind'; Facade South_Net Id : T_BA_Med String := ACE01_Net Id; Facade South_Subject : T_BA_Med String := 'Fcd South. Facade Sun Blind'; Facade West_Net Id : T_BA_Med String := ACE01_Net Id; Facade West_Subject : T_BA_Med String := 'Fcd West. Facade Sun Blind'; Building_Net Id : T_BA_Med String := ACE01_Net Id; Building Alarms_Subject : T_BA_Med String := 'Building Alarms'; Building Mode_Subject : T_BA_Med String := 'Building Mode'; Building Energy Level_Subject : T_BA_Med String := 'Building Energy Level'; Building Sp Rm T_Subject : T_BA_Med String := 'Building Sp Rm T'; Building Sun Protection_Subject : T_BA_Med String := 'Building Sun Protection'; st General Settings : ST_BA_General Settings; // published by FB_BA_Settings b General Settings_Error : BOOL; e Building Energy Level : E_BA_Energy Lvl Ex; // published by FB_BA_Building Energy Level b Building Energy Level_Error : BOOL; e Building Mode : E_BA_Building Mode; // published by FB_BA_Building Mode b Building Mode_Error : BOOL; st Building Sun Blind : ST_BA_Building Sun Blind; // published by FB_BA_Building Sunprotecti on b Building Sun Blind_Error : BOOL; st Building Alarms : ST_BA_Building Alarms; // published by FB_BA_Building Alarms b Building Alarms_Error : BOOL; st Weather Station : ST_BA_Weather Station; // published by FB_BA_Weather Station_xxx b Weather Station_Error : BOOL; st Facade North Sun Blind : ST_BA_Facade; // published by FB_BA_Facade b Facade North Sun Blind_Error : BOOL; st Facade East Sun Blind : ST_BA_Facade; // published by FB_BA_Facade b Facade East Sun Blind_Error : BOOL; st Facade South Sun Blind : ST_BA_Facade; // published by FB_BA_Facade b Facade South Sun Blind_Error : BOOL; st Facade West Sun Blind : ST_BA_Facade; // published by FB_BA_Facade b Facade West Sun Blind_Error : BOOL; st Building Sp Rm T : ST_BA_Sp Rm T; // Published by FB_BA_Building Sp Rm T b Building Sp Rm T_Error : BOOL; END_VAR 6.1.4.3.2 Sys Time The global variable list contains the local NT system time of the Twin CAT system. The variables may only be written once per controller. {attribute 'qualified_only'} VAR_GLOBAL st System Time : TIMESTRUCT; st System Time UTC : TIMESTRUCT; dt System Time : DT; dt System Time UTC : DT; END_VAR 6.1.4.3.3 Event Classes ID EC_ID The global variable list specifies the event class number for the message class objects and the alarm- capable objects. Illustration {attribute 'qualified_only'} VAR_GLOBAL CONSTANT NC10 : UDINT := 10; NC20 : UDINT := 20; NC30 : UDINT := 30; NC40 : UDINT := 40; NC50 : UDINT := 50; NC51 : UDINT := 51; TF8040 Version: 1.14.0 1117
## Page 1118

Programming NC60 : UDINT := 60; NC70 : UDINT := 70; NC80 : UDINT := 80; END_VAR Name Type Description NC10 UDINT Danger to life NC20 UDINT Safety message NC30 UDINT Alarm message NC40 UDINT Fault message NC50 UDINT Maintenance message NC51 UDINT Maintenance message NC60 UDINT System message NC70 UDINT Manual intervention NC80 UDINT Other messages 6.1.4.3.4 BA2_Param The global variable list contains general parameters to initialize objects. Illustration {attribute 'qualified_only'} {attribute 'strict'} VAR_GLOBAL CONSTANT f AP : REAL := 1013.25; n Def Time Delay_To Abnormal : UDINT := 1; n Def Time Delay_To Normal : UDINT := 1; f Def COVIncrement : REAL := 0.1; f Def Limit Deadband : REAL := 0.0; n Loop_Def Op Mode : E_BA_PIDMode := E_BA_PIDMode.e P1ID; st Trend_Def Start Time : ST_BA_Date Time := (); st Trend_Def Stop Time : ST_BA_Date Time := (); n Trend_Buffer Size : UDINT:= 500; b Trend_Def Log Enable : BOOL := FALSE; b Trend_Def Stop On Full : BOOL := FALSE; n Trend_Def Log Interval : UDINT := 90; n Trend_Def Notification Threshold : UDINT := 50; e Trend_Def Logging Type : E_BA_Logging Type := E_BA_Logging Type.e Polled; END_VAR VAR_GLOBAL b Blink : BOOL; b Dly Start PLC : BOOL := TRUE; END_VAR 1118 Version: 1.14.0 TF8040
## Page 1119

Programming VAR_GLOBAL CONSTANT Name Type Description f AP REAL Global constant Hydrostatic air pressure. The mean air pressure of the earth's atmosphere at sea level is 1013.25 h Pa. n Def Time Delay_To A UDINT Default value for the parameter Time delay of transitions to bnormal abnormal states. n Def Time Delay_To N UDINT Default value for the parameter Time delay of transitions to ormal normal states. f Def COVIncrement REAL Default value for the COV increment parameter. f Def Limit Deadband REAL Default value for the Dead band limit parameter. n Loop_Def Op Mode E_BA_PIDMode Default value for the Operation mode parameter. st Trend_Def Start Tim ST_BA_Date Time Default value for the Start time parameter. e st Trend_Def Stop Tim ST_BA_Date Time Default value for the Stop time parameter. e n Trend_Buffer Size UDINT Number of entries in a trend buffer. b Trend_Def Log Enab BOOL Enabling trend logging. le b Trend_Def Stop On F BOOL FALSE, Ring buffer; TRUE, Fixed memory that does not ull store anything when the buffer is full. n Trend_Def Log Inter UDINT Default value for the Logging interval parameter. val n Trend_Def Notificati UDINT Default value for the Notification threshold parameter. on Threshold e Trend_Def Logging E_BA_Logging Type Default value for the Logging type parameter. Type VAR_GLOBAL Name Type Description b Blink BOOL Global blink pulse. The blink pulse is generated in the template FB_BA_Control Cabinet Basic [} 825]. b Dly Start PLC BOOL The variable is set to TRUE delayed after a restart of the PLC. In the template FB_BA_Device [} 830] this delay is implemented by the timing element ton Dly Start PLC. 6.1.4.3.5 Priority The global variable list uses XBA_BACnet Param from the Tc3_XBA library to determine the BACnet plant priorities. The chapter Commanding [} 34] contains further information on the subject of priorities. Syntax VAR_GLOBAL n Program : UDINT := TO_UDINT(LIMIT(1,XBA_BACnet Param.a Priority[2],16)); n Manual Remote : UDINT := TO_UDINT(LIMIT(1,XBA_BACnet Param.a Priority[3],16)); n Manual Local : UDINT := TO_UDINT(LIMIT(1,XBA_BACnet Param.a Priority[4],16)); n Critical : UDINT := TO_UDINT(LIMIT(1,XBA_BACnet Param.a Priority[5],16)); n Life Safety : UDINT := TO_UDINT(LIMIT(1,XBA_BACnet Param.a Priority[6],16)); END_VAR TF8040 Version: 1.14.0 1119
## Page 1120

Programming Name Type Description n Program UDINT Priority "Program", program control. n Manual Remote UDINT Priority "Manual Remote", remote manual override (MBE). n Manual Local UDINT Priority "Manual Local", local manual override (LVB). n Critical UDINT Priority "Critical", plant safety. n Life Safety UDINT Priority "Life Safety", personal safety. 6.2 HMI 6.2.1 Tc Hmi Ba Tc Hmi Ba is an extension of the Twin CAT HMI for building automation applications. The integrator should be made as easy as possible to create an HMI, for example for a heating system, ventilation system or the entire HVAC technology of a building. With this solution it is also possible to map and operate the room automation in a building. Tc Hmi Ba supports some functions of a classic management and control level (MCL). Note that Tc Hmi Ba is not a MCL. Contents The easy creation of HMIs for building automation is enabled by Tc Hmi Ba by providing various controls [} 1122] and icons [} 1231]. Generic HMI For integrators using the complete TF8040 solution, there is also the option of accessing generic functions [} 54] from Tc Hmi Ba, which further simplify and accelerate engineering. System requirements • TF8040 (current version) • TE2000 • Google™ Chrome™ / Chromium™ (support for other browsers to follow) Open source software Various open source software is used in the components of Tc Hmi Ba. The license texts can be found in the respective folders: • Development system: ◦ Tc Hmi Ba Framework: §Project Path§/Packages/Beckhoff. Twin CAT. HMI. BA. Framework/runtimes/ native/Legal ◦ Ba Site Extension: §Project Path§/Packages/Beckhoff. Twin CAT. HMI. BA. Ba Site/runtimes/any/native/ Legal • Target system: ◦ Tc Hmi Ba Framework: C:\Program Data\Beckhoff\TF2000 Twin CAT 3 HMI Server\service\Tc Hmi Project\www\Beckhoff. Twin CAT. HMI. BA. Framework\Legal ◦ Ba Site Extension: C:\Program Data\Beckhoff\TF2000 Twin CAT 3 HMI Server\service\Tc Hmi Project\Ba Site\Legal 1120 Version: 1.14.0 TF8040
## Page 1121

Programming 6.2.1.1 Introduction Tc Hmi Ba is an extension of the Twin CAT HMI for building automation applications. The integrator should be made as easy as possible to create an HMI, for example for a heating system, ventilation system or the entire HVAC technology of a building. With this solution it is also possible to map and operate the room automation in a building. Tc Hmi Ba supports some functions of a classic management and control level (MCL). However, it should be noted that Tc Hmi Ba is not an MBE. Contents The easy creation of HMIs for building automation projects is enabled by Tc Hmi Ba by providing various controls [} 1122] and icons [} 1231]. Generic HMI For integrators using the complete TF8040 solution, there is also the option of accessing generic functions [} 54] from Tc Hmi Ba, which further simplify and accelerate engineering. Open source software Various open source software is used in the components of Tc Hmi Ba. The license texts can be found in the respective folders: • Development system: ◦ Tc Hmi Ba Framework: §Project Path§/Packages/Beckhoff. Twin CAT. HMI. BA. Framework/runtimes/ native/Legal ◦ Ba Site-Extension: §Projekt Pfad§/Packages/Beckhoff. Twin CAT. HMI. BA. Ba Site/runtimes/any/ native/Legal • Target system: ◦ Tc Hmi Ba Framework: C:\Program Data\Beckhoff\TF2000 Twin CAT 3 HMI Server\service\Tc Hmi Project\www\Beckhoff. Twin CAT. HMI. BA. Framework\Legal ◦ Ba Site-Extension: C:\Program Data\Beckhoff\TF2000 Twin CAT 3 HMI Server\service\Tc Hmi Project\Ba Site\Legal 6.2.1.1.1 System requirements For the development system: • Twin CAT HMI Engineering For the target system • Twin CAT HMI Server The Nu Get packages included are divided into two areas. Client packages • Beckhoff. Twin CAT. HMI. BA. Icons • Beckhoff. Twin CAT. HMI. BA. Framework • Beckhoff. Twin CAT. HMI. BA. Controls The following system requirements apply to the Client packages: • Chrome engine (e.g. Microsoft Edge®, Google Chrome®, Chromium®) When using web browsers with a different engine, proper function and display is not guaranteed. TF8040 Version: 1.14.0 1121
## Page 1122

Programming Server packages • Beckhoff. Twin CAT. HMI. BA. Ba Site The following system requirements apply to the Server packages: • at least Windows 10 on the development and target system • . NET Desktop Runtime > v6.0 6.2.1.2 Controls The following pages describe the content and functions of the Nu Get package Beckhoff. Twin CAT. HMI. BA. Controls. The main focus is on the attributes and functions of the controls that can be used in the Designer. A Tc Hmi Ba control is implemented as a Tc Hmi-Framework Control and provides various functionalities of TF8040 in graphical form. Although the creation involves more effort, the result is a more performant and convenient control for the user. Installation The Nu Get package Beckhoff. Twin CAT. HMI. BA. Controls must be installed in order to use the controls and functions. 1122 Version: 1.14.0 TF8040
## Page 1123

Programming The package depends on the following packages and therefore installs them as well: • Beckhoff. Twin CAT. HMI. Framework • Beckhoff. Twin CAT. HMI. Controls • Beckhoff. Twin CAT. HMI. BA. Framework [} 1242] • Beckhoff. Twin CAT. HMI. BA. Icons [} 1231] 6.2.1.2.1 Building General 6.2.1.2.1.1 Building Information The Building Information control initially appears like a normal button [} 1130]. It is designed to display various building or facade specific information. TF8040 Version: 1.14.0 1123
## Page 1124

Programming Use Use on any page (e.g. in the header). Features If the window is not open, the amount of relevant information is displayed in the corner of the button. This includes: • Fire alarm • Burglar alarm • Ice alarm • Maintenance • Storm alarm The status of the sun protection or the thermal automatic can only be viewed when the window is open. If an alarm becomes active, all controls that depend on building information are notified. This applies to: • Sunblind [} 1210] • Window [} 1214] Attributes The control inherits from the button [} 1130] and thus has the same attributes. In addition, there are the following attributes. Common Fire Alarm tchmi:general#/definitions/Boolean If TRUE, the fire alarm is displayed. Burglar Alarm tchmi:general#/definitions/Boolean If TRUE, the burglar alarm is displayed. Ice Alarm tchmi:general#/definitions/Boolean If TRUE, the ice alarm is displayed. Thermal Automatic tchmi:general#/definitions/Boolean If TRUE, the thermal automatic is displayed. Facades tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Building Information. Facades Create different facades that can then be referenced by corresponding controls (see above). 6.2.1.2.1.2 Legend The Legend control displays all icons on the active web page with their description. Use Use on any page where you want to display an explanation of the icons. 1124 Version: 1.14.0 TF8040
## Page 1125

Programming Features Provides static and dynamic display of icons and allows adding additional icons. Display The icons can be displayed statically on the web page or dynamically (event-driven) by calling the Open Legend Dialog [} 1256] function. Additional icons Local Additional icons can be added to the respective instance of the legend via the Icon Data Custom [} 1126] attribute. When the function is called, the attribute is in the parameter list. Global Icons to be displayed by each legend instance must be added via a Twin CAT HMI Internal Symbol. The symbol must have the name Ba Legend Icon Data List and be of type Tc Hmi. Building Automation. Controls. Building General. Legend. Icon Data List Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. Common Show Headline tchmi:general#/definitions/Boolean TF8040 Version: 1.14.0 1125
## Page 1126

Programming Sets the visibility of the title. Entry Width tchmi:framework#/definitions/Measurement Value Width of an entry. Entry Width Unit tchmi:framework#/definitions/Measurement Unit Unit of width of an entry. Tab Position tchmi:framework#/definitions/Tc Hmi. Building Automation. Position Position of the tabs. Icon Data Source tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Building General. Legend. Icon Data Source Selection of entries to be displayed. Icon Data Custom tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Building General. Legend. Icon Data List List with additional entries. 6.2.1.2.1.3 Weather Station The Weather Station template displays the weather data. Use Use on any page where a template of the Weather Station type is to be displayed. Compatibility The Ba Template Description supports the following Ba Objects. Subelements: 1126 Version: 1.14.0 TF8040
## Page 1127

Programming Symbol name PLC template Description Dstb FB_BA_Sensor Binary [} 1088] Fault Rain FB_BA_Sensor Binary [} 1088] Rain Wth T FB_BA_Sensor Analog [} 1087] Outside temperature Dew Pt T FB_BA_Sensor Analog [} 1087] Dew point Prss Abs FB_BA_Sensor Analog [} 1087] Air pressure (absolute) Prss Rel FB_BA_Sensor Analog [} 1087] Air pressure (relative) Hum Abs FB_BA_Sensor Analog [} 1087] Air humidity (absolute) Hum Rel FB_BA_Sensor Analog [} 1087] Air humidity (relative) Brightness FB_BA_Measured Value Cardinal [} 1085] Brightness Dawn FB_BA_Sensor Binary [} 1088] Dawn Glob Radn FB_BA_Sensor Analog [} 1087] Solar radiation Wnd Dir FB_BA_Sensor Analog [} 1087] Wind direction Wnd Spd FB_BA_Sensor Analog [} 1087] Wind speed Latd FB_BA_Sensor Analog [} 1087] Latitude Lngt FB_BA_Sensor Analog [} 1087] Longitude Sun Azm FB_BA_Sensor Analog [} 1087] Sun direction Sun Elv FB_BA_Sensor Analog [} 1087] Sun elevation Hierarchy: • Ba Object ◦ Dstb ◦ Rain ◦ Wth T ◦ Dew Pt T ◦ Prss Abs ◦ Prss Rel ◦ Hum Abs ◦ Hum Rel ◦ Brightness ◦ Dawn ◦ Glob Radn ◦ Wnd Dir ◦ Wnd Spd ◦ Latd ◦ Lngt ◦ Sun Azm ◦ Sun Elv Corresponds to the PLC templates: • FB_BA_Weather Station_Draft [} 853] • FB_BA_Weather Station_Thies [} 855] Attributes The control inherits from Base Template and thus has the same attributes. In addition, there are the following attributes. TF8040 Version: 1.14.0 1127
## Page 1128

Programming BA Ba Template Description tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Building General. Weather Station. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. Common Show Position tchmi:general#/definitions/Boolean Determines whether the values for the position are visible. Show Temperature tchmi:general#/definitions/Boolean Determines whether the values for the temperature are visible. Show Air Pressure tchmi:general#/definitions/Boolean Determines whether the values for the air pressure are visible. Show Humidity tchmi:general#/definitions/Boolean Determines whether the values for the air humidity are visible. Show Sun tchmi:general#/definitions/Boolean Determines whether the values for the sun are visible. Show Brightness tchmi:general#/definitions/Boolean Determines whether the values for the brightness are visible. Show Wind tchmi:general#/definitions/Boolean Determines whether the values for the wind are visible. Show Wind Compass tchmi:general#/definitions/Boolean Determines whether the wind compass is visible. 6.2.1.2.2 Common 6.2.1.2.2.1 Bullet Point List The Bullet Point List lists various texts in bullet point form. 1128 Version: 1.14.0 TF8040
## Page 1129

Programming Use Use on any page where a bullet point list is to be displayed. Features Change of the bullet by the attribute List Style Type. Numbering of the entries through the corresponding selection of the List Style Type attribute. Change of the bullet by the attribute List Style Image. Attributes The control inherits from Text Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Entries tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Bullet Point List. Entries Bullet points to be displayed in the Bullet Point List. List Style Type tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Common. Bullet Point List. List Style Types TF8040 Version: 1.14.0 1129
## Page 1130

Programming Type of the bullet. If String is selected, the text entered is used as a bullet without interpretation. List Style Image tchmi:framework#/definitions/Path Path to the image of the bullet. 6.2.1.2.2.2 Button The button is essentially the same as the Tc Hmi Button. The only difference is extended functionalities for the icon, because the options of the icon package can be used here. Use Can be used wherever a button with extended icon functionality is required. Features Provides advanced functionality for icons from the Nu Get package Tc Hmi Ba. Icons [} 1231]. Attributes The control inherits from Text Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Icon tchmi:framework#/definitions/Path Path to the icon. Icon Width tchmi:general#/definitions/Number Width of the icon. Icon Width Unit tchmi:general#/definitions/Measurement Unit Unit of the width of the icon. Icon Height tchmi:general#/definitions/Number Height of the icon. Icon Height Unit tchmi:general#/definitions/Measurement Unit Unit of the height of the icon. Icon Horizontal Alignment tchmi:general#/definitions/Horizontal Alignment Definition of the horizontal alignment of the icon within the button. 1130 Version: 1.14.0 TF8040
## Page 1131

Programming Icon Vertical Alignment tchmi:general#/definitions/Vertical Alignment Definition of the vertical alignment of the icon within the button. Icon Rotation tchmi:general#/definitions/Number Determines by how many degrees the icon should be rotated. Icon Rotation Speed tchmi:general#/definitions/Number Determines the speed at which the icon should rotate. Icon Rotation Direction tchmi:general#/definitions/Tc Hmi. Building Automation. Controls. Direction Determines the direction in which the icon rotates if the attribute Icon Rotation Speed is defined. The default value is clockwise. Icon Overlays tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Common. Icon. Overlay List Defines overlays of the icon. Legend Show In Legend tchmi:general#/definitions/Boolean Specifies whether the icon is visible in the legend. Category tchmi:general#/definitions/String Specifies the category of the icon in the legend. Description tchmi:general#/definitions/String Specifies the description text of the icon in the legend. Events Event Description on Button Pressed Triggered when the button is pressed. on Button Double Pressed Triggered when a double click on the button has been performed. The velocity for detecting a double click can be set globally [} 1269]. 6.2.1.2.2.3 Calendar The control Calendar is used to display and manage exceptions to a schedule and select a date. TF8040 Version: 1.14.0 1131
## Page 1132

Programming Use Use on any page where a date is to be selected. If a Schedule object is passed to the Ba Object [} 1135] attribute in the Event Calendar display mode, the exceptions of a time schedule can also be displayed or edited. Features Provides two different display modes, the ability to manage exceptions and a color highlighting of related exceptions when the mouse pointer is over them. Date Picker A space-saving view of a calendar. Returns the selected date via an event. Event Calendar The Event Calendar is available in the month view and in the year view. Month view An event-oriented view of a calendar. It returns the selected date via an event and offers the option to manage an exception by clicking on it. 1132 Version: 1.14.0 TF8040
## Page 1133

Programming Year view An overview of all days of the year with marking of the days on which at least one exception is active. Selecting a month changes to the month view. TF8040 Version: 1.14.0 1133
## Page 1134

Programming Menu In the upper right corner there are buttons for quick access and other actions. Quick access: • Today: Jumps to the current date. • View: Switches between the month and year view. Other actions: • Show/Hide: Shows or hides exceptions. • Add: Adds local exceptions. • Save: Writes all changes to the PLC. • Reset: Discards all unconfirmed changes. Local exceptions Entries in the a Exception collection of a Schedule object (e.g. FB_BA_Sched M [} 225]) are regarded as local exceptions. In the upper area, you can set the date or the repetition type of the local exception. Below this, the time periods with the applicable values can be set. The automatic numbering of the local exceptions starts at 1. Global exceptions (calendar reference) Entries in the a Calendar collection of a Schedule object (e.g. FB_BA_Sched M [} 225]) are regarded as global exceptions. 1134 Version: 1.14.0 TF8040
## Page 1135

Programming For global exceptions, only the time periods and applicable values can be defined. The date or the repetition type must be configured in the referenced Calendar object (e.g. FB_BA_Cal [} 217]). The automatic numbering of the global exceptions starts at 100. Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Display Mode Determines the display mode of the calendar. Display View Determines the view of the calendar in the Event Calendar display mode. Show Menu Sets the visibility of the menu. Events Event Description on Date Changed Returns the selected date. 6.2.1.2.2.4 Checkbox The checkbox shows or edits binary values. TF8040 Version: 1.14.0 1135
## Page 1136

Programming Use Can be used on any page where binary values are to be displayed or edited. Special features The active and inactive text can be set (e.g. "On" / "Off"). The appearance can be customized using the Appearance [} 1136] attribute (see image above). Possibility to link a Ba Object [} 1136] to have to create only a single binding. All the required attributes are then linked via this binding and changes to the value are automatically written back to the PLC. Attributes The control inherits from Text Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Feedback concept The control can use the feedback concept [} 60]. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Active Text tchmi:general#/definitions/String Specifies the text that is displayed if State is TRUE. Inactive Text tchmi:general#/definitions/String Specifies the text that is displayed if State is FALSE. Appearance tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Checkbox. Appearance Determines how the checkbox appears at the top. 1136 Version: 1.14.0 TF8040
## Page 1137

Programming Colors Check Background Color tchmi:general#/definitions/Solid Color Background color of the checkbox if State is TRUE. This attribute has no effect if Appearance is set to Toggle Slider. Checkmark Color tchmi:general#/definitions/Solid Color Color of the check mark or toggle. Ba Data Ba Interface tchmi:framework#/definitions/Symbol Symbol that fulfills the Ba Interface [} 62] of the control. Ba Interface Symbol Names tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Common. Checkbox. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. State tchmi:general#/definitions/Boolean State of the checkbox. State Feedback tchmi:general#/definitions/Boolean Feedback for the state of the checkbox. Events Event Description on State Changed Triggered when the value of State has changed. on User Interaction Finished Triggered when the user interaction with the checkbox has finished. 6.2.1.2.2.5 Color Picker The Color Picker can be used to select a color from various color palettes. TF8040 Version: 1.14.0 1137
## Page 1138

Programming Use Can be used on any page where it is necessary to select a color. Features Color selection can be done using different color spaces. HSL Ring All colors are selected without shading. HSV Circle Selection of all colors up to white. HSL Rect All color Selection of all colors up to black. 1138 Version: 1.14.0 TF8040
## Page 1139

Programming HSL Rect single Selection of all shades of a color. To change the color, change the attribute Background Color. Attributes The control inherits from Tc Hmi Control and thus has the same attributes. In addition, there are the following attributes. Color Plate Type tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Color Plate Type Defines the color palette used. Background Color tchmi:framework#/definitions/Solid Color Determines the background color when the Hsl Rect1 color palette is selected. Selected Solid Color (read-only) tchmi:framework#/definitions/Solid Color Selected color. Selected Rgba Color (read-only) tchmi:framework#/definitions/Tc Hmi. Building Automation. RGBAColor Selected color in RGBA format. Events Event Description on Selected Color Changed Triggered when the selected color has changed. 6.2.1.2.2.6 Combo box The Combobox shows or edits multistate values. Use Can be used on any page where multistate values are to be displayed or edited. TF8040 Version: 1.14.0 1139
## Page 1140

Programming Features Possibility to link a Ba Object [} 1140] to have to create only a single binding. All the required attributes are then linked via this binding and changes to the value are automatically written back to the PLC. Attributes The control inherits from Text Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Feedback concept The control can use the feedback concept [} 60]. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Data tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Common. Combobox. Combobox Items Data for the combo box. Colors Button Color tchmi:framework#/definitions/Solid Color Color of the button that opens the dropdown list. Button Arrow Color tchmi:framework#/definitions/Solid Color Color of the arrow in the button. Ba Data Ba Interface tchmi:framework#/definitions/Symbol Symbol that fulfills the Ba Interface [} 62] of the control. Ba Interface Symbol Names tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Common. Combobox. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Selected Data (read-only) tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Common. Combobox. Combobox Item 1140 Version: 1.14.0 TF8040
## Page 1141

Programming Currently selected data. Selected Value tchmi:general#/definitions/Number Value of the currently selected data. Use Selected Value Feedback tchmi:general#/definitions/Boolean Determines whether or not the attribute Selected Value Feedback is used. Selected Value Feedback tchmi:general#/definitions/Number Feedback for the selected value. Events on Changed Triggered when the selected value has changed. This happens when the user selects a new entry. Events Event Description on Selected Value Changed Triggered when the selected value has changed. on User Interaction Finished Triggered when the user interaction with the combo box has finished. 6.2.1.2.2.7 Date Time Field The Date Time Field can be used to select or display a date and time. Use Use on any page where date values are to be displayed or edited. Features If the attribute Read Only [} 1194] is FALSE, the Date Time Picker can be opened via the button to select a new date or time. TF8040 Version: 1.14.0 1141
## Page 1142

Programming Attributes The control inherits from Text Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Common Date Time tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Ba Date Time Current value of time and date. Events Event Description on Date Changed Triggered when the value of the date or time has changed. on User Interaction Finished Triggered when the user interaction with the Date Time Field has finished. 6.2.1.2.2.8 Icon The icon essentially corresponds to the Tc Hmi Image. The only difference is extended functionalities for the icon, because the options of the icon package [} 1233] can be used here. Use Use wherever an icon is required. 1142 Version: 1.14.0 TF8040
## Page 1143

Programming Features Provides advanced functionality for icons from the Nu Get package Tc Hmi Ba Icons [} 1231]. Attributes Icon tchmi:framework#/definitions/Path Path to the icon. Icon Width tchmi:general#/definitions/Number Width of the icon. Icon Width Unit tchmi:general#/definitions/Measurement Unit Unit of the width of the icon. Icon Height tchmi:general#/definitions/Number Height of the icon. Icon Height Unit tchmi:general#/definitions/Measurement Unit Unit of the height of the icon. Icon Horizontal Alignment tchmi:general#/definitions/Horizontal Alignment Definition of the horizontal alignment of the icon within the button. Icon Vertical Alignment tchmi:general#/definitions/Vertical Alignment Definition of the vertical alignment of the icon within the button. Icon Rotation tchmi:general#/definitions/Number Determines by how many degrees the icon should be rotated. Icon Rotation Speed tchmi:general#/definitions/Number Determines the speed at which the icon should rotate. Icon Rotation Direction tchmi:general#/definitions/Tc Hmi. Building Automation. Controls. Direction Determines the direction in which the icon rotates if the attribute Icon Rotation Speed is defined. The default value is clockwise. Icon Overlays tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Common. Icon. Overlay List Defines overlays of the icon. TF8040 Version: 1.14.0 1143
## Page 1144

Programming Icon Show In Legend tchmi:general#/definitions/Boolean Specifies whether the icon is visible in the legend. Category tchmi:general#/definitions/String Specifies the category of the icon in the legend. Description tchmi:general#/definitions/String Specifies the description text of the icon in the legend. 6.2.1.2.2.9 Input Box The Input Box is used to display and edit numerical or textual values. Use Use on any page where numerical or textual values are to be displayed or edited. Features Numerical input If the Data Type is equal to number, the user input is checked for the following criteria: • purely numerical input (letters and special characters are not allowed) • minimum value (if Min Value is set) • maximum value (if Max Value is set) The unit and number of decimal places for a numerical value can also be specified with the attributes Unit and Digits. Attributes The control inherits from Text Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Feedback concept The control can use the feedback concept [} 60]. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. 1144 Version: 1.14.0 TF8040
## Page 1145

Programming The attribute is not applicable to all controls. Common Data Type tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Input Box. Input Data Type Data type of the Input Box. If auto is selected, the default value or the first input is analyzed and the data type is set accordingly. If number is selected Value does not contain the unit. Text (read-only) tchmi:general#/definitions/String The displayed text. Ba Data Ba Interface tchmi:framework#/definitions/Symbol Symbol that fulfills the Ba Interface [} 62] of the control. Ba Interface Symbol Names tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Input Box. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Value tchmi:framework#/definitions/Tc Hmi. Building Automation. String Or Number Current Value. Depending on the selected Data Type the value is numerical or textual. Value Feedback tchmi:framework#/definitions/Tc Hmi. Building Automation. String Or Number Feedback for the value. Use Value Feedback tchmi:general#/definitions/Boolean If TRUE, then the Value Feedback attribute is used. Number Min Value tchmi:general#/definitions/Number Lowest permissible input value (if Data Type is equal to number). Max Value tchmi:general#/definitions/Number Largest permissible input value (if Data Type is equal to number). Unit tchmi:framework#/definitions/Tc Hmi. Building Automation. String Or Number Determines the unit after Value (if Data Type is equal to number). Possible values: TF8040 Version: 1.14.0 1145
## Page 1146

Programming • textual (e.g. "°C") • numerical (enumeration value of E_BA_Unit) Digits tchmi:general#/definitions/Number Number of decimal places (if Data Type is equal to number). Events Event Description on Value Changed Triggered when the value has changed. on User Interaction Finished Triggered when the user exits the input. This means: • Enter key is pressed • Input Box loses focus 6.2.1.2.2.10 Manual Override The Manual Override is used to manually override a binary, analog or multi-level value. Use Use on any page where a value is to be manually overridden. The control is used in the Project Navigation Textual [} 1167]. Features Simply override the current value with a manual value. If manual override is active, this is indicated visually. Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Ba Data Ba Interface tchmi:framework#/definitions/Symbol Symbol that fulfills the Ba Interface [} 62] of the control. 1146 Version: 1.14.0 TF8040
## Page 1147

Programming Ba Interface Symbol Names tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Common. Manual Override. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Manual Enable tchmi:general#/definitions/Boolean Defines whether manual override is enabled or not. Manual Value tchmi:framework#/definitions/Tc Hmi. Building Automation. Number Or Boolean The current manual value. Auto Value tchmi:framework#/definitions/Tc Hmi. Building Automation. Number Or Boolean The current automatic value. 6.2.1.2.2.11 Manual Override Binary Manual Override Binary is used to manually override a binary value. Use Use on any page where a binary value is to be overridden manually. Features Simply override the current value with a manual value. If manual override is active, this is indicated visually. Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. TF8040 Version: 1.14.0 1147
## Page 1148

Programming Ba Data Ba Interface tchmi:framework#/definitions/Symbol Symbol that fulfills the Ba Interface [} 62] of the control. Ba Interface Symbol Names tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Common. Manual Override Binary. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Manual Enable tchmi:general#/definitions/Boolean Defines whether manual override is enabled or not. Manual Value tchmi:general#/definitions/Boolean The current manual value. Auto Value tchmi:general#/definitions/Boolean The current automatic value. 6.2.1.2.2.12 Paginator The Paginator can be used to navigate between different content pages. Use Use on any page where you want to switch between different content pages in a gallery. Features Devices with touch screen Switch between configured content pages with a swipe gesture to the left or right. Devices without touch screen Navigation through the content pages is done via various controls. For this purpose, the functions Go Forward and Go Backward are called by events of the controls (e.g. On Pressed). Explanation using the example of two rectangles, which are positioned to the left and right of the Paginator respectively. 1148 Version: 1.14.0 TF8040
## Page 1149

Programming The properties window of the respective rectangle is used to configure the On Pressed event. Then the function Go Forward / Go Backward is added. TF8040 Version: 1.14.0 1149
## Page 1150

Programming Attributes The control inherits from Tc Hmi Region and thus has the same attributes. The Target Content attribute is replaced by the Pages attribute. Pages tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Paginator. Pages Creating the pages to be navigated through. Functions Go Forward When the function is called, it navigates to the next page. If the navigation is currently on the last page, there is a change to the first page. Go Backward When the function is called, it navigates to the previous page. If the navigation is currently on the first page, there is a change to the last page. 6.2.1.2.2.13 Scale With the Scale control different types of scales can be displayed and edited. The focus of the control is the visualization of a heating curve with a defined number of interpolation points. 1150 Version: 1.14.0 TF8040
## Page 1151

Programming Use Can be used on any page where scales are to be displayed or edited. Features A scale can be edited by drag and drop and the maximum and minimum value can be set. Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Data tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Scale. Scales Determines the data for the different scales. XAxis Extension tchmi:general#/definitions/Number Determines how much longer the X-axis is displayed, depending on XMin and XMax. TF8040 Version: 1.14.0 1151
## Page 1152

Programming Title tchmi:general#/definitions/String Determines the title that will be displayed in the header of the control. Show Header tchmi:general#/definitions/Boolean Determines whether the header of the control is displayed or not. 6.2.1.2.2.14 Slider The slider can be used to display and edit numerical values. Use Can be dragged to any page where numerical values are to be edited. Features The value can be set by drag and drop or by clicking on the slider. You can also click on the display that shows the current value and then enter the desired value. It can be set whether the min. and max. values or the current value are displayed. Different areas can be colored for the slider. Here you have the possibility to set color gradients or exact color areas. If the feedback concept [} 1152] is used, the value of the feedback is displayed with a slight shadow. Thus, for example, both values can be visualized at the same time for an object that has a target value and an actual value. Attributes The control inherits from Text Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Feedback concept The control can use the feedback concept [} 60]. 1152 Version: 1.14.0 TF8040
## Page 1153

Programming BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Show Value tchmi:general#/definitions/Boolean Determines whether the current value is displayed. Show Scale tchmi:general#/definitions/Boolean Determines whether the Min Value [} 1156] and Max Value [} 1156] are displayed. Orientation tchmi:framework#/definitions/Tc Hmi. Building Automation. Orientation Determines the orientation of the slider (horizontal or vertical). Switch Min Max tchmi:general#/definitions/Boolean If active, the positions of Min Value and Max Value are swapped. Ranges tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Slider. Slider Ranges Specifies different color areas or color gradients to be displayed in the slider. TF8040 Version: 1.14.0 1153
## Page 1154

Programming 1154 Version: 1.14.0 TF8040
## Page 1155

Programming Knob Appearance tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Slider. Knob Appearance Determines the display of the slider knob. Ba Data Ba Interface tchmi:framework#/definitions/Symbol Symbol that fulfills the Ba Interface [} 62] of the control. Ba Interface Symbol Names tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Common. Slider. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Value tchmi:general#/definitions/Number The current value of the slider. Value Feedback tchmi:general#/definitions/Number TF8040 Version: 1.14.0 1155
## Page 1156

Programming The feedback for the value of the slider. Number Unit tchmi:general#/definitions/String Determines the unit that is displayed after Value [} 1155]. Min Value tchmi:general#/definitions/Number The minimum value of the slider. Max Value tchmi:general#/definitions/Number The maximum value of the slider. Step tchmi:general#/definitions/Number Determines the accuracy with which the value can be set with the slider (e.g. 0.01). Events Event Description On Value Changed The event is triggered every time the value of the slider changes, for example, when the slider is moved. on User Interaction Finished The event is triggered when the value change has been completed by the user. This happens with drag and drop, when the user releases the slider again or after clicking on an area of the slider. 6.2.1.2.2.15 Tab Window The Tab Window is used to display different content in different tabs. Use Use on any page where a Tab Window is to be displayed. Features Pages of type *.content or programmatically created HTML can be assigned to the tabs via the Data attribute. 1156 Version: 1.14.0 TF8040
## Page 1157

Programming Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. Common Data tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Tab Window. Tab Window Data Data for the different tabs. Tab Position tchmi:framework#/definitions/Tc Hmi. Building Automation. Position Position of the tabs. Tab Distance Tchmi:framework#/definitions/Number Distance between the tabs. Tab Container Distance tchmi:general#/definitions/Number The size of the tab container. TF8040 Version: 1.14.0 1157
## Page 1158

Programming Tab Size Auto tchmi:general#/definitions/Boolean Determines whether the tabs should occupy the complete width of the tab container or not. 6.2.1.2.2.16 Text block The control Textblock is used to display text. Use Use on any page where text is to be displayed. Features A specialized text block with reduced resource requirements. Attributes The control inherits from Text Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Digits tchmi:general#/definitions/Number Number of decimal places if an analog Ba Object [} 60] is linked. Common Text tchmi:general#/definitions/String Text for the text block. 1158 Version: 1.14.0 TF8040
## Page 1159

Programming 6.2.1.2.2.17 Ui Icon The Ui Icon control can be used to display events and values. It looks like a normal button [} 1130] and can be filled with different icons. Use Suitable for creating P&I diagrams to represent various plant components (e.g. pump). The attribute Connections can be used to create suitable connections to connect the Ui Icon with a main line, for example. Features Value displays Various displays can be added to the Ui Icon via the attribute Displays Data. Event displays The attribute Events Data can be used to display various events around the Ui Icon. If the generic approach [} 77] of Tc Hmi Ba is used and a Ba Object / Ba View is linked to the control, active events are displayed automatically. When the Ui Icon is actuated, the project navigation [} 1167] of the linked object opens and, in the case of an event, the parameter window [} 1170] with the event view opens accordingly. TF8040 Version: 1.14.0 1159
## Page 1160

Programming Attributes The control inherits from the button [} 1130] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Displays Data Tc Hmi. Building Automation. Controls. Ui Icon. Displays Data The attribute makes it possible to create different displays via an editor. 1160 Version: 1.14.0 TF8040
## Page 1161

Programming The following properties can be set for each display: Name Description Text Color Font color of the display. Value Display value in the display. If a binding exists and Read Only is disabled, the value is written to this binding when the user ends the input. Position Position of the display. Several displays created at the same position are arranged on top of each other. Read Only Determines whether the display is editable or read-only. Unit Unit to be appended to the value (if it is a number). Digits Number of decimal places. Font Weight Font weight of the text. Displayed Digits tchmi:general#/definitions/Boolean The number of decimal places when a number is shown in a display. Icon Status Tc Hmi. Building Automation. Controls. Common. Ui Icon. Status Colors the icon according to the set status. Automatic coloring is set via the global variable Auto Activate Icon Status [} 1271]. TF8040 Version: 1.14.0 1161
## Page 1162

Programming Status Display Alarm Fault Maintenance Notification Others Active Inactive Change the colors used via the following CSS variables in the theme CSS file: :root { --tchmi-ba-global-event-color-alarm: rgb(255, 0, 0); --tchmi-ba-global-event-color-disturb: rgb(255, 255, 0); --tchmi-ba-global-event-color-maintenance: rgb(255, 255, 0); --tchmi-ba-global-event-color-notification: rgb(255, 255, 55); --tchmi-ba-global-event-color-other: rgb(255, 255, 255); --tchmi-ba-global-color-active: rgb(0, 255, 0); --tchmi-ba-global-color-inactive: rgb(255, 255, 255); } It should be noted that changes to these colors apply per visualization, which can make it difficult to maintain different systems due to different appearances. Border Status Tc Hmi. Building Automation. Controls. Common. Ui Icon. Status Colors the icon according to the set status. 1162 Version: 1.14.0 TF8040
## Page 1163

Programming Status Display Alarm Fault Maintenance Notification Others Active Inactive For the colors used, see the attribute Icon Status. Events Data Tc Hmi. Building Automation. Controls. Ui Icon. Events Data The attribute makes it possible to create different events via an editor. TF8040 Version: 1.14.0 1163
## Page 1164

Programming The following properties can be set for each event: Name Description Activate Determines whether the event is active or not. Event condition Determines the type (priority) of the event. The icons are arranged according to their priority in a clockwise direction. Top right is the highest priority. Event state Current state of the event. Event count Determines how many events of this type and state are active. Acknowledge symbol Writes TRUE to the symbol when the event is pressed. Is Acknowledgable Determines whether the event can be pressed. Icon Icon to use if no event condition is selected to allow user specific icons. Enable pulse Evaluation is done only if Event condition and Event state are not used. When activated, a red pulse is displayed around the Ui Icon. Show Displays tchmi:general#/definitions/Boolean Determines whether the displays defined in the attribute Display Data are shown or not. Pop Up Show Faceplate tchmi:general#/definitions/Boolean 1164 Version: 1.14.0 TF8040
## Page 1165

Programming Determines whether a pop-up is opened when the Ui Icon is clicked. If the attribute is not activated, the Ui Icon can, for example, be used for navigation to another content but still display events of the linked Ba Object. Connections Connections can be used to represent connections to other lines in a P&I diagram. tchmi:framework#/definitions/Padding Connections can be created here that extend vertically or horizontally away from the Ui Icon. The length of the connection must be specified in each case. The unit pixel is always used. Percent is not supported at this point. Connection Extensions tchmi:framework#/definitions/Padding Here extensions can be created for the connections created above. The length of the extension must be specified in each case. The unit pixel is always used. Percent is not supported at this point. Connections Width tchmi:framework#/definitions/Positive Number Specification of the width in pixels for the connections. Connections Color tchmi:framework#/definitions/Solid Color Specification of the color for the connections. Connections Color Per Side tchmi:framework#/definitions/Tc Hmi. Building Automation. Four Sided Color Defines the color for different connections. The Connections Color attribute must be set to NULL or NONE. TF8040 Version: 1.14.0 1165
## Page 1166

Programming 6.2.1.2.3 Management 6.2.1.2.3.1 Event List The Event List displays events in list form. To use the control, the generic functionalities [} 77] of Tc Hmi Ba must be used. Use Use on any page where events are to be listed. Features Displays the events from a specific Ba Object or Ba View. It can also display the events of all connected controllers. Using the buttons in the upper area, events can be filtered by different event types. Allows you to acknowledge one or all events. The event currently selected in the list is acknowledged. The button History shows or hides the event history. Attributes The control inherits from Base Room Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. 1166 Version: 1.14.0 TF8040
## Page 1167

Programming Common Is Global Event List tchmi:general#/definitions/Boolean Determines whether the events of all connected controllers should be displayed. Active Events Count (read-only) tchmi:general#/definitions/Number Number of active events that the user can acknowledge. Columns tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Management. Event List. Column List Specifies the order and settings of the columns. The default setting can be changed in the global settings [} 1266]. If the column width is specified in the unit "factor", the columns automatically use the remaining free space. Column Sorting tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Management. Event List. Column Sorting Has been replaced by the attribute Columns. Specifies the column sorting. The default attribute setting can also be overwritten globally for all Event List controls in Code Behind. Events Event Description on Events Changed This is triggered when the events collection has changed. on Event Acknowledged Is triggered when an event has been acknowledged. on All Events Acknowledged Triggered when all events have been acknowledged. 6.2.1.2.3.2 Project Navigation Textual The Project Navigation Textual is one of the generic controls and is used to navigate through the project structure of a device. It provides information about the type (e.g. Analog Input or Structured View) [1], the description [2], the value [3] and the events (if available) [4] of the objects. Here you will find more detailed information about the generic possibilities [} 77] of Tc Hmi Ba and how they can be used. TF8040 Version: 1.14.0 1167
## Page 1168

Programming Use To navigate, the Ba Object [} 1171] attribute must be linked. If a Ba View is linked, you can navigate through its children. If only a single Ba Object (no Ba View) is linked, then only one entry is displayed with this Ba Object. Features Generic navigation The navigation is built generically based on the structure of the linked Ba Object or Ba View, which means that all Ba Objects of a Ba View can be reached with just one binding. Manual override The value display and manual override is realized with the Manual Override [} 1146] control. Link content page The function for linking content pages is an additional navigation aid. A content page must exist in the Tc Hmi project that has the Symbol Path of a view as its name. The name of the content page is case-sensitive. 1168 Version: 1.14.0 TF8040
## Page 1169

Programming A button then appears behind the relevant entry in the project navigation. In addition, a Tc Hmi Region with the name Target Region must exist in the Tc Hmi project in order to display the linked content page. Header The header contains an input field for searching the listing and a burger menu for displaying additional actions. Actions: • Selection of labels to be displayed for the entries TF8040 Version: 1.14.0 1169
## Page 1170

Programming • Opening the trend configurator [} 55] • Opening generated trend configurations Parameter dialog After clicking on the type icon, the parameter dialog of the selected Ba Object appears. The parameters listed are divided into categories. Visibility and permitted read/write accesses depend on the role [} 15] of the logged-in user. Changes to parameters are written to the PLC with the tick icon and discarded with the cross icon. The category assignment and visibility of the parameters can be set globally (see Global settings [} 1266]). Depending on the Ba Object selected, additional buttons may appear in the header. Buttons: 1170 Version: 1.14.0 TF8040
## Page 1171

Programming • Event bell ◦ available for every event-capable object ◦ replaces the content of the window with the event list [} 1166] of the object when clicked • Trend functionalities ◦ only available for objects that support them or views that contain objects with trend functions. Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Ba Used Title tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Project Navigation Textual. Ba Used Title Determines which parameter is used for the description in an entry. The setting can be customized in the client. Show Header tchmi:general#/definitions/Boolean Determines whether the header is displayed or not. Auto Collapse tchmi:general#/definitions/Boolean Determines whether list entries are automatically closed when another list entry is selected. 6.2.1.2.3.3 Schedule The Schedule can be used to display and operate schedules and calendar entries. The current schedule is created on the basis of the weekly schedule and exceptions. TF8040 Version: 1.14.0 1171
## Page 1172

Programming Use Use on any page where a schedule is to be managed. If a Schedule object is passed to the Ba Object [} 1174] attribute, the generic functions [} 77] can be used. Features Resulting schedule The first tab, Current schedule, displays the combination of the weekly schedule and the exceptions. The following hierarchy applies: 1. Local exceptions 2. Global exceptions 3. Weekly schedule Editing the weekly schedule On the Weekly schedule tab it is possible to edit the weekly schedule without taking into account exceptions that have already been defined. 1172 Version: 1.14.0 TF8040
## Page 1173

Programming In this view there is a schedule with different entries for each day. An entry can be edited or deleted via its menu. The start and end time or position can also be changed with the mouse or finger. Each daily schedule also has a menu that can be used to add entries and reset changes. By selecting the copy function, the day's entries are copied and can be inserted on other days. Copying is also possible to other schedules or exceptions. Managing exceptions The exceptions are managed on the Calendar tab. For more information on how to use it, see the Calendar [} 1131] control. Menu Using the menu in the upper right-hand area of the schedule, you can either transfer all changes made to the PLC or discard them. TF8040 Version: 1.14.0 1173
## Page 1174

Programming Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Orientation tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Orientation Determines the orientation of the weekly schedule. Snap Period tchmi:general#/definitions/Number Determines how precisely schedule entries can be set. If Snap Periode is set to 15, for example, entries can be set to the nearest quarter of an hour. Display Time Cursor tchmi:general#/definitions/Boolean Specifies whether a cursor for the current time is displayed in the resulting schedule. Current Date Time tchmi:general#/definitions/Date Time Specifies the time that the cursor displays for the current time. If a Ba Object is used, the current time from the corresponding device is displayed. Ba Data Ba Interface tchmi:framework#/definitions/Symbol Symbol that fulfills the Ba Interface [} 62] of the control. Ba Interface Symbol Names tchmi:framework#/definitions/ Tc Hmi. Building Automation. Conrols. Management. Schedule. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Active Text tchmi:general#/definitions/String Specifies the text that is displayed in the entries if a binary schedule has been linked and the value is TRUE. 1174 Version: 1.14.0 TF8040
## Page 1175

Programming Inactive Text tchmi:general#/definitions/String Specifies the text that is displayed in the entries if a binary schedule has been linked and the value is FALSE. State Texts tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Common. Combobox. Combobox Items Specifies the texts that are displayed in the entries when a multistate schedule has been linked. Unit tchmi:framework#/definitions/Tc Hmi. Building Automation. String Or Number Specifies the unit in the entries if an analog schedule has been linked. Possible values: • textual (e.g. "°C") • numerical (enumeration value of E_BA_Unit) Digits tchmi:general#/definitions/Number Defines the number of decimal places if an analog schedule has been linked. 6.2.1.2.3.4 Trend The Trend control can display multiple trend curves. It allows you to select different trend curves and change the settings of all axes. Use Can be used on any page where a trend is to be displayed. Allows linking to a Ba Object [} 1178] of type Trend object or View. For more information, see the documentation on Trending [} 55]. TF8040 Version: 1.14.0 1175
## Page 1176

Programming Features Multiple trend curves If the Ba Object is a trend object, then only the associated trend curve is displayed. It is not possible to select from different trend curves. If the Ba Object is a View, it is searched for trend objects and existing trend curves are displayed accordingly. It is possible to select from different trend curves if more than two trend objects are found. In the listing, the trend curves to be displayed in the chart can be selected via the checkboxes. The adjacent button opens the parameter window [} 1170] of the respective trend object. Axis parameterization The settings of a y-axis can be opened by selecting the respective scale values. Menu The menu allows further settings for the trend. 1176 Version: 1.14.0 TF8040
## Page 1177

Programming Cursor If Cursor is activated, a cursor is displayed under the x-axis. By default, this function is disabled. Data zoom The zoom can be shown and hidden via the checkbox. By default, the zoom is shown. Redo Restores the default settings. Update The trend curves can be updated once. Auto Update If the checkbox is checked, the trend curves are automatically updated as soon as new trend entries are available. Displayed objects Determines the objects to be displayed in the listing. • Ref Object: Displays recorded values. • Trend: Displays all trend objects that record a value. TF8040 Version: 1.14.0 1177
## Page 1178

Programming Displayed label Selection of the label to be used in the listing. Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Show Data Zoom tchmi:general#/definitions/Boolean Defines whether the data zoom is displayed. XAxes Range tchmi:general#/definitions/Number The time period in minutes displayed on the X-axis. Entering 24 * 60 = 1440 shows the last 24 hours. Series Selector Width tchmi:general#/definitions/Number The width of the selection of displayed trends in % if several trends are displayed. 6.2.1.2.4 Plants 6.2.1.2.4.1 Cooler The Cooler template represents a cooler. 1178 Version: 1.14.0 TF8040
## Page 1179

Programming Use Use on any page where a template of the FB_BA_Col T_02 type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: Symbol name PLC template Description TFI FB_BA_Sensor Analog_IO Flow temperature sensor TRt FB_BA_Sensor Analog_IO Return temperature sensor Vlv FB_BA_Vlv [} 1092] Valve Hierarchy: - Ba Object - TFl - TRt - Vlv Corresponds to the PLC template: - FB_BA_AC_Col T_02 Attributes This template inherits from the Base Template [} 1195] control. In addition, there are the following attributes. BA Ba Template Description tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. Cooler. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. Flow Temperature Sensor Setpoint tchmi:general#/definitions/Boolean TF8040 Version: 1.14.0 1179
## Page 1180

Programming Object for the setpoint. Show Feedback tchmi:general#/definitions/Boolean Determines whether the feedback is visible. Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. Return Temperature Sensor Setpoint tchmi:general#/definitions/Boolean Object for the setpoint. Show Feedback tchmi:general#/definitions/Boolean Determines whether the feedback is visible. Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. Valve Display Mode tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. Valve. Display Mode Determines the icon to be displayed. Show Feedback tchmi:general#/definitions/Boolean Determines whether the feedback is visible. Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. Colors Flow Pipe Color tchmi:framework#/definitions/Solid Color Color for the flow pipe. Return Pipe Color tchmi:framework#/definitions/Solid Color Color for the return pipe. 1180 Version: 1.14.0 TF8040
## Page 1181

Programming 6.2.1.2.4.2 Damper The Damper template displays the damper position graphically and in text form. Use Use on any page where a template of the Damper type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Two-point Subelements: Symbol name PLC template Required Description Swi Cls FB_BA_BI_IO [} 205] x Switch close Swi Opn FB_BA_BI_IO [} 205] x Switch open Hierarchy: - Ba Object - Swi Cls - Swi Opn Corresponds to the PLC template: - FB_BA_Dmp2P [} 1058] Analog Subelements: Symbol name PLC template Required Description Mdlt FB_BA_AO_IO [} 197] x Feedback Hierarchy: - Ba Object - Mdlt Corresponds to the PLC template - FB_BA_Actuator Analog [} 982] Attributes This template inherits from the Ui Icon Fdb Stp [} 1199] control. In addition, there are the following attributes. Common Display Mode tchmi:framework#/definitions/Tc Hmi. Building Automation. Templates. Universal. Damper. Display Mode TF8040 Version: 1.14.0 1181
## Page 1182

Programming Determines the icon to be displayed. If "Custom" is selected, the icon [} 1130] that was set in the icon attribute is displayed. Flap Position tchmi:general#/definitions/Number Position of the flaps in percent (0 is closed). 6.2.1.2.4.3 Erc Plate The Erc Plate template is an energy recovery system with a plate heat exchanger. Use Use on any page where a template of the Erc Pl_02 type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: Symbol name PLC template Description By Dmp FB_BA_Actuator Analog [} 982] Bypass damper Diff Prss Swi FB_BA_Sensor Binary_IO Differential pressure Dmp FB_BA_Actuator Analog [} 982] Damper Hierarchy: - Ba Object - By Dmp 1182 Version: 1.14.0 TF8040
## Page 1183

Programming - Diff Prss Swi - Dmp Corresponds to the PLC template: - FB_BA_AC_Erc Pl_02 [} 733] Attributes This template inherits from the Base Template [} 1195] control. BA Ba Template Description tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. Erc Plate. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. Damper Show Feedback tchmi:general#/definitions/Boolean Determines whether the feedback is visible. Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. Damper Bypass Show Feedback tchmi:general#/definitions/Boolean Determines whether the feedback is visible. Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. Colors Flow Pipe Color tchmi:framework#/definitions/Solid Color Color for the flow pipe. Return Pipe Color tchmi:framework#/definitions/Solid Color Color for the return pipe. 6.2.1.2.4.4 Erc Rotation The Erc Rotation template is an energy recovery system with a rotary heat exchanger. TF8040 Version: 1.14.0 1183
## Page 1184

Programming Use Use on any page where a template of the Erc Rot_01 type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: Symbol name PLC template Description Diff Prss Swi FB_BA_Sensor Binary_IO Differential pressure Mdlt FB_BA_AO_IO [} 197] Motor feedback Motor FB_BA_Mot Mdlt [} 1070] Motor Hierarchy: - Ba Object - Diff Prss Swi - Motor - Mdlt Corresponds to the PLC template: - FB_BA_AC_Erc Rot_01 [} 738] Attributes This template inherits from the Base Template [} 1195] control. BA Ba Template Description tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Plants. Erc Rotation. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. 1184 Version: 1.14.0 TF8040
## Page 1185

Programming Common Show Feedback tchmi:general#/definitions/Boolean Determines whether the feedback is visible. Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. Display Position tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Common. Ui Icon. Display Position Position of the setpoint and actual value. 6.2.1.2.4.5 Heating Circuit The Heating Circuit template represents a heating circuit. Use Use on any page where a template of the Htg Cir01 type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: TF8040 Version: 1.14.0 1185
## Page 1186

Programming Symbol name PLC template Description Pu FB_BA_Pu1st [} 1074] Pump Sp FB_BA_H_Htg Cir_Sp Setpoint Sp Fl WT FB_BA_AV_Op [} 202] Setpoint flow temperature sensor TFl FB_BA_Sensor Analog_IO Flow temperature sensor TRt FB_BA_Sensor Analog_IO Return temperature sensor Vlv FB_BA_Vlv [} 1092] Valve Hierarchy: - Ba Object - Pu - Sp - Sp Fl WT - TFl - TRt - Vlv Corresponds to the PLC template: - FB_BA_H_Htg Cir01 [} 975] Attributes This template inherits from the template FB_BA_AC_Col T_02 [} 1178]. BA Ba Template Description tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Plants. Heating Circuit. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. Flow Temperature Sensor Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. Pump Show Feedback tchmi:general#/definitions/Boolean Determines whether the feedback is visible. Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. 1186 Version: 1.14.0 TF8040
## Page 1187

Programming 6.2.1.2.4.6 Motor The motor template shows the status of a motor graphically and, if available, the feedback in text form. Use Use on any page where a template of the Motor type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: Symbol name PLC template Required Description Cmd FB_BA_BO_IO [} 209] x Command Mdlt FB_BA_BO_IO [} 209] Feedback Hierarchy: - Ba Object - Cmd - Mdlt Corresponds to the PLC templates - FB_BA_Mot Ctl [} 1066] - FB_BA_Mot Ctl Ext [} 1069] - FB_BA_Pu1st [} 1074] - FB_BA_Pu1st Ext [} 1076] - FB_BA_Pu Ctl [} 1077] Attributes This template inherits from the Ui Icon Fdb Stp [} 1199] control. In addition, there are the following attributes. BA Ba Template Description tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. Motor. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. Common Display Mode tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. Motor. Display Mode Determines the icon to be displayed. If "Custom" is selected, the icon that was set in the icon [} 1130] attribute is displayed. If "Custom" is selected, the icon [} 1130] that was set in the icon attribute is displayed. TF8040 Version: 1.14.0 1187
## Page 1188

Programming 6.2.1.2.4.7 Pre Heater The Pre Heater template is a preheater. Use Use on any page where a template of the Pre Htr type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: Symbol name PLC template Description Frost Thermostat FB_BA_Sensor Binary_IO Frost protection thermostat Pu FB_BA_Pu1st [} 1074] Pump Sp FB_BA_H_Htg Cir_Sp Setpoint Sp Fl WT FB_BA_AV_Op [} 202] Setpoint flow temperature sensor TFl FB_BA_Sensor Analog_IO Flow temperature sensor TFrost FB_BA_AO_IO [} 197] Temperature frost TRt FB_BA_Sensor Analog_IO Return temperature sensor Vlv FB_BA_Vlv [} 1092] Valve Hierarchy: - Ba Object - Frost Thermostat - Pu - Sp - Sp Fl WT 1188 Version: 1.14.0 TF8040
## Page 1189

Programming - TFl - TFrost - TRt - Vlv Corresponds to the PLC template: - FB_BA_AC_Pre Htr [} 748] Attributes This template inherits from the template Heating Circuit [} 1185]. BA Ba Template Description tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Plants. Pre Heater. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. Frost Temperature Sensor Setpoint tchmi:general#/definitions/Boolean Object for the setpoint. Show Feedback tchmi:general#/definitions/Boolean Determines whether the feedback is visible. Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. 6.2.1.2.4.8 Pump The Pump template shows the state of a pump graphically and, if available, the feedback in text form. Use Use on any page where a template of the Pump type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: Symbol name PLC template Required Description Cmd FB_BA_BO_IO [} 209] x Command Mdlt FB_BA_BO_IO [} 209] Feedback TF8040 Version: 1.14.0 1189
## Page 1190

Programming Hierarchy: - Ba Object - Cmd - Mdlt Corresponds to the PLC template - FB_BA_Mot Ctl [} 1066] - FB_BA_Mot Ctl Ext [} 1069] - FB_BA_Pu1st [} 1074] - FB_BA_Pu1st Ext [} 1076] - FB_BA_Pu Ctl [} 1077] Attributes This template inherits from the Ui Icon Fdb Stp [} 1199] control. In addition, there are the following attributes. BA Ba Template Description tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. Pump. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. Common Display Mode tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. Pump. Display Mode Determines the icon to be displayed. If "Custom" is selected, the icon [} 1130] that was set in the icon attribute is displayed. 6.2.1.2.4.9 Sensor Analog The Sensor Analog template displays the feedback of an analog value and, if linked, a setpoint. Use Use on any page where a template of the Sensor Analog type is to be displayed. 1190 Version: 1.14.0 TF8040
## Page 1191

Programming Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: Symbol name PLC template Required Description MV FB_BA_AI_Raw [} 195] x Feedback Hierarchy: - Ba Object - MV Corresponds to the PLC template - FB_BA_Sensor Analog [} 1087] Attributes This template inherits from the control Sensor [} 1196]. In addition, there are the following attributes. BA Ba Template Description tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Plants. Sensor Analog. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. 6.2.1.2.4.10 Sensor Binary The Sensor Binary template displays the feedback of a binary value and, if linked, a setpoint value. Use Use on any page where a template of the Sensor Binary type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: Symbol name PLC template Required Description Input FB_BA_BI_Raw [} 206] x Value Hierarchy: TF8040 Version: 1.14.0 1191
## Page 1192

Programming - Ba Object - Input Corresponds to the PLC template: - FB_BA_Sensor Binary [} 1088] Attributes This template inherits from the control Sensor [} 1196]. In addition, there are the following attributes. BA Ba Template Description tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Plants. Sensor Binary. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. 6.2.1.2.4.11 Valve The Valve template shows the feedback of a valve and, if available, the setpoint. Use Use on any page where a template of Valve type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Three-point Subelements: Symbol name PLC template Required Description Anlg3Pnt FB_BA_Analog3Pnt [} 995] x Pos FB_BA_AV_Op [} 202] x Feedback Hierarchy: - Ba Object - Anlg3Pnt - Pos Corresponds to the PLC template - FB_BA_Vlv3pt [} 1094] Analog value Subelements: 1192 Version: 1.14.0 TF8040
## Page 1193

Programming Symbol name PLC template Required Description Fdb FB_BA_AI_IO [} 192] x Feedback Mdlt FB_BA_AO_IO [} 197] Setpoint Hierarchy: - Ba Object - Fdb - Mdlt Corresponds to the PLC template - FB_BA_Vlv [} 1092] Attributes This template inherits from the Ui Icon Fdb Stp [} 1199] control. In addition, there are the following attributes. BA Ba Template Description tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. Valve. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. Common Display Mode tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. Valve. Display Mode Determines the icon to be displayed. If "Custom" is selected, the icon [} 1130] that was set in the icon attribute is displayed. 6.2.1.2.4.12 VAV The VAV template shows the setpoint of a volume flow controller and, if available, the setpoint. Use Use on any page where a template of the VAV type is to be displayed. Compatibility The Ba Template Description [} 61] supports the following Ba Objects. Subelements: Symbol name PLC template Required Description Mdlt FB_BA_AO_IO [} 197] Setpoint Fdb FB_BA_AI_IO [} 192] x Feedback Hierarchy: • Ba Object TF8040 Version: 1.14.0 1193
## Page 1194

Programming ◦ Mdlt ◦ Fdb Corresponds to the PLC template: • FB_BA_Actuator Analog [} 982] Attributes This template inherits from the Ui Icon Fdb Stp [} 1199] control. In addition, there are the following attributes. BA Ba Template Description tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. VAV. Ba Template Description Edit the Ba Template Description of the Ba Template [} 61]. Common Display Mode tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Plants. VAV. Display Mode Determines the icon to be displayed. If "Custom" is selected, the icon [} 1130] that was set in the icon attribute is displayed. 6.2.1.2.5 System 6.2.1.2.5.1 Base Control The Base Control is the basis for various controls, it contains methods and attributes that other controls also need. This prevents redundant implementations. Use This is only used for inheritance and is therefore not available in the toolbox. Features Implements functionalities that run in the background and take over the management of various tasks. These include, for example: • Busy handling • log out various watches Attributes The control inherits from Tc Hmi Control and thus has the same attributes. In addition, there are the following attributes. Common Read Only tchmi:general#/definitions/Boolean Determines whether the user has read-only or write access. 1194 Version: 1.14.0 TF8040
## Page 1195

Programming The attribute is not applicable to all controls. Layout Content Padding tchmi:framework#/definitions/Padding Specifies the padding for the content of the control. The attribute is not applicable to all controls. 6.2.1.2.5.2 Base Template The Base Template is the basis for all more sophisticated template controls (e.g. Pre Htr, Htg Cir), which are more than just a Ui Icon [} 1159]. It provides methods and attributes to prevent redundant implementations. Use This is only used for inheritance and is therefore not available in the toolbox. Features Enables the use of Ba Templates [} 61] for all inheriting controls. Attributes The control inherits from Tc Hmi Control and thus has the same attributes. In addition, there are the following attributes. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Ba Template Description tchmi:general#/definitions/Object Edit the Ba Template Description of the Ba Template [} 61]. Show Tags tchmi:general#/definitions/Boolean Determines whether the tags are displayed or not. TF8040 Version: 1.14.0 1195
## Page 1196

Programming 6.2.1.2.5.3 Sensor The sensor is a specialized form of Ui Icon Fdb Stp [} 1199] and serves as the basis for sensor controls (e.g. Sensor Analog). It provides methods and attributes to prevent redundant implementations. Use This is only used for inheritance and is therefore not available in the toolbox. Features Facilitates the handling of the various display options of sensors. Attributes The control inherits from Ui Icon Fdb Stp [} 1199] and thus has the same attributes. In addition, there are the following attributes. Common Pin Layout tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. System. Sensor. Pin Layout Specifies the layout of the pins. Display Mode tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. System. Sensor. Display Mode Specifies the icon to be displayed. If "Custom" is selected, the icon [} 1130] that was set in the icon attribute is displayed. Pin Position tchmi:framework#/definitions/Tc Hmi. Building Automation. Position Specifies the orientation of the pins. Pin Connection tchmi:general#/definitions/Number Specifies the line length of the first pin. Pin Extension tchmi:general#/definitions/Number Specifies the line length from the first pin. Pin Width tchmi:general#/definitions/Number Specifies the line width of the pins. Custom Letter tchmi:general#/definitions/String Specifies the letter to be displayed in the icon if the Display Mode [} 1130] attribute has the value "Custom". Show Value tchmi:general#/definitions/Boolean Specifies whether the value is visible. 1196 Version: 1.14.0 TF8040
## Page 1197

Programming 6.2.1.2.5.4 Base Room Control Base Room Control is the basis for all room controls (e.g. Light [} 1203], Sunblind [} 1210], Heating Cooling [} 1200], Window [} 1214]). It provides methods and attributes to prevent redundant implementations. Use This is only used for inheritance and is therefore not available in the toolbox. Features Enables the use of Ba Templates [} 61] for all inheriting controls. Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. BA Ba Interface Symbol Names tchmi:general#/definitions/Object Edit the Ba Interface Symbol Names [} 1246]. Ba Data Ba Interface tchmi:framework#/definitions/Symbol Symbol that fulfills the Ba Interface [} 62] of the control. Error tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Room Automation. Heating Cooling. Energy Level If TRUE, an error message is displayed. Show Priority tchmi:general#/definitions/Boolean Defines whether the priority is displayed. 6.2.1.2.5.5 Text Control The Text Control offers various attributes, all of which are valid for text manipulation. Use This is only used for inheritance and is therefore not available in the toolbox. Features The following text manipulations are possible: TF8040 Version: 1.14.0 1197
## Page 1198

Programming • change position horizontally and vertically • influence font, size and thickness • add various decorations to the text (e.g. underlined) • define how the text should be displayed if the available space is not sufficient Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. Colors Text Color tchmi:framework#/definitions/Solid Color Color of texts. Text Decoration Color tchmi:framework#/definitions/Solid Color Color of text decorations. Text Text Vertical Alignment tchmi:framework#/definitions/Vertical Alignment Vertical alignment of texts. Text Horizontal Alignment tchmi:framework#/definitions/Horizontal Alignment Horizontal alignment of texts. Text Font Size tchmi:framework#/definitions/Measurement Value Font size of texts. Percentages are relative to the font size of the parent element. Text Font Size Unit tchmi:framework#/definitions/Measurement Unit Unit for the font size of texts. Can be absolute (px) or relative (%). Text Font Family tchmi:framework#/definitions/Font Family Font of texts. Text Font Style tchmi:framework#/definitions/Font Style Font style of texts. Text Font Weight tchmi:framework#/definitions/Font Weight Font weight of texts. Text Decoration Line tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Text Control. Text Decoration Line Position of the text decoration. 1198 Version: 1.14.0 TF8040
## Page 1199

Programming Text Decoration Style tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Text Control. Text Decoration Style Style of text decoration. User Select tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Text Control. User Select Behavior when selecting the text of a user. Text Overflow tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Text Control. Text Overflow Defines how to display text that is wider than the control. 6.2.1.2.5.6 Ui Icon Fdb Stp The Ui Icon Fdb Stp is a specialized form of the Ui Icon [} 1159] and serves as a basis for simple Tc Hmi Ba controls (e.g. Valve, Sensor Analog). It provides methods and attributes to prevent redundant implementations. Use This is only used for inheritance and is therefore not available in the toolbox. Features Facilitates the handling of the setpoint and actual value. Attributes The control inherits from Ui Icon [} 1159] and thus has the same attributes. In addition, there are the following attributes. BA tchmi:general#/definitions/Object Edit the Ba Template Description of the Ba Template [} 61]. Common Display Mode tchmi:general#/definitions/Number Determines the icon to be displayed. If "Custom" is selected, the icon [} 1130] that was set in the icon attribute is displayed. Show Feedback tchmi:general#/definitions/Boolean Determines whether the feedback is visible. Show Setpoint tchmi:general#/definitions/Boolean Determines whether the setpoint is visible. Show Displays tchmi:general#/definitions/Boolean Determines whether the setpoint and actual value is visible. TF8040 Version: 1.14.0 1199
## Page 1200

Programming Display Position tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Common. Ui Icon. Display Position Position of the setpoint and actual value. 6.2.1.2.6 Room Automation 6.2.1.2.6.1 Heating Cooling The Heating Cooling control displays the operation mode, set and actual temperature in a room and can change the setpoint. Use Use on any page where controls are needed to control air conditioning systems. Features The following table shows the possible operation modes. Operation mode Symbol Heating Cooling Inactive If the plant is inactive, the control is in the neutral zone. Displays The user level determines the information available in the display. For users with Advanced level or higher, the current values for temperature and setpoint are visible. For users up to Basic level, only the current setpoint adjustment is displayed. Operation The Heating Cooling control displays the current state of the plant and opens the activity display for setting the room temperature with a click. The temperature setpoints are adjusted by moving the slider. The cursor in the slider represents the room temperature by its position. 1200 Version: 1.14.0 TF8040
## Page 1201

Programming The room temperature and limits are visible from the "Advanced" user level. The activity display also shows the operation mode. It can be binary or in percent. Heating: Cooling: The control is only active if the active energy level corresponds to "Comfort". Attributes The control inherits from Base Room Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Feedback concept The control can use the feedback concept [} 60]. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Show Temperatures tchmi:general#/definitions/Boolean If TRUE, the temperatures are displayed. TF8040 Version: 1.14.0 1201
## Page 1202

Programming Ba Data Ba Interface Symbol Names tchmi:framework#/definitions/ Tc Hmi. Building Automation. Controls. Room Automation. Heating Cooling. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Temperature Room Temp tchmi:general#/definitions/Number Current measured room temperature. Room Temp Adjust tchmi:general#/definitions/Number Current room temperature adjustment. Room Temp Adjust Feedback tchmi:general#/definitions/Number Feedback for the current room temperature adjustment. Room Temp Adjust Range tchmi:general#/definitions/Number Specifies the range of the room temperature adjustment. Heating Setpoint tchmi:general#/definitions/Number Current setpoint for heating mode. Cooling Setpoint tchmi:general#/definitions/Number Current setpoint for cooling mode. Heating Active tchmi:framework#/definitions/Tc Hmi. Building Automation. Number Or Boolean If TRUE or greater than 0, then heating is displayed. Cooling Active tchmi:framework#/definitions/Tc Hmi. Building Automation. Number Or Boolean If TRUE or greater than 0, then cooling is displayed. 1202 Version: 1.14.0 TF8040
## Page 1203

Programming Unit tchmi:general#/definitions/String Unit for displaying the temperatures. Events Event Description on Temp Adjust Changed Triggered when the user changes the temperature adjustment. 6.2.1.2.6.2 Light The Light control is used to display and control the brightness of a light source. Use Use on any page where controls are needed to control light sources. Features Priorities Display of different priorities via the attribute Priority. Brightness specification The brightness can be adjusted using an analog (dimmable) or binary (switchable) value. Buttons with predefined brightness values are available for dimmable lamps. The display of these buttons can be set globally [} 1267]: Operation Clicking on the Light control changes the visibility of the menu for adjusting the brightness. Attributes The control inherits from Base Room Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. TF8040 Version: 1.14.0 1203
## Page 1204

Programming Feedback concept The control can use the feedback concept [} 60]. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Display Mode tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Room Automation. Light. Display Mode Determines the display mode of the lamp. Name Presentation light Bulb light Bulb Filled filles Show Value tchmi:general#/definitions/Boolean If TRUE, the brightness value is displayed. Ba Data Priority tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority 1204 Version: 1.14.0 TF8040
## Page 1205

Programming The current priority displayed on the control. High priorities (low value in priority enumeration) deactivate the control's operating options. Priority Presentation fire communication Error burglary Alarm maintenance cleaning night Watch simple manual automatic Light scene1…scene3 TF8040 Version: 1.14.0 1205
## Page 1206

Programming The icons used for the various priorities can be set globally [} 1267]. Ba Interface Symbol Names tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Light. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Brightness tchmi:framework#/definitions/Tc Hmi. Building Automation. Number Or Boolean Current brightness value (0-100%). Brightness Feedback tchmi:framework#/definitions/Tc Hmi. Building Automation. Number Or Boolean Feedback for the brightness value (0-100%). Events Event Description on Brightness Changed Triggered when the user changes the brightness. on Hand Mode Reset Triggered when the button for resetting from "hand" to automatic mode is pressed. 6.2.1.2.6.3 Room Control The Room Control can combine the various controls of the room automation. Available components are: • Heating Cooling [} 1200] • Light [} 1203] • Sunblind [} 1210] • Window [} 1214] Use The Room Control can be used to automate a room or area with only one control. It is possible, for example, to combine only one area with lamps so that the overview in the visualization is maintained. Features Operating options and settings correspond to those of the individual controls. Room status The general room information is displayed in the header of the control: 1206 Version: 1.14.0 TF8040
## Page 1207

Programming • Light on or off • Mode or message with the highest priority • Occupancy • Overrun time Side menu for control Clicking on the control opens a side menu containing the controls for the individual areas. Central control Each area contains a header with quick settings for uniform control of all controls. Attributes The control inherits from Base Control [} 1194] and thus has the same attributes. In addition, there are the following attributes. TF8040 Version: 1.14.0 1207
## Page 1208

Programming Feedback concept The control can use the feedback concept [} 60]. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Control Units tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Room Control. Control List Specifies which components (Heating Cooling [} 1200], Light [} 1203], Sunblind [} 1210], Window [} 1214]) are to be added. Name tchmi:general#/definitions/String The room name. Hide Room Status tchmi:general#/definitions/Boolean If TRUE, then the room information (header) is not visible. Show Room Name tchmi:general#/definitions/Boolean If TRUE, the room name [} 1208] is displayed instead of the room information. Ba Data Presence tchmi:general#/definitions/Boolean If TRUE, presence was detected in the room. • Presence active • Presence inactive 1208 Version: 1.14.0 TF8040
## Page 1209

Programming Switch Off Delay Active tchmi:general#/definitions/Boolean If TRUE, the delay for the automatic system is active. • Delay active • Delay inactive Lights Show Lights tchmi:general#/definitions/Boolean If TRUE, the lights are displayed in the control. The components are always visible in the side menu. Further information on the attributes can be found in the documentation for the Light [} 1203] control. Sunblinds Show Sunblinds tchmi:general#/definitions/Boolean If TRUE, the sunblinds are displayed in the control. The components are always visible in the side menu. Further information on the attributes can be found in the Sunblind [} 1210] control documentation. Heating Cooling Show Heating Cooling tchmi:general#/definitions/Boolean If TRUE, the Heating Cooling applications are displayed in the control. The components are always visible in the side menu. Further information on the attributes can be found in the documentation of the Heating Cooling [} 1200] control Windows Show Windows tchmi:general#/definitions/Boolean If TRUE, the windows are displayed in the control. The components are always visible in the side menu. Further information on the attributes can be found in the documentation of the Window [} 1214] control. TF8040 Version: 1.14.0 1209
## Page 1210

Programming 6.2.1.2.6.4 Sunblind The Sunblind control can display and control the position and angle of sunblinds. Use Use on any page where controls are needed to control sunblinds. Features Priorities Display of different priorities via the attribute Priority. Angle setting The angle setting is optional and can only be used if the sunblind supports it. This function is enabled or disabled via the attribute Use Angle. Operation Clicking on the Sunblind control changes the visibility of the menu for setting the position or angle. Attributes The control inherits from Base Room Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Feedback concept The control can use the feedback concept [} 60]. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. 1210 Version: 1.14.0 TF8040
## Page 1211

Programming The attribute is not applicable to all controls. Common Controls tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Controls Specifies the type of controls to be used for position and angle settings. • slider Horizontal • buttons Show Value tchmi:general#/definitions/Boolean If TRUE, the values for angle and position are displayed. Ba Data Priority tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority The current priority displayed on the control. High priorities (low value in priority enumeration) deactivate the control's operating options. TF8040 Version: 1.14.0 1211
## Page 1212

Programming Name Presentation fire storm ice communication Error burglary Alarm maintenance referencing manual Actuator manual Group all Down all Up scene1…scene3 1212 Version: 1.14.0 TF8040
## Page 1213

Programming Name Presentation facade Thermo Automatic facade Twilight Automatic park Position sun Protection group Thermo Automatic group Twilight Automatic The icons used for the various priorities can be set globally [} 1268]. Ba Interface Symbol Names tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Sunblind. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Position tchmi:general#/definitions/Number Current position (0-100%). Position Feedback tchmi:general#/definitions/Number Feedback for the position (0-100%). Angle Use Angle tchmi:general#/definitions/Boolean If TRUE, the controls for controlling the angle are displayed. Angle tchmi:general#/definitions/Number Current angle (0-100%). Angle Feedback tchmi:general#/definitions/Number TF8040 Version: 1.14.0 1213
## Page 1214

Programming Feedback for the angle (0-100%). Angle Step tchmi:general#/definitions/Number Determines the step size with which the angle is adjusted via the angle buttons. Events Event Description on Position Changed Triggered when the user changes the position of the sunblind. on Angle Changed Triggered when the user changes the angle of the sunblind. on Manual Reset Triggered when the button for resetting from "hand" to automatic mode is pressed. 6.2.1.2.6.5 Window The Window control can display and control the position of windows or roof domes with drives. Use Use on any page where controls are needed to control windows. Features Position specification The position of the window can be specified via an analog or binary value if the drive supports it. For analog values, buttons with predefined position values can be displayed. The display of these buttons can be set globally [} 1269]. Operation Clicking on the Window control changes the visibility of the menu for setting the position. 1214 Version: 1.14.0 TF8040
## Page 1215

Programming Attributes The control inherits from Base Room Control [} 1197] and thus has the same attributes. In addition, there are the following attributes. Feedback concept The control can use the feedback concept [} 60]. BA Ba Object tchmi:framework#/definitions/Symbol Symbol for Ba Object [} 60] for using the generic functionalities [} 77] of Tc Hmi Ba. Links a single object or a complete view (including children) to the control. The attribute is not applicable to all controls. Common Show Value tchmi:general#/definitions/Boolean If TRUE, the value for position is displayed. Display Mode tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Window. Display Mode Determines the display mode of the window. Name Presentation roof Dome window Icon Rotation tchmi:general#/definitions/Number Rotates the icon. Angle in degrees. Ba Data Priority tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Room Automation. Window. Priority TF8040 Version: 1.14.0 1215
## Page 1216

Programming The current priority displayed on the control. High priorities (low value in priority enumeration) deactivate the control's operating options. 1216 Version: 1.14.0 TF8040
## Page 1217

Programming Name Presentation fire storm ice communication Error burglary Alarm maintanence referencing manual Actuator manual Group all Down all Up scene1…scene3 TF8040 Version: 1.14.0 1217
## Page 1218

Programming Name Presentation facade Thermo Automatic facade Twilight Automatic park Position sun Protection group Thermo Automatic group Twilight Automatic The icons used for the various priorities can be set globally [} 1269]. Ba Interface Symbol Names tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Window. Ba Interface Symbol Names Edit the Ba Interface Symbol Names [} 1246]. Position tchmi:framework#/definitions/Tc Hmi. Building Automation. Number Or Boolean Current position (0-100%). Position Feedback tchmi:framework#/definitions/Tc Hmi. Building Automation. Number Or Boolean Feedback for the position (0-100%). Events Event Description on Position Changed Triggered when the user changes the position of the window or a roof dome. on Manual Reset Triggered when the button for resetting from "hand" to automatic mode is pressed. 6.2.1.3 Guidlines 6.2.1.3.1 Localization Localization in the Tc Hmi Ba controls is managed by the Twin CAT HMI localization system. 1218 Version: 1.14.0 TF8040
## Page 1219

Programming Localization in the project A Tc Hmi project created with the Tc Hmi Ba project template already contains localizations for German and English. They can be modified, supplemented and extended to include other languages. Add localization Each new language requires a new localization file in the localization folder. The appropriate combination of language and area must then be selected. TF8040 Version: 1.14.0 1219
## Page 1220

Programming A newly created localization file is automatically opened and initially appears empty. Existing language entries from other languages can be shown by activating the Show missing keys option. Localization of controls Localizations of controls from Nu Get packages can be overridden and supplemented with additional languages. Add localization Each new language requires a new localization file in the localization folder. 1220 Version: 1.14.0 TF8040
## Page 1221

Programming The name of the file is generated automatically and is therefore irrelevant. For each control, select any existing localization in order to transfer the language entries. TF8040 Version: 1.14.0 1221
## Page 1222

Programming After confirming the selection, the localization files are available in the project. Finally, the language entries must be replaced in the new localization. 1222 Version: 1.14.0 TF8040
## Page 1223

Programming The available localizations can be shown and hidden via the right-click menu of a column. Override localization The localization of the control must first be imported into the folder for localizations. The name of the file is generated automatically and is therefore irrelevant. TF8040 Version: 1.14.0 1223
## Page 1224

Programming The localizations to be overridden must then be selected. Mgmt Ctrl contains all localizations of the Tc Hmi Ba Framework [} 1242] package and Tc Hmi Ba Controls [} 1122] package. Localization contains all localizations from the Tc Hmi Ba Icons [} 1231] package. After confirming the selection, the localization files are available in the project. 1224 Version: 1.14.0 TF8040
## Page 1225

Programming Export/import localization Excel The localization file menu allows you to export localizations. The exported localizations can be edited in Excel and then re-imported. 6.2.1.3.2 Ba Object handling Almost all existing Tc Hmi Ba controls [} 1122] can process a Ba Object [} 60]. The handling of symbols in the Ba Site-Extension is basically identical to that of the ADS-Extension. Handling A simple example should give you an idea of the possible applications inside and outside a User Control. For this purpose, the Tc Hmi Ba controls Sensor Analog and Textblock are linked to a greatly reduced variant of an analog sensor in a Tc Hmi project. The structure of the PLC is as follows: TF8040 Version: 1.14.0 1225
## Page 1226

Programming Symbol mapping direct Linking the symbol from the Ba Site-Extension directly to the attribute Ba Object of a Tc Hmi Ba control. Symbol mapping via User Control parameters The User Control in this example has the parameters Ba Object01 and Ba Object02 of type Symbol to pass through the symbols from the Ba Site-Extension. The Symbol data type is more performant for the Tc Hmi Ba controls. Due to the data type, it is no longer possible to navigate in the object when creating the binding. However, deeper objects can still be reached by manually extending the symbol. One parameter Symbol for parameter Ba Object01: • IFP01::Top::Children::Sample::Children::Sensor01 Several parameters Symbol for parameter Ba Object01: • IFP01::Top::Children::Sample::Children::Sensor01 Symbol for parameter Ba Object02: • IFP01::Top::Children::Sample::Children::Sensor01::Children::MV 1226 Version: 1.14.0 TF8040
## Page 1227

Programming 6.2.1.3.3 Ba Template handling Template handling Explanation of the functionality using the example of the standard TF8040 PLC template FB_BA_AC_Col T_02 for a cooler. The matching Tc Hmi Ba template FB_BA_AC_Col T_02 expects the following subelements (TF8040 PLC templates) in the linked Ba Object in the predefined hierarchy. Subelements: Symbol name PLC template Description Fdb FB_BA_AI_IO Feedback Mdlt FB_BA_AO_IO Setpoint MV FB_BA_AI_IO Feedback TFl FB_BA_Sensor Analog_IO Flow temperature sensor TRt FB_BA_Sensor Analog_IO Return temperature sensor Vlv FB_BA_Vlv Valve Hierarchy: - BAObject - TFl - MV - TRt - MV - Vlv - Fdb - Mdlt States The states of a Tc Hmi Ba template depend on the Ba Object. No Ba Object The cooler without linked Ba Object. All subelements are present, but without value display. Presentation: TF8040 Version: 1.14.0 1227
## Page 1228

Programming Subelement missing The cooler has been assigned a Ba Object in which the valve (Vlv) is missing. The validation registers that a top-level subelement does not exist or has a different symbol name, and therefore hides it. Hierarchy: - BAObject - TFl - MV - TRt - MV Presentation: Symbol name renamed In this Ba Object the top level subelements are correctly present, but the symbol name for Fdb from the Vlv has been renamed in the PLC template. Since the deviation occurs in one of the lower levels, the affected subelement is shown with the value display in the error state. Hierarchy: 1228 Version: 1.14.0 TF8040
## Page 1229

Programming - BAObject - TFl - MV - TRt - MV - Vlv - Fdb_Test - Mdlt Presentation: In addition, an error message indicates the subelement. Customize symbol names New symbol names can be communicated via the Ba Template Description. TF8040 Version: 1.14.0 1229
## Page 1230

Programming A dialog lists all subelements and allows navigation through the further levels [1]. The identifier refers to the symbol name of the current level [2]. If this specification is no longer possible, then the last level of the subelement is reached [3]. At Feedback the current symbol name for Fdb from the PLC template is to be entered. After confirming the input, the Tc Hmi Ba template performs the validation of the Ba Object again. Presentation: The cooler is fully functional again. Using nested Ba Objects If the Ba Objects, e.g. for the command of a motor, are not on the level provided by default, but in a lower level, these nested objects can be accessed with the following syntax. My View::Motor::Cmd 1230 Version: 1.14.0 TF8040
## Page 1231

Programming 6.2.1.4 Icons Tc Hmi Ba contains various icons that are necessary for the implementation of visualizations for building automation. The icons are created in *.svg format and are intended for use on the web. Installation In order to use the icons, the Nu Get package Beckhoff. Twin CAT. HMI. BA. Icons must be installed. Since there is a dependency on the Beckhoff. Twin CAT. HMI. Framework, this is also installed. Use There are three different application options. TF8040 Version: 1.14.0 1231
## Page 1232

Programming ZIP archive A Nu Get package is basically a ZIP archive that allows direct use of the icons after unpacking. The unpacked content looks like this: Only the folder Icons is relevant. It contains the various icons divided according to content categories. Gallery Explorer After installing the Nu Get package in a Twin CAT HMI project, the icons integrate into the Gallery Explorer. 1232 Version: 1.14.0 TF8040
## Page 1233

Programming The icons here are arranged according to function. To use an icon from the Gallery Explorer, it must be dragged and dropped into a folder in the project. The icon is created as a copy in the project directory, not as a reference. Use as reference When using the icons as reference, their extended functionalities can be used. In addition, the icons benefit directly from updates to the Nu Get package. Tc Hmi project With the function Tc Hmi. Building Automation. Functions. Get Ba Icon Path() the icons can be used as a reference in a Tc Hmi project. The following steps are required: 1. Drag a control (e.g. a button) to the content/view. 2. Create the Function Binding. 3. In the field Backgroundimage enter Get Ba Icon Path (function is suggested). 4. Path specification to the icon, e.g. "HVAC/fan" (quotation marks must be observed). 5. Adjust size and position. The path information can be taken from the structure of the Gallery Explorer. ð After that the button should look like this: The extended functions of the icons can only be used with controls from the Nu Get package Beckhoff. Twin CAT. HMI. BA. Controls. The controls that have a category Icon have extended setting options. As an example, the button from the category BA | Common is used below. TF8040 Version: 1.14.0 1233
## Page 1234

Programming The Icon attribute can be set again using the Tc Hmi. Building Automation. Functions. Get Ba Icon Path() function. This form of embedding allows the icon to change dynamically. The following attributes are available: • Icon Rotation • Icon Rotation Speed • Icon Rotation Direction • Icon Color (see Colors category) In the code For using the icons in the code, e.g. when developing framework controls, the icon paths can be accessed even more easily. The namespace Tc Hmi. Building Automation. Icons contains constants that point to the respective icons in the Nu Get package (e.g. Tc Hmi. Building Automation. Icons. HVAC. Fan.path). HVAC symbols Symbols for P&I diagrams. The icons are drawn with appropriate size ratios for an P&I diagram and are only shown differently in this listing. 1234 Version: 1.14.0 TF8040
## Page 1235

Programming Event symbols Symbols to represent alarms, events or notifications. Events The concept of alarms [} 32] uses the following icons. TF8040 Version: 1.14.0 1235
## Page 1236

Programming Icon Name Alarm Fault Maintenance Notification Miscellaneous The events [} 32] are displayed in different states. Flag The flag icons are displayed when one of the Status Flags of an object is active. 1236 Version: 1.14.0 TF8040
## Page 1237

Programming Icon Name In Alarm Fault Overridden Out Ofservice TF8040 Version: 1.14.0 1237
## Page 1238

Programming Priorities Icon Name Life Safety Critical Manual Local Manual Remote Lock Icon Name High Medium 1238 Version: 1.14.0 TF8040
## Page 1239

Programming Node Type TF8040 Version: 1.14.0 1239
## Page 1240

Programming Icon Name Aggregate Buildings Building element Component Control cabinet Floor Information focus Property Plant 1240 Version: 1.14.0 TF8040
## Page 1241

Programming Icon Name Room Technical system Object Type Symbols for the different object types. Room Automation Symbols for room automation. Standard Standard symbols for visualizations. TF8040 Version: 1.14.0 1241
## Page 1242

Programming 6.2.1.5 Framework The framework contains various classes, enumerations, interfaces and types that are used to create the controls [} 1122]. Various helper methods facilitate server-client communication, access to different content and positioning in a control. There are no controls in the package because it is intended for use in framework control projects. The framework is written in Type Script. If the complete solution TF8040 [} 8] is used, the framework also takes over many management functions to realize the Generic [} 54]. Installation In order to use the framework, the Nu Get package Beckhoff. Twin CAT. HMI. BA. Framework must be installed. In addition, further functions are required, which originate from the following Nu Get packages that are automatically installed as well: • Beckhoff. Twin CAT. HMI. BA. Icons [} 1231] • Beckhoff. Twin CAT. HMI. Framework Ensure that the files from the framework are loaded in the project. When used in a Tc Hmi framework project, the appropriate packages must be entered in the Manifest.json. 1242 Version: 1.14.0 TF8040
## Page 1243

Programming Intelli Sense support for the framework in Visual Studio can be achieved by adding the following entries to tsconfig.tpl.json: "include": [ "$(Beckhoff. Twin CAT. HMI. Framework). Install Path/Tc Hmi.d.ts", "$(Beckhoff. Twin CAT. HMI. BA. Icons). Install Path/index.d.ts", "$(Beckhoff. Twin CAT. HMI. BA. Framework). Install Path/index.d.ts" ] 6.2.1.5.1 BA 6.2.1.5.1.1 BAObject Handler The Ba Object Handler takes over the management of the Ba Object. Use The implementation is done via the respective interfaces. IUses Ba Object Provision of the Ba Object Handler. Requires: • Tc Hmi Ba Framework module My Namespace { export class My Class<A extends My Class. IAttributes = My Class. IAttributes> extends Tc Hmi. Building Automation. Base implements Tc Hmi. Building Automation. Ba Object Handler. IUses Ba Object { public ba Object Handler: Tc Hmi. Building Automation. Ba Object Handler; constructor(id: string, parent: Tc Hmi. Building Automation. IBase Node | null, attr?: A) { super(id, parent, attr); this.ba Object Handler = new Tc Hmi. Building Automation. Ba Object Handler(this); } public process Ba Object() { if (this.ba Object Handler.ba Object == null) return; // do work } } export module My Class { export interface IAttributes extends Tc Hmi. Building Automation. Base. IAttributes { TF8040 Version: 1.14.0 1243
## Page 1244

Programming // optional additional attributes } } } IFCUses Ba Object Providing the Ba Object Handler with Ba Object attribute for the Tc Hmi Designer. Requires: • Tc Hmi Ba Framework • Tc Hmi Ba Controls module My Namespace { export class My Control extends Tc Hmi. Building Automation. Controls. System. Base Control implements Tc Hmi. Building Automation. Ba Object Handler. IFCUses Ba Object { public ba Object Handler: Tc Hmi. Building Automation. Ba Object Handler; constructor(element: JQuery, pc Element: JQuery, attrs: Tc Hmi. Controls. Control Attribute List) { super(element, pc Element, attrs); this.ba Object Handler = new Tc Hmi. Building Automation. Ba Object Handler(this); } public process Ba Object() { if (this.ba Object Handler.ba Object == null) return; // do work } public set Ba Object(p: Tc Hmi. Building Automation. BA. Ba Basic Object | Tc Hmi. Building Automation. BA. Ba Basic Object. IBa Basic Object Attributes | Tc Hmi. Symbol | null | undefined): this { this.ba Object Handler.set Ba Object(p); return this; } public get Ba Object() { return this.ba Object Handler.ba Object; } } } In the interface IFCUses Ba Object the setters and getters for the Ba Object are already defined, so in the Description.json only the Ba Object attribute has to be defined. "attributes": [ { "name": "data-tchmi-ba-object", "display Name": "Ba Object", "property Name": "Ba Object", "property Setter Name": "set Ba Object", "property Getter Name": "get Ba Object", "visible": true, "themeable": "None", "type": "tchmi:framework#/definitions/Symbol", "category": "BA", "description": "BA object of the control.", "required On Compile": false, "read Only": false, "bindable": true, "heritable": true, "default Value": null, "default Value Internal": null } ] 1244 Version: 1.14.0 TF8040
## Page 1245

Programming Properties Name Description load Children Determines whether all child elements are loaded when setting the Ba Object (as Ba View). load Texts Determines whether all texts are loaded when setting the Ba Object (as Ba View). enable Parent Ba Object Proces Determines whether the Ba Object processor of the parent control is called. sor ba Object Returns the Ba Object. ba Object Symbol Expression Returns the Symbol Expression from the Ba Object. is Loading Ba Object Checks if the Ba Object is set but still loading. Methods Name Description set Ba Object Sets the Ba Object. resolve Ba Object Resolves the passed information to create a Ba Object. read Ba Object Reads the Ba Object from the server. watch Ba Variable Adds a watch to the passed Ba Variable. The Watch is also destroyed when the class is destroyed. try Watch Ba Variable Attempts to monitor a Ba Variable. try Watch Children Ba Variable Attempts to monitor a Ba Variable of a child element of a Ba View. watch Value Range Monitors the value range of a specific variable. check Ba Object Access Checks the Operation Type and the write access of the Ba Variable Value Rm. Events Name Description on Ba Object Changed Triggered when the Ba Object has changed. 6.2.1.5.2 Helper 6.2.1.5.2.1 Ba Interface Handler The Ba Interface Handler is a helper class that handles the management of the Ba Interfaces of a control. With the help of the Ba Interfaces it is possible to link several data points from one control with only one binding. Ba Interface The Ba Interface attribute is associated with a Tc Hmi symbol. This symbol must have a certain structure, which is described by the Ba Interface definition. Sample The Ba Interface of a checkbox has the following structure: export type Ba Interface = { state: boolean, state Feedback?: boolean, active Text?: string, inactive Text?: string, } For the connected symbol to be valid for the Ba Interface of the checkbox, the symbol must have the described subsymbols with the corresponding data type. TF8040 Version: 1.14.0 1245
## Page 1246

Programming Ba Interface Definition A control that uses the Ba Interface Handler must implement the interface IUses Ba Interface<T>. The type parameter T should describe the structure of the used Ba Interfaces. Here using the data type Checkbox. Ba Interface: export class Checkbox implements IUses Ba Interface<Checkbox. Ba Interface> Since Type Script types cannot be interpreted by Java Script at runtime, it is necessary to define the Ba Interface Definition as a constant. Here the data type of the respective element must be specified and optional elements of the Ba Interfaces can be defined via the property optional. Optional elements are not considered in the later validation of the Ba Interfaces. If required elements are not found during validation, error messages will occur and the Ba Interface will not be processed further. export const Ba Interface Def: Ba Interface Definition<Ba Interface> = { state: { type: 'boolean' }, state Feedback: { type: 'boolean', optional: true }, active Text: { type: 'string', optional: true }, inactive Text: { type: 'string', optional: true } }; It is possible to specify multiple data types. command: { type: ['number', 'boolean'] } Ba Interface Symbol Names The default values of Ba Interface Symbol Names, as well as the expected data types can be found in the tooltip of the dialog for setting Ba Interface Symbol Names. 1246 Version: 1.14.0 TF8040
## Page 1247

Programming So that the Ba Interface Handler can access the corresponding sub-symbols of the Ba Interfaces, it is necessary to specify a symbol name for each element of the interface. The symbol name corresponds to the name of the variable in the connected function block / structure. This can be done, for example, by a variable Checkbox. Ba Interface Symbol Names : export let Ba Interface Symbol Names: Ba Interface Symbol Names<Ba Interface> = { state: { symbol Name: 'State' }, state Feedback: { symbol Name: 'State Feedback' }, active Text: { symbol Name: 'Active Text' }, inactive Text: { symbol Name: 'Inactive Text' } } The symbol name should be able to be adapted for later use if the symbol is called differently in the connected function block/structure (e.g. symbol Name: "b State" ). It is also possible to use subsymbols. If the state is e.g. in a structure or a function block within the connected symbol, it can be accessed (e.g. symbol Name: "Command::b Value Rm"). There are two possibilities for overwriting these default symbol names, which are explained below. Attribute Ba Interface Symbol Names Since the setters and getters for the Ba Interface Symbol Names are already defined in the interface IUses Ba Interface<T>, the following attribute can be defined in the Description.json so that the symbol names can be changed in the designer: { "name": "data-tchmi-ba-interface-symbol-names", "display Name": "Ba Interface Symbol Names", "property Name": "Ba Interface Symbol Names", "property Setter Name": "set Ba Interface Symbol Names", TF8040 Version: 1.14.0 1247
## Page 1248

Programming "property Getter Name": "get Ba Interface Symbol Names", "visible": true, "themeable": "None", "display Priority": 61, "type": "tchmi:framework#/definitions/ Tc Hmi. Building Automation. Common. Checkbox. Ba Interface Symbol Names", "category": "Ba Data", "description": "Symbol names for the interface symbol.", "required On Compile": false, "read Only": false, "bindable": true, "heritable": true, "default Value": null, "default Value Internal": null } The type is to be defined in the Types. Schema.json. Overwrite in on Initialized If the symbol names for all controls are to be overwritten, it is not practical to edit the Ba Interface Symbol Names attribute of each control separately. The default symbol names can be globally overwritten in the on Initialized event. For this purpose, a Code Behind function is created with the following content: module Tc Hmi { var destroy On Initialized = Tc Hmi. Event Provider.register('on Initialized', function (e, data) { e.destroy(); // overwrite Ba Interface Symbol Names of the Checkbox Building Automation. Controls. Checkbox. Ba Interface Symbol Names = { state: { symbol Name: 'b State' }, state Feedback: { symbol Name: 'b Stat Fdb' }, active Text: { symbol Name: 's Active Text' }, inactive Text: { symbol Name: 's Inactive Text' } } }); } It is not necessary to set the symbol names of all elements. Only the elements that have not been marked as optional are to be set. Initialization The Ba Interface Handler must be initialized in the __prev Init() method of the control. The following steps must be performed during initialization. // Create instance of Ba Interface Handler this.ba Interface Handler = new Ba Interface Handler<Checkbox. Ba Interface>(this); // Set the Ba Interface Definition this.ba Interface Handler.ba Interface Definition = Checkbox. Ba Interface Def; // Set the default symbol names this.set Ba Interface Symbol Names(Checkbox. Ba Interface Symbol Names); Use The implementation of the setter for the Ba Interface attribute can look like this: public set Ba Interface(p: Ba Interface Symbol<Checkbox. Ba Interface> | null | undefined): this { this.ba Interface Handler.set Ba Interface Sym(p, () => { // do work with the validated Ba Interface 1248 Version: 1.14.0 TF8040
## Page 1249

Programming }); return this; } public get Ba Interface() { return this.ba Interface Handler.get Ba Interface Sym(); } Here you can see that for the setter the method set Ba Interface Sym()of the Ba Interface Handler is used. In addition to the symbol, this also expects a Processor method that is called when the Ba Interface Symbol has been validated or the Ba Interface Symbol Names have changed. The setters and getters for the Ba Interface Symbol Names attribute can be implemented as follows: public set Ba Interface Symbol Names(p: Ba Interface Symbol Names<Checkbox. Ba Interface> | Ba Interface Symbol Names Designer | null | undefined): this { if (p != null) this.ba Interface Handler.update Symbol Names(Ba Interface Handler.convert To Ba Interface Symbol Names (p)); return this; } public get Ba Interface Symbol Names(): Ba Interface Symbol Names<Checkbox. Ba Interface> | null | undefined { return this.ba Interface Handler.ba Interface Description; Methods The most important methods of the Ba Interface Handler are described below. Name Description has Sub Symbol Checks if the Ba Interface has a specific subelement. This method must be used if optional elements are to be read or written. write Sub Symbol Writes the value of a subelement. watch Sub Symbol Creates a subscription for a subelement. update Symbol Names Updates the symbol names of the Ba Interface subelements. convert To Ba Interface Sym Converts the data type Ba Interface Symbol Names Designer to bol Names Ba Interface Symbol Names. If the data type Ba Interface Symbol Names is already passed to the method, no conversion is performed and the object is returned directly. 6.2.1.5.3 Busy Handler The Busy Handler is a class of Tc Hmi Ba Framework [} 1242]. It provides information about whether a control is still busy (e.g. waiting for information from the Twin CAT HMI Server). Recognizable by the loading animation. Functions log Timer Results Of Control Checks which actions on a control lead to loading times. Namespace: Tc Hmi. Building Automation. Busy Handler.log Timer Results Of Control Is only applicable to controls that implement the Tc Hmi. Building Automation. Busy Handler. IBusy Handler interface. TF8040 Version: 1.14.0 1249
## Page 1250

Programming Preparation Before use, the recording of timer results must be activated. This can be done, for example, at the project level with a code-behind function: let Tc Hmi. Event Provider.register('on Initialized', function (e, data) { e.destroy(); Tc Hmi. Building Automation. Busy Handler. Record Timer Results = true; } Use The call is made in the console of the browser after a control has been loaded. The ID of the control is necessary for this. Tc Hmi. Building Automation. Busy Handler.log Timer Results Of Control('Die Control Id') Evaluation The results of the timers are available in the console window: It is recognizable what the control was busy with. In this case, a sub-element with ID Checkbox_Sp_2-ba-fc was waited for, which was busy loading the Ba Object most of the time. 6.2.1.6 Functions 6.2.1.6.1 Add Badge Adds a number display to a control in the upper right corner. The display is optimized for Tc Hmi Ba Controls. Use The function is called event-driven and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter Control tchmi:framework#/definitions/Control Control for the badge extension. 1250 Version: 1.14.0 TF8040
## Page 1251

Programming Count tchmi:general#/definitions/Number Number to be displayed. Is visible when the value is greater than 0. Restriction to "99+" from three-digit values. 6.2.1.6.2 Convert Hex To Rgba Color Converts a hex color to an RGBA color. Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter Hex tchmi:general#/definitions/String Hex color to be converted. Return value tchmi:framework#/definitions/Tc Hmi. Building Automation. Color. RGBAColor RGBA color. 6.2.1.6.3 Convert Hsl To Rgba Color Converts an HSL color to an RGBA color. Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter HSL tchmi:framework#/definitions/Tc Hmi. Building Automation. HSLColor HSL color to be converted. Return value tchmi:framework#/definitions/Tc Hmi. Building Automation. Color. RGBAColor RGBA color. 6.2.1.6.4 Convert Rgba To Hex Color Converts an RGBA color to a hex color. Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. TF8040 Version: 1.14.0 1251
## Page 1252

Programming Parameter RGBA tchmi:framework#/definitions/Tc Hmi. Building Automation. Color. RGBAColor RGBA color to be converted. Return value tchmi:general#/definitions/String Hex color. 6.2.1.6.5 Convert Rgba To Hsl Color Converts an RGBA color to an HSL color. Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter RGBA tchmi:framework#/definitions/Tc Hmi. Building Automation. Color. RGBAColor RGBA color to be converted. Return value tchmi:framework#/definitions/Tc Hmi. Building Automation. HSLColor HSL color. 6.2.1.6.6 Convert Rgba To Solid Color Converts an RGBA color to a Tc Hmi solid color. Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter RGBA tchmi:framework#/definitions/Tc Hmi. Building Automation. Color. RGBAColor RGBA color to be converted. Return value tchmi:framework#/definitions/Solid Color Tc Hmi Solid color. 6.2.1.6.7 Convert Solid To Rgba Color Converts a Tc Hmi solid color to an RGBA color. 1252 Version: 1.14.0 TF8040
## Page 1253

Programming Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter Solid tchmi:general#/definitions/Solid Color Tc Hmi Solid color to be converted. Return value tchmi:framework#/definitions/Tc Hmi. Building Automation. Color. RGBAColor RGBA color. 6.2.1.6.8 Convert Unit To String Converts the value of a BA. Unit enumeration into a unit. Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter Unit tchmi:general#/definitions/Number Partial path from icon. Return value tchmi:general#/definitions/String Unit. 6.2.1.6.9 Get Ba Icon Path Returns the full path of an icon for a partial path. Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. The partial path for the function parameter corresponds to the structure of the Nu Get package Beckhoff. Twin CAT. HMI. BA. Icons, as it can be seen in the Twin CAT HMI Gallery Explorer. Valid call options: Get Ba Icon Path('HVAC/Cooler.svg') Get Ba Icon Path('HVAC/cooler.svg') Get Ba Icon Path('HVAC/Cooler') Get Ba Icon Path('HVAC/cooler') TF8040 Version: 1.14.0 1253
## Page 1254

Programming Parameter Path tchmi:general#/definitions/String Partial path from icon. Return value tchmi:general#/definitions/String Full path from the icon. 6.2.1.6.10 Get Current User Name Returns the name of the active user (no authentication corresponds to __System Guest) or null if unknown (e.g. when loading). Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. Return value tchmi:general#/definitions/String User name. 6.2.1.6.11 Get Fade Color Calculates a color between two colors to a corresponding value. Use The function can be called event-driven as well as via the Function Binding and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter Start Color tchmi:framework#/definitions/Solid Color Start color of the cross-fade. Start Value tchmi:framework#/definitions/Number Start value of the cross-fade. End Color tchmi:framework#/definitions/Solid Color End color of the cross-fade. End Value tchmi:framework#/definitions/Solid Color End value of the cross-fade. Value tchmi:framework#/definitions/Number 1254 Version: 1.14.0 TF8040
## Page 1255

Programming Value used to calculate the color. Return value tchmi:general#/definitions/Solid Color Calculated color. 6.2.1.6.12 Load User Dependent Content Loads a specified content when the specified user is logged in. Use The function is called event-driven and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter Host Region tchmi:framework#/definitions/Tc Hmi. Controls. System. Tc Hmi Region The host region to which the content should be loaded. User Contents tchmi:framework#/definitions/Tc Hmi. Building Automation. User Contents Collection of users with their associated content. Store Last Content tchmi:general#/definitions/Boolean Determines whether the last content will be reloaded on the user's next visit. 6.2.1.6.13 Open Ba Trend Opens a dialog in which the trend from a linked Ba Object or the trends from a Ba View are displayed. Use The function is called event-driven and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter Ba Object tchmi:framework#/definitions/Content Path The Ba Object / Ba View whose trends are displayed. 6.2.1.6.14 Open Dialog Window Opens a content page in a dialog. Use The function is called event-driven and can be found in the Actions and Conditions editor under Functions > Building Automation. TF8040 Version: 1.14.0 1255
## Page 1256

Programming Parameter Content tchmi:framework#/definitions/Content Path Path to the content to be displayed. Buttons tchmi:framework#/definitions/Tc Hmi. Building Automation. Dialog Window Buttons Buttons for closing or confirming the dialog. Modal tchmi:general#/definitions/Boolean Determines whether the dialog is opened modally or not. Scrolling tchmi:framework#/definitions/Scroll Mode Determines whether the content can be scrolled. Headline tchmi:general#/definitions/String Title of the dialog. Width tchmi:general#/definitions/Number Width of the dialog. Width Unit tchmi:framework#/definitions/Measurement Unit Unit of the width of the dialog. Height tchmi:general#/definitions/Number Height of the dialog. Height Unit tchmi:framework#/definitions/Measurement Unit Unit of the height of the dialog. 6.2.1.6.15 Open Legend Dialog Opens an instance of the Legend [} 1124] control in a dialog. Use Use The function is called event-driven and can be found in the Actions and Conditions editor under Functions > Building Automation. 1256 Version: 1.14.0 TF8040
## Page 1257

Programming Parameter Modal tchmi:general#/definitions/Boolean Determines whether the dialog is opened modally or not. Buttons tchmi:framework#/definitions/Tc Hmi. Building Automation. Dialog Window Buttons Buttons for closing or confirming the dialog. Width tchmi:framework#/definitions/Measurement Value Width of the dialog. Width Unit tchmi:framework#/definitions/Measurement Unit Unit of the width of the dialog. Height tchmi:framework#/definitions/Measurement Value Height of the dialog. Height Unit tchmi:framework#/definitions/Measurement Unit Unit of the height of the dialog. Entry Width tchmi:framework#/definitions/Measurement Value Width of an entry. Entry Width Unit tchmi:framework#/definitions/Measurement Unit Unit of width of an entry. Tab Position tchmi:framework#/definitions/Tc Hmi. Building Automation. Position Position of the tabs. Icon Data Source tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Building General. Legend. Icon Data Source Selection of entries to be displayed. Icon Data Custom tchmi:framework#/definitions/Tc Hmi. Building Automation. Controls. Building General. Legend. Icon Data List List with additional entries. 6.2.1.6.16 Open Light Zone Dialog Opens an instance of the Light Zone control in a dialog. TF8040 Version: 1.14.0 1257
## Page 1258

Programming Use The function is called event-driven and can be found in the Actions and Conditions editor under Functions > Building Automation. Parameter Ba Object tchmi:framework#/definitions/Symbol Ba Object for the control. 6.2.1.6.17 Open Trend Collection View Opens a dialog for Monitoring trend collections [} 57]. Use The function is called event-driven and can be found in the Actions and Conditions editor under Functions > Building Automation. 6.2.1.6.18 Update Object Info Updates the object information of all objects in all BA devices. Use The function is called event-driven and can be found in the Actions and Conditions editor under Functions > Building Automation. 6.2.1.6.19 Use Ba Objects In User Control Description By default, a User Control reads out the complete structure behind a linked parameter, which can lead to a high communication traffic. With a Ba Object (e.g. Ba View) this can quickly become a lot of data. This function reduces the server communication to a minimum when using a Ba Object as a parameter in a User Control. Use The parameter from the User Control for the Ba Object must be of type Symbol. By this definition the parameter is not read, but only passed on. Likewise the name of the parameter must be Ba Object! In this way, access to the underlying symbols of the Ba Object is no longer possible. The function should be called whenever the Ba Object parameter has been changed. For this purpose, a new event . Ba Object is created. 1258 Version: 1.14.0 TF8040
## Page 1259

Programming In the configuration window of the event, the function is selected in the folder "Functions > Building Automation > Use Ba Object In User Control". The controls in the User Control are then linked to the Ba Object or its subelements via the identifiers of the controls. TF8040 Version: 1.14.0 1259
## Page 1260

Programming It is also possible to connect User Controls within a User Control with Ba Objects. The identifier must be assigned as explained in the next paragraph. Likewise, the inner User Control must then also have the parameter Ba Object. Linking Ba Object To use the Ba Object directly, the control must have the identifier $User Control Name$. Root. $User Control Name$ is replaced with the name of the User Control. Make sure that the root element of the User Control has the same name as the file of the User Control. Subelements of Ba Object To use a subelement, the control must carry the symbol path as identifier. Explanation using the example of a Ba View with the following structure. Access to the element Pu is via the symbol path $User Control Name$. Pu as identifier. 1260 Version: 1.14.0 TF8040
## Page 1261

Programming Access to the element Cmd is via the symbol path $User Control Name$. Pu. Cmd as identifier. Parameters from Ba Object Access to the parameter of an element is done via the symbol path. Example: • $User Control Name$. Root.s Description • $User Control Name$. Pu. Cmd.b Present Value • $User Control Name$. Op Mod. Op Mod Man.n Present Value • $User Control Name$. Htg Lmt. Sp.f Present Value If the control is of type Checkbox [} 1135], Combo Box [} 1139] or Input Box [} 1144], then the value of the parameter is written to the PLC after the user interaction is terminated. Without Ba Object or Ba Parameter If the control or User Control within the User Control is not to work with a Ba Object or Ba Parameter, then the identifier of the control must not contain $User Control Name$.. Parameter User Control tchmi:framework#/definitions/Tc Hmi. Controls. System. Tc Hmi User Control The User Control in which the Ba Objects are to be used. Mostly this parameter is the User Control itself (self). Ba Object tchmi:general#/definitions/Object The User Control parameter to which the Ba Object is connected from the outside must be linked with this parameter. TF8040 Version: 1.14.0 1261
## Page 1262

Programming 6.2.1.7 Server extensions 6.2.1.7.1 Ba Site Extension Description The Ba Site-Extension serves as an interface between a TF8040 PLC (TF8040 Getting Started [} 64]) and a Tc Hmi client. The extension makes it possible to offer generic functions that significantly simplify and accelerate the engineering of the HMI. Links between the PLC and the HMI server are still possible via the ADS extension, even without the extension. In this case the benefits referred to above no longer apply. Use To be able to use the generic functionalities in a project, the extension [} 77] must be installed. Configuration The extension can be configured in Tc Hmi engineering or via the configuration page of the HMI server. Configuration from Tc Hmi engineering: General Interval This time determines how often variables are read (updated) in the interface. Event setting These settings influence the behavior of the event history. You can set how many events are saved in the event history and from which number the events are historized. Devices The extension must be notified of the devices to which the HMI is to connect. The devices can be added or removed via the configuration mask. 1262 Version: 1.14.0 TF8040
## Page 1263

Programming Settings required for each device: • Determination whether enabled/disabled • Ams Net Id • PLC port The configuration is activated by clicking on Accept. Checking the configuration In the Twin CAT HMI Configuration window, all devices should now be listed under All symbols. TF8040 Version: 1.14.0 1263
## Page 1264

Programming A mapping for the device was also created. Required mappings The mapping automatically created for each device with the same name as the device itself is mandatory and must not be renamed or deleted. Activating the configuration automatically adds a device of the same name and with the same settings in the ADS extension. This device in the ADS extension is also mandatory and must not be renamed or deleted. User management User groups Here, the user groups _Guest_, _Basic_, _Advanced_, _Expert_ and _Internal_ can each be assigned user groups from the HMI. It can be configured that different user groups receive the same user level. 1264 Version: 1.14.0 TF8040
## Page 1265

Programming Symbols Device symbols A dynamic symbol with the same name as the device is created for each device. The structure of the first level of a device symbol is always the same. The first level contains the top node of the device, where the children are located. These Children are thus the first actual elements in the project structure. Events The symbol offers various subsymbols that refer to the current events of all. TF8040 Version: 1.14.0 1265
## Page 1266

Programming • Acknowledgeable Count: Active events that require an interaction from the user (acknowledge) • Count: Number of all events • List: The list of events • This makes the symbol suitable for a cross-device event list [} 1166]. Event History The symbol offers various subsymbols that refer to the event history of all devices. • Count: Number of all events in the history. • List: The list of events in the history. This makes the symbol suitable for a cross-device event history [} 1166]. 6.2.1.8 Global settings The global settings of the various Tc Hmi Ba Nu Get packages can be overwritten. The entry point is the callback from the Tc Hmi Ba Events.on Override Settings event that is to be created in the Code Behind. (function (Tc Hmi) { Tc Hmi. Event Provider.register(Tc Hmi. Building Automation. Tc Hmi Ba Events.on Override Settings, function ( e, data) { e.destroy(); // Todo }); })(Tc Hmi); The value is then changed in the To Do area, as described below for the respective property. Tc Hmi Ba Controls Event List Default Columns Defines the default column settings for all Event List [} 1166] controls. Tc Hmi. Building Automation. Controls. Management. Event List. Default Columns = [ { type: Tc Hmi. Building Automation. Controls. Management. Event List. Columns.ba Identifier, width: 30, width Unit: 'px' }, { type: Tc Hmi. Building Automation. Controls. Management. Event List. Columns.event, width: 30, width Un it: 'px' }, { type: Tc Hmi. Building Automation. Controls. Management. Event List. Columns.timestamp, width: 140, wi dth Unit: 'px' }, { type: Tc Hmi. Building Automation. Controls. Management. Event List. Columns.device, width: 70, width U nit: 'px' }, { type: Tc Hmi. Building Automation. Controls. Management. Event List. Columns.object Name, width: 300, w idth Unit: 'px' }, 1266 Version: 1.14.0 TF8040
## Page 1267

Programming { type: Tc Hmi. Building Automation. Controls. Management. Event List. Columns.instance Path, width: 300, width Unit: 'px' }, { type: Tc Hmi. Building Automation. Controls. Management. Event List. Columns.description, width: 300, width Unit: 'px' }, { type: Tc Hmi. Building Automation. Controls. Management. Event List. Columns.event Class, width: 30, wi dth Unit: 'px' }, { type: Tc Hmi. Building Automation. Controls. Management. Event List. Columns.event Class Instance Descrip tion, width: 200, width Unit: 'px' } ]; Maximum Event Type Pulse Defines for each user level whether a pulse is displayed if an active event with this or a higher priority [} 103] is pending. Setting a value. Tc Hmi. Building Automation. Controls. Management. Event List. Maximum Event Type Pulse.set(Tc Hmi. Building Autom ation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Type.e Disturb); Setting all values. Tc Hmi. Building Automation. Controls. Management. Event List. Maximum Event Type Pulse = new Map([ [Tc Hmi. Building Automation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Basic, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Advanced, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Expert, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Internal, Tc Hmi. Building Automation. BA. Event Type.e Disturb] ]); Project Navigation Textual Default Content View Dialog Width Defines the default size of the dialog that displays the content of a Ba Object. Tc Hmi. Building Automation. Controls. Management. Project Navigation Textual. Default Content View Dialog Width = 1000; Room Control Default Ba Object List Dialog Width Defines the default size of the dialog that displays the Ba Object list. Tc Hmi. Building Automation. Controls. Room Automation. Room Control. Default Ba Object List Dialog Width = 1000; Light Show Quick Links Defines whether the quick settings are displayed for Light-Control [} 1203]. Tc Hmi. Building Automation. Controls. Room Automation. Light. Show Quick Links = false; TF8040 Version: 1.14.0 1267
## Page 1268

Programming Priority Icons Defines the icons that are displayed on the Light-Control [} 1203] for a certain priority. If no icon is defined for a priority, nothing is displayed. Setting a value. Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority Icons.set(Tc Hmi. Building Automation. Co ntrols. Room Automation. Light. Priority.fire, Tc Hmi. Building Automation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Fire Alarm, color: Tc Hmi. Building Automation. Color. RGBAColor. Red })); Setting all values. Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority Icons = new Map([ [Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority.fire, Tc Hmi. Building Automation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Fire Alarm, colo r: Tc Hmi. Building Automation. Color. RGBAColor. Red })], [Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority.communication Error, Tc Hmi. Build ing Automation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Events. Fla g. Fault, color: Tc Hmi. Building Automation. Color. RGBAColor. Red })], [Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority.burglary, Tc Hmi. Building Automat ion. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Burglar Alar m, color: Tc Hmi. Building Automation. Color. RGBAColor. Red })], [Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority.maintenance, Tc Hmi. Building Auto mation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Maintena nce, color: Tc Hmi. Building Automation. Color. RGBAColor. Dark Orange })], [Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority.cleaning, Tc Hmi. Building Automat ion. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Cleaning, c olor: Tc Hmi. Building Automation. Color. RGBAColor. Yellow })], [Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority.night Watch, Tc Hmi. Building Autom ation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Night Watc h, color: Tc Hmi. Building Automation. Color. RGBAColor. Blue })], [Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority.manual, Tc Hmi. Building Automatio n. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Room Automation. Manual, color: Tc Hmi. Building Automation. Color. RGBAColor. Dark Orange })], [Tc Hmi. Building Automation. Controls. Room Automation. Light. Priority.automatic Light, Tc Hmi. Building A utomation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Room Automation . Automatic, color: Tc Hmi. Building Automation. Color. RGBAColor. Tc Hmi Green })] ]); Sunblind Priority Icons Defines the icons that are displayed on the Sunblind control [} 1210] for a certain priority. If no icon is defined for a priority, nothing is displayed. Setting a value. Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority Icons.set(Tc Hmi. Building Automation . Controls. Room Automation. Sunblind. Priority.fire, Tc Hmi. Building Automation. Icons.convert IIcon Data To II con Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Fire Alarm, color: Tc Hmi. Building Automation. Color. RGBAColor. Red })); Setting all values. Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority Icons = new Map([ [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.fire, Tc Hmi. Building Automati on. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Fire Alarm, c olor: Tc Hmi. Building Automation. Color. RGBAColor. Red })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.storm, Tc Hmi. Building Automat ion. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Storm Alarm, color: Tc Hmi. Building Automation. Color. RGBAColor. Blue })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.ice, Tc Hmi. Building Automatio n. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Ice Alarm, col or: Tc Hmi. Building Automation. Color. RGBAColor. Blue })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.comm Error, Tc Hmi. Building Aut omation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Events. Flag. Faul t, color: Tc Hmi. Building Automation. Color. RGBAColor. Red })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.burglary, Tc Hmi. Building Auto mation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Burglar A larm, color: Tc Hmi. Building Automation. Color. RGBAColor. Red })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.maintenance, Tc Hmi. Building A 1268 Version: 1.14.0 TF8040
## Page 1269

Programming utomation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Building. Maint enance, color: Tc Hmi. Building Automation. Color. RGBAColor. Dark Orange })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.manual Actuator, Tc Hmi. Buildi ng Automation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Room Automat ion. Manual, color: Tc Hmi. Building Automation. Color. RGBAColor. Dark Orange })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.manual Group, Tc Hmi. Building A utomation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Room Automation . Manual, color: Tc Hmi. Building Automation. Color. RGBAColor. Dark Orange })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.facade Thermo Automatic, Tc Hmi . Building Automation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Room Automation. Automatic, color: Tc Hmi. Building Automation. Color. RGBAColor. Tc Hmi Green })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.facade Twilight Automatic, Tc H mi. Building Automation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Ro om Automation. Automatic, color: Tc Hmi. Building Automation. Color. RGBAColor. Tc Hmi Green })], [Tc Hmi. Building Automation. Controls. Room Automation. Sunblind. Priority.sun Protection, Tc Hmi. Buildin g Automation. Icons.convert IIcon Data To IIcon Attributes({ ... Tc Hmi. Building Automation. Icons. Room Automati on. Automatic, color: Tc Hmi. Building Automation. Color. RGBAColor. Tc Hmi Green })] ]); Window Show Quick Links Defines whether the quick settings are displayed for the Window [} 1214] control. Tc Hmi. Building Automation. Controls. Room Automation. Window. Show Quick Links = false; Tc Hmi Ba Framework Busy Handler Record Timer Results Defines whether the timer results for various processes are recorded. Tc Hmi. Building Automation. Busy Handler. Record Timer Results = false; Button Double Press Duration Defines the time that may elapse between two clicks until the two clicks are recognized as a double click. Tc Hmi. Building Automation. Components. Button. Double Press Duration = 200; Calendar Default Event Dialog Size Defines the default size of the event dialog. Tc Hmi. Building Automation. Components. Calendar. Default Event Dialog Size = { width: 700, height: 350 }; Calendar List Default Calendar List Dialog Size Defines the default size of the Calendar List dialog. Tc Hmi. Building Automation. Components. Calendar List. Default Calendar List Dialog Size = { width: 750, height: 400 }; TF8040 Version: 1.14.0 1269
## Page 1270

Programming Content Window Hide Header Icon Border Default Defines whether the border of the header icon is hidden by default. Visibility can still be set separately for each instance. Tc Hmi. Building Automation. Components. Content Window. Hide Header Icon Border Default = false; Date Time Picker Default Date Time Picker Dialog Size Defines the default size of the Date Time Picker dialog. Tc Hmi. Building Automation. Components. Date Time Picker. Default Date Time Picker Dialog Size = { width: 650, height: 450 }; Default Date Picker Dialog Size Defines the default size of the Date Picker dialog. Tc Hmi. Building Automation. Components. Date Time Picker. Default Date Picker Dialog Size = { width: 300, height: 300 }; Dialog Window Move Limitation Limitation for positioning outside the browser window. Tc Hmi. Building Automation. Components. Dialog Window. Move Limitation = 100; Time Picker Default Time Picker Dialog Size Defines the default size of the Time Picker dialog. Tc Hmi. Building Automation. Components. Time Picker. Default Time Picker Dialog Size = { width: 350, height: 200 }; Project Navigation List Maximum Event Type Pulse Defines for each user level whether a pulse is displayed if an active event with this or a higher priority [} 103] is pending. Setting a value. Tc Hmi. Building Automation. Navigation. Project Navigation List. Maximum Event Type Pulse.set(Tc Hmi. Building Au tomation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Type.e Disturb); Setting all values. Tc Hmi. Building Automation. Navigation. Project Navigation List. Maximum Event Type Pulse = new Map([ [Tc Hmi. Building Automation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Basic, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Advanced, Tc Hmi. Building Automation. BA. Event Type.e Disturb], 1270 Version: 1.14.0 TF8040
## Page 1271

Programming [Tc Hmi. Building Automation. BA. Role.e Expert, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Internal, Tc Hmi. Building Automation. BA. Event Type.e Disturb] ]); Maximum Event Condition Displayed Defines the maximum Event Condition [} 102] for each user level, which is displayed in the lines of the Project Navigation [} 1167]. Setting a value. Tc Hmi. Building Automation. Navigation. Project Navigation List. Maximum Event Condition Displayed.set(Tc Hmi. B uilding Automation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Condition.e Type Other); Setting all values. Navigation. Project Navigation List. Maximum Event Condition Displayed = new Map([ [Tc Hmi. Building Automation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Condition.e Type Other] , [Tc Hmi. Building Automation. BA. Role.e Basic, Tc Hmi. Building Automation. BA. Event Condition.e Type Other] , [Tc Hmi. Building Automation. BA. Role.e Advanced, Tc Hmi. Building Automation. BA. Event Condition.e Event Ic on Displayed], [Tc Hmi. Building Automation. BA. Role.e Expert, Tc Hmi. Building Automation. BA. Event Condition.e Event Icon Displayed], [Tc Hmi. Building Automation. BA. Role.e Internal, Tc Hmi. Building Automation. BA. Event Condition.e Event Ic on Displayed] ]); Ui Icon Auto Activate Icon Status Defines whether the Icon Status [} 1162] attribute is set automatically when events are configured. With this setting, the icon is colored in the defined event color when an event is active. Tc Hmi. Building Automation. Components. Ui Icon. Auto Activate Icon Status = false; Auto Scale Event Icon Threshold Defines the threshold value that the height or width must fall below before the automatic scaling of the event icon becomes active. Tc Hmi. Building Automation. Components. Ui Icon. Auto Scale Event Icon Threshold = 40; Enable Event Count Badge Defines whether the number of events of the same event type are displayed. Tc Hmi. Building Automation. Components. Ui Icon. Enable Event Count Badge = true; Event Icon Size Defines the initial height and width of the Event Icon. Tc Hmi. Building Automation. Components. Ui Icon. Event Icon Size = 30; TF8040 Version: 1.14.0 1271
## Page 1272

Programming Maximum Event Type Pulse Defines for each user level whether a pulse is displayed if an active event with this or a higher priority [} 103] is pending. Setting a value. Tc Hmi. Building Automation. Components. Ui Icon. Maximum Event Type Pulse.set(Tc Hmi. Building Automation. BA. Rol e.e Guest, Tc Hmi. Building Automation. BA. Event Type.e Disturb); Setting all values. Components. Ui Icon. Maximum Event Type Pulse = new Map([ [Tc Hmi. Building Automation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Basic, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Advanced, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Expert, Tc Hmi. Building Automation. BA. Event Type.e Disturb], [Tc Hmi. Building Automation. BA. Role.e Internal, Tc Hmi. Building Automation. BA. Event Type.e Disturb] ]); Maximum Event Condition Displayed Defines the maximum Event Condition [} 102] for each user level, which is displayed at Ui Icon [} 1159]. Setting a value. Tc Hmi. Building Automation. Components. Ui Icon. Maximum Event Condition Displayed.set(Tc Hmi. Building Automati on. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Condition.e Type Other); Setting all values. Tc Hmi. Building Automation. Components. Ui Icon. Maximum Event Condition Displayed = new Map([ [Tc Hmi. Building Automation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Condition.e Type Other] , [Tc Hmi. Building Automation. BA. Role.e Basic, Tc Hmi. Building Automation. BA. Event Condition.e Type Other] , [Tc Hmi. Building Automation. BA. Role.e Advanced, Tc Hmi. Building Automation. BA. Event Condition.e Event Ic on Displayed], [Tc Hmi. Building Automation. BA. Role.e Expert, Tc Hmi. Building Automation. BA. Event Condition.e Event Icon Displayed], [Tc Hmi. Building Automation. BA. Role.e Internal, Tc Hmi. Building Automation. BA. Event Condition.e Event Ic on Displayed] ]); Charting Axis Default Axis Options Dialog Size Defines the default size of the dialog for the axis options. Tc Hmi. Building Automation. Charting. Axis. Default Axis Options Dialog Size = { height: 180, width: 350 }; Trend Default Displayed Objects Defines the default object in the trend display. Tc Hmi. Building Automation. Charting. Trend. Default Displayed Objects = Tc Hmi. Building Automation. Trend. Displayed Objects.trendable Objects; 1272 Version: 1.14.0 TF8040
## Page 1273

Programming Default Displayed Description Defines the default description in the trend display. Tc Hmi. Building Automation. Charting. Trend. Default Displayed Description = Tc Hmi. Building Automation. BA. Ba Parameter Id.e Inst Description; Collection Configurator Default Configurator Dialog Width Defines the default width of the trend collection configurator dialog. Tc Hmi. Building Automation. Charting. Trend. Collection Configurator. Default Configurator Dialog Width = 1000 ; Default Trend Collection Selection Dialog Width Defines the default width of the dialog for the selection of trend collections to be displayed. Tc Hmi. Building Automation. Charting. Trend. Collection Configurator. Default Trend Collection Selection Dialog Width = 400; Storage User Data Last Content Sorage Location Defines the location where a user's last opened content is saved. Tc Hmi. Building Automation. Storage. User Data. Last Content Storage Location = Tc Hmi. Building Automation. Stor age. Location.ba Site; Last Theme Sorage Location Defines the location where a user's last used theme is saved. Tc Hmi. Building Automation. Storage. User Data. Last Theme Storage Location = Tc Hmi. Building Automation. Storag e. Location.ba Site; Trend Settings Storage Location Defines the location where a user's trend settings are saved. Tc Hmi. Building Automation. Storage. User Data. Trend Settings Storage Location = Tc Hmi. Building Automation. St orage. Location.ba Site; Trend Collection Storage Location Defines the location where a user's trend collections are saved. Tc Hmi. Building Automation. Storage. User Data. Trend Collection Storage Location = Tc Hmi. Building Automation. Storage. Location.ba Site; Trend Collection Selection Storage Location Defines the location where a user's displayed trend collections are saved. Tc Hmi. Building Automation. Storage. User Data. Trend Collection Selection Storage Location = Tc Hmi. Building Au tomation. Storage. Location.ba Site; Server Ba Site-Extension Default Diagnostics Dialog Size Defines the default size of the diagnostics dialog. TF8040 Version: 1.14.0 1273
## Page 1274

Programming Tc Hmi. Building Automation. Server. Ba Site. Default Diagnostics Dialog Size = { height: 500, width: 500 }; Event Helper Maximum Event Condition Defines the maximum Event Condition [} 102] for each user level, that is displayed in the HMI . Default setting displays all events [} 1235], flags [} 1236], priorities [} 1238] and locks [} 1238]. Setting a value. Tc Hmi. Building Automation. BA. Event Helper. Maximum Event Condition.set(Tc Hmi. Building Automation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Condition.e Event Icon Displayed); Setting all values. Tc Hmi. Building Automation. BA. Event Helper. Maximum Event Condition = new Map([ [Tc Hmi. Building Automation. BA. Role.e Guest, Tc Hmi. Building Automation. BA. Event Condition.e Event Icon D isplayed], [Tc Hmi. Building Automation. BA. Role.e Basic, Tc Hmi. Building Automation. BA. Event Condition.e Event Icon D isplayed], [Tc Hmi. Building Automation. BA. Role.e Advanced, Tc Hmi. Building Automation. BA. Event Condition.e Event Ic on Displayed], [Tc Hmi. Building Automation. BA. Role.e Expert, Tc Hmi. Building Automation. BA. Event Condition.e Event Icon Displayed], [Tc Hmi. Building Automation. BA. Role.e Internal, Tc Hmi. Building Automation. BA. Event Condition.e Event Ic on Displayed] ]); BA Hidden Ba Parameter Ids Defines the Ba Parameter Ids that are not displayed in the generic parameter dialog. Tc Hmi. Building Automation. BA. Ba Device. Hidden Ba Parameter Ids = []; Ba Parameter Categories Organizes the different Ba Parameter Ids into categories. The order in which they are added is taken into account when they are displayed in the parameter dialog. Setting a value. Tc Hmi. Building Automation. BA. Ba Parameter Categories.set(Tc Hmi. Building Automation. BA. Ba Parameter Categor y.configuration, [ Tc Hmi. Building Automation. BA. Ba Parameter Id.e Configurate, Tc Hmi. Building Automation. BA. Ba Parameter Id.e Toggle Mode, Tc Hmi. Building Automation. BA. Ba Parameter Id.e Step Delay, Tc Hmi. Building Automation. BA. Ba Parameter Id.e Min Off Time, Tc Hmi. Building Automation. BA. Ba Parameter Id.e Min On Time ]); Ba Device Dialog Connection Auto Close State Changed Defines whether the notification is automatically closed when a device loses the connection after the connection is restored. 1274 Version: 1.14.0 TF8040
## Page 1275

Programming Tc Hmi. Building Automation. BA. Ba Device. Dialog Connection Auto Close State Changed = true; Dialog Connection Auto Reload On Reconnect Defines whether the HMI is automatically reloaded after the connection to a device is restored. Tc Hmi. Building Automation. BA. Ba Device. Dialog Connection Auto Reload On Reconnect = true; Dialog Connection Auto Reload On Reconnect Time Defines the delay time until the HMI is automatically reloaded after the connection to a device is restored. Tc Hmi. Building Automation. BA. Ba Device. Dialog Connection Auto Reload On Reconnect Time = 30; Ba Basic Object Disable Parameter Dialog Header Icon Defines whether the object/node icon is not displayed in the header of the parameter dialog. Tc Hmi. Building Automation. BA. Ba Basic Object. Disable Parameter Dialog Header Icon = false; Default Parameter Dialog Width Defines the default width of the parameter window. Tc Hmi. Building Automation. BA. Ba Basic Object. Default Parameter Dialog Width = 800; Default Online Trend Dialog Size Defines the standard size of the window of the online trend. Tc Hmi. Building Automation. BA. Ba Basic Object. Default Online Trend Dialog Size = { height: 250, width: 450 } Default Navigation Dialog Width Defines the default width of the dialog that displays the Project Navgiation List of a Ba Object. Tc Hmi. Building Automation. BA. Ba Basic Object. Default Navigation Dialog Width = 1000; Auto Collapse Navigation Dialog Entries Specifies whether only one entry or multiple entries may be open in the dialog that displays the Project Navigation List. Tc Hmi. Building Automation. BA. Ba Basic Object. Auto Collapse Navigation Dialog Entries = true; Ba View Disable Node Type Icons Disable Node Type Icons Defines whether the Node Type Icons [} 1239] are used in the HMI. Tc Hmi. Building Automation. BA. Ba View. Disable Node Type Icons = false; 6.2.1.9 Project templates Project templates are intended to make it easier to get started with a Tc Hmi Ba project by pre-installing required dependencies and providing additional elements (e.g. navigation). Installation The installation of the project templates into the available development environments is not performed by the TF8040 but by the batch file Install Project Templates.bat. TF8040 Version: 1.14.0 1275
## Page 1276

Programming After installing the Twin CAT 3 HMI and TF8040, the batch file is located in the directory: C:\Twin CAT\Functions\TF8040 Building Automation\HMI\Project Templates A double click on the Install Project Templates.bat executes it and a console window opens. The project templates currently have some limitations. The following section describes these in more detail and how they can be remedied. User management In order to use the integrated user management of TF8040, it is necessary that certain user groups and matching users exist in the Tc Hmi project. The project template does not include these users. The program Create Default User Management.exe can be used to create the required settings for a project. More detailed information on the various user groups [} 15] can be found here. After installing the Twin CAT 3 HMI and TF8040, the program is located in the directory: C:\Twin CAT\Functions\TF8040 Building Automation\HMI\Tools\Create Default User Management ü Double-clicking on the Create Default User Management.exe will execute it. 1. First select the HMI project. 2. Close the project (if not already closed). 1276 Version: 1.14.0 TF8040
## Page 1277

Programming 3. Check output TF8040 Version: 1.14.0 1277
## Page 1278

Programming 4. Open the project and create passwords for the created users. Ba Site-Extension The server extension will start inactive because the configuration files are not loaded with the project template. Therefore a manual start is necessary. 1278 Version: 1.14.0 TF8040
## Page 1279

Programming 6.2.1.9.1 Tc Hmi Ba Project The project template is used to create a Tc Hmi project quickly and easily. The notes [} 1276] for project templates must be observed. Contents Preview TF8040 Version: 1.14.0 1279
## Page 1280

Programming References The project template contains the following Nu Get packages: • Beckhoff. Twin CAT. HMI. BA. Icons • Beckhoff. Twin CAT. HMI. BA. Framework • Beckhoff. Twin CAT. HMI. BA. Controls • Beckhoff. Twin CAT. HMI. BA. Server Extension • Beckhoff. Twin CAT. HMI. Framework • Beckhoff. Twin CAT. HMI. Controls • Beckhoff. Twin CAT. HMI. Functions • Beckhoff. Twin CAT. HMI. Responsive Navigation • Microsoft. Type Script. MSBuild Code Behind Listing of all global settings for Tc Hmi Ba. • Tc Hmi Ba Settings.js 1280 Version: 1.14.0 TF8040
## Page 1281

Programming Content Pages To make it easier to get started, the project template already contains some content pages, such as navigation in the header. The following pages are required for the header to function correctly: • Event List.content • Server Log.content • Start Page.content The navigation in the header refers to the following pages: • Plant View.content • Project Navigation.content These pages are customizable, and further pages can be added. If pages are added, renamed or removed, the attribute Menu Data [} 1283] of the header must be updated (see Navigation). Navigation Configurable menu bar. • Header Menu.usercontrol Samples The "Samples" folder contains samples of User Controls for creating user-specific plants. 6.2.1.9.1.1 Header The header is a User Control and serves as an entry point for users. It offers an easy way to configure a navigation for the HMI and several other features. Features The features at a glance (from left to right). • Logo (1) • Responsive navigation (2) • User settings and further information (3) • Event list (4) • Building information (5) • Outdoor temperature (6) • Date and time (7) User settings and further information In this menu, the user can make various settings and display dialogs: • Setting the language • Setting the theme • Display diagnostic data of the Ba Site-Extension TF8040 Version: 1.14.0 1281
## Page 1282

Programming • Show dialog with icon legend • Updating the general object information that is not updated cyclically (e.g. description, active text, status texts) • List for displaying and editing the calendar objects in the project • Show server log Event list The event list [} 1166] can be accessed via the button with the bell symbol. The button also shows the number of active events if the number was linked via the Event Count attribute. Building information The button with the info symbol is the control Building Information [} 1123]. It can be used to open a window with information about the building and the facades. Attributes The control inherits from Tc Hmi Control and thus has the same attributes. In addition, there are the following attributes. Logo tchmi:framework#/definitions/Content Path 1282 Version: 1.14.0 TF8040
## Page 1283

Programming Path specification to the image with the logo that is displayed at the start of the header. Menu Data tchmi:framework#/definitions/Tc Hmi. Controls. Responsive Navigation. Tc Hmi Navigation Bar. Menu Item List Defines the structure and hierarchy of the navigation. Entries in the header can be linked directly to content pages, or submenus can be created that expand when selected. Switch Breakpoint tchmi:general#/definitions/Number Determines at which pixel width the navigation changes to the Hamburger symbol. Event Count tchmi:general#/definitions/Number Here you can link a symbol that contains the number of active events in the event list. This number is then displayed in a badge on the button for the event list. Current Temperature tchmi:general#/definitions/Number Current temperature to be displayed in the header. Typically, the outside temperature is displayed here. Current Temperature Unit tchmi:general#/definitions/String Unit of the current temperature. Close Menu tchmi:general#/definitions/Boolean If the attribute has the value TRUE, the header menus can be closed (this can be changed during runtime). Nav Content tchmi:framework#/definitions/Tc Hmi. Controls. Responsive Navigation. Tc Hmi Navigation Content Content to display in the responsive navigation. User Content tchmi:framework#/definitions/Tc Hmi. Controls. Responsive Navigation. Tc Hmi Navigation Content TF8040 Version: 1.14.0 1283
## Page 1284

Programming Content for display in the user menu. Target Region tchmi:framework#/definitions/Tc Hmi Region The Tc Hmi Region must be linked here, which is used to display the content pages selected from the menu. Event Content tchmi:framework#/definitions/Content Path Content on which the event list is located. Start Page tchmi:framework#/definitions/Content Path Start page of the HMI. This page is loaded into the Target Region when you click the logo. 1284 Version: 1.14.0 TF8040
## Page 1285

Tools 7 Tools For new projects we strongly recommend to use the version 5 of TF8040! 7.1 Building Automation Site Explorer The Building Automation Site Explorer maps all objects clearly in the project structure. He assists in the commissioning and adjustment of plants. System requirements Microsoft: • Windows 10 or higher • . NET Desktop Runtime > v6.0 The current version of the . NET Runtime can be checked in the Control Panel under Programs and Features. Beckhoff: One of the following components must be installed to use the Building Automation Site Explorers: • TC1000 | TC3.1 ADS • TE1000 | TC3 Engineering Application Access rights During the first application, the user is prompted to apply a role [} 15]. In this way, the access rights are firmly fixed. Dialog boxes Project TF8040 Version: 1.14.0 1285
## Page 1286

Tools Columns • Object [} 32] • Object name • Description • State The following states are displayed: ◦ Value source Indicates a setpoint or display value. ◦ Active event [} 32] ◦ Overridden ◦ Out of service ◦ Active priority • Manual override • Current value • Trend • Commissioning condition Properties Displays the properties of the selected entry. • Control Among other things, the properties of a control list components (such as services or supplements) that are executed at runtime. 1286 Version: 1.14.0 TF8040
## Page 1287

Tools Example: Properties of a control • Objects TF8040 Version: 1.14.0 1287
## Page 1288

Tools Example: Properties of an analog object. Events Active events [} 32] are listed in the event overview: In addition, a summary of all active events is displayed in the status bar at the bottom. For each event type, the highest priority event symbol is indicated: Individual states of the combined events [} 32] can be viewed via the drop-down menu: 1288 Version: 1.14.0 TF8040
## Page 1289

Tools In the project view, a summary of all active events [} 32] of a view can also be displayed by moving the mouse over the entry: Event history All occurred events [} 32] of a view are listed in the event history: Functions Acknowledge Events [} 32] can be acknowledged from different views via the context menu: Example: Acknowledge fault in the project view. Example: Acknowledge alarm in the event overview. Navigate to an object The context menu can be used to navigate directly to the selected object [} 32] (in the project view [} 1285]): TF8040 Version: 1.14.0 1289
## Page 1290

Tools Example: Navigation to the selected object from the event history. Commissioning: Commissioning states of individual objects can be adjusted in the corresponding column: Example: Interface for entering the commissioning state of an object. Details Commissioning details of selected objects are displayed in the properties. Subsequent editing is possible for some details. Example: Commissioning details of a defective field device. • Online The following details are stored online (per object [} 32]) in the controller. 1290 Version: 1.14.0 TF8040
## Page 1291

Tools ◦ State: Current commissioning state. • Offline The following details are stored offline (per object [} 32]) in the site settings. ◦ Timestamp: Time of the last change to the commissioning state (if the change was made using Building Automation Site Explorer). ◦ Comment: Optional comment. Menu Save: Saves the commissioning details of all connected devices. At the latest when the connection to a device is terminated, the commissioning details are automatically saved. Trend Various information can be read in the project view: 1. Indication of a referencing Trend object [} 226]. 2. Current number of data sets of the referencing Trend object [} 226]. 3. Start or stop recording the current value of an object [} 32] (Online trend). 4. Display or remove the log buffer of a Trend object [} 226] (Offline trend). Example: Representation of different trends. Offline trend The offline trend reads the log buffer of a Trend object [} 226] and displays it in the Trend view. TF8040 Version: 1.14.0 1291
## Page 1292

Tools Entries are not updated automatically! Online trend The online trend records the current value of an object [} 32] in the Trend view. 1292 Version: 1.14.0 TF8040
## Page 1293

Tools NOTICE Loss of data Recorded values are not saved after ending the recording or closing the trend view! Menu Name Description Cleaning Removes all entries from the trend view (equivalent to restarting the current recordings). Reset Not only removes all entries from the Trend view, but also stops recording all objects [} 32]. Referencing Name Description Assign free trend Assigns an object [} 32] to the next, unused Trend object [} 226]. Remove reference from assigned trend Removes the Objects [} 32] reference from all referencing Trend object(s) object(s) [} 226]. Navigate to assigned trend Navigates to the assigned Trend object [} 226] (in the project view). Referencing trend objects Name Description Remove referred object Removes the current object [} 32] reference. Locate referred object Navigates to the assigned bject [} 32] (in the project view). Editing values Current values (if writable) can be edited directly in the project view. TF8040 Version: 1.14.0 1293
## Page 1294

Tools Editing parameters Access rights: The column R|W (Read, Write) lists the required access rights per parameter. 1294 Version: 1.14.0 TF8040
## Page 1295

Tools Role Abbreviation Default * Advanced A Expert E Internal I Locked - Reports Reports are intended to provide a general overview of a project. Furthermore, the following requirements can also be met: • Project documentation for the operator • Project status tracking All reports can be exported to the following formats: • *.csv Object summary Overview of all objects [} 32] located in the connected site. Filter To increase the overview, the view can be filtered according to plants: Trend overview TF8040 Version: 1.14.0 1295
## Page 1296

Tools Overview of available trends [} 226] and recorded or referred objects [} 32]. DPAD Relations Create a comparison to show DPAD [} 42] relations. Included information per object [} 32]: Symbol path Properties • Object Name • Description Label (if used) • Aggregate information ◦ Name ◦ Description • Function information ◦ Name ◦ Description Discovered devices Each time a connection to the Site is established, connection information of all available devices is updated. If there are connections to unknown devices among them (which are not part of the current Site configuration), they are listed as discovered devices at the bottom of the application: To add a discovered device to the Site configuration, just click on the corresponding menu item. Discovered devices are possible suggestions. They are displayed because it can be assumed that they belong to the current Site configuration. Log and status Messages and states are displayed in the log or in the status bar at the bottom of the application: 1296 Version: 1.14.0 TF8040
## Page 1297

Tools Log entries may contain additional information ( ). These can be called by moving the mouse pointer over the *. The following functions can be called via the context menu: • Copy selected entries: Copies selected entries to the clipboard. • Copy all entries: Copies all entries to the clipboard. • Export: Copies all entries to a file. • Clean: Removes all entries from the view. Version Details of versions are output in the log when the application is started: • Terminal Explorer [OL52] Started Terminal Explorer v1.0.11.2 • Terminal Client API Loaded terminal client API v1.2.2.1 (Compatible to terminal server v1.0.12.0) The entry contains two pieces of information to be distinguished: • Version of the loaded Terminal Client API DLL • Version of the Terminal Server to which the loaded Terminal Client API is compatible. NOTICE Observe version Only connections to ADS devices working with this version can be established! • Twin CAT ADS Loaded Twin CAT ADS v4.4.0.0 Toolbar Sites Selection of configured Sites. Use cases You can choose between two use cases for Site deployment: • Local: For own purposes (e.g. for tests) Site and device configurations can be stored locally (in the application directory). TF8040 Version: 1.14.0 1297
## Page 1298

Tools • Reference: To improve collaboration in teams, references allow saving Site and device configurations in arbitrary directories (e.g. network drives or Git repositories). Involved persons thus work on the same basis and avoid side effects such as: ◦ Different selection and configuration of devices ◦ Inconsistent commissioning states Site management Name Description Create Creates a new Site. Remove Removes an existing Site. Edit Displays the Site properties for editing. Export Exports a Site to a specific directory for referencing. Import Imports a Site for use as a reference. Connection When the Site connects, communication is established to all selected devices: Manage devices Name Description Add Adds a new device to the active Site. Adding devices by manually entering the AMS Net ID is possible. All prerequisites (such as setting up the ADS route) must be met before a connection can be established. Remove Removes a selected device from the active Site configuration. Manage routes • Select route: The selection box can be used to select routes that have already been created: 1298 Version: 1.14.0 TF8040
## Page 1299

Tools • Create new route: The dialog box for searching devices can be opened via the Browse button: Diagnose Diagnostic functions are accessible for configured devices of the active Site via the menu: Device communication TF8040 Version: 1.14.0 1299
## Page 1300

Tools Connections and states Displays a list of all configured devices to visualize the communication of individual devices with each other. If a device (1) is designated for communication (using remote subscriptions), all target devices (2) will each appear as a connection under the source device (1). It also displays target devices (2) that are not part of the active Site configuration. The individual states of the routes on the respective devices are indicated by corresponding symbols: • The left symbol (3) represents the state of the route on the source device (1). • The right symbol (4) represents the state of the route on the target device (2). Key • Devices Graphic Description Device unreachable. Device reachable. • Routes 1300 Version: 1.14.0 TF8040
## Page 1301

Tools Graphic Description Route unknown if the state could not be determined (e.g. if the device is unreachable). Route missing. Route valid. Create route Communication within a site is functional when the routes of all communicating devices are established with each other. Example1: Routes valid on source and target device: Example 2: Route valid on source device but not on target device: Missing routes (both of all and for selected devices) can be configured at once: ü Provide credentials: In most cases, uniform credentials are used across all devices. 1. Open the properties for default credentials: 2. Make adjustments via properties: ð If individual credentials must be stored for different devices, the default credentials can be overwritten as follows: 3. Select device: TF8040 Version: 1.14.0 1301
## Page 1302

Tools 4. Activate and edit the individual credentials: ð Select devices for route configuration 5. Devices with invalid route settings are automatically selected for configuration at the beginning: 6. If devices should not be provided for configuring the route, they can be deselected: ð Apply configuration: 7. The route configuration of the selected devices can be rolled out via the menu: ð All configuration operations are logged in the log: ð For unavailable devices (e.g. not reachable or route not configured) neither route states can be displayed nor route configurations can be adopted: Fix connection Despite existing route configuration, the connection between two devices may be faulty. In this case, routes are set up on both sides, but with incorrect parameters (for example, if an IP address has changed). Example: Display of a valid connection due to routes set up on both sides. A (highlighted) connection can be repaired via the menu. This reconfigures the routes on both devices. Fix local route 1302 Version: 1.14.0 TF8040
## Page 1303

Tools Despite existing route configuration, the local connection to a target device may be faulty. In this case, the route is set up, but with faulty parameters (e.g., if the IP address of the target device has changed). Routes to unreachable devices can be fixed via the menu: 7.2 Symbol Explorer 7.2.1 Introduction With the Symbol Explorer you can access controllers online via the ADS communication interface: • You can read the variables declared as persistent. • The Symbol Explorer provides functions with which variable backups can be created. These can be duplicated for follow-up projects and uploaded to other controllers. • Variables can be checked for differences and merged using a compare function. 7.2.2 Definitions 7.2.2.1 Symbol A symbol is a type for describing variables of a Beckhoff controller. If variables are read from a controller using the Symbol Explorer, information such as name, type, size, sub-variables and many other parameters are merged into one variable. A symbol is then formed from this quantity of parameters. Symbol types A symbol can describe different types of variables. Complex symbols describe variables that can consist of function blocks, arrays and structures. Primitive symbols describe variables that can consist of basic types, INT, REAL, BOOL, etc. 7.2.2.2 Snapshot A snapshot describes a snapshot of a symbol or symbol structure. The function to create a snapshot is provided for several use cases. You can create a snapshot of all the symbols and thus have a complete backup of the symbols on a controller. However, using the various representations and filter functions in the symbol list, you can also create just "sections of a symbol/symbols" and save them in a snapshot. You have thus created a template for the simplified duplication of symbol values. 7.2.3 User interface The interface is divided into various windows with different outputs for using the Symbol Explorer. TF8040 Version: 1.14.0 1303
## Page 1304

Tools 7.2.3.1 Main window After opening the start page, the following options can be selected: • Recent snapshots • Recent routes • Connect • Snapshot Main menu The menu is divided into the following tabs. Open Command Description Choose route Connect to a route. Open snapshot Open a snapshot. Recent snapshots List of frequently used snapshots. Recent routes List of frequently used routes. View Command Description Output Switch Output window small / large. Tools Command Description Compare symbols Comparison of two symbol lists. Help Command Description About Twin CAT Symbol Explorer Version specification 7.2.3.2 Start page The start page gives a quick overview of the last selected routes or opened snapshots. Furthermore, one of the last routes or snapshots can be selected and opened directly with one click. 1304 Version: 1.14.0 TF8040
## Page 1305

Tools Open Command Description Choose Route Connect to a route. Open snapshot Open a snapshot Recent Command Description Recent snapshots List of frequently used snapshots. Recent routes List of frequently used routes. 7.2.3.3 Choose Route The "Choose Route" dialog provides a quick and easy view of the routes that are registered on the system. The ports that can be reached by the Symbol Explorer are displayed for each route. These are the pre-set ports for accessing the PLC (Twin CAT2 / Twin CAT3) or specially configured ports for accessing the Ether CAT master under the Process Image, for example. The ports can be configured via the Options dialog. TF8040 Version: 1.14.0 1305
## Page 1306

Tools Toolbar Symbol Command Description Options Open Choose Route dialog Options Refresh Route Refresh the status of the routes Options dialog Here you can choose which ports should be used by the Symbol Explorer to connect to a Traget. You can choose from the default ports or add a specific port. Default port numbers 1306 Version: 1.14.0 TF8040
## Page 1307

Tools Description Ports MOTION 500, 501, 511 Tc2 PLC 801, 811, 821, 831 Tc3 PLC 851, 852, 853, 854, 855 IO IMAGE 27905, 27906, 27907, 27908, 27909, 27910 TC3 TASK 350, 351, 352, 353, 354, 355 7.2.3.4 Symbol Entry Point The Symbol Entry Point describes the entry point(s) that the Symbol Explorer should take in the symbolic structure of a target. The required symbols can be selected. Various filters are also available that can reduce the number of symbols to be loaded. Symbol Type Selection This is a coarse filter that is applied to a symbol area (e.g. 'Persistent'). If the filter is selected, only the symbol and the parent symbol marked in the PLC with the respective scope (e.g. 'Persistent') are displayed. Symbol Datatypes A filter that is applied to the data type or a special feature of the data type. Array size limitation If the filter is active, all arrays with a primitive data type that are greater than the value for 'Maximum array length' are excluded. Datatype Blacklist Symbols whose data type is in the blacklist are excluded. TF8040 Version: 1.14.0 1307
## Page 1308

Tools 7.2.3.5 Output window The Output window displays information, errors and warnings at runtime. The functions of the toolbar are described in the following table. 1308 Version: 1.14.0 TF8040
## Page 1309

Tools Toolbar Symbol Command Description Expand / Collapse Expands and collapses the Output window Clear messages Clears the messages Show / Hide errors Shows and hides the error messages Show / Hide warnings Shows and hides the warnings Show / Hide messages Shows and hides the messages 7.2.3.6 Online window The Online window displays the online symbols of a controller. Functions for creating backups, monitoring and editing symbols are available via the toolbar and the context menus. TF8040 Version: 1.14.0 1309
## Page 1310

Tools Toolbar Symbol Command Description Show symbols as list Shows symbols as a flat list. Drop down box Extended symbol lists. Show instance watch Symbol instances view. Synchronize symbols Show dialog for synchronizing symbols. Sort by Sorting of symbols by e.g. name or size. Sort direction Direction of sorting. Upload symbols Writes changed symbols to the controller Take snapshot Takes a snapshot of the symbols Refresh Refreshes symbol value once Auto refresh Refreshes symbol value every 2 seconds Export / Import CSV Export or import symbols as CSV file Export symbols as Export symbols as an Excel spreadsheet. Excel Close window Close window Exclusions when refreshing Symbols that have been edited via the Symbol Explorer and symbols that are currently being edited are excluded from refreshing. Notes on ADS communication The Symbol Explorer uses the ADS protocol for the online communication. Note that ADS is only a transport layer; however, side effects can occur. Read these requirements and note the restrictions: ADS itself is only the transport layer, the requested ADS device must support the ADS command. When the PLC is processing an ADS request (reading/writing the symbol values), it will work completely on that single ADS request before starting a new PLC cycle. To keep the load on the controller low, the number of symbols to be read/written has been limited to a maximum of 250 per ADS request for this reason. 7.2.3.7 Snapshot window The Snapshot window displays the offline symbols from a snapshot. Functions for editing, uploading and creating copy templates are available via the toolbar and the context menus. 1310 Version: 1.14.0 TF8040
## Page 1311

Tools Toolbar Symbol Command Description Show symbols as list Shows symbols as a flat list. Drop down box Extended symbol lists. Show instance watch Symbol instances view. Synchronize symbols Show dialog for synchronizing symbols. Sort by Sorting of symbols by e.g. name or size. Sort direction Direction of sorting. Save Saves a snapshot. Take snapshot Takes a snapshot of the symbols Export / Import CSV Export or import symbols as CSV file Export symbols as Export symbols as an Excel spreadsheet. Excel Close window Close window 7.2.3.8 Comparison window The Symbol Compare window displays the offline symbols from a snapshot. Functions for editing, uploading and creating copy templates of the symbols are available via the toolbar and the context menus. TF8040 Version: 1.14.0 1311
## Page 1312

Tools The Symbol Compare window displays the following differences: • Differences from symbol to symbol (value) • Removed symbols • Added symbols • Missing symbols • Types differences Toolbar Symbol Command Description Show changes Shows value differences only. Previous change Go to previous change Next change Go to next change First change Go to first change Undo all Reset changes Last change Go to last change Copy all changes to left Copies all changes into the left-hand list Copy all changes to right Copies all changes into the right-hand list Copy change to left Copies the selected row into the left-hand list Copy change to right Copies the selected row into the right-hand list Close window Close window 1312 Version: 1.14.0 TF8040
## Page 1313

Tools 7.2.3.9 Symbol Quick Navigation Bar TF8040 Version: 1.14.0 1313
## Page 1314

Tools 7.2.3.10 Symbol list Copying and pasting in the Symbol Explorer is list cell dependent! This means that if a cell is selected and copied in the Symbol Explorer, the content of the cell is copied. The only exception is the cell 'Name'; if this is selected and copied, the entire symbol information is copied. By means of the hotkeys and context menus, the symbol list provides functions such as Edit values or Copy/ Paste. Furthermore, the symbol list offers a filter function, with which symbols to be edited can be purposefully filtered and highlighted. 1314 Version: 1.14.0 TF8040
## Page 1315

Tools Hotkeys Shortcut Description Ctrl + left-click Expands or collapses the symbol and its sub-symbols. Ctrl + left-click Selective multi-selection on a row. Ctrl + C Copies the selected symbol (and all sub-symbols). Ctrl + V Pastes the copied symbol values into the selected symbol (and the sub-symbols). Ctrl + Shift + C Copies the contents of the selected cell. Ctrl + R Resets the symbol value to the previous value. Shift + left-click Multi-selection Double left-click Starts the editing of a symbol. F2 If a symbol had been selected beforehand, editing starts. Context menu Selection Description Read from PLC Reads the current value from the PLC on the selected symbol. Copy Copies the selected symbol (and all subsystems). Paste Pastes the copied symbol values into the selected symbol (and the sub-symbols). Search for Suggestions for a search Reset Resets the symbol value to the previous value. Add instance Add symbol to the Instance Watch. watch Details Call symbol details 7.2.3.11 Synchronize Symbol window This window can be used to compare different targets (Online <-> Online or Snapshort <-> Online) or to load a snapshot (recipe or value snapshot) back onto a target. The symbols of the targets are compared with each other. If a symbol exists on both sides, its value is compared. If there is a difference at the point, the symbol is noted as a difference in the list (see below in the image). At the end, the different symbols can be synchronized between the targets. TF8040 Version: 1.14.0 1315
## Page 1316

Tools 7.2.4 Getting started This chapter describes step by step how to work with the Symbol Explorer and is intended to provide an overview of its functions. Connecting to a controller The Symbol Explorer communicates with a controller via the ADS communication interface. So that communication with a controller can be successfully established, the following conditions must be satisfied: • The controller can be reached via the network. • Twin CAT is in Run Mode. • An AMS route to the controller has been set up. • A PLC runtime has been activated and started. If the criteria are fulfilled, a connection can be established and the symbols read out. It is only possible to read out symbols that have been declared as persistent and symbols that contain persistently declared symbols. Starting the connection to a controller 1. Start the Symbol Explorer and click the Connect button on the start page. 2. In the Choose Route dialog, select the Ams Route belonging to the controller to which you wish to connect. ð If you were able to successfully connect to the controller, the online window opens, showing you the read-out symbols in a list. 1316 Version: 1.14.0 TF8040
## Page 1317

Tools Taking a snapshot 1. Start the Symbol Explorer and connect to a controller. 2. Click the Take Snapshot button in the online window in order to take the snapshot. 3. You will then be requested to select a location to save the snapshot file. Select a folder and confirm with OK. ð All values of the symbols in the list are synchronized with the PLC and written to the file. Loading a snapshot 1. Open the Symbol Explorer and click the Snapshot button on the start page. 2. You will then be requested to select a snapshot file. Select a snapshot file to be loaded and confirm with OK. ð The snapshot window then opens, showing you the loaded symbols in a list. Viewing and editing symbol lists in parallel The Symbol Explorer can display two symbol lists in parallel. It is thus possible, for example, to place the current symbols (online) and symbols from a snapshot next to one another and to edit symbol values between these two lists. Simply connect to a controller and then open a snapshot. A different order of opening/connecting is also possible. Copying a snapshot to a controller 1. Open and connect the Symbol Explorer to a controller. 2. Then open a snapshot. You can now see the Online and Snapshot windows side by side. TF8040 Version: 1.14.0 1317
## Page 1318

Tools 3. Press the Copy Symbols button in the snapshot window. The Symbol Transfer Protocol dialog then opens: ð The dialog informs you in detail about the copying procedure. 4. If the symbol values are correct, confirm the copying procedure by clicking OK, otherwise select Cancel. If you have confirmed the copying procedure, the symbol values from the snapshot are copied into the online symbol list. ð Once the copy procedure is completed, the symbols with changed values are highlighted by a red square in front of the symbol name. 5. You can now load the changes from the Online window into the controller. To do this, press the Upload Symbol button in the toolbar. 1318 Version: 1.14.0 TF8040
## Page 1319

Tools Comparing symbols and synchronizing differences With the Symbol Explorer it is possible to compare two lists of symbols. You can thus compare online symbols with symbols from a snapshot and check for differences. Starting a comparison 1. Connect to a controller or load a snapshot. 2. Repeat the procedure so that two symbol lists stand side by side. 3. Then press the hotkey [F8] or select Compare Symbols in the Tools menu. ð The comparison window then opens. Synchronizing differences During synchronization, differences are copied from one symbol to another, either from left to right or from right to left. This procedure differs from the direct editing of a symbol via the Online or Snapshot window. Synchronization functions The synchronization functions can be applied implicitly to differences on the basis of a row selection. For example, if you click a row with a difference and then the right arrow button on the central toolbar, the symbol value is copied from the left into the symbol on the right. This allows the easy merging of many small differences. 7.2.4.1 Open Instance Watch Template ü To load an Instance Watch template, the Symbol Explorer must first be started. TF8040 Version: 1.14.0 1319
## Page 1320

Tools 1. Open the Instance Watch ð If no default template has been defined, the Instance Watch is empty. 2. To load a template press the button Instance Watch Options (pen). 1320 Version: 1.14.0 TF8040
## Page 1321

Tools 3. A window opens. Load a template using the button Load. Here a file chooser dialog opens where you have to select the *.iwt file. 4. If you want this template to be loaded every time the instance watch is started, set this by pressing the button Set as default. The path of the *iwt file should appear on the left, next to the button at Default template. To undo this change click the button Clear default. 5. Confirm the Instance watch options dialog with OK. ð The instance watch is loaded with the template. TF8040 Version: 1.14.0 1321
## Page 1322

Tools 7.2.5 Filter, search and replace By means of the individual filtering of the symbols, it is possible to find the desired symbols faster. You can filter for the name, type or comment of a symbol. Find and replace toolbar Symbol Command Description Recent search terms List of frequent searches Match case Search is case-sensitive Match whole word Search for the exact entry Close search Closes the search Enter search example Enter search expression Start search Starts the search Use regular expressions Switches the search to the use of regular expressions Replace all Replace all Search Pattern Search Pattern Templates Search for value to replace Search for value to replace Replacement value Replacement value 7.2.5.1 Filter equation overview A function is a subordinate quantity of functions, parameters, operators and value pairs. A function begins and ends with brackets (). Each function, parameter, operator and value pair is followed by a semicolon. AND function The AND function is used to filter for symbols whose conditions are satisfied by a TRUE. Two examples of the use of the AND function and in conjunction with the OR function are shown below. AND ( Type = BOOL; Name = 'b Enabled'; Value = True ) The function filters for symbols with the type BOOL whose name is b Enabled and whose value is TRUE. 1322 Version: 1.14.0 TF8040
## Page 1323

Tools AND ( Name = n Counter; OR ( Value = 10; Value = 50 )) The function filters for symbols with the name n Counter whose value is '10' or '50'. OR function The OR function is used to filter for symbols where one condition is satisfied by a TRUE. Two examples of the use of the OR function and in conjunction with the AND function are shown below. OR ( Value = 150; Value = -150 ) The function filters for symbols whose value is '150' or '-150'. AND ( Name = 'n Counter'; OR ( Value = 10; Value = 50 )) The function filters for symbols with the name n Counter whose value is '10' or '50'. PARENT function The PARENT function is used to filter for symbols whose direct parent symbol (higher-level symbol) is subject to an identical condition. The conditions specified in the PARENT function are logically ANDed. The PARENT function can only be used in an AND function or in an OR function. Here is a general sample of the use of the PARENT function: AND ( Name = 's Object Name'; PARENT ( Name = 'Plant'; Value = TRUE )) The function filters for symbols with the name 's Sobject Name' and their parent symbol with the name 'Plant'. Furthermore, the value of this symbol must be TRUE. ANCESTOR function The ANCESTOR function is used to filter symbols whose ancestors in the parent chain of symbols are subject to a condition, e.g. a special name or type. The condition specified in the ANCESTOR function is logically ANDed. The ANCESTOR function can only be used in an AND function or in an OR function. Here are some general examples of the use of the ANCESTOR function: AND ( Name = 's Object Name'; ANCESTOR ( Type = 'FB_BAC_AI')) The function filters for symbols with the name 's Object Name'. The ancestors of these symbols come from the parent chain of symbols with the type 'FB_BAC_AI'. AND ( Name = 's Object Name'; ANCESTOR ( Name = 'Plant01')) The function filters for symbols with the name 's Object Name'. Within the parent chain of these symbols, one of the ancestors bears the name 'Plant01'. CHILD function The CHILD function is used to filter symbols whose child symbols are subject to a condition. The conditions specified in the CHILD function are logically ANDed. TF8040 Version: 1.14.0 1323
## Page 1324

Tools The CHILD function can only be used in an AND function or in an OR function. Here is a general example of the use of the CHILD function: AND ( Name = 'Plant'; Child ( Name = 's Object Name'; Value = 'P001' ) Value Parameter The function searches for symbols whose value satisfies a condition with a certain value. Samples: Value = '100' Search for symbols whose value is '100'. Value > '100' Search for symbols whose value is greater than '100'. Value < '100' Search for symbols whose value is smaller than '100'. Value != '100' Search for symbols whose value is not '100'. Value = '' Search for symbols whose value is empty ' '. Comment Parameter The function searches for symbols whose value satisfies a condition with a certain comment. Samples: Comment = 'Signal to detect' 1324 Version: 1.14.0 TF8040
## Page 1325

Tools Search for symbols whose comment is 'Signal to detect'. Comment != 'Signal to detect' Search for symbols whose comment is not 'Signal to detect'. Comment >'Signal' Search for symbols whose comment begins with 'Signal'. Comment < 'detect' Search for symbols whose comment ends with 'detect'. Name Parameter The function searches for symbols whose value satisfies a condition with a certain name. Samples: Name = 'b Enable' Search for symbols whose name is 'b Enable'. Name != 'b Enable' Search for symbols whose name is not 'b Enable'. Name > 'b En' Search for symbols whose name begins with 'b En'. Name < 'le' Search for symbols whose name ends with 'le'. Type Parameter The function searches for symbols whose value corresponds to a condition of a certain type. Samples: Type = 'FB_BACnet_Pump' Search for symbols whose type is 'FB_BACnet_Pump'. Type != 'FB_BACnet_Pump' TF8040 Version: 1.14.0 1325
## Page 1326

Tools Search for symbols whose name is not 'FB_BACnet_Pump'. Type > 'FB_BACnet' Search for symbols whose name begins with 'FB_BACnet'. Type < 'BACnet_Pump' Search for symbols whose name ends with 'BACnet_Pump'. Attribute Parameter The function searches for symbols that have an attribute whose name satisfies a condition with a certain value. Samples: Attribute = 'Is Persistent' Search for symbols that have an attribute with the name 'Is Persistent'. Attribute != 'Is Persistent' Search for symbols that do not have an attribute with the name 'Is Persistent'. 7.2.6 Command Line Interface The Symbol Explorer can be called up via the command line using the command line interface (CLI). The following commands are available: --Snap Shot From Plc Take a snapshot from PLC target. --Sync Plc To Snap Shot Synchronize PLC target with a Snapshot. --Sync File To Plc Synchronize Snapshot with a PLC target. --Snap Shot From Plc Create snapshots of a PLC. Option Description <Net Id> AMS Net Id of the target <Port> AMS port of the target <Snap Shot Path> Snap Shot file path --Snap Shot From Plc <Net Id> <Port> <Snap Shot Path> --Sync Plc To Snap Shot Synchronize PLC symbol values with a snapshot. The current PLC symbol values are transferred to a snapshot. Option Description <Net Id> AMS Net Id of the target <Port> AMS port of the target <Snap Shot Path> Snap Shot file path --Sync Plc To Snap Shot <Net Id> <Port> <Snap Shot Path> 1326 Version: 1.14.0 TF8040
## Page 1327

Tools --Sync Snap Shot To Plc Synchronize snapshot symbol values with the PLC. The snapshot symbol values are transferred to the PLC. Option Description <Net Id> AMS Net Id of the target <Port> AMS port of the target <Snap Shot Path> Snap Shot file path --Sync Snap Shot To Plc <Net Id> <Port> <Snap Shot Path> Symbol Entry Point A symbol entry point is required for the CLI as well as via the UI to access symbols of a target. The symbol entry point can be specified for the CLI in the form of a configuration file. To create the file, the target must be accessed once with the UI and the Symbol Entry Point dialog is started. In the dialog, you can select which symbols are of interest, just as for the UI. Call sample ...\Twin CAT\Functions\Symbol Explorer.exe --Snap Shot From Plc <192.168.10.1.1> <851> <"c: \Temp\Snapshots\File.tcpvs> Sample for starting the Symbol Explorer from the PLC Twin CAT 3 PLC Library: Tc2_Utilities -> NT_Start Process Sample NT_Start Process Sample for configuring the input variables. PATHSTR: "...\Twin CAT\Functions\Symbol Explorer.exe" DIRNAME: "...\Twin CAT\Functions" COMNDLINE: "--Snap Shot From Plc 192.168.10.1.1 851 "c:\Temp\Snapshots\File.tcpvs". 7.2.7 Workflows The following are some examples of how to use the Symbol Explorer. TF8040 Version: 1.14.0 1327
## Page 1328

Tools 7.2.7.1 Opening snapshots from Visual Studio and the XAE Shell 1. Add the Symbol Explorer snapshot to the Visual Studio / XAE. 2. Right-click on the snapshot and select Open With... from the context menu 1328 Version: 1.14.0 TF8040
## Page 1329

Tools 3. Click on the Add button. 4. Click on the button with the dots. Search for the Symbol Explorer.exe file and confirm with OK. TF8040 Version: 1.14.0 1329
## Page 1330

Tools 5. Select Twin CAT Symbol Explorer from the list of programs and click on the Set as Default button. Confirm the dialog with OK. ð The Symbol Explorer has now been linked as a program for opening snapshots. 7.2.7.2 Instance view for parameterization of AI and AO objects The following example shows the creation of an instance watch to carry out typical parameterization tasks on analog objects. The view can be used, for example, to log the parameterization of a sensor calibration. Connecting to a target system 1. Log in to the target system in the Symbol Explorer. 1330 Version: 1.14.0 TF8040
## Page 1331

Tools 2. Set a filter expression. 3. Open the Instance Watch window. TF8040 Version: 1.14.0 1331
## Page 1332

Tools 4. Drag and drop the Scale Offset and Resolution symbols into the Instance window. 5. Generate a filter from the Instance Watch. ð This function creates a filter for the tree view with the following expression: And(Or(Name='f Resolution';Name='f Scale Offset');Parent(Or(Type='Tc3_XBA. FB_BA_AI_ IO'))) 7.2.7.3 Synchronizing filtered data, example with Exclude In the following example, data from a snapshot is synchronized: All changes from the snapshot should be transferred to the controller, except for symbols with operating data with the name n Active Time Elapsed and n State Change Count. Connecting to the target system and loading a snapshot 1. Open the snapshot [} 1303] with data backup of the affected target system (PLC). 1332 Version: 1.14.0 TF8040
## Page 1333

Tools 2. Select BACnet_Globals. 3. Log in to the target system in the Symbol Explorer. Synchronize and snapshot -> target system with filtered symbols 1. Synchronize the data from the snapshot to the target system by clicking the Sync button in the main window of the snapshot. ð Suggestion for synchronization: 43 symbols are found for synchronization. TF8040 Version: 1.14.0 1333
## Page 1334

Tools 2. Set filters on the symbols n State Change Count and n Active Time Elapsed in the snapshot. Filter: or(name='statechangecount';name='activetimeelapsed') 3. Negate the selection using the Exclude function. ð All symbols except n State Change Count and n Active Time Elapsed are displayed. 4. Click on the Sync button again. 1334 Version: 1.14.0 TF8040
## Page 1335

Tools ð Now only 19 symbols are available for synchronization. Symbols that receive the operating data have been successfully filtered out 7.2.7.4 Back up and restore BACnet Object IDs with snapshot These instructions serve as a workflow for writing BACnet Object IDs from a Symbol Explorer snapshot back into a PLC. Restoring object instance IDs is necessary if, for example, a controller that is already communicating with a BACnet MBE is replaced. Back up IDs: 1. Login with the Symbol Explorer. 2. Create snapshot Start the Symbol Explorer and connect it to a controller. Click on the Take Snapshot button in the Online window to create a snapshot. Sekect the storage location for the snapshot file. ð Once you have selected the folder and confirmed with OK, all values of the symbols in the list are synchronized with the PLC and written to the file. TF8040 Version: 1.14.0 1335
## Page 1336

Tools Restore IDs from a snapshot in the target system: Start in XAE 1. PLC Reset origin 2. Log in PLC 3. Do not start the PLC! Symbol Explorer 1. Open the snapshot [} 1303] with the data backup of the affected target system (PLC). 1336 Version: 1.14.0 TF8040
## Page 1337

Tools 2. Log in to the target system in the Symbol Explorer 3. Synchronize the data from the snapshot to the target system TF8040 Version: 1.14.0 1337
## Page 1338

Tools ð The symbols for synchronization are displayed in the dialog box and prepared for transfer to the target system. 4. Write the symbols from the snapshot to the PLC using the Symbol Explorer. Checking in the XAE 1338 Version: 1.14.0 TF8040
## Page 1339

Tools 1. Write the Init mode from the BACnet server in the PLC to e Init Reset. 2. Start the PLC. ð The BACnet server starts in e Init Mode and recreates the objects. 7.2.8 Extensions The functional scope of the Symbol Explorer has been expanded to include industry-specific features: • Building Automation I/O Export [} 1339]: This extension is used to export I/O variables of type Tc3_XBA. FB_BA_**_Raw. • Building Automation Instance Watch [} 1341]: This extension is a more comprehensive Instance Watch that is adapted to the needs of building automation. 7.2.8.1 Building Automation I/O Export This plugin creates a list of all symbols of the types "Tc3_XBA. FB_BA_**_Raw" that are present in the opened route or snapshot. The symbols found can be saved as CSV or Twin CAT Function Block. Starting the I/O export The I/O export is available in an open route or snapshot. It can be found as a button in the top toolbar: A window opens in which the RAW objects can first be sorted according to their own I/O process types or according to the type of the parent element: TF8040 Version: 1.14.0 1339
## Page 1340

Tools If sorted according to the I/O process type(I/O Type), the object is sorted according to its own type. When sorting according to the type of the parent element (Parent Type), the type of the parent element is decisive. The preview (Preview of the Selection) is updated as a result of the upper selection. The objects are sorted into the categories Binary Input, Binary Output, Analog Input and Analog Output: If no symbols were found, a check should be made to see whether the Solution contains symbols of the types Tc3_XBA. FB_BA_**_Raw. In addition, the Symbol Explorer must be set so that the entry Other is selected in the Symbol Entry Point dialog under Symbol Type Selection. 1340 Version: 1.14.0 TF8040
## Page 1341

Tools For a snapshot, this must be set in the Symbol Entry Point dialog of a route before it is created. Otherwise these symbols will not be saved in a snapshot. The RAW variables found can be exported using the '💾 Export' button. A CSV file and/or a Twin CAT Function Block is available as an export option. The name of the function block can be entered in the text field Function Block Name. The Twin CAT Function Block can be used as a global interface for address mappings. For use, all placeholders ('YOUR_IO_**') must be replaced with the corresponding I/O variables. 7.2.8.2 Instance Watch BA The Instance Watch BA is an extension of the Instance Watch integrated in the Symbol Explorer. The extensions concern a customized Instance Watch BA template, which is loaded when the Instance Watch BA is started, and an extended view of sophisticated BA-specific data types. Start of the Instance Watch BA First, start the Symbol Explorer and open a snapshot or route. The Instance Watch BA can then be selected from the drop-down menu in the top left-hand corner: TF8040 Version: 1.14.0 1341
## Page 1342

Tools An Instance Watch with the title Instance Watch BA and an already loaded Instance Watch template for Building Automation will open. BA-specific Instance Watch Template This template contains every object that has implemented the interface "Tc3_XBA. I_BA_View" or "Tc3_XBA. I_BA_Object". The properties n Instance Id, s Object Name, s Description and e Object Type are also displayed for these objects. This template is loaded every time the Instance Watch BA is started. Resetting the Instance Watch Template If changes have been made to the Instance Watch Template (e.g. properties added/removed), the BA- specific Instance Watch Template can be restored. To do this, the Instance Watch Options must be opened. To reset the template, press the Restore BA default button. Then confirm with OK. Extended view of BA-specific sophisticated types With the Instance Watch BA, some sophisticated types can be clearly displayed and edited. This currently includes these types: • Tc3_XBA. T_BA_Event Transition Text • Tc3_XBA. T_BA_Event Transitions 1342 Version: 1.14.0 TF8040
## Page 1343

Tools • Tc3_XBA. ST_BA_Limit Param • Tc3_XBA. ST_BA_Time Delay Param • Tc3_BA2_Common. ST_BA_Status Flags • Tc3_BA2_Common. ST_BA_Date • Tc3_BA2_Common. ST_BA_Time • Tc3_BA2_Common. ST_BA_Date Time View To see the simplified view of the above symbols, these symbols must be added to the Instance Watch BA as usual. In the example of Tc3_BA2_Common. ST_BA_Date Time, the symbol looks like this: Processing Symbols with a maximum of four sub-symbols can be edited by double-clicking on the symbol cell: For symbols that have more than four sub-symbols, the symbol is edited using the pencil icon. This only appears for these symbols. After clicking, a dialog opens: TF8040 Version: 1.14.0 1343
## Page 1344

Tools Changes are applied immediately in both cases, but are not yet synchronized with the PLC or saved in the snapshot. Therefore, the dialog can be closed after editing the symbol. 7.2.9 Examples of regular expressions For an understanding of the expressions used for filtering and sorting, the following link opens a collection of frequently used regular expressions: Overview of regular expressions 7.3 Template Repository The Template Repository is an app for managing templates. Starting the app in the development environment ü The TF8040 setup automatically installs the Template Repository in the Twin CAT development environment (XAE Shell or Visual Studio). 1. Right-click on a free field in the toolbar to open a context menu. 1344 Version: 1.14.0 TF8040
## Page 1345

Tools 2. Select the app Template Repository from the context menu. 3. Start the app by clicking on the icon Twin CAT Template Repository. ð The main window opens. TF8040 Version: 1.14.0 1345
## Page 1346

Tools Main Window The main window is divided into 6 different areas: 1 Menu bar The following functions are available in the menu bar: • Refresh Template Repositories updates all repositories • Show Log File opens the log file dialog Detailed log information about the software version used and errors are displayed here. 1346 Version: 1.14.0 TF8040
## Page 1347

Tools 2 Search bar The search bar searches the included repositories for keywords (tags) or names within the templates. The search results are displayed in the respective areas. 3 Twin CAT Repository area The Twin CAT repository area contains all templates that are supplied with the TF8040 installation. Templates can be taken from this area but not added. With the TF8040 installation, you receive a repository with templates. In order to use them for your project-specific applications, you must temporarily load the repository into the global area. 4 Global Repository Area The Global Repository area serves as a storage location for all customer-specific templates that can used by several developers across projects. Here templates can be taken and added across projects. The storage location can be a network drive in the company network or any location on the local hard disk, for example. 5 Local Repository area All templates that are used in the local solution are stored in the Local Repository area. TF8040 Version: 1.14.0 1347
## Page 1348

Tools Templates can be exchanged between the local and global area. 6 Info area The notification area displays detailed information about the currently selected templates. Adding templates to a PLC project Templates can be integrated into the current solution in two ways: ü Double click on the desired template 1348 Version: 1.14.0 TF8040
## Page 1349

Tools ü Right click on the desired template > Add to > PLC Project 1. The dialog window Add Template to PLC Project opens. Select the template and confirm this with OK. TF8040 Version: 1.14.0 1349
## Page 1350

Tools ð The desired template including all dependent subtemplates is now in the PLC project. Call and instantiation of a template After the desired template has been added to the project from the repository, it can be instantiated and called in the project applications. Instantiation in the declaration part: Call in the program part: 1350 Version: 1.14.0 TF8040
## Page 1351

Appendix 8 Appendix 8.1 Third-party components This software contains third-party components. Please refer to the license file provided in the following folder for further information: \Twin CAT\Functions\Symbol Explorer\Licenses. 8.2 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG TF8040 Version: 1.14.0 1351
## Page 1352

Appendix Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 1352 Version: 1.14.0 TF8040
## Page 1353

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Third-party trademark statements Chrome, Chromium and Google are trademarks of Google LLC. Intel, the Intel logo, Intel Core, Xeon, Intel Atom, Celeron and Pentium are trademarks of Intel Corporation or its subsidiaries. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 1354

More Information: www.beckhoff.com/tf8040 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
