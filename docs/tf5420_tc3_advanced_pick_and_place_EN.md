---
title: "tf5420_tc3_advanced_pick_and_place_EN"
product: "tf5420"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.15.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/tf5420_tc3_advanced_pick_and_place_EN.pdf"
release_date: "2025-08-13"
---
Manual | EN TF5420 Twin CAT 3 | Motion Pick-and-Place 2025-08-13 | Version: 1.15.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 Overview of the new functions................................................................................................................ 9 4 Group State Diagram.............................................................................................................................. 11 5 MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place)...................................................................... 13 5.1 Configure an MC Group.................................................................................................................. 13 5.2 MC Group Coordinated Motion....................................................................................................... 18 5.3 MC Group with Pick-and-Place....................................................................................................... 20 6 Spatial Configuration.............................................................................................................................. 22 6.1 Coordinate Frame Object................................................................................................................ 22 6.2 Conveyor Tracking Object............................................................................................................... 22 6.3 Conveyor Tracking Behavior........................................................................................................... 22 6.4 Node Connector Object................................................................................................................... 23 6.5 Configuring a Node Connector........................................................................................................ 23 6.6 Configure for MC_Track Conveyor Belt............................................................................................ 28 6.7 Background Information.................................................................................................................. 35 7 PLC Libraries........................................................................................................................................... 38 7.1 Tc3_Mc Coordinated Motion............................................................................................................. 38 7.1.1 Function Blocks................................................................................................................ 40 7.1.2 Datatypes......................................................................................................................... 76 7.2 Tc3_Mc3Definitions......................................................................................................................... 86 7.2.1 Datatypes......................................................................................................................... 86 8 Samples................................................................................................................................................... 95 9 Appendix.................................................................................................................................................. 96 9.1 Cyclic Group Interface..................................................................................................................... 96 9.1.1 Nc To Plc............................................................................................................................ 96 9.1.2 Plc To Nc............................................................................................................................ 97 9.2 Index Offset Specification for MC Group Parameters..................................................................... 97 9.3 Differences between MC2 and MC3............................................................................................... 98 9.4 MC_LREAL/Special Input Values................................................................................................... 98 9.5 Global data types............................................................................................................................ 99 9.5.1 MC_GROUP_TYPE......................................................................................................... 99 9.5.2 MC_GROUP_STATE....................................................................................................... 99 9.5.3 ST_Group Status............................................................................................................ 100 9.5.4 ST_Group Status Flags.................................................................................................... 100 TF5420 Version: 1.15.0 3
## Page 4

Table of contents 4 Version: 1.15.0 TF5420
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF5420 Version: 1.15.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.15.0 TF5420
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF5420 Version: 1.15.0 7
## Page 8

Introduction 2 Introduction The TF5420 Twin CAT 3 Motion Pick-and-Place software package is installed together with the TF5400 software package. Target system Windows 10 Twin CAT 3 Motion Pick-and-Place TF5420 Twin CAT 3 Motion Pick-and-Place executes multi-dimensional motions. It was specially developed for the requirements of pick-and-place applications. It should be applied to motions where the precise path dynamics in segment transitions are not so important, but where the user wishes to get from one point to another as quickly as possible. The Tc3_Mc Coordinated Motion library contains all the associated function blocks. Additional licensing requirements TF5420 Twin CAT 3 Motion Pick-and-Place requires the TC1260 license. 8 Version: 1.15.0 TF5420
## Page 9

Overview of the new functions 3 Overview of the new functions As of TF5400 V3.3.72 • New: In the Group Disabled state, PTP commands of the Tc2_MC2 library (e.g. MC_Move Absolute) are permitted on axes of the group. As of TF5400 V3.3.19 • MC-Group Pick-and-Place no longer available. • New: Function block MC_Set Coordinate Transform Preparation [} 54] for the MC-Group Coordinated Motion • Requires Twin CAT V3.1.4024.40 or higher As of TF5400 V3.2.27 for the MC Group Coordinated Motion: • New: Introduction of additional dynamic constraints for path and auxiliary axes. • New: Optionally, the override also affects the synchronization phase for the MC_Track Conveyor Belt [} 55]. • Optimizations to the MC_Track Conveyor Belt [} 55] that prevent SAF cycle misalignment between conveyor (master) and slave axis. • Optimizations of the error reaction for the MC_Track Conveyor Belt [} 55]. In the event of a runtime error of the conveyor belt (master), an active MC_Move Path [} 70] is not aborted and an error reaction is to be triggered via the PLC. • Requires an x64 platform As of TF5400 V3.1.10.64: • New: In an MC Group Coordinated Motion with Geo Blending, a blocker that is triggered early enough before it becomes active will be blended over and passed on without interruption. • Requires Twin CAT V3.1.4024.24 or higher As of TF5400 V3.1.10.1: • New: Group type MC Group Coordinated Motion. • New: Data for the MC Group Coordinated Motion in the cyclic group interface [} 96]. • New: Function blocks for MC Group Coordinated Motion: ◦ MC_Blocker Preparation [} 71] ◦ MC_Release Blocker [} 73] ◦ MC_Group Read Blocker Status [} 74] ◦ MC_Dwell Time Preparation [} 75] • New: MC_Group Halt [} 60] function block for MC Group Coordinated Motion. • New: Enum MC_TRANSITION_MODE [} 83] extended by mc Trans Mode Corner Distance for MC Group Coordinated Motion. • New: Enum MC_CIRC_PATHCHOICE [} 81] extended by mc Circ Pathchoice Short Segment and mc Circ Pathchoice Long Segment. • Requires Twin CAT V3.1.4024.7 or higher As of TF5400 V3.1.6.27: • New: The remaining time and distance of the current segment can be read via ADS, see Index Offset Specification for MC Group Parameters [} 97]. • Requires Twin CAT V3.1.4022.0 or higher As of TF5400 V3.1.6.3: • New: Function block MC_Set Coordinate Transform [} 53]. TF5420 Version: 1.15.0 9
## Page 10

Overview of the new functions • New: Function block MC_Track Conveyor Belt [} 55] As of TF5400 V3.1.4.4: • New: Special input value [} 98] MC_MAXIMUM. As of TF5400 V3.1.2.47: • New: Function block MC_Move Circular Absolute Preparation. 10 Version: 1.15.0 TF5420
## Page 11

Group State Diagram 4 Group State Diagram The state diagram describes the state of a Coordinated Motion group. The states described here can be read from the PLC using the function block MC_Group Read Status. Note Description 1 Applicable for all non-administrative (movement) function blocks. 2 In the Group Stopping state, many function blocks can be called, but they are not executed. Exceptions are MC_Group Disable [} 43] and MC_Ungroup All Axes [} 58], which cancel the stop and create the transition to the Group Disabled state. 3 MC_Group Stop [} 62]. DONE 4 The number of axes in the group (added via MC_Add Axis To Group [} 40]) must be equal to the number of axes in the spatial axis convention plus the Additional Axes Count. 5 - 6 MC_Group Disable can be called in all states and changes the state to Group Disabled. When MC_Group Disable is called in an error state, the state changes to Group Error Disabled. TF5420 Version: 1.15.0 11
## Page 12

Group State Diagram 7 The state change to Group Error Enabled occurs in the axis/group error case from any state in which the group is enabled. 8 The state change occurs when "b Is Control Loop Closed" is TRUE for all axes. b Positive Direction"/"b Negative Direction" do not have to be enabled. 9 - 10 MC_Group Reset [} 48] has no effect if the state is different from Group Error Stop. MC_Group Reset must be called to exit the Group Error Stop state. 12 Version: 1.15.0 TF5420
## Page 13

MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place) 5 MC Group (TF5420 Twin CAT 3 Motion Pick-and- Place) 5.1 Configure an MC Group Basically, the configuration described here is valid for all Motion Objects in the Advanced Motion Pack. 1. Add new “NC/PTP NCI Configuration” in the Motion section. 2. Add all axes to the NC-Configuration. TF5420 Version: 1.15.0 13
## Page 14

MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place) 3. Add the appropriate Group to the entry “Objects” in the NC-Configuration: For Coordinated Motion, multi-dimensional movements: MC Group Coordinated Motion [} 18] or MC Group with Pick-and-Place [} 20]. 14 Version: 1.15.0 TF5420
## Page 15

MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place) 4. Check the Tasks in the Group. Context ID 0 has to be set to “NC-Task 1 SAF”. Context ID 1 has to be set to “NC-Task 1 SVB”. TF5420 Version: 1.15.0 15
## Page 16

MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place) 5. Configure the group parameters according to the desired application. For more explanations referring to the group parameters see the following sections. 6. To address the group from the PLC a cyclic interface has to be declared and linked to the IO of the group (see PLC Library Tc3_Mc Coordinated Motion [} 18]). To address and enable the axes the library “Tc2_Mc2” has to be added to the project. ð A new “NC/PTP NCI Configuration” has been established. VAR st Group Ref : AXES_GROUP_REF; END_VAR 16 Version: 1.15.0 TF5420
## Page 17

MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place) TF5420 Version: 1.15.0 17
## Page 18

MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place) 5.2 MC Group Coordinated Motion Parameter (Init) Spatial Axes Conventions Three axes conventions can be set. The axes conventions define how the axes are interpreted in the axis group. In combination with "Additional Axes Count", they define the dimension of the axis group and thus the number of axes that need to be added, as well as the way in which each of the added axes is interpreted. Parameter Value Type Description Spatial mc Axes Conv2DCartesian XY MC. MC_AXES_CONVENTI A 2D group consisting of X, Y. The Axes ON order of the translatory axes in the Convention configuration determines the order of translation. 18 Version: 1.15.0 TF5420
## Page 19

MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place) Parameter Value Type Description Spatial mc Axes Conv3DCartesian XY MC. MC_AXES_CONVENTI A 3D group consisting of X, Y, Z. The Axes Z ON order of the translatory axes in the Convention configuration determines the order of translation. Spatial mc Axes Conv4DCartesian XY MC. MC_AXES_CONVENTI A 4D group consisting of X, Y, Z and Axes ZC ON a rotary axis around Z (C). The order Convention of the translatory and rotary axes in the configuration determines the order of translation and rotation. Additional Axes Count Number of axes in the axis group that have no geometric interpretation. Between 0 and 8 axes of this type can be inserted. Blending Strategy Sets the blending strategy. Parameter Value Type Description Blending mc Blending Geo MC. MC_BLENDING_STRA The blending path is defined Strategy TEGY geometrically and then executed with the dynamics allowed for the path. Blending mc Blending Superpos MC. MC_BLENDING_STRA The blending path results Strategy TEGY dynamically from the superposition of two segments in the blending area. Time Override Ramp Time Ramp time for override modification from 0 % to 100 %. The time override is superimposed on the actual profile. This can result in higher dynamics in total during the override changes than were parameterized at the group. Tracking Override Behavior Defines whether the portion of the movement for accurate synchronization is subject to override or not. Available from TF5400 3.2.27. Parameter Value Type Description Tracking Disable MC. Override Behavior The group override has no effect on Override the portion of movement for accurate Behavior synchronization. Tracking Enable MC. Override Behavior The group override also affects the Override portion of movement for accurate Behavior synchronization. Geo Blending-specific parameters Blending Path Type Defines the geometry used for the blending path. Parameter Value Type Description Blending mc Blending Path Type Ignore MC. MC_BLENDING_PATH No blending. Path Type _TYPE Blending mc Blending Path Type Poly5 MC. MC_BLENDING_PATH The blending path uses a fifth degree Path Type _TYPE polynomial. TF5420 Version: 1.15.0 19
## Page 20

MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place) 5.3 MC Group with Pick-and-Place MC Group with Pick-and-Place no longer available Instead of the MC Group with Pick-and-Place, use MC Group Coordinated Motion [} 18]. Up to TF5400 Twin CAT Advanced Motion Pack version 3.2.27, existing projects can be opened and executed with the MC Group with Pick-and-Place. The MC Group connects axes in order to execute a multi-dimensional motion. Axes conventions Tab: Parameter (Init). Three axes conventions can be set. The axes conventions define how the axes are interpreted in the axis group. They define the dimension of the axis group and thus the number of axes that need to be added, as well as the way in which each of the added axes is interpreted. Parameter Value Type Description Axes mc Axes Conv2DCartesian XY MC. MC_AXES_CONVENTI A 2D group consisting of X, Y. The Convention ON order of the translatory axes in the configuration determines the order of translation. Axes mc Axes Conv3DCartesian XY MC. MC_AXES_CONVENTI A 3D group consisting of X, Y, Z. The Convention Z ON order of the translatory axes in the configuration determines the order of translation. Axes mc Axes Conv4DCartesian XY MC. MC_AXES_CONVENTI A 4D group consisting of X, Y, Z and Convention ZC ON a rotary axis around Z (C). The order of the translatory and rotary axes in the configuration determines the order of translation and rotation. 20 Version: 1.15.0 TF5420
## Page 21

MC Group (TF5420 Twin CAT 3 Motion Pick-and-Place) Axis group parameters of the pick-and-place kernel Tab: Parameter (Init). Parameter Unit Type Description NET Cycle Time Divisor UINT Improves accuracy on the basis of temporal discretization. Time Override Ramp S LREAL Ramp time for override modification from Time 0 % to 100 %. The pick-and-place setpoint generator was specially developed for the requirements of pick-and-place applications. It is intended for motions where the precise path dynamics are not so important, but where the user wishes to get from one point to another as quickly as possible. It is therefore permissible for the algorithm to violate restrictions in the path dynamics within the tolerance sphere. Axis restrictions are never violated. TF5420 Version: 1.15.0 21
## Page 22

Spatial Configuration 6 Spatial Configuration The Spatial Configuration describes geometrical relationships between reference frames. Those relationships are of translation and rotation type. 6.1 Coordinate Frame Object Coordinate Frame Objects can be used to hierarchically build up geometrical translation and rotation relationships. For straight interpretation the x-direction of the final element within the hierarchy should point into the conveying direction. Parameter Description Unit Rotation Convention Convention used for the calculation of rotations. Default is DIN9300 Z”Y’X where Rotation 3 is the parameter for Z”, Rotation 2 is the parameter for Y’ and Rotation 1 is the parameter for X. Definition Direction Indicates the direction in which the displacement is programmed (from the point of view of the reference system or the MCS). Translation X Translation in the x-axis direction. mm Translation Y Translation in the y-axis direction. mm Translation Z Translation in the z-axis direction. mm Rotation 1 Rotation axis is defined by the Rotation Convention. ° Rotation 2 Rotation axis is defined by the Rotation Convention. ° Rotation 3 Rotation axis is defined by the Rotation Convention. ° 6.2 Conveyor Tracking Object A Conveyor Tracking object can be used to synchronize an axes group with a conveyor belt. It is added as a child object to a Coordinate Frame object. While the Coordinate Frame describes the static transformation (translation and/or rotation) to the conveyor belt system, the Conveyor Tracking object handles the dynamic part of the tracking. The Conveyor Tracking parameters are listed in the following table. The dynamics parameters are default values that are used when MC_DEFAULT is chosen for the corresponding parameter in the MC_Track Conveyor Belt function block instance. Parameter Description Unit Velocity Default velocity for synchronization. mm s-1 Acceleration Default acceleration for synchronization. mm s-2 Deceleration Default deceleration for synchronization. mm s-2 Jerk Default jerk for synchronization. mm s-3 Default Tracking Behavior Conveyor tracking behavior after In Sync has been reached. Synchronization Tolerance Distance to tracking target in which the tracking is mm Distance considered synchronized (In Sync = TRUE). Usage of this parameter might be useful if the master signal is noisy. This parameter only has influence if MC Group Coordinated Motion is in use. 6.3 Conveyor Tracking Behavior The Default Tracking Behavior defines the kind of default disturbance rejection during tracking. A disturbance may be an unexpected impulse or a conveyor indexing movement. 22 Version: 1.15.0 TF5420
## Page 23

Spatial Configuration mc Tracking Behavior Dyn Limited Velocity synchronization to the Conveyor Belt is maintained using the given Acceleration, Deceleration and Jerk. Relevant when disturbances are not known precisely or disturbance dynamics are significant. Dynamic limits are input to the MC_Track Conveyor Belt function block. The values from the Conveyor Tracking Object will be used when MC_Default is input to the function block. When the conveyor indexes, the response will be limited by the dynamic parameters. When the Dyn Limited setting is used, the response is compensated with the jerk limit. The function block output MC_Track Conveyor Belt. In Sync indicates when there is synchronization. In Sync Using the mc Tracking Behavior Dyn Limited operation mode the In Sync = TRUE output may disappear when the synchronized position has been lost. Staying within the parameterized dynamics the algorithm tries to return to the synchronized position on its own. When the synchronized position has been reached the In Sync = TRUE output appears, again. mc Tracking Behavior Stay In Sync Velocity synchronization to the Conveyor Belt is maintained with non-limited Acceleration, Deceleration and Jerk. When the conveyor indexes, the tracking response will not be limited. Rather, the tracking response intends to remain synchronized and follow the conveyor unconditionally. The function block output MC_Track Conveyor Belt. In Sync indicates when there is synchronization. In Sync Using the mc Tracking Behavior Stay In Sync operation mode when the In Sync signal has once become TRUE, it stays TRUE as long as the command is active. 6.4 Node Connector Object A Node Connector is an administrative Object, that establishes a transformation from one reference frame (node) to another. Parameter Description Start node Object ID of the starting point for the coordinate transformation. The default ID value is 0 and stands for the WCS, the World Coordinate System. End node Object ID of the end point of the coordinate transformation, e.g. a point on the Conveyor Belt. 6.5 Configuring a Node Connector Configuring for MC_Set Coordinate Transform is illustrated at the example of a pallet located relative to the WCS or MCS coordinate system. Node connector objects Node connector objects are used by MC_Set Coordinate Transform and MC_Track Conveyor Belt. Instead of coordinate frames, node connector objects are addressed by the PLC as representatives. Example To introduce a coordinate transform using MC_Set Coordinate Transform: TF5420 Version: 1.15.0 23
## Page 24

Spatial Configuration 1. Insert an MC Group. 2. Insert a Node Connector. 24 Version: 1.15.0 TF5420
## Page 25

Spatial Configuration TF5420 Version: 1.15.0 25
## Page 26

Spatial Configuration 3. Insert a Coordinate Frame. 4. Enter relevant Node Connector Parameters - in this example the end node refers to the pallet object identification. 26 Version: 1.15.0 TF5420
## Page 27

Spatial Configuration 5. Enter relevant Coordinate Frame Parameters. 6. Link the inserted Node Connector to the PLC. TF5420 Version: 1.15.0 27
## Page 28

Spatial Configuration ð Finally‚ you can insert the MC_Set Coordinate Transform function block. The axis group Axis Group is linked with the Pick-and-Place function blocks. For axis movements a move command has to be programmed, e.g. Move Path. 6.6 Configure for MC_Track Conveyor Belt To track a conveyor belt using MC_Track Conveyor Belt: 1. Insert an MC Group. 28 Version: 1.15.0 TF5420
## Page 29

Spatial Configuration 2. Insert a Node Connector. TF5420 Version: 1.15.0 29
## Page 30

Spatial Configuration 30 Version: 1.15.0 TF5420
## Page 31

Spatial Configuration 3. Insert a Coordinate Frame. TF5420 Version: 1.15.0 31
## Page 32

Spatial Configuration 4. Insert Conveyor Tracking. Firstly, a Coordinate Frame has been created. Secondly, the Conveyor Tracking Object has to be added as a child element to the Coordinate Frame created previously. 32 Version: 1.15.0 TF5420
## Page 33

Spatial Configuration 5. Enter relevant Node Connector Parameters - the end node refers to the conveyor tracking object identification. 6. Enter relevant Coordinate Frame Parameters. TF5420 Version: 1.15.0 33
## Page 34

Spatial Configuration 7. Enter relevant Conveyor Tracking Parameters. The Default Tracking Behavior specifies whether, after In Sync has been reached for the first time, the tracking movement is still limited by the specified dynamic limits (In Sync may be lost again) or synchronization is forced (even if the dynamic limits need to be violated in order to do so). 8. Link the Node Connector to the PLC. 34 Version: 1.15.0 TF5420
## Page 35

Spatial Configuration ð Finally‚ you can insert the MC_Track Conveyor Belt function block. 6.7 Background Information Coordinate systems – relationships • WCS World Coordinate System. • MCS Machine Coordinate System. • UCS User Coordinate System. • PCS Programmed Coordinate System. Workpiece. TF5420 Version: 1.15.0 35
## Page 36

Spatial Configuration Pick-and-Place: From warehouse to carrier The workpieces must be taken from the warehouse and placed in the free carrier positions running on the conveyor belt. Thereby, • the storage place is defined within the WCS, • the robot is located somewhere within the WCS, • the robot can be controlled within its MCS, • the conveyor belt is located somewhere in the WCS, • on the conveyor belt a carrier can be located within the UCS, • a workpiece can be located within its carrier within the PCS. 36 Version: 1.15.0 TF5420
## Page 37

Spatial Configuration Pick-and-Place: From conveyor belt towards conveyor belt The workpieces have to be taken from the upper conveyor belt and placed on the lower conveyor belt. Thereby, • the robot is located somewhere within the WCS, • the robot can be controlled within its MCS, • each conveyor belt is located somewhere in the WCS, • workpieces on the conveyor belt can be located within a UCS. TF5420 Version: 1.15.0 37
## Page 38

PLC Libraries 7 PLC Libraries 7.1 Tc3_Mc Coordinated Motion The Tc3_Mc Coordinated Motion library is used for TF5410 Twin CAT 3 Motion Collision Avoidance and also for TF5420 Twin CAT 3 Motion Pick-and-Place. Overview Function block Description TF5410 TF5420 Twin CAT 3 Mo- Twin CAT 3 Motion Pick-and- tion Collision Place Avoidance MC Group with MC Group Co- Pick-and-Place ordinated Mo- tion Administrative MC_Add Axis To Group Adds an axis group. [} 40] ( up to v3.2) MC_Group Disable [} 43] Disables an axis group. ( up to v3.2) MC_Group Enable [} 44] Enables an axis group. ( up to v3.2) MC_Group Read Error Reads the error ID of a group. [} 45] ( up to v3.2) MC_Group Read Status Reads the group status. [} 47] ( up to v3.2) MC_Group Reset [} 48] Resets a group. ( up to v3.2) MC_Group Set Override Sets the override of a group and returns the [} 50] actual override value. ( up to v3.2) MC_Remove Axis From Grou Removes an axis from a group. p [} 51] ( up to v3.2) MC_Set Coordinate Transfo Activates a reference system. rm [} 53] ( up to v3.2) MC_Set Coordinate Transfo Adds a change of reference system to the rm Preparation [} 54] list of movement segments. 38 Version: 1.15.0 TF5420
## Page 39

PLC Libraries Function block Description TF5410 TF5420 Twin CAT 3 Mo- Twin CAT 3 Motion Pick-and- tion Collision Place Avoidance MC Group with MC Group Co- Pick-and-Place ordinated Mo- tion MC_Track Conveyor Belt Assists in synchronizing velocity to an object [} 55] moving along a straight line through space. ( up to v3.2) MC_Ungroup All Axes Disables a group and removes all axes. [} 58] ( up to v3.2) UDINT_TO_IDENTINGROU Converts an integer value to P [} 59] IDENT_IN_GROUP_REF, so axes without special interpretation can be added to a group. Motion MC_Group Halt [} 60] Stops a group without locking it for further motion commands. MC_Group Stop [} 62] Stops a group and locks it for further motion commands. ( up to v3.2) MC_Move Linear Absolute P Adds an absolute linear movement to a list of reparation [} 64] motion segments. ( up to v3.2) MC_Move Circular Absolute Adds an absolute circular movement to a list of Preparation [} 66] motion segments. ( up to v3.2) MC_Move Path [} 70] Executes a list of motion segments. ( up to v3.2) MC_Blocker Preparation Appends a blocking job to the list of segments in the [} 71] structure Path Data. MC_Release Blocker Resolves a blocking job that is blocking further [} 73] execution of the path. MC_Group Read Blocker Sta Reads the current blocker status. tus [} 74] MC_Dwell Time Preparation Appends a standstill job with a defined time to the [} 75] list of segments in the structure Path Data. TF5420 Version: 1.15.0 39
## Page 40

PLC Libraries Structures and enumerations Function block Description TF5410 TF5420 Twin CAT 3 Mo- Twin CAT 3 Motion Pick-and- tion Collision Place Avoidance MC Group with MC Group Co- Pick-and-Place ordinated Mo- tion IDENT_IN_GROUP_REF Defines how an axis is interpreted in a group. [} 76] ( up to v3.2) MC_CIRC_MODE [} 77] The circle mode defines which definition is used to program a circle. ( up to v3.2) MC_CIRC_PATHCHOICE The data type defines the rotation direction of a [} 81] circle. ( up to v3.2) MC_PATH_DATA_REF Represents the path to be executed at [} 82] MC_Move Path [} 70]. ( up to v3.2) Clear Path [} 83] Resets the path represented by MC_PATH_DATA_REF ( up to v3.2) [} 82]. MC_TRANSITION_MODE Characterizes the way a segment transition is [} 83] executed. ( up to v3.2) MC_COORD_REF [} 85] Object ID of a coordinate system. ( up to v3.2) 7.1.1 Function Blocks 7.1.1.1 Administrative 7.1.1.1.1 MC_Add Axis To Group MC_Add Axis To Group Execute BOOL BOOL Done Ident In Group IDENT_IN_GROUP_REF BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error Id 40 Version: 1.15.0 TF5420
## Page 41

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Add Axis To Group adds an axis to a group. From V3.1.10.1, stationary axes can be added to and removed from a CA group in the Group Moving group state. If a moving axis is added to a group, the command is rejected with an error message (a change of the group state with a moving axis is also rejected). Only axes in Group Disabled or Group Error Disabled state can be added to a MC group. Inputs VAR_INPUT Execute : BOOL; Ident In Group : IDENT_IN_GROUP_REF; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Ident In Group IDENT_IN_GROUP_R Defines the interpretation of the axis to be added to the group. For EF multi-dimensional motions, this can be the Cartesian interpretation. The global variables [} 76] (e.g. MCS_X) must be used. For Collision Avoidance the function UDINT_TO_IDENTINGROUP [} 59] must be used. Notice The use of integer values for the input Ident In Group is NOT supported and may lead to incompatibility with future releases. If integer values are used, it may no longer be possible to build the project. We recommend using global variables (e.g. MCS_X) or the conversion function UDINT_TO_IDENTINGROUP. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; Axis : AXIS_REF; END_VAR Name Type Description Axes Group AXES_GROUP_REF Reference to a group of axes (see Cyclic Group Interface [} 96]). Axis AXIS_REF Reference to an axis (see AXIS_REF). Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. TF5420 Version: 1.15.0 41
## Page 42

PLC Libraries Name Type Description Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Sample for Twin CAT 3 Motion Pick-and-Place Multi-dimensional movements Multi-dimensional movements are only applicable when TF5420 is used. VAR_GLOBAL CONSTANT c Axes Count : UINT := 4; END_VAR VAR st Group Ref : AXES_GROUP_REF; // link to MC Group st Axis : ARRAY[1..c Axes Count] OF AXIS_REF; fb Add Axis : ARRAY[1..c Axes Count] OF MC_Add Axis To Group; i : UINT; END_VAR fb Add Axis[1]. Ident In Group := MCS_X; //X-Axis fb Add Axis[2]. Ident In Group := MCS_Y; //Y-Axis fb Add Axis[3]. Ident In Group := MCS_Z; //Z-Axis fb Add Axis[4]. Ident In Group := MCS_C1;//1st rotation is C-rotation (around Z-Axis) FOR i:=1 TO c Axes Count DO fb Add Axis[i]( Axes Group:=st Group Ref, Axis := st Axis[i], Execute := TRUE); END_FOR Sample for TF5410 Twin CAT 3 Motion Collision Avoidance PTP with Collision Avoidance PTP with Collision Avoidance is only applicable when TF5410 is used. VAR_GLOBAL CONSTANT c Axes Count : UDINT:=10; END_VAR VAR st Group Ref : AXES_GROUP_REF; // link to CA Group st Axis : ARRAY[1..c Axes Count] OF AXIS_REF; fb Add Axis : ARRAY[1..c Axes Count] OF MC_Add Axis To Group; i : UDINT; END_VAR FOR i:=1 TO c Axes Count DO fb Add Axis[i]( Axes Group:=st Group Ref, Axis := st Axis[i], Ident In Group := UDINT_TO_IDENTINGROUP(i), Execute := TRUE); END_FOR 42 Version: 1.15.0 TF5420
## Page 43

PLC Libraries Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.1.2 MC_Group Disable MC_Group Disable Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Group Disable disables the group. After successful execution the group changes into group state Group Disabled (see State diagrams). As of TF5400 V3.3.72, PTP commands of the Tc2_MC2 library (e.g. MC_Move Absolute) are permitted on axes of the MC Group Coordinated Motion in the Group Disabled state. NOTICE Disabling a Moving Group results in an instant stop. The sudden stopping of axes is likely to exceed its allowed deceleration limits. Depending on the drive hardware, this could lead to current peaks and runtime errors. Before executing MC_Group Disable, use MC_Group Halt [} 60] or MC_Group Stop [} 62] to avoid this situation. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF TF5420 Version: 1.15.0 43
## Page 44

PLC Libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.1.3 MC_Group Enable MC_Group Enable Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Group Enable enables the group. If it succeeds and all axes are ready, the group is then in group state Group Standby (see State diagrams). An MC Group can only be enabled, if all axes were added to the group before. Inputs VAR_INPUT Execute : BOOL; END_VAR 44 Version: 1.15.0 TF5420
## Page 45

PLC Libraries Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Group AXES_GROUP_REF Reference to a group of axes (see Cyclic group interface [} 96]) Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.1.4 MC_Group Read Error MC_Group Read Error Enable BOOL BOOL Valid ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id UDINT Group Error Id The function block MC_Group Read Error returns the error code for the group. It does not return any errors for function blocks (e.g. invalid parameterization). TF5420 Version: 1.15.0 45
## Page 46

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL The command is executed as long as Enable is active. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Valid : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; Group Error Id : UDINT; END_VAR Name Type Description Valid BOOL This output indicates that other output values are valid for this function block. Busy BOOL This output becomes TRUE when the command is started with Enable and remains so as long as the function block executes the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Group Error Id UDINT Returns the error ID of the group (see NC error documentation). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 46 Version: 1.15.0 TF5420
## Page 47

PLC Libraries 7.1.1.1.5 MC_Group Read Status MC_Group Read Status Enable BOOL BOOL Valid ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Group Moving BOOL Group Homing BOOL Group Error Stop BOOL Group Not Ready BOOL Group Standby BOOL Group Stopping BOOL Group Disabled BOOL All Axes Standing BOOL In Position BOOL Error UDINT Error Id The function block MC_Group Read Status reads the status of an axis group (see State diagrams). TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL The command is executed as long as Enable is active. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Valid : BOOL; Busy : BOOL; Group Moving : BOOL; Group Homing : BOOL; Group Error Stop : BOOL; Group Not Ready : BOOL; Group Standby : BOOL; Group Stopping : BOOL; Group Disabled : BOOL; All Axes Standing : BOOL; Constant Velocity : BOOL; // hidden Accelerating : BOOL; // hidden Decelerating : BOOL; // hidden In Position : BOOL; TF5420 Version: 1.15.0 47
## Page 48

PLC Libraries Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Valid BOOL This output indicates that other output values are valid for this function block. Busy BOOL This output becomes TRUE when the command is started with Enable and remains so as long as the function block executes the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Group Moving BOOL The group is in the Group Moving state (see State diagrams). Group Homing BOOL The group is in the Group Homing state (see State diagrams). Group Error Stop BOOL The group is in the Group Error Stop state (see State diagrams). Group Not Ready BOOL The group is in the Group Not Ready state (see State diagrams). Group Standby BOOL The group is in the Group Standby state (see State diagrams). Group Stopping BOOL The group is in the Group Stopping state (see State diagrams). Group Disabled BOOL The group is in the Group Disabled state (see State diagrams). All Axes Standing BOOL None of the axes in the group move physically (velocity = 0 and acceleration = 0), regardless of whether a Motion Command exists or not. Constant Velocity BOOL Not supported. Not visible as of TF5400 3.2.27. Accelerating BOOL Not supported. Not visible as of TF5400 3.2.27. Decelerating BOOL Not supported. Not visible as of TF5400 3.2.27. In Position BOOL Not supported. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.1.6 MC_Group Reset MC_Group Reset Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) 48 Version: 1.15.0 TF5420
## Page 49

PLC Libraries The function block MC_Group Reset resets all internal errors of a group and all axes which are part of the group. If the group was enabled when the error occurred, the group goes into state Group Standby. If the group was disabled, it goes to state Group Disabled (see State diagrams). If this function block is called while there is no error, it has no effect. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 TF5420 Version: 1.15.0 49
## Page 50

PLC Libraries 7.1.1.1.7 MC_Group Set Override MC_Group Set Override Enable BOOL BOOL Enabled Vel Factor MC_LREAL BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Error UDINT Error Id LREAL Actual Vel Factor TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Group Set Override changes the override of a group. A change is made with a certain delay. An override input value is valid between 0 [0%] and 1 [100%]. If the value is set outside this range, it is automatically set to the respective limit value. The behavior for override modifications in relation to the MC group can be defined as an axis group parameter, see Time Override Ramp Time. Inputs VAR_INPUT Enable : BOOL; Vel Factor : MC_LREAL := 1.0; END_VAR Name Type Description Enable BOOL The command is executed as long as Enable is active. Vel Factor MC_LREAL The override is set to this value (value range between 0 [0 %] and 1 [100 %]). Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Enabled : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; Actual Vel Factor : UDINT; END_VAR Name Type Description Enabled BOOL This output signals that the Vel Factor has been set successfully. The Vel Factor shows the type of an override factor. 50 Version: 1.15.0 TF5420
## Page 51

PLC Libraries Name Type Description Busy BOOL This output becomes TRUE when the command is started with Enable and remains so as long as the function block executes the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Actual Vel Factor UDINT Override that is currently active in the group (value range between 0 [0 %] and 1 [100 %]). Sample VAR st Group Ref : AXES_GROUP_REF; fb Set Override : MC_Group Set Override; END_VAR fb Set Override( Axes Group:=st Group Ref , Enable:= TRUE , Vel Factor:=1.0 , (* 1.0 = 100% *) ); Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.1.8 MC_Remove Axis From Group MC_Remove Axis From Group Execute BOOL BOOL Done Ident In Group IDENT_IN_GROUP_REF BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Remove Axis From Group removes an axis from the axis group. From TF5400 V3.1.10.1, stationary axes can be added to and removed from a CA group in the Group Moving group state. If a moving axis is added to a group, the command is rejected with an error message (a change of the group state with a moving axis is also rejected). Axes can only be added to an MC group if Enable Requested is FALSE, e.g. in the Group Disabled state. TF5420 Version: 1.15.0 51
## Page 52

PLC Libraries Success of the function block The function block always returns DONE if the axis no longer belongs to the group. This means that DONE is returned even if the axis was not in the group before the function block was called. Inputs VAR_INPUT Execute : BOOL; Ident In Group : IDENT_IN_GROUP_REF; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Ident In Group IDENT_IN_GROUP_REF Defines the interpretation of the axis to be added to the group. For multidimensional motions, this can be the Cartesian interpretation. The global variables (e.g. MCS_X) must be used. For Collision Avoidance the function UDINT_TO_IDENTINGROUP must be used. Use of integer values for the input Ident In Group The use of integer values for the input Ident In Group is NOT supported and may lead to incompatibility with future releases. If integer values are used, it may no longer be possible to build the project. We recommend using global variables [} 76] (e.g. MCS_X) or the conversion function UDINT_TO_IDENTINGROUP [} 59]. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). 52 Version: 1.15.0 TF5420
## Page 53

PLC Libraries Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.1.9 MC_Set Coordinate Transform MC_Set Coordinate Transform Execute BOOL BOOL Done Coord Transform MC_COORD_REF BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Active BOOL Command Aborted BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Set Coordinate Transform activates a coordinate transformation for successor movements. The successful activation is indicated by Active or Done. Decouples the successor movements from a transport system (see MC_Track Conveyor Belt [} 55]). Successor movements (e.g. MC_Move Path [} 70]) take place relative to the coordinate transformation. Use case for changing the reference system The MC group can be decoupled by using MC_Set Coordinate Transform and changing the reference system. Inputs VAR_INPUT Execute : BOOL; Coord Transform : MC_COORD_REF; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Coord Transform MC_COORD_REF Reference to a coordinate system (see MC_COORD_REF [} 85]). Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Group AXES_GROUP_REF Reference to a group of axes (see Cyclic Group Interface [} 96]). TF5420 Version: 1.15.0 53
## Page 54

PLC Libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Done, Command Aborted or Error is set. Active BOOL Active indicates that the command is being executed. Active indicates that the reference system has been successfully set (MC Coordinated Motion Group only). Active indicates a delay in conveyor tracking (MC Coordinated Motion Group only). Active becomes FALSE if one of the outputs Done, Command Aborted or Error is set to TRUE. Note: According to the PLCopen definition, Active is reset if Done is set to TRUE. In the event of an insignificant or non-existent delay, Active can only be set to TRUE for a short period of time. If the PLC program checks Active, it is therefore advisable to also check Done. Command Aborted BOOL This output becomes TRUE if the command was interrupted by another command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4022.25 PC or CX (x64) Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack Tc2_MC2 V3.1.6.03 7.1.1.1.10 MC_Set Coordinate Transform Preparation MC_Set Coordinate Transform Preparation ↔ Path Data Reference To MC_PATH_DATA_REF BOOL Error Coord Transform MC_COORD_REF UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion 54 Version: 1.15.0 TF5420
## Page 55

PLC Libraries The function block MC_Set Coordinate Transform Preparation inserts a change of reference system into the table containing the segments of a path. Inputs VAR_INPUT Path Data : MC_PATH_DATA_REF; Coord Transform : MC_COORD_REF; END_VAR Name Type Description Path Data MC_PATH_DATA_REF [} 82] Table containing the segments of a path. The table is written by the function block MC_…Preparation and executed by MC_Move Path [} 70]. Coord Transform MC_COORD_REF [} 85] Reference to a coordinate system. Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC library to include Twin CAT V3.1.4024.40 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.3.19 7.1.1.1.11 MC_Track Conveyor Belt MC_Track Conveyor Belt Execute BOOL BOOL In Sync Coord Transform MC_COORD_REF BOOL Busy Initial Object Pos Pointer To MC_LREAL BOOL Active Initial Object Pos Count UDINT BOOL Command Aborted Master Ref Pos MC_LREAL BOOL Error Velocity MC_LREAL UDINT Error Id Acceleration MC_LREAL Deceleration MC_LREAL Jerk MC_LREAL ↔ Axes Group Reference To AXES_GROUP_REF ↔ Conveyor Belt Reference To AXIS_REF TF5420 Version: 1.15.0 55
## Page 56

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block Mc_Track Conveyor Belt enables a reference system that is in motion. It synchronizes the Axes Group with the Conveyor Belt in terms of velocity. Synchronization with a position requires a motion command. The function block thus helps to synchronize with an object that moves in a straight line through space. Example: products moving on a conveyor belt or other transport system. The origin of the conveyor belt is parameterized with a coordinate system (Coord Transform). X is the conveying direction. The detected object position (Initial Object Pos) and the corresponding touch probe position (Master Ref Pos) are entered in the function block. Synchronization dynamics can be entered in the function block. Movements executed after Active = TRUE are synchronized with the conveyor belt. Execution of MC_Track Conveyor Belt with another instance causes direct synchronization with a second conveyor belt. When changing the reference system, a conveyor belt can be decoupled. Use case for changing the reference system The MC group can be decoupled by using MC_Track Conveyor Belt and changing the reference system. The reference system can be changed with MC_Set Coordinate Transform. News and optimizations regarding MC_Track Converyor Belt with TF5400 V3.2.27 for MC Group Coordinated Motion • New: Optionally, the override also affects the synchronization phase for the MC_Track Conveyor Belt. The setting is made in the parameter "Tracking Override Behavior" in the MC Group Coordinated Motion [} 18]. • Optimizations to the MC_Track Conveyor Belt that prevent SAF cycle misalignment between conveyor (master) and slave axis. • Optimizations of the error reaction for the MC_Track Conveyor Belt. In the event of a runtime error of the conveyor belt (master), an active MC_Move Path is not aborted and an error reaction is to be triggered via the PLC. Inputs VAR_INPUT Execute : BOOL; Coord Transform : MC_COORD_REF; Initial Object Pos : POINTER TO MC_LREAL; Initial Object Pos Count : UDINT; Master Ref Pos : MC_LREAL; Velocity : MC_LREAL := MC_DEFAULT; Acceleration : MC_LREAL := MC_DEFAULT; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. 56 Version: 1.15.0 TF5420
## Page 57

PLC Libraries Name Type Description Coord Transform MC_COORD_REF Reference to a coordinate system (see MC_COORD_REF [} 85]). Initial Object Pos POINTER TO MC_LREAL Pointer to array [1.. Initial Object Pos Count]. Initial Object Pos Count UDINT Dimension of the Initial Object Pos vector. Master Ref Pos MC_LREAL Touch probe position. Velocity MC_LREAL Velocity for synchronization. The velocity must exceed the conveyor belt velocity. The velocity is not limited by the maximum axis velocity. Acceleration MC_LREAL Used in the Conveyor Tracking object. The acceleration for synchronization. The acceleration is not limited by the maximum axis acceleration. If no value is entered, then the default acceleration of the Conveyor Tracking object is used. Deceleration MC_LREAL Used in the Conveyor Tracking object. The deceleration for synchronization. The deceleration is not limited by the maximum axis deceleration. If no value is entered, then the default deceleration of the Conveyor Tracking object is used. Jerk MC_LREAL The jerk for synchronization. If no value is entered, then the default jerk of the Conveyor Tracking object is used. The maximum jerk is not limited. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; Conveyor Belt : AXIS_REF; END_VAR Name Type Description Axes Group AXES_GROUP_REF Reference to a group of axes (see Cyclic Group Interface [} 96]). Conveyor Belt AXIS_REF Reference to an axis. Reference to the conveyor axis. Outputs VAR_OUTPUT In Sync : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description In Sync BOOL The output In Sync becomes TRUE for the first time when the slave is synchronized with the velocity. If the slave dynamics is too low to follow the master movement, the output In Sync could be reset to FALSE, after which the slave axis starts synchronizing again. Notice Velocity synchronization: Active and In Sync - the function block MC_Track Conveyor Belt synchronizes the Axes Group with the velocity of the Conveyor Belt axis. The function block uses the given parameters for Acceleration, Deceleration and Jerk. When this synchronization movement TF5420 Version: 1.15.0 57
## Page 58

PLC Libraries Name Type Description begins, Active is set to TRUE. When the velocity of the Conveyor Belt is reached, In Sync is set to TRUE. The synchronization status is continuously monitored and indicated with In Sync. Notice Conveyor movement, default tracking behavior and In Sync - once the output signal In Sync has been set, there are two options to maintain synchronization. mc Tracking Behavior Dyn Limited - this behavior is the default (MC_Default) tracking behavior. The Axes Group maintains velocity synchronization with the Conveyor Belt using the given parameters for Acceleration, Deceleration and Jerk. – mc Tracking Behavior Stay In Sync - the Axes Group maintains the velocity synchronization with the Conveyor Belt with unlimited parameters for Acceleration, Deceleration and Jerk. Notice Position synchronization: Master Ref Pos and Initial Object Pos - the function blocks MC_Track Conveyor Belt and MC_Move Path should be used together for flexible synchronization with a moving target position. After MC_Track Conveyor Belt. Active is set to TRUE, Initial Object Pos and the distance to Master Ref Pos are appended to the next call to MC_Move Path. MC_Track Conveyor Belt. In Sync = TRUE and MC_Move Path. Done = TRUE indicate that the synchronized position has been reached. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If BUSY becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Command Aborted or Error is set. Active BOOL If Active is TRUE, the function block controls the group. Command Abor BOOL This output becomes TRUE if the command was interrupted by another ted command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4022.25 PC or CX (x64) Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack Tc2_MC2 V3.1.6.03 7.1.1.1.12 MC_Ungroup All Axes MC_Ungroup All Axes Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) 58 Version: 1.15.0 TF5420
## Page 59

PLC Libraries The function block MC_Ungroup All Axes removes all axes and disables the group. If the function block succeeds, the group is then in group state Group Disabled (see State diagrams). Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.1.13 UDINT_TO_IDENTINGROUP TF5420 Version: 1.15.0 59
## Page 60

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The function UDINT_TO_IDENTINGROUP is a conversion function, which converts an integer value to IDENT_IN_GROUP_REF. It is required to add a PTP axis without spatial interpretation to a CA-Group. This conversion function returns a valid input for MC_Add Axis To Group [} 40] and MC_Remove Axis From Group [} 51]. For axes intended for multi-dimensional movement (TF5420) see IDENT_IN_GROUP_REF [} 76]. Use of integer values for the input Ident In Group The use of integer values for the input Ident In Group is NOT supported and may lead to incompatibility with future releases. If integer values are used, it may no longer be possible to build the project. We recommend using global variables [} 76] (e.g. MCS_X) or the conversion function UDINT_TO_IDENTINGROUP [} 59]. Return value Name Type Description UDINT_TO_IDENTINGROUP IDENT_IN_GROUP_REF [} 76] Converts an integer value, so a PTP axis can be added to a motion group. Inputs VAR_INPUT id : UDINT; END_VAR Name Type Description id UDINT The unique identifier an axis shall have in the group. This does not have to be the axis ID from the cyclic axis interface. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.2 Motion 7.1.1.2.1 MC_Group Halt MC_Group Halt Execute BOOL BOOL Done Deceleration MC_LREAL BOOL Busy Jerk MC_LREAL BOOL Active ↔ Axes Group Reference To AXES_GROUP_REFBOOL Command Aborted BOOL Error UDINT Error Id 60 Version: 1.15.0 TF5420
## Page 61

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The MC_Group Halt function block stops a group with a defined deceleration ramp. Unlike "MC_Group Stop [} 62]", the group is not locked for further motion commands. Therefore, the group can be restarted by another command during the deceleration ramp or after stopping. WARNING Possible delayed axis stop If Standby Gap Control is active with a CA group and the gap is also less than the minimum, the gap is first extended before the axes can be stopped with an MC_Group Halt. • Make sure that you actually need the behavior of Standby Gap Control; if not, consider disabling it (default setting). • Use an MC_Group Stop instead of an MC_Group Halt if the axes need to be stopped without a delay. NOTICE MC_Group Halt not implemented for MC group with pick-and-place The MC_Group Halt function block is only implemented for the MC Group Coordinated Motion and for PTP movements with Collision Avoidance (CA group). When used with another group type, the command is rejected. Applies to the MC_Group: MC_Group Halt cancels the active coordinate transformation and deletes all jobs in the queue. Inputs VAR_INPUT Execute : BOOL; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Deceleratio MC_LREA [mm/s²]. The deceleration can be programmed as a scalar value (≥1), or "Special n L input values [} 98]" can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. Jerk MC_LREA [mm/s³]. The jerk can be programmed as a scalar value (≥100), or "Special input L values [} 98]" can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. MC_IGNORE executes the command with unlimited jerk. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF TF5420 Version: 1.15.0 61
## Page 62

PLC Libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL Becomes TRUE when the group has been stopped and has come to a standstill. Once the group has come to a standstill, the group state becomes Group Standby (see State diagrams). Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Active BOOL Active indicates that the command is being executed. If the command was in the queue, it becomes active as soon as an executed command is completed. Command Aborted BOOL This output becomes TRUE if the command was interrupted by another command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.2.2 MC_Group Stop MC_Group Stop Execute BOOL BOOL Done Deceleration MC_LREAL BOOL Busy Jerk MC_LREAL BOOL Active ↔ Axes Group Reference To AXES_GROUP_REFBOOL Command Aborted BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) 62 Version: 1.15.0 TF5420
## Page 63

PLC Libraries The function block MC_Group Stop stops the group and all associated axes with a defined deceleration ramp and locks the axis for motion commands. While the group is in the Group Stopping state, no other function block can move an axis of the group (see State diagrams). The group can only be moved again once the signal Execute has been set to FALSE after the velocity is 0. MC_Group Stop cancels the active coordinate transformation and deletes all jobs in the queue. Inputs VAR_INPUT Execute : BOOL; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Deceleration MC_LREAL [mm/s²]. The deceleration can be programmed as a scalar value (≥1), or "Special input values [} 98]" can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. Jerk MC_LREAL [mm/s³]. The jerk can be programmed as a scalar value (≥100), or "Special input values [} 98]" can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. MC_IGNORE executes the command with unlimited jerk. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL Becomes TRUE when the group has been stopped and has come to a standstill. The group remains in the Group Stopping state while Execute is TRUE, at least until the axes have come to a stop. The group is then in the Group Standby state (see State diagrams). Busy BOOL Becomes TRUE when the command is started with Execute and remains so as long as the command is executed. If Busy becomes FALSE again, the group is ready for a new command. After the group is stopped, Busy remains TRUE until the group is released with Execute=FALSE. Active BOOL Indicates that the function block controls the group. After the group is stopped, Active remains TRUE until the group is released with Execute=FALSE. TF5420 Version: 1.15.0 63
## Page 64

PLC Libraries Name Type Description Command Aborted BOOL The command is aborted by disabling MC_Power of at least one axis of the group or if the group is disabled during the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.2.3 MC_Move Linear Absolute Preparation MC_Move Linear Absolute Preparation Position Pointer To MC_LREAL BOOL Error Position Count UDINT UDINT Error Id Velocity MC_LREAL Acceleration MC_LREAL Deceleration MC_LREAL Jerk MC_LREAL Buffer Mode MC_BUFFER_MODE Transition Mode MC_TRANSITION_MODE Transition Parameter Pointer To MC_LREAL Transition Parameter Count UDINT Invoke Id UDINT Dynamic Constraints Reference To IPlc Dynamic Constraint ↔ Path Data Reference To MC_PATH_DATA_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Move Linear Absolute Preparation adds an absolute linear movement to the table of segments in the Path Data structure. After creating a table, it can be executed via MC_Move Path [} 70]. The function block MC_Move Linear Absolute Preparation can be called several times per cycle. A maximum of 30 entries are allowed per Path Data table. Inputs VAR_INPUT Position : POINTER TO LREAL; Position Count : UDINT; Velocity : MC_LREAL := MC_INVALID; Acceleration : MC_LREAL := MC_DEFAULT; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; Buffer Mode : MC_BUFFER_MODE := mc Aborting; Transition Mode : MC_TRANSITION_MODE := mc Trans Mode None; Transition Parameter : POINTER TO LREAL; Transition Parameter Count : UDINT; 64 Version: 1.15.0 TF5420
## Page 65

PLC Libraries Invoke Id : UDINT; Dynamic Constraints : REFERENCE TO IPlc Dynamic Constraint := 0; END_VAR Name Type Description Position POINTER TO Pointer to an array [1.. Position Count] of the target position vector. LREAL Position Count UDINT Dimension of the position vector. Must match the number of axes in the axis convention (see MC Group Coordinated Motion or MC Group with Pick-and-Place). Velocity MC_LREAL The maximum velocity for the programmed segment. The velocity does not always have to be reached. The velocity must be set >0. Acceleration MC_LREAL Maximum path acceleration for the programmed segment. Special input values [} 98] can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. The acceleration must be set ≥1. Deceleration MC_LREAL Maximum path deceleration for the programmed segment. Special input values [} 98] can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. The deceleration must be set ≥1. Jerk MC_LREAL Path jerk for the programmed segment. Special input values [} 98] can be used. MC_DEFAULT executes the command with default axis values. The jerk must be set ≥100. From TF5400 V3.2.27: MC_MAXIMUM is supported for MC Group Coordinated Motion. Here MC_MAXIMUM = 100 * MC_DEFAULT. Buffer Mode MC_BUFFER_M Defines how successive motion commands are to be processed (see ODE MC_BUFFER_MODE [} 86]). Transition mode MC_TRANSITIO Defines the blending mode (see MC_TRANSITION_MODE [} 83]). N_MODE Transition Parame POINTER TO Pointer to array [1.. Transition Parameter Count] of blending parameters. ter LREAL Transition parameters define the blending from the last programmed position (see MC_TRANSITION_MODE [} 83]). Transition Parame UDINT Number of blending parameters (see MC_TRANSITION_MODE [} 83]). ter Count Invoke Id UDINT Segment ID for analysis purposes. Dynamic Constrai REFERENCE From TF5400 V3.2.27, MC Group Coordinated Motion: nts TO Optional input to further limit the allowed values for velocity, IPlc Dynamic Cons acceleration, deceleration or jerk during motion. traint Notice Reference assignment: <Instance Of MC_Move Linear Absolute Preparation>. Dynamic Constraints REF= <Instance Of IPlc Dynamic Constraint>; Inputs/outputs VAR_IN_OUT Path Data : MC_PATH_DATA_REF; END_VAR Name Type Description Path Data MC_PATH_DATA_RE Table containing the segments of a path. The table is written by F MC_Move…Preparation and executed by MC_Move Path [} 70] (see MC_PATH_DATA_REF [} 82]). TF5420 Version: 1.15.0 65
## Page 66

PLC Libraries Resetting a table A table is not reset during execution. To reset, the method Clear Path() must be called from MC_PATH_DATA_REF. Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.2.4 MC_Move Circular Absolute Preparation MC_Move Circular Absolute Preparation Circ Mode MC_CIRC_MODE BOOL Error Aux Point Pointer To MC_LREAL UDINT Error Id Aux Point Count UDINT End Point Pointer To MC_LREAL End Point Count UDINT Path Choice MC_CIRC_PATHCHOICE Velocity MC_LREAL Acceleration MC_LREAL Deceleration MC_LREAL Jerk MC_LREAL Buffer Mode MC_BUFFER_MODE Transition Mode MC_TRANSITION_MODE Transition Parameter Pointer To MC_LREAL Transition Parameter Count UDINT Invoke Id UDINT Dynamic Constraints Reference To IPlc Dynamic Constraint ↔ Path Data Reference To MC_PATH_DATA_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) 66 Version: 1.15.0 TF5420
## Page 67

PLC Libraries The MC_Move Circular Absolute Preparation function block adds an absolute circular motion to the table of segments in the MC_PATH_DATA_REF [} 82] structure. After creating a table, it can be executed via MC_Move Path [} 70]. The function block MC_Move Circular Absolute Preparation can be called several times per cycle. A maximum of 30 entries are permitted per MC_Path_DATA_REF table. Resetting a table A table is not reset during execution. To reset, the Clear Path [} 83] method must be called from MC_PATH_DATA_REF [} 82]. Inputs VAR_INPUT Circ Mode : MC_CIRC_MODE := mc Circ Mode Invalid; Aux Point : POINTER TO MC_LREAL; Aux Point Count : UDINT; End Point : POINTER TO MC_LREAL; End Point Count : UDINT; Path Choice : MC_CIRC_PATHCHOICE := mc Circ Pathchoice Counter Clockwise; Velocity : MC_LREAL := MC_INVALID; Acceleration : MC_LREAL := MC_DEFAULT; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; Buffer Mode : MC_BUFFER_MODE := mc Aborting; Transition Mode : MC_TRANSITION_MODE := mc Trans Mode None; Transition Parameter : POINTER TO MC_LREAL; Transition Parameter Count : UDINT; Invoke Id : UDINT; Dynamic Constraints : REFERENCE TO IPlc Dynamic Constraint := 0; END_VAR Name Type Description Circ Mode MC_CIRC_MOD Specifies which circle definition is used to program the circle. Specifies E the meaning of the "Aux Point" input signal (see MC_CIRC_MODE [} 77]). Aux Point POINTER TO Pointer to an array [1.. Aux Point Count] of the Aux Point vector. The MC_LREAL interpretation of the Aux Point vector depends on the spatial axes convention (see MC Group Coordinated Motion). Aux Point Count UDINT Dimension of the Aux Point vector. End Point POINTER TO Pointer to an array [1.. End Point Count] of the target position vector. MC_LREAL End Point Count UDINT Dimension of the End Point vector. Must match the number of axes in the axis convention (see MC Group Coordinated Motion or MC Group with Pick-and-Place). Path Choice MC_CIRC_PATH Defines the direction of rotation with respect to the normal vector. The CHOICE input is ignored if the input Circ Mode is set to mc Circ Mode Border (see MC_CIRC_PATHCHOICE [} 81]). Velocity MC_LREAL The maximum velocity for the programmed segment. The velocity does not always have to be reached. The velocity must be set >0. Acceleration MC_LREAL Maximum path acceleration for the programmed segment. Special input values [} 98] can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. The acceleration must be set ≥1. Deceleration MC_LREAL Maximum path deceleration for the programmed segment. Special input values [} 98] can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. The deceleration must be set ≥1. Jerk MC_LREAL Path jerk for the programmed segment. Special input values [} 98] can be used. MC_DEFAULT executes the command with default axis values. The jerk must be set ≥100. TF5420 Version: 1.15.0 67
## Page 68

PLC Libraries Name Type Description From TF5400 V3.2.27: MC_MAXIMUM is supported for MC Group Coordinated Motion. Here MC_MAXIMUM = 100 * MC_DEFAULT. Buffer Mode MC_BUFFER_M Defines how successive motion commands are to be processed (see ODE MC_BUFFER_MODE [} 86]). Transition mode MC_TRANSITIO Defines the blending mode (see MC_TRANSITION_MODE [} 83]). N_MODE Transition Parame POINTER TO Pointer to array [1.. Transition Parameter Count] of blending parameters. ter MC_LREAL Transition parameters define the blending from the last programmed position (see MC_TRANSITION_MODE [} 83]). Transition Parame UDINT Number of blending parameters. ter Count Invoke Id UDINT Segment ID for analysis purposes. Dynamic Contraint REFERENCE From TF5400 V3.2.27, MC Group Coordinated Motion: s TO Optional input to further limit the allowed values for velocity, IPlc Dynamic Cons acceleration, deceleration or jerk during motion. traint Notice Reference assignment: <Instance Of MC_Move Circular Absolute Preparation>. Dynam ic Constraints REF= <Instance Of IPlc Dynamic Constraint>; Inputs/outputs VAR_IN_OUT Path Data : MC_PATH_DATA_REF; END_VAR Name Type Description Path Data MC_PATH_DAT Table containing the segments of a path. The table is written by A_REF MC_Move…Preparation and executed by MC_Move Path [} 70] (see MC_PATH_DATA_REF [} 82]). Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Sample of center point programming Assuming a path consisting of 4 segments as shown in the figure is to be programmed in mc Circ Mode Center mode: the user defines the center of the circle as an auxiliary point ("Aux Point"). When using mc Circ Mode Center, the input MC_CIRC_PATHCHOICE [} 81] determines the direction of rotation. Since the plane is defined by the cross product, mc Circ Pathchoice Counter Clockwise must be selected for both circle segments N20 and N30. 68 Version: 1.15.0 TF5420
## Page 69

PLC Libraries VAR Buffer : ARRAY[1..4096] OF BYTE; Path : MC_PATH_DATA_REF (ADR(buffer), SIZEOF(buffer)); fb Move Lin Prep : MC_Move Linear Absolute Preparation; fb Move Circ Prep : MC_Move Circular Absolute Preparation; a Target Pos : ARRAY[1..c Axes Count] OF MC_LREAL; a Circ Pos : ARRAY[1..c Axes Count] OF MC_LREAL; a Aux Point : ARRAY[1..3] OF MC_LREAL; a Transition Param : ARRAY[1..2] OF MC_LREAL; END_VAR VAR CONSTANT c Axes Count : UINT:=3; END_VAR fb Move Lin Prep. Position := ADR(a Target Pos); fb Move Lin Prep. Position Count := c Axes Count; fb Move Lin Prep. Transition Parameter := ADR(a Transition Param); fb Move Lin Prep. Transition Parameter Count := 2; fb Move Lin Prep. Buffer Mode := mc Buffered; fb Move Lin Prep. Transition Mode := mc Trans Mode None; fb Move Circ Prep. End Point := ADR(a Target Pos); fb Move Circ Prep. End Point Count := c Axes Count; fb Move Circ Prep. Aux Point := ADR(a Aux Point); fb Move Circ Prep. Aux Point Count := 3; fb Move Circ Prep. Circ Mode := mc Circ Mode Center; fb Move Circ Prep. Transition Parameter := ADR(a Transition Param); fb Move Circ Prep. Transition Parameter Count := 2; fb Move Circ Prep. Buffer Mode := mc Buffered; fb Move Circ Prep. Transition Mode := mc Trans Mode None; a Target Pos[1] := 200; a Target Pos[2] := 0; a Target Pos[3] := 0; a Transition Param[1] := 0; a Transition Param[2] := 0; fb Move Lin Prep(Path Data:= path, Velocity:= 3000, Invoke Id:= 10); a Target Pos[1] := 300; a Target Pos[2] := -100; a Target Pos[3] := 0; a Aux Point[1] := 200; a Aux Point[2] := -100; a Aux Point[3] := 0; a Transition Param[1] := 0; a Transition Param[2] := 0; fb Move Circ Prep(Path Data:= path, Path Choice:= mc Circ Pathchoice Clockwise, Velocity:= 1000, Invoke I d:= 20); a Target Pos[1] := 400; a Target Pos[2] := -200; a Target Pos[3] := 0; a Aux Point[1] := 400; a Aux Point[2] := -100; a Aux Point[3] := 0; a Transition Param[1] := 0; a Transition Param[2] := 0; fb Move Circ Prep(Path Data:= path, Path Choice:= mc Circ Pathchoice Counter Clockwise, Velocity:= 1000, TF5420 Version: 1.15.0 69
## Page 70

PLC Libraries Invoke Id:= 30); a Target Pos[1] := 600; a Target Pos[2] := -200; a Target Pos[3] := 100; a Transition Param[1] := 0; a Transition Param[2] := 0; fb Move Lin Prep(Path Data:= path, Velocity:= 3000, Invoke Id:= 40); Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or Tc3_Mc Coordinated Motion, CX (x64) Tc2_MC2 TF5400 Advanced Motion Pack V3.1.2.47 7.1.1.2.5 MC_Move Path MC_Move Path Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy ↔ Path Data Reference To MC_PATH_DATA_REF BOOL Active BOOL Command Aborted BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Move Path executes a movement defined in the Path Data table by MC_Move Linear Absolute Preparation [} 64], MC_Move Circular Absolute Preparation [} 66], MC_Blocker Preparation [} 71] and MC_Set Coordinate Transform Preparation [} 54]. Re-triggering of an FB instance during motion It is possible to execute different motion commands with one instance of this function block. However, the outputs of the function block only indicate the last command executed. The user loses the ability to diagnose for the previously sent motion commands. Re-triggering of a function block is therefore not recommended. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; Path Data : MC_PATH_DATA_REF; END_VAR 70 Version: 1.15.0 TF5420
## Page 71

PLC Libraries Name Type Description Axes Group AXES_GROUP Reference to a group of axes (see Cyclic group interface [} 96]). _REF Path Data MC_PATH_DAT Table containing the segments of a path. The table is written by A_REF [} 82] MC_Move Linear Absolute Preparation [} 64], MC_Move Circular Absolute Preparation [} 66], MC_Blocker Preparation [} 71] and MC_Set Coordinate Transform Preparation [} 54] and executed by MC_Move Path [} 70]. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. This means that the last command defined by the reference variable Path Data was executed successfully. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Active BOOL If Active is TRUE, the FB controls the axis. Command A BOOL This output becomes TRUE if the command was interrupted by another borted command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.1.2.6 MC_Blocker Preparation MC_Blocker Preparation Blocker Id UDINT BOOL Error Buffer Mode MC_BUFFER_MODE UDINT Error Id Invoke Id UDINT ↔ Path Data Reference To MC_PATH_DATA_REF TF5420 Version: 1.15.0 71
## Page 72

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The function block MC_Blocker Preparation appends a blocking job to the list of segments in the Path Data structure. The Path Data table can be executed via MC_Move Path. The function block MC_Blocker Preparation can be called several times per cycle. A maximum of 30 entries are allowed per Path Data table. A blocking job is an entry that suspends execution of the path until it is resolved with MC_Release Blocker [} 73]. As long as the blocker is not resolved, the execution of the path is stopped at this segment. Each blocker has an Id so that the individual blockers can be distinguished in the PLC. When a blocking job is active, the group status is still "moving". If the override is changed while the blocking job is active, it will take effect for the next moving job. If a new job with Buffer Mode mc Aborting is executed while the blocking job is active, the blocking job is aborted. If MC_Group Halt [} 60] or MC_Group Stop [} 62] are executed while the blocking job is active, the path is terminated and the blocking job is automatically released. Inputs VAR_INPUT Blocker Id : UDINT; Buffer Mode : MC_BUFFER_MODE := mc Buffered; Invoke Id : UDINT; END_VAR Name Type Description Blocker Id UDINT Id of the blocker. Can be any UDINT >0. Buffer Mode MC_BUFFER_M Defines how successive motion commands are to be processed (see ODE MC_BUFFER_MODE [} 86]). Only mc Buffered and mc Aborting are allowed here. Invoke Id UDINT Segment ID for analysis purposes. Inputs/outputs VAR_IN_OUT Path Data : MC_PATH_DATA_REF; END_VAR Name Type Description Path Data MC_PATH_DAT Table containing the segments of a path. The table is written by the A_REF Preparation function blocks, like this one, and executed by MC_Move Path (see MC_PATH_DATA_REF). Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. 72 Version: 1.15.0 TF5420
## Page 73

PLC Libraries Name Type Description Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 7.1.1.2.7 MC_Release Blocker MC_Release Blocker Execute BOOL BOOL Done Blocker Id UDINT BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The function block MC_Release Blocker releases a blocking job that blocks further execution of the path. A blocking job is inserted into the path with MC_Blocker Preparation [} 71]. With the Superpos blending strategy or, from TF5400 3.1.10.63, also with the Geo Blending strategy, the blocker can be resolved before the blocker position is reached. Blending between motion segments surrounding this blocker can be executed if those segments allow it and are still executable at the time the blocking job is released. Inputs VAR_INPUT Execute : BOOL; Blocker Id : UDINT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Blocker Id UDINT Id of the blocker. Can be any UDINT >0. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Group AXES_GROUP_ Reference to an axis group (see Cyclic Group Interface [} 96]). REF TF5420 Version: 1.15.0 73
## Page 74

PLC Libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 7.1.1.2.8 MC_Group Read Blocker Status MC_Group Read Blocker Status Enable BOOL BOOL Valid ↔ Axes Group Reference To AXES_GROUP_REF BOOL Blocked UDINT Blocker Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The function block MC_Group Read Blocker Status reads the current blocker status. Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL Enables reading of the current blocker status. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR 74 Version: 1.15.0 TF5420
## Page 75

PLC Libraries Name Type Description Axes Gro AXES_GROU Reference to an axis group (see Cyclic Group Interface [} 96]). up P_REF Outputs VAR_OUTPUT Valid : BOOL; Blocked : BOOL; Blocker Id : UDINT; END_VAR Name Type Description Valid BOOL Returns TRUE if a valid group type is used. Only group type MC Group Coordinated Motion is allowed. Blocked BOOL Returns TRUE if a blocking job is active, i.e. execution of the path is stopped. Returns FALSE if no blocking job is active. Blocker I UDINT Id of the blocker. Can be any UDINT >0. d Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 7.1.1.2.9 MC_Dwell Time Preparation MC_Dwell Time Preparation Dwell Time TIME BOOL Error Buffer Mode MC_BUFFER_MODE UDINT Error Id Invoke Id UDINT ↔ Path Data Reference To MC_PATH_DATA_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The function block MC_Dwell Time Preparation appends a standstill job with a defined time to the table of segments in the Path Data structure. The Path Data table can be executed via MC_Move Path. The function block MC_Dwell Time Preparation can be called several times per cycle. Inputs VAR_INPUT Dwell Time : Time; Buffer Mode : MC_BUFFER_MODE := mc Buffered; Invoke Id : UDINT; END_VAR Name Type Description Dwell Time Time Time during which the path is stationary at velocity 0. Any timespan >= 0 is allowed. A Dwell Time of zero leads to an exact stop, even if the surrounding segments would allow a transition with a velocity > 0. TF5420 Version: 1.15.0 75
## Page 76

PLC Libraries Name Type Description Buffer Mode MC_BUFFER_MODE Defines how successive motion commands are to be processed (see MC_BUFFER_MODE [} 86]). Only mc Buffered and mc Aborting are allowed here. Invoke Id UDINT Segment ID for analysis purposes. Inputs/outputs VAR_IN_OUT Path Data : MC_PATH_DATA_REF; END_VAR Name Type Description Path Data MC_PATH_DATA_REF Table containing the segments of a path. The table is written by the Preparation function blocks, like this one, and executed by MC_Move Path (see MC_PATH_DATA_REF). Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 7.1.2 Datatypes 7.1.2.1 IDENT_IN_GROUP_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion IDENT_IN_GROUP_REF defines how an axis is interpreted in a group. Global variables can be used for multi-dimensional movements. For PTP collision-avoidance groups, the UDINT_TO_IDENTINGROUP [} 59] function must be called. Use of integer values for the input Ident In Group The use of integer values for the input Ident In Group is NOT supported and may lead to incompatibility with future releases. If integer values are used, it may no longer be possible to build the project. We recommend using global variables [} 76] (e.g. MCS_X) or the conversion function UDINT_TO_IDENTINGROUP [} 59]. 76 Version: 1.15.0 TF5420
## Page 77

PLC Libraries The constants below define axes as Cartesian axes in the machine coordinate system (MCS). A to C define the rotation axis (C: rotation around Z; B: rotation around Y; A: rotation around X). The number determines the rotation order. For example, if one axis is defined as MCS_C1 and another as MCS_B2, the system will first rotate around the Z-axis and second around the Y-axis VAR_GLOBAL MCS_X : IDENT_IN_GROUP_REF; MCS_Y : IDENT_IN_GROUP_REF; MCS_Z : IDENT_IN_GROUP_REF; MCS_A1 : IDENT_IN_GROUP_REF; MCS_A2 : IDENT_IN_GROUP_REF; MCS_A3 : IDENT_IN_GROUP_REF; MCS_B1 : IDENT_IN_GROUP_REF; MCS_B2 : IDENT_IN_GROUP_REF; MCS_B3 : IDENT_IN_GROUP_REF; MCS_C1 : IDENT_IN_GROUP_REF; MCS_C2 : IDENT_IN_GROUP_REF; MCS_C3 : IDENT_IN_GROUP_REF; //new from TF5400 V3.1.10.1, only compatible with MC Group Coordinated Motion ADDAX1 : IDENT_IN_GROUP_REF; ADDAX2 : IDENT_IN_GROUP_REF; ADDAX3 : IDENT_IN_GROUP_REF; ADDAX4 : IDENT_IN_GROUP_REF; // new from TF5400 V3.2.27, only compatible with MC Group ADDAX5 : IDENT_IN_GROUP_REF; ADDAX6 : IDENT_IN_GROUP_REF; ADDAX7 : IDENT_IN_GROUP_REF; ADDAX8 : IDENT_IN_GROUP_REF; END_VAR Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.2.2 MC_CIRC_MODE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The circle mode determines which circle definition is used to program a circle. TYPE MC_CIRC_MODE : ( mc Circ Mode Invalid := 16#0000, mc Circ Mode Border := 16#2000, mc Circ Mode Center := 16#2001, mc Circ Mode Radius := 16#2002 ) END_TYPE mc Circ Mode Invalid Returns errors • This parameter is invalid and will lead to an error where a valid MC_CIRC_MODE argument is required. TF5420 Version: 1.15.0 77
## Page 78

PLC Libraries mc Circ Mode Border Start Point • The movement starts at the starting point “Start Point”. • This point is the endpoint of the preceding move command. End Point • The user configures the endpoint “End Point”. • The circular movement will end at this point. Aux Point • The user configures the auxiliary point "Aux Point". • The circular movement will pass through this point. Path Choice • The input parameter "Path Choice" and the data type "MC_CIRC_PATHCHOICE" are ignored. Applicability • The mode mc Circ Mode Border cannot be used to describe a full circle (i.e. "Start Point" equals "End Point"). This is due to the fact that in this the center point of the circle would be ambiguous. • The mode mc Circ Mode Border cannot be used to describe paths with more than one full rotation of the circle. 78 Version: 1.15.0 TF5420
## Page 79

PLC Libraries mc Circ Mode Center Start Point • The movement starts at the starting point “Start Point”. • This point is the endpoint of the preceding move command. End Point • The user configures the endpoint “End Point”. • The circular movement will end at this point. Aux Point • The user configures the auxiliary point "Aux Point". • For the circular movement this auxiliary point will act as the circle center point. • The center point is required to have the same distance from “Start Point” and “End Point”. If the distances differ only slightly, the center point will be adjusted. If the distances differ significantly, the circle description will not be accepted. Path Choice • There are usually two possible arcs of the circle that can be traversed from starting point "Start Point" to the endpoint "End Point". The “Path Choice” parameter makes the two unique. See MC_CIRC_PATHCHOICE for more information. Applicability • The mode mc Circ Mode Center cannot be used to describe a semicircle (i.e. an arc that traverses an angle of 180° or very close to that) or a full circle (i.e. "Start Point" equals "End Point"). This is due to the fact that in these cases starting point, center point and endpoint would be collinear and thus the plane in which the circle lies would be ambiguous. • The mode mc Circ Mode Center cannot be used to describe paths with more than one full rotation of the circle. TF5420 Version: 1.15.0 79
## Page 80

PLC Libraries mc Circ Mode Radius MC_CIRC_PATHCHOn ICE E Clockwise 1 4 Counterclockwise 3 2 1 2 3 4 Short segment 3 2 Long segment 4 1 S E=End Point S=Start Point Images • Four different arcs are distinguished by the orientation of the normal vector and the parameter “Path Choice”. Start Point • The movement starts at the starting point “Start Point”. • This point is the endpoint of the preceding move command. • The circle to be constructed and its plane contain the starting point. Aux Point • The user configures the parameter "Aux Point", which in this mode acts as the normal vector of the plane of the circle. Its length is taken as the radius of the circle. Normal Vector 80 Version: 1.15.0 TF5420
## Page 81

PLC Libraries End Point • The user configures the endpoint “End Point”. • The movement will end at this point. • MC group with pick-and-place only: If this point is outside the plane defined by “Start Point” and the normal vector, movement will follow a helix instead of a circle. Path Choice and • The right-hand rule is applied for all “Path Choice” values except resulting arc mc Circ Pathchoice Clockwise, which follows the left-hand rule. • mc Circ Pathchoice Counter Clockwise and mc Circ Pathchoice Short Segment describe an arc that covers an angle <= 180°, mc Circ Pathchoice Clockwise and mc Circ Pathchoice Long Segment describe an arc that covers an angle >= 180°. • Which of the 4 possible arcs with a given radius is chosen depends on the “Path Choice” argument and the orientation of the normal vector. See above table for more information. Applicability • The mode mc Circ Mode Radius can only be used to describe arcs that cover an angle < 360°. • The length of the normal vector (i.e. the radius of the circle) must be at least half the distance between starting point and endpoint. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or Tc3_Mc Coordinated Motion, CX (x64) Tc2_MC2 TF5400 Advanced Motion Pack V3.1.2.47 7.1.2.3 MC_CIRC_PATHCHOICE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The MC_CIRC_PATHCHOICE data type defines the direction of rotation of a circle if mc Circ Mode Center or mc Circ Mode Radius is selected from the enumeration MC_CIRC_MODE [} 77]. TYPE MC_CIRC_PATHCHOICE : ( mc Circ Pathchoice Clockwise := 16#3000, mc Circ Pathchoice Counter Clockwise := 16#3001, //new from TF5400 V3.1.10.1 mc Circ Pathchoice Short Segment := 16#3002, mc Circ Pathchoice Long Segment := 16#3003 ); END_TYPE Name Type Description mc Circ Pathchoice Clockwise INT represents the circle segment with an angle >180°. mc Circ Pathchoice Counter Clockwise INT represents the circle segment with an angle <180°. mc Circ Pathchoice Short Segment INT represents the circle segment with the smaller angle. mc Circ Pathchoice Long Segment INT represents the circle segment with the larger angle. TF5420 Version: 1.15.0 81
## Page 82

PLC Libraries 7.1.2.4 MC_PATH_DATA_REF MC_PATH_DATA_REF UDINT Filled Rows UDINT Occupied Buffer TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) MC_PATH_DATA_REF represents the path to be executed by MC_Move Path [} 70], whereby the number of entries is limited to 30. The path to be executed is written by MC_Move Linear Absolute Preparation [} 64], MC_Move Circular Absolute Preparation [} 66] and MC_Blocker Preparation [} 71]. It is initialized with a pointer to a user-defined buffer. Hereby the user can define the size of the path. The initialization has to be done during declaration. The path table is not reset at execution. To reset, the method Clear Path [} 83] must be called. Outputs VAR_OUTPUT Filled Rows : UDINT; Occupied Buffer : UDINT; END_VAR Name Type Description Filled Rows UDIN Number of path entries (e.g. path segments). T Occupied Buffer UDIN Occupied buffer size in byte. By analyzing this output the user can analyze if the T end of the defined buffer will be reached. Sample The sample below shows how to declare a path reference and how to reset an existing path. VAR buffer : ARRAY[1..4096] OF BYTE; Path : MC_PATH_DATA_REF(ADR(buffer), SIZEOF(buffer)); END_VAR //delete all segments of path table Path. Clear Path(); The data type MC_PATH_DATA_REF is part of the Motion Control (MC) library. Use the method Clear Path() to clear path information of type MC_PATH_DATA_REF and thus to reset an existing path. Use only Motion Control functions or Motion Control function blocks on the data type MC_PATH_DATA_REF. In particular, do not use any storage functions such as MEMCMP, MEMCPY, MEMSET or MEMMOVE with data type MC_PATH_DATA_REF. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 82 Version: 1.15.0 TF5420
## Page 83

PLC Libraries 7.1.2.4.1 Clear Path Clear Path TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The method Clear Path resets the path represented by MC_PATH_DATA_REF. The path table is not reset automatically at execution. 7.1.2.5 MC_TRANSITION_MODE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The transition mode characterizes the way a segment transition is executed. TYPE MC_TRANSITION_MODE : ( mc Trans Mode None := 16#1000, mc Trans Mode Start Velocity := 16#1001, mc Trans Mode Constant Velocity := 16#1002, mc Trans Mode Corner Distance := 16#1003, mc Trans Mode Max Corner Deviation := 16#1004, mc Trans Mode Corner Distance Advanced := 16#100A ); END_TYPE The following table shows an overview of the implemented transition modes and the number of parameters that must be defined in Transition Parameter Count. Name Transition Parameter Count Description mc Trans Mode None No effect No blending mc Trans Mode Corner Distance 1 Transition parameters act as a tolerance sphere in which the path not compatible with MC Group may be left. with Pick-and-Place, available from TF5400 V3.1.10.1 mc Trans Mode Corner Distance Ad 2 Transition parameters act as a vanced tolerance sphere in which the path may be left. mc Trans Mode None No blending is executed. Stop at segment transition. mc Trans Mode Corner Distance Blending is executed between the segments. The transition parameters act as tolerance ball in which the programmed path is not followed. The parameter describes the radius on the previous and second segment at which the blending starts and ends. TF5420 Version: 1.15.0 83
## Page 84

PLC Libraries This mode is only compatible with MC Group Coordinated Motion. mc Trans Mode Corner Distance Advanced Blending is executed between the segments. The transition parameter act as tolerance ball in which the programmed path is not followed. The first parameter describes the radius on the previous segment at which the blending starts (r_in). The second parameter describes the radius on the following segment (r_out) which defines a position for which it is guaranteed that the blending is done. The parameter r_out is a maximum value. The blending can end before r_out is reached. Blending (r_in) with MC Group with Pick-and-Place is limited to 90 % of previous segment. r_out is not limited. r_in (N20) r_in (N30) N20 r_out r_out (N30) (N20) N30 N10 Recommended Transition Parameter Relation for Blending with MC Group with Pick- and-Place The graphics sketch a planar movement within two dimensional space. Let two axes be involved in this movement. Assuming that the involved axes exhibit similar dynamics r_out should measure at least 2 * r_in. Combinations of buffer mode and transition mode Buffer mode and transition mode are combined only when TF5420 is used. The following table shows the possible combinations of transition mode and buffer mode and their effect. 84 Version: 1.15.0 TF5420
## Page 85

PLC Libraries TM/PM mc Aborting mc Buffered mc Blending Previ- Others ous mc Trans Mode None The previous Stop at the end of Not permissible Not permissible command is the previous canceled command. The next immediately. A new command is then movement is started. executed. The velocity in transition is 0. This combination is only permitted for the first segment of a path. mc Trans Mode Corn Blending from the Not permissible Blending from the Not permissible er Distance active segment to last programmed the first segment of command to the new New from TF5400 the new command. command V3.1.10.1, only The intersection of compatible with the segments is MC Group defined by the Coordinated distance needed to Motion stop on the active segment. This combination is only permitted for the first segment of a path. mc Trans Mode Corn Blending from the Not permissible Blending from the Not permissible er Distance Advance active segment to last programmed d the first segment of command to the new the new command. command The intersection of the segments is defined by the distance needed to stop on the active segment. This combination is only permitted for the first segment of a path. Others Not permissible Not permissible Not permissible Not permissible Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.1.2.6 MC_COORD_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) Object Id that refers to a node connector. TF5420 Version: 1.15.0 85
## Page 86

PLC Libraries 7.2 Tc3_Mc3Definitions Structures and enumerations Name Description TF5420 Twin CAT 3 Motion Pick- and-Place TF5410 Twin- MC Group MC Group CAT 3 Motion with Pick- Coordi- Collision and-Place nated Mo- Avoidance tion MC_BUFFER_MODE Defines how successive travel commands are to be processed. [} 86] MC_COMPENSATION_T The value defines the compensation type. YPE [} 89] MC_DIRECTION [} 90] The value determines the direction of the movement. MC_SYNC_MODE The value defines the direction in which synchronization is to be [} 91] performed. MC_SYNC_STRATEGY Defines the synchronization profile of the slave axis. [} 91] 7.2.1 Datatypes 7.2.1.1 MC_BUFFER_MODE The data type MC_BUFFER_MODE is used to specify how successive travel commands are to be processed. At least two function blocks are required for buffer mode to have an effect. TYPE MC_BUFFER_MODE : ( mc Aborting := 16#0, mc Buffered := 16#1, mc Blending Low := 16#12, mc Blending Previous := 16#13, mc Blending Next := 16#14, mc Blending High := 16#15 ) UINT; END_TYPE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion Example: In the following example, a move command is used to move a group from position P to P and then to P . 0 1 2 The reference point for the different velocity profiles is always P . The mode specifies the velocity v or v at 1 1 2 this point. 86 Version: 1.15.0 TF5420
## Page 87

PLC Libraries Since the speed of the first command is lower than the second, the modes Blending Low/Blending Previous and Blending High/Blending Next have the same result. If the speed of the second command is lower than the first the modes Blending Low/Blending Next and Blending High/Blending Previous are equivalent. TF5420 Version: 1.15.0 87
## Page 88

PLC Libraries Combinations of buffer mode and transition mode Notice Buffer mode and transition mode are merely combined using TF5420. The following table shows possible combinations of transition mode and buffer mode and its effect. 88 Version: 1.15.0 TF5420
## Page 89

PLC Libraries TM/BM mc Aborting mc Buffered mc Blending Previ- Other ous mc Trans Mode None Previous command Stop at the end of Not allowed Not allowed is aborted previous command. immediately. New Subsequently next movement is started. command is Velocity in transition executed. is 0. This combination is only allowed for the 1st segment of a path. mc Trans Mode Corn Blending from active Not allowed Blending from last Not allowed er Distance segment to first programmed segment of new command to new new from V3.1.10.1, command. The command only compatible intersection point of with MC Group the segments is Coordinated defined by the Motion distance needed to stop on the active segment. This combination is only allowed for the 1st segment of a path. mc Trans Mode Corn Blending from active Not allowed Blending from last Not allowed er Distance Advance segment to first programmed d segment of new command to new command. The command intersection point of the segments is defined by the distance needed to stop on the active segment. This combination is only allowed for the 1st segment of a path. Other Not allowed Not allowed Not allowed Not allowed Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 7.2.1.2 MC_COMPENSATION_TYPE The data type MC_COMPENSATION_TYPE is used to specify which compensation type is to be used. TYPE MC_COMPENSATION_TYPE: ( mc Type Invalid Compensation := 16#0, mc Type Geo Compensation := 16#1 )UINT; END_TYPE TF5420 Version: 1.15.0 89
## Page 90

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Compensations TF5400 Advanced Motion Pack V3.1.6.07 7.2.1.3 MC_DIRECTION (* Defines the direction of the movement (e.g. for a modulo axis). *) TYPE MC_DIRECTION : ( mc Direction Non Modulo := 0, (* Position is interpreted as absolute position. *) mc Direction Positive := 1, (* Moves in positive direction. *) mc Direction Shortest Way := 2, (* The direction of movement depends on whether the positive direction of movement or the negative direction of movement is the shortest distance from the target position. *) mc Direction Negative := 3 (* Moves in negative direction. *) ) END_TYPE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion MC_DIRECTION is used to specify the direction of movement during modulo positioning. Modulo positioning is only applicable to periodic systems. For open systems such as open tracks, only the value mc Direction Non Modulo is accepted. mc Direction Non Modulo: The position is always interpreted as an absolute position. mc Direction Positive: Positive direction of movement mc Direction Negative: Negative direction of movement mc Direction Shortest Way: The direction of movement depends on whether the positive direction or the negative direction has the shortest distance to the target position. In combination with the Tc2_MC2 or Tc3_Mc3Definitions library it is possible that the data type cannot be resolved unambiguously (ambiguous use of name 'MC_Direction'). In this case the namespace must be specified when using the data type (Tc3_Mc3Planar Motion. MC_DIRECTION or Tc3_Mc3Definitions. MC_DIRECTION or Tc2_MC2. MC_DIRECTION). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or Tc3_Mc Collision Avoidance, CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 90 Version: 1.15.0 TF5420
## Page 91

PLC Libraries 7.2.1.4 MC_SYNC_MODE (* Defines the direction of the synchronization position of modulo axes. *) TYPE MC_SYNC_MODE : ( mc Sync Mode Non Modulo := 0, (* Sync Slave Position is interpreted as absolute position. *) mc Sync Mode Positive := 1, (* Synchronizes in positive direction. *) mc Sync Mode Negative := 3 (* Synchronizes in negative direction. *) ) END_TYPE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The value defines the direction in which synchronization is to be performed. The Sync Mode specification is only effective if a modulo coordinate system has been defined for the axis. This can be a closed XTS track or a closed CA group, for example. The value is ignored if there is only one mathematical solution for reaching the synchronous position. mc Sync Mode Non Modulo: The Slave Sync Position is always interpreted as an absolute position. mc Sync Mode Positive: The slave axis synchronizes itself in positive direction of movement. mc Sync Mode Negative: The slave axis synchronizes itself in negative direction of movement. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or Tc3_Mc Collision Avoidance, CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 7.2.1.5 MC_SYNC_STRATEGY The data type MC_SYNC_STRATEGY defines the synchronization profile of the slave for e.g. a MC_Gear In Pos CA command. TYPE MC_SYNC_STRATEGY : ( mc Sync Strategy Late := 16#1, mc Sync Strategy Slow := 16#2, mc Sync Strategy Early := 16#3 ) END_TYPE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion Examples: The boundary conditions in the following examples are equal: • The master motion is equal. • The Master Start Distance is equal. • The distances (Master Sync Position – current master position) and (Slave Sync Position – current slave position) are in all three examples equal. • The slave dynamics are equal. • Configuration with one axis in the CA Group, one PTP axis as master. TF5420 Version: 1.15.0 91
## Page 92

PLC Libraries • A motion command is issued to the master. Example 1: mc Sync Strategy Late The slave starts the synchronization as late as possible and with full dynamics (according to the input values velocity, acceleration, deceleration, jerk). It reaches the Slave Sync Position just in time with the correct gear ratio. The user has to take care that the master does not accelerate once the slave signals Start Sync, since the synchronization profile is already planned with the maximal slave dynamics. The slave cannot violate its dynamic restrictions and therefore cannot compensate any master acceleration. This situation will result in an error at the function block. 1. Issue the command MC_Gear In Pos CA to the axis. The command becomes active while the master is still accelerating. ð The slave starts synchronizing as late as possible and with full dynamics, and reached the Slave Sync Position when the master reached the Master Sync Position (black x-Cursor). Example 2: mc Sync Stratey Slow The slave starts its synchronization in motion as soon as the master passes (Master Sync Position - Master Start Distance) in the right direction if a Master Start Dist was set, otherwise as soon as the function block is Active. The dynamics of the slave are reduced so that the slave reaches the Slave Sync Pos with the right gear factor just in time when the master reaches the Master Sync Pos. The slave can compensate for an acceleration of the master if Start Sync is also set, but only until the slave reaches its maximum dynamics. 1. Issue the command MC_Gear In Pos CA to the axis. The command becomes active while the master is still accelerating. ð The slave starts synchronizing as soon as MC_Gear In Pos CA is Active. The dynamics is reduced such that the slave reaches the Slave Sync Position at the same time the master reaches the Master Sync Position (black x-Cursor). A synchronization on a standing master can lead to a high load if mc Sync Strategy Slow is used. It is best to use mc Sync Strategy Early in this case. 92 Version: 1.15.0 TF5420
## Page 93

PLC Libraries Example 3: mc Sync Strategy Early The slave starts synchronization immediately (if a Master Start Distance is set: immediately after it was passed) and with full dynamics. The slave signals earlier In Sync than demanded by the Slave Sync Position, but it is still guaranteed that demanded offset between master and slave (Master Sync Position – Slave Sync Position) is reached with the correct gear ratio. This strategy can synchronize on a standing master and is best suited if the master velocity is not constant. The slave will constantly try to synchronize. If the boundary conditions do not allow the slave to be In Sync at the Slave Sync Position, this will not result in an error but the slave constantly tries to synchronize to the master. 1. Issue the command MC_Gear In Pos CA to the axis. The command becomes active while the master is still accelerating. ð The slave starts the synchronization as soon as MC_Gear In Pos CA is Active and with full dynamics. The slave is In Sync as soon as possible, but still reaches the Slave Sync Position at the same time the master reaches the Master Sync Position (black x-Cursor). TF5420 Version: 1.15.0 93
## Page 94

PLC Libraries Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 94 Version: 1.15.0 TF5420
## Page 95

Samples 8 Samples Multi-dimensional motion Pnp Simple Sample Download: https://infosys.beckhoff.com/content/1033/TF5420_TC3_Advanced_Pick_And_Place/Resources/ 9725595531.zip Description: Project that executes a simple pick and place-movement. Pn PSimple Sample with an additional axis and blocking Download: https://infosys.beckhoff.com/content/1033/TF5420_TC3_Advanced_Pick_And_Place/Resources/ 9725597195.zip Description: Project that contains an additional axis and a blocking job. TF5420 Version: 1.15.0 95
## Page 96

Appendix 9 Appendix 9.1 Cyclic Group Interface The cyclic group interface provides the cyclical data exchange between PLC and a NC group object. The group interface contains the directions Nc To Plc [} 96] and Plc To Nc [} 97]. Both direction are divided in common and group specific data. AXES_GROUP_REF TYPE AXES_GROUP_REF : STRUCT Plc To Nc AT %Q* : CDT_PLCTOMC_GROUP; Nc To Plc AT %I* : CDT_MCTOPLC_GROUP; END_STRUCT END_TYPE Plc To Nc: Plc To Nc [} 97] is a data structure that is cyclically exchanged between PLC and NC. Via this data structure the MC function blocks communicate with the motion group and send control information from the PLC to the NC. This data structure is automatically placed in the output process image of the PLC and must be linked with the input process image of a motion group. Nc To Plc: Nc To Plc [} 96] is a data structure that is cyclically exchanged between PLC and NC. Via this data structure the MC function blocks communicate with the NC and receive status information from the NC. This data structure is automatically placed in the input process image of the PLC and must be linked in Twin CAT System Manager with the output process image of an NC axis. 9.1.1 Nc To Plc Data structure which is cyclically exchanged between NC and PLC. Some data is group-specific. Name Type Description Common Group OID OTCID Tc COM object ID (OID) of this group Group Type MC_GROUP_TYPE Type of group [} 99] Group Status ST_Group Status [} 100] Status information about the group State MC_GROUP_STATE State of the group, see Group State Diagram. [} 99] Flags ST_Group Status Flags Additional status information [} 100] Is Enable Requested BIT Defines whether enabling or disabling of a group is requested. All Axes Standing BIT Indicates whether all axes are physically stationary, i.e. the velocity and acceleration for all axes is zero, regardless of whether a motion command is active. In Position BIT Indicates whether the group is in position. Group Error Id UDINT Error code in the event of a group error Group Axes Count UDINT Number of axes that are currently part of this group (e.g. added via MC_Add Axis To Group). 96 Version: 1.15.0 TF5420
## Page 97

Appendix Name Type Description Act Override Factor LREAL Currently used override factor Path Velo LREAL Only MC Group Coordinated Motion: Absolute value of cartesian velocity on the path Invoke Id UDINT Only MC Group Coordinated Motion: Segment ID for analysis purposes Is In Blending Segment BIT Only MC Group Coordinated Motion: Indicates if a blending segment is active. Remaining Time Active Job LREAL Only MC Group Coordinated Motion: Remaining time of the current segment Remaining Cartesian Distance Active Job LREAL Only MC Group Coordinated Motion: Remaining distance for the current segment Active Blocker Id UDINT Only MC Group Coordinated Motion: Id of the active blocker. Remaining Time To Sync LREAL Only MC Group Coordinated Motion: Remaining time until the axis group is synchronized with the conveyor belt during conveyor tracking. Remaining Cartesian Time To Sync LREAL Only MC Group Coordinated Motion: Remaining distance until the axis group is synchronized with the conveyor belt during conveyor tracking. 9.1.2 Plc To Nc Data structure which is cyclically exchanged between PLC and NC. Name Type Description Common Override Factor LREAL Desired Override Factor (1.0 = 100%, Default Value is 1.0) 9.2 Index Offset Specification for MC Group Parameters Port 501: AMSPORT_R0_NCSAF: UINT := 501;. The Object ID (OID) of the MC group must be designated as the index group. TF5420 Version: 1.15.0 97
## Page 98

Appendix Index offset (Hex) Access Group Data Phys Definition Description Comments type Type . unit range 0x5030084 Read MC Group LREAL mm >=0 Remaining Only available distance of the for MC Group current with Pick-and- segment. Place from V3.1.6.27 0x5030085 Read MC Group LREAL s >=0 Remaining Only available time for the for MC Group current with Pick-and- segment. Place from V3.1.6.27 9.3 Differences between MC2 and MC3 This chapter lists differences between MC2 and MC3 (as introduced in TF5400 Advanced Motion Pack). Axes MC2 MC3 Maximum dynamics The velocity defined in axis There are maximum values for parameterization is interpreted as velocity, acceleration, deceleration physical maximum value. and jerk which limit the values that Acceleration, deceleration and Jerk can be set in FBs. Moreover specified in the axis are default default dynamics can be selected values that only have an effect if no by user at respective FB input. dynamics is specified in FBs. PLC Library MC2 MC3 Default values For dynamics parameters of type The constant MC_Default is LREAL "0" is default value. If "0" is introduced (see MC_LREAL/Special set the default parameters from the Input Values [} 98]). axes are used. "0" is not interpreted as default value but as a normal value which in case of dynamics can be invalid. Timing of FB outputs FB returns values that were valid at FB returns values that are valid at the start of PLC cycle. the moment PLC code is executed. This may lead to timing difference between cyclic interface and FB output. Decoupling A special function block can be The slave axis is decoupled by used (e.g. MC_Gear Out/ sending another motion command MC_Cam Out) with Buffermode mc Aborting. 9.4 MC_LREAL/Special Input Values Data type MC_LREAL, is equivalent to data type LREAL. However, there exist a few additional values that have a special signification. Value Signification Example MC_DEFAULT The input is executed with default Acceleration, Deceleration, Jerk for value for this input. all motion commands MC_MAXIMUM The command is executed with Generally, from software version maximum value for this input. 3.1.4.4 on for specific motion commands the value MC_MAXIMUM 98 Version: 1.15.0 TF5420
## Page 99

Appendix Value Signification Example can be assigned to the inputs Velocity, Acceleration, Deceleration and Jerk. For more detailed information refer to the particular documentation of the function block the input intended to be supplied with the MC_MAXIMUM value belongs to. MC_IGNORE The input is ignored. MC_Gear In Pos CA. Master Start Dist ance MC_INVALID The input must be set by the user, MC_Move Absolute CA. Position there exists no default or maximum value, nor can the input be ignored. 9.5 Global data types 9.5.1 MC_GROUP_TYPE The enum MC. MC_GROUP_TYPE defines the type of a group. Syntax Definition: TYPE MC_GROUP_TYPE ( mc Group Type Invalid := 0, mc Group Type CA := 1, mc Group Type CM := 3 ) END_TYPE Values Name Description mc Group Type Invalid No valid group mc Group Type CA Collision Avoidance group mc Group Type CM Coordinated Motion group [} 18] 9.5.2 MC_GROUP_STATE The enum MC. MC_GROUP_STATE defines the state of a group. State transitions, see state diagram [} 11]. Syntax Definition TYPE MC_GROUP_STATE ( mc Group State Invalid := 0, mc Group State Disabled := 1, mc Group State Standby := 2 mc Group State Moving := 3, mc Group State Stopping := 4, mc Group State Error Stop := 5, mc Group State Homing := 6, mc Group State Not Ready := 7, mc Group State Suspended := 8 ) END_TYPE TF5420 Version: 1.15.0 99
## Page 100

Appendix Values Name Description mc Group State Invalid No valid group state mc Group State Disabled The group is disabled. mc Group State Standby The group is in standby state. mc Group State Moving The group is moving. mc Group State Stopping The group is stopping. mc Group State Error Stop The group stops due to an error. mc Group State Homing mc Group State Not Ready The group is not ready. mc Group State Suspended 9.5.3 ST_Group Status The structure ST_Group Status defines the status of a group. Syntax Definition: TYPE ST_Group Status STRUCT State : MC_GROUP_STATE; Flags : ST_Group Status Flags; END_STRUCT END_TYPE Values Name Type Description State MC_GROUP_STATE [} 99] State of the group Flags ST_Group Status Flags [} 100] Additional status information 9.5.4 ST_Group Status Flags The structure ST_Group Status Flags defines additional status information. Syntax Definition: TYPE STRUCT Is Enable Requested : BIT; All Axes Standing : BIT; In Position : BIT; END_STRUCT END_TYPE Values Name Type Description Is Enable Requested BIT Defines whether enabling or disabling of a group is requested. All Axes Standing BIT Indicates whether all axes are physically stationary, i.e. the velocity and acceleration for all axes is zero, regardless of whether a motion command is active. In Position BIT Indicates whether the group is in position. 100 Version: 1.15.0 TF5420
## Page 101

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H.
## Page 102

More Information: www.beckhoff.com/TF5420 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
