---
title: "TF5225"
product: "TF5225"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.321"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5225_tc3_cnc_cycles_measurement_en.pdf"
release_date: "2025-06-05"
---
Manual | EN TF5225 | Twin CAT 3 CNC Measurement 6/5/2025 | Version: 1.321
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5225 | Twin CAT 3 CNC Version: 1.321 3 Measurement
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 5

Contents Contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Cycles - Introduction............................................................................................................................... 11 2 Calibrating and measuring..................................................................................................................... 12 2.1 Overview......................................................................................................................................... 12 2.2 Handling output variables................................................................................................................ 12 2.3 Calibrating a touch probe................................................................................................................ 13 2.3.1 Overview.......................................................................................................................... 13 2.3.2 Description....................................................................................................................... 15 2.3.3 Calibrating the touch probe on a ring............................................................................... 19 2.3.4 Calibrating the length of the touch probe......................................................................... 21 2.3.5 Calibrating the touch probe at an edge along the X axis................................................. 23 2.3.6 Calibrating the touch probe at an edge along the Y axis................................................. 25 2.3.7 Calibrating the touch probe at two edges along the X axis.............................................. 27 2.3.8 Calibrating the touch probe at two edges along the Y axis.............................................. 29 2.3.9 Calibrating the touch probe on a sphere.......................................................................... 31 2.4 Calibrating the tool touch probe...................................................................................................... 34 2.4.1 Overview.......................................................................................................................... 34 2.4.2 Description....................................................................................................................... 34 2.5 Aligning laser................................................................................................................................... 37 2.5.1 Overview.......................................................................................................................... 37 2.5.2 Description....................................................................................................................... 37 2.5.3 Aligning laser system....................................................................................................... 39 2.6 Calibrating laser.............................................................................................................................. 41 2.6.1 Overview.......................................................................................................................... 41 2.6.2 Description....................................................................................................................... 42 2.6.3 Calibrating laser system................................................................................................... 44 2.7 Measure laser tool........................................................................................................................... 46 2.7.1 Overview.......................................................................................................................... 46 2.7.2 Description....................................................................................................................... 47 2.7.3 Measure length and radius............................................................................................... 50 2.8 Laser tool breakage check.............................................................................................................. 52 2.8.1 Overview.......................................................................................................................... 52 2.8.2 General............................................................................................................................ 53 2.8.3 Breakage check............................................................................................................... 55 2.8.4 Parameters....................................................................................................................... 56 2.8.5 Syntax.............................................................................................................................. 56 2.8.6 Programming example..................................................................................................... 56 2.8.7 Output variables............................................................................................................... 56 2.9 Teach-in (sequence numbering)..................................................................................................... 57 2.9.1 Overview.......................................................................................................................... 57 2.9.2 Description....................................................................................................................... 59 2.9.3 Teach-in........................................................................................................................... 63 TF5225 | Twin CAT 3 CNC Version: 5 Measurement
## Page 6

Contents 2.10 Workpiece Coordinate System (WCS)............................................................................................ 81 2.10.1 Overview.......................................................................................................................... 81 2.10.2 Description....................................................................................................................... 83 2.10.3 Single point measurement............................................................................................... 87 2.10.4 Two point measurement................................................................................................... 96 2.10.5 Three point measurement.............................................................................................. 106 2.10.6 Measure the diameter.................................................................................................... 109 2.10.7 Measure slot and web.................................................................................................... 124 2.10.8 Angle measurement....................................................................................................... 142 2.10.9 Rectangle....................................................................................................................... 175 2.10.10 Extra measurement cycles............................................................................................. 181 2.10.11 Measuring a circle segment........................................................................................... 187 2.10.12 Measuring a corner........................................................................................................ 199 2.10.13 Measuring a sphere....................................................................................................... 205 2.11 Measuring a tool............................................................................................................................ 208 2.11.1 Overview........................................................................................................................ 208 2.11.2 Description..................................................................................................................... 208 2.12 Measuring a rotary axis................................................................................................................. 212 2.12.1 Overview........................................................................................................................ 212 2.12.2 Description..................................................................................................................... 212 2.12.3 Process.......................................................................................................................... 216 2.12.4 Pre-positioning............................................................................................................... 217 2.12.5 Parameters..................................................................................................................... 219 2.12.6 Syntax............................................................................................................................ 220 2.12.7 Output variables............................................................................................................. 220 2.12.8 Programming examples................................................................................................. 221 3 Calculation cycles................................................................................................................................. 225 3.1 Introduction................................................................................................................................... 225 3.2 Cycle for calculation of a circle in 2D............................................................................................ 226 3.2.1 Process.......................................................................................................................... 226 3.2.2 Parameters..................................................................................................................... 226 3.2.3 Syntax............................................................................................................................ 227 3.2.4 Output variables............................................................................................................. 227 3.2.5 Programming example................................................................................................... 227 3.3 Cycle for calculation of a plane..................................................................................................... 228 3.3.1 Process.......................................................................................................................... 228 3.3.2 Parameters..................................................................................................................... 228 3.3.3 Syntax............................................................................................................................ 229 3.3.4 Output variables............................................................................................................. 229 3.3.5 Programming example................................................................................................... 229 3.4 Cycle for calculation of a straight line in 3D.................................................................................. 230 3.4.1 Process.......................................................................................................................... 230 3.4.2 Parameters..................................................................................................................... 230 3.4.3 Syntax............................................................................................................................ 231 3.4.4 Output variables............................................................................................................. 231 3.4.5 Programming example................................................................................................... 231 6 Version: TF5225 | Twin CAT 3 CNC Measurement
## Page 7

Contents 3.5 Cycle for calculation of a sphere................................................................................................... 232 3.5.1 Process.......................................................................................................................... 232 3.5.2 Parameters..................................................................................................................... 232 3.5.3 Syntax............................................................................................................................ 233 3.5.4 Output variables............................................................................................................. 233 3.5.5 Programming example................................................................................................... 234 3.6 Cycle for calculation of a circle in 3D............................................................................................ 234 3.6.1 Process.......................................................................................................................... 234 3.6.2 Parameters..................................................................................................................... 235 3.6.3 Syntax............................................................................................................................ 235 3.6.4 Output variables............................................................................................................. 235 3.6.5 Programming example................................................................................................... 236 4 High Speed Settings............................................................................................................................. 237 4.1 Introduction................................................................................................................................... 237 4.2 Sys Hsc Settings cycle - High Speed Cutting settings.................................................................... 237 4.2.1 Process.......................................................................................................................... 237 4.2.2 Parameterisation............................................................................................................ 238 4.2.3 Syntax............................................................................................................................ 238 4.2.4 Programming example................................................................................................... 238 5 Support and Service............................................................................................................................. 240 TF5225 | Twin CAT 3 CNC Version: 7 Measurement
## Page 8

Contents 8 Version: TF5225 | Twin CAT 3 CNC Measurement
## Page 9

List of figures List of figures Fig. 1 Sys Calib Meas Output................................................................................................................... 13 Fig. 2 Calibrating the touch probe on a ring........................................................................................... 19 Fig. 3 Calibrating the length of the touch probe..................................................................................... 21 Fig. 4 Calibrating the touch probe at an edge along the X axis............................................................. 23 Fig. 5 Calibrating the touch probe at an edge along the Y axis............................................................. 25 Fig. 6 Calibrating the touch probe at two edges along the X axis.......................................................... 27 Fig. 7 Calibrating the touch probe at two edges along the Y axis.......................................................... 29 Fig. 8 Calibrating the touch probe on a sphere...................................................................................... 31 Fig. 9 Calibrating the tool touch probe................................................................................................... 34 Fig. 10 Manual teach-in............................................................................................................................ 63 Fig. 11 Semi-automatic teach-in.............................................................................................................. 66 Fig. 12 Automatic teach-in....................................................................................................................... 69 Fig. 13 Resulting coordinate system........................................................................................................ 73 Fig. 14 Align plane................................................................................................................................... 74 Fig. 15 Measurement of three spheres in a plane.................................................................................... 77 Fig. 16 Teach-in with 3 spheres............................................................................................................... 78 Fig. 17 Measure in X axis......................................................................................................................... 87 Fig. 18 Measure in Y axis......................................................................................................................... 90 Fig. 19 Measure in Z axis......................................................................................................................... 93 Fig. 20 Measure in X and Y axes............................................................................................................. 96 Fig. 21 Measure in X and Z axes............................................................................................................. 99 Fig. 22 Measure in Y and Z axes............................................................................................................. 103 Fig. 23 Measure in X, Y and Z axes......................................................................................................... 106 Fig. 24 Inner diameter with four points..................................................................................................... 109 Fig. 25 Inner diameter with three points................................................................................................... 112 Fig. 26 Outer diameter with four points.................................................................................................... 115 Fig. 27 Outer diameter with three points.................................................................................................. 118 Fig. 28 Inner diameter with four points and obstacle............................................................................... 121 Fig. 29 Measure slot in X axis.................................................................................................................. 124 Fig. 30 Measure slot in Y axis.................................................................................................................. 127 Fig. 31 Measure web in X axis................................................................................................................. 130 Fig. 32 Measure web in Y axis................................................................................................................. 133 Fig. 33 Measure slot in X axis with obstacle............................................................................................ 136 Fig. 34 Measure slot in Y axis with obstacle............................................................................................ 139 Fig. 35 Measure angle in X axis (C axis)................................................................................................. 142 Fig. 36 Measure angle in Y axis (C axis)................................................................................................. 145 Fig. 37 Measure angle between 2 drilled holes (C axis).......................................................................... 148 Fig. 38 Measure angle between pins (C axis).......................................................................................... 151 Fig. 39 Measure angle between drilled hole and spigot (C axis)............................................................. 154 Fig. 40 Measure angle between point in Y and drilled hole (C axis)........................................................ 157 Fig. 41 Measure angle between point in Y and spigot (C axis)................................................................ 160 Fig. 42 Measure angle between point in X and drilled hole (C axis)........................................................ 163 Fig. 43 Measure angle between point in X and spigot (C axis)................................................................ 166 Fig. 44 Measure angle in Z axis (A axis).................................................................................................. 169 TF5225 | Twin CAT 3 CNC Version: 1.321 9 Measurement
## Page 10

List of figures Fig. 45 Measure angle in Z axis (B axis).................................................................................................. 172 Fig. 46 Inner rectangle............................................................................................................................. 175 Fig. 47 Outer rectangle............................................................................................................................ 178 Fig. 48 Centre point across 4 drilled holes............................................................................................... 181 Fig. 49 Centre point of a hole circle......................................................................................................... 184 Fig. 50 Measure circle segment from the inside with 3 points................................................................. 187 Fig. 51 Measure circle segment from the inside with 4 points................................................................. 190 Fig. 52 Measure circle segment from the outside with 3 points............................................................... 193 Fig. 53 Measure circle segment from the outside with 4 points............................................................... 196 Fig. 54 Rectangular inside and outside corners....................................................................................... 199 Fig. 55 Any inside and outside corners.................................................................................................... 202 Fig. 56 Measuring a sphere..................................................................................................................... 205 Fig. 57 Measuring a tool........................................................................................................................... 208 Fig. 58 Measuring a stationary rotary axis............................................................................................... 215 Fig. 59 Measuring a moved rotary axis.................................................................................................... 215 Fig. 60 Mounting the calibration sphere................................................................................................... 215 Fig. 61 Positions of the touch probe head tip........................................................................................... 216 Fig. 62 Pre-positioning with rotation about the Y axis.............................................................................. 217 Fig. 63 Touch probe with inclined position............................................................................................... 218 Fig. 64 Measuring a swivel axis............................................................................................................... 222 Fig. 65 Measuring a round table with a 6-axis articulated robot............................................................... 223 Fig. 66 Measuring with inclined touch probe head................................................................................... 224 Fig. 67 Calculation of a circle in 2D.......................................................................................................... 226 Fig. 68 Calculation of a plane................................................................................................................... 228 Fig. 69 Calculation of a straight line in 3D................................................................................................ 230 Fig. 70 Calculation of a sphere................................................................................................................ 232 Fig. 71 Calculation of a circle in 3D.......................................................................................................... 234 Fig. 72 Operation mode of HSC settings................................................................................................. 237 10 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 11

Cycles - Introduction 1 Cycles - Introduction Cycles are additional options and subject to the purchase of a license. General information Cycle call ISG cycles are called using a cycle call: L CYCLE[ NAME="..." @P1 = .. @P2 = .. ...] A cycle is called by specifying the cycle name. It is also possible to parameterise the cycle input parameters to modify cycle behaviour to a special application. This documentation contains a separate subsection for each cycle where cycle behaviour is described in greater detail. It also contains a list of the input parameters used for the cycle. Finally, a simple programming example describes how to call the cycle. Selecting the cycle plane A cycle is programmed independently of the currently valid plane (G17, G18, G19) and independently of the axis names configured in the NC channel. In the cycle documentation, the axes are described by the following names for the sake of better legibility: • The X axis describes the 1st main axis • The Y axis describes the 2nd main axis • The Z axis describes the 3rd main axis • A axis is the designation for the rotary axis about the 1st main axis • B axis is the designation for the rotary axis about the 2nd main axis • C axis is the designation for the rotary axis about the 3rd main axis Cycles can also be used in offset and rotated coordinate systems. These coordinate systems should only be defined using the #CS command. The #ROTATION command is not suitable for use in combination with cycles. TF5225 | Twin CAT 3 CNC Version: 1.321 11 Measurement
## Page 12

Calibrating and measuring 2 Calibrating and measuring 2.1 Overview Cycles are additional options and subject to the purchase of a license. Task In order to increase the machining precision of workpieces in CNC-controlled production, geometric errors must be reliably detected and corrected. The purpose of “Measurement cycles - Calibration includes • the automatic calibration of measuring equipment • the measurement of coordinate systems, and • the measurement of workpieces and tools. See “Cycles - Kinematic optimisation” for how to determine and correct geometric errors in machine kinematics. Please note that cycles are additional options and subject to the purchase of a license. Programming and parameterisation The programming and parameterisation of cycles is described in each of the overviews in the main chapter. 2.2 Handling output variables The measurement and calibration cycles contain output variables that can be used to request the result. There are two options to read out the output variables. They are described in more detail below. Option 1: Read out the output variables per cycle variables The first option is to create the V. CYC. output variable in the program calling the cycle. The cycle checks whether this variable already exists. If this is the case, the corresponding result value is written in the existing V. CYC. variable. Read out the output variables per cycle variables The example describes how to read out the output variables for the cycle "Sys Calib Touchprobe1.ecy". Analogously, the procedure can be transferred to all measurement and calibration cycles. In the program calling the cycle, the result values must be written to the file "result.txt". For this purpose, the output variables in which the result value is written on cycle execution are created locally. %main.nc #VAR V. CYC. Sys Ret Offset X V. CYC. Sys Ret Offset Y V. CYC. Sys Ret Tool Radius #ENDVAR T1 D1 G00 G90 Z0 L CYCLE [NAME=Sys Calib Touchprobe1.ecy @P2 = 100] G00 G90 Z50 #FILENAME[MSG="result.txt"] #MSG SAVE["Tool Radius = %f", V. CYC. Sys Ret Offset X] #MSG SAVE["Offset in X = %f", V. CYC. Sys Ret Offset Y] 12 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 13

Calibrating and measuring #MSG SAVE["Offset in Y = %f", V. CYC. Sys Ret Tool Radius] M30 Option 2: Read out the output variables per subroutine The post files of the cycles created by the user can also be used to read out the result values. These post files are automatically called at the end of the cycle. The output variables are visible in them. Fig. 1: Sys Calib Meas Output Read out the output variables per subroutine The example describes how to read out the output variables for the cycle Sys Calib Touchprobe1.ecy. Analogously, the procedure can be transferred to all measurement and calibration cycles. In the program calling the cycle, the result values must be written to the file "result.txt". For this purpose, result variables must be created locally to receive the values of the output variables. %main.nc #VAR V. L. Res Off X V. L. Res Off Y V. L. Res Radius #ENDVAR T1 D1 G00 G90 Z0 L CYCLE [NAME=Sys Calib Touchprobe1.ecy @P2 = 100] G00 G90 Z50 #FILENAME[MSG="result.txt"] #MSG SAVE["Tool Radius = %f", V. L. Res Radius] #MSG SAVE["Offset in X = %f", V. L. Res Off X] #MSG SAVE["Offset in Y = %f", V. L. Res Off Y] M30 In order for the result values to be transferred to the variables created by the user within the cycle, the post subroutine "Sys Calib Touchprobe1Post.nc" must be created by the user. It is then called automatically within the cycle. %Sys Calib Touchprobe1Post.nc V. L. Res Off X = V. CYC. Sys Ret Offset X V. L. Res Off Y = V. CYC. Sys Ret Offset Y V. L. Res Radius = V. CYC. Sys Ret Tool Radius M17 2.3 Calibrating a touch probe 2.3.1 Overview Task This instruction describes: TF5225 | Twin CAT 3 CNC Version: 1.321 13 Measurement
## Page 14

Calibrating and measuring • the automatic calibration of the touch probe. Possible applications The characteristic touch probe parameters are determined by measuring geometric objects with known properties. The determining parameters include: • the length of the touch probe, • the radius of the touch probe sphere • and the shift of the touch probe along the X and Y axes. These are electronic variables that integrate the speed-dependent trigger offsets during measurement and may therefore deviate from the geometric values. The various output variables are defined in greater detail in the subsections for each of the cycles. Programming The cycles are called with the L CYCLE[..] function and the required parameters are taken directly from the NC program. A more detailed description of the call is provided in the subsections for each of the cycles. 14 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 15

Calibrating and measuring 2.3.2 Description 2.3.2.1 General The length of the touch probe is defined up to the bottom of the touch probe sphere. The velocity-dependent delay between the fixed stop point of the touch probe sphere and the trigger point of the measurement is calculated in the diameter of the touch probe sphere. Calibration is also useful when the exact physical diameter of the touch probe sphere is known. The Sys Calib Config Touchprobe.nc calibration file [} 16] must be present and the corresponding parameters must be configured before the cycles are used (except for the calibration parameters to be identified), otherwise the cycles cannot run. If no measuring signal is triggered during the measurement, the machine stops with the error message: "No workpiece detected, please check your measuring section“ P-ERR-13413. If a measurement is detected during positioning, the machine stops with the error message: “Collision on positioning, please check your motion range”P-ERR-13414. The measurement results are saved in V. CYC variables (output variables) and can be processed in the post- files. An overview of existing output variables is contained in each of the cycle sections. NOTICE Cycles which output the touch probe shift contain a spindle rotation and require a meas- urement with the rear of the touch probe. If this is not possible, the cycle may not be ex- ecuted. TF5225 | Twin CAT 3 CNC Version: 1.321 15 Measurement
## Page 16

Calibrating and measuring 2.3.2.2 Configuration file The following items are required to successfully configure the touch probe: • the radius of the touch probe sphere, the offsets in X and Y and the length of the touch probe must be defined using the tool data. • The configuration file Sys Calib Config Touchprobe.nc was created, containing at least the measuring and positioning feed rates. Detailed description The Sys Calib Config Touchprobe.nc file is executed before each cycle to identify the touch probe parameters. The following variables must then be defined. Variable Description V. CYC. Sys Conf_Probes Measuring feed during measurement. _feed V. CYC. Sys Conf_Probes Positioning feed rate between measuring points. _feed_max V. CYC. Sys Conf_Spindl Definition whether the touch probe is to be positioned in the measurement e_orientation direction before every measurement run. 0 = touch probe is not positioned (default value). Touch probe must be in initial position before the start of the cycle. 1 = touch probe is positioned V. CYC. Sys Conf_Probes Measuring feed for a second probing at a slow speed. _feed_repeat If defined with a value > 0, the probe is retracted slightly after the first probing and the measurement is repeated. Default value = 0. V. CYC. Sys Conf_Probes Retraction distance in the measuring direction for the second probing at a slow _dist_repeat speed. Only used if V. CYC. Sys Conf_Probes_feed_repeat is greater than zero. Default value = 2. V. CYC. Sys Conf_Spindl Definition of the basic angle specified to position the touch probe. e_angle Only used if V. CYC. Sys Conf_Spindle_orientation = 1. Corresponds to the spindle position (M19) required for measuring in the positive X direction. Default value = 0. V. CYC. Sys Conf_Spindl Position of the spindle final position when positioned with M19. e_Pos_Dir Only used if V. CYC. Sys Conf_Spindle_orientation = 1. 0 = The spindle positions the touch probe clockwise when the touch probe tip is viewed from below (default value). 1 = The spindle positions the touch probe counter clockwise when the touch probe tip is viewed from below. V. CYC. Sys Conf_Probes Spindle feed rate for spindle positioning of the touch probe. _spdl_feed Default value = 200 V. CYC. Sys Conf_Probes Time in seconds to wait for the spindle to reposition before a corresponding _spdl_wait measurement run. Default value = 1 V. CYC. Sys Conf_Retract Feed rate from pre-positioning to start position. _Pre Pos_feed If 0 is specified, the pre-positioning velocity is used. Default value = 0 V. CYC. Sys Conf_Retract Retract velocity after measurement event _Meas_feed If 0 is specified, the measuring feed is used. Default value = 0 16 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 17

Calibrating and measuring Additional configuration data for the touch probe is read from the current tool data. The touch probe must therefore be defined as a current tool and its tool data must be saved (except for calibration). The tool data to be considered includes: • The radius of the touch probe sphere (V. G. WZ_AKT. R) • The length of the touch probe (V. G. WZ_AKT. L) • Horizontal offsets of the touch probe tip relative to the spindle flange (V. G. WZ_AKT. V. X and W. G. WZ_AKT. V. Y) The measurement results are calculated to include the offsets between the touch probe tip and the spindle flange and the radius of the touch probe sphere. For example, the configuration file Sys Calib Config Touchprobe.nc may look like this: Configuration file %Sys Calib Config Touchprobe.nc V. CYC. Sys Conf_Probes_feed = 500 (measuring feed rate) V. CYC. Sys Conf_Probes_feed_max = 1000 (positioning feed rate) V. CYC. Sys Conf_Spindle_orientation = 0 (positioning of probe) V. CYC. Sys Conf_Spindle_angle = 0 (probe basic angle) V. CYC. Sys Conf_Probes_feed_repeat = 0 (repetition feed rate) V. CYC. Sys Conf_Probes_dist_repeat = 2 (distance of repetition) V. CYC. Sys Conf_Probes_spdl_feed = 200 (spindle speed) V. CYC. Sys Conf_Probes_spdl_wait = 1 (dwell time) V. CYC. Sys Conf_Spindle_Pos_Dir = 0 (spindle pos. direction) V. CYC. Sys Conf_Retract_Pre Pos_feed = 0 (retract pre pos.feed rate) V. CYC. Sys Conf_Retract_Meas_feed = 0 (retract meas. feed rate) M17 TF5225 | Twin CAT 3 CNC Version: 1.321 17 Measurement
## Page 18

Calibrating and measuring 2.3.2.3 Pre- and post-files For this cycle there are 2 pre-files which must be called before this cycle and 2 post-files which are called after each cycle. • These files are optional. If they do not exist, this step is skipped. • As required, these files must therefore be created as a subroutine. In general, a post-file is required to process the output variables stored in the local V. CYC. variables. • Machine-specific adaptations, e.g. activation of the touch probe, can be carried out in the pre-file. • The post-file can be used to process output variables, for example. In addition, separate pre and post-files can be written for each cycle, with each file being valid for each cycle. The syntax is obtained from the cycle name+pre.nc or cycle name+post.nc. There is a general pre-file and a general post-file which are used for all Sys Calib Touchprobe cycles: • Sys Calib Touchprobe Pre.nc • Sys Calib Touchprobe Post.nc These files are only valid for this cycle and consist of the following: Cyclename +1Pre or 1Post +.nc • Sys Calib Touchprobe1Pre.nc • Sys Calib Touchprobe1Post.nc 2.3.2.4 General cycle process The cycles call internally different subroutines in this sequence. Example based on Sys Calib Touchprobe1.ecy: 1. Sys Calib Touchprobe Pre.nc (optional) 2. Sys Calib Touchprobe1Pre.nc (optional) 3. Sys Calib Config Touchprobe.nc 4. Sys Calib Touchprobe1Post.nc (optional) 5. Sys Calib Touchprobe Post.nc (optional) 18 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 19

Calibrating and measuring 2.3.3 Calibrating the touch probe on a ring The touch probe head is calibrated by approaching a ring of known diameter several times. The shifts in the X and Y directions and the radius of the touch probe sphere are included in the identified calibration parameters. The spindle is turned through 180° during the cycle. 2.3.3.1 Process (internal cycle) Starting position before the cycle is called: The touch probe must be positioned as centrally as possible in the ring either manually or in automatic mode. It stands vertically, i.e. the touch probe rotation stands at 0. The internal cycle process can be described as follows: 1. If there is a deviation, the spindle position is turned automatically to its initial position. 2. The touch probe travels a total of four measurements along the inner side of the ring and returns to the starting position. 3. The spindle position is turned through 180° automatically. 4. The touch probe again travels four measurements along the inner side of the ring and returns to the starting position. 5. The spindle position is turned automatically back to its initial position. Z Y X Fig. 2: Calibrating the touch probe on a ring TF5225 | Twin CAT 3 CNC Version: 1.321 19 Measurement
## Page 20

Calibrating and measuring 2.3.3.2 Parameters Required input parameters Cycle parameters Description @P2 Inner diameter of the ring Optional input parameters Cycle parameters Description @P14 Probe angle of the first lateral measurement in relation to the positive X axis Presetting = 0° @P15 Difference between the probe angle and the lateral measurements Presetting = 90° @P33 Crossover range during measurement process Additional motion path that exceeds the expected workpiece edge/workpiece surface Presetting = @P2/2 It is recommended using the Syntax check to verify whether the input parameters have been correctly assigned. 2.3.3.3 Syntax L CYCLE [ NAME = Sys Calib Touchprobe1.ecy @P.. = .. ] 2.3.3.4 Programming example Calibrating the touch probe on a ring T1 D1 G53 G00 G90 X100 Y100 Z100 G00 G91 Z-50 L CYCLE [NAME=Sys Calib Touchprobe1.ecy \ @P2 = 50 \ @P14 = 20 \ @P15 = 70 \ @P33 = 30 \ ] G00 G91 Z50 M30 2.3.3.5 Output variables Variable Value V. CYC. Sys Ret Offset X Calculated shift of the touch probe head along the X axis V. CYC. Sys Ret Offset Y Calculated shift of the touch probe head along the Y axis V. CYC. Sys Ret Tool Radius Calculated radius of the touch probe sphere See information on use of the output variables [} 12]. 20 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 21

Calibrating and measuring 2.3.4 Calibrating the length of the touch probe Calibrating the length of the touch probe by comparison with a known reference surface. 2.3.4.1 Process (internal cycle) The touch probe stands vertically, i.e. the rotation is at 0. Starting from the starting position, a vertical measurement is executed along the Z axis. After the measurement value is recorded, the touch probe returns to the starting position. Z Y X Fig. 3: Calibrating the length of the touch probe 2.3.4.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P6 Measurement path in the direction of the negative Z axis, only positive values permitted @P86 Z reference value of known surface It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.3.4.3 Syntax L CYCLE [ NAME = Sys Calib Touchprobe2.ecy @P.. = .. ] TF5225 | Twin CAT 3 CNC Version: 1.321 21 Measurement
## Page 22

Calibrating and measuring 2.3.4.4 Programming example Calibrating the length of the touch probe T1 D1 G53 G00 G90 X140 Y-65 Z400 L CYCLE [NAME=Sys Calib Touchprobe2.ecy \ @P6 = 200 \ @P86 = 300 \ ] M30 2.3.4.5 Output variables Variable Value V. CYC. Sys Ret Touchprobe Length Calculated length of the touch probe head V. CYC. Sys Ret Offset Z Resulting offset (negative length) See information on use of the output variables [} 12]. 22 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 23

Calibrating and measuring 2.3.5 Calibrating the touch probe at an edge along the X axis The touch probe head is calibrated by approaching a known reference point along the X axis several times. The shifts of the touch probe head in the X and Y directions and the radius of the touch probe sphere are included in the identified calibration parameters. 2.3.5.1 Process (internal cycle) Starting position before the cycle is called: The touch probe must be positioned at a start point manually or in automatic mode so that the probe can reach the reference edge in the measurement direction without collision. It stands vertically, i.e. the touch probe rotation stands at 0. The internal cycle process can be described as follows: 1. If there is a deviation, the spindle position is turned to its initial position 2. The touch probe runs a measurement along the X axis and back to the starting position. This meas- urement is repeated with the spindle turned through another 90 degrees until a total of four measure- ments are executed. 3. The spindle is turned automatically back to its initial position Z Y X Fig. 4: Calibrating the touch probe at an edge along the X axis 2.3.5.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P4 Length and sign of the measurement path along the X axis @P84 Reference value of the edge in X It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.3.5.3 Syntax L CYCLE [ NAME = Sys Calib Touchprobe3.ecy @P.. = .. ] TF5225 | Twin CAT 3 CNC Version: 1.321 23 Measurement
## Page 24

Calibrating and measuring 2.3.5.4 Programming example Calibrating the touch probe at an edge along the X axis T1 D1 G53 G00 G90 X200 Y200 Z400 L CYCLE [NAME=Sys Calib Touchprobe3.ecy \ @P4 = 200 \ @P84 = 300 \ ] M30 2.3.5.5 Output variables Variable Value V. CYC. Sys Ret Offset X Calculated shift of the touch probe head along the X axis V. CYC. Sys Ret Offset Y Calculated shift of the touch probe head along the Y axis V. CYC. Sys Ret Tool Radius Radius of the touch probe sphere See information on use of the output variables [} 12]. 24 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 25

Calibrating and measuring 2.3.6 Calibrating the touch probe at an edge along the Y axis The touch probe head is calibrated by approaching a known reference edge along the Y axis several times. The shifts of the touch probe head in the X and Y directions and the radius of the touch probe sphere are included in the identified calibration parameters. 2.3.6.1 Process (internal cycle) Starting position before the cycle is called: The touch probe must be positioned at a start point manually or in automatic mode so that the probe can reach the reference edge in the measurement direction without collision. It stands vertically, i.e. the touch probe rotation stands at 0. The internal cycle process can be described as follows: 1. If there is a deviation, the spindle position is turned to its initial position 2. The touch probe runs a measurement along the Y axis and back to the starting position. This meas- urement is repeated with the spindle turned through another 90 degrees until a total of four measure- ments are executed. 3. The spindle is turned automatically back to its initial position Z Y X Fig. 5: Calibrating the touch probe at an edge along the Y axis 2.3.6.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P5 Length and sign of the measurement path along the Y axis @P85 Reference value of the edge in Y It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.3.6.3 Syntax L CYCLE [ NAME = Sys Calib Touchprobe4.ecy @P.. = .. ] TF5225 | Twin CAT 3 CNC Version: 1.321 25 Measurement
## Page 26

Calibrating and measuring 2.3.6.4 Programming example Calibrating the touch probe at an edge along the Y axis T1 D1 G53 G00 G90 X1400 Y1400 Z1000 L CYCLE [NAME=Sys Calib Touchprobe4.ecy \ @P5 = 200 \ @P85 = 1500 \ ] M30 2.3.6.5 Output variables Variable Value V. CYC. Sys Ret Offset X Calculated shift of the touch probe head along the X axis V. CYC. Sys Ret Offset Y Calculated shift of the touch probe head along the Y axis V. CYC. Sys Ret Tool Radius Radius of the touch probe sphere See information on use of the output variables [} 12]. 26 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 27

Calibrating and measuring 2.3.7 Calibrating the touch probe at two edges along the X axis The touch probe head is calibrated by approaching two reference points at a known distance along the X axis several times. The shifts of the touch probe head in the X and Y directions and the radius of the touch probe sphere are included in the identified calibration parameters. 2.3.7.1 Process (internal cycle) Starting position before the cycle is called: The touch probe must be positioned at the start point manually or in automatic mode so that the probe can reach the two reference edges without collision. It stands vertically, i.e. the touch probe rotation stands at 0. The internal cycle process can be described as follows: 1. If there is a deviation, the spindle position is turned to its initial position 2. The touch probe runs a measurement along the X axis on the specified measurement path in the dir- ection of the first edge and back to the starting position. This measurement is repeated with the spindle turned through another 90 degrees until a total of four measurements are executed. 3. The spindle is turned automatically back to its initial position 4. A measurement is executed with a negative measurement path in the direction of the second edge 5. Return to starting position Z Y X Fig. 6: Calibrating the touch probe at two edges along the X axis 2.3.7.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P3 Clearance of the two edges along the X axis @P4 Length and sign of the 1st measurement path along the X axis It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. TF5225 | Twin CAT 3 CNC Version: 1.321 27 Measurement
## Page 28

Calibrating and measuring 2.3.7.3 Syntax L CYCLE [ NAME = Sys Calib Touchprobe5.ecy @P.. = .. ] 2.3.7.4 Programming example Calibrating the touch probe at two edges along the X axis T1 D1 G53 G00 G90 X1400 Y1410 Z1000 L CYCLE [NAME=Sys Calib Touchprobe5.ecy \ @P3 = 200 \ @P4 = 300 \ ] M30 2.3.7.5 Output variables Variable Value V. CYC. Sys Ret Offset X Calculated shift of the touch probe head along the X axis V. CYC. Sys Ret Offset Y Calculated shift of the touch probe head along the Y axis V. CYC. Sys Ret Tool Radius Radius of the touch probe sphere See information on use of the output variables [} 12]. 28 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 29

Calibrating and measuring 2.3.8 Calibrating the touch probe at two edges along the Y axis The touch probe head is calibrated by approaching two reference points at a known distance along the Y axis several times. The shifts of the touch probe head in the X and Y directions and the radius of the touch probe sphere are included in the identified calibration parameters. 2.3.8.1 Process (internal cycle) Starting position before the cycle is called: The touch probe must be positioned at the start point manually or in automatic mode so that the probe can reach the two reference edges without collision. It stands vertically, i.e. the touch probe rotation stands at 0. The internal cycle process can be described as follows: 1. If there is a deviation, the spindle position is turned to its initial position 2. The touch probe runs a measurement along the Y axis on the specified measurement path in the dir- ection of the first edge and back to the starting position. This measurement is repeated with the spindle turned through another 90 degrees until a total of four measurements are executed. 3. The spindle is turned automatically back to its initial position 4. A measurement is executed with a negative measurement path in the direction of the second edge 5. Return to starting position Z Y X Fig. 7: Calibrating the touch probe at two edges along the Y axis 2.3.8.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P3 Distance of the two edges along the Y axis @P5 Length and sign of the 1st measurement path along the Y axis It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. TF5225 | Twin CAT 3 CNC Version: 1.321 29 Measurement
## Page 30

Calibrating and measuring 2.3.8.3 Syntax L CYCLE [ NAME = Sys Calib Touchprobe6.ecy @P.. = .. ] 2.3.8.4 Programming example Calibrating the touch probe at two edges along the Y axis T1 D1 G53 G00 G90 X1400 Y1410 Z1000 A0 B90 C0 L CYCLE [NAME=Sys Calib Touchprobe6.ecy \ @P3 = 200 \ @P5 = 300 \ ] M30 2.3.8.5 Output variables Variable Value V. CYC. Sys Ret Offset X Calculated shift of the touch probe head along the X axis V. CYC. Sys Ret Offset Y Calculated shift of the touch probe head along the Y axis V. CYC. Sys Ret Tool Radius Radius of the touch probe sphere See information on use of the output variables [} 12]. 30 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 31

Calibrating and measuring 2.3.9 Calibrating the touch probe on a sphere The touch probe head is calibrated by approaching a sphere of known diameter several times. The shifts of the touch probe head in the X and Y directions and the radius of the touch probe sphere are included in the identified calibration parameters. In addition, the length of the touch probe is determined by specifying a reference parameter for the Z axis. Optionally, the calibration of the known sphere centre point is repeated to improve the calibration accuracy. This cycle is only suitable for calibrating a touch probe providing there is a negligible difference between the trigger offset in Z and the trigger offset in X and Y. The sphere diameter must be significantly greater than the sphere diameter of the touch probe for the calibration. 2.3.9.1 Process (internal cycle) Starting position before the cycle is called: The touch probe must be positioned either manually or in automatic mode as centrally as possible and at a short clearance above the first sphere. It stands vertically, i.e. the touch probe rotation stands at 0. The internal cycle process can be described as follows: 1. If there is a deviation, the spindle position is turned automatically to its initial position. 2. The touch probe first runs a measurement in the Z direction and a total of four lateral measurements, after which it returns to the starting position. 3. The spindle position is turned through 180°. 4. The touch probe again runs a measurement in the Z direction and a total of four lateral measure- ments, after which it returns to the starting position. 5. The spindle is turned back to its initial position and the touch probe approaches the calculated centre point on the XY plane. 6. If a measurement repetition was specified in @P88 to enhance accuracy, points 2 to 6 are repeated, whereby the lateral measurements take place at the calculated height of the equator. 7. If @P86 was defined, an additional measurement is executed in the Z direction before the touch probe returns again to the starting position. @P15 @P14 @P6 @P86 @P13 @P33 Z Y @P87 X Fig. 8: Calibrating the touch probe on a sphere TF5225 | Twin CAT 3 CNC Version: 1.321 31 Measurement
## Page 32

Calibrating and measuring 2.3.9.2 Parameters Required input parameters Cycle parameters Description @P6 Measurement path in the direction of the negative Z axis, only positive values permitted @P87 Diameter of sphere Optional input parameters Cycle Description parameters @P13 Safety clearance for pre-positioning Default value = diameter of touch probe @P14 Probe angle of the first lateral measurement in relation to the positive X axis [degrees] Default value = 0 @P15 Difference of the probe angle between the lateral measurements [degrees] Default value = 90 @P33 Crossover range during measurement process Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = @P87/4 (calibration at sphere) @P64 Definition of the path to approach to pre-position 0: linear (default value) 1: circular @P86 Z reference of top sphere edge. If parameters are specified, the length of the touch probe is modified. @P88 Measurement repetition with calculated parameters at height of equator for enhanced accuracy 1: yes 2: no (default value) NOTICE If circular approach of the pre-position was selected in @P64, collision detection is dis- abled. This option may only be enabled if safe approach to the pre-position is ensured. It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.3.9.3 Syntax L CYCLE [ NAME = Sys Calib Touchprobe7.ecy @P.. = .. ] 2.3.9.4 Programming example Calibrating the touch probe on a sphere T1 D1 G53 G00 G90 X100 Y100 Z95 L CYCLE [NAME=Sys Calib Touchprobe7.ecy \ @P6 = 10 \ @P64 = 1 \ @P14 = 20 \ @P13 = 10 \ 32 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 33

Calibrating and measuring @P33 = 15 \ @P87 = 90 \ ] M30 2.3.9.5 Output variables Variable Value V. CYC. Sys Ret Offset X Calculated shift of the touch probe along the X axis. V. CYC. Sys Ret Offset Y Calculated shift of the touch probe along the Y axis. V. CYC. Sys Ret Offset Radius Calculated radius of the touch probe sphere. V. CYC. Sys Ret Touchprobe Length Calculated length of the touch probe head See information on use of the output variables [} 12]. TF5225 | Twin CAT 3 CNC Version: 1.321 33 Measurement
## Page 34

Calibrating and measuring 2.4 Calibrating the tool touch probe 2.4.1 Overview These instructions describe the automatic calibration of a tool touch probe with a reference tool. Fig. 9: Calibrating the tool touch probe Possible applications During the calibration, the surface position of the touch probe is determined in Z, the centre point in X and Y and the diameter of the measuring plate. The velocity-dependent shift of the measurement trigger points are also scanned in the tool touch probe parameters measured. It is therefore practical to repeat a calibration if only the measurement velocity changes. Prerequisites To ensure that the calibration of the tool touch probe is executed successfully, the following requirements must be fulfilled: 1. Tool touch probe is fitted and active 2. A reference tool of known length and know radius is changed and the tool data is activated. 3. The required measurement and pre-positioning velocities and the approximate plate diameter were entered in the configuration file [} 34]. 2.4.2 Description 2.4.2.1 Configuration file The Sys Calib Config Tool Setting Probe.nc file is executed within the cycle and helps to parameterise the tool touch probe. For calibration, it is sufficient to specify the measuring and positioning feed and the approximate measuring plate diameter. This is required for pre-positioning. After completing calibration, the measurement results must also be entered in the configuration file. 34 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 35

Calibrating and measuring For the value MESS_POS, the number transferred to the cycle by @P20 must be entered. The following values must be entered before the cycle is started: Variables Description V. CYC. Sys Conf_Meas_feed[MESS_POS] Measuring feed V. CYC. Sys Conf_Meas_feed_max[MESS_POS] Positioning feed V. CYC. Sys Conf_Plate_Diam[MESS_POS] Approximate touch measuring plate diameter. For example, the configuration file Sys Calib Config Tool Setting Probe.nc may look like this: Configuration file V. CYC. Sys Conf_Meas_feed[1] = 500 (measuring feed rate) V. CYC. Sys Conf_Meas_feed_max[1] = 1000 (positioning feed rate) V. CYC. Sys Conf_Plate_Diam[1] = 30 (estimated plate diameter) M17 The following values must be entered after the cycle has been executed. Variables Description V. CYC. Sys Conf_Pos_Ax1[MESS_POS] Centre of touch probe in the X axis V. CYC. Sys Conf_Pos_Ax2[MESS_POS] Centre of touch probe in the Y axis V. CYC. Sys Conf_Pos_Ax3[MESS_POS] Surface position of touch probe in the Z axis V. CYC. Sys Conf_Plate_Diam[MESS_POS] Measured diameter of measuring plate. 2.4.2.2 Pre- and post-files For this cycle there is a pre-file which must be called before this cycle and a post-file which is called after this cycle. These files are optional. If they do not exist, this step is skipped. As required, these files must therefore be created as a subroutine. Machine-specific adaptations, e.g. activation of the touch probe, can be carried out in the pre-file. The post-file can be used to process output variables, for example. Pre- and post-files must have the following names: • Sys Calib Tool Setting Probe Pre • Sys Calib Tool Setting Probe Post 2.4.2.3 Process (internal cycle) Before cycle start, the reference tool must be positioned centrally above the tool touch probe. After cycle start, the following process then results when default parameters are used: 1. Measurement takes place from the starting point in the Z direction and is then lifted to the starting pos- ition. 2. The reference tools is positioned next to the measuring plate at the positioning feed in the X+ direc- tion. 3. Measure from this position in the direction of the plate centre. 4. This procedure is repeated for all four directions (X+,Y+,X-,Y-). 5. The tool retracts to the starting position in Z. 6. Measurement is repeated in the Z direction 7. The tool retracts to the starting position in Z. TF5225 | Twin CAT 3 CNC Version: 1.321 35 Measurement
## Page 36

Calibrating and measuring 2.4.2.4 Parameters Required input parameters Cycle parameters Description @P6 Measurement distance in the direction of the negative Z axis, only positive values permitted [mm, inch] @P22 Measurement offset in Z for lateral measurements [mm, inch] Optional input parameters Cycle parameters Description @P13 Safety clearance for lateral measurements [mm, inch] Default value = 1/4 of measuring plate diameter. @P14 Probe angle for first lateral measurement [degrees] Default value = 0 @P15 Incremental angle for lateral measurements [degrees] Default value = 90 @P16 Measuring feed rate for a slow measurement If defined, the measurements are repeated at the specified feed rate. @P17 Radial return clearance for the slow measurement [mm, inch] Default value = 1 @P18 Axial return clearance for the slow measurement [mm, inch] Default value = 1 @P20 Numbering of tool touch probe (Required to read out the configuration from Sys Calib Config Tool Setting Probe.nc) Default value = 1 It is recommended to use the Syntax check.to verify whether the input parameters are correctly assigned. 2.4.2.5 Syntax L CYCLE [ NAME = Sys Calib Tool Setting Probe.ecy @P.. = .. ] 2.4.2.6 Programming example Calibration of tool touch probe To execute the programming example, save the configuration file Sys Calib Config Tool Setting Probe.nc with the following contents: V. CYC. Sys Conf_Meas_feed[1] = 500 V. CYC. Sys Conf_Meas_feed_max[1] = 1000 V. CYC. Sys Conf_Plate_Diam[1] = 40 M17 Call the cycle using the following program after changing the reference tool and positioning it above the centre of the touch probe: L CYCLE [NAME=Sys Calib Tool Setting Probe.ecy \ @P6 = 30 \ @P22 = 10 \ ] M30 36 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 37

Calibrating and measuring 2.4.2.7 Output variables Cycle parameters Description V. CYC. Sys Ret Pos Ax1 The centre point of the tool touch probe in X. V. CYC. Sys Ret Pos Ax2 The centre point of the tool touch probe in Y. V. CYC. Sys Ret Pos Ax3 Surface position of the touch probe in Z. V. CYC. Sys Ret Diameter The measuring plate diameter measured. See information on use of the output variables [} 12]. After completing calibration, the measurement results must also be entered in the configuration file Sys Calib Config Tool Setting Probe.nc. 2.5 Aligning laser 2.5.1 Overview Task Automatic alignment detection of a laser measuring station. Possible applications Precise laser alignment in the XYZ axes. 2.5.2 Description NOTICE The tool diameter may not be greater than the distance between the laser transmitter and receiver less the specified measuring distance. NOTICE During the cycle, all active offsets must be suppressed using #SUPPRESS OFFSETS ex- cept for tool offsets to ensure uniform positioning during alignment, calibration and meas- uring. 2.5.2.1 Configuration files The Sys Calib Config Laser.nc file must be present in the form of a subroutine. It contains the laser parameters. Approximate values are sufficient for the position of the laser focal point for alignment. They are used to pre-position the tool. The precise correction values are detected during the cycle process. Variable Description V. CYC. LASER_BRAKEOFFSET_FAST Return clearance for fast measurement V. CYC. LASER_BRAKEOFFSET Return clearance for precision measurement V. CYC. MEAS_FEED_FAST Measuring feed for fast measurement V. CYC. MEAS_FEED_SLOW Measuring feed for precision measurement V. CYC. MEAS_MODE Mode 0 = push (default), 1 = pull TF5225 | Twin CAT 3 CNC Version: 1.321 37 Measurement
## Page 38

Calibrating and measuring V. CYC. DIRECTION Definition of measuring and positioning direction: 0- Measurement takes place in X- direction 1- Measurement takes place in Y- direction 2- Measurement takes place in X+ direction 3- Measurement takes place in Y+ direction V. CYC. LASER_POS_X Position of the laser focal point in the X axis V. CYC. LASER_POS_Y Position of the laser focal point in the Y axis V. CYC. LASER_POS_Z Position of the laser focal point in the Z axis V. CYC. LASER_Z_START_POS Start point of first measurement in Z. V. CYC. LASER_Z_END_POS End point of first measurement in Z. For example, the configuration file Sys Calib Config Laser.nc may look like this: Configuration file %Sys Calib Config Laser.nc V. CYC. LASER_BRAKEOFFSET_FAST = 1 ; ret. clear. for fast measurement V. CYC. LASER_BRAKEOFFSET = 0.5 ; ret. clear. for precision measurement V. CYC. MEAS_FEED_FAST = 500 ; meas. feed for fast measurement V. CYC. MEAS_FEED_SLOW = 10 ; meas. feed for precision measurement V. CYC. MEAS_MODE = 0 ; 0 = push (default), 1 = pull V. CYC. LASER_POS_X = 10 ; pos. of the laser focal point V. CYC. LASER_POS_Y = 20 ; pos. of the laser focal point V. CYC. LASER_POS_Z= 700; position of the laser focal point (0 = measurement direction X -) (1 = measurement direction Y -) (2 = measurement direction X +) (3 = measurement direction Y +) V. CYC. DIRECTION = 1 ; measurement direction V. CYC. LASER_Z_START_POS = V. CYC. LASER_POS_Z + 5 ; start pos. in Z V. CYC. LASER_Z_END_POS = V. CYC. LASER_POS_Z - 5 ; end pos. in Z M17 Optionally, the two subroutines below can be saved. They control the activation and deactivation of the lasers: 1. Sys Calib Config Laser On.nc 2. Sys Calib Config Laser Off.nc A distinction is made between push and pull measurements. 2.5.2.2 Pre- and post-files For this cycle there is a pre-file which must be called before this cycle and a post-file which is called after this cycle. These files are optional. If they do not exist, this step is skipped. As required, these files must therefore be created as a subroutine. Machine-specific adaptations, e.g. laser activation, can be executed in the pre-file. The post-file can be used to process output variables, for example. Pre- and post-files must have the following names: • Sys Calib Laser Aligning Pre.nc • Sys Calib Laser Aligning Post.nc 38 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 39

Calibrating and measuring 2.5.3 Aligning laser system 2.5.3.1 Process During the cycle, all active offsets must be suppressed using #SUPPRESS OFFSETS except for tool offsets to ensure uniform positioning during alignment, calibration and measuring. Position the tool above the measuring station as centrally as possible either manually or in automatic mode. 1. The reference tool is positioned simultaneously in the X and Y directions above the configured focal point of the laser. 2. The reference tool moves to the configured starting point of the measurement in Z. 3. The reference tool is moved in the XY direction by half the specified measuring distance. 4. The focal point of the laser is detected in the Z direction at increased measuring speed. 5. The focal point of the laser is determined in the Z direction at reduced measuring speed (increased measuring speed/2). 6. A precision measurement is executed in the Z direction at slower measuring speed. 7. The reference tool is positioned next to the laser and lowered. 8. The focal point of the laser is detected in the XY direction at increased measuring speed. 9. The focal point of the laser is detected in the XY direction at reduced measuring speed (increased measuring speed/2). 10. A lateral precision measurement in XY is executed. 11. The reference tool is moved in the opposite direction in the XY direction by the specified measuring distance. 12. The reference tool moves to the configured starting point in Z. 13. Points 4 to 10 are repeated. 14. The reference tool moves to the configured starting point in Z. 15. The reference tool is returned to the starting point position. 2.5.3.2 Parameter Required input parameters Cycle parameters Description @P66 Measurement offset in Z for lateral measurements [mm, inch] Only positive values are permissible. @P130 Measuring distance in XY between first and second measuring points [mm, inch] Only positive values are permissible. Optional input parameters Cycle Description parameters @P13 Clearance for lateral measurements [mm, inch] Default value = current tool diameter @P23 Precision measurement repetitions Default value = 1 @P33 Crossover range during measurement process [mm, inch] Additional motion path after expected workpiece edge is reached Default value = current tool diameter (V. G. WZ_AKT. R) TF5225 | Twin CAT 3 CNC Version: 1.321 39 Measurement
## Page 40

Calibrating and measuring @P37 Permissible tolerance of measuring point scatter. Default value = 1/100 (1/2 * current tool diameter) (1/100* V. G. WZ_AKT. R) If the difference of the measured values exceeds this tolerance, an error is output. @P67 Lateral offset for length measurements [mm, inch] Only positive values are permissible. The value should stand at 0 for pointed tools, small tools and spherical tools. Default value = 0 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.5.3.3 Syntax L CYCLE [ NAME = Sys Calib Laser Aligning.ecy @P.. = .. ] 2.5.3.4 Programming example Align laser T1 D1 G53 G00 Z750 G00 X10 Y20 L CYCLE [NAME=Sys Calib Laser Aligning.ecy \ @P13 = 2 \ @P23 = 2 \ @P37 = 0.05 \ @P66 = 5 \ @P67 = 5 \ @P130 = 35 ] G00 Z750 M30 2.5.3.5 Output variables Cycle parameters Description V. CYC. Sys Ret Laser Diff X Detected difference in X axis between the two measuring points V. CYC. Sys Ret Laser Diff Y Detected difference in Y axis between the two measuring points V. CYC. Sys Ret Laser Diff Z Detected difference in Z axis between the two measuring points V. CYC. Sys Ret Laser Pos X Detected position of the laser focal point in the X axis V. CYC. Sys Ret Laser Pos Y Detected position of the laser focal point in the Y axis V. CYC. Sys Ret Laser Pos Z Detected position of the laser focal point in the Z axis See information on use of the output variables [} 12]. After completing the alignment process, enter the detected position of the laser focal point and the measuring and positioning directions in the configuration file [} 42]. 40 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 41

Calibrating and measuring 2.6 Calibrating laser 2.6.1 Overview Task Automatic alignment detection of the laser focal point position of a laser measuring station. Possible applications Precise measurement of laser switching behaviour. TF5225 | Twin CAT 3 CNC Version: 1.321 41 Measurement
## Page 42

Calibrating and measuring 2.6.2 Description NOTICE The tool diameter may not be greater than the distance between the laser transmitter and receiver. NOTICE During the cycle, all active offsets must be suppressed using #SUPPRESS OFFSETS ex- cept for tool offsets to ensure uniform positioning during calibration and measuring. 2.6.2.1 Configuration files The Sys Calib Config Laser.nc file must be present in the form of a subroutine. It contains the laser parameters. Approximate values are sufficient for the position of the laser focal point for calibration. They are used to pre-position the tool. The exact position values are detected during calibration. Variable Description V. CYC. LASER_BRAKEOFFSET_FAST Return clearance for fast measurement V. CYC. LASER_BRAKEOFFSET Return clearance for precision measurement V. CYC. MEAS_FEED_FAST Measuring feed for fast measurement V. CYC. MEAS_FEED_SLOW Measuring feed for precision measurement V. CYC. MEAS_MODE Mode 0 = push (default), 1 = pull V. CYC. DIRECTION Definition of measuring and positioning direction: 0- Measurement takes place in X- direction 1- Measurement takes place in Y- direction 2- Measurement takes place in X+ direction 3- Measurement takes place in Y+ direction V. CYC. LASER_POS_X Position of the laser focal point in the X axis V. CYC. LASER_POS_Y Position of the laser focal point in the Y axis V. CYC. LASER_POS_Z Position of the laser focal point in the Z axis V. CYC. LASER_Z_START_POS Start point of first measurement in Z. V. CYC. LASER_Z_END_POS End point of first measurement in Z. For example, the configuration file Sys Calib Config Laser.nc may look like this: Configuration file %Sys Calib Config Laser.nc V. CYC. LASER_BRAKEOFFSET_FAST = 1 ; ret. clear. for fast measurement V. CYC. LASER_BRAKEOFFSET = 0.5 ; ret. clear. for precision measurement V. CYC. MEAS_FEED_FAST = 500 ; meas. feed for fast measurement V. CYC. MEAS_FEED_SLOW = 10 ; meas. feed for precision measurement V. CYC. MEAS_MODE = 0 ; 0 = push (default), 1 = pull V. CYC. LASER_POS_X = 10 ; pos. of the laser focal point V. CYC. LASER_POS_Y = 20 ; pos. of the laser focal point V. CYC. LASER_POS_Z= 700; position of the laser focal point (0 = measurement direction X -) (1 = measurement direction Y -) (2 = measurement direction X +) (3 = measurement direction Y +) V. CYC. DIRECTION = 1 ; measurement direction V. CYC. LASER_Z_START_POS = V. CYC. LASER_POS_Z + 5 ; start pos. in Z V. CYC. LASER_Z_END_POS = V. CYC. LASER_POS_Z - 5 ; end pos. in Z M17 42 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 43

Calibrating and measuring Optionally, the two subroutines below can be saved. They control the activation and deactivation of the lasers: 1. Sys Calib Config Laser On.nc 2. Sys Calib Config Laser Off.nc A distinction is made between push and pull measurements. 2.6.2.2 Pre- and post-files For this cycle there is a pre-file which must be called before this cycle and a post-file which is called after this cycle. These files are optional. If they do not exist, this step is skipped. As required, these files must therefore be created as a subroutine. Machine-specific adaptations, e.g. laser activation, can be executed in the pre-file. The post-file can be used to process output variables, for example. Pre- and post-files must have the following names: • Sys Calib Laser Pre.nc • Sys Calib Laser Post.nc TF5225 | Twin CAT 3 CNC Version: 1.321 43 Measurement
## Page 44

Calibrating and measuring 2.6.3 Calibrating laser system 2.6.3.1 Process During the cycle, all active offsets must be suppressed using #SUPPRESS OFFSETS except for tool offsets to ensure uniform positioning during calibration and measuring. Position the tool above the measuring station as centrally as possible either manually or in automatic mode. 1. The reference tool is positioned simultaneously in the X and Y directions above the configured focal point of the laser. 2. The reference tool moves to the configured starting point of the measurement in Z. 3. The focal point of the laser is detected in the Z direction at increased measuring speed. (When length measurement is active) 4. The focal point of the laser is determined in the Z direction at reduced measuring speed (increased measuring speed/2). (When length measurement is active) 5. A precision measurement is executed in the Z direction at slower measuring speed. (When length measurement is active) 6. The reference tool is positioned next to the laser and lowered. (When radius measurement is active) 7. The focal point of the laser is detected in the XY direction at increased measuring speed. (When ra- dius measurement is active) 8. The focal point of the laser is detected in the XY direction at reduced measuring speed. (When radius measurement is active) 9. A lateral measurement in XY is executed. (When radius measurement is active) 10. The reference tool is returned to the starting point position. 2.6.3.2 Parameters Required input parameters Cycle parameters Description @P65 type 0: length measurement 1: radius measurement 2: length and radius measurement @P66 Measurement offset in Z for lateral measurements [mm, inch] Only positive values are permissible. Optional input parameters Cycle Description parameters @P13 Clearance for lateral measurements [mm, inch] Default value = current tool diameter @P23 Precision measurement repetitions Default value = 1 @P33 Crossover range during measurement process [mm, inch] Additional motion path after expected workpiece edge is reached Default value = current tool diameter (V. G. WZ_AKT. R) @P37 Permissible tolerance of measuring point scatter. Default value = 1/100 (1/2 * current tool diameter) (1/100* V. G. WZ_AKT. R) If the difference of the measured values exceeds this tolerance, an error is output. 44 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 45

Calibrating and measuring @P67 Lateral offset for length measurements [mm, inch] Only positive values are permissible. The value should stand at 0 for pointed tools, small tools and spherical tools. Default value = 0 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.6.3.3 Syntax L CYCLE [ NAME = Sys Calib Laser System.ecy @P.. = .. ] 2.6.3.4 Programming example Calibrating laser T1 D1 G53 G00 Z750 G00 X10 Y20 L CYCLE [NAME=Sys Calib Laser System.ecy \ @P23 = 2 \ @P37 = 0.05 \ @P65 = 2 \ @P66 = 5 \ @P67 = 5 ] G00 Z750 M30 2.6.3.5 Output variables Cycle parameters Description V. CYC. Sys Ret Laser Pos X Detected position of the laser focal point in the X axis V. CYC. Sys Ret Laser Pos Y Detected position of the laser focal point in the Y axis V. CYC. Sys Ret Laser Pos Z Detected position of the laser focal point in the Z axis V. CYC. Sys Ret Offset Length Detected length offset V. CYC. Sys Ret Offset Radius Detected radius offset See information on use of the output variables [} 12]. After completing the calibration process, enter the detected position of the laser focal point and the measuring and positioning directions in the configuration file [} 42]. TF5225 | Twin CAT 3 CNC Version: 1.321 45 Measurement
## Page 46

Calibrating and measuring 2.7 Measure laser tool 2.7.1 Overview Task Automatic measurement of tool parameters. 46 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 47

Calibrating and measuring 2.7.2 Description NOTICE Possible damage to laser measuring station: The tool diameter may not be greater than the distance between the laser transmitter and receiver. NOTICE During the cycle, all active offsets must be suppressed using #SUPPRESS OFFSETS ex- cept for tool offsets to ensure uniform positioning during calibration and measuring. 2.7.2.1 Configuration files The Sys Calib Config Laser.nc file must be present in the form of a subroutine. It contains the laser parameters. Laser position data can be detected using the calibration cycle [} 44]. Variable Description V. CYC. LASER_BRAKEOFFSET_FAST Return clearance for fast measurement V. CYC. LASER_BRAKEOFFSET Return clearance for precision measurement V. CYC. MEAS_FEED_FAST Measuring feed for fast measurement V. CYC. MEAS_FEED_SLOW Measuring feed for precision measurement V. CYC. MEAS_MODE Mode 0 = push (default), 1 = pull V. CYC. DIRECTION Definition of measuring and positioning direction: 0- Measurement takes place in X- direction 1- Measurement takes place in Y- direction 2- Measurement takes place in X+ direction 3- Measurement takes place in Y+ direction V. CYC. LASER_POS_X Position of the laser focal point in the X axis V. CYC. LASER_POS_Y Position of the laser focal point in the Y axis V. CYC. LASER_POS_Z Position of the laser focal point in the Z axis V. CYC. LASER_Z_START_POS Start point of first measurement in Z. V. CYC. LASER_Z_END_POS End point of first measurement in Z. For example, the configuration file Sys Calib Config Laser.nc may look like this: Configuration file %Sys Calib Config Laser.nc V. CYC. LASER_POS_X = 10 ;position of the laser focal point V. CYC. LASER_POS_Y = 20 ;position of the laser focal point V. CYC. LASER_POS_Z = 700; position of the laser focal point (0 = measurement direction X -) (1 = measurement direction Y -) (2 = measurement direction X +) (3 = measurement direction Y +) V. CYC. DIRECTION = 1 ;position / measurement direction V. CYC. LASER_BRAKEOFFSET = 0.5 ;ret. clear. for precision measurement V. CYC. MEAS_FEED_FAST = 500 ;meas feed for fast measurement V. CYC. MEAS_FEED_SLOW = 10 ;meas feed for precision measurement V. CYC. LASER_Z_START_POS = V. CYC. LASER_POS_Z + 5 ;start of 1st meas in Z V. CYC. LASER_Z_END_POS = V. CYC. LASER_POS_Z - 5 ;end of 1st meas in Z M17 TF5225 | Twin CAT 3 CNC Version: 1.321 47 Measurement
## Page 48

Calibrating and measuring Optionally, the two subroutine files below can be saved. They control the activation and deactivation of the lasers: 1. Sys Calib Config Laser On.nc 2. Sys Calib Config Laser Off.nc A distinction is made between push and pull measurements. 48 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 49

Calibrating and measuring 2.7.2.2 Pre- and post-files For this cycle there are pre-files which are called before this cycle and post-files which are called after each cycle. These files are optional. If they do not exist, this step is skipped. As required, these files must therefore be created as a subroutine. Machine-specific adaptations, e.g. laser activation, can be executed in the pre-file. The post-file can be used to process output variables, for example. There is a general pre-file and a general post-file which are used for all laser cycles. • Sys Meas Laser Pre.nc • Sys Meas Laser Post.nc These files are only valid for this cycle and consist of the following: cycle name +Pre.nc or +Post.nc • Sys Meas Laser Tool Pre.nc • Sys Meas Laser Tool Post.nc The call sequence is as follows: • cycle call • Sys Meas Laser Pre.nc • Sys Meas Laser Tool Pre.nc • Cycle execution • Sys Meas Laser Tool Post.nc • Sys Meas Laser Post.nc 2.7.2.3 General cycle process The cycles call internally different subroutines. Example based on Sys Meas Laser Tool.ecy 1. Sys Meas Laser Pre.nc (optional) 2. Sys Meas Laser Tool Pre.nc (optional) 3. Sys Calib Config Laser.nc 4. Sys Meas Laser Tool Post.nc (optional) 5. Sys Meas Laser Post.nc (optional) TF5225 | Twin CAT 3 CNC Version: 1.321 49 Measurement
## Page 50

Calibrating and measuring 2.7.3 Measure length and radius This cycle determines the parameters of a tool (length and radius) using a laser. 2.7.3.1 Internal cycle process During the cycle, all active offsets must be suppressed using #SUPPRESS OFFSETS except for tool offsets to ensure uniform positioning during calibration and measuring. Position the tool above the measuring station as centrally as possible either manually or in automatic mode. 1. The reference tool is positioned simultaneously in the X and Y directions above the configured focal point of the laser. 2. The reference tool moves to the configured starting point of the measurement in Z. 3. The focal point of the laser is detected in the Z direction at increased measuring speed. (When length measurement is active) 4. The focal point of the laser is determined in the Z direction at reduced measuring speed (increased measuring speed/2). (When length measurement is active) 5. A precision measurement is executed in the Z direction at a slow measuring speed. (When length measurement is active) 6. The reference tool is positioned next to the laser and lowered. (When radius measurement is active) 7. The focal point of the laser is detected in the XY direction at increased measuring speed. (When ra- dius measurement is active) 8. The focal point of the laser is detected in the XY direction at reduced measuring speed. (When radius measurement is active) 9. A lateral measurement in XY is executed. (When radius measurement is active) 10. The reference tool is returned to the starting point position. 2.7.3.2 Parameters In addition to the parameters described, the Sys Calib Config Laser.nc calibration file [} 47] is executed during the cycle. Its function is to parameterise the laser measuring station and must be filled with the result values of the calibration cycle. Required input parameters Input parameters Description @P65 type 0: length measurement 1: radius measurement 2: length and radius measurement @P66 Measurement offset in Z for lateral measurements [mm, inch] Only positive values are permissible. Optional input parameters Input Description parameters @P13 Clearance for lateral measurements [mm, inch] Default value = current tool diameter (V. G. WZ_AKT. R*2) @P23 Precision measurement repetitions Default value = 1 50 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 51

Calibrating and measuring @P33 Crossover range during measurement process [mm, inch] Additional motion path that exceeds the expected contact point Default value = current tool diameter (V. G. WZ_AKT. R) @P37 Permissible tolerance of measuring point scatter. Default value = 1/100 current tool diameter (0.01V. G. WZ_AKT. R) If the difference of the measured values exceeds this tolerance, an error is output. @P67 Lateral offset for length measurements [mm, inch] Only positive values are permissible. The value should stand at 0 for pointed tools, small tools and spherical tools. Default value = 0 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.7.3.3 Syntax L CYCLE [ NAME = Sys Meas Laser Tool.ecy @P.. = .. ] 2.7.3.4 Programming example Measure length and radius T1 D1 M6 G53 G00 Z750 G00 X10 Y20 S1500 M3 L CYCLE [NAME=Sys Meas Laser Tool.ecy \ @P65 = 2 \ @P66 = 10 ] G00 Z750 M30 2.7.3.5 Output variables Variable Value V. CYC. Sys Ret Tool Length Detected tool length V. CYC. Sys Ret Tool Radius Detected tool radius V. CYC. Sys Ret Tool Offset Length Detected tool length difference V. CYC. Sys Ret Tool Offset Radius Detected tool radius difference For information on the use of output variables, see Handling output variables See information on use of the output variables [} 12]. Result values can be transferred to the tool database by using External Variables in the post-program, for example. TF5225 | Twin CAT 3 CNC Version: 1.321 51 Measurement
## Page 52

Calibrating and measuring 2.8 Laser tool breakage check 2.8.1 Overview Task Automatic breakage check of a tool. Possible applications This cycle can be used to check tools for breakage or wear during production to prevent damage to follow-on tools, for example. Programming The cycles are called with the L CYCLE[..] function and the required parameters are taken directly from the NC program. A more detailed description of the call is provided in the subsections for each of the cycles. Parameters The section Parameters describes the total overview of all parameters. Each cycle also has a modified parameter list which includes only the relevant parameters for the cycle. 52 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 53

Calibrating and measuring 2.8.2 General NOTICE The tool diameter may not be greater than the distance between the laser transmitter and receiver. NOTICE During the cycle, all active offsets must be suppressed using #SUPPRESS OFFSETS ex- cept for tool offsets to ensure uniform positioning during calibration and measuring. The 3 files must be present and configured before use, otherwise the cycles cannot run. 1. Sys Calib Config Laser.nc 2. Sys Calib Config Laser On.nc 3. Sys Calib Config Laser Off.nc Depending on the parameters, a machine stop is executed in the event of a tool breakage or a warning with the error message P-ERR-13461 is output. If wear exceeds the specified tolerance, the machine is stopped depending on the parameters or a warning with the error message P-ERR-13450 is output. 2.8.2.1 Configuration files The Sys Calib Config Laser.nc file is executed before each cycle to calibrate the laser. Variable Description V. CYC. LASER_BRAKEOFFSET_FAST Return clearance for fast measurement V. CYC. LASER_BRAKEOFFSET Return clearance for precision measurement V. CYC. MEAS_FEED_FAST Measuring feed for fast measurement V. CYC. MEAS_FEED_SLOW Measuring feed for precision measurement V. CYC. MEAS_MODE Mode 0 = push (default), 1 = pull V. CYC. DIRECTION Definition of measuring and positioning direction: 0- Measurement takes place in X- direction 1- Measurement takes place in Y- direction 2- Measurement takes place in X+ direction 3- Measurement takes place in Y+ direction V. CYC. LASER_POS_X Position of the laser focal point in the X axis V. CYC. LASER_POS_Y Position of the laser focal point in the Y axis V. CYC. LASER_POS_Z Position of the laser focal point in the Z axis V. CYC. LASER_Z_START_POS Start point of first measurement in Z. V. CYC. LASER_Z_END_POS End point of first measurement in Z. These 2 files control the activation and deactivation of the lasers: • Sys Calib Config Laser On.nc • Sys Calib Config Laser Off.nc TF5225 | Twin CAT 3 CNC Version: 1.321 53 Measurement
## Page 54

Calibrating and measuring 2.8.2.2 Pre- and post-files For this cycle there are pre-files which are called before this cycle and post-files which are called after each cycle. These files are optional. If they do not exist, this step is skipped. As required, these files must therefore be created as a subroutine. Machine-specific adaptations, e.g. laser activation, can be executed in the pre-file. The post-file can be used to process output variables, for example. There is a general pre-file and a general post-file which are used for all laser cycles. • Sys Meas Laser Pre.nc • Sys Meas Laser Post.nc These files are only valid for this cycle and consist of the following: cycle name +Pre.nc or +Post.nc • Sys Meas Laser Tool Break Pre.nc • Sys Meas Laser Tool Break Post.nc The call sequence is as follows: • cycle call • Sys Meas Laser Pre.nc • Sys Meas Laser Tool Break Pre.nc • Cycle execution • Sys Meas Laser Tool Break Post.nc • Sys Meas Laser Post.nc 2.8.2.3 General cycle process The cycles call internally different subroutines in this sequence. Measuring Example based on Sys Meas Laser Tool Break.ecy 1. Sys Meas Laser Pre.nc (optional) 2. Sys Meas Laser Tool Break Pre.nc (optional) 3. Sys Calib Config Laser.nc 4. Sys Meas Laser Tool Break Post.nc (optional) 5. Sys Meas Laser Post.nc (optional) 54 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 55

Calibrating and measuring 2.8.3 Breakage check Position the tool above the measuring station as centrally as possible either manually or in automatic mode. 2.8.3.1 Internal cycle process During the cycle, all active offsets must be suppressed using #SUPPRESS OFFSETS except for tool offsets to ensure uniform positioning during calibration and measuring. 1. The tool is positioned simultaneously in X and Y directions above the laser focal point including the ra- dius offset. (These values were defined in the file Sys Calib Config Laser.nc). 2. The focal point of the laser is detected in the Z direction at increased measuring speed. 3. The focal point of the laser is detected in the Z direction at reduced measuring speed (increased measuring speed/2).. 4. A precision measurement is executed in the Z direction at slower measuring speed in order to detect the tool length. 5. The device moves back in Z to the starting position. TF5225 | Twin CAT 3 CNC Version: 1.321 55 Measurement
## Page 56

Calibrating and measuring 2.8.4 Parameters In addition to the parameters described, the Sys Calib Config Laser.nc calibration file [} 47] is executed during the cycle. Its function is to parameterise the laser measuring station and must be filled with the result values of the calibration cycle. Input Description parameters @P33 Permissible tolerance of the measuring points to determine tool breakage. If this value is exceed, it is evaluated as a tool breakage. (default = 0.5) @P37 Permissible tolerance of the measuring points to determine tool wear. (default = 0.1) It the tolerance is too small, it may result in unnecessary machine stops. @P67 Radius offset (lateral offset when probing) Only positive values are permissible. Set the offset according to the tool measurement. (default = 0) @P70 0 (default) = warning when tool is worn, 1 = stop when tool is worn @P71 0 (default) = warning when tool breaks, 1 = stop when tool breaks It is recommended using the Syntax check to verify whether the input parameters have been correctly assigned. 2.8.5 Syntax L CYCLE [ NAME = Sys Meas Laser Tool Break.ecy @P.. = .. ] 2.8.6 Programming example Laser tool breakage check T1 D1 (D10 shaft end cutter) M6 G53 G00 Z750 G00 X10 Y20 S1500 M3 L CYCLE [NAME=Sys Meas Laser Tool Break.ecy \ @P33 = 0.2 \ @P37 = 0.1 \ @P67 = 4.5 ] G00 Z750 M30 2.8.7 Output variables Variable Value V. CYC. Sys Ret Tool Is Worn Tool is worn (0=No, 1=Yes) V. CYC. Sys Ret Tool Is Broken Tool is broken (0=No, 1=Yes) V. CYC. Sys Ret Tool Length Detected tool length V. CYC. Sys Ret Tool Offset Length Detected tool length difference 56 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 57

Calibrating and measuring For information on the use of output variables, see Handling output variables See information on use of the output variables [} 12]. Result values can be transferred to the tool database by using External Variables in the post-program, for example. 2.9 Teach-in (sequence numbering) 2.9.1 Overview Task Measure the position and orientation of workpieces. Possible applications • Precise measuring of the position and orientation of a workpiece • Generate a machining coordinate system to compensate for the inclined position of the workpiece Programming The cycles are called with the L CYCLE[..] function and the required parameters are taken directly from the NC program. A more detailed description of the call is provided in the subsections for each of the cycles. The example below explains the typical programming of a teach-in based on the example of the Sys Meas Cs4.ecy cycle which determines the inclined position of a workpiece by 3 measurements. After the cycle is called, activate the machining coordinate system generated in the cycle to compensate for the inclined position of the workpiece. In addition, the example writes the calculated values of the machining coordinate system to a text file. This can be implemented in the NC program as follows: Teach-in #VAR V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Z V. CYC. Sys Ret A V. CYC. Sys Ret B V. CYC. Sys Ret C #ENDVAR T1 D1 M6 G00 G90 X140 Y-65 Z100 L CYCLE [NAME=Sys Meas Cs4.ecy \ @P6 = 50 \ @P17 = 30 \ @P18 = 30 \ @P39 = 2 \ @P41 = 40 \ @P42 = 60 \ @P44 = 50 \ ] G00 G91 Z100 #FILE NAME [MSG="Sys Mea Cs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] #MSG SAVE ["V. CYC. Sys Ret A =%f", V. CYC. Sys Ret A] #MSG SAVE ["V. CYC. Sys Ret B =%f", V. CYC. Sys Ret B] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] L CS_BASE_2.bcs G0 G90 X0 Y0 Z100 TF5225 | Twin CAT 3 CNC Version: 1.321 57 Measurement
## Page 58

Calibrating and measuring ... machining ... #CS OFF M30 To enable program execution, a configuration file [} 60] must also be saved as NC program. 58 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 59

Calibrating and measuring 2.9.2 Description These cycles are used to determine the precise position, orientation and zero position using a touch probe or a reference tool. The values determined are written to a subroutine. The measurement results are on V. CYC variables (output variables) and can be processed in the post files. 2.9.2.1 General A axis is the designation for the rotary axis about X. B axis is the designation for the rotary axis about Y. C axis is the designation for the rotary axis about Z. The Sys Calib Config Touchprobe.nc file is not used for manual teach-in. If no measuring signal is triggered during the measurement, the machine stops with the error message: “No workpiece detected, please check your measuring section.“ P-ERR-13413 If a measurement is detected during positioning, the machine stops with the error message: “Collision on positioning, please check your motion range.“ P-ERR-13414 The Sys Calib Config Touchprobe.nc file must be present and configured before the cycles are used, otherwise the cycles cannot run. At the end of the cycles, a file is written CS_BASE_[CS ID @P39].bcs. NOTICE If the file already exists, it is deleted and a new file is written. No back-up is made! From then on, the file can be called from any program. The generated program defines the required coordinate system (CS) and enables it immediately. 2.9.2.2 Parameters The input parameters are listed in the corresponding cycle subsection. TF5225 | Twin CAT 3 CNC Version: 1.321 59 Measurement
## Page 60

Calibrating and measuring 2.9.2.3 Configuration file The following items are required to successfully configure the touch probe: • the radius of the touch probe sphere, the offsets in X and Y and the length of the touch probe must be defined using the tool data. • The configuration file Sys Calib Config Touchprobe.nc was created, containing at least the measuring and positioning feed rates. Detailed description The Sys Calib Config Touchprobe.nc file is executed before each cycle to identify the touch probe parameters. The following variables must then be defined. Variable Description V. CYC. Sys Conf_Probes Measuring feed. _feed V. CYC. Sys Conf_Probes Positioning feed rate between measuring points. _feed_max V. CYC. Sys Conf_Spindl Definition whether the touch probe is to be positioned in the measurement e_orientation direction before every measurement run. 0 = touch probe is not positioned (default value). Touch probe must be in initial position before the start of the cycle. 1 = touch probe is positioned V. CYC. Sys Conf_Probes Measuring feed for a second probing at a slow speed. _feed_repeat If defined with a value > 0, the probe is retracted slightly after the first probing and the measurement is repeated. Default value = 0. V. CYC. Sys Conf_Probes Retraction distance in the measuring direction for the second probing at a slow _dist_repeat speed. Only used if V. CYC. Sys Conf_Probes_feed_repeat is greater than zero. Default value = 2. V. CYC. Sys Conf_Spindl Definition of the basic angle specified to position the touch probe. e_angle Only used if V. CYC. Sys Conf_Spindle_orientation = 1. Corresponds to the spindle position (M19) required for measuring in the positive X direction. Default value = 0. V. CYC. Sys Conf_Spindl Position of the spindle final position when positioned with M19. e_Pos_Dir Only used if V. CYC. Sys Conf_Spindle_orientation = 1. 0 = The spindle positions the touch probe clockwise when the touch probe tip is viewed from below (default value). 1 = The spindle positions the touch probe counter clockwise when the touch probe tip is viewed from below. V. CYC. Sys Conf_Probes Spindle feed rate for spindle positioning of the touch probe. _spdl_feed Default value = 200 V. CYC. Sys Conf_Probes Time in seconds to wait for the spindle to reposition before a corresponding _spdl_wait measurement run. Default value = 1 V. CYC. Sys Conf_Retract Feed rate from pre-positioning to start position. _Pre Pos_feed If 0 is specified, the pre-positioning velocity is used. Default value = 0 V. CYC. Sys Conf_Retract Retract velocity after measurement event _Meas_feed If 0 is specified, the measuring feed is used. Default value = 0 60 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 61

Calibrating and measuring Additional configuration data for the touch probe is read from the current tool data. The touch probe must therefore be defined as a current tool and its tool data must be saved (except for calibration). The tool data to be considered includes: • The radius of the touch probe sphere (V. G. WZ_AKT. R) • The length of the touch probe (V. G. WZ_AKT. L) • Horizontal offsets of the touch probe tip relative to the spindle flange (V. G. WZ_AKT. V. X and W. G. WZ_AKT. V. Y) The measurement results are calculated to include the offsets between the touch probe tip and the spindle flange and the radius of the touch probe sphere. For example, the configuration file Sys Calib Config Touchprobe.nc may look like this: Configuration file %Sys Calib Config Touchprobe.nc V. CYC. Sys Conf_Probes_feed = 500 (measuring feed rate) V. CYC. Sys Conf_Probes_feed_max = 1000 (positioning feed rate) V. CYC. Sys Conf_Spindle_orientation = 0 (positioning of probe) V. CYC. Sys Conf_Spindle_angle = 0 (probe basic angle) V. CYC. Sys Conf_Probes_feed_repeat = 0 (repetition feed rate) V. CYC. Sys Conf_Probes_dist_repeat = 2 (distance of repetition) V. CYC. Sys Conf_Probes_spdl_feed = 200 (spindle speed) V. CYC. Sys Conf_Probes_spdl_wait = 1 (dwell time) V. CYC. Sys Conf_Spindle_Pos_Dir = 0 (spindle pos. direction) V. CYC. Sys Conf_Retract_Pre Pos_feed = 0 (retract pre pos.feed rate) V. CYC. Sys Conf_Retract_Meas_feed = 0 (retract meas. feed rate) M17 2.9.2.4 Pre- and post-files For this cycle there are 2 pre-files which must be called before this cycle and 2 post-files which are called after each cycle. These files are optional. As required, these files can be created as a subroutine. You can make machine-.specific modifications in this file, such as: • Extend laser • Retract laser • Activate the touch probe etc. There is a general pre file and a general post file which are used for all Sys Meas Cs cycles. • Sys Meas Cs Pre.nc • Sys Meas Cs Post.nc In addition there is normally a separate file for each cycle and this is only valid for this particular cycle. Cyclename +Pre or Post +.nc • Sys Meas Cs1Pre.nc • Sys Meas Cs1Post.nc 2.9.2.5 General cycle process The cycles call internally different subroutines. Example based on Sys Meas Cs1.ecy TF5225 | Twin CAT 3 CNC Version: 1.321 61 Measurement
## Page 62

Calibrating and measuring Sys Meas Cs Pre.nc (optional) Sys Meas Cs1Pre.nc (optional) Sys Calib Config Touchprobe.nc Sys Meas Cs1Post.nc (optional) Sys Meas Cs Post.nc (optional) 62 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 63

Calibrating and measuring 2.9.3 Teach-in A CS is determined and saved to record several points. 2.9.3.1 Sys Meas Cs1 - Manual teach-in • 3 points must be approached manually. • A pointed tool is suitable for this method. • No touch probe is required. 3 2 1 Z Y X Fig. 10: Manual teach-in 2.9.3.1.1 Process (internal cycle) 1. After the start of the cycle you are requested to approach the first point. Bottom left corner. 2. Required: X0Y0Z0 3. Press Start again. 4. You are requested to approach the second point. 5. One point along the positive X axis. 6. Press Start again. 7. You are requested to approach the third point. 8. Positive on the X and Y surface viewed from the first point. 9. Press Start a final time to end the cycle. 10. A new file is written CS_BASE_[CS ID @P39].bcs 2.9.3.1.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P39 Select the required CS to be written. Value range: 1-10 It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. TF5225 | Twin CAT 3 CNC Version: 1.321 63 Measurement
## Page 64

Calibrating and measuring 2.9.3.1.3 Syntax L CYCLE [ NAME = Sys Meas Cs1.ecy @P.. = .. ] 64 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 65

Calibrating and measuring 2.9.3.1.4 Programming example Manual teach-in T9 D9 M6 L CYCLE [NAME= Sys Meas Cs1.ecy @P39=1] M30 Another example for handling Sys Meas Cs cycles is contained in the Overview section [} 57] in the subsection Programming. 2.9.3.1.5 Example of a program generated CS_BASE_1.bcs #COMMENT BEGIN CS X = 1421.5527 CS Y = -46.6678 CS Z = 719.0895 CS A = -0.005 CS B = 0.0387 CS C = -0.0222 #COMMENT END #CS DEF [1][1421.5527,-46.6678,719.0895,-0.005,0.0387,-0.0222] #CS ON [1] M17 2.9.3.1.6 Output variables Variable Value V. CYC. Sys Ret X The calculated X value V. CYC. Sys Ret Y The calculated Y value V. CYC. Sys Ret Z The calculated Z value V. CYC. Sys Ret A The calculated A value V. CYC. Sys Ret B The calculated B value V. CYC. Sys Ret C The calculated C value For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 65 Measurement
## Page 66

Calibrating and measuring 2.9.3.2 Sys Meas Cs2 - Semi-automatic teach-in 7 points must be pre-positioned manually. The measurements are executed automatically in conjunction with a touch probe. Fig. 11: Semi-automatic teach-in 2.9.3.2.1 Process (internal cycle) 1. The touch probe must be positioned manually or in automatic mode in the proximity of the front left corner so that the probe can reach all points without collision. 2. Measurement in Z direction as follows. 3. After the start of the cycle, the touch probe must be positioned manually above the 1st measuring point. 4. Press Start again to start the measurement run. 5. Repeat this process with point 2 and point 3. 6. The orientation of the top surface is calculated. 7. Measurements in X direction as follows. 8. Then approach starting point 4 and press Start again. 9. Afterwards, approach starting point 5 and press Start again. 10. Measurements in Y as follows. 11. Approach point 6 manually and press Start. 12. Finally, approach point 7 manually and press Start. 13. The orientation about the Z axis is calculated using points 4 to 7. 14. A new file is written CS_BASE_[CS ID @P39].bcs NOTICE If the file already exists, it is deleted and a new file is written. No back-up is made! 2.9.3.2.2 Parameters Required input parameters Input parameters Description @P4 Measurement path in X axis 66 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 67

Calibrating and measuring @P5 Measurement path in Y axis @P6 Measurement path in the direction of the negative Z axis @P39 Select the required CS to be written. Value range: 1-10 Optional input parameters Input parameters Description @P9 Shift the measuring point along the X axis (default: 0) @P10 Shift the measuring point along the Y axis (default: 0) @P11 Shift the measuring point along the Z axis (default: 0) @P14 Angle 1 - Basic setting of the A axis (default: 0) @P15 Angle 2 - Basic setting of the B axis (default: 0) @P16 Angle 3 - Basic setting of the C axis (default: 0) The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.9.3.2.3 Syntax L CYCLE [ NAME = Sys Meas Cs2.ecy @P.. = .. ] TF5225 | Twin CAT 3 CNC Version: 1.321 67 Measurement
## Page 68

Calibrating and measuring 2.9.3.2.4 Programming example Semi-automatic teach-in T9 D9 M6 L CYCLE [NAME= Sys Meas Cs2.ecy \ @P4 = 30 \ @P5 = 30 \ @P6 = -40 \ @P9 = 0 \ @P10 = 0 \ @P11 = 0 \ @P14 = 0 \ @P15 = 90 \ @P16 = 0 \ @P39 = 3 \ ] M30 Another example for handling Sys Meas Cs cycles is contained in the Overview section [} 57] in the subsection Programming. 2.9.3.2.5 Example of a program generated CS_BASE_1.bcs #COMMENT BEGIN CS X = 1421.5527 CS Y = -46.6678 CS Z = 719.0895 CS A = -0.005 CS B = 0.0387 CS C = -0.0222 #COMMENT END #CS DEF [1][1421.5527,-46.6678,719.0895,-0.005,0.0387,-0.0222] #CS ON [1] M17 2.9.3.2.6 Output variables Variable Value V. CYC. Sys Ret X The calculated X value V. CYC. Sys Ret Y The calculated Y value V. CYC. Sys Ret Z The calculated Z value V. CYC. Sys Ret A The calculated A value V. CYC. Sys Ret B The calculated B value V. CYC. Sys Ret C The calculated C value For information on the use of output variables, see Handling output variables [} 12] 68 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 69

Calibrating and measuring 2.9.3.3 Sys Meas Cs3 - Automatic teach-in 7 measurements are executed automatically depending on the defined parameters. Fig. 12: Automatic teach-in 2.9.3.3.1 Process (internal cycle) 1. The touch probe must be positioned manually or in automatic mode in the proximity of the front left corner so that the probe can reach all points without collision. 2. First execute 3 measurements on the top surface. 3. Then execute the two measurements on the X surface. 4. Finally, execute the two measurements on the Y surface. 5. If a retraction height was transferred, the touch probe is retracted to this height. 6. A new file is written CS_BASE_[CS ID @P39].bcs NOTICE If the file already exists, it is deleted and a new file is written. No back-up is made! 2.9.3.3.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P4 Measurement path in X axis @P5 Measurement path in Y axis @P6 Measurement path in the direction of the negative Z axis @P17 Pre-position in X @P18 Pre-position in Y @P19 Pre-position in Z TF5225 | Twin CAT 3 CNC Version: 1.321 69 Measurement
## Page 70

Calibrating and measuring @P39 Select the required CS to be written. Value range: 1-10 @P41 Pre-position in X2 @P42 Pre-position in X3 @P43 Pre-position in Y2 @P44 Pre-position in Y3 Optional input parameters Input parameters Description @P9 Shift the measuring point along the X axis (default: 0) @P10 Shift the measuring point along the Y axis (default: 0) @P11 Shift the measuring point along the Z axis (default: 0) @P49 Retraction height after measurement Default value = position after last measurement It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.9.3.3.3 Syntax L CYCLE [ NAME = Sys Meas Cs3.ecy @P.. = .. ] Another example for handling Sys Meas Cs cycles is contained in the Overview section [} 57] in the subsection Programming. 2.9.3.3.4 Programming example Automatic teach-in ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 G90 X1400 Y-65 Z735 #VAR ; input parameters: V. L. Meas Dist X = 30 V. L. Meas Dist Y = 30 V. L. Meas Dist Z = 40 V. L. Number CS = 2 V. L. Pre Pos X1 = 30 V. L. Pre Pos Y1 = 30 V. L. Pre Pos Z1 = -25 V. L. Pre Pos X2 = 40 V. L. Pre Pos Y2 = 40 V. L. Pre Pos X3 = 60 V. L. Pre Pos Y3 = 50 ; output variables: V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Z V. CYC. Sys Ret A V. CYC. Sys Ret B V. CYC. Sys Ret C #ENDVAR L CYCLE [NAME=Sys Meas Cs3.ecy @P4=V. L. Meas Dist X @P5=V. L. Meas Dist X \ @P6=V. L. Meas Dist Z @P17=V. L. Pre Pos X1 \ @P18=V. L. Pre Pos Y1 @P19=V. L. Pre Pos Z1 \ 70 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 71

Calibrating and measuring @P39=V. L. Number CS @P41=V. L. Pre Pos X2 \ @P42=V. L. Pre Pos X3 @P43=V. L. Pre Pos Y2 \ @P44=V. L. Pre Pos Y3] ; print result #FILE NAME [MSG="Sys Mea Cs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] #MSG SAVE ["V. CYC. Sys Ret A =%f", V. CYC. Sys Ret A] #MSG SAVE ["V. CYC. Sys Ret B =%f", V. CYC. Sys Ret B] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] ; calling the #CS by the subroutine written in the cycle L CS_BASE_2.bcs ; ... machining workpiece with measured coordinate system .... #CS OFF M30 TF5225 | Twin CAT 3 CNC Version: 1.321 71 Measurement
## Page 72

Calibrating and measuring 2.9.3.3.5 Example of a program generated CS_BASE_3.bcs #COMMENT BEGIN CS X = 1421.5527 CS Y = -46.6678 CS Z = 719.0895 CS A = -0.005 CS B = 0.0387 CS C = -0.0222 #COMMENT END #CS DEF [1][1421.5527,-46.6678,719.0895,-0.005,0.0387,-0.0222] #CS ON [1] M17 2.9.3.3.6 Output variables Variable Value V. CYC. Sys Ret X The calculated X value V. CYC. Sys Ret Y The calculated Y value V. CYC. Sys Ret Z The calculated Z value V. CYC. Sys Ret A The calculated A value V. CYC. Sys Ret B The calculated B value V. CYC. Sys Ret C The calculated C value For information on the use of output variables, see Handling output variables [} 12] 72 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 73

Calibrating and measuring 2.9.3.4 Sys Meas Cs4 - Align plane cycle Automated alignment of a plane by measuring three points on the workpiece surface. The cycle calculates a machining coordinate system (CS) to modify the angle position to a plane. The translatory shift of the calculated coordinate system causes a shift to the first measuring point on the plane. The calculated rotary shift causes an angle compensation related to the measured plane. Forming a new coordinate system The first point measured on the plane determines the relative shift of the coordinate system. The system can also be further shifted by the cycle input parameters @P9@P11. The rotation of the new coordinate system is calculated so that its X axis runs through the vector from the first to the second measured point (irrespective of the shift by the input parameters). The Y axis is obtained by the vertical projection of the line to the third measured point on the new X axis. The Z axis is defined in order to retain the original rectangular system representation. The graphic below describes the measurement of a horizontal XY plane. The measured points therefore have the same height in the original coordinate system.. This clearly shows that the selection of the pre- positions has an influence on the resulting coordinate system. Fig. 13: Resulting coordinate system 2.9.3.4.1 Process (internal cycle) Starting position before the cycle is called: The touch probe must be positioned at the start point manually or in automatic mode so that the probe can reach all points without collision. The internal cycle process can be described as follows: 1. The touch probe approaches the first pre-position specified in @P17 and @P18 relative to the start point. 2. Measurement in Z direction 3. The touch probe approaches the second pre-position in X direction specified in @P41 relative to the first measuring point. 4. Measurement in Z direction 5. The touch probe approaches the third pre-position specified in @P42 and @P44 relative to the start point. 6. Measurement in Z direction 7. If a retraction height was transferred, the touch probe is retracted to this height TF5225 | Twin CAT 3 CNC Version: 1.321 73 Measurement
## Page 74

Calibrating and measuring @P42 @P44 @P18 @P17 @P6 Z @P41 Y X Fig. 14: Align plane 2.9.3.4.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P6 Measurement path in the direction of the negative Z axis @P17 Pre-position in X of the first measuring point relative to the start point @P18 Pre-position in Y of the first measuring point relative to the start point @P39 Select the required CS to be written. Value range: 1-10 @P41 Pre-position in X of the second measuring point relative to the first measuring point @P42 Pre-position in X of the third measuring point relative to the start point @P44 Pre-position in Y of the third measuring point relative to the start point Optional input parameters Input parameters Description @P9 Shift the measurement result along the 1st axis (shifts origin of the calculated coordinate system) Default value = 0 @P10 Shift the measurement result along the 2nd axis (shifts origin of the calculated coordinate system) Default value = 0 @P11 Shift the measurement result along the 3rd axis (shifts origin of the calculated coordinate system) Default value = 0 74 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 75

Calibrating and measuring @P49 Retraction height after measurement Default value = position after last measurement It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.9.3.4.3 Syntax L CYCLE [ NAME = Sys Meas Cs4.ecy @P.. = .. ] 2.9.3.4.4 Programming example Align plane ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G00 G90 X1400 Y-65 Z735 #VAR ; input parameters: V. L. Meas Dist Z = 40 V. L. Number CS = 2 V. L. Pre Pos X1 = 30 V. L. Pre Pos Y1 = 30 V. L. Pre Pos X2 = 40 V. L. Pre Pos X3 = 60 V. L. Pre Pos Y3 = 50 ; output variables: V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Z V. CYC. Sys Ret A V. CYC. Sys Ret B V. CYC. Sys Ret C #ENDVAR L CYCLE [NAME=Sys Meas Cs4.ecy @P6=V. L. Meas Dist Z @P17=V. L. Pre Pos X1 \ @P18=V. L. Pre Pos Y1 @P39=V. L. Number CS \ @P41=V. L. Pre Pos X2 @P42=V. L. Pre Pos X3 \ @P44=V. L. Pre Pos Y3] ; print result #FILE NAME [MSG="Sys Mea Cs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] #MSG SAVE ["V. CYC. Sys Ret A =%f", V. CYC. Sys Ret A] #MSG SAVE ["V. CYC. Sys Ret B =%f", V. CYC. Sys Ret B] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] ; calling the #CS by the subroutine written in the cycle L CS_BASE_2.bcs ; ... machining workpiece with measured coordinate system .... #CS OFF M30 Example of a program generated: %CS_BASE_2.bcs #COMMENT BEGIN CS X = 1430 CS Y = -35 CS Z = 734,992 CS A = 0 TF5225 | Twin CAT 3 CNC Version: 1.321 75 Measurement
## Page 76

Calibrating and measuring CS B = 0 CS C = -0.0222 #COMMENT END #CS DEF [2][1430,-35,734.992,0,0,0] #CS ON [2] M17 Another example for handling Sys Meas Cs cycles is contained in the Overview section [} 57] in the subsection Programming. 2.9.3.4.5 Output variables Variable Value V. CYC. Sys Ret X value for the translatory shift of the calculated coordinate system. Corresponds to the X X value of the first measuring point. V. CYC. Sys Ret Y value for the translatory shift of the calculated coordinate system. Corresponds to the X Y value of the first measuring point. V. CYC. Sys Ret Z value for the translatory shift of the calculated coordinate system. Corresponds to the X Z value of the first measuring point. V. CYC. Sys Ret A value for the rotary shift of the calculated coordinate system. A V. CYC. Sys Ret A value for the rotary shift of the calculated coordinate system. B V. CYC. Sys Ret A value for the rotary shift of the calculated coordinate system. C For information on the use of output variables, see Handling output variables [} 12] 76 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 77

Calibrating and measuring 2.9.3.5 Sys Meas Cs5 - Teach-in with 3 spheres This cycle determines a coordinate system which is defined by the centre points of three spheres. The automatic measurement of the three spheres determines their centre points in order to calculate the necessary coordinate system parameters. The sphere diameter must be significantly greater than the sphere diameter of the touch probe for a successful calibration. A pre-positioning for the second and third spheres must be specified for the measurement. Here, an approximate parameter is sufficient. However, the deviation from the actual position of the spheres should be small. Forming a new coordinate system The centre point of the first sphere measured specifies the relative shift of the coordinate system. The system can also be further shifted by the cycle input parameters @P9@P11. The rotation of the new coordinate system is calculated so that its X axis runs through the vector from the centre point of the first sphere to the centre point of the second sphere (irrespective of the shift by the input parameters). The Y axis is obtained by the vertical projection of the centre point to the third sphere on the new X axis. The Z axis is defined in order to retain the original rectangular system representation. The graphic below describes the measurement of three spheres in the XY plane. The spheres therefore have the same height in the original coordinate system. Fig. 15: Measurement of three spheres in a plane It becomes obvious that the measurement order influences the resulting coordinate system. 2.9.3.5.1 Process (internal cycle) Starting position before the cycle is called: The touch probe must be positioned either manually or in automatic mode as centrally as possible and at a short clearance above the first sphere. It stands vertically, i.e. the touch probe rotation stands at 0. In addition, the touch probe must be in initial position. The position of the touch probe in the Z axis is retained for all pre-positions. The internal cycle process can be described as follows: 1. The touch probe first runs a measurement in the Z direction and a total of four lateral measurements, after which it returns to the starting position. If a measurement repetition was specified in @P88 to en- hance accuracy, the measurement is repeated, whereby the lateral measurements take place at the calculated height of the equator. TF5225 | Twin CAT 3 CNC Version: 1.321 77 Measurement
## Page 78

Calibrating and measuring 2. The touch probe approaches the second pre-position specified in @P41 and @P43 with constant Z position. 3. The second sphere is measured in the same way as in step 1. 4. The touch probe approaches the third pre-position specified in @P42 and @P44 with constant Z posi- tion. 5. The third sphere is measured in the same way as in step 1. 6. The touch probe returns to the starting position. @P42 @P44 @P15 @P14 @P6 @P43 @P41 @P13 @P33 Z Y @P87 X Fig. 16: Teach-in with 3 spheres 2.9.3.5.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input Description parameters @P6 Measurement path in the direction of the negative Z axis @P39 Select the required CS to be written. Value range: 1-10 @P41 Pre-position in X of the second measuring point relative to the start point @P42 Pre-position in X of the third measuring point relative to the start point @P43 Pre-position in Y of the second measuring point relative to the start point @P44 Pre-position in Y of the third measuring point relative to the start point @P87 Estimated diameter of the spheres. Here, an approximate parameter is sufficient. It is used to calculate the pre-positions. Optional input parameters Input parameters Description @P9 Shift the measurement result along the 1st axis (shifts origin of the calculated coordinate system) Default value = 0 @P10 Shift the measurement result along the 2nd axis (shifts origin of the calculated coordinate system) Default value = 0 @P11 Shift the measurement result along the Z axis (shifts origin of the calculated coordinate system) Default value = 0 @P13 Safety clearance for pre-positioning Default value = diameter of touch probe 78 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 79

Calibrating and measuring @P14 Probe angle of the first lateral measurement in relation to the positive 1st axis [degrees] Default value = 0 @P15 Difference of the probe angle between the lateral measurements [degrees] Default value = 90 @P33 Crossover range during measurement process Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = @P87/4 @P64 Definition of the path to approach to pre-position 0: linear (default value) 1: circular (Caution: collision detection is disabled) @P88 Measurement repetition at the height of the equator using calculated parameters from the first pass for enhanced accuracy 1: yes 2: no (default value) NOTICE Disabled collision detection when @P64 is active. If circular approach of the pre-position was selected in @P64, collision detection is disabled. This option may only be enabled if safe approach to the pre-position is ensured. It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.9.3.5.3 Syntax L CYCLE [ NAME = Sys Meas Cs5.ecy @P.. = .. ] 2.9.3.5.4 Programming example Teach-in with 3 spheres ; touch probe activation T1 D1 G53 ; deactivation of the zero offset G53 #VAR ; input parameters: V. L. Meas Dist Z = 40 V. L. Number CS = 2 V. L. Pre Pos X2 = 40 V. L. Pre Pos Y3 = 50 V. L. Pre Pos Y2 = 40 V. L. Pre Pos X3 = 60 V. L. Sphere Diameter = 20 ; output variables: V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Z V. CYC. Sys Ret A V. CYC. Sys Ret B V. CYC. Sys Ret C #ENDVAR L CYCLE [NAME=Sys Meas Cs5.ecy @P6 = V. L. Meas Dist Z @P39 = V. L. Number CS \ @P41=V. L. Pre Pos X2 @P42=V. L. Pre Pos X3 \ @P43 = V. L. Pre Pos Y2 @P44=V. L. Pre Pos Y3 \ @P87 = V. L. Sphere Diameter ] TF5225 | Twin CAT 3 CNC Version: 1.321 79 Measurement
## Page 80

Calibrating and measuring ; print result #FILE NAME [MSG="Sys Mea Cs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] #MSG SAVE ["V. CYC. Sys Ret A =%f", V. CYC. Sys Ret A] #MSG SAVE ["V. CYC. Sys Ret B =%f", V. CYC. Sys Ret B] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] ; calling the #CS by the subroutine written in the cycle L CS_BASE_2.bcs ; ... machining workpiece with measured coordinate system .... #CS OFF M30 Example of a program generated: %CS_BASE_2.bcs #COMMENT BEGIN CS X = 1430 CS Y = -35 CS Z = 734,992 CS A = 0 CS B = 0 CS C = -0.0222 #COMMENT END #CS DEF [2][1430,-35,734.992,0,0,0] #CS ON [2] M17 Another example for handling Sys Meas Cs cycles is contained in the Overview section [} 57] in the subsection Programming. 2.9.3.5.5 Output variables Variable Value V. CYC. Sys Ret X Relative shift of the calculated coordinate system in the first axis V. CYC. Sys Ret Y Relative shift of the calculated coordinate system in the second axis V. CYC. Sys Ret Z Relative shift of the calculated coordinate system in the third axis V. CYC. Sys Ret A Rotation of the calculated coordinate system about the first axis (rotation sequence ZYX) V. CYC. Sys Ret B Rotation of the calculated coordinate system about the second axis (rotation sequence ZYX) V. CYC. Sys Ret C Rotation of the calculated coordinate system about the third axis (rotation sequence ZYX) V. CYC. Sys Ret Diameter1 Determined sphere diameter of the first sphere V. CYC. Sys Ret Center X1 Determined sphere centre point of the first sphere - first axis V. CYC. Sys Ret Center Y1 Determined sphere centre point of the first sphere - second axis V. CYC. Sys Ret Center Z1 Determined sphere centre point of the first sphere - third axis V. CYC. Sys Ret Diameter2 Determined sphere diameter of the second sphere V. CYC. Sys Ret Center X2 Determined sphere centre point of the second sphere - first axis V. CYC. Sys Ret Center Y2 Determined sphere centre point of the second sphere - second axis V. CYC. Sys Ret Center Z2 Determined sphere centre point of the second sphere - third axis V. CYC. Sys Ret Diameter3 Determined sphere centre point of the second sphere - first axis V. CYC. Sys Ret Center X3 Calculate sphere centre point of the third sphere - first axis V. CYC. Sys Ret Center Y3 Determined sphere centre point of the third sphere - second axis V. CYC. Sys Ret Center Z3 Determined sphere centre point of the third sphere - third axis For information on the use of output variables, see Handling output variables [} 12] 80 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 81

Calibrating and measuring 2.10 Workpiece Coordinate System (WCS) 2.10.1 Overview Task This instruction describes the automatic measurement of workpieces. In addition, a zero offset is written to offset the origin of the machining coordinate system to match the workpiece, Possible applications The following applications are conceivable: • Precise measurement of workpieces before or after machining • Generating a zero offset to match the workpiece to simplify the programming for machining • Measuring machining operations with active zero offset Programming The cycles are called with the L CYCLE[..] function and the required parameters are taken directly from the NC program. A more detailed description of the call is provided in the subsections for each of the cycles. The section below explains the typical programming of a teach-in based on the example of the Sys Meas Wcs7.ecy cycle which determines the corner point of a rectangular workpiece by 3 measurements. After calling the cycle, the zero offset generated in the cycle is activated and traverses over the corner point of the workpiece. In addition, the example writes the coordinates of the corner point to a text file. This can be implemented in the NC program as follows: TCS measurement: Set zero offset (G54) followed by machining to zero offset (G54) #VAR V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Z #ENDVAR T1 D1 M6 G53 G00 G90 X-50 Y-50 G00 G91 Z-100 L CYCLE [NAME=Sys Meas Wcs7.ecy \ @P4 = 10 \ @P5 = 10 \ @P6 = -10 \ @P7 = 54 \ @P9 = 0 \ @P10 = 0 \ @P11 = -2 \ @P17 = 20 \ @P18 = 30 \ @P19 = -15 \ ] G00 G91 Z100 #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] G54 G0 G90 X0 Y0 Z200 ... Workpiece machining .... G53 M30 TF5225 | Twin CAT 3 CNC Version: 1.321 81 Measurement
## Page 82

Calibrating and measuring TCS measurement: Measure with active zero offset (G54) #VAR V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Z #ENDVAR T1 D1 M6 G54 G00 G90 X-5 Y-5 G00 G90 Z5 L CYCLE [NAME=Sys Meas Wcs7.ecy \ @P4 = 10 \ @P5 = 10 \ @P6 = -10 \ @P9 = 0 \ @P10 = 0 \ @P11 = -2 \ @P17 = 20 \ @P18 = 30 \ @P19 = -15 \ ] G00 G90 Z100 #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] G53 M30 To enable program execution, a configuration file [} 84] must also be saved as NC program. 82 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 83

Calibrating and measuring 2.10.2 Description 2.10.2.1 General P-ERR-13413. If a measurement is detected during positioning, the machine stops with the error message: “Collision on positioning, please check your motion range.“ P-ERR-13414. The measurement results are on V. CYC variables (output variables) and can be processed in the post files. TF5225 | Twin CAT 3 CNC Version: 1.321 83 Measurement
## Page 84

Calibrating and measuring 2.10.2.2 Pre- and post-files For this cycle there are 2 pre-files which must be called before this cycle and 2 post-files which are called after each cycle. These files are optional. As required, these files can be created as a subroutine. You can make machine-.specific modifications in this file, such as: • Extend laser • Retract laser • Activate the touch probe etc. There is a general pre file and a general post file which are used for all Sys Meas Wcs cycles. • Sys Meas Wcs Pre.nc • Sys Meas Wcs Post.nc In addition there is normally a separate file for each cycle and this is only valid for this particular cycle. Cyclename +Pre or Post +.nc • Sys Meas Wcs1Pre.nc • Sys Meas Wcs1Post.nc 2.10.2.3 Configuration file The following items are required to successfully configure the touch probe: • the radius of the touch probe sphere, the offsets in X and Y and the length of the touch probe must be defined using the tool data. • The configuration file Sys Calib Config Touchprobe.nc was created, containing at least the measuring and positioning feed rates. Detailed description The Sys Calib Config Touchprobe.nc file is executed before each cycle to identify the touch probe parameters. The following variables must then be defined. Variable Description V. CYC. Sys Conf_Probes Measuring feed during measurement. _feed V. CYC. Sys Conf_Probes Positioning feed rate between measuring points. _feed_max V. CYC. Sys Conf_Spindl Definition whether the touch probe is to be positioned in the measurement e_orientation direction before every measurement run. 0 = touch probe is not positioned (default value). Touch probe must be in initial position before the start of the cycle. 1 = touch probe is positioned V. CYC. Sys Conf_Probes Measuring feed for a second probing at a slow speed. _feed_repeat If defined with a value > 0, the probe is retracted slightly after the first probing and the measurement is repeated. Default value = 0. V. CYC. Sys Conf_Probes Retraction distance in the measuring direction for the second probing at a slow _dist_repeat speed. Only used if V. CYC. Sys Conf_Probes_feed_repeat is greater than zero. Default value = 2. 84 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 85

Calibrating and measuring V. CYC. Sys Conf_Spindl Definition of the basic angle specified to position the touch probe. e_angle Only used if V. CYC. Sys Conf_Spindle_orientation = 1. Corresponds to the spindle position (M19) required for measuring in the positive X direction. Default value = 0. V. CYC. Sys Conf_Spindl Position of the spindle final position when positioned with M19. e_Pos_Dir Only used if V. CYC. Sys Conf_Spindle_orientation = 1. 0 = The spindle positions the touch probe clockwise when the touch probe tip is viewed from below (default value). 1 = The spindle positions the touch probe counter clockwise when the touch probe tip is viewed from below. V. CYC. Sys Conf_Probes Spindle feed rate for spindle positioning of the touch probe. _spdl_feed Default value = 200 V. CYC. Sys Conf_Probes Time in seconds to wait for the spindle to reposition before a corresponding _spdl_wait measurement run. Default value = 1 V. CYC. Sys Conf_Retract Feed rate from pre-positioning to start position. _Pre Pos_feed If 0 is specified, the pre-positioning velocity is used. Default value = 0 V. CYC. Sys Conf_Retract Retract velocity after measurement event _Meas_feed If 0 is specified, the measuring feed is used. Default value = 0 Additional configuration data for the touch probe is read from the current tool data. The touch probe must therefore be defined as a current tool and its tool data must be saved (except for calibration). The tool data to be considered includes: • The radius of the touch probe sphere (V. G. WZ_AKT. R) • The length of the touch probe (V. G. WZ_AKT. L) • Horizontal offsets of the touch probe tip relative to the spindle flange (V. G. WZ_AKT. V. X and W. G. WZ_AKT. V. Y) The measurement results are calculated to include the offsets between the touch probe tip and the spindle flange and the radius of the touch probe sphere. For example, the configuration file Sys Calib Config Touchprobe.nc may look like this: Configuration file %Sys Calib Config Touchprobe.nc V. CYC. Sys Conf_Probes_feed = 500 (measuring feed rate) V. CYC. Sys Conf_Probes_feed_max = 1000 (positioning feed rate) V. CYC. Sys Conf_Spindle_orientation = 0 (positioning of probe) V. CYC. Sys Conf_Spindle_angle = 0 (probe basic angle) V. CYC. Sys Conf_Probes_feed_repeat = 0 (repetition feed rate) V. CYC. Sys Conf_Probes_dist_repeat = 2 (distance of repetition) V. CYC. Sys Conf_Probes_spdl_feed = 200 (spindle speed) V. CYC. Sys Conf_Probes_spdl_wait = 1 (dwell time) V. CYC. Sys Conf_Spindle_Pos_Dir = 0 (spindle pos. direction) V. CYC. Sys Conf_Retract_Pre Pos_feed = 0 (retract pre pos.feed rate) V. CYC. Sys Conf_Retract_Meas_feed = 0 (retract meas. feed rate) M17 TF5225 | Twin CAT 3 CNC Version: 1.321 85 Measurement
## Page 86

Calibrating and measuring 2.10.2.4 General cycle process The cycles call internally different subroutines. Example based on Sys Meas Cs1.ecy Sys Meas Wcs Pre.nc (optional) Sys Meas Wcs1Pre.nc (optional) Sys Calib Config Touchprobe.nc Sys Meas Wcs1Post.nc (optional) Sys Meas Wcs Post.nc (optional) 86 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 87

Calibrating and measuring 2.10.3 Single point measurement Only one point is approached in these cycles. The calculated value is transferred to the selected zero offset. 2.10.3.1 Measure in X axis After positioning, the touch probe measures along the X axis until it contacts a workpiece. The touch probe must be positioned at measuring depth in front of the required surface, either manually or in automatic mode, before the cycle is started. Fig. 17: Measure in X axis 2.10.3.1.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Measurement takes place from the starting point viewed in the X- direction. 2. When the measurement is completed, the device moves back to the starting point. 3. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 87 Measurement
## Page 88

Calibrating and measuring 2.10.3.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P4 Measurement path in the X axis (incremental) Positive value: the touch probe moves in positive X direction Negative value: the touch probe moves in negative X direction Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.3.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs1.ecy @P.. = .. ] 2.10.3.1.4 Programming example Measure in X axis ; touch probe activation T1 D1 M6 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X-50 Y0 G0 Z-10 #VAR ; input parameters: V. L. Meas Dist X = 10 V. L. Zero Offset Number = 54 ; output variables: V. CYC. Sys Ret X #ENDVAR ; cycle call L CYCLE [NAME="Sys Meas Wcs1.ecy" \ @P4 = V. L. Meas Dist X \ @P7 = V. L. Zero Offset Number \ ] 88 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 89

Calibrating and measuring ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] G54 ; ... machining workpiece with measured zero offset .... G53 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.3.1.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value of workpiece For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 89 Measurement
## Page 90

Calibrating and measuring 2.10.3.2 Measure in Y axis After positioning, the touch probe measures along the Y axis until it contacts a workpiece. The touch probe must be positioned at measuring depth in front of the required surface, either manually or in automatic mode, before the cycle is started. Fig. 18: Measure in Y axis 2.10.3.2.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Measurement takes place from the starting point in the Y direction. 2. When the measurement is completed, the device moves back to the starting point. 3. Description of selected zero offset. 90 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 91

Calibrating and measuring 2.10.3.2.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P5 Measurement path in the Y axis (incremental) Positive value: the touch probe moves in positive Y direction Negative value: the touch probe moves in negative Y direction Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P10 Shift the measuring point along the Y axis It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.3.2.3 Syntax L CYCLE [ NAME = Sys Meas Wcs2.ecy @P.. = .. ] 2.10.3.2.4 Programming example Measure in Y axis ; touch probe activation T1 D1 M6 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y-50 Z-10 #VAR ;input parameters V. L. Meas Dist Y = 10 V. L. Zero Offset Number = 54 ;output parameters V. CYC. Sys Ret Y #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs2.ecy" \ @P5=V. L. Meas Dist Y \ @P7=V. L. Zero Offset Number ] ; print result TF5225 | Twin CAT 3 CNC Version: 1.321 91 Measurement
## Page 92

Calibrating and measuring #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.3.2.5 Output variables Variables Value V. CYC. Sys Ret Y Calculated Y value of workpiece For information on the use of output variables, see Handling output variables [} 12] 92 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 93

Calibrating and measuring 2.10.3.3 Measure in Z axis After positioning, the touch probe measures along the Z axis until it contacts a workpiece. The touch probe must be positioned at measuring depth in front of the required surface, either manually or in automatic mode, before the cycle is started. Fig. 19: Measure in Z axis 2.10.3.3.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Measurement takes place from the starting point in the Z direction. 2. When the measurement is completed, the device moves back to the starting point. 3. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 93 Measurement
## Page 94

Calibrating and measuring 2.10.3.3.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P6 Measurement path in the Z axis (incremental) Positive value, the touch probe moves in positive Z direction Negative value, the touch probe moves in negative Z direction Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P11 Shift the measuring point along the Z axis It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.3.3.3 Syntax L CYCLE [ NAME = Sys Meas Wcs3.ecy @P.. = .. ] 2.10.3.3.4 Programming example Measure in Z axis ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ; input parameters: V. L. Meas Dist Z = -10 V. L. Zero Offset Number = 54 ; output variables: V. CYC. Sys Ret Z #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs3.ecy" \ @P6=V. L. Meas Dist Z \ @P7=V. L. Zero Offset Number ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] 94 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 95

Calibrating and measuring #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.3.3.5 Output variables Variable Value V. CYC. Sys Ret Z Calculated Z value of workpiece For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 95 Measurement
## Page 96

Calibrating and measuring 2.10.4 Two point measurement 2 points are approached in these cycles. The determined values are transferred to the selected zero offset. 2.10.4.1 Measure in X and Y axes After positioning, the touch probe first measures along the X axis until it contacts a workpiece. After repositioning measurement takes place in Y direction. The touch probe must be positioned either manually or in automatic mode so that it can be positioned in front of the measuring surface in X and Y axes. Fig. 20: Measure in X and Y axes 2.10.4.1.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in front of the measuring surface in Y and then measure in X direction. 2. After clearance, the device moves back to the starting point. 3. Pre-position in front of the measuring surface in X and then measure in Y direction. 4. After clearance, the device moves back to the starting point. 5. Description of selected zero offset. 96 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 97

Calibrating and measuring 2.10.4.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P4 Measurement path in the X axis (incremental) Positive value, the touch probe moves in positive X direction Negative value, the touch probe moves in negative X direction @P5 Measurement path in the Y axis (incremental) Positive value, the touch probe moves in positive Y direction Negative value, the touch probe moves in negative Y direction Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P17 Pre-position along the X axis Default value = @P4 @P18 Pre-position along the Y axis Default value = @P5 It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.4.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs4.ecy @P.. = .. ] 2.10.4.1.4 Programming example Measure in X and Y axes ; touch probe activation T1 D1 M6 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X-50 Y-50 Z-10 #VAR ; input parameters: TF5225 | Twin CAT 3 CNC Version: 1.321 97 Measurement
## Page 98

Calibrating and measuring V. L. Meas Dist X = 10 V. L. Meas Dist Y = 10 V. L. Zero Offset Number = 54 V. L. Positioning X = 15 V. L. Positioning Y = 20 ; output variables: V. CYC. Sys Ret X V. CYC. Sys Ret Y #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs4.ecy" \ @P4 = V. L. Meas Dist X \ @P5 = V. L. Meas Dist Y \ @P7 = V. L. Zero Offset Number \ @P17 = V. L. Positioning X \ @P18 = V. L. Positioning Y \ ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.4.1.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value of workpiece V. CYC. Sys Ret Y Calculated Y value of workpiece For information on the use of output variables, see Handling output variables [} 12] 98 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 99

Calibrating and measuring 2.10.4.2 Measure in X and Z axes After positioning, the touch probe first measures along the Z axis until it contacts a workpiece. After repositioning measurement takes place in X direction. The touch probe must be positioned either manually or in automatic mode so that it can be positioned in front of the measuring surface in X and Z axes. Fig. 21: Measure in X and Z axes 2.10.4.2.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position above the measuring surface in X and then measure in Z direction. 2. After clearance, the device moves back to the starting point. 3. Pre-position in front of the measuring surface in Z and then measure in X direction. 4. After clearance, the device moves back to the starting point. 5. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 99 Measurement
## Page 100

Calibrating and measuring 2.10.4.2.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P4 Measurement path in the X axis (incremental) Positive value, the touch probe moves in positive X direction Negative value, the touch probe moves in negative X direction @P6 Measurement path in the Z axis (incremental) Positive value, the touch probe moves in positive Z direction Negative value, the touch probe moves in negative Z direction Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P11 Shift the measuring point along the Z axis @P17 Pre-position along the X axis Default value = @P4 @P19 Pre-position along the Z axis Default value = @P6 It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.4.2.3 Syntax L CYCLE [ NAME = Sys Meas Wcs5.ecy @P.. = .. ] 2.10.4.2.4 Programming example Measure in X and Z axes ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X-50 Y0 Z5 #VAR ; input parameters: V. L. Meas Dist X = 10 100 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 101

Calibrating and measuring V. L. Meas Dist Z = -10 V. L. Zero Offset Number = 54 V. L. Positioning X = 20 V. L. Positioning Z = -15 ; output variables: V. CYC. Sys Ret X V. CYC. Sys Ret Z #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs5.ecy"\ @P4=V. L. Meas Dist X\ @P6=V. L. Meas Dist Z\ @P7=V. L. Zero Offset Number\ @P17=V. L. Positioning X\ @P19=V. L. Positioning Z] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. TF5225 | Twin CAT 3 CNC Version: 1.321 101 Measurement
## Page 102

Calibrating and measuring 2.10.4.2.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value of workpiece V. CYC. Sys Ret Z Calculated Z value of workpiece For information on the use of output variables, see Handling output variables [} 12] 102 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 103

Calibrating and measuring 2.10.4.3 Measure in Y and Z axes After positioning, the touch probe first measures along the Z axis until it contacts a workpiece. After repositioning measurement takes place in Y direction. The touch probe must be positioned either manually or in automatic mode so that it can be positioned in front of the measuring surface in Y and Z axes. Fig. 22: Measure in Y and Z axes 2.10.4.3.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position above the measuring surface in Y and then measure in Z direction. 2. After clearance, the device moves back to the starting point. 3. Pre-position in front of the measuring surface in Z and then measure in Y direction. 4. After clearance, the device moves back to the starting point. 5. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 103 Measurement
## Page 104

Calibrating and measuring 2.10.4.3.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P5 Measurement path in the Y axis (incremental) Positive value, the touch probe moves in positive Y direction Negative value, the touch probe moves in negative Y direction @P6 Measurement path in the Z axis (incremental) Positive value, the touch probe moves in positive Z direction Negative value, the touch probe moves in negative Z direction Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P10 Shift the measuring point along the Y axis @P11 Shift the measuring point along the Z axis @P18 Pre-position along the Y axis Default value = @P5 @P19 Pre-position along the Z axis Default value = @P6 It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.4.3.3 Syntax L CYCLE [ NAME = Sys Meas Wcs6.ecy @P.. = .. ] 2.10.4.3.4 Programming example Measure in Y and Z axes ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y-50 Z5 #VAR ; input parameters: V. L. Meas Dist Y = 10 104 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 105

Calibrating and measuring V. L. Meas Dist Z = -10 V. L. Zero Offset Number = 54 V. L. Positioning Y = 20 V. L. Positioning Z = -15 ; output variables: V. CYC. Sys Ret Y V. CYC. Sys Ret Z #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs6.ecy"\ @P5=V. L. Meas Dist Y\ @P6=V. L. Meas Dist Z\ @P7=V. L. Zero Offset Number\ @P18=V. L. Positioning Y\ @P19=V. L. Positioning Z] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.4.3.5 Output variables Variables Value V. CYC. Sys Ret Y Calculated Y value of workpiece V. CYC. Sys Ret Z Calculated Z value of workpiece For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 105 Measurement
## Page 106

Calibrating and measuring 2.10.5 Three point measurement 3 points are approached in these cycles. The determined values are transferred to the selected zero offset. 2.10.5.1 Measure in X, Y and Z axes After positioning, the touch probe first measures along the Z axis until it contacts a workpiece. After repositioning measurement takes place in X direction and after further repositioning measurement takes place in Y direction. The touch probe must be positioned either manually or in automatic mode so that it can be positioned in front of the measuring surface in X, Y and Z axes. Fig. 23: Measure in X, Y and Z axes 2.10.5.1.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position above the measuring surface in X and Y and then measure in Z direction. 2. After clearance, the device moves back to the starting point. 3. Pre-position in front of the measuring surface in Y and Z and then measure in X direction. 4. After clearance, the device moves back to the starting point. 5. Pre-position in front of the measuring surface in X and Z and then measure in Y direction. 6. After clearance, the device moves back to the starting point. 7. Description of selected zero offset. 106 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 107

Calibrating and measuring 2.10.5.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P4 Measurement path in the X axis (incremental) Positive value, the touch probe moves in positive X direction Negative value, the touch probe moves in negative X direction @P5 Measurement path in the Y axis (incremental) Positive value, the touch probe moves in positive Y direction Negative value, the touch probe moves in negative Y direction @P6 Measurement path in the Z axis (incremental) Positive value, the touch probe moves in positive Z direction Negative value, the touch probe moves in negative Z direction Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P11 Shift the measuring point along the Z axis @P17 Pre-position along the X axis (Default value = @P4) @P18 Pre-position along the Y axis (Default value = @P5) @P19 Pre-position along the Z axis (Default value = @P6) It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.5.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs7.ecy @P.. = .. ] 2.10.5.1.4 Programming example Measure in X, Y and Z axes ; touch probe activation T1 D1 TF5225 | Twin CAT 3 CNC Version: 1.321 107 Measurement
## Page 108

Calibrating and measuring ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ; input parameters: V. L. Meas Dist X = 10 V. L. Meas Dist Y = 10 V. L. Meas Dist Z = -10 V. L. Zero Offset Number = 54 V. L. Positioning X = 20 V. L. Positioning Y = 15 V. L. Positioning Z = -13 ; output variables: V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Z #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs7.ecy" \ @P4=V. L. Meas Dist X \ @P5=V. L. Meas Dist Y \ @P6=V. L. Meas Dist Z \ @P7=V. L. Zero Offset Number\ @P17=V. L. Positioning X \ @P18=V. L. Positioning Y \ @P19=V. L. Positioning Z ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.5.1.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value of workpiece V. CYC. Sys Ret Y Calculated Y value of workpiece V. CYC. Sys Ret Z Calculated Z value of workpiece For information on the use of output variables, see Handling output variables [} 12] 108 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 109

Calibrating and measuring 2.10.6 Measure the diameter The cycle sets the zero offset by means of drilled holes or pins. The determined values are transferred to the selected zero offset. 2.10.6.1 Inner diameter with four points After positioning within the drilled hole, the touch probe measures along the C and Y axes both in the positive and negative directions. The touch probe must be positioned in the drilled hole as centrally as possible at measuring depth either manually or in automatic mode. Fig. 24: Inner diameter with four points 2.10.6.1.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in X direction. 2. Measure in X- direction. 3. Move back to starting point. 4. Then follow measurements in X+, Y- and Y+. 5. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 109 Measurement
## Page 110

Calibrating and measuring 2.10.6.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Drilled hole diameter Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning If @P13 is not specified, the entire measuring section is traversed at the measuring feed @P33 Crossover range [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.6.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs8.ecy @P.. = .. ] 2.10.6.1.4 Programming example Inner diameter with 4 points ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 G0 Z-10 #VAR ;input parameters V. L. Hole Diameter = 40 V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. Cross Over = 10 ;output variables 110 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 111

Calibrating and measuring V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs8.ecy" \ @P2=V. L. Hole Diameter \ @P7=V. L. Zero Offset Number \ @P13=V. L. Safety Distance \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.6.1.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (circle centre point) V. CYC. Sys Ret Y Calculated Y value (circle centre point) V. CYC. Sys Ret Diameter Calculated circle diameter For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 111 Measurement
## Page 112

Calibrating and measuring 2.10.6.2 Inner diameter with three points After positioning within the drilled hole the touch probe measured along the specified angled straight lines. The touch probe must be positioned in the drilled hole as centrally as possible at measuring depth either manually or in automatic mode. Fig. 25: Inner diameter with three points 2.10.6.2.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in X and Y directions 2. Measure along a straight line in the X-Y plane using the 1st angle. 3. Move back to starting point. 4. This is followed by the measurements at angle 2 and angle 3. 5. Description of selected zero offset. 112 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 113

Calibrating and measuring 2.10.6.2.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Drilled hole diameter Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning If @P13 is not specified, the entire measuring section is traversed at the measuring feed @P14 Angle 1 to measuring point 1 in relation to X+ axis [degrees] Default value = 0 @P15 Angle 2 to measuring point 2 in relation to X+ axis [degrees] Default value = 120 @P16 Angle 3 to measuring point 3 in relation to X+ axis [degrees] Default value = 240 @P33 Crossover range [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 Angles 1-3 must be different. It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.6.2.3 Syntax L CYCLE [ NAME = Sys Meas Wcs9.ecy @P.. = .. ] 2.10.6.2.4 Programming example Inner diameter with 3 points ; touch probe activation T1 D1 ; deactivation of the zero offset G53 TF5225 | Twin CAT 3 CNC Version: 1.321 113 Measurement
## Page 114

Calibrating and measuring ; positioning to the starting point G0 X0 Y0 G0 Z-10 #VAR ;input parameters V. L. Hole Diameter = 40 V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. First Angle = 30 V. L. Second Angle = 150 V. L. Third Angle = 270 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs9.ecy"\ @P2=V. L. Hole Diameter\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P14=V. L. First Angle\ @P15=V. L. Second Angle\ @P16=V. L. Third Angle\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.6.2.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (circle centre point) V. CYC. Sys Ret Y Determined Y value (circle centre point) V. CYC. Sys Ret Diameter Determined circle diameter For information on the use of output variables, see Handling output variables [} 12] 114 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 115

Calibrating and measuring 2.10.6.3 Outer diameter with four points The touch probe is positioned above the workpiece. Then, measurements take place in the positive and negative directions of the X and Y axes. This requires repeated pre-positioning in each case. The touch probe must be positioned as centrally as possible above the spigot either manually or in automatic mode. Fig. 26: Outer diameter with four points 2.10.6.3.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in X direction. 2. Pre-position in Z- direction. 3. Measure in X+ direction. 4. Clearance in X- direction. 5. Move back to Z start. 6. Move back to X start. 7. Then follow measurements in X+, Y- and Y+. 8. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 115 Measurement
## Page 116

Calibrating and measuring 2.10.6.3.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Spigot diameter @P19 Pre-position along the Z axis Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.6.3.3 Syntax L CYCLE [ NAME = Sys Meas Wcs10.ecy @P.. = .. ] Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.6.3.4 Programming example Outer diameter with 4 points ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Spigot Diameter = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 10 116 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 117

Calibrating and measuring V. L. Positioning Z = -10 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs10.ecy"\ @P2=V. L. Spigot Diameter\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P19=V. L. Positioning Z\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] M30 2.10.6.3.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (circle centre point) V. CYC. Sys Ret Y Calculated Y value (circle centre point) V. CYC. Sys Ret Diameter Calculated circle diameter For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 117 Measurement
## Page 118

Calibrating and measuring 2.10.6.4 Outer diameter with three points The touch probe is positioned above the workpiece. Then, measurements takes place along the specified angled straight lines. This requires pre-positioning in each case. The touch probe must be positioned as centrally as possible above the spigot either manually or in automatic mode. Fig. 27: Outer diameter with three points 2.10.6.4.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in X and Y directions using 1st angle. 2. Pre-position in Z. 3. Measure along an angled straight line in the X-Y plane using the 1st angle. 4. Clearance in X and Y directions for pre-positioning using 1st angle 5. Move back to Z start. 6. Move back to starting point. 7. This is followed by the measurements at angle 2 and angle 3. 8. Description of selected zero offset. 118 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 119

Calibrating and measuring 2.10.6.4.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Spigot diameter @P19 Pre-position along the Z axis Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P14 Angle 1 to first measuring point in relation to X+ axis [degrees] Default value = 0 @P15 Angle 2 to second measuring point in relation to X+ axis [degrees] Default value = 120 @P16 Angle 3 to third measuring point in relation to X+ axis [degrees] Default value = 240 @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 Angles 1-3 must be different. It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.6.4.3 Syntax L CYCLE [ NAME = Sys Meas Wcs11.ecy @P.. = .. ] 2.10.6.4.4 Programming example Outer diameter with 3 points ; touch probe activation T1 D1 ; deactivation of the zero offset G53 TF5225 | Twin CAT 3 CNC Version: 1.321 119 Measurement
## Page 120

Calibrating and measuring ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Spigot Diameter = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 10 V. L. First Angle = 30 V. L. Second Angle = 150 V. L. Third Angle = 270 V. L. Positioning Z = -10 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs11.ecy"\ @P2=V. L. Spigot Diameter\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P14=V. L. First Angle\ @P15=V. L. Second Angle\ @P16=V. L. Third Angle\ @P19=V. L. Positioning Z\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.6.4.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (circle centre point) V. CYC. Sys Ret Y Calculated Y value (circle centre point) V. CYC. Sys Ret Diameter Calculated circle diameter For information on the use of output variables, see Handling output variables [} 12] 120 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 121

Calibrating and measuring 2.10.6.5 Inner diameter with four points and obstacle After positioning above the spigot, the touch probe measures along the X and Y axes both in the positive and negative directions after it was again pre-positioned. The touch probe must be positioned as centrally as possible above the spigot either manually or in automatic mode. Fig. 28: Inner diameter with four points and obstacle 2.10.6.5.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in X direction. 2. Pre-position in Z direction. 3. Measure in X- direction. 4. Clearance in X+ direction. 5. Move back to Z start. 6. Move back to X start. 7. Then follow measurements in X+, Y- and Y+. 8. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 121 Measurement
## Page 122

Calibrating and measuring 2.10.6.5.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Drilled hole diameter @P19 Pre-position along the Z axis Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.6.5.3 Syntax L CYCLE [ NAME = Sys Meas Wcs18.ecy @P.. = .. ] 2.10.6.5.4 Programming example Inner diameter with 4 points and obstacle ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Hole Diameter = 40 V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. Positioning Z = -15 V. L. Cross Over = 20 122 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 123

Calibrating and measuring ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs18.ecy"\ @P2=V. L. Hole Diameter\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P19=V. L. Positioning Z\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.6.5.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (circle centre point) V. CYC. Sys Ret Y Calculated Y value (circle centre point) V. CYC. Sys Ret Diameter Calculated circle diameter For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 123 Measurement
## Page 124

Calibrating and measuring 2.10.7 Measure slot and web These cycles determine the centre point of the slot/web by specifying the slot/web width. The calculated value is transferred to the selected zero offset. 2.10.7.1 Measure slot in X axis After positioning within the slot, the touch probe measures both in the positive and negative X directions. The touch probe must be positioned at measuring depth as centrally as possible in the slot either manually or in automatic mode. Fig. 29: Measure slot in X axis 2.10.7.1.1 Process (internal cycle) The internal cycle process can be described as follows: 1. (Pre-position in X direction.) 2. Measure in X- direction. 3. Move back to starting point. 4. Then follows measurement in X+. 5. Description of selected zero offset. 124 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 125

Calibrating and measuring 2.10.7.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P3 Slot width Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P13 Safety clearance for pre-positioning If @P13 is not specified, the entire measuring section is traversed at the measuring feed @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.7.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs12.ecy @P.. = .. ] 2.10.7.1.4 Programming example Measure slot in X axis ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 G0 Z-10 #VAR ;input parameters V. L. Slot Width = 40 V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret X TF5225 | Twin CAT 3 CNC Version: 1.321 125 Measurement
## Page 126

Calibrating and measuring V. CYC. Sys Ret Length X #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs12.ecy"\ @P3=V. L. Slot Width\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Length X =%f", V. CYC. Sys Ret Length X] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.7.1.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (centre of slot) V. CYC. Sys Ret Length X Calculated X length (width of slot) For information on the use of output variables, see Handling output variables [} 12] 126 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 127

Calibrating and measuring 2.10.7.2 Measure slot in Y axis After positioning within the slot, the touch probe measures both in the positive and negative X directions. The touch probe must be positioned at measuring depth as centrally as possible in the slot either manually or in automatic mode. Measure slot in Y axis. Fig. 30: Measure slot in Y axis 2.10.7.2.1 Process (internal cycle) The internal cycle process can be described as follows: 1. (Pre-position in Y direction.) 2. Measure in Y- direction. 3. Move back to starting point. 4. Then follows measurement in Y+ 5. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 127 Measurement
## Page 128

Calibrating and measuring 2.10.7.2.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P3 Slot width Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning If @P13 is not specified, the entire measuring section is traversed at the measuring feed @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.7.2.3 Syntax L CYCLE [ NAME = Sys Meas Wcs13.ecy @P.. = .. ] 2.10.7.2.4 Programming example Measure slot in Y axis ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 G0 Z-10 #VAR ;input parameters V. L. Slot Width = 40 V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret Y 128 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 129

Calibrating and measuring V. CYC. Sys Ret Length Y #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs13.ecy"\ @P3=V. L. Slot Width\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Length Y =%f", V. CYC. Sys Ret Length Y] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.7.2.5 Output variables Variables Value V. CYC. Sys Ret Y Calculated Y value (centre of slot) V. CYC. Sys Ret Length Y Calculated Y length (width of slot) For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 129 Measurement
## Page 130

Calibrating and measuring 2.10.7.3 Measure web in X axis After positioning above the web, the touch probe measures both in the positive and negative X directions after repeated pre-positioning. The touch probe must be positioned as centrally as possible above the web either manually or in automatic mode. Fig. 31: Measure web in X axis 2.10.7.3.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in X direction. 2. Pre-position in Z direction. 3. Measure in X+ direction. 4. Clearance in X- direction. 5. Move back to Z start. 6. Move back to X start. 7. Then follows measurement in X- direction. 8. Description of selected zero offset. 130 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 131

Calibrating and measuring 2.10.7.3.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P3 Web width @P19 Pre-position along the Z axis Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.7.3.3 Syntax L CYCLE [ NAME = Sys Meas Wcs14.ecy @P.. = .. ] 2.10.7.3.4 Programming example Measure web in X axis ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Web Width = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. Positioning Z = -10 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret X TF5225 | Twin CAT 3 CNC Version: 1.321 131 Measurement
## Page 132

Calibrating and measuring V. CYC. Sys Ret Length X #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs14.ecy"\ @P3=V. L. Web Width\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P19=V. L. Positioning Z\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Length X =%f", V. CYC. Sys Ret Length X] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.7.3.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (centre of web) V. CYC. Sys Ret Length X Calculated X length (width of web) For information on the use of output variables, see Handling output variables [} 12] 132 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 133

Calibrating and measuring 2.10.7.4 Measure web in Y axis After positioning above the web, the touch probe measures both in the positive and negative Y directions after repeated pre-positioning. The touch probe must be positioned as centrally as possible above the web either manually or in automatic mode. Fig. 32: Measure web in Y axis 2.10.7.4.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in Y direction. 2. Pre-position in Z direction. 3. Measure in Y+ direction. 4. Clearance in Y- direction. 5. Move back to Z start. 6. Move back to Y start 7. Then follows measurement in Y+. 8. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 133 Measurement
## Page 134

Calibrating and measuring 2.10.7.4.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P3 Web width @P19 Pre-position along the Z axis Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.7.4.3 Syntax L CYCLE [ NAME = Sys Meas Wcs15.ecy @P.. = .. ] Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.7.4.4 Programming example Measure slot and web ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Web Width = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. Positioning Z = -10 134 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 135

Calibrating and measuring V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret Y V. CYC. Sys Ret Length Y #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs15.ecy"\ @P3=V. L. Web Width\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P19=V. L. Positioning Z\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] M30 2.10.7.4.5 Output variables Variables Value V. CYC. Sys Ret Y Calculated Y value (centre of web) V. CYC. Sys Ret Length Y Calculated Y length (width of web) TF5225 | Twin CAT 3 CNC Version: 1.321 135 Measurement
## Page 136

Calibrating and measuring 2.10.7.5 Measure slot in X axis with obstacle After positioning above the obstacle, the touch probe measures both in the positive and negative X directions. The touch probe must be positioned as centrally as possible above the obstacle either manually or in automatic mode. The obstacle is located in the middle of the slot. Fig. 33: Measure slot in X axis with obstacle 2.10.7.5.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in X direction. 2. Pre-position in Z direction. 3. Measure in X- direction. 4. Clearance in X+ direction. 5. Move back to Z start. 6. Move back to X start. 7. Then follows measurement in X+. 8. Description of selected zero offset. 136 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 137

Calibrating and measuring 2.10.7.5.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P3 Slot width @P19 Pre-position along the Z axis Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.7.5.3 Syntax L CYCLE [ NAME = Sys Meas Wcs16.ecy @P.. = .. ] 2.10.7.5.4 Programming example Measure slot in X axis with obstacle ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Slot Width = 40 V. L. Zero Offset Number = 54 V. L. Safety Distance = 10 V. L. Positioning Z = -15 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret X TF5225 | Twin CAT 3 CNC Version: 1.321 137 Measurement
## Page 138

Calibrating and measuring V. CYC. Sys Ret Length X #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs16.ecy"\ @P3=V. L. Slot Width\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P19=V. L. Positioning Z\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Length X =%f", V. CYC. Sys Ret Length X] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.7.5.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (centre of slot) V. CYC. Sys Ret Length X Calculated X length (width of slot) For information on the use of output variables, see Handling output variables [} 12] 138 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 139

Calibrating and measuring 2.10.7.6 Measure slot in Y axis with obstacle After positioning above the obstacle, the touch probe measures both in the positive and negative Y direction after repeated pre-positioning in the slot. The touch probe must be positioned as centrally as possible above the obstacle either manually or in automatic mode. The obstacle is located in the middle of the slot. Fig. 34: Measure slot in Y axis with obstacle 2.10.7.6.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in Y direction. 2. Pre-position in Z direction. 3. Measure in Y- direction. 4. Clearance in Y+ direction. 5. Move back to Z start. 6. Move back to Y start. 7. Then follows measurement in Y+. 8. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 139 Measurement
## Page 140

Calibrating and measuring 2.10.7.6.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P3 Slot width @P19 Pre-position along the Z axis Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.7.6.3 Syntax L CYCLE [ NAME = Sys Meas Wcs17.ecy @P.. = .. ] 2.10.7.6.4 Programming example Measure slot in Y axis with obstacle ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Slot Width = 40 V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. Positioning Z = -15 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret Y 140 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 141

Calibrating and measuring V. CYC. Sys Ret Length Y #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs17.ecy"\ @P3=V. L. Slot Width\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P19=V. L. Positioning Z\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Length Y =%f", V. CYC. Sys Ret Length Y] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.7.6.5 Output variables Variables Value V. CYC. Sys Ret Y Calculated Y value (centre of slot) V. CYC. Sys Ret Length Y Calculated Y length (width of slot) For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 141 Measurement
## Page 142

Calibrating and measuring 2.10.8 Angle measurement These cycles determine workpiece twist and the compensation value. The calculated value is transferred to the selected zero offset. 2.10.8.1 Measure angle in X axis (C axis) Determining the twist of the workpiece about the Z axis by two lateral measurements along the X axis. If no C axis is configured, call the cycle without transferring @P7. The twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Before calling the cycle, the touch probe must be positioned on the X and Y coordinates of the first measuring point. A clearance movement in Z can be parameterised between the measuring points. The calculated angle corresponds to the twist of the workpiece about the Z axis in relation to the Y axis. Fig. 35: Measure angle in X axis (C axis) 2.10.8.1.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Preposition along Z at the starting point of the 1st measurement. (@P22) 2. Measure in X axis. (@P4) 3. Clearance in X at the starting point of the 1st measurement. 4. Clearance along Z. (@P19 or @P22) 5. Position in X and Y axes. (@P17, @P18) 6. Preposition along Z at the starting point of the 2nd measurement (same measurement height in Z at for 1st measurement). 7. Measure in X axis. (@P4) 8. Clearance in X at the starting point of the 2nd measurement. 9. Clearance along Z. (@P19 or @P22) 10. Clearance in X and Y at the starting point of the 1st measurement. 11. Calculate twist in C. 12. Description of selected zero offset. (@P7) 142 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 143

Calibrating and measuring 2.10.8.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P4 Measurement path in the X axis (incremental) Positive value, the touch probe moves in positive X direction Negative value, the touch probe moves in negative X direction @P18 Preposition along the Y axis before the 2nd measurement (incremental) @P18 may not be 0. Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P17 Preposition along the X axis before the 2nd measurement [mm, inch] (incremental) Default value = 0 @P19 Clearance length along the Z axis between the measurements (incremental) Default value = 0 @P22 Preposition along the Z axis before the first measurement (incremental) If @P19 is not specified, the tool is retracted between the measurements by the value of @P22 Default value = 0 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs19.ecy @P.. = .. ] 2.10.8.1.4 Programming example Measure angle in X axis (C axis) ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point TF5225 | Twin CAT 3 CNC Version: 1.321 143 Measurement
## Page 144

Calibrating and measuring G0 X0 Y0 G0 Z5 #VAR ;input parameters V. L. Meas Dist X = 10 V. L. Zero Offset Number = 54 V. L. Positioning Y = 10 V. L. Pre Pos Z = 5 V. L. Start Pre Pos Z = -15 ;output variables V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs19.ecy"\ @P4=V. L. Meas Dist X\ @P7=V. L. Zero Offset Number\ @P18=V. L. Positioning Y\ @P19=V. L. Pre Pos Z\ @P20=V. L. Start Pre Pos Z] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.1.5 Output variables Variables Value V. CYC. Sys Ret C Calculated C value (twist in relation to X axis) If the workpiece is parallel to the Y axis, V. CYC. Sys Ret C = 0. For information on the use of output variables, see Handling output variables [} 12] 144 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 145

Calibrating and measuring 2.10.8.2 Measure angle in Y axis (C axis) Determining the twist of the workpiece about the Z axis by two lateral measurements along the Y axis. If no C axis is configured, call the cycle without transferring @P7. The twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Before calling the cycle, the touch probe must be positioned on the X and Y coordinates of the first measuring point. A clearance movement in Z can be parameterised between the measuring points. The calculated angle corresponds to the twist of the workpiece about the Z axis in relation to the X axis. Fig. 36: Measure angle in Y axis (C axis) 2.10.8.2.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Preposition along Z at the starting point of the 1st measurement. (@P22) 2. Measure in Y axis. (@P5) 3. Clearance in Y at the starting point of the 1st measurement. 4. Clearance along Z. (@P19 or @P22) 5. Position in X and Y axes. (@P17, @P18) 6. Preposition along Z at the starting point of the 2nd measurement (same measurement height in Z at for 1st measurement). 7. Measure in Y axis. (@P5) 8. Clearance in Y at the starting point of the 2nd measurement. 9. Clearance along Z. (@P19 or @P22) 10. Clearance in X and Y at the starting point of the 1st measurement. 11. Calculate twist in C. 12. Description of selected zero offset. (@P7) TF5225 | Twin CAT 3 CNC Version: 1.321 145 Measurement
## Page 146

Calibrating and measuring 2.10.8.2.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P5 Measurement path in the Y axis (incremental) Positive value, the touch probe moves in positive Y direction Negative value, the touch probe moves in negative Y direction @P17 Preposition along the X axis before the 2nd measurement (incremental) @P17 may not be 0. Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P18 Preposition along the Y axis before the 2nd measurement (incremental) Default value = 0 @P19 Clearance length along the Z axis between the measurements (incremental) Default value = 0 @P22 Preposition along the Z axis before the first measurement (incremental) If @P19 is not specified, the tool is retracted between the measurements by the value of @P22 Default value = 0 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.2.3 Syntax L CYCLE [ NAME = Sys Meas Wcs20.ecy @P.. = .. ] 2.10.8.2.4 Programming example Measure angle in Y axis (C axis) ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point 146 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 147

Calibrating and measuring G0 X0 Y0 G0 Z5 #VAR ;input parameters V. L. Meas Dist Y = 10 V. L. Zero Offset Number = 54 V. L. Positioning X = 10 V. L. Pre Pos Z = 5 V. L. Start Pre Pos Z = -15 ;output variables V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs20.ecy"\ @P5=V. L. Meas Dist Y\ @P7=V. L. Zero Offset Number\ @P17=V. L. Positioning X\ @P19=V. L. Pre Pos Z\ @P20=V. L. Start Pre Pos Z] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.2.5 Output variables Variable Value V. CYC. Sys Ret C Calculated C value (twist in relation to X axis) If the workpiece is parallel to X axis, V. CYC. Sys Ret C = 0. For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 147 Measurement
## Page 148

Calibrating and measuring 2.10.8.3 Measure angle between 2 drilled holes (C axis) The centre point of the drilled holes is calculated by 4 measured points (see Sys Meas Wcs8) and by the angle between the drilled holes in relation to the X axis. The touch probe must be positioned as centrally as possible above the first drilled hole either manually or in automatic mode. If no C axis is configured, call the cycle without transferring @P7. The twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Z Y X Fig. 37: Measure angle between 2 drilled holes (C axis) 2.10.8.3.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in Z. 2. Measure in X- direction. 3. Move back to starting point. 4. Then follow measurements in X+, Y- and Y+ 5. Move back in Z to starting position. 6. Position in X, Y and Z above the 2nd drilled hole. 7. Measure the 2nd drilled hole with the same sequence as drilled hole 1. 8. Description of selected zero offset. 148 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 149

Calibrating and measuring 2.10.8.3.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Drilled hole diameter @P22 Measuring depth Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P13 Safety clearance for pre-positioning [mm, inch] If @P13 is not specified, the entire measuring section for the drilled hole is traversed at the measuring feed @P17 Pre-position along the X axis above the 2nd drilled hole Default value = 0 @P18 Pre-position along the Y axis above the 2nd drilled hole Default value = 0 @P19 Pre-position along the Z axis Default value is the starting position above the 1st drilled hole @P29 Diameter of the 2nd drilled hole (default = diameter of the 1st drilled hole) @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.3.3 Syntax L CYCLE [ NAME = Sys Meas Wcs21.ecy @P.. = .. ] 2.10.8.3.4 Programming example Measure angle between 2 drilled holes (C axis) ; touch probe activation T1 D1 ; deactivation of the zero offset G53 TF5225 | Twin CAT 3 CNC Version: 1.321 149 Measurement
## Page 150

Calibrating and measuring ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Hole Diameter = 20 V. L. Zero Offset Number = 54 V. L. Positioning X = 50 V. L. Positioning Y = 20 V. L. Positioning Z = 10 V. L. Meas Depth = -15 V. L. Hole Diameter2 = 30 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs21.ecy"\ @P2=V. L. Hole Diameter\ @P7=V. L. Zero Offset Number\ @P17=V. L. Positioning X\ @P18=V. L. Positioning Y\ @P19=V. L. Positioning Z\ @P22=V. L. Meas Depth\ @P29=V. L. Hole Diameter2\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.3.5 Output variables Variables Value V. CYC. Sys Ret C Calculated C value (twist of straight lines through the circle centre points in relation to the X axis) If the straight line through the two centre points is parallel to the X axis, V. CYC. Sys Ret C = 0. For information on the use of output variables, see Handling output variables [} 12] 150 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 151

Calibrating and measuring 2.10.8.4 Measure angle between pins (C axis) The centre point of the spigot is calculated by 4 measured points (see Sys Meas Wcs10) and by the angle between the drilled holes in relation to the X axis. The touch probe must be positioned as centrally as possible above the first spigot either manually or in automatic mode. If no C axis is configured, call the cycle without transferring @P7. The twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Fig. 38: Measure angle between pins (C axis) 2.10.8.4.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in X direction. 2. Pre-position in Z direction. 3. Measure in X+ direction. 4. Clearance in X- direction. 5. Move back to Z start. 6. Move back to X start. 7. Then follow measurements in X+, Y- and Y+ 8. Move back in Z to starting position. 9. Position in X, Y and Z above the 2nd pin. 10. Measure the second pin with the same sequence as drilled hole 1. 11. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 151 Measurement
## Page 152

Calibrating and measuring 2.10.8.4.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Spigot diameter @P22 Measuring depth Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P17 Pre-position along the X axis above the 2nd spigot Default value = 0 @P18 Pre-position along the Y axis above the 2nd spigot Default value = 0 @P19 Pre-position along the Z axis above the 2nd spigot Default value is the starting position above the 1st spigot @P29 Diameter of the 2nd spigot (default = diameter of the first spigot) @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.4.3 Syntax L CYCLE [ NAME = Sys Meas Wcs22.ecy @P.. = .. ] 2.10.8.4.4 Programming example Measure angle between pins (C axis) ; touch probe activation T1 D1 ; deactivation of the zero offset G53 152 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 153

Calibrating and measuring ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Spigot Diameter = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. Positioning X = 50 V. L. Positioning Y = 20 V. L. Positioning Z = 10 V. L. Meas Depth = -15 V. L. Spigot Diameter2 = 30 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs22.ecy" \ @P2=V. L. Spigot Diameter \ @P7=V. L. Zero Offset Number \ @P17=V. L. Positioning X \ @P18=V. L. Positioning Y \ @P19=V. L. Positioning Z \ @P22=V. L. Meas Depth \ @P29=V. L. Spigot Diameter2 \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.4.5 Output variables Variables Value V. CYC. Sys Ret C Calculated C value (twist of straight lines through the circle centre points in relation to the X axis) If the straight line through the two centre points is parallel to the X axis, V. CYC. Sys Ret C = 0. For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 153 Measurement
## Page 154

Calibrating and measuring 2.10.8.5 Measure angle between drilled hole and spigot (C axis) The centre point of the drilled hole is calculated by 4 measured points (see Sys Meas Wcs8, Sys Meas Wcs10) and by the angle between the drilled holes in relation to the X axis. The touch probe must be positioned as centrally as possible above the first drilled hole either manually or in automatic mode. If no C axis is configured, call the cycle without transferring @P7. The twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Fig. 39: Measure angle between drilled hole and spigot (C axis) 2.10.8.5.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in Z. 2. Measure in X- direction. 3. Move back to starting point. 4. Then follow measurements in X+, Y- and Y+ 5. Move back in Z to starting position. 6. Position in X, Y and Z above the pin. 7. Measure the pin in the same sequence as the drilled hole. 8. Description of selected zero offset. 154 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 155

Calibrating and measuring 2.10.8.5.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Drilled hole diameter @P22 Measuring depth @P29 Diameter of spigot Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P13 Safety clearance for pre-positioning [mm, inch] Default value for spigot? = diameter of the touch probe If @P13 is not specified, the entire measuring section for the drilled hole is traversed at the measuring feed @P17 Pre-position along the X axis above the spigot Default value = 0 @P18 Pre-position along the Y axis above the spigot Default value = 0 @P19 Pre-position along the Z axis above the spigot Default value is the starting position above the drilled hole @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.5.3 Syntax L CYCLE [ NAME = Sys Meas Wcs23.ecy @P.. = .. ] 2.10.8.5.4 Programming example Measure angle between drilled hole and spigot (C axis) ; touch probe activation T1 D1 ; deactivation of the zero offset TF5225 | Twin CAT 3 CNC Version: 1.321 155 Measurement
## Page 156

Calibrating and measuring G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Hole Diameter = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 2 V. L. Positioning X = 50 V. L. Positioning Y = 20 V. L. Positioning Z = 10 V. L. Meas Depth = -15 V. L. Spigot Diameter = 30 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs23.ecy" \ @P2=V. L. Hole Diameter \ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance \ @P17=V. L. Positioning X \ @P18=V. L. Positioning Y \ @P19=V. L. Positioning Z \ @P22=V. L. Meas Depth \ @P29=V. L. Spigot Diameter \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.5.5 Output variables Variables Value V. CYC. Sys Ret C Calculated C value (twist of straight lines through the circle centre points in relation to the X axis) If the straight line through the two centre points is parallel to the X axis, V. CYC. Sys Ret C = 0. For information on the use of output variables, see Handling output variables [} 12] 156 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 157

Calibrating and measuring 2.10.8.6 Measure angle between point in Y and drilled hole (C axis) The centre point of the drilled hole is calculated by 4 measured points (see Sys Meas Wcs8) and by the angle between the drilled hole and the measured point in Y (see Sys Meas Wcs2) in relation to the X axis. The touch probe must be positioned in front of the required surface above the workpiece, either manually or in automatic mode, before the cycle is started. If no C axis is configured, call the cycle without transferring @P7. The twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Fig. 40: Measure angle between point in Y and drilled hole (C axis) 2.10.8.6.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in Z. 2. Measure in X axis. 3. Clearance in X to starting point. 4. Move back in Z to starting position. 5. Position in X, Y and Z above the 2nd 6. Pre-position in X direction. 7. Pre-position in Z direction. 8. Measure in X+ direction. 9. Clearance in X- direction. 10. Move back to Z start. 11. Move back to X start. 12. Then follow measurements in X+, Y- and Y+ 13. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 157 Measurement
## Page 158

Calibrating and measuring 2.10.8.6.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Drilled hole diameter @P4 Measurement path in the X axis (incremental) Positive value, the touch probe moves in positive X direction Negative value, the touch probe moves in negative X direction @P22 Measuring depth Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P13 Safety clearance for pre-positioning in the drilled hole If @P13 is not specified, the entire measuring section in the drilled hole is traversed at the measuring feed @P17 Pre-position along the X axis above the spigot Default value = 0 @P18 Pre-position along the Y axis above the spigot Default value = 0 @P19 Pre-position along the Z axis above the drilled hole @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.6.3 Syntax L CYCLE [ NAME = Sys Meas Wcs24.ecy @P.. = .. ] 2.10.8.6.4 Programming example Measure angle between point in Y and drilled hole (C axis) ; touch probe activation T1 D1 ; deactivation of the zero offset 158 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 159

Calibrating and measuring G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Hole Diameter = 20 V. L. Meas Dist X = 10 V. L. Zero Offset Number = 54 V. L. Positioning X = 50 V. L. Positioning Y = 20 V. L. Positioning Z = 10 V. L. Meas Depth = -10 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs24.ecy" \ @P2=V. L. Hole Diameter \ @P4=V. L. Meas Dist X \ @P7=V. L. Zero Offset Number \ @P17=V. L. Positioning X \ @P18=V. L. Positioning Y \ @P19=V. L. Positioning Z \ @P22=V. L. Meas Depth \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.6.5 Output variables Variables Value V. CYC. Sys Ret C Calculated C value (twist of straight lines through the measuring point and circle centre points in relation to the X axis) If the straight line through the two points is parallel to the X axis, V. CYC. Sys Ret C = 0. For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 159 Measurement
## Page 160

Calibrating and measuring 2.10.8.7 Measure angle between point in Y and spigot (C axis) The centre point of the spigot is calculated by 4 measured points (see Sys Meas Wcs10) and by the angle between the drilled hole and the measured point in Y (see Sys Meas Wcs2) in relation to the X axis. The touch probe must be positioned in front of the required surface above the workpiece, either manually or in automatic mode, before the cycle is started. If no C axis is configured, call the cycle without transferring @P7. The twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Fig. 41: Measure angle between point in Y and spigot (C axis) 2.10.8.7.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in Z. 2. Measure in X axis. 3. Clearance in X to starting point. 4. Move back in Z to starting position. 5. Position in X, Y and Z above the pin. 6. Pre-position in X direction. 7. Pre-position in Z direction. 8. Measure in X+ direction. 9. Clearance in X- direction. 10. Move back to Z start. 11. Move back to X start. 12. Then follow measurements in X+, Y- and Y+ 13. Description of selected zero offset. 160 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 161

Calibrating and measuring 2.10.8.7.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Spigot diameter @P4 Measurement path in the X axis (incremental) Positive value, the touch probe moves in positive X direction Negative value, the touch probe moves in negative X direction @P22 Measuring depth Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P17 Pre-position along the X axis above the spigot Default value = 0 @P18 Pre-position along the Y axis above the spigot Default value = 0 @P19 Pre-position along the Z axis above the spigot @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.7.3 Syntax L CYCLE [ NAME = Sys Meas Wcs25.ecy @P.. = .. ] 2.10.8.7.4 Programming example Measure angle between point in Y and spigot (C axis) ; touch probe activation T1 D1 ; deactivation of the zero offset TF5225 | Twin CAT 3 CNC Version: 1.321 161 Measurement
## Page 162

Calibrating and measuring G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Spigot Diameter = 20 V. L. Meas Dist X = 10 V. L. Zero Offset Number = 54 V. L. Safety Distance = 10 V. L. Positioning X = 50 V. L. Positioning Y = 20 V. L. Positioning Z = -15 V. L. Meas Depth = -10 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs25.ecy" \ @P2=V. L. Spigot Diameter \ @P4=V. L. Meas Dist X \ @P7=V. L. Zero Offset Number \ @P13=V. L. Safety Distance \ @P17=V. L. Positioning X \ @P18=V. L. Positioning Y \ @P19=V. L. Positioning Z \ @P22=V. L. Meas Depth \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.7.5 Output variables Variables Value V. CYC. Sys Ret C Calculated C value (twist of straight lines through the measuring point and circle centre points in relation to the X axis) If the straight line through the two points is parallel to the X axis, V. CYC. Sys Ret C = 0. For information on the use of output variables, see Handling output variables [} 12] 162 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 163

Calibrating and measuring 2.10.8.8 Measure angle between point in X and drilled hole (C axis) The centre point of the drilled hole is calculated by 4 measured points (see Sys Meas Wcs8) and by the angle between the drilled hole and the measured point in X (see Sys Meas Wcs1) in relation to the Y axis. The touch probe must be positioned in front of the required surface above the workpiece, either manually or in automatic mode, before the cycle is started. If no C axis is configured, call the cycle without transferring @P7. The twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Fig. 42: Measure angle between point in X and drilled hole (C axis) 2.10.8.8.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in Z. 2. Measure in Y axis. 3. Clearance in Y at starting point. 4. Move back in Z to starting position. 5. Position in X, Y and Z above the 2nd 6. Pre-position in X direction. 7. Pre-position in Z direction. 8. Measure in X+ direction. 9. Clearance in X- direction. 10. Move back to Z start. 11. Move back to X start. 12. Then follow measurements in X+, Y- and Y+ 13. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 163 Measurement
## Page 164

Calibrating and measuring 2.10.8.8.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Drilled hole diameter @P5 Measurement path in the Y axis (incremental) Positive value, the touch probe moves in positive Y direction Negative value, the touch probe moves in negative Y direction @P22 Measuring depth Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P13 Safety clearance for pre-positioning in the drilled hole If @P13 is not specified, the entire measuring section in the drilled hole is traversed at the measuring feed @P17 Pre-position along the X axis above the drilled hole Default value = 0 @P18 Pre-position along the Y axis above the drilled hole Default value = 0 @P19 Pre-position along the Z axis above the drilled hole @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.8.3 Syntax L CYCLE [ NAME = Sys Meas Wcs26.ecy @P.. = .. ] 2.10.8.8.4 Programming example Measure angle between point in X and drilled hole (C axis) ; touch probe activation T1 D1 ; deactivation of the zero offset 164 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 165

Calibrating and measuring G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Hole Diameter = 20 V. L. Meas Dist Y = 10 V. L. Zero Offset Number = 54 V. L. Positioning X = 50 V. L. Positioning Y = 20 V. L. Positioning Z = -15 V. L. Meas Depth = -10 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs26.ecy" \ @P2=V. L. Hole Diameter \ @P5=V. L. Meas Dist Y \ @P7=V. L. Zero Offset Number\ @P17=V. L. Positioning X \ @P18=V. L. Positioning Y \ @P19=V. L. Positioning Z \ @P22=V. L. Meas Depth \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.8.5 Output variables Variables Value V. CYC. Sys Ret C Calculated C value (twist of straight lines through the measuring point and circle centre points in relation to the X axis) If the straight line through the two points is parallel to the X axis, V. CYC. Sys Ret C = 0. For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 165 Measurement
## Page 166

Calibrating and measuring 2.10.8.9 Measure angle between point in X and spigot (C axis) The centre point of the drilled hole is calculated by 4 measured points (see Sys Meas Wcs10) and by the angle between the drilled hole and the measured point in X (see Sys Meas Wcs1) in relation to the X axis. The touch probe must be positioned in front of the required surface above the workpiece, either manually or in automatic mode, before the cycle is started. If no C axis is configured, call the cycle without transferring @P7. The twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Fig. 43: Measure angle between point in X and spigot (C axis) 2.10.8.9.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in Z. 2. Measure in Y axis. 3. Clearance in Y at starting point. 4. Move back in Z to starting position. 5. Position in X, Y and Z above the pin. 6. Pre-position in X direction. 7. Pre-position in Z direction. 8. Measure in X+ direction. 9. Clearance in X- direction. 10. Move back to Z start. 11. Move back to X start. 12. Then follow measurements in X+, Y- and Y+ 13. Description of selected zero offset. 166 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 167

Calibrating and measuring 2.10.8.9.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Spigot diameter @P5 Measurement path in the Y axis (incremental) Positive value, the touch probe moves in positive Y direction Negative value, the touch probe moves in negative Y direction @P22 Measuring depth Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P17 Pre-position along the X axis above the spigot Default value = 0 @P18 Pre-position along the Y axis above the spigot Default value = 0 @P19 Pre-position along the Z axis above the spigot @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.9.3 Syntax L CYCLE [ NAME = Sys Meas Wcs27.ecy @P.. = .. ] 2.10.8.9.4 Programming example Measure angle between point in X and spigot (C axis) ; touch probe activation T1 D1 ; deactivation of the zero offset TF5225 | Twin CAT 3 CNC Version: 1.321 167 Measurement
## Page 168

Calibrating and measuring G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Spigot Diameter = 20 V. L. Meas Dist Y = 10 V. L. Zero Offset Number = 54 V. L. Safety Distance = 10 V. L. Positioning X = 50 V. L. Positioning Y = 20 V. L. Positioning Z = 10 V. L. Meas Depth = -15 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs27.ecy" \ @P2=V. L. Spigot Diameter \ @P5=V. L. Meas Dist Y \ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance \ @P17=V. L. Positioning X \ @P18=V. L. Positioning Y \ @P19=V. L. Positioning Z \ @P22=V. L. Meas Depth \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.9.5 Output variables Variables Value V. CYC. Sys Ret C Calculated C value (twist of straight lines through the measuring point and circle centre points in relation to the X axis) If the straight line through the two points is parallel to the X axis, V. CYC. Sys Ret C = 0. For information on the use of output variables, see Handling output variables [} 12] 168 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 169

Calibrating and measuring 2.10.8.10 Measure angle in Z axis (A axis) After positioning, the touch probe measures in the direction of the Y axis. The touch probe must be positioned as centrally as possible at measuring depth at the first measuring point either manually or in automatic mode. The calculated angle corresponds to the twist of the workpiece about the X axis in relation to the Z axis. Fig. 44: Measure angle in Z axis (A axis) 2.10.8.10.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Measure in Y axis. 2. Clearance in Y at starting point. 3. Position in Z and Y axes. 4. Measure in Y axis. 5. Clearance in Y at second starting point. 6. Calculate twist in A. 7. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 169 Measurement
## Page 170

Calibrating and measuring 2.10.8.10.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P5 Measurement path in the Y axis (incremental) Positive value, the touch probe moves in positive Y direction Negative value, the touch probe moves in negative Y direction @P19 Pre-position along the Z axis Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P18 Pre-position along the Y axis Default value = 0 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.8.10.3 Syntax L CYCLE [ NAME = Sys Meas Wcs32.ecy @P.. = .. ] 2.10.8.10.4 Programming example Measure angle in Z axis (A axis) ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 G0 Z-15 #VAR ;input parameters V. L. Meas Dist Y = 10 V. L. Zero Offset Number = 54 V. L. Positioning Z = -10 ;output variables V. CYC. Sys Ret A #ENDVAR 170 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 171

Calibrating and measuring ;cycle call L CYCLE [NAME="Sys Meas Wcs32.ecy"\ @P5=V. L. Meas Dist Y\ @P7=V. L. Zero Offset Number\ @P19=V. L. Positioning Z] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret A =%f", V. CYC. Sys Ret A] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.10.5 Output variables Variable Value V. CYC. Sys Ret A Calculated A value (twist in relation to Z axis) If the workpiece is parallel to Z axis, V. CYC. Sys Ret A = 0. For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 171 Measurement
## Page 172

Calibrating and measuring 2.10.8.11 Measure angle in Z axis (B axis) After positioning, the touch probe measures in the direction of the X axis. The touch probe must be positioned as centrally as possible at measuring depth at the first measuring point either manually or in automatic mode. The calculated angle corresponds to the twist of the workpiece about the Y axis in relation to the Z axis. Fig. 45: Measure angle in Z axis (B axis) 2.10.8.11.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Measure in X axis. 2. Clearance in X to starting point. 3. Position in X and Z axes. 4. Measure in X axis. 5. Clearance in X at second starting point. 6. Calculate twist in B. 7. Description of selected zero offset. 172 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 173

Calibrating and measuring 2.10.8.11.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P4 Measurement path in the X axis (incremental) Positive value, the touch probe moves in positive X direction Negative value, the touch probe moves in negative X direction @P19 Pre-position along the Z axis Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P12 Reference angle [degrees] Default value = 0 @P17 Pre-position along the X axis It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.8.11.3 Syntax L CYCLE [ NAME = Sys Meas Wcs33.ecy @P.. = .. ] 2.10.8.11.4 Programming example Measure angle in Z axis (B axis) ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 G0 Z-15 #VAR ;input parameters V. L. Meas Dist X = 10 V. L. Zero Offset Number = 54 V. L. Positioning Z = -10 ;output variables V. CYC. Sys Ret B #ENDVAR ;cycle call TF5225 | Twin CAT 3 CNC Version: 1.321 173 Measurement
## Page 174

Calibrating and measuring L CYCLE [NAME="Sys Meas Wcs33.ecy" \ @P4=V. L. Meas Dist X \ @P7=V. L. Zero Offset Number \ @P19=V. L. Positioning Z ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret B =%f", V. CYC. Sys Ret B] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.8.11.5 Output variables Variables Value V. CYC. Sys Ret B Calculated B value (twist in relation to Z axis) If the workpiece is parallel to Z axis, V. CYC. Sys Ret B = 0. For information on the use of output variables, see Handling output variables [} 12] 174 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 175

Calibrating and measuring 2.10.9 Rectangle These cycles determined the centre point of a rectangle. The calculated value is transferred to the selected zero offset. 2.10.9.1 Inner rectangle After positioning in the pocket, the tough probe measures in the position and negative X and Y directions and uses the measured values to calculate the centre point. The touch probe must be positioned at measuring depth as centrally as possible in the pocket either manually or in automatic mode. Fig. 46: Inner rectangle 2.10.9.1.1 Process (internal cycle) The internal cycle process can be described as follows: 1. (Pre-position in X direction.) 2. Measure in X- direction. 3. Move back to starting point. 4. Then follow measurements in X+, Y- and Y+ 5. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 175 Measurement
## Page 176

Calibrating and measuring 2.10.9.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P31 Length of the pocket in X @P32 Length of the pocket in Y Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning If @P13 is not specified, the entire measuring section is traversed at the measuring feed @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.9.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs28.ecy @P.. = .. ] 2.10.9.1.4 Programming example Inner rectangle ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 G0 Z-15 #VAR ;input parameters V. L. Zero Offset Number = 54 V. L. Safety Distance = 5 V. L. Pocket Length X = 40 V. L. Pocket Length Y = 60 176 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 177

Calibrating and measuring V. L. Cross Over = 5 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Length X V. CYC. Sys Ret Length Y #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs28.ecy" \ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance \ @P31=V. L. Pocket Length X \ @P32=V. L. Pocket Length Y \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Length X =%f", V. CYC. Sys Ret Length X] #MSG SAVE ["V. CYC. Sys Ret Length Y =%f", V. CYC. Sys Ret Length Y] G0 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.9.1.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (rectangle centre point) V. CYC. Sys Ret Y Calculated Y value (rectangle centre point) V. CYC. Sys Ret Length X Calculated X length (length of rectangle) V. CYC. Sys Ret Length Y Calculated Y length (width of rectangle) For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 177 Measurement
## Page 178

Calibrating and measuring 2.10.9.2 Outer rectangle The touch probe is positioned above the spigot and then measures in the positive and negative X and Y directions after pre-positioning in each case. It then calculates the centre point from these measured values. The touch probe must be positioned as centrally as possible above the rectangular pocket either manually or in automatic mode. Fig. 47: Outer rectangle 2.10.9.2.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in X direction. 2. Pre-position in Z direction. 3. Measure in X+ direction. 4. Clearance in X- direction. 5. Move back to Z start. 6. Move back to X start. 7. Then follow measurements in X+, Y- and Y+ 8. Description of selected zero offset. 178 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 179

Calibrating and measuring 2.10.9.2.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P19 Pre-position along the Z axis above the spigot @P31 Length in X of rectangle @P32 Length in Y of rectangle Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning [mm, inch] Default value = diameter of touch probe @P33 Crossover range [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.9.2.3 Syntax L CYCLE [ NAME = Sys Meas Wcs29.ecy @P.. = .. ] 2.10.9.2.4 Programming example Outer rectangle ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Zero Offset Number = 54 V. L. Safety Distance = 10 V. L. Positioning Z = -15 V. L. Pocket Length X = 40 V. L. Pocket Length Y = 60 TF5225 | Twin CAT 3 CNC Version: 1.321 179 Measurement
## Page 180

Calibrating and measuring V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Length X V. CYC. Sys Ret Length Y #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs29.ecy" \ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance \ @P19=V. L. Positioning Z \ @P31=V. L. Pocket Length X \ @P32=V. L. Pocket Length Y \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret Length X =%f", V. CYC. Sys Ret Length X] #MSG SAVE ["V. CYC. Sys Ret Length Y =%f", V. CYC. Sys Ret Length Y] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.9.2.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (rectangle centre point) V. CYC. Sys Ret Y Calculated Y value (rectangle centre point) V. CYC. Sys Ret Length X Calculated X length (length of rectangle) V. CYC. Sys Ret Length Y Calculated Y length (width of rectangle) For information on the use of output variables, see Handling output variables [} 12] 180 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 181

Calibrating and measuring 2.10.10 Extra measurement cycles The calculated value is transferred to the selected zero offset. 2.10.10.1 Centre point across 4 drilled holes The centre points of each of the drilled holes are calculated by 4 points (see Sys Meas Wcs8) and the total centre point is calculated from the 4 centre points. The touch probe must be positioned in the drilled hole as centrally as possible at measuring depth either manually or in automatic mode. Fig. 48: Centre point across 4 drilled holes 2.10.10.1.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Pre-position in Z. 2. (Pre-position in X direction.) 3. Measure in X- direction. 4. Move back to starting point. 5. Then follow measurements in X+, Y- and Y 6. Move back to starting point in Z. 7. Position in Y on the 2nd drilled hole and repeat the measurement process. 8. Position in X on the 3rd drilled hole and repeat the measurement process. 9. Position in Y on the 4th drilled hole and repeat the measurement process. 10. Determine the central points of the 4 drilled holes 11. Description of selected zero offset. TF5225 | Twin CAT 3 CNC Version: 1.321 181 Measurement
## Page 182

Calibrating and measuring 2.10.10.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Drilled hole diameter @P17 Pre-position along the X axis above the drilled holes @P18 Pre-position along the Y axis above the drilled holes @P19 Pre-position along the Z axis above the drilled holes Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning If @P13 is not specified, the entire measuring section is traversed at the measuring feed @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.10.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs30.ecy @P.. = .. ] 2.10.10.1.4 Programming example Centre point across 4 drilled holes ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Hole Diameter = 30 V. L. Zero Offset Number = 54 182 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 183

Calibrating and measuring V. L. Safety Distance = 5 V. L. Positioning X = 40 V. L. Positioning Y = 30 V. L. Positioning Z = -15 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs30.ecy" \ @P2=V. L. Hole Diameter \ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance \ @P17=V. L. Positioning X \ @P18=V. L. Positioning Y \ @P19=V. L. Positioning Z \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.10.1.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (centre point) V. CYC. Sys Ret Y Calculated Y value (centre point) For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 183 Measurement
## Page 184

Calibrating and measuring 2.10.10.2 Centre point of a hole circle The touch probe calculated the centre points of each of the drilled holes by 4 points (see Sys Meas Wcs8) and calculated the total centre point of the hole circle from the centre points. The touch probe must be positioned as centrally as possible above the central point of the hole circle either manually or in automatic mode. Fig. 49: Centre point of a hole circle 2.10.10.2.1 Process (internal cycle) The internal cycle process can be described as follows: 1. Approach the first drilled hole 2. Pre-position in Z 3. (Pre-position in X direction.) 4. Measure in X- direction. 5. Move back to starting point. 6. Then follow measurements in X+, Y- and Y+. 7. Move back to starting point in Z. 8. The next drilled hole positions are calculated and the first drilled hole is measured. 9. When the last drilled hole is measured, the centre point of all measurements is calculated 10. Description of selected zero offset. 184 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 185

Calibrating and measuring 2.10.10.2.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P2 Drilled hole diameter @P19 Pre-position along the Z axis above the drilled holes @P29 Hole circle diameter Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measuring point along the X axis @P10 Shift the measuring point along the Y axis @P13 Safety clearance for pre-positioning If @P13 is not specified, the entire measuring section is traversed at the measuring feed @P14 Angle of hole circle [degrees] Default value = 360 @P15 Angle between the drilled holes - Alternatively, this parameter can be made using @P30 @P16 Starting angle [degrees] Default value = 0 @P30 Number of drilled holes If not specified, the number of drilled holes is calculated from the angle values. @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = 5 The number of drilled holes can be defined by the angle between the drilled holes or the number of drilled holes. It is not permissible to specify @P15 and @P30 in the same cycle. It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.10.2.3 Syntax L CYCLE [ NAME = Sys Meas Wcs31.ecy @P.. = .. ] TF5225 | Twin CAT 3 CNC Version: 1.321 185 Measurement
## Page 186

Calibrating and measuring 2.10.10.2.4 Programming example Centre point of a hole circle ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 Z5 #VAR ;input parameters V. L. Hole Diameter = 30 V. L. Zero Offset Number = 54 V. L. Positioning Z = -15 V. L. Hole Circle Diameter = 50 V. L. Number Of Holes = 3 V. L. Cross Over = 10 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs31.ecy" \ @P2=V. L. Hole Diameter \ @P7=V. L. Zero Offset Number \ @P19=V. L. Positioning Z \ @P29=V. L. Hole Circle Diameter \ @P30=V. L. Number Of Holes \ @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.10.2.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (hole circle centre point) V. CYC. Sys Ret Y Calculated Y value (hole circle centre point) For information on the use of output variables, see Handling output variables [} 12] 186 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 187

Calibrating and measuring 2.10.11 Measuring a circle segment The following cycles determine the X and Y values of the centre point of a circle segment. The determined values are transferred to the selected zero offset. 2.10.11.1 Measuring circle segment from the inside (3 points) After positioning within the drilled hole, the touch probe measures along the 3 angled straight lines defined by an incremental angle. The touch probe must be positioned in the drilled hole as centrally as possible at measuring depth either manually or in automatic mode. Z Y X Fig. 50: Measure circle segment from the inside with 3 points 2.10.11.1.1 Process (internal cycle) The internal cycle process can be described as follows 1. (Pre-position in X and Y directions using 1st angle.) 2. Measure in X and Y directions using 1st angle. 3. Move back to starting point. 4. This is followed by the measurements at angle 2 and angle 3. 5. Description of selected zero offset. 2.10.11.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input Description parameters @P2 Estimated drilled hole diameter. Here, an approximate parameter is sufficient. For calculating pre-positioning. TF5225 | Twin CAT 3 CNC Version: 1.321 187 Measurement
## Page 188

Calibrating and measuring Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measurement result along the X axis @P10 Shift the measurement result along the Y axis @P13 Safety clearance for pre-positioning If @P13 is not specified, the entire measuring section is traversed at the measuring feed @P14 Angle to measuring point 1 in relation to X+ axis [degrees] (default: 0) @P15 Incremental angle [degrees] (default: 120) @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface (default: 5) It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.11.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs36.ecy @P.. = .. ] 2.10.11.1.4 Programming example Measuring a workpiece ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G00 X50 Y20 G00 Z-10 #VAR ;input parameters V. L. Hole Diameter = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 1 V. L. Start Angle = 20 V. L. Incremental Angle = 70 V. L. Cross Over = 0 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE[NAME="Sys Meas Wcs36.ecy"\ @P2=V. L. Hole Diameter\ @P7=V. L. Zero Offset Number\ 188 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 189

Calibrating and measuring @P13=V. L. Safety Distance\ @P14=V. L. Start Angle\ @P15=V. L. Incremental Angle\ @P33=V. L. Cross Over] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] G00 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.11.1.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (circle centre point) V. CYC. Sys Ret Y Calculated Y value (circle centre point) V. CYC. Sys Ret Diameter Calculated circle diameter For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 189 Measurement
## Page 190

Calibrating and measuring 2.10.11.2 Measuring circle segment from the inside (4 points) After positioning within the drilled hole, the touch probe measures along the 3 angled straight lines defined by an incremental angle. The touch probe must be positioned in the drilled hole as centrally as possible at measuring depth either manually or in automatic mode. Z Y X Fig. 51: Measure circle segment from the inside with 4 points 2.10.11.2.1 Process (internal cycle) The internal cycle process can be described as follows 1. Pre-position in X and Y directions using 1st angle. 2. Measure in X and Y directions using 1st angle. 3. Move back to starting point. 4. This is followed by the measurements at angle 2, angle 3 and angle 4. 5. Description of selected zero offset. 2.10.11.2.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input Description parameters @P2 Estimated drilled hole diameter. Here, an approximate parameter is sufficient. For calculating pre-positioning. Optional input parameters Input parameters Description 190 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 191

Calibrating and measuring @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measurement result along the X axis @P10 Shift the measurement result along the Y axis @P13 Safety clearance for pre-positioning If @P13 is not specified, the entire measuring section is traversed at the measuring feed @P14 Angle to measuring point 1 in relation to X+ axis [degrees] (default: 0) @P15 Incremental angle [degrees] (default: 90) @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface (default: 5) It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.11.2.3 Syntax L CYCLE [ NAME = Sys Meas Wcs37.ecy @P.. = .. ] 2.10.11.2.4 Programming example Measuring a workpiece ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G00 X50 Y20 G00 Z-10 #VAR ;input parameters V. L. Hole Diameter = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 1 V. L. Start Angle = 20 V. L. Incremental Angle = 44 V. L. Cross Over = 0 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE[NAME="Sys Meas Wcs37.ecy"\ @P2=V. L. Hole Diameter\ @P7=V. L. Zero Offset Number\ @P13=V. L. Safety Distance\ @P14=V. L. Start Angle\ @P15=V. L. Incremental Angle\ @P33=V. L. Cross Over] TF5225 | Twin CAT 3 CNC Version: 1.321 191 Measurement
## Page 192

Calibrating and measuring ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] G00 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.11.2.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (circle centre point) V. CYC. Sys Ret Y Calculated Y value (circle centre point) V. CYC. Sys Ret Diameter Calculated circle diameter For information on the use of output variables, see Handling output variables [} 12] 192 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 193

Calibrating and measuring 2.10.11.3 Measuring circle segment from the outside (3 points) After positioning above the spigot, the touch probe measures along the 3 angled straight lines defined by an incremental angle. The touch probe must be positioned in the drilled hole as centrally as possible at measuring depth either manually or in automatic mode. Fig. 52: Measure circle segment from the outside with 3 points 2.10.11.3.1 Process (internal cycle) The internal cycle process can be described as follows 1. Pre-position in X and Y directions using 1st angle. 2. Pre-position in Z direction. 3. Measure in X and Y directions using 1st angle. 4. Lift in Z and return to start point. 5. This is followed by the measurements at angle 2 and angle 3. 6. Description of selected zero offset. 2.10.11.3.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input Description parameters @P2 Estimated spigot diameter. Here, an approximate parameter is sufficient. For calculating pre-positioning. Optional input parameters Input parameters Description TF5225 | Twin CAT 3 CNC Version: 1.321 193 Measurement
## Page 194

Calibrating and measuring @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measurement result along the X axis @P10 Shift the measurement result along the Y axis @P13 Safety clearance for pre-positioning Default: diameter of touch probe @P14 Angle to measuring point 1 in relation to X+ axis [degrees] Default: 0 @P15 Incremental angle [degrees] Default: 120 @P19 Pre-position in the Z axis, relative @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default: 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.11.3.3 Syntax L CYCLE [ NAME = Sys Meas Wcs38.ecy @P.. = .. ] 2.10.11.3.4 Programming example Measuring a workpiece ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G00 X50 Y20 G00 Z10 #VAR ;input parameters V. L. Spigot Diameter = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 3 V. L. Start Angle = 20 V. L. Incremental Angle = 70 V. L. Cross Over = 5 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE[NAME="Sys Meas Wcs38.ecy" \ @P2=V. L. Spigot Diameter \ @P7=V. L. Zero Offset Number \ @P13=V. L. Safety Distance \ @P14=V. L. Start Angle \ @P15=V. L. Incremental Angle \ 194 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 195

Calibrating and measuring @P33=V. L. Cross Over ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] G00 Z0 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.11.3.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (circle centre point) V. CYC. Sys Ret Y Calculated Y value (circle centre point) V. CYC. Sys Ret Diameter Calculated circle diameter For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 195 Measurement
## Page 196

Calibrating and measuring 2.10.11.4 Measuring circle segment from the outside (4 points) After positioning above the spigot, the touch probe measures along the 4 angled straight lines defined by an incremental angle. The touch probe must be positioned outside the spigot as centrally as possible at measuring depth either manually or in automatic mode. Z Y X Fig. 53: Measure circle segment from the outside with 4 points 2.10.11.4.1 Process (internal cycle) The internal cycle process can be described as follows 1. Pre-position in X and Y directions using 1st angle. 2. Pre-position in Z direction. 3. Measure in X and Y directions using 1st angle. 4. Lift in Z and return to start point. 5. This is followed by the measurements at angle 2, angle 3 and angle 4. 6. Description of selected zero offset. 2.10.11.4.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input Description parameters @P2 Estimated spigot diameter. Here, an approximate parameter is sufficient. For calculating pre-positioning. Optional input parameters Input parameters Description 196 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 197

Calibrating and measuring @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measurement result along the X axis @P10 Shift the measurement result along the Y axis @P13 Safety clearance for pre-positioning Default: diameter of touch probe @P14 Angle to measuring point 1 in relation to X+ axis [degrees] Default: 0 @P15 Incremental angle [degrees] Default: 90 @P19 Pre-position in the Z axis, relative @P33 Crossover range (unsigned) [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default: 5 It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.11.4.3 Syntax L CYCLE [ NAME = Sys Meas Wcs39.ecy @P.. = .. ] 2.10.11.4.4 Programming example Measuring a workpiece ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G00 X50 Y20 G00 Z10 #VAR ;input parameters V. L. Spigot Diameter = 20 V. L. Zero Offset Number = 54 V. L. Safety Distance = 3 V. L. Start Angle = 20 V. L. Incremental Angle = 70 V. L. Cross Over = 5 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE[NAME="Sys Meas Wcs39.ecy" @P2 = V. L. Spigot Diameter \ @P7 = V. L. Zero Offset Number \ @P13 = V. L. Safety Distance \ @P14 = V. L. Start Angle \ @P15 = V. L. Incremental Angle \ @P33 = V. L. Cross Over ] TF5225 | Twin CAT 3 CNC Version: 1.321 197 Measurement
## Page 198

Calibrating and measuring ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] G00 Z0 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.11.4.5 Output variables Variables Value V. CYC. Sys Ret X Calculated X value (circle centre point) V. CYC. Sys Ret Y Calculated Y value (circle centre point) V. CYC. Sys Ret Diameter Calculated circle diameter For information on the use of output variables, see Handling output variables [} 12] 198 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 199

Calibrating and measuring 2.10.12 Measuring a corner The following cycles determine the X and Y values of the corner and the rotation of the workpiece. The determined values are transferred to the selected zero offset. 2.10.12.1 Rectangular corner This cycle measures a rectangular outside or inside corner. This requires three measuring points. Outside and inside corners are distinguished by an appropriate enquiry of the input parameters, as described in the related subsection. If @P7 is specified, only the corner coordinates in X and Y are written to the zero offset, but not the twist in C. If required, the twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Z Y X Fig. 54: Rectangular inside and outside corners 2.10.12.1.1 Process (internal cycle) The internal cycle process can be described as follows 1. Approach the pre-position. 2. Measure in Y axis. 3. Clearance in Y at starting point. 4. Position in X axis. 5. Measure in Y axis. 6. Clearance in Y at second starting point. 7. Position in X axis. 8. Position in Y axis. 9. Measure in X axis. 10. Description of selected zero offset. 2.10.12.1.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P4 Measurement path in the X axis (incremental) Positive value, the touch probe moves in positive X direction Negative value, the touch probe moves in negative X direction TF5225 | Twin CAT 3 CNC Version: 1.321 199 Measurement
## Page 200

Calibrating and measuring @P5 Measurement path in the Y axis (incremental) Positive value, the touch probe moves in positive Y direction Negative value, the touch probe moves in negative Y direction @P17 Pre-position in the X axis (absolute), position of measuring point 1 @P18 Pre-position in the Y axis (absolute), position of measuring point 1 @P41 Relative path distance along X axis from measuring point 1 to measuring point 2 @P42 Relative path distance along X axis from measuring point 2 to measuring point 3 @P43 Relative path distance along Y axis from measuring point 2 to measuring point 3 Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measurement result along the X axis @P10 Shift the measurement result along the Y axis @P12 Reference angle [degrees] (default 0) Difference between outside and inside corners An outside corner is traversed when • @P5 > 0 and @P43 > 0, or • @P5 < 0 and @P43 < 0. An inside corner is traversed when • @P5 > 0 and @P43 < 0, or • @P5 < 0 and @P43 > 0. It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.12.1.3 Syntax L CYCLE [ NAME = Sys Meas Wcs34.ecy @P.. = .. ] 2.10.12.1.4 Programming example Measuring a rectangular outside corner ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 G0 Z-10 #VAR ;input parameters 200 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 201

Calibrating and measuring V. L. Meas Dist X = 5 V. L. Meas Dist Y = 5 V. L. Zero Offset Number = 54 V. L. Positioning X = 10 V. L. Positioning Y = 10 V. L. Relative X1 = -30 V. L. Relative X2 = -30 V. L. Relative Y = 30 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE[NAME="Sys Meas Wcs34.ecy"\ @P4=V. L. Meas Dist X\ @P5=V. L. Meas Dist Y\ @P7=V. L. Zero Offset Number\ @P17=V. L. Positioning X\ @P18=V. L. Positioning Y\ @P41=V. L. Relative X1\ @P42=V. L. Relative X2\ @P43=V. L. Relative Y] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] G00 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.12.1.5 Output variables Variable Value V. CYC. Sys Ret X Calculated X value of corner V. CYC. Sys Ret Y Calculated Y value of corner V. CYC. Sys Ret C Calculated C value, twist of workpiece in relation to X axis For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 201 Measurement
## Page 202

Calibrating and measuring 2.10.12.2 Any corner This cycle measures any outside or inside corner. This requires four measuring points. Outside and inside corners are distinguished by an appropriate enquiry of the input parameters, as described in the related subsection. If @P7 is specified, only the corner coordinates in X and Y are written to the zero offset, but not the twist in C. If required, the twist in C can be manually transferred to the related zero offset by evaluating the output variables in the post-program. Z Y X Fig. 55: Any inside and outside corners 2.10.12.2.1 Process (internal cycle) The internal cycle process can be described as follows 1. Approach the pre-position. 2. Measure in Y axis. 3. Clearance in Y at starting point. 4. Position in X axis. 5. Measure in Y axis. 6. Clearance in Y at second starting point. 7. Position in X axis. 8. Position in Y axis. 9. Measure in X axis. 10. Position in Y axis. 11. Measure in X axis. 12. Description of selected zero offset. 2.10.12.2.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input parameters Description @P4 Measurement path in the X axis (incremental) Positive value, the touch probe moves in positive X direction Negative value, the touch probe moves in negative X direction @P5 Measurement path in the Y axis (incremental) Positive value, the touch probe moves in positive Y direction Negative value, the touch probe moves in negative Y direction 202 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 203

Calibrating and measuring @P17 Pre-position in the X axis (absolute), position of measuring point 1 @P18 Pre-position in the Y axis (absolute), position of measuring point 1 @P41 Relative path distance along X axis from measuring point 1 to measuring point 2 @P42 Relative path distance along X axis from measuring point 2 to measuring point 3 @P43 Relative path distance along Y axis from measuring point 2 to measuring point 3 @P44 Relative path distance along Y axis from measuring point 3 to measuring point 4 Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measurement result along the X axis @P10 Shift the measurement result along the Y axis @P12 Reference angle [degrees] (default: 0) Difference between outside and inside corners An outside corner is traversed when • @P5 > 0 and @P43 > 0, or • @P5 < 0 and @P43 < 0. An inside corner is traversed when • @P5 > 0 and @P43 < 0, or • @P5 < 0 and @P43 > 0. It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 2.10.12.2.3 Syntax L CYCLE [ NAME = Sys Meas Wcs35.ecy @P.. = .. ] 2.10.12.2.4 Programming example Measuring any outside corner ; touch probe activation T1 D1 ; deactivation of the zero offset G53 ; positioning to the starting point G0 X0 Y0 G0 Z-10 #VAR ;input parameters V. L. Meas Dist X = 5 V. L. Meas Dist Y = 5 V. L. Zero Offset Number = 54 V. L. Positioning X = 10 TF5225 | Twin CAT 3 CNC Version: 1.321 203 Measurement
## Page 204

Calibrating and measuring V. L. Positioning Y = 10 V. L. Relative X1 = -30 V. L. Relative X2 = -30 V. L. Relative Y1 = 30 V. L. Relative Y2 = 30 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret C #ENDVAR ;cycle call L CYCLE[NAME="Sys Meas Wcs35.ecy"\ @P4=V. L. Meas Dist X\ @P5=V. L. Meas Dist Y\ @P7=V. L. Zero Offset Number\ @P17=V. L. Positioning X\ @P18=V. L. Positioning Y\ @P41=V. L. Relative X1\ @P42=V. L. Relative X2\ @P43=V. L. Relative Y1\ @P44=V. L. Relative Y2] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y] #MSG SAVE ["V. CYC. Sys Ret C =%f", V. CYC. Sys Ret C] G00 Z10 M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.12.2.5 Output variables Variable Value V. CYC. Sys Ret X Calculated X value of corner V. CYC. Sys Ret Y Calculated Y value of corner V. CYC. Sys Ret C Calculated C value, twist of workpiece in relation to X axis For information on the use of output variables, see Handling output variables [} 12] 204 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 205

Calibrating and measuring 2.10.13 Measuring a sphere This cycle determines the diameter and centre point of a sphere. The determined value of the sphere centre point is transferred to the selected zero offset. The touch probe therefore measures the sphere from the top in Z direction and then from the side in positive and negative X and Y directions. The tip of the touch probe must be round in order to obtain precise results. @P15 @P14 @P6 @P13 @P33 Z Y @P87 X Fig. 56: Measuring a sphere 2.10.13.1 Process (internal cycle) Starting position before the cycle is called: The touch probe must be positioned either manually or in automatic mode as centrally as possible and at a short clearance above the first sphere. It stands vertically, i.e. the touch probe rotation stands at 0. The internal cycle process can be described as follows: 1. The spindle must be in its initial position at cycle start. 2. The touch probe first runs a measurement in the Z direction and a total of four lateral measurements, after which it returns to the starting position. 3. If a measurement repetition was specified in @P88 to enhance accuracy, the measurement is re- peated, whereby the lateral measurements take place at the calculated height of the equator. 4. The touch probe travels to starting height above the measured centre point of the sphere. 2.10.13.2 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required input parameters Input Description parameters @P6 Measurement path in the direction of the negative Z axis TF5225 | Twin CAT 3 CNC Version: 1.321 205 Measurement
## Page 206

Calibrating and measuring @P87 Estimated diameter of the sphere. Here, an approximate parameter is sufficient. For calculating pre-positioning. Optional input parameters Input parameters Description @P7 Zero offset to be described (TCS) G159=1 to G159=9 and G54 to G59 Input without address "G159=" or "G" If not specified, then measurement only but no write function Only permitted when G53 is active at cycle call. @P9 Shift the measurement result along the X axis (shifts origin of the zero offset) @P10 Shift the measurement result along the Y axis (shifts origin of the zero offset) @P11 Shift the measurement result along the Z axis (shifts origin of the zero offset) @P13 Safety clearance for pre-positioning Default: diameter of touch probe @P14 Probe angle of the first lateral measurement in relation to the positive X axis [degrees] Default: 0 @P15 Difference of the probe angle between the lateral measurements [degrees] Default: 90 @P33 Crossover range during measurement process [mm, inch] Additional motion path that exceeds the expected workpiece edge/workpiece surface Default: @P87/4 @P64 Definition of the path to approach to pre-position 0: linear (default) 1: circular (Caution: collision detection is disabled) @P88 Measurement repetition at the height of the equator using calculated parameters from the first pass for enhanced accuracy 1: yes 2: no (default) NOTICE If circular approach of the pre-position was selected in @P64, collision detection is dis- abled. This option may only be enabled if safe approach to the pre-position is ensured. It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.10.13.3 Syntax L CYCLE [ NAME = Sys Meas Wcs40.ecy @P.. = .. ] 2.10.13.4 Programming example Measuring a sphere ; touch probe activation T1 D1 M6 ; deactivation of the zero offset G53 ; positioning to the starting point G00 X100 Y300 Z200 206 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 207

Calibrating and measuring G00 Z10 #VAR ;input parameters V. L. Meas Dist Z = 100 V. L. Zero Offset Number = 56 V. L. Safety Distance = 100 V. L. Start Angle = 90 V. L. Incremental Angle = 45 V. L. Cross Over = 100 V. L. Path Definition = 1 V. L. Sphere Diameter = 400 ;output variables V. CYC. Sys Ret X V. CYC. Sys Ret Y V. CYC. Sys Ret Z V. CYC. Sys Ret Diameter #ENDVAR ;cycle call L CYCLE [NAME="Sys Meas Wcs40.ecy" @P6 = V. L. Meas Dist Z \ @P7 = V. L. Zero Offset Number \ @P13 = V. L. Safety Distance \ @P14 = V. L. Start Angle \ @P15 = V. L. Incremental Angle \ @P33 = V. L. Cross Over \ @P64 = V. L. Path Definition \ @P87 = V. L. Sphere Diameter ] ; print result #FILE NAME [MSG="Sys Meas Wcs Result.txt"] #MSG SAVE ["V. CYC. Sys Ret X =%f", V. CYC. Sys Ret X ] #MSG SAVE ["V. CYC. Sys Ret Y =%f", V. CYC. Sys Ret Y ] #MSG SAVE ["V. CYC. Sys Ret Z =%f", V. CYC. Sys Ret Z ] #MSG SAVE ["V. CYC. Sys Ret Diameter =%f", V. CYC. Sys Ret Diameter] M30 Another example for handling Sys Meas Wcs cycles is contained in the Overview section [} 81] in the subsection Programming. 2.10.13.5 Output variables Variable Value V. CYC. Sys Ret X Calculated X value of sphere centre point with offset added (@P9) V. CYC. Sys Ret Y Calculated Y value of sphere centre point with offset added (@P10) V. CYC. Sys Ret Z Calculated Z value of sphere centre point with offset added (@P11) V. CYC. Sys Ret Diameter Calculated sphere diameter For information on the use of output variables, see Handling output variables [} 12] TF5225 | Twin CAT 3 CNC Version: 1.321 207 Measurement
## Page 208

Calibrating and measuring 2.11 Measuring a tool 2.11.1 Overview These instructions describe the automatic measurement of tools using a tool touch probe. Fig. 57: Measuring a tool Possible applications The cycle can also automatically measure the length and/or radius of tools. Prerequisites To ensure that the successful measurement of the tool, the following requirements must be met: 1. Tool touch probe is fitted and active 2. The tool touch probe was already calibrated [} 34] 3. The required measurement and pre-positioning velocities and the touch probe parameters were entered in the configuration file [} 208]. 2.11.2 Description 2.11.2.1 Configuration file The Sys Calib Config Tool Setting Probe.nc file is executed within the cycle and helps to parameterise the tool touch probe. The following variables must be defined to measure a tool. For the value MESS_POS, the number transferred to the cycle by @P20 must be entered. Variables Description V. CYC. Sys Conf_Meas_feed[MESS_POS] Measuring feed V. CYC. Sys Conf_Meas_feed_max[MESS_POS] Positioning feed V. CYC. Sys Conf_Pos_Ax1[MESS_POS] Centre of touch probe in the X axis V. CYC. Sys Conf_Pos_Ax2[MESS_POS] Centre of touch probe in the Y axis 208 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 209

Calibrating and measuring V. CYC. Sys Conf_Pos_Ax3[MESS_POS] Surface position of touch probe in the Z axis V. CYC. Sys Conf_Plate_Diam[MESS_POS] Diameter of touch probe plate. For example, the configuration file Sys Calib Config Tool Setting Probe.nc may look like this: Configuration file V. CYC. Sys Conf_Meas_feed[1] = 500 (measuring feed rate) V. CYC. Sys Conf_Meas_feed_max[1] = 1000 (positioning feed rate) V. CYC. Sys Conf_Pos_Ax1[1] = 10 (probe position in X) V. CYC. Sys Conf_Pos_Ax2[1] = 20 (probe position in Y) V. CYC. Sys Conf_Pos_Ax3[1] = 30 (probe position in Z) V. CYC. Sys Conf_Plate_Diam[1] = 30 (estimated plate diameter) M17 2.11.2.2 Pre- and post-files For this cycle there is a pre-file which must be called before this cycle and a post-file which is called after this cycle. These files are optional. If they do not exist, this step is skipped. As required, these files must therefore be created as a subroutine. Machine-specific adaptations, e.g. activation of the touch probe, can be carried out in the pre-file. The post-file can be used to process output variables, for example. Pre- and post-files must have the following names: • Sys Meas Tool Pre • Sys Meas Tool Post 2.11.2.3 Process (internal cycle) Before cycle start, the tool must be positioned centrally above the tool touch probe. After cycle start, the following process then results when default parameters are used: 1. In measuring mode 1 or 3, measurement takes place in the Z direction and the probe is then lifted to the starting position. 2. In measuring mode 2 or 3, the tool is positioned in X+ direction next to the measuring plate and meas- urement takes place in the direction of the plate centre. 3. Optionally, this process is repeated in different directions. 2.11.2.4 Parameters Required input parameters Input parameters Description @P6 Measurement path in the direction of the negative Z axis [mm, inch] @P22 Measurement offset in Z for lateral measurements [mm, inch] Optional input parameters Input parameters Description @P13 Safety clearance for lateral measurements [mm, inch] Default value = 1/4 of measuring plate diameter. @P14 Probe angle for first lateral measurement [degrees] Default value = 0 @P15 Incremental angle for lateral measurements [degrees] Default value = 360 / number of samples (@P23) TF5225 | Twin CAT 3 CNC Version: 1.321 209 Measurement
## Page 210

Calibrating and measuring @P16 Measuring feed for a slow measurement If defined, the measurements are repeated at the specified feed rate. @P17 Radial return clearance for the slow measurement [mm, inch] Default value = 1 @P18 Axial return clearance for the slow measurement [mm, inch] Default value = 1 @P20 Measuring station numbering (Required to read out the configuration from Sys Calib Tool Setting Probe.nc) Default value = 1 @P23 Number of lateral samples Default value = 1 @P25 Measuring mode 1: Measure only tool length 2: Measure only tool radius (tool must be known) 3: Measure tool length and tool radius (default value) It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.11.2.5 Syntax L CYCLE [ NAME = Sys Meas Tool.ecy @P.. = .. ] 2.11.2.6 Programming example Measuring a tool To execute the programming example, save the configuration file Sys Calib Config Tool Setting Probe.nc with the following contents: V. CYC. Sys Conf_Meas_feed[1] = 500 V. CYC. Sys Conf_Meas_feed_max[1] = 1000 V. CYC. Sys Conf_Pos_Ax1[1] = 530.219 V. CYC. Sys Conf_Pos_Ax2[1] = -210.234 V. CYC. Sys Conf_Pos_Ax3[1] = -437.126 V. CYC. Sys Conf_Plate_Diam[1] = 39.982 M17 Call the cycle using the following program after changing the reference tool and positioning it above the centre of the touch probe: L CYCLE [NAME=Sys Meas Tool.ecy \ @P6 = 30 \ @P22 = 10 \ ] M30 2.11.2.7 Output variables Cycle parameters Description V. CYC. Sys Ret Tool Length Measured tool length. V. CYC. Sys Ret Tool Radius Measured tool radius. See information on use of the output variables [} 12]. 210 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 211

Calibrating and measuring Result values can be transferred to the tool database by using External Variables in the post-program, for example. TF5225 | Twin CAT 3 CNC Version: 1.321 211 Measurement
## Page 212

Calibrating and measuring 2.12 Measuring a rotary axis 2.12.1 Overview This cycle measures a rotary axis in the current coordinate system by scanning a calibration sphere. The result permits a check of the direction of the rotary axis and the angle travelled in the cycle. With stationary rotary axes, the position of the rotary axis can also be determined. The cycle can measure both manual axes and NC-controlled axes. Effectiveness The examples below define conceivable application cases. • Detecting incorrect positions of the rotary axis, for example after start-up • Determining the position of a stationary rotary axis, for example a round table or a stationary rotary axis • Checking the actually traversed angles of the rotary axis Condition To ensure that the successful measurement of the rotary axis, the following requirements must be met. • Calibrated touch probe • Mounted calibration sphere whose diameter significantly exceeds the touch probe tip • During the measurement, the measured rotary axis may not be involved in a kinematic transformation (RTCP / complete transformation) • During pre-positioning within the cycle, only linear axes and rotary axes involved in a complete kinematic transformation may be moved 2.12.2 Description 2.12.2.1 General The Sys Calib Config Touchprobe.nc calibration file must be present and the corresponding parameters must be configured before the cycles are used, otherwise the cycles cannot run. If no measuring signal is triggered during the measurement, the machine stops with the error message: "No workpiece detected, please check your measuring section“ P-ERR-13413. If a measurement is detected while positioning the measuring motion during the cycle, the machine stops with the error message: “Collision on positioning, please check your motion range” P-ERR-13414. The measurement results are saved in V. CYC. variables and can be processed in the post-files. An overview of existing output variables is contained in each of the cycle subsections. 2.12.2.2 Pre- and post-files For this cycle there is a pre-file which must be called before this cycle and a post-file which is called after this cycle. These files are optional. If they do not exist, this step is skipped. As required, these files must therefore be created as a subroutine. Generally, a post-file is required to process the output variables stored in local V. CYC. variables. Machine-specific adaptations, e.g. activation of the touch probe, can be carried out in the pre-file. The post- file can be used to process output variables, for example. Pre- and post-files must have the following names: • Sys Meas Rot Ax Pre.nc 212 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 213

Calibrating and measuring • Sys Meas Rot Ax Post.nc 2.12.2.3 Configuration file The following items are required to successfully configure the touch probe: • the radius of the touch probe sphere, the offsets in X and Y and the length of the touch probe must be defined using the tool data. • The configuration file Sys Calib Config Touchprobe.nc was created, containing at least the measuring and positioning feed rates. Detailed description The Sys Calib Config Touchprobe.nc file is executed before each cycle to identify the touch probe parameters. The following variables must then be defined. Variable Description V. CYC. Sys Conf_Probes Measuring feed during measurement. _feed V. CYC. Sys Conf_Probes Positioning feed rate between measuring points. _feed_max V. CYC. Sys Conf_Spindl Definition whether the touch probe is to be positioned in the measurement e_orientation direction before every measurement run. 0 = touch probe is not positioned (default value). Touch probe must be in initial position before the start of the cycle. 1 = touch probe is positioned V. CYC. Sys Conf_Probes Measuring feed for a second probing at a slow speed. _feed_repeat If defined with a value > 0, the probe is retracted slightly after the first probing and the measurement is repeated. Default value = 0. V. CYC. Sys Conf_Probes Retraction distance in the measuring direction for the second probing at a slow _dist_repeat speed. Only used if V. CYC. Sys Conf_Probes_feed_repeat is greater than zero. Default value = 2. V. CYC. Sys Conf_Spindl Definition of the basic angle specified to position the touch probe. e_angle Only used if V. CYC. Sys Conf_Spindle_orientation = 1. Corresponds to the spindle position (M19) required for measuring in the positive X direction. Default value = 0. V. CYC. Sys Conf_Spindl Position of the spindle final position when positioned with M19. e_Pos_Dir Only used if V. CYC. Sys Conf_Spindle_orientation = 1. 0 = The spindle positions the touch probe clockwise when the touch probe tip is viewed from below (default value). 1 = The spindle positions the touch probe counter clockwise when the touch probe tip is viewed from below. V. CYC. Sys Conf_Probes Spindle feed rate for spindle positioning of the touch probe. _spdl_feed Default value = 200 V. CYC. Sys Conf_Probes Time in seconds to wait for the spindle to reposition before a corresponding _spdl_wait measurement run. Default value = 1 V. CYC. Sys Conf_Retract Feed rate from pre-positioning to start position. _Pre Pos_feed If 0 is specified, the pre-positioning velocity is used. Default value = 0 TF5225 | Twin CAT 3 CNC Version: 1.321 213 Measurement
## Page 214

Calibrating and measuring V. CYC. Sys Conf_Retract Retract velocity after measurement event _Meas_feed If 0 is specified, the measuring feed is used. Default value = 0 Additional configuration data for the touch probe is read from the current tool data. The touch probe must therefore be defined as a current tool and its tool data must be saved (except for calibration). The tool data to be considered includes: • The radius of the touch probe sphere (V. G. WZ_AKT. R) • The length of the touch probe (V. G. WZ_AKT. L) • Horizontal offsets of the touch probe tip relative to the spindle flange (V. G. WZ_AKT. V. X and W. G. WZ_AKT. V. Y) The measurement results are calculated to include the offsets between the touch probe tip and the spindle flange and the radius of the touch probe sphere. For example, the configuration file Sys Calib Config Touchprobe.nc may look like this: Configuration file %Sys Calib Config Touchprobe.nc V. CYC. Sys Conf_Probes_feed = 500 (measuring feed rate) V. CYC. Sys Conf_Probes_feed_max = 1000 (positioning feed rate) V. CYC. Sys Conf_Spindle_orientation = 0 (positioning of probe) V. CYC. Sys Conf_Spindle_angle = 0 (probe basic angle) V. CYC. Sys Conf_Probes_feed_repeat = 0 (repetition feed rate) V. CYC. Sys Conf_Probes_dist_repeat = 2 (distance of repetition) V. CYC. Sys Conf_Probes_spdl_feed = 200 (spindle speed) V. CYC. Sys Conf_Probes_spdl_wait = 1 (dwell time) V. CYC. Sys Conf_Spindle_Pos_Dir = 0 (spindle pos. direction) V. CYC. Sys Conf_Retract_Pre Pos_feed = 0 (retract pre pos.feed rate) V. CYC. Sys Conf_Retract_Meas_feed = 0 (retract meas. feed rate) M17 2.12.2.4 Process and pre-positioning A calibration sphere is measured a total of three times to measure the rotary axis. Between each of these measurements, the angle of the measured axis must be changed and the calibration sphere re-approached. Pre-positioning between calls is executed by the user. During pre-positioning, only linear axes and rotary axes involved in a complete kinematic transform- ation may be moved. During the measurement, the measured rotary axis may not be involved in a kinematic transformation. The orientation of the touch probe head in the current coordinate system may only be changed during pre- positioning by the axis to be measured. Two cases are conceivable to use this cycle: 1. Measuring a stationary rotary axis: The position of the rotary axis in the current coordinate system is fixed or no upstream axis must be moved for pre-positioning (e.g. round table). In this case, the calib- ration sphere must be mounted so that the position of its centre point in the current coordinate system co-rotates with the rotation of the rotary axis. The position of the touch probe head can be moved for pre-positioning by linear axes or by rotary axes involved in a kinematic transformation. 214 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 215

Calibrating and measuring +C -C +C -C Zw Yw Xw Fig. 58: Measuring a stationary rotary axis 1. Measuring a moved rotary axis: The position of the rotary axis is changed by upstream linear axes (e.g. 5-axis machine with swivel head). In this case, the calibration sphere must be mounted stationary in the current coordinate system. The touch probe head co-rotates with the measured rotary axis. The measured rotary axis may not be involved in any kinematic transformation so that a distinction can be made between the measured centre points of the calibration sphere. +Z +A +A +Y -Z -Z -A +X -Y -A -X -Y Yw Zw Xw Fig. 59: Measuring a moved rotary axis 2.12.2.5 Mounting the calibration sphere To measure a stationary rotary axis, the co-rotating calibration sphere must be positioned so that its position is as far as possible away from the centre of rotation. The angle about which the rotary axis rotates between each of the measurements should be selected so that the centre point of the calibration sphere lies far apart between measurements. Zw Yw Xw Fig. 60: Mounting the calibration sphere TF5225 | Twin CAT 3 CNC Version: 1.321 215 Measurement
## Page 216

Calibrating and measuring With moved rotary axes, the angles between measurements should be as large as possible. In addition, the position of the touch probe head tip must change when the measured axis rotates. If this is not the case, an additional rotary axis can be swivelled in at the beginning. However, the additional rotary axis may not be repositioned during the entire cycle. This special case is treated in the programming example “Measuring with inclined touch probe head”. Z Y Fig. 61: Positions of the touch probe head tip 2.12.3 Process The calibration sphere is measured a total of three times within the cycle. The measurement movements of the sphere measurement are oriented towards the measurement cycle for sphere measurement, whereby the measurement movements co-rotate with the measured axis. Between measurements, the user initiates the approach of the starting position for the next measurement. The Pre-positioning section goes into greater detail on what the user must pay special attention to. The pre- position can be approached manually, in manual mode or also using an NC subroutine. Before the start of the cycle, the touch head probe must be positioned vertically and as centrally as possible above the calibration sphere. If the touch probe head cannot be positioned vertically before the first measurement, an additional adaptation must be made in the input parameters (for more details, see the section Compensation for an inclined position). The measurement movements are co-rotated with the measured axis. In order to obtain a reliable estimate of the resulting measurement movement in advance, it is recommended to rotate the measured axis only by a small angle in a first pass. Of course, another possible alternative is run a preliminary simulation of the cycle. The process can be described as follows: Starting position before the cycle is called: The touch probe must be positioned either manually or in automatic mode as centrally as possible and at a short distance above the first sphere. It stands vertically, i.e. the touch probe rotation stands at 0. If this is not possible, a compensation must be executed using input parameters. After the cycle is called: 1. The touch probe first runs a measurement vertically to its orientation and a total of four lateral meas- urements, after which it returns to the starting position. 2. The calibration sphere or the touch probe is pre-positioned again. Depending on the input parameters, this is done manually, in manual mode or with NC subroutines. The measured rotary axis must be ro- tated by the largest possible angle and the touch probe must be repositioned. 3. Repeated measurement of the sphere. 216 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 217

Calibrating and measuring 4. The calibration sphere or the touch probe is pre-positioned again. 5. Repeated measurement of the sphere 6. The touch probe travels to the starting point of the third measurement. The general cycle process with subroutine calls takes place as follows. Sys Meas Rot Ax Pre.nc (optional) Sys Calib Config Touchprobe.nc Sys Meas Rot Ax Pre Pos2.nc (optional) Sys Meas Rot Ax Pre Pos3.nc (optional) Sys Meas Rot Ax Post.nc (optional) 2.12.4 Pre-positioning NOTICE A collision-free measurement movement must be ensured for all three measurements. Please note here that the measurement movements co-rotate with the measured axis. This also applies to the probe angle and incremental angle. Pre-position of the first measurement / cycle starting point The pre-position of the first measurement is obtained from the cycle starting point. The touch probe must be positioned as centrally and vertically as possible above the calibration sphere. If the touch probe head cannot be positioned vertically at the start, an additional adaptation is required in the input parameters (for more details, see the Section Compensation for an inclined position). Pre-positioning the second and third measurements To pre-position the second and third measurements, the user must move measured rotary axis through any angle but which is as large as possible. Then the starting position for the next measurement must be selected so that the touch probe head is flush with the sphere centre point, i.e. points to the centre point of the calibration sphere. During pre-positioning, only linear axes and rotary axes involved in a complete kinematic transformation may be moved. During the measurement, the measured rotary axis may not be involved in a kinematic transformation. The orientation of the touch probe head in the current coordinate system may only be changed during pre-positioning by the axis to be measured. The measurement movement is co-rotated with the measured axis. The following rotation of the sphere measurement movement is obtained when the measured axis rotates, for example, about the Y axis in the current coordinate system and was turned through 35 degrees. Z Y X Fig. 62: Pre-positioning with rotation about the Y axis TF5225 | Twin CAT 3 CNC Version: 1.321 217 Measurement
## Page 218

Calibrating and measuring Co-rotation of measurement movements also applied to the probe angle. If the measured axis rotates about the Y axis and it was turned through 90° for pre-positioning, this rotation would place the X axis on the Z axis in a right-hand coordinate system In this case, the probe angle refers to the Z axis of the original coordinate system. The rotation vector of the measured axis must be defined by the input parameters to adapt the measurement movement automatically. Minor deviations are insignificant here since these values are only relevant to the measurement movements. However, they have no direct influence on the measurement result. With manual pre-positioning, the traversed angle must also be defined. Pre-positioning the second and third measurements with NC subroutines If pre-positioning of the second and third measurement are to take place automatically, suitable NC subroutines can be saved here to execute the corresponding movements. It is recommended to pre-position the cycle in manual mode for the first application. Movements travelled in manual mode and resulting in successful execution of the cycle can then be integrated in the NC subroutines. This permits a completely automated execution of the cycle. The input parameter @P90 must be set to 0 for automated pre-positioning. In addition, the files Sys Meas Rot Ax Pre Pos2.nc and Sys Meas Rot Ax Pre Pos3.nc must be saved. The file Sys Meas Rot Ax Pre Pos2.nc is called after the first sphere measurement and describes the pre-positioning for the second measurement. The file Sys Meas Rot Ax Pre Pos3.nc is called after the second sphere measurement and describes the pre-positioning for the third measurement. Refer to the section Programming examples for an example of how these NC subroutines can look like. Compensating an inclined position of the touch probe head at the start of the cycle. If the touch probe head cannot be positioned vertically for the first measurement due to the machine design, the inclined position can be compensated by the parameters @P94-@P97. The inclined position of the touch probe head is defined here by defining a rotary axis and a rotation angle. This permits compensation of the measurement movement to the inclined axis. This adaptation is only required for the first measurement pass. The inclined position of the touch probe in the graphic below can be described by a rotation of 20° about the Y axis. In this case, the following parameter definition should be transferred in order to execute the cycle successfully. @P94 = 0, @P95 = 1, @P96 = 0, @P97 = 20 Z Y X Fig. 63: Touch probe with inclined position For pre-positioning, the touch probe head must still point to the centre point of the sphere. The touch probe offsets in the X and Y directions determined by calibrating the touch probe are of no consequence here. 218 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 219

Calibrating and measuring 2.12.5 Parameters The touch probe must be configured in addition to supplying the input parameters described here. For more information on this function, see the section Configuration file [} 84]. The (calibrated) parameters of the touch probe (radius, length and offset in X and Y directions) are specified via the tool parameters. Required parameters Cycle Description parameters @P6 Measurement path in the direction of the (co-rotated) negative Z axis @P87 Estimated diameter of the calibration sphere. Here, an approximate parameter is sufficient. For calculating measurement movements. @P89 Index of the measured rotary axis (-1 with manual axis). @P91 Expected X value of measured rotary axis. Here, an approximate parameter is sufficient. For calculating measurement movements. @P92 Expected Y value of measured rotary axis. Here, an approximate parameter is sufficient. For calculating measurement movements. @P93 Expected Z value of measured rotary axis. Here, an approximate parameter is sufficient. For calculating measurement movements. Optional parameters Cycle Description paramet ers @P13 Safety clearance to sphere during measurement movement Default value = diameter of touch probe @P14 Probe angle for first sphere measurement [degrees]. Refers to the (co-rotated) X axis. Default value = 0 @P15 Probe angle difference between the co-rotated horizontal measurements for all measurements. [degrees] Default value = 90 @P33 Crossover range during measurement process for all measurements Additional motion path that exceeds the expected workpiece edge/workpiece surface Default value = @P87/4 @P50 Filename including file suffix to write the output variables. If this is not transferred, only the output variables in the NC program are written, as usual. Default value = "” @P64 Definition of the section for sphere measurement for all measurements. 0: linear (default value) 1: circular (Caution: collision detection disabled) @P90 Pre-positioning mode between sphere measurements 0: automatic by NC subroutines 1: manual or in manual mode (default value) @P94 X value of rotary axis to define the inclined position of the touch probe at cycle start. Default value = 0 @P95 Y value of rotary axis to define the inclined position of the touch probe head at cycle start. Default value = 0 @P96 Z value of rotary axis to define the inclined position of the touch probe head at cycle start. Default value = 0 TF5225 | Twin CAT 3 CNC Version: 1.321 219 Measurement
## Page 220

Calibrating and measuring @P97 Rotation angle to define the inclined position of the touch probe head at cycle start. [degrees] Default value = 0 @P98 Probe angle for second sphere measurement. Refers to the (co-rotated) X axis. [degrees] Default value = 0 @P99 Probe angle for third sphere measurement. Refers to the (co-rotated) X axis. [degrees] Default value = 0 @P100 Angle travelled between measurement 1 and 2 of the measured rotary axis with manual pre- positioning. Here, an approximate parameter is sufficient. For calculating measurement movements. [degrees] Default value = 0 @P101 Angle travelled between measurement 2 and 3 of the measured rotary axis with manual pre- positioning. Here, an approximate parameter is sufficient. For calculating measurement movements. [degrees] Default value = 0 NOTICE Disabled collision detection when @P64 is active. If circular approach of the pre-position was selected in @P64, collision detection is disabled. This option may only be enabled if safe approach to the pre-position is ensured. It is recommended to use the Syntax check to verify whether the input parameters are correctly assigned. 2.12.6 Syntax L CYCLE [ NAME = Sys Meas Rot Ax.ecy @P.. = .. ] 2.12.7 Output variables Variables Description V. CYC. Sys Ret Rot Ax Dir X value of the measured rotary axis. ection X V. CYC. Sys Ret Rot Ax Dir Y value of the measured rotary axis. ection Y V. CYC. Sys Ret Rot Ax Dir Z value of the measured rotary axis. ection Z V. CYC. Sys Ret Abs Angle Amount of the measured rotation of the rotary axis between measurement 1 and M1To M2 2. (in degrees) V. CYC. Sys Ret Abs Angle Amount of the measured rotation of the rotary axis between measurement 1 and M1To M3 3. (in degrees) V. CYC. Sys Ret Rot Ax Off X value of the circle centre point obtained from the three measured calibration set X sphere positions. V. CYC. Sys Ret Rot Ax Off Y value of the circle centre point obtained from the three measured calibration set Y sphere positions. V. CYC. Sys Ret Rot Ax Off Z value of the circle centre point obtained from the three measured calibration set Z sphere positions. V. CYC. Sys Ret Angle M1t Angle of the first sphere measurement to the X axis. o X V. CYC. Sys Ret Angle M1t Angle of the first sphere measurement to the Y axis. o Y V. CYC. Sys Ret Angle M1t Angle of the first sphere measurement to the Z axis. o Z 220 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 221

Calibrating and measuring V. CYC. Sys Ret Angle M2t Angle of the second sphere measurement to the X axis. o X V. CYC. Sys Ret Angle M2t Angle of the second sphere measurement to the Y axis. o Y V. CYC. Sys Ret Angle M2t Angle of the second sphere measurement to the Z axis. o Z V. CYC. Sys Ret Angle M3t Angle of the third sphere measurement to the X axis. o X V. CYC. Sys Ret Angle M3t Angle of the third sphere measurement to the Y axis. o Y V. CYC. Sys Ret Angle M3t Angle of the third sphere measurement to the Z axis. o Z See information on use of the output variables [} 12]. The variables V. CYC. Sys Ret Rot Ax Direction X, V. CYC. Sys Ret Rot Ax Direction Y and V. CYC. Sys Ret Rot Ax Direction Z define the measured rotary axis about which the rotary axis is turned. The output variable V. CYC. Sys Ret Abs Angle M1to M2 describes the amount of the measured angle about which the rotary axis was turned between the first and second measurements. V. CYC. Sys Ret Abs Angle M1to M3 describes the amount of the angle between the first and the third measurements. The variables V. CYC. Sys Ret Rot Ax Offset X, V. CYC. Sys Ret Rot Ax Offset Y and V. CYC. Sys Ret Rot Ax Offset Z describe the position of the circle centre point which is obtained from the three measured calibration sphere positions in the current coordinate system. This is of special interest when the cycle was executed with a stationary rotary axis. In this case, this point lies on the rotary axis and therefore defines the axis centre of rotation. The zero position of the axis is checked with the output variables V. CYC. Sys Ret Angle M1to X to V. CYC. Sys Ret Angle M3to Z. To carry out the measurement of the rotary axis, a calibration sphere is scanned in a total of three different positions. For each measurement, the centre point of the calibration sphere is determined in the current coordinate system. A circle can then be calculated from these three centre point positions. The circle is defined by a circle centre point (V. CYC. Sys Ret Rot Ax Offset X- V. CYC. Sys Ret Rotax Offset Z). The output variables V. CYC. Sys Ret Angle M1to X to V. CYC. Sys Ret Angle M3to Z supply the angles of the circle centre point vector in relation to each calibration sphere centre point compared to the X, Y or Z axis in each case. For example, if the first measurement was carried out at an axis angle of 0° and the axis should be parallel to the Z axis in zero position, V. CYC. Sys Ret Angle M1to Z then checks whether this also corresponds to the measurement. 2.12.8 Programming examples The section below described a number of user scenarios with the related cycle calls. 2.12.8.1 Measuring a swivel axis A swivel axis will be measured in the cycles. It is expected that the swivel axis rotates about the X axis. Since the swivel axis is moved by the upstream linear axes, it is not stationary. This means that the calibration sphere must be mounted fixed while the swivel axis is moved by the linear axes within the cycle. Since the calibration sphere is mounted fixed, it is not permitted to measure it with an active kinematic transformation as then it is impossible to distinguish the X, Y and Z coordinates of the individual centre point measurements. TF5225 | Twin CAT 3 CNC Version: 1.321 221 Measurement
## Page 222

Calibrating and measuring +Z +A +A +Y -Z -Z -A +X -Y -A -X -Y Yw Zw Xw Fig. 64: Measuring a swivel axis The following parameter settings are conceivable for the successful execution of the cycle. • It is expected that the measured swivel axis rotates about the X axis: @P91=1, @P92=0, @P93=0 • Pre-positioning is to take place in manual mode: @P90=1 • The index of the measured rotary axis has the value 4: @P89=4 • The diameter of the calibration sphere is 50 mm: @P87=50 • The sphere should be measured with a safety clearance of 50 mm: @P13=50 • Measurement movements in Z direction should have a length of 30 mm. @P6=30 • To ensure the calibration sphere is touched in horizontal measurement movements, the crossover range is set to 10mm: @P33=10 This results in the following cycle call: G90 G1 A0 G1 X90 Y-240 Z-10 L CYCLE [NAME=Sys Meas Rot Ax.ecy \ @P6 = 30 \ @P13 = 50 \ @P33 = 10 \ @P87 = 50 \ @P89 = 4 \ @P90 = 1 \ @P91 = 1 \ @P92 = 0 \ @P93 = 0 \ ] M30 If pre-positioning is to be automated, parameter 90 must be set to zero. @P90=0. The saved pre-positioning subroutines could look like this: ; Sys Meas Rot Ax Pre Pos2.nc: G1 G91 Z50 G1 G90 A50 G1 G91 Y-140 G1 G91 Z-120 G90 M17 ; Sys Meas Rot Ax Pre Pos3.nc: G1 G91 Z100 G1 G90 A-50 G1 G91 Y280 G1 G91 Z-100 G90 M17 2.12.8.2 Measuring a rotary axis with an active kinematic This example shows the measurement of a round table by a 6-axis articulated robot. 222 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 223

Calibrating and measuring +C -C +C -C Zw Yw Xw Fig. 65: Measuring a round table with a 6-axis articulated robot When pre-positioning within the cycle, only linear axes and rotary axes involved in a complete kinematic transformation may be moved. Since the robot only has rotary axes, it must be integrated in a kinematic transformation. During the measurement, the measured round axis may not be involved in a kinematic transformation. The measured round table rotates fixed about the Z axis. Since the measured rotary axis is fixed, the calibration sphere must be mounted so that it co-rotates with the round table. In this case, select a position on the round table as far away as possible from the centre of rotation. The following parameter settings are conceivable for the successful execution of the cycle. • It is expected that the measured swivel axis rotates about the Z axis: @P91=0, @P92=0, @P93=1 • Pre-positioning is to take place in manual mode: @P90=1 • The index of the measured rotary axis has the value 6: @P89=6 • The diameter of the calibration sphere is 50 mm: @P87=50 • The sphere should be measured with a safety clearance of 30 mm: @P13=50 • Measurement movements in Z direction should have a length of 30 mm. @P6=30 • To ensure the calibration sphere is touched in horizontal measurement movements, the crossover range is set to 10mm: @P33=10 This results in the following cycle call: #TRAFO ON G90 G1 C0 G1 X1300 Y100 Z315 L CYCLE [NAME=Sys Meas Rot Ax.ecy \ @P6 = 30 \ @P13 = 50 \ @P33 = 10 \ @P87 = 50 \ @P89 = 6 \ @P90 = 1 \ @P91 = 0 \ @P92 = 0 \ @P93 = 1 \ ] #TRAFO OFF M30 Pre-positioning between measurements takes place in manual mode with an active kinematic transformation. It is important that the orientation of the touch probe is not changed. Only the X, Y and Z coordinates may be changed in the current programming coordinate system. 2.12.8.3 Measuring with an inclined touch probe head in the starting position This example describes the measurement of the C axis of a 5-axis machine with inclined tough probe head., TF5225 | Twin CAT 3 CNC Version: 1.321 223 Measurement
## Page 224

Calibrating and measuring +Z +C -C +C -C +A +A +Y -Z -Z -A +X -Y -A -X -Y Yw Zw Xw Fig. 66: Measuring with inclined touch probe head If the touch probe head were vertical at the start (axis A=0), the touch probe head would not change its position in the current coordinate system when the C axis rotates. The X, Y and Z coordinates of the measured centre points of the calibration sphere would then lie above each other, and this would made the calculation impossible. To permit a successful execution of the cycle, the A axis here can be swivelled in, in this example by 50°. However, this results in the situation that the touch probe head is already inclined at cycle start. In order to adapt the measurement movements, the corresponding parameters must be made in the parameters P94 to P96. The important thing is that the touch probe head points to the centre point of the calibration sphere at cycle start. The following parameter settings are conceivable for the successful execution of the cycle. • The touch probe head is inclined since in this example it was swivelled through 50° about the A axis which rotates about the X axis. Rotation about the X axis results in the following parameter settings: @P94=1, @P95=0, @P96=0 • The inclination was caused by an angle of 50°. @P97=50 • It is expected that the measured axis rotates about the Z axis: @P91=0, @P92=0, @P93=1 • Pre-positioning is to take place in manual mode: @P90=1 • The index of the measured rotary axis has the value 3: @P89=3 • The diameter of the calibration sphere is 50 mm: @P87=50 • The sphere should be measured with a safety clearance of 50 mm: @P13=50 • Measurement movements in Z direction should have a length of 30 mm. @P6=30 • To ensure the calibration sphere is touched in horizontal measurement movements, the crossover range is set to 10mm: @P33=10 This results in the following cycle call: G90 G1 A50 C0 G1 X90 Y-340 Z-60 L CYCLE [NAME=Sys Meas Rot Ax.ecy \ @P6 = 30 \ @P13 = 50 \ @P33 = 10 \ @P87 = 50 \ @P89 = 3 \ @P90 = 1 \ @P91 = 0 \ @P92 = 0 \ @P93 = 1 \ @P94 = 1 \ @P95 = 0 \ @P96 = 0 \ @P97 = 50 \ ] M30 224 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 225

Calculation cycles 3 Calculation cycles 3.1 Introduction Cycles are additional options and subject to the purchase of a license. Task Calculation cycles are used to execute complex calculations that require the user to have a lot of technical knowledge and carry out extensive programming work. The following calculation cycles are currently available: • Calculation of the diameter and centre point of a 2-dimensional circle consisting of min. 3 sampling points • Calculation of the diameter and centre point of a sphere consisting of min. 4 sampling points • Calculation of a plane consisting of min. 3 sampling points • Calculation of a circle in 3D space consisting of min. 3 sampling points • Calculation of a straight line in 3D space consisting of min. 2 sampling points The calculation cycles use the “method of least squares” to calculate the most probable result from a specific number of sampling points. Programming and parameterisation The programming and parameterisation of cycles is described in each of the overviews in the main chapter. Handling output variables If the V. CYC output variable is created in the main program (or in the subroutine calling the cycle), the value is written within the cycle and is available in the main program after the calculation. The calculation cycles described below include programming examples that can be used to understand how to interpret the output variables. TF5225 | Twin CAT 3 CNC Version: 1.321 225 Measurement
## Page 226

Calculation cycles 3.2 Cycle for calculation of a circle in 2D Z (@P51, @P61) (@P52, @P62) (@P50, @P60) Y X Fig. 67: Calculation of a circle in 2D 3.2.1 Process When a circle is calculated in the XY plane, the radius and centre of the circle are determined from a specific number of points on the arc (min. 3, max. 10). The points may not be collinear, otherwise no calculation can be performed. To obtain good calculation results, it is recommended to use points that are as distant from each other as possible. 3.2.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P50 X coordinate point 1 @P51 X coordinate point 2 @P52 X coordinate point 3 @P53 (optional) X coordinate point 4 @P54 (optional) X coordinate point 5 @P55 (optional) X coordinate point 6 @P56 (optional) X coordinate point 7 @P57 (optional) X coordinate point 8 @P58 (optional) X coordinate point 9 @P59 (optional) X coordinate point 10 @P60 Y coordinate point 1 @P61 Y coordinate point 2 @P62 Y coordinate point 3 @P63 (optional) Y coordinate point 4 @P64 (optional) Y coordinate point 5 @P65 (optional) Y coordinate point 6 @P66 (optional) Y coordinate point 7 @P67 (optional) Y coordinate point 8 @P68 (optional) Y coordinate point 9 226 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 227

Calculation cycles @P69 (optional) Y coordinate point 10 It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 3.2.3 Syntax L CYCLE [ NAME = Sys Calc Circle.ecy @P.. = .. ] 3.2.4 Output variables Variable Value V. CYC. Sys Ret Center X Calculated centre of circle in X V. CYC. Sys Ret Center Y Calculated centre of circle in Y V. CYC. Sys Ret Radius Calculated radius of circle V. CYC. Sys Ret Varianc Calculated variance of the distance of the transferred points from the calculated e centre of the circle See information on use of the output variables [} 225]. 3.2.5 Programming example Calculation cycle ; Definition of return variables #VAR V. CYC. Sys Ret Radius V. CYC. Sys Ret Center X V. CYC. Sys Ret Center Y V. CYC. Sys Ret Variance #ENDVAR ; cycle call L CYCLE [NAME=Sys Calc Circle.ecy \ @P50 = 0 @P60 = -1 \ @P51 = 0 @P61 = 1 \ @P52 = 1 @P62 = 0 \ @P53 = -1 @P63 = 0 ] ; print result #FILE NAME [MSG="Sys Calc Circle Result.txt"] #MSG SAVE EXCLUSIVE["Center X = %f",V. CYC. Sys Ret Center X] #MSG SAVE EXCLUSIVE["Center Y = %f",V. CYC. Sys Ret Center Y] #MSG SAVE EXCLUSIVE["Radius = %f", V. CYC. Sys Ret Radius] #MSG SAVE EXCLUSIVE["Variance = %f", V. CYC. Sys Ret Variance] M30 TF5225 | Twin CAT 3 CNC Version: 1.321 227 Measurement
## Page 228

Calculation cycles 3.3 Cycle for calculation of a plane (@P52, @P62, @P72) Z (@P51, @P61, @P71) (@P50, @P60, @P70) Y X Fig. 68: Calculation of a plane 3.3.1 Process When a plane is calculated in 3-dimensional space, the normal and support vectors of a plane are determined from a specific number of points (min. 3, max. 10). The points may not be collinear, otherwise no calculation can be performed. To obtain good calculation results, it is recommended to use points that are as distant from each other as possible. 3.3.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P50 X coordinate point 1 @P51 X coordinate point 2 @P52 X coordinate point 3 @P53 (optional) X coordinate point 4 @P54 (optional) X coordinate point 5 @P55 (optional) X coordinate point 6 @P56 (optional) X coordinate point 7 @P57 (optional) X coordinate point 8 @P58 (optional) X coordinate point 9 @P59 (optional) X coordinate point 10 @P60 Y coordinate point 1 @P61 Y coordinate point 2 @P62 Y coordinate point 3 @P63 (optional) Y coordinate point 4 @P64 (optional) Y coordinate point 5 @P65 (optional) Y coordinate point 6 @P66 (optional) Y coordinate point 7 @P67 (optional) Y coordinate point 8 228 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 229

Calculation cycles @P68 (optional) Y coordinate point 9 @P69 (optional) Y coordinate point 10 @P70 Z coordinate point 1 @P71 Z coordinate point 2 @P72 Z coordinate point 3 @P73 (optional) Z coordinate point 4 @P74 (optional) Z coordinate point 5 @P75 (optional) Z coordinate point 6 @P76 (optional) Z coordinate point 7 @P77 (optional) Z coordinate point 8 @P78 (optional) Z coordinate point 9 @P79 (optional) Z coordinate point 10 It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 3.3.3 Syntax L CYCLE [ NAME = Sys Calc Plane.ecy @P.. = .. ] 3.3.4 Output variables Variable Value V. CYC. Sys Ret Normal X Calculated normal vector in X V. CYC. Sys Ret Normal Y Calculated normal vector in Y V. CYC. Sys Ret Normal Z Calculated normal vector in Z V. CYC. Sys Ret Sup Vector X Calculated support vector of plane in X (corresponds to point on the plane) V. CYC. Sys Ret Sup Vector Y Calculated support vector of plane in Y corresponds to point on the plane) V. CYC. Sys Ret Sup Vector Z Calculated support vector of plane in Z (corresponds to point on the plane) See information on use of the output variables [} 225]. 3.3.5 Programming example Calculation cycle ; creation of return variables #VAR V. CYC. Sys Ret Normal X V. CYC. Sys Ret Normal Y V. CYC. Sys Ret Normal Z V. CYC. Sys Ret Sup Vector X V. CYC. Sys Ret Sup Vector Y V. CYC. Sys Ret Sup Vector Z #ENDVAR ; calculation of the XY plane L CYCLE [NAME=Sys Calc Plane.ecy \ @P50 = 1 @P60 = 0 @P70 = 0 \ @P51 = 0 @P61 = 1 @P71 = 0 \ @P52 = 1 @P62 = 1 @P72 = 0 ] ; print result #FILE NAME[MSG="Sys Calc Plane Result.txt" ] #MSG SAVE ["Normal X = %f", V. CYC. Sys Ret Normal X ] #MSG SAVE ["Normal Y = %f", V. CYC. Sys Ret Normal Y ] #MSG SAVE ["Normal Z = %f", V. CYC. Sys Ret Normal Z ] #MSG SAVE ["Point X = %f", V. CYC. Sys Ret Sup Vector X ] TF5225 | Twin CAT 3 CNC Version: 1.321 229 Measurement
## Page 230

Calculation cycles #MSG SAVE ["Point Y = %f", V. CYC. Sys Ret Sup Vector Y ] #MSG SAVE ["Point Z = %f", V. CYC. Sys Ret Sup Vector Z ] M30 3.4 Cycle for calculation of a straight line in 3D (@P52, @P62, @P72) Z (@P51, @P61, @P71) (@P50, @P60, @P70) Y X Fig. 69: Calculation of a straight line in 3D 3.4.1 Process When a straight line is calculated in 3-dimensional space, the distances between the points as well as the direction and support vectors are determined from a specific number of points on the straight line (min. 2, max. 10). The points may not be identical, otherwise no calculation can be performed. To obtain good calculation results, it is recommended to use points that are as distant from each other as possible. 3.4.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P50 X coordinate point 1 @P51 X coordinate point 2 @P52 (optional) X coordinate point 3 @P53 (optional) X coordinate point 4 @P54 (optional) X coordinate point 5 @P55 (optional) X coordinate point 6 @P56 (optional) X coordinate point 7 @P57 (optional) X coordinate point 8 @P58 (optional) X coordinate point 9 @P59 (optional) X coordinate point 10 @P60 Y coordinate point 1 @P61 Y coordinate point 2 @P62 (optional) Y coordinate point 3 230 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 231

Calculation cycles @P63 (optional) Y coordinate point 4 @P64 (optional) Y coordinate point 5 @P65 (optional) Y coordinate point 6 @P66 (optional) Y coordinate point 7 @P67 (optional) Y coordinate point 8 @P68 (optional) Y coordinate point 9 @P69 (optional) Y coordinate point 10 @P70 Z coordinate point 1 @P71 Z coordinate point 2 @P72 (optional) Z coordinate point 3 @P73 (optional) Z coordinate point 4 @P74 (optional) Z coordinate point 5 @P75 (optional) Z coordinate point 6 @P76 (optional) Z coordinate point 7 @P77 (optional) Z coordinate point 8 @P78 (optional) Z coordinate point 9 @P79 (optional) Z coordinate point 10 It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 3.4.3 Syntax L CYCLE [ NAME = Sys Calc Line.ecy @P.. = .. ] 3.4.4 Output variables Variable Value V. CYC. Sys Ret Dir Vector X Calculated direction vector of straight line in X V. CYC. Sys Ret Dir Vector Y Calculated direction vector of straight line in Y V. CYC. Sys Ret Dir Vector Z Calculated direction vector of straight line in Z V. CYC. Sys Ret Sup Vector X Calculated support vector of straight line in X (corresponds to point on the straight line) V. CYC. Sys Ret Sup Vector Y Calculated support vector of straight line in Y (corresponds to point on the straight line) V. CYC. Sys Ret Sup Vector Z Calculated support vector of straight line in Z (corresponds to point on the straight line) V. CYC. Sys Ret Variance Calculated variance of the distance of the points from the calculated straight line See information on use of the output variables [} 225]. 3.4.5 Programming example Calculation cycle ; creation of return variables #VAR V. CYC. Sys Ret Dir Vector X V. CYC. Sys Ret Dir Vector Y V. CYC. Sys Ret Dir Vector Z V. CYC. Sys Ret Sup Vector X TF5225 | Twin CAT 3 CNC Version: 1.321 231 Measurement
## Page 232

Calculation cycles V. CYC. Sys Ret Sup Vector Y V. CYC. Sys Ret Sup Vector Z V. CYC. Sys Ret Variance #ENDVAR ; calc line of X-axis from points L CYCLE [NAME=Sys Calc Line.ecy \ @P50 = 0 @P60 = 0 @P70 = 0 \ @P51 = 1 @P61 = 0 @P71 = 0 \ @P52 = 2 @P62 = 0 @P72 = 0 \ ] #FILE NAME[MSG="Sys Calc Line Result.txt" ] #MSG SAVE ["Direction X = %f", V. CYC. Sys Ret Dir Vector X] #MSG SAVE ["Direction Y = %f", V. CYC. Sys Ret Dir Vector Y] #MSG SAVE ["Direction Z = %f", V. CYC. Sys Ret Dir Vector Z] #MSG SAVE ["Point on Line X = %f", V. CYC. Sys Ret Sup Vector X] #MSG SAVE ["Point on Line Y = %f", V. CYC. Sys Ret Sup Vector Y] #MSG SAVE ["Point on Line Z = %f", V. CYC. Sys Ret Sup Vector Z] #MSG SAVE ["Variance = %f", V. CYC. Sys Ret Variance ] M30 3.5 Cycle for calculation of a sphere (@P52, @P62, @P72) (@P51, @P61, @P71) Z (@P50, @P60, @P70) Y X Fig. 70: Calculation of a sphere 3.5.1 Process When a sphere is calculated in 3-dimensional space, the radius and centre of the sphere are determined from a specific number of points on the sphere’s surface (min. 4, max. 10). The points may not be collinear or on the same plane, otherwise no calculation can be performed. To obtain good calculation results, it is recommended to use points that are as distant from each other as possible. 3.5.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P50 X coordinate point 1 @P51 X coordinate point 2 232 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 233

Calculation cycles @P52 X coordinate point 3 @P53 X coordinate point 4 @P54 (optional) X coordinate point 5 @P55 (optional) X coordinate point 6 @P56 (optional) X coordinate point 7 @P57 (optional) X coordinate point 8 @P58 (optional) X coordinate point 9 @P59 (optional) X coordinate point 10 @P60 Y coordinate point 1 @P61 Y coordinate point 2 @P62 Y coordinate point 3 @P63 Y coordinate point 4 @P64 (optional) Y coordinate point 5 @P65 (optional) Y coordinate point 6 @P66 (optional) Y coordinate point 7 @P67 (optional) Y coordinate point 8 @P68 (optional) Y coordinate point 9 @P69 (optional) Y coordinate point 10 @P70 Z coordinate point 1 @P71 Z coordinate point 2 @P72 Z coordinate point 3 @P73 Z coordinate point 4 @P74 (optional) Z coordinate point 5 @P75 (optional) Z coordinate point 6 @P76 (optional) Z coordinate point 7 @P77 (optional) Z coordinate point 8 @P78 (optional) Z coordinate point 9 @P79 (optional) Z coordinate point 10 It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 3.5.3 Syntax L CYCLE [ NAME = Sys Calc Sphere.ecy @P.. = .. ] 3.5.4 Output variables Variable Value V. CYC. Sys Ret Center X Calculated centre of sphere in X V. CYC. Sys Ret Center Y Calculated centre of sphere in Y V. CYC. Sys Ret Center Z Calculated centre of sphere in Z V. CYC. Sys Ret Radius Calculated radius of sphere V. CYC. Sys Ret Variance Calculated variance of the distance of the transferred points from the calculated sphere See information on use of the output variables [} 225]. TF5225 | Twin CAT 3 CNC Version: 1.321 233 Measurement
## Page 234

Calculation cycles 3.5.5 Programming example Calculation cycle ; creation of return variables #VAR V. CYC. Sys Ret Center X V. CYC. Sys Ret Center Y V. CYC. Sys Ret Center Z V. CYC. Sys Ret Radius V. CYC. Sys Ret Variance #ENDVAR ; calculation of the unit sphere L CYCLE [NAME=Sys Calc Sphere.ecy \ @P50 = 1 @P60 = 0 @P70 = 0 \ @P51 = -1 @P61 = 0 @P71 = 0 \ @P52 = 0 @P62 = 1 @P72 = 0 \ @P53 = 0 @P63 = -1 @P73 = 0 \ @P54 = 0 @P64 = 0 @P74 = 1 \ ] ; print result #FILE NAME[MSG="Sys Calc Sphere Result.txt"] #MSG SAVE EXCLUSIVE["Center X = %f", V. CYC. Sys Ret Center X ] #MSG SAVE EXCLUSIVE["Center Y = %f", V. CYC. Sys Ret Center Y ] #MSG SAVE EXCLUSIVE["Center Z = %f", V. CYC. Sys Ret Center Z ] #MSG SAVE EXCLUSIVE["Radius = %f", V. CYC. Sys Ret Radius ] #MSG SAVE EXCLUSIVE["Variance = %f", V. CYC. Sys Ret Variance] M30 3.6 Cycle for calculation of a circle in 3D (@P52, @P62, @P72) (@P51, @P61, @P71) Z v (@P50, @P60, @P70) Y X Fig. 71: Calculation of a circle in 3D 3.6.1 Process When a circle is calculated in 3-dimensional space, the radius, distance from origin and normal vector of the circle are determined from a specific number of points on the arc (min. 3, max. 10). The points may not be collinear, otherwise no calculation can be performed. To obtain good calculation results, it is recommended to use points that are as distant from each other as possible. 234 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 235

Calculation cycles 3.6.2 Parameters The following parameters are required to call the cycle: Cycle parameters Description @P50 X coordinate point 1 @P51 X coordinate point 2 @P52 X coordinate point 3 @P53 (optional) X coordinate point 4 @P54 (optional) X coordinate point 5 @P55 (optional) X coordinate point 6 @P56 (optional) X coordinate point 7 @P57 (optional) X coordinate point 8 @P58 (optional) X coordinate point 9 @P59 (optional) X coordinate point 10 @P60 Y coordinate point 1 @P61 Y coordinate point 2 @P62 Y coordinate point 3 @P63 (optional) Y coordinate point 4 @P64 (optional) Y coordinate point 5 @P65 (optional) Y coordinate point 6 @P66 (optional) Y coordinate point 7 @P67 (optional) Y coordinate point 8 @P68 (optional) Y coordinate point 9 @P69 (optional) Y coordinate point 10 @P70 Z coordinate point 1 @P71 Z coordinate point 2 @P72 Z coordinate point 3 @P73 (optional) Z coordinate point 4 @P74 (optional) Z coordinate point 5 @P75 (optional) Z coordinate point 6 @P76 (optional) Z coordinate point 7 @P77 (optional) Z coordinate point 8 @P78 (optional) Z coordinate point 9 @P79 (optional) Z coordinate point 10 It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 3.6.3 Syntax L CYCLE [ NAME = Sys Calc Plane Circle.ecy @P.. = .. ] 3.6.4 Output variables Variable Value V. CYC. Sys Ret Center X Calculated centre of circle in X V. CYC. Sys Ret Center Y Calculated centre of circle in Y V. CYC. Sys Ret Center Z Calculated centre of circle in Z V. CYC. Sys Ret Radius Calculated radius of circle TF5225 | Twin CAT 3 CNC Version: 1.321 235 Measurement
## Page 236

Calculation cycles V. CYC. Sys Ret Normal X Calculated normal vector in X V. CYC. Sys Ret Normal Y Calculated normal vector in Y V. CYC. Sys Ret Normal Z Calculated normal vector in Z V. CYC. Sys Ret Rad Variance Calculated variance of points to radius See information on use of the output variables [} 225]. 3.6.5 Programming example Calculation cycle ; creation of return variables #VAR V. CYC. Sys Ret Center X V. CYC. Sys Ret Center Y V. CYC. Sys Ret Center Z V. CYC. Sys Ret Normal X V. CYC. Sys Ret Normal Y V. CYC. Sys Ret Normal Z V. CYC. Sys Ret Radius V. CYC. Sys Ret Rad Variance #ENDVAR ; calculation of unit circle in the XY-plane with Z=1 L CYCLE [NAME=Sys Calc Plane Circle.ecy \ @P50 = 1 @P60 = 0 @P70 = 1 \ @P51 = 0 @P61 = 1 @P71 = 1 \ @P52 = -1 @P62 = 0 @P72 = 1 \ @P53 = 0 @P63 = -1 @P73 = 1 ] ; print result #FILE NAME[MSG="Sys Calc Plane Circle Result.txt" ] #MSG SAVE ["Radius = %f", V. CYC. Sys Ret Radius ] #MSG SAVE ["Center X = %f", V. CYC. Sys Ret Center X ] #MSG SAVE ["Center Y = %f", V. CYC. Sys Ret Center Y ] #MSG SAVE ["Center Z = %f", V. CYC. Sys Ret Center Z ] #MSG SAVE ["Normal X = %f", V. CYC. Sys Ret Normal X ] #MSG SAVE ["Normal Y = %f", V. CYC. Sys Ret Normal Y ] #MSG SAVE ["Normal Z = %f", V. CYC. Sys Ret Normal Z ] #MSG SAVE ["Variance = %f", V. CYC. Sys Ret Rad Variance ] M30 236 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 237

High Speed Settings 4 High Speed Settings 4.1 Introduction In general, the machine response can be optimised by means of channel parameters using the High Speed Settings cycle. This allows you to influence the surface quality, speed and accuracy for a specific machine. Cycles are additional options and subject to the purchase of a license. Task The High Speed Setting cycles optimise the machining response of a specific machine by specifying tolerances for • roughing • prefinishing • finishing . The user can use the cycle to select the required machining state to influence machine response. Licensing note Please note that cycles are additional options and subject to the purchase of a license. 4.2 Sys Hsc Settings cycle - High Speed Cutting settings Velocity HSC Accuracy Surface finish Fig. 72: Operation mode of HSC settings 4.2.1 Process The Sys Hsc Settings cycle can optimise machine response. NC programs can be specified in the channel- specific lists. They are called depending on the specified mode. The parameters for this are: • hscs.deselect.prog TF5225 | Twin CAT 3 CNC Version: 1.321 237 Measurement
## Page 238

High Speed Settings • hscs.deselect.tolerance • hscs.rough.prog • hscs.rough.tolerance • hscs.prefinish.prog • hscs.prefinish.tolerance • hscs.finish.prog • hscs.finish.tolerance The values for the tolerance data lists are converted internally into mm or inch. These tolerances can be read in the NC program by the following variables: V. G. HSCS. DESELECT. TOLERANCE V. G. HSCS. ROUGH. TOLERANCE V. G. HSCS. PREFINISH. TOLERANCE V. G. HSCS. FINISH. TOLERANCE 4.2.2 Parameterisation The following input parameters are required to call the cycle: Input parameters Description @P1 Mode default value = 1 1 = Deselect 2 = Rough (roughing) 3 = Medium (prefinishing) 4 = Fine (finishing) It is recommended using the Syntax check.to verify whether the input parameters have been correctly assigned. 4.2.3 Syntax L CYCLE [ NAME = Sys Hsc Settings.ecy @P.. = .. ] 4.2.4 Programming example General programming example Mill circular pocket Mode 4 is called in this example. This mode corresponds to the finishing configuration. As a consequence, the subroutine manufacturer Hsc Finish Settings.nc specified in the parameter hscs.finish.prg is called. In addition, this makes available the machining tolerance of 0.01 mm in the variable V. G. HSCS. FINISH. TOLERANCE and it is used in the subroutine as an example for the #HSC command. ; HSC Settings T9 D9 ( Tool data ) M6 ( Tool change ) G00 G17 G90 F2000 M03 S6000 ( Technology data ) G00 Z150 ( Go to z start position ) G00 X0 Y0 ( position over the workpiece ) ; Finishing Mode L CYCLE [NAME=Sys Hsc Settings.ecy \ @P1 = 4 \ 238 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 239

High Speed Settings ] ; 3D Milling ;... ;... M30 Programming example for optimisation programs The specified data are given as an example and cannot simply be adopted. This could cause damage to the machine. % manufacturer Hsc Deselect Settings.nc G133 = 100 G134 = 100 #HSC OFF #FILTER OFF M17 % manufacturer Hsc Rough Settings.nc ; example ; G133 = 180 ; example G133 = 180 set 180% ; G134 = 180 ; #SLOPE[TYPE=HSC] ; #HSC ON[SURFACE PATH_DEV=V. G. HSCS. ROUGH. TOLERANCE \ TRACK_DEV=V. G. HSCS. ROUGH. TOLERANCE] ; #FILTER ON [AX_DEV=V. G. HSCS. ROUGH. TOLERANCE] M17 % manufacturer Hsc Prefinish Settings.nc ; example ; G133 = 150 ; example G133 = 150 set 150% ; G134 = 150 ; #SLOPE[TYPE=HSC] ; #HSC ON[SURFACE PATH_DEV=V. G. HSCS. PREFINISH. TOLERANCE \ TRACK_DEV=V. G. HSCS. PREFINISH. TOLERANCE] ; #FILTER ON [AX_DEV=V. G. HSCS. PREFINISH. TOLERANCE] M17 % manufacturer Hsc Finish Settings.nc ; example ; G133 = 80 ; example G133 = 80 set 80% ; G134 = 80 ; #SLOPE[TYPE=HSC] ; #HSC ON[SURFACE PATH_DEV=V. G. HSCS. FINISH. TOLERANCE \ TRACK_DEV=V. G. HSCS. FINISH. TOLERANCE] ; #FILTER ON [AX_DEV=V. G. HSCS. FINISH. TOLERANCE] M17 TF5225 | Twin CAT 3 CNC Version: 1.321 239 Measurement
## Page 240

Support and Service 5 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 240 Version: 1.321 TF5225 | Twin CAT 3 CNC Measurement
## Page 242

More Information: www.beckhoff.com/TF5225 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
