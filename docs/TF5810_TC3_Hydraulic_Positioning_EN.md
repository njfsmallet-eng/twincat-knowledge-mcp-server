---
title: "TF5810_TC3_Hydraulic_Positioning_EN"
product: "TF5810"
category: "Motion_Control"
tags: ["HYDRAULIC", "POSITIONING"]
language: "EN"
document_type: "Manual"
version: "1.8.3"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5810_TC3_Hydraulic_Positioning_EN.pdf"
release_date: "2025-08-18"
---
Manual | EN TF5810 Twin CAT 3 | Hydraulic Positioning 2025-08-18 | Version: 1.8.3
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 7 1.1 Notes on the documentation............................................................................................................. 7 1.2 For your safety.................................................................................................................................. 7 1.3 Notes on information security............................................................................................................ 9 2 Introduction to hydraulics...................................................................................................................... 10 3 General structure.................................................................................................................................... 15 3.1 Structure of the documentation....................................................................................................... 15 3.2 Functions, function blocks and types.............................................................................................. 16 3.3 The hydraulics library...................................................................................................................... 24 4 PLCopen Motion Control........................................................................................................................ 27 4.1 Administrative.................................................................................................................................. 27 4.1.1 MC_Power_Bk Plc Mc....................................................................................................... 27 4.1.2 MC_Read Actual Position_Bk Plc Mc.................................................................................. 29 4.1.3 MC_Read Actual Torque_Bk Plc Mc.................................................................................... 30 4.1.4 MC_Read Actual Velocity_Bk Plc Mc.................................................................................. 31 4.1.5 MC_Read Axis Error_Bk Plc Mc.......................................................................................... 32 4.1.6 MC_Read Bool Parameter_Bk Plc Mc................................................................................. 33 4.1.7 MC_Read Digital Output_Bk Plc Mc.................................................................................... 34 4.1.8 MC_Read Parameter_Bk Plc Mc........................................................................................ 36 4.1.9 MC_Read Status_Bk Plc Mc............................................................................................... 37 4.1.10 MC_Reset_Bk Plc Mc........................................................................................................ 39 4.1.11 MC_Reset And Stop_Bk Plc Mc.......................................................................................... 40 4.1.12 MC_Set Override_Bk Plc Mc.............................................................................................. 41 4.1.13 MC_Set Position_Bk Plc Mc............................................................................................... 43 4.1.14 MC_Set Reference Flag_Bk Plc Mc..................................................................................... 45 4.1.15 MC_Write Bool Parameter_Bk Plc Mc................................................................................. 46 4.1.16 MC_Write Digital Output_Bk Plc Mc.................................................................................... 47 4.1.17 MC_Write Parameter_Bk Plc Mc........................................................................................ 48 4.2 Motion............................................................................................................................................. 49 4.2.1 MC_Cam In_Bk Plc Mc....................................................................................................... 49 4.2.2 MC_Cam Out_Bk Plc Mc.................................................................................................... 51 4.2.3 MC_Cam Table Select_Bk Plc Mc....................................................................................... 53 4.2.4 MC_Digital Cam Switch_Bk Plc Mc..................................................................................... 54 4.2.5 MC_Emergency Stop_Bk Plc Mc........................................................................................ 57 4.2.6 MC_Flying Gear_Bk Plc Mc................................................................................................ 59 4.2.7 MC_Gear In_Bk Plc Mc....................................................................................................... 63 4.2.8 MC_Gear In Pos_Bk Plc Mc................................................................................................ 65 4.2.9 MC_Gear Out_Bk Plc Mc.................................................................................................... 67 4.2.10 MC_Home_Bk Plc Mc........................................................................................................ 68 4.2.11 MC_Halt_Bk Plc Mc........................................................................................................... 71 4.2.12 MC_Imediate Stop_Bk Plc Mc............................................................................................ 72 4.2.13 MC_Move Absolute_Bk Plc Mc........................................................................................... 73 4.2.14 MC_Move Joy Sticked_Bk Plc Mc....................................................................................... 75 TF5810 Version: 1.8.3 3
## Page 4

Table of contents 4.2.15 MC_Move Relative_Bk Plc Mc............................................................................................ 77 4.2.16 MC_Move Velocity_Bk Plc Mc............................................................................................ 79 4.2.17 MC_Ramped Stop_Bk Plc Mc............................................................................................. 80 4.2.18 MC_Stop_Bk Plc Mc.......................................................................................................... 82 4.2.19 MC_Move Jog_Bk Plc Mc................................................................................................... 84 4.3 Data types....................................................................................................................................... 86 4.3.1 AXIS_REF_Bk Plc Mc........................................................................................................ 86 4.3.2 E_Tc Plc Buffered Cmd Type_Bk Plc Mc............................................................................... 89 4.3.3 E_Tc Mc Current Step......................................................................................................... 90 4.3.4 E_Tc Mc Drive Type............................................................................................................ 94 4.3.5 E_Tc Mc Encoder Type....................................................................................................... 98 4.3.6 E_Tc MCFb State............................................................................................................. 103 4.3.7 E_Tc Mc Homing Type...................................................................................................... 103 4.3.8 E_Tc MCParameter........................................................................................................ 104 4.3.9 E_Tc Mc Profile Type........................................................................................................ 118 4.3.10 E_Tc Mc Pressure Reading Mode..................................................................................... 119 4.3.11 E_Tc Mc Valve Type......................................................................................................... 120 4.3.12 MC_Buffer Mode_Bk Plc Mc............................................................................................. 121 4.3.13 MC_CAM_ID_Bk Plc Mc.................................................................................................. 122 4.3.14 MC_CAM_REF_Bk Plc Mc.............................................................................................. 123 4.3.15 MC_CAMSWITCH_REF_Bk Plc Mc................................................................................ 123 4.3.16 MC_Direction_Bk Plc Mc................................................................................................. 124 4.3.17 MC_Homing Mode_Bk Plc Mc.......................................................................................... 125 4.3.18 MC_Start Mode_Bk Plc Mc............................................................................................... 125 4.3.19 MC_TRACK_REF_Bk Plc Mc.......................................................................................... 126 4.3.20 OUTPUT_REF_Bk Plc Mc............................................................................................... 126 4.3.21 ST_Function Generator FD_Bk Plc Mc.............................................................................. 127 4.3.22 ST_Function Generator TB_Bk Plc Mc.............................................................................. 128 4.3.23 ST_Tc Mc Auto Ident........................................................................................................ 128 4.3.24 ST_Tc Hyd Ax Param....................................................................................................... 130 4.3.25 ST_Tc Hyd Ax Rt Data....................................................................................................... 141 4.3.26 ST_Tc Mc Aux Data Labels............................................................................................... 149 4.3.27 ST_Tc Plc Device Input..................................................................................................... 149 4.3.28 ST_Tc Plc Device Output.................................................................................................. 153 4.3.29 ST_Tc Plc Mc Log Buffer................................................................................................... 156 4.3.30 ST_Tc Plc Mc Log Entry.................................................................................................... 156 4.3.31 ST_Tc Plc Reg Data Item.................................................................................................. 157 4.3.32 ST_Tc Plc Reg Data Table................................................................................................ 157 4.3.33 ST_Tc Hybrid Ax Param................................................................................................... 158 4.3.34 ST_Tc Hybrid Ax Rt Data................................................................................................... 161 4.3.35 ST_Tc Plc Input Analog.................................................................................................... 164 4.3.36 ST_Tc Pctrl Param........................................................................................................... 164 4.3.37 MC_Ref_Signal_Ref_Bk Plc Mc...................................................................................... 165 4.3.38 E_Tc Mc Jog Mode........................................................................................................... 165 4.4 System.......................................................................................................................................... 166 4.4.1 Controller........................................................................................................................ 166 4 Version: 1.8.3 TF5810
## Page 5

Table of contents 4.4.2 Drive............................................................................................................................... 187 4.4.3 Encoder.......................................................................................................................... 198 4.4.4 Function Generator......................................................................................................... 226 4.4.5 Table Functions............................................................................................................... 229 4.4.6 Generators..................................................................................................................... 237 4.4.7 Runtime.......................................................................................................................... 244 4.4.8 Message logging............................................................................................................ 256 4.4.9 Utilities............................................................................................................................ 261 4.5 Parameter..................................................................................................................................... 279 4.5.1 MC_Ax Ads Comm Server_Bk Plc Mc................................................................................ 279 4.5.2 MC_Communications_Bk Plc Mc..................................................................................... 281 4.5.3 MC_Ax Ads Ptr Arr Comm Server_Bk Plc Mc....................................................................... 281 4.5.4 MC_Ax Ads Read Decoder_Bk Plc Mc............................................................................... 283 4.5.5 MC_Ax Ads Write Decoder_Bk Plc Mc............................................................................... 285 4.5.6 MC_Ax Param Aux Labels Load_Bk Plc Mc........................................................................ 286 4.5.7 MC_Ax Param Load_Bk Plc Mc......................................................................................... 287 4.5.8 MC_Ax Param Save_Bk Plc Mc......................................................................................... 288 4.5.9 MC_Ax Uti Read Coe Drive Term_Bk Plc Mc....................................................................... 289 4.5.10 MC_Ax Uti Read Coe Enc Term_Bk Plc Mc......................................................................... 291 4.5.11 MC_Ax Uti Read Reg Drive Term_Bk Plc Mc....................................................................... 293 4.5.12 MC_Ax Uti Read Reg Enc Term_Bk Plc Mc......................................................................... 294 4.5.13 MC_Ax Uti Update Reg Drive Term_Bk Plc Mc.................................................................... 295 4.5.14 MC_Ax Uti Update Reg Enc Term_Bk Plc Mc...................................................................... 297 4.5.15 MC_Ax Uti Write Coe Drive Term_Bk Plc Mc....................................................................... 299 4.5.16 MC_Ax Uti Write Coe Enc Term_Bk Plc Mc......................................................................... 300 4.5.17 MC_Ax Uti Write Reg Drive Term_Bk Plc Mc....................................................................... 302 4.5.18 MC_Ax Uti Write Reg Enc Term_Bk Plc Mc......................................................................... 303 4.6 Part 5 Homing............................................................................................................................... 305 4.6.1 Finalizing Functions........................................................................................................ 305 4.6.2 Step Functions................................................................................................................ 308 5 Knowledge Base................................................................................................................................... 320 5.1 FAQs............................................................................................................................................. 321 5.2 Global constants........................................................................................................................... 338 5.3 Valve............................................................................................................................................. 347 5.4 Electric/hydraulic hybrid axes........................................................................................................ 349 5.5 Configuration of an axis................................................................................................................ 363 5.5.1 FB_Power...................................................................................................................... 370 5.6 The Plc Mc Manager....................................................................................................................... 370 5.7 Sample programs.......................................................................................................................... 374 5.8 Commissioning.............................................................................................................................. 380 5.8.1 Basic settings................................................................................................................. 380 5.8.2 Temporary zero compensation...................................................................................... 381 5.8.3 Movement directions...................................................................................................... 381 5.8.4 Position measuring system............................................................................................ 382 5.8.5 Characteristic curve measurement................................................................................ 382 5.8.6 Overlap........................................................................................................................... 383 TF5810 Version: 1.8.3 5
## Page 6

Table of contents 5.8.7 Reference velocity/velocity ratio..................................................................................... 383 5.8.8 Referencing.................................................................................................................... 385 5.8.9 Dynamics/target approach............................................................................................. 385 6 Support and Service............................................................................................................................. 387 6 Version: 1.8.3 TF5810
## Page 7

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF5810 Version: 1.8.3 7
## Page 8

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 8 Version: 1.8.3 TF5810
## Page 9

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF5810 Version: 1.8.3 9
## Page 10

Introduction to hydraulics 2 Introduction to hydraulics Hydraulics vs electromechanics: a technology comparison Hydraulic drives differ from electric drives in that they have a fundamentally different design, so that their behavior is only comparable to a limited degree. This special behavior and the distinctly different fields of application require adapted control and monitoring mechanisms. The following table provides an overview of these differences. The electromechanical axes controlled by Twin CAT NC/NCI/CNC typically consist of an AX servo drive and an AM synchronous motor with integrated position measuring system. The differences mainly relate to the design, since linear or asynchronous motors can also be traced back to this basic principle. The servo drive generates a rotating or moving magnetic field through the currents it controls, which is followed by the moving part of the motor. The strength, speed and angular/rotational speed difference of this magnetic field to the rotor is controlled in such a way that the desired movement is achieved. With appropriate design, a configuration is created that can be easily modeled. Since the basic structure is constant, this basically also applies to the model. Hydraulic axes are a much more varied in terms of their design. In addition to the various variants of linear cylinders (plungers, synchronous, differential, area-switchable cylinders etc.), several rotary drives (swivel cylinders, rotary cylinders, various types of hydraulic motors) are available as actuators. The velocity can be defined through continuous valves or primary or secondary controlled pumps. In addition, there are various hydraulic circuits in which further components influencing the amount of oil or pressure are added. Most of these have a non-linear or situation-dependent behavior. Ultimately, these differences mean that applications which can be achieved by a precisely defined and then precisely executed movement are nowadays largely realized electromechanically. The more complex, less standardized and difficult to handle hydraulic axes are used for tasks in which their particular strengths can be exploited. For example, they are ideally suited for applying large forces and energies over long periods or in applications where space is limited. In many cases, the behavior they are used to controlled is atypical for electromechanical drives, such as limiting or relieving pressure or force control. The plastics industry and metal forming are just two examples. Electric/hydraulic hybrid axes Electromechanical servo axes and hydraulic axes both offer specific advantages. The combination of these technologies creates a hybrid system that offers a new mixture of positive and negative properties from both worlds. Even though it is not possible to utilize all advantages in this way while avoiding all disadvantages, overall a clear advantage can be achieved by combining the technologies in a suitable manner. The following section provides an overview of these concepts. Proportional valve-controlled hydraulic axes are less efficient than servo axes, which is a significant disadvantage. Their efficiency is limited by the principle of throttle control. Electric drive control based on the PWM principle has been used for decades. For technical reasons (no switching valves with high flow rate and low switching time << 1ms) this is not possible for hydraulic axes. In hybrid axes the oil flow is controlled by changing the speed and possibly the direction of rotation of a constant current pump with a servo drive, rather than by using a variable throttle. In theory, there is no pressure drop between the pump and the cylinder. The pump can be regarded as a friction-locked but not form-locked gear unit, while the cylinder assumes the role of a spindle. A selectable feed constant can be made available by making provision for changing the effective cylinder areas or the quantity of oil pumped per revolution by switching the oil paths depending on the situation. The result is a true gear shift that is not available for an electromechanical axis. In applications that require alternating high velocity and high power, this can lead to considerable savings. Switching valves can be used to hydraulically fix a force once it has built up and relieve the load on the electric drive. In this way, the torque reduction of an electromechanical axis can be avoided. All components of the hybrid axis can be assembled as a self-contained module up to performance values that can be quite considerable. In this case, all hydraulic connections are encapsulated internally, and the only external connections are electrical ones. The axis is mountable and also exchangeable like an electromechanical axis. In situations where higher performance is required, a conventional discrete structure has to be used. However, it should be noted that a comparable electromechanical axis is also anything but compact or light. 10 Version: 1.8.3 TF5810
## Page 11

Introduction to hydraulics Further details on the configuration concept and commissioning can be found in the Knowledge Base (in preparation). Overview of differences The differences in design described above have a considerable effect on the operating behavior of hydraulic and electric drives. An overview of these effects is presented below. Typical natural frequencies of electromechanical axes are in the range >80 Hz. Values below 20 Hz are not uncommon for hydraulic axes. In both technologies, axes with >200 Hz can be realized, but for technical and/or calculation reasons they are only used when necessary. The natural frequency has a direct influence on controllability, since it limits the usable k P of the position controller. The controllability of electromechanical axes is a prerequisite for standard NCs. • For hydraulic axes, differential cylinders with just one piston rod are preferred. This makes the feed constant (here defined as travel per oil quantity) direction-dependent. Standard NCs do not take this behavior into account, because there is no such effect with electromechanical axes. • The asymmetrical working surfaces of a differential cylinder require an asymmetrical pressure distribution on the surfaces for a standstill in force equilibrium. If the axis starts in the opposite direction, a different pressure distribution must be established. For this purpose, an amount of oil has to be transported through the valves, which are initially only slightly opened, without any movement taking place. This leads to a delayed startup. A comparable but much fiercer phenomenon occurs if the axis has built up a pressing force beforehand. Standard NCs do not take this behavior into account, because there is no such effect with electromechanical axes. • Hydraulic actuators rely on seals to separate their workspaces from each other and from ambient. These seals, which in some cases have long circumferential edges, are in contact with metal surfaces and must slide on them. Above all, the transition from standstill to movement is accompanied by pronounced changes in adhesion/sliding friction. The comparable effects with electromechanical axes are several orders of magnitude smaller and are usually negligible. In the case of hydraulic axes, they play a key role in determining the behavior on startup, when approaching the target and when moving at low speeds. • Hydraulic axes use continuously adjustable valves or pumps as actuators. These components are always more or less non-linear. The system gain to be taken into account by the controller and the feed constant to be used by the pilot control are dependent on the operating point. Compromises in motion control can be reduced through linearization, but not completely avoided. Standard NCs do not take this behavior into account, because there is no such effect with electromechanical axes. • A dead range around the zero point of several 10 % of full scale is not uncommon for valves. Even with linearization, position control at standstill is then only possible to a limited extent. Standard NCs do not take this behavior into account, because there is no such effect with electromechanical axes. • The output value sent to the valve defines the slider position and thus, via a non-linear mechanical function, the openings for the oil flow. However, the pressure drop across the opening has a strong influence on the actual oil quantity and thus on the cylinder speed. Fluctuations in the supply pressure or cylinder pressure (resulting from the process force) have a strong influence on the axis velocity. • It is not easily possible to use of an I component in the controller. In combination with the adhesion/ sliding friction changes, low-frequency oscillations can easily occur, which are difficult to control. The cylinder oscillates periodically around positions determined by the working cycle, resulting in damage to seals and surfaces in the medium term. It may be possible to operate a hydraulic axis with a standard NC. The higher the quality of the component selection and configuration, the easier it is to do this. However, expectations regarding the behavior then offer little room for compromise. Conventional hydraulic axis configurations usually require adapted solutions, which are provided by Beckhoff Automation in the hydraulic library. Motion Control in a different way The key function of a Motion Control solution is the set value generator. It calculates or resolves instantaneous set values for position, velocity, acceleration and possibly jerk. The time-controlled mode of operation of the NC is well known in this context. However, there is an often overlooked alternative that is of particular interest for hydraulic axes. Its derivation and the differences are described below. TF5810 Version: 1.8.3 11
## Page 12

Introduction to hydraulics A set value generator can operate either as a function of or independently of the variables of another axis. The former is the case if the values for a cam plate coupling are derived from the values of another axis via a table or, in the case of a gear coupling, via a calculation formula. This requires a position controller that is active during the motion. Both the hydraulics library and, above all, the NC offer various options here. If the values are calculated independently of other axes, a distinction must be made between time-based and displacement-based generation. Like practically all current MC systems, Twin CAT NC/NCI/CNC works on a time-controlled basis. The core technology of the hydraulic library is path-controlled, although here, too, time- controlled operation is possible. The differences are shown below. A time-controlled Motion Control solution uses equations in which the motion profile runs on a time basis. This is shown below for an accelerated movement: V := A * t P := ½ * A * t2 If the first equation is squared and then both equations are resolved to t2 and equated, the following equation is obtained: V := SQRT( 2 * A * P ) If the absolute value of the remaining distance s to a target position is used for P and the sign is restored, a suitable braking ramp results. V := ± SQRT( 2 * A * ABS( s ) ) It should be noted that the time as the controlling variable has been replaced by the path. Combining this braking ramp with a ramp for the acceleration phase and a constant phase provides the basis for a simple but particularly robust Motion Control solution that is characterized by the following features: • Delayed axis responses at the start of a motion are ignored. The valve is not initially opened excessively and without effect by a position controller, only to be controlled back down again to a standstill once the cylinder springs into action. • No position control takes place even during the active motion. If the axis does not move at the correct velocity or at varying velocity, this is automatically compensated for by a premature or delayed initiation of the brake phase. • Counter forces generated by the process slow down the axis. However, this inevitably leads to an increase in pressure even without a reaction from the control unit, possibly up to the supply pressure and thus to the maximum available force. If this is not sufficient for a further movement, it would not be affected by a controller either. Even without position control, there is no risk of the axis stopping. • When approaching the target position, the velocity is adjusted according to the remaining distance. This adjustment happens continuously and thus compensates for inaccurate braking. • Non-linearities are also compensated. However, they can appear as interfering irregularities in the acceleration. In this case, the behavior can be improved by a more precise linearization. • The permanently active position controller, which is inevitable with the time-controlled principle, increases the tendency to oscillate and generates undesirable changes in the speeds. With electromechanical axes, this effect is less pronounced and can be tolerated. Hydraulic axes are subjected to considerably more excitation sources, and they have lower frequency and are less attenuated. The effect is distinct and often rather troublesome. • The accuracy at the target does not depend on the method used. In the time-controlled "vertical" principle, a deviation of the axis behavior from the ideal is compensated by an added controller output. With the displacement-based principle, the reaction takes place by "horizontal" stretching or compressing of the profile. • With the time-based principle, two axes that are operated with the same parameters and started simultaneously with the same commands will move as if they were mechanically connected. Both axes move at the right time in the right place and at the right velocity. The deviation is limited to the (typically small) lag errors and is not integrated. • With the displacement-based principle, influences from the process or even manufacturing tolerances of the components are not compensated. Deviations are integrated within a movement. There is no definitive expectation of a link between two axes that are operated with the same parameters and started simultaneously with the same commands. They are positioned in the target with the achievable accuracy, but do not necessarily arrive there at exactly the same time. 12 Version: 1.8.3 TF5810
## Page 13

Introduction to hydraulics Structure of the library In contrast to the NC, the library functions work entirely in the PLC runtime. This has several consequences, which are listed below. • Internal function blocks are usually also visible. This makes the online view less transparent. On the other hand, local variables can be used for an analysis. • All parameters and even runtime variables are visible and accessible. This creates opportunities for specific manipulations. It should be obvious why this should be done with the utmost care. • Nothing is done without a corresponding function block being called directly or indirectly. In contrast to the NC, the internal operation of the Motion Control is very transparent. This is particularly true for: ◦ Loading and saving of parameters. ◦ Recording of actual values. ◦ Setpoint generation. ◦ Control. ◦ Output adjustment. • In contrast to NC, there are no "finished" axes. This increases the initial work, but also offers opportunities for producing adapted properties. • Since the axis is configured in the PLC application, it is easily possible that unexpected and difficult to understand effects are created by an incorrect sequence or combination of the called function blocks. It is highly advisable to follow the examples. • Since the function blocks are called by the PLC, the Motion Control also works with the cycle time of the PLC task. A task with a typical NC cycle time of considerably less than 10 ms should be used. In order to make the projects more transparent, the most important function blocks are implemented according to the PLCopen standards. Among other things, this standard specifies that the function blocks are linked to an axis via a reference named Axis Ref. Since there is no hidden task level in the library, all data (parameters, runtime values) required for the axis are integrated in this structure. The communication of the function blocks of an axis is based on shared use of this reference. The only exceptions are the signals defined by PLCopen. The Execute input can be controlled by the Done output of another function block, for example, in order to create a desired sequence. Structure of an application In a PLC application realized with the hydraulics library, a distinction should be made between three different types of function block: • System function blocks related to all axes. This includes communication with the Plc Mc Manager IBN tool or handling of message recording. Regardless of the number of axes, these function blocks must be instantiated exactly once per project and called up exactly once per cycle. Obviously, this should be done from the Main() of a program. • Function blocks used for the configuration of an axis. These include, for example, the encoder function block and the setpoint generator etc. Exactly one instance of these function blocks must be created for each axis. The call should be made exactly once per cycle. • Function blocks related to an axis. These include, for example, the MC_Move Absolute_Bk Plc Mc function block, the MC_Stop_Bk Plc Mc function block, etc. More than one instance of these function blocks can be created per axis. As a rule, the call must be made exactly once per cycle. If the application has only one axis, this difference is less clear, but must still be considered. System function blocks The system function blocks include the following: • MC_Ax Ads Comm Server_Bk Plc Mc() This function block provides an ADS connection for the Plc Mc Manager for all axes. If this function block is not called cyclically, no connection is established. • MC_Ax Rt Logger Spool_Bk Plc Mc() or MC_Ax Rt Logger Despool_Bk Plc Mc TF5810 Version: 1.8.3 13
## Page 14

Introduction to hydraulics This function block manages the message buffer. If exactly one of these function blocks is not called cyclically, the message buffer overflows, and subsequent messages are lost. As you can see, the system function blocks require access to all affected structures. At the same time, the axis-related function blocks also require access. This can be easily ensured by creating the structures as VAR_GLOBAL. This is shown in the examples and applies especially to: • The axis references. They should be created as ARRAY[1... number of axes] OF Axis_Ref_Bk Plc Mc. ◦ This means that it is not possible to distribute the axis references in modules of the application. ◦ There is an alternative method that works with POINTER lists. Special care is required in his case. This method is therefore not recommended for general use. • The message buffer of type ST_Tc Plc Mc Log Buffer. The buffer is shared by all axes, and the management function block therefore cannot be assigned to an axis. Function blocks for the configuration of an axis These always include: • The initialization function block MC_Ax Uti Standard Init_Bk Plc Mc(). • The function blocks of the actual value acquisition. These always include a function block of type MC_Ax Rt Encoder_Bk Plc Mc() and one or more function blocks for determining pressures or forces, as required. Filtering can be used, if necessary. • A function block of type MC_Ax Runtime_Bk Plc Mc() for setpoint generation. This function block contains a standard position controller. • A function block of type MC_Ax Ax Rt Finish_Bk Plc Mc() or MC_Ax Rt Finish Linear_Bk Plc Mc. Various output parameters are combined here, and a section-by-section or characteristic curve-controlled output linearization is carried out. • A function block of type MC_Ax Rt Drive_Bk Plc Mc() that adapts to the I/O variables of the output hardware. If necessary, this minimum structure must be supplemented by function blocks that give the axis additional capabilities. These include, for example, function blocks for controlling pressures or forces, as an alternative position controller or for automatic measurement of characteristic curves. To be effective, the calls of these function blocks must be inserted at the correct position between the above-mentioned function blocks. The transparency of the application can be improved by combining these function blocks into an axis block with general interfaces. Axis-related function blocks These include the usual function blocks for configuring the working cycle of an axis. • MC_Power_Bk Plc Mc • MC_Move Absolute_Bk Plc Mc • MC_Stop_Bk Plc Mc • MC_Reset_Bk Plc Mc • MC_Home_Bk Plc Mc • MC_Gear In_Bk Plc Mc • MC_Gear Out_Bk Plc Mc • etc. Since the behavior of these function blocks corresponds to the PLCopen definitions, they can largely be used like the corresponding function blocks of the TC_MC libraries. However, the function blocks of these libraries only send commands to the NC driver and observe its reactions and feedback. Various function blocks of the hydraulic library contain essential parts of the functionality and must be called continuously and in every cycle. This must be taken into account when creating the application. 14 Version: 1.8.3 TF5810
## Page 15

General structure 3 General structure 3.1 Structure of the documentation Each axis consists of an axis structure under the name "AXIS_REF_Bk Plc Mc", which is composed of different external structures. This axis structure contains all the data (runtime data and parameter data) for this axis. Certain function blocks have to be present in each application, to enable an axis to move. These function blocks include: • MC_Ax Uti Standard Init_Bk Plc Mc [} 254]: Initialization and monitoring of the different axis components. Such an FB should be called cyclically. Blocks such as MC_Power_Bk Plc Mc, etc. may only be called after successful initialization. • MC_Power_Bk Plc Mc [} 27]: The function block is used to control an external actuator. The function block issues release notifications to valve output stages or frequency converters, for example. • MC_Ax Standard Body_Bk Plc Mc [} 253]: In each case the function block calls a function block of type MC_Ax Rt Encoder_Bk Plc Mc [} 198]: Determination of the actual position of the axis from the input information of a hardware module. MC_Ax Runtime_Bk Plc Mc [} 237]: Deals with profile generation. MC_Ax Rt Finish_Bk Plc Mc [} 246]: Adaptation of the control value to the special characteristics of the axis (characteristic curve linearization) MC_Ax Rt Drive_Bk Plc Mc [} 187]: The function block performs preparation of the control value for the axis for it to be output on a hardware module. • MC_Ax Ads Comm Server_Bk Plc Mc [} 279]: Establishes the connection to Plc Mc Manager and monitors it. This block must be called independent of the initialization, in order to enable commissioning without existing parameters. Optional useful function blocks are: • MC_Ax Rt Logger Spool_Bk Plc Mc [} 261]: The function block prevents overflowing of the Log Buffer of the library. • MC_Ax Param Delayed Save_Bk Plc Mc: Performs an auto-save of the axis parameters. TF5810 Version: 1.8.3 15
## Page 16

General structure The so-called "Plc Mc Manager" is provided for commissioning. This tool consolidates setting parameters and is intended to facilitated commissioning of the system. The first example is intended to illustrate the "first steps". Function groups Description Management functions [} 18] Functions for management and monitoring of axes, parameter access and states. Single axis motion functions [} 19] Triggering and monitoring of active movements for individual axes. Axis group motion functions [} 19] Triggering and monitoring of active movements for axis groups. Drive adjustments [} 19] Function blocks for preparing axis control values for output on output devices (terminals, actuators etc.) in the periphery. Encoder adjustments [} 19] Function blocks for evaluating actual position data, which were read by input devices (terminals, encoders etc.) in the periphery. Parameter handling [} 20] Function blocks for saving, reading and communicating parameters. Motion generators [} 19] Control value generators for active axis movements Controller [} 21] Controllers for various state variables: position, velocity, pressure. Table functions [} 21] Table functions for non-linear mappings and cam plates Message logging [} 21] Message recording. Runtime functions [} 22] Various runtime functions. Data types Enumerations [} 23] and structures [} 24] used in the library 3.2 Functions, function blocks and types Available from version 3.0 All the functions, function blocks and data types present in the library are listed here. You will find answers to frequently asked questions and notes on the use of the library, setting up, problem analysis and example projects in the Knowledge Base [} 320]. Some of the components listed here are not intended to be used by an application. Their presence, interface and behavior is therefore not guaranteed. Because, however, a Twin CAT PLC library is strictly open, it is not possible to hide these internal components. It is, nevertheless, essential to avoid calling these components, identified with (internal use only) or (not recommended), directly from an application. If one of these components would, in practice, be useful for you, please make contact with our Support Department. We will then examine the possibility of making the function block available to you, independently of the library, and for you to then take the responsibility for using it. If the library contains function blocks, types or constants that are not listed in the documentation, then these are elements that have not yet been approved, and are the subject of current software maintenance and development work. These elements must never be directly used in an application, because they are, as a general rule, not yet tested. 16 Version: 1.8.3 TF5810
## Page 17

General structure The hydraulic library only offers a restricted range of functions, even in connection with electrical drives. Twin CAT NC PTP, NC I and CNC offer a significantly broader spectrum and more comprehensive support for commissioning and diagnosis. A number of libraries are available, which deal with a typical axis configuration or special functionalities. These libraries require the Tc Plc Hydraulics library and have to be ordered separately. Name Description Tc Plc Lib Hydraulics_30_2R2Vgantry. LIB in preparation Tc Plc Lib Hydraulics_30_4R3Vgantry. LIB in preparation PLC open Motion Control The function blocks listed here are oriented towards: Technical Specification PLCopen - Technical Committee 2 - Task Force Function blocks for motion control Part 1 Version 1.1 and Part 2 Version 0.99F (definition not yet finalized) The names of these function blocks begin with MC_ and end with _Bk Plc Mc. Parts of the PLCopen definitions have not yet been finalized. Future versions of the library may be subject to modifications. Such modifications may relate to • Names, behavior or even existence of functions, function blocks or derived data types • Names, behavior, types or existence of input or output signals TF5810 Version: 1.8.3 17
## Page 18

General structure Administrative Function blocks Name Description MC_Cam Table Select_Bk Plc Mc [} 53] The function block initializes a variable of type ST_Tc Plc Mc Cam Id, thereby preparing a cam plate for the coupling of two axes. MC_Power_Bk Plc Mc [} 27] Function block to control an external actuator. MC_Read Actual Position_Bk Plc Mc [} 29] The actual position of an axis is determined. MC_Read Actual Torque_Bk Plc Mc [} 30] The actual force or the actual pressure of an axis is determined. MC_Read Actual Velocity_Bk Plc Mc [} 31] The actual velocity of an axis is determined. MC_Read Axis Error_Bk Plc Mc [} 32] The current error code of an axis is found. MC_Read Bool Parameter_Bk Plc Mc [} 33] The boolean parameters of an axis are read. MC_Read Digital Output_Bk Plc Mc [} 34] The current state of a digital output of a cam controller is determined. MC_Read Parameter_Bk Plc Mc [} 36] The non-boolean parameters of an axis are read. MC_Read Status_Bk Plc Mc [} 37] The state of the axis is decoded. MC_Reset_Bk Plc Mc [} 39] The axis is placed in a state ready for operation. MC_Reset And Stop_Bk Plc Mc [} 40] The axis is placed in a state ready for operation and is stationary. MC_Set Override_Bk Plc Mc [} 41] The axis override is set. MC_Set Position_Bk Plc Mc [} 43] The actual position of the axis is set. MC_Set Reference Flag_Bk Plc Mc [} 45] The referencing flag of the axis is defined. (Function is not defined by PLCopen) MC_Write Bool Parameter_Bk Plc Mc [} 46] The boolean parameters of an axis are written. MC_Write Digital Output_Bk Plc Mc [} 47] The current state of a digital output of a cam controller is defined. MC_Write Parameter_Bk Plc Mc [} 48] The non-boolean parameters of an axis are written. 18 Version: 1.8.3 TF5810
## Page 19

General structure Motion Function Blocks, Single Axis Name Description MC_Digital Cam Switch_Bk Plc Mc [} 54] Generation of software cams as a function of position, direction of movement and velocity of an axis. MC_Emergency Stop_Bk Plc Mc [} 57] Stopping a movement without reaching the target position. (Function is not defined by PLCopen) MC_Halt_Bk Plc Mc [} 71] Stopping a movement without reaching the target position. MC_Home_Bk Plc Mc [} 68] Initiation and monitoring of homing. MC_Imediate Stop_Bk Plc Mc [} 72] Stopping a movement without reaching the target position. (Function is not defined by PLCopen) MC_Move Absolute_Bk Plc Mc [} 73] Start and monitoring of a positioning process at a specifiable velocity to absolutely stated target co- ordinates. MC_Move Joy Sticked_Bk Plc Mc [} 75] Starting and controlling of an axis movement with a proportional control unit. (Function is not defined by PLCopen) MC_Move Relative_Bk Plc Mc [} 77] Start and monitoring of a positioning process at a specifiable velocity over an absolutely stated distance. MC_Move Velocity_Bk Plc Mc [} 79] Start and monitoring of a positioning process at a specifiable velocity but with no specified target. MC_Ramped Stop_Bk Plc Mc [} 80] Stopping of a movement with a pure time ramp. MC_Stop_Bk Plc Mc [} 82] Stopping a movement without reaching the target position. Motion Function blocks, Multiple Axis Name Description MC_Cam In_Bk Plc Mc [} 49] The function block starts and monitors a cam plates coupling between two axes. MC_Cam Out_Bk Plc Mc [} 51] The function block releases a cam plate coupling between two axes. MC_Gear In_Bk Plc Mc [} 63] Start and monitoring of the gear coupling of two axes. MC_Gear In Pos_Bk Plc Mc [} 65] On-the-fly gear coupling of two axes. MC_Gear Out_Bk Plc Mc [} 67] Cancelling the gear coupling of two axes. System Function Blocks Name Description MC_Ax Rt Drive_Bk Plc Mc [} 187] Preparation of the control value of the axis for output on a hardware module, mapping information. MC_Ax Rt Encoder_Bk Plc Mc [} 198] Determination of the actual position of the axis from the input information of a hardware module, mapping information. MC_Ax Rt Finish_Bk Plc Mc [} 246] Adaptation of the generated control value to the special features of the axis. MC_Ax Rt Finish Linear_Bk Plc Mc [} 247] Adjustment of the generated control value to the special features of the axis, taking into account a characteristic curve. MC_Ax Runtime_Bk Plc Mc [} 243] Position value generation and position control of the axis. MC_Ax Rt Generator_Bk Plc Mc [} 237] Control value generation for the axis. MC_Ax Rt Controller_Bk Plc Mc [} 245] Position control of the axis. TF5810 Version: 1.8.3 19
## Page 20

General structure System function blocks, other actual values Name Description MC_Ax Rt Read Force Diff_Bk Plc Mc [} 215] Determination of the differential actual force of an axis. MC_Ax Rt Read Force Single_Bk Plc Mc [} 218] Determination of the one-sided actual force of an axis. MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220] Determination of the differential actual pressure of an axis. MC_Ax Rt Read Pressure Single_Bk Plc Mc [} 222] Determination of the one-sided actual pressure of an axis. System Function Blocks, Parameter Name Description MC_Ax Ads Comm Server_Bk Plc Mc [} 279] The application is given the capacity to function as an ADS server. MC_Ax Ads Read Decoder_Bk Plc Mc [} 283] The function block decodes ADS read accesses for an ADS server. MC_Ax Ads Write Decoder_Bk Plc Mc [} 285] The function block decodes ADS write accesses for an ADS server. MC_Ax Ads Ptr Arr Comm Server_Bk Plc Mc [} 281] The application is given the capacity to function as an ADS server. MC_Ax Param Aux Labels Load_Bk Plc Mc [} 286] Loading the label texts for the client-specific axis parameters from a file. MC_Ax Param Load_Bk Plc Mc [} 287] Load the parameters for an axis from a file. MC_Ax Param Save_Bk Plc Mc [} 288] Write the parameters for an axis into a file. MC_Ax Param Delayed Save_Bk Plc Mc [} 261] Delayed writing of the axis parameters. MC_Ax Uti Read Coe Drive Term_Bk Plc Mc [} 289] Reading the contents of a register from the EL terminal, which is used as drive interface for the axis. MC_Ax Uti Read Coe Enc Term_Bk Plc Mc [} 291] Reading the contents of a register from the EL terminal, which is used as encoder interface for the axis. MC_Ax Uti Read Reg Drive Term_Bk Plc Mc [} 293] Reading the contents of a register from the KL terminal, which is used as drive interface for the axis. MC_Ax Uti Read Reg Enc Term_Bk Plc Mc [} 294] Reading the contents of a register from the KL terminal, which is used as encoder interface for the axis. MC_Ax Uti Update Reg Drive Term_Bk Plc Mc [} 295] Writing a parameter set into the register of a KL terminal, which is used as drive interface for the axis. MC_Ax Uti Update Reg Enc Term_Bk Plc Mc [} 297] Writing a parameter set into the register of a KL terminal, which is used as encoder interface for the axis. MC_Ax Uti Write Coe Drive Term_Bk Plc Mc [} 299] Writing the contents of a register into the EL terminal, which is used as drive interface for the axis. MC_Ax Uti Write Coe Enc Term_Bk Plc Mc [} 300] Writing the contents of a register into the EL terminal, which is used as encoder interface for the axis. MC_Ax Uti Write Reg Drive Term_Bk Plc Mc [} 302] Writing the contents of a register into the KL terminal, which is used as drive interface for the axis. MC_Ax Uti Write Reg Enc Term_Bk Plc Mc [} 303] Writing the contents of a register into the KL terminal, which is used as encoder interface for the axis. MC_Lin Table Export To Asci File_Bk Plc Mc [} 275] The function block exports a linearization table to a file in ASCI format. MC_Lin Table Export To Bin File_Bk Plc Mc [} 276] The function block exports a linearization table to a file in binary format. MC_Lin Table Import From Asci File_Bk Plc Mc [} 277] The function block imports a linearization table from a file in ASCI format. MC_Lin Table Import From Bin File_Bk Plc Mc [} 278] The function block imports a linearization table from a file in binary format. 20 Version: 1.8.3 TF5810
## Page 21

General structure System Function Blocks, Controllers Name Description MC_Ax Ctrl Auto Zero_Bk Plc Mc [} 166] Automatic zero balance. MC_Ax Ctrl Pressure_Bk Plc Mc [} 172] Controller for pressure build-up control. MC_Ax Ctrl Pressure FF_Ex_Bk Plc Mc [} 176] Extended controller for a pressure controller with a build- up action. MC_Ax Ctrl Pullback On Pressure_Bk Plc Mc Controller for pressure displacement control. MC_Ax Ctrl Slow Down On Pressure_Bk Plc Mc [} 178] Controller for pressure relief control. MC_Ax Ctrl Stepper De Stall_Bk Plc Mc [} 182] Monitoring the movement of a stepper motor axis. MC_Ax Ctrl Velocity_Bk Plc Mc Controller for the axis velocity. MC_Ax Ctrl Velo Moving_Bk Plc Mc Controller for the axis velocity. System Function blocks, Table Functions Name Description MC_Ax Table From Asci File_Bk Plc Mc [} 229] Reading the content of table from a text file. MC_Ax Table From Bin File_Bk Plc Mc [} 230] Reading the content of table from a binary file. MC_Ax Table Read Out Non Cyclic_Bk Plc Mc [} 232] Function block for determining the slave values assigned to a master value with the aid of a table. MC_Ax Table To Asci File_Bk Plc Mc [} 234] Writing the contents of a table to text file. MC_Ax Table To Bin File_Bk Plc Mc [} 235] Writing the contents of a table to a binary file. System Function blocks, Message Logging Name Description MC_Ax Rt Log Axis Entry_Bk Plc Mc [} 256] An axis-related message is entered in the Log Buffer of the library. MC_Ax Rt Log Clear_Bk Plc Mc [} 257] Clear and initialize all entries in the Log Buffer. MC_Ax Rt Log Entry_Bk Plc Mc [} 258] A message is entered in the Log Buffer of the library. MC_Ax Rt Logger Despool_Bk Plc Mc [} 259] Ensure the minimum number of free messages in the Log Buffer of the library. MC_Ax Rt Logger Read_Bk Plc Mc [} 260] Reading a message from the Log Buffer of the library. MC_Ax Rt Logger Spool_Bk Plc Mc [} 261] Transferring messages from the Log Buffer of the library into the Windows event viewer. TF5810 Version: 1.8.3 21
## Page 22

General structure System function blocks, runtime functions Name Description MC_Ax Rt Check Sync Distance_Bk Plc Mc [} 244] Monitoring of the distance between the referencing cam and zero pulse. MC_Ax Rt Cmd Buffer Execute_Bk Plc Mc [} 256] Processing of the command buffer. MC_Ax Rt Commands Locked_Bk Plc Mc [} 262] The function simplifies setting and deleting of a protective function in the status double word of an axis. MC_Ax Rt Go Error State_Bk Plc Mc [} 249] (not recommended) The axis is placed into an error state. MC_Ax Rt Move Checking_Bk Plc Mc [} 250] Monitoring the movement of an axis. MC_Ax Rt Set Direct Output_Bk Plc Mc [} 251] Direct output of a control value. MC_Ax Rt Set Ext Gen Values_Bk Plc Mc [} 252] Supplying an axis with command variables, which do not originate from the axis' own generator. MC_Ax Standard Body_Bk Plc Mc [} 253] Calls the usual sub-components for an axis (encoder, generator, finish, drive). MC_Ax Uti Auto Ident_Bk Plc Mc Automatic determination of axis parameters. MC_Ax Uti Auto Ident Slave_Bk Plc Mc in preparation: Automatic determination of slave axis parameters. MC_Ax Uti Average Derivative_Bk Plc Mc [} 265] Determination of the derivative of value through numeric differentiation over than one cycle. MC_Ax Uti PT1_Bk Plc Mc [} 267] Calculation of a first-order low-pass. MC_Ax Uti PT2_Bk Plc Mc [} 267] Calculation of a second-order low-pass. MC_Ax Uti Slew Rate Limitter_Bk Plc Mc [} 268] Generation of a rise-limited ramp. MC_Ax Uti Sliding Average_Bk Plc Mc [} 269] Determination of a sliding average value. MC_Ax Uti Standard Init_Bk Plc Mc [} 254] Initialization and monitoring of axis components. MC_Function Generator FD_Bk Plc Mc [} 226] A function generator. MC_Function Generator Set Frq_Bk Plc Mc [} 227] Updates the operating frequency of a time base for one or several function generators. MC_Function Generator TB_Bk Plc Mc [} 228] Updates a time base for one or several function generators. 22 Version: 1.8.3 TF5810
## Page 23

General structure Data types: Enumerations Name Description E_Tc Mc Current Step [} 90] This enumeration returns codes for the internal states of the control value generators. E_Tc Mc Drive Type [} 94] The constants in this enumeration are used to identify the hardware used to output the control values for an axis. E_Tc Mc Encoder Type [} 98] The constants in this enumeration are used to identify the hardware used to acquire the actual values for an axis. E_Tc MCFb State [} 103] This enumeration supplies codes for the current state of an axis. E_Tc Mc Homing Type [} 103] This enumeration supplies codes for the referencing method used by an axis. E_Tc MCParameter [} 104] The constants listed here are used for numbering parameters. E_Tc Mc Pressure Reading Mode [} 119] The constants in this list determine which actual value in the ST_Tc Hyd Ax Rt Data structure of the axis is to be updated with the result of a pressure or force measurement. E_Tc Mc Profile Type [} 118] The constants listed here are used for identifying control value generators. E_Tc Plc Buffered Cmd Type_Bk Plc Mc [} 89] In preparation: The constants in this list are used to identify buffered axis commands. MC_Buffer Mode_Bk Plc Mc [} 121] The constants in this list are used for controlling blending according to PLC Open. MC_Direction_Bk Plc Mc [} 124] This enumeration supplies codes for the direction of movement if this information is not contained in other data or cannot be in determined on the basis of the situation. MC_Homing Mode_Bk Plc Mc [} 125] This enumeration returns codes for specification of the referencing method. MC_Start Mode_Bk Plc Mc [} 125] The constants in this list are used for identifying the modes during axis startups. TF5810 Version: 1.8.3 23
## Page 24

General structure Data types: Structures Name Description Axis_Ref_Bk Plc Mc [} 86] A variable of this type contains all the necessary variables or pointers to variables that are associated with an axis. CAMSWITCH_REF_Bk Plc Mc [} 123] A variable of this type is transferred to an MC_Digital Cam Switch_Bk Plc Mc [} 54] function block. MC_CAM_ID_Bk Plc Mc [} 122] A variable of this type contains the description of a cam plate prepared for coupling. MC_CAM_REF_Bk Plc Mc [} 123] A variable of this type contains the description of a provided cam plate. OUTPUT_REF_Bk Plc Mc [} 126] A variable of this type contains output data of an MC_Digital Cam Switch_Bk Plc Mc [} 54] function block. ST_Function Generator FD_Bk Plc Mc [} 127] A variable of this type contains parameters for defining the output signals of a function generator. ST_Function Generator TB_Bk Plc Mc [} 128] A variable of this type contains parameter for defining a time base for a function generator. ST_Tc Mc Auto Ident [} 128] A variable of this type contains the parameters for an MC_Ax Uti Auto Ident_Bk Plc Mc function block. ST_Tc Mc Aux Data Labels [} 149] A variable of this type contains label texts for the client- specific axis parameters. ST_Tc Hyd Ax Param [} 130] A variable of this type contains all the parameters for an axis. ST_Tc Hyd Ax Rt Data [} 141] A variable of this type contains the runtime data for an axis. ST_Tc Plc Mc Log Buffer [} 156] A variable with this structure forms the Log Buffer of the library. ST_Tc Plc Mc Log Entry [} 156] A variable with this structure contains a message of the Log Buffer of the library. ST_Tc Plc Device Input [} 149] This structure contains the input image variables of an axis. ST_Tc Plc Device Output [} 153] This structure contains the output image variables of an axis. ST_Tc Plc Reg Data Item [} 157] This structure contains a parameter set for a KL terminal. ST_Tc Plc Reg Data Table [} 157] This structure contains a parameter for a KL terminal. TRACK_REF_Bk Plc Mc [} 126] In preparation. 3.3 The hydraulics library Special control algorithms are required to meet the requirements of the hydraulic systems. The PLC libraries Tc Plc Hydraulics_30 (for Twin CAT 2) and TC2_Hydraulic (for Twin CAT 3) contain a number of blocks and functions for hydraulic axes and the data types used in them. They extend support for this drive technology by enabling the operation of axes whose properties (limit frequency, scattering behavior) make them unsuitable for position control, or whose tasks differ from those of electrical servo axes. The product presented here includes: • the software library "Tc Plc Hydraulics.lib" or "Tc2_Hydraulics.compiled-library" • the commissioning tool "Plc Mc Manager.exe" To simplify the use of the library, the function blocks are designed based on specifications by the IEC61131 user organization (PLCopen) and certified accordingly. 24 Version: 1.8.3 TF5810
## Page 25

General structure The documentation for version V2.1 will continue to be available. Library topics: • Evaluation of encoders [} 198] • Evaluation of pressure cells • Various filter functions ◦ Pt1 filter ◦ Moving average [} 269] ◦ Rise limitation [} 268] • Full access to internal parameters • Motion control • Controllers for ◦ Pressure/force ◦ Position ◦ Velocity ◦ Possibility of in-house controller development • Synchronization of hydraulic and electric axes • Adaptation of control values to output devices • Full handling of complex devices • Message logging • Parameter handling ◦ Storage and loading routines ◦ Autosave • Characteristic curve linearization ◦ Section by section ◦ Characteristic compensation curve The following motion controllers are supported: 1. Time-based motion control: ◦ The controlling parameter for the profile generation is time. ◦ The generator does not “know” the axis. ◦ Only the pre-controlled position controller establishes the connection. TF5810 Version: 1.8.3 25
## Page 26

General structure 2. Displacement-based motion control: ◦ The controlling parameter for the profile generation is the residual path. ◦ The generator “knows” the axis. ◦ During motion no position control is possible/required. 3. Dependent motion control: ◦ The set values are calculated from the values of another axis, based on a mapping rule (gear formula, curve table). ◦ The generator does not “know” the axis. ◦ Only the pre-controlled position controller establishes the connection. Displacement- and time-based motion control: Time-based motion control uses time reference variable. The basic equations are v=a*t and s=0.5*a*t*t. The set value generator provides a velocity and a position, which are evaluated by the position and velocity controller and offset against the current position. During displacement-controlled positioning, in contrast to time-controlled the control value for the axis is calculated as a function of the residual path. Rearranging the above equations results in v=sqrt(2*a*s). Both methods have advantages and disadvantages. • Time-controlled require closed-loop control, particularly for acceleration and deceleration processes. The feedback is essential to enable the velocity controller to generate the correct output value. However, such a control loop reacts strongly to stick/slip effects or supply pressure fluctuations, which can cause the system to start oscillating. • Displacement-controlled axes do not have to be operated in closed-loop control. This method is therefore significantly more robust against external interference. • Since displacement-control of axes is based on the displacement, not on the time, a velocity is provided, but not readjusted. This makes the positioning of hydraulic axes very robust. Both methods are supported by the hydraulics library and can also be used in combination. 26 Version: 1.8.3 TF5810
## Page 27

PLCopen Motion Control 4 PLCopen Motion Control 4.1 Administrative 4.1.1 MC_Power_Bk Plc Mc MC_Power_Bk Plc Mc Enable BOOL BOOL Busy Enable_Positive BOOL BOOL Status Enable_Negative BOOL BOOL Error Buffer Mode MC_Buffer Mode_Bk Plc Mc UDINT Error ID ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block is used to control an external actuator. Further information on this topic can be found under FAQ #9 [} 329]. Inputs VAR_INPUT Enable: BOOL; Enable_Positive: BOOL; Enable_Negative: BOOL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Enable BOOL A TRUE at this input activates an external actuator of an axis. Enable_Positive BOOL A TRUE at this input activates the directional enable of an external actuator of an axis for movements in a positive direction. Enable_Negative BOOL A TRUE at this input activates the directional enable of an external actuator of an axis for movements in a negative direction. Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Status: BOOL; TF5810 Version: 1.8.3 27
## Page 28

PLCopen Motion Control Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. State BOOL Readiness for operation is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded error message is provided here. Behavior of the function block This function block is used to control external actuators. These can be modules for valve control (the valve's onboard output stage or control cabinet assembly), frequency inverters or servo drives. These devices usually require a digital signal to enable the output of energy through a power stage. Depending on the design of the device, it is also possible for the "positive" and "negative" movement directions to be individually activated. The function block's input signals are passed on through the interface to the peripheral device. Enable also activates error monitoring. The function block investigates the axis interface that has been passed to it every time it is called. A number of problems can be detected and reported during this process: • If the value i Tc Mc_Drive Ax2000_XXXXX is set under n Drive_Type in p St Ax Params, the following procedure is applied: ◦ If one of the pointers p St Device Output or p St Device Input in AXIS_REF_Bk Plc Mc [} 86] is not initialized, the function block responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Drive In or dw Tc Hyd Err Cd Ptr Plc Drive Out. Status is then FALSE. ◦ If an error is detected in the communication with the AX device or an error message occurs in the p St Device Input interface of the AX device, the function block responds with Error and an Error ID, which is defined in the global constants [} 344] of the library. Status is then FALSE, and the axis is set to an error state with the axis error dw Tc Hyd Err Cd Drive Not Ready. ◦ Otherwise, the value of Enable is returned as the Status. • If the value i Tc Mc_Drive KL2531 or i Tc Mc_Drive KL2541 is set under n Drive_Type in p St Ax Params, the following procedure is applied: ◦ The pointers p St Device Output and p St Device Input in AXIS_REF_Bk Plc Mc [} 86] are checked. If these pointers have not been initialized, the function block responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Drive In or dw Tc Hyd Err Cd Ptr Plc Drive Out. Status is then FALSE. ◦ If an error is detected in the communication with the I/O terminal or an error message of the terminal occurs in the p St Device Input interface, the function block responds with Error and an Error ID, which is defined in the global constants [} 344] of the library. Status is then FALSE, and the axis is set to an error state with the axis error dw Tc Hyd Err Cd Drive Not Ready. ◦ Enable is used to activate the terminal output stage through a bit in p St Device Output.b Terminal Ctrl. The ready signal in b Terminal Ctrl.b Terminal State is returned as Status. ◦ If the drive interface is operating without error, the value of Enable_Positive is entered with the mask dw Tc Hyd Dc Dw Fd Pos Ena in the n De Ctrl DWord of p St Ax Rt Data. ◦ If the drive interface is operating without error, the value of Enable_Negative is entered with the mask dw Tc Hyd Dc Dw Fd Neg Ena in the n De Ctrl DWord of p St Ax Rt Data. • Otherwise the pointers p St Device Input and p St Device Output in AXIS_REF_Bk Plc Mc [} 86] are checked. If these pointers have not been initialized, the function block responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Drive In or dw Tc Hyd Err Cd Ptr Plc Drive Out. Status is then FALSE. ◦ Otherwise, the value of b Power Ok from p St Device Input is returned as the Status. • If the drive interface is operating without error, the value of Enable is entered with the mask dw Tc Hyd Dc Dw Ctrl Enable in the n De Ctrl DWord of p St Ax Rt Data. • If the drive interface is operating without error, the value of Enable_Positive is entered with the mask dw Tc Hyd Dc Dw Fd Pos Ena in the n De Ctrl DWord of p St Ax Rt Data. 28 Version: 1.8.3 TF5810
## Page 29

PLCopen Motion Control • If the drive interface is operating without error, the value of Enable_Negative is entered with the mask dw Tc Hyd Dc Dw Fd Neg Ena in the n De Ctrl DWord of p St Ax Rt Data. This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.1.2 MC_Read Actual Position_Bk Plc Mc MC_Read Actual Position_Bk Plc Mc Enable BOOL BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Valid BOOL Error UDINT Error ID LREAL Position Available from version 3.0 The function block determines the current position of an axis. Inputs VAR_INPUT Enable: BOOL; END_VAR Name Type Description Enable BOOL Updating of the position value is initiated by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Valid: BOOL; Error: BOOL; Error ID: UDINT; Position: LREAL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Valid BOOL Successful determination of the actual position is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Position LREAL [mm] The actual position. TF5810 Version: 1.8.3 29
## Page 30

PLCopen Motion Control Behavior of the function block On a rising edge at Enable the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the axis is in an error state and the cause is an encoder problem, the response is Error and Error ID:=error code of the encoder. The actual position is determined and Valid is reported if these checks can be carried out without problems. A falling edge at Enable clears all the pending output signals. This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.1.3 MC_Read Actual Torque_Bk Plc Mc MC_Read Actual Torque_Bk Plc Mc Enable BOOL BOOL Valid ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Busy BOOL Error UDINT Error ID LREAL Torque Available from version 3.0 The function block determines the current actual force or actual pressure of an axis. Inputs VAR_INPUT Enable: BOOL; END_VAR Name Type Description Enable BOOL A rising edge at this input triggers an update of the actual value. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Valid: BOOL; Busy: BOOL; Error: BOOL; Error ID: UDINT; Torque: LREAL; END_VAR 30 Version: 1.8.3 TF5810
## Page 31

PLCopen Motion Control Name Type Description Valid BOOL This indicates successful determination of the actual value. Busy BOOL This output is TRUE while the command is being processed. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Torque LREAL The actual force or actual pressure. Behavior of the function block On a rising edge at Enable the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the axis is in an error state and the cause is an encoder problem, the response is Error and Error ID:=error code of the encoder. If these checks were completed without problem, the actual force or the actual pressure is determined, and Valid is reported. A falling edge at Enable clears all the pending output signals. This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.1.4 MC_Read Actual Velocity_Bk Plc Mc MC_Read Actual Velocity_Bk Plc Mc Enable BOOL BOOL Valid ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Busy BOOL Error UDINT Error ID LREAL Velocity Available from version 3.0 The function block determines the current velocity of an axis. Inputs VAR_INPUT Enable: BOOL; END_VAR Name Type Description Enable BOOL A rising edge at this input triggers an update of the velocity value. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. TF5810 Version: 1.8.3 31
## Page 32

PLCopen Motion Control Outputs VAR_OUTPUT Valid: BOOL; Busy: BOOL; Error: BOOL; Error ID: UDINT; Velocity: LREAL; END_VAR Name Type Description Valid BOOL This indicates successful determination of the velocity. Busy BOOL This output is TRUE while the command is being processed. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Velocity LREAL [mm/s] The actual velocity. Behavior of the function block On a rising edge at Enable the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the axis is in an error state and the cause is an encoder problem, the response is Error and Error ID:=error code of the encoder. The velocity is determined and reported with Valid if these checks can be carried out without problems. A falling edge at Enable clears all the pending output signals. This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.1.5 MC_Read Axis Error_Bk Plc Mc MC_Read Axis Error_Bk Plc Mc Enable BOOL BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Valid BOOL Error UDINT Error ID UDINT Axis Error ID Available from version 3.0 This function block determines the current error code of an axis. Inputs VAR_INPUT Enable: BOOL; END_VAR Name Type Description Enable BOOL TRUE at this input triggers an update of the error code. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR 32 Version: 1.8.3 TF5810
## Page 33

PLCopen Motion Control Name Type Description Axis AXIS_RE Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be F_Bk Plc transferred. Mc Outputs VAR_OUTPUT Busy: BOOL; Valid: BOOL; Error: BOOL; Error ID: UDINT; Axis Error ID:UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Valid BOOL Successful determination of the actual position is indicated here. Error BOOL Indicates TRUE, if the function block was unable to execute the required function. Error ID UDINT Provides a coded cause of error, if the function block was unable to execute the required function. Axis Error ID UDINT Provides the current error code [} 339] of the axis. Behavior of the function block The function block checks the axis interface that has been passed to it if TRUE is asserted at Enable. The current error code is reported as Axis Error ID. If Enable is FALSE, the function block cancels all pending output signals. This function block requires no time and no preconditions for executing its tasks. The outputs Error and Busy will never assume the value TRUE and only exist for compatibility reasons. 4.1.6 MC_Read Bool Parameter_Bk Plc Mc MC_Read Bool Parameter_Bk Plc Mc Enable BOOL BOOL Busy Parameter Number INT BOOL Valid ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID BOOL Value Available from version 3.0 This function block reads the boolean parameters of an axis. The function block MC_Read Parameter_Bk Plc Mc [} 36] is available for non-boolean parameters. Inputs VAR_INPUT Enable: BOOL; Parameter Number: INT; END_VAR TF5810 Version: 1.8.3 33
## Page 34

PLCopen Motion Control Name Type Description Enable BOOL A reading process is initiated by a rising edge at this input. Parameter Number INT This code number specifies the parameter that is to be read. Only named constants from E_Tc MCParameter [} 104] should be used. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Valid: BOOL; Error: BOOL; Error ID: UDINT; Value: BOOL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Valid BOOL Successful execution of the reading process is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Value BOOL The value of the parameter is made available here. Behavior of the function block On a rising edge at Enable the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If an unsupported value is given to Parameter Number the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Support. The desired parameter value is made available at Value, and Done is asserted if these checks can be carried out without problems. A falling edge at Enable clears all the pending output signals. This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.1.7 MC_Read Digital Output_Bk Plc Mc MC_Read Digital Output_Bk Plc Mc Enable BOOL BOOL Valid Output Number INT BOOL Busy ↔ Output Reference To OUTPUT_REF_Bk Plc Mc BOOL Error UDINT Error ID BOOL Value 34 Version: 1.8.3 TF5810
## Page 35

PLCopen Motion Control Available from version 3.0 The function block determines the current state of a digital output of a cam controller. Inputs VAR_INPUT Enable: BOOL; Output Number: INT; END_VAR Name Type Description Enable BOOL A rising edge at this input triggers an update of the state. Output Number INT The number of the output to be determined. Inputs/outputs VAR_IN_OUT Output: OUTPUT_REF_Bk Plc Mc; END_VAR Name Type Description Output OUTPUT_REF_Bk Plc Mc Here, the address of a variable of type OUTPUT_REF_Bk Plc Mc [} 126] should be transferred. Outputs VAR_OUTPUT Valid: BOOL; Busy: BOOL; Error: BOOL; Error ID: UDINT; Value: BOOL; END_VAR Name Type Description Valid BOOL This indicates successful determination of the state. Busy BOOL This output is TRUE while the command is being processed. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Value BOOL The state of the digital output. Behavior of the function block If Enable is TRUE, the function block checks the transferred parameters. During this process, a problem may be detected and reported: • If the value of Output Number is not within the permissible range [0..31], the response is Error with Error ID:=dw Tc Hyd Err Cd Illegal Output Number. If these checks were carried out without problems, the state of the digital output is determined, and Valid is reported. A falling edge at Enable clears all the pending output signals. TF5810 Version: 1.8.3 35
## Page 36

PLCopen Motion Control 4.1.8 MC_Read Parameter_Bk Plc Mc MC_Read Parameter_Bk Plc Mc Enable BOOL BOOL Busy Parameter Number INT BOOL Valid ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID LREAL Value Available from version 3.0 This function block reads the non-boolean parameters of an axis. The function block MC_Read Bool Parameter_Bk Plc Mc [} 33] is available for boolean parameters. Inputs VAR_INPUT Enable: BOOL; Parameter Number: INT; END_VAR Name Type Description Enable BOOL A reading process is initiated by a rising edge at this input. Parameter Number INT This code number specifies the parameter that is to be read. Only named constants from E_Tc MCParameter [} 104] should be used. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Valid: BOOL; Error: BOOL; Error ID: UDINT; Value: LREAL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Valid BOOL Successful execution of the reading process is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Value LREAL The value of the parameter is made available here. Behavior of the function block On a rising edge at Enable the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: 36 Version: 1.8.3 TF5810
## Page 37

PLCopen Motion Control • If an unsupported value is given to Parameter Number the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Support. The desired parameter value is made available at Value, and Done is asserted if these checks can be carried out without problems. A falling edge at Enable clears all the pending output signals. This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.1.9 MC_Read Status_Bk Plc Mc MC_Read Status_Bk Plc Mc Enable BOOL BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Valid BOOL Error UDINT Error ID BOOL Errorstop BOOL Disabled BOOL Stopping BOOL Stand Still BOOL Discrete Motion BOOL Continuous Motion BOOL Synchronized Motion BOOL Homing BOOL Constant Velocity BOOL Accelerating BOOL Decelerating Available from version 3.0 The function block determines the current state of an axis. Inputs VAR_INPUT Enable: BOOL; END_VAR Name Type Description Enable BOOL A TRUE state at this input triggers an update of the function block. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Valid: BOOL; TF5810 Version: 1.8.3 37
## Page 38

PLCopen Motion Control Error: BOOL; Error ID: UDINT; Errorstop: BOOL; Disabled: BOOL; Stopping: BOOL; Stand Still: BOOL; Discrete Motion: BOOL; Continous Motion: BOOL; Synchronized Motion: BOOL; Homing: BOOL; Constant Velocity: BOOL; Accelerating: BOOL; Decelerating: BOOL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Valid BOOL Successful determination of the actual position is indicated here. Error BOOL This output reports any problems relating to the function of the function block. Error ID UDINT Provides a coded cause of error, if the function block was unable to execute the required function. Errorstop BOOL This signal indicates that the axis associated with an error has been placed in a state in which it is not able to operate. This state can only be cleared by activating either a MC_Reset_Bk Plc Mc [} 39] or a MC_Reset And Stop_Bk Plc Mc [} 40] function block. Disabled BOOL This signal indicates whether the axis is enabled or disabled by its MC_Power_Bk Plc Mc [} 27] function block. Stopping BOOL This signal indicates that an active movement of the axis is being stopped by a MC_Stop_Bk Plc Mc [} 82] or by a MC_Reset And Stop_Bk Plc Mc [} 40] function block. This signal is cleared as soon as the axis is stationary. Stand Still BOOL This signal indicates that the axis is neither in a fault state nor is it active. Discrete Motion BOOL This signal indicates that the axis is executing an autonomous movement (not resulting from a coupling) with a defined target. Continous Motion BOOL This signal indicates that the axis is executing an autonomous movement (not resulting from a coupling) with a defined velocity but not with a specified target. Synchronized Motion BOOL This signal indicates that the axis is being controlled by a gear coupling. Homing BOOL This signal indicates that the axis is executing a homing. Constant Velocity BOOL This signal indicates that the axis is being moved with constant velocity. Accelerating BOOL This signal indicates that the velocity of an axis is reaching a specified value. This does not always mean that the velocity is increasing: when an axis that is already in movement is started, it can happen that the axis accelerates in the direction opposite the current sense of the velocity in order to achieve a specified velocity in the other direction. From the point of view of the original movement this is a deceleration, although from the point of the current (new) movement it is still an acceleration. Decelerating BOOL This signal indicates that the axis is reducing its velocity in order to continue a movement with a velocity lower than the current velocity, or in order to end it. Behavior of the function block If Enable is TRUE, the function block checks the transferred axis interface and decodes the internal state information. A FALSE state at Enable clears all pending output signals. 38 Version: 1.8.3 TF5810
## Page 39

PLCopen Motion Control This function block requires no time and no preconditions for executing its tasks. The outputs Error and Busy will never assume the value TRUE and only exist for compatibility reasons. Observe outputs The outputs Error and Error ID indicate the state of the function block, not that of the axis. To read the current error code of the axis a MC_Read Axis Error_Bk Plc Mc() [} 32] function block must be used. 4.1.10 MC_Reset_Bk Plc Mc MC_Reset_Bk Plc Mc Execute BOOL BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Done BOOL Error UDINT Error ID Available from version 3.0 The function block eliminates an error state and puts the axis in an operational state. Inputs VAR_INPUT Execute: BOOL; END_VAR Name Type Description Execute BOOL An axis reset is initiated by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful execution of the axis reset is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. TF5810 Version: 1.8.3 39
## Page 40

PLCopen Motion Control Behavior of the function block A rising edge at Execute triggers an axis reset. This puts the axis in an operational state, as far as possible, and Done is reported. If this is not possible, the system responds with Error and Error ID:= the Error Code of the axis. A falling edge at Execute clears all the pending output signals. In some drive types, signal exchange with an external device is required, in order to rectify certain errors. During the time required for this, the function block is unable to report a final result (Done or Error). Instead, Busy is used to indicate that the function is in progress. 4.1.11 MC_Reset And Stop_Bk Plc Mc MC_Reset And Stop_Bk Plc Mc Execute BOOL BOOL Busy Deceleration LREAL BOOL Done Jerk LREAL BOOL Error Ramp Time LREAL UDINT Error ID Buffer Mode MC_Buffer Mode_Bk Plc Mc BOOL Active ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block puts a faulty axis in an operational state. If the axis is processing a travel command, this is aborted, and the associated required stop operation is monitored. Inputs VAR_INPUT Execute: BOOL; Deceleration: LREAL; //from V3.0.5 Jerk: LREAL; //from V3.0.5 Ramp Time: LREAL; //from V3.0.5 Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Execute BOOL A rising edge at this input triggers an axis reset and a stop operation. Deceleration LREAL [mm/s2] The deceleration to be applied. Jerk LREAL [mm/s3] The jerk to be applied. Ramp Time LREAL [s] The required stopping time. Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. 40 Version: 1.8.3 TF5810
## Page 41

PLCopen Motion Control Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful execution of the axis reset is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If it is not possible to successfully clear an existing error state for an axis through a reset operation, the system responds with Error and Error ID:= the Error Code for the axis. • If the axis is placed into an error state in the course of a stop operation that may have been necessary, the system responds with Error and Error ID:= the Error Code for the axis. Successful completion of both operations is reported with Done. The axis is then without error and stationary. A falling edge at Execute clears all the pending output signals. If the axis is executing a motion, it is decelerated until it stops. In some drive types, signal exchange with an external device is required, in order to rectify certain errors. During the time required for this, the function block is unable to report a final result (Done or Error). Instead, Busy is used to indicate that the function is in progress. 4.1.12 MC_Set Override_Bk Plc Mc MC_Set Override_Bk Plc Mc Enable BOOL BOOL Enabled Vel Factor LREAL BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID Available from version 3.0 The function block sets the override of an axis. This function block only takes effect if the profile type i Tc Mc_Profile Ctrl Based is used. Inputs VAR_INPUT Enable: BOOL; Vel Factor: LREAL; END_VAR TF5810 Version: 1.8.3 41
## Page 42

PLCopen Motion Control Name Type Description Enable BOOL An active state at this input sets the override of the axis. Vel Factor LREAL [1] The new override of the axis. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Enabled: BOOL; Busy: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Enabled BOOL This indicates the active state of the function block. Busy BOOL This output is TRUE while the command is being processed. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block If the Enable state is active, the value transferred as Vel Override is limited to the range 0.0 to 1.0 and entered in Axis.p St Ax Params^.f Override. Enabled is set to TRUE. A falling edge at Enable clears all outputs. 42 Version: 1.8.3 TF5810
## Page 43

PLCopen Motion Control All velocity changes caused by an override modification are limited according to the maximum permitted accelerations and decelerations. In order to ensure reproducible behavior during the target approach, the override only reduces the travel speed to p St Ax Params.f Creep Speed. Therefore, it is not possible to stop the axis movement through an override of 0.0. 4.1.13 MC_Set Position_Bk Plc Mc MC_Set Position_Bk Plc Mc Execute BOOL BOOL Done Position LREAL BOOL Busy Mode BOOL BOOL Error ↔ Axis Reference To AXIS_REF_Bk Plc Mc UDINT Error ID Available from version 3.0 The function block sets the actual position of an axis. Inputs VAR_INPUT Execute: BOOL; Position: LREAL; Mode: BOOL; END_VAR TF5810 Version: 1.8.3 43
## Page 44

PLCopen Motion Control Name Type Description Execute BOOL A rising edge at this input sets the actual position of the axis. Position LREAL [mm] The new actual position of the axis. Mode BOOL This parameter specifies the operating mode. If Mode = TRUE, the actual position is changed by Position, if Mode = FALSE, the actual position is set to Position. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL This indicates successful processing of the command. Busy BOOL This output is TRUE while the command is being processed. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • Depending on the encoder type specified in Axis.p St Ax Params^.n Enc_Type, either ST_Tc Hyd Ax Rt Data.f Enc_Ref Shift or ST_Tc Hyd Ax Param.f Enc_Zero Shift is updated such that the actual position of the axis assumes the required value. If the encoder type is unknown or the encoder does not permit the actual value to be set, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Enc Type. • If ST_Tc Hyd Ax Param.f Enc_Zero Shift changes recognizable during this process, AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Rt Data [} 141].b Params Unsave is set. This function block may cause the actual position and/or the target position of the currently processed motion to be moved after an active software limit switch. This is not monitored by the function block. If these checks could be performed without problem, all other affected elements in ST_Tc Hyd Ax Rt Data are automatically updated. This function block can therefore also be activated for axes, which perform an active motion. The successful execution of the function is indicated with Done. A falling edge at Execute clears all the pending output signals. 44 Version: 1.8.3 TF5810
## Page 45

PLCopen Motion Control 4.1.14 MC_Set Reference Flag_Bk Plc Mc MC_Set Reference Flag_Bk Plc Mc Execute BOOL BOOL Done Reference Flag BOOL BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID Available from version 3.0 (Function is not defined by PLCopen) The function block defines the referencing flag of the axis. Inputs VAR_INPUT Execute: BOOL; Reference Flag: BOOL; END_VAR Name Type Description Execute BOOL A rising edge at this input sets the referencing flag of the axis. Reference Flag BOOL The new state of the referencing flag of the axis. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL This indicates successful processing of the command. Busy BOOL This output is TRUE while the command is being processed. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block A rising edge at Execute causes the referencing flag in ST_Tc Hyd Ax Rt Data.n State DWord [} 338] to be updated. To this end, the respective bit is cleared or set with dw Tc Hyd Ns Dw Referenced, depending on Reference Flag. The successful execution of the function is indicated with Done. A falling edge at Execute clears all the pending output signals. TF5810 Version: 1.8.3 45
## Page 46

PLCopen Motion Control 4.1.15 MC_Write Bool Parameter_Bk Plc Mc MC_Write Bool Parameter_Bk Plc Mc Execute BOOL BOOL Busy Parameter Number INT BOOL Done Value BOOL BOOL Error ↔ Axis Reference To AXIS_REF_Bk Plc Mc UDINT Error ID Available from version 3.0 This function block writes the boolean parameters of an axis. The function block MC_Write Parameter_Bk Plc Mc [} 48] is available for non-boolean parameters. Inputs VAR_INPUT Execute: BOOL; Parameter Number: INT; Value: BOOL; END_VAR Name Type Description Execute BOOL A write process is initiated by a rising edge at this input. Parameter Number INT This code number specifies the parameter that is to be read. Only named constants from E_Tc MCParameter [} 104] should be used. Value BOOL The value of the parameter is to be provided here. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful execution of the writing process is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Enable the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If an unsupported value is given to Parameter Number the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Support. 46 Version: 1.8.3 TF5810
## Page 47

PLCopen Motion Control If these checks could be performed without problems Value is entered into the desired parameter value and Done is reported. If the parameter is changed in the process AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Rt Data [} 141].b Params Unsave is set. A falling edge at Enable clears all the pending output signals. This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.1.16 MC_Write Digital Output_Bk Plc Mc MC_Write Digital Output_Bk Plc Mc Execute BOOL BOOL Done Output Number INT BOOL Busy Value BOOL BOOL Error ↔ Output Reference To OUTPUT_REF_Bk Plc Mc UDINT Error ID Available from version 3.0 The function block determines the state of a digital output of a cam controller. Inputs VAR_INPUT Execute: BOOL; Output Number: INT; Value: BOOL; END_VAR Name Type Description Execute BOOL A rising edge at this input triggers an update of the state. Output Number INT The number of the output to be determined. Value BOOL The state of the digital output. Inputs/outputs VAR_IN_OUT Output: OUTPUT_REF_Bk Plc Mc; END_VAR Name Type Description Output OUTPUT_REF_Bk Plc Mc Here, the address of a variable of type OUTPUT_REF_Bk Plc Mc should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Error: BOOL; Error ID: UDINT; END_VAR TF5810 Version: 1.8.3 47
## Page 48

PLCopen Motion Control Name Type Description Done BOOL This indicates successful determination of the state. Busy BOOL This output is TRUE while the command is being processed. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block A rising edge at Execute causes the function block to check the transferred parameters. During this process, a problem may be detected and reported: • If the value of Output Number is not within the permissible range [0..31], the response is Error with Error ID:=dw Tc Hyd Err Cd Illegal Output Number. If these checks could be performed without problems, the state of the digital output is defined according to the value of Value, and Done is reported. A falling edge at Execute clears all the pending output signals. 4.1.17 MC_Write Parameter_Bk Plc Mc MC_Write Parameter_Bk Plc Mc Execute BOOL BOOL Busy Parameter Number INT BOOL Done Value LREAL BOOL Error ↔ Axis Reference To AXIS_REF_Bk Plc Mc UDINT Error ID Available from version 3.0 This function block writes the non-boolean parameters of an axis. The function block MC_Write Bool Parameter_Bk Plc Mc [} 46] is available for boolean parameters. Inputs VAR_INPUT Enable: BOOL; Parameter Number: INT; Value: LREAL; END_VAR Name Type Description Enable BOOL A write process is initiated by a rising edge at this input. Parameter Number INT This code number specifies the parameter that is to be read. Only named constants from E_Tc MCParameter [} 104] should be used. Value LREAL The value of the parameter is to be provided here. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. 48 Version: 1.8.3 TF5810
## Page 49

PLCopen Motion Control Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful execution of the writing process is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Enable the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If an unsupported value is given to Parameter Number the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Support. If these checks could be performed without problems Value is entered into the desired parameter value and Done is reported. If the parameter is changed recognizably in the process AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Rt Data [} 141].b Params Unsave is set. A falling edge at Enable clears all the pending output signals. This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.2 Motion 4.2.1 MC_Cam In_Bk Plc Mc MC_Cam In_Bk Plc Mc Execute BOOL BOOL Busy Master Offset LREAL BOOL In Sync Slave Offset LREAL BOOL Command Aborted Master Scaling LREAL BOOL Error Slave Scaling LREAL UDINT Error ID Start Mode MC_Start Mode_Bk Plc Mc BOOL End Of Profile Cam Table Id MC_CAM_ID_Bk Plc Mc Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Master Reference To AXIS_REF_Bk Plc Mc ↔ Slave Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block starts and monitors a cam plate coupling between two axes. To release the coupling, an MC_Cam Out_Bk Plc Mc [} 51] function block should be used. TF5810 Version: 1.8.3 49
## Page 50

PLCopen Motion Control Inputs VAR_INPUT Execute: BOOL; Master Offset: LREAL:=0.0; Slave Offset: LREAL:=0.0; Master Scaling: LREAL:=0.0; Slave Scaling: LREAL:=0.0; Start Mode: MC_Start Mode_Bk Plc Mc:=MC_Start Mode_Absolute; Cam Table Id: MC_CAM_ID_Bk Plc Mc; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Execute BOOL A rising edge at this input starts the coupling. Master Offset LREAL [mm, 1] This value is offset against with the actual position of the master, before the resulting value is looked up in the master column of the table. Slave Offset LREAL [mm, 1] This value is offset against the slave position from the table. Master Scaling LREAL [mm, 1] This value is offset against with the actual position of the master, before the resulting value is looked up in the master column of the table. Slave Scaling LREAL [mm, 1] This value is offset against the slave position from the table. Start Mode MC_Start Mode_Bk Plc Mc A value from MC_Start Mode_Bk Plc Mc [} 125], which specifies the behavior of the slave axis when the coupling is activated. Cam Table Id MC_CAM_ID_Bk Plc Mc Here, a variable of type MC_CAM_ID_Bk Plc Mc [} 122] should be transferred, which was initialized by a function block of type MC_Cam Table Select_Bk Plc Mc [} 53]. Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Inputs/outputs VAR_IN_OUT Master: AXIS_REF_Bk Plc Mc; Slave: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Master AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Slave AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; In Sync: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; End Of Profile: BOOL; END_VAR 50 Version: 1.8.3 TF5810
## Page 51

PLCopen Motion Control Name Type Description Busy BOOL Indicates that a command is being processed. In Sync BOOL This indicates the first successful synchronization of the axes. The signal the remains active, even if the synchronization subsequently fails temporarily or permanently. Command Aborted BOOL This indicates abortion of the coupling. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. End Of Profile BOOL This is indicates whether the master has reached the end of the defined range. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If Cam Table Id.b Validated was not set by a function block of type MC_Cam Table Select_Bk Plc Mc, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl No Init. • If either the master or the slave are not in idle state, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Startable. • If the value MC_Start Mode_Ramp In is specified as Start Mode, the function block responds with Error and Error ID:=dw Tc Hyd Err Cd Not Support. If these checks could be performed without problem, the coupling is initiated. Depending on Start Mode, the reference position for Slave is either set to 0.0 or to the current actual position of Slave. The axis is now in state Mc State_Synchronizedmotion [} 103], and the function block starts calculating and monitoring the coupling. The set position and set velocity of Slave are calculated depending on the actual position and the set velocity of the master and the table. When the velocity required by the coupling is reached for the first time while the slave axis coupling is active, this is indicated at output In Gear. Since the coupling can currently only be activated at standstill, this is the case immediately. If the slave axis is unable to follow the specifications for some reason while the coupling is active, In Gear remains unchanged. If an error code occurs in the motion generator while the coupling is active, the system responds with Error and Error ID:=motion algorithm error code. A falling edge at Execute neither aborts the calculation nor the monitoring of the coupling. This is only brought about if the coupling is activated through an MC_Cam Out_Bk Plc Mc function block or if an error occurs. Only then are all pending output signals cleared. This function block temporarily deals with setpoint generation. To indicate this, Busy is not only TRUE up to the transition to synchronicity, but remains TRUE until the coupling is released. Function block call It is mandatory to call this function block cyclically when Busy is TRUE. Subsequently, the function block should be called at least once with Execute:=FALSE. 4.2.2 MC_Cam Out_Bk Plc Mc MC_Cam Out_Bk Plc Mc Execute BOOL BOOL Busy ↔ Slave Reference To AXIS_REF_Bk Plc Mc BOOL Done BOOL Error UDINT Error ID TF5810 Version: 1.8.3 51
## Page 52

PLCopen Motion Control Available from version 3.0 The function block releases a cam plate coupling between two axes, which was started through an MC_Cam In_Bk Plc Mc [} 49] function block. Inputs VAR_INPUT Execute: BOOL; ND_VAR Name Type Description Execute BOOL A rising edge at this input starts the coupling. Inputs/outputs VAR_IN_OUT Slave: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Slave AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful processing of the command. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the pointer p St Ax Params in AXIS_REF_Bk Plc Mc [} 86] is not initialized, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc. • If the pointer p St Ax Params in AXIS_REF_Bk Plc Mc [} 86] is not initialized, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Mc Plc. • If the axis is not coupled, the function block responds with Done, without further checks or activities. • If the current set velocity of the axis is smaller than the velocity specified by p St Ax Params.f Creep Speed, the axis immediately assumes Mc State_Standstill and dissipates the residual velocity. Done is indicated, and no further checks or activities take place. If these checks could be performed without problem and Done is not already indicated for one of the reasons mentioned, the motion controlled by the cam plate coupling is converted to a continuous motion with the same velocity and direction, which is independent of the master. Done is indicated if this conversion was executed successfully, otherwise the system responds with Error and Error ID:=error code. 52 Version: 1.8.3 TF5810
## Page 53

PLCopen Motion Control This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.2.3 MC_Cam Table Select_Bk Plc Mc MC_Cam Table Select_Bk Plc Mc Execute BOOL BOOL Busy Periodic BOOL BOOL Done Master Absolute BOOL BOOL Error Slave Absolute BOOL UDINT Error ID ↔ Master Reference To AXIS_REF_Bk Plc Mc MC_CAM_ID_Bk Plc Mc Cam Table Id ↔ Slave Reference To AXIS_REF_Bk Plc Mc ↔ Cam Table Reference To MC_CAM_REF_Bk Plc Mc Available from version 3.0 The function block initializes a variable of type MC_CAM_ID_Bk Plc Mc [} 122], thereby preparing a cam plate for the coupling of two axes. Inputs VAR_INPUT Execute: BOOL; Periodic: BOOL; Master Absolute: BOOL; Slave Absolute: BOOL; ND_VAR Name Type Description Execute BOOL A rising edge at this input starts the command. Periodic BOOL Not supported: FALSE is currently to be passed here. Master Absolute BOOL Not supported: TRUE is currently to be passed here. Slave Absolute BOOL Not supported: TRUE is currently to be passed here. Inputs/outputs VAR_IN_OUT Master: AXIS_REF_Bk Plc Mc; Slave: AXIS_REF_Bk Plc Mc; Cam Table: MC_CAM_REF_Bk Plc Mc; END_VAR Name Type Description Master AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc should be transferred. Slave AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc should be transferred. Cam Table MC_CAM_REF_Bk Plc Mc A variable of type MC_CAM_REF_Bk Plc Mc [} 123] should be transferred here. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; TF5810 Version: 1.8.3 53
## Page 54

PLCopen Motion Control Error ID: UDINT; Cam Table Id: MC_CAM_ID_Bk Plc Mc; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful initialization of Cam Table Id. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Cam Table Id MC_CAM_ID_Bk Plc Mc Returns a variable of type MC_CAM_ID_Bk Plc Mc [} 122], which can be passed on to a function block of type MC_Cam In_Bk Plc Mc [} 49]. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If Cam Table.p Table is not initialized the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc. • If Cam Table.n Last Idx is not greater than Cam Table.n First Idx the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Entry Count. • If Cam Table.n First Idx and Cam Table.n Last Idx define a table with more than 100 rows the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Line Count. • If Master Absolute or Slave Absolute are not set or Periodic is set, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Support. If these checks could be performed without problem, Cam Table Id is initialized. The data from Cam Table and the input data of function block are used for this purpose. Cam Table Id is marked as valid and modified. Done is used to report execution of the command. A falling edge at Execute clears all the pending output signals. This function block requires no time for executing its tasks. The output Busy will never assume the value TRUE and only exists for compatibility reasons. 4.2.4 MC_Digital Cam Switch_Bk Plc Mc MC_Digital Cam Switch_Bk Plc Mc Enable BOOL BOOL In Operation Enable Mask DWORD BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error ↔ Switches Reference To CAMSWITCH_REF_Bk Plc Mc UDINT Error ID ↔ Outputs Reference To OUTPUT_REF_Bk Plc Mc ↔ Track Options Reference To TRACK_REF_Bk Plc Mc Available from version 3.0 The function block generates software cams depending on the position, direction of travel and velocity of an axis. 54 Version: 1.8.3 TF5810
## Page 55

PLCopen Motion Control Inputs VAR_INPUT Enable: BOOL; Enable Mask: DWORD; END_VAR Name Type Description Enable BOOL This input controls all activities of the function block. Enable Mask DWORD A mask with bits that specify the activation of the outputs in Outputs. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; Switches: CAMSWITCH_REF_Bk Plc Mc; Outputs: OUTPUT_REF_Bk Plc Mc; Track Options: TRACK_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Switches CAMSWITCH_REF_Bk Plc Mc Here, an array of type CAMSWITCH_REF_Bk Plc Mc [} 123] should be transferred. Outputs OUTPUT_REF_Bk Plc Mc Here, the address of a variable of type OUTPUT_REF_Bk Plc Mc [} 126] should be transferred. Track Options TRACK_REF_Bk Plc Mc Here, an array of type TRACK_REF_Bk Plc Mc [} 126] should be transferred. Outputs VAR_OUTPUT In Operation: BOOL; Busy: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description In Operation BOOL This indicates whether the function block is active. Busy BOOL This output is TRUE while the command is being processed. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block Cam signals (switches) are switched based on the actual position of an axis. The available options are position-controlled (with start and end position) and time-controlled (with trigger position and duration). The direction of travel of the axis can be taken into account. The cam signals are assigned to tracks with parameter sable properties. The time response can be specified through a switch-on and switch-off delay. Predictive signalling can be achieved through negative values. A hysteresis enables suppression of undesirable signalling, if the axis is near a switching points and the actual position is not entirely constant. Example CAMSWITCH_REF_Bk Plc Mc [} 123] used: TF5810 Version: 1.8.3 55
## Page 56

PLCopen Motion Control Parameter Switch[1] Switch[2] Switch[3] Switch[4] ... Switch[n] Track Number 1 1 1 2 First On Positio 2000.0 2500.0 -1000.0 3000.0 n Last On Positio 3000.0 3000.0 1000.0 n Axis Direction 1 2 0 0 Cam Switch Mo 0 0 0 1 de Duration 1.35 ..... TRACK_REF_Bk Plc Mc [} 126] used: Parameter Track[1] Track[2] ... Track[n] On Compensation -0.125 0.0 Off Compensation 0.250 0.0 Hysteresis 0.0 0.0 Signal curves during axis motion from 0.0 to 5000.0 and back: The following diagram shows the signal curves over the position. For positive direction of travel the signals are shown normally (upwards), for negative direction of travel they are shown negative, i.e. 'downwards'. The vertical cursor lines indicate the positions 1000 and 3000 mm. 56 Version: 1.8.3 TF5810
## Page 57

PLCopen Motion Control 4.2.5 MC_Emergency Stop_Bk Plc Mc MC_Emergency Stop_Bk Plc Mc Execute BOOL BOOL Busy Ramp Time LREAL BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error Id BOOL Active BOOL Command Aborted Available from version 3.0.5 The function block cancels a current axis motion and monitors the emergency stop operation. Inputs VAR_INPUT Execute: BOOL; Ramp Time: LREAL; //from V3.0.5 END_VAR Name Type Description Execute BOOL A rising edge at this input ends a movement being carried out by the axis. Ramp Time LREAL [s] The required stopping time. TF5810 Version: 1.8.3 57
## Page 58

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Active: BOOL; Command Aborted: BOOL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful processing of the operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Active BOOL Indicates that a command is being processed. Command Aborted BOOL Indicates that processing of this command was aborted by another command. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • The stop can only be executed if the axis is actively carrying out a movement. If it is stationary, the function block immediately asserts the Done signal. • If the axis is already in an error state, or if it is in the process of carrying out a stop operation, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If the axis is in a state, in which it is controlled by a coupling with another axis or a comparable mechanism, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. The Stop operation begins if these checks can be carried out without problems. Ramp Time is used to calculate a deceleration, taking into account the reference velocity. Max Jerk is used if a jerk-limiting control value generator is selected. If no value is specified for Ramp Time, which is recognizably greater than 0, the axis parameter f Emergency Ramp is used. An MC_Stop_Bk Plc Mc [} 82] function block is used internally for slowing down the axis. Once the control value output is reduced to 0, all control or regulating voltage outputs are suppressed, as long as Execute is set to TRUE. 58 Version: 1.8.3 TF5810
## Page 59

PLCopen Motion Control 4.2.6 MC_Flying Gear_Bk Plc Mc MC_Flying Gear_Bk Plc Mc Enable BOOL BOOL Start Sync Ratio LREAL BOOL In Sync Master Sync Position LREAL BOOL Stop Sync Slave Sync Position LREAL BOOL Busy Slave Desync Position LREAL BOOL Active Slave Stop Position LREAL BOOL Error Default Slave Negative BOOL UDINT Error Id Turn Point BOOL ↔ Master Reference To AXIS_REF_Bk Plc Mc ↔ Slave Reference To AXIS_REF_Bk Plc Mc The function block takes over the control of a flying gear coupling. Inputs VAR_INPUT Enable: BOOL; Ratio: LREAL; Master Sync Position: LREAL; Slave Sync Position: LREAL; Slave Desync Position: LREAL; Slave Stop Position: LREAL; Default Slave Negative: BOOL; END_VAR Name Type Description Enable BOOL This signal allows the function block to become active as soon as the master's position passes the Master Sync Position in the designated direction. Ratio LREAL This parameter specifies the gear ratio between master and slave for the fully coupled case. Master Sync Position LREAL This parameter indicates the position in the designated direction of the master at which the coupling should have been fully established. Slave Sync Position LREAL This parameter indicates the position in the designated direction of the slave at which the coupling should have been fully established. Slave Desync Position LREAL This parameter indicates the position in the designated direction of the slave at which the release of the coupling should start. Slave Stop Position LREAL This parameter indicates the position in the designated direction of the slave at which the release of the coupling should have been completed. Default Slave Negative BOOL In some cases, the function block cannot determine the intended work direction from the transferred parameters. Additional information is then required from the application. Inputs/outputs VAR_IN_OUT Master: AXIS_REF_Bk Plc Mc; Slave: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Master AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc should be transferred. Slave AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc should be transferred. TF5810 Version: 1.8.3 59
## Page 60

PLCopen Motion Control Outputs VAR_OUTPUT Start Sync: BOOL; In Sync: BOOL; Busy: BOOL; Active: BOOL; Error: BOOL; Error Id: BOOL; END_VAR Name Type Description Start Sync BOOL This signal is TRUE if the master is within the section for the establishment of the coupling. In Sync BOOL This signal is TRUE if the coupling is fully active. Busy BOOL This signal goes TRUE if Enable is TRUE, master and slave are ready and not in an error state and the transferred parameters are suitable. Active BOOL This signal goes TRUE as soon as the master passes the Master Sync Position in the designated direction. It goes FALSE when the Slave Stop Position is reached in the opposite direction of the slave. Error BOOL This signal goes TRUE if there are unsuitable parameters on a rising edge at Enable or if the master or slave is in an error state on a TRUE at Enable. Error Id BOOL A numerically encoded indication of an error cause. Behavior of the function block The function block establishes a coupling between a master and a slave axis that is established and released on the fly. The parameterization and enable can vary the behavior in wide areas. In combination with positioning commands, a variety of motion sequences can be realized. Just a few samples are shown here. NOTICE The scopes were created using the sample S106_Flying Gear. The number of the sample corresponds to the selected n Sequence. During commissioning When measuring the position of the master, the zero point should be shifted so that the actual position represents comprehensible information about the situation in the machine. For the slave, the zero shift should be chosen in such a way that the actual position, taking into account the dimensions of the material, tools and other installations, matches that of the master, if the remaining gap has just become 0. To avoid elastic deformation, no force should have been built up. Sample #1 Here, master and slave move in the same direction. Both return to their starting position. 60 Version: 1.8.3 TF5810
## Page 61

PLCopen Motion Control Preparation: • The master was positioned at 800.0 mm. • The slave was positioned at 500.0 mm. • The location at which the slave begins with the establishment of the synchronization is thus defined. • The final coupling factor (ratio) has been set to 1.0 for better understanding. In practical use, this factor is often chosen slightly smaller in order to trigger a transition to a pressure or force control. • The point for achieving synchronization has been set to 460.0 mm for the master (Master Sync Position) and 450.0 mm for the slave (Slave Sync Position). • The difference of 10.0 mm between master and slave represents the distance required for material, tools and other installations and is chosen here in such a way that the representation illustrates the behavior. • The distance for synchronizing the slave is calculated from the starting position of the slave and the Slave Sync Position and is in this case 500.0 - 450.0 => 50 mm. • With a ratio of 1.0, the master has a distance to synchronize of 2.0 * 50 mm => 100 mm. So the synchronization of the master will start at 460.0 mm+100 mm => 560 mm (Master Sync Position plus distance). If the master is below this position when the coupling is enabled, an error is signaled. • The point for leaving the synchronization has been set to 450.0 mm for the slave (Slave Desync Position). • The point for the complete release of the coupling (Slave Stop Position) has been set to 500.0 mm. The intended distance for this is thus 500.0 mm – 450 mm => 50 mm. • With a ratio of 1.0, the master will also travel a distance of 2.0 * 50 mm => 100 mm. • Distances that the master travels before TM_1 and after TM_4 in the above scope do not concern the slave. • If the master changes its speed between TM_1 and TM_2 or between TM_3 and TM_4, the slave will take this into account. Then its speed curve may be less clear than in the above scope. Sample #2 Here, the master and slave move in opposite directions. Both return to their starting position. TF5810 Version: 1.8.3 61
## Page 62

PLCopen Motion Control • Here, the starting position is not 50 mm above the Slave Sync Position, but by the same amount below it. Sample #3 Here, master and slave move in the same direction. However, the slave only returns to its starting position by means of an MC_Move Absolut_Bk Plc Mc(). • Here, the initial situation is the same as in the sample #1. • However, the Slave Stop Position is different here. The slave accordingly stops earlier. 62 Version: 1.8.3 TF5810
## Page 63

PLCopen Motion Control • The distance between Slave Desync Position and Slave Stop Position is 100 mm here. As a result, the release of the coupling creates a different profile than the establishment of the coupling. • Once the master has completed its movement, the function block is deactivated and the slave is driven to the starting position with its own command. 4.2.7 MC_Gear In_Bk Plc Mc MC_Gear In_Bk Plc Mc Execute BOOL BOOL Busy Ratio Numerator INT BOOL In Gear Ratio Denominator INT BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error Id Jerk LREAL BOOL Active Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Master Reference To AXIS_REF_Bk Plc Mc ↔ Slave Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block starts and monitors a coupling between two axes. To release the coupling, an MC_Gear Out_Bk Plc Mc [} 67] function block should be used. Inputs VAR_INPUT Execute: BOOL; Ratio Numerator: INT; Ratio Denominator: INT; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; //from V3.0.5 Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Execute BOOL A rising edge at this input starts the coupling. Ratio Numerator INT [1, 1] These parameters describe the coupling factor in the form of a gear unit. Ratio Denominator INT [1, 1] These parameters describe the coupling factor in the form of a gear unit. Acceleration LREAL [mm/s2] The acceleration permitted for the synchronization in actual value units of the axis per square second. Deceleration LREAL [mm/s2] The deceleration permitted for the synchronization in actual value units of the axis per square second. Jerk LREAL [mm/s3] The jerk to be applied. Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) TF5810 Version: 1.8.3 63
## Page 64

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Master: AXIS_REF_Bk Plc Mc; Slave: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Master AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Slave AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; In Gear: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; Active: BOOL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. In Gear BOOL This indicates the first successful synchronization of the axes. The signal the remains active, even if the synchronization subsequently fails temporarily or permanently. Command Aborted BOOL This indicates abortion of the coupling. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Active BOOL Indicates that a command is being processed. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • Next, the system checks whether Ratio Denominator is 0. In this case the system responds with Error and Error ID:=dw Tc Hyd Err Cd Illegal Gear Factor. • Currently, the coupling can only be activated if both the master and the slave are at standstill. Otherwise the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Startable. • If the axis is already in an error state, or if it is in the process of carrying out a stop operation, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If the motion algorithm is already indicating an error code, the system responds with Error and Error ID:= the motion algorithm's error code. If these checks could be performed without problem, the coupling is initiated. The axis is now in state Mc State_Synchronizedmotion [} 103], and the function block starts monitoring the coupling. When the velocity required by the coupling is reached for the first time while the slave axis coupling is active, this is indicated at output In Gear. Since the coupling can currently only be activated at standstill, this is the case immediately. If the slave axis is unable to follow the specifications for some reason while the coupling is active, In Gear remains unchanged. If an error code occurs in the motion generator while the coupling is active, the system responds with Error and Error ID:=motion algorithm error code. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the coupling is still active, the existing coupling remains unaffected and active. 64 Version: 1.8.3 TF5810
## Page 65

PLCopen Motion Control The output Active is currently identical to the output Busy. 4.2.8 MC_Gear In Pos_Bk Plc Mc MC_Gear In Pos_Bk Plc Mc Execute BOOL BOOL Start Sync Ratio Numerator INT BOOL In Sync Ratio Denominator INT BOOL Busy Master Sync Position LREAL BOOL Active Slave Sync Position LREAL BOOL Command Aborted Sync Mode INT BOOL Error Master Start Distance LREAL UDINT Error Id Acceleration LREAL Deceleration LREAL Jerk LREAL Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Master Reference To AXIS_REF_Bk Plc Mc ↔ Slave Reference To AXIS_REF_Bk Plc Mc Available from version 3.0.33 The function block starts and monitors an on-the-fly coupling between two axes. To release the coupling, an MC_Gear Out_Bk Plc Mc [} 67] function block should be used. Inputs VAR_INPUT Execute: BOOL; Ratio Numerator: INT; Ratio Denominator: INT; Master Sync Position: LREAL; Slave Sync Position: LREAL; Sync Mode: INT; Master Start Distance: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; //from V3.0.5 Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; END_VAR TF5810 Version: 1.8.3 65
## Page 66

PLCopen Motion Control Name Type Description Execute BOOL A rising edge at this input starts the coupling. Ratio Numerator INT [1, 1] These parameters describe the coupling factor in the form of a gear unit. Ratio Denominator INT [1, 1] These parameters describe the coupling factor in the form of a gear unit. Master Sync Position LREAL [mm] The coupling is fully active from this master position. Slave Sync Position LREAL [mm] The coupling is fully active from this slave position. Sync Mode INT Currently not supported. Master Start Distance LREAL [mm] This is the master distance over which the coupling is established. Acceleration LREAL [mm/s2] The acceleration permitted for the synchronization in actual value units of the axis per square second. Deceleration LREAL [mm/s2] The deceleration permitted for the synchronization in actual value units of the axis per square second. Jerk LREAL [mm/s3] The jerk to be applied. Buffer Mode MC_Buffer Mode_Bk Reserved. This input is provided in preparation for a Plc Mc future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Inputs/outputs VAR_IN_OUT Master: AXIS_REF_Bk Plc Mc; Slave: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Master AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Slave AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Start Sync: BOOL; In Sync: BOOL; Busy: BOOL; Active: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Start Sync BOOL Indicates the transition phase between idle state and fully active coupling. In Sync BOOL This indicates the first successful synchronization of the axes. The signal the remains active, even if the synchronization subsequently fails temporarily or permanently. Busy BOOL Indicates that a command is being processed. Active BOOL Indicates that a command is being processed. Command Aborted BOOL This indicates abortion of the coupling. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. 66 Version: 1.8.3 TF5810
## Page 67

PLCopen Motion Control Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • Next, the system checks whether Ratio Denominator is 0. In this case the system responds with Error and Error ID:=dw Tc Hyd Err Cd Illegal Gear Factor. • If Ratio Denominator is less than 0, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Support. • The coupling can only be activated if the slave is at standstill. Otherwise the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Startable. • If the absolute value of the Master Start Distance is too small, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Cannot Synchronize. • If the actual position of the master is not between Master Sync Position and the end of the synchronization distance specified by Master Start Distance, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Cannot Synchronize. If these checks could be performed without problem, the coupling is initiated. The slave axis initially continues to be in state Mc State_Standstill [} 103]. Only when the master axis reaches the start of the synchronization distance for the first time does the slave axis report Mc State_Synchronizedmotion [} 103] and indicate Start Sync, and the function block starts monitoring the coupling. As soon as the axis reaches the end the synchronization distance for the first time, the slave axis indicates In Sync. Should the master axis later pass the start of the synchronization distance backwards, the coupling is not released. If an error code occurs in the motion generator while the coupling is active, the system responds with Error and Error ID:=motion algorithm error code. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the coupling is still active, the existing coupling remains unaffected and active. An example is available under #103 [} 374]. The function block does not support the functionality of Twin CAT NC. The output Active is currently identical to the output Busy. 4.2.9 MC_Gear Out_Bk Plc Mc MC_Gear Out_Bk Plc Mc Execute BOOL BOOL Busy ↔ Slave Reference To AXIS_REF_Bk Plc Mc BOOL Done BOOL Error UDINT Error Id Available from version 3.0 The function block releases a coupling between two axes. This coupling must have been established with an MC_Gear In_Bk Plc Mc [} 63] or an MC_Gear In Pos_Bk Plc Mc [} 65] function block. Inputs VAR_INPUT Execute: BOOL; END_VAR TF5810 Version: 1.8.3 67
## Page 68

PLCopen Motion Control Name Type Description Execute BOOL A rising edge at this input releases the coupling. Inputs/outputs VAR_IN_OUT Slave: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Slave AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful processing of the movement is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the axis is not operated in a gear coupling, the function block immediately indicates Done and omits all further checks or activities. • If the current set velocity of the axis is smaller than the velocity specified by p St Ax Params.f Creep Speed, the axis immediately assumes Mc State_Standstill and dissipates the residual velocity. Done is indicated, and no further checks or activities take place. If these checks could be performed without problem and Done is not already indicated for one of the reasons mentioned, the motion controlled by the gear coupling is converted to a continuous motion with the same velocity and direction, which is independent of the master. Done is indicated if this conversion was executed successfully, otherwise the system responds with Error and Error ID:=error code. 4.2.10 MC_Home_Bk Plc Mc MC_Home_Bk Plc Mc Execute BOOL BOOL Busy Position LREAL BOOL Done Homing Mode MC_Homing Mode_Bk Plc Mc BOOL Command Aborted Calibration Cam BOOL BOOL Error Buffer Mode MC_Buffer Mode_Bk Plc Mc UDINT Error ID Old Debug Tag UDINT BOOL Active ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 This function block starts and monitors the homing of an axis. 68 Version: 1.8.3 TF5810
## Page 69

PLCopen Motion Control Inputs VAR_INPUT Execute: BOOL; Position: LREAL; Homing Mode: MC_Homing Mode_Bk Plc Mc; Calibration Cam: BOOL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Execute BOOL The homing is initiated by a rising edge at this input. Position LREAL [mm] The reference position. Homing Mode MC_Homing Mode_Bk Plc Mc Specifies the method [} 125] to be used. Calibration Cam BOOL This can be used for direct transfer of the referencing index (cam). Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful processing of the homing is indicated here. Command Aborted BOOL Abortion of homing is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute, the function block examines the transferred axis interface. A number of problems can be detected and reported during this process: • Homing can only be started from a stationary condition without errors. If that is not the case, the function block will react by asserting Error with Error ID:=dw Tc Hyd Err Cd Not Startable or with the error code that is passed to it. • If the axis is already in a fault state, or if it is in the process of carrying out a stop operation, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If one of the velocities stated in the axis parameters is too small (less than 1% of the reference velocity) the function block responds with Error and Error ID:=dw Tc Hyd Err Cd Set Velo. TF5810 Version: 1.8.3 69
## Page 70

PLCopen Motion Control Homing begins if these checks are carried out without problems. The exact sequence is specified by Homing Mode [} 125]. If the movement algorithm reports an error code while homing is being executed, the function block responds with Error and Error ID:=the movement algorithm's error code. If completion of homing is prevented by the activity of another function block, the function block responds with Command Aborted. Successful completion of homing is reported with Done. A falling edge at Execute clears all the pending output signals. If, while homing is still active, Execute is set to FALSE, execution of homing that had started continues unaffected. The signals provided at the end of the movement (Error, Error ID, Command Aborted, Done) are made available for one cycle. Notice f Enc_Default Home Position in p St Ax Params is provided for circumstances in which the application does not itself specify a reference position and a value saved with the machine data is to be loaded for use instead. If different values are required, depending on the situation, use should be made of f Customer Data[] in p St Ax Params. If i Tc Mc_Encoder Sim is set as encoder type, the mode MC_Direct_Bk Plc Mc takes effect, irrespective of Homing Mode and AXIS_REF_Bk Plc Mc [} 86].st Ax Params.n Enc_Homing Type. MC_Default Homing Mode_Bk Plc Mc The referencing method is not specified by the application, but through AXIS_REF_Bk Plc Mc [} 86].st Ax Params.n Enc_Homing Type. The following rules apply: n Enc_Homing Type MC_Homing Mode_Bk Plc Mc i Tc Mc_Homing On Block MC_Block_Bk Plc Mc i Tc Mc_Homing On Index MC_Abs Switch_Bk Plc Mc i Tc Mc_Homing On Sync MC_Ref Pulse_Bk Plc Mc i Tc Mc_Homing On Exec MC_Direct_Bk Plc Mc MC_Abs Switch_Bk Plc Mc The axis is moved with AXIS_REF_Bk Plc Mc [} 86].st Ax Params.f Enc_Ref Index Velo in the direction specified by b Enc_Ref Index Positive. The axis stops if Calibration Cam becomes TRUE or if the reference cam (bit 5, dw Tc Hyd Dc Dw Ref Index) is detected in AXIS_REF_Bk Plc Mc [} 86].st Ax Rt Data.n De Ctrl DWord. The axis is then moved with f Enc_Ref Sync Velo in the direction specified by b Enc_Ref Sync Positive, until the reference cam is exited. The actual value for the axis is set to the value of the reference position. MC_Limit Switch_Bk Plc Mc Not currently supported. MC_Ref Pulse_Bk Plc Mc The axis is moved with AXIS_REF_Bk Plc Mc [} 86].st Ax Params.f Enc_Ref Index Velo in the direction specified by b Enc_Ref Index Positive. The axis stops if Calibration Cam becomes TRUE or if the reference cam (bit 5, dw Tc Hyd Dc Dw Ref Index) is detected in AXIS_REF_Bk Plc Mc [} 86].st Ax Rt Data.n De Ctrl DWord. The axis is then moved with f Enc_Ref Sync Velo in the direction specified by b Enc_Ref Sync Positive, until the reference cam is exited. The encoder's hardware latch is then activated, and the axis is moved on until the latch becomes valid. After the axis has stopped, the actual value for the axis is set to a value that is calculated from the reference position and from the distance covered since the encoder's sync pulse was detected. MC_Direct_Bk Plc Mc The actual value of the axis is immediately set to the value of the reference position. MC_Absolute_Bk Plc Mc Not currently supported. 70 Version: 1.8.3 TF5810
## Page 71

PLCopen Motion Control MC_Block_Bk Plc Mc The axis is moved with AXIS_REF_Bk Plc Mc [} 86].st Ax Params.f Enc_Ref Index Velo in the direction specified by b Enc_Ref Index Positive. If no movement is detected over a period of 2 seconds, the fixed stop (block) is considered to have been reached. The actual value for the axis is set to the value of the reference position. From version 3.0.41 of 12 October 2017 it is possible to change the time period for the function block detection. See ST_Tc Hyd Ax Rt Data [} 141].f Block Detect Delay. MC_Flying Switch_Bk Plc Mc Not currently supported. MC_Flying Ref Pulse_Bk Plc Mc Not currently supported. 4.2.11 MC_Halt_Bk Plc Mc MC_Halt_Bk Plc Mc Execute BOOL BOOL Busy Deceleration LREAL BOOL Done Jerk LREAL BOOL Command Aborted Ramp Time LREAL BOOL Error Buffer Mode MC_Buffer Mode_Bk Plc Mc UDINT Error Id ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Active Available from version 3.0 The function block cancels a current axis motion and monitors the stop operation. The stop operation initiated by this function block can be interrupted by other function blocks. An MC_Stop_Bk Plc Mc function block can be used to prevent the axis from restarting during a stop operation. Inputs VAR_INPUT Execute: BOOL; Deceleration: LREAL; //from V3.0.5 Jerk: LREAL; //from V3.0.5 Ramp Time: LREAL; //from V3.0.5 Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Execute BOOL A rising edge at this input ends a movement being carried out by the axis. Deceleration LREAL [mm/s2] The deceleration to be applied. Jerk LREAL [mm/s3] The jerk to be applied. Ramp Time LREAL [s] The required stopping time. Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) TF5810 Version: 1.8.3 71
## Page 72

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Active: BOOL; Command Aborted: BOOL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful processing of the operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Active BOOL Indicates that a command is being processed. Command Aborted BOOL Indicates that processing of this command was aborted by another command. Behavior of the function block The behavior of the function block is identical to that of the MC_Stop_Bk Plc Mc [} 82]() function block. The only difference is that processing of the command can be aborted by other function blocks. 4.2.12 MC_Imediate Stop_Bk Plc Mc MC_Imediate Stop_Bk Plc Mc Execute BOOL BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Done BOOL Error UDINT Error Id BOOL Active BOOL Command Aborted Available from version 3.0.5 The function block cancels a current axis motion. Inputs VAR_INPUT Execute: BOOL; END_VAR Name Type Description Execute BOOL A rising edge at this input ends a movement being carried out by the axis. 72 Version: 1.8.3 TF5810
## Page 73

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Active: BOOL; Command Aborted: BOOL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful processing of the operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Active BOOL Indicates that a command is being processed. Command Aborted BOOL Indicates that processing of this command was aborted by another command. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • The stop can only be executed if the axis is actively carrying out a movement. If it is stationary, the function block immediately asserts the Done signal. • If the axis is already in an error state, or if it is in the process of carrying out a stop operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If the axis is in a state, in which it is controlled by a coupling with another axis or a comparable mechanism, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. The Stop operation begins if these checks can be carried out without problems. The control value of the axis is immediately set to 0, without any ramp. All outputs of control or regulation voltages are then suppressed, as long as Execute is set to TRUE. 4.2.13 MC_Move Absolute_Bk Plc Mc MC_Move Absolute_Bk Plc Mc Execute BOOL BOOL Busy Position LREAL BOOL Done Velocity LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error ID Jerk LREAL BOOL Active Direction MC_Direction_Bk Plc Mc Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc TF5810 Version: 1.8.3 73
## Page 74

PLCopen Motion Control Available from version 3.0 This function block starts and monitors the movement of an axis. Inputs VAR_INPUT Execute: BOOL; Position: LREAL; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; Direction: MC_Direction_Bk Plc Mc:=MC_Shortest_Way_Bk Plc Mc; //from V3.0.8 Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Execute BOOL The movement is initiated by a rising edge at this input. Position LREAL [mm] The target position of the movement in actual value units of the axis. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Jerk LREAL Reserved [mm/s3] Direction MC_Direction_Bk Plc Mc Reserved. This input was only amended for compatibility reasons and either should not be assigned, or the constant MC_Shortest_Way_Bk Plc Mc should be assigned to it. (from V3.0.8) Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR 74 Version: 1.8.3 TF5810
## Page 75

PLCopen Motion Control Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful processing of the movement is indicated here. Command Aborted BOOL Abortion of the movement is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • The possibility that Position is located behind an active software limit switch is checked next. In this case the system responds with Error and Error ID:=dw Tc Hyd Err Cd Soft End. • Depending on the motion algorithm specified in Axis.p St Ax Params^.n Profile the axis may either only be able to begin the movement initiated here when stationary, or may be able to begin from another movement that has not yet been completed. If it is unable at the present time to accept this new order, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Startable. • If the axis is already in an error state, or if it is in the process of carrying out a stop operation, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Velocity is too small (less than 1% of the reference velocity) the system responds with Error and Error ID:=dw Tc Hyd Err Cd Set Velo. • If Acceleration is too small (the Velocity cannot be reached within 100 seconds) the system responds with Error and Error ID:=dw Tc Hyd Err Cd Acc. • If Deceleration is too small (the Velocity cannot be reduced within 100 seconds) the system responds with Error and Error ID:=dw Tc Hyd Err Cd Acc. • If the motion algorithm is already indicating an error code, the system responds with Error and Error ID:= the motion algorithm's error code. The movement begins if these checks can be carried out without problems. This is done by limiting the parameters Position, Velocity, Acceleration and Deceleration to the maximum permissible values and passing them to the motion algorithm. The axis is now in the Mc State_Discrete Motion [} 103] state, and the function block begins to monitor the movement. If the motion algorithm reports an error code while the movement is being executed, the system responds with Error and Error ID:=the motion algorithm's error code. If completion of the movement is prevented by the activity of another function block, the system responds with Command Aborted. If the motion algorithm achieves the target conditions for the axis, the system responds with Done. A falling edge at Execute clears all the pending output signals. If, while the movement is still active, Execute is set to FALSE, execution of the movement that had started continues unaffected. The signals provided at the end of the movement (Error, Error ID, Command Aborted, Done) are made available for one cycle. 4.2.14 MC_Move Joy Sticked_Bk Plc Mc MC_Move Joy Sticked_Bk Plc Mc Execute BOOL BOOL Busy Joy Stick LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error Id Jerk LREAL BOOL Active ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 This function block starts and monitors the movement of an axis. TF5810 Version: 1.8.3 75
## Page 76

PLCopen Motion Control This function is currently only supported by axes, which are controlled by a function block of type MC_Ax Runtime Ctrl Based_Bk Plc Mc (in preparation: MC_Ax Run Time Time Ramp_Bk Plc Mc). Such a function block is selected by specifying the corresponding constant from E_Tc Mc Profile Type under n Profile Type in ST_Tc Hyd Ax Param. Inputs VAR_INPUT Execute: BOOL; Joy Stick: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; END_VAR Name Type Description Execute BOOL The movement is initiated by a rising edge at this input. Joy Stick LREAL [1] The velocity specified via the control unit, normalized to the range ±1.0. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. Jerk LREAL Reserved [mm/s3] Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Command Aborted BOOL Abortion of the movement is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the axis is already in an error state, or if it is in the process of carrying out a stop operation, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If the motion algorithm is already indicating an error code, the system responds with Error and Error ID:= the motion algorithm's error code. • Next, the system checks whether the generator of the axis supports the required function. If this is not the case, the system responds with is Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. 76 Version: 1.8.3 TF5810
## Page 77

PLCopen Motion Control The movement begins if these checks can be carried out without problems. To this end the motion algorithm is set to state i Tc Hyd State Ext Generated and the axis to state Mc State_Synchronizedmotion. The axis velocity is specified through Joy Stick and ST_Tc Hyd Ax Param [} 130].f Ref Velo. Changes in velocity are accompanied by ramp limitation to ST_Tc Hyd Ax Param [} 130].f Max Acc. If the axis moves towards an active software limit switch, the velocity is limited, depending on the remaining distance, such that the limit switch is approached correctly. A falling edge at Execute offset puts motion algorithm in state i Tc Hyd State Tc Dec P or i Tc Hyd State Tc Dec M and the axis in state Mc State_Standstill. If the axis is in motion at this point in time, it is decelerated with a stop ramp and assumes state i Tc Hyd State Idle. 4.2.15 MC_Move Relative_Bk Plc Mc MC_Move Relative_Bk Plc Mc Execute BOOL BOOL Busy Distance LREAL BOOL Done Velocity LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error ID Jerk LREAL BOOL Active Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 This function block starts and monitors the movement of an axis. Inputs VAR_INPUT Execute: BOOL; Distance: LREAL; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Execute BOOL The movement is initiated by a rising edge at this input. Distance LREAL [mm] The distance to the target position of the movement in actual value units of the axis. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. Jerk LREAL Reserved [mm/s3] Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR TF5810 Version: 1.8.3 77
## Page 78

PLCopen Motion Control Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful processing of the movement is indicated here. Command Aborted BOOL Abortion of the movement is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • The possibility that moving by Distance will lead to a conflict with an active software limit switch is checked next. In this case the system responds with Error and Error ID:=dw Tc Hyd Err Cd Soft End. • Depending on the motion algorithm specified in Axis.p St Ax Params^.n Profile the axis may either only be able to begin the movement initiated here when stationary, or may be able to begin from another movement that has not yet been completed. If it is unable at the present time to accept this new order, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Startable. • If the axis is already in an error state, or if it is in the process of carrying out a stop operation, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Velocity is too small (less than 1% of the reference velocity) the system responds with Error and Error ID:=dw Tc Hyd Err Cd Set Velo. • If Acceleration is too small (the Velocity cannot be reached within 100 seconds) the system responds with Error and Error ID:=dw Tc Hyd Err Cd Acc. • If Deceleration is too small (the Velocity cannot be reduced within 100 seconds) the system responds with Error and Error ID:=dw Tc Hyd Err Cd Acc. • If the motion algorithm is already indicating an error code, the system responds with Error and Error ID:= the motion algorithm's error code. The movement begins if these checks can be carried out without problems. This is done by limiting the parameters Distance, Velocity, Acceleration and Deceleration to the maximum permissible values and passing them to the motion algorithm. The axis is now in the Mc State_Discrete Motion [} 103] state, and the function block begins to monitor the movement. If the motion algorithm reports an error code while the movement is being executed, the system responds with Error and Error ID:=the motion algorithm's error code. If completion of the movement is prevented by the activity of another function block, the system responds with Command Aborted. If the motion algorithm achieves the target conditions for the axis, the system responds with Done. A falling edge at Execute clears all the pending output signals. If, while the movement is still active, Execute is set to FALSE, execution of the movement that had started continues unaffected. The signals provided at the end of the movement (Error, Error ID, Command Aborted, Done) are made available for one cycle. 78 Version: 1.8.3 TF5810
## Page 79

PLCopen Motion Control 4.2.16 MC_Move Velocity_Bk Plc Mc MC_Move Velocity_Bk Plc Mc Execute BOOL BOOL Busy Velocity LREAL BOOL In Velocity Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error Id Direction MC_Direction_Bk Plc Mc BOOL Active Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 This function block starts and monitors the movement of an axis. Inputs VAR_INPUT Execute: BOOL; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Direction: MC_Direction_Bk Plc Mc; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Execute BOOL The movement is initiated by a rising edge at this input. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. Direction MC_Direction_Bk Plc Mc A direction specification coded according to MC_Direction_Bk Plc Mc [} 124]. Buffer Mode MC_Direction_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; In Velocity: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR TF5810 Version: 1.8.3 79
## Page 80

PLCopen Motion Control Name Type Description Busy BOOL Indicates that a command is being processed. In Velocity BOOL This output becomes TRUE when the axis reaches the required velocity for the first time. Command Aborted BOOL Abortion of the movement is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • Depending on the motion algorithm specified in Axis.p St Ax Params^.n Profile the axis may either only be able to begin the movement initiated here when stationary, or may be able to begin from another movement that has not yet been completed. If it is unable at the present time to accept this new order, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Startable. • If the axis is already in an error state, or if it is in the process of carrying out a stop operation, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Velocity is too small (less than 1% of the reference velocity) the system responds with Error and Error ID:=dw Tc Hyd Err Cd Set Velo. • If the motion algorithm is already indicating an error code, the system responds with Error and Error ID:= the motion algorithm's error code. The movement begins if these checks can be carried out without problems. This is done by selecting a value for the target position depending on Direction and the parameters for the software limit switches. This is done by limiting the parameters Velocity, Acceleration and Deceleration to the maximum permissible values and passing them to the motion algorithm. The axis is now in the Mc State_Continousmotion [} 103] state, and the function block begins to monitor the movement. If the motion algorithm reports an error code while the movement is being executed, the system responds with Error and Error ID:=the motion algorithm's error code. If completion of the movement is prevented by the activity of another function block, the system responds with Command Aborted. In Velocity is set when the motion algorithm reaches the required velocity. A falling edge at Execute clears all the pending output signals. If, while the movement is still active, Execute is set to FALSE, execution of the movement that had started continues unaffected. The signals provided at the end of the movement (Error, Error ID, Command Aborted, In Velocity) are made available for one cycle. 4.2.17 MC_Ramped Stop_Bk Plc Mc MC_Ramped Stop_Bk Plc Mc Execute BOOL BOOL Busy Ramp Time LREAL BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error Id BOOL Active BOOL Command Aborted The function block cancels a movement that is currently being executed. Inputs VAR_INPUT Execute: BOOL; Ramp Time: LREAL; //from V3.0.5 END_VAR 80 Version: 1.8.3 TF5810
## Page 81

PLCopen Motion Control Name Type Description Execute BOOL A rising edge at this input ends a movement being carried out by the axis. Ramp Time LREAL [s] The required stopping time. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Active: BOOL; Command Aborted: BOOL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful processing of the operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Active BOOL Indicates that a command is being processed. Command Aborted BOOL Indicates that processing of this command was aborted by another command. Behavior of the function block On a rising edge at Execute, the function block examines the transferred axis interface. A number of problems can be detected and reported during this process: • The stop can only be executed if the axis is actively carrying out a movement. If it is stationary, the function block immediately reports the Done signal. • If the axis is already in an error state, or if it is in the process of carrying out a stop operation, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If the axis is in a state, in which it is controlled by a coupling with another axis or a comparable mechanism, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. The Stop operation begins if these checks can be carried out without problems. Ramp Time is used to calculate a deceleration, taking into account the reference velocity. With this deceleration, the target velocity is reduced to 0 with a pure time ramp. CAUTION No defined end position is driven to and the axis can overrun a software limit switch. TF5810 Version: 1.8.3 81
## Page 82

PLCopen Motion Control 4.2.18 MC_Stop_Bk Plc Mc MC_Stop_Bk Plc Mc Execute BOOL BOOL Busy Deceleration LREAL BOOL Done Jerk LREAL BOOL Error Ramp Time LREAL UDINT Error Id Buffer Mode MC_Buffer Mode_Bk Plc Mc BOOL Active ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Command Aborted Available from version 3.0 The function block cancels a current axis motion and monitors the stop operation. The stop operation initiated by this function block cannot be interrupted by other function blocks. A function block MC_Halt_Bk Plc Mc should be used to enable an axis restart during a stop operation. Inputs VAR_INPUT Execute: BOOL; Deceleration: LREAL; //from V3.0.5 Jerk: LREAL; //from V3.0.5 Ramp Time: LREAL; //from V3.0.5 Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; //from V3.0.8 END_VAR Name Type Description Execute BOOL A rising edge at this input ends a movement being carried out by the axis. Deceleration LREAL [mm/s2] The deceleration to be applied. Jerk LREAL [mm/s3] The jerk to be applied. Ramp Time LREAL [s] The required stopping time. Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Active: BOOL; Command Aborted: BOOL; END_VAR 82 Version: 1.8.3 TF5810
## Page 83

PLCopen Motion Control Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful processing of the operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Active BOOL Indicates that a command is being processed. Command Aborted BOOL Indicates that processing of this command was aborted by another command. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • The stop can only be executed if the axis is actively carrying out a movement. If it is stationary, the function block immediately asserts the Done signal. • If the axis is already in an error state, or if it is in the process of carrying out a stop operation, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If the axis is in a state, in which it is controlled by a coupling with another axis or a comparable mechanism, it responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. The Stop operation begins if these checks can be carried out without problems. Deceleration is used, if this parameter is recognizably greater than 0. Otherwise Ramp Time is used to calculate a deceleration, taking into account the reference velocity. If a jerk-limiting control value generator is selected, Jerk is used if this parameter is recognizably greater than 0. If none of the mentioned parameters is recognizably greater than 0, the axis parameter Max Dec and Max Jerk are used. The next reachable position is determined and used as new target position, taken into account the current set velocity and the currently valid parameters. Once this position has been reached, the axis assumes its regular behavior in idle state. The Ramp Time specifies the time during which the axis is to be decelerated from its reference speed to standstill. If the axis moves with a different velocity, the braking time reduces accordingly. If control value generators with creep mode are used, the corresponding time is added to the braking time. If the motion algorithm reports an error code while the movement is being executed, the system responds with Error and Error ID:=the motion algorithm's error code. If the complete processing is prevented by the activity of another function block, the system responds with Command Aborted. Successful completion of the operation is reported with Done. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the operation is still active, the initiated stop continues unaffected. The signals provided at the end of the movement (Error, Error ID, Done) are made available for one cycle. The output Active is currently identical to the output Busy. TF5810 Version: 1.8.3 83
## Page 84

PLCopen Motion Control 4.2.19 MC_Move Jog_Bk Plc Mc MC_Move Jog_Bk Plc Mc Jog Forward BOOL BOOL Done Jog Backwards BOOL BOOL Busy Mode E_Tc Mc Jog Mode BOOL Command Aborted Position LREAL BOOL Error Velocity LREAL UDINT Error ID Acceleration LREAL Deceleration LREAL Jerk LREAL ↔ Axis Reference To AXIS_REF_Bk Plc Mc This function block starts and monitors the movement of an axis. Inputs VAR_INPUT Jog Forward: BOOL; Jog Backwards: BOOL; Mode: E_Tc Mc Jog Mode; Position: LREAL; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; END_VAR Name Type Description Jog Forward BOOL The command is executed with rising edge and the axis moved in positive direction of travel. Depending on the mode the axis moves as long as the signal remains TRUE or stops automatically after a specified distance. During the motion no further signal edges are accepted (this includes the Jog Backwards input). If signal edges occur simultaneously at the Jog Forward and Jog Backwards inputs, Jog Forward has priority. Jog Backwards BOOL The command is executed with rising edge and the axis moved in negative direction of travel. Jog Forward and Jog Backwards should be triggered alternatively, although they are also mutually locked internally. Mode E_Tc Mc Jog Mode The input defines the E_Tc Mc Jog Mode operation mode in which the manual function is to be executed. Position LREAL [mm] Relative distance for movements in MC_JOGMODE_INCHING operation mode. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Jerk LREAL Reserved [mm/s3] Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR 84 Version: 1.8.3 TF5810
## Page 85

PLCopen Motion Control Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful processing of the movement is indicated here. Command Aborted BOOL Abortion of the movement is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Direction: Reserved. This input was only amended for compatibility reasons and either should not be assigned, or the constant MC_Shortest_Way_Bk Plc Mc should be assigned to it. (from V3.0.8) Buffer Mode: Reserved. This input is provided in preparation for a future build. It should currently either not be assigned or assigned the constant Aborting_Bk Plc Mc. (from V3.0.8) Behavior of the function block On a rising edge at Jog Forward or Jog Backwards a movement is started, depending on the mode [} 165] used. • MC_JOGMODE_STANDARD_SLOW: triggers a MC_Move Velocity_Bk Plc Mc [} 79] on a rising edge and a MC_Stop_Bk Plc Mc [} 82] on a falling edge. • MC_JOGMODE_STANDARD_FAST: triggers a MC_Move Velocity_Bk Plc Mc on a rising edge and a MC_Stop_Bk Plc Mc on a falling edge. • MC_JOGMODE_CONTINOUS: triggers a MC_Move Velocity_Bk Plc Mc on a rising edge and a MC_Stop_Bk Plc Mc on a falling edge. • MC_JOGMODE_INCHING: triggers a MC_Move Relative_Bk Plc Mc [} 77] on a rising edge. The lower-level function blocks check the higher-level axis interface and report the problems at the output Error and Error ID The movement begins if these checks can be carried out without problems. If the motion algorithm reports an error code while the movement is being executed, the system responds with Error and Error ID:=the motion algorithm's error code. If completion of the movement is prevented by the activity of another function block, the system responds with Command Aborted. If the motion algorithm achieves the target conditions for the axis, the system responds with Done. A falling edge at Execute clears all the pending output signals. If, while the movement is still active, Execute is set to FALSE, execution of the movement that had started continues unaffected. The signals provided at the end of the movement (Error, Error ID, Command Aborted, Done) are made available for one cycle. TF5810 Version: 1.8.3 85
## Page 86

PLCopen Motion Control 4.3 Data types 4.3.1 AXIS_REF_Bk Plc Mc Available from version 3.0 The variables in this structure consolidate the subcomponents of the axis. A variable of this type is transferred to most function blocks of the library. This type therefore corresponds to the AXIS_REF data type of PLCopen. Syntax TYPE AXIS_REF_Bk Plc Mc: STRUCT s Axis Name: STRING(83) := 'No Name'; p St Ax Log Buffer: POINTER TO ST_Tc Mc Log Buffer:=0; p St Device Input: POINTER TO ST_Tc Plc Device Input:=0; p St Device Output: POINTER TO ST_Tc Plc Device Output:=0; p St Ax Aux Labels: POINTER TO ST_Tc Mc Aux Data Labels:=0; p St Ax Auto Params: POINTER TO ST_Tc Mc Auto Ident:=0; p St Ax Command Buf: POINTER TO ST_Tc Plc Cmd Buffer_Bk Plc Mc:=0; n Active Request: UDINT := 0; n Next Request: UDINT := 1; b Params Enable: BOOL:=FALSE; n State: E_Tc MCFb State:=Mc State_Standstill; n Init State: INT:=0; n Init Error: DINT:=0; n Interface Type: UINT := 16#FFFF; n Device In Type: UINT := 16#FFFF; n Device Out Type: UINT := 16#FFFF; n Rt Data Type: UINT := 16#FFFF; n Param Type: UINT := 16#FFFF; n Log Buffer Type: UINT := 16#FFFF; n Ax Auto Ident Type: UINT := 16#FFFF; n Cmd Buffer Type: UINT := 16#FFFF; n Log Level: DINT := 0; n Debug Tag: UDINT := 16#00000000; st Ax Params: ST_Tc Hyd Ax Param; st Ax Rt Data: ST_Tc Hyd Ax Rt Data; END_STRUCT END_TYPE 86 Version: 1.8.3 TF5810
## Page 87

PLCopen Motion Control Parameter TF5810 Version: 1.8.3 87
## Page 88

PLCopen Motion Control Name Type Description s Axis Name STRING The text name of the axes. p St Ax Log Buffer POINTER TO The address of a variable of type ST_Tc Mc Log Buffer ST_Tc Mc Log Buffer [} 156]. This variable contains the Log Buffer of the library. p St Device Input POINTER TO The address of a variable of type ST_Tc Plc Device Input ST_Tc Plc Device Input [} 149]. This variable contains all input interfaces of the axis. p St Device Output POINTER TO The address of a variable of type ST_Tc Plc Device Output ST_Tc Plc Device Output [} 153]. This variable contains all output interfaces of the axis. p St Ax Aux Labels POINTER TO The address a variable of type ST_Tc Mc Aux Data Labels ST_Tc Mc Aux Data Labels [} 149]. This variable optionally contains the application parameter IDs in ST_Tc Hyd Ax Param:f Customer Data[..]. p St Ax Auto Params POINTER TO The address a variable of type ST_Tc Mc Auto Ident ST_Tc Mc Auto Ident [} 128]. This variable optionally contains the parameters for an MC_Ax Uti Auto Ident_Bk Plc Mc function block. p St Ax Command Buf POINTER TO From V3.0.8 the input Buffer Mode defined by the ST_Tc Plc Cmd Buffer_Bk PLCopen is available for various function blocks. The Plc Mc functionality that can be controlled with this is currently in preparation. In this context this command buffer was amended. n Active Request UDINT Every function block sets a code here that starts a function on this axis. After this, the function block monitors this variable to see if it is changed by another function block that is taking over control through another function. In this way any function block can tell whether a function that it has started has been interrupted by another function block, and can generate appropriate signals. n Next Request UDINT Reserved. Used for generating new values for n Active Request. b Params Enable BOOL This variable is only TRUE if the parameters have been placed into a valid state by being loaded from the file. Saving the parameters will also assert this signal, because this also ensures consistency between the data in the parameter structure and in the file. The axis is not ready to operate while this variable is not TRUE. At runtime, write accesses to the parameter structure temporarily set this variable to FALSE, after which it is returned to its previous state. n State E_Tc MCFb State The current state of the axis is stored here, encoded in accordance with E_Tc MCFb State [} 103]. n Init State INT The current state of the initialization. n Init Error DINT Any error code detected during initialization. n Interface Type UINT The type code of the currently valid AXIS_REF_Bk Plc Mc variable type. n Device In Type UINT The type code of the currently valid ST_Tc Plc Device Input [} 149] variable type. n Device Out Type UINT The type code of the currently valid ST_Tc Plc Device Output [} 153] variable type. n Rt Data Type UINT The type code of the currently valid ST_Tc Hyd Ax Rt Data [} 141] variable type. 88 Version: 1.8.3 TF5810
## Page 89

PLCopen Motion Control Name Type Description n Param Type UINT The type code of the currently valid ST_Tc Hyd Ax Param [} 130] variable type. n Log Buffer Type UINT The type code of the currently valid ST_Tc Mc Log Buffer [} 156] variable type. n Ax Auto Ident Type UINT The type code of the currently valid ST_Tc Mc Auto Ident [} 128] variable type. n Cmd Buffer Type UINT reserved. The type code of the currently valid command buffer variable type. n Log Level DINT The Message Level [} 347], from which entries in the logging buffer are to be made. n Debug Tag UDINT Many library blocks enter a debug ID here for the duration of their execution. st Ax Params ST_Tc Hyd Ax Param This variable of type ST_Tc Hyd Ax Param [} 130] contains the axis parameters. st Ax Rt Data ST_Tc Hyd Ax Rt Data This variable of type ST_Tc Hyd Ax Rt Data [} 141] contains the runtime data of the axis. In order to make the data structures of the library independent of the CPU architecture (I86, Strong ARM), it is necessary to change the order of data or insert placeholders in some places. These placeholders contain a name in the form "b Align_1"; the number has no purpose. Neither existence, name, type or dimensioning are guaranteed. 4.3.2 E_Tc Plc Buffered Cmd Type_Bk Plc Mc The constants in this list are used to identify buffered axis commands. See MC_Buffer Mode_Bk Plc Mc [} 121]. Syntax TYPE E_Tc Plc Buffered Cmd Type_Bk Plc Mc : ( (* last modification: xx.xx.2009 *) i Buffered Cmd_No Operation, i Buffered Cmd_Move Absolute, i Buffered Cmd_Move Relative, i Buffered Cmd_Move Velocity, (**) i Buffered Cmd_Stop, i Buffered Cmd_Reset And Stop, i Buffered Cmd_Halt, i Buffered Cmd_Cam In, i Buffered Cmd_Gear In, i Buffered Cmd_Power, i Buffered Cmd_Home, i Buffered Cmd_Step Abs Switch, i Buffered Cmd_Step Limit Switch, i Buffered Cmd_Step Block, i Buffered Cmd_Step Direct, i Buffered Cmd_Finish Homing, (**) i Buffered Cmd Ex_Jerk:=100, i Buffered Cmd Ex_Acc, i Buffered Cmd Ex_Velo, i Buffered Cmd Ex_Creep, (**) i Buffered Cmd_ ); END_TYPE TF5810 Version: 1.8.3 89
## Page 90

PLCopen Motion Control Values Name Description i Buffered Cmd_No Operation This constant is used as initial value for call parameters of function blocks and in variables. i Buffered Cmd_Move Absolute The buffered command was entered by an MC_Move Absolute_Bk Plc Mc function block. See note #1. i Buffered Cmd_Move Relative The buffered command was entered by an MC_Move Relative_Bk Plc Mc function block. See note #1. i Buffered Cmd_Move Velocity The buffered command was entered by an MC_Move Velocity_Bk Plc Mc function block. See note #1. i Buffered Cmd_Stop reserved, not implemented. i Buffered Cmd_Reset And Stop reserved, not implemented. i Buffered Cmd_Halt reserved, not implemented. i Buffered Cmd_Cam In reserved, not implemented. i Buffered Cmd_Gear In reserved, not implemented. i Buffered Cmd_Power reserved, not implemented. i Buffered Cmd_Home reserved, not implemented. i Buffered Cmd_Step Abs Switch reserved, not implemented. i Buffered Cmd_Step Limit Switch reserved, not implemented. i Buffered Cmd_Step Block reserved, not implemented. i Buffered Cmd_Step Direct reserved, not implemented. i Buffered Cmd_Finish Homing reserved, not implemented. i Buffered Cmd Ex_Jerk The command component associated with constant-jerk motion was entered by a function block. See note #2. i Buffered Cmd Ex_Acc The command component associated with constant acceleration or deceleration was entered by a function block. See note #2. i Buffered Cmd Ex_Velo The command component associated with constant-velocity motion was entered by a function block. See note #2. i Buffered Cmd Ex_Creep reserved, not implemented. #1: If the axis uses a setpoint generator type without Look Ahead, complete commands are entered as a buffer element. #2: If the axis uses a setpoint generator type with Look Ahead, commands are split into sections and entered as a package typically consisting of seven buffer elements (jerk, acceleration, jerk, velocity, jerk, deceleration, jerk). 4.3.3 E_Tc Mc Current Step Available from version 3.0 The constants in this list are used for identifying the internal states of the control value generators. Not all of these states are used by all control value generators. Syntax TYPE E_Tc Mc Current Step :( i Tc Hyd State Idle, i Tc Hyd State Tc Acc P, 90 Version: 1.8.3 TF5810
## Page 91

PLCopen Motion Control i Tc Hyd State Tc Acc M, i Tc Hyd State Pc Acc P, i Tc Hyd State Pc Acc M, i Tc Hyd State Const Velo P, i Tc Hyd State Const Velo M, i Tc Hyd State Pc Dec P, i Tc Hyd State Pc Dec M, i Tc Hyd State Creep Velo P, i Tc Hyd State Creep Velo M, i Tc Hyd State Tc Dec P, i Tc Hyd State Tc Dec M, i Tc Hyd State Feed Stop Pos, i Tc Hyd State Feed Stop Neg, i Tc Hyd State Do Brake, i Tc Hyd State Coupling := 1000, i Tc Hyd State Coupled, i Tc Hyd State Ext Coupled, i Tc Hyd State Ext Generated := 2000, i Tc Hyd State Emergency Break := 9000, i Tc Hyd State Fault := 9999 ); END_TYPE TF5810 Version: 1.8.3 91
## Page 92

PLCopen Motion Control Values 92 Version: 1.8.3 TF5810
## Page 93

PLCopen Motion Control Name Description i Tc Hyd State Idle The axis is not actively moving. Its behavior is controlled by ST_Tc Hyd Ax Param.f Lag Amp, ST_Tc Hyd Ax Param.f Target Clamping and ST_Tc Hyd Ax Param.f Repos Distance. i Tc Hyd State Tc Acc P The axis establishes a positive control value according to ST_Tc Hyd Ax Rt Data.f Dest Acc. This value is set by one of the start function blocks according to the data of the travel command. This state is assumed when the control value reaches the specified motion control value. If the system detects that the braking process for the target approach has to be initiated, the state is changed to i Tc Hyd State Pc Dec P. In the absence of feed enable, the state is changed to i Tc Hyd State Feed Stop Pos. i Tc Hyd State Tc Acc M The axis establishes a negative control value according to ST_Tc Hyd Ax Rt Data.f Dest Acc. This value is set by one of the start function blocks according to the data of the travel command. This state is assumed when the control value reaches the specified motion control value. If the system detects that the braking process for the target approach has to be initiated, the state is changed to i Tc Hyd State Pc Dec M. In the absence of feed enable, the state is changed to i Tc Hyd State Feed Stop Neg. i Tc Hyd State Pc Acc P The axis is in the displacement-controlled acceleration phase of a travelling motion in positive direction. The control value is set to a value specified by the travel command according to ST_Tc Hyd Ax Rt Data.f Dest Acc. The state then changes to i Tc Hyd State Const Velo P. i Tc Hyd State Pc Acc M The axis is in the displacement-controlled acceleration phase of a travelling motion in negative direction. The control value is set to a value specified by the travel command according to ST_Tc Hyd Ax Rt Data.f Dest Acc. The state then changes to i Tc Hyd State Const Velo M. i Tc Hyd State Const Velo P The axis travels in positive direction with constant control value. The control value is specified by the travel command. i Tc Hyd State Const Velo M The axis travels in negative direction with constant control value. The control value is specified by the travel command. i Tc Hyd State Pc Dec P The axis is in the displacement-controlled brake phase of a travelling motion in positive direction. The control value is reduced to ST_Tc Hyd Ax Param.f Creep Speed. The state then changes to i Tc Hyd State Creep Velo P. i Tc Hyd State Pc Dec M The axis is in the displacement-controlled brake phase of a travelling motion in negative direction. The control value is reduced to ST_Tc Hyd Ax Param.f Creep Speed. The state then changes to i Tc Hyd State Creep Velo M. i Tc Hyd State Creep Velo P The axis travels in positive direction with constant control value. The control value is specified by ST_Tc Hyd Ax Param.f Creep Speed. i Tc Hyd State Creep Velo M The axis travels in negative direction with constant control value. The control value is specified by ST_Tc Hyd Ax Param.f Creep Speed. i Tc Hyd State Tc Dec P The axis executes a regular stop, starting from a travelling motion in positive direction. The control value is reduced with ST_Tc Hyd Ax Param.f Stop Ramp. The state then changes to i Tc Hyd State Idle. i Tc Hyd State Tc Dec M The axis executes a regular stop, starting from a travelling motion in negative direction. The control value is reduced with ST_Tc Hyd Ax Param.f Stop Ramp. The state then changes to i Tc Hyd State Idle. i Tc Hyd State Feed Stop Pos The axis executes an intermediate stop, due to lack of feed enable in positive direction (dw Tc Hyd Dc Dw Fd Pos Ena is not set in ST_Tc Hyd Ax Rt Data.n De Ctrl DWord). The control value is reduced with ST_Tc Hyd Ax Param.f Stop Ramp. The axis then waits for a feed enable. TF5810 Version: 1.8.3 93
## Page 94

PLCopen Motion Control Name Description i Tc Hyd State Feed Stop Neg The axis executes an intermediate stop, due to lack of feed enable in negative direction (dw Tc Hyd Dc Dw Fd Neg Ena is not set in ST_Tc Hyd Ax Rt Data.n De Ctrl DWord). The control value is reduced with ST_Tc Hyd Ax Param.f Stop Ramp. The axis then waits for a feed enable. i Tc Hyd State Do Brake The axis executes a waiting time. This is necessary, if switching is required due to a brake or a switching valve. i Tc Hyd State Coupling The axis is in transition to state i Tc Hyd State Coupled. i Tc Hyd State Coupled The control value of the axis is derived from the control value of another axis based on the principle of electronic gearing. i Tc Hyd State Ext Coupled The control value of the axis is calculated based on the principle of continuously variable transmission. i Tc Hyd State Ext Generated The control value of the axis is generated by an external function block. This may be a library function block or an application-specific function block. i Tc Hyd State Emergency Break The axis performs an emergency stop. The control value is reduced with ST_Tc Hyd Ax Param.f Emergency Ramp. The system then checks whether the axis is in an error state (ST_Tc Hyd Ax Rt Data.n Error Code not equal 0). If yes, the state is changed to i Tc Hyd State Fault, otherwise i Tc Hyd State Idle. i Tc Hyd State Fault The axis is in an error state. It does not carry out actively control movements and does not accept motion commands. To put the axis back in an undisturbed state, call a function block of type MC_Reset_Bk Plc Mc or MC_Reset And Stop_Bk Plc Mc. 4.3.4 E_Tc Mc Drive Type Available from version 3.0 The constants listed here are used to identify the hardware used to output the control values for an axis. Syntax TYPE E_Tc Mc Drive Type :( (* The sequence below must not be changed! New types have to be added at the end. In case a type becomes obsolete it has to be replaced by a dummy to ensure the numerical meaning of the other codes. *) (* Die bestehende Reihenfolge darf nicht veraendert werden. Neue Typen muessen am Ende eingefuegt werden. Wenn ein Typ wegfallen sollte, muss er durch einen Dummy ersetzt werden, um die numerische Zuordnung zu garantieren. *) (* last modification: 26.02.2016 *) i Tc Mc_Drive_Customized, i Tc Mc_Drive Low Cost Stepper, i Tc Mc_Drive KL2521, i Tc Mc_Drive KL4032, i Tc Mc_Drive Ax2000_B900R, i Tc Mc_Drive M2400_D1, i Tc Mc_Drive M2400_D2, i Tc Mc_Drive M2400_D3, i Tc Mc_Drive M2400_D4, i Tc Mc_Drive Low Cost Stepper HS, i Tc Mc_Drive Low Cost Stepper FS, i Tc Mc_Drive Ix2512_1Coil, i Tc Mc_Drive Ix2512_2Coil, i Tc Mc_Drive KL2531, i Tc Mc_Drive KL2541, i Tc Mc_Drive EL4132, i Tc Mc_Drive Ax2000_B200R, 94 Version: 1.8.3 TF5810
## Page 95

PLCopen Motion Control i Tc Mc_Drive Ax2000_B110R, i Tc Mc_Drive KL2532, i Tc Mc_Drive KL2552, i Tc Mc_Drive KL2535_1Coil, i Tc Mc_Drive KL2535_2Coil, i Tc Mc_Drive KL2545_1Coil, i Tc Mc_Drive KL2545_2Coil, i Tc Mc_Drive Low Cost Inverter, i Tc Mc_Drive_Co E_DS408, i Tc Mc_Drive Ax2000_B110A, i Tc Mc_Drive Ax5000_B110A, i Tc Mc_Drive Ax2000_B750A, i Tc Mc_Drive_Co E_DS402, i Tc Mc_Drive Ax5000_B110SR, i Tc Mc_Drive EL4x22, i Tc Mc_Drive EL2521, i Tc Mc_Drive Pump Etc IO, i Tc Mc_Drive EL2535_1Coil, i Tc Mc_Drive EL2535_2Coil, i Tc Mc_Drive EL7201, i Tc Mc_Drive EL7037, i Tc Mc_Drive EL7047, i Tc Mc_Drive EM8908, i Tc Mc_Drive Ax5000_B110INC, i Tc Mc_Drive_Test Only:=1000 ); END_TYPE TF5810 Version: 1.8.3 95
## Page 96

PLCopen Motion Control Values 96 Version: 1.8.3 TF5810
## Page 97

PLCopen Motion Control Name Description i Tc Mc_Drive_Customized i Tc Mc_Drive_Customized: The control value for the drive has not been prepared for output on any particular hardware. This process must be carried out by the PLC application itself. i Tc Mc_Drive Low Cost Stepper i Tc Mc_Drive Low Cost Stepper: The incremental set position changes are generated as a digital output signals for a directly controlled stepper motor. This code continues to be supported for reasons of compatibility, and has the same meaning as i Tc Mc_Drive Low Cost Stepper HS. i Tc Mc_Drive KL2521 i Tc Mc_Drive KL2521: The control value for the drive has been appropriately processed for output on a KL2521 Pulse Train terminal. i Tc Mc_Drive KL4032 i Tc Mc_Drive KL4032: The control value for the drive has been appropriately processed for output on a ±10 V KL4032 analog output terminal. i Tc Mc_Drive Ax2000_B900R i Tc Mc_Drive Ax2000_B900R: The control value for the drive is processed for output on an AX2000 servo drive at a resolver motor at the Beckhoff Real Time Ethernet fieldbus. i Tc Mc_Drive M2400_D1 i Tc Mc_Drive M2400_D1: The control value for the drive has been appropriately processed for output on the first channel of an M2400 Box on the Beckhoff II/O. i Tc Mc_Drive M2400_D2 i Tc Mc_Drive M2400_D2: The control value for the drive has been appropriately processed for output on the second channel of an M2400 Box on the Beckhoff II/O. i Tc Mc_Drive M2400_D3 i Tc Mc_Drive M2400_D3: The control value for the drive has been appropriately processed for output on the third channel of an M2400 Box on the Beckhoff II/O. i Tc Mc_Drive M2400_D4 i Tc Mc_Drive M2400_D4: The control value for the drive has been appropriately processed for output on the fourth channel of an M2400 Box on the Beckhoff II/O. i Tc Mc_Drive Low Cost Stepper HS i Tc Mc_Drive Low Cost Stepper HS: The incremental set position changes are generated as a digital output signals for a directly controlled stepper motor. Half-stepping is being used. i Tc Mc_Drive Low Cost Stepper FS i Tc Mc_Drive Low Cost Stepper FS: The incremental set position changes are generated as a digital output signals for a directly controlled stepper motor. Full-stepping is being used. i Tc Mc_Drive Ix2512_1Coil i Tc Mc_Drive Ix2512_1Coil: The control value for the drive is processed for output on a Fieldbus Box IP/IE2512. The rules for valves with one coil apply. i Tc Mc_Drive Ix2512_2Coil i Tc Mc_Drive Ix2512_2Coil: The control value for the drive is processed for output on a Fieldbus Box IP/IE2512. The rules for valves with two coils apply. i Tc Mc_Drive KL2531 i Tc Mc_Drive KL2531: The control value for the drive is processed for output on a KL2531 stepper motor output stage terminal. i Tc Mc_Drive KL2541 i Tc Mc_Drive KL2541: The control value for the drive is processed for output on a KL2541 stepper motor output stage terminal. i Tc Mc_Drive EL4132 i Tc Mc_Drive EL4132: The control value for the drive has been appropriately processed for output on a ±10 V EL4132 analog output terminal. i Tc Mc_Drive Ax2000_B200R i Tc Mc_Drive Ax2000_B200R: The control value for the drive is processed for output on an AX2000 servo drive at a resolver motor at the Beckhoff II/O fieldbus. i Tc Mc_Drive Ax2000_B110R i Tc Mc_Drive Ax2000_B110R: The control value for the drive is processed for output on an AX2000 servo drive at a resolver motor at the Ether CAT fieldbus. i Tc Mc_Drive KL2532 i Tc Mc_Drive KL2532: The control value for the drive is processed for output on a KL2532 DC motor output stage terminal. TF5810 Version: 1.8.3 97
## Page 98

PLCopen Motion Control Name Description i Tc Mc_Drive KL2552 i Tc Mc_Drive KL2535_1Coil i Tc Mc_Drive KL2535_1Coil: The control value for the drive is processed for output on a KL2535 PMW output stage terminal. i Tc Mc_Drive KL2535_2Coil i Tc Mc_Drive KL2535_2Coil: The control value for the drive is processed for output on a KL2535 PMW output stage terminal. i Tc Mc_Drive KL2545_1Coil i Tc Mc_Drive KL2545_1Coil: The control value for the drive is processed for output on a KL2545 PMW output stage terminal. i Tc Mc_Drive KL2545_2Coil i Tc Mc_Drive KL2545_2Coil: The control value for the drive is processed for output on a KL2545 PMW output stage terminal. i Tc Mc_Drive Low Cost Inverter i Tc Mc_Drive Low Cost Inverter: The control value for the drive is processed for output in the form of digital output signals for a frequency converter with programmed fixed frequencies. i Tc Mc_Drive_Co E_DS408 i Tc Mc_Drive_Co E_DS408: The control value for the drive is processed for output on a proportional valve at the Ether CAT fieldbus. i Tc Mc_Drive Ax2000_B110A i Tc Mc_Drive Ax2000_B110A: The control value for the drive is processed for output on an AX2000 servo drive at an absolute multi- turn encoder motor at the Ether CAT fieldbus. i Tc Mc_Drive Ax5000_B110A i Tc Mc_Drive Ax5000_B110A: The control value for the drive is processed for output on an AX5000 servo drive at an absolute multi- turn encoder motor at the Ether CAT fieldbus. i Tc Mc_Drive Ax2000_B750A i Tc Mc_Drive Ax2000_B750A: The control value for the drive is processed for output on an AX2000 servo drive at an absolute multi- turn encoder motor at the Sercos fieldbus. i Tc Mc_Drive_Co E_DS402 i Tc Mc_Drive_Co E_DS402: In preparation. i Tc Mc_Drive Ax5000_B110SR i Tc Mc_Drive Ax5000_B110SR: The control value for the drive is processed for output on an AX5000 servo drive at an absolute single-turn encoder or resolver motor at the Ether CAT fieldbus. i Tc Mc_Drive EL4x22 i Tc Mc_Drive EL4x22: In preparation. i Tc Mc_Drive EL2521 i Tc Mc_Drive EL2521: The control value for the drive has been appropriately processed for output on a KL2521 Pulse Train terminal. i Tc Mc_Drive Pump Etc IO i Tc Mc_Drive Pump Etc IO: Reserved i Tc Mc_Drive EL2535_1Coil i Tc Mc_Drive EL2535_1Coil: The control value for the drive is processed for output on an EL2535 PMW output stage terminal. i Tc Mc_Drive EL2535_2Coil i Tc Mc_Drive EL2535_2Coil: The control value for the drive is processed for output on an EL2535 PMW output stage terminal. i Tc Mc_Drive EL7201 i Tc Mc_Drive EL7201: The control value for the drive has been appropriately processed for output on a EL7201 servo terminal. i Tc Mc_Drive EL7037 i Tc Mc_Drive EL7037: The control value for the drive is processed for output on an EL7037 stepper motor output stage terminal. i Tc Mc_Drive EL7047 i Tc Mc_Drive EL7047: The control value for the drive is processed for output on an EL7047 stepper motor output stage terminal. i Tc Mc_Drive EM8908 i Tc Mc_Drive EM8908: Reserved for sector-specific package. i Tc Mc_Drive Ax5000_B110INC i Tc Mc_Drive Ax5000_B110INC: The control value for the drive is processed for output on an AX5000 servo drive at an incremental encoder at the Ether CAT fieldbus. i Tc Mc_Drive_Test Only i Tc Mc_Drive_Test Only: Reserved for internal testing; do not use. 4.3.5 E_Tc Mc Encoder Type Available from version 3.0 98 Version: 1.8.3 TF5810
## Page 99

PLCopen Motion Control The constants listed here are used to identify the hardware used to acquire the actual values for an axis. Syntax TYPE E_Tc Mc Encoder Type :( (* The sequence below must not be changed! New types have to be added at the end. In case a type becomes obsolete it has to be replaced by a dummy to ensure the numerical meaning of the other codes. *) (* Die bestehende Reihenfolge darf nicht veraendert werden. Neue Typen muessen am Ende eingefuegt werden. Wenn ein Typ wegfallen sollte, muss er durch einen Dummy ersetzt werden, um die numerische Zuordnung zu garantieren. *) (* last modification: 17.01.2013 *) i Tc Mc_Encoder Sim, i Tc Mc_Encoder Dig Increment, i Tc Mc_Encoder Low Cost Stepper, i Tc Mc_Encoder KL2521, i Tc Mc_Encoder KL3042, i Tc Mc_Encoder KL5001, i Tc Mc_Encoder KL5101, i Tc Mc_Encoder Ax2000_B900R, i Tc Mc_Encoder Dig Cam, i Tc Mc_Encoder Ix5009, i Tc Mc_Encoder M2510, i Tc Mc_Encoder KL3002, i Tc Mc_Encoder KL2531, i Tc Mc_Encoder KL5111, i Tc Mc_Encoder Abs32, i Tc Mc_Encoder M3120, i Tc Mc_Encoder KL2541, i Tc Mc_Encoder EL3102, i Tc Mc_Encoder EL3142, i Tc Mc_Encoder EL5001, i Tc Mc_Encoder EL5101, i Tc Mc_Encoder EL5111, i Tc Mc_Encoder KL3062, i Tc Mc_Encoder KL3162, i Tc Mc_Encoder Ax2000_B200R, i Tc Mc_Encoder Ax2000_B110R, i Tc Mc_Encoder EL3162, i Tc Mc_Encoder KL2542, i Tc Mc_Encoder KL2545, i Tc Mc_Encoder Ax2000_B110A, i Tc Mc_Encoder Ax5000_B110A, i Tc Mc_Encoder Ax2000_B750A, i Tc Mc_Encoder Co E_DS406, i Tc Mc_Encoder Co E_DS402SR, i Tc Mc_Encoder Ax5000_B110SR, i Tc Mc_Encoder Co E_DS402A, i Tc Mc_Encoder EL2521, i Tc Mc_Encoder Abs32Etc, i Tc Mc_Encoder EL7201SR, i Tc Mc_Encoder Dig Pulse Count, i Tc Mc_Encoder EL3255, i Tc Mc_Encoder EL7047, i Tc Mc_Drive EM8908A, i Tc Mc_Drive EM8908C, i Tc Mc_Encoder Co E5001, i Tc Mc_Encoder EL7201A, i Tc Mc_Drive Ax5000_B110INC, i Tc Mc_Encoder EL5032, i Tc Mc_Encoder EL5021, i Tc Mc_Encoder_Test Only:=1000 ); END_TYPE TF5810 Version: 1.8.3 99
## Page 100

PLCopen Motion Control Values 100 Version: 1.8.3 TF5810
## Page 101

PLCopen Motion Control Name Description i Tc Mc_Encoder Sim The virtual actual position of the axis is a copy of the set position. On a real machine this type must only be used for virtual axes. Otherwise the axis will carry out uncontrolled and unpredictable movements. i Tc Mc_Encoder Dig Increment The incremental actual value of the axis is generated by evaluating two digital input bits. These represent the A and B tracks of an incremental encoder, and are evaluated, in accordance with the principle of a quadrature decoder, using quadruple evaluation. Only one of the input bits may change its state in each PLC cycle. This means that the maximum velocity is one increment per TCycle. i Tc Mc_Encoder Low Cost Stepper Incremental changes to the actual position are generated from the output signals for a digitally operated stepper motor. i Tc Mc_Encoder KL2521 The incremental actual position is generated from the pulse counter of a KL2521 Pulse Train terminal. i Tc Mc_Encoder KL3042 The absolute actual position is generated from the ADW value of a 0..20 m A KL3042 analog input terminal. i Tc Mc_Encoder KL5001 The absolute actual position is generated from the counter value from a KL5001 SSI input terminal. i Tc Mc_Encoder KL5101 The incremental actual position is generated from the counter value from a KL5101 input terminal. i Tc Mc_Encoder Ax2000_B900R The incremental actual position is determined from the counter value of an AX2000 servo drive at a resolver motor at the Beckhoff Real Time Ethernet fieldbus. i Tc Mc_Encoder Dig Cam The position cam byte is generated from four digital input bits. i Tc Mc_Encoder Ix5009 The absolute actual position is generated from the counter value of an SSI IP/IE5009 Fieldbus Box. i Tc Mc_Encoder M2510 The absolute actual position is generated from the ADW value of a ±10 V M2510 analog input box. i Tc Mc_Encoder KL3002 The absolute actual position is generated from the ADW value of a ±10 V KL3002 analog input terminal. i Tc Mc_Encoder KL2531 The incremental actual position is generated from the pulse counter of a KL2531 stepper motor terminal. i Tc Mc_Encoder KL5111 The incremental actual position is generated from the counter value from a KL5111 input terminal. i Tc Mc_Encoder Abs32 The absolute actual position is generated from the 32-bit value of a general electronic input system. i Tc Mc_Encoder M3120 The incremental actual position is generated from the counter value of an M3120 Lightbus module. i Tc Mc_Encoder KL2541 The incremental actual position is generated from the pulse counter (motor pulse or encoder) of a KL2541 stepper motor terminal. i Tc Mc_Encoder EL3102 The absolute actual position is generated from the ADW value of a ±10 V EL3102 analog input terminal. i Tc Mc_Encoder EL3142 The absolute actual position is generated from the ADW value of a 0..20 m A EL3142 analog input terminal. i Tc Mc_Encoder EL5001 The absolute actual position is generated from the counter value from an EL5001 SSI input terminal. i Tc Mc_Encoder EL5101 The incremental actual position is generated from the counter value from an EL5101 input terminal. i Tc Mc_Encoder EL5111 The incremental actual position is generated from the counter value from an EL5111 input terminal. i Tc Mc_Encoder KL3062 The absolute actual position is generated from the ADW value of a 0..10 V KL3062 analog input terminal. TF5810 Version: 1.8.3 101
## Page 102

PLCopen Motion Control Name Description i Tc Mc_Encoder KL3162 The absolute actual position is generated from the ADW value of a 0..10 V KL3162 analog input terminal. i Tc Mc_Encoder Ax2000_B200R The incremental actual position is determined from the counter value of an AX2000 actuator at a resolver motor at the Beckhoff II/ O fieldbus. i Tc Mc_Encoder Ax2000_B110R The incremental actual position is determined from the counter value of an AX2000 actuator at a resolver motor at the Ether CAT fieldbus. i Tc Mc_Encoder EL3162 The absolute actual position is generated from the ADW value of a 0..10 V EL3162 analog input terminal. i Tc Mc_Encoder KL2542 The incremental actual position is generated from the counter value from a KL2542 input terminal. i Tc Mc_Encoder KL2545 The incremental actual position is generated from the counter value from a KL2545 input terminal. i Tc Mc_Encoder Ax2000_B110A The absolute actual position is determined from the counter value of an AX2000 actuator at an absolute multi-turn encoder motor at the Ether CAT fieldbus. i Tc Mc_Encoder Ax5000_B110A The absolute actual position is determined from the counter value of an AX5000 actuator at an absolute multi-turn encoder motor at the Ether CAT fieldbus. i Tc Mc_Encoder Ax2000_B750A The absolute actual position is determined from the counter value of an AX2000 actuator at an absolute multi-turn encoder motor at the Sercos fieldbus. i Tc Mc_Encoder Co E_DS406 An encoder with Co E_406 support at the Ether CAT fieldbus. i Tc Mc_Encoder Co E_DS402SR In preparation. i Tc Mc_Encoder Ax5000_B110SR The incremental actual position is determined from the counter value of an AX5000 actuator at a single turn encoder motor at the Ether CAT fieldbus. i Tc Mc_Encoder Co E_DS402A In preparation. i Tc Mc_Encoder EL2521 The incremental actual position is generated from the pulse counter of an EL2521 Pulse Train terminal. i Tc Mc_Encoder Abs32Etc The absolute actual position is generated from the 32-bit value of a general Ether CAT electronic input system. Profile support is not a precondition. i Tc Mc_Encoder EL7201SR The incremental actual position is generated from the counter value from an EL7201 servo terminal. i Tc Mc_Encoder Dig Pulse Count Counts the edges (positive and negative) of pulses. The direction of rotation is determined via the drive output. Only one pulse can be detected per PLC cycle. i Tc Mc_Encoder EL3255 i Tc Mc_Encoder EL3255: In preparation. i Tc Mc_Encoder EL7047 i Tc Mc_Drive EM8908A i Tc Mc_Drive EM8908C i Tc Mc_Encoder Co E5001 i Tc Mc_Encoder EL7201A i Tc Mc_Drive Ax5000_B110INC The incremental actual position is determined from the counter value of an AX5000 actuator at an incremental encoder at the Ether CAT fieldbus. i Tc Mc_Encoder EL5032 The absolute actual position is generated from the counter value of an EL5032 En Dat-2.2 input terminal. i Tc Mc_Encoder EL5021 The absolute actual position is generated from the counter value of an EL5021 sin/cos input terminal. i Tc Mc_Encoder_Test Only Reserved for internal testing; do not use. 102 Version: 1.8.3 TF5810
## Page 103

PLCopen Motion Control 4.3.6 E_Tc MCFb State Available from version 3.0 The constants listed here are used to identify the runtime states of the axes. Syntax TYPE E_Tc MCFb State : ( Mc State_Standstill := 0, Mc State_Discrete Motion, Mc State_Continousmotion, Mc State_Synchronizedmotion, Mc State_Stopping, Mc State_Errorstop, Mc State_Homing, Mc State_Disabled ); END_TYPE Values Name Description Mc State_Standstill The axis does not have a motion command. Active position control, repositioner monitoring, the output of a press control value or none of these will be carried out, depending on the parameterization. Mc State_Discrete Motion The axis executes a movement with a defined target position and velocity. Mc State_Continousmotion The axis executes a movement without any defined target position. Only the velocity is specified. Mc State_Synchronizedmotion The axis performs a movement, which is derived from the movement of another axis. Mc State_Stopping The axis is carrying out a stop. Mc State_Errorstop The axis has been stopped because of a problem. It cannot at present be started, and requires a reset before it will be in a condition from which it can start. Mc State_Homing The axis is homing. Mc State_Disabled The controller enable of the axis is FALSE. 4.3.7 E_Tc Mc Homing Type Available from version 3.0 The constants listed here are used to identify the referencing method of the axes. Syntax TYPE E_Tc Mc Homing Type :( i Tc Mc_Homing On Block, i Tc Mc_Homing On Index, i Tc Mc_Homing On Sync, i Tc Mc_Homing On Multi Sync, i Tc Mc_Homing On Exec ); END_TYPE TF5810 Version: 1.8.3 103
## Page 104

PLCopen Motion Control Values Name Description i Tc Mc_Homing On Block The axis is moved in the direction specified by ST_Tc Hyd Ax Param.b Enc_Ref Index Positive with ST_Tc Hyd Ax Param.f Enc_Ref Index Velo. If no movement is detected over a period of 2 seconds, the fixed stop (block) is considered to have been reached. The actual value for the axis is set to the value of the reference position. i Tc Mc_Homing On Index The axis is moved in the direction specified by ST_Tc Hyd Ax Param.b Enc_Ref Index Positive with ST_Tc Hyd Ax Param.f Enc_Ref Index Velo. The axis is stopped if the referencing cam (bit 5, dw Tc Hyd Dc Dw Ref Index) is detected in ST_Tc Hyd Ax Rt Data.n De Ctrl DWord. It is then moved with ST_Tc Hyd Ax Param.f Enc_Ref Sync Velo in the direction specified by ST_Tc Hyd Ax Param.b Enc_Ref Sync Positive until the referencing cam has again been left. The actual value for the axis is set to the value of the reference position. i Tc Mc_Homing On Sync The axis is moved in the direction specified by ST_Tc Hyd Ax Param.b Enc_Ref Index Positive with ST_Tc Hyd Ax Param.f Enc_Ref Index Velo. The axis is stopped if the referencing cam (bit 5, dw Tc Hyd Dc Dw Ref Index) is detected in ST_Tc Hyd Ax Rt Data.n De Ctrl DWord. It is then moved with ST_Tc Hyd Ax Param.f Enc_Ref Sync Velo in the direction specified by ST_Tc Hyd Ax Param.b Enc_Ref Sync Positive until the referencing cam has again been left. The encoder's hardware latch is then activated, and the axis is moved on until the latch becomes valid. After the axis has stopped, the actual value for the axis is set to a value that is calculated from the reference position and from the distance covered since the encoder's sync pulse was detected. i Tc Mc_Homing On Multi Sync The actual value of the axis is immediately set to the value of the reference position. i Tc Mc_Homing On Exec The hardware latch of the encoder is activated. The axis is moved with ST_Tc Hyd Ax Param.f Enc_Ref Sync Velo in the direction specified by ST_Tc Hyd Ax Param.b Enc_Ref Index Positive, until the latch has become valid twice. If the end of path is detected before two sync pulses were detected, the process is repeated in the opposite direction. If this does not succeed either, the homing is aborted. Otherwise the current actual position is determined from the distance of the sync pulses and the f Enc_Base Distance. 4.3.8 E_Tc MCParameter Available from version 3.0 The constants listed here are used for numbering parameters. Syntax TYPE E_Tc MCParameter : ( (* ================================================================== A T T E N T I O N ================================================================== = These Codes are also used to identify parameters in files. = Any change of the meaning of any code here will make any file = incompatible without notice and may even cause a crash of = the control system! ================================================================== = CONSEQUENCE: Only adding new codes is allowed! 104 Version: 1.8.3 TF5810
## Page 105

PLCopen Motion Control ================================================================== = These codes are also used for ADS communication ================================================================== *) (* ================================================================== A C H T U N G ================================================================== = Diese Codes werden auch zur Kennzeichnung von Parametern = in den Dateien verwendet. Eine Veraenderung der Codes wuerde = die Dateien (nicht erkennbar) inkompatibel machen und koennte = zum Systemabsturz fuehren! ================================================================== = ALSO: Es duerfen nur neue Codes dazugefuegt werden! ================================================================== = Diese Codes werden ebenfalls fuer die ADS-Kommunikation benutzt ================================================================== *) Mc Para_Commanded Position:=1, Mc Para_SWLimit Pos, Mc Para_SWLimit Neg, Mc Para_Enable Limit Pos, Mc Para_Enable Limit Neg, Mc Para_Enable Pos Lag Monitoring, Mc Para_Max Position Lag, Mc Para_Max Velocity System, Mc Para_Max Velocity Appl, Mc Para_Actual Velocity, Mc Para_Commanded Velocity, Mc Para_Max Acceleration System, Mc Para_Max Acceleration Appl, Mc Para_Max Deceleration System, Mc Para_Max Deceleration Appl, Mc Para_Max Jerk, (* ============================================================ *) Mc Para_Bk Plc Mc_Profil Type:=1000, Mc Para_Bk Plc Mc_Env Cycletime, Mc Para_Bk Plc Mc_Ax Name, Mc Para_Bk Plc Mc_Time Based, Mc Para_Bk Plc Mc_Jerk Enabled, Mc Para_Bk Plc Mc_Log Level, Mc Para_Bk Plc Mc_Cycle Divider, Mc Para_Bk Plc Mc_Param File Name, Mc Para_Bk Plc Mc_Encoder Type:=1100, Mc Para_Bk Plc Mc_Encoder Homing Type, Mc Para_Bk Plc Mc_Encoder Zero Shift, Mc Para_Bk Plc Mc_Encoder Inc Weighting, Mc Para_Bk Plc Mc_Encoder Inc Interpolation, Mc Para_Bk Plc Mc_Encoder Ref Index Velo, Mc Para_Bk Plc Mc_Encoder Ref Index Positive, Mc Para_Bk Plc Mc_Encoder Ref Sync Velo, Mc Para_Bk Plc Mc_Encoder Ref Sync Positive, Mc Para_Bk Plc Mc_Encoder Default Home Position, Mc Para_Bk Plc Mc_Encoder Reversed, Mc Para_Bk Plc Mc_Encoder Base Distance, Mc Para_Bk Plc Mc_Encoder Modulo Base, Mc Para_Bk Plc Mc_Encoder Enable Latch, Mc Para_Bk Plc Mc_Encoder Latched Pos, Mc Para_Bk Plc Mc_Encoder Ref Shift, Mc Para_Bk Plc Mc_Encoder Ref Flag, Mc Para_Bk Plc Mc_Encoder Poti Rg To Rl, Mc Para_Bk Plc Mc_Encoder Overrun Mask, Mc Para_Bk Plc Mc_Encoder Position Mask, Mc Para_Bk Plc Mc_Encoder Zero Swap, Mc Para_Bk Plc Mc_Encoder No Upload, Mc Para_Bk Plc Mc_Encoder Modulo Mode, Mc Para_Bk Plc Mc_Valve Overlap Comp P:=1200, Mc Para_Bk Plc Mc_Valve Bend Point Velo, Mc Para_Bk Plc Mc_Valve Bend Point Output, Mc Para_Bk Plc Mc_Valve Response Time, Mc Para_Bk Plc Mc_Valve Overlap Comp M, Mc Para_Bk Plc Mc_Cylinder Arrea A:=1280, Mc Para_Bk Plc Mc_Cylinder Arrea B, Mc Para_Bk Plc Mc_Drive Type:=1300, Mc Para_Bk Plc Mc_Area Ratio, Mc Para_Bk Plc Mc_Drive Reversed, Mc Para_Bk Plc Mc_Drive Default Power Ok TF5810 Version: 1.8.3 105
## Page 106

PLCopen Motion Control Mc Para_Bk Plc Mc_Drive Absolute Output, Mc Para_Bk Plc Mc_Drive Inc Weighting, Mc Para_Bk Plc Mc_Drive Inc Interpolation, Mc Para_Bk Plc Mc_Drive No Upload, Mc Para_Bk Plc Mc_Drive Is Hybrid, Mc Para_Bk Plc Mc_Hybrid Concept, Mc Para_Bk Plc Mc_Pump_Cavities, Mc Para_Bk Plc Mc_Pump_Enc Type, Mc Para_Bk Plc Mc_Pump_N_max, Mc Para_Bk Plc Mc_Pump_N_min, Mc Para_Bk Plc Mc_Pump_P_max, Mc Para_Bk Plc Mc_Pump_P_min, Mc Para_Bk Plc Mc_Pump_Q_fast_P, Mc Para_Bk Plc Mc_Pump_Q_slow_P, Mc Para_Bk Plc Mc_Pump_Q_fast_M, Mc Para_Bk Plc Mc_Pump_Q_slow_M, Mc Para_Bk Plc Mc_Pump_Q_leak, Mc Para_Bk Plc Mc_Pump_Enc_Offset, Mc Para_Bk Plc Mc_Cylinder_A_add P, Mc Para_Bk Plc Mc_Cylinder_A_add M, Mc Para_Bk Plc Mc_Prs Scaling_A, Mc Para_Bk Plc Mc_Prs Scaling_B, Mc Para_Bk Plc Mc_Prs Scaling_Sys, Mc Para_Bk Plc Mc_Motor_Ramp Time, Mc Para_Bk Plc Mc_Pump_Regenerative, Mc Para_Bk Plc Mc_Virtual_A_add P, Mc Para_Bk Plc Mc_Virtual_A_add M, Mc Para_Bk Plc Mc_Aside_Prs Hi Res ADC, Mc Para_Bk Plc Mc_Bside_Prs Hi Res ADC, Mc Para_Bk Plc Mc_System_Prs Hi Res ADC, Mc Para_Bk Plc Mc_Start Ramp:=1400, Mc Para_Bk Plc Mc_obsolete_1, Mc Para_Bk Plc Mc_obsolete_2, Mc Para_Bk Plc Mc_Stop Ramp:=1500, Mc Para_Bk Plc Mc_Emergency Ramp, Mc Para_Bk Plc Mc_Brake On, Mc Para_Bk Plc Mc_Brake Off, Mc Para_Bk Plc Mc_Brake Safety, Mc Para_Bk Plc Mc_Creep Speed P:=1600, Mc Para_Bk Plc Mc_Creep Distance P, Mc Para_Bk Plc Mc_Brake Distance P, Mc Para_Bk Plc Mc_Brake Dead Time P, Mc Para_Bk Plc Mc_Creep Speed M, Mc Para_Bk Plc Mc_Creep Distance M, Mc Para_Bk Plc Mc_Brake Distance M, Mc Para_Bk Plc Mc_Brake Dead Time M, Mc Para_Bk Plc Mc_Asymetrical Targeting, Mc Para_Bk Plc Mc_Lag Amp:=1700, Mc Para_Bk Plc Mc_Lag Amp Adapt Limit, Mc Para_Bk Plc Mc_Lag Amp Adapt Factor, Mc Para_Bk Plc Mc_Zero Compensation, Mc Para_Bk Plc Mc_Target Clamping, Mc Para_Bk Plc Mc_Repos Distance, Mc Para_Bk Plc Mc_Auto Brake Distance, Mc Para_Bk Plc Mc_Enable Control Loop On Fault, Mc Para_Bk Plc Mc_Lag Amp Dx, Mc Para_Bk Plc Mc_Lag Amp Ti, Mc Para_Bk Plc Mc_Lag Amp Wu Limit, Mc Para_Bk Plc Mc_Lag Amp Out Limit, Mc Para_Bk Plc Mc_Velo Amp, Mc Para_Bk Plc Mc_Velo Amp Dx, Mc Para_Bk Plc Mc_Velo Amp Ti, Mc Para_Bk Plc Mc_Velo Amp Wu Limit, Mc Para_Bk Plc Mc_Velo Amp Out Limit, Mc Para_Bk Plc Mc_Feed Forward, Mc Para_Bk Plc Mc_Lag Amp Td, Mc Para_Bk Plc Mc_Lag Amp Tdd, Mc Para_Bk Plc Mc_Lag Amp Cfb_t A, Mc Para_Bk Plc Mc_Lag Amp Cfb_k A, Mc Para_Bk Plc Mc_Lag Amp Cfb_t V, Mc Para_Bk Plc Mc_Lag Amp Cfb_k V, Mc Para_Bk Plc Mc_Lag Ctrl Type, Mc Para_Bk Plc Mc_Lag Amp Cfb_t F, 106 Version: 1.8.3 TF5810
## Page 107

PLCopen Motion Control Mc Para_Bk Plc Mc_Lag Amp Cfb_k F, Mc Para_Bk Plc Mc_Acc Feed Forward, Mc Para_Bk Plc Mc_Pctrl_k P:=1780, Mc Para_Bk Plc Mc_Pctrl_Tn, Mc Para_Bk Plc Mc_Pctrl_Tv, Mc Para_Bk Plc Mc_Pctrl_Nf, Mc Para_Bk Plc Mc_Pctrl_Preset, Mc Para_Bk Plc Mc_Pctrl_Wu Limit, Mc Para_Bk Plc Mc_Pctrl_Align Areas, Mc Para_Bk Plc Mc_Mon Position Range:=1800, Mc Para_Bk Plc Mc_Mon Target Range, Mc Para_Bk Plc Mc_Mon Target Filter, Mc Para_Bk Plc Mc_Mon Position Lag Filter, Mc Para_Bk Plc Mc_Mon Dynamic Lag Limit, Mc Para_Bk Plc Mc_Mon Peh Enable, Mc Para_Bk Plc Mc_Mon Peh Timeout, Mc Para_Bk Plc Mc_Dig Input Reversed, Mc Para_PFW_Enable Limit Pos:=1898, Mc Para_PFW_Enable Limit Neg:=1899, Mc Para_Bk Plc Mc_Jog Velo Fast:=1900, Mc Para_Bk Plc Mc_Jog Velo Slow, Mc Para_Bk Plc Mc_Customer Data:=2000, Mc Para_Bk Plc Mc_Auto Id_Ena Eo T:=3000, Mc Para_Bk Plc Mc_Auto Id_Ena Ovl, Mc Para_Bk Plc Mc_Auto Id_Ena Zadj, Mc Para_Bk Plc Mc_Auto Id_Ena Aratio, Mc Para_Bk Plc Mc_Auto Id_Ena Lin Tab, Mc Para_Bk Plc Mc_Auto Id_Eo T_N:=3100, Mc Para_Bk Plc Mc_Auto Id_Eo T_P, Mc Para_Bk Plc Mc_Auto Id_Eo I_N, Mc Para_Bk Plc Mc_Auto Id_Eo I_P, Mc Para_Bk Plc Mc_Auto Id_Eo Tlim_N, Mc Para_Bk Plc Mc_Auto Id_Eo Tlim_P, Mc Para_Bk Plc Mc_Auto Id_Dec Factor, Mc Para_Bk Plc Mc_Auto Id_Eo Vlim_N, Mc Para_Bk Plc Mc_Auto Id_Eo Vlim_P, Mc Para_Bk Plc Mc_Auto Id_Last Ident_N, Mc Para_Bk Plc Mc_Auto Id_Last Ident_P, Mc Para_Bk Plc Mc_Auto Id_Tbl Count:=3150, Mc Para_Bk Plc Mc_Auto Id_Tbl Low End, Mc Para_Bk Plc Mc_Auto Id_Tbl High End, Mc Para_Bk Plc Mc_Auto Id_Tbl Ramp, Mc Para_Bk Plc Mc_Auto Id_Tbl Settling, Mc Para_Bk Plc Mc_Auto Id_Tbl Recovery, Mc Para_Bk Plc Mc_Auto Id_Tbl Min Cycle, Mc Para_Bk Plc Mc_Auto Id_Lin Tbl Available, Mc Para_Bk Plc Mc_Auto Id_Tbl Valve Type, Mc Para_Bk Plc Mc_Auto Id_Lin Tab_1:=3200, Mc Para_Bk Plc Mc_Auto Id_Lin Tab_2:=3400, (* ---------------------------------------------------------- *) Mc Rt Data_Bk Plc Mc_Actual Position:=10000, Mc Rt Data_Bk Plc Mc_Actual Acceleration, Mc Rt Data_Bk Plc Mc_Pos Error, Mc Rt Data_Bk Plc Mc_Distance To Target, Mc Rt Data_Bk Plc Mc_Act Pressure, Mc Rt Data_Bk Plc Mc_Act Pressure A, Mc Rt Data_Bk Plc Mc_Act Pressure B, Mc Rt Data_Bk Plc Mc_Act Force, Mc Rt Data_Bk Plc Mc_Valve Pressure, Mc Rt Data_Bk Plc Mc_Supply Pressure, Mc Rt Data_Bk Plc Mc_Set Position, Mc Rt Data_Bk Plc Mc_Set Velocity, Mc Rt Data_Bk Plc Mc_Set Acceleration, Mc Rt Data_Bk Plc Mc_Set Pressure, Mc Rt Data_Bk Plc Mc_Set Override, Mc Rt Data_Bk Plc Mc_Latch Position, Mc Rt Data_Bk Plc Mc_Ctrl Out Lag, Mc Rt Data_Bk Plc Mc_Ctrl Out Clamping, Mc Rt Data_Bk Plc Mc_Ctrl Out Overlap Comp, Mc Rt Data_Bk Plc Mc_Target Position, Mc Rt Data_Bk Plc Mc_NSDW:=11000, Mc Rt Data_Bk Plc Mc_DCDW, Mc Rt Data_Bk Plc Mc_Err Code, Mc Rt Data_Bk Plc Mc_Fb State, TF5810 Version: 1.8.3 107
## Page 108

PLCopen Motion Control Mc Rt Data_Bk Plc Mc_Cur Step, Mc Rt Data_Bk Plc Mc_Params Unsave, Mc Rt Data_Bk Plc Mc_Raw Position, Mc Rt Data_Bk Plc Mc_Act Pos Cams, Mc Rt Data_Bk Plc Mc_Reload Params, Mc Rt Data_Bk Plc Mc_Encoder Min Pos, Mc Rt Data_Bk Plc Mc_Encoder Max Pos, Mc Rt Data_Bk Plc Mc_Buffered Entries, Mc Rt Data_Bk Plc Mc_Pump_Switched:=12000, Mc Rt Data_Bk Plc Mc_Pump_Area Switched, Mc Rt Data_Bk Plc Mc_Pump_Angle:=12100, Mc Rt Data_Bk Plc Mc_Pump_Modulo Angle, Mc Rt Data_Bk Plc Mc_Pump_Speed, Mc Rt Data_Bk Plc Mc_Pump_Torque, Mc Rt Data_Bk Plc Mc_Motor_N_max, Mc Rt Data_Bk Plc Mc_Active_Area_P, Mc Rt Data_Bk Plc Mc_Active_Area_M, Mc Rt Data_Bk Plc Mc_Active_Qmax_P, Mc Rt Data_Bk Plc Mc_Active_Qmax_M, Mc Rt Data_Bk Plc Mc_Active_Feed_P, Mc Rt Data_Bk Plc Mc_Active_Feed_M, Mc Rt Data_Bk Plc Mc_Active_N_max, Mc Rt Data_Bk Plc Mc_Active_Vmax_P, Mc Rt Data_Bk Plc Mc_Active_Vmax_M, (* ---------------------------------------------------------- *) (**) Mc Para_Bk Plc Mc_ (**) Mc Para_Bk Plc Mc_File Mark Complete:=32767 (* Ax. Params.b Lin Tab Available Auto Ident: .. / Auto Ident: .. *)229 ); END_TYPE 108 Version: 1.8.3 TF5810
## Page 109

PLCopen Motion Control Values TF5810 Version: 1.8.3 109
## Page 110

PLCopen Motion Control Name Description Mc Para_Commanded Position:=1 The last commanded target position of the axis. Mc Para_SWLimit Pos Software limit switch in positive direction. Mc Para_SWLimit Neg Software limit switch in negative direction. Mc Para_Enable Limit Pos Enable for the software limit switch in positive direction. Mc Para_Enable Limit Neg Enable for the software limit switch in negative direction. Mc Para_Enable Pos Lag Monitoring Enabling the lag error monitoring. Mc Para_Max Position Lag Threshold value for position lag monitoring. Mc Para_Max Velocity System The upper limit set by the system for the maximum velocity that can be commanded by the application. Mc Para_Max Velocity Appl The maximum velocity that can be commanded by the application. Mc Para_Actual Velocity The actual axis velocity. Mc Para_Commanded Velocity The last commanded velocity of the axis. Mc Para_Max Acceleration System The upper limit set by the system for the maximum acceleration that can be commanded by the application. Mc Para_Max Acceleration Appl The maximum acceleration that can be commanded by the application. Mc Para_Max Deceleration System The upper limit set by the system for the maximum deceleration that can be commanded by the application. Mc Para_Max Deceleration Appl The maximum deceleration that can be commanded by the application. Mc Para_Max Jerk The upper limit set by the system for the maximum jerk that can be commanded by the application. Mc Para_Bk Plc Mc_Profil Type:=1000 : Type of setpoint generation. Mc Para_Bk Plc Mc_Env Cycletime The cycle time of the task in which the core function blocks (encoder, setpoint generator, etc.) of the axis are called. Mc Para_Bk Plc Mc_Ax Name The text-based name of the axis. Mc Para_Bk Plc Mc_Time Based The switching of the setpoint generation: Timebased or Displacementbased. Mc Para_Bk Plc Mc_Jerk Enabled The control word for jerk limitation. Mc Para_Bk Plc Mc_Log Level Threshold value for message logging. Mc Para_Bk Plc Mc_Cycle Divider Reserved, not implemented. Mc Para_Bk Plc Mc_Param File Name Name of the parameter file. Mc Para_Bk Plc Mc_Encoder Type:=1100 Type of encoder evaluation. Mc Para_Bk Plc Mc_Encoder Homing Type Axes with incremental encoder: The default method of homing. Mc Para_Bk Plc Mc_Encoder Zero Shift Axes with absolute encoder system: The zero offset shift of the encoder evaluation. Mc Para_Bk Plc Mc_Encoder Inc Weighting The increment weighting of the encoder evaluation. Mc Para_Bk Plc Mc_Encoder Inc Interpolation The increment interpolation of the encoder evaluation. Mc Para_Bk Plc Mc_Encoder Ref Index Velo Axes with incremental encoder: The homing searches for the index (cam) with this velocity. Mc Para_Bk Plc Mc_Encoder Ref Index Positive Axes with incremental encoder: The homing searches for the index (cam) in positive direction. Mc Para_Bk Plc Mc_Encoder Ref Sync Velo Axes with incremental encoder: The homing searches for the homing signal with this velocity. 110 Version: 1.8.3 TF5810
## Page 111

PLCopen Motion Control Name Description Mc Para_Bk Plc Mc_Encoder Ref Sync Positive Axes with incremental encoder: The homing searches for the homing signal in positive direction. Mc Para_Bk Plc Mc_Encoder Default Home Position, Axes with incremental encoder: A default value for homing. Mc Para_Bk Plc Mc_Encoder Reversed Enable for inverted encoder evaluation. Mc Para_Bk Plc Mc_Encoder Base Distance Reserved for distance-coded encoders. Mc Para_Bk Plc Mc_Encoder Modulo Base Reserved, not implemented. Mc Para_Bk Plc Mc_Encoder Enable Latch Enable for the latch function of an encoder hardware. Mc Para_Bk Plc Mc_Encoder Latched Pos The latched position during homing. Mc Para_Bk Plc Mc_Encoder Ref Shift Axes with incremental encoder: The zero offset shift of the encoder evaluation. Mc Para_Bk Plc Mc_Encoder Ref Flag Axis calibration state. Mc Para_Bk Plc Mc_Encoder Poti Rg To Rl For potentiometer encoders: The ratio of total potentiometer resistance to load resistance (input resistance of the terminal). Mc Para_Bk Plc Mc_Encoder Overrun Mask A mask for detecting an encoder overflow. Mc Para_Bk Plc Mc_Encoder Position Mask A mask for isolating the valid bits within the mapped variables. Mc Para_Bk Plc Mc_Encoder Zero Swap Block-by-block shifting of the counting range of the encoder evaluation. Mc Para_Bk Plc Mc_Encoder No Upload A TRUE here prevents the automatic determination of axis parameters by reading data from an encoder. Mc Para_Bk Plc Mc_Encoder Modulo Mode Reserved Mc Para_Bk Plc Mc_Valve Overlap Comp P:=1200 Compensation of the valve overlap for the positive direction. Mc Para_Bk Plc Mc_Valve Bend Point Velo Velocity for compensation of the characteristic curve bend. Mc Para_Bk Plc Mc_Valve Bend Point Output Valve output for compensation of the characteristic curve bend. Mc Para_Bk Plc Mc_Valve Response Time Compensation of the valve response time. Mc Para_Bk Plc Mc_Valve Overlap Comp M Compensation of the valve overlap for the negative direction. Mc Para_Bk Plc Mc_Cylinder Arrea A:=1280 The cylinder area of the cylinder side pushing in positive direction. Mc Para_Bk Plc Mc_Cylinder Arrea B The cylinder area of the cylinder side pushing in negative direction. Mc Para_Bk Plc Mc_Drive Type:=1300 Type of drive adjustment. Mc Para_Bk Plc Mc_Area Ratio The direction-dependent velocity ratio. Mc Para_Bk Plc Mc_Drive Reversed Enable for inverted output adjustment. Mc Para_Bk Plc Mc_Drive Default Power Ok Drive power is assumed to be available; no hardware signal required. Mc Para_Bk Plc Mc_Drive Absolute Output Enable for absolute value formation during output adjustment. Mc Para_Bk Plc Mc_Drive Inc Weighting Weighting of the output adjustment. Mc Para_Bk Plc Mc_Drive Inc Interpolation Interpolation of the output adjustment. Mc Para_Bk Plc Mc_Drive No Upload A TRUE here prevents the automatic determination of axis parameters by reading data from a drive. Mc Para_Bk Plc Mc_Drive Is Hybrid This parameter is used to identify a servo-electric/ hydraulic hybrid axis. Please note: A TRUE here triggers a recalculation of drive parameters. TF5810 Version: 1.8.3 111
## Page 112

PLCopen Motion Control Name Description Mc Para_Bk Plc Mc_Hybrid Concept The circuit concept used for the servo-electric/ hydraulic axis must be specified here. Mc Para_Bk Plc Mc_Pump_Cavities Hybrid axis: Number of pump cavities Mc Para_Bk Plc Mc_Pump_Enc Type The encoder type of the pump drive is defined here. Only a small selection of encoder types is available. This is not the encoder on the cylinder. Mc Para_Bk Plc Mc_Pump_N_max [rpm] The maximum permissible pump speeds. Mc Para_Bk Plc Mc_Pump_N_min [rpm] The minimum permissible pump speeds. Mc Para_Bk Plc Mc_Pump_P_max [bar] The maximum permissible operating pressure of the pump. Mc Para_Bk Plc Mc_Pump_P_min [bar] The minimum permissible operating pressure of the pump. Mc Para_Bk Plc Mc_Pump_Q_fast_P [cm3/rev] The rotation-related flow rate of the pump in rapid or force mode at the cylinder connection Mc Para_Bk Plc Mc_Pump_Q_slow_P acting in the positive direction. Mc Para_Bk Plc Mc_Pump_Q_fast_M [cm3/U] The rotation-related flow rate of the pump in rapid or force mode at the cylinder connection acting Mc Para_Bk Plc Mc_Pump_Q_slow_M in the negative direction. Mc Para_Bk Plc Mc_Pump_Q_leak Reserved Mc Para_Bk Plc Mc_Pump_Enc_Offset Reserved Mc Para_Bk Plc Mc_Cylinder_A_add P If, depending on the situation, an area effective for oil demand is connected in the positive direction of action, it must be identified here. Mc Para_Bk Plc Mc_Cylinder_A_add M If, depending on the situation, an area effective for oil demand is connected in the negative direction of action, it must be identified here. This can also be an oil demand required by an apparent area, which actually bypasses the cylinder. In this case, the area should be identified as "virtual". Mc Para_Bk Plc Mc_Prs Scaling_A The scaling pressures for the A-side, the B-side and the system pressure detection are to be set here. Mc Para_Bk Plc Mc_Prs Scaling_B Mc Para_Bk Plc Mc_Prs Scaling_Sys Mc Para_Bk Plc Mc_Motor_Ramp Time When switching between rapid and force mode, the weighting factor for the velocity output and the maximum attainable velocity are changed. A ramp can be defined here, in order to avoid a discontinuity. Mc Para_Bk Plc Mc_Pump_Regenerative This parameter indicates that the smaller cylinder area is operated in oil exchange with the larger cylinder area. Mc Para_Bk Plc Mc_Virtual_A_add P The active area that can be activated in positive direction must be taken into account for the oil demand, but it does not contribute to the force build- up. Mc Para_Bk Plc Mc_Virtual_A_add M The active area that can be activated in negative direction must be taken into account for the oil demand, but it does not contribute to the force build- up. Mc Para_Bk Plc Mc_Aside_Prs Hi Res ADC The pressure sensor on the area acting in positive direction is read in with a 24-bit terminal. Mc Para_Bk Plc Mc_Bside_Prs Hi Res ADC The pressure sensor on the area acting in negative direction is read in with a 24-bit terminal. Mc Para_Bk Plc Mc_System_Prs Hi Res ADC The pressure sensor at the pressurized hydraulic reservoir is read with a 24-bit terminal. 112 Version: 1.8.3 TF5810
## Page 113

PLCopen Motion Control Name Description Mc Para_Bk Plc Mc_Start Ramp:=1400 Only for certain setpoint generators: The acceleration ramp. Mc Para_Bk Plc Mc_obsolete_1 Reserved Mc Para_Bk Plc Mc_obsolete_2 Reserved Mc Para_Bk Plc Mc_Stop Ramp:=1500 Only for certain setpoint generators: The deceleration ramp. Mc Para_Bk Plc Mc_Emergency Ramp In the event of an emergency stop: The time for braking from maximum speed to standstill. Mc Para_Bk Plc Mc_Brake On A delay between the signal for releasing a brake and the active axis motion. Mc Para_Bk Plc Mc_Brake Off A delay between the active axis motion and the signal for activating a brake. Mc Para_Bk Plc Mc_Brake Safety A delay between the active axis motion in one direction and active motion in the opposite direction. Mc Para_Bk Plc Mc_Creep Speed P:=1600 The creep speed in positive direction. With symmetric target approach: The creep velocity in negative direction. Mc Para_Bk Plc Mc_Creep Distance P The creep distance in positive direction. With symmetrical target approach: The creep distance in negative direction. Mc Para_Bk Plc Mc_Brake Distance P The braking distance time in positive direction. For symmetrical target approach: The braking distance in negative direction. Mc Para_Bk Plc Mc_Brake Dead Time P The brake dead time in positive direction. Mc Para_Bk Plc Mc_Creep Speed M With asymmetric target approach: The creep velocity in negative direction. Mc Para_Bk Plc Mc_Creep Distance M With asymmetric target approach: The creep distance in negative direction. Mc Para_Bk Plc Mc_Brake Distance M For asymmetric target approach: The braking distance in negative direction. Mc Para_Bk Plc Mc_Brake Dead Time M The brake dead time in negative direction. Mc Para_Bk Plc Mc_Asymetrical Targeting Enable asymmetrical (direction-dependent) target approach. Mc Para_Bk Plc Mc_Lag Amp:=1700 Gain factor for the proportional component in the position controller. Mc Para_Bk Plc Mc_Lag Amp Adapt Limit Reserved Mc Para_Bk Plc Mc_Lag Amp Adapt Factor Reserved Mc Para_Bk Plc Mc_Zero Compensation Offset compensation of the output. Mc Para_Bk Plc Mc_Target Clamping Default output value for the clamping function. Mc Para_Bk Plc Mc_Repos Distance Threshold value for automatic repositioning. Mc Para_Bk Plc Mc_Auto Brake Distance Enable for automatic calculation of the braking distance. Mc Para_Bk Plc Mc_Enable Control Loop On Fault Enable for position control in the event of axis errors. Mc Para_Bk Plc Mc_Lag Amp Dx Threshold value for the integrating component of the position controller. Mc Para_Bk Plc Mc_Lag Amp Ti Time constant for the integrating component of the position controller. Mc Para_Bk Plc Mc_Lag Amp Wu Limit Limitation (wind-up limit) for the integrating component of the position controller. Mc Para_Bk Plc Mc_Lag Amp Out Limit Output limitation for the position controller. Mc Para_Bk Plc Mc_Velo Amp Gain factor for the proportional component in the velocity controller. TF5810 Version: 1.8.3 113
## Page 114

PLCopen Motion Control Name Description Mc Para_Bk Plc Mc_Velo Amp Dx Threshold value for the integrating component of the velocity controller. Mc Para_Bk Plc Mc_Velo Amp Ti Time constant for the integrating component of the velocity controller. Mc Para_Bk Plc Mc_Velo Amp Wu Limit Limitation (wind up limit) for the integrating component of the velocity controller. Mc Para_Bk Plc Mc_Velo Amp Out Limit Output limitation for the velocity controller. Mc Para_Bk Plc Mc_Feed Forward Feed forward weighting of the axis. Mc Para_Bk Plc Mc_Lag Amp Td A parameter of the extended position controller in the MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc [} 185] function block: The gain of the D part. Mc Para_Bk Plc Mc_Lag Amp Tdd A parameter of the extended position controller in the MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc [} 185] function block: The attenuation of the D part. Mc Para_Bk Plc Mc_Lag Amp Cfb_t A A parameter of the extended position controller in the MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc function block: The filter time of the actual acceleration feedback. Mc Para_Bk Plc Mc_Lag Amp Cfb_k A A parameter of the extended position controller in the MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc function block: The gain of the actual acceleration feedback. Mc Para_Bk Plc Mc_Lag Amp Cfb_t V A parameter of the extended position controller in the MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc function block: The filter time of the actual velocity feedback. Mc Para_Bk Plc Mc_Lag Amp Cfb_k V A parameter of the extended position controller in the MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc function block: The gain of the actual velocity feedback. Mc Para_Bk Plc Mc_Lag Ctrl Type Type of lag controller Mc Para_Bk Plc Mc_Lag Amp Cfb_t F Force damping of the condition feedback in the lag controller Mc Para_Bk Plc Mc_Lag Amp Cfb_k F Mc Para_Bk Plc Mc_Acc Feed Forward Acceleration feed forward weighting Mc Para_Bk Plc Mc_Pctrl_k P:=1780 Proportional gain of a force or pressure controller. Mc Para_Bk Plc Mc_Pctrl_Tn Time constant in the I part of a force or pressure controller. Mc Para_Bk Plc Mc_Pctrl_Tv Time constant in the D part of a force or pressure controller. Mc Para_Bk Plc Mc_Pctrl_Nf Depth of a mean value filter in the D part of a force or pressure controller. Mc Para_Bk Plc Mc_Pctrl_Preset Initial value of the I part of a force or pressure controller. Mc Para_Bk Plc Mc_Pctrl_Wu Limit Limitation of the I part of a force or pressure controller. Mc Para_Bk Plc Mc_Pctrl_Align Areas Adaptation of the output of a force or pressure controller to the direction-dependent active areas. Mc Para_Bk Plc Mc_Mon Position Range:=1800 Tolerance for the position window. Mc Para_Bk Plc Mc_Mon Target Range Tolerance for the target window. Mc Para_Bk Plc Mc_Mon Target Filter Filter time for the target window. Mc Para_Bk Plc Mc_Mon Position Lag Filter Filter time for position lag monitoring. Mc Para_Bk Plc Mc_Mon Dynamic Lag Limit Tolerance for dynamic position lag monitoring. Mc Para_Bk Plc Mc_Mon Peh Enable Enable for monitoring of the ready message at the target. 114 Version: 1.8.3 TF5810
## Page 115

PLCopen Motion Control Name Description Mc Para_Bk Plc Mc_Mon Peh Timeout Filter time for monitoring of the ready message at the target. Mc Para_Bk Plc Mc_Dig Input Reversed Enable for inversion of the input signals of an axis with digital position sensors. Mc Para_PFW_Enable Limit Pos:=1898 Reserved Mc Para_PFW_Enable Limit Neg:=1899 Reserved Mc Para_Bk Plc Mc_Jog Velo Fast:=1900 A default value for a fast jog velocity. Mc Para_Bk Plc Mc_Jog Velo Slow A default value for a slow jog velocity. Mc Para_Bk Plc Mc_Customer Data:=2000 A field with parameters that can be used freely by an application. These parameters are stored and loaded with the axis parameters. Mc Para_Bk Plc Mc_Auto Id_Ena Eo T:=3000 Automatic identification: Determination of the hard stops of the cylinder. Mc Para_Bk Plc Mc_Auto Id_Ena Ovl Automatic identification: Determination of the valve overlap. Mc Para_Bk Plc Mc_Auto Id_Ena Zadj Automatic identification: Determination of the offset. Mc Para_Bk Plc Mc_Auto Id_Ena Aratio Automatic identification: Determination of the direction-related velocity ratio. Mc Para_Bk Plc Mc_Auto Id_Ena Lin Tab Automatic identification: Determination of the characteristic curve. Mc Para_Bk Plc Mc_Auto Id_Eo T_N:=3100 Automatic identification: Hard stop of the cylinder in negative direction. Mc Para_Bk Plc Mc_Auto Id_Eo T_P Automatic identification: Hard stop of the cylinder in positive direction. Mc Para_Bk Plc Mc_Auto Id_Eo I_N Automatic identification: Determined negative hard stop of the cylinder in increments. Mc Para_Bk Plc Mc_Auto Id_Eo I_P Automatic identification: Determined positive hard stop of the cylinder in increments. Mc Para_Bk Plc Mc_Auto Id_Eo Tlim_N Automatic identification: Determined negative hard stop of the cylinder. Mc Para_Bk Plc Mc_Auto Id_Eo Tlim_P Automatic identification: Determined positive hard stop of the cylinder. Mc Para_Bk Plc Mc_Auto Id_Dec Factor Automatic identification: Factor for deceleration weighting. Mc Para_Bk Plc Mc_Auto Id_Eo Vlim_N Automatic identification: Velocity limitation of the characteristic curves determination in negative direction. Mc Para_Bk Plc Mc_Auto Id_Eo Vlim_P Automatic identification: Velocity limitation of the characteristic curves determination in positive direction. Mc Para_Bk Plc Mc_Auto Id_Last Ident_N Automatic identification: The output value of the last successful measurement in negative direction. Mc Para_Bk Plc Mc_Auto Id_Last Ident_P Automatic identification: The output value of the last successful measurement in positive direction. Mc Para_Bk Plc Mc_Auto Id_Tbl Count:=3150 Automatic identification: The number of table points required. Since the zero point is counted but is only present once, this parameter must always be an odd number. Values between 3 and 99 are accepted. A value of less than 11 is not recommended. Mc Para_Bk Plc Mc_Auto Id_Tbl Low End Automatic identification: Lower end of the intended measuring distance. Mc Para_Bk Plc Mc_Auto Id_Tbl High End Automatic identification: Upper end of the intended measuring distance. TF5810 Version: 1.8.3 115
## Page 116

PLCopen Motion Control Name Description Mc Para_Bk Plc Mc_Auto Id_Tbl Ramp Automatic identification: Ramp for setting up the measurement output. The specified time refers a change from zero to full scale. Smaller output changes are applied in a proportion of the time. Mc Para_Bk Plc Mc_Auto Id_Tbl Settling Automatic identification: Delay time between establishment of the measuring output and the start of the measurement. Mc Para_Bk Plc Mc_Auto Id_Tbl Recovery Automatic characteristic curve identification: Waiting time for a change of direction. Mc Para_Bk Plc Mc_Auto Id_Tbl Min Cycle Automatic identification: Minimum measuring distance. Mc Para_Bk Plc Mc_Auto Id_Lin Tbl Available This signal is set to TRUE at the end of a successful characteristic curve measurement. Mc Para_Bk Plc Mc_Auto Id_Tbl Valve Type Automatic identification: The expected type of characteristic curve. Mc Para_Bk Plc Mc_Auto Id_Lin Tab_1:=3200 Automatic identification: Points of the characteristic curve, related velocity. Mc Para_Bk Plc Mc_Auto Id_Lin Tab_2:=3400 Automatic identification: Points of the characteristic curve, related output. Mc Rt Data_Bk Plc Mc_Actual Position:=10000 The actual position. Mc Rt Data_Bk Plc Mc_Actual Acceleration The actual acceleration. Mc Rt Data_Bk Plc Mc_Pos Error The lag error. Mc Rt Data_Bk Plc Mc_Distance To Target The remaining distance to the target. Mc Rt Data_Bk Plc Mc_Act Pressure The actual differential pressure at the valve. Mc Rt Data_Bk Plc Mc_Act Pressure A The actual pressure in the A-chamber of the cylinder. Mc Rt Data_Bk Plc Mc_Act Pressure B The actual pressure in the B-chamber of the cylinder. Mc Rt Data_Bk Plc Mc_Act Force The actual force. Mc Rt Data_Bk Plc Mc_Valve Pressure The pressure drop at the valve. Mc Rt Data_Bk Plc Mc_Supply Pressure The actual supply pressure value. Mc Rt Data_Bk Plc Mc_Set Position The current position setpoint. Mc Rt Data_Bk Plc Mc_Set Velocity The current velocity setpoint. Mc Rt Data_Bk Plc Mc_Set Acceleration The current acceleration setpoint. Mc Rt Data_Bk Plc Mc_Set Pressure The setpoint for pressure or force regulators. Mc Rt Data_Bk Plc Mc_Set Override The current override value. Mc Rt Data_Bk Plc Mc_Latch Position The (offset) reference position. This is the position at which the actual position was finally set during homing. Mc Rt Data_Bk Plc Mc_Ctrl Out Lag The current output of the position controller. Mc Rt Data_Bk Plc Mc_Ctrl Out Clamping The current value of the terminal output. Mc Rt Data_Bk Plc Mc_Ctrl Out Overlap Comp The current output component of the overlap compensation. Mc Rt Data_Bk Plc Mc_Target Positio The last commanded target position of the axis. This position is not changed by a Stop command. Mc Rt Data_Bk Plc Mc_NSDW:=11000 The axis status word with the operating states. There is no relationship with the status word of an external device. Mc Rt Data_Bk Plc Mc_DCDW The control word of the axis with the enables (and other parameters). There is no relationship with the control word of an external device. 116 Version: 1.8.3 TF5810
## Page 117

PLCopen Motion Control Name Description Mc Rt Data_Bk Plc Mc_Err Code The current error code of the axis. Mc Rt Data_Bk Plc Mc_Fb State The current axis step (defined by PLCopen). See also E_Tc MCFb State. Mc Rt Data_Bk Plc Mc_Cur Step The current (internal) axis step. See also E_Tc Mc Current Step. Mc Rt Data_Bk Plc Mc_Params Unsave A TRUE here indicates that a parameter was changed significantly, but the parameter file was not yet written again. This signal cannot be issued by the library, if the parameter was changed directly (without the write function blocks). Mc Rt Data_Bk Plc Mc_Raw Position The actual position, which was not manipulated through a zero offset shift. Mc Rt Data_Bk Plc Mc_Act Pos Cams For axes with digital position sensors: The sensor signals. Mc Rt Data_Bk Plc Mc_Reload Params If parameters are changed by the runtime: A request to the Plc Mc Manager to read out the parameters again. Mc Rt Data_Bk Plc Mc_Encoder Min Pos Reserved Mc Rt Data_Bk Plc Mc_Encoder Max Pos Reserved Mc Rt Data_Bk Plc Mc_Buffered Entries For axes with a command buffer: The number of buffered commands. Mc Rt Data_Bk Plc Mc_Pump_Switched:=12000 With hybrid axes: The state of the pump switching. Mc Rt Data_Bk Plc Mc_Pump_Area Switched With hybrid axes: The state of the area switching. Mc Rt Data_Bk Plc Mc_Pump_Angle:=12100 With hybrid axes: The pump actual angle. Mc Rt Data_Bk Plc Mc_Pump_Modulo Angle With hybrid axes: The actual pump angle within the current revolution. Mc Rt Data_Bk Plc Mc_Pump_Speed With hybrid axes: The actual pump speed. Mc Rt Data_Bk Plc Mc_Pump_Torque With hybrid axes: The actual torque of the pump drive. Mc Rt Data_Bk Plc Mc_Motor_N_max With hybrid axes: The speed limitation for the pump drive. Mc Rt Data_Bk Plc Mc_Active_Area_P With hybrid axes: The active area currently acting in the positive direction. Mc Rt Data_Bk Plc Mc_Active_Area_M With hybrid axes: The active area currently acting in the negative direction. Mc Rt Data_Bk Plc Mc_Active_Qmax_P With hybrid axes: The current delivery rate of the pump acting in the positive direction. Mc Rt Data_Bk Plc Mc_Active_Qmax_M With hybrid axes: The current delivery rate of the pump acting in the negative direction. Mc Rt Data_Bk Plc Mc_Active_Feed_P With hybrid axes: The feed constant currently acting in the positive direction. Mc Rt Data_Bk Plc Mc_Active_Feed_M With hybrid axes: The feed constant currently acting in the negative direction. Mc Rt Data_Bk Plc Mc_Active_N_max With hybrid axes: The current speed limitation for the pump. Mc Rt Data_Bk Plc Mc_Active_Vmax_P With hybrid axes: The current maximum velocity in the positive direction. Mc Rt Data_Bk Plc Mc_Active_Vmax_M With hybrid axes: The current maximum velocity in the negative direction. Mc Para_Bk Plc Mc_File Mark Complete In a parameter file: The logical end ID. Mc Para_Bk Plc Mc_Asymmetrical Targeting: The enable for asymmetric targeting. Mc Para_Bk Plc Mc_Auto ID_Ena Eo I_N: Automatic identification: Determined negative hard stop of the cylinder in increments. TF5810 Version: 1.8.3 117
## Page 118

PLCopen Motion Control Mc Para_Bk Plc Mc_Auto ID_Ena Eo I_P: Automatic identification: Determined positive hard stop of the cylinder in increments. Mc Para_Bk Plc Mc_Auto ID_Min Cycle: Automatic identification: Minimum measuring distance. Mc Para_Bk Plc Mc_Auto_Brake Distance: The enable for the automatic calculation of the braking distance. Mc Para_Bk Plc Mc_Cycle Devider: Reserved, not implemented. Mc Para_Bk Plc Mc_Dig Inputs Reversed: Enable for inversion of the input signals of an axis with digital position sensors. Mc Para_Bk Plc Mc_Enable Control Loop On Faults: The enable for position control in case of axis errors. Mc Para_Bk Plc Mc_Enc No Upload: A TRUE here prevents the automatic determination of axis parameters by reading data from an encoder. Mc Para_Bk Plc Mc_Encoder Latched Position: The position latched during a homing. Mc Para_Bk Plc Mc_obsolete_XYZ: Placeholder for parameters that are no longer supported. These parameter codes must not be reused for new parameters. To ensure this, such numerical values are assigned names of this form. Mc Para_Bk Plc Mc_Velop Wu Limit: Limitation (wind-up limit) for the integrating component of the velocity controller. Mc Para_PFW_Xyz: These parameters are reserved for a sector-specific solution. Mc Rt Data_Bk Plc Mc_Ax Name: The textual name of the axis. Mc Rt Data_Bk Plc Mc_File Mark Complete: In a parameter file: The logical end identifier. 4.3.9 E_Tc Mc Profile Type Available from version 3.0 The constants listed here are used to identify the rules used to generate the control value for an axis. Syntax TYPE E_Tc Mc Profile Type : ( (* The sequence below must not be changed! New types have to be added at the end. In case a type becomes obsolete it has to be replaced by a dummy to ensure the numerical meaning of the other codes. *) (* Die bestehende Reihenfolge darf nicht veraendert werden. Neue Typen muessen am Ende eingefuegt werden. Wenn ein Typ wegfallen sollte, muss er durch einen Dummy ersetzt werden, um die numerische Zuordnung zu garantieren. *) i Tc Mc_Profile Const Acc, i Tc Mc_Profile Time Pos Ctrl, i Tc Mc_Profile Cosine, i Tc Mc_Profile Ctrl Based, i Tc Mc_Profile Time Ramp, i Tc Mc_Profile Jerk Based, i Tc Mc_Profile Buffered Jerk, i Tc Mc_Profile Switched Velo, i Tc Mc_Profile_Test Only:=100 ); END_TYPE 118 Version: 1.8.3 TF5810
## Page 119

PLCopen Motion Control Values Name Description i Tc Mc_Profile Const Acc Only present for compatibility reasons; has been replaced by i Tc Mc_Profile Ctrl Based. i Tc Mc_Profile Time Pos Ctrl Only present for compatibility reasons; no longer supported. i Tc Mc_Profile Cosine Only present for compatibility reasons; no longer supported. i Tc Mc_Profile Ctrl Based The control value for the drive is assembled from sections of constant acceleration and deceleration. Time (acceleration, change of velocity, stop) and distance (positioning) function as controlling values. This generator type can optionally operate in purely timer-controlled mode with continuously closed position controller. i Tc Mc_Profile Time Ramp The control value for the drive is generated with time-controlled ramps for accelerations and decelerations. The controlling parameters are time (acceleration, velocity change, stop) and path (braking, stopping). This generator type is intended for axes, which only have digital cams instead of an encoder. i Tc Mc_Profile Jerk Based The control value for the drive is assembled from sections of constant acceleration and deceleration. The deceleration is reduced with limited jerk towards the target. Optionally, the acceleration can be increased with limited jerk. Time (acceleration, change of velocity, stop) and distance (positioning) function as controlling values. Some functions are not supported by this generator type, or not fully. This generator type can optionally operate in purely timer-controlled mode with continuously closed position controller. i Tc Mc_Profile Buffered Jerk Reserved i Tc Mc_Profile Switched Velo Reserved for sector-specific packet. i Tc Mc_Profile_Test Only This type is only intended for internal testing of function block prototypes, which have not yet been released. It cannot be set via the Plc Mc Manager. 4.3.10 E_Tc Mc Pressure Reading Mode Available from version 3.0 The constants in this list are transferred to function blocks for logging actual force or pressure values [} 20]. They determine which actual value should be updated in the ST_Tc Hyd Ax Rt Data [} 141] structure with the result of the evaluation. Syntax TYPE E_Tc Mc Pressure Reading Mode : ( i Tc Hyd Pressure Reading Default, i Tc Hyd Pressure Reading Act Pressure, i Tc Hyd Pressure Reading Act Pressure A, i Tc Hyd Pressure Reading Act Pressure B, i Tc Hyd Pressure Reading Act Force, i Tc Hyd Pressure Reading Supply Pressure, i Tc Hyd Pressure Reading Valve Pressure ); END_TYPE TF5810 Version: 1.8.3 119
## Page 120

PLCopen Motion Control Values Name Description i Tc Hyd Pressure Reading Default The target variable depends on the function block being used. i Tc Hyd Pressure Reading Act Pressure The target variable is f Act Pressure. Some function blocks automatically update f Act Pressure A and f Act Pressure B. i Tc Hyd Pressure Reading Act Pressure A The target variable is f Act Pressure A. i Tc Hyd Pressure Reading Act Pressure B The target variable is f Act Pressure B. i Tc Hyd Pressure Reading Act Force The target variable is f Act Force. Some function blocks automatically update f Act Pressure,f Act Pressure A and f Act Pressure B. i Tc Hyd Pressure Reading Supply Pressure The target variable is f Supply Pressure. i Tc Hyd Pressure Reading Valve Pressure The target variable is f Valve Pressure. 4.3.11 E_Tc Mc Valve Type The constants in this list are used to mark rules for automatically identifying characteristic curves of an axis. Syntax TYPE E_Tc Mc Valve Type : ( (* The sequence below must not be changed! New types have to be added at the end. In case a type becomes obsolete it has to be replaced by a dummy to ensure the numerical meaning of the other codes. *) (* Die bestehende Reihenfolge darf nicht veraendert werden. Neue Typen muessen am Ende eingefuegt werden. Wenn ein Typ wegfallen sollte, muss er durch einen Dummy ersetzt werden, um die numerische Zuordnung zu garantieren. *) i Tc Mc_Valve Type Default, i Tc Mc_Valve Type Abrupt, i Tc Mc_Valve Type Decomp, i Tc Mc_Valve Type Linear P, i Tc Mc_Valve Type Linear M, i Tc Mc_Valve Type Copy To P, i Tc Mc_Valve Type Copy To M ); END_TYPE 120 Version: 1.8.3 TF5810
## Page 121

PLCopen Motion Control Values Name Description i Tc Mc_Valve Type Default Standard method: Measurement in both directions of movement. i Tc Mc_Valve Type Abrupt This setting is provided on valves with an abrupt transition from the coverage area. This is only the case with very few valve variants, and without this setting it manifests itself through a very hard behavior, especially at the beginning of the automatic identification. Notice This setting should only be made in coordination with Hydraulic Support. i Tc Mc_Valve Type Decomp This setting is adapted to valves with pressure relief in the coverage area (h symbol). i Tc Mc_Valve Type Linear P With this setting, the identification is performed only in the negative direction. For the positive direction a linear characteristic curve is assumed, the endpoint of which is calculated from the maximum velocity in the negative direction using the set velocity ratio. Notice The velocity ratio is not determined automatically. i Tc Mc_Valve Type Linear M With this setting, the identification is carried out only in the positive direction. For the negative direction a linear characteristic curve is assumed, the endpoint of which is calculated from the maximum velocity in the positive direction using the set velocity ratio. Notice The velocity ratio is not determined automatically. i Tc Mc_Valve Type Copy To P With this setting, the identification is performed only in the negative direction. For the positive direction, the measuring points are calculated from the measuring points of the negative direction using the set velocity ratio. Notice The velocity ratio is not determined automatically. i Tc Mc_Valve Type Copy To M With this setting, the identification is carried out only in the positive direction. For the negative direction, the measuring points are calculated from the measuring points of the positive direction using the set velocity ratio. Notice The velocity ratio is not determined automatically. 4.3.12 MC_Buffer Mode_Bk Plc Mc Available from version 3.0 The constants in this list are used for controlling blending according to PLC Open. Syntax TYPE MC_Buffer Mode_Bk Plc Mc : ( Aborting_Bk Plc Mc := 0, Buffered_Bk Plc Mc, Blending Low_Bk Plc Mc, Blending Previous_Bk Plc Mc, Blending Next_Bk Plc Mc, Blending High_Bk Plc Mc ); END_TYPE TF5810 Version: 1.8.3 121
## Page 122

PLCopen Motion Control Values Name Description Aborting_Bk Plc Mc The default case: The new command becomes active immediately and cancels any other command that may already be active. The function block monitoring the aborted command will respond with Command Aborted. Buffered_Bk Plc Mc For axes with command buffer: This command is started automatically once all previous commands have been fully processed. Blending Low_Bk Plc Mc For axes with command buffer: This command is connected to the previous command without intermediate stop. If possible, the transition point is passed with the lower velocity of the commands involved. Blending Previous_Bk Plc Mc For axes with command buffer: This command is connected to the previous command without intermediate stop. If possible, the transition point is passed with the commanded velocity of the previous command. Blending Next_Bk Plc Mc For axes with command buffer: This command is connected to the previous command without intermediate stop. If possible, the transition point is passed with the commanded velocity of the new command. Blending High_Bk Plc Mc For axes with command buffer: This command is connected to the previous command without intermediate stop. If possible, the transition point is passed with the higher velocity of the commands involved. 4.3.13 MC_CAM_ID_Bk Plc Mc Available from version 3.0 (internal use only). Syntax TYPE MC_CAM_ID_Bk Plc Mc: STRUCT st Cam Ref: MC_CAM_REF_Bk Plc Mc; b Validated: BOOL:=FALSE; b Periodic: BOOL:=FALSE; b Master Abs: BOOL:=FALSE; b Slave Abs: BOOL:=FALSE; b Is Changed: BOOL:=TRUE; END_STRUCT END_TYPE Values Name Description st Cam Ref A copy of the MC_CAM_REF_Bk Plc Mc [} 123] structure. b Validated Here this structure is identified as valid, if it was initialized by a function block of type MC_Cam Table Select_Bk Plc Mc [} 53]. b Periodic Reserved b Master Abs Specifies whether the data of the master column are absolute or refer to the master position at the time of the coupling. b Slave Abs Specifies whether the data of the slave column are absolute or refer to the slave position at the time of the coupling. b Is Changed Reserved 122 Version: 1.8.3 TF5810
## Page 123

PLCopen Motion Control 4.3.14 MC_CAM_REF_Bk Plc Mc Available from version 3.0 (internal use only). Syntax TYPE MC_CAM_REF_Bk Plc Mc: STRUCT p Table: POINTER TO LREAL:=0; n First Idx: UDINT:=1; n Last Idx: UDINT:=1; b Equi Distant: BOOL:=FALSE; END_STRUCT END_TYPE Values Name Description p Table The address of the curve table. n First Idx The index of the first table row. n Last Idx The index of the last table row. b Equi Distant Reserved 4.3.15 MC_CAMSWITCH_REF_Bk Plc Mc Available from version 3.0 A variable of this type is transferred to an MC_Digital Cam Switch_Bk Plc Mc [} 54] function block. Syntax TYPE CAMSWITCH_REF_Bk Plc Mc: STRUCT Switch: ARRAY [ci Bk Plc Mc_Cam Switch Ref_Min Idx..ci Bk Plc Mc_Cam Switch Ref_Max Idx] OF MC_CAMSWITCH _REFTYPE_Bk Plc Mc; END_STRUCT END_TYPE TYPE MC_CAMSWITCH_REFTYPE_Bk Plc Mc: STRUCT Track Number: INT; First On Position: LREAL; Last On Position: LREAL; Axis Direction: INT; Cam Switch Mode: INT; Duration: LREAL; (* private members, do not touch *) n Current State: SINT:=0; b Triggered: BOOL:=FALSE; f Timer: LREAL; (**) END_STRUCT END_TYPE TF5810 Version: 1.8.3 123
## Page 124

PLCopen Motion Control Parameter Name Type Description Track Number INT This is an index in an ARRAY [ci Bk Plc Mc_Track Ref_Min Idx..ci Bk Plc Mc_Track Ref_Max Idx] OF MC_TRACK_REF_Bk Plc Mc [} 126], which is transferred to a function block of type MC_Digital Cam Switch_Bk Plc Mc [} 54]. First On Position LREAL [mm] The start of the cam track. For time-controlled cams, this is the trigger position. Last On Position LREAL [mm] The end of the cam track. Has no effect for time-controlled cams. Axis Direction INT Specifies in which direction of movement the cam becomes active: 0 = both directions, 1 = positive direction, 2 = negative direction. Cam Switch Mode INT The operating mode of the cam: For displacement-controlled cams enter 0, for time-controlled cams enter 1. Duration LREAL [s] For time-controlled cams enter the switch-on time in seconds. n Current State SINT These elements are runtime variables and must not be influenced or used by the application. b Triggered BOOL f Timer LREAL 4.3.16 MC_Direction_Bk Plc Mc Available from version 3.0 The constants listed here are used to identify the direction in which axes are moving. Syntax TYPE MC_Direction_Bk Plc Mc: ( MC_Positive_Direction_Bk Plc Mc := 1, MC_Shortest_Way_Bk Plc Mc, MC_Negative_Direction_Bk Plc Mc, MC_Current_Direction_Bk Plc Mc, MC_Switch Positive_Direction_Bk Plc Mc, MC_Switch Negative_Direction_Bk Plc Mc ); END_TYPE Values Name Description MC_Positive_Direction_Bk Plc Mc The movement is in the direction of rising values of position. MC_Shortest_Way_Bk Plc Mc The direction of movement is selected so that the distance covered is as short as possible. MC_Negative_Direction_Bk Plc Mc The movement is in the direction of falling values of position. MC_Current_Direction_Bk Plc Mc The movement is in the same direction as the most recently executed movement. MC_Switch Positive_Direction_Bk Plc Mc not supported MC_Switch Negative_Direction_Bk Plc Mc not supported 124 Version: 1.8.3 TF5810
## Page 125

PLCopen Motion Control 4.3.17 MC_Homing Mode_Bk Plc Mc Available from version 3.0 The constants in this list are used for identifying the modes during axis homing. Syntax TYPE MC_Homing Mode_Bk Plc Mc: ( MC_Default Homing Mode_Bk Plc Mc, MC_Abs Switch_Bk Plc Mc, MC_Limit Switch_Bk Plc Mc, MC_Ref Pulse_Bk Plc Mc, MC_Direct_Bk Plc Mc, MC_Absolute_Bk Plc Mc, MC_Block_Bk Plc Mc, MC_Flying Switch_Bk Plc Mc, MC_Flying Ref Pulse_Bk Plc Mc ); END_TYPE Values Name Description MC_Default Homing Mode_Bk Plc Mc The referencing method specified in the axis parameters is used. MC_Abs Switch_Bk Plc Mc The method i Tc Mc_Homing On Index is used. MC_Limit Switch_Bk Plc Mc not supported MC_Ref Pulse_Bk Plc Mc The method i Tc Mc_Homing On Sync is used. MC_Direct_Bk Plc Mc The method i Tc Mc_Homing On Exec is used. MC_Absolute_Bk Plc Mc not supported MC_Block_Bk Plc Mc The method i Tc Mc_Homing On Block is used. MC_Flying Switch_Bk Plc Mc not supported MC_Flying Ref Pulse_Bk Plc Mc not supported 4.3.18 MC_Start Mode_Bk Plc Mc Available from version 3.0 The constants in this list are used for identifying the modes during axis startups. Syntax TYPE MC_Start Mode_Bk Plc Mc: ( MC_Start Mode_Absolute:=1, MC_Start Mode_Relative, MC_Start Mode_Ramp In ); END_TYPE TF5810 Version: 1.8.3 125
## Page 126

PLCopen Motion Control Values Name Description MC_Start Mode_Absolute The set slave position determined by the MC_Cam In_Bk Plc Mc function block is regarded as absolute value. MC_Start Mode_Relative The set slave position determined by MC_Cam In_Bk Plc Mc function blocks is regarded as distance from the location of the coupling. MC_Start Mode_Ramp In Not supported 4.3.19 MC_TRACK_REF_Bk Plc Mc Available from version 3.0 Syntax TYPE TRACK_REF_Bk Plc Mc: STRUCT Track: ARRAY [ci Bk Plc Mc_Track REF_Min Idx..ci Bk Plc Mc_Track REF_Max Idx] OF MC_TRACK_REFTYPE _Bk Plc Mc; END_STRUCT END_TYPE TYPE MC_TRACK_REFTYPE_Bk Plc Mc: STRUCT On Compensation: LREAL; Off Compensation:LREAL; Hysteresis: LREAL; END_STRUCT END_TYPE Parameter Name Description On Compensation The switch-on dead time to be compensated in seconds. Off Compensation The switch-off dead time to be compensated in seconds. Hysteresis The axis must have moved away from the switching point by this distance before reaching of the switching point is evaluated again. If a positive value is specified as dead time compensation, signaling is delayed. A negative value leads to leading signaling. The time cannot be adhered to precisely, if the controlling parameter changes with a fluctuating rate. If this controlling parameter is an actual axis position, the actual axis velocity must be constant. 4.3.20 OUTPUT_REF_Bk Plc Mc Available from version 3.0 A structure of this type is transferred to function blocks of types MC_Read Digital Output_Bk Plc Mc() [} 34], MC_Write Digital Output_Bk Plc Mc() [} 47] and MC_Digital Cam Switch_Bk Plc Mc() [} 54]. Syntax TYPE OUTPUT_REF_Bk Plc Mc: STRUCT Output Bits: UDINT:=0; END_STRUCT END_TYPE 126 Version: 1.8.3 TF5810
## Page 127

PLCopen Motion Control Parameter Name Type Description Output Bits UDINT The outputs addressed via this structure. 4.3.21 ST_Function Generator FD_Bk Plc Mc Available from version 3.0.31 This structure consolidates parameter for the definition of the output signals of a function generator. A structure of this type is transferred to MC_Function Generator FD_Bk Plc Mc [} 226]() function blocks. Syntax TYPE ST_Function Generator FD_Bk Plc Mc : STRUCT Sin_Amplitude: LREAL:=0.0; Sin_Phase: LREAL:=0.0; Sin_Offset: LREAL:=0.0; Cos_Amplitude: LREAL:=0.0; Cos_Phase: LREAL:=0.0; Cos_Offset: LREAL:=0.0; Rect_Amplitude: LREAL:=0.0; Rect_Phase: LREAL:=0.0; Rect_Ratio: LREAL:=0.5; Rect_Offset: LREAL:=0.0; Saw_Amplitude: LREAL:=0.0; Saw_Phase: LREAL:=0.0; Saw_Ratio: LREAL:=0.5; Saw_Offset: LREAL:=0.0; END_STRUCT END_TYPE Parameter Name Type Description Sin_Amplitude LREAL The peak value of the signals. Cos_Amplitude Rect_Amplitude Saw_Amplitude Sin_Phase LREAL The phase shift of the signals. Cos_Phase Rect_Phase Saw_Phase Sin_Offset LREAL The zero offset of the signals. Cos_Offset Rect_Offset Saw_Offset Rect_Ratio LREAL The duty factor of the square or sawtooth signal. Saw_Ratio TF5810 Version: 1.8.3 127
## Page 128

PLCopen Motion Control 4.3.22 ST_Function Generator TB_Bk Plc Mc Available from version 3.0.31 This structure consolidates parameters for the time base of one or several function generators. A structure of this type is transferred to MC_Function Generator TB_Bk Plc Mc [} 228](), MC_Function Generator FD_Bk Plc Mc [} 127]() and MC_Function Generator Set Frq_Bk Plc Mc [} 227]() function blocks. Syntax TYPE ST_Function Generator TB_Bk Plc Mc : STRUCT Frequency: LREAL:=0.000001; Freeze: BOOL:=FALSE; Cycle Count: DINT:=0; Current Time: LREAL:=0.0; Current Ratio: LREAL:=0.0; END_STRUCT END_TYPE Parameter Name Type Description Frequency LREAL The operating frequency of the time base generated by an MC_Function Generator TB_Bk Plc Mc [} 228]() function block in Hertz. Freeze BOOL If this variable is set to TRUE, a MC_Function Generator TB_Bk Plc Mc [} 228]() function block will not evaluate the structure. Cycle Count DINT The number of fully generated signal sequences. Current Time LREAL The time elapsed since the currently created signal sequence. Current Ratio LREAL The normalized progress since the start of the currently generated signal sequence. 4.3.23 ST_Tc Mc Auto Ident Available from version 3.0.4 In this structure the parameters for an MC_Ax Uti Auto Ident_Bk Plc Mc function block are stored. It contains further information about the purpose of the individual elements. Syntax TYPE ST_Tc Mc Auto Ident : (* last modification: 08.11.2019 *) STRUCT End Of Travel_Negativ: LREAL:=0.0; End Of Travel_Positiv: LREAL:=0.0; End Of Travel_Negativ Limit: LREAL:=0.0; End Of Travel_Positiv Limit: LREAL:=0.0; Deceleration Factor: LREAL:=1.0; End Of Velocity_Negativ Limit: LREAL:=0.0; End Of Velocity_Positiv Limit: LREAL:=0.0; End Of Travel_Last Ident_P: LREAL:=0.0; End Of Travel_Last Ident_M: LREAL:=0.0; Valve Characteristic Low End: LREAL:=0.0; Valve Characteristic High End: LREAL:=0.0; Valve Characteristic Ramp: LREAL:=0.0; Valve Characteristic Settling:LREAL:=0.0; (* starting with V3.0.32 *) Valve Characteristic Recovery:LREAL:=0.0; Valve Characteristic Min Cycle:LREAL:=0.0; Valve_Lin Limit P: LREAL:=0.0; (* starting with V3.0.46 *) 128 Version: 1.8.3 TF5810
## Page 129

PLCopen Motion Control Valve_Lin Limit M: LREAL:=0.0; Valve Characteristic Table: ARRAY[1..100,1..2] OF LREAL; End Of Increments_Negativ: DINT:=0; End Of Increments_Positiv: DINT:=0; Valve Characteristic Type: INT:=0; (* starting with V3.0.33 *) Valve Characteristic Tbl Count:INT:=0; Enable End Of Travel: BOOL:=FALSE; Enable Overlap: BOOL:=FALSE; Enable Zero Adjust: BOOL:=FALSE; Enable Arrea Ratio: BOOL:=FALSE; End Of Travel_Positiv Done: BOOL:=FALSE; End Of Travel_Negativ Done: BOOL:=FALSE; Enable Valve Characteristic: BOOL:=FALSE; Enable No Uturn: BOOL:=FALSE; END_STRUCT END_TYPE Parameter Name Type Description End Of Travel_Negativ LREAL End Of Travel_Positiv LREAL End Of Travel_Negativ Limit LREAL End Of Travel_Positiv Limit LREAL Deceleration Factor LREAL End Of Velocity_Negativ Limit LREAL End Of Velocity_Positiv Limit LREAL End Of Travel_Last Ident_P LREAL End Of Travel_Last Ident_M LREAL Valve Characteristic Low End LREAL Valve Characteristic High End LREAL Valve Characteristic Ramp LREAL Valve Characteristic Settling LREAL Valve Characteristic Recovery LREAL Valve Characteristic Min Cycle LREAL Valve_Lin Limit P LREAL Valve_Lin Limit M LREAL Valve Characteristic Table ARRAY End Of Increments_Negativ DINT End Of Increments_Positiv DINT Valve Characteristic Type INT Valve Characteristic Tbl Count INT Enable End Of Travel BOOL Enable Overlap BOOL Enable Zero Adjust BOOL Enable Arrea Ratio BOOL End Of Travel_Positiv Done BOOL End Of Travel_Negativ Done BOOL Enable Valve Characteristic BOOL Enable No Uturn BOOL TF5810 Version: 1.8.3 129
## Page 130

PLCopen Motion Control 4.3.24 ST_Tc Hyd Ax Param Available from version 3.0 This structure contains all axis parameters. Also see about this: Suitable procedures for axis commissioning [} 380]. The order of the parameters is not guaranteed. Syntax TYPE ST_Tc Hyd Ax Param : (* last modification: 08.07.2020 *) STRUCT (* ================================================================== this section isn't saved / dieser Bereich wird nicht gesichert ================================================================== *) s Param File Name: STRING(255) := 'Def Ax Parm File.dat'; (* ================================================================== from this point all parameters are saved / von hier an werden alle Parameter gesichert ================================================================== *) f Acc: LREAL := 2000.0; f Area Ratio: LREAL := 1.0; f Brake Dead Time M: LREAL := 0.0; f Brake Dead Time P: LREAL := 0.0; f Brake Distance M: LREAL := 0.1; f Brake Distance P: LREAL := 0.1; f Brake Off Delay: LREAL := 0.0; f Brake On Delay: LREAL := 0.0; f Brake Safety Delay: LREAL := 0.0; f Creep Distance M: LREAL := 1.0; f Creep Distance P: LREAL := 1.0; f Creep Speed M: LREAL := 80.0; f Creep Speed P: LREAL := 80.0; f Customer Data: ARRAY [1..i Tc Hydf Cust Data Max Idx] OF LREAL; f Cycletime: LREAL := 0.010; f Cylinder_Arrea A: LREAL := 1.0; f Cylinder_Arrea B: LREAL := 1.0; f Cylinder_Mass: LREAL := 1.0; f Cylinder_Stroke: LREAL := 1.0; f Dec: LREAL := 2000.0; f Drive_Inc Interpolation: LREAL := 1.0; f Drive_Inc Weighting: LREAL := 0.001; f Emergency Ramp: LREAL := 0.1; f Enc_Base Distance: LREAL := 0.001; f Enc_Default Home Position: LREAL := 0.0; f Enc_Inc Interpolation: LREAL := 1.0; f Enc_Inc Weighting: LREAL := 0.001; f Enc_Modulo Base: LREAL := 0.001; f Enc_Poti Rg To Rl: LREAL := 0.0; f Enc_Ref Index Velo: LREAL := 0.1; f Enc_Ref Sync Velo: LREAL := 0.1; f Enc_Zero Shift: LREAL := 0.0; f Jog Velo Fast: LREAL := 100.0; f Jog Velo Slow: LREAL := 25.0; f Feed Forward: LREAL := 1.0; f Acc Feed Forward: LREAL := 0.0; f Lag Amp: LREAL := 0.05; f Lag Amp Dp: LREAL := 0.0; f Lag Amp Dx: LREAL := 0.0; f Lag Amp Ti: LREAL := 0.0; f Lag Amp Out L: LREAL := 0.0; f Lag Amp Wu L: LREAL := 0.0; f Lag Amp Td: LREAL := 0.0; f Lag Amp Tdd: LREAL := 0.0; f Lag Amp Cfb_k V: LREAL := 0.0; f Lag Amp Cfb_t V: LREAL := 0.0; f Lag Amp Cfb_k A: LREAL := 0.0; f Lag Amp Cfb_t A: LREAL := 0.0; f Lag Amp Cfb_k F: LREAL := 0.0; 130 Version: 1.8.3 TF5810
## Page 131

PLCopen Motion Control f Lag Amp Cfb_t F: LREAL := 0.0; f Max Acc: LREAL := 500.0; f Max Dec: LREAL := 500.0; f Max Dynamic Lag: LREAL := 0.0; f Max Jerk: LREAL := 1000.0; f Max Lag: LREAL := 0.0; f Max Lag Filter: LREAL := 0.0; f Max Velo: LREAL := 500.0; f Mon Position Range: LREAL := 1.0; f Mon Target Filter: LREAL := 1.0; f Mon Target Range: LREAL := 1.0; f PEH_Timeout: LREAL := 0.0; f Ref Velo: LREAL := 500.0; f Repos Distance: LREAL := 0.0; f Soft End Max: LREAL := 10000.0; f Soft End Min: LREAL := 0.0; f Start Acc Distance: LREAL := 1.0; f Start Ramp: LREAL := 1.0; f Stop Ramp: LREAL := 1.0; f Target Clamping: LREAL := 0.0; f Velo Amp: LREAL := 0.0; f Velo Amp Dx: LREAL := 0.0; f Velo Amp Ti: LREAL := 0.0; f Velo Amp Out L: LREAL := 0.0; f Velo Amp Wu L: LREAL := 0.0; f Valve_Bend Point Output: LREAL := 0.0; f Valve_Bend Point Velo: LREAL := 0.0; f Valve_Overlap Comp M: LREAL := 0.0; f Valve_Overlap Comp P: LREAL := 0.0; f Valve_Response Time: LREAL := 0.0; f Zero Compensation: LREAL := 0.0; n Enc_Overrun Mask: DWORD := 0; n Enc_Position Mask: DWORD := 0; n Enc_Zero Swap: DINT := 0; n Dig In Reversed: DINT := 0; n Cycle Divider: INT := 1; n Drive_Type: E_Tc Mc Drive Type:=i Tc Mc_Drive_Customized; n Enc_Homing Type: E_Tc Mc Homing Type:=i Tc Mc_Homing On Block; n Enc_Type: E_Tc Mc Encoder Type:=i Tc Mc_Encoder Sim; n Jerk Enabled: WORD := 16#0101; n Profile Type: E_Tc Mc Profile Type:=i Tc Mc_Profile Ctrl Based; n Controller Type: WORD := 16#0101; n Overlap Def Mode: WORD := 0; b Asymetrical Targeting: BOOL := FALSE; b Drive_Absolute Output: BOOL := FALSE; b Drive_Default Power Ok: BOOL := FALSE; b Drive_Reversed: BOOL := FALSE; b Enable Auto Brake Distance: BOOL := FALSE; b Enable Control Loop On Fault: BOOL := FALSE; b Enc_Ref Index Positive: BOOL := FALSE; b Enc_Ref Sync Positive: BOOL := FALSE; b Enc_Reversed: BOOL := FALSE; b Max Lag Ena: BOOL := FALSE; b PEH_Enable: BOOL := FALSE; b Pos Ctrl Acc Ena: BOOL := FALSE; b Soft End Max Ena: BOOL := FALSE; b Soft End Min Ena: BOOL := FALSE; b Time Based: BOOL := FALSE; b Lin Tab Available: BOOL := FALSE; b Enc_No Up Load: BOOL := FALSE; b Drive_No Up Load: BOOL := FALSE; b Drive Is Hybrid: BOOL := FALSE; b Aligned Start: BOOL := FALSE; b Enc Modulo Mode: BOOL := FALSE; (*-----------------------------------------------------------------*) st Hybrid: ST_Tc Hybrid Ax Param; st Pctrl: ST_Tc Pctrl Param; END_STRUCT END_TYPE TF5810 Version: 1.8.3 131
## Page 132

PLCopen Motion Control Parameter 132 Version: 1.8.3 TF5810
## Page 133

PLCopen Motion Control Name Type Description s Param File Name STRING This file name is used for storing the axis parameter as a DAT file. f Acc LREAL [mm/s2] The absolute acceleration limitation of the axis. f Area Ratio LREAL [1] This parameter can be used to compensate the directional dependence of the velocity. f Brake Dead Time M LREAL [s] From V3.0.8: This parameter makes it possible to extend the set braking distance for the negative direction by an amount proportional to the actual velocity. f Brake Dead Time P LREAL [s] From V3.0.8: This parameter makes it possible to extend the set braking distance for the positive direction by an amount proportional to the actual velocity. f Brake Distance M LREAL [mm] From V3.0.8: Braking distance: If b Asymetrical Targeting is TRUE, at this negative distance from the target, active profile- controlled control value generation ceases; optionally a standstill position controller or a different mechanism that applies at target is activated. f Brake Distance P LREAL [mm] From V3.0.8: Braking distance: At this non-direction- dependent or (if b Asymetrical Targeting is TRUE) positive distance from the target, active profile-controlled control value generation ceases; optionally a standstill position controller or a different mechanism that applies at target is activated. f Brake Off Delay LREAL [s] If this parameter is set to a value greater than 0, the control value generator observes a delay time between the rising edge at ST_Tc Plc Device Output.b Brake Off and the start of the acceleration phase. f Brake On Delay LREAL [s] If this parameter is set to a value greater than 0, the control value generator observes a delay time between the end of the active profile generation and the falling edge at ST_Tc Plc Device Output [} 153].b Brake Off. TF5810 Version: 1.8.3 133
## Page 134

PLCopen Motion Control Name Type Description f Brake Safety Delay LREAL [s] If this parameter is set to a value greater than 0, the control value generator at the falling edge at ST_Tc Plc Device Output [} 153].b Brake Off observes a delay time between the end of an active profile generation and the rising edge of the next motion command. f Creep Distance M LREAL [mm] From V3.0.8: If b Asymetrical Targeting is TRUE, f Creep Speed M is used as the control value from this negative distance to the target for the last phase of the profile-controlled control value generation. f Creep Distance P LREAL [mm] From V3.0.8: From this non- direction-dependent or (with b Asymetrical Targeting = TRUE) positive distance to the target, f Creep Speed P is used as the control value for the last phase of profile-controlled control value generation. f Creep Speed M LREAL [mm/s] From V3.0.8: If b Asymetrical Targeting is TRUE and the direction of movement is negative, this velocity is used for the last phase of the profile- controlled control value generation. f Creep Speed P LREAL [mm/s] From V3.0.8: This velocity is used, in non-direction-dependent mode, or (if b Asymetrical Targeting is TRUE) if the direction of movement is positive, for the last phase of the profile-controlled control value generation. f Customer Data ARRAY 20 LREAL parameters are available for use by the application, as required. They are loaded and stored together with the other axis parameters. Library function blocks do not use these parameters independently, by the application can instruct to use them based on the type of call. f Cycletime LREAL [s] The cycle time of the PLC task, from which the library function blocks are called. This value is determined automatically by an MC_Ax Uti Standard Init_Bk Plc Mc [} 254]() function block and may be used but not be changed by the application. f Cylinder_Arrea A LREAL [mm2] The active area of the cylinder, which is under pressure during a motion in positive direction. 134 Version: 1.8.3 TF5810
## Page 135

PLCopen Motion Control Name Type Description f Cylinder_Arrea B LREAL [mm2] The active area of the cylinder, which is under pressure during a motion in negative direction. f Cylinder_Mass LREAL reserved. f Cylinder_Stroke LREAL reserved. f Dec LREAL f Dec: [mm/s2] The absolute deceleration limitation of the axis. f Drive_Inc Interpolation LREAL This parameter is used in some output devices for internal conversion of the velocity control value. f Drive_Inc Weighting LREAL This parameter is used in some output devices for internal conversion of the velocity control value. f Emergency Ramp LREAL [s] This parameter specifies the time required for deceleration from f Ref Velo to standstill. It is used by different control value generators in response to unscheduled emergency stop requests (lack of controller enable, fault condition, function block call). f Enc_Base Distance LREAL [mm] This parameter is used for the evaluation of encoders with distance-coded zero marks. f Enc_Default Home Position LREAL [mm] This parameter can be used to store a position, which can be transferred as reference position to an MC_Home_Bk Plc Mc [} 68]() function block. If homing is triggered by the Plc Mc Manager, the value stored here is used in this way. If this is also intended to be the case if homing is triggered by the PLC application, this parameter should be transferred when the used function block is called. f Enc_Inc Interpolation LREAL [mm/n] This parameter specifies the resolution with which the actual position of the axis is determined. f Enc_Inc Weighting LREAL [1] This parameter specifies the resolution with which the actual position of the axis is determined. f Enc_Modulo Base LREAL f Enc_Poti Rg To Rl LREAL [1] It is used by some function blocks for linearization of simple potentiometer displacement transducer, which are subject to load from the input resistance of the interface electronics. f Enc_Ref Index Velo LREAL [1] This parameter specifies the control value as a proportion of f Ref Velo, which is output during a search for the reference index (cam) during homing. TF5810 Version: 1.8.3 135
## Page 136

PLCopen Motion Control Name Type Description f Enc_Ref Sync Velo LREAL 81] This parameter specifies the control value as a proportion of f Ref Velo, which is output during a search for the reference pulse (sync pulse, zero pulse) during homing. f Enc_Zero Shift LREAL [mm] This parameter shifts the zero point of the actual value determination of the axis. f Jog Velo Fast LREAL [mm/s] Set velocity for fast manual travel. f Jog Velo Slow LREAL [mm/s] Set velocity for slow manual travel. f Feed Forward LREAL f Acc Feed Forward LREAL [s] The optional acceleration pre- control of the axis. f Lag Amp LREAL [mm/s per mm → 1/s] The Kp amplification of the standstill position controller. f Lag Amp Dp LREAL [mm] In preparation: The response window of the extended standstill position controller. f Lag Amp Dx LREAL [mm] In preparation: The response window of the standstill position controller. f Lag Amp Ti LREAL In preparation: The integration time of the standstill position controller. f Lag Amp Out L LREAL In preparation: The output limit of the standstill position controller. f Lag Amp Wu L LREAL In preparation: The limit of the I part standstill position controller. f Lag Amp Td LREAL [1] Optional: Rate time of the differential part of the position controller. This parameter is only used by MC_Ax Rt Pos Pi Controller Ex_Bk P lc Mc(). f Lag Amp Tdd LREAL [s] Optional: Damping time of the differential part of the position controller. This parameter is only used by MC_Ax Rt Pos Pi Controller Ex_Bk P lc Mc(). f Lag Amp Cfb_k V LREAL V: : [1] Optional: Weighting factor of the actual velocity activation in the condition feedback of the position controller. This parameter is only used by MC_Ax Rt Pos Pi Controller Ex_Bk P lc Mc(). 136 Version: 1.8.3 TF5810
## Page 137

PLCopen Motion Control Name Type Description f Lag Amp Cfb_t V LREAL [1] Optional: Filter time of the actual velocity activation in the condition feedback of the position controller. This parameter is only used by MC_Ax Rt Pos Pi Controller Ex_Bk P lc Mc(). f Lag Amp Cfb_k A LREAL [1] Optional: Weighting factor of the actual acceleration activation in the condition feedback of the position controller. This parameter is only used by MC_Ax Rt Pos Pi Controller Ex_Bk P lc Mc(). f Lag Amp Cfb_t A LREAL [1] Optional: Filter time of the actual acceleration activation in the condition feedback of the position controller. This parameter is only used by MC_Ax Rt Pos Pi Controller Ex_Bk P lc Mc(). f Lag Amp Cfb_k F LREAL [1] Optional: Weighting factor of the actual force activation in the condition feedback of the position controller. This parameter is only used by MC_Ax Rt Pos Pi Controller Ex_Bk P lc Mc(). f Lag Amp Cfb_t F LREAL [1] Optional: Filter time of the actual force activation in the condition feedback of the position controller. f Max Acc LREAL [mm/s2] The axis acceleration limitation applicable to the function blocks. This value is limited to f Acc. f Max Dec LREAL [mm/s2] The axis deceleration limitation applicable to the function blocks. This value is limited to f Dec. f Max Dynamic Lag LREAL [s] This parameter specifies one of the limit values for the lag monitoring. f Max Jerk LREAL [mm/s3] The axis jerk limitation applicable to the function blocks. This value is used if i Tc Mc_Profile Jerk Based is set as profile type. f Max Lag LREAL [mm] This parameter specifies one of the limit values for the lag monitoring. f Max Lag Filter LREAL [s] This parameter specifies one of the limit values for the lag monitoring. TF5810 Version: 1.8.3 137
## Page 138

PLCopen Motion Control Name Type Description f Max Velo LREAL [mm/s] The maximum velocity that can be used by function blocks. If a function block tries to use a higher value, the value is generally limited accordingly without an error message. This parameter is limited to f Ref Velo. f Mon Position Range LREAL [mm] This parameter is used for target window monitoring. f Mon Target Filter LREAL [s] This parameter is used for target window monitoring. f Mon Target Range LREAL [mm] This parameter is used for target window monitoring. f PEH_Timeout LREAL [s] This parameter specifies the limit value for PEH monitoring. f Ref Velo LREAL [mm/s] This parameter specifies the maximum absolute axis velocity. f Repos Distance LREAL [mm] If this parameter is greater than 0 and the axis has moved beyond the target by more than this distance, target positioning is automatically applied again. f Soft End Max LREAL [mm] The upper (positive) software limit switch. f Soft End Min LREAL [mm] The lower (negative) software limit switch. f Start Acc Distance LREAL obsolete, will be removed in the near future. f Start Ramp LREAL [s] This parameter specifies the time required in profile type i Tc Mc_Profile Time Ramp to accelerate to f Ref Velo. f Stop Ramp LREAL [s] This parameter specifies the time required for deceleration from f Ref Velo to standstill. It is used in profile type i Tc Mc_Profile Time Ramp for the target approach, and also by control value generators in response to unscheduled stop requests (lack of feed enable, fault condition, function block call). f Target Clamping LREAL [v] If this parameter is set to a value greater than zero, this control value is output with the correct sign when a target is reached. A position control is suppressed. f Velo Amp LREAL The Kp gain of the lower-level velocity controller. f Velo Amp Dx LREAL The response window of the lower- level velocity controller. f Velo Amp Ti LREAL The integration time of the lower- level velocity controller. f Velo Amp Out L LREAL The output limitation of the lower- level velocity controller. 138 Version: 1.8.3 TF5810
## Page 139

PLCopen Motion Control Name Type Description f Velo Amp Wu L LREAL Limitation of the I part of the lower- level velocity controller. f Valve_Bend Point Output LREAL [1] In valves with a bend in the characteristic curve, this parameter can be used for simple linearization. f Valve_Bend Point Velo LREAL [1] In valves with a bend in the characteristic curve, this parameter can be used for simple linearization. f Valve_Overlap Comp M LREAL [1] From V3.0.8: Compensation (if b Asymetrical Targeting = TRUE) for of a valve overlap used for the negative direction. f Valve_Overlap Comp P LREAL [1] From V3.0.8: Compensation of a non-direction-dependent valve overlap or (if b Asymetrical Targeting = TRUE) a valve overlap used for the positive direction. f Valve_Response Time LREAL [s] This parameter can be used for dead time compensation of the actuator. f Zero Compensation LREAL [V] This parameter can be used to compensate an analog offset of the velocity output. n Enc_Overrun Mask DWORD n Enc_Position Mask DWORD n Enc_Zero Swap DINT reserved. n Dig In Reversed DINT n Cycle Divider INT reserved. n Drive_Type E_Tc Mc Drive Type Specifies the drive type [} 94]. n Enc_Homing Type E_Tc Mc Homing Type Used to specify the referencing method, which an MC_Home_Bk Plc Mc() [} 68] function block uses if MC_Default Homing Mode_Bk Plc Mc [} 125] is transferred as Homing Mode. n Enc_Type E_Tc Mc Encoder Type Specifies the encoder type [} 98]. n Jerk Enabled WORD This bit mask determines at which transitions in the profile jerk limitation is to be applied. This value is used if i Tc Mc_Profile Jerk Based is set as profile type. n Profile Type E_Tc Mc Profile Type Specifies the control value generator [} 118]. n Controller Type WORD This parameter is set automatically by the called position controller. It is not saved. n Overlap Def Mode WORD reserved. TF5810 Version: 1.8.3 139
## Page 140

PLCopen Motion Control Name Type Description b Asymetrical Targeting BOOL From V3.0.8: If this parameter is TRUE, direction-dependent parameters take effect during target approach and overlap compensation. b Drive_Absolute Output BOOL If this parameter is set to TRUE, control values are always output positively, regardless of the direction. b Drive_Default Power Ok BOOL If this parameter is set, the Power Ok feedback in the ST_Tc Plc Device Input [} 149] structure of the axis is ignored. b Drive_Reversed BOOL If this parameter is set, the control value output is negated. b Enable Auto Brake Distance BOOL If this parameter is TRUE, f Creep Distance M and f Creep Distance P are calculated automatically from f Creep Speed M or f Creep Speed P and f Lag Amp. b Enable Control Loop On Fault BOOL If this parameter is TRUE, the standstill position controller of the axis also becomes active in the event of an error. Requirement: Its parameters are suitable for this, and the axis is in a suitable state. b Enc_Ref Index Positive BOOL If this parameter is set, while searching for the reference index (cam) during homing a positive control value is output, otherwise a negative value. b Enc_Ref Sync Positive BOOL If this parameter is set, while searching for the reference pulse (sync pulse, zero pulse) during homing a positive control value is output, otherwise a negative value. b Enc_Reversed BOOL If this parameter is set, the actual position value is evaluated in negated form. b Max Lag Ena BOOL This parameter activates lag monitoring. b PEH_Enable BOOL This parameter activates the PEH monitoring. b Pos Ctrl Acc Ena BOOL obsolete, will be removed in the near future. b Soft End Max Ena BOOL This parameter activates the upper software limit switch. b Soft End Min Ena BOOL This parameter activates the lower software limit switch. b Time Based BOOL If this parameter is TRUE, the profile calculations are timer- controlled. The position controller is always active. 140 Version: 1.8.3 TF5810
## Page 141

PLCopen Motion Control Name Type Description b Lin Tab Available BOOL TRUE here means that each pointer was associated with a linearization table during initialization, which contains a successfully determined characteristic curve. b Enc_No Up Load BOOL If this parameter is set, no parameters are read from the device, even in configurations with fieldbus encoders. b Drive_No Up Load BOOL If this parameter is set, no parameters are read from the device, even in configurations with fieldbus drives and valves. b Drive Is Hybrid BOOL This parameter is used to identify a servo-electric/hydraulic hybrid axis. The extended parameters in st Hybrid take effect and appear in the Plc Mc Manager. b Aligned Start BOOL From V3.x.y: If this parameter is TRUE, a jump of the output is avoided when starting from a lag error. b Enc Modulo Mode BOOL reserved. st Hybrid ST_Tc Hybrid Ax Param This structure pools parameters for hybrid electro/hydraulic axes. st Pctrl ST_Tc Pctrl Param This structure contains parameters that can be used for a force or pressure controller. f Brake Distance: [mm] Up to V3.0.7: Braking distance: At this non-direction-dependent positive distance from the target, active profile-controlled control value generation ceases; optionally a standstill position controller or a different mechanism that applies at target is activated. f Brake Dead Time:[s] Up to V3.0.7: This parameter allows to extend the set braking distance with a portion proportional to the actual speed. f Creep Speed:[mm/s] Up to V3.0.7: This velocity is used non-direction-dependent for the last phase of profile-controlled control value generation. f Creep Distance:[mm] Up to V3.0.7: From this non-direction-dependent distance to the target, f Creep Speed is used as the control value for the last phase of profile-controlled control value generation. This parameter is only used by MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc(). f Valve_Overlap Comp:[1] Up to V3.0.7: Compensation of a non-direction-dependent valve overlap. See Commissioning [} 380] for more information about axis commissioning. 4.3.25 ST_Tc Hyd Ax Rt Data Available from version 3.0 The variables in this structure indicate the runtime state of the axis. TF5810 Version: 1.8.3 141
## Page 142

PLCopen Motion Control The order of the data is not guaranteed. Syntax TYPE ST_Tc Hyd Ax Rt Data : (* last modification: 02.07.2018 *) STRUCT (*-------------------------------*) f Act Force: LREAL := 0.0; f Active Overlap: LREAL := 0.0; f Act Pos: LREAL := 0.0; f Act Pos Delta: LREAL := 0.0; f Act Pos Offset: LREAL := 0.0; f Act Pressure: LREAL := 0.0; f Act Pressure A: LREAL := 0.0; f Act Pressure B: LREAL := 0.0; f Act Velo: LREAL := 0.0; f Brake Off Timer: LREAL := 0.0; f Brake On Timer: LREAL := 0.0; f Brake Safety Timer: LREAL := 0.0; f Clamping Output: LREAL := 0.0; f Dest Acc: LREAL := 0.0; f Dest Creep Distance M: LREAL := 0.0; f Dest Creep Distance P: LREAL := 0.0; f Dest Creep Speed M: LREAL := 0.0; f Dest Creep Speed P: LREAL := 0.0; f Dest Dec: LREAL := 0.0; f Dest Jerk: LREAL := 0.0; f Dest Pos: LREAL := 0.0; f Dest Ramp End: LREAL := 0.0; f Dest Speed: LREAL := 0.0; f Distance To Target: LREAL := 0.0; f Enc_Ref Shift: LREAL := 0.0; f Enc_Zero Swap: LREAL := 0.0; f Gear Active: LREAL := 0.0; f Gear Setting: LREAL := 0.0; f Lag Ctrl Output: LREAL := 0.0; f Latched Pos: LREAL := 0.0; f Oil Requirred_A: LREAL := 0.0; f Oil Requirred_B: LREAL := 0.0; f Oil Used_A: LREAL := 0.0; f Oil Used_B: LREAL := 0.0; f Output: LREAL := 0.0; f Override: LREAL := 1.0; f Param Acc Time: LREAL := 0.0; f Pos Error: LREAL := 0.0; f Set Acc: LREAL := 0.0; f Set Pos: LREAL := 0.0; f Set Pressure: LREAL := 0.0; f Set Speed: LREAL := 0.0; f Set Speed Old: LREAL := 0.0; f Set Velo: LREAL := 0.0; f Start Pos: LREAL := 0.0; f Start Ramp: LREAL := 0.0; f Start Ramp Anchor: LREAL := 0.0; f Supply Pressure: LREAL := 0.0; f Target Pos: LREAL := 0.0; f Timer PEH: LREAL := 0.0; f Timer TPM: LREAL := 0.0; f Valve Pressure: LREAL := 0.0; f Velo Error: LREAL := 0.0; f Block Detect Delay: LREAL := 2.0; (*------------------------------------------------------*) n Axis State: DWORD := 0; n Calibration State: DWORD := 0; n De Ctrl DWord: DWORD := 0; n Error Code: DWORD := 0; n State DWord: DWORD := 0; udi Amp Error Code: UDINT; (*------------------------------------------------------*) i Current Step: E_Tc Mc Current Step; w Enc Err Mask: WORD:=0; w Enc Err Mask Inv: WORD:=0; n Drv Wc Count: INT:=0; (**) n Enc Wc Count: INT:=0; 142 Version: 1.8.3 TF5810
## Page 143

PLCopen Motion Control n Drv Device State: UINT:=0; n Enc Device State: INT:=0; (*------------------------------------------------------*) b Act Pos Cams: BYTE := 0; b Brake Off: BOOL := FALSE; b Brake Off Inverted: BOOL := FALSE; b Controllable: BOOL := FALSE; b Counted Cycles: BYTE := 1; b Cycle Counter: BYTE := 0; b Drive Response: BOOL := FALSE; b Enc Do Latch: BOOL := FALSE; (**) b Encoder Response: BOOL := FALSE; b Enc Latch Valid: BOOL := FALSE; b Locked_Estop: BOOL := FALSE; b Params Unsave: BOOL := FALSE; b Reload Params: BOOL := FALSE; b Targeting: BOOL := FALSE; b Unaligned Overlap: BOOL := FALSE; b Act Pos Offset Enable: BOOL := FALSE; (* starting with 09.03.2015 *) (**) b Drive Startup: BOOL := FALSE; b Enc Align Ref Shift: BOOL := FALSE; b Drv Wcs Error: BOOL := FALSE; b Enc Wcs Error: BOOL := FALSE; b First Wcs: BOOL := FALSE; b Change Count: BYTE := 0; b Start Auto Ident: BOOL := FALSE; b Param File Complete: BOOL := FALSE; (*------------------------------------------------------*) p Master Rt Data: POINTER TO BYTE; p Master Param: POINTER TO BYTE; (*------------------------------------------------------*) udi Serc Device ID: UDINT := 0; ui Serc Box Addr: UINT := 0; ui Serc Port: UINT := 0; (*------------------------------------------------------*) st Pos Ctrlr: stbkplcinternal_cplxctrl; st Velo Ctrlr: stbkplcinternal_cplxctrl; (*------------------------------------------------------*) s Top Block Name: STRING(87) := ''; st Hybrid: ST_Tc Hybrid Ax Rt Data; (*------------------------------------------------------*) END_STRUCT END_TYPE TF5810 Version: 1.8.3 143
## Page 144

PLCopen Motion Control Parameter 144 Version: 1.8.3 TF5810
## Page 145

PLCopen Motion Control Name Type Description f Act Force LREAL [N, k N] Actual force of the cylinder. This value is usually determined by a function block for acquisition of actual force or pressure values [} 20]. f Active Overlap LREAL [1] The current output of the overlap compensation. An output variable of the profile generators. f Act Pos LREAL [mm] The current actual position of the axis. This value is usually determined by an encoder function block. f Act Pos Delta LREAL [mm] The change of the actual position relative to the previous cycle. f Act Pos Offset LREAL [mm] The offset used to influence the actual value. If b Act Pos Offset Enable is TRUE, this offset is added to f Act Pos. If f Act Pos Offset changes, f Act Velo is unaffected. If b Act Pos Offset Enable is TRUE, f Act Pos Offset takes effect immediately and without ramp. Note the information. [} 149] Example: If the reference position is 100.0 mm and the offset is 1.0 mm, the actual position at the point of the zero pulse is set to 101.0 mm. If influencing is subsequently disabled or set to 0.0, the actual position at the point of the zero pulse shows the value 100.0 mm, just like it would have done during homing without influencing. f Act Pressure LREAL [bar] Actual pressure in the cylinder. This value is usually determined by a function block for acquisition of actual force or pressure values [} 20]. f Act Pressure A LREAL [bar] Actual pressure on the A-side of the cylinder. This value is usually determined by a function block for acquisition of actual force or pressure values [} 20]. f Act Pressure B LREAL [bar] Actual pressure on the B-side of the cylinder. This value is usually determined by a function block for acquisition of actual force or pressure values [} 20]. f Act Velo LREAL [mm/s] The current actual velocity of the axis. This value is usually determined by an encoder function block. f Brake Off Timer LREAL f Brake On Timer LREAL f Brake Safety Timer LREAL f Clamping Output LREAL [V] An output variable of the profile generators. f Dest Acc LREAL [mm/s2] The acceleration specified by the current or last executed motion command. f Dest Creep Distance LREAL [mm] Up to V3.0.7: The creep distance. f Dest Creep Distance M LREAL [mm] Up to V3.0.8: The creep distance in negative direction. f Dest Creep Distance P LREAL [mm] Up to V3.0.8: The creep distance in positive direction. f Dest Creep Speed LREAL [mm/s] Up to V3.0.7: The creep speed. f Dest Creep Speed M LREAL From V3.0.8: The creep speed in negative direction. f Dest Creep Speed P LREAL [mm/s] From V3.0.8: The creep speed in positive direction. TF5810 Version: 1.8.3 145
## Page 146

PLCopen Motion Control Name Type Description f Dest Dec LREAL [mm/s2] The deceleration specified by the current or last executed motion command. f Dest Jerk LREAL [mm/s3] The jerk specified by the current or last executed motion command. f Dest Pos LREAL [mm] The currently active target position. f Dest Ramp End LREAL f Dest Speed LREAL [mm/s] The velocity specified by the current or last executed motion command. f Distance To Target LREAL [mm] The current remaining distance of the axis. This value is usually determined by a generator function block. f Enc_Ref Shift LREAL [mm] The offset between the converted (perhaps internal extended) counter value of an incremental encoder input terminal and the actual position of the axis. This offset is determined through homing, e.g. with an MC_Home_Bk Plc Mc [} 68] function block, or manipulated with an MC_Set Position_Bk Plc Mc [} 43] function block. f Enc_Zero Swap LREAL f Gear Active LREAL f Gear Setting LREAL f Lag Ctrl Output LREAL [1] The normalized output of the position controller. An output variable of the profile generators. f Latched Pos LREAL [mm] The position (taking into account current offsets) at which homing took place or where the components of the actual value acquisition (encoder, I/O electronics) were switched on. f Oil Requirred_A LREAL [l/min] The oil consumption on the A-side, calculated taking into account the set velocity. f Oil Requirred_B LREAL [l/min] The oil consumption on the B-side, calculated taking into account the set velocity. f Oil Used_A LREAL [l/min] The oil consumption on the A-side, calculated taking into account the actual velocity. f Oil Used_B LREAL [l/min] The oil consumption on the B-side, calculated taking into account the actual velocity. f Output LREAL [1] The control value to be output. This variable is used for communication between the MC_Ax Rt Finish_Bk Plc Mc [} 246] and MC_Ax Rt Drive_Bk Plc Mc [} 187] function blocks. f Override LREAL [1] The current axis velocity override. f Param Acc Time LREAL f Pos Error LREAL [mm] The current position error of the axis. f Set Acc LREAL [mm/s2] The current acceleration control value. An output variable of the profile generators. f Set Pos LREAL [mm] The current position command value of the axis. f Set Pressure LREAL [bar] The setpoint for an optional pressure or force control must be stored here. f Set Speed LREAL [mm/s] The normalized set velocity of the axis. An output variable of the profile generators. f Set Speed Old LREAL f Set Velo LREAL f Start Pos LREAL [mm] The start position of the current or last processed motion command. 146 Version: 1.8.3 TF5810
## Page 147

PLCopen Motion Control Name Type Description f Start Ramp LREAL f Start Ramp Anchor LREAL f Supply Pressure LREAL [bar] Supply pressure. This value is usually determined by a function block for acquisition of actual force or pressure values [} 20]. f Target Pos LREAL [mm] The target position specified by the current or last processed motion command. f Timer PEH LREAL f Timer TPM LREAL f Valve Pressure LREAL [bar] Pressure drop at the valve. This value is usually determined by a function block for acquisition of actual force or pressure values [} 20]. f Velo Error LREAL f Block Detect Delay LREAL [s] The delay time for the detection of the function block during homing on block. This value is initialized with 2.0 seconds to reflect the default behavior of previous versions. If a different time is required, it must be updated before homing commences. If a value of less than the cycle time is detected when homing commences, the default value of 2.0 seconds is entered automatically. This value is not saved as a parameter. This variable has been available under Twin CAT 2 in V3.0.41 from 12 October 2017. n Axis State DWORD The motion state of the axis. n Calibration State DWORD The current homing state. n De Ctrl DWord DWORD The control signals [} 339] of the axis. n Error Code DWORD The current Error Code [} 339] of the axis. n State DWord DWORD The state signals [} 338] of the axis. udi Amp Error Code UDINT i Current Step E_Tc Mc Current Step The internal state of the control value generators. Values from E_Tc Mc Current Step [} 90]. w Enc Err Mask WORD w Enc Err Mask Inv WORD n Drv Wc Count INT n Enc Wc Count INT n Drv Device State UINT n Enc Device State INT b Act Pos Cams BYTE The current position cam of the axis. This value is only used, if i Tc Mc_Encoder Dig Cam is set as encoder type. b Brake Off BOOL The control signal for an external brake. An output variable of the profile generators. b Brake Off Inverted BOOL The inverted b Brake Off signal. b Controllable BOOL b Counted Cycles BYTE b Cycle Counter BYTE b Drive Response BOOL b Enc Do Latch BOOL This signal is used for communication by the MC_Home_Bk Plc Mc [} 68] and MC_Ax Rt Encoder_Bk Plc Mc [} 198] function blocks of the axis during homing. TF5810 Version: 1.8.3 147
## Page 148

PLCopen Motion Control Name Type Description b Encoder Response BOOL b Enc Latch Valid BOOL This signal is used for communication by the MC_Home_Bk Plc Mc [} 68] and MC_Ax Rt Encoder_Bk Plc Mc [} 198] function blocks of the axis during homing. b Locked_Estop BOOL A TRUE in this variable prevents the control value generators from exiting the state i Tc Hyd State Emergency Break / Mc State_Errorstop, despite the fact that the drive outputs are reduced to 0. Used by MC_Emergency Stop_Bk Plc Mc [} 57] and MC_Imediate Stop_Bk Plc Mc [} 72]. b Params Unsave BOOL The function blocks MC_Write Parameter_Bk Plc Mc [} 48] and MC_Write Bool Parameter_Bk Plc Mc [} 46] set this flag if they change a parameter value. An MC_Ax Param Save_Bk Plc Mc [} 288] function block clears the flag when the parameters are successfully saved. In online mode of the Plc Mc Manager [} 371], this flag is used for the state display. b Reload Params BOOL b Targeting BOOL b Unaligned Overlap BOOL The characteristic of the overlap compensation is defined here. b Act Pos Offset Enable BOOL A TRUE in this variable activates actual value influencing. See also under f Act Pos Offset. b Drive Startup BOOL b Enc Align Ref Shift BOOL reserved. b Drv Wcs Error BOOL b Enc Wcs Error BOOL b First Wcs BOOL b Change Count BYTE This value is incremented with each parameter change. b Start Auto Ident BOOL b Param File Complete BOOL This flag is set if a corresponding identifier was found at the end of the file when the parameters were loaded and the CRC check was successful. p Master Rt Data POINTER TO BYTE p Master Param POINTER TO BYTE udi Serc Device ID UDINT ui Serc Box Addr UINT ui Serc Port UINT st Pos Ctrlr stbkplcinternal_cplxctrl st Velo Ctrlr stbkplcinternal_cplxctrl s Top Block Name STRING Most of the library function blocks called directly by application enter a debug ID here. st Hybrid ST_Tc Hybrid Ax Rt Data Extended status data for servo-electric/hydraulic hybrid axes. 148 Version: 1.8.3 TF5810
## Page 149

PLCopen Motion Control Information for f Act Pos Offset • If actual value influencing is active during homing, b Act Pos Offset is taken into account when the actual position is set. • This function is only realized for the following encoder types: i Tc Mc_Encoder Co E_DS406, i Tc Mc_Encoder EL3255, i Tc Mc_Encoder Sim, i Tc Mc_Encoder EL5101, i Tc Mc_Encoder KL5101, i Tc Mc_Encoder KL5111, i Tc Mc_Encoder EL5001, i Tc Mc_Encoder KL5001, i Tc Mc_Encoder KL3002, i Tc Mc_Encoder EL3102, i Tc Mc_Encoder KL3042, i Tc Mc_Encoder KL3062, i Tc Mc_Encoder EL3142, i Tc Mc_Encoder EM8908_A, i Tc Mc_Encoder EL3162, i Tc Mc_Encoder KL3162. • If one of the types listed is set for an I/O device that is compatible with one of these types, the function described is also realized. All other elements of this structure are reserved for internal use. They are not guaranteed and must not be used or modified by the application. 4.3.26 ST_Tc Mc Aux Data Labels Available from version 3.0 This structure is used for storing the label texts for the customer-specific axis parameters. A structure of this type can be linked with the axis through an MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block via a pointer in the AXIS_REF_Bk Plc Mc [} 86] structure. Syntax TYPE ST_Tc Mc Aux Data Labels: STRUCT st Label: ARRAY [1..20] OF STRING(20); END_STRUCT END_TYPE Parameter Name Type Description st Label ARRAY The label texts 4.3.27 ST_Tc Plc Device Input Available from version 3.0 This structure contains the input image variables of an axis. Syntax TYPE ST_Tc Plc Device Input : STRUCT ui Count: UINT:=0; ui Latch: UINT:=0; usi Status: USINT:=0; ui PZDL_Reg Daten: UINT:=0; ui PZDH: UINT:=0; usi Reg Status: USINT:=0; udi Count: UDINT:=0; ui Status: UINT:=0; TF5810 Version: 1.8.3 149
## Page 150

PLCopen Motion Control b Terminal State: BYTE:=0; ui Terminal Data: WORD:=0; ui Terminal State2:WORD:=0; b Dig In A: BOOL:=FALSE; b Dig In B: BOOL:=FALSE; b Dig Cam MM: BOOL:=FALSE; b Dig Cam M: BOOL:=FALSE; b Dig Cam P: BOOL:=FALSE; b Dig Cam PP: BOOL:=FALSE; Drive Error: UDINT:=0; Actual Pos: ARRAY [0..1] OF UINT:=0; Drive State: ARRAY [0..3] OF BYTE:=0; S_i Reserve: INT:=0; S_Di Reserve: ARRAY [1..9] OF DINT:=0; Ci A_Reserve: ARRAY [1..8] OF UINT:=0; b Power Ok: BOOL:=FALSE; b En Ack: BOOL:=FALSE; w Drive Dev State: WORD:=0; w Drive Wc State: BYTE:=0; w Enc Dev State: WORD:=0; w Enc Wc State: BYTE:=0; ui Drive Box State: UINT:=0; ui Enc Box State: UINT:=0; s Enc Ads Addr: ST_Tc Plc Ads Addr; n Enc Ads Channel: BYTE:=0; s Drv Ads Addr: ST_Tc Plc Ads Addr; n Drv Ads Channel: BYTE:=0; n Reserve: ARRAY [1..20] OF BYTE; END_STRUCT END_TYPE 150 Version: 1.8.3 TF5810
## Page 151

PLCopen Motion Control Parameter TF5810 Version: 1.8.3 151
## Page 152

PLCopen Motion Control Name Type Description ui Count UINT Used for position detection. Used for i Tc Mc_Encoder EL3102, i Tc Mc_Encoder EL3142, i Tc Mc_Encoder EL5101, i Tc Mc_Encoder KL2521, i Tc Mc_Encoder KL2531, i Tc Mc_Encoder KL2541, i Tc Mc_Encoder KL3002, i Tc Mc_Encoder KL3042, i Tc Mc_Encoder KL3062, i Tc Mc_Encoder KL3162, i Tc Mc_Encoder KL5101, i Tc Mc_Encoder KL5111, i Tc Mc_Encoder M2510, i Tc Mc_Encoder M3120, i Tc Mc_Drive KL2531, i Tc Mc_Drive KL2541. ui Latch UINT Used for position detection. Used for i Tc Mc_Encoder EL5101, i Tc Mc_Encoder KL5101, i Tc Mc_Encoder KL5111. usi Status USINT Used for device state information. Used for i Tc Mc_Encoder EL5101, i Tc Mc_Encoder KL3002, i Tc Mc_Encoder KL3042, i Tc Mc_Encoder KL3062, i Tc Mc_Encoder KL3162, i Tc Mc_Encoder KL5101, i Tc Mc_Encoder KL5111, i Tc Mc_Encoder M3120. ui PZDL_Reg Daten UINT Used for position detection and parameter communication. Used for i Tc Mc_Encoder KL5001. ui PZDH UINT Used for position detection. Used for i Tc Mc_Encoder KL5001. usi Reg Status USINT Used for device state information. Used for i Tc Mc_Encoder EL5001, i Tc Mc_Encoder KL5001. udi Count UDINT Used for position detection. Used for i Tc Mc_Encoder EL5001. ui Status UINT Used for device state information. Used for i Tc Mc_Encoder Ax2000_B110, i Tc Mc_Drive Ax2000_B110. b Terminal State BYTE Used for parameter communication. Used for i Tc Mc_Encoder KL2521, i Tc Mc_Encoder KL2531, i Tc Mc_Encoder KL2541, i Tc Mc_Drive EL4132, i Tc Mc_Drive KL2521, i Tc Mc_Drive KL2531, i Tc Mc_Drive KL2541, i Tc Mc_Drive KL4032. ui Terminal Data WORD Reserved ui Terminal State2 WORD Used for position detection. Used for i Tc Mc_Encoder KL2541. b Dig In A BOOL Used for position detection. Used for i Tc Mc_Encoder Dig Increment. b Dig In B BOOL Used for position detection. Used for i Tc Mc_Encoder Dig Increment. b Dig Cam MM BOOL Used for position detection. Used for i Tc Mc_Encoder Dig Cam. b Dig Cam M BOOL Used for position detection. Used for i Tc Mc_Encoder Dig Cam. b Dig Cam P BOOL Used for position detection. Used for i Tc Mc_Encoder Dig Cam. b Dig Cam PP BOOL Used for position detection. Used for i Tc Mc_Encoder Dig Cam. Drive Error UDINT Used for device state information. Used for i Tc Mc_Encoder Ax2000_B200, i Tc Mc_Encoder Ax2000_B900. Actual Pos ARRAY Used for position detection. Used for i Tc Mc_Encoder Ax2000_B110, i Tc Mc_Encoder Ax2000_B200, i Tc Mc_Encoder Ax2000_B900. 152 Version: 1.8.3 TF5810
## Page 153

PLCopen Motion Control Name Type Description Drive State ARRAY Used for device state information. Used for i Tc Mc_Encoder Ax2000_B200, i Tc Mc_Encoder Ax2000_B900. S_i Reserve INT Reserved S_Di Reserve ARRAY Reserved Ci A_Reserve ARRAY Reserved b Power Ok BOOL Optionally used for monitoring of a mains contactor. Used for i Tc Mc_Drive Ax2000_B110, i Tc Mc_Encoder Ax2000_B200, i Tc Mc_Encoder Ax2000_B900. b En Ack BOOL Reserved w Drive Dev State WORD Reserved w Drive Wc State BYTE Used for monitoring the connection to the actuator. Used for i Tc Mc_Encoder Ax2000_B110, i Tc Mc_Drive Ax2000_B110. w Enc Dev State WORD Reserved w Enc Wc State BYTE Used for monitoring the connection to the encoder. Used for i Tc Mc_Encoder Ax2000_B110, i Tc Mc_Drive Ax2000_B110, i Tc Mc_Encoder EL3102, i Tc Mc_Encoder EL3142, i Tc Mc_Encoder EL5001, i Tc Mc_Encoder EL5101. ui Drive Box State UINT Used for monitoring the connection to the actuator. Used for i Tc Mc_Drive Ax2000_B200, i Tc Mc_Drive Ax2000_B900. ui Enc Box State UINT Used for monitoring the connection to the encoder. Used for i Tc Mc_Encoder Ax2000_B200, i Tc Mc_Encoder Ax2000_B900. s Enc Ads Addr ST_Tc Plc Ads Addr Used for parameter communication. Used for i Tc Mc_Encoder Ax2000_B110, i Tc Mc_Drive Ax2000_B110, i Tc Mc_Encoder EL3102, i Tc Mc_Encoder EL3142, i Tc Mc_Encoder EL5001, i Tc Mc_Encoder EL5101. n Enc Ads Channel BYTE Used for parameter communication. Used for i Tc Mc_Encoder Ax2000_B110, i Tc Mc_Drive Ax2000_B110. s Drv Ads Addr ST_Tc Plc Ads Addr Used for parameter communication. Used for i Tc Mc_Encoder Ax2000_B110, i Tc Mc_Drive Ax2000_B110. n Drv Ads Channel BYTE Used for parameter communication. Used for i Tc Mc_Encoder Ax2000_B110, i Tc Mc_Drive Ax2000_B110. n Reserve ARRAY Reserved 4.3.28 ST_Tc Plc Device Output Available from version 3.0 This structure contains the output image variables of an axis. Syntax TYPE ST_Tc Plc Device Output : STRUCT n Dac Out: INT:=0; b Dig Out Ap: BOOL:=FALSE; TF5810 Version: 1.8.3 153
## Page 154

PLCopen Motion Control b Dig Out An: BOOL:=FALSE; b Dig Out Bp: BOOL:=FALSE; b Dig Out Bn: BOOL:=FALSE; ui Count: UINT:=0; ui Dac Out A: UINT:=0; ui Dac Out B: UINT:=0; b Move Pos: BOOL:=FALSE; b Move Neg: BOOL:=FALSE; b Brake Off: BOOL:=FALSE; b Brake Off Inverted:BOOL:=FALSE; Drive Ctrl: ARRAY [0..3] OF BYTE:=0; Nominal Velo: DINT:=0; ui Drive Ctrl: UINT:=0; S_i Reserve: ARRAY [1..2] OF INT:=0; S_Di Reserve: ARRAY [1..7] OF DINT:=0; Ci A_Reserve: ARRAY [1..7] OF UINT:=0; b Power On: BOOL:=FALSE; b Enable: BOOL:=FALSE; b Enable Pos: BOOL:=FALSE; b Enable Neg: BOOL:=FALSE; n Reset State: BYTE:=0; usi Ctrl: USINT:=0; ui Terminal Data: WORD:=0; b Terminal Ctrl: BYTE:=0; ui Terminal Ctrl2: WORD:=0; n Reserve: ARRAY [1..20] OF BYTE; END_STRUCT END_TYPE 154 Version: 1.8.3 TF5810
## Page 155

PLCopen Motion Control Parameter Name Type Description n Dac Out INT Used for control value outputs or parameter communication. Used for i Tc Mc_Encoder KL2531, i Tc Mc_Encoder KL2541, i Tc Mc_Drive EL4132, i Tc Mc_Drive KL2521, i Tc Mc_Drive KL2531, i Tc Mc_Drive KL2541, i Tc Mc_Drive KL4032, i Tc Mc_Drive M2400_Dn. b Dig Out Ap BOOL Used for control value output. Used for i Tc Mc_Drive Low Cost Stepper. b Dig Out An BOOL Used for control value output. Used for i Tc Mc_Drive Low Cost Stepper. b Dig Out Bp BOOL Used for control value output. Used for i Tc Mc_Drive Low Cost Stepper. b Dig Out Bn BOOL Used for control value output. Used for i Tc Mc_Drive Low Cost Stepper. ui Count UINT Reserved ui Dac Out A UINT Used for control value output. Used for i Tc Mc_Encoder Ix2512_1Coil, i Tc Mc_Encoder Ix2512_2Coil. ui Dac Out B UINT Used for control value output. Used for i Tc Mc_Encoder Ix2512_2Coil. b Move Pos BOOL Reserved b Move Neg BOOL Reserved b Brake Off BOOL Reserved b Brake Off Inverted BOOL Reserved Drive Ctrl ARRAY Used for device control signals. Used for i Tc Mc_Encoder Ax2000_B200, i Tc Mc_Drive Ax2000_B200, i Tc Mc_Encoder Ax2000_B900, i Tc Mc_Drive Ax2000_B900. Nominal Velo DINT Used for control value output. Used for i Tc Mc_Drive Ax2000_B110, i Tc Mc_Encoder Ax2000_B200, i Tc Mc_Encoder Ax2000_B900. ui Drive Ctrl UINT Used for device control signals. Used for i Tc Mc_Encoder Ax2000_B110, i Tc Mc_Drive Ax2000_B110. S_i Reserve ARRAY Reserved S_Di Reserve ARRAY Reserved Ci A_Reserve ARRAY Reserved b Power On BOOL Optionally used for controlling a mains contactor. Used for i Tc Mc_Drive Ax2000_B110, i Tc Mc_Encoder Ax2000_B200, i Tc Mc_Encoder Ax2000_B900. b Enable BOOL Reserved b Enable Pos BOOL Reserved b Enable Neg BOOL Reserved n Reset State BYTE Reserved usi Ctrl USINT Used for device control signals or parameter communication. Used for i Tc Mc_Encoder EL5101, i Tc Mc_Encoder KL3002, i Tc Mc_Encoder KL3042, i Tc Mc_Encoder KL3062, i Tc Mc_Encoder KL3162, i Tc Mc_Encoder KL5101, i Tc Mc_Encoder KL5111, i Tc Mc_Encoder M3120. ui Terminal Data WORD Used for parameter communication. Used for i Tc Mc_Encoder KL2521, i Tc Mc_Encoder KL5001, i Tc Mc_Encoder KL5101, i Tc Mc_Encoder KL5111, i Tc Mc_Drive EL4132, i Tc Mc_Drive KL2521, i Tc Mc_Drive KL4032. b Terminal Ctrl BYTE Used for parameter communication. Used for i Tc Mc_Encoder KL2521, i Tc Mc_Encoder KL2531, i Tc Mc_Encoder KL2541, i Tc Mc_Drive EL4132, i Tc Mc_Drive KL2521, i Tc Mc_Drive KL2531, i Tc Mc_Drive KL2541, i Tc Mc_Drive KL4032. ui Terminal Ctrl2 WORD Used for device control signals. Used for i Tc Mc_Encoder KL2541, i Tc Mc_Drive KL2531, i Tc Mc_Drive KL2541. n Reserve ARRAY Reserved TF5810 Version: 1.8.3 155
## Page 156

PLCopen Motion Control 4.3.29 ST_Tc Plc Mc Log Buffer Available from version 3.0 A variable with this structure forms the Log Buffer of the library. Further information about creating a log buffer can be found under FAQ #10 in the Knowledge Base [} 320]. The data in this structure must not be modified by the application. Syntax TYPE ST_Tc Mc Log Buffer: STRUCT Read Idx: INT:=0; Write Idx: INT:=0; Message Arr: ARRAY [0..19] OF ST_Tc Plc Mc Log Entry; END_STRUCT END_TYPE Parameter Name Type Description Read Idx INT The read index of the buffer. Write Idx INT The write index of the buffer. Message Arr ARRAY The currently stored messages. ST_Tc Plc Mc Log Entry [} 156] 4.3.30 ST_Tc Plc Mc Log Entry Available from version 3.0 A variable with this structure contains a message of the Log Buffer of the library. Used as a component in ST_Tc Plc Mc Log Buffer [} 156]. Further information about creating a log buffer can be found under FAQ #10 in the Knowledge Base [} 320]. The data in this structure must not be modified by the application. Syntax TYPE ST_Tc Plc Mc Log Entry: STRUCT Time Low: UDINT:=0; Time High: UDINT:=0; Log Level: DWORD:=0; Source: DWORD:=0; Msg: STRING(255); Arg Type: INT:=0; di Arg: DINT:=0; lr Arg: LREAL:=0; s Arg: STRING(255); END_STRUCT END_TYPE 156 Version: 1.8.3 TF5810
## Page 157

PLCopen Motion Control Parameter Name Type Description Time Low UDINT The timestamp of the message. Records the time at which the message was generated. Time High UDINT Log Level DWORD Indicates the urgency of the message. Only values from a specified pool of numbers should appear here. Source DWORD Indicates the source of the message. Only values from a specified pool of numbers should appear here. Msg STRING The message text with an optional placeholder for a variable component. Arg Type INT The type of the optional component. di Arg DINT If an optional component of type DINT is used, its value can be found here. lr Arg LREAL If an optional component of type LREAL is used, its value can be found here. s Arg STRING If an optional component of type STRING is used, its value can be found here. 4.3.31 ST_Tc Plc Reg Data Item Available from version 3.0.7 This structure contains a parameter for a KL terminal. An ARRAY of elements of this type forms the type ST_Tc Plc Reg Data Table [} 157]. Syntax TYPE ST_Tc Plc Reg Data Item : STRUCT Access: INT:=0; Select: INT:=-1; Reg Data: WORD:=0; END_STRUCT END_TYPE Parameter Name Type Description Access INT The type of the operation to be executed is coded here. Details can be found under MC_Ax Uti Update Reg Drive Term_Bk Plc Mc [} 295] or MC_Ax Uti Update Reg Enc Term_Bk Plc Mc [} 297]. Select INT The address of the register in the terminal. Reg Data WORD The parameters to be used for the operation to be executed. 4.3.32 ST_Tc Plc Reg Data Table Available from version 3.0.7 This structure contains a parameter set for a KL terminal. Such a table is processed by the MC_Ax Uti Update Reg Drive Term_Bk Plc Mc [} 295] or MC_Ax Uti Update Reg Enc Term_Bk Plc Mc [} 297] function blocks. Syntax TYPE ST_Tc Plc Reg Data Table : STRUCT Reg Data Item: ARRAY [1..64] OF ST_Tc Plc Reg Data Item; END_STRUCT END_TYPE TF5810 Version: 1.8.3 157
## Page 158

PLCopen Motion Control Parameter Name Type Description Reg Data Item ARRAY 4.3.33 ST_Tc Hybrid Ax Param Available from version 3.0.44 This structure contains additional parameters of the servo-electric/hydraulic axis. Also see about this: Suitable procedures for axis commissioning [} 380]. The order of the parameters is not guaranteed. Syntax TYPE ST_Tc Hybrid Ax Param : (* last modification: 20.02.2019 *) STRUCT f Pump_N_max: LREAL; f Pump_N_min: LREAL; f Pump_P_max: LREAL; f Pump_P_min: LREAL; f Pump_Q_fast_P: LREAL; f Pump_Q_slow_P: LREAL; f Pump_Q_fast_M: LREAL; f Pump_Q_slow_M: LREAL; f Pump_Q_leak: LREAL; f Pump_Enc_Offset: LREAL; f Cylinder_A_add P: LREAL; f Cylinder_A_add M: LREAL; f Ramp Time: LREAL; f Aside_Prs Scaling: LREAL; f Bside_Prs Scaling: LREAL; f System_Prs Scaling: LREAL; n Pump Cavities: DINT; n Concept: DINT; n Pump_Enc Type: E_Tc Mc Encoder Type:=i Tc Mc_Encoder Sim; b Regenerative: BOOL; b Virtual_A_add P: BOOL; b Virtual_A_add M: BOOL; b Aside_Prs Hi Res ADC: BOOL; b Bside_Prs Hi Res ADC: BOOL; b System_Prs Hi Res ADC: BOOL; END_STRUCT END_TYPE 158 Version: 1.8.3 TF5810
## Page 159

PLCopen Motion Control Parameter TF5810 Version: 1.8.3 159
## Page 160

PLCopen Motion Control Name Type Description f Pump_N_max LREAL [rpm] The minimum and maximum permissible pump speeds. f Pump_N_min LREAL f Pump_P_max LREAL [bar] The minimum and maximum permissible operating pressure of the pump. f Pump_P_min LREAL f Pump_Q_fast_P LREAL [cm3/rev] The rotation-related flow rate of the pump in rapid or force mode at the cylinder connection f Pump_Q_slow_P LREAL acting in the positive direction. f Pump_Q_fast_M LREAL [cm3/U] The rotation-related flow rate of the pump in rapid or force mode at the cylinder connection f Pump_Q_slow_M LREAL acting in the negative direction. f Pump_Q_leak LREAL Reserved f Pump_Enc_Offset LREAL Reserved f Cylinder_A_add P LREAL If, depending on the situation, an area effective for oil demand is connected in the positive direction of action, it must be identified here. This can also be an oil demand required by an apparent area, which actually bypasses the cylinder. In this case, the area should be identified as "virtual". f Cylinder_A_add M LREAL If, depending on the situation, an area effective for oil demand is connected in the negative direction of action, it must be identified here. This can also be an oil demand required by an apparent area, which actually bypasses the cylinder. In this case, the area should be identified as "virtual". f Ramp Time LREAL When switching between rapid and force mode, the weighting factor for the velocity output and the maximum attainable velocity are changed. A ramp can be defined here, in order to avoid a discontinuity. f Aside_Prs Scaling LREAL The scaling pressures for the A-side, the B-side and the system pressure detection are to be set f Bside_Prs Scaling LREAL here. f System_Prs Scaling LREAL n Pump Cavities DINT Enter the number of pump chambers here. For piston pumps the number of pistons must be set. For internal gear pumps, the number of teeth on the internal pinion must be set. n Concept DINT The circuit concept used for the servo-electric/ hydraulic axis must be specified here. n Pump_Enc Type E_Tc Mc Encoder Type The encoder type [} 98] of the pump drive is defined here. Only a small selection of encoder types is available. This is not the encoder on the cylinder. b Regenerative BOOL This parameter indicates that the smaller cylinder area is operated in oil exchange with the larger cylinder area. b Virtual_A_add P BOOL If an area that can be activated in the positive direction of action is effective for the oil demand but not for the force build-up, it must be identified here. b Virtual_A_add M BOOL If an area that can be activated in the negative direction of action is effective for the oil demand but not for the force build-up, it must be identified here. 160 Version: 1.8.3 TF5810
## Page 161

PLCopen Motion Control Name Type Description b Aside_Prs Hi Res ADC BOOL This parameter indicates that the pressure sensor of the area with positive direction of action is read with a 24-bit input terminal. b Bside_Prs Hi Res ADC BOOL This parameter indicates that the pressure sensor of the area with negative direction of action is read with a 24-bit input terminal. b System_Prs Hi Res ADC BOOL This parameter indicates that the pressure sensor at the pressurized hydraulic reservoir is read with a 24-bit input terminal. See Commissioning [} 380] for more information about axis commissioning. 4.3.34 ST_Tc Hybrid Ax Rt Data Available from version 3.0.44 This structure contains additional runtime values of the servo-electric/hydraulic axis. The parameter sequence is not guaranteed. Syntax TYPE ST_Tc Hybrid Ax Rt Data : (* last modification: 05.12.2018 *) STRUCT f Pump_Angle: LREAL; f Pump_Modulo Angle: LREAL; f Pump_Speed: LREAL; f Pump_Torque: LREAL; f Motor_N_max: LREAL; f Motor_Ref Current: LREAL; f Motor_Ref Torque: LREAL; f Motor_Peek Current: LREAL; f Motor_Peek Torque: LREAL; f Motor_Nom Current: LREAL; f Motor_Nom Torque: LREAL; f Active_Area_P: LREAL; f Active_Area_M: LREAL; f Active_Qmax_P: LREAL; f Active_Qmax_M: LREAL; f Active_Feed_P: LREAL; f Active_Feed_M: LREAL; f Active_N_max: LREAL; f Active_Vmax_P: LREAL; f Active_Vmax_M: LREAL; f Feed_Ramp Rate_P: LREAL; f Feed_Ramp Rate_M: LREAL; f Ramping_Feed_P: LREAL; f Ramping_Feed_M: LREAL; b Pump_Switched: BOOL; b Pump_Area Switched: BOOL; b Motor_Enable Pwr Mon:BOOL; b Re Ramp_Feed Factor: BOOL; b Hyd Actual Call: BOOL; END_STRUCT END_TYPE TF5810 Version: 1.8.3 161
## Page 162

PLCopen Motion Control Parameter 162 Version: 1.8.3 TF5810
## Page 163

PLCopen Motion Control Name Type Description f Pump_Angle LREAL [°] The rotation-related actual angle of the motor and thus also of the pump in the range 0 ... 360°. f Pump_Modulo Angle LREAL [°] The cavity-related actual angle of the motor and thus also of the pump in the range 0 ... 360°/number_of_cavities. f Pump_Speed LREAL [°/s] The angular speed of the motor and thus also of the pump. This value corresponds to six times the speed in rpm. f Pump_Torque LREAL [%] The torque called up by the pump from the motor in relation to its nominal torque. f Motor_N_max LREAL [rpm] The maximum speed of the motor. f Motor_Ref Current LREAL [A] The current reference value of the motor. f Motor_Ref Torque LREAL [Nm] The torque reference value of the motor. f Motor_Peek Current LREAL [A] The current peak value of the motor. f Motor_Peek Torque LREAL [Nm] The torque peak value of the motor. f Motor_Nom Current LREAL [A] The current rating of the motor. f Motor_Nom Torque LREAL [Nm] The torque rating of the motor. f Active_Area_P LREAL [mm2] The currently effective area on the P-side of the cylinder. f Active_Area_M LREAL [mm2] The currently effective area on the M-side of the cylinder. f Active_Qmax_P LREAL [cm3/rev] The currently available quantity on the P-side of the cylinder. f Active_Qmax_M LREAL [cm3/rev] The currently available quantity on the M-side of the cylinder. f Active_Feed_P LREAL [mm/rev] The currently available rotational feed rate on the P-side of the cylinder. f Active_Feed_M LREAL [mm/rev] The currently available rotational feed rate on the M-side of the cylinder. f Active_N_max LREAL [rpm] The currently available maximum speed of motor and pump. f Active_Vmax_P LREAL [mm/s] The currently available maximum velocity in positive direction. f Active_Vmax_M LREAL [mm/s] The currently available maximum velocity in negative direction. f Feed_Ramp Rate_P LREAL [mm/rev/cycle] The cycle-related feed factor change of a current or already executed ramp in the positive direction of cylinder movement. f Feed_Ramp Rate_M LREAL [mm/rev/cycle] The cycle-related feed factor change of a current or already executed ramp in the negative direction of cylinder movement. f Ramping_Feed_P LREAL [mm/rev] The current ramped feed factor in positive direction of cylinder movement. f Ramping_Feed_M LREAL [mm/rev] The current ramped feed factor in negative direction of cylinder movement. b Pump_Switched BOOL This signal indicates active switching of the pump to force mode. b Pump_Area Switched BOOL This signal indicates active activation of the areas for force mode. b Motor_Enable Pwr Mon BOOL This signal indicates that the current and torque parameters of the drive have been read and an accurate torque calculation is available. b Re Ramp_Feed Factor BOOL This signal starts the ramp for switching between rapid and force mode. TF5810 Version: 1.8.3 163
## Page 164

PLCopen Motion Control Name Type Description b Hyd Actual Call BOOL This signal indicates that an instance of the function block MC_Ax Rt Hybrid Axis Actuals_Bk Plc Mc () has been called for the servo-electric/hydraulic axis. Otherwise it is not ensured that the actual values of the axis are fully determined and the effects of pump or area switching are taken into account. In this case, the axis is set to the error state and a message is written to the log. 4.3.35 ST_Tc Plc Input Analog Available from version 3.0.44 This structure contains variables for the evaluation of analog inputs. Syntax TYPE ST_Tc Plc Input Analog : (* last modification: 20.02.2019 *) STRUCT n ADC: DINT; n Op State: INT; b Wc State: BOOL; END_STRUCT END_TYPE Parameter Name Type Description n ADC DINT n ADC: The actual value is displayed here. If this value is determined with a 16-bit terminal, it must be adapted. If it is a signed value (e.g. from a ±10 V terminal), it must be assigned with a type conversion INT_TO_DINT(). This automatically extends the sign to the upper 16 bits with the correct type. Otherwise negative values are interpreted as very large positive values. If only positive values occur, this can be omitted. In this case, direct mapping from 16 to 2 bit can be used, since the upper 16 bits remain unaffected. n Op State INT n Op State: This signal indicates the operating state of the terminal. b Wc State BOOL b Wc State: This signal indicates a problem with continuous data exchange with the terminal. 4.3.36 ST_Tc Pctrl Param This structure contains additional parameters that can be used for a force or pressure controller. The supply of such a function block must be handled by the application. The order of the parameters is not guaranteed Syntax TYPE ST_Tc Pctrl Param : (* last modification: 30.07.2019 *) STRUCT fk P: LREAL; f Tn: LREAL; f Tv: LREAL; f Preset: LREAL; f Wu Limit: LREAL; 164 Version: 1.8.3 TF5810
## Page 165

PLCopen Motion Control n Nf: INT; b Align Areas: BOOL; END_STRUCT END_TYPE Parameter Name Type Description fk P LREAL The proportional gain of the controller. f Tn LREAL The integration time constant of the controller. If it is set to 0.0, the I part is switched off. f Tv LREAL The rate time constant of the controller. If it is set to 0.0, the D part is switched off. f Preset LREAL This value initializes the I component when it is activated. f Wu Limit LREAL Limit for the I part. n Nf INT The response of the D part usually generates an uneven signal that makes an axis unstable. This parameter can be used to enable a moving average filter that averages up to 100 values. b Align Areas BOOL If this parameter is TRUE, the output of the controller is adjusted to the ratio of the active areas of a cylinder depending on the direction. This can contribute to a more stable control if the axis has to provide control in both directions. NOTICE n Nf: Undesired vibration Strong filtering produces a phase error that can lead to vibration. 4.3.37 MC_Ref_Signal_Ref_Bk Plc Mc A variable of this type is transferred to a MC_Step Absolute Switch_Bk Plc Mc [} 308] or MC_Step Absolute Switch Detection_Bk Plc Mc [} 310] function block. Syntax TYPE MC_Ref_Signal_Ref_Bk Plc Mc: STRUCT Signal Source: E_Signal Source_Bk Plc Mc := E_Signal Source_Bk Plc Mc. Signal Source_Default; Level: BOOL; END_STRUCT END_TYPE TYPE E_Signal Source_Bk Plc Mc: Signal Source_Default := 0; (**) END_TYPE Parameter Name Type Description Signal Source E_Signal Source_Bk Plc Mc Signal Source: Selection of the signal source by E_Signal Source_Bk Plc Mc. Level BOOL Level:Input signal of the referencing cam. 4.3.38 E_Tc Mc Jog Mode The constants in this listing are used to switch between different jog modes. TF5810 Version: 1.8.3 165
## Page 166

PLCopen Motion Control Syntax TYPE E_Tc Mc Jog Mode : ( MC_JOGMODE_STANDARD_SLOW, (* motion with standard jog parameters for slow motion *) MC_JOGMODE_STANDARD_FAST, (* motion with standard jog parameters for fast motion *) MC_JOGMODE_CONTINOUS, (* axis moves as long as the jog button is pressed using parameterized dynamics *) MC_JOGMODE_INCHING, (* axis moves for a certain relative distance *) MC_JOGMODE_INCHING_MODULO (* axis moves for a certain relative distance - stop position is rounded to the distance value *)); END_TYPE Parameter Name Description MC_JOGMODE_STANDARD_SLOW The axis moves as long as the signal at one of the jog inputs is TRUE. The low velocity for manual functions specified in AXIS_REF_Bk Plc Mc and standard dynamics are used. In this operation mode the position, velocity and dynamics data specified in the function block have no effect. MC_JOGMODE_STANDARD_FAST The axis moves as long as the signal at one of the jog inputs is TRUE. The high velocity for manual functions specified in AXIS_REF_Bk Plc Mc and standard dynamics are used. In this operation mode the position, velocity and dynamics data specified in the function block have no effect. MC_JOGMODE_CONTINOUS The axis moves as long as the signal at one of the jog inputs is TRUE. The velocity and dynamics data specified by the user are used. The position has no effect. MC_JOGMODE_INCHING With rising edge at one of the jog inputs the axis is moved by a certain distance which is specified via the position input. The axis stops automatically, irrespective of the state of the jog inputs. A new movement step is only executed once a further rising edge is encountered. With each start the velocity and dynamics data specified by the user are used. MC_JOGMODE_INCHING_MODULO Reserved 4.4 System 4.4.1 Controller 4.4.1.1 MC_Ax Ctrl Auto Zero_Bk Plc Mc MC_Ax Uti Offset Latch_Bk Plc Mc Execute BOOL BOOL Done Offset Limit LREAL BOOL Error ↔ Axis Reference To AXIS_REF_Bk Plc Mc UDINT Error ID BOOL Latched LREAL Offset Available from version 3.0 The function block executes an automatic zero compensation. This function block may only be used for zero overlap valves. 166 Version: 1.8.3 TF5810
## Page 167

PLCopen Motion Control Inputs VAR_INPUT Enable: BOOL:=FALSE; Enable On Moving: BOOL:=FALSE; Offset Limit: LREAL:=0.0; Tn: LREAL:=0.0; Threshold: LREAL:=0.1; Filter: LREAL:=0.1; END_VAR Name Type Description Enable BOOL This input controls the activity of the compensation. Enable On Moving BOOL This input controls the activity of the compensation. Offset Limit LREAL [V] The value in f Zero Compensation is limited to this value. Tn LREAL [s] The integral action time of the compensation. This is the time for a change by 10 V. Values greater than 100 s are recommended. Threshold LREAL [V] Parameter for the Done signal. Filter LREAL [s] Parameter for the Done signal. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; Active: BOOL; Limiting: BOOL; Done: BOOL; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Active BOOL Indicates that the function block actively adjusts the value of f Zero Compensation in ST_Tc Hyd Ax Param [} 130]. Limiting BOOL Indicates that the value of f Zero Compensation in ST_Tc Hyd Ax Param [} 130] has reached the limit specified by Offset Limit. Done BOOL Indicates leveling out of the offset compensation. Purpose of the function block If a hydraulic cylinder is drifting when the position controller is switched off (k P=0.0), or if there is a permanent lag error relative to the target when the position controller is active, this can be corrected by using a zero overlap valve with offset compensation. A hydraulic cylinder stops when it is in equilibrium of forces. In the simplest case (cylinder with identical surfaces, no external forces by gravity or a process) this equilibrium is fulfilled, if the same pressure acts on both surfaces. For a differential cylinder, the pressures must be proportional to the inverse of the surfaces. Any external forces must be included. In order to achieve the required pressure conditions, a proportion of the system pressure is required as pressure difference. In the case of a zero overlap valve, this is defined by the pressure gain characteristic. TF5810 Version: 1.8.3 167
## Page 168

PLCopen Motion Control Another possible reason for an offset is a difference between the hydraulic zero point of the valve and the logical zero point of the output hardware. These are unavoidable manufacturing tolerances. Therefore, a small valve excitation with up to ±0.5 V is required. Refer to the data sheets provided by the valve and hardware manufacturers for further information. Behavior of the function block: Enable logic As long as Enable for the function block or the axis controller is FALSE, the function block does not become Active. The comparison value for monitoring the compensation is initialized and the time measurement for the Done message is reset. If the enable conditions are met and the axis is not in idle state (i.e. it is in motion), the time measurement for the Done message is also reset. If the enable conditions are met and the axis is in idle state, the function block 'Compensation&Timing' is processed. Irrespective of these preconditions, the function block' Feedback' is processed. Enable logic: 168 Version: 1.8.3 TF5810
## Page 169

PLCopen Motion Control Behavior of the function block: Compensation&Timing A correction value is formed from the lag error and the response of the controller. The bandwidth of the possible axis controller parameterization is taken into account. A delta value (maximum change in zero compensation per cycle) is formed from this correction value and Tn. Tn defines a ramp time for an increase by 10 V. The delta value is limited such that this ramp slope is not exceeded. In this way an excessively fast change, during which the correction would become unstable, can be avoided. Values greater than 100 seconds are recommended. A tolerance threshold is used for compensation. In this case Lag Amp Dx (threshold value of the I component in the position controller) is used. If the correction value is greater than or equal to the tolerance threshold and the actual velocity is greater than or equal to zero (i.e. the remaining correction value is not already reduced), the Active function block is used and the compensation is reduced in each cycle by the delta value described. If the correction value is less than or equal to the tolerance threshold and the actual velocity is less than or equal to zero (i.e. the remaining correction value is not already reduced), the Active function block is used and the compensation is reduced in each cycle by the delta value described. If the magnitude of the correction value is smaller than the tolerance threshold, Active becomes FALSE. If the compensation differs by more than the Threshold from the Old Value comparison value, the time measurement is reset and the current compensation is updated as a new comparison value. Otherwise, the time measurement is increased with the cycle time. In this way, the time required to accumulate a change in compensation by at least the Threshold is logged. Compensation&Timing: TF5810 Version: 1.8.3 169
## Page 170

PLCopen Motion Control Behavior of the function block: Feedback The compensation is limited to ±Offset Limit and signaled to Limiting. Done is reported when the function block is active and the time measurement reaches the time set in Filter. Example: If Threshold is set to 0.05 and Filter to 2.0, Done is reported if the compensation has been readjusted by less than 0.05 V within the last 2 seconds. 170 Version: 1.8.3 TF5810
## Page 171

PLCopen Motion Control Feedback The limitation to the range specified by Offset Limit applies even if the function block is not active. The Limiting output is updated. The value Offset Limit and ST_Tc Hyd Ax Param [} 130].f Zero Compensation are regarded as offset voltage. The value 10.0 therefore corresponds to full scale control. In general, a value between 0.1 and 1.0 makes sense for Offset Limit, depending on the application. Integration of the function block in the application In the call sequence for the function blocks of an axis, an MC_Ax Ctrl Auto Zero_Bk Plc Mc function block should appear immediately before the MC_Ax Rt Finish_Bk Plc Mc [} 246]. If an MC_Ax Standard Body_Bk Plc Mc [} 253] function block is called instead of the individual function blocks, MC_Ax Ctrl Auto Zero_Bk Plc Mc should be called before this function block. TF5810 Version: 1.8.3 171
## Page 172

PLCopen Motion Control WARNING Dangerous axis movement If situations occur during axis operation, in which the axis has a controller enable pending but does not display its normal motion behavior, the MC_Ax Ctrl Auto Zero_Bk Plc Mc function block must be disabled. Possible causes for such a situation including function block startup with or without transition to pressure control or reduction of or switch-off of the supply. If this is not taken into account, the value of f Zero Compensation in ST_Tc Hyd Ax Param [} 130] may run in any direction until the specified limit is reached. As soon as the axis is responsive again at a later stage, a dangerous motion may be unavoidable. In this case the positioning behavior will be severely affected. If the function block is called without Enable On Moving, it may no longer be able to automatically correct the shifted offset. In this case the axis will stop outside the target window and never report the motion as complete, or only after a long time. In combination with an MC_Ax Standard Body_Bk Plc Mc [} 253] function block, all responses of the MC_Ax Ctrl Auto Zero_Bk Plc Mc function block are delayed by one PLC cycle. Usually this is no problem. If this offset does cause problems, the individual function blocks for encoder etc. should be used, and the MC_Ax Ctrl Auto Zero_Bk Plc Mc function block should be called immediately before the MC_Ax Rt Finish_Bk Plc Mc [} 246] function block. 4.4.1.2 MC_Ax Ctrl Pressure_Bk Plc Mc MC_Ax Ctrl Pressure_Bk Plc Mc Enable BOOL BOOL Error Reset BOOL UDINT Error ID First Aux Param Idx INT BOOL In Windup k P LREAL Tn LREAL Reading Mode E_Tc Mc Pressure Reading Mode Pre Set LREAL Windup Limit LREAL Align Areas BOOL ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block controls the pressure applied to an axis such that a specified default value is established and maintained in the actual value selected by Reading Mode. In most cases the actual pressure can be logged with function blocks of type MC_Ax Rt Read Pressure Single_Bk Plc Mc [} 222] or MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220]. Inputs VAR_INPUT Enable: BOOL:=FALSE; Reset: BOOL:=TRUE; First Aux Param Idx: INT:=0; k P: LREAL:=0.0; Tn: LREAL:=0.0; Reading Mode:E_Tc Mc Pressure Reading Mode:=i Tc Hyd Pressure Reading Default; Pre Set: LREAL:=0.0; Windup Limit:LREAL:=0.0; END_VAR 172 Version: 1.8.3 TF5810
## Page 173

PLCopen Motion Control Name Type Description Enable BOOL TRUE at this input activates the controller. Reset BOOL TRUE at this input resets the controller. The memory of the I part is cleared. First Aux Param Idx INT Here a range in the AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Param [} 130].f Customer Data can be activated as parameter interface. k P LREAL The gain factor of the P part. Tn LREAL The integral action time of the I part. Reading Mode E_Tc Mc Pressure Readin The actual value to be controlled can be specified here. g Mode AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure is selected as default value. Pre Set LREAL Here you can specify a default value for calculating an initial value for the I part of the controller. The I part is preloaded with this value on activation. Windup Limit LREAL Here you can specify a limit value for the I part. Such a limitation prevents extreme behavior of the I part in situations where the path does not respond to controller outputs. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; In Windup: UDINT; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. In Windup UDINT This output becomes TRUE if the I part is limited by Windup Limit. Behaviour of the function block: The function block investigates the axis interface that has been passed to it every time it is called. TRUE at Reset puts the function block in an idle state, irrespective of the other control signals. Both the P component and the I component are then deleted. Enable can be used to specified whether the function block assumes the active state. The input Reading Mode determines which variable is assigned the parameter to be controlled in the st Ax Rt Data structure. • i Tc Hyd Pressure Reading Default, i Tc Hyd Pressure Reading Act Pressure: f Act Pressure is controlled. • i Tc Hyd Pressure Reading Act Force: f Act Force is controlled. • Any other value deactivates the controller. TF5810 Version: 1.8.3 173
## Page 174

PLCopen Motion Control The set value has to be specified in f Set Pressure in the st Ax Rt Data structure of the axis. First, the function block determines whether it has to assume or quit the active state. To this end the Enable signal is evaluated. A rising edge causes the I component to be initialized with Pre Set. If the output value matching ST_Tc Hyd Ax Rt Data [} 141].in f Set Pressure is known, it can be utilized for reaching the compensated state more quickly. A P component is then calculated with k P, an I component with Tn. The sum of these controller components is output as control value in ST_Tc Hyd Ax Rt Data [} 141].f Set Speed. Since this controller assumes the function of a control value generator, it cancels ST_Tc Hyd Ax Rt Data [} 141].f Lag Ctrl Output. The MC_Ax Rt Finish_Bk Plc Mc [} 246] function block to be positioned after the controller function block then considers the response automatically. The transition to the inactive state results in deletion of the controller components. Integration of the function block in the application A function block of this type must be called after the actual value and actual pressure acquisition. It handles the full control of the axis and replaces any function block for control value generation that may be present. A program example [} 321] #15 is available. If a function block for control value generation and an MC_Ax Ctrl Pressure_Bk Plc Mc function block are present, these function blocks should either be called alternatively, or the MC_Ax Ctrl Pressure_Bk Plc Mc function block must follow after the control value function block, so that it overwrites the outputs of this function block. Not all generator types allow both options. A value greater than 0 in First Aux Param Idx can be used to instruct the function block to use three consecutive values in the f Customer Data of the parameter structure as Tn, k P and Pre Set. If the address of a suitable ARRAY[..] OF STRING() is entered in Axis.p St Ax Aux Labels, the parameters are automatically assigned a name. Commissioning The four parameters k P, Tn, Pre Set and Windup Limit enable the controller to be adapted to a range of different tasks. NOTICE Control oscillations During commissioning the axis may be subjected to the full system pressure, or damped or undamped vibrations in a wide frequency range may occur. Appropriate measures must be taken, if there is a risk for the axis or its surroundings. In any case, measures should be taken to enable fast deactivation of the controls. Initially 0.0 should be entered for Tn and Preset and 1.0 for Windup Limit. The controller now operates as a pure P controller. Once a function block has started up and the controller is activated (Enable:=TRUE, Reset:=FALSE, Set Pressure:=set value), the maximum applicable value for k P can be determined. Increase the value step-by-step, until an oscillation tendency becomes apparent. Use repeated deactivation and activation to check whether the controller is actually stable. In practice the value will be between around 0.1 and 0.5. The next parameter to be set is Tn. Initially, a relatively large value should be specified, e.g. 0.5. The actual pressure should now be regulated to the set value with large inertia, but fairly precisely. Now determine the maximum possible setting through step-by-step reduction. Again, use repeated deactivation and activation to check whether the controller is actually stable. If there is a tendency to damped oscillation during activation, Tn is already set too low. The setting of Windup Limit does not directly influence the behavior of the controller. Rather, this parameter is used to influence the transition behavior. If the controller is able to build up the pressure immediately because the axis does not have to travel, the value of Windup Limit should be chosen such that the I component is not greater than three to four times the value that is required according to valve characteristics. In this way the pressure regulation can be achieved significantly more quickly. If the axis still has some way 174 Version: 1.8.3 TF5810
## Page 175

PLCopen Motion Control to travel, a low value for this parameter will determine the motion of the axis until the working position is reached. If the parameter is chosen too low, the axis will move very slowly or even stop. On the other hand, a value that is too large will cause the axis to reach the working position with a rather high velocity, resulting in steep pressure increase. The resulting peak pressure can be significant. NOTICE If possible, activation of a pressure controller should be avoided, unless the axis is very close to its working position. The value for Pre Set can be used for two procedures. If the pressure regulator should continue the control value of another function block continuously, its control value can be specified for the calculation of Pre Set. In this way it is possible to reduce or avoid step changes in the control value during activation of the controller. If the control value to be generated by the controller is known, a value that is close to this value can be specified as Pre Set. In this way it is possible to reduce the time, which the I component requires to establish the control value. Since the P component is also active, a value should be set that is higher than the exact value. The ultimate aim when setting these parameters is to find a set of values that is appropriated for the task by making small changes and assessing the controller characteristics. Example for the behavior of the controller, if the axis first has to travel some distance before it can build up the required pressure. TF5810 Version: 1.8.3 175
## Page 176

PLCopen Motion Control Example for the controller behavior, if the axis is able to build up the required pressure immediately. 4.4.1.3 MC_Ax Ctrl Pressure FF_Bk Plc Mc MC_Ax Ctrl Pressure FF_Bk Plc Mc Enable BOOL BOOL Error Enable_P BOOL UDINT Error ID Enable_I BOOL BOOL In Windup Enable_D BOOL LREAL Deviation Reset BOOL LREAL Proportional Enable_Wu L BOOL LREAL Integrator Enable_Out L BOOL LREAL Differential Setpoint LREAL LREAL Response Actual LREAL Feed Velocity LREAL Feed Charge LREAL p Param Pointer To ST_Tc Pctrl Param ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block regulates the pressure acting on an axis in such a way that the desired default value Set Point is set up and maintained in Actual. Alternatively, forces can also be used as actual values and setpoints. In most cases the actual pressure can be logged with function blocks of type MC_Ax Rt Read Pressure Single_Bk Plc Mc [} 222] or MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220]. Function blocks of type MC_Ax Rt Read Force Single_Bk Plc Mc [} 218] or MC_Ax Rt Read Force Diff_Bk Plc Mc [} 215] are suitable for an actual force. Inputs VAR_INPUT Enable: BOOL:=FALSE; Enable_P: BOOL:=TRUE; Enable_I: BOOL:=TRUE; Enable_D: BOOL:=TRUE; Reset: BOOL:=TRUE; 176 Version: 1.8.3 TF5810
## Page 177

PLCopen Motion Control Setpoint: LREAL:=0.0; Actual: LREAL:=0.0; Feed Velocity: LREAL:=0.0; Feed Charge: LREAL:=0.0; p Param: POINTER TO ST_Tc Pctrl Param; END_VAR Name Type Description Enable BOOL TRUE at this input activates the controller. Enable_P BOOL A TRUE at this input activates the proportional component of the controller. Enable_I BOOL A TRUE at this input activates the integrator of the controller if the proportional component is active. Enable_D BOOL A TRUE at this input activates the differential component of the controller if the proportional component is active. Reset BOOL TRUE at this input resets the controller. The memory of the I part is cleared. Setpoint LREAL The setpoint of the controller. Actual LREAL The actual value of the controller. Feed Velocity LREAL The default value for a lower-level pre-control. Feed Charge LREAL An instantaneously effective and permanent change in the integral component. p Param POINTER TO The address of a structure with the controller parameters. If zero ST_Tc Pctrl Param is transferred here, the controller uses the parameters in st Ax Params.st Pctrl. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; In Windup: UDINT; Deviation: LREAL; Proportional: LREAL; Integrator: LREAL; Differential: LREAL; Response: LREAL; END_VAR Name Type Description Error BOOL A TRUE here signals an error. Error ID UDINT A numerically encoded error indication. In Windup UDINT A TRUE here signals that the integrator is limited by the Windup Limit. Deviation LREAL The current controller deviation. Proportional LREAL The current proportional component. Integrator LREAL The current integral component. Differential LREAL The current differential component. Response LREAL The output of the controller. TF5810 Version: 1.8.3 177
## Page 178

PLCopen Motion Control The controller has a complete PID core, the individual components of which can be switched on and off via Boolean inputs regardless of their parameters. In addition, a pre-control input is available, which makes it easier to adapt the control against a moving object to the velocity of the object. If necessary, the component of the integrator can be instantaneously changed with the input Feed Charge. 4.4.1.4 MC_Ax Ctrl Slow Down On Pressure_Bk Plc Mc MC_Ax Ctrl Slow Down On Pressure_Bk Plc Mc Enable P BOOL LREAL Response Enable M BOOL BOOL Active Reset BOOL BOOL Error First Aux Param Idx INT UDINT Error ID k P LREAL Tn LREAL Pre Set LREAL Reading Mode E_Tc Mc Pressure Reading Mode ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block decelerates an axis such that a certain default value is not exceeded in the actual value selected through Reading Mode. The rules of substitutional pressure control apply. In most cases the actual pressure can be logged with function blocks of type MC_Ax Rt Read Pressure Single_Bk Plc Mc [} 222] or MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220]. 178 Version: 1.8.3 TF5810
## Page 179

PLCopen Motion Control Inputs VAR_INPUT Enable P: BOOL:=FALSE; Enable M: BOOL:=FALSE; Reset: BOOL:=TRUE; First Aux Param Idx: INT:=0.0; k P: LREAL:=0.0; Tn: LREAL:=0.0; Pre Set: LREAL:=0.0; Reading Mode: E_Tc Mc Pressure Reading Mode:=i Tc Hyd Pressure Reading Default; END_VAR E_Tc Mc Pressure Reading Mode [} 119] Name Type Description Enable P BOOL TRUE at this input enables the controller to influence the output value during a motion in positive direction. Enable M BOOL TRUE at this input enables the controller to influence the output value during a motion in negative direction. Reset BOOL TRUE at this input resets the controller. The memory of the I part is cleared. First Aux Param Idx INT Here a range in the AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Param [} 130].f Customer Data can be activated as parameter interface. k P LREAL The gain factor of the P part. Tn LREAL The integral action time of the I part. Pre Set LREAL Here you can specify a default value for calculating an initial value for the I part of the controller. The I part is preloaded with this value on activation. Reading Mode E_Tc Mc Pressure Readin The actual value to be controlled can be specified here. g Mode AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure is selected as default value. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Response: LREAL; Active: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Response LREAL The output value of a pressure controller. Active BOOL TRUE at this output indicates that the function block generates a response in order to take over the pressure control. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. TF5810 Version: 1.8.3 179
## Page 180

PLCopen Motion Control Behaviour of the function block: TRUE at Reset puts the function block in an idle state, irrespective of the other control signals. Active is then FALSE and Response := 0.0, since both the P component and the I component are deleted. The input Reading Mode determines which variable is assigned the parameter to be controlled in the st Ax Rt Data structure. • i Tc Hyd Pressure Reading Default, i Tc Hyd Pressure Reading Act Pressure: f Act Pressure is controlled. • i Tc Hyd Pressure Reading Act Force: f Act Force is controlled. • Any other value deactivates the controller. The set value has to be specified in f Set Pressure in the st Ax Rt Data structure of the axis. During active operation the behavior of the function block is determined by the inputs Enable P and Enable M. They determine whether the function block should intervene in positive or negative direction during a motion. Note that the function block is tasked to counteract an active travelling motion. Enable P should therefore be set if travelling motion in positive direction should not exceed a specified pressure. In opposite direction of travel Enable M enables a pressure-limiting controller response in positive direction. First, the function block determines whether it has to assume or quit the active state. To this end the signals Enable P, Enable M, the sign of ST_Tc Hyd Ax Rt Data [} 141].f Set Speed and the difference between Set Pressure and the selected actual value are evaluated. During transition to the active state the I component is initialized with Pre Set. It is loaded with a starting value, which in combination with ST_Tc Hyd Ax Rt Data [} 141].f Set Speed results in the value of Pre Set. If the output value matching f Set Pressure is known, it can be utilized for reaching the compensated state more quickly. In practice, the choice of this parameter should be made dependent on the behavior of the controlled system. This is mainly influenced by the flexibility of the pressed in object, but also by the selected velocity. If the increase is rather slow compared with the Tn used, the current control value from ST_Tc Hyd Ax Rt Data [} 141].f Set Speed should be used as preset value. If the actual pressure responds with a rapid increase, it is advisable to use a value, which takes into account the set pressure and the pressure amplification of the valve. A P component is then calculated with k P, an I component with Tn. The sum of these controller components is output as Response, and the state of the controller is indicated as TRUE at Active. The transition to the inactive state results in deletion of the controller components and is indicated with FALSE at Active. Integration of the function block in the application A function block of this type must be called after the actual value and actual pressure acquisition, and after the control value generation. If function blocks are called for velocity or position control, these must also be positioned before the pressure regulator function block, or the responses of the controllers should be coordinated with due diligence. Although the pressure regulator calculates a response, it is not entered in the ST_Tc Hyd Ax Rt Data [} 141] structure. This is done by the application, depending on Active and taking into account signals of other controllers. Usually, Response is assigned to the variable ST_Tc Hyd Ax Rt Data [} 141].f Lag Ctrl Output. The MC_Ax Rt Finish_Bk Plc Mc [} 246] function block to be positioned after the controller function block then considers the response automatically. A value greater than 0 in First Aux Param Idx can be used to instruct the function block to use three consecutive values in the f Customer Data of the parameter structure as Tn, k P and Pre Set. If the address of a suitable ARRAY[..] OF STRING() is entered in Axis.p St Ax Aux Labels, the parameters are automatically assigned a name. 180 Version: 1.8.3 TF5810
## Page 181

PLCopen Motion Control 4.4.1.5 MC_Ax Ctrl Slow Down On Pressure Ex_Bk Plc Mc MC_Ax Ctrl Slow Down On Pressure Ex_Bk Plc Mc Enable BOOL BOOL Busy Enable Relief BOOL BOOL Active Setpoint LREAL BOOL Error Actual LREAL UDINT Error ID Feed Velocity LREAL p Param Pointer To ST_Tc Pctrl Param ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block brakes an axis in such a way that the actual value in Actual does not exceed the setpoint specified in Setpoint. In most cases, the actual pressure or actual force can be measured with function blocks of the type MC_Ax Rt Read Pressure Single_Bk Plc Mc [} 222] or MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220] or MC_Ax Rt Read Force Single_Bk Plc Mc [} 218] or MC_Ax Rt Read Force Diff_Bk Plc Mc [} 215]. Inputs VAR_INPUT Enable: BOOL:=FALSE; Enable Relief: BOOL:=FALSE; Setpoint: LREAL; Actual: LREAL; Feed Velocity: LREAL:=0.0; p Param: POINTER TO ST_Tc Pctrl Param:=0; END_VAR Name Type Description Enable BOOL A TRUE at this input enables the controller. Enable Relief BOOL A TRUE at this input allows the controller to actively back off if necessary. Setpoint LREAL The setpoint for the actual value to be limited. Actual LREAL The current value of the variable to be limited. Feed Velocity LREAL If the object against which the pressure or force is applied is moving, its velocity can be pre-controlled here. p Param POINTER TO The address of a structure of the type ST_Tc Pctrl Param [} 164] ST_Tc Pctrl Param can be transferred here. If this input is unused or if 0 is applied to it, the control parameters from the parameters of the axis are used. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Active: BOOL; Error: BOOL; Error ID: UDINT; END_VAR TF5810 Version: 1.8.3 181
## Page 182

PLCopen Motion Control Name Type Description Busy BOOL A TRUE at this output indicates that the function block is enabled. This does not necessarily mean that it is actively intervening in the behavior of the axis. Active BOOL A TRUE at this output indicates that the function block is enabled and is actively intervening in the behavior of the axis. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block The function block is placed in an idling state by a FALSE at Enable or if the axis is not enabled by the controller. Busy, Active and Error are then FALSE. If Enable is TRUE, a series of prerequisites is checked. • Setpoint must be recognizably different from 0.0. • The axis must be distance-controlled. • The axis must not be operated with an external setpoint generator. • The product of Setpoint and k P of the controller must not fall below the creep velocity of the axis. In this case, the axis would no longer be able to move sensibly. If one of these prerequisites is not satisfied, then Busy and Active are FALSE and Error is TRUE. Otherwise Busy is TRUE. The sign of Setpoint determines the working direction of the function block. If it is positive, it intervenes when Actual approaches the setpoint from below in an ascending direction. Active is only TRUE if the function block intervenes. The function block determines the difference between the setpoint and the actual value, taking into account the working direction, and calculates the still permissible velocity with the k P from the parameter structure used. If the target velocity exceeds this value, Active goes TRUE and the velocity is limited. When the actual value reaches the setpoint, the still permissible velocity = 0.0 and the axis should come to a standstill now at the latest. If the actual value continues to increase, an opposite movement is only triggered with Enable Relief. In some applications, a force or pressure must be exerted against a moving object. In this case, the control accuracy can be improved by providing the controller with a suitable pre-control at Feed Velocity. Integration of the function block in the application A function block of this type must be called after the actual value and actual pressure acquisition, and after the control value generation. If function blocks are called for velocity or position control, they must also be placed in front of the pressure controller function block. The MC_Ax Rt Finish_Bk Plc Mc [} 246] function block to be positioned after the controller function block then considers the response automatically. 4.4.1.6 MC_Ax Ctrl Stepper De Stall_Bk Plc Mc MC_Ax Ctrl Stepper De Stall_Bk Plc Mc Enable Acc BOOL BOOL Active Enable Dec BOOL BOOL Activated Reset BOOL BOOL Error Use KL2531State BOOL UDINT Error ID Reset Ref On Error BOOL First Aux Param Idx INT Velo Limit LREAL Limit Filter LREAL Update Filter LREAL ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block monitors the motion of a stepper motor axis, which is operated with an encoder. 182 Version: 1.8.3 TF5810
## Page 183

PLCopen Motion Control It is essential to use a real encoder (not an encoder emulation based on pulse counting of an output terminal) in order to ensure correct function of this function block. The application of such a function block can result in stalling (torque discontinuity). It therefore cannot be assumed that the velocity is constant. Inputs VAR_INPUT Enable Acc: BOOL:=FALSE; Enable Dec: BOOL:=FALSE; Reset: BOOL:=FALSE; Use KL2531State: BOOL:=FALSE; Reset Ref On Error: BOOL:=FALSE; First Aux Param Idx:INT:=0; Velo Limit: LREAL:=0.0; Limit Filter: LREAL:=0.0; Update Filter: LREAL:=0.0; END_VAR Name Type Description Enable Acc BOOL These inputs determine whether the monitoring may intervene during the acceleration and braking phases. Enable Dec BOOL Reset BOOL This input controls the activity of the controller. Use KL2531State BOOL If TRUE is transferred here, the function block evaluates ST_Tc Plc Device Input [} 149].b Terminal State. Reset Ref On Error BOOL If TRUE is transferred here, the function block clears the reference flag of the axis. First Aux Param Idx INT Here a range in the AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Param [} 130].f Customer Data can be activated as parameter interface. Velo Limit LREAL The threshold for the velocity deviation, from which the stall situation is detected. Limit Filter LREAL The time over which an excessive velocity deviation must be present continuously for the stall situation to be detected. Update Filter LREAL The time constant, with which the velocity control value in the function block is adjusted to the actual velocity. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Active: BOOL; Activated: BOOL; Error: BOOL; Error ID: UDINT; END_VAR TF5810 Version: 1.8.3 183
## Page 184

PLCopen Motion Control Name Type Description Active BOOL Indicates that a stall situation was detected. Activated BOOL Indicates that a stall situation was detected since the last start of an active axis movement. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behaviour of the function block: During each call the function block checks whether it has to change the state. It goes in the active state if the internal motion phase permits this under the rules of Enable Acc, Enable Dec and the velocity error continuously exceeds the value of Velo Limit for at least Limit Filter. Enable Acc enables the function block to intervene during phases with constant phases or phases with rising magnitude. Enable Dec enables the activity of the function block for phases with falling magnitude or constant velocity. Active and Activated are set during the transition to the active state. The function block changes to inactive state if the velocity error was reduced to half the value of Velo Limit. Active is cancelled during the transition to the inactive state. In active state the control value is adjusted to the actual velocity with the time constant Update Filter. If the time constant is set to 0.0, the actual velocity is applied directly. In inactive state Activated is cancelled, if the axis leaves the idle state and starts an active motion. Since the function block evaluates the difference between set and actual velocity, it is important to set the reference velocity correctly when this function block is used. Imprecise setting of this parameter can result in unnecessary intervention by the function block in the motion. The following Scope View shows a positioning, during which an obstacle was encountered twice. In each case the axis stopped completely. 184 Version: 1.8.3 TF5810
## Page 185

PLCopen Motion Control Integration of the function block in the application A function block of this type must be called after the actual value acquisition and control value generation. The function block superimposes its response with that of the control value generator and enters it in the ST_Tc Hyd Ax Rt Data [} 141]. The MC_Ax Rt Finish_Bk Plc Mc [} 246] function block to be positioned after the controller function block then considers the response automatically. A value greater than 0 in First Aux Param Idx can be used to instruct the function block to use three consecutive values in the f Customer Data of the parameter structure as Velo Limit, Limit Filter and Update Filter. If the address of a suitable ARRAY[..] OF STRING() is entered in Axis.p St Ax Aux Labels, the parameters are automatically assigned a name. 4.4.1.7 MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc Reset BOOL LREAL Set Pos I_Enable BOOL LREAL Set Velo ↔ Axis Reference To AXIS_REF_Bk Plc Mc LREAL Response BOOL In Windup Available from version 3.0.40 The function block can be used as an alternative to the default position controller. It is called after the MC_Ax Runtime_Bk Plc Mc() function block (setpoint generator and default position controller). This arrangement overwrites the responses of the default position controller. Inputs VAR_INPUT Reset: BOOL:=FALSE; I_Enable: BOOL:=FALSE; END_VAR Name Type Description Reset BOOL This input deletes all internal and external controller responses. I_Enable BOOL This input controls the activity of the I part. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Set Pos: LREAL; Set Velo: LREAL; Response: LREAL; In Windup: BOOL; END_VAR TF5810 Version: 1.8.3 185
## Page 186

PLCopen Motion Control Name Type Description Set Pos LREAL [mm] The set position that becomes effective at the internal controller. Set Velo LREAL [mm/s] The set velocity that becomes effective at the internal controller. Response LREAL [mm/s] The controller response. In Windup BOOL Here, the limitation of the I part that has become active is signaled. Purpose of the function block The default position controller integrated in the MC_Ax Runtime_Bk Plc Mc() [} 237] function block cannot meet the control requirements of some applications, due to its simple structure. The MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc() function block is available for such applications. It supports the following control components: • Position P controller • Position I controller with threshold and Windup limit • Position D controller (realized as velocity P controller) with attenuation time • Condition feedback for the actual velocity • Condition feedback for the actual acceleration • Compensation of the static effect of the condition feedback for the actual velocity Velocity pre-control is activated after the controller. The same applies to any activated linearizations. The controller is enabled with V3.0.40. The extended parameters are supported by the Plc Mc Manager released with this version. Structure of the controller The component marked with an asterisk * prepares the set value for the I component of the controller when the setpoint generator is path-controlled. This is necessary because the set position provided by the setpoint generator jumps to the target position when the braking distance is reached. With time-controlled setpoint generator, the component is transparent. 186 Version: 1.8.3 TF5810
## Page 187

PLCopen Motion Control Not shown here: TRUE on Reset, or a missing controller enable of the axis deletes both the I component and the controller output. The I component has a threshold value Dx, which prevents a response to small deviations. For technical reasons, this parameter is limited to at least 2/3 incremental weighting of the encoder. If the I component is to be inactive, set Ti to zero. The implementation of the D component takes advantage of the fact that the differentiated set position is provided by the setpoint generator. An actual velocity is determined by differentiating the actual position. Under this condition, the differentiation time constant Td acts as a proportionality factor. If the D component is to be inactive, set the time constant Td to zero. Three branches are implemented in the condition feedback: • Velocity activation: The actual velocity is filtered and activated with a weighting factor. As it is subtracted, it has an attenuating effect. If the connection is to be inactive, set K to zero. Cfb_V • Acceleration activation: The actual velocity is differentiated, filtered and activated with a weighting factor. As it is subtracted, it has an attenuating effect. If the connection is to be inactive, set K to Cfb_A zero. • A velocity activation generates a statically effective reduction of the velocity pre-control. In the case of path-controlled positioning, this generates a noticeable velocity deviation. With time-controlled positioning, this effect is compensated, as far as possible, by the continuously active position control. This undesirable side-effect of velocity feedback is eliminated by automatic adjustment of the pre- control. Deactivating the velocity activation also deactivates this compensation. Velocity pre-control is activated after the controller. The weighting is fixed at 1.0 when the setpoint generator is path-controlled and cannot be reduced. If linearization is activated, it takes place after the controller and is not shown here. 4.4.2 Drive 4.4.2.1 MC_Ax Rt Drive_Bk Plc Mc MC_Ax Rt Drive_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error Id Available from version 3.0 The function block performs preparation of the control value for the axis for it to be output on a hardware module. To this end a function block is called depending on the value set as n Drive_Type in Axis. ST_Tc Hyd Ax Param [} 130], which takes into account the special features of the hardware module. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. TF5810 Version: 1.8.3 187
## Page 188

PLCopen Motion Control Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behaviour of the function block: The function block investigates the axis interface that has been passed to it every time it is called. A number of problems can be detected and reported during this process: • If n Drive_Type in p St Ax Params is set to an unacceptable value, the function block reacts with Error and Error ID:=dw Tc Hyd Err Cd Drive Type. If the pointer p St Ax Rt Data for the axis has been initialized, it is placed into a fault state. • If one of the specific sub-function-blocks detects a problem, it will (if possible) place the axis into a fault state. This error is then echoed at the outputs of the MC_Ax Rt Drive_Bk Plc Mc. If it is possible to carry out these checks without encountering any problems, the control value for the axis is processed appropriately for the n Drive_Type [} 94] in Axis. ST_Tc Hyd Ax Param [} 130]. Information about the necessary linking of I/O components with the input and output structures of the axis may be found in the Knowledge Base [} 320] under FAQ #7. If only the usual blocks (encoder, generator, finish, drive) for the axis are to be called, a block of type MC_Ax Standard Body_Bk Plc Mc [} 253] should be used for simplicity. The function blocks MC_Ax Uti Read Reg Drive Term_Bk Plc Mc [} 293] and MC_Ax Uti Write Reg Drive Term_Bk Plc Mc [} 302] are available for asynchronous data exchange with I/O devices of the KL series. i Tc Mc_Drive Ax2000_B110A The function block handles the evaluation of the actual values of an AX2000 servo actuator at the Ether CAT fieldbus. This assumes that the connected motor is equipped with an absolute encoder. If a motor is operated with a resolver, i Tc Mc_Drive Ax2000_B110R should be set. During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this suggestion. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the encoder function block and described there. See also i Tc Mc_Encoder AX2000_B110A [} 199]. i Tc Mc_Drive Ax2000_B110R The function block handles the processing of the axis control value for output on an AX2000 servo drive at the Ether CAT fieldbus. During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this suggestion. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the encoder function block and described there. See also i Tc Mc_Encoder Ax2000_B110R [} 200]. 188 Version: 1.8.3 TF5810
## Page 189

PLCopen Motion Control i Tc Mc_Drive Ax2000_B200R, i Tc Mc_Drive Ax2000_B900R The function block handles the processing of the axis control value for output on an AX2000 servo drive at the Beckhoff Lightbus (B200) or Rt Ethernet fieldbus (B900). During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this suggestion. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the encoder function block and described there. See also i Tc Mc_Encoder Ax2000_B200R [} 201]. i Tc Mc_Drive Ax2000_B750A The function block handles (from V3.0.26) processing of the control value of the axis for output at an AX2000 servo actuator at the Sercos fieldbus. The function block handles the evaluation of the actual values of an AX2000 servo actuator at the Ether CAT fieldbus. During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this suggestion. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the encoder function block and described there. See also i Tc Mc_Encoder AX2000_B750A [} 202]. Note a number of special features. Further information can be found in the Knowledge Base. i Tc Mc_Drive Ax5000_B110A, i Tc Mc_Drive Ax5000_B110SR The function block handles the processing of the axis control value for output on an AX5000 servo actuator at the Ether CAT fieldbus. The function block handles the evaluation of the actual values of an AX2000 servo actuator at the Ether CAT fieldbus. If motor is operated with a resolver, i Tc Mc_Encoder Ax5000_B110SR should be set. During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this suggestion. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the encoder function block and described there. See also i Tc Mc_Encoder AX5000_B110A [} 202]. A list of successfully tested compatible devices can be found under i Tc Mc_Encoder AX5000_B110A [} 202]. Note a number of special characteristics. Further information can be found in the Knowledge Base. i Tc Mc_Drive Co E_DS402 The function block handles the evaluation of the actual values of a servo actuator with Co E DS402 profile at the Ether CAT fieldbus. During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this suggestion. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the encoder function block and described there. See also i Tc Mc_Encoder Co E_DS402A [} 204] and i Tc Mc_Encoder Co E_DS402SR [} 205]. A list of successfully tested compatible devices can be found under i Tc Mc_Encoder Co E_DS402SR [} 205]. TF5810 Version: 1.8.3 189
## Page 190

PLCopen Motion Control Currently only drives with resolver or single-turn encoders are supported. i Tc Mc_Drive_Co E_DS408 The function block handles the processing of the axis control value for output to a proportional valve at the Ether CAT fieldbus. The valve must support the Ci A DS408 profile. I/O variable Interface. Variable Use see note ST_Tc Plc Device Input.n Dac Out Output of the velocity signal. see note ST_Tc Plc Device Output.ui Drive Ctrl Device control. see note ST_Tc Plc Device Input.ui Status Device status Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Info Data. State ST_Tc Plc Device Input.ui Drive Box St Monitoring of online status ate Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Automatic identification. r The names of the process data exchanged with the device are specified via the XML file of the manufacturer. The valve must support the following Index. Sub Index combinations. Index Subindex Meaning 1000 0 Identification 1008 0 Device name (optional) 1018 1 Manufacturer ID 1018 2 Device type The following list of compatible devices is naturally incomplete. It is not a recommendation but is merely intended for information. Beckhoff cannot guarantee trouble-free operation of the listed devices. If a manufacturer or one of their devices is not listed, trouble-free operation may well be possible, but is not guaranteed. Manufacturer Type Description Moog D638Exxx Proportional valve Parker Dxx FP /Dxx FE /TDP /TPQ Proportional valve x: Represents a placeholder for different characters. i Tc Mc_Drive Ix2512_1Coil The function block deals with processing of the axis control value for output on an IP2512 PWM fieldbus module. I/O variable Interface. Variable Use Data out ST_Tc Plc Device Output.ui Dac Out A Output of the PWM factor. i Tc Mc_Drive Ix2512_2Coil The function block deals with processing of the axis control value for output on an IP2512 PWM fieldbus module. 190 Version: 1.8.3 TF5810
## Page 191

PLCopen Motion Control I/O variable Interface. Variable Use Data out ST_Tc Plc Device Output.ui Dac Out A Output of the PWM factor for coil 1. Data out ST_Tc Plc Device Output.ui Dac Out B Output of the PWM factor for coil 2. i Tc Mc_Drive EL2535 The function block prepares the control value of the axis for output on a current-controlled PWM output terminal. This terminal provides two independent output stages and can be used for the following valve types: Proportional valve with spring center position and two coils without permanent magnets: n Drive_Type = i Tc Mc_Drive EL2535_2Coil. Both channels are required for one valve. The terminal cannot be used for another valve at the same time. With this type of valve, a proportion of the full current in the directionally active coil with currentless countercoil is required to move the slider to the desired position. For -100% .. 0% .. +100% control, the terminal block generates the output values 0 .. 0 .. 32767 in ui Dac Out A and 32767 .. 0 .. 0 in ui Dac Out B. I/O variable Interface. Variable Use Channel1. PWM Output ST_Tc Plc Device Output.ui Dac Out A Output of the PWM factor for coil 1. Channel2. PWM Output ST_Tc Plc Device Output.ui Dac Out B Output of the PWM factor for coil 2. ST_Tc Plc Device Output.n Dac Out DO NOT USE! Channel1. Status ST_Tc Plc Device Input.ui Status Status of the first device channel Channel2. Status ST_Tc Plc Device Input.ui Terminal St Status of the second device ate2 channel Channel1. Control ST_Tc Plc Device Output.ui Drive Ctrl Control of the first device channel Channel2. Control ST_Tc Plc Device Output.ui Terminal Control of the second device Ctrl2 channel Info Data. State ST_Tc Plc Device Input.ui Drive Box St Connection monitoring, condition ate monitoring. Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Automatic identification, r parameterization. Proportional valve with spring end position and coil without permanent magnets: n Drive_Type = i Tc Mc_Drive EL2535_1Coil. Only one channel is required here. The terminal can also be used for another valve. The I/O variables of the second channel must be used for this purpose. With this type of valve, 50% of the full power supply is required to move the slider to the center position. The terminal module generates the output values 0 .. 16384 .. 32767 for -100% .. 0% .. +100% control. TF5810 Version: 1.8.3 191
## Page 192

PLCopen Motion Control I/O variable Interface. Variable Use ST_Tc Plc Device Output.ui Dac Out A DO NOT USE! ST_Tc Plc Device Output.ui Dac Out B DO NOT USE! Channel1. PWM Output ST_Tc Plc Device Output.n Dac Out Output of the PWM factor. Channel1. Status ST_Tc Plc Device Input.ui Status Device status Channel1. Control ST_Tc Plc Device Output.ui Drive Ctrl Device control. Info Data. State ST_Tc Plc Device Input.ui Drive Box St Connection monitoring, condition ate monitoring. Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Automatic identification, r parameterization. Proportional valve with spring center position and a coil with permanent magnets: n Drive_Type = i Tc Mc_Drive EL2535_1Coil. Only one channel is required here. The terminal can also be used for another valve. The I/O variables of the second channel must be used for this purpose. This type of valve requires a bipolar current supply, which corresponds to the operating principle of a ±10 V terminal. The output value generated by the terminal block is to be adjusted as follows AFTER the drive function block has been called by the application: ST_Tc Plc Device Output.n Dac Out := 2 * (ST_Tc Plc Device Output.n Dac Out - 16384); I/O variable Interface. Variable Use ST_Tc Plc Device Output.ui Dac Out A DO NOT USE! ST_Tc Plc Device Output.ui Dac Out B DO NOT USE! Channel1. PWM Output ST_Tc Plc Device Output.n Dac Out Output of the PWM factor. Channel1. Status ST_Tc Plc Device Input.ui Status Device status Channel1. Control ST_Tc Plc Device Output.ui Drive Ctrl Device control. Info Data. State ST_Tc Plc Device Input.ui Drive Box St Connection monitoring, condition ate monitoring. Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Automatic identification, r parameterization. i Tc Mc_Drive EL4132 The function block deals with processing of the axis control value for output on a ±10 V output terminal. I/O variable Interface. Variable Use Output ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. Info Data. State ST_Tc Plc Device Input.ui Drive Box St Connection monitoring, condition ate monitoring. Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate i Tc Mc_Drive EL7031 The function block deals with processing of the axis control value for output on an EL7031 stepper motor output stage terminal. 192 Version: 1.8.3 TF5810
## Page 193

PLCopen Motion Control I/O variable Interface. Variable Use STM Velocity. Velocity ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. STM Control. Control ST_Tc Plc Device Output.ui Drive Ctrl Operation: Control of the output stage. STM Status. Status ST_Tc Plc Device Input.ui Status Operation: Status of the output stage. Wc State. Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Info Data. State ST_Tc Plc Device Input.ui Drive Box St Connection monitoring, condition ate monitoring. Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Communication. r i Tc Mc_Drive EL7041 The function block deals with processing of the axis control value for output on an EL7041 stepper motor output stage terminal. I/O variable Interface. Variable Use STM Velocity. Velocity ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. STM Control. Control ST_Tc Plc Device Output.ui Drive Ctrl Operation: Control of the output stage. STM Status. Status ST_Tc Plc Device Input.ui Status Operation: Status of the output stage. ENC Status. Counter Value ST_Tc Plc Device Input.ui Count Operation: Read the actual position. ENC Status. Latch Value ST_Tc Plc Device Input.ui Latch Operation: Reading the latch position. ENC Status. Status ST_Tc Plc Device Input.ui Terminal St Operation: Status of the encoder ate2 interface. ENC Control. Control ST_Tc Plc Device Output.ui Terminal Operation: Control of the encoder Ctrl2 interface. Wc State. Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Info Data. State ST_Tc Plc Device Input.ui Drive Box St Connection monitoring, condition ate monitoring. Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Communication. r i Tc Mc_Drive EL7201 The function block prepares the control value of the axis for output to an EL7201 servo terminal. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the encoder function block. See also i Tc Mc_Encoder EL7201. TF5810 Version: 1.8.3 193
## Page 194

PLCopen Motion Control I/O variable Interface. Variable Use Target velocity ST_Tc Plc Device Output. Nominal Ve Operation: Output of the velocity lo signal. Controlword ST_Tc Plc Device Output.ui Drive Ctrl Operation: Control of the output stage. Position actual value ST_Tc Plc Device Input.udi Count Operation: Read the actual position. Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Statusword ST_Tc Plc Device Input.ui Status Operation: Status of the output stage. Info Data. State ST_Tc Plc Device Input.ui Drive Box St Connection monitoring, condition ate monitoring. Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Communication r i Tc Mc_Drive KL2521 The function block deals with processing of the axis control value for output on a KL2521 pulse output terminal. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the encoder function block. See also i Tc Mc_Encoder KL2521 [} 211]. I/O variable Interface. Variable Use Data in ST_Tc Plc Device Input.ui Terminal D Operation: Read the actual ata position. For register communication [} 336]: Interface for read data. Control ST_Tc Plc Device Output.b Terminal Register communication Ctrl Status ST_Tc Plc Device Input.b Terminal St Register communication ate Data out ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. Register communication: Interface for written data. i Tc Mc_Drive KL2531 The function block deals with processing of the axis control value for output on a KL2531 stepper motor output stage terminal. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the encoder function block. See also i Tc Mc_Encoder KL2531 [} 211]. 194 Version: 1.8.3 TF5810
## Page 195

PLCopen Motion Control I/O variable Interface. Variable Use Velocity ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. For register communication [} 336]: Interface for written data. Position ST_Tc Plc Device Input.ui Terminal D Operation: Read the actual ata position. For register communication: Interface for read data. Ctrl ST_Tc Plc Device Output.b Terminal Control the output stage, register Ctrl communication. Status ST_Tc Plc Device Input.b Terminal St Status of the output stage, register ate communication. Ext Status ST_Tc Plc Device Input.ui Terminal St Diagnosis of output stage and ate2 motor i Tc Mc_Drive KL2532 The function block deals with processing of the axis control value for output on a KL2532 DC motor output stage terminal. I/O variable Interface. Variable Use Data in ST_Tc Plc Device Input.ui Terminal D For register communication ata [} 336]: Interface for read data. Control ST_Tc Plc Device Output.b Terminal Register communication. Ctrl Status ST_Tc Plc Device Input.b Terminal St Register communication ate Data out ST_Tc Plc Device Output.n Dac Out Register communication i Tc Mc_Drive KL2535_1Coil, i Tc Mc_Drive KL2535_2Coil The function block deals with processing of the axis control value for output on a KL2535 PWM output stage terminal. I/O variable Interface. Variable Use Data in ST_Tc Plc Device Input.ui Terminal D Register communication [} 336] ata Control ST_Tc Plc Device Output.b Terminal Register communication. Ctrl Status ST_Tc Plc Device Input.b Terminal St Register communication ate Data out ST_Tc Plc Device Output.n Dac Out Register communication i Tc Mc_Drive KL2541 The function block deals with processing of the axis control value for output on a KL2541 stepper motor output stage terminal. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the encoder function block. See also i Tc Mc_Encoder KL2541 [} 212]. TF5810 Version: 1.8.3 195
## Page 196

PLCopen Motion Control I/O variable Interface. Variable Use Velocity ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. For register communication [} 336]: Interface for written data. Position ST_Tc Plc Device Input.ui Terminal D Operation: Read the actual ata position. For register communication: Interface for read data. Ctrl ST_Tc Plc Device Output.b Terminal Control the output stage, register Ctrl communication. Status ST_Tc Plc Device Input.b Terminal St Status of the output stage, register ate communication. Ext Ctrl ST_Tc Plc Device Output.ui Terminal Latch control during homing with Ctrl2 the synchronous pulse of the encoder Ext Status ST_Tc Plc Device Input.ui Terminal St Diagnosis of output stage and ate2 motor, latch status during homing with the synchronous pulse of the encoder i Tc Mc_Drive KL2542 The function block deals with processing of the axis control value for output on a KL2542 DC motor output stage terminal. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the encoder function block. See also i Tc Mc_Encoder KL2542 [} 212]. I/O variable Interface. Variable Use Data out ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. For register communication [} 336]: Interface for written data. Data in ST_Tc Plc Device Input.ui Terminal D Operation: Read the actual ata position. For register communication: Interface for read data. Control ST_Tc Plc Device Output.b Terminal Control the output stage, register Ctrl communication. Status ST_Tc Plc Device Input.b Terminal St Status of the output stage, register ate communication. i Tc Mc_Drive KL4032 The function block deals with processing of the axis control value for output on a ±10 V output terminal. 196 Version: 1.8.3 TF5810
## Page 197

PLCopen Motion Control I/O variable Interface. Variable Use Data out ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. For register communication [} 336]: Interface for written data. Control ST_Tc Plc Device Output.b Terminal Register communication Ctrl Status ST_Tc Plc Device Input.b Terminal St Register communication ate Data in ST_Tc Plc Device Output.ui Terminal Register communication: Interface Data for read data. i Tc Mc_Drive Low Cost Stepper The function block deals with processing of the axis control value for output on digital output terminals. For emulation of an actual position, a pulse counter is updated, which can be evaluated with an i Tc Mc_Encoder Low Cost Stepper [} 214] encoder. I/O variable Interface. Variable Use Output ST_Tc Plc Device Output.n Dig Out Ap Non-inverted control of the A phase. Output ST_Tc Plc Device Output.n Dig Out An Inverted control of the A phase. Output ST_Tc Plc Device Output.n Dig Out Bp Non-inverted control of the B phase. Output ST_Tc Plc Device Output.n Dig Out Bn Inverted control of the B phase. i Tc Mc_Drive Low Cost Inverter The function block deals with processing of the axis control value for output on digital output terminals for operation of a pole reversing contactor configuration or a frequency inverter with fixed frequencies. If this drive type is used, a number of special characteristics must be taken into account. For linking, a distinction has to be made between two options: Brake, enable, direction and velocity level After the MC_Ax Rt Finish_Bk Plc Mc [} 246] or MC_Ax Standard Body_Bk Plc Mc [} 253]function block of the axis has been called, four decoded signals are available. In order to generate the required signals, the following consolidations of the direction-specific signals are required after the function block call. Sample: st Ax Device Out.b Dig Out Ap:=st Ax Device Out.b Dig Out Ap OR st Ax Device Out.b Dig Out Bp; st Ax Device Out.b Dig Out An:=st Ax Device Out.b Dig Out An OR st Ax Device Out.b Dig Out Bn; From V3.0.11 the output of an absolute value can be activated on the valve tab. In this case, the signal consolidation shown above is applied internally. TF5810 Version: 1.8.3 197
## Page 198

PLCopen Motion Control I/O variable Interface. Variable Use Output ST_Tc Plc Device Output.n Dig Out Ap Selection of the fixed frequency for rapid traverse. Output ST_Tc Plc Device Output.n Dig Out An Selection of the fixed frequency for slow traverse. Output ST_Tc Plc Device Output.b Move Pos Specifies the direction of travel: Positive. Output ST_Tc Plc Device Output.b Move Neg Specifies the direction of travel: Negative. Output ST_Tc Plc Device Output.b Power On Enabling the power stage. Output ST_Tc Plc Device Output.b Brake Off Activation of the brake. Input ST_Tc Plc Device Input.b Power Ok Status of the converter: Ready for operation. Brake, enable and direction-coded velocity level I/O variable Interface. Variable Use Output ST_Tc Plc Device Output.n Dig Out Ap Selection of the fixed frequency for rapid traverse in positive direction of travel. Output ST_Tc Plc Device Output.n Dig Out An Selection of the fixed frequency for slow traverse in positive direction of travel. Output ST_Tc Plc Device Output.n Dig Out Bn Selection of the fixed frequency for slow traverse in negative direction of travel. Output ST_Tc Plc Device Output.n Dig Out Bp Selection of the fixed frequency for rapid traverse in negative direction of travel. Output ST_Tc Plc Device Output.b Power On Enabling the power stage. Output ST_Tc Plc Device Output.b Brake Off Activation of the brake. Input ST_Tc Plc Device Input.b Power Ok Status of the converter: Ready for operation. i Tc Mc_Drive M2400_Dn The function block performs preparation of the control value for the axis so that it can be output on one of the four channels of a ±10 V M2400 output box. I/O variable Interface. Variable Use Data out ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. 4.4.3 Encoder 4.4.3.1 MC_Ax Rt Encoder_Bk Plc Mc MC_Ax Rt Encoder_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error Id BOOL Above Limit BOOL Below Limit Available from version 3.0 198 Version: 1.8.3 TF5810
## Page 199

PLCopen Motion Control This function block determines the actual position of the axis from the input information of a hardware module. To this end a function block is called depending on the value set as n Enc_Type in Axis. ST_Tc Hyd Ax Param [} 130], which takes into account the special features of the hardware module. MC_Ax Rt Hybrid Axis Actuals_Bk Plc Mc [} 224] is an adapted function block for determining the essential actual values of a servo-electric/hydraulic hybrid axis. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; Above Limit: BOOL; Below Limit: BOOL; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Above Limit BOOL Exceeding of the upper software limit switch is indicated by the actual position. Below Limit BOOL If the value falls below the lower software limit switch, this is indicated by the actual position. Behavior of the function block The function block investigates the axis interface that has been passed to it every time it is called. A number of problems can be detected and reported during this process: • If n Enc_Type in p St Ax Params is set to an unacceptable value, the function block responds with Error and Error ID:=dw Tc Hyd Err Cd Enc Type. The axis is set to an error state. • If one of the specific sub-function-blocks detects a problem, it will (if possible) place the axis into a fault state. This error is then echoed at the outputs of the MC_Ax Rt Encoder_Bk Plc Mc. If it is possible to carry out these checks without encountering any problems, the actual value of the axis is determined by calling a type-specific function block corresponding to the n Enc_Type [} 98] in Axis. ST_Tc Hyd Ax Param [} 130]. Information about the necessary linking of I/O components with the input and output structures of the axis may be found in the Knowledge Base under FAQ #4 [} 324]. If only the usual blocks (encoder, generator, finish, drive) for the axis are to be called, a block of type MC_Ax Standard Body_Bk Plc Mc [} 253] should be used for simplicity. The function blocks MC_Ax Uti Read Reg Enc Term_Bk Plc Mc [} 294] and MC_Ax Uti Write Reg Enc Term_Bk Plc Mc [} 303] are available for asynchronous data exchange with I/O devices of the KL series. i Tc Mc_Encoder Ax2000_B110A The function block handles the evaluation of the actual values of an AX2000 servo actuator at the Ether CAT fieldbus. This assumes that the connected motor is equipped with an absolute encoder. If a motor is operated with a resolver, i Tc Mc_Encoder Ax2000_B110R should be set. TF5810 Version: 1.8.3 199
## Page 200

PLCopen Motion Control During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this proposition. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the drive function block. See also i Tc Mc_Drive AX2000_B110R [} 188]. I/O variable Interface. Variable Use Position actual value ST_Tc Plc Device Input. Actual Pos[0. Determines the actual position. .1] Status word ST_Tc Plc Device Input.ui Status Device status, encoder emulation. Control word ST_Tc Plc Device Output.ui Drive Ctrl Device control. Velocity demand value ST_Tc Plc Device Output. Nominal Ve Output of the velocity control value. lo Wc State (see note) ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring for actual e value acquisition. Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring for the ate drive. Info Data. State ST_Tc Plc Device Input.ui Drive Box St Monitoring of online status ate Info Data. Ads Addr (see note) ST_Tc Plc Device Input.s Enc Ads Add Parameter communication. r Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Control of real-time status, r parameter communication. Chn0 (see note) ST_Tc Plc Device Input.n Enc Ads Cha Parameter communication. nnel Chn0 ST_Tc Plc Device Input.n Drv Ads Cha Control of real-time status, nnel parameter communication. Output (on a DO terminal) ST_Tc Plc Device Output. Power On Optional control of the mains contactor. A digital output terminal is required for this purpose. Input (on a DI terminal) ST_Tc Plc Device Input. Power Ok Optional evaluation of the mains contactor. A digital input terminal is required for this purpose. In order to simplify the establishment of the I/O link, the linking of ST_Tc Plc Device Input.s Enc Ads Addr, ST_Tc Plc Device Input.n Enc Ads Channel and ST_Tc Plc Device Input.w Enc Wc State can be avoided, if the actual value acquisition takes place via the same device, as usual. In this case, the function blocks for parameter communication and encoder evaluation use the corresponding variables of the drive link. i Tc Mc_Encoder Ax2000_B110R The function block handles the evaluation of the actual values of an AX2000 servo actuator at the Ether CAT fieldbus. This assumes that the connected motor is equipped with a resolver. If a motor is operated with an absolute encoder, i Tc Mc_Encoder Ax2000_B110A must be set. During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this proposition. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the drive function block. See also i Tc Mc_Drive AX2000_B110R [} 188]. 200 Version: 1.8.3 TF5810
## Page 201

PLCopen Motion Control I/O variable Interface. Variable Use Position actual value ST_Tc Plc Device Input. Actual Pos[0. Determines the actual position. .1] Status word ST_Tc Plc Device Input.ui Status Device status, encoder emulation. Control word ST_Tc Plc Device Output.ui Drive Ctrl Device control. Velocity demand value ST_Tc Plc Device Output. Nominal Ve Output of the velocity control value. lo Wc State (see note) ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring for actual e value acquisition. Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring for the ate drive. ui Drive Box State ST_Tc Plc Device Input. Info Data. Stat Monitoring of online status e Info Data. Ads Addr (see note) ST_Tc Plc Device Input.s Enc Ads Add Parameter communication. r Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Parameter communication. r Chn0 (see note) ST_Tc Plc Device Input.n Enc Ads Cha Parameter communication. nnel Chn0 ST_Tc Plc Device Input.n Drv Ads Cha Parameter communication. nnel Output (on a DO terminal) ST_Tc Plc Device Output. Power On Optional control of the mains contactor. A digital output terminal is required for this purpose. Input (on a DI terminal) ST_Tc Plc Device Input. Power Ok Optional evaluation of the mains contactor. A digital input terminal is required for this purpose. In order to simplify the establishment of the I/O link, the linking of ST_Tc Plc Device Input.s Enc Ads Addr, ST_Tc Plc Device Input.n Enc Ads Channel and ST_Tc Plc Device Input.w Enc Wc State can be avoided, if the actual value acquisition takes place via the same device, as usual. In this case, the function blocks for parameter communication and encoder evaluation use the corresponding variables of the drive link. i Tc Mc_Encoder Ax2000_B200R, i Tc Mc_Encoder Ax2000_B900R The function block deals with evaluation of the actual values of an AX2000 servo actuator with Lightbus (B200) or Realtime Ethernet (B900). During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this proposition. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the drive function block. See also i Tc Mc_Drive AX2000_B200R [} 189]. TF5810 Version: 1.8.3 201
## Page 202

PLCopen Motion Control I/O variable Interface. Variable Use Actual Pos[0..1] ST_Tc Plc Device Input. Actual Pos[0. Determines the actual position. .1] Drive Error ST_Tc Plc Device Input. Drive Error Device status. Drive State[0..3] ST_Tc Plc Device Input. Drive State[0. Device status. .3] Box State ST_Tc Plc Device Input.ui Drive Box St Connection monitoring. ate Drive Ctrl0 ST_Tc Plc Device Output. Drive Ctrl[0] Device control. Drive Ctrl1 ST_Tc Plc Device Output. Drive Ctrl[1] Device control. Drive Ctrl2 ST_Tc Plc Device Output. Drive Ctrl[2] Device control. Drive Ctrl3 ST_Tc Plc Device Output. Drive Ctrl[3] Device control. Nominal Velo ST_Tc Plc Device Output. Nominal Ve Output of the velocity control value. lo Output (on a DO terminal) ST_Tc Plc Device Output. Power On Optional control of the mains contactor. A digital output terminal is required for this purpose. Input (on a DI terminal) ST_Tc Plc Device Input. Power Ok Optional evaluation of the mains contactor. A digital input terminal is required for this purpose. i Tc Mc_Encoder Ax2000_B750A The function block handles (from V3.0.26) the evaluation of the actual values of an AX2000 servo drive at the Sercos fieldbus. This assumes that the connected motor is equipped with an absolute encoder. During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulics library, it is essential to decline this proposition. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the drive function block. See also i Tc Mc_Drive AX2000_B750A [} 189]. I/O variable Interface. Variable Use Drive status word ST_Tc Plc Device Input.ui Status Device status. Actual position value encoder 1 ST_Tc Plc Device Input.udi Count Determines the actual position. Master control word ST_Tc Plc Device Output.ui Drive Ctrl Device control. Velocity command value ST_Tc Plc Device Output. Nominal Ve Output of the velocity control value. lo System Status (from Sercos ST_Tc Plc Device Input.ui Drive Box St Monitoring of the Sercos phase. master) ate This variable is provided by the Sercos master (e.g. FC7501). Output (on a DO terminal) ST_Tc Plc Device Output. Power On Optional control of the mains contactor. A digital output terminal is required for this purpose. Input (on a DI terminal) ST_Tc Plc Device Input. Power Ok Optional evaluation of the mains contactor. A digital input terminal is required for this purpose. Note a number of special characteristics. Further information can be found in the Knowledge Base [} 320]. i Tc Mc_Encoder Ax5000_B110A, i Tc Mc_Encoder Ax5000_B110SR The function block handles the evaluation of the actual values of an AX5000 servo actuator at the Ether CAT fieldbus. This assumes that the connected motor is equipped with an absolute encoder. If a motor is operated with a resolver, i Tc Mc_Encoder Ax5000_B110SR should be set. 202 Version: 1.8.3 TF5810
## Page 203

PLCopen Motion Control During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this proposition. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the drive function block. See also i Tc Mc_Drive AX5000_B110A [} 189]. I/O variable Interface. Variable Use Position feedback 1 value ST_Tc Plc Device Input.udi Count Determines the actual position. Drive status word ST_Tc Plc Device Input.ui Status Device status. Master control word ST_Tc Plc Device Output.ui Drive Ctrl Device control. Velocity command value ST_Tc Plc Device Output. Nominal Ve Output of the velocity control value. lo Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring for the ate drive. Wc State (see note) ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring for actual e value acquisition. Info Data. State ST_Tc Plc Device Input. Monitoring of online status ui Drive Box State Info Data. Ads Addr ST_Tc Plc Device Input.s Drv Ads Add Control of real-time status, r parameter communication. Info Data. Ads Addr (see note) ST_Tc Plc Device Input.s Enc Ads Add Parameter communication. r Chn0 (see note 2) ST_Tc Plc Device Input.n Drv Ads Cha For single devices or the first drive nnel of a dual device: Control of real- time status, parameter communication. Chn0 (see notes 1,2) ST_Tc Plc Device Input.n Enc Ads Cha For single devices or the first drive nnel of a dual device: Parameter communication. Chn1 (see note 2) ST_Tc Plc Device Input.n Drv Ads Cha Only for the second drive of a dual nnel device: Control of real-time status, parameter communication. Chn1 (see notes 1,2) ST_Tc Plc Device Input.n Enc Ads Cha Only for the second drive of a dual nnel device: Parameter communication. Output (on a DO terminal) ST_Tc Plc Device Output. Power On Optional control of the mains contactor. A digital output terminal is required for this purpose. Input (on a DI terminal) ST_Tc Plc Device Input. Power Ok Optional evaluation of the mains contactor. A digital input terminal is required for this purpose. The following list of compatible devices is naturally incomplete. It is not a recommendation but is merely intended for information. Beckhoff cannot guarantee trouble-free operation of the listed devices. If a manufacturer or one of their devices is not listed, trouble-free operation may well be possible, but is not guaranteed. Manufacturer Type Description Baumüller b-maxx Servo controller with single-turn absolute encoder TF5810 Version: 1.8.3 203
## Page 204

PLCopen Motion Control In order to simplify the establishment of the I/O link, the linking of ST_Tc Plc Device Input.s Enc Ads Addr, ST_Tc Plc Device Input.n Enc Ads Channel and ST_Tc Plc Device Input.w Enc Wc State can be avoided, if the actual value acquisition takes place via the same device, as usual. In this case, the function blocks for parameter communication and encoder evaluation use the corresponding variables of the drive link. The variables Chn0 and Chn2 are used for distinguishing the channels of a dual unit. Connect Chn0 for the first drive of the device and Chn1 for the second. For single devices proceed as for the first channel of a dual device. Note a number of special characteristics. Further information can be found in the Knowledge Base. i Tc Mc_Encoder Co E_DS402A The function block handles the evaluation of the actual values of a servo actuator with Co E DS402 profile at the Ether CAT fieldbus. This assumes that the connected motor is equipped with a multi-turn absolute encoder. AX8000 devices with absolute encoder support this profile. During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulics library, it is essential to decline this proposition. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the drive function block. See also i Tc Mc_Drive Co E_DS402 [} 189]. I/O variable Interface. Variable Use see notice ST_Tc Plc Device Input.udi Count Determines the actual position. ST_Tc Plc Device Input.ui Status ST_Tc Plc Device Output.ui Drive Ctrl ST_Tc Plc Device Output. Nominal Ve lo Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Info Data. State ST_Tc Plc Device Input.ui Drive Box St Monitoring of online status ate Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Automatic identification. r The names of the process data exchanged with the device are specified via the XML file of the manufacturer. A list with compatible devices can be found below. Mapping Note AX8000: 204 Version: 1.8.3 TF5810
## Page 205

PLCopen Motion Control I/O variable Interface. Variable Use Position actual value ST_Tc Plc Device Input.udi Count Determines the actual position. Statusword ST_Tc Plc Device Input.ui Status Controlword ST_Tc Plc Device Output.ui Drive Ctrl Target velocity ST_Tc Plc Device Output. Nominal Ve Set velocity lo Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Info Data. State ST_Tc Plc Device Input.ui Drive Box St Monitoring of online status ate Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Automatic identification. r i Tc Mc_Encoder Co E_DS402SR The function block handles the evaluation of the actual values of a servo actuator with Co E DS402 profile at the Ether CAT fieldbus. This assumes that the connected motor is equipped with a resolver or a single-turn absolute encoder. During manual insertion or automatic detection of a drive actuator the Twin CAT System Manager will suggest to insert an NC axis in the project and connect it with this actuator. If this actuator is to be controlled with the hydraulic system library, it is essential to decline this proposition. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions overlap with those of the drive function block. See also i Tc Mc_Drive Co E_DS402 [} 189]. I/O variable Interface. Variable Use see note ST_Tc Plc Device Input.udi Count Determines the actual position. ST_Tc Plc Device Input.ui Status ST_Tc Plc Device Output.ui Drive Ctrl ST_Tc Plc Device Output. Nominal Ve lo Wc State ST_Tc Plc Device Input.w Drive Wc St Connection monitoring. ate Info Data. State ST_Tc Plc Device Input.ui Drive Box St Monitoring of online status ate Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Automatic identification. r The names of the process data exchanged with the device are specified via the XML file of the manufacturer. The encoder must support the following Index. Sub Index combinations. TF5810 Version: 1.8.3 205
## Page 206

PLCopen Motion Control Index Subindex Meaning 1000 0 Identification 1008 0 Device name (optional) 1018 1 Manufacturer ID 1018 2 Device type 6080 0 Maximum speed in RPM (optional; if this object is not supported, the reference speed must be entered manually). 608F 1 Number of encoder increments per motor revolution. 6090 1 Number of increments per motor revolution used for control value output. The following list of compatible devices is naturally incomplete. It is not a recommendation but is merely intended for information. Beckhoff cannot guarantee trouble-free operation of the listed devices. If a manufacturer or one of their devices is not listed, trouble-free operation may well be possible, but is not guaranteed. Manufacturer Type Description LTi DRi VES Gmb H Servo controller with single-turn absolute encoder i Tc Mc_Encoder Co E_DS406 The function block handles the evaluation of encoders with direct Ether CAT connection. The encoder must support the Ci A DS406 profile. I/O variable Interface. Variable Use see note ST_Tc Plc Device Input.udi Count Determines the actual position. see notes ST_Tc Plc Device Input.w Enc Dev Sta Monitoring the device status. te Wc State ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring. e Info Data. State ST_Tc Plc Device Input.ui Enc Box Sta Monitoring of online status. te Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Automatic identification. r The names of the process data exchanged with the device are specified via the XML file of the manufacturer. Monitoring of the device status is not guaranteed for all devices from all manufacturers. For some devices an 8-bit status is provided. This kind of information should be mapped on the lower 8 bits of the w Enc Dev State element. The encoder must support the following Index. Sub Index combinations. 206 Version: 1.8.3 TF5810
## Page 207

PLCopen Motion Control Index Subindex Meaning 1000 0 Identification 1008 0 Device name (optional) 1018 1 Manufacturer ID 1018 2 Device type 6001 0 Rotational encoders: increments per revolution (obligatory) 6002 0 Rotational encoders: Total counting range (option A, alternatively: index 6502) Linear encoders: Total counting range (obligatory) 6005 1 Linear encoders: Resolution (option A, alternatively: index 6501) 6501 0 Linear encoders: Resolution (option B, alternatively: index 6005) 6502 0 Rotational encoders: Number of counted revolutions (option B, alternatively: index 6002) 650A 2 Linear encoders: lower limit of the intended working area (option) 650B 3 Linear encoders: upper limit of the intended working area (option) The following list of compatible devices is naturally incomplete. It is not a recommendation but is merely intended for information. Beckhoff cannot guarantee trouble-free operation of the listed devices. If a manufacturer or one of their devices is not listed, trouble-free operation may well be possible, but is not guaranteed. Certain parameters can be determined automatically, depending on the support of the listed objects. This applies to the counting range, the overflow detection and (for linear encoders) the resolution. If the respective objects are not provided or not in a supported combination, this is not possible. In such a case, operation may be possible. However, the parameters must then be set manually during commissioning. Manufacturer Type Description Fritz Kübler Gmb H 58x8 Multi-turn absolute encoder. IVO Gmb H & Co. KG GXMMW_H Multi-turn absolute encoder. MTS Temposonics R Linear absolute encoder. TR Electronic Gmb H: LMP Linear absolute encoder. TWK-Electronic Gmb H CRKxx12R12C1xx Multi-turn absolute encoder. i Tc Mc_Encoder Dig Cam The function block handles the evaluation of four digital inputs as position cams. I/O variable Interface. Variable Use Input ST_Tc Plc Device Input.b Dig Cam PP Determines the actual position: Positive target cam. Input ST_Tc Plc Device Input.b Dig Cam P Determines the actual position: Positive brake cam. Input ST_Tc Plc Device Input.b Dig Cam M Determines the actual position: Negative brake cam. Input ST_Tc Plc Device Input.b Dig Cam MM Determines the actual position: Negative target cam. TF5810 Version: 1.8.3 207
## Page 208

PLCopen Motion Control i Tc Mc_Encoder Dig Increment The function block handles the evaluation of two digital inputs for the emulation of an incremental encoder evaluation. I/O variable Interface. Variable Use Input ST_Tc Plc Device Input.b Dig In A Determines the actual position. Input ST_Tc Plc Device Input.b Dig In B Determines the actual position. i Tc Mc_Encoder EL3102 The function block handles the evaluation of data from an EL3102 analog input terminal. I/O variable Interface. Variable Use Value ST_Tc Plc Device Input.ui Count Read the actual position. Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Optional: Address information for r parameter communication via Co E. Info Data. State ST_Tc Plc Device Input.ui Enc Box Sta Connection monitoring, condition te monitoring. Wc State ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring. e i Tc Mc_Encoder EL3142 The function block handles the evaluation of data from an EL3142 analog input terminal. The mapping is similar to the interface-compatible EL3102. i Tc Mc_Encoder EL3162 The function block handles the evaluation of data from an EL3162 analog input terminal. The mapping is similar to the interface-compatible EL3102. i Tc Mc_Encoder EL3255 The function block handles the evaluation of data from an EL3255 analog input terminal. I/O variable Interface. Variable Use AI Standard Channel x. Value ST_Tc Plc Device Input.ui Count Read the actual position. AI Standard Channel x. Status ST_Tc Plc Device Input.w Enc Dev Sta Evaluation of the fault signal of the te encoder. Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Address information for parameter r communication via Co E. Info Data. State ST_Tc Plc Device Input.ui Enc Box Sta Connection monitoring, condition te monitoring. Wc State ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring. e The terminal supports up to five encoders. The variables Info Data. Ads Addr, Info Data. State and Wc State should be distributed to all axes involved through multiple mapping. i Tc Mc_Encoder EL5001 The function block handles the evaluation of data from an EL5001 SSI encoder terminal. 208 Version: 1.8.3 TF5810
## Page 209

PLCopen Motion Control I/O variable Interface. Variable Use Value ST_Tc Plc Device Input.udi Count Read the actual position. Status ST_Tc Plc Device Output.usi Reg Stat Evaluation of the fault signal of the us encoder. Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Address information for parameter r communication via Co E. Info Data. State ST_Tc Plc Device Input.ui Enc Box Sta Connection monitoring, condition te monitoring. Wc State ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring. e i Tc Mc_Encoder EL5021 The function block handles the evaluation of data from an EL5021 sin/cos encoder terminal. I/O variable Interface. Variable Use ENC Status. Counter value ST_Tc Plc Device Input.udi Count Read the actual position. ENC Status. Status ST_Tc Plc Device Input.usi Reg Statu Evaluation of the fault signal of the s encoder. ENC Status. Latch value ST_Tc Plc Device Input.udi Latch For homing using the synchronous pulse of the encoder. ENC Control. Control ST_Tc Plc Device Output.usi Ctrl Control of the latch function. Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Address information for parameter r communication via Co E. Info Data. State ST_Tc Plc Device Input.ui Enc Box Sta Connection monitoring, condition te monitoring. Wc State ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring. e i Tc Mc_Encoder EL5032 (ab V3.0.40) The function block handles the evaluation of data from an EL5032 ENDAT encoder terminal. The EL5032 terminal provides a 32-bit or 64-bit counter, depending on its setting. This means that the highest value that can be displayed is either 232 – 1 or 264 – 1. Multiplied with the encoder resolution, this results in the evaluable path. At 10 nm resolution results in a value of 42949 mm. This is sufficient for most applications, which is why it is usually OK to use the terminal in 32-bit mode. To do this, only the mapping to udi Count is required. Otherwise, the 64-bit mode of the terminal must be activated and the complete mapping to udi Count and S_Di Reserve[1] must be configured. NOTICE Note the supply voltage To prevent damage to the connected device, check the supply voltage set in the EL5032 before connecting the device When a fieldbus is started and an axis error is reset, certain parameters of the connected device are read. The device type is included in the logging. Only absolute linear scales and absolute multi-turn encoders are accepted. With linear scales, the resolution is automatically updated in the encoder weighting and interpolation. TF5810 Version: 1.8.3 209
## Page 210

PLCopen Motion Control I/O variable Interface. Variable Use Position (DWORD or lower part of ST_Tc Plc Device Input.udi Count Read the actual position. ULINT) Position (upper part of ULINT) ST_Tc Plc Device Input. S_Di Reserv Optional: Reading of the actual e[1] position under Twin CAT 2. Position (upper part of ULINT) ST_Tc Plc Device Input.udi Latch Optional: Reading of the actual position under Twin CAT 3. Status ST_Tc Plc Device Input.ui Enc Dev Sta Evaluation of the fault signal of the te encoder. Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Address information for parameter r communication via Co E. Info Data. State ST_Tc Plc Device Input.ui Enc Box Sta Connection monitoring, condition te monitoring. Wc State ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring. e i Tc Mc_Encoder EL5101 The function block handles the evaluation of data from an EL5101 incremental encoder terminal. I/O variable Interface. Variable Use Value ST_Tc Plc Device Input.ui Count Operation: Read the actual position. Latch ST_Tc Plc Device Input.ui Latch For homing using the synchronous pulse of the encoder. Ctrl ST_Tc Plc Device Output.usi Ctrl Control of the latch function etc. Status ST_Tc Plc Device Input.usi Status Status of the encoder, of the latch function. Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Address information for parameter r communication via Co E. Info Data. State ST_Tc Plc Device Input.ui Enc Box Sta Connection monitoring, condition te monitoring. Wc State ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring. e i Tc Mc_Encoder EL5111 The function block handles the evaluation of data from an EL5111 incremental encoder terminal. I/O variable Interface. Variable Use Value ST_Tc Plc Device Input.ui Count Operation: Read the actual position. Latch ST_Tc Plc Device Input.ui Latch For homing using the synchronous pulse of the encoder. Ctrl ST_Tc Plc Device Output.usi Ctrl Control of the latch function etc. Status ST_Tc Plc Device Input.usi Status Status of the encoder, of the latch function. Info Data. Ads Addr ST_Tc Plc Device Input.s Enc Ads Add Address information for parameter r communication via Co E. Info Data. State ST_Tc Plc Device Input.ui Enc Box Sta Connection monitoring, condition te monitoring. Wc State ST_Tc Plc Device Input.w Enc Wc Stat Connection monitoring. e i Tc Mc_Encoder EL7041 The function block handles the evaluation of data from an EL7041 stepper motor output terminal. 210 Version: 1.8.3 TF5810
## Page 211

PLCopen Motion Control This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the drive function block. See also i Tc Mc_Drive EL7041 [} 193]. i Tc Mc_Encoder EL7201 The function block handles the evaluation of data from an EL7201 servo output terminal. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the drive function block. See also i Tc Mc_Drive EL7201. i Tc Mc_Encoder Ix5009 The function block handles the evaluation of data from an IP5009 SSI encoder box. I/O variable Interface. Variable Use PZDL_Reg Daten ST_Tc Plc Device Input.ui PZDL_Reg Operation: Read the actual Daten position. For register communication [} 336]: Interface for read data. PZDH ST_Tc Plc Device Input.ui PZDH Read the actual position. Reg Status ST_Tc Plc Device Input.usi Reg Statu Miscellaneous status information. s i Tc Mc_Encoder KL2521 The function block handles the evaluation of data from a KL2521 pulse output terminal. The output pulses are counted and used for an encoder emulation. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the drive function block. See also i Tc Mc_Drive KL2521 [} 194]. I/O variable Interface. Variable Use Data in ST_Tc Plc Device Input.ui Terminal D Operation: Read the actual ata position. For register communication [} 336]: Interface for read data. Control ST_Tc Plc Device Output.b Terminal Register communication Ctrl Status ST_Tc Plc Device Input.b Terminal St Register communication ate Data out ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. Register communication: Interface for written data. i Tc Mc_Encoder KL2531 The function block handles the evaluation of data from a KL2531 pulse output terminal. The output pulses are counted and used for an encoder emulation. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the drive function block. See also i Tc Mc_Drive KL2531 [} 194]. TF5810 Version: 1.8.3 211
## Page 212

PLCopen Motion Control I/O variable Interface. Variable Use Velocity ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. For register communication [} 336]: Interface for written data. Position ST_Tc Plc Device Input.ui Terminal D Operation: Read the actual ata position. For register communication: Interface for read data. Ctrl ST_Tc Plc Device Output.b Terminal Control the output stage, register Ctrl communication. Status ST_Tc Plc Device Input.b Terminal St Status of the output stage, register ate communication. Ext Status ST_Tc Plc Device Input.ui Terminal St Diagnosis of output stage and ate2 motor i Tc Mc_Encoder KL2541 The function block handles the evaluation of data from a KL2541 pulse output terminal. The output pulses are counted and used for an encoder emulation. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the drive function block. See also i Tc Mc_Drive KL2541 [} 195]. I/O variable Interface. Variable Use Velocity ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. For register communication [} 336]: Interface for written data. Position ST_Tc Plc Device Input.ui Terminal D Operation: Read the actual ata position. For register communication: Interface for read data. Ctrl ST_Tc Plc Device Output.b Terminal Control the output stage, register Ctrl communication. Status ST_Tc Plc Device Input.b Terminal St Status of the output stage, register ate communication. Ext Ctrl ST_Tc Plc Device Output.ui Terminal Latch control during homing with Ctrl2 the synchronous pulse of the encoder Ext Status ST_Tc Plc Device Input.ui Terminal St Diagnosis of output stage and ate2 motor, latch status during homing with the synchronous pulse of the encoder i Tc Mc_Encoder KL2542 The function block handles the evaluation of data from a KL2542 motor output stage terminal. This I/O device belongs to a group of devices, which are used for the control value output as well as actual value determination. The required mapping definitions, particularly for parameter communication, overlap with those of the drive function block. See also i Tc Mc_Drive KL2542 [} 196]. 212 Version: 1.8.3 TF5810
## Page 213

PLCopen Motion Control I/O variable Interface. Variable Use Data out ST_Tc Plc Device Output.n Dac Out Operation: Output of the velocity signal. For register communication [} 336]: Interface for written data. Data in ST_Tc Plc Device Input.ui Terminal D Operation: Read the actual ata position. For register communication: Interface for read data. Control ST_Tc Plc Device Output.b Terminal Control the output stage, register Ctrl communication. Status ST_Tc Plc Device Input.b Terminal St Status of the output stage, register ate communication. i Tc Mc_Encoder KL3002 The function block handles the evaluation of data from a KL3002 analog input terminal. I/O variable Interface. Variable Use Data in ST_Tc Plc Device Input.ui Count Read the actual position. Ctrl ST_Tc Plc Device Output.usi Ctrl Register communication [} 336] Status ST_Tc Plc Device Input.usi Status Register communication. i Tc Mc_Encoder KL3042 The function block handles the evaluation of data from a KL3042 analog input terminal. I/O variable Interface. Variable Use Data in ST_Tc Plc Device Input.ui Count Read the actual position. Ctrl ST_Tc Plc Device Output.usi Ctrl Register communication [} 336] Status ST_Tc Plc Device Input.usi Status Register communication. i Tc Mc_Encoder KL3062 The function block handles the evaluation of data from a KL3062 analog input terminal. I/O variable Interface. Variable Use Data in ST_Tc Plc Device Input.ui Count Read the actual position. Ctrl ST_Tc Plc Device Output.usi Ctrl Register communication [} 336] Status ST_Tc Plc Device Input.usi Status Register communication. i Tc Mc_Encoder KL3162 The function block handles the evaluation of data from a KL3162 analog input terminal. I/O variable Interface. Variable Use Data in ST_Tc Plc Device Input.ui Count Read the actual position. Ctrl ST_Tc Plc Device Output.usi Ctrl Register communication [} 336] Status ST_Tc Plc Device Input.usi Status Register communication. i Tc Mc_Encoder KL5001 The function block handles the evaluation of data from a KL5001 SSI encoder terminal. TF5810 Version: 1.8.3 213
## Page 214

PLCopen Motion Control I/O variable Interface. Variable Use PZDL_Reg Daten ST_Tc Plc Device Input.ui PZDL_Reg Operation: Read the actual Daten position. For register communication [} 336]: Interface for read data. PZDH ST_Tc Plc Device Input.ui PZDH Read the actual position. Reg Status ST_Tc Plc Device Input.usi Reg Statu Miscellaneous status information. s Reg Daten ST_Tc Plc Device Output.b Terminal Register communication. Data i Tc Mc_Encoder KL5101 The function block handles the evaluation of data from a KL5101 incremental encoder terminal. I/O variable Interface. Variable Use Counter ST_Tc Plc Device Input.ui Count Operation: Read the actual position. For register communication: Interface for read data. Latch ST_Tc Plc Device Input.ui Latch For homing using the synchronous pulse of the encoder. Ctrl ST_Tc Plc Device Output.usi Ctrl Control of the latch function etc., register communication [} 336] Status ST_Tc Plc Device Input.usi Status Miscellaneous status information. Reg Daten ST_Tc Plc Device Output.b Terminal Register communication. Data i Tc Mc_Encoder KL5111 The function block handles the evaluation of data from a KL5111 incremental encoder terminal. I/O variable Interface. Variable Use Counter ST_Tc Plc Device Input.ui Count Operation: Read the actual position. For register communication: Interface for read data. Latch ST_Tc Plc Device Input.ui Latch For homing using the synchronous pulse of the encoder. Ctrl ST_Tc Plc Device Output.usi Ctrl Control of the latch function etc., register communication [} 336] Status ST_Tc Plc Device Input.usi Status Miscellaneous status information. Reg Daten ST_Tc Plc Device Output.b Terminal Register communication. Data i Tc Mc_Encoder Low Cost Stepper If the value i Tc Mc_Drive Low Cost Stepper [} 197] is entered as n Drive_Type, the half steps that are output are counted in ST_Tc Plc Device Output.ui Count. The result is used to calculate the actual position. Mapping is not required for the encoder. This encoder type can only be used in combination with an i Tc Mc_Drive Low Cost Stepperdrive. 214 Version: 1.8.3 TF5810
## Page 215

PLCopen Motion Control i Tc Mc_Encoder M2510 The function block handles the evaluation of data from an M2510 analog input box. I/O variable Interface. Variable Use Data in ST_Tc Plc Device Input.ui Count Read the actual position. i Tc Mc_Encoder M3120 The function block handles the evaluation of data from an M3120 incremental encoder box. I/O variable Interface. Variable Use Value_N ST_Tc Plc Device Input.ui Count Read the actual position. State_N ST_Tc Plc Device Input.usi Status Miscellaneous status information. Ctrl_N ST_Tc Plc Device Output.usi Ctrl Control of the latch function etc. i Tc Mc_Encoder Sim A simulation encoder calculates the actual position through integration of the set velocity. No mapping is required. 4.4.3.2 MC_Ax Rt Read Force Diff_Bk Plc Mc MC_Ax Rt Read Force Diff_Bk Plc Mc Adc Value A INT BOOL Error Adc Value B INT UDINT Error Id Scale Factor A LREAL Scale Offset A LREAL Scale Factor B LREAL Scale Offset B LREAL Slipping Offset LREAL Reading Mode E_Tc Mc Pressure Reading Mode ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block handles determination of the actual force of the axis from the input data of two analog input terminals. The actual pressure on the A- and B-sides is converted to the force acting on the load, taking into account the areas and the sliding friction. If only one input signal is available, a function block of type MC_Ax Rt Read Force Single_Bk Plc Mc [} 218] should be used. If the actual pressure is to be determined, a function block of type MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220] should be used. Inputs VAR_INPUT Adc Value A: INT:=0; Adc Value B: INT:=0; Scale Factor A: LREAL:=0.0; Scale Offset A: LREAL:=0.0; Scale Factor B: LREAL:=0.0; Scale Offset B: LREAL:=0.0; Slipping Offset: LREAL:=0.0; Reading Mode: E_Tc Mc Pressure Reading Mode:=i Tc Hyd Pressure Reading Default; END_VAR E_Tc Mc Pressure Reading Mode [} 119] TF5810 Version: 1.8.3 215
## Page 216

PLCopen Motion Control Name Type Description Adc Value A INT These parameters are used to transfer the input data of the analog terminals. Adc Value B INT Scale Factor A LREAL [N/ADC_INC] This value represents the weighting. It determines which pressure increase corresponds to a stage of the AD converter. Scale Offset A LREAL [N/ADC_INC] This offset is used to correct the zero point of the pressure scale. Scale Factor B LREAL [N/ADC_INC] This value represents the weighting. It determines which pressure increase corresponds to a stage of the AD converter. Scale Offset B LREAL [N/ADC_INC] This offset is used to correct the zero point of the pressure scale. Slipping Offset LREAL [N] If the function block is used for calculating the active force, the force required to overcome the sliding friction can be entered here. Reading Mode E_Tc Mc Pressure Readin The actual value to be determined can be specified here. g Mode AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure is selected as default target. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behaviour of the function block: The function block determines the actual pressure and the actual force of the axis by evaluating the variables Adc Value A and Adc Value B. The result is entered in ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure. The parameters assigned to an axis can be saved in ST_Tc Hyd Ax Param.f Customer Data[...], for example. This ensures that the data are loaded, saved and backed up together with the standard parameters of the axis and are also exported and imported, as required. Determining a differential actual pressure Commissioning is usually done in one of three ways. Commissioning option A (preferred for ±10V) In this case, no movement of the axis is required. The achievable accuracy is sufficient for high-quality pressure sensors in most cases. 216 Version: 1.8.3 TF5810
## Page 217

PLCopen Motion Control • The rated pressure of the pressure sensors divided by Adc Value A or Adc Value B should be MAX MAX entered as Scale Factor A and Scale Factor B. • If the function block is used for determining the actual pressure, the parameters Scale Arrea A and Scale Arrea B should be set to 1.0. Otherwise these parameters should be specified for an actual force in N (= Newton) in mm2. Commissioning option B For this option it is necessary that a function block can be approached with full system pressure in both directions. A genuine movement of the axis is not required. Approaching of the end stops can be modeled by limiting the axis movement through provisional limits or even complete mechanical fixing. • All function blocks, which respond to the value of ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure, must be deactivated. • First, slowly approach the lower function block (in the direction of decreasing actual position). The values for Adc Value A and Adc Value B are determined and logged. The system pressure should now be present on the A-side and the tank pressure – and therefore the ambient pressure – on the B-side. Should this not be the case for some reason, the pressures on the A- and B-side should be determined through measurement. • Then, slowly approach the upper function block (in the direction of increasing actual position). The values for Adc Value A and Adc Value B are again determined and logged. Now measure the pressures again. • The parameters to be entered can then be calculated as follows: Scale Factor A := (Pressure A - Pressure A ) / (Adc Value A - Adc Value A ); MAX MIN MAX MIN Scale Factor B := (Pressure B - Pressure B ) / (Adc Value B - Adc Value B ); MAX MIN MAX MIN Scale Offset A := Pressure A - Scale Factor A * Adc Value A; MIN MIN Scale Offset B := Pressure B - Scale Factor B * Adc Value B; MIN MIN Commissioning option C Alternatively, commissioning can be carried out without axis control. However, the accuracy that can be achieved in this way is much lower. • First, the axis should be made pressure-free. To this end, switch off the compressor and relieve the pressure in the accumulator. • Ensure that the axis does not build up pressure. To this end, an axis that is subject to external forces (gravity etc.) should be supported mechanically. Open the valve several times in both directions, either manually or electrically. • Now determine and log the values for Adc Value A and Adc Value B. The tank pressure – and therefore the ambient pressure – should be present both on the A-side and on the B-side. Should this not be the case for some reason, the pressures on the A- and B-side should be determined through measurement. Use the values found in this way as MIN values in the equations mentioned above. • Take the pressure for the upper limit of the electrical signal (10 V, 20 m A) from the data sheet specifications for the pressure sensors. Use the upper limit value for the converted electrical value as Adc Value A and Adc Value B. Use these values as MAX values in the equations mentioned above. • The parameters to be entered can then be calculated as described above. Determining an active force To determine an active force, first determine the actual pressure, as described above. Entering the active areas under Scale Arrea A and Scale Arrea A causes the function block to convert the pressures on both sides into forces, taking into account the areas. TF5810 Version: 1.8.3 217
## Page 218

PLCopen Motion Control 4.4.3.3 MC_Ax Rt Read Force Single_Bk Plc Mc MC_Ax Rt Read Force Single_Bk Plc Mc Adc Value INT BOOL Error Scale Factor LREAL UDINT Error Id Scale Offset LREAL Slipping Offset LREAL Reading Mode E_Tc Mc Pressure Reading Mode ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block handles determination of the actual force of the axis from the input data of an analog input terminal. The actual pressure on the A- or B-sides is converted to the force acting on the load, taking into account the area and the sliding friction. If only one input signal is available, a function block of type MC_Ax Rt Read Force Diff_Bk Plc Mc [} 215] should be used. If the actual pressure is to be determined, a function block of type MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220] should be used. Inputs VAR_INPUT Adc Value A: INT:=0; Adc Value B: INT:=0; Scale Factor A: LREAL:=0.0; Scale Offset A: LREAL:=0.0; Scale Factor B: LREAL:=0.0; Scale Offset B: LREAL:=0.0; Slipping Offset: LREAL:=0.0; Reading Mode: E_Tc Mc Pressure Reading Mode:=i Tc Hyd Pressure Reading Default; END_VAR Name Type Description Adc Value A INT These parameters are used to transfer the input data of the analog terminals. Adc Value B INT Scale Factor A LREAL [N/ADC_INC] This value represents the weighting. It determines which pressure increase corresponds to a stage of the AD converter. Scale Offset A LREAL [N/ADC_INC] This offset is used to correct the zero point of the pressure scale. Scale Factor B LREAL [N/ADC_INC] This value represents the weighting. It determines which pressure increase corresponds to a stage of the AD converter. Scale Offset B LREAL [N/ADC_INC] This offset is used to correct the zero point of the pressure scale. Slipping Offset LREAL [N] If the function block is used for calculating the active force, the force required to overcome the sliding friction can be entered here. Reading Mode E_Tc Mc Pressure Reading Mo The actual value to be determined can be specified here. de AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure is selected as default target. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR 218 Version: 1.8.3 TF5810
## Page 219

PLCopen Motion Control Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Error BOOL Error: The occurrence of an error is indicated here. Error ID UDINT Error ID: Here, a coded cause of error is provided. Behaviour of the function block: The function block determines the actual pressure and the actual force of the axis by evaluating the variables Adc Value A. The result is entered in ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure. The parameters assigned to an axis can be saved in ST_Tc Hyd Ax Param [} 130].f Customer Data[...], for example. This ensures that the data are loaded, saved and backed up together with the standard parameters of the axis and are also exported and imported, as required. Determining a differential actual pressure If the function block is used to determine the actual pressure, the parameters Scale Arrea A and Scale Arrea A should be set to 1.0 and Slipping Offset to 0.0. Commissioning option A In this case, no movement of the axis is required. The achievable accuracy is sufficient for high-quality pressure sensors in most cases. • Enter the rated pressure of the pressure sensors divided by Adc Value A as Scale Factor A. MAX Commissioning option B For this option it is necessary that a function block can be approached with full system pressure in both directions. A genuine movement of the axis is not required. Approaching of the end stops can be modeled by limiting the axis movement through provisional limits or even complete mechanical fixing. • All function blocks, which respond to the value of ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure, must be deactivated. • First, slowly approach the lower function block (in the direction of decreasing actual position). The values for Adc Value A and Adc Value B are determined and logged. The system pressure should now be present on the A-side and the tank pressure – and therefore the ambient pressure – on the B-side. Should this not be the case for some reason, the pressures on the A- and B-side should be determined through measurement. • Then, slowly approach the upper function block (in the direction of increasing actual position). The values for Adc Value A and Adc Value B are again determined and logged. Now measure the pressures again. • The parameters to be entered can then be calculated as follows: Scale Factor A := (Pressure A - Pressure A ) / (Adc Value A - Adc Value A ); MAX MIN MAX MIN Scale Factor B := (Pressure B - Pressure B ) / (Adc Value B - Adc Value B ); MAX MIN MAX MIN Scale Offset A := Pressure A - Scale Factor A * Adc Value A; MIN MIN Scale Offset B := Pressure B - Scale Factor B * Adc Value B; MIN MIN TF5810 Version: 1.8.3 219
## Page 220

PLCopen Motion Control Commissioning option C Alternatively, commissioning can be carried out without axis control. However, the accuracy that can be achieved in this way is much lower. • First, the axis should be made pressure-free. To this end, switch off the compressor and relieve the pressure in the accumulator. • Ensure that the axis does not build up pressure. To this end, an axis that is subject to external forces (gravity etc.) should be supported mechanically. Open the valve several times in both directions, either manually or electrically. • Now determine and log the values for Adc Value A and Adc Value B. The tank pressure – and therefore the ambient pressure – should be present both on the A-side and on the B-side. Should this not be the case for some reason, the pressures on the A- and B-side should be determined through measurement. Use the values found in this way as MIN values in the equations mentioned above. • Take the pressure for the upper limit of the electrical signal (10 V, 20 m A) from the data sheet specifications for the pressure sensors. Use the upper limit value for the converted electrical value as Adc Value A and Adc Value B. Use these values as MAX values in the equations mentioned above. • The parameters to be entered can then be calculated as described above. Determining an active force To determine an active force, first determine the actual pressure, as described above. Entering the active area under Scale Arrea A causes the function block to convert the single-sided pressure to a force, taking into account the area. 4.4.3.4 MC_Ax Rt Read Pressure Diff_Bk Plc Mc MC_Ax Rt Read Pressure Diff_Bk Plc Mc Adc Value A INT BOOL Error Adc Value B INT UDINT Error Id Scale Factor A LREAL Scale Offset A LREAL Scale Factor B LREAL Scale Offset B LREAL Reading Mode E_Tc Mc Pressure Reading Mode ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block handles determination of the actual pressure of the axis from the input data of two analog input terminals. If only one input signal is available, a function block of type MC_Ax Rt Read Pressure Single_Bk Plc Mc [} 222] should be used. If the force is to be determined, instead of the pressure, a function block of type MC_Ax Rt Read Force Diff_Bk Plc Mc [} 215] should be used. Inputs VAR_INPUT Adc Value A: INT:=0; Adc Value B: INT:=0; Scale Factor A: LREAL:=0.0; Scale Offset A: LREAL:=0.0; Scale Factor B: LREAL:=0.0; Scale Offset B: LREAL:=0.0; Reading Mode: E_Tc Mc Pressure Reading Mode:=i Tc Hyd Pressure Reading Default; END_VAR 220 Version: 1.8.3 TF5810
## Page 221

PLCopen Motion Control Name Type Description Adc Value A INT These parameters are used to transfer the input data of the analog terminals. Adc Value B INT Scale Factor A LREAL [bar/ADC_INC] This value represents the weighting. It determines which pressure increase corresponds to a stage of the AD converter. Scale Offset A LREAL [bar] This offset is used to correct the zero point of the pressure scale. Scale Factor B LREAL [bar/ADC_INC] This value represents the weighting. It determines which pressure increase corresponds to a stage of the AD converter. Scale Offset B LREAL [bar] This offset is used to correct the zero point of the pressure scale. Reading Mode E_Tc Mc Pressure Reading Mo This parameter is used to specify where the result of the de evaluation is to be stored. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behaviour of the function block: The function block investigates the axis interface that has been passed to it every time it is called. During this process, a problem may be detected and reported: • If the pointer p St Ax Rt Data in AXIS_REF_Bk Plc Mc [} 86] is not initialized, the function block reacts with an Error and Error ID:=dw Tc Hyd Err Cd Ptr Mc Plc. In this case, the axis cannot be placed into a fault state. If these checks could be performed without problem, the actual pressure of the axis is determined by evaluating the variables Adc Value A and Adc Value B. The result is entered in ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure. The parameters assigned to an axis can be saved in ST_Tc Hyd Ax Param [} 130].f Customer Data[...], for example. This ensures that the data are loaded, saved and backed up together with the standard parameters of the axis and are also exported and imported, as required. Commissioning option A In this case, no movement of the axis is required. The achievable accuracy is sufficient for high-quality pressure sensors in most cases. • The rated pressure of the pressure sensors divided by Adc Value A or Adc Value B should be MAX MAX entered as Scale Factor A and Scale Factor B. TF5810 Version: 1.8.3 221
## Page 222

PLCopen Motion Control Commissioning option B In this case, no movement of the axis is required. The achievable accuracy is sufficient for high-quality pressure sensors in most cases. • The rated pressure of the pressure sensors divided by Adc Value A or Adc Value B should be MAX MAX entered as Scale Factor A and Scale Factor B. Commissioning option C For this option it is necessary that a function block can be approached with full system pressure in both directions. A genuine movement of the axis is not required. Approaching of the end stops can be modeled by limiting the axis movement through provisional limits or even complete mechanical fixing. • All function blocks, which respond to the value of ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure, must be deactivated. • First, slowly approach the lower function block (in the direction of decreasing actual position). The values for Adc Value A and Adc Value B are determined and logged. The system pressure should now be present on the B-side and the tank pressure – and therefore the ambient pressure – on the A-side. Should this not be the case for some reason, the pressures on the A- and B-side should be determined through measurement. • Then, slowly approach the upper function block (in the direction of increasing actual position). The values for Adc Value A and Adc Value B are again determined and logged. Now measure the pressures again. • The parameters to be entered can then be calculated as follows: Scale Factor A := (Pressure A - Pressure A ) / (Adc Value A - Adc Value A ); MAX MIN MAX MIN Scale Factor B := (Pressure B - Pressure B ) / (Adc Value B - Adc Value B ); MAX MIN MAX MIN Scale Offset A := Pressure A - Scale Factor A * Adc Value A; MIN MIN Scale Offset B := Pressure B - Scale Factor B * Adc Value B; MIN MIN Commissioning option D Alternatively, commissioning can be carried out without axis control. However, the accuracy that can be achieved in this way is much lower. • First, the axis should be made pressure-free. To this end, switch off the compressor and relieve the pressure in the accumulator. • Ensure that the axis does not build up pressure. To this end, an axis that is subject to external forces (gravity etc.) should be supported mechanically. Open the valve several times in both directions, either manually or electrically. • Now determine and log the values for Adc Value A and Adc Value B. The tank pressure – and therefore the ambient pressure – should be present both on the A-side and on the B-side. Should this not be the case for some reason, the pressures on the A- and B-side should be determined through measurement. Use the values found in this way as MIN values in the equations mentioned above. • Take the pressure for the upper limit of the electrical signal (10 V, 20 m A) from the data sheet specifications for the pressure sensors. Use the upper limit value for the converted electrical value as Adc Value A and Adc Value B. Use these values as MAX values in the equations mentioned above. • The parameters to be entered can then be calculated as described above. 4.4.3.5 MC_Ax Rt Read Pressure Single_Bk Plc Mc MC_Ax Rt Read Pressure Single_Bk Plc Mc Adc Value INT BOOL Error Scale Factor LREAL UDINT Error Id Scale Offset LREAL Reading Mode E_Tc Mc Pressure Reading Mode ↔ Axis Reference To AXIS_REF_Bk Plc Mc 222 Version: 1.8.3 TF5810
## Page 223

PLCopen Motion Control Available from version 3.0 The function block handles determination of the actual pressure of the axis from the input data of an analog input terminal. If separate input signals are available for the A and B sides, a function block of type MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220] should be used. Inputs VAR_INPUT Adc Value: INT:=0; Scale Factor: LREAL:=0.0; Scale Offset: LREAL:=0.0; Reading Mode: E_Tc Mc Pressure Reading Mode:=i Tc Hyd Pressure Reading Default; END_VAR Name Type Description Adc Value INT These parameters are used to transfer the input data of the analog terminal. Scale Factor LREAL [bar/ADC_INC] This value represents the weighting. It determines which pressure increase corresponds to a stage of the AD converter. Scale Offset LREAL [bar] This offset is used to correct the zero point of the pressure scale. Reading Mode E_Tc Mc Pressure Reading Mo The actual value to be determined can be specified here. de AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure is selected as default value. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behaviour of the function block: The function block investigates the axis interface that has been passed to it every time it is called. During this process, a problem may be detected and reported: • If the pointer p St Ax Rt Data in AXIS_REF_Bk Plc Mc [} 86] is not initialised, the function block reacts with an Error and Error ID:=dw Tc Hyd Err Cd Ptr Mc Plc. In this case, the axis cannot be placed into a fault state. TF5810 Version: 1.8.3 223
## Page 224

PLCopen Motion Control If these checks could be performed without problem, the actual pressure of the axis is determined by evaluating the variables Adc Value. The result is entered in ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure. The parameters assigned to an axis can be saved in ST_Tc Hyd Ax Param [} 130].f Customer Data[...], for example. This ensures that the data are loaded, saved and backed up together with the standard parameters of the axis and are also exported and imported, as required. Commissioning option A For this option it is necessary that a function block can be approached with full system pressure in both directions. A genuine movement of the axis is not required. Approaching of the end stops can be modeled by limiting the axis movement through provisional limits or even complete mechanical fixing. • All function blocks, which respond to the value of ST_Tc Hyd Ax Rt Data [} 141].f Act Pressure, must be deactivated. • First, slowly approach the lower function block (in the direction of decreasing actual position). The value for Adc Value is determined and logged. The system pressure should now be present on the B- side and the tank pressure – and therefore the ambient pressure – on the A-side. Should this not be the case for some reason, the pressures on the A- and B-side should be determined through measurement. • Then, slowly approach the upper function block (in the direction of increasing actual position). The value for Adc Value is determined and logged again. Now measure the pressures again. • The parameters to be entered can then be calculated as follows: Scale Factor := (Pressure - Pressure ) / (Adc Value - Adc Value ); MAX MIN MAX MIN Scale Offset := Pressure - Scale Factor * Adc Value; MIN MIN Commissioning option B Alternatively, commissioning can be carried out without axis control. However, the accuracy that can be achieved in this way is much lower. • First, the axis should be made pressure-free. To this end, switch off the compressor and relieve the pressure in the accumulator. • Ensure that the axis does not build up pressure. To this end, an axis that is subject to external forces (gravity etc.) should be supported mechanically. Open the valve several times in both directions, either manually or electrically. • Now the value for Adc Value is determined and logged. The tank pressure – and therefore the ambient pressure – should be present both on the A-side and on the B-side. If this is not the case for some reason, the pressure on the A-side should be determined through measurement. Use the values found in this way as MIN values in the equations mentioned above. • Take the pressure for the upper limit of the electrical signal (10 V, 20 m A) from the data sheet specifications for the pressure sensors. Use the upper limit value for the converted electrical value as Adc Value. Use these values as MAX values in the equations mentioned above. • The parameters to be entered can then be calculated as described above. 4.4.3.6 MC_Ax Rt Hybrid Axis Actuals_Bk Plc Mc MC_Ax Rt Hybrid Axis Actuals_Bk Plc Mc st System_Prs In ST_Tc Plc Input Analog BOOL Error st Aside_Prs In ST_Tc Plc Input Analog UDINT Error Id st Bside_Prs In ST_Tc Plc Input Analog n Torque Feedback INT udi Motor Enc_Count UDINT b Update Act Force BOOL b Pump Switch_Ext BOOL b Area Switch_Ext BOOL ↔ Axis Reference To AXIS_REF_Bk Plc Mc 224 Version: 1.8.3 TF5810
## Page 225

PLCopen Motion Control Available from version 3.0.44 The function block determines the essential actual values of a servo-electric/hydraulic hybrid axis. Inputs VAR_INPUT st System_Prs In: ST_Tc Plc Input Analog [} 164]; st Aside_Prs In: ST_Tc Plc Input Analog [} 164]; st Bside_Prs In: ST_Tc Plc Input Analog [} 164]; n Torque Feedback: INT; udi Motor Enc_Count: UDINT; b Update Act Force: ST_ BOOL; b Pump Switch_Ext: BOOL; b Area Switch_Ext: BOOL; Name Type Description st System_Prs In ST_Tc Plc Input Analog [} 164] If a pressure sensor is present at the pressurized reservoir, the input variables of the terminal are transferred here. st Aside_Prs In ST_Tc Plc Input Analog [} 164] If a pressure sensor is present on the positive area of the cylinder, the input variables of the terminal are transferred here. st Bside_Prs In ST_Tc Plc Input Analog [} 164] If a pressure sensor is present on the negative area of the cylinder, the input variables of the terminal are transferred here. n Torque Feedback INT The torque feedback signal of the drive is to be transferred here. udi Motor Enc_Count UDINT The counter value of the motor encoder must be transferred here. b Update Act Force ST_ BOOL With this signal, the function block calculates the current actual force of the axis and updates it in st Ax Rt Data.f Act Force. b Pump Switch_Ext BOOL This signal notifies the function block that pump switching of the axis is active. b Area Switch_Ext BOOL This signal notifies the function block that area switching of the axis is active. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error Id: BOOL; END_VAR TF5810 Version: 1.8.3 225
## Page 226

PLCopen Motion Control Name Type Description Error BOOL The occurrence of an error is indicated here. Error Id BOOL An encoded indication of the cause of the error is provided here. Behavior of the function block If the axis is identified as 'hybrid', the function block performs the following steps. • If a permissible encoder type for the motor encoder is specified for the axis, the function block determines the current actual angle from udi Motor Enc_Count. Otherwise, the axis is set to a error state and the angle is set to 0.0°. • The modulo actual angle is updated with the set number of pump cavities. • The actual pump speed is determined. • The pump torque is determined. • If a scaling pressure is set for the system pressure and the connection monitoring in st System_Prs In does not indicate a problem, the input value is converted to a pressure and updated in st Ax Rt Data.f Supply Pressure of the axis. • If a scaling pressure is set for the pressure on the positive side and the connection monitoring in st Aside_Prs In does not indicate a problem, the input value is converted to a pressure and updated in st Ax Rt Data.f Act Pressure A of the axis. • If a scaling pressure is set for the pressure on the negative side and the connection monitoring in st Bside_Prs In does not indicate a problem, the input value is converted to a pressure and updated in st Ax Rt Data.f Act Pressure B of the axis. • If TRUE is passed in b Update Act Force, the function block st Ax Rt Data.f Act Force updates the axis, using the currently effective areas. • If an edge is detected at one of the switch signals (b Area Switch_Ext, b Pump Switch_Ext), the function block initiates a ramp for changing the feed constant and the maximum speed. Irrespective of whether the axis is identified as 'hybrid', this function block calls a local instance of MC_Ax Rt Encoder_Bk Plc Mc() [} 198] for the axis. If no function block of this type is called for a servo-electric/hydraulic axis, changeovers are not handled correctly. This could lead to unexpected behavior of the axis. In this case, the axis is set to the error state and a message is output. 4.4.4 Function Generator 4.4.4.1 MC_Function Generator FD_Bk Plc Mc MC_Function Generator FD_Bk Plc Mc ↔ st Time Base Reference To ST_Function Generator TB_Bk Plc Mc LREAL Sinus ↔ st Function Def Reference To ST_Function Generator FD_Bk Plc Mc LREAL Cosinus LREAL Rectangle LREAL Saw Tooth Available from version 3.0.31 The function block calculates the signals of a function generator. Inputs/outputs VAR_IN_OUT st Time Base: ST_Function Generator TB_Bk Plc Mc; st Function Def: ST_Function Generator FD_Bk Plc Mc; END_VAR 226 Version: 1.8.3 TF5810
## Page 227

PLCopen Motion Control Name Type Description st Time Base ST_Function Generator TB_Bk st Time Base: A structure with the parameters of the time Plc Mc base of this function generator. st Function Def ST_Function Generator FD_Bk st Function Def: A structure with the definitions of the Plc Mc output signals of a function generator. Outputs VAR_OUTPUT Sinus: LREAL; Cosinus: LREAL; Rectangle: LREAL; Saw Tooth: LREAL; END_VAR Name Type Description Sine LREAL The output signals of the function generator. Cosine LREAL Rectangle LREAL Saw Tooth LREAL Behavior of the function block The output signals are determined from st Time Base. Current Ratio and the parameters in st Function Def [} 127]. The time base in st Time Base should be updated with an MC_Function Generator TB_Bk Plc Mc [} 228]() function block. To change the operating frequency, an MC_Function Generator Set Frq_Bk Plc Mc [} 227]() function block should be used. 4.4.4.2 MC_Function Generator Set Frq_Bk Plc Mc MC_Function Generator Set Frq_Bk Plc Mc Frequency LREAL Cycle Time LREAL ↔ st Time Base Reference To ST_Function Generator TB_Bk Plc Mc Available from version 3.0.31 The function block updates the operating frequency of a time base for one or several function generators [} 226]. Inputs VAR_INPUT Frequency: LREAL; Cycle Time: LREAL; END_VAR Name Type Description Frequency LREAL The operating frequency to be used. Cycle Time LREAL The cycle time of the calling task. TF5810 Version: 1.8.3 227
## Page 228

PLCopen Motion Control Inputs/outputs VAR_IN_OUT st Time Base: ST_Function Generator TB_Bk Plc Mc; END_VAR Name Type Description st Time Base ST_Function Generator TB_Bk A structure with the parameters of the time base of one or Plc Mc several function generators [} 128]. Behavior of the function block The function block sets st Time Base. Frequency to the transferred value. st Time Base. Current Time is adjusted, if required. The function block uses st Time Base. Freeze to prevent a collision with MC_Function Generator TB_Bk Plc Mc [} 228]() function blocks. Thus, it can also be called from another task. 4.4.4.3 MC_Function Generator TB_Bk Plc Mc MC_Function Generator TB_Bk Plc Mc Cycle Time LREAL ↔ st Time Base Reference To ST_Function Generator TB_Bk Plc Mc Available from version 3.0.31 The function block updates a time base for one or several function generators [} 226]. Inputs VAR_INPUT Cycle Time: LREAL; END_VAR Name Type Description Cycle Time LREAL The cycle time of the calling task. Inputs/outputs VAR_IN_OUT st Time Base: ST_Function Generator TB_Bk Plc Mc; END_VAR Name Type Description st Time Base ST_Function Generator TB_Bk Pl A structure with the parameters of the time base of one or c Mc several function generators [} 128]. Behavior of the function block If st Time Base. Freeze is not set, st Time Base. Current Time is updated with Cycle Time and st Time Base. Current Ratio is determined. st Time Base. Frequency is taken into account. To change the operating frequency, an MC_Function Generator Set Frq_Bk Plc Mc [} 227]() function block should be used. 228 Version: 1.8.3 TF5810
## Page 229

PLCopen Motion Control 4.4.5 Table Functions 4.4.5.1 MC_Ax Table From Asci File_Bk Plc Mc Available from version 3.0 The function block reads the contents of a table from a text file. Inputs VAR_INPUT Execute: BOOL:=FALSE; p Table: POINTER TO LREAL:=0; Low Idx: INT:=0; High Idx: INT:=0; File Name: STRING(255):=''; END_VAR Name Type Description Execute BOOL A rising edge at this input starts the read process. p Table POINTER TO LREAL This parameter is used to transfer the address of an ARRAY[n First Idx..n Last Idx,1..2]. Low Idx INT This parameter is used to transfer the lower index of the ARRAY, whose address is transferred as p Table. High Idx INT This parameter is used to transfer the upper index of the ARRAY, whose address is transferred as p Table. File Name STRING This parameter can be used to specify a file name. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Last Idx: INT:=0; END_VAR TF5810 Version: 1.8.3 229
## Page 230

PLCopen Motion Control Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful processing of the homing is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Last Idx INT This parameter is used to indicate the index of the last table row defined by the read operation. Behavior of the function block A rising edge at Execute causes the function block to check the transferred parameters. A number of problems can be detected and reported during this process: • If Low Idx is negative the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. • If p Table=0 the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. • If Low Idx and High Idx describe a table with less than five rows the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. If these checks were performed without problems, the read operation is started. Busy is TRUE for the duration of the operation. This can lead to some further problems, which are indicated by various error codes. Successful reading of the file is indicated with Done. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the process is still active, the process that had started continues unaffected. The signals at the end of the process (Error, Error ID, Done) are made available for one cycle. If a File Name is specified, it must be complete (including the drive letter and the path, if applicable, always including the file type), since it is used by function block without any further modification or amendment. If no File Name is specified, the function block uses the path and the file name, which were specified through the MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block. File type TXT is used here, to distinguish from the parameter file with file type DAT. The file contents can be read or modified with an ASCII editor. Changes of the content can make correct reading or the intended use impossible or change the effect of the table in a way that is difficult to trace. Manual changes should therefore be implemented very carefully, if at all, and only by competent persons. 4.4.5.2 MC_Ax Table From Bin File_Bk Plc Mc Available from version 3.0 The function block reads the contents of a table from a binary file. 230 Version: 1.8.3 TF5810
## Page 231

PLCopen Motion Control Inputs VAR_INPUT Execute: BOOL:=FALSE; p Table: POINTER TO LREAL:=0; Low Idx: INT:=0; High Idx: INT:=0; File Name: STRING(255):=''; END_VAR Name Type Description Execute BOOL A rising edge at this input starts the read process. p Table POINTER TO LREAL This parameter is used to transfer the address of an ARRAY[n First Idx..n Last Idx,1..2]. Low Idx INT This parameter is used to transfer the lower index of the ARRAY, whose address is transferred as p Table. High Idx INT This parameter is used to transfer the upper index of the ARRAY, whose address is transferred as p Table. File Name STRING This parameter can be used to specify a file name. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Last Idx: INT:=0; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful processing of the homing is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Last Idx INT This parameter is used to indicate the index of the last table row defined by the read operation. Behavior of the function block A rising edge at Execute causes the function block to check the transferred parameters. A number of problems can be detected and reported during this process: • If Low Idx is negative the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. • If p Table=0 the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. • If Low Idx and High Idx describe a table with less than five rows the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. If these checks were performed without problems, the read operation is started. Busy is TRUE for the duration of the operation. This can lead to some further problems, which are indicated by various error codes. Successful reading of the file is indicated with Done. TF5810 Version: 1.8.3 231
## Page 232

PLCopen Motion Control A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the process is still active, the process that had started continues unaffected. The signals at the end of the process (Error, Error ID, Done) are made available for one cycle. If a File Name is specified, it must be complete (including the drive letter and the path, if applicable, always including the file type), since it is used by function block without any further modification or amendment. If no File Name is specified, the function block uses the path and the file name, which were specified through the MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block. File type TBL is used here, to distinguish from the parameter file with file type DAT. The file contents cannot be read or modified with an ASCII editor. 4.4.5.3 MC_Ax Table Read Out Non Cyclic_Bk Plc Mc MC_Ax Table Read Out Non Cyclic_Bk Plc Mc p Table Pointer To LREAL LREAL f Slave Value f Master Value LREAL LREAL f Slave Gear n First Idx UDINT BOOL b Under Range n Last Idx UDINT BOOL b Over Range b Re Init BOOL BOOL b Error Available from version 3.0 The function block determines the slave values assigned to a master value with the aid of a table. This function block is a component of cam plates or similar non-linear couplings. It is generally not called direct by an application. Inputs VAR_INPUT p Table: POINTER TO LREAL:=0; f Master Value: LREAL:=0.0; n First Idx: UDINT:=1; n Last Idx: UDINT:=1; b Re Init: BOOL:=FALSE; END_VAR 232 Version: 1.8.3 TF5810
## Page 233

PLCopen Motion Control Name Type Description p Table POINTER TO This parameter is used to transfer the address of an LREAL ARRAY[n First Idx..n Last Idx,1..2]. An incorrect specification at this point causes the PLC application to crash by triggering serious runtime errors (Page Fault Exception). f Master Value LREAL Here the value of the master is to be transferred, for which the associated slave n First Idx UDINT This parameter is used to transfer the lower index of the ARRAY, whose address is transferred as p Table. An incorrect specification at this point causes the PLC application to crash by triggering serious runtime errors (Page Fault Exception). n Last Idx UDINT This parameter is used to transfer the upper index of the ARRAY, whose address is transferred as p Table. An incorrect specification at this point causes the PLC application to crash by triggering serious runtime errors (Page Fault Exception). b Re Init BOOL This input indicates to the function block that the search procedure should start at the top of the table. Outputs VAR_OUTPUT f Slave Value: LREAL:=0.0; f Slave Gear: LREAL:=0.0; b Under Range: BOOL; b Over Range: BOOL; END_VAR Name Type Description f Slave Value LREAL This parameter is used to output the slave value belonging to f Master Value. f Slave Gear LREAL This parameter is used to output the local slope of the slave values at the point in the table specified by the master. b Under Range BOOL This output becomes TRUE, if the master value reaches the bottom of the table or falls below it. b Over Range BOOL This output becomes TRUE, if the master value reaches the top of the table or exceeds it. Behavior of the function block The function block searches inside the transferred table for a master pair of values, which matches or includes the transferred f Master Value. Within the found intervals a linear intermediate interpolation is calculated. The result is output as f Slave Value. The local slope determined in this calculation is output as f Slave Gear. If f Master Value is below the value range described by the table, b Under Range is indicated. The value output as f Slave Value is the value assigned to the lowest point of the table. 0.0 is returned as f Slave Gear. If the f Master Value is above the range of values described by the table, b Over Range is indicated. The value output as f Slave Value is the value assigned to the top point of the table. 0.0 is returned as f Slave Gear. The return value f Slave Gear represents the ratio of the first derivatives of f Master Value and f Slave Value. If f Master Value represents a position or a virtual time, the multiplication of master progress velocity and f Slave Gear returns the set slave velocity. This can be used to generate a pilot-control velocity. An MC_Ax Rt Set Ext Gen Values_Bk Plc Mc [} 252] function block is preferable for this purpose. TF5810 Version: 1.8.3 233
## Page 234

PLCopen Motion Control 4.4.5.4 MC_Ax Table To Asci File_Bk Plc Mc MC_Ax Table Read Out Non Cyclic_Bk Plc Mc p Table Pointer To LREAL LREAL f Slave Value f Master Value LREAL LREAL f Slave Gear n First Idx UDINT BOOL b Under Range n Last Idx UDINT BOOL b Over Range b Re Init BOOL BOOL b Error Available from version 3.0 The function block writes the contents of a table to a text file. Inputs VAR_INPUT Execute: BOOL:=FALSE; p Table: POINTER TO LREAL:=0; Low Idx: INT:=0; High Idx: INT:=0; File Name: STRING(255):=''; END_VAR Name Type Description Execute BOOL The writing process is initiated by a rising edge at this input. p Table POINTER TO LREAL This parameter is used to transfer the address of an ARRAY[n First Idx..n Last Idx,1..2]. Low Idx INT This parameter is used to transfer the lower index of the ARRAY, whose address is transferred as p Table. High Idx INT This parameter is used to transfer the upper index of the ARRAY, whose address is transferred as p Table. File Name STRING This parameter can be used to specify a file name. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful processing of the homing is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. 234 Version: 1.8.3 TF5810
## Page 235

PLCopen Motion Control Behavior of the function block A rising edge at Execute causes the function block to check the transferred parameters. A number of problems can be detected and reported during this process: • If Low Idx is negative the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. • If p Table=0 the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. • If Low Idx and High Idx describe a table with less than five rows the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. If these checks were performed without problems, the write operation is started. Busy is TRUE for the duration of the operation. This can lead to some further problems, which are indicated by various error codes. Successful writing of the file is indicated with Done. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the process is still active, the process that had started continues unaffected. The signals at the end of the process (Error, Error ID, Done) are made available for one cycle. If a File Name is specified, it must be complete (including the drive letter and the path, if applicable, always including the file type), since it is used by function block without any further modification or amendment. If no File Name is specified, the function block uses the path and the file name, which were specified through the MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block. File type TXT is used here, to distinguish from the parameter file with file type DAT. The file contents can be read or modified with an ASCII editor. Changes of the content can make correct reading or the intended use impossible or change the effect of the table in a way that is difficult to trace. Manual changes should therefore be implemented very carefully, if at all, and only by competent persons. 4.4.5.5 MC_Ax Table To Bin File_Bk Plc Mc Available from version 3.0 The function block writes the contents of a table to a binary file. Inputs VAR_INPUT Execute: BOOL:=FALSE; p Table: POINTER TO LREAL:=0; Low Idx: INT:=0; High Idx: INT:=0; File Name: STRING(255):=''; END_VAR TF5810 Version: 1.8.3 235
## Page 236

PLCopen Motion Control Name Type Description Execute BOOL The writing process is initiated by a rising edge at this input. p Table POINTER TO LREAL This parameter is used to transfer the address of an ARRAY[n First Idx..n Last Idx,1..2]. Low Idx INT This parameter is used to transfer the lower index of the ARRAY, whose address is transferred as p Table. High Idx INT This parameter is used to transfer the upper index of the ARRAY, whose address is transferred as p Table. File Name STRING This parameter can be used to specify a file name. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful processing of the homing is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block A rising edge at Execute causes the function block to check the transferred parameters. A number of problems can be detected and reported during this process: • If Low Idx is negative the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. • If p Table=0 the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. • If Low Idx and High Idx describe a table with less than five rows the system responds with Error and Error ID=dw Tc Hyd Err Cd Tbl Entry Count. If these checks were performed without problems, the write operation is started. Busy is TRUE for the duration of the operation. This can lead to some further problems, which are indicated by various error codes. Successful writing of the file is indicated with Done. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the process is still active, the process that had started continues unaffected. The signals at the end of the process (Error, Error ID, Done) are made available for one cycle. If a File Name is specified, it must be complete (including the drive letter and the path, if applicable, always including the file type), since it is used by function block without any further modification or amendment. If no File Name is specified, the function block uses the path and the file name, which were specified through the MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block. File type TBL is used here, to distinguish from the parameter file with file type DAT. 236 Version: 1.8.3 TF5810
## Page 237

PLCopen Motion Control The file contents cannot be read or modified with an ASCII editor. 4.4.6 Generators 4.4.6.1 MC_Ax Rt Generator_Bk Plc Mc MC_Ax Rt Generator_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID BOOL Lag Error This function block performs the task of a setpoint generator. To this end a profile-specific function block is called, depending on the value set as n Profile Type in Axis. ST_Tc Hyd Ax Param [} 130]. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; Lag Error: BOOL; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Lag Error BOOL If the lag error exceeds the set limits, it is indicated here. This signal is also available if position lag monitoring is not activated. Behavior of the function block The function block investigates the axis interface that has been passed to it every time it is called. A number of problems can be detected and reported during this process: • If one of the pointers has not been initialized the function block reacts with Error and with Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc or dw Tc Hyd Err Cd Ptr Mc Plc. If it is possible to carry out these checks without encountering any problems, the setpoint generation is executed by calling an appropriate function block corresponding to the n Profile Type in Axis. ST_Tc Hyd Ax Param [} 130]. The Lag Error output indicates whether the current lag error of the axis exceeds the set limits. The axis is only set to an error state if b Max Lag Ena is set in Axis. ST_Tc Hyd Ax Param [} 130]. The following generators are presently available: TF5810 Version: 1.8.3 237
## Page 238

PLCopen Motion Control n Profile Type Description i Tc Mc_Profile Ctrl Based [} 239] Standard profile: Single-stage time-referenced acceleration, displacement- referenced (square root) braking ramp, target approach at creep velocity, selectable behavior when stationary. An axis in motion can be restarted at any time (new target, new velocity etc.), except in error state or in a state with dependent control value generation. Info: Overshooting the new target can happen even if the axis is in front of the target position at the time of the start. Info: The function block can be parameterized such that it starts automatically and assumes an active motion state under certain conditions, which are defined through its parameters. Info: This generator type can optionally operate in purely time-controlled mode with continuously closed position controller. i Tc Mc_Profile Jerk Based Standard profile: Single- or two-stage time-controlled acceleration through optional jerk limitation, displacement-controlled (square root generator) braking ramp, target approach with jerk limitation, selectable behavior in idle state. An axis in motion can be restarted at any time (new target, new velocity etc.), except in error state or in a state with dependent control value generation. Info: Overshooting the new target can happen even if the axis is in front of the target position at the time of the start. Info: The function block can be parameterized such that it starts automatically and assumes an active motion state under certain conditions, which are defined through its parameters. Info: This generator type can optionally operate in purely time-controlled mode with continuously closed position controller. Info: Some functions are not supported by this generator type, or not fully. i Tc Mc_Profile Time Pos Ctrl Info: Only present for compatibility reasons; will shortly no longer be supported. Special profile: Two stage acceleration (initially time-referenced, then displacement-referenced following square root curve), displacement- referenced (square root) braking ramp, target approach at creep velocity, selectable behavior when stationary. It is not possible to execute a start for an axis that is already travelling (new target, new velocity etc.). i Tc Mc_Profile Cosine Info: Only present for compatibility reasons; will shortly no longer be supported. Special profile: Two stage acceleration (initially time-referenced, then displacement-referenced following cosine curve), displacement-referenced (cosine) braking ramp, target approach at creep velocity, selectable behavior when stationary. It is not possible to execute a start for an axis that is already travelling (new target, new velocity etc.). i Tc Mc_Profile Time Ramp Special profile: Single-stage time-controlled acceleration, time-controlled braking ramp, target approach with creep speed, conditionally selectable [} 241] behavior in idle state. The generator uses position cams instead of an encoder. An axis in motion can be restarted (new target, new velocity etc.), except in error state. Info: This generator type is intended for axes, which only have digital cams instead of an encoder. If only the usual function blocks (encoder, generator, finish, drive) for the axis are to be called, a function block of type MC_Ax Standard Body_Bk Plc Mc [} 253] should be used for simplicity. 238 Version: 1.8.3 TF5810
## Page 239

PLCopen Motion Control i Tc Mc_Profile Ctrl Based A profile is generated with a time-controlled acceleration phase, a displacement-controlled braking phase based on the square root generator principle, and a target approach with creep speed. The arrows on the profile of the control value suggest how the shape of the curve can be affected through the parameters of the move order or of the axis. To begin with, a time-controlled ramp function "1" is used to accelerate to the required travel velocity "2". This control value is maintained until a point is reached that was recalculated at the start. After this point, a displacement-referenced ramp "3" is followed to brake down from the main travel velocity to the creep velocity "5"; this control value is reached at a specified distance, "4", from the target. This control value is retained until the target has been approached to within a specified remaining distance "6". The axis is then switched to its idle behavior. Parameters active in the travel profile Start ramp "1": The smallest of the following values is the effective one: f Max Acc and f Acc in Axis. ST_Tc Hyd Ax Param [} 130], Acceleration of the function block used to start the axis (for example: MC_Move Absolute_Bk Plc Mc [} 73]). Travel phase "2": The smallest of the following values is the effective one: f Ref Velo and f Max Velo in Axis. ST_Tc Hyd Ax Param [} 130], Velocity of the function block used to start the axis (for example: MC_Move Absolute_Bk Plc Mc [} 73]). Braking ramp "3": The smallest of the following values is the effective one: f Max Dec and f Dec in Axis. ST_Tc Hyd Ax Param [} 130], Deceleration of the function block used to start the axis (for example: MC_Move Absolute_Bk Plc Mc [} 73]). Creep phase "4", "5": The values of f Creep Speed and f Creep Distance in Axis. ST_Tc Hyd Ax Param [} 130] have an effect. TF5810 Version: 1.8.3 239
## Page 240

PLCopen Motion Control Transfer to target "6": The f Brake Distance and/or f Brake Dead Time in Axis. ST_Tc Hyd Ax Param [} 130] have an effect. Automatic starting of the axis If the difference between the actual position and the current target position exceeds the value in Axis. ST_Tc Hyd Ax Param [} 130].f Repos Distance, an automatic start is triggered. i Tc Mc_Profile Jerk Based A profile is generated with a time-controlled acceleration phase (with optional jerk limitation), a displacement- controlled braking ramp based on the square root generator principle, and a target approach with jerk limitation. The arrows on the profile of the control value suggest how the shape of the curve can be affected through the parameters of the move order or of the axis. To begin with, a time-controlled ramp function "1" is used to accelerate to the required travel velocity "2". The optional jerk limitation "6" can take effect. The travel speed is maintained until a point is reached that was recalculated at the start. At this point a displacement- controlled braking ramp "3" is applied, until the distance to the target has reduced to the residual distance. The deceleration "4" is reduced with limited jerk "5" towards the target. The axis is then switched to its idle behavior. Parameters active in the travel profile Start ramp "1": The smallest of the following values is the effective one: f Max Acc and f Acc in Axis. ST_Tc Hyd Ax Param [} 130], Acceleration of the function block used to start the axis (for example: MC_Move Absolute_Bk Plc Mc [} 73]). 240 Version: 1.8.3 TF5810
## Page 241

PLCopen Motion Control Travel phase "2": The smallest of the following values is the effective one: f Ref Velo and f Max Velo in Axis. ST_Tc Hyd Ax Param [} 130], Velocity of the function block used to start the axis (for example: MC_Move Absolute_Bk Plc Mc [} 73]). Braking ramp "3", "4": The smallest of the following values is the effective one: f Max Dec and f Dec in Axis. ST_Tc Hyd Ax Param [} 130], Deceleration of the function block used to start the axis (for example: MC_Move Absolute_Bk Plc Mc [} 73]). Transfer to target "5": f Max Jerk in Axis. ST_Tc Hyd Ax Param [} 130] and f Jerk of the function block used on axis start take effect (example: MC_Move Absolute_Bk Plc Mc [} 73]) and f Brake Distance and/or f Brake Dead Time in Axis. ST_Tc Hyd Ax Param [} 130]. i Tc Mc_Profile Time Pos Ctrl Only present for compatibility reasons; will shortly no longer be supported. It should not be used for new projects and should be replaced when existing projects are revised, if possible. i Tc Mc_Profile Cosine Only present for compatibility reasons; will shortly no longer be supported. It should not be used for new projects and should be replaced when existing projects are revised, if possible. i Tc Mc_Profile Time Ramp A profile is generated with a time-controlled acceleration phase, a time-controlled braking phase and a target approach with creep speed. TF5810 Version: 1.8.3 241
## Page 242

PLCopen Motion Control The arrows on the profile of the control value suggest how the shape of the curve can be affected through the parameters of the move order or of the axis. To begin with, a time-controlled ramp function "1" is used to accelerate to the required travel velocity "2". This control value is maintained until the direction-specific target window cam is detected. From here, a time-controlled ramp "3" is applied to decelerate from the set motion value to the set creep value "5". This control value is maintained until the direction-specific target cam is detected. The axis is then switched to its idle behavior. Parameters active in the travel profile Start ramp "1": f Start Ramp has an effect in Axis. ST_Tc Hyd Ax Param [} 130]. Travel phase "2": The smallest of the following values is the effective one: f Ref Velo and f Max Velo in Axis. ST_Tc Hyd Ax Param [} 130], Velocity of the function block used to start the axis (for example: MC_Move Absolute_Bk Plc Mc [} 73]). Braking ramp "3": f Stop Ramp has an effect in Axis. ST_Tc Hyd Ax Param [} 130]. Creep phase "4": f Creep Speed has an effect in Axis. ST_Tc Hyd Ax Param [} 130]. Behavior of the function block on restart during a motion If a further start command is issued during an active movement, a distinction has to be made between two cases. This profile is created on restart in the same direction with a different velocity (higher in this case). 242 Version: 1.8.3 TF5810
## Page 243

PLCopen Motion Control This profile is created on restart in the opposite direction, in this case with the same velocity. This profile type can only be used in a meaningful manner in combination with the encoder type i Tc Mc_Encoder Dig Cam [} 207]. See also Special case: digital position cams. 4.4.6.2 MC_Ax Runtime_Bk Plc Mc MC_Ax Runtime_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID BOOL Lag Error Available from version 3.0 The function block integrates a function block of the type MC_Ax Rt Generator_Bk Plc Mc() [} 237] and a function block of the type MC_Ax Rt Controller_Bk Plc Mc() [} 245]. The outputs of the generator are forwarded. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. TF5810 Version: 1.8.3 243
## Page 244

PLCopen Motion Control Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; Lag Error: BOOL; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Lag Error BOOL If the lag error exceeds the set limits, it is indicated here. This signal is also available if position lag monitoring is not activated. 4.4.7 Runtime 4.4.7.1 MC_Ax Rt Check Sync Distance_Bk Plc Mc MC_Ax Rt Check Sync Distance_Bk Plc Mc Max Distance LREAL BOOL Active Min Distance LREAL BOOL Exceeded Max Index Width LREAL ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block checks for an invalid path (distance) after leaving the cam during homing. Inputs VAR_INPUT Max Distance: LREAL; Min Distance: LREAL; Max Index Width: LREAL; END_VAR Name Type Description Max Distance LREAL [mm] This parameter is used to specify the maximum permitted distance that may be traveled between the referencing cam and reaching of the zero pulse. Min Distance LREAL [mm] This parameter is used to specify the minimum distance that must be traveled between the referencing cam and reaching of the zero pulse. Max Index Width LREAL [mm] This parameter is used to specify the minimum distance that must be traveled to leave the referencing cam. (from V3.0.20) Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. 244 Version: 1.8.3 TF5810
## Page 245

PLCopen Motion Control Outputs VAR_OUTPUT Active: BOOL; Exceeded: BOOL; END_VAR Name Type Description Active BOOL Indicates that the axis has left the cam has and expects the zero pulse of the encoder. Exceeded BOOL Indicates that the axis has travelled more than Max Distance after leaving the cam, without detection of the zero pulse of the encoder. Behavior of the function block The function block detects the part of the homing, in which the axis searches for the zero pulse of encoder, thereby monitoring the distance travelled. Two problems can be detected during this process: • The axis travels Max Index Width, without that the falling edges of the referencing cam being detected. • The axis travels Max Distance, without a zero pulse being detected. • The zero pulse is detected, before the axis has traveled Min Distance. Any problems that are detected are indicated with Exceeded. If this is to lead to an axis error, the application must specify a corresponding change of state. An MC_Ax Rt Go Error State_Bk Plc Mc [} 249] function block and a coded Error Code [} 339] should be used here. Monitoring for Min Distance and Max Distance can be suppressed by setting the respective parameter to 0.0. 4.4.7.2 MC_Ax Rt Controller_Bk Plc Mc MC_Ax Rt Controller_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc This function block contains the standard position controller of the axis. If necessary, a function block of the significantly more complex type MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc() [} 185] can be used instead of this function block. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here a variable of the type AXIS_REF_Bk Plc Mc [} 86] should be transferred. TF5810 Version: 1.8.3 245
## Page 246

PLCopen Motion Control Structure of the controller The Ti parameter is used by this controller as Ki. A value of 0.0 disables the I part. Increasing values generate increasingly strong reactions of the I part. 4.4.7.3 MC_Ax Rt Finish_Bk Plc Mc MC_Ax Rt Finish_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID Available from version 3.0 This function block adapts the control value that has been generated to the special features of the particular axis. An MC_Ax Rt Finish Linear_Bk Plc Mc [} 247] function block should be used if a characteristic curve linearization is required. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. 246 Version: 1.8.3 TF5810
## Page 247

PLCopen Motion Control Behavior of the function block The function block investigates the axis interface that has been passed to it every time it is called. A number of problems can be detected and reported during this process: • If one of the pointers has not been initialized the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc or dw Tc Hyd Err Cd Ptr Mc Plc. If these checks could be performed without problem, the control value for the axis is adapted according to the values in Axis. ST_Tc Hyd Ax Param [} 130]. • The control value for the advance and the positional control reaction are combined to form the output control value. • Area compensation is taken into account. • Compensation is applied for a bend in the characteristic curve. • The overlap compensation, the terminal control value and the offset compensation are included in the calculation. If only the usual function blocks (encoder, generator, finish, drive) for the axis are to be called, a function block of type MC_Ax Standard Body_Bk Plc Mc [} 253] should be used for simplicity. 4.4.7.4 MC_Ax Rt Finish Linear_Bk Plc Mc MC_Ax Rt Finish Linear_Bk Plc Mc Enable Linearisation BOOL BOOL Error Valve Table Pointer To LREAL UDINT Error ID Valve Table Low Idx INT Valve Table High Idx INT ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0.16 The function block deals with the adjustment of the generated control value to the special features of the axis, taking into account a characteristic curve. Inputs VAR_INPUT Enable Linearisation: BOOL; Valve Table: POINTER TO LREAL:=0; Valve Table Low Idx: INT:=0; Valve Table High Idx: INT:=0; END_VAR Name Type Description Enable Linearisation BOOL TRUE at this input activates the linearization. Valve Table POINTER TO The address of the linearization table should be transferred LREAL here. If possible, this should be the Valve Characteristic Table of an ST_Tc Mc Auto Ident [} 128] linked to the axis. If a NULL- pointer is passed here the linearization table and the limiting indices of the ST_Tc Mc Auto Ident structure associated with the axis are used. If such a structure is not present, the function block shows the behavior of a MC_Ax Rt Finish() function block. Valve Table Low Idx INT The index of the first point in the linearization table. Valve Table High Idx INT The index of the last point in the linearization table. If possible, this should be the Valve Characteristic Tbl Count of an ST_Tc Mc Auto Ident [} 128] linked to the axis. TF5810 Version: 1.8.3 247
## Page 248

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. VAR_ Outputs UTPUT Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block The function block investigates the axis interface that has been passed to it every time it is called. A number of problems may be detected: • Enable Linearisation is FALSE. • There is no Valve Table available. • Valve Table Low Idx is less than 0. • Valve Table High Idx is less than or equal to Valve Table Low Idx. In these cases an MC_Ax Rt Finish_Bk Plc Mc [} 246] function block is called internally, and its outputs are passed on. Otherwise the table linearization for the axis is performed. Note the following special characteristics: • The parameter for compensating the directional dependence (area ratio, gravity etc.) of the axis velocity has no effect. This compensation should be taken into account in the table. • The parameters for compensating a kink in the characteristic curve have no effect. This compensation should be taken into account in the table. • The parameter for the overlap compensation has no effect. This compensation should be taken into account in the table. • A pressing power output or an offset compensation cannot be realized through a linearization. The corresponding parameters are active. Example: Display of a linearization in the Plc Mc Manager: 248 Version: 1.8.3 TF5810
## Page 249

PLCopen Motion Control A sample program can be found in the Sample List [} 374] of the Knowledge Base [} 320]. Demonstrates automatic determination of a characteristic curve with an MC_Ax Uti Auto Ident_Bk Plc Mc function block. 4.4.7.5 MC_Ax Rt Go Error State_Bk Plc Mc MC_Ax Rt Go Error State_Bk Plc Mc Trigger BOOL Error Code DWORD No Logging BOOL ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 (not recommended) This function block places the axis into a fault state. Inputs VAR_INPUT Trigger: BOOL; Error ID: UDINT; No Logging: BOOL; END_VAR Name Type Description Trigger BOOL A rising edge at this input places the axis in a fault state. Error ID UDINT An encoded indication of the cause of the error is provided here. No Logging BOOL TRUE at this input suppresses the output of a message. TF5810 Version: 1.8.3 249
## Page 250

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Behavior of the function block The axis is placed into a fault state by a rising edge at the Trigger input. Requirements: • The value at the Error Code input is not equal to 0. • The axis is not already in an error state. If No Logging is FALSE (default state), message containing information on the affected axis and the Error Code is generated during the transition of the axis to the error state. This default message should be replaced with a message that is meaningful for the application. In this case the default message should be suppressed by setting No Logging to TRUE. 4.4.7.6 MC_Ax Rt Move Checking_Bk Plc Mc MC_Ax Rt Move Checking_Bk Plc Mc Enable BOOL BOOL Triggered Min Distance LREAL BOOL Timeout Filter LREAL ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block monitors the response of an axis. Inputs VAR_INPUT Enable: BOOL; Min Distance: LREAL; Filter: LREAL; END_VAR Name Type Description Enable BOOL TRUE at this input activates the monitoring. Min Distance LREAL [mm] The required minimum distance must be transferred here. Filter LREAL [s] The measuring time must be specified here. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. 250 Version: 1.8.3 TF5810
## Page 251

PLCopen Motion Control Outputs VAR_OUPUT Triggered: BOOL; Timeout: BOOL; END_VAR Name Type Description Triggered BOOL This output indicates that the axis was set to error state. Timeout BOOL This output indicates that monitoring was triggered. Behavior of the function block The function block continuously checks whether the axis has traveled at least a Min Distance within Filter in the direction that matches the required motion. If this is not the case, timeout is indicated. If Enable is TRUE, the axis is set to error state dw Tc Hyd Err Cd Not Moving = 16#435D = 17245. This is indicated through Triggered. 4.4.7.7 MC_Ax Rt Set Direct Output_Bk Plc Mc MC_Ax Rt Set Direct Output_Bk Plc Mc Enable BOOL BOOL Busy Out Value LREAL BOOL Command Aborted Ramp Time LREAL BOOL Error ↔ Axis Reference To AXIS_REF_Bk Plc Mc UDINT Error Id Available from version 3.0 The function block issues a control value, regardless of a profile generation. Inputs VAR_INPUT Enable: BOOL; Out Value: LREAL; Ramp Time: LREAL; END_VAR Name Type Description Enable BOOL TRUE at this input activates the output. Out Value LREAL The control value to be output should be transferred here. Ramp Time LREAL [s] Here, the time should be specified in which the control value would reach full scale. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUPUT Busy: BOOL; Command Aborted: BOOL; TF5810 Version: 1.8.3 251
## Page 252

PLCopen Motion Control Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Command Aborted BOOL This indicates abortion of the function. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block A rising edge at Enable activates the function. The axis is put into states Mc State_Continousmotion [} 103] and i Tc Hyd State Ext Generated [} 90] and Busy becomes TRUE. The control value of the axis is updated with Out Value. The rate of change is specified through Ramp Time. If Enable is set to FALSE, the control value is brought to 0.0 using Ramp Time, and the function is terminated. Only then does Busy become FALSE. If another function block takes over control of the axis while the MC_Ax Rt Set Direct Output_Bk Plc Mc is active, the function block terminates its function and indicates Command Aborted. 4.4.7.8 MC_Ax Rt Set Ext Gen Values_Bk Plc Mc MC_Ax Rt Set Ext Gen Values_Bk Plc Mc Enable BOOL BOOL Error Position LREAL UDINT Error Id Velocity LREAL BOOL Active Target Position LREAL ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block supplies an axis with command variables, which do not originate from the axis' own generator. Inputs VAR_INPUT Enable: BOOL; Position: LREAL:=0.0; Velocity: LREAL:=0.0; Target Position: LREAL:=0.0; END_VAR Name Type Description Enable BOOL TRUE at this input activates the transfer of the command variables provided. Position LREAL [mm] Set position value to be transferred cyclically. Velocity LREAL [mm/s] Set velocity value to be transferred cyclically. Target Position LREAL [mm] Target position value for the current motion to be transferred cyclically. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR 252 Version: 1.8.3 TF5810
## Page 253

PLCopen Motion Control Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs OUTPUT Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block The function block investigates the axis interface that has been passed to it every time it is called. If a rising edge is detected at Execute, the axis is put in state Mc State_Synchronizedmotion and i Tc Hyd State Ext Generated. If Execute is TRUE, the values of Position, Velocity and Target Position are entered in the runtime variables of the axis. The purpose is to map the behavior of the generator function block for a comparable motion, as far as possible. If a falling edge is detected at Execute, the function block puts the axis in the state Mc State_Standstill. If the axis is not at standstill at this time, it is stopped via the time-controlled ramp set in f Stop Ramp. The generator function block of the axis should still be called cyclically. It deals with position control and updates further internal variables. 4.4.7.9 MC_Ax Standard Body_Bk Plc Mc MC_Ax Standard Body_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID Available from version 3.0 This function block calls a function block of each of the following types: MC_Ax Rt Encoder_Bk Plc Mc [} 198], MC_Ax Runtime_Bk Plc Mc [} 237], MC_Ax Rt Finish_Bk Plc Mc [} 246] and MC_Ax Rt Drive_Bk Plc Mc [} 187]. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; END_VAR TF5810 Version: 1.8.3 253
## Page 254

PLCopen Motion Control Name Type Description Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block The usual components of the axis are called, depending on the value in ST_Tc Hyd Ax Param [} 130]. If one of the called function blocks reports an Error, it will be returned with its Error ID at the outputs of this function block. In the event of multiple problems, they are prioritized according to the following sequence: encoder, generator, finish, drive. 4.4.7.10 MC_Ax Uti Standard Init_Bk Plc Mc MC_Ax Uti Standard Init_Bk Plc Mc Axis Name STRING(255) BOOL Busy Path Name STRING(255) BOOL Done p Device Input Pointer To ST_Tc Plc Device Input BOOL Ready p Device Output Pointer To ST_Tc Plc Device Output BOOL Error p Log Buffer Pointer To ST_Tc Plc Mc Log Buffer UDINT Error ID p Aux Labels Pointer To ST_Tc Mc Aux Data Labels BOOL Reload Table p St Ax Auto Params Pointer To ST_Tc Mc Auto Ident p St Ax Lin Curve Buffer Pointer To ST_Tc Mc Ax Lin Curve Buffer p St Ax Command Buf Pointer To ST_Tc Plc Cmd Buffer_Bk Plc Mc n Log Level DWORD f Save Delay LREAL ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block handles the initialization and monitoring of axis components. Inputs VAR_INPUT Axis Name: STRING(255); Path Name: STRING(255); p Device Input: POINTER TO ST_Tc Plc Device Input:=0; p Device Output: POINTER TO ST_Tc Plc Device Output:=0; p Log Buffer: POINTER TO ST_Tc Plc Mc Log Buffer:=0; p St Ax Aux Labels: POINTER TO ST_Tc Mc Aux Data Labels:=0; p St Ax Auto Params: POINTER TO ST_Tc Mc Auto Ident; p St Ax Command Buf: POINTER TO ST_Tc Plc Cmd Buffer_Bk Plc Mc:=0; //from V3.0.8 n Log Level: DINT:=0; END_VAR 254 Version: 1.8.3 TF5810
## Page 255

PLCopen Motion Control Name Type Description Axis Name STRING Here, the text-based name of the axis (example: 'Axis_1') should be transferred. Path Name STRING Here, the text-based path name (example: 'C:\Twin CAT\Project\'), under which the axis parameters are to be saved, should be transferred. p Device Input POINTER This parameter is used to transfer the address of a variable of type ST_Tc Plc Device Input [} 149]. p Device Output POINTER This parameter is used to transfer the address of a variable of type ST_Tc Plc Device Output [} 153]. p Log Buffer POINTER Here, the address of a variable of type ST_Tc Plc Mc Log Buffer [} 156] can be transferred. p St Ax Aux Labels POINTER Here, the address of an ST_Tc Mc Aux Data Labels [} 149] structure with label texts for customer-specific axis parameters can be transferred. p St Ax Auto Param POINTER Here, the address of a variable of type ST_Tc Mc Auto Ident [} 128] can be s transferred. p St Ax Command B POINTER From V3.0.8 the input Buffer Mode defined by the PLCopen is available uf for various function blocks. The functionality that can be controlled with this is currently in preparation. In this context this command buffer was amended. The input p St Ax Command Buf must currently not be supplied, or only with the value 0. n Log Level DINT Here, a coded value [} 347] should be transferred, which specifies the threshold value for recording of messages. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Ready: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates that a command has been successfully processed. Ready BOOL This indicates that a command has been successfully processed and the axis parameters have been successfully loaded. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block With each call, the function block examines the transferred axis interface and the transferred pointers. If a change is detected, the function block indicates in the transferred AXIS_REF_Bk Plc Mc [} 86] structure that the axis has to be reinitialized. The MC_Ax Param Load_Bk Plc Mc [} 287] function block used by this function block TF5810 Version: 1.8.3 255
## Page 256

PLCopen Motion Control will now automatically load the axis parameters from the file. If p Aux Labels is supplied, the label texts of the customer-specific axis parameters are then loaded with a MC_Ax Param Aux Labels Load_Bk Plc Mc [} 286] function block. The strings transferred as Axis Name and Path Name must not contain spaces or special characters, which would make them unsuitable for generating a file name. The file name is generated by concatenating the transferred strings and adding the extension '.dat'. The file name for the label texts of the customer-specific axis parameter is generated in the same way, but with the extension '.txt'. The parameters p Device Input and p Device Output should be supplied for all axes, which use an I/O hardware for position detection. If virtual axes are used, these parameters should not be assigned or assigned 0. The input p St Ax Command Buf must currently not be supplied, or only with the value 0. 4.4.7.11 MC_Ax Rt Cmd Buffer Execute_Bk Plc Mc MC_Ax Rt Cmd Buffer Execute_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Behavior of the function block If the axis is equipped with a command buffer via an MC_Ax Uti Standard Init() function block, positioning commands such as MC_Move Absolute_Bk Plc Mc are entered in this buffer. If i Tc Mc_Profile Ctrl Based is set as the setpoint generator, a function block of this type must be called cyclically so that these commands are forwarded to the axis and actively processed. 4.4.8 Message logging 4.4.8.1 MC_Ax Rt Log Axis Entry_Bk Plc Mc MC_Ax Rt Log Axis Entry_Bk Plc Mc p Buffer Pointer To ST_Tc Plc Mc Log Buffer Log Level DWORD Source DWORD Arg Type INT di Arg DINT lr Arg LREAL s Arg STRING(255) ↔ Axis Reference To AXIS_REF_Bk Plc Mc ↔ Message Reference To STRING(255) 256 Version: 1.8.3 TF5810
## Page 257

PLCopen Motion Control Available from version 3.0 The function block enters an axis-related message in the Log Buffer of the library. Further information about creating a log buffer can be found under FAQ #10 in the Knowledge Base [} 320]. All axis-related library function blocks use this function block for message outputs. Inputs VAR_INPUT p Buffer: POINTER TO ST_Tc Plc Mc Log Buffer; Log Level: DWORD:=0; Source: DWORD:=0; Message: STRING(255); Arg Type: INT:=0; di Arg: DINT:=0; lr Arg: LREAL:=0; s Arg: STRING(255); END_VAR Name Type Description p Buffer POINTER Here the address of a variable of type ST_Tc Plc Mc Log Buffer [} 156] is to be transferred. Log Level DWORD A coded specification of the message type. A Logger Levels [} 347] value from the Global Constants [} 338] should be used. Source DWORD A coded specification of the message source. A Logger Sources [} 347] value from the Global Constants [} 338] should be used. Message STRING The message text. Arg Type INT The type of the optional argument. di Arg DINT The value of the optional argument, if it is of type DINT. lr Arg LREAL The value of the optional argument, if it is of type LREAL. s Arg STRING The value of the optional argument, if it is of type STRING. Inputs/outputs VAR_IN_OUT Axis: POINTER TO AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis POINTER Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred Behavior of the function block The only difference between the function block and MC_Ax Rt Log Entry_Bk Plc Mc [} 258] is that the axis name appears before the message. 4.4.8.2 MC_Ax Rt Log Clear_Bk Plc Mc MC_Ax Rt Log Clear_Bk Plc Mc p Buffer Pointer To ST_Tc Plc Mc Log Buffer TF5810 Version: 1.8.3 257
## Page 258

PLCopen Motion Control Available from version 3.0 The function block deletes a Log Buffer of the library. Further information about creating a log buffer can be found under FAQ #10 in the Knowledge Base [} 320]. Inputs/outputs VAR_IN_OUT p Buffer: POINTER TO ST_Tc Plc Mc Log Buffer; END_VAR Name Type Description p Buffer POINTER p Buffer: Here the address of a variable of type ST_Tc Plc Mc Log Buffer [} 156] is to be transferred. Behavior of the function block All entries in the Log Buffer are deleted and initialized. 4.4.8.3 MC_Ax Rt Log Entry_Bk Plc Mc MC_Ax Rt Log Entry_Bk Plc Mc p Buffer Pointer To ST_Tc Plc Mc Log Buffer Log Level DWORD Source DWORD Message STRING(255) Arg Type INT di Arg DINT lr Arg LREAL s Arg STRING(255) Available from version 3.0 The function block enters a message in the Log Buffer of the library. Further information about creating a log buffer can be found under FAQ #10 in the Knowledge Base [} 320]. Inputs VAR_INPUT p Buffer: POINTER TO ST_Tc Plc Mc Log Buffer; Log Level: DWORD:=0; Source: DWORD:=0; Message: STRING(255); Arg Type: INT:=0; di Arg: DINT:=0; lr Arg: LREAL:=0; s Arg: STRING(255); END_VAR 258 Version: 1.8.3 TF5810
## Page 259

PLCopen Motion Control Name Type Description p Buffer POINTER Here the address of a variable of type ST_Tc Plc Mc Log Buffer [} 156] is to be transferred. Log Level DWORD A coded specification of the message type. A Logger Levels [} 347] value from the Global Constants [} 338] should be used. Source DWORD A coded specification of the message source. A Logger Sources [} 347] value from the Global Constants [} 338] should be used. Message STRING The message text. Arg Type INT The type of the optional argument. di Arg DINT The value of the optional argument, if it is of type DINT. lr Arg LREAL The value of the optional argument, if it is of type LREAL. s Arg STRING The value of the optional argument, if it is of type STRING. Behavior of the function block If p Buffer was supplied correctly and points to an ST_Tc Plc Mc Log Buffer [} 156], which has capacity for at least one further message, the transferred message data are complemented with local time information and entered in the message buffer. 4.4.8.4 MC_Ax Rt Logger De Spool_Bk Plc Mc MC_Ax Rt Logger Despool_Bk Plc Mc p Buffer Pointer To ST_Tc Plc Mc Log Buffer Spare INT Available from version 3.0 The function block prevents overflowing of the Log Buffer of the library. Further information about creating a log buffer can be found under FAQ #10 in the Knowledge Base [} 320]. Inputs VAR_INPUT Spare: INT; END_VAR Name Type Description spare INT The required number of free messages in the Log Buffer. Inputs/outputs VAR_IN_OUT p Buffer: POINTER TO ST_Tc Plc Mc Log Buffer; END_VAR Name Type Description p Buffer POINTER Here the address of a variable of type ST_Tc Plc Mc Log Buffer [} 156] is to be transferred. Behavior of the function block With each call the function block removes a message from the Log Buffer, if the number of free messages is smaller than the minimum number transferred in Spare. An MC_Ax Rt Logger Spool_Bk Plc Mc [} 261] function block should be used to include the whole history in the Windows Event Viewer. TF5810 Version: 1.8.3 259
## Page 260

PLCopen Motion Control Using this function block makes sense whenever a write-restricted mass storage medium is used (typically a FLASH DISK). As a minimum, a limited history of 10 to 15 messages is enabled. 4.4.8.5 MC_Ax Rt Logger Read_Bk Plc Mc MC_Ax Rt Logger Read_Bk Plc Mc Entry INT DWORD Result p Buffer Pointer To ST_Tc Plc Mc Log Buffer p Entry Pointer To ST_Tc Plc Mc Log Entry Available from version 3.0 The function block reads a message from the Log Buffer of the library. Further information about creating a log buffer can be found under FAQ #10 in the Knowledge Base [} 320]. This function block is used by diagnostics tools via ADS. A direct call from the PLC application generally makes no sense. Inputs/outputs VAR_IN_OUT Entry: INT:=0; p Buffer: POINTER TO ST_Tc Plc Mc Log Buffer; p Entry: POINTER TO ST_Tc Plc Mc Log Entry; END_VAR Name Type Description Entry INT The number of the message to be read. p Buffer POINTER Here the address of a variable of type ST_Tc Plc Mc Log Buffer [} 156] is to be transferred. p Entry POINTER Here, the address of a variable of type ST_Tc Plc Mc Log Entry [} 156] should be transferred as target. Outputs VAR_OUTPUT Result: DWORD:=0; END_VAR Name Type Description Result DWORD Here, a coded cause of error is provided. Behavior of the function block The function block checks the transferred input values with each call. Two problems can be detected during this process: • If Entry is not in the valid range (1..20), the function block returns dw Tc Hyd Ads Err Invalid Idx Offset as Result. • If p Buffer or p Entry are not defined, the function block returns dw Tc Hyd Ads Err Not Ready as Result. If no problem was detected during the check, the function block copies the message selected by Entry from the Log Buffer p Buffer into the message structure addressed with p Entry. Entry is understood as a relative age specification: Entry:=1 selects the last message entered, Entry:=2 the next older one, etc. If the required message is not available, an empty message is provided. 260 Version: 1.8.3 TF5810
## Page 261

PLCopen Motion Control 4.4.8.6 MC_Ax Rt Logger Spool_Bk Plc Mc MC_Ax Rt Logger Spool_Bk Plc Mc p Buffer Pointer To ST_Tc Plc Mc Log Buffer Available from version 3.0 The function block deals with transferring messages from the Log Buffer of the library into the Windows Event Viewer. Further information about creating a log buffer can be found under FAQ #10 in the Knowledge Base [} 320]. Inputs/outputs VAR_IN_OUT p Buffer: POINTER TO ST_Tc Plc Mc Log Buffer; END_VAR Name Type Description p Buffer POINTER Here the address of a variable of type ST_Tc Plc Mc Log Buffer [} 156] is to be transferred. Description Behavior of the function block With each call the function block removes a message from the Log Buffer and transfers it to the Windows Event Viewer. If the computer uses a write-restricted mass storage medium (typically FLASH DISK), it makes no sense to use the Windows Event Viewer. An MC_Ax Rt Logger Despool_Bk Plc Mc [} 259] function block can be used to generate a history in any case. 4.4.9 Utilities 4.4.9.1 MC_Ax Param Delayed Save_Bk Plc Mc MC_Ax Param Delayed Save_Bk Plc Mc Delay LREAL BOOL Error ↔ Axis Reference To AXIS_REF_Bk Plc Mc UDINT Error Id The function block triggers a time-delayed writing of the parameter file after a parameter has been changed. Inputs VAR_INPUT Delay: LREAL:=0.0; END_VAR Name Type Description Delay LREAL [s] Delay when triggering the parameter backup. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR TF5810 Version: 1.8.3 261
## Page 262

PLCopen Motion Control Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Error BOOL This output indicates any problems that may have occurred. Error ID UDINT In the event of an error, coded information about the type of problem is reported here. Behavior of the function block If one of the function blocks listed below noticeably changes a parameter, a time is reset. This time is increased by the cycle time in every cycle where this is not the case. If it reaches the parameter Delay, the writing of the parameter file is triggered. • MC_Write Bool Parameter_Bk Plc Mc • MC_Write Parameter_Bk Plc Mc • MC_Ax Uti Auto Ident_Bk Plc Mc • MC_Lin Table Import From Asci File_Bk Plc Mc • MC_Lin Table Import From Bin File_Bk Plc Mc 4.4.9.2 MC_Ax Rt Commands Locked_Bk Plc Mc : DWORD The function simplifies setting and deleting of a protective function in the status double word of an axis. Inputs VAR_INPUT n State DWord: DWORD:=0; b Protect: BOOL:=FALSE; END_VAR Name Type Description n State DWord DWORD The current state of the status double word. b Protect BOOL The required state of the protective function. Behavior of the function The function shows the status bit of the protective function in the transferred status double word, depending on b Protect. The application must assign the result of the function to the status double word of the axis. There is an example [} 378] available. 262 Version: 1.8.3 TF5810
## Page 263

PLCopen Motion Control 4.4.9.3 MC_Ax Rt Follow Up_Bk Plc Mc MC_Ax Rt Follow Up_Bk Plc Mc Enable BOOL ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block updates the offset compensation. Inputs VAR_INPUT Enable: BOOL; END_VAR Name Type Description Enable BOOL A TRUE at this input enables the function block. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type Axis_Ref_Bk Plc Mc [} 86] should be transferred. Behavior of the function block If Enable = TRUE, the actual position is copied to all target and set positions. Target velocity, lag error and position controller output are set to 0.0. With a falling edge at Enable, the axis will re-enable the position controller depending on parameters and enables at the current actual position. The function block should not be enabled for an axis that is performing an active movement or needs to be controlled. Because the position control is disabled, the axis can drift. If the axis is to be moved by external actions, the required oil paths must be opened by the application. 4.4.9.4 MC_Ax Rt Update External Encoder_Bk Plc Mc MC_Ax Rt Update External Encoder_Bk Plc Mc Actual Pos LREAL ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block updates the actual position of an axis with a value determined by the application. Inputs VAR_INPUT Actual Pos: LREAL; END_VAR Name Type Description Actual Pos LREAL The new value for the actual position. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR TF5810 Version: 1.8.3 263
## Page 264

PLCopen Motion Control Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type Axis_Ref_Bk Plc Mc [} 86] should be transferred. Behavior of the function block Actual Pos is entered as an actual position in the runtime data of the axis. The change generated by this in relation to the cycle time of the axis is used as the actual velocity. b Encoder Response is set in st Ax Rt Data to mark an update that has been made. NOTICE If this function block is used, no MC_Ax Rt Encoder_Bk Plc Mc() or MC_Ax Standard Body_Bk Plc Mc() function block may be called. NOTICE The actual position must be updated in each cycle. The function block does not filter. 4.4.9.5 MC_Ax Uti Offset Latch_Bk Plc Mc MC_Ax Uti Offset Latch_Bk Plc Mc Execute BOOL BOOL Done Offset Limit LREAL BOOL Error ↔ Axis Reference To AXIS_REF_Bk Plc Mc UDINT Error ID BOOL Latched LREAL Offset Available from version 3.0.40 The function block updates the offset compensation. Inputs VAR_INPUT Execute: BOOL; Offset Limit: LREAL:=0.5; END_VAR Name Type Description Execute BOOL A rising edge triggers the update. Offset Limit LREAL [V] The maximum permissible value range for the offset compensation. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type Axis_Ref_Bk Plc Mc [} 86] should be transferred. 264 Version: 1.8.3 TF5810
## Page 265

PLCopen Motion Control Outputs VAR_OUTPUT Done: BOOL; Error: BOOL; Error Id: UDINT; Latched: BOOL; Offset: LREAL; END_VAR Name Type Description Done BOOL A successful update is indicated here. Error BOOL This output indicates any problems that may have occurred. Error Id UDINT In the event of an error, coded information about the type of problem is reported here. Latched BOOL This output signals that the update was successfully completed. Offset LREAL [V] This output reports the offset value. It is only accepted as a new compensation when Done. Behavior of the function block With a rising edge at Execute, Offset is updated with the current output of the position controller. Before accepting this value as compensation, the function block checks for several possible errors: • The axis must have a controller enable and must not be in an active motion state or error state (Axis.st Ax Rt Data.i Current Step=i Tc Hyd State Idle). (error code dw Tc Hyd Ads Err Busy) • The detected controller output must not be outside ±Offset Limit. (error code dw Tc Hyd Ads Err Illegal Value) If one of the errors has occurred, Error is reported and Error Id is assigned the specified error code. In this case, the compensation remains unchanged. Otherwise, offset is applied as the new compensation value. Since from this point in time the part of the output value previously provided by the position controller is taken over by the compensation, the output of the controller must be canceled. The following steps are carried out once only: • The set and current target positions are updated with the actual position. • The position error (lag error) is set to zero. • The position controller output is set to zero. • The I part of the default position controller is wiped. • If a position controller other than the default position controller is used, its I part must be deleted by the application. All outputs are set to the idle state with a falling edge at Execute. 4.4.9.6 Filters 4.4.9.6.1 MC_Ax Uti Average Derivative_Bk Plc Mc MC_Ax Uti Average Derivative_Bk Plc Mc Input LREAL LREAL Output Min Idx DINT BOOL Error Max Idx DINT UDINT Error ID p Buffer Pointer To LREAL ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 TF5810 Version: 1.8.3 265
## Page 266

PLCopen Motion Control The function block determines the derivative of a value through numeric differentiation over more than one cycle. Inputs VAR_INPUT Input: LREAL:=0.0; Min Idx: DINT:=0; Max Idx: DINT:=0; p Buffer: POINTER TO LREAL:=0; END_VAR Name Type Description Input LREAL The raw value of the parameter to be filtered. Min Idx DINT The index of the first filter buffer element to be used. Max Idx DINT The index of the last filter buffer element to be used. p Buffer POINTER The address of the first filter buffer element. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Output: LREAL:=0.0; Error: BOOL:=FALSE; Error ID: UDINT:=0; END_VAR Name Type Description Output LREAL The filtered value. Error BOOL This output indicates problems with the transferred parameters. Error ID UDINT In the event of an error, coded information about the type of problem is reported here. Behavior of the function block With each call the function block checks the address of the filter buffer p Buffer and the indices of the elements Min Idx and Max Idx to be used. If the transferred values are obviously nonsensical, the system responds with Error and coded information in Error ID. Otherwise, with each call Input is entered in the filter buffer, and the average value of the modification over the set of values available in the buffer is formed and returned as Output. The set of values for averaging contains (Max Idx - Min Idx + 1) values. The measuring time is determined by multiplication of this number with the cycle time. The principle of sliding averaging leads to a delay amounting to half the measuring time. If the filtered parameter can be used in a control loop, the resulting frequency-dependent phase shift can lead to restrictions for the parameter selection. The function block has no way to fully check the transferred values of p Buffer, Min Idx and Max Idx. The user must ensure that these values can be used safely. Otherwise may behave in an unpredictable manner (overwriting of memory) or abortion of the PLC operation. 266 Version: 1.8.3 TF5810
## Page 267

PLCopen Motion Control 4.4.9.6.2 MC_Ax Uti PT1_Bk Plc Mc MC_Ax Uti Pt1_Bk Plc Mc f Input LREAL LREAL f Output f Cycletime LREAL BOOL b Error f T0 LREAL UDINT n Error Id Available from version 3.0 The function block calculates a first-order low-pass. Inputs VAR_INPUT f Input: LREAL:=0.0; f Cycletime: LREAL:=0.001; f T0: LREAL:=1.0; END_VAR Name Type Description f Input LREAL The raw value of the parameter to be filtered. f Cycletime LREAL [s] The cycle time of the calling PLC task. f T0 LREAL [s] The filter time constant. Outputs VAR_OUTPUT f Output: LREAL; b Error: BOOL; n Error Id: UDINT; END_VAR Name Type Description f Output LREAL The filtered value. b Error BOOL This output indicates problems with the transferred parameters. n Error Id UDINT In the event of an error, coded information about the type of problem is reported here. Behavior of the function block With each call the function block checks the transferred parameters. If an invalid value is detected, the function block responds with b Error and a corresponding value in n Error Id. Otherwise, the internal variables are updated with f Input, and the filtered value is returned as f Output. 4.4.9.6.3 MC_Ax Uti PT2_Bk Plc Mc MC_Ax Uti Pt2_Bk Plc Mc f Input LREAL LREAL f Output f Cycletime LREAL BOOL b Error f Theta LREAL UDINT n Error Id f T0 LREAL Available from version 3.0 The function block calculates a second-order low-pass. TF5810 Version: 1.8.3 267
## Page 268

PLCopen Motion Control Inputs VAR_INPUT f Input: LREAL:=0.0; f Cycletime: LREAL:=0.001; f Theta: LREAL:=1.0; f T0: LREAL:=1.0; END_VAR Name Type Description f Input LREAL The raw value of the parameter to be filtered. f Cycletime LREAL [s] The cycle time of the calling PLC task. f Theta LREAL The attenuation. f T0 LREAL The filter time constant. Outputs VAR_OUTPUT f Output: LREAL; b Error: BOOL; n Error Id: UDINT; END_VAR Name Type Description f Output LREAL The filtered value. b Error BOOL This output indicates problems with the transferred parameters. n Error Id UDINT In the event of an error, coded information about the type of problem is reported here. Behavior of the function block With each call the function block checks the transferred parameters. If an invalid value is detected, the function block responds with b Error and a corresponding value in n Error Id. Otherwise, the internal variables are updated with f Input, and the filtered value is returned as f Output. 4.4.9.6.4 MC_Ax Uti Slew Rate Limitter_Bk Plc Mc MC_Ax Uti Slew Rate Limitter_Bk Plc Mc f Input LREAL LREAL f Output f Cycletime LREAL BOOL b Error f Max Rate LREAL UDINT n Error Id Available from version 3.0 The function block generates a rise-limited ramp. Inputs VAR_INPUT f Input: LREAL:=0.0; f Cycletime: DINT:=0; f Max Rate: DINT:=0; END_VAR Name Type Description f Input LREAL The raw value of the parameter to be filtered. f Cycletime DINT [s] The cycle time of the calling PLC task in seconds. f Max Rate DINT The magnitude of the maximum permitted rate of change at the output as change per second. 268 Version: 1.8.3 TF5810
## Page 269

PLCopen Motion Control Outputs VAR_OUTPUT f Output: LREAL:=0.0; b Error: BOOL:=FALSE; n Error Id: UDINT:=0; END_VAR Name Type Description f Output LREAL [1/s] The filtered value. b Error BOOL This output indicates problems with the transferred parameters. n Error Id UDINT In the event of an error, coded error information is output here. Behavior of the function block With each call the function block checks the transferred values for f Cycletime and f Max Rate. If the values are incorrect, the system responds with b Error and coded information in n Error Id. Otherwise, the difference between Input and Output is determined with each call. If the magnitude of this difference is less than or equal to f Max Rate * f Cycletime, the value of Input is used directly as f Output. Otherwise, f Output is changed by f Max Rate * f Cycletime. The sign is selected automatically. The value for f Cycletime must be ≥ 0.001. Negative values are not permitted for f Max Rate. Input will usually be a value, which is determined and filtered based on the cycle of the axis blocks. AXIS_REF_Bk Plc Mc [} 86]. ST_Tc Hyd Ax Param [} 130].f Cycletime can be used for f Cycletime here. 4.4.9.6.5 MC_Ax Uti Sliding Average_Bk Plc Mc MC_Ax Uti Sliding Average_Bk Plc Mc Input LREAL LREAL Output Min Idx DINT LREAL Derivative Max Idx DINT p Buffer Pointer To LREAL Available from version 3.0 The function block determines a sliding average value. Inputs VAR_INPUT Input: LREAL:=0.0; Min Idx: DINT:=0; Max Idx: DINT:=0; p Buffer: POINTER TO LREAL:=0; END_VAR Name Type Description Input LREAL The raw value of the parameter to be filtered. Min Idx DINT The index of the first filter buffer element to be used. Max Idx DINT The index of the last filter buffer element to be used. p Buffer POINTER The address of the first filter buffer element. TF5810 Version: 1.8.3 269
## Page 270

PLCopen Motion Control Outputs VAR_OUTPUT Output: LREAL:=0.0; END_VAR Name Type Description Output LREAL Output: The filtered value. Behavior of the function block With each call the function block checks the address of the filter buffer p Buffer and the indices of the elements Min Idx and Max Idx to be used. If the transferred values are obviously nonsensical, Input is output as Output. Otherwise, with each call Input is entered in the filter buffer, and the average value over the set of values available in the buffer is formed and returned as Output. The set of values for averaging contains (Max Idx - Min Idx + 1) values. The filter time is determined by multiplication of this number with the cycle time. The principle of sliding averaging leads to a delay amounting to half the filter time. If the filtered parameter can be used in a control loop, the resulting frequency-dependent phase shift can lead to restrictions for the parameter selection. The function block has no way to fully check the transferred values of p Buffer, Min Idx and Max Idx. The user must ensure that these values can be used safely. Otherwise may behave in an unpredictable manner (overwriting of memory) or abortion of the PLC operation. 4.4.9.7 Identification 4.4.9.7.1 MC_Ax Uti Auto Ident_Bk Plc Mc MC_Ax Uti Auto Ident_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Busy Execute BOOL BOOL Done Wait BOOL BOOL Error UDINT Error ID INT Step BOOL In Recovery BOOL Request Positiv BOOL Request Negativ Available from version 3.3.6.4 The function block automatic determines a number of axis parameters. Inputs VAR_INPUT Execute: BOOL; Wait: BOOL; END_VAR 270 Version: 1.8.3 TF5810
## Page 271

PLCopen Motion Control Name Type Description Execute BOOL A rising edge at this input triggers the identification. Wait BOOL (From Twin CAT 2 V3.0.44 / Twin CAT 3 V3.3.1.22) If this input is set to TRUE, the internal sequence processor does not go outside the recovery time. This prevents the output value from ramping up when the valves are not yet switched. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Step: INT; In Recovery: BOOL; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful identification. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Step INT The current step of the internal sequence processor. In Recovery BOOL (From Twin CAT 2 V3.0.44 / Twin CAT 3 V3.3.1.22) This indicates that a recovery time (defined by Valve Characteristic Recovery) has elapsed. Request Positiv BOOL This signals a movement in a positive direction. (from version 3.3.6.4) e Request Negati BOOL This signals a movement in a negative direction. (from version 3.3.6.4) ve Behavior of the function block The function block checks whether the pointer IS_REF_Bk Plc Mc [} 86].p St Ax Auto Params was initialized. If this is the case, it performs a number of initializations when a rising edge is detected at the Execute input and then commences the parameter identification. The individual steps of the identification are determined by the values in ST_Tc Mc Auto Ident [} 128]. Enable End Of Travel: If this boolean parameter is set, the mechanical travel limits are determined automatically. First, the system ensures that the axis can move freely or is at the positive function block. The axis is now moved with a negative control voltage until it has reached the function block. The axis is then operated with a positive control voltage until the positive function block has been detected. The control voltage is limited to End Of Travel_Negativ Limit and End Of Travel_Positiv Limit. If the positive travel limit falls below the negative limit, the values are swapped, and Axis.st Ax Params.b Drive_Reversed is inverted. Enable Overlap, Enable Zero Adjust: If one of these boolean parameter is set, the cover or the offset voltage of the valve is determined. Thus operation is influenced by End Of Travel_Negative and End Of Travel_Positive. TF5810 Version: 1.8.3 271
## Page 272

PLCopen Motion Control First, the axis is moved into a position window that is located in the middle between End Of Travel_Positiv and End Of Travel_Negativ. The width of the window is 80% of the area defined by these parameters. The output polarity of the drive is inverted, if required. Now, the output voltage is determined, at which the axis starts moving in positive direction. Then, the corresponding negative voltage is determined. By offsetting these parameter, both the cover and the offset voltage are determined. The type of entry in the axis parameter is controlled through Enable Overlap and Enable Zero Adjust. Enable Arrea Ratio: If this boolean parameter is set, the direction-dependent velocity ratio is determined. First, the axis is moved into a position window, which is located in the middle between p St Ax Auto Params. End Of Travel_Positiv and p St Ax Auto Params. End Of Travel_Negativ. The width of the window is 80% of the area defined by these parameters. Then, the axis is moved in positive and negative direction for one second with a control voltage of 1 V. The velocities determined during this movement are divided, in order to determine the velocity ratio. End Of Travel_Negativ: [mm] If determination of the travel limits is activated, this value is determined by the function block. If it is disabled, the application must specify the value here. This parameter influences the determination of the offset voltage and the area ratio. End Of Travel_Positiv: [mm] If determination of the travel limits is activated, this value is determined by the function block. If it is disabled, the application must specify the value here. This parameter influences the determination of the offset voltage and the area ratio. End Of Increments_Negativ: [1] If determination of the travel limits is activated, this value is determined by the function block. It then matches End Of Travel_Negativ, but it is the raw encoder value in increments. End Of Increments_Positiv: [1] If determination of the travel limits is activated, this value is determined by the function block. It then matches End Of Travel_Positiv, but it is the raw encoder value in increments. End Of Travel_Negativ Limit: [V] This parameter limits negative output voltages. End Of Travel_Positiv Limit: [V] This parameter limits positive output voltages. End Of Travel_Positiv Done: This signal is set by the function block, if determination of the travel limits is disabled or the positive travel limit was determined. End Of Travel_Negativ Done: This signal is set by the function block, if determination of the travel limits is disabled or the negative travel limit was determined. End Of Velocity_Negativ Limit: [mm/s] This parameter limits negative velocities. If this velocity is reached or exceeded during the measurement, the current measurement is completed, but no further measurement in this direction is performed. End Of Velocity_Positiv Limit: [mm/s] This parameter limits positive velocities. If this velocity is reached or exceeded during the measurement, the current measurement is completed, but no further measurement in this direction is performed. Deceleration Factor: [1] After the measuring stroke, the axis is moved to the end of the measuring path for the next measuring stroke. The regular axis parameter f Max Acc and f Max Dec, which are weighted with this factor, are used. Enable Valve Characteristic: If this boolean parameter is set, the characteristic velocity curve is determined automatically. Valve Characteristic Table: This ARRAY[1..2,1..100] contains the value pairs of the linearization table. Valve Characteristic Table[nnn,1] is the normalized velocity value, Valve Characteristic Table[nnn,2] is the normalized output value. Within the table, the value pairs with increasing index have increasing values for the velocity value and the output value. The first value pair therefore describes the fastest negative point, the last active value pair the fastest positive point. During automatic determination, the control voltage is limited 272 Version: 1.8.3 TF5810
## Page 273

PLCopen Motion Control to End Of Travel_Negativ Limit and End Of Travel_Positiv Limit and the velocity to End Of Velocity_Negativ Limit and End Of Velocity_Positiv Limit. The further points of the table are determined through extrapolation from the last two measuring points. Valve Characteristic Type: The identification can be adapted here to special valve variants or special conditions of the axis. See also E_Tc Mc Valve Type [} 120]. Valve Characteristic Tbl Count: This parameter specifies the number of value pairs to be determined in Valve Characteristic Table. The value must be odd and between 3 and 99 (including). Valve Characteristic Low End: [mm] The lower end position of the range permitted for determining the characteristic curve. Valve Characteristic High End: [mm] The upper end position of the range permitted for determining the characteristic curve. Valve Characteristic Ramp: [s] This parameter specifies the ramp for establishing the measuring voltage for the characteristic curve determination. During the specified time the voltage is increased to 10 V. Since the actual voltages are generally lower, less time is usually required to establish the voltage. Please pay attention to the notes at the end of this document. Valve Characteristic Settling: [s] Once the control value has been ramped up to the test level for the measurement, the starting of the measurement can be delayed through this parameter. Please pay attention to the notes at the end of this document. Valve Characteristic Recovery: [s] This parameter defines a dwell time, which is adhered to before the measurement travel. This enables the supply to compensate a pressure drop that may have been caused by the previous measurement travel. During this time the axis is not controlled. From Twin CAT 2 V3.0.44 / Twin CAT 3 V3.3.1.22: The expiry of the dwell time is indicated at the In Recovery output. Valve Characteristic Min Cycle: [mm] The measurement travel is only valid if the measuring voltage was established before the axis has moved towards the center of the measuring distance defined by Valve Characteristic High End and Valve Characteristic Low End by less than the half of this value. Otherwise, the effective measuring distance (without ramps) is less than this distance, and this measurement and all further measurements in this direction are replaced by a value calculated using the reference velocity of the axis. Valve_Lin Limit P, Valve_Lin Limit M: [mm/s] The lowest velocity for using the linearization table. For lower velocities, the characteristic curve is replaced by a straight line that connects the zero point with the point for the velocity specified here. Example: Diagram of a characteristic curve determination in Twin CAT Scope View: TF5810 Version: 1.8.3 273
## Page 274

PLCopen Motion Control Example: Display of a linearization in the Plc Mc Manager: 274 Version: 1.8.3 TF5810
## Page 275

PLCopen Motion Control The characteristic curve determined in this way can be used with an MC_Ax Rt Finish Linear_Bk Plc Mc function block for linearization at runtime. The characteristic curve is stored in the parameter file of the axis and automatically read on system startup. Irrespective of that, the linearization table can be imported from a text or binary file [} 336] with an MC_Lin Table Import From Asci File_Bk Plc Mc [} 277] or MC_Lin Table Import From Bin File_Bk Plc Mc [} 278] function block, or exported with an MC_Lin Table Export To Asci File_Bk Plc Mc [} 275] or MC_Lin Table Export To Bin File_Bk Plc Mc [} 276] function block. If a lower velocity than at the previous measuring point is detected in the same direction during the measurement at a test output, a warning is issued regardless of the set logger limit. The measuring point is automatically corrected to avoid falling characteristic ranges. This correction has no influence on the validity of the characteristic curve. However, it should be checked whether the values in Valve Characteristic Ramp and Valve Characteristic Settling are suitable for this axis. 4.4.9.7.2 MC_Lin Table Export To Asci File_Bk Plc Mc MC_Lin Table Export To Asci File_Bk Plc Mc Execute BOOL BOOL Busy File Name STRING(255) BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID The function block exports a linearization table to a file in ASCI format. TF5810 Version: 1.8.3 275
## Page 276

PLCopen Motion Control Inputs VAR_INPUT Execute: BOOL:=FALSE; File Name: STRING(255):=''; END_VAR Name Type Description Execute BOOL A rising edge initiates the export. File Name STRING Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful identification. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block The function block generates a file in the format expected by MC_Lin Table Import From Asci File_Bk Plc Mc [} 277]. 4.4.9.7.3 MC_Lin Table Export To Bin File_Bk Plc Mc MC_Lin Table Export To Bin File_Bk Plc Mc Execute BOOL BOOL Busy File Name STRING(255) BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID The function block exports a linearization table to a file in binary format. Inputs VAR_INPUT Execute: BOOL:=FALSE; File Name: STRING(255):=''; END_VAR Name Type Description Execute BOOL A rising edge initiates the export. File Name STRING 276 Version: 1.8.3 TF5810
## Page 277

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful identification. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block The function block generates a file in the format expected by MC_Lin Table Import From Bin File_Bk Plc Mc [} 278]. 4.4.9.7.4 MC_Lin Table Import From Asci File_Bk Plc Mc MC_Lin Table Import From Asci File_Bk Plc Mc Execute BOOL BOOL Busy File Name STRING(255) BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID INT Last Idx The function block imports a linearization table from a file in ASCI format. Inputs VAR_INPUT Execute: BOOL:=FALSE; File Name: STRING(255):=''; END_VAR Name Type Description Execute BOOL A rising edge initiates the import. File Name STRING Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. TF5810 Version: 1.8.3 277
## Page 278

PLCopen Motion Control Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Last Idx: INT:=0; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful identification. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Last Idx INT Behavior of the function block The function block reads the contents of the file and interprets it line by line according to the following rules: • Leading spaces (blanks, tabs) are ignored. • The digits 0..9 are accepted and used as digits before the decimal point for the first value. • A point or comma is interpreted as a separator between digits before and after the decimal point. • The digits 0..9 are accepted and used as digits after the decimal point for the first value. • Spaces (blanks, tabs) are interpreted as separators between the first and second values. • The digits 0..9 are accepted and used as digits before the decimal point for the second value. • A point or comma is interpreted as a separator between digits before and after the decimal point. • The digits 0..9 are accepted and used as digits after the decimal point for the second value. • If unexpected characters are detected or expected elements are missing, the import is aborted with an error. • Each pair of numbers is entered as a point in the linearization table of the axis. Last Idx is thereby incremented. After a successful import, the number of table points read is available here. Manipulation of the file The ASCI format makes it easy to manipulate such a file with a simple editor. This is possible, but not recommended. A deviation from the expected structure of the file makes it impossible to import it. Even with the correct formatting, however, a linearization table can inadvertently be created that makes it impossible for the system to function correctly. In addition, persons may be endangered and the products or plant may be damaged. 4.4.9.7.5 MC_Lin Table Import From Bin File_Bk Plc Mc MC_Lin Table Export To Bin File_Bk Plc Mc Execute BOOL BOOL Busy File Name STRING(255) BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID The function block imports a linearization table from a file in binary format. Inputs VAR_INPUT Execute: BOOL:=FALSE; File Name: STRING(255):=''; END_VAR 278 Version: 1.8.3 TF5810
## Page 279

PLCopen Motion Control Name Type Description Execute BOOL A rising edge initiates the import. File Name STRING Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Error: BOOL; Error ID: UDINT; Last Idx: INT:=0; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL This indicates successful identification. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Last Idx INT Behavior of the function block The function block reads the contents of the file and interprets it line by line according to the following rules: • Each two values are regarded as a pair of numbers. • Each pair of numbers is entered as a point in the linearization table of the axis. Last Idx is thereby incremented. After a successful import, the number of table points read is available here. Manipulation of the file The binary format makes it practically impossible to manipulate such a file with a simple editor. This is possible with an appropriate program, but absolutely not recommended. The expected structure of the file is hardly visible and it is practically impossible to maintain the formatting. Even with the correct formatting, however, it will hardly be possible to create a usable linearization table. The correct function of the system will not be possible. In addition, persons may be endangered and the products or plant may be damaged. 4.5 Parameter 4.5.1 MC_Ax Ads Comm Server_Bk Plc Mc MC_Ax Ads Comm Server_Bk Plc Mc n First Axis Index INT BOOL Plc Mc Man Offline n Last Axis Index INT p Ax Itf Pointer To AXIS_REF_Bk Plc Mc TF5810 Version: 1.8.3 279
## Page 280

PLCopen Motion Control Available from version 3.0 The function block gives the application the capacity to function as an ADS server. Calls function blocks of type MC_Ax Ads Read Decoder_Bk Plc Mc [} 283] and MC_Ax Ads Write Decoder_Bk Plc Mc [} 285] as required. The ADS codes [} 345] are listed in the Knowledge Base. Inputs VAR_INPUT n First Axis Index: INT; n Last Axis Index: INT; END_VAR Name Type Description n First Axis Index INT This parameter is used to specify the dimensioning of the AXIS_REF_Bk Plc Mc n Last Axis Index INT [} 86] array. An incorrect specification at this point excludes some of the axes from the communication or results in a crash of the PLC application by triggering serious runtime errors (Page Fault Exception). Inputs/outputs VAR_IN_OUT p Ax Itf: POINTER TO AXIS_REF_Bk Plc Mc; END_VAR Name Type Description p Ax Itf POINTER Here, the address of a variable or an array of variables of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Plc Mc Man Offline: BOOL; END_VAR Name Type Description Plc Mc Man Offline BOOL This parameter corresponds to the parameter of the same name of the MC_Ax Ads Comm Server_Bk Plc Mc [} 279] function block. Behavior of the function block Through cyclic calling of this function block in the PLC application, the application assumes the character of an ADS server and responds to ADS read and ADS write-access like any other ADS server. This includes the decoding of Idx Group/Idx Offset addressing. Function blocks of type MC_Ax Ads Read Decoder_Bk Plc Mc [} 283] and MC_Ax Ads Write Decoder_Bk Plc Mc [} 285] are called as required. This function block must not be used if the PLC application already is an ADS server. In this case the function blocks of type MC_Ax Ads Read Decoder_Bk Plc Mc [} 283] and MC_Ax Ads Write Decoder_Bk Plc Mc [} 285] should be called from the existing ADS server function block of the application. 280 Version: 1.8.3 TF5810
## Page 281

PLCopen Motion Control 4.5.2 MC_Communications_Bk Plc Mc The function block internally calls the function blocks MC_Ax Ads Comm Server_Bk Plc Mc [} 279] and MC_Ax Rt Logger Spool_Bk Plc Mc [} 261]. It also provides a message buffer. Inputs VAR_INPUT n First Axis Index: INT; n Last Axis Index: INT; p Ax Itf: POINTER TO AXIS_REF_Bk Plc Mc; END_VAR Name Type Description n First Axis Index INT These parameters correspond to the parameters of the same name of the MC_Ax Ads Comm Server_Bk Plc Mc function block. n Last Axis Index INT p Ax Itf POINTER Here the address of the AXIS_REF_Bk Plc Mc [} 86] array is to be transferred. An incorrect specification at this point causes the PLC application to crash inevitably through triggering of serious runtime errors (Page Fault Exception). Outputs VAR_OUTPUT Plc Mc Man Offline: BOOL; END_VAR Name Type Description Plc Mc Man Offline BOOL This parameter corresponds to the parameter of the same name of the MC_Ax Ads Comm Server_Bk Plc Mc function block. NOTICE Crash of the PLC application An incorrect specification at this point excludes some of the axes from the communication or results in a crash of the PLC application by triggering serious runtime errors (Page Fault Exception) Behavior of the function block By cyclic call of this function block in the PLC application the transferred axes are connected to an internal message buffer. The message buffer referenced when calling MC_Ax Uti Standard Init_Bk Plc Mc [} 254] is ignored when calling the MC_Communications_Bk Plc Mc function block. The messages from the internal message buffer are cyclically transferred to the Windows Event Viewer by internally calling an instance of the MC_Ax Rt Logger Spool_Bk Plc Mc [} 261] function block. Furthermore the PLC application gets the character of an ADS server, because internally an instance of the MC_Ax Ads Comm Server_Bk Plc Mc [} 279] function block is called. 4.5.3 MC_Ax Ads Ptr Arr Comm Server_Bk Plc Mc MC_Ax Ads Ptr Arr Comm Server_Bk Plc Mc n First Axis Index INT BOOL Plc Mc Man Offline n Last Axis Index INT p Ax Itf Arr Pointer To Pointer To AXIS_REF_Bk Plc Mc TF5810 Version: 1.8.3 281
## Page 282

PLCopen Motion Control The function block gives the application the capacity to function as an ADS server. Calls function blocks of type MC_Ax Ads Read Decoder_Bk Plc Mc [} 283] and MC_Ax Ads Write Decoder_Bk Plc Mc [} 285] as required. The ADS codes [} 345] are listed in the Knowledge Base. For most applications an MC_Ax Ads Comm Server_Bk Plc Mc is adequate and preferable. (MC_Ax Ads Comm Server_Bk Plc Mc [} 279]) Inputs VAR_INPUT n First Axis Index: INT; n Last Axis Index: INT; END_VAR Name Type Description n First Axis Index INT This parameter is used to specify the dimensioning of the n Last Axis Index INT AXIS_REF_Bk Plc Mc [} 86] array. An incorrect specification at this point excludes some of the axes from the communication or results in a crash of the PLC application by triggering serious runtime errors (Page Fault Exception). Inputs/outputs VAR_IN_OUT p Ax Itf Arr: POINTER TO DWORD; END_VAR Name Type Description p Ax Itf Arr POINTER Here, the address of a variable of type ARRAY [ncnst First Ax Id..ncnst Last Ax Id] OF POINTER TO AXIS_REF_Bk Plc Mc [} 86] should be transferred. An incorrect specification at this point causes the PLC application to crash inevitably through triggering of serious runtime errors (Page Fault Exception). Outputs VAR_OUTPUT Plc Mc Man Offline: BOOL; END_VAR Name Type Description Plc Mc Man Offline BOOL This parameter corresponds to the parameter of the same name of the MC_Ax Ads Comm Server_Bk Plc Mc function block. Behavior of the function block Through cyclic calling of this function block in the PLC application, the application assumes the character of an ADS server and responds to ADS read and ADS write-access like any other ADS server. This includes the decoding of Idx Group/Idx Offset addressing. Function blocks of type MC_Ax Ads Read Decoder_Bk Plc Mc [} 283] and MC_Ax Ads Write Decoder_Bk Plc Mc [} 285] are called as required. This function block must not be used if the PLC application already is an ADS server. 282 Version: 1.8.3 TF5810
## Page 283

PLCopen Motion Control In this case the function blocks of type MC_Ax Ads Read Decoder_Bk Plc Mc [} 283] and MC_Ax Ads Write Decoder_Bk Plc Mc [} 285] should be called from the existing ADS server function block of the application. A program example [} 321] #16 is available. 4.5.4 MC_Ax Ads Read Decoder_Bk Plc Mc MC_Ax Ads Read Decoder_Bk Plc Mc n First Axis Index INT BOOL b Clear n Last Axis Index INT BOOL b Pending b Reset BOOL b Valid BOOL s Net Id STRING(80) n Port UINT n Invoke Id UDINT n Idx Grp UDINT n Idx Offs UDINT cb Read Len UDINT p Ax Itf Pointer To AXIS_REF_Bk Plc Mc ↔ Dead Man Count Reference To UDINT Available from version 3.0 The function block decodes ADS read accesses. The ADS codes [} 345] are listed in the Knowledge Base. Inputs VAR_INPUT n First Axis Index: INT; n Last Axis Index: INT; b Reset: BOOL; b Valid: BOOL; s Net Id: STRING(80); n Port: UINT; n Invoke Id: UDINT; n Idx Group: UDINT; n Idx Offs: UDINT; cb Read Len: UDINT; p Ax Itf: POINTER TO AXIS_REF_Bk Plc Mc:=0; END_VAR TF5810 Version: 1.8.3 283
## Page 284

PLCopen Motion Control Name Type Description n First Axis Index INT This parameter is used to specify the dimensioning of the n Last Axis Index INT AXIS_REF_Bk Plc Mc [} 86] array. An incorrect specification at this point excludes some of the axes from the communication or results in a crash of the PLC application by triggering serious runtime errors (Page Fault Exception). b Reset BOOL The signals are used to co-ordinate the decoder with the ADS server. b Valid BOOL s Net Id STRING These values are required in order to generate the ADS response. They are supplied by an ADS server's ADS indication function block. n Port UINT n Invoke Id UDINT n Idx Group UDINT These values are required in order to decode the access. They are supplied by an ADS server's ADS indication function block. n Idx Offs UDINT cb Read Len UDINT p Ax Itf POINTER Here, the address of a variable or an array of variables of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Inputs/outputs VAR_IN_OUT Dead Man Count: UDINT; END_VAR Name Type Description Dead Man Count UDINT Outputs VAR_OUTPUT b Clear: BOOL; b Pending: BOOL; END_VAR Name Type Description b Clear BOOL Indicates that an ADS access indicated with b Valid should be acknowledged. b Pending BOOL Indicates that an ADS access indicated with b Valid is being processed. Behavior of the function block If, when the b Valid signal is present, the function block indicates neither b Clear nor b Pending it has not decoded the combination of n Idx Group and n Idx Offs and has not generated a response. In such a case, the ADS server (if there is one) must call another decoder, or must generate a response with the appropriate error code. 284 Version: 1.8.3 TF5810
## Page 285

PLCopen Motion Control 4.5.5 MC_Ax Ads Write Decoder_Bk Plc Mc MC_Ax Ads Write Decoder_Bk Plc Mc n First Axis Index INT BOOL b Clear n Last Axis Index INT BOOL b Pending b Reset BOOL BOOL Plc Mc Man Offline b Valid BOOL s Net Id STRING(80) n Port UINT n Invoke Id UDINT n Idx Grp UDINT n Idx Offs UDINT cb Write Len UDINT p Write Buff XWORD p Ax Itf Pointer To AXIS_REF_Bk Plc Mc ↔ Dead Man Count Reference To UDINT Available from version 3.0 The function block decodes ADS write accesses. The ADS codes [} 345] are listed in the Knowledge Base. Inputs VAR_INPUT n First Axis Index: INT; n Last Axis Index: INT; b Reset: BOOL; b Valid: BOOL; s Net Id: STRING(80); n Port: UINT; n Invoke Id: UDINT; n Idx Group: UDINT; n Idx Offs: UDINT; cb Write Len: UDINT; p Write Buff: DWORD; p Ax Itf: POINTER TO AXIS_REF_Bk Plc Mc:=0; END_VAR Name Type Description n First Axis Index INT The dimensions of the AXIS_REF_Bk Plc Mc [} 86] array must be specified n Last Axis Index INT here. An incorrect specification at this point excludes some of the axes from the communication or results in a crash of the PLC application by triggering serious runtime errors (Page Fault Exception). b Reset BOOL The signals are used to co-ordinate the decoder with the ADS server. b Valid BOOL s Net Id STRING These values are required in order to generate the ADS response. They are supplied by an ADS server's ADS indication function block. n Port UINT n Invoke Id UDINT n Idx Group UDINT These values are required in order to decode the access. They are supplied by an ADS server's ADS indication function block. n Idx Offs UDINT cb Write Len UDINT p Write Buff DWORD p Ax Itf POINTER Here, the address of a variable or an array of variables of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. TF5810 Version: 1.8.3 285
## Page 286

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Dead Man Count: UDINT; END_VAR Name Type Description Dead Man Count UDINT Counter for function block calls without ADS indication Outputs VAR_OUTPUT b Clear: BOOL; b Pending: BOOL; Plc Mc Man Offline: BOOL; END_VAR Name Type Description b Clear BOOL Indicates that an ADS access indicated with b Valid should be acknowledged. b Pending BOOL Indicates that an ADS access indicated with b Valid is being processed. Plc Mc Man Offline BOOL Indicates that the connection to the Plc Mc Manager is not available. Behavior of the function block If the function block signals neither b Clear nor b Pending when the b Valid signal is present, it has not decoded the combination of n Idx Group and n Idx Offs and no response has been generated. In such a case, the ADS server (if there is one) must call another decoder, or must generate a response with the appropriate error code. 4.5.6 MC_Ax Param Aux Labels Load_Bk Plc Mc MC_Ax Param Aux Labels Load_Bk Plc Mc Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error Id Available from version 3.0 The function block loads the label texts for the customer-specific axis parameters from a file. These texts can be generated with a simple text editor such as Microsoft Notepad. NOTICE The file must be structured according to the rules specified below. Otherwise, significant problems may occur, including system crash. This function block is generally not called directly by the application. If possible, a function block of type MC_Ax Uti Standard Init_Bk Plc Mc [} 254] should be used, which uses a function block of type MC_Ax Param Aux Labels Load_Bk Plc Mc. Inputs VAR_INPUT Execute: BOOL; END_VAR Name Type Description Execute BOOL The loading process is initiated by a rising edge at this input. 286 Version: 1.8.3 TF5810
## Page 287

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Successful loading of the parameters is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If one of the pointers has not been initialized the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc or dw Tc Hyd Err Cd Ptr Mc Plc. The loading process begins if these checks are carried out without problems. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the loading process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Error, Error ID, Done) are made available for one cycle. The number of rows in the file must match the number specified in the global constants of the library as i Tc Hydf Cust Data Max Idx (currently: 20). The maximum number of characters in each row is 20 (included spaces, without line breaks). 4.5.7 MC_Ax Param Load_Bk Plc Mc MC_Ax Param Load_Bk Plc Mc Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error Id Available from version 3.0 The function block loads the parameters for an axis from a file. A function block of type MC_Ax Param Save_Bk Plc Mc [} 288] must be used to generate a compatible parameter file. This function block is generally not called directly by the application. If possible, a function block of type MC_Ax Uti Standard Init_Bk Plc Mc [} 254] should be used, which uses a function block of type MC_Ax Param Load_Bk Plc Mc. TF5810 Version: 1.8.3 287
## Page 288

PLCopen Motion Control Inputs VAR_INPUT Execute: BOOL; END_VAR Name Type Description Execute BOOL The loading process is initiated by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Successful loading of the parameters is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the file cannot be opened for reading, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc or dw Tc Hyd Err Cd Ptr Mc Plc. The loading process begins if these checks are carried out without problems. The file version is determined, and any parameters that are not specified by the file are replaced with neutral default values. If the file contains parameters that are not used or no longer used, these are ignored. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the loading process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Error, Error ID, Done) are made available for one cycle. 4.5.8 MC_Ax Param Save_Bk Plc Mc MC_Ax Param Save_Bk Plc Mc Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error Id Available from version 3.0 The function block writes the parameters for an axis into a file. A function block of type MC_Ax Param Load_Bk Plc Mc [} 287] must be used to read the file. 288 Version: 1.8.3 TF5810
## Page 289

PLCopen Motion Control Inputs VAR_INPUT Execute: BOOL; END_VAR Name Type Description Execute BOOL The writing process is initiated by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Successful writing of the parameters is indicated here. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the file cannot be opened for writing, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc or dw Tc Hyd Err Cd Ptr Mc Plc. The writing process begins if these checks are carried out without problems. The versions of the saved parameters are logged. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the writing process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Error, Error ID, Done) are made available for one cycle. 4.5.9 MC_Ax Uti Read Coe Drive Term_Bk Plc Mc MC_Ax Uti Read Coe Drive Term_Bk Plc Mc Execute BOOL BOOL Busy Pdata Pointer To BYTE BOOL Done Byte Count BYTE BOOL Command Aborted Index WORD BOOL Error Subindex BYTE UDINT Error ID ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 TF5810 Version: 1.8.3 289
## Page 290

PLCopen Motion Control The function block reads the contents of a register from the EL terminal, which is used as drive interface for the axis. Inputs VAR_INPUT Execute: BOOL; Pdata: POINTER TO BYTE:=0; Byte Count: BYTE:=0; Index: WORD:=0; Subindex: BYTE:=0; END_VAR Name Type Description Execute BOOL A rising edge at this input starts the read process. Pdata POINTER Here, the address of the variable is specified, in which the read value is to be output. Byte Count BYTE Here, the size of the variable is specified in bytes. Index WORD Here, the addressing of parameter in the terminal is specified. Subindex BYTE Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF _Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful loading of the parameter is indicated here. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Index or Subindex are out of range the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If Byte Count or Pdata are out of range the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Drive_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. 290 Version: 1.8.3 TF5810
## Page 291

PLCopen Motion Control • If problems occur during the ADS communication with the terminal, the corresponding ADS error code is returned as Error ID, and Error is indicated. The following codes [} 339] may occur: ◦ 16#0006 = 6 = The port number of the ADS address used is invalid: Check mapping of the Info Data element of the terminal! ◦ 16#0007 = 7 = The Ams Net ID of the ADS address used is invalid: Check mapping of the Info Data element of the terminal! ◦ 16#0702 = 1794 = dw Tc Hyd Ads Err Invalid Idx Group = The terminal does not support the Co E protocol. ◦ 16#0703 = 1795 = dw Tc Hyd Ads Err Invalid Idx Offset = The address in index and subindex is not supported in the terminal. ◦ 16#0745 = 1861 = dw Tc Hyd Ads Err Timeout = Timeout. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the loading process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Done, Command Aborted, Error, Error ID) are made available for one cycle. 4.5.10 MC_Ax Uti Read Coe Enc Term_Bk Plc Mc MC_Ax Uti Read Coe Enc Term_Bk Plc Mc Execute BOOL BOOL Busy Pdata Pointer To BYTE BOOL Done Byte Count BYTE BOOL Command Aborted Index WORD BOOL Error Subindex BYTE UDINT Error ID ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block reads the contents of a register from the EL terminal, which is used as encoder interface for the axis. Inputs VAR_INPUT Execute: BOOL; Pdata: POINTER TO BYTE:=0; Byte Count: BYTE:=0; Index: WORD:=0; Subindex: BYTE:=0; END_VAR Name Type Description Execute BOOL A rising edge at this input starts the read process. Pdata POINTER Here, the address of the variable is specified, in which the read value is to be output. Byte Count BYTE Here, the size of the variable is specified in bytes. Index WORD Here, the addressing of parameter in the terminal is specified. Subindex BYTE Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR TF5810 Version: 1.8.3 291
## Page 292

PLCopen Motion Control Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Successful loading of the parameter is indicated here. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Index or Subindex are out of range the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If Byte Count or Pdata are out of range the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Encoder_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. • If problems occur during the ADS communication with the terminal, the corresponding ADS error code is returned as Error ID, and Error is indicated. The following codes [} 339] may occur: ◦ 16#0006 = 6 = The port number of the ADS address used is invalid: Check mapping of the Info Data element of the terminal! ◦ 16#0007 = 7 = The Ams Net ID of the ADS address used is invalid: Check mapping of the Info Data element of the terminal! ◦ 16#0702 = 1794 = dw Tc Hyd Ads Err Invalid Idx Group = The terminal does not support the Co E protocol. ◦ 16#0703 = 1795 = dw Tc Hyd Ads Err Invalid Idx Offset = The address in index and subindex is not supported in the terminal. ◦ 16#0745 = 1861 = dw Tc Hyd Ads Err Timeout = Timeout. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the loading process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Done, Command Aborted, Error, Error ID) are made available for one cycle. 292 Version: 1.8.3 TF5810
## Page 293

PLCopen Motion Control 4.5.11 MC_Ax Uti Read Reg Drive Term_Bk Plc Mc MC_Ax Uti Read Reg Drive Term_Bk Plc Mc Execute BOOL WORD Reg Data Select INT BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Done BOOL Command Aborted BOOL Error UDINT Error ID Available from version 3.0 The function block reads the contents of a register from the KL terminal, which is used as drive interface for the axis. Inputs VAR_INPUT Execute: BOOL; Select: INT; END_VAR Name Type Description Execute BOOL A rising edge at this input starts the read process. Select INT The register number should be transferred here. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Reg Data: WORD; Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Reg Data WORD The read value is output here. Busy BOOL Indicates that a command is being processed. Done BOOL Successful loading of the parameter is indicated here. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: TF5810 Version: 1.8.3 293
## Page 294

PLCopen Motion Control • If one of the pointers ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] is not initialized, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc. • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Select is out of the allowed range from 0 to 63, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Drive_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. If these checks could be performed without problem, the read operation is initiated. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the loading process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Reg Data, Done, Command Aborted, Error, Error ID, Done) are made available for one cycle. The drive types i Tc Mc_Drive KL2521, i Tc Mc_Drive KL4032, i Tc Mc_Drive KL2531 and i Tc Mc_Drive KL2541 support the parameter communication. 4.5.12 MC_Ax Uti Read Reg Enc Term_Bk Plc Mc MC_Ax Uti Read Reg Enc Term_Bk Plc Mc Execute BOOL WORD Reg Data Select INT BOOL Busy ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Done BOOL Command Aborted BOOL Error UDINT Error ID Available from version 3.0 The function block reads the contents of a register from the KL terminal, which is used as encoder interface for the axis. Inputs VAR_INPUT Execute: BOOL; Select: INT; END_VAR Name Type Description Execute BOOL A rising edge at this input starts the read process. Select INT The register number should be transferred here. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. 294 Version: 1.8.3 TF5810
## Page 295

PLCopen Motion Control Outputs VAR_OUTPUT Reg Data: WORD; Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Reg Data WORD The read value is output here. Busy BOOL Indicates that a command is being processed. Done BOOL Successful loading of the parameter is indicated here. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If one of the pointers ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] is not initialized, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc. • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Select is out of the allowed range from 0 to 63, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Encoder_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. If these checks could be performed without problem, the read operation is initiated. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the loading process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Reg Data, Done, Command Aborted, Error, Error ID, Done) are made available for one cycle. The drive types i Tc Mc_Encoder KL3002, i Tc Mc_Encoder KL3042, i Tc Mc_Encoder KL3062, i Tc Mc_Encoder KL3162, i Tc Mc_Encoder KL5101, i Tc Mc_Encoder KL5111, i Tc Mc_Encoder KL2521, i Tc Mc_Encoder KL2531 und i Tc Mc_Encoder KL2541 support parameter communication. 4.5.13 MC_Ax Uti Update Reg Drive Term_Bk Plc Mc MC_Ax Uti Update Reg Drive Term_Bk Plc Mc Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Busy ↔ Reg Data Reference To ST_Tc Plc Reg Data Table BOOL Command Aborted BOOL Error UDINT Error ID Available from version 3.0.7 The function block writes a parameter set into the registers of a KL terminal. It uses MC_Ax Uti Read Reg Drive Term_Bk Plc Mc [} 293] and MC_Ax Uti Write Reg Drive Term_Bk Plc Mc [} 302] function blocks for this purpose. TF5810 Version: 1.8.3 295
## Page 296

PLCopen Motion Control Inputs VAR_INPUT Execute: BOOL; END_VAR Name Type Description Execute BOOL The writing process is initiated by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; Reg Data: ST_Tc Plc Reg Data Table; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Reg Data ST_Tc Plc Reg Data Table Here, the address of parameter set should be specified, whose content is to be written into the terminal. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Indicates successful writing of the parameter. Busy BOOL Indicates that a command is being processed. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If one of the pointers ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] is not initialized, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc. • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Select is out of the allowed range from 0 to 63, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Drive_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. • The value in ST_Tc Plc Reg Data Table [} 157]. Reg Data Item[...]. Access determines how the element is treated. ◦ 0: Element is ignored. ◦ 1: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents differ, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. ◦ 2: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents are not larger, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. 296 Version: 1.8.3 TF5810
## Page 297

PLCopen Motion Control ◦ 3: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents are not smaller, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. ◦ 4: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents are not larger or equal, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. ◦ 5: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents are not smaller or equal, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. ◦ 10: The register addressed through Select is written with Reg Data. ◦ Other values are currently ignored. Future versions of the library may support additional functions. An empty element should therefore always be identified with 0. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the writing process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Done, Command Aborted, Error, Error ID, Done) are made available for one cycle. 4.5.14 MC_Ax Uti Update Reg Enc Term_Bk Plc Mc MC_Ax Uti Update Reg Enc Term_Bk Plc Mc Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Busy ↔ Reg Data Reference To ST_Tc Plc Reg Data Table BOOL Command Aborted BOOL Error UDINT Error ID Available from version 3.0 The function block writes a parameter set into the registers of a KL terminal. It uses MC_Ax Uti Read Reg Enc Term_Bk Plc Mc [} 294] and MC_Ax Uti Write Reg Enc Term_Bk Plc Mc [} 303] function blocks for this purpose. Inputs VAR_INPUT Execute: BOOL; END_VAR Name Type Description Execute BOOL The writing process is initiated by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; Reg Data: ST_Tc Plc Reg Data Table; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Reg Data ST_Tc Plc Reg Data Table Here, the address of parameter set should be specified, whose content is to be written into the terminal. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; TF5810 Version: 1.8.3 297
## Page 298

PLCopen Motion Control Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Indicates successful writing of the parameter. Busy BOOL Indicates that a command is being processed. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If one of the pointers ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] is not initialized, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc. • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Select is out of the allowed range from 0 to 63, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Drive_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. • The value in ST_Tc Plc Reg Data Table [} 157]. Reg Data Item[...]. Access determines how the element is treated. ◦ 0: Element is ignored. ◦ 1: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents differ, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. ◦ 2: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents are not larger, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. ◦ 3: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents are not smaller, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. ◦ 4: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents are not larger or equal, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. ◦ 5: The register addressed through Select is read. Its contents are compared with Reg Data. If the contents are not smaller or equal, the write operation is aborted with Error and Error ID:=16#FFFFFFFF. ◦ 10: The register addressed through Select is written with Reg Data. ◦ Other values are currently ignored. Future versions of the library may support additional functions. An empty element should therefore always be identified with 0. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the writing process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Done, Command Aborted, Error, Error ID, Done) are made available for one cycle. 298 Version: 1.8.3 TF5810
## Page 299

PLCopen Motion Control 4.5.15 MC_Ax Uti Write Coe Drive Term_Bk Plc Mc MC_Ax Uti Write Coe Drive Term_Bk Plc Mc Execute BOOL BOOL Busy Pdata Pointer To BYTE BOOL Done Byte Count BYTE BOOL Command Aborted Index WORD BOOL Error Subindex BYTE UDINT Error ID ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block writes the contents of a register of the EL terminal, which is used as drive interface for the axis. Inputs VAR_INPUT Execute: BOOL; Pdata: POINTER TO BYTE:=0; Byte Count: BYTE:=0; Index: WORD:=0; Subindex: BYTE:=0; END_VAR Name Type Description Execute BOOL The writing process is initiated by a rising edge at this input. Pdata POINTER The address of the variable whose content is to be written to the terminal must be specified here. Byte Count BYTE Here, the size of the variable is specified in bytes. Index WORD Here, the addressing of parameter in the terminal is specified. Subindex BYTE Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Indicates successful writing of the parameter. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. TF5810 Version: 1.8.3 299
## Page 300

PLCopen Motion Control Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Index or Subindex are out of range the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If Byte Count or Pdata are out of range the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Drive_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. • If problems occur during the ADS communication with the terminal, the corresponding ADS error code is returned as Error ID, and Error is indicated. The following codes [} 339] may occur: ◦ 16#0006 = 6 = The port number of the ADS address used is invalid: Check mapping of the Info Data element of the terminal! ◦ 16#0007 = 7 = The Ams Net ID of the ADS address used is invalid: Check mapping of the Info Data element of the terminal! ◦ 16#0702 = 1794 = dw Tc Hyd Ads Err Invalid Idx Group = The terminal does not support the Co E protocol. ◦ 16#0703 = 1795 = dw Tc Hyd Ads Err Invalid Idx Offset = The address in index and subindex is not supported in the terminal. ◦ 16#0745 = 1861 = dw Tc Hyd Ads Err Timeout = Timeout. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the writing process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Done, Command Aborted, Error, Error ID) are made available for one cycle. 4.5.16 MC_Ax Uti Write Coe Enc Term_Bk Plc Mc MC_Ax Uti Write Coe Enc Term_Bk Plc Mc Execute BOOL BOOL Busy Pdata Pointer To BYTE BOOL Done Byte Count BYTE BOOL Command Aborted Index WORD BOOL Error Subindex BYTE UDINT Error ID ↔ Axis Reference To AXIS_REF_Bk Plc Mc Available from version 3.0 The function block writes the contents of a register of the EL terminal, which is used as encoder interface for the axis. Inputs VAR_INPUT Execute: BOOL; Pdata: POINTER TO BYTE:=0; Byte Count: BYTE:=0; Index: WORD:=0; Subindex: BYTE:=0; END_VAR 300 Version: 1.8.3 TF5810
## Page 301

PLCopen Motion Control Name Type Description Execute BOOL The writing process is initiated by a rising edge at this input. Pdata POINTER The address of the variable whose content is to be written to the terminal must be specified here. Byte Count BYTE Here, the size of the variable is specified in bytes. Index WORD Here, the addressing of parameter in the terminal is specified. Subindex BYTE Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Indicates successful writing of the parameter. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Index or Subindex are out of range the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If Byte Count or Pdata are out of range the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Encoder_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. • If problems occur during the ADS communication with the terminal, the corresponding ADS error code is returned as Error ID, and Error is indicated. The following codes [} 339] may occur: ◦ 16#0006 = 6 = The port number of the ADS address used is invalid: Check mapping of the Info Data element of the terminal! ◦ 16#0007 = 7 = The Ams Net ID of the ADS address used is invalid: Check mapping of the Info Data element of the terminal! ◦ 16#0702 = 1794 = dw Tc Hyd Ads Err Invalid Idx Group = The terminal does not support the Co E protocol. ◦ 16#0703 = 1795 = dw Tc Hyd Ads Err Invalid Idx Offset = The address in index and subindex is not supported in the terminal. TF5810 Version: 1.8.3 301
## Page 302

PLCopen Motion Control ◦ 16#0745 = 1861 = dw Tc Hyd Ads Err Timeout = Timeout. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the writing process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Done, Command Aborted, Error, Error ID) are made available for one cycle. 4.5.17 MC_Ax Uti Write Reg Drive Term_Bk Plc Mc MC_Ax Uti Write Reg Drive Term_Bk Plc Mc Execute BOOL BOOL Busy Select INT BOOL Done Reg Data WORD BOOL Command Aborted ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID Available from version 3.0 The function block writes the contents of a register of the KL terminal, which is used as drive interface for the axis. Inputs VAR_INPUT Execute: BOOL; Select: INT; Reg Data: WORD; END_VAR Name Type Description Execute BOOL The writing process is initiated by a rising edge at this input. Select INT The register number should be transferred here. Reg Data WORD The value to be written should be transferred here. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Indicates successful writing of the parameter. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. 302 Version: 1.8.3 TF5810
## Page 303

PLCopen Motion Control Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If one of the pointers ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] is not initialized, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc. • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Select is out of the allowed range from 0 to 63, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Drive_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. The writing process begins if these checks are carried out without problems. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the writing process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Reg Data, Done, Command Aborted, Error, Error ID, Done) are made available for one cycle. The drive types i Tc Mc_Drive KL2521, i Tc Mc_Drive KL4032, i Tc Mc_Drive KL2531 and i Tc Mc_Drive KL2541 support the parameter communication. 4.5.18 MC_Ax Uti Write Reg Enc Term_Bk Plc Mc MC_Ax Uti Write Reg Enc Term_Bk Plc Mc Execute BOOL BOOL Busy Select INT BOOL Done Reg Data WORD BOOL Command Aborted ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID Available from version 3.0 The function block writes the contents of a register of the KL terminal, which is used as encoder interface for the axis. Inputs VAR_INPUT Execute: BOOL; Select: INT; Reg Data: WORD; END_VAR Name Type Description Execute BOOL The writing process is initiated by a rising edge at this input. Select INT The register number should be transferred here. Reg Data WORD The value to be written should be transferred here. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR TF5810 Version: 1.8.3 303
## Page 304

PLCopen Motion Control Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Busy: BOOL; Done: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Busy BOOL Indicates that a command is being processed. Done BOOL Indicates successful writing of the parameter. Command Aborted BOOL Indicates abortion of the read operation. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded indication of the cause of the error is provided here. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • If one of the pointers ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] is not initialized, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Ptr Plc Mc. • If the axis is enabled for operation, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Ready. • If Select is out of the allowed range from 0 to 63, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Tbl Illegal Index. • If an I/O module, which does not support parameter communication, is set as n Encoder_Type in the axis parameters, the system responds with Error and Error ID:=dw Tc Hyd Err Cd Not Compatible. The writing process begins if these checks are carried out without problems. A falling edge at Execute clears all the pending output signals. If Execute is set to FALSE while the writing process is still active, the process that had started continues unaffected. The signals provided at the end of the operation (Reg Data, Done, Command Aborted, Error, Error ID, Done) are made available for one cycle. The drive types i Tc Mc_Encoder KL3002, i Tc Mc_Encoder KL3042, i Tc Mc_Encoder KL3062, i Tc Mc_Encoder KL3162, i Tc Mc_Encoder KL5101, i Tc Mc_Encoder KL5111, i Tc Mc_Encoder KL2521, i Tc Mc_Encoder KL2531 und i Tc Mc_Encoder KL2541 support parameter communication. 304 Version: 1.8.3 TF5810
## Page 305

PLCopen Motion Control 4.6 Part 5 Homing 4.6.1 Finalizing Functions 4.6.1.1 MC_Abort Homing_Bk Plc Mc MC_Abort Homing_Bk Plc Mc Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Busy BOOL Active BOOL Command Aborted BOOL Error UDINT Error ID The function block is used to cancel a referencing process. Inputs VAR_INPUT Execute: BOOL; END_VAR Name Type Description Execute BOOL A rising edge at this input starts the abort. Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Active: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Successful processing is indicated here Busy BOOL Indicates that a command is being processed. Active BOOL Readiness for operation is indicated here. Command Aborted BOOL Here an abort of the command is indicated. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded error message is provided here. TF5810 Version: 1.8.3 305
## Page 306

PLCopen Motion Control Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface whether an active movement is executed. If the axis is not in an active movement, referencing is aborted directly. If the axis is in an active movement, this movement is stopped via a MC_Stop_Bk Plc Mc [} 82]. If the stop is successful, the function block reports Done. If an error occurs during the stop, this error is indicated via Error and Error Id. A falling edge at Execute clears all the pending output signals. If, while the movement is still active, Execute is set to FALSE, execution of the command that had started continues unaffected 4.6.1.2 MC_Finish Homing_Bk Plc Mc MC_Finish Homing_Bk Plc Mc Execute BOOL BOOL Done Distance LREAL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block is used to cancel a referencing process. Inputs VAR_INPUT Execute: BOOL; Distance: LREAL; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; END_VAR Name Type Description Execute BOOL A rising edge at this input starts the movement and terminates the referencing. Distance LREAL [mm] The distance to the target position of the movement in actual value units of the axis. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Jerk LREAL [mm/s3] The required jerk in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Buffer Mode MC_Buffer Mode_Bk Plc reserved Mc 306 Version: 1.8.3 TF5810
## Page 307

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis s Log AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Active: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Successful processing is indicated here Busy BOOL Indicates that a command is being processed. Active BOOL Readiness for operation is indicated here. Command Aborted BOOL Here an abort of the command is indicated. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded error message is provided here. Behavior of the function block On a rising edge at Execute the parameters Distance, Velocity, Acceleration and Deceleration are transferred to the MC_Move Relative_Bk Plc Mc [} 77] function block. After checking the transferred parameters, the movement is executed. If the motion algorithm reports an error code while the movement is being executed, the system responds with Error and Error ID:=the motion algorithm's error code. If completion of the movement is prevented by the activity of another function block, the system responds with Command Aborted. If the motion algorithm achieves the target conditions for the axis, the system responds with Done. A falling edge at Execute clears all the pending output signals. If, while the movement is still active, Execute is set to FALSE, execution of the movement that had started continues unaffected. The signals provided at the end of the movement (Error, Error ID, Command Aborted, Done) are made available for one cycle. The axis is in the state Mc State_Homing [} 103] during the movement, at the end the state changes to Mc State_Standstill [} 103]. TF5810 Version: 1.8.3 307
## Page 308

PLCopen Motion Control 4.6.2 Step Functions 4.6.2.1 MC_Step Absolute Switch_Bk Plc Mc MC_Step Absolute Switch_Bk Plc Mc Execute BOOL BOOL Done Direction MC_Direction_Bk Plc Mc BOOL Busy Switch Mode MC_Switch Mode_Bk Plc Mc BOOL Active Reference Signal MC_Ref_Signal_Ref_Bk Plc Mc BOOL Command Aborted Velocity LREAL BOOL Error Acceleration LREAL UDINT Error ID Deceleration LREAL Jerk LREAL Set Position LREAL Torque Limit LREAL Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block is used for referencing via a limit switch. The function block triggers a position setting internally after the cam is found. Inputs VAR_INPUT Execute: BOOL; Direction: MC_Direction_Bk Plc Mc; Switch Mode: MC_Switch Mode_Bk Plc Mc; Reference Signal: MC_Ref_Signal_Ref_Bk Plc Mc; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; Set Position: LREAL; Torque Limit: LREAL; Time Limit: TIME; Distance Limit: LREAL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; END_VAR 308 Version: 1.8.3 TF5810
## Page 309

PLCopen Motion Control Name Type Description Execute BOOL The homing is initiated by a rising edge at this input. Direction MC_Direction_Bk Plc Mc The direction is specified via MC_Direction_Bk Plc Mc [} 124]. Switch Mode MC_Switch Mode_Bk Plc M The type of signal detection is specified via c MC_Switch Mode_Bk Plc Mc [} 124]. Reference Signal MC_Ref_Signal_Ref_Bk P The signal state of the cam is communicated via lc Mc MC_Ref_Signal_Ref_Bk Plc Mc [} 165]. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Jerk LREAL [mm/s3] The required jerk in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Set Position LREAL Required position on the referencing cam. Torque Limit LREAL reserved Time Limit TIME After this time, the referencing is canceled with error. At zero, time monitoring is disabled. Distance Limit LREAL After this distance, the referencing will be aborted with an error. At zero, the distance monitoring is disabled. Buffer Mode MC_Buffer Mode_Bk Plc M reserved c Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Active: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Successful processing is indicated here Busy BOOL Indicates that a command is being processed. Active BOOL Readiness for operation is indicated here. Command Aborte BOOL Here an abort of the command is indicated. d Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded error message is provided here. TF5810 Version: 1.8.3 309
## Page 310

PLCopen Motion Control Behavior of the function block On a rising edge at Execute the parameters Direction, Switch Mode, Reference Signal, Velocity, Acceleration and Deceleration are transferred to the MC_Step Absolute Switch Detection_Bk Plc Mc [} 310] function block. If the internal function block MC_Step Absolute Switch Detection_Bk Plc Mc is successfully processed, the determined position is set accordingly via MC_Set Position_Bk Plc Mc [} 43]. During processing, the function block reports Busy and Active. After successful position setting, Done is reported back. If a subordinate function block reports an error, this is reported via Error and Error ID. 4.6.2.2 MC_Step Absolute Switch Detection_Bk Plc Mc MC_Step Absolute Switch Detection_Bk Plc Mc Execute BOOL BOOL Done Direction MC_Direction_Bk Plc Mc BOOL Busy Switch Mode MC_Switch Mode_Bk Plc Mc BOOL Active Reference Signal MC_Ref_Signal_Ref_Bk Plc Mc BOOL Command Aborted Velocity LREAL BOOL Error Acceleration LREAL UDINT Error ID Deceleration LREAL LREAL Recorded Position Jerk LREAL Set Position LREAL Torque Limit LREAL Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode_Bk Plc Mc Detection Velocity Limit LREAL Detection Velocity Time TIME ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block is used for referencing via a limit switch. The function block outputs the position of the cam to the outside via Recorded Position. No position is set. Inputs VAR_INPUT Execute: BOOL; Direction: MC_Direction_Bk Plc Mc; Switch Mode: MC_Switch Mode_Bk Plc Mc; Reference Signal: MC_Ref_Signal_Ref_Bk Plc Mc; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; Set Position: LREAL; Torque Limit: LREAL; Time Limit: TIME; Distance Limit: LREAL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; END_VAR 310 Version: 1.8.3 TF5810
## Page 311

PLCopen Motion Control Name Type Description Execute BOOL The homing is initiated by a rising edge at this input. Direction MC_Direction_Bk Plc The direction is specified via MC_Direction_Bk Plc Mc [} 124]. Mc Switch Mode MC_Switch Mode_B The type of signal detection is specified via k Plc Mc MC_Switch Mode_Bk Plc Mc [} 124]. Reference Signal MC_Ref_Signal_Ref The signal state of the cam is communicated via _Bk Plc Mc MC_Ref_Signal_Ref_Bk Plc Mc [} 165]. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Jerk LREAL [mm/s3] The required jerk in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Set Position LREAL Required position on the referencing cam. Torque Limit LREAL reserved Time Limit TIME After this time, the referencing is canceled with error. At zero, time monitoring is disabled. Distance Limit LREAL After this distance, the referencing will be aborted with an error. At zero, the distance monitoring is disabled. Buffer Mode MC_Buffer Mode_Bk Plc Mc Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Active: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; Recorded Position: LREAL; END_VAR Name Type Description Done BOOL Successful processing is indicated here Busy BOOL Indicates that a command is being processed. Active BOOL Readiness for operation is indicated here. Command Aborted BOOL Here an abort of the command is indicated. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded error message is provided here. Recorded Position LREAL [mm] Determined position of the referencing cam. TF5810 Version: 1.8.3 311
## Page 312

PLCopen Motion Control Behavior of the function block On a rising edge at Execute only MC_Positive_Direction_Bk Plc Mc, MC_Negative_Direction_Bk Plc Mc, MC_Switch Positive_Direction_Bk Plc Mc, MC_Switch Negative_Direction_Bk Plc Mc are accepted at the parameter Direction. The parameters Velocity, Acceleration, Deceleration and Jerk are transferred to MC_Move Velocity_Bk Plc Mc [} 79]. After the cam has been detected, the position is communicated via Recorded Position and a MC_Halt_Bk Plc Mc [} 71] aborts the movement. During processing, the function block reports Busy and Active. After successful processing Done is reported back. If a subordinate function block reports an error, this is reported via Error and Error ID. 4.6.2.3 MC_Step Block_Bk Plc Mc MC_Step Block_Bk Plc Mc Execute BOOL BOOL Done Direction MC_Direction_Bk Plc Mc BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Set Position LREAL Detection Velocity Limit LREAL Detection Velocity Time TIME Torque Limit LREAL Torque Tolerance LREAL Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block is used for referencing via a fixed stop. The function block triggers a position setting internally after the cam is found. Inputs VAR_INPUT Execute: BOOL; Direction: MC_Direction_Bk Plc Mc; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; Set Position: LREAL; Detection Velocity Limit: LREAL; Detection Velocity Time: LREAL; Torque Limit: LREAL; Torque Tolerance: LREAL; Time Limit: TIME; Distance Limit: LREAL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; END_VAR 312 Version: 1.8.3 TF5810
## Page 313

PLCopen Motion Control Name Type Description Execute BOOL The homing is initiated by a rising edge at this input. Direction MC_Direction_Bk The direction is specified via MC_Direction_Bk Plc Mc Plc Mc [} 124]. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Jerk LREAL [mm/s3] The required jerk in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Set Position LREAL Required position on the referencing cam. Detection Velocity Limit LREAL [mm/s] Velocity limit to reliably detect a stop Detection Velocity Time LREAL [s] Time in which the actual velocity must be below the Detection Velocity Limit in order to reliably detect the fixed stop. Torque Limit LREAL [Bar] Limitation for the pressure Torque Tolerance LREAL [Bar] Tolerance for the pressure Time Limit TIME After this time, the referencing is canceled with error. At zero, time monitoring is disabled. Distance Limit LREAL After this distance, the referencing will be aborted with an error. At zero, the distance monitoring is disabled. Buffer Mode MC_Buffer Mode_ reserved Bk Plc Mc Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Active: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Successful processing is indicated here Busy BOOL Indicates that a command is being processed. Active BOOL Readiness for operation is indicated here. Command Aborted BOOL Here an abort of the command is indicated. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded error message is provided here. TF5810 Version: 1.8.3 313
## Page 314

PLCopen Motion Control Behavior of the function block On a rising edge at Execute all parameters are transferred to the function block MC_Step Block Detection_Bk Plc Mc [} 314]. If the internal function block MC_Step Block Detection_Bk Plc Mc is successfully processed, the determined position is set accordingly via MC_Set Position_Bk Plc Mc [} 43]. During processing, the function block reports Busy and Active. After successful position setting, Done is reported back. If a subordinate function block reports an error, this is reported via Error and Error ID. 4.6.2.4 MC_Step Block Detection_Bk Plc Mc MC_Step Block Detection_Bk Plc Mc Execute BOOL BOOL Done Direction MC_Direction_Bk Plc Mc BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Detection Velocity Limit LREAL LREAL Recorded Position Detection Velocity Time TIME Torque Limit LREAL Torque Tolerance LREAL Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block is used for referencing via a limit switch. The function block outputs the position of the cam to the outside via Recorded Position. No position is set. Inputs VAR_INPUT Execute: BOOL; Direction: MC_Direction_Bk Plc Mc; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; Set Position: LREAL; Detection Velocity Limit: LREAL; Detection Velocity Time: LREAL; Torque Limit: LREAL; Torque Tolerance: LREAL; Time Limit: TIME; Distance Limit: LREAL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; END_VAR 314 Version: 1.8.3 TF5810
## Page 315

PLCopen Motion Control Name Type Description Execute BOOL The homing is initiated by a rising edge at this input. Direction MC_Direction_Bk Pl A direction preset coded according to c Mc MC_Direction_Bk Plc Mc [} 124]. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Jerk LREAL [mm/s3] The required jerk in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Set Position LREAL Required position on the referencing cam. Detection Velocity Limit LREAL [mm/s] Velocity limit to reliably detect a stop Detection Velocity Time LREAL [s] Time in which the actual velocity must be below the Detection Velocity Limit in order to reliably detect the fixed stop. Torque Limit LREAL [Bar] Limitation for the pressure Torque Tolerance LREAL [Bar] Tolerance for the pressure Time Limit TIME After this time, the referencing is canceled with error. At zero, time monitoring is disabled. Distance Limit LREAL After this distance, the referencing will be aborted with an error. At zero, the distance monitoring is disabled. Buffer Mode MC_Buffer Mode_B k Plc Mc Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Active: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; Recorded Position: LREAL; END_VAR TF5810 Version: 1.8.3 315
## Page 316

PLCopen Motion Control Name Type Description Done BOOL Successful processing is indicated here Busy BOOL Indicates that a command is being processed. Active BOOL Readiness for operation is indicated here. Command Aborted BOOL Here an abort of the command is indicated. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded error message is provided here. Recorded Position LREAL [mm] Determined position of the referencing cam. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. A number of problems can be detected and reported during this process: • At Direction, MC_Positive_Direction_Bk Plc Mc, MC_Negative_Direction_Bk Plc Mc, is accepted • The Distance Limit must have a value greater than the increment resolution. The parameters Velocity, Acceleration, Deceleration and Jerk are transferred to MC_Move Velocity_Bk Plc Mc [} 79]. After the cam has been detected, the position is communicated via Recorded Position and a MC_Halt_Bk Plc Mc [} 71] stops the movement. A hard stop is detected when the actual velocity for the time Detection Velocity Time is below Detection Velocity Limit or the current pressure is greater than Torque Limit minus Torque Tolerance. If no fixed stop is detected within Distance Limit or Time Limit, referencing is aborted with an error. During processing, the function block reports Busy and Active. After successful processing Done is reported back. If a subordinate function block reports an error, this is reported via Error and Error ID. 4.6.2.5 MC_Step Reference Pulse_Bk Plc Mc MC_Step Reference Pulse_Bk Plc Mc Execute BOOL BOOL Done Direction MC_Direction_Bk Plc Mc BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Set Position LREAL Torque Limit LREAL Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block is used to reference an incremental position measuring system. An actual value setting is carried out internally via the referencing pulse. Inputs VAR_INPUT Execute: BOOL; Direction: MC_Direction_Bk Plc Mc; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; Set Position: LREAL; Torque Limit: LREAL; Time Limit: TIME; Distance Limit: LREAL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; END_VAR 316 Version: 1.8.3 TF5810
## Page 317

PLCopen Motion Control Name Type Description Execute BOOL The homing is initiated by a rising edge at this input. Direction MC_Direction_Bk Plc Mc The direction is specified via MC_Direction_Bk Plc Mc. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Jerk LREAL [mm/s3] The required jerk in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Set Position LREAL Required position on the referencing cam. Torque Limit LREAL Reserved Time Limit TIME After this time, the referencing is canceled with error. At zero, time monitoring is disabled. Distance Limit LREAL After this distance, the referencing will be aborted with an error. At zero, the distance monitoring is disabled. Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Active: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; END_VAR Name Type Description Done BOOL Successful processing is indicated here Busy BOOL Indicates that a command is being processed. Active BOOL Readiness for operation is indicated here. Command Aborted BOOL Here an abort of the command is indicated. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded error message is provided here. Behavior of the function block On a rising edge at Execute the parameters Direction, Velocity, Acceleration and Deceleration are transferred to the MC_Step Reference Pulse Detection_Bk Plc Mc [} 318] function block. If the internal function block MC_Step Reference Pulse Detection_Bk Plc Mc is processed successfully, the determined position is set accordingly via MC_Set Position_Bk Plc Mc [} 43]. TF5810 Version: 1.8.3 317
## Page 318

PLCopen Motion Control During processing, the function block reports Busy and Active. After successful position setting, Done is reported back. If a subordinate function block reports an error, this is reported via Error and Error ID. 4.6.2.6 MC_Step Reference Pulse Detection_Bk Plc Mc MC_Step Reference Pulse Detection_Bk Plc Mc Execute BOOL BOOL Done Direction MC_Direction_Bk Plc Mc BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Torque Limit LREAL LREAL Recorded Position Time Limit TIME Distance Limit LREAL Buffer Mode MC_Buffer Mode_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc The function block is used to reference an incremental position measuring system. The function block outputs the position of the reference pulse to the outside via Recorded Position. No position is set. Inputs VAR_INPUT Execute: BOOL; Direction: MC_Direction_Bk Plc Mc; Velocity: LREAL; Acceleration: LREAL; Deceleration: LREAL; Jerk: LREAL; Set Position: LREAL; Torque Limit: LREAL; Time Limit: TIME; Distance Limit: LREAL; Buffer Mode: MC_Buffer Mode_Bk Plc Mc:=Aborting_Bk Plc Mc; END_VAR Name Type Description Execute BOOL The homing is initiated by a rising edge at this input. Direction MC_Direction_Bk Plc Mc The direction is specified via MC_Direction_Bk Plc Mc [} 124]. Velocity LREAL [mm/s] The required motion velocity in actual value units of the axis per second. Acceleration LREAL [mm/s2] The required acceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Deceleration LREAL [mm/s2] The required deceleration in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Jerk LREAL [mm/s3] The required jerk in actual value units of the axis per square second. If this parameter is 0.0, it is replaced by a default value from the axis parameters. Set Position LREAL Required position on the referencing cam. Torque Limit LREAL Reserved Time Limit TIME After this time, the referencing is canceled with error. At zero, time monitoring is disabled. Distance Limit LREAL After this distance, the referencing will be aborted with an error. At zero, the distance monitoring is disabled. Buffer Mode MC_Buffer Mode_Bk Plc Mc Reserved 318 Version: 1.8.3 TF5810
## Page 319

PLCopen Motion Control Inputs/outputs VAR_IN_OUT Axis: AXIS_REF_Bk Plc Mc; END_VAR Name Type Description Axis AXIS_REF_Bk Plc Mc Here, the address of a variable of type AXIS_REF_Bk Plc Mc [} 86] should be transferred. Outputs VAR_OUTPUT Done: BOOL; Busy: BOOL; Active: BOOL; Command Aborted: BOOL; Error: BOOL; Error ID: UDINT; Recorded Position: LREAL; END_VAR Name Type Description Done BOOL Successful processing is indicated here Busy BOOL Indicates that a command is being processed. Active BOOL Readiness for operation is indicated here. Command Aborted BOOL Here an abort of the command is indicated. Error BOOL The occurrence of an error is indicated here. Error ID UDINT An encoded error message is provided here. Recorded Position LREAL [mm] Determined position at the reference pulse. Behavior of the function block On a rising edge at Execute the function block checks the transferred axis interface. During this process, problems may be detected and reported: • At Direction, MC_Positive_Direction_Bk Plc Mc, MC_Negative_Direction_Bk Plc Mc, is accepted The parameters Velocity, Acceleration, Deceleration and Jerk are transferred to MC_Move Velocity_Bk Plc Mc [} 79]. After the cam has been detected, the position is communicated via Recorded Position and a MC_Halt_Bk Plc Mc [} 71] stops the movement. If no reference pulse is detected within Distance Limit or Time Limit the referencing is aborted with an error During processing, the function block reports Busy and Active. After successful position setting, Done is reported back. If a subordinate function block reports an error, this is reported via Error and Error ID. TF5810 Version: 1.8.3 319
## Page 320

Knowledge Base 5 Knowledge Base Knowledge Base of the Tc Plc Hydraulics PLC library Available from version 3.0 Here you will find a number of answers to recurring questions. Topics Name Description Global Constants [} 338] Pre-defined error codes, masks for bit queries, ADS codes etc. Commissioning [} 380] Commissioning information Sample List [} 374] Program examples Ideas Bank [} 321] Tips and tricks HMI tool [} 370] The Plc Mc Manager Problems during library updates Compilation problems may occur when the library is updated. The reason may be a change of name of one or several function blocks or data types. Such changes are not always avoidable and generally implemented for one of the following reasons: • Adaptation to the rules of the PLC Open Motion Control definitions. • Further development of the PLC Open Motion Control definitions. • Further development the technology provided. • Adaptation to the technology used, particularly support of further I/O devices. • Avoidance of name collisions and other compatibility problems with other libraries. From V3.0 build 22, the library uses Tc Ether CAT. LIB for communication via the Ether CAT fieldbus. In older Twin CAT environments this library is not yet available. If the Tc Plc Hydraulics library is to be used in such an environment, the Tc Ether Cat Dummy. LIB provided should be copied into the project directory and renamed to Tc Ether CAT. LIB. This library should then be added to the project BEFORE Tc Plc Hydraulics. LIB. This procedure must not be used in Twin CAT environments that support Ether CAT. The file provided must NOT be used to replace an existing operational Tc Ether CAT. LIB. There are no functions that require Ether CAT technologies. The library version used in a project should be copied into the project directory and backed up together with the project. This avoids inadvertent version changes, which could otherwise occur if Twin CAT is updated in the meantime. To update the library, copy the new version directly into the project directory. We strongly recommend carrying out a trial compilation of the whole project after a library update. In addition, the mapping should be updated with the System Manager. If the table shown below indicates a change in size in one of the structures, it is essential to check the address assignment. If the library is updated to a version that differs not only in the third (build) number, but also in the major and minor version number, it can be assumed that the mappings created by the System Manager are no longer correct. In this case it is imperative to refresh the links. 320 Version: 1.8.3 TF5810
## Page 321

Knowledge Base Old name New name Reason of for the change ST_Tc Mc Ax Interface Axis_Ref_Bk Plc Mc Adaptation to PLC Open Motion Control definitions. ST_Tc Plc Mc Cam Id MC_CAM_ID_Bk Plc Mc Adaptation to PLC Open Motion Control definitions. ST_Tc Plc Mc Cam Ref MC_CAM_REF_Bk Plc Mc Adaptation to PLC Open Motion Control definitions. E_Tc MCDirection MC_Direction_Bk Plc Mc Adaptation to PLC Open Motion Control definitions. E_Tc MCStart Mode MC_Start Mode_Bk Plc Mc Adaptation to PLC Open Motion Control definitions. ST_Tc Plc Mc Encoder In --- Omitted; task is handled by ST_Tc Plc Device Input ST_Tc Plc Mc Encoder Out --- Omitted; task is handled by ST_Tc Plc Device Output ST_Tc Plc Mc Drive In --- Omitted; task is handled by ST_Tc Plc Device Input ST_Tc Plc Mc Drive Out --- Omitted; task is handled by ST_Tc Plc Device Output ST_Tc Plc Mc Ax2000In --- Omitted; task is handled by ST_Tc Plc Device Input ST_Tc Plc Mc Ax2000Out --- Omitted; task is handled by ST_Tc Plc Device Output MC_Ax Uti Cancel Monitoring_Bk Plc --- Omitted; redundant due to PLC Mc Open definitions Size of the I/O structures in bytes Name V 2.1. X from V3.0.0 from V3.1.0 (proposed) ST_Tc Plc Mc Encoder In 16 - - ST_Tc Plc Mc Encoder Out 1 - - ST_Tc Plc Mc Drive In 23 - - ST_Tc Plc Mc Drive Out 40 - - ST_Tc Plc Mc Ax2000In 37 - - ST_Tc Plc Mc Ax2000Out 26 - - ST_Tc Plc Device Input - 143 ? [} 149] ST_Tc Plc Device Output - 103 ? [} 153] 5.1 FAQs Available from version 3.0 Here you will find answers to frequently asked questions. TF5810 Version: 1.8.3 321
## Page 322

Knowledge Base Name Description FAQ #1 [} 322] How do I integrate one or more axes into a PLC application? FAQ #2 [} 323] What data has to be created in the PLC application for the axes? FAQ #3 [} 323] How do I initialize the data and load the parameters for an axis when the PLC starts? FAQ #4 [} 324] How is the actual position of the axes determined? FAQ #5 [} 327] How is the control value for an axis created? FAQ #6 [} 327] How is the control value for an axis prepared for output? FAQ #7 [} 327] How is the control value output to an axis? FAQ #8 [} 329] In what order should the function blocks of an axis be called? FAQ #9 [} 329] How do I control a valve output stage (on-board or externally)? FAQ #10 [} 329] How do I create a message buffer? FAQ #11 [} 330] How do I abort monitoring of a function? FAQ #12 [} 331] How do I monitor the communication with an I/O device? FAQ #13 [} 331] How do I assign my own labels to customer-specific axis parameters? FAQ #14 [} 331] How do I control a current valve? FAQ #15 [} 331] Which axis variables should be logged with the Scope? FAQ #16 [} 332] What is the purpose of the variable n Debug Tag in Axis_Ref_Bk Plc Mc? FAQ #17 [} 332] What has to be taken into account when Sercos drives are used? FAQ #18 [} 333] How is a pressure or a force determined? FAQ #19 [} 333] What has to be taken into account when AX5000 drives are used? FAQ #20 [} 334] How do I prepare an axis for blending based on PLC Open? FAQ #21 [} 336] How can I access registers of a terminal, to which an encoder or a valve of an axis is connected? FAQ #22 [} 336] What is the structure of an ASCII file for a linearization table? FAQ #23 [} 337] How can Plc Mc Manager commands be blocked? FAQ #24 [} 338] What format do import/export files with characteristic curve data have? Commissioning How is operation of the axis begun, and how is it optimized? [} 380] FAQ #1 How do I integrate one or more axes into a PLC application? The procedure here differs fundamentally from an axis guided by the NC task, because in this case everything done by the NC task is performed by the PLC. Ready-made function blocks are, however, available in most areas, so that the additional programming effort is held within reasonable limits. The following particular points must be considered: • Axis data in the PLC application (FAQ #2 [} 323]) • Initializing and loading the axis parameters when starting the PLC application (FAQ #3 [} 323]) • Acquisition of actual values (FAQ #4 [} 324]) • Generating control values (FAQ #5 [} 327]) • Processing control values in preparation for output (FAQ #6 [} 327]) • Setting up the axes (Commissioning [} 380]) • Commissioning of actual pressure determination with function blocks of type MC_Ax Rt Read Pressure Single_Bk Plc Mc [} 222] or MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220]. • Organization of the procedure for movement (FAQ #7 [} 327]) 322 Version: 1.8.3 TF5810
## Page 323

Knowledge Base If only the usual blocks (encoder, generator, finish, drive) for the axis are to be called, a block of type MC_Ax Standard Body_Bk Plc Mc should be used for simplicity. FAQ #2 What data has to be created in the PLC application for the axes? For each axis, one variables of each type Axis_Ref_Bk Plc Mc [} 86], ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] has to be created. The use of variable fields is highly recommended for multiple axes. Examples for one and five axes can be found in the first sample programs. The procedure using MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function blocks shown in these examples ensures correct initialization on start-up of the PLC and initiates loading of the axis parameters from files. Further data are required for realizing message logging. See also FAQ #10 [} 329]. Further data are required for assigning one's own IDs to customer-specific axis parameters in the Plc Mc Manager. See also FAQ #13 [} 331] Further data are required in order to utilize blending according to PLC Open. See also FAQ #20 [} 334]. FAQ #3 How do I initialize the data for an axis? A number of initializations must be carried out when the PLC applications starts. This is best done in three stages, which are provided by an MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block and should only be realized directly by the application in special cases. They are described here only for the sake of completeness. 1. A number of pointers must be correctly set up to link the components of the axes together. This task should be solved with a function block of type MC_Ax Uti Standard Init_Bk Plc Mc [} 254], which detects a shift or change in size in the memory or the change of a type code during a subsequent online change and then ensures that the pointers are reinitialised and the parameters are reloaded. 2. The parameters for the axis must be appropriately set. Although it would be technically possible for the application to do have these assignments hard-coded, this is not usually helpful. It is preferable to save the settings in files, which are loaded on system startup under control of the application through the MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block. Notes on setting up an axis can be found under Commissioning [} 380]. 3. The task cycle time should be applied in the axis parameters. This should be done at the end of the parameter loading procedure, in order to set this value correctly, in view of the fact that it is important for the function of many function blocks. An MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block deals with this task automatically. If a function block of type MC_Ax Ads Comm Server_Bk Plc Mc is used in the application, the function block must be called in the same task that carries out the pointer assignments. If this is not possible, or for some reason difficult, then calling the function block must be prevented while the assignments are being carried out. The result, otherwise, can be that the PLC application crashes as a result of serious runtime errors (Page Fault Exception). All activities listed here should through be realized and coordinated by an MC_Ax Uti Standard Init_Bk Plc Mc function block. If the n Init State variable in Axis_Ref_Bk Plc Mc of the axis adopts either the value 2 or -2, then the initialization has been successful or has ended with an error. If the initialization is successful, MC_Ax Uti Standard Init_Bk Plc Mc. Ready and b Params Enable in Axis_Ref_Bk Plc Mc are TRUE, otherwise this variable remains FALSE. The sample programs provided specify the name of the axis and the name (included the path) of the corresponding parameter file. It is essential that these specifications are modified to match the particular application. TF5810 Version: 1.8.3 323
## Page 324

Knowledge Base FAQ #4: How is the actual position of the axes determined? A range of signal transducers may be considered for use as position sensors, operating according to a variety of physical principles to generate a position-dependent electrical magnitude. This magnitude determines the type of I/O components that must be used. The variables of types ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] must be created for each axis, and contain elements that are to be linked to the actual value, counter, latch, control and status variables associated with the I/O hardware. Here are a few examples: 324 Version: 1.8.3 TF5810
## Page 325

Knowledge Base I/O component Signal Encoder Type AX2000 B110 with absolute Ether CAT i Tc Mc_Encoder Ax2000_B110A encoder [} 199] AX2000 B110 with resolver Ether CAT i Tc Mc_Encoder Ax2000_B110R [} 188] AX2000 B200 with resolver Ether CAT i Tc Mc_Encoder Ax2000_B200R [} 189] AX2000 B750 with absolute Ether CAT i Tc Mc_Encoder Ax2000_B750A encoder [} 202] AX2000 B900 with resolver Ether CAT i Tc Mc_Encoder Ax2000_B900R [} 189] AX5000 B110 with multi-turn Ether CAT i Tc Mc_Encoder AX5000_B110A absolute encoder [} 202] Ether CAT servo controllers with Ether CAT i Tc Mc_Encoder Co E_DS402A [} 204] Co E DS402 support and multi-turn encoder Ether CAT servo controllers with Ether CAT i Tc Mc_Encoder Co E_DS402SR Co E DS402 support and resolver [} 205] or single-turn encoder EL3102 -10V .. 10V i Tc Mc_Encoder EL3102 [} 208] EL3142 0m A .. 20m A i Tc Mc_Encoder EL3142 [} 208] EL3162 0 .. 10V i Tc Mc_Encoder EL3162 [} 208] EL3255 Potentiometric displacement i Tc Mc_Encoder EL3162 [} 208] transducer EL5001 SSI i Tc Mc_Encoder EL5001 [} 208] EL5101 A/B increments, RS422="TTL" i Tc Mc_Encoder EL5101 [} 210] EL7041 A/B increments, RS422="TTL" i Tc Mc_Encoder EL7041 [} 210] Ether CAT encoder with Ether CAT i Tc Mc_Encoder Co E_DS406 [} 206] Co E_DS406 profile IE5009 SSI i Tc Mc_Encoder Ix5009 [} 211] IP5009 SSI i Tc Mc_Encoder Ix5009 [} 211] KL10xx 2 bit, A/B increments i Tc Mc_Encoder Dig Increment [} 208] KL11xx 2 bit, A/B increments i Tc Mc_Encoder Dig Increment [} 208] KL12xx 2 bit, A/B increments i Tc Mc_Encoder Dig Increment [} 208] KL13xx 2 bit, A/B increments i Tc Mc_Encoder Dig Increment [} 208] KL14xx 2 bit, A/B increments i Tc Mc_Encoder Dig Increment [} 208] KL17xx 2 bit, A/B increments i Tc Mc_Encoder Dig Increment [} 208] KL10xx 4 bit, position cams i Tc Mc_Encoder Dig Cam [} 207] KL11xx 4 bit, position cams i Tc Mc_Encoder Dig Cam [} 207] KL12xx 4 bit, position cams i Tc Mc_Encoder Dig Cam [} 207] KL13xx 4 bit, position cams i Tc Mc_Encoder Dig Cam [} 207] KL14xx 4 bit, position cams i Tc Mc_Encoder Dig Cam [} 207] KL17xx 4 bit, position cams i Tc Mc_Encoder Dig Cam [} 207] TF5810 Version: 1.8.3 325
## Page 326

Knowledge Base I/O component Signal Encoder Type KL2521 Pulse Train i Tc Mc_Encoder KL2521 [} 211] KL2531 Stepper motor, direct (encoder i Tc Mc_Encoder KL2531 [} 211] emulated through pulse counter) KL2541 Stepper motor, direct (with encoder i Tc Mc_Encoder KL2541 [} 212] or encoder emulates through pulse counter) KL2542 DC motor, direct with encoder i Tc Mc_Encoder KL2542 [} 212] KL3001 -10V .. 10V i Tc Mc_Encoder KL3002 [} 213] KL3002 -10V .. 10V i Tc Mc_Encoder KL3002 [} 213] KL3011 0m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3012 0m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3021 4m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3022 4m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3041 0m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3042 0m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3044 0m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3051 4m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3052 4m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3054 4m A .. 20m A i Tc Mc_Encoder KL3042 [} 213] KL3061 0V .. 10V i Tc Mc_Encoder KL3062 [} 213] KL3062 0V .. 10V i Tc Mc_Encoder KL3062 [} 213] KL3064 0V .. 10V i Tc Mc_Encoder KL3062 [} 213] KL3162 0V .. 10V i Tc Mc_Encoder KL3162 [} 213] KL5001 SSI i Tc Mc_Encoder KL5001 [} 213] KL5101 A/B increments, RS422="TTL" i Tc Mc_Encoder KL5101 [} 214] KL5111 A/B increments, RS422="HTL" i Tc Mc_Encoder KL5111 [} 214] M2510 -10V .. 10V i Tc Mc_Encoder M2510 [} 215] M3100 A/B increments, RS422="TTL" i Tc Mc_Encoder M3120 [} 215] M3120 A/B increments, RS422="TTL" i Tc Mc_Encoder M3120 [} 215] If one of the components mentioned here is used, then one of the encoder function blocks provided will usually be applied. The interfaces of these function blocks are not guaranteed and should therefore not be called directly by the application. It is better to set the encoder type according to the constants in E_Tc Mc Encoder Type [} 98] under n Enc_Type in ST_Tc Hyd Ax Param [} 130], and to use a function block of type MC_Ax Rt Encoder_Bk Plc Mc [} 198]. This then automatically calls the correct type of sub-function-block for the type concerned. All encoder function blocks use the parameters f Enc_Inc Weighting and f Enc_Inc Interpolation as increment assessment. f Enc_Zero Shift is also used as a zero shift for absolute displacement sensors. Incremental sensors usually require a reference travel using a MC_Home_Bk Plc Mc [} 68] function block, during which f Enc_Ref Shift in ST_Tc Hyd Ax Rt Data [} 141] is determined. This value then does the job of the zero shift. It goes without saying that in special cases the zero shift can also be defined with an MC_Set Position_Bk Plc Mc [} 43] function block. The referenced status of the axis should be defined with MC_Set Reference Flag_Bk Plc Mc [} 45](). If it is not possible to determine the actual position with function blocks from the library for technical reasons, this task can be handled by application function blocks, and the result can be entered in f Act Pos, and f Act Velo can be entered in ST_Tc Hyd Ax Rt Data [} 141], if required. For the sake of uniformity use should again be made here of the f Enc_Inc Weighting, f Enc_Inc Interpolation and f Enc_Zero Shift or f Enc_Ref Shift parameters. 326 Version: 1.8.3 TF5810
## Page 327

Knowledge Base If only the usual function blocks (encoder, generator, finish, drive) for the axis are to be called, a function block of type MC_Ax Standard Body_Bk Plc Mc should be used for simplicity. Commissioning of an actual pressure determination with function blocks of type MC_Ax Rt Read Pressure Single_Bk Plc Mc or MC_Ax Rt Read Pressure Diff_Bk Plc Mc is described in the documentation for the function block. FAQ #5: How is the control value for an axis created? In each cycle, the PLC application must call a function block of type MC_Ax Runtime_Bk Plc Mc [} 237], or alternatively a suitable controller function block (e.g. a pressure regulator) for each axis. The parameter n Profile Type in ST_Tc Hyd Ax Param [} 130] specifies the procedure that is to be used to generate the control value. Velocity control values are calculated here according to the type, and depending on other parameters associated with the axis and on the movement data. These control values are, however, normalized to the abstract numerical range ±1.0, and have not yet been prepared for immediate output to I/O hardware. If only the usual function blocks (encoder, generator, finish, drive) for the axis are to be called, a function block of type MC_Ax Standard Body_Bk Plc Mc [} 253]should be used for simplicity. FAQ #6: How is the control value for an axis prepared for output? After calling the MC_Ax Runtime_Bk Plc Mc [} 237] function block, a function block of type MC_Ax Rt Finish_Bk Plc Mc [} 246] must be called for each axis. This function block assembles a number of velocity components (control value, controller output, offset compensation, overlap compensation), and also takes into account in the bends in the feed forward characteristic curve. Numerical adjustment is usually necessary prior to output to an I/O module. An MC_Ax Rt Drive_Bk Plc Mc [} 187] function block is to be called for each axis for this purpose. The value of n Drive_Type in ST_Tc Hyd Ax Param [} 130] selects the hardware-specific sub-function-block to be used. The variables of types ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] must be created for each axis, and contain elements that are to be linked to the set value and control variables of the I/O hardware. If only the usual function blocks (encoder, generator, finish, drive) for the axis are to be called, a function block of type MC_Ax Standard Body_Bk Plc Mc [} 253] should be used for simplicity. FAQ #7: How is the control value output to an axis? A range of devices and equipment might be functioning as actuators, applying a variety of physical principles to create a variable velocity that depends on an electrical magnitude. This magnitude determines the type of I/O components that must be used. The variables of types ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] must be created for each axis, and contain elements that are to be linked to the variables of the I/O hardware. Here are a few examples: TF5810 Version: 1.8.3 327
## Page 328

Knowledge Base I/O component Signal Drive Type AX2000 B110 with absolute Ether CAT i Tc Mc_Drive AX2000_B110A [} 188] encoder AX2000 B110 with resolver Ether CAT i Tc Mc_Drive AX2000_B110R [} 188] AX2000 B200 with resolver Ether CAT i Tc Mc_Drive AX2000_B200R [} 189] AX2000 B750 with absolute Ether CAT i Tc Mc_Drive Ax2000_B750A [} 189] encoder AX2000 B900 with resolver Ether CAT i Tc Mc_Drive AX2000_B900R [} 189] AX5000 B110 with absolute Ether CAT i Tc Mc_Drive AX5000_B110A [} 189] encoder Ether CAT servo controllers with Ether CAT i Tc Mc_Drive Co E_DS402 [} 189] Co E DS402 support and resolver, single-turn or multi-turn encoder Ether CAT valve with Co E_DS408 Ether CAT i Tc Mc_Drive_Co E_DS408 [} 190] profile EL2535 PWM i Tc Mc_Drive EL2535 EL4031, EL4032, EL4034, EL4038 -10 V .. 10 V i Tc Mc_Drive EL4132 [} 191] EL4131, EL4132, EL4134 EL4011, EL4012, EL4014, EL4018, 0..20 m A i Tc Mc_Drive EL4x22 EL4112 EL4021, EL4022, EL4024, EL4028, 4..20 m A EL4122, EL4124 EL7031 Stepper motor, direct i Tc Mc_Drive EL7031 [} 192] EL7041 Stepper motor, direct i Tc Mc_Drive EL7041 [} 193] IE2512 PWM i Tc Mc_Drive Ix2512_1Coil [} 190] i Tc Mc_Drive Ix2512_2Coil [} 190] IP2512 PWM i Tc Mc_Drive Ix2512_1Coil [} 190] i Tc Mc_Drive Ix2512_2Coil [} 190] KL20xx, KL21xx, KL22xx, KL24xx 5 bit for operating a frequency i Tc Mc_Drive Low Cost Inverter [} 197] converter with fixed frequencies KL20xx, KL21xx, KL22xx, KL24xx 4 bit for operating a voltage- i Tc Mc_Drive Low Cost Stepper controlled stepper motor [} 197] KL2521 Pulse Train i Tc Mc_Drive KL2521 [} 194] KL2531 Stepper motor, direct i Tc Mc_Drive KL2531 [} 194] KL2532 DC motor, direct with encoder i Tc Mc_Drive KL2532 [} 195] KL2535 PWM i Tc Mc_Drive KL2535_1Coil [} 195] i Tc Mc_Drive KL2535_2Coil [} 195] KL2541 Stepper motor, direct i Tc Mc_Drive KL2541 [} 195] KL2542 DC motor, direct with encoder i Tc Mc_Drive KL2542 [} 196] KL4031 -10 V .. 10 V i Tc Mc_Drive KL4032 [} 196] KL4032 -10 V .. 10 V i Tc Mc_Drive KL4032 [} 196] KL4034 -10 V .. 10 V i Tc Mc_Drive KL4032 [} 196] M2400 -10 V .. 10 V i Tc Mc_Drive M2400_D1 [} 198], i Tc Mc_Drive M2400_D2, i Tc Mc_Drive M2400_D3, i Tc Mc_Drive M2400_D4 328 Version: 1.8.3 TF5810
## Page 329

Knowledge Base If one of the components mentioned here is used, then one of the drive function blocks provided will usually be used. These interfaces of these function blocks are not guaranteed and should therefore not be called directly by the application. It is better to set the drive type according to the constants in E_Tc Mc Drive Type [} 94] under n Drive_Type in ST_Tc Hyd Ax Param [} 130], and to use a function block of type MC_Ax Rt Drive_Bk Plc Mc [} 187]. If only the usual function blocks (encoder, generator, finish, drive) for the axis are to be called, a function block of type MC_Ax Standard Body_Bk Plc Mc [} 253] should be used for simplicity. FAQ #8: In what order should the function blocks of an axis be called? 1. Obligatory: all function blocks, which detect the actual status of the axis. These include function blocks of types MC_Ax Rt Encoder_Bk Plc Mc [} 198], MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220] or MC_Ax Rt Read Pressure Single_Bk Plc Mc [} 222]. 2. Usual: function blocks or commands, which update the enable signals of the axis. This is usually a function block of type MC_Power_Bk Plc Mc [} 27]. For axes with an incremental encoder, which is referenced using a cam, a function call MC_Ax Rt Set Referencing Cam Signal_Bk Plc Mc is used in addition. 3. Optional: Function blocks, which derive a decision or trigger a command based on an actual axis status, an I/O signal or an application signal. For example, an axis start can be triggered in response to the signal of a proximity limit switch, or an axis movement can be stopped before the target position is reached, depending on the pressure increase. 4. Obligatory: Control value generators such as function blocks of type MC_Ax Runtime_Bk Plc Mc [} 237]. 5. Optional: Various controllers can be called at this point, as required. This can be a function block of type MC_Ax Ctrl Slow Down On Pressure_Bk Plc Mc [} 178] or similar. 6. Obligatory: An adaptation function block of type MC_Ax Rt Finish_Bk Plc Mc [} 246]. 7. Optional: If required, a function block for the automatic commissioning can be called at this point. 8. Obligatory: An output function block of type MC_Ax Rt Drive_Bk Plc Mc [} 187]. Instead of the library function blocks, application function blocks can be used. However, one should check carefully whether this is necessary, in which case compatibility with the library must be ensured. In some applications this may become necessary, in order to adapt a non-standard sensor or actuator, or to solve a special control task. FAQ #9: How do I control a valve output stage (on-board or externally)? The ST_Tc Plc Device Output [} 153] structure is intended for the b Power On and b Enable signals and for controlling the output stage supply and activation. Both signals are set by function blocks of type MC_Power_Bk Plc Mc [} 27], if the input Enable is set. At the same time this function block sets the software controller enable in ST_Tc Hyd Ax Rt Data [} 141].n De Ctrl DWord [} 339]. The ST_Tc Plc Device Input [} 149] structure is intended for the signals b Power Ok, b En Ack and b Ready for the output stage supply control, feedback from the output stage activation and the status signal. The differences in the signals provided by different manufacturer can be very significant. Currently, only the b Power Ok signal is used for specifying the Status output of the MC_Power_Bk Plc Mc [} 27] function block. If no suitable signal is available, or if no monitoring is to be realised, ST_Tc Hyd Ax Param [} 130].b Drive_Default Power Ok should be set. FAQ #10: How do I create a message buffer? Direct output of messages from the function blocks would result in runtime variations that would be difficult to calculate. For this reason, the messages are stored in a buffer and output in the Windows Event Viewer one after another, if required. In order to be able to use a message buffer, a variable of type ST_Tc Plc Mc Log Buffer [} 156] must be created. This buffer is used to hold the messages from all axes. It is important that only one such variable is created in the project, irrespective of the number of axes. The address of this buffer should be transferred to the MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function blocks of all axes, together with the addresses of the other TF5810 Version: 1.8.3 329
## Page 330

Knowledge Base individual axis components. This function blocks are usually called in the initialization part of the project. This address is stored in the element p St Ax Log Buffer in the structure Axis_Ref_Bk Plc Mc [} 86] and by the function block. n Log Level in Axis_Ref_Bk Plc Mc [} 86] is used to specify the significance level threshold for storing messages in the buffer. The values [} 347] to be used are defined in the global variables of the library. Note that this setting is required for each axis. The library function blocks detect the preparations mentioned above and will commence issuing messages. However, if the message output is enabled, the buffer would fill up quickly and not accept further messages. There are two ways to avoid this. FAQ #10.1: Passing on messages to the Windows Event Viewer In order to transfer messages from the Log Buffer of the library to the Windows Event Viewer, a function block of type MC_Ax Rt Logger Spool_Bk Plc Mc [} 261] should be called cyclically. Witch each call a message is removed from the Log Buffer. Computers running Windows CE are also capable of amending an Event Viewer for the messages created by Twin CAT. To this end this service is emulated by the Twin CAT system service. However, usually only a flash disk will be available. In order to avoid overloading the relatively small message capacity of the Event Viewer, only errors should be logged. FAQ #10.2: Deleting the oldest messages In order to ensure a minimum number of messages that can be handled, a function block of type MC_Ax Rt Logger Despool_Bk Plc Mc [} 259] should be called cyclically. With each call, this function block removes the oldest message from the Log Buffer, until a transferred number of free messages is available. The deleted messages are lost. FAQ #10.3: Generating logger entries through the application An application can output a message either axis-related or non-axis-related. The function blocks MC_Ax Rt Log Axis Entry_Bk Plc Mc [} 256] and MC_Ax Rt Log Entry_Bk Plc Mc [} 258] are available for this purpose. FAQ #10.4: Library-internal message buffer A cyclic call to the MC_Communications_Bk Plc Mc [} 281] function block uses a library-internal message buffer. For this purpose, the MC_Communications_Bk Plc Mc function block references the internal message buffer in the transferred axes and calls the MC_Ax Rt Logger Spool_Bk Plc Mc [} 261] function block. A message buffer created in the PLC application is no longer required here. In addition, the message buffer referenced when calling MC_Ax Uti Standard Init_Bk Plc Mc [} 254] is ignored when calling the MC_Communications_Bk Plc Mc function block. FAQ #11: How do I abort monitoring of a function? Some library function blocks start an activity, for which cyclic calling is no longer essential. However, these function blocks are also structured according to the rules of the PLCopen Motion Control guidelines in such a way that they fully monitor the activity and present it at their outputs. This is indicated by the output Busy, which most function blocks provide. Omitting the cyclic call of a function block that is in this monitoring state would usually result in significant problems. The next function start with the respective function block would have problems with evaluating the edges at its inputs, or it would detect that meanwhile the axis has executed another function and indicated a problem that doesn't exist (Command Aborted). In older versions of the library a function block of type MC_Ax Uti Cancel Monitoring_Bk Plc Mc() was provided, which for a few motion functions aborted the monitoring by the function block initiating the function. This function block is no longer required, in view of the fact that in the meantime the PLC Open rules have been implemented more fully. 330 Version: 1.8.3 TF5810
## Page 331

Knowledge Base To instruct a function block to terminate monitoring its function, in most cases it is sufficient to call it once or several times with Execute:=FALSE. This applies in particular to MC_Move Absolute_Bk Plc Mc [} 73](), MC_Move Relative_Bk Plc Mc [} 77]() and MC_Move Velocity_Bk Plc Mc [} 79](). Subsequently, a new functionality can be started in same or a later cycle with the same function block or an instance of the same or another type. This procedure can be repeated as required. Complex functions composed of several sub-actions, such as MC_Home_Bk Plc Mc(), require the continuous calling of the function block as the latter organizes the required processes itself ( MC_Home_Bk Plc Mc ()) [} 68] FAQ #12: How do I monitor the communication with an I/O device? ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] variables provide an element with the name ui Box State. If the Bus Couplers or the interface cards of the power units used offer a corresponding variable and the variable assumes the value 0 with undisturbed communication in the fieldbus used, a link should be created. This is possible, for example, with Beckhoff Lightbus and Real-time Ethernet. If an MC_Power_Bk Plc Mc [} 27] function block is used for the axis, the function block monitors the ui Box State and reports problems with the communication. In such a case the axis is put in an error state. Ether CAT offers enhanced options. FAQ #13: How do I assign my own labels to customer-specific axis parameters? The Axis_Ref_Bk Plc Mc [} 86] structure uses the p Aux Labels pointer to support the application of an array of texts, which are displayed by the Plc Mc Manager. These texts can be loaded by the MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block when the application is started from a file. To this end this function block must be provided with the address of an ST_Tc Mc Aux Data Labels [} 149] variable and a suitable file. It goes without saying that it is also possible to define the elements of the ST_Tc Mc Aux Data Labels [} 149] variable through direct assignment from the application. In this case, the file is not required. A number of controller function blocks of the library define the arrays texts automatically. FAQ #14: How do I control a current valve? In contrast to a 4/2 or 3/2 directional proportional valve or a servo-valve, a current valve is controlled with a 0..10 V signal (if a valve output stage is present) or actuated with a load-independent current of 0... I . In Nominal this control, only the magnitude of the velocity is transferred. The direction is transferred not with the sign, but by other means. This usually requires digital signals, which are used for controlling switching valves. The ST_Tc Plc Device Output [} 153] structure provides elements such as b Brake Off, b Move Pos and b Move Neg for this purpose. For generating an absolute control value, b Drive_Absolute Output should be set in the axis parameters. This also enables the use of conventional frequency converters with asynchronous motor, encoder and brake, if the converter provides an analog input. FAQ #15: Which axis variables should be logged with the Scope? The following signal composition is recommended: • Always: actual axis position: Axis_Ref_Bk Plc Mc. ST_Tc Hyd Ax Rt Data [} 141].f Act Pos: in actual value units, as specified by the encoder scaling. • Only for gear or synchronization coupling, cam plate: set axis position: Axis_Ref_Bk Plc Mc. ST_Tc Hyd Ax Rt Data.f Set Pos: in actual value units, as specified by the encoder scaling. TF5810 Version: 1.8.3 331
## Page 332

Knowledge Base • Particularly during commissioning: actual velocity value: Axis_Ref_Bk Plc Mc. ST_Tc Hyd Ax Rt Data.f Act Velo: velocity in physical representation. • Particularly during commissioning: Residual distance or target position: Axis_Ref_Bk Plc Mc. ST_Tc Hyd Ax Rt Data.f Distance To Target or Axis_Ref_Bk Plc Mc. ST_Tc Hyd Ax Rt Data.f Target Pos: in actual value units, as specified by the encoder scaling. • Only if pressure/force logging is active: various actual pressure and force values: in Axis_Ref_Bk Plc Mc. ST_Tc Hyd Ax Rt Data: as required f Act Pressure f Act Pressure A f Act Pressure B f Act Force f Valve Pressure f Supply Pressure: pressures and forces, unit is defined through parameterization of the logging function blocks. • Particularly during commissioning: velocity control value: Axis_Ref_Bk Plc Mc. ST_Tc Hyd Ax Rt Data.f Set Velo: velocity in physical representation. • Particularly during commissioning: controller output: Axis_Ref_Bk Plc Mc. ST_Tc Hyd Ax Rt Data.f Lag Ctrl Output: velocity in physical representation. The signal selection in Scope View is simplified if the Axis_Ref_Bk Plc Mc variables contain a name that begins with aaa_. This approach is used in the sample programs and ensures that the variables can be found quickly in the symbol list. In the signal composition of Scope View, channels can be temporarily disabled. In this way it is possible to maintain a comprehensive configuration but limit logging to data that are currently of interest. FAQ #16: What is the purpose of the variable n Debug Tag in Axis_Ref_Bk Plc Mc? This variable exists in some versions. It has no meaning for the PLC project. This variable is used by nearly all library function blocks to store a unique ID for the duration of their execution. To this end the content that was found is stored in a local variable of the function block and restored immediately before the function block is exited. Should the program crash, or if there is a suspicion that there was a problem in a library function block, the n Debug Tag variables of all axes should be checked. If a value <> 0 is present, the function block was affected by the crash, and the reason should be investigated. The numeric values used are listed in the library under "Global constants". In addition, the contents of ST_Tc Hyd Ax Rt Data [} 141].s Top Block Name should be determined. Usually, the name of the function block called directly by the application can be found here. FAQ #17: What has to be taken into account when Sercos drives are used? If Sercos drives (from V3.0.26) are used, the following rules must be followed: • The Sercos master interface (e.g. FC7501 etc.) must be allocated the name "Sercos Master" in the System Manager. Otherwise neither control of the Sercos phase nor parameter and diagnostics communication is possible. • Only a Sercos segment with the library can be used. • In the System Manager, the drive devices at the Sercos Segment should be allocated the name under which they are known to the library by calling the MC_Ax Uti Standard Init_Bk Plc Mc() function block. Otherwise neither control of the Sercos phase nor parameter and diagnostics communication is possible. • The input variable System State [} 189] of the Sercos master interface should be linked for each drive device of the Sercos segment. • If one or several drives at the Sercos segment are reset, the segment can interrupt the fieldbus. In this case, the Sercos master interface will undergo a corresponding phase change. Usually, the startup up to phase 4 will be automatic. Then: ◦ the axis addressed by the reset will be error-free, as long as there are no ongoing problems. 332 Version: 1.8.3 TF5810
## Page 333

Knowledge Base ◦ all other axes at the Sercos segment will be in error state (fieldbus failure, axis not ready for operation). Once the triggering reset of the first axis has been processed, the other axes can usually be brought into an error-free state through a reset without a phase change. This behavior is determined by characteristics of the Sercos fieldbus and cannot be influenced by the library. It must be taken into account in the application in a suitable manner. • Depending on certain parameter settings of the drive actuator, axis parameters are determined automatically or have to be specified manually: ◦ S-0-0076, bits 0 to 2 specify the weighting type of the position data. Supported features: ◦ a) 0 0 1 translatory weighting: S-0-0123 defines the rotation resolution (encoder-interpolation). The revolutional feed rate is calculated from this number and the weighting (S-0-0077, S-0-0078). ◦ b) 0 1 0 rotary weighting: S-0-0079 defines the rotation resolution (encoder-interpolation). The revolutional feed rate has to be set manually. ◦ S-0-0044, bits 0 to 2 specify the weighting type of the velocity data. Supported features: ◦ a) 0 0 1 translatory weighting: The velocity control value is converted to a velocity in encoder increments per time, based on the revolutional feed rate and the rotation resolution. This information is offset against the velocity resolution (S-0-0045, S-0-0046) and output. ◦ b) 0 1 0 rotational weighting The velocity control value is converted to a speed based on the revolutional feed rate and output. ◦ S-0-0091 is converted with the method described above for velocity control values and used as reference velocity. If the maximum speed exceeds the value determined in this way, it is limited accordingly. FAQ #18: How is a pressure or a force determined? To determine an actual pressure or an actual force, one or several function blocks of types MC_Ax Rt Read Pressure Diff_Bk Plc Mc [} 220], MC_Ax Rt Read Force Diff_Bk Plc Mc [} 215], MC_Ax Rt Read Force Single_Bk Plc Mc [} 218] or MC_Ax Rt Read Pressure Single_Bk Plc Mc [} 222] have to be called for each axis. Details for the call sequence can be found under FAQ #8 [} 329]. The AD converter values to be transferred to the function blocks have to be linked with allocated variables of the application. Details regarding selection and parameterization can be found in the function blocks descriptions. FAQ #19: What has to be taken into account when AX5000 drives are used? For AX5000 devices, when communication is established, a series of IDNs are read from the device and various parameters are automatically calculated. IDN ...used for parameters 44 Reference velocity, internal: Scaling of the velocity output 45 internal: scaling of the velocity output 46 internal: scaling of the velocity output 76 Encoder interpolation 79 Encoder interpolation 91 Reference velocity The following parameters are thus set automatically and cannot be influenced via the Plc Mc Manager: TF5810 Version: 1.8.3 333
## Page 334

Knowledge Base Parameter ...influences which other param- eters Global: reference velocity Calculated from the maximum Manuel velocities, max. appl. vel. speed of the device and the revolutional feed rate. Encoder: inc. interpolation Read from IDN79 of the device. Note: The revolutional feed rate has to be entered as inc. evaluation. FAQ #20: How do I prepare an axis for blending based on PLC Open? In Hydraulik.lib it is possible to command up to 12 buffered movements. For this purpose, a command buffer of type ST_Tc Plc Cmd Cmd Buffer_Bk Plc Mc must be passed to the MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block for updating the axis reference and a function block MC_Ax Rt Cmd Buffer Execute_Bk Plc Mc must be called cyclically. If Move function blocks such as MC_Move Absolute_Bk Plc Mc [} 73], MC_Move Relative_Bk Plc Mc [} 77] or MC_Move Velocity_Bk Plc Mc [} 79] are now activated, they enter their data in the command buffer. In buffered mode make sure that the Move function blocks and the MC_Ax Runtime_Bk Plc Mc [} 237] function block of the axis run in a PLC task. 334 Version: 1.8.3 TF5810
## Page 335

Knowledge Base Transition between a slow and a fast section. TF5810 Version: 1.8.3 335
## Page 336

Knowledge Base Transition between a fast and a slow section. FAQ #21: How can I access registers of a terminal, to which an encoder or a valve of an axis is connected? For register communication with terminals to which the encoder or the valve of an axis is connected, it is recommended to use function blocks of types MC_Ax Uti Read Reg Drive Term_Bk Plc Mc [} 293](), MC_Ax Uti Read Reg Enc Term_Bk Plc Mc [} 294](), MC_Ax Uti Write Reg Drive Term_Bk Plc Mc [} 302]() and MC_Ax Uti Write Reg Enc Term_Bk Plc Mc [} 303](). FAQ #22: What is the structure of an ASCII file for a linearization table? The format of an ASCII file from a linearization table is specified as follows: • One linearization point per row. • For each row first a velocity value, then an output value. • The velocity values are normalized to the reference velocity. They are therefore in the range -1,000 to 1,000 inclusive. • The output values are normalized to the full scale value. They therefore cover the range -1,000 to 1,000. 336 Version: 1.8.3 TF5810
## Page 337

Knowledge Base • The first value in a row may be preceded by white space characters (space, tab). • Between the two values in row there must be at least one white space character (space, tab). • Between the two values of a row there may be further white space characters (space, tab). • Point and comma are permitted as decimal separator. • No non-digits are permitted between a negative sign and the first digit. • The first point specifies the negative end of the table. • The velocity value of all further points must be higher (i.e. less negative or more positive) than its predecessor. • It makes sense if the output value of a point is higher (i.e. less negative or more positive) than its predecessor, since otherwise there would be a negative slope in this section. This would result in a change of sign of the gain and therefore instability in an active control. • The zero point (i.e. both coordinates of the point are 0.000) has to be specified. Example: The following (idealized) table describes a cylinder, which in negative direction only reaches half the velocity of the positive direction due to asymmetric effective areas (due to single-sided piston rod). It is assumed that the cylinder is operated with a zero overlap valve with a bend in the characteristic curve at 40% Normalized velocity Normalized output -0.500 -1.000 -0.430 -0.900 -0.360 -0.800 -0.290 -0.700 -0.220 -0.600 -0.150 -0.500 -0.080 -0.400 -0.060 -0.300 -0.040 -0.200 -0.020 -0.100 0.000 0.000 0.040 0.100 0.080 0.200 0.120 0.300 0.160 0.400 0.300 0.500 0.440 0.600 0.580 0.700 0.720 0.800 0.860 0.900 1.000 1.000 FAQ #23: How can Plc Mc Manager commands be blocked? In some situations the triggering of commands by the Plc Mc Manager can be problematic. This would be the case if a certain sequence of actions has to be processed completely, for example. In order to prevent inadvertent issuing of commands by the Plc Mc Manager in such cases, the MC_Ax Rt Commands Locked_Bk Plc Mc [} 262] function can be used to enter a lock in the status double word of the axis. If this lock is active, any command sent by Plc Mc Manager sent is rejected with a write protection error. It is essential to remove the lock, once the action to be protected has been processed. This also and in particular applies in the event of errors. TF5810 Version: 1.8.3 337
## Page 338

Knowledge Base An example [} 378] is available. FAQ #24: What format do files with characteristic curve data have? If an axis is equipped with components for a characteristic curve-controlled linearization, the interpolation points can be exported to a file using a function block of the type MC_Lin Table Export To Ascii File_Bk Plc Mc(). The function block MC_Lin Table Import From Ascii File_Bk Plc Mc() is available if such data are to be imported from a file created or modified in this way or in other ways. So that such files can be used, the following format must be strictly adhered to. • A row must be used for each point. • Each row must be terminated with CR/LF. • Each row initially contains the normalized velocity value in the range -1.0 to 1.0. • After at least one separator (space or tab), the normalized output value follows for the full range from -1.0 to 1.0. • The output value must exhibit a constant step size (distance between two points). • The first row contains the negative end value. Its output value must be -1.0. • The last row contains the positive end value. Its output value must be 1.0. • A row must be provided for the output value 0.0. • The file must therefore contain the same number of points in the negative and positive range. The total number must be odd. • Both the velocity and the output value follow the same rules: Sign with negative numbers A digit A decimal separator: comma or point At least one decimal place Optional: An exponent, marked with "e", a minus sign and a digit Example: -1.81408951053528e-1 -5.0e-1 Example: 0.333 0.5 5.2 Global constants Available from version 3.0 Bit-masks for position cams These masks are to be used by the application to provide digital movement cams for b Act Pos Cams in ST_Tc Hyd Ax Rt Data. Constant Description b Tc Hyd Act Pos Cam Pos Summary of b Tc Hyd Act Pos Cam High and b Tc Hyd Act Pos Cam Up. b Tc Hyd Act Pos Cam High The axis has reached the upper target position. b Tc Hyd Act Pos Cam Up The axis is located close to the upper target position. b Tc Hyd Act Pos Cam Down The axis is located close to the lower target position. b Tc Hyd Act Pos Cam Low The axis has reached the lower target position. b Tc Hyd Act Pos Cam Neg Summary of b Tc Hyd Act Pos Cam Low and b Tc Hyd Act Pos Cam Down. Bit-masks for axis status information These masks are to be used by the application to interrogate status signals in n State DWord in ST_Tc Hyd Ax Rt Data. 338 Version: 1.8.3 TF5810
## Page 339

Knowledge Base Constant Description dw Tc Hyd Ns Dw Functional Axis is ready for operation. dw Tc Hyd Ns Dw Referenced Axis has been referenced. dw Tc Hyd Ns Dw Steady Axis is not active. dw Tc Hyd Ns Dw In Targ Rng The axis is located within a distance from the target position specified by f Mon Position Range in ST_Tc Hyd Ax Param. dw Tc Hyd Ns Dw In Target The axis has been located without interruption since a time specified by f Mon Target Filter within a distance from the target position specified by f Mon Target Range in ST_Tc Hyd Ax Param. dw Tc Hyd Ns Dw Dont Touch Protected Reserved. Not supported. dw Tc Hyd Ns Dw Stopped The last movement of the axis was stopped without reaching the specified target position. dw Tc Hyd Ns Dw Busy The axis is active. dw Tc Hyd Ns Dw Move Up The axis is moving in the direction of increasing positions. dw Tc Hyd Ns Dw Move Down The axis is moving in the direction of decreasing positions. dw Tc Hyd Ns Dw Referencing Axis is homing. dw Tc Hyd Ns Dw Const Velo The axis is moving with constant velocity. dw Tc Hyd Ns Dw Ext Setpoint Active The axis is controlled by an MC_Ax Rt Set Ext Gen Values_Bk Plc Mc [} 252] function block. dw Tc Hyd Ns Dw Started Over The axis was started, i.e. the last accepted command took effect while the axis was still in motion. dw Tc Hyd Ns Dw Control Active Reserved. Not supported. dw Tc Hyd Ns Dw Err State The axis is in an error state. Bit-masks for axis enable information These masks are to be used by the application to provide enable signals in n De Ctrl DWord in ST_Tc Hyd Ax Rt Data. Constant Description dw Tc Hyd Dc Dw Ctrl Enable Controller enable. This enable is a precondition for the output of control value and controller outputs. dw Tc Hyd Dc Dw Fd Pos Ena Advance movement enable in positive direction. This enable is a precondition for the output of control value and controller outputs in the direction of increasing values of position. dw Tc Hyd Dc Dw Ctrl Pos Ena Combination of dw Tc Hyd Dc Dw Ctrl Enable and dw Tc Hyd Dc Dw Fd Pos Ena. dw Tc Hyd Dc Dw Fd Neg Ena Advance movement enable in negative direction. This enable is a precondition for the output of control value and controller outputs in the direction of decreasing values of position. dw Tc Hyd Dc Dw Ctrl Neg Ena Combination of dw Tc Hyd Dc Dw Ctrl Enable and dw Tc Hyd Dc Dw Fd Neg Ena. dw Tc Hyd Dc Dw Ref Index Referencing cam. dw Tc Hyd Dc Dw Accept Blocked Drive Reserved. Not supported. dw Tc Hyd Dc Dw Blocked Drive Detected Reserved. Not fully supported. This signal suppresses any active velocity controller. Error Codes These constants are to be used for the outputs of Error ID from function blocks and for n Error Code in ST_Tc Hyd Ax Rt Data. TF5810 Version: 1.8.3 339
## Page 340

Knowledge Base Constant Hexadeci- Decimal Description mal dw Tc Hyd Ads Err No Error 0 0 No error. dw Tc Hyd Ads Err Unknown Po 16#0006 6 ADS port unknown. Possible causes: rt • AMS Net ID / ADS port address the wrong runtime system or the wrong computer • another project is running in the addressed PLC • the application does not call a MC_Ax Ads Comm Server_Bk Plc Mc [} 279]() function block dw Tc Hyd Ads Err Unknown Ta 16#0007 7 Target machine unknown. Possible causes: rget • AMS Net ID / ADS port address the wrong runtime system or the wrong computer • the target system has not been started • Twin CAT has not been started • the connection is electrically / mechanically interrupted • for communication via Ethernet: the TCP/IP connection is not working dw Tc Hyd Ads Err Invalid Idx Gr 16#0702 1794 Invalid Index Group. Possible causes: oup • AMS Net ID / ADS port address the wrong runtime system or the wrong computer • another project is running in the addressed PLC • application software error (incorrect combination of ADS port / Idx Group / Idx Offset) dw Tc Hyd Ads Err Invalid Idx Of 16#0703 1795 Invalid Index Offset. Possible causes: fset • AMS Net ID / ADS port address the wrong runtime system or the wrong computer • another project is running in the addressed PLC • application software error (incorrect combination of ADS port / Idx Group / Idx Offset) • attempted access to an array element with invalid index (out of bounds) dw Tc Hyd Ads Err Rd Wr Not Pe 16#0704 1796 Access (write, read) not permitted. Possible causes: rmitted • a write access to a variable without write permission was requested dw Tc Hyd Ads Err Invalid Size 16#0705 1797 Size (number of bytes) not permitted. Possible causes: • application software error (incorrect combination of ADS port / Idx Group / Idx Offset) dw Tc Hyd Ads Err Illegal Value 16#0706 1798 Value not permitted. Possible causes: • the transferred value is outside absolute parameter limits • the transferred value is outside parameter limits, which have been specified by other already applicable parameters dw Tc Hyd Ads Err Not Ready 16#0707 1799 Not ready for operation. Possible causes: • an MC_Power_Bk Plc Mc function block was prompted by its Enable input to activate an axis that is not ready for operation 340 Version: 1.8.3 TF5810
## Page 341

Knowledge Base Constant Hexadeci- Decimal Description mal dw Tc Hyd Ads Err Busy 16#0708 1800 Already active. Possible causes: • the axis could not accept an instruction because it is already dealing with another task dw Tc Hyd Ads Err No File 16#070C 1804 Reserved: File is missing / not accessible. dw Tc Hyd Ads Err Syntax 16#070D 1805 Syntax in command or file invalid. Possible causes: • invalid characters or character combinations were detected while reading a characteristic curve file stored in ASCII format • incomplete information was detected while reading a characteristic curve file stored in ASCII format dw Tc Hyd Ads Err Timeout 16#0745 1861 Timeout. Possible causes: • during a communication the response did not arrive within a designed time ◦ the chosen time is too short ◦ the connection is interrupted • the process has prevented processing of the command or delayed it beyond the designated time • the specified commands parameters have increased the time requirement beyond the designated value dw Tc Hyd Ads Err No Ams Addr 16#0749 1865 AMS/ADS address missing: • The ADS address of the device was not mapped to the corresponding variable of the input structure. dw Tc Hyd Err Cd Not Compatib 16#4040 16448 The axis is incompatible with the required function. le Possible causes: • application software error dw Tc Hyd Err Cd Illegal Output 16#4104 16644 The output number is outside the permitted range. Number Possible causes: • an MC_Read Digital Output_Bk Plc Mc or MC_Write Digital Output_Bk Plc Mc function block was called with an invalid parameter. dw Tc Hyd Err Cd Not Support 16#4107 16647 Function or command not supported. Possible causes: • application software error dw Tc Hyd Err Cd Cycle Time 16#4205 16901 Cycle time (f Cycletime in ST_Tc Hyd Ax Param) not permitted. Possible causes: • Parameterization error dw Tc Hyd Err Cd Missing Enc 16#4210 16912 There is no connection to an encoder interface (p St Device Input and/or p St Device Output in Axis_Ref_Bk Plc Mc [} 86]). Possible causes: • Application software error (the MC_Ax Uti Standard Init_Bk Plc Mc function block was not called or not provided with the address of an ST_Tc Plc Device Input and an ST_Tc Plc Device Output structure) TF5810 Version: 1.8.3 341
## Page 342

Knowledge Base Constant Hexadeci- Decimal Description mal dw Tc Hyd Err Cd Missing Drive 16#4212 16914 There is no connection to a drive interface (p St Device Input and/or p St Device Output in Axis_Ref_Bk Plc Mc [} 86]). Possible causes: • Application software error (the MC_Ax Uti Standard Init_Bk Plc Mc function block was not called or not provided with the address of an ST_Tc Plc Device Input and an ST_Tc Plc Device Output structure) dw Tc Hyd Err Cd Cannot Sync 16#421A 16922 Start distance inadequate when an hronize MC_Gear In Pos_Bk Plc Mc() function block is called. Possible causes: • the axis is too close to the sync point when the function block is activated • the dynamic axis parameters are inadequate dw Tc Hyd Err Cd Illegal Gear F 16#421B 16923 The parameters of a gear coupling are not permitted. actor Possible causes: • the parameter of the function block is not permitted dw Tc Hyd Err Cd Soft End 16#4222 16930 The target position is located on the far side of an active software limit switch, and is therefore not permitted. dw Tc Hyd Err Cd Low Dist 16#4228 16936 The travel distance is unacceptably small. dw Tc Hyd Err Cd Illegal Start Ty 16#4239 16953 Invalid start type. pe dw Tc Hyd Err Cd Command Bu 16#423F 16959 Command buffer is full. ffer Overflow dw Tc Hyd Err Cd Enc Lost Cam 16#4253 16979 Reserved. Not supported. m dw Tc Hyd Err Cd Ctrl Ena Lost 16#4260 16992 Controller enable was withdrawn during the motion. Possible causes: • the axis enable was withdrawn at an unexpected time due to a machine logic signal • application software error dw Tc Hyd Err Cd Enc No Cam 16#429C 17052 Reserved. Not supported. m Found dw Tc Hyd Err Cd Enc No Cam 16#429D 17053 Reserved. Not supported. m End dw Tc Hyd Err Cd Enc No Sync 16#429E 17054 Reserved. Not supported. Pulse dw Tc Hyd Err Cd Acc 16#4309 17161 The acceleration is not acceptable. dw Tc Hyd Err Cd Dec 16#430A 17162 The deceleration is not acceptable. dw Tc Hyd Err Cd Jerk 16#430B 17163 The jerk limitation is invalid. dw Tc Hyd Err Cd Ptr Plc Mc 16#4345 17221 No connection to one of the required axis interfaces (p St Device Input or p St Device Output in Axis_Ref_Bk Plc Mc [} 86]). dw Tc Hyd Err Cd Ptr Mc Plc 16#4346 17222 No connection to one of the required axis interfaces (p St Device Input or p St Device Output in Axis_Ref_Bk Plc Mc [} 86]). dw Tc Hyd Err Cd Ctrl Ena 16#4356 17238 Movement without controller enable is not permitted. dw Tc Hyd Err Cd Neg Fd Ena 16#4357 17239 Movement in the direction of reducing positions without the negative direction advance enable is not permitted. 342 Version: 1.8.3 TF5810
## Page 343

Knowledge Base Constant Hexadeci- Decimal Description mal dw Tc Hyd Err Cd Pos Fd Ena 16#4358 17240 Movement in the direction of increasing positions without positive direction advance enable is not permitted. dw Tc Hyd Err Cd Set Velo 16#4359 17241 The required velocity is not acceptable. dw Tc Hyd Err Cd Peh Timeout 16#435C 17244 The axis does not reach the target window within the specified time. dw Tc Hyd Err Cd Not Moving 16#435D 17245 The axis is not moving, or not in the correct direction. dw Tc Hyd Err Cd Consequenti 16#43A0 17312 Consequential error: The axis was put in an error al state due to a problem with another axis. dw Tc Hyd Err Cd Enc Type 16#4401 17409 The parameter type is invalid. dw Tc Hyd Err Cd Enc Scaling 16#4406 17414 The increment scaling is not permitted. dw Tc Hyd Err Cd Enc Sync Dist 16#4414 17428 The distance between Latch_Enable and the sync pulse is too small. dw Tc Hyd Err Cd Enc Set Act P 16#4422 17442 A problem occurred during actual value setting. os dw Tc Hyd Err Cd Ptr Plc Enc In 16#4442 17474 The axis does not have a pointer to an encoder input interface dw Tc Hyd Err Cd Ptr Plc Enc Ou 16#4443 17475 The axis does not have a pointer to an encoder t output interface. dw Tc Hyd Err Cd Enc Underru 16#4450 17488 Reported by some encoder types: The actual position n has passed the lower count limit of the encoder. dw Tc Hyd Err Cd Enc Overrun 16#4451 17489 Reported by some encoder types: The actual position has passed the upper count limit of the encoder. dw Tc Hyd Err Cd Enc Hdw Fail 16#4464 17508 Drive actuator or encoder report a hardware fault. ed dw Tc Hyd Err Cd Ssi 16#4470 17520 An error was detected when operating an SSI encoder. dw Tc Hyd Err Cd Pos Lag 16#4550 17744 The lag error exceeds an active limit. dw Tc Hyd Err Cd Drive Type 16#4601 17921 The value set in n Drive_Type is not permitted. dw Tc Hyd Err Cd Ref Velo 16#4605 17925 Reference velocity (f Ref Velo in ST_Tc Hyd Ax Param) is invalid. dw Tc Hyd Err Cd Stepper Stall 16#4636 17974 A stall situation was detected. ed dw Tc Hyd Err Cd Ptr Plc Drive In 16#4642 17986 The axis does not have a pointer to a drive input interface. dw Tc Hyd Err Cd Ptr Plc Drive O 16#4643 17987 The axis does not have a pointer to a drive output ut interface. dw Tc Hyd Err Cd Drive Not Rea 16#4650 18000 Power section not ready for operation. dy dw Tc Hyd Err Cd Tbl Entry Cou 16#4A02 18946 The number of table entries (rows) is not permitted. nt dw Tc Hyd Err Cd Tbl Invalid Ma 16#4A04 18948 The table contains entries with invalid master step ster Step size. dw Tc Hyd Err Cd Tbl No Init 16#4A10 18960 The table is not initialized. dw Tc Hyd Err Cd Tbl Illegal Ind 16#4A13 18963 Table index not permitted. ex dw Tc Hyd Err Cd Tbl Line Coun 16#4A15 18965 The number of table entries is too large. t dw Tc Hyd Err Cd Not Startable 16#4B01 19201 Axis in a state that does not allow it to start. dw Tc Hyd Err Cd Func Timeout 16#4B07 19207 The function was not reported as complete within the specified time. dw Tc Hyd Err Cd Not Ready 16#4B09 19209 The axis is not in an operable state. TF5810 Version: 1.8.3 343
## Page 344

Knowledge Base Constant Hexadeci- Decimal Description mal dw Tc Hyd Err Cd Homing Type 16#4F00 20224 Referencing method (n Enc_Homing Type in ST_Tc Hyd Ax Param) is not permitted. dw Tc Hyd Err Cd Enc Cut Off 16#4F01 20225 The limit frequency for the actual value acquisition has been exceeded. dw Tc Hyd Err Cd Illegal Distan 16#4F02 20226 Distance is invalid: zero or negative. ce dw Tc Hyd Err Enc Disconecte 16#4FF0 20464 Encoder hardware is uncoupled. Possible causes: d • the fieldbus connection is interrupted • the power supply for the device is not available • the device is faulty • another device, which is located in the fieldbus connection between the controller and the device, has no power supply or is faulty dw Tc Hyd Err Drive Disconect 16#4FF1 20465 Drive hardware is uncoupled. Possible causes: ed • the fieldbus connection is interrupted • the power supply for the device is not available • the device is faulty • another device, which is located in the fieldbus connection between the controller and the device, has no power supply or is faulty dw Tc Hyd Err Distance Insuffic 16#4FF2 20466 The travel path is inadequate. ient dw Tc Hyd Err Illegal Areas 16#4FF3 20467 Inadmissible effective areas: • inadmissible values have been entered for the cylinder areas on the valve tab • the combination of the registered areas is not permitted in this way dw Tc Hyd Err Incomplete Impl 16#4FF4 20468 The axis implementation is incomplete: ementation • although the axis is marked with b Drive Is Hybrid in its parameters, no MC_Ax Rt Hybrid Axis Actuals_Bk Plc Mc function block is called • the same instance of type ST_Tc Plc Device Input is also transferred to the MC_Ax Uti Standard Init_Bk Plc Mc function block of another axis • the same instance of type ST_Tc Plc Device Output is also transferred to the MC_Ax Uti Standard Init_Bk Plc Mc function block of another axis • another instance of ST_Tc Plc Mc Log Buffer is passed to another axis • the same valid pointer to an instance of ST_Tc Plc Cmd Buffer_Bk Plc Mc was passed to another axis • the same valid pointer to an instance of ST_Tc Mc Auto Ident was passed to another axis Device-specific error codes of function block MC_Power_Bk Plc Mc These values appear at the Error ID output of an MC_Power_Bk Plc Mc function block, if an error is reported by the external device. 344 Version: 1.8.3 TF5810
## Page 345

Knowledge Base Constant Hexadeci- Decimal Description mal dw Tc Hyd Err Cd AX2000Main 16#0001 1 Only for AX2000: no feedback by the mains contactor Pwr Tm Out (timeout during waiting for ST_Tc Plc Mc Ax2000In.b Power Ok). dw Tc Hyd Err Cd AX2000Main 16#0002 2 Only for AX2000: negative edge on feedback from Pwr Fault mains contactor (ST_Tc Plc Mc Ax2000In.b Power Ok). dw Tc Hyd Err Cd AX2000Pwr 16#0003 3 Only for AX2000: no feedback from AX output stage Stage Tm Out (timeout during waiting for ST_Tc Plc Mc Ax2000In. Drive State[3].6, no Ready). dw Tc Hyd Err Cd AX2000Pwr 16#0004 4 Only for AX2000: Negative edge of AX output stage Stage Fault (ST_Tc Plc Mc Ax2000In. Drive State[3].6, no Ready). dw Tc Hyd Err Cd AX2000Rep 16#0005 5 Only for AX2000: error message from AX device orts Error (ST_Tc Plc Mc Ax2000In. Drive State[3].7 or ST_Tc Plc Mc Ax2000In. Drive Error<>0). dw Tc Hyd Err Cd AX2000Error 16#0006 6 Only for AX2000: I2T error message from AX output I2T stage (ST_Tc Plc Mc Ax2000In. Drive State[0].0). dw Tc Hyd Err Cd AX2000Error 16#0007 7 Only for AX2000: brake resistor of the AX output Chopper stage faulty (ST_Tc Plc Mc Ax2000In. Drive State[0].1). dw Tc Hyd Err Cd AX2000Error 16#0008 8 Only for AX2000: watchdog (timeout during Watch Dog communication) of the AX output stage was triggered (ST_Tc Plc Mc Ax2000In. Drive State[0].3). dw Tc Hyd Err Cd AX2000Error 16#0009 9 Only for AX2000: supply error reported by AX output Pwr Line stage (ST_Tc Plc Mc Ax2000In. Drive State[0].4). dw Tc Hyd Err Cd AX2000Con 16#000A 10 Only for AX2000: The connection to the AX device is nection Lost broken or substantially disrupted (ST_Tc Plc Mc Ax2000In. Box State<>0). dw Tc Hyd Err Cd AX2000Con 16#000B 11 Only for AX2000: The communication with the AX nection Tm Out device could not be established (timeout). dw Tc Hyd Err Cd KL2531Over 16#0001 1 Only for KL2531/KL2541: The KL2531/KL2541 Temp terminal reports overtemperature alarm. dw Tc Hyd Err Cd KL2531Unde 16#0002 2 Only for KL2531/KL2541: The KL2531/KL2541 r Voltage terminal reports inadequate supply voltage on the power rail. 16#0003 3 Only for KL2531/KL2541: Reserved. dw Tc Hyd Err Cd KL2531Ope 16#0004 4 Only for KL2531/KL2541: The KL2531/KL2541 n Load A terminal reports broken wire on the A-side. dw Tc Hyd Err Cd KL2531Ope 16#0005 5 Only for KL2531/KL2541: The KL2531/KL2541 n Load B terminal reports broken wire on the B-side. dw Tc Hyd Err Cd KL2531Over 16#0006 6 Only for KL2531/KL2541: The KL2531/KL2541 Current A terminal reports overcurrent at output stage A. dw Tc Hyd Err Cd KL2531Over 16#0007 7 Only for KL2531/KL2541: The KL2531/KL2541 Current B terminal reports overcurrent at output stage B. dw Tc Hyd Err Cd KL2531Not R 16#0008 8 Only for KL2531/KL2541: The terminal reports a eady output stage problem (enabled, not ready). dw Tc Hyd Err Cd KL2531Conn 16#000A 10 Only for KL2531/KL2541: The connection to the ection Lost terminal is broken or substantially disrupted (ST_Tc Plc Mc Drive In.ui Box State<>0). dw Tc Hyd Err Cd KL2531Conn 16#000B 11 Only for KL2531/KL2541: The communication with ection Tm Out the terminal could not be established (timeout). ADS Codes These constants are accepted by the MC_Ax Ads Read Decoder and MC_Ax Ads Write Decoder function blocks. TF5810 Version: 1.8.3 345
## Page 346

Knowledge Base Index Group Index Offset Type R/W Description 16#4000 + axis 2 STRING() R Axis name in text form. index 4 UDINT R Cycle time in microseconds. 16#10003 UDINT R Encoder type: n Enc_Type from ST_Tc Hyd Ax Param. 16#10006 LREAL R Incremental evaluation: f Enc_Inc Weighting from ST_Tc Hyd Ax Param. 16#30003 UDINT R Drive type: n Drive_Type from ST_Tc Hyd Ax Param. 16#4100 + axis 1 UDINT R Error code: n Error Code from index ST_Tc Hyd Ax Rt Data. 16#10002 LREAL R Actual position: f Act Pos from ST_Tc Hyd Ax Rt Data. 16#10005 LREAL R Actual velocity: f Act Velo from ST_Tc Hyd Ax Rt Data. 16#4200 + axis 1 - W Execute axis reset. index 16#10 - W Start homing. 16#21 Structure W Start axis movement. 16#FFFF0001 - W Save parameters. 16#FFFF0002 - W Load parameters. 16#4300 + axis 16#81 UDINT R Status double word: n State DWord index from ST_Tc Hyd Ax Rt Data. 16#B1 UDINT R Error code: n Error Code from ST_Tc Hyd Ax Rt Data. 16#F000 + axis 1 Structure R The ST_Tc Hyd Ax Rt Data variable index for the axis. 2 Structure R/W The ST_Tc Hyd Ax Param variable for the axis. 16#800F0000 + axis E_Tc MCParameter R/W Parameters and actual values of index the axis. [} 104] 16#FFFFFFFF 0 String() R Identification of the server. 1 UINT R Major version of the library. 2 UINT R Minor version of the library. 3 UINT R Release of the library. 4 UINT R Number of axes supported Array Dimensions The following constants used for dimensioning of fields and can be used by the application. 346 Version: 1.8.3 TF5810
## Page 347

Knowledge Base Constant Description ci Bk Plc Mc_Cam Switch Ref_Min Idx Lower boundary index on an array[] of CAMSWITCH_REF_Bk Plc Mc [} 123], supplied to blocks of type MC_Digital Cam Switch_Bk Plc Mc [} 54] ci Bk Plc Mc_Cam Switch Ref_Max Idx Upper boundary index on an array[] of CAMSWITCH_REF_Bk Plc Mc [} 123], supplied to blocks of type MC_Digital Cam Switch_Bk Plc Mc [} 54] ci Bk Plc Mc_Track Ref_Min Idx Lower boundary index on an array[] of TRACK_REF_Bk Plc Mc [} 126], supplied to blocks of type MC_Digital Cam Switch_Bk Plc Mc [} 54] ci Bk Plc Mc_Track Ref_Max Idx Upper boundary index on an array[] of TRACK_REF_Bk Plc Mc [} 126], supplied to blocks of type MC_Digital Cam Switch_Bk Plc Mc [} 54] Logger Levels The following constants are used for the specification of the level, from which messages are included in the logger function of the library. Constant Description dw Tc Hyd Log Level_None No logging dw Tc Hyd Log Level_Errors Only error messages dw Tc Hyd Log Level_Warnings Error messages and warnings dw Tc Hyd Log Level_Actions Error messages, warnings and activities Logger Sources The following constants are used to specify the source of messages in the logger function of the library. Constant Description dw Tc Hyd Log Source_Library A function block of the hydraulics library dw Tc Hyd Log Source_Lib Ext_2R2V A function block of the 2R2V library dw Tc Hyd Log Source_Application A function block of the application dw Tc Hyd Log Source_Application Framework A function block of an application platform Logger Argument Types The following constants are used to specify the type of an optional parameter for a message in the logger function of the library. Constant Description dw Tc Hyd Log Arg Type_DInt The message contains a parameter of type DINT. The message text must include a placeholder in the form %d. dw Tc Hyd Log Arg Type_LReal The message contains a parameter of type LREAL. The message text must include a placeholder in the form %f. dw Tc Hyd Log Arg Type_String The message contains a parameter of type STRING. The message text must include a placeholder in the form %s. 5.3 Valve The valve is generally the actuator, which controls the axis. For continuous valves, a distinction is made between: • Servo valve • Proportional valve • Control valve TF5810 Version: 1.8.3 347
## Page 348

Knowledge Base Servo valve These valves control large oil flows via small electrical signals • A small torque motor controls the connected control oil, thereby adjusting the slider of the main stage. • Often multi-stage design • High responsiveness and controllability Proportional valve A coil current generates a proportional force, which moves the valve slider against the force of a spring. Compared to servo valve: • Longer step response time • Higher current consumption • Larger hysteresis • More robust against contamination • Attractive price Control valve: A proportional valve, for which the slider position is measured and automatically adjusted: • Shorter step response time • Smaller hysteresis • Smaller load reaction • More complex and more expensive than proportional valves • Electronics on the valve or in the control cabinet Basic principles of reading valve data sheets A continuous valve is usually used as actuator for a controller. The designs of valves from different manufacturers or different types may differ quite significantly. In order to adapt the output scaling to the particular situation, the valve data sheet for the continuous valve must be available during commissioning. A valve has a number of hydraulic ports. A and B are the valve outputs; A is connected to the cylinder side with the larger piston area, B is connected to the cylinder side with the smaller piston area. P and T represent the supply connections. P is the pressure line, and T is the return line to the tank. In the hydraulics library, the A-side is always the side under positive pressure, the B-side is the side under negative pressure. In many cases the valve slide has to move slightly before an oil flow can be detected. This stroke is listed in the valve data sheet under overlap. The data sheet may indicate an overlapped valve, although this overlap is compensated in the valve electronics. 348 Version: 1.8.3 TF5810
## Page 349

Knowledge Base The characteristic volume flow curve shows the key information for the valve. The diagram above shows that the piston itself has an overlap of 20%, which was reduced to 5% in the valve electronics. As a result, no overlap compensation via the hydraulics library is required. The fact that overlap compensation was carried out in the valve does not make it a zero overlap valve, and the axis is therefore only capable of position control to a limited degree. The diagram shows that the oil flow in the A-chamber of the piston is greater than the oil flow in the B- chamber. This asymmetry indicates an area compensation in valve, in this case with a ratio of 11:6. 5.4 Electric/hydraulic hybrid axes Hybrid axis concepts The manufacturers of hydraulic components have developed a number of solutions for the design of such an axis. In order not to have to create a dedicated solution for each model of each manufacturer, generalized concepts were developed that combine a group of comparable models. The trailing letters (a, b, c, ...) denote equivalent variants of a concept. In the following section, these concepts and variants are presented using samples. The list of these samples is, by its very nature, incomplete. The screen contents shown below are only visible if the 'hybrid' flag is set on the Valve tab. Simplified representation The concepts listed below require the use of various pressure limiters and anti-cavitation check valves for their safe and long-term function. These components are indispensable but have no direct influence on the basic function of the axis. For a better understanding, all circuits are simplified to a greater or lesser degree and should not be regarded as documentation of an actual product. TF5810 Version: 1.8.3 349
## Page 350

Knowledge Base 1: Simulation of a synchronous cylinder without regenerative circuit The control behavior of a synchronous cylinder is simulated using a hydraulic synchronous or differential cylinder and an adapted pump arrangement. A gear shift can be realized by a pump changeover, although this results in a different concept. 1a: Simulation of a synchronous cylinder with a differential cylinder Manufacturer / Product: Voith Turbo / CLDP. Here, two pumps with flow rates adapted to the cylinder areas are operated on a motor shaft. The flow rates of the pumps Q1 / Q2 must be adapted to the ratio of the effective areas. Since this is not always perfectly possible, complex pressure distributions can result, depending on the situation. The control results in the behavior of a synchronous cylinder with direction-independent feed constant. Hydraulically a differential cylinder is present and an exchange volume is to be stored. No gear shift is available. It can be realized by synchronous flow-switchable pumps. This results in a different concept. 350 Version: 1.8.3 TF5810
## Page 351

Knowledge Base Required parameters: Effective area in positive direction (1), effective area in negative direction (2), volume per revolution at the effective area in positive direction (3), maximum pump speed (4). Automatically calculated parameters: Volume per revolution at the effective area in negative direction. The ratio of the effective areas is used. Automatically set parameters: The selectable areas are 0, the rotation volumes for force mode are equal to the values for rapid mode. TF5810 Version: 1.8.3 351
## Page 352

Knowledge Base 1b: Simulated synchronous cylinder with multiple differential cylinders Manufacturer / Product: Bucher / Demo HMI2018. Here, three differential cylinders with an area ratio of 2:3 are mechanically connected in parallel. The three smaller areas A2abc are hydraulically connected in parallel and form an effective area. Of the larger areas, A1ab are hydraulically connected in parallel, while the third area A1c is ventilated. For control purposes, the result is a compound synchronous cylinder with direction-independent feed constant. Hydraulically a synchronous cylinder is present and no exchange volume is to be stored. According to the manufacturer a gear shift is possible. This results in a different concept. 352 Version: 1.8.3 TF5810
## Page 353

Knowledge Base Required parameters: Effective area in positive direction (1), effective area in negative direction (2), volume per revolution at the effective area in positive direction (3), maximum pump speed (4). Automatically calculated parameters: Volume per revolution at the effective area in negative direction. The ratio of the effective areas is used (in this case 1:1). Automatically set parameters: The selectable areas are 0, the rotation volumes for force mode are equal to the values for rapid mode. 2: Simulation of a synchronous cylinder with regenerative circuit The control behavior of a synchronous cylinder is simulated using a hydraulic differential cylinder and an adapted pump arrangement in a regenerative circuit. A gear shift can be realized by a pump changeover, although this results in a different concept. TF5810 Version: 1.8.3 353
## Page 354

Knowledge Base 2a: Simulation of a synchronous cylinder with regenerative circuit Manufacturer / Product: Bosch Rexroth / application. Here, two pumps with flow rates adapted to the cylinder areas are operated on a motor shaft. The flow rates of pumps Q1 / Q2 must be adapted to the area ratio of rod cross-section / ring area. Since this is not always perfectly possible, complex pressure distributions can result, depending on the situation. The control results in the behavior of a synchronous cylinder with direction-independent feed constant. Hydraulically a differential cylinder is present and an exchange volume is to be stored. No gear shift is available. It can be realized by synchronous flow-switchable pumps. This results in a different concept. The oil volume in Q1 and the volume of lines through which only their flow rate flows must be smaller than the oil exchanged during operation for the cross-section of the piston rod. Otherwise there is no safe oil exchange. 354 Version: 1.8.3 TF5810
## Page 355

Knowledge Base Required parameters: Effective area in positive direction (1), effective area in negative direction (2), volume per revolution at the effective area in positive direction (3), maximum pump speed (4), maximum pump speed (5). Automatically calculated parameters: Volume per revolution at the effective area in negative direction. The ratio of the effective areas is used. Automatically set parameters: The selectable areas are 0, the rotation volumes for force mode are equal to the values for rapid mode. The flag for regenerative operation is set. 3: Gear shift through switching of effective areas Switching valves are used to make the effective areas of a cylinder effective or ineffective or to connect them in a variable manner. In some cases, 'virtual' areas are created which have to be taken into account in the oil quantity but do not contribute to force build-up. TF5810 Version: 1.8.3 355
## Page 356

Knowledge Base 3a: Use of a cylinder with 2+1 active areas Manufacturer / Product: EH-D. Rapid traverse switching: V1 and V2 (note valve symbol!) are switched off. V3 must be switched to extend the cylinder. If A1 and A3 are the same, no oil is exchanged with the reservoir. Otherwise, differential oil must be taken in via the RV or displaced via the DBV, depending on the direction. Force mode: V1 and V2 (note valve symbol!) are switched on. During extending, activation of V3 is mandatory. The oil quantity from A3 is supplemented for A1/A2 via the RV. Retracting is only possible in this configuration by displacing a considerable volume via the DBV. Heat is generated during this process. This combination of valve switching and direction of rotation of the pump is useful for pressure reduction, but it should not be used for active movement. Required parameters: Active area in extending direction = A1 (1), added active area in extending direction = A2 (2), active area in retraction direction = A3 (3), added active area in retraction direction = 0 (4), volume per revolution at active area in positive direction (5), maximum pump speed (6). Automatically calculated parameters: The volume per revolution on the active area in negative direction is set equal to the volume per revolution on the effective area in positive direction. Automatically set parameters: The rotation volumes for force mode are equal to the values for rapid mode. 356 Version: 1.8.3 TF5810
## Page 357

Knowledge Base 3b: Virtual area switching generation Manufacturer / Product: Voith Turbo / CLSP. In this case, the valves produce a gear shift. Rapid mode: During extending, V1a and V2b are activated. The oil quantity for the ring area is exchanged via V1a between the areas. The oil quantity for the rod cross-section is supplemented via V2b by the pump from the reservoir. Depending on the circuit, the rod cross-section is hydraulically supported. The cylinder has a low natural frequency and should be operated with adapted dynamics. During retracting, V1b and V2a are activated. The oil quantity for the ring area is exchanged via V1b by the pump between the areas. The oil quantity for the rod cross-section is diverted to the reservoir via V2a. Due to the circuit, area A2 is only subjected to the pre-load pressure of the reservoir. The cylinder is only to some extent able to brake by its own force. It should be operated with adapted dynamics. Force mode: During extending, V1b and V2b are activated. The oil quantity for the ring area is exchanged via V1b by the pump between the areas. The oil quantity for the rod cross-section is supplemented via V2b by the pump from the reservoir. Due to the circuit, area A2 is only subjected to the pre-load pressure of the reservoir. The cylinder is only to some extent able to brake by its own force. It should be supported and slowed down by the process. During retracting, V1b and V2b are activated. The oil quantity for the ring area is exchanged via V1b by the pump between the areas. The oil quantity for the rod cross-section is discharged via V2b through the pump to the reservoir. Due to the circuit, area A2 is only subjected to the pre-load pressure of the reservoir. The cylinder is only to some extent able to move by its own force. It must be checked whether it is able to overcome the forces generated by gravity and friction. This circuit should only be used to reduce forces generated in extending direction. TF5810 Version: 1.8.3 357
## Page 358

Knowledge Base Required parameters: Effective area in extending direction = rod cross-section (1), added effective area in extending direction = ring area (2), effective area in retraction direction = ring area (3), added effective area in retraction direction = 0 (4), volume per revolution at effective area in positive direction (5), maximum pump speed (6). Automatically calculated parameters: The volume per revolution on the effective area in negative direction is set equal to the volume per revolution on the effective area in positive direction. Automatically set parameters: The rotation volumes for force mode are equal to the values for rapid mode. 358 Version: 1.8.3 TF5810
## Page 359

Knowledge Base 3c: Virtual area switching generation Manufacturer / Product: EH-D / 18-0129-001-HY-K. In this case, the valves produce a gear shift. Rapid mode: During extending, activation of V1 is optional, activation of V2 and V3 is mandatory. The oil quantity for the ring area is exchanged via V3 / V1 between the areas. The oil quantity for the rod cross-section is added via V2 from the reservoir. Due to the circuit, area A1 is only subjected to the pre-load pressure of the reservoir. Due to the circuit, area A2 is only subjected to the pre-load pressure of the reservoir. The cylinder is only to some extent able to move by its own force. It must be checked whether it is able to overcome the forces generated by gravity and friction. This circuit should only be used to reduce forces generated in extending direction. During retracting, activation of V1 and V2 is mandatory, activation of V3 is optional. The oil quantity for the ring area is exchanged via V1 / V3 by the pump between the areas. The oil quantity for the rod cross-section is diverted to the reservoir via V2. Due to the circuit, area A2 is only subjected to the pre-load pressure of the reservoir. The cylinder is only to some extent able to brake by its own force. It should be operated with adapted dynamics. Force mode: During extending, activation of V1 is optional, activation of V3 is mandatory, activation of V2 is prohibited. The oil quantity for the ring area is exchanged via V3 / V1 by the pump between the areas. The oil quantity for the rod cross-section is supplemented via RV by the pump from the reservoir. Due to the circuit, area A2 is only subjected to the pre-load pressure of the reservoir. The cylinder is only to some extent able to brake by its own force. It should be supported and slowed down by the process. TF5810 Version: 1.8.3 359
## Page 360

Knowledge Base During retracting, activation of V1 is mandatory, activation of V3 is optional, activation of V2 is prohibited. The oil quantity for the ring area is exchanged via V1 / V3 by the pump between the areas. The oil quantity for the rod cross-section is diverted to the reservoir via DBV. Due to the circuit, area A2 is only subjected to the limiting pressure of the DBV. The cylinder is only to some extent able to move by its own force. It must be checked whether it is able to overcome the forces generated by gravity and friction. Required parameters: Effective area in retraction and extension direction = ring area (1, 3), added effective area in retraction and extension direction = rod cross-section (2, 4), volume per revolution at the effective area in positive direction (5). The added effective area in the extension direction must be marked as 'virtual' (7), since it must be taken into account when calculating the required speed, but does not contribute to the force build-up, maximum pump speed (6). Automatically calculated parameters: The volume per revolution on the effective area in negative direction is set equal to the volume per revolution on the effective area in positive direction. Automatically set parameters: The rotation volumes for force mode are equal to the values for rapid mode. 360 Version: 1.8.3 TF5810
## Page 361

Knowledge Base 3d: Virtual area switching generation Manufacturer / Product: Voith Turbo / PDSC. In this case, the valves produce a gear shift. Rapid mode: During extending and retracting, activation of V1 is mandatory. Part of the oil quantity from A2 is used regeneratively for A1, the remaining quantity is exchanged via pump with A3. Since A3=A1-A2, the behavior is synchronous, both hydraulically and from a control perspective. Force mode: During extending, activation of V1 is prohibited. Since the pressure in A1 is higher than the pressures in A2 and A3 due to the effect of the pump, the RV locks and the DBV connects A2 and A3. Since A1=A2+A3, the behavior is synchronous, both hydraulically and from a control perspective. Retraction in force mode is not possible since the RV generates the rapid mode configuration with hydraulic control. TF5810 Version: 1.8.3 361
## Page 362

Knowledge Base Required parameters: Effective area in retraction and extension direction = A3 (1, 3), added effective area in retraction and extension direction = A2 (2, 4), volume per revolution at A1 (5), maximum pump speed (6). Automatically calculated parameters: The volume per revolution at A2+A3 is set equal to the volume per revolution at the effective area in positive direction. Automatically set parameters: The rotation volumes for force mode are equal to the values for rapid mode. 3e: Virtual area switching generation 362 Version: 1.8.3 TF5810
## Page 363

Knowledge Base Manufacturer / Product: EH-D / ECO. In this case, the valves produce a gear shift. Rapid mode: During retracting, activation of VA1 and VA2 is mandatory, activation of VB2 is optional. Activation of VB1 and VA3 is prohibited. The pump conveys oil from A1 to A2; the portion originating from A2 for the rod cross- section is discharged via VA1 to the reservoir. During extending, activation of VA1 and VB2 is prohibited. Activation of VB1 and VA2 is optional. Activation of VA3 is mandatory. The oil quantity from A2 is used regeneratively via VA3 for A1, the remaining quantity is added via pump and VB1 from the reservoir. Force mode: During extending, activation of VA1 and VA3 is prohibited. Activation of VB1 and VA2 is optional. Activation of VA2 is mandatory. The oil quantity from A2 is used regeneratively via VB2 for A1, the remaining quantity is added via pump and VB1 from the reservoir. Retracting in force mode is not possible because the DBV would have to discharge the oil quantity for the rod cross-section at high pressure. For decompression of area A1, the pressure can be reduced in force mode, while activation of VB1 and VA2 is mandatory. Required parameters: Effective area in retraction direction = ring area (1), added effective area in retraction direction = 0 (2), effective area in extension direction = rod cross-section (3), added effective area in extension direction = ring area (4), volume per revolution at A1 (5), maximum pump speed (6). Automatically calculated parameters: The volume per revolution at A2 is set equal to the volume per revolution at the effective area in positive direction. Automatically set parameters: The rotation volumes for force mode are equal to the values for rapid mode. 5.5 Configuration of an axis In contrast to the Beckhoff NC, the axis in the hydraulic library is configured by the application itself. This means that the function blocks for operating an axis (read actual value, generate setpoints, generate position rules, linearization and output) must be called up individually. TF5810 Version: 1.8.3 363
## Page 364

Knowledge Base All function blocks work on a common axis reference, which must be created globally. If there is more than one axis, the axis references must be created as an array. In addition to the axis reference (AXIS_REF_Bk Plc Mc [} 86]), the I/O structures ST_Tc Plc Device Input [} 149] and ST_Tc Plc Device Output [} 153] must be declared for each axis. Further optional elements are added, depending on the application. To view messages a ST_Tc Plc Mc Log Buffer [} 156] should be declared. This buffer is shared by all axes. If other sensors such as pressure or load cells are used in the application in addition to position detection, the I/O value must be set in the application. The parameterization of the scaling can be managed in the f Customer Data[] section of the axis. For each axis 20 customer-specific data are provided in this section. This data is saved via the axis, loaded and displayed in the PLc Mc Manager. For the display in the Plc Mc Manager the label can be changed by declaring the structure ST_Tc Mc Aux Data Labels [} 149]. Sample for the data of an axis General settings An attribute must be set in Twin CAT 3 so that the I/O is always read in with a constant time interval, regardless of the time required by the program. In Twin CAT 2, the I/O flag at the start of the task must be set in the System Manager under PLC configuration. 364 Version: 1.8.3 TF5810
## Page 365

Knowledge Base In contrast to NC, the hydraulic axis itself (setpoint generator, controller, etc.) is calculated directly in the PLC. It is therefore recommended to set the cycle time of the task to less than 10 ms. Initialization The PLCopen standard specifies that all Motion function blocks of the application are called with an instance of type AXIS_REF_Bk Plc Mc. For technical reasons, some axis components cannot be contained in such an instance, since they must be located in separate areas (e.g. process images). Other elements are optional and are only be added if required. To link them to the axis reference, they are transferred to an initialization function block of type MC_Ax Uti Standard Init_Bk Plc Mc [} 254]. When called for the first time, the function block links the input and output structures and all optional elements with the axis reference. Variables that have to be passed as addresses are marked with the prefix "p". The function block should be called cyclically to check the pointer addresses. It is not permitted to bind an instance of ST_Tc Plc Device Input, ST_Tc Plc Device Output or ST_Tc Mc Auto Udent to multiple axes. It is not permitted to connect more than one instance of ST_Tc Mc Log Buffer to axes. The function block loads the parameters from the given file path and transfers them to the axis reference. All parameters are stored in binary form in an Axis name.dat file. Once the parameters have been loaded successfully, the b Params Enable flag in the axis reference becomes TRUE. Only now is the use of parameters that have not yet been defined ruled out, and all other axis-related function blocks may be called. TF5810 Version: 1.8.3 365
## Page 366

Knowledge Base Actual value acquisition The encoder type set in the parameter structure of the axis reference determines how and from which variables of the input structure the MC_Ax Rt Encoder_Bk Plc Mc [} 198] function block will read the actual value and convert it to a position [mm] and a velocity [mm/s]. The connection is monitored when Ether CAT components are used. If the actual values are very noisy, it is possible to filter them via a sliding average value (MC_Ax Uti Sliding Average_Bk Plc Mc [} 269]) or a Pt1 element (MC_Ax Uti PT1_Bk Plc Mc [} 267]). The use of custom filters is possible. Filter function blocks must be called after the encoder function block. The variable to be filtered must be passed to their input. The result can be written back to the corresponding variable of the axis reference. This causes the old noisy value to be replaced by a new, stabilized value. If a heavily filtered actual value is used for control purposes, the dynamics and controllability can be affected due to the filter jump response. Additional function blocks are available for reading in pressure and force values. The function block to be used depends on the variable to be measured. In contrast to position determination, for force and pressure determination the mapping interface and terminal monitoring must be provided by the application. MC_Ax Rt Hybrid Axis Actuals_Bk Plc Mc [} 224] is an adapted function block for determining the essential actual values of a servo-electric/hydraulic hybrid axis. Setpoint generation and default position controller If, for example, MC_Move Absolute_Bk Plc Mc [} 73] triggers an active movement of the axis, the setpoint generator calculates the current values for the set velocity and the set position in each cycle. This can be done in a time-controlled or path-controlled manner. Permanent position control is required for time- controlled generation, otherwise this is only required at standstill. Several profile variants are supported. For more information, please refer to the documentation for the function block. MC_Ax Runtime_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID BOOL Lag Error If the axis does not have a command buffer, a command is entered directly in the runtime data of the axis. Otherwise, commands are buffered, subjected to path planning, and then made effective according to the blending rules. If required, the application can handle the setpoint generation. An MC_Ax Rt Set Ext Gen Values_Bk Plc Mc [} 252] function block must be used for this purpose. If external generation is active, the library block to be called is switched to a passive state and then reactivated. In this way, application-specific gear units and other non- standard mechanisms can be realized. The setpoint generator and a default position controller that is adequate in most cases are integrated in the MC_Ax Runtime_Bk Plc Mc [} 237] function block. 366 Version: 1.8.3 TF5810
## Page 367

Knowledge Base Alternative position controller If another controller is called after the default position controller and f Lag Ctrl Output is overwritten in the runtime data of the axis reference, another position controller can be activated. This can be a customer- specific controller or another controller from the library such as the FB MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc [} 185]. MC_Ax Rt Pos Pi Controller Ex_Bk Plc Mc Reset BOOL LREAL Set Pos I_Enable BOOL LREAL Set Velo ↔ Axis Reference To AXIS_REF_Bk Plc Mc LREAL Response BOOL In Windup This library controller is a PID controller with optional extensions such as condition feedback and acceleration pre-control. Further controllers Pressure or force controllers are used in many applications with hydraulic axes. As an example, an MC_Ax Ctrl Pressure_Bk Plc Mc [} 172] function block is shown here. MC_Ax Ctrl Pressure_Bk Plc Mc Enable BOOL BOOL Error Reset BOOL UDINT Error ID First Aux Param Idx INT BOOL In Windup k P LREAL Tn LREAL Reading Mode E_Tc Mc Pressure Reading Mode Pre Set LREAL Windup Limit LREAL Align Areas BOOL ↔ Axis Reference To AXIS_REF_Bk Plc Mc In the active state, the function block overwrites the output of the setpoint generator. In order for the controller response to take effect, it must be called up before linearization. When activating or deactivating, step changes in the control values of the axis can occur depending on the parameter values. Final processing At this point, the control values of the axis are present in a form that assumes linear behavior of the axis and its components. In practice, this is rarely the case. To take this into account, the control values (setpoints, controller outputs, overlap compensation) are combined to an output value and subjected to linearization. This adjustment can be carried out in sections or based on characteristic curves. Sectional linearization The library provides the function block MC_Ax Rt Finish_Bk Plc Mc [} 246] for simple linearization. MC_Ax Rt Finish_Bk Plc Mc ↔ Axis Reference To AXIS_REF_Bk Plc Mc BOOL Error UDINT Error ID The set velocity weighted with the pre-control and the controller output are added to the output velocity. An active overlap compensation is selected such that it is ramped linearly from zero to the set overlap compensation Ovl between 0 and V . It is fully effective for the remaining area. Creep TF5810 Version: 1.8.3 367
## Page 368

Knowledge Base The direction dependency is compensated. The output velocity is multiplied by f Area Ratio from the axis parameters if the velocity is positive and f Area Ratio ≥ 1.0. If the velocity is negative and f Area Ratio ≤ 1.0 division is applied. The output is formed by adding the weighted target velocity, the controller output, the active overlap compensation and the offset correction. Linearization based on characteristic curve The library provides the function block MC_Ax Rt Finish Linear_Bk Plc Mc [} 247] for this linearization with higher resolution. If the use of the characteristic curve is not enabled or not possible, an internal function block is used for sectional linearization. This is the case if at least one of the following reasons applies: • FALSE is transferred at the enable input of the function block. • No instance of type ST_Tc Mc Auto Ident has been linked to the axis reference. • b Lin Tab Available in the axis parameters is FALSE: The characteristic curve is not valid. Otherwise, the target velocity weighted with the pre-control and the controller output are added to the output velocity. The two characteristic curve points closest to the calculated value are determined and the output value is formed by intermediate interpolation and addition of the offset correction. 368 Version: 1.8.3 TF5810
## Page 369

Knowledge Base Characteristic curve measurement The function block MC_Ax Uti Auto Ident_Bk Plc Mc supports the measurement of a characteristic curve by means of a standardized automatic sequence. The parameters to be set for this are stored in the structure ST_Tc Mc Auto Ident [} 128]. If a characteristic curve measurement and a characteristic curve-based linearization are to be used, such an element must be created and connected to the axis reference. An MC_Ax Uti Auto Ident_Bk Plc Mc function block must be called after the MC_Ax Rt Finish Linear_Bk Plc Mc [} 247] function block and before the MC_Ax Rt Drive_Bk Plc Mc [} 187] function block of the axis. The characteristic curve determined in this way combines the influences of a number of sources: • Non-linearities of the valve • Asymmetry of the cylinder • Flow effects at higher velocities • Possible limitations due to a pump • Positional influences such as gravitation • Influences of other components in the oil flow With a servo-electric/hydraulic hybrid axis, no MC_Ax Uti Auto Ident_Bk Plc Mc function block may be activated. Output adjustment At this point, the control values for the axis are available as physical or standardized parameters. Only the MC_Ax Rt Drive_Bk Plc Mc [} 187] function block determines an output parameter that represents these parameters in a form that is converted to the desired response by the device used. The method used and its parameters are set in the parameter structure of the axis reference. Interfacing of the Plc Mc Manager In preparation. The Plc Mc Manager is connected via the Twin CAT ADS service. Since this allows only one port per application, all axes must use a common connection. Multiple instances of this function block are not permitted. TF5810 Version: 1.8.3 369
## Page 370

Knowledge Base The sample shown applies to an application with only one axis. Multi-axis projects must combine the axis references in an array whose address and first and last index are transferred. This FB must be called independently of whether axes can load their parameters. Message logging All axes of an application share a logging buffer. To send the messages that arrive there to the Event Log of the operating system and, if available, to the message window of the development environment, create an instance of the function block MC_Ax Rt Logger Spool_Bk Plc Mc [} 259] for each application. The call of the function block is independent of whether axes can load their parameters. 5.5.1 FB_Power The function block manages the axis enables. A distinction is made between controller enable and direction- dependent feed enable in positive and negative direction. Feed enable is an internal enable for the setpoint generator, whereas controller enable is used for the position controller and also for the output stage of drives. 5.6 The Plc Mc Manager The Plc Mc Manager supports commissioning and testing of axes, which are automated using the hydraulics library. It visualizes the actual state and enables access to parameters and triggering of commands. The Plc Mc Manager is not intended for operating machines and systems. It is not a substitute for a user interface. For your safety WARNING Risk of injury due to unexpected machine behavior! The commands triggered by the Plc Mc Manager can obstruct automatic actions and responses of the control software obstruct or influence them in an unexpected or undesirable direction. This may result in unexpected and dangerous movements. • Make sure that neither you nor others are harmed by the movement, e.g. by maintaining a suitable safety distance. • Do not carry out any action whose consequences you cannot assess. Installation For Twin CAT 2: A license-free copy of the Plc Mc Manager is provided with the library or the documentation. Select a suitable path, then create a shortcut on the desktop of the PC. Without such a shortcut, the Plc Mc Manager can only be started from Explorer. 370 Version: 1.8.3 TF5810
## Page 371

Knowledge Base For Twin CAT 3: When downloading the library, a license-free copy of the Plc Mc Manager is created in the directory C:\Twin CAT\Functions\TF5810-TC3_Hydraulics-Positioning. If your Twin CAT not installed under to C: or in another directory, the path must be adjusted accordingly. Running the Plc Mc Manager If the tool is stored on the PC, it can be started by double-clicking. Offline display of a parameter file In the menu bar under Online you will find the Offline file mode, where a dialog for selecting an axis parameter file of type DAT is offered. When a file is opened, the axis parameters are show like in online mode, as far as possible. No actual axis states are shown, and no axis commands can be triggered. This also applies if the displayed parameters belong to an axis, to which access would be possible. Online operation If the runtime system with the library function blocks is not present on the PC on which the Plc Mc Manager is running, the target system has to be selected first. In the menu bar under Online you will find the Target dialog, where the computers are listed that are entered as Remote Computers in Twin CAT System Service on the AMS Router tab. By selecting a Remote Computer, the communication with the runtime system is activated automatically. If the runtime system with the library function blocks is present on the PC on which the Plc Mc Manager is running, the communication with the runtime system can be activated with Login via the menu bar under Online. In the current versions the Plc Mc Manager is prepared for use under Twin CAT 3. To establish the connection at runtime, it checks the expected ADS addresses for both Twin CAT 2 and Twin CAT 3. This may take several seconds, particularly if a network connection is used. The details shown below should then appear. TF5810 Version: 1.8.3 371
## Page 372

Knowledge Base 1. Shows the port and the server used for the communication with the runtime system. 2. The mode is displayed. Since no axis has been selected up to this point, the Plc Mc Manager is still in OFFLINE mode. 3. Shows the version information of the library used by the PLC application. If these details do not appear after a few seconds, the connection has failed. This can have a number of reasons: • No target system was selected, despite the fact that the application is not running on the same computer as the Plc Mc Manager. • The PLC application does not contain a MC_Ax Ax Ads Comm Server_Bk Plc Mc [} 279] function block or does not call it. • The application is not running on the selected target system. • No connection to the selected target system. • The PC on which the Plc Mc Manager is running has no access rights to the selected target system. • The PLC is not running. If a dialog with an error message appears at this point, the connection to the target system is disturbed (timeout), or the Plc Mc Manager and the library used in the application are not compatible. Incompatibility is usually due to a new library version being used, without updating the Plc Mc Manager. Many parameter input fields have a "?" field on the left-hand side. This can be used to call up a brief explanation of the parameter. Sample: Explanation of the parameter <Global. Creep Distance>: 372 Version: 1.8.3 TF5810
## Page 373

Knowledge Base First steps Double-clicking on the server shown on the left displays the axes used in the application as a list. Click on an axis to select it. Its status is then cyclically updated, and its parameter are accessible. If the communication fails for some reason, it can be restarted by clicking on an axis. This example shows the file path and name used for this axis. However, an Init Error 1804 (0x70C) and an Init State of -2 are reported. The error code indicates a file error and the Init State is "negative terminated". There are several possible causes for this: • The path does not exist on the computer where the PLC application is running. Problems can easily arise if the application goes online for the first time on another system. TF5810 Version: 1.8.3 373
## Page 374

Knowledge Base • The path is not accessible from the location of the PLC runtime. This is possible, for example, if the path points to a network. • Reading and/or writing is not allowed on this path. • The path or file name is not spelled correctly. The backslash may be missing at the end of the path name. • There is no corresponding file under the specified path name. The last cause listed always occurs when commissioning of a PLC application is started without an existing file. To create a file with default parameters, press the [Save] key to initiate a write operation with the initial parameter values. The [Reset] key deletes the error state, and in this case the loading of the parameters from the file is repeated. If the problem cannot be solved by this procedure, it is caused by another of the listed causes. Data and commands The Plc Mc Manager only graphically displays variables from the PLC. Runtime values can be found in the Axis Ref in st Rt Data. Parameters that are changed via the Plc Mc Manager must actively be written to the variables of the PLC via the Activate button. All values that have to be saved permanently are stored in the Axis Ref under st Ax Params. These parameters are saved by the PLC, not by the Plc Mc Manager. If the axis is controller and feed enabled by the PLC with an MC_Power_Bk Plc Mc function block, it can be moved using the jog keys (<, <<, >>, >). At this time it is still a simulated axis. The axis can also be commanded via the Position and Velocity fields. The movement command is executed via the Start button. 5.7 Sample programs Available from version 3.0 Structure of the application The application is largely made up of PLCopen function blocks. A selection of function blocks is available, which are equipped with an interface defined by the PLCopen. A number of examples are described below, which provide a good basis for project configuration. Each example contains the project file, the required axis parameter files and a scope configuration. The axis parameter files must be stored in a folder on the target system. The file path must be adjusted in the global constant "cnst_Param File Path" of the project file. Example 1: Single axis For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599853451.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937463179.zip The MC_Ax Uti Standard Init_Bk Plc Mc [} 254] function block loads the parameters and monitors the pointer addresses. After the data has been loaded successfully, "b Params Enable" becomes TRUE and the actual axis blocks are called. MC_Ax Standard Body_Bk Plc Mc [} 253] internally calls the required function blocks such as MC_Ax Rt Encoder_Bk Plc Mc [} 198], MC_Ax Runtime_Bk Plc Mc [} 237], MC_Ax Rt Finish_Bk Plc Mc [} 246] and MC_Ax Rt Drive_Bk Plc Mc [} 187]. However, if a filter, a pressure regulator, a characteristic curve measurement or similar is required, the individual components must be called instead of MC_Ax Standard Body_Bk Plc Mc [} 253]. By using a MC_Ax Ads Comm Server_Bk Plc Mc [} 279] function block the axis can be commanded via the Plc Mc Manager. The MC_Ax Param Delayed Save_Bk Plc Mc function block saves changes made by the Plc Mc Manager after a given time (here 10 s). Via the Plc Mc Manager you can log onto the target system and actively move the axis. 374 Version: 1.8.3 TF5810
## Page 375

Knowledge Base Example 2: Multi-axis application For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599855627.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937465739.zip The example illustrates a configuration with arrays of function blocks and structures. The range of functions corresponds to example 1. Example 3: Pressure-controlled braking For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599857803.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937468299.zip The example shows how the pressure regulator MC_Ax Ctrl Slow Down On Pressure_Bk Plc Mc [} 178] throttles the feed rate of an axis depending on the pressure. In this example, the controller becomes active when the actual pressure exceeds the set pressure. Since the result is transferred via an application code to "f Lag Ctrl Output", the controller must be called after the setpoint generator. Otherwise, f Lag Ctrl Output would be overwritten by the position controller in MC_Ax Runtime_Bk Plc Mc [} 237]. If a command is started in the Plc Mc Manager with a velocity of 100 mm/s and a position of 500 mm, for example, the scope shows that the pressure increases continuously with increasing position. At a position of 400 mm, the system has reached the set pressure of 50 bar and stops. Example 5: Move function blocks For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599859979.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937547659.zip In this example, various function blocks are used for motion control. If the variable b Start becomes TRUE, the state machine starts the axis with MC_Move Absolute_Bk Plc Mc [} 73] to the position 500 mm. When the axis has reached the target and the target window conditions are met (in Pos Rang, in Target Range for Target Filter Time and in Brake Distance), a MC_Move Velocity_Bk Plc Mc [} 79] automatically starts with a velocity of 400 mm/s. This velocity remains active for 5 seconds and is then terminated with MC_Stop_Bk Plc Mc [} 82], so that the axis comes to a standstill. This is followed by a relative movement of 100 mm with MC_Move Relative_Bk Plc Mc [} 77] and a move to position 0.0 mm. Different acceleration and deceleration ramps are used in the different motion profiles. Example 6: Time ramp generator For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599862155.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937550219.zip An axis without encoder cannot be controlled via the standard setpoint generator. For this type of axis, i Tc Mc_Profile Time Ramp [} 241] provides an alternative setpoint generator. If the variable "b Up" or "b Down" is TRUE in the global variables, the axis moves at the specified velocity (here 500 mm/s) to the first limit switch (Dig Cam P – for positive/ Dig Cam M – for negative) and then slows down to the corresponding creep velocity. After reaching Dig Cam PP – for positive/ Dig Cam MM – for negative the output is deleted. Example 7: Override and function generator For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599864331.zip TF5810 Version: 1.8.3 375
## Page 376

Knowledge Base For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937552779.zip Demonstration of the function block MC_Set Override_Bk Plc Mc [} 41]. Global variables (b Override Sinusoidal, f Override Cycle Time, f Override Min Value, f Override Max Value) can be used to specify the sequence, the period and the limitations of a signal generator, which modifies the override. Function blocks of type MC_Function Generator FD_Bk Plc Mc [} 226], MC_Function Generator TB_Bk Plc Mc [} 228] and MC_Function Generator Set Frq_Bk Plc Mc [} 227] are used for generating the override. Example 8: Digital cam controller For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599866507.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937555339.zip The example shows how to control digital cams through an axis and MC_Digital Cam Switch_Bk Plc Mc [} 54]. In the example two cams are activated in TRACK_REF_Bk Plc Mc [} 126] (maximum 32). The first cam is activated under three different conditions: 1. from position -1000 mm to 1000 mm and positive direction 2. from position 2000 mm to 3000 mm and positive direction 3. from position 3000 mm to 2500 mm and negative direction The second cam has only one condition: 1. to be active in positive and negative direction for a time of 1.35 s from position 3000 mm. In addition to the switching conditions, a cam can also have a switch-on and switch-off delay. For cam 1, the switch-on delay is set to 0.125 s and the switch-off delay is set to 0.250 s. The conditions for switching a cam are specified in CAMSWITCH_REF_Bk Plc Mc [} 123]. The output of a cam is specified in OUTPUT_REF_Bk Plc Mc [} 126]. The axis must be commanded via the Plc Mc Manger (position greater than 3000 mm). Example 9: Joystick For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599868683.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937557899.zip The example demonstrates the use of the function block MC_Move Joy Sticked_Bk Plc Mc [} 75]. With this function block, the axis is moved in an endless motion at a velocity specified by Joy Stick. Joystick is a normalized value between +/-1.0, which, multiplied by the commanded velocity, results in the set velocity. Example 10: Identification and linearization For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599870859.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937611659.zip The example describes the automatic characteristic curve measurement with MC_Ax Uti Auto Ident_Bk Plc Mc and the use of the characteristic curve with MC_Ax Rt Finish Linear_Bk Plc Mc [} 247]. The settings for the automatic characteristic curve measurement are accessible in the Plc Mc Manger under the Lin Def tab and can be found in the structure ST_Tc Mc Auto Ident [} 128]. In the example, you can choose between three different valve simulations using the global variable n Test. A suitable .dat file is loaded according to the selected simulation. The parameters for the characteristic curve measurement are preset in the .dat file as required. Note: If n Test is switched while the PLC is running, the Plc Mc Manager must be reconnected. The following scenarios can be selected via n Test: 1. Only the overlap and velocity ratio is missing 2. A zero overlap characteristic curve with bend is missing 376 Version: 1.8.3 TF5810
## Page 377

Knowledge Base 3. A characteristic curve with overlap is missing The variable "b Start Auto" can be used to start MC_Ax Uti Auto Ident_Bk Plc Mc. During the measurement, the function block returns a busy and the already measured characteristic curve is displayed on the Lin Tab tab. If the measurement was successful, the characteristic curve can be used by the function block MC_Ax Rt Finish Linear_Bk Plc Mc [} 247]. The characteristic curve is automatically saved and loaded in the .dat file of the axis. The function block MC_Ax Table To Asci File_Bk Plc Mc [} 234] is available for exporting the characteristic curve in an ASCII-readable format. Example 11: Stop function blocks For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599873035.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937614219.zip The different ways of stopping an axis are compared here. The example can be started by setting the variable b Start to TRUE. MC_Stop_Bk Plc Mc [} 82]: Executes a stop with preset deceleration parameters. The axis reports ready when the calculated target including target tolerances (in Pos Range, in Target Range for target filter time and in Brake Distance) has been reached. MC_Emergency Stop_Bk Plc Mc [} 57]: Brakes with preset ramp to standstill. MC_Imediate Stop_Bk Plc Mc [} 72]: Sets the set value to zero without ramp. Example 12: Buffering and blending For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599875211.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937616779.zip The basic procedure for buffered movements is explained in FAQ 20 [} 334]. To start the example, the variable b Start must become TRUE. The Scope View shows that there are six movements, which are processed in coupled mode. Example 13: Filter For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599877387.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937619339.zip The example shows the behavior of several filter types and what to consider when using filters. If all signals with the name "Noisy" are switched off in Scope View, the original signal and the filtered signals can be seen with corresponding offsets. The shape of the signal is retained. The more a signal is filtered, the stronger the phase shift between the original and filtered signal. This phase shift has a direct influence on the controllability of axes and other sections. If the noisy signals are made visible in the Scope, it can be seen that the noise portion in the signal is considerably lower both through a MC_Ax Uti Sliding Average_Bk Plc Mc [} 269] and after a MC_Ax Uti PT1_Bk Plc Mc [} 267]. Example 14: Function generator For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599879563.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937621899.zip TF5810 Version: 1.8.3 377
## Page 378

Knowledge Base In some applications, a setpoint generator is required to generate sinusoidal, trapezoidal or sawtooth signals. For example, the signals generated with MC_Function Generator TB_Bk Plc Mc [} 228] and MC_Function Generator FD_Bk Plc Mc [} 226] can be transferred to an axis via MC_Ax Rt Set Ext Gen Values_Bk Plc Mc [} 252]. Example 15: Pressure regulator For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599881739.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937624459.zip The example shows the reading and scaling of an actual pressure value in the application. A pressure control for an axis with MC_Ax Ctrl Pressure_Bk Plc Mc [} 172] is demonstrated. The application first moves to a position at which a pressure increase is expected via a fast movement. The movement continues at a slower velocity and the controller is activated when the set pressure has been reached. Example 16: Distributed axis references For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599883915.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937627019.zip The example shows the use of a list of POINTER TO Axis_Ref_Bk Plc Mc. The use of MC_Ax Ads Ptr Arr Comm Server_Bk Plc Mc [} 281] instead of MC_Ax Ads Comm Server_Bk Plc Mc [} 279] makes it possible to distribute the axis references. The list must be updated in each cycle. This update must be carried out before calling MC_Ax Ads Ptr Arr Comm Server_Bk Plc Mc [} 281]. Sample 17: External setpoint generation For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 6407024139.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 9326778891.zip The simple sample shows the basic use of a function block of the type MC_Ax Rt Set Gen Values [} 252]. Example 18: Locking Plc Mc Manager For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599886091.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937629579.zip It may be necessary to disable Plc Mc Manager commands such as Jog, Move Abs or Stop. This can be done in the PLC with MC_Ax Rt Commands Locked_Bk Plc Mc [} 262]. Sample 19: External setpoint generation For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 9326087819.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 9326781195.zip Here, a larger project demonstrates the possibilities of the external setpoint generator. 378 Version: 1.8.3 TF5810
## Page 379

Knowledge Base Example 100: Electronic gearing For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599888267.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937663627.zip The example shows how two slave axes can be coupled by an electronic gearing via a master axis (axis 3). The coupling is created and released by MC_Gear In_Bk Plc Mc [} 63] and MC_Gear Out_Bk Plc Mc [} 67]. It must be ensured that the dynamic parameters of the master and slave are compatible with each other, otherwise the slave cannot follow the master. To establish the coupling, the master and slave must be in idle state. The coupling can be released during the motion. The master axis moves to the target and the slave axis is stopped when the coupling is released. Example 101: Electronic cam plate For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599890443.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937666187.zip Axes 1 and 2 are coupled to virtual axis 3 via a cam plate. In this example, the coupling parameters for axis 1 are stored in the text file Tc Plc Mc Ex_101_2.txt. For axis 2, the coupling parameters are calculated in function block "FB_Calculate Cam Table2". MC_Cam Table Select_Bk Plc Mc [} 53] is used to specify the master and slave axis and the cam table. In function block MC_Cam In_Bk Plc Mc [} 49] the coupling is generated and the set values for the slave are calculated. If the master axis is moved via the Plc Mc Manager, the slave axis follows the corresponding cam plate. The coupling is canceled with MC_Cam Out_Bk Plc Mc [} 51]. Example 103: Flying gear coupling For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599892619.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937668747.zip Demonstration of an activated flying gear coupling with function blocks MC_Gear In Pos_Bk Plc Mc [} 65] and MC_Gear Out_Bk Plc Mc [} 67]. Example 104: Synchronization control For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599894795.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937671307.zip Demonstration of a synchronization control for a two-axis gantry using a virtual master. Synchronization control is always used where two or more axes have to be controlled in a balanced manner. A virtual master axis is used for generating the set values. The set values are distributed to the slave axes, which add their local position controller. For example, the current position of the virtual master axis is calculated as an average value over the slave axes. In order to ensure smooth commissioning, it is essential that certain parameters are kept the same. This applies in some cases within the group of slave axes, partly also for the master axis. In "FB_Parameter" this is forced by cyclic copying. Example 105: Linearization for synchronization control For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 1599896971.zip TF5810 Version: 1.8.3 379
## Page 380

Knowledge Base For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 4937673867.zip This example demonstrates the characteristic curve determination for a two-axis gantry (see also example 104) with the function blocks MC_Ax Uti Auto Ident_Bk Plc Mc and MC_Ax Uti Auto Ident Slave_Bk Plc Mc. Sample 106: Flying coupling For Twin CAT 2: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 9326092427.zip For Twin CAT 3: https://infosys.beckhoff.com/content/1033/tf5810_tc3_hydraulic_positioning/Resources/ 9326783499.zip Some of the possibilities offered by the flying coupling and uncoupling of an electronic gear unit are illustrated here. 5.8 Commissioning The procedure described here refers to basic commissioning of an axis of which nothing is known. With identical axes, certain points can be skipped. 5.8.1 Basic settings In order to start up the real axis, various default settings must be applied. The corresponding encoder type must be entered in the General tab. To do this, the corresponding encoder must be selected via the selection menu and written to the runtime variables via Activate. The currently active type is displayed to the left of the selection window. The Knowledge Base contains a table [} 324], which helps to select the correct encoder type and explains the mapping interface to I/O. If, for technical reasons, it is not possible to determine the actual position with the standard encoder function block of the library, this task can also be executed by application function blocks. Then enter the result in f Act Pos and f Act Velo in ST_Tc Hyd Ax Rt Data and update the position change in the current cycle in f Act Pos Delta. b Encoder Response should be used to indicate whether the actual values could be updated. For the sake of uniformity use should again be made here of the f Enc_Inc Weighting, f Enc_Inc Interpolation and f Enc_Zero Shift or f Enc_Ref Shift parameters. 380 Version: 1.8.3 TF5810
## Page 381

Knowledge Base A range of devices and equipment might be functioning as actuators (Drivetyp), applying a variety of physical principles to create a variable velocity that depends on an electrical magnitude. Depending on the corresponding I/O component, the Drivetype must be set in the selection window and the variables must be linked to the field device. The Knowledge Base contains a table [} 327] which supports the selection of the type to be set. If the position measuring system is an incremental system, the corresponding referencing method [} 103] must also be defined. On the Global tab you should initially enter 100 for the reference velocity. The value is corrected later, but in this way, overlap etc. can be entered directly in %. The acceleration and deceleration should be set to 100 mm/s². With this setting, this axis will accelerate to reference velocity in 1 s. The jog parameters should be set to 5 mm/s and 10 mm/s. The creep velocity should be set to 5 mm/sec, the creep distance should be 10 mm and the braking distance 2 mm. If the valve is covered and the valve data sheet is available, you can enter the overlap from the data sheet on the Valve tab. On the Encoder tab, enter the resolution per increment in Inc. evaluation. Alternatively, an increment number can also be specified in Inc. interpolation and the corresponding path in Inc. evaluation. In the Controller tab, the lag and velocity controller must be set to zero. For further commissioning, a Scope with the following variables should be recorded: • Set Velo • Act Velo • Set Pos • Act Pos • f Output • f Lag Ctrl Output If available, record pressures, forces and valve slide position. If the controller enable and feed enable of the axis are set, the axis must not move. If this is the case, a temporary zero balance must be carried out. 5.8.2 Temporary zero compensation The Offset compensation parameter is set in the Controller tab. Depending on the direction in which the axis is drifting, a value between -10 V and +10 V must be entered. As a rule, values of +/- 0.5 V are to be expected. 5.8.3 Movement directions The jog button should be used to move the axis slowly. If this is not the case, the pressure supply must be checked. Furthermore, switching valves may also have to be operated or the compensation of the valve overlap is set too small. It is recommended to specify a positive direction of movement for the axis that corresponds to the way the machine works. If the axis moves in this direction, the actual position should count upwards. If this is not the case, the counting direction can be inverted on the Encoder tab. If the direction of change of the indicated position corresponds to the mechanical movement, but the direction of action of the given commands is not as desired, the output can be inverted on the Valve tab. When the valve output is inverted, the offset compensation must be adjusted, as it is not inverted and its effect is reversed. TF5810 Version: 1.8.3 381
## Page 382

Knowledge Base 5.8.4 Position measuring system The axis should show a plausible actual position for both an absolute and an incremental position measuring system. The zero point of the encoder and the defined zero point of the axis usually do not coincide. On the Encoder tab, you can enter the desired current position and transfer it to the axis via the Set-Pos button. At this point in time, this set position does not have to match the actual position exactly. Especially with incremental measuring systems, homing is carried out later on. The Plc Mc Manager adapts the display of the parameters as far as possible to the set encoder type. As a result, different parameters can be visible for different axes. For incremental encoder types, the diagram shown above appears. The visibility of the parameters for homing depends on the set homing method. To avoid collisions during commissioning, the software limit switches should be activated and set appropriately in the Monitor tab. Since the actual position can differ slightly from the actual position, it is recommended to set the software limit switches a little closer. 5.8.5 Characteristic curve measurement The characteristic curve measurement (MC_Ax Uti Auto Ident_Bk Plc Mc) not only determines the characteristic curve itself, but also the reference velocity, the velocity ratio and the optional travel distance limits. For more information on the setting options, see the function block itself. The reference velocity should be preset to an approximate plausible value. One possibility is to calculate the smaller cylinder area (A [mm²]) with the nominal volume flow (Qn [l/min)] of the valve: Vref:= Qn*1.000.000/60/ A The Lin Def tab can be used to implement various settings. Further information can be found here. 382 Version: 1.8.3 TF5810
## Page 383

Knowledge Base If this is activated, the Auto Ident function block starts by first determining the travel limits. The axis is then positioned at a distance of at least 10 % from the travel limits, in order to determine the overlap. Once this has been carried out successfully, the axis moves to the lower end and starts measuring. Depending on the available travel path, several measurements are carried out in each direction. Once the characteristic curve has been successfully measured, it can be viewed in the Lin Tab tab. A successfully measured characteristic curve can be recognized by the fact that st Params.b Lin Tab Avaiable is TRUE. The chapter Coverage and reference velocity should be skipped if the characteristic curve was measured successfully. 5.8.6 Overlap In order to determine the overlap, the set velocity must be increased slowly until a response by the actual velocity can be recognized. It is possible that the set velocity must be increased to a value of up to 30 mm/s before a response of the actual velocity can be seen. When measuring the overlap, the overlap itself should always be set to zero. If different velocity set values are required in order to move the axis in positive or negative direction from standstill, this indicates an asymmetric valve. In this case the check mark Asym in the Global tab must be set and activated. The valve can now be parameterized separately in positive and negative direction. The set velocity at which the axis moves must be entered under Overlap in the "Valve" tab. If the overlap has already been assigned a value, this value must be taken into account. For asymmetric valves ensure that the entry is made in the correct field; the overlap for the positive direction is expected in the upper field, the overlap for the negative direction in the lower field. After this optimization the axis should also respond at different small velocities. Whether the axis responds with the right velocity is not important. If an overlap has been entered from the data sheet and the axis always moves too fast, the overlap should be reduced. 5.8.7 Reference velocity/velocity ratio This chapter describes manual commissioning. A characteristic curve measurement also determines the parameters discussed here. If it is used, this chapter should be skipped. Once the axis can be moved at low velocity, the reference velocity must be set. In order to determine the reference velocity, the set velocity is increased step-by-step, and a check is carried out to determine whether the axis follows with approximately the set velocity. In this step, only movements in the faster direction are to be evaluated. The oil is transported into the small piston surface! The next step deals with directional dependency. To trigger the required movements, the position and velocity can be specified in the Status tab. The movement is executed with the Start button. The previously created Scope View should be used to analyze the velocities. The software limit switches should be activated and set so that the axis does not hit the mechanical limit stops. TF5810 Version: 1.8.3 383
## Page 384

Knowledge Base If the actual velocity is much lower than the set velocity, the reference velocity should be reduced. If the actual velocity is much higher than the set velocity, the reference velocity should be increased. The appropriate reference velocity has been found when the medium to high set and actual velocities almost match. The reference velocity does not have to correspond to the actual or calculated maximum velocity of the axis. The following diagram shows the linearization section-by-section through overlapping and reference velocity with a non-linear characteristic curve. It is left to the user to decide where the maximum deviation between the linearization and the actual characteristic curve can occur. 384 Version: 1.8.3 TF5810
## Page 385

Knowledge Base The usual asymmetry of the cylinders causes the axis to move too slowly in the slower direction at any commanded velocity when the reference velocity is set. This behavior can be compensated for on the Valve tab by using the velocity ratio parameter. When the behavior is symmetrical, this parameter should be set to 1,000. If the positive direction of travel is the slower direction, use a value greater than 1,000. If the negative direction of travel is the slower direction, a value less than 1,000 should be used. This increases the output in the slower direction and compensates for the asymmetry. With this compensation, the output can only be increased up to its maximum value. The parameterization must be carried out at velocities that the axis can reach in both directions. If the parameter is changed in the wrong direction, the velocity decreases in the faster direction. In this case the reference velocity must not be corrected. 5.8.8 Referencing For incremental position measuring systems: Now at the latest, the axis should be referenced correctly and fully. Enter the index velocity, index direction, sync velocity, sync direction and the reference position under the Encoder tab. For more information see MC_Home_Bk Plc Mc [} 68]. It may be necessary to reset the travel limits. 5.8.9 Dynamics/target approach At this point in time, the axis is able to position with different velocities and moderate dynamics. On the Monitor tab you can set when the axis should report ready. An axis is in the target if the remaining distance is smaller than Pos Range and Brake Distance; for the Target Filter Time the remaining distance must be smaller than Targetrange. These three parameters must be set appropriately according to the application requirements. TF5810 Version: 1.8.3 385
## Page 386

Knowledge Base The user subsequently has to decide whether the axis should be positioned time-based or displacement- based. Most hydraulic applications can be operated path-controlled. If, however, time-based profile generation is necessary, the Time Based check mark should be set. 5.8.9.1 Displacement-based axis The position controller is only active for the target approach. The acceleration can be set so steeply that the axis gently accelerates without significant jerks when it starts moving. For braking on the target approach, not only the deceleration but also the creep distance, creep velocity and braking distance must be set. All three parameters depend on each other and influence the target approach. If the axis is within the braking distance, it is only controlled by the position controller. The creep velocity and creep distance are used to stabilize the axis after deceleration, in order to take it to its target via the position controller. The target approach should look like this: It is often observed that an axis that is extremely slowed down requires a longer creep phase in order to position as accurately as an axis with a gentler deceleration. 5.8.9.2 Time-based axis control If the axis control is to be time-based, the position controller is active during the entire motion. This option should only be used for axes with a high natural frequency and ideally with a zero overlap valve. The acceleration must be limited to values that the axis can follow without strong vibration. Special attention should be paid to starting up. When braking, the deceleration must be adjusted so that the axis can follow the set value ramp. The creep velocity, creep distance and braking distance can be set to zero. The actual position must follow the set position to avoid overshooting. If this is not the case, the pre-control must be reduced. At this point, the axis is fully commissioned for positioning. If a pressure regulator, cam plate or gear coupling is used in the application, these elements must also be put into operation. 386 Version: 1.8.3 TF5810
## Page 387

Support and Service 6 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF5810 Version: 1.8.3 387
## Page 388

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements En Dat is a trademark of Dr. Johannes Heidenhain Gmb H. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 389

More Information: www.beckhoff.com/tf5810 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
