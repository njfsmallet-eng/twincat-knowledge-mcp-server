---
title: "TF6760 Twin CAT 3"
product: "TF6760"
category: "IoT"
tags: ["CAT", "IoT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.11.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6760_TC3_IoT_https_rest_en.pdf"
release_date: "2025-08-04"
---
Manual | EN TF6760 Twin CAT 3 | Io T HTTPS/REST 2025-08-04 | Version: 1.11.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation......................................................................................................................................... 9 3.3 Licensing........................................................................................................................................... 9 4 Technical introduction............................................................................................................................ 12 4.1 HTTP/HTTPS.................................................................................................................................. 12 4.2 REST API........................................................................................................................................ 13 4.3 Supported functions........................................................................................................................ 14 4.4 Technical restrictions...................................................................................................................... 14 4.5 Compression................................................................................................................................... 15 4.6 Security........................................................................................................................................... 15 4.6.1 Transport layer................................................................................................................. 15 4.6.2 Application level............................................................................................................... 22 4.7 Re-parameterization........................................................................................................................ 23 4.8 URL redirects.................................................................................................................................. 23 4.9 Cookies........................................................................................................................................... 24 5 PLC API.................................................................................................................................................... 25 5.1 Tc3_Iot Base.................................................................................................................................... 25 5.1.1 Function blocks................................................................................................................ 25 5.1.2 Data types........................................................................................................................ 37 5.1.3 Parameter List................................................................................................................... 39 5.2 Tc3_Json Xml.................................................................................................................................. 40 5.2.1 Function blocks................................................................................................................ 40 5.2.2 Interfaces....................................................................................................................... 230 6 Samples................................................................................................................................................. 235 6.1 Iot Http Samples.............................................................................................................................. 235 6.1.1 Open Weather Map.......................................................................................................... 236 6.1.2 Postman Echo................................................................................................................. 236 6.1.3 AWS Io T......................................................................................................................... 236 6.1.4 Philips Hue..................................................................................................................... 236 6.1.5 Telegram........................................................................................................................ 237 6.1.6 AWS Service Configuration............................................................................................ 240 7 Appendix................................................................................................................................................ 241 7.1 ADS Return Codes........................................................................................................................ 241 TF6760 Version: 1.11.0 3
## Page 4

Table of contents 4 Version: 1.11.0 TF6760
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF6760 Version: 1.11.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.11.0 TF6760
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF6760 Version: 1.11.0 7
## Page 8

Overview 2 Overview The function blocks of the PLC library Tc3_Io TBase can be used to address REST APIs as a client via HTTP/HTTPS communication. Common HTTP commands such as GET, PUT or POST are available for this purpose. In principle, data can be requested from a REST API and also sent to a REST API. Product components The TF6760 Io T HTTPS/REST function consists of the following components, which are included by default in the Twin CAT 3 scope of delivery: • Driver: Tc Iot Drivers.sys (included with the Twin CAT 3 XAE and XAR setups) • PLC library: Tc3_Iot Base (included in the scope of delivery of the Twin CAT 3 XAE setup) 8 Version: 1.11.0 TF6760
## Page 9

Installation 3 Installation 3.1 System requirements Technical data Description Operating system Windows 7/10, Windows Embedded Standard 7, Windows CE 7, Twin CAT/BSD Target platform PC architecture (x86, x64 or Arm®) Twin CAT Version Twin CAT 3.1 Build 4024.7 or higher Required Twin CAT setup level Twin CAT 3 XAE, XAR Required Twin CAT license TF6760 TC3 Io T HTTPS/REST 3.2 Installation A seperate setup is not required for TF6760 Io T HTTPS/REST. All required components will be delivered directly within the Twin CAT setup. • Twin CAT XAE setup: Driver components and PLC library (Tc3_Iot Base) • Twin CAT XAR setup: Driver components 3.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. TF6760 Version: 1.11.0 9
## Page 10

Installation 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 10 Version: 1.11.0 TF6760
## Page 11

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. TF6760 Version: 1.11.0 11
## Page 12

Technical introduction 4 Technical introduction The following chapter gives a brief technical introduction about the HTTP protocol and its secure extension, the HTTPS protocol. Furthermore the REST architecture and its connection to the HTTP protocol are described. 4.1 HTTP/HTTPS HTTP (Hypertext Transfer Protocol) is a standard protocol that is mainly used for IP communication between servers and clients on the Internet. The client is usually a web browser that requests a website from a web server. Another use case for the HTTP protocol is REST (Representational State Transfer) web services. Furthermore, HTTP is a stateless protocol, each command is handled independently. After a server has responded to a client request, the connection is closed again. A client has the option of informing the server that the connection should be maintained after a request. HTTP methods The HTTP standard (version 1.1) defines different methods that a HTTP server can offer to requesting clients. In particular, GET, POST, and PUT are some of the most commonly used HTTP methods. The following table contains all HTTP methods defined in the standard. HTTP method Description GET Requests a resource from the server. POST Transfers data to the server. PUT Replaces or creates a resource on the server with the request payload. CONNECT Establishes an SSL tunnel to a server. DELETE Deletes the addressed resource from the server. HEAD Same functionality as GET, without payload data. OPTIONS Requests the available communication options from the server. TRACE Performs a message loopback for testing purposes. PATCH Same functionality as PUT, but used for partial changes of resources. A user must know that not every server implements all these methods. According to the specification, only GET and HEAD are mandatory for a specification-compliant server, all other commands are optional. There is also the possibility that user credentials are required to access resources on a server. HTTP status codes An HTTP response is divided into header and body. An important part of this response is the HTTP status code. The HTTP status code delivers information about the request back to the client. The following table shows the defined ranges of the HTTP status code. Status code range Description 100–199 Status codes that contain information messages. 200–299 Status codes that inform the client about a successful request. 300–399 Status codes that show a diversion and request an interaction from the user. 400–499 Status codes that show error messages (triggered by the client). 500–599 Status codes that show error messages (triggered by the server). 12 Version: 1.11.0 TF6760
## Page 13

Technical introduction HTTPS HTTPS (Hypertext Transfer Protocol Secure) is an extension of the HTTP protocol, which implements TLS (Transport Layer Security). Data sent using the HTTP protocol is completely unencrypted and therefore does not meet the security requirements for sending passwords or credit card information, for example. In addition to the encryption of transported data, HTTPS also offers server authentication. 4.2 REST API A RESTful (Representational State Transfer) web service is a web service that is designed with an architecture specially for distributed systems. All RESTful web services on a server together are called REST API (Application Programming Interface). REST APIs are often associated with the HTTP protocol but are neither a standard nor a protocol. So, there are – per definition - different protocols that can be used to communicate with REST APIs, HTTP is only the most common one. A REST API has to follow six different architectural definitions that are mentioned in the specification: • Client-Server model: Data and user interface have to be divided by definition. • Statelessness: Client and server have to communicate stateless. Every client request must deliver all the information that the server needs to process the request. • Caching: Information can be classified as cacheable or not-cacheable. A client can cache server responses for future requests, but this information might be outdated. • Consistent interface: REST interfaces must be usable from different endpoints in the same way, due to their consistent interface. • Layered systems: A REST API has to be a multilayered, hierarchical built system. • Code-On-Demand (optional): The functions of clients have to be extendable with reloadable and executable program parts. How to request resources from a REST API As mentioned before, HTTP(S) is just one of the possibilities to implement a REST API but is the only one that has importance for this documentation. The following section will contain a short description how to request resources from a REST API that is implemented with HTTP(S). A resource on a HTTPS REST API is identified with its URL. There are two different possibilities how a URL can be offered by a webservice. On the one hand, a URL can only consist of path parameters and on the other hand it could contain query parameters. The following example will explain the difference between these two possibilities. A URL is built with three parts: 1. Domain name 2. Path parameters 3. Query parameters When the weather for the city Verl should be requested from a fictional Beckhoff weather service, the URL without query parameters could look like: https://www.beckhoff-weather.com/forecast/city/verl With the usage of query parameters, the URL could look like: https://www.beckhoff-weather.com/forecast?city=verl The first part https://www.beckhoff-weather.com is the domain name of the webserver, which is translated to an IP address with the help of a DNS-Server. The path parameters /forecast/city/verl specify on which resource of the server the request should be processed. Another possibility is to use a query parameter like forecast?city=verl to request a specific resource on a path. TF6760 Version: 1.11.0 13
## Page 14

Technical introduction 4.3 Supported functions The following table gives an overview of all supported functions. HTTP version 1.1 is generally supported. Function Min. Twin CAT version Description HTTP Requests 3.1 Build 4024.7 GET, POST, PUT, CONNECT, DELETE, HEAD, OPTIONS, TRACE, PATCH. Cipher Suites 3.1 Build 4024.7 Specification of the Cipher Suites to be used. Data format 3.1 Build 4024.7 The data format can be freely defined. Appropriate auxiliary libraries for easy use of JSON and XML are available. Header Fields 3.1 Build 4024.7 Header Fields can be freely defined or customized. Compression 3.1 Build 4024.11 Compression algorithms [} 15] are used to reduce the data volume of messages. gzip and deflate are supported in send and receive direction. Persistent Connections (Keep- 3.1 Build 4024.7 The connection to an HTTP server Alive) is maintained instead of being terminated after a request. Pre-Shared Key (PSK) 3.1 Build 4024.7 A PSK can be used to secure the transport channel (using TLS). Transport Layer Security (TLS) – 3.1 Build 4024.7 TLS can be used to secure the version 1.1 and 1.2 transport channel. Transport Layer Security (TLS) – 3.1 Build 4026.0 TLS can be used to secure the version 1.1 and 1.3 transport channel. Certificates 3.1 Build 4024.7 Certificates can be used to secure the transport channel (using TLS). The PEM format is used here. Certificate revocation lists (CRL) 3.1 Build 4024.7 Use of certificate revocation lists. 4.4 Technical restrictions This chapter describes the technical limitations of the Io T driver with regard to HTTP client functionality. It should be noted that these limitations are not flaws but design features that have been implemented deliberately. Restriction Description Number of simultaneous HTTP requests from an Each instance of the function block FB_Iot Http Client HTTP client instance [} 28] can only send one HTTP request at a time. The next request can only be sent once the corresponding HTTP response has arrived. If several requests are sent from the same client instance before the response arrives, they are placed in a queue. The timeout configured for the HTTP client instance has higher priority than the response. Communication of large amounts of data When communicating large amounts of data, the user should be aware that this leads to a real-time load, as this large amount of data has to be copied. Router memory is also used. 14 Version: 1.11.0 TF6760
## Page 15

Technical introduction 4.5 Compression In general, the term "data compression" refers to the ability to reduce the number of bits needed to represent data. One way of dealing with this is to provide recurring strings with a reference to the first of these strings through a compression algorithm. Appropriate compression must occur without loss of information. Two compression types that are very common in HTTP communication are gzip and deflate. Both have been supported in transmit and receive direction in the HTTP driver and the Tc3_Iot Base library since Twin CAT version 3.1.4024.11. The methods belong to the group of lossless compression types. In Twin CAT the compression can be set individually for a FB_Iot Http Request [} 31] function block and is passed to it as an input parameter. By default, no compression is used in transmit direction. In receive direction the driver can receive and correctly represent both types of compression without separate settings. The following diagram shows an HTTP request to the Postman Echo test REST API (see Postman Echo [} 236]). The Twin CAT HTTP client notifies the REST API via a header field that both deflate and gzip are supported in receive direction. 4.6 Security When considering protection of data communication, a distinction can be made between two levels: protection of the transport channel [} 15] and protection at application layer. 4.6.1 Transport layer The worldwide common standard Transport Layer Security (TLS) is used in the Twin CAT Io T driver for the secure transmission of data. The following chapter describes the TLS communication flow, taking TLS version 1.2 as an example. The TLS standard combines symmetric and asymmetric cryptography to protect transmitted data from unauthorized access and manipulation by third parties. In addition, TLS supports authentication of communication devices for mutual identity verification. Contents of this chapter The information in this chapter refers to the general TLS communication flow, without specific reference to the implementation in Twin CAT. They are only intended to provide a basic understanding in order to better comprehend the reference to the Twin CAT implementation explained in the following sub-chapters. Supported functions The Twin CAT Io T driver enables the use of the following TLS functions. TF6760 Version: 1.11.0 15
## Page 16

Technical introduction Function Description Self-signed client certificates Use a self-signed client certificate to authenticate to the message broker. CA-signed client certificates Use of a CA-signed client certificate to authenticate to the message broker. The CA certificate can also be specified to establish a trust relationship. Certificate revocation lists Use of certificate revocation lists (CRL). Pre-Shared Key (PSK) Use of a pre-shared key (PSK) to authenticate to the message broker. Cipher suite definition A cipher suite is by definition a composition of algorithms (key exchange, authentication, encryption, MAC) for encryption. The client and server agree on these during the TLS connection establishment. For more information on cipher suites please refer to the relevant technical literature. TLS communication flow Communication with TLS encryption starts with a TLS handshake between server and client. During the handshake asymmetric cryptography is used; after successful completion of the handshake the server and client communicate based on symmetric cryptography, because this is many times faster than asymmetric cryptography. There are three different types of authentication for the TLS protocol: • The server identifies itself through a certificate (see Server certificate [} 18]) • The client and server identify themselves through a certificate (see Client/Server certificate [} 19]) • Pre-shared keys (see Pre-shared keys [} 19]) Please refer to the relevant technical literature for information about the advantages and disadvantages of the different authentication types. Exemplary explanation based on RSA All messages marked with * are optional, i.e. not mandatory. The following steps refer to the RSA procedure and are not generally valid for other procedures. The following table explains the individual steps from the communication flow shown above. 16 Version: 1.11.0 TF6760
## Page 17

Technical introduction Step Description Client Hello The client initiates a connection to the server. The TLS version used, a random sequence of bytes (client random) and the cipher suites supported by the client are transmitted, among other parameters. Server Hello The server selects one of the cipher suites offered by the client and specifies it for the communication. If there is no intersection between the cipher suites supported by the client and server, the TLS connection establishment is aborted. In addition, the server also communicates a random sequence of bytes (server random). Certificate The server presents its certificate to the client to enable the client to verify that the server is the expected server. If the client does not trust the server certificate, the TLS connection establishment is aborted. The server certificate also contains the server's public key. Server Key Exchange For certain key exchange algorithms, the information from the certificate is not sufficient for the client to generate the so-called pre-master secret. In this case the missing information is transferred using Server Key Exchange. Certificate Request The server requests a certificate from the client to verify the identity of the client. Server Hello Done The server notifies the client that sending of the initial information is complete. Certificate The client communicates its certificate, including the public key, to the server. The procedure is the same as in the opposite direction: If the server does not trust the certificate sent by the client, the connection establishment is aborted. Client Key Exchange The client generates an encrypted pre-master secret and uses the server's public key to send the secret to the server using asymmetric encryption. This pre- master secret, the "server random" and the "client random" are then used to calculate the symmetric key that is used for communication after the connection has been established. Certificate Verify The client signs the previous handshake messages with its private key. Since the server has obtained the client's public key by sending the certificate, it can verify that the certificate presented really "belongs" to the client. Change Cipher Spec The client notifies the server that it is switching to symmetric cryptography. From here on every message from the client to the server is signed and encrypted. Finished The client notifies the server in encrypted form that the TLS connection establishment on its side is complete. The message contains a hash and a MAC relating the previous handshake messages. TF6760 Version: 1.11.0 17
## Page 18

Technical introduction Step Description Change Cipher Spec The server decrypts the pre-master secret that the client encrypted with its public key. Since only the server has its private key, only the server can decrypt this pre-master secret. This ensures that the symmetric key is only known to the client and the server. The server then calculates the symmetric key from the pre-master secret and the two random sequences and notifies the client that it too is now communicating using symmetric cryptography. From here on every message from the server to the client is signed and encrypted. By generating the symmetric key, the server can decrypt the client's Finished message and verify both hash and MAC. If this verification fails, the connection is aborted. Finished The server notifies the client that the TLS connection establishment on its side is also finished. As with the client, the message contains a hash and a MAC relating to the previous handshake messages. On the client side, the same verification is then performed as on the server. Here too, if the hash and MAC are not successfully decrypted, the connection is aborted. Application Data Once the TLS connection establishment is complete, client and server communicate using symmetric cryptography. 4.6.1.1 Server certificate This section covers a situation where the client wants to verify the server certificate but the server does not want to verify the client certificate. In this case the communication flow described in chapter Transport layer [} 15] is shortened as follows. Verification of the server certificate The server certificate is verified on the client side. A check is performed to ascertain whether it is signed by a particular certificate authority. If this is not the case, the client aborts the connection, since it does not trust the server. Application in Twin CAT In Twin CAT, the file path to the CA certificate (. PEM or . DER file) or the content of the . PEM file is specified as a string. The certificate presented by the server is then checked in the Io T driver. If the certificate chain is not signed by the specified CA, the connection to the server is aborted. The following code illustrates the described connection parameters as an example. The sample code refers to the HTTP client, the MQTT client and the Web Socket client. The HTTP client is used as an example. 18 Version: 1.11.0 TF6760
## Page 19

Technical introduction PROGRAM MAIN VAR fb Client : FB_Iot Http Client; END_VAR fb Client.st TLS.s CA:= 'C:\Twin CAT\3.1\Config\Certificates\some CA.pem'; If the user does not have the CA certificate, a connection can still be established. A boolean variable is available for this purpose, which prevents Twin CAT from verifying the server certificate. Although the connection is encrypted with the public key of the unverified server certificate, it is more vulnerable to man- in-the-middle attacks. fb Client.st TLS.s CA.b No Server Cert Check:= TRUE; 4.6.1.2 Client/Server certificate This section considers the case where both the client certificate and the server certificate are verified. The slightly modified communication flow (compared to the Server certificate [} 18] chapter) is visualized in the following diagram. The individual steps of the TLS connection establishment are described in chapter Transport layer [} 15]. Application in Twin CAT If a client certificate is used, in Twin CAT the file path (. PEM or . DER file) or the content of the . PEM file is passed as a string, just as for the CA certificate. Twin CAT as the client then presents this certificate to the server. For Certificate Verify the client's private key must also be referenced. Optionally, in the case of password protection for the private key, this password can also be transferred. The sample code refers to the HTTP client, the MQTT client and the Web Socket client. The HTTP client is used as an example. PROGRAM MAIN VAR fb Client : FB_Iot Http Client; END_VAR fb Client.st TLS.s CA:= 'C:\Twin CAT\3.1\Config\Certificates\some CA.pem'; fb Client.st TLS.s Cert:= 'C:\Twin CAT\3.1\Config\Certificates\some CRT.pem'; fb Client.st TLS.s Key File:= 'C:\Twin CAT\3.1\Config\Certificates\someprivatekey.pem.key'; fb Client.st TLS.s Key Pwd:= 'yourkeyfilepasswordhere'; If a client certificate is set, a CA certificate must also be set to validate the server certificate. This is due to the behavior of the security framework used in the Io T driver. If the validation of the server certificate is to be shutdown in this case, an additional flag can be set to skip the validation. However, it is not possible to omit the CA certificate. 4.6.1.3 Pre-shared keys By default, asymmetric key pairs are used for the TLS connection establishment. Asymmetric cryptography requires more computing power, so using Pre-Shared Keys (PSK) may be an option in situations where CPU power is limited. Pre-shared keys are previously shared symmetric keys. TF6760 Version: 1.11.0 19
## Page 20

Technical introduction Compared to the communication flow with asymmetric encryption, the certificate is omitted when using PSK. Client and server must agree on a PSK via the so-called identity. By definition the PSK is known in advance to both parties. Server Key Exchange: In this optional message, the server can give the client a hint about the identity of the PSK used. Client Key Exchange: The client specifies the identity of the PSK to be used for encryption. Application in Twin CAT In Twin CAT the identity of the PSK is specified as a string; the PSK itself is stored as a byte array in the controller. The length of the PSK is also specified. The sample code refers to the HTTP client, the MQTT client and the Web Socket client. The HTTP client is used as an example. PROGRAM MAIN VAR fb Client : FB_Iot Http Client; c My Psk Key : ARRAY[1..64] OF BYTE := [16#1B, 16#D0, 16#6F, 16#D2, 16#56, 16#16, 16#7D, 16#C1, 16# E8, 16#C7, 16#48, 16#2A, 16#8E, 16#F5, 16#FF]; END_VAR fb Client.st TLS.s Psk Identity:= 'identityof PSK'; fb Client.st TLS.a Psk Key:= c My Psk Key; fb Client.st TLS.n Psk Key Len:= 15; 4.6.1.4 Supported cipher suites The Twin CAT Io T driver supports secure data transmission using the TLS standard. Below you will find an overview of all cipher suites supported by the Io T driver, depending on the Twin CAT version. 20 Version: 1.11.0 TF6760
## Page 21

Technical introduction Twin CAT 3.1 Build 4024.x Cipher suite AES128-GCM-SHA256 AES128-SHA AES128-SHA256 AES256-SHA AES256-SHA256 DES-CBC3-SHA DHE-RSA-AES128-GCM-SHA256 DHE-RSA-AES128-SHA DHE-RSA-AES128-SHA256 DHE-RSA-AES256-SHA DHE-RSA-AES256-SHA256 ECDHE-ECDSA-AES128-GCM-SHA256 ECDHE-ECDSA-AES128-SHA ECDHE-ECDSA-AES128-SHA256 ECDHE-ECDSA-AES256-SHA ECDHE-ECDSA-DES-CBC3-SHA ECDHE-RSA-AES128-GCM-SHA256 ECDHE-RSA-AES128-SHA ECDHE-RSA-AES128-SHA256 ECDHE-RSA-AES256-SHA ECDHE-RSA-DES-CBC3-SHA EDH-RSA-DES-CBC3-SHA PSK-3DES-EDE-CBC-SHA PSK-AES128-CBC-SHA PSK-AES128-CBC-SHA256 PSK-AES128-GCM-SHA256 PSK-AES256-CBC-SHA TF6760 Version: 1.11.0 21
## Page 22

Technical introduction Twin CAT 3.1 Build 4026.x Cipher suite AES128-GCM-SHA256 AES128-SHA AES128-SHA256 AES256-GCM-SHA384 AES256-SHA AES256-SHA256 DHE-RSA-AES128-GCM-SHA256 DHE-RSA-AES128-SHA DHE-RSA-AES128-SHA256 DHE-RSA-AES256-GCM-SHA384 DHE-RSA-AES256-SHA DHE-RSA-AES256-SHA256 ECDHE-ECDSA-AES128-GCM-SHA256 ECDHE-ECDSA-AES128-SHA ECDHE-ECDSA-AES128-SHA256 ECDHE-ECDSA-AES256-GCM-SHA384 ECDHE-ECDSA-AES256-SHA ECDHE-ECDSA-AES256-SHA384 ECDHE-RSA-AES128-GCM-SHA256 ECDHE-RSA-AES128-SHA ECDHE-RSA-AES128-SHA256 ECDHE-RSA-AES256-GCM-SHA384 ECDHE-RSA-AES256-SHA ECDHE-RSA-AES256-SHA384 PSK-AES128-CBC-SHA PSK-AES128-CBC-SHA256 PSK-AES128-GCM-SHA256 PSK-AES256-CBC-SHA PSK-AES256-CBC-SHA384 PSK-AES256-GCM-SHA384 4.6.2 Application level Various safety mechanisms are also available at the application layer. These safety mechanisms are described below. 4.6.2.1 JSON Web Token (JWT) JSON Web Token (JWT) is an open standard (based on RFC 7519) that defines a compact and self- describing format for securely transmitting information between communication devices in the form of a JSON object. The authenticity of the transmitted information can be verified and ensured, since a JWT is provided with a digital signature. The signature can involve a shared secret (via an HMAC algorithm) or a public/private key (via RSA). The most common application example for JWT is the authorization of a device or user for a service. Once a user has logged into the service, all further requests to the service include the JWT. Based on the JWT, the service can then decide which additional services or resources the user may access. This means, for example, that single sign-on solutions can be implemented in cloud services. The PLC library Tc3_Json Xml provides an option to create and sign a JWT via the method FB_Jwt Encode. 22 Version: 1.11.0 TF6760
## Page 23

Technical introduction 4.6.2.2 AWS Signature Version 4 AWS Signature V4 adds authentication information to requests to AWS services (for example instantiating a virtual machine via the EC2 service) sent via the HTTP protocol. For security reasons, most requests to AWS services must be signed with an access key. This access key, consisting of an access key ID and a secret access key, can be set up and managed in a corresponding AWS account. For further information please refer to the AWS documentation. 4.7 Re-parameterization In certain cases, it may be necessary to re-parameterize the HTTP client during operation by means of an Online Change. The new parameterization can either take place automatically in the program sequence or be triggered manually if required. This depends on the implementation. Example use cases for a new parameterization: replacement of a token that is about to expire, certificates that need to be renewed or a changed IP address of the HTTP server. The following section describes the procedure for re-parameterization of an HTTP client that has already been parameterized. For cyclic background communication of an HTTP client function block with the Twin CAT driver, the Execute method must be called cyclically in the background (see FB_Iot Http Client [} 28]). When a program is started, calling this method first sets the parameters of the HTTP client instance, after which it is possible to send HTTP requests. The variable b Configured is able to detect completion of this parameterization. The HTTP client is fully configured once the variable has the value TRUE. To carry out a new parameterization, the call of the Execute method must be suspended and the Disconnect method must be called. It is important to ensure that no more HTTP requests are sent at the time of the call. By calling the Disconnect method b Configured is set to FALSE. The parameters are then reset and the Execute method is called again as usual. The following code snippet shows a simple re-parameterization using a trigger. IF b Reset THEN fb Http Client. Disconnect(); IF fb Http Client.b Configured=FALSE THEN fb Http Client.s Host Name:='postman-echo.com'; fb Http Client.st TLS.s CA:='C:\Twin CAT\3.1\Config\Certificates\ca CERT.cer'; b Reset:=FALSE; END_IF ELSE fb Http Client. Execute(); END_IF The trigger variable b Reset suspends the call of the Execute method and calls the Disconnect method. Once b Configured is set to FALSE on the HTTP client function block, the host name and CA certificate parameters are reset. b Reset is then reset and the Excute method is called again. 4.8 URL redirects With a server-side URL redirect a server indicates to a client that a requested server resource has been moved permanently or temporarily. Such redirects are not automatically evaluated in the Io T driver. It is therefore left to the application logic to evaluate a URL redirect. Example: HTTP status code 301 ("Moved permanently"). This is where a server notifies a client that a server resource has been moved permanently. A header field with the name "Location" is added to the HTTP response, so that the client can be notified of the new address of the resource. This header field then contains the new URL where the resource is located. In a Twin CAT application, after receiving an HTTP response via the status code query, an application logic could be implemented that extracts the new URL from a response with status code 301 and sends a new request with the updated URL to the server. To do this, the "Location" header field of the response must be queried and used as the target URL for a new request. TF6760 Version: 1.11.0 23
## Page 24

Technical introduction 4.9 Cookies Cookies are used in the HTTP environment for three use cases. Use cases include session management, which is used for logins and anything else that the server needs to “remember.” Cookies are also used for personalization and tracking. From a technical point of view, when an HTTP server responds to the client it sends back one or more header fields named “Set-Cookie” in the response. These cookies will then be included in future requests to the HTTP server, although in this case separated by a semicolon in a single header field. In Twin CAT the header fields described above are automatically combined with the cookies into one header field and separated by a line feed. This does not only apply to header fields of the type “Set-Cookie”, but in all cases where an HTTP response of the server contains several header fields of the same name. The following sample illustrates this: HTTP/1.1 200 OK Content-Type: text/html Set-Cookie: token1=Beckhoff Set-Cookie: token2=Io T If the response is received by the Twin CAT Io T driver, the two header fields with the name “Set-Cookie” are automatically merged into one. The following string is then output after querying the header field in the program code: 'token1=Beckhoff$Ntoken2=Io T'; 24 Version: 1.11.0 TF6760
## Page 25

PLC API 5 PLC API 5.1 Tc3_Iot Base 5.1.1 Function blocks 5.1.1.1 FB_Iot Http Aws Sig V4Header Field Map This function block enables signing of a header with AWS Signature Version 4 (see AWS Signature Version 4 [} 23]). Syntax Definition: FUNCTION BLOCK FB_Iot Http Aws Sig4Header Field Map EXTENDS FB_Iot Http Header Field Map VAR_OUTPUT b Error : BOOL; hr Error Code : HRESULT; END_VAR Outputs Name Type Description b Error BOOL Becomes TRUE when an error situation occurs hr Error Code HRESULT Returns an ADS return code. An explanation of the possible ADS return codes can be found in the Appendix. Methods Name Description Add Field [} 26] Adds a header field to an instance of this function module. Set Parameter [} 26] Sets the required parameters on a header intended for requests to AWS services and signs it. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.12 or higher IPC or CX (x86, x64, ARM) Tc3_Iot Base TF6760 Version: 1.11.0 25
## Page 26

PLC API 5.1.1.1.1 Set Parameter This method sets the required parameters on a header intended for requests to AWS services and signs it. The individual parameters must be sorted alphabetically for signing. This is done internally by the driver, so the user does not have to pay attention to the order. Syntax METHOD Set Parameter : BOOL VAR_IN_OUT CONSTANT service : STRING; region : STRING; access Key : STRING; secret Key : STRING; signed Headers : STRING; END_VAR Return value Name Type Description Set Parameter BOOL Returns TRUE if the method call was successful. Inputs Name Type Description service STRING AWS service code region STRING AWS data center code. access Key STRING The Access Key of the two-part access key of an AWS IAM user. Required for authentication of requests. secret Key STRING The Secret Key of the two-part access key of an AWS IAM user. Required for authentication of requests. signed Headers STRING Describes a semicolon-separated list of HTTPS headers to include in the signature. For more information please refer to the AWS documentation. 5.1.1.1.2 Add Field This method adds an additional header field to an instance of the function block FB_Iot Http Header Field Map. Syntax METHOD Add Field : BOOL VAR_IN_OUT CONSTANT s Field : STRING; s Value : STRING; END_VAR VAR_INPUT b Append Value : BOOL; END_VAR 26 Version: 1.11.0 TF6760
## Page 27

PLC API Return value Name Type Description Add Field BOOL Returns TRUE if the method call was successful. Inputs Name Type Description b Append Value BOOL Replaces the existing header field value (FALSE) or appends the value to the existing value (TRUE). Inputs/outputs Name Type Description s Field STRING Name of the field that is added to the header of the HTTP request. s Value STRING Value of the added header field. 5.1.1.1.3 Find Field This method searches for a specific header field in an instance of the function block FB_Iot Http Header Field Map. Syntax METHOD Find Field : BOOL VAR_IN_OUT CONSTANT s Field : STRING; END_VAR VAR_INPUT p Value : PVOID; n Value Size : UDINT; END_VAR Return value Name Type Description Find Field BOOL Returns TRUE if the method call was successful. Inputs Name Type Description p Value PVOID Pointer to the data memory where the found header field is to be stored. n Value Size UDINT The size of the memory variables. Inputs/outputs Name Type Description s Field STRING Name of the field to be found in the header. TF6760 Version: 1.11.0 27
## Page 28

PLC API 5.1.1.2 FB_Iot Http Client This function block enables communication with a HTTP server. A client function block is responsible for the connection to exactly one server. The Execute() method of the function block must be called cyclically to enable the functionality of the HTTP client. The exact resource on the server is specified with the s Uri property of the function block FB_Iot Http Request. All connection parameters exist as input parameters and are evaluated when a connection is established. Syntax Definition: FUNCTION BLOCK FB_Iot Http Client VAR_INPUT //default is local host s Host Name : STRING((Parameter List.c Size Of Http Client Host Name-1)) :='127.0.0.1'; //default is 80 n Host Port : UINT :=80; b Keep Alive : BOOL :=TRUE; t Connection Timeout : TIME :=T#10s; //optional parameter st TLS : ST_Iot Socket Tls; END_VAR VAR_OUTPUT b Error : BOOL; hr Error Code : HRESULT; b Configured : BOOL; //TRUE if connection to server is established b Connected : BOOL; END_VAR Inputs Name Type Description s Host Name STRING (255) s Host Name can be specified as a name or as an IP address. If no information is provided, the local host is used. n Host Port UINT The host port can be specified here. The default value is 80 mm. b Keep Alive BOOL Specifies whether the connection to the server should be maintained until either the server or client terminates it. Please note that not every server supports this function. t Connection Timeout TIME Specifies the connection timeout. st TLS ST_Iot Socket Tls If the server offers a TLS-secured connection, the required configuration can be implemented here. [} 37] Outputs Name Type Description b Error BOOL Becomes TRUE when an error situation occurs. hr Error Code HRESULT Returns an ADS return code. An explanation of the possible ADS return codes can be found in the Appendix. b Configured BOOL Becomes TRUE when the initial configuration is complete. b Connected BOOL Becomes TRUE if a connection to the host is established. Please note that the connection is usually closed after each request, depending on the input parameter b Keep Alive. 28 Version: 1.11.0 TF6760
## Page 29

PLC API Methods Name Description Disconnect Disconnects the client from the server if there is an active connection. Execute Method for background communication with the Twin CAT driver. The method must be called cyclically for every function block instance. If the method is called for the first time before the parameters are changed, default values are used. In this case, the parameters can only be changed by Re- parameterization [} 23]. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.7 or higher IPC or CX (x86, x64, Arm®) Tc3_Iot Base 5.1.1.3 FB_Iot Http Header Field Map This function block offers the option of adding additional header fields to an HTTP request. To do this, the Add Field method must be called on this function block. The function block must then be forwarded to the HTTP command that is sent to the server. Syntax Definition: FUNCTION_BLOCK FB_Iot Http Header Field Map VAR_OUTPUT b Error : BOOL; hr Error Code : HRESULT; END_VAR Outputs Name Type Description b Error BOOL Becomes TRUE as soon as an error situation occurs. hr Error Code HRESULT Returns an ADS return code. An explanation of the possible ADS return codes can be found in the Appendix. Methods Name Description Add Field Adds a header field to an instance of this function module. [} 30] Find Field Searches for a specific header field in an instance of the function block FB_Iot Http Header Field Map. [} 30] TF6760 Version: 1.11.0 29
## Page 30

PLC API Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.7 or higher IPC or CX (x86, x64, Arm®) Tc3_Iot Base 5.1.1.3.1 Add Field This method adds an additional header field to an instance of the function block FB_Iot Http Header Field Map. Syntax METHOD Add Field : BOOL VAR_IN_OUT CONSTANT s Field : STRING; s Value : STRING; END_VAR VAR_INPUT b Append Value : BOOL; END_VAR Return value Name Type Description Add Field BOOL Returns TRUE if the method call was successful. Inputs Name Type Description b Append Value BOOL Replaces the existing header field value (FALSE) or appends the value to the existing value (TRUE). Inputs/outputs Name Type Description s Field STRING Name of the field that is added to the header of the HTTP request. s Value STRING Value of the added header field. 5.1.1.3.2 Find Field This method searches for a specific header field in an instance of the function block FB_Iot Http Header Field Map. Syntax METHOD Find Field : BOOL VAR_IN_OUT CONSTANT s Field : STRING; END_VAR VAR_INPUT 30 Version: 1.11.0 TF6760
## Page 31

PLC API p Value : PVOID; n Value Size : UDINT; END_VAR Return value Name Type Description Find Field BOOL Returns TRUE if the method call was successful. Inputs Name Type Description p Value PVOID Pointer to the data memory where the found header field is to be stored. n Value Size UDINT The size of the memory variables. Inputs/outputs Name Type Description s Field STRING Name of the field to be found in the header. 5.1.1.4 FB_Iot Http Request This function block enables the PLC to send HTTP commands to the server that has been configured with the function block FB_Iot Http Client. To be able to process an HTTP response, the output b Busy of this function block must first return FALSE. Then the content payload, specific header fields or a JSON string can be extracted from the response. Syntax Definition: FUNCTION_BLOCK FB_Iot Http Request IMPLEMENTS ITc Iot Http Response VAR_INPUT s Content Type : STRING((Parameter List.c Size Of Http Content Type-1)) :='text/html;charset=UTF-8'; e Compression Mode : E_Iot Http Compression Mode := 'E_Iot Http Compression Mode . No Compression'; END_VAR VAR_OUTPUT b Busy : BOOL; b Error : BOOL; e Error Id : ETc Iot Http Request Error; n Status Code : UINT; n Content Size : UDINT; END_VAR TF6760 Version: 1.11.0 31
## Page 32

PLC API Inputs Name Type Description s Content Type STRING Content type of the request, e.g. the initial value "text/html; charset=UTF-8". e Compression Mode E_Iot Http Compression Mode Enumeration of the different compression modes. Further information is provided in the chapter Compression [} 15]. The list can be found in the Appendix. Outputs Name Type Description b Busy BOOL This output remains TRUE until the function block has executed the command. b Error BOOL Becomes TRUE as soon as an error situation occurs. e Error Id ETc Iot Http Request Error Enumeration of status code on transport level e.g. if a certificate validation has failed. The enumeration can be found in the Appendix. n Status Code UINT HTTP status code send from the server within the response. n Content Size UDINT Size of the content payload. Methods Name Description Get Content [} 33] Reads the response from the HTTP server. Get Header Field [} 33] Reads the value from a specified header field. Get Json Dom Content [} 34] Parses the server response as JSON object. Send Json Dom Request [} 34] Sends a request to the server as JSON object. Send Request [} 35] Sends a HTTP command to the server. Send Xml Dom Request [} 36] Sends a request to the server as an XML object. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.7 or higher IPC or CX (x86, x64, Arm®) Tc3_Iot Base 32 Version: 1.11.0 TF6760
## Page 33

PLC API 5.1.1.4.1 Get Content This method reads the HTTP response and saves it into a variable. To be able to read the content from an HTTP response, the b Busy output of the function block FB_Iot Http Request must return FALSE. Syntax METHOD Get Content : BOOL VAR_INPUT p Content : PVOID; n Content Size : UDINT; b Set Null Termination : BOOL; END_VAR Return value Name Type Description Get Content BOOL Returns TRUE if the method call was successful. Inputs Name Type Description p Content PVOID Pointer to data memory where the read data should be stored. n Content Size UDINT Size of the received message. b Set Null Termination BOOL If the received message is a STRING, it can be specified either with or without null termination. If b Set Null Termination is set to TRUE, null termination is enforced. Please note that n Content Size must then be increased by +1. 5.1.1.4.2 Get Header Field This method can read the value of a specific header field from an HTTP response. To be able to read a header field from an HTTP response, the b Busy output of the function block FB_Iot Http Request must return FALSE. Syntax METHOD Get Header Field : BOOL VAR_IN_OUT CONSTANT s Field : STRING; END_VAR VAR_INPUT p Value : PVOID; n Value Size : UDINT; END_VAR Return value Name Type Description Get Header Field BOOL Returns TRUE if the method call was successful. TF6760 Version: 1.11.0 33
## Page 34

PLC API Inputs Name Type Description p Value PVOID Pointer to data memory where the read data should be stored. n Value Size UDINT The maximum size that the buffer of this method can have. Inputs/outputs Name Type Description s Field STRING Name of the field that is added to the header of the HTTP request. 5.1.1.4.3 Get Json Dom Content Using Get Content [} 33], the response from an HTTP server is saved in a variable. If the received message is a JSON string, it can be saved in a JSON object to use the functions of the PLC library Tc3_Json Xml [} 40]. The Get Json Dom Content method saves the response directly in a JSON object. This skips the string conversion step. To be able to read the content of an HTTP response, the b Busy output of the function block FB_Iot Http Request must return FALSE. Syntax METHOD Get Json Dom Content : SJson Value VAR_INPUT fb Json : REFERENCE TO FB_Json Dom Parser; END_VAR Return value Name Type Description Get Json Dom Content SJson Value JSON root node to start parsing. Inputs Name Type Description fb Json REFERENCE TO The instance of the Json Dom Parser that is to be used FB_Json Dom Parser to parse the JSON object. 5.1.1.4.4 Send Json Dom Request This method sends a request with a JSON object payload to a HTTP server. This method can be used, for example, if the server only accepts JSON object payloads. 34 Version: 1.11.0 TF6760
## Page 35

PLC API Syntax METHOD Send Json Dom Request : BOOL VAR_IN_OUT CONSTANT s Uri : STRING; END_VAR VAR_INPUT fb Client : REFERENCE TO FB_Iot Http Client; e Request Type : ETc Iot Http Request Type; fb Json : REFERENCE TO FB_Json Dom Parser; fb Header : REFERENCE TO FB_Iot Http Header Field Map; END_VAR Return value Name Type Description Send Json Dom Request BOOL Returns TRUE if the method call was successful. Inputs Name Type Description fb Client REFERENCE TO FB_Iot Http Client The HTTP client function block instance from which the request should be sent. e Request Type ETc Iot Http Request Type The type of HTTP command the request should have. The list can be found in the appendix. fb Json REFERENCE TO FB_Json Dom Parser The instance of Json Dom Parser for parsing a string to a JSON object. fb Header REFERENCE TO FB_Iot Http Header Field Map The instance of Iot Http Header Field Map to edit the header of the HTTP request. / Inputs/outputs Name Type Description s Uri STRING The identifier of the resource on the host. Please note, that the s Uri is appended to the host name of the Iot Http Client. 5.1.1.4.5 Send Request This method sends a request to a HTTP server. Syntax METHOD Send Request : BOOL VAR_IN_OUT CONSTANT s Uri : STRING; END_VAR VAR_INPUT fb Client : REFERENCE TO FB_Iot Http Client; e Request Type : ETc Iot Http Request Type; p Content : PVOID; n Content Size : UDINT; fb Header : REFERENCE TO FB_Iot Http Header Field Map; END_VAR TF6760 Version: 1.11.0 35
## Page 36

PLC API Return value Name Type Description Send Request BOOL Returns TRUE if the method call was successful. Inputs Name Type Description fb Client REFERENCE TO FB_Iot Http Client The HTTP client function block instance from which the request should be sent. e Request Type ETc Iot Http Request Type The type of HTTP command the request should have. The list can be found in the appendix. p Content PVOID Pointer to data memory from where the request payload should be read. n Content Size UDINT Size of the request payload. fb Header REFERENCE TO The instance of the FB_Iot Http Header Field Map FB_Iot Http Header Field Map to edit the header of the HTTP request. / Inputs/outputs Name Type Description s Uri STRING The identifier of the resource on the host. Please note, that the s Uri is appended to the host name of the Iot Http Client. 5.1.1.4.6 Send Xml Dom Request This method sends a request with an XML object payload to an HTTP server. This method can be used, for example, if the server only accepts XML object payloads. Syntax METHOD Send Xml Dom Request : BOOL VAR_IN_OUT CONSTANT s Uri : STRING; END_VAR VAR_INPUT fb Client : REFERENCE TO FB_Iot Http Client; e Request Type : ETc Iot Http Request Type; fb Xml : REFERENCE TO FB_Xml Dom Parser; fb Header : REFERENCE TO FB_Iot Http Header Field Map; END_VAR Return value Name Type Description Send Xml Dom Request BOOL Returns TRUE if the method call was successful. 36 Version: 1.11.0 TF6760
## Page 37

PLC API Inputs Name Type Description fb Client REFERENCE TO FB_Iot Http Client The HTTP client function block instance from which the request should be sent. e Request Type ETc Iot Http Request Type The type of HTTP command the request should have. The list can be found in the appendix. fb Xml REFERENCE TO FB_Xml Dom Parser The instance of Xml Dom Parser for parsing a string into an XML object. fb Header REFERENCE TO FB_Iot Http Header Field Map The instance of Iot Http Header Field Map to edit the header of the HTTP request. / Inputs/outputs Name Type Description s Uri STRING The identifier of the resource on the host. Please note, that the s Uri is appended to the host name of the Iot Http Client. 5.1.2 Data types 5.1.2.1 ST_Iot Socket Tls The following type contains the TLS security settings for the HTTP client and the Web Socket client. Either CA (Certificate Authority) or PSK (Pre Shared Key) can be used. Syntax Definition: TYPE ST_Iot Socket Tls : STRUCT s CA : STRING(255*); s Cert : STRING(255*); s Key File : STRING(255*); s Key Pwd : STRING(255*); s Crl : STRING(255*); s Ciphers : STRING(255*); s Version : STRING(80) := 'tlsv1.2'; b No Server Cert Check : BOOL := FALSE; s Psk Identity : STRING(255*); a Psk Key : ARRAY[1..64*] OF BYTE; n Psk Key Len : USINT; END_STRUCT END_TYPE TF6760 Version: 1.11.0 37
## Page 38

PLC API Parameter Name Type Description s CA STRING(255) Certificate of the certificate authority (CA) s Cert STRING(255) Client certificate for server authentication s Key File STRING(255) Private key of the client s Key Pwd STRING(255) Password of the private key, if applicable s Crl STRING(255) Path to the certificate revocation list, which may be present in PEM or DER format s Ciphers STRING(255) Cipher suites to be used, specified in Open SSL string format s Version STRING(80) TLS version to be used b No Server Cert Check BOOL Disables verification of the server certificate validity. If communication is to take place without TLS encryption (HTTP/Web Sockets), this value must remain FALSE. s Psk Identity STRING(255) Pre Shared Key identity for TLS PSK connection a Psk Key ARRAY[1..64] OF BYTE Pre Shared Key for TLS PSK connection n Psk Key Len USINT Length of the Pre Shared Key in bytes All strings and arrays marked with an * are initialized with the value in brackets. These values can be accessed and changed via the parameter list. This is not possible at runtime, but only before the code is compiled. 5.1.2.2 ETc Iot Http Request Error TYPE ETc Iot Http Request Error: ( HTTP_REQ_ERR_BUSY:=-1, HTTP_REQ_ERR_SUCCESS:=0, HTTP_REQ_ERR_NOMEM:=1, HTTP_REQ_ERR_CREATE_PROTOCOL:=2, HTTP_REQ_ERR_CONN_INVAL:=3, HTTP_REQ_ERR_NO_CONN:=4, HTTP_REQ_ERR_CONN_REFUSED:=5, HTTP_REQ_ERR_NOT_FOUND:=6, HTTP_REQ_ERR_CONN_LOST:=7, HTTP_REQ_ERR_TLS:=8, HTTP_REQ_ERR_NOT_SUPPORTED:=10, HTTP_REQ_ERR_AUTH:=11, HTTP_REQ_ERR_ACL_DENIED:=12, HTTP_REQ_ERR_UNKNOWN:=13, HTTP_REQ_ERR_ERRNO:=14, HTTP_REQ_ERR_EAI:=15, HTTP_REQ_ERR_PROXY:=16, HTTP_REQ_ERR_TLS_CA_NOTFOUND:=17, HTTP_REQ_ERR_TLS_CERT_NOTFOUND:=18, HTTP_REQ_ERR_TLS_KEY_NOTFOUND:=19, HTTP_REQ_ERR_TLS_CA_INVALID:=20, HTTP_REQ_ERR_TLS_CERT_INVALID:=21, HTTP_REQ_ERR_TLS_KEY_INVALID:=22, HTTP_REQ_ERR_TLS_VERIFY_FAIL:=23, HTTP_REQ_ERR_TLS_SETUP:=24, HTTP_REQ_ERR_TLS_HANDSHAKE_FAIL:=25, HTTP_REQ_ERR_TLS_CIPHER_INVALID:=26, HTTP_REQ_ERR_TLS_VERSION_INVALID:=27, HTTP_REQ_ERR_TLS_PSK_INVALID:=28, HTTP_REQ_ERR_TLS_CRL_NOTFOUND:=29, HTTP_REQ_ERR_TLS_CRL_INVALID:=30, HTTP_REQ_ERR_FINALIZE_DISCONNECT:=31, HTTP_REQ_ERR_BIND:=32, HTTP_REQ_ERR_BIND_ADDR_INUSE:=33, HTTP_REQ_ERR_BIND_ADDR_INVAL:=34, HTTP_REQ_ERR_CREATE:=35, HTTP_REQ_ERR_CREATE_TYPE:=36, HTTP_REQ_ERR_CONN:=37, HTTP_REQ_ERR_CONN_TIMEDOUT:=38, HTTP_REQ_ERR_CONN_HOSTUNREACH:=39, HTTP_REQ_ERR_TLS_CERT_EXPIRED:=40, 38 Version: 1.11.0 TF6760
## Page 39

PLC API HTTP_REQ_ERR_TLS_CN_MISMATCH:=41, HTTP_REQ_ERR_INV_PARAM:=1000, HTTP_REQ_ERR_FIFO_FULL:=1001, HTTP_REQ_ERR_TCP_SEND:=1002, HTTP_REQ_ERR_CANCELLED:=1003, HTTP_REQ_ERR_RESPONSE_TIMEDOUT:=1004, HTTP_REQ_ERR_INV_HDR_SIZE:=1005, HTTP_REQ_ERR_INV_ENCODING:=1006, HTTP_REQ_ERR_INV_CONTENT_SIZE:=1007, HTTP_REQ_ERR_INV_CHUNK_SIZE:=1008, HTTP_REQ_ERR_PARSE_HDR:=1100, HTTP_REQ_ERR_PARSE_HDR_FIELD:=1101, HTTP_REQ_ERR_PARSE_HDR_FIELD_NAME:=1102, HTTP_REQ_ERR_PARSE_HDR_FIELD_VAL:=1103, HTTP_REQ_ERR_PARSE_STATUS_LINE:=1104, HTTP_REQ_ERR_PARSE_CHUNK:=1105, HTTP_REQ_ERR_PARSE_CHUNK_SIZE:=1106, HTTP_REQ_ERR_PARSE_CHUNK_EXT_NAME:=1107, HTTP_REQ_ERR_PARSE_CHUNK_EXT_VAL:=1108, HTTP_REQ_ERR_PARSE_CHUNK_DATA:=1109, HTTP_REQ_ERR_PARSE_CHUNK_TRAILER:=1110 ) DINT; END_TYPE 5.1.2.3 ETc Iot Http Request Type TYPE ETc Iot Http Request Type: ( HTTP_GET:=0, HTTP_POST:=1, HTTP_PUT:=2, HTTP_DELETE:=3, HTTP_TRACE:=4, HTTP_OPTIONS:=5, HTTP_PATCH:=6, HTTP_CONNECT:=7, HTTP_HEAD:=8 ) DINT; END_TYPE 5.1.2.4 E_Iot Http Compression Mode TYPE E_Iot Http Compression Mode: ( No Compression:=0, Deflate:=1, Gzip:=2 ) UDINT; END_TYPE 5.1.3 Parameter List The parameter list of the Tc3_Iot Base library can be used to modify the size of different parameters. This modification is not possible during runtime and can only be done before compiling the code. For a better overview, only the parameter that are important for HTTP are listed in this documentation. Syntax Definition: VAR_GLOBAL CONSTANT Parameter_List c Size Of Http Content Type : UDINT(32..10000); c Size Of Http Client Host Name : UDINT(32..10000); c Size Of Http Tls File Paths : UDINT(32..10000); c Size Of Http Tls Key File : UDINT(32..10000); c Size Of Http Tls Key Pwd : UDINT(32..10000); c Size Of Http Tls Ciphers : UDINT(32..10000); c Size Of Http Tls Psk Identity : UDINT(32..10000); c Size Of Http Tls Psk Key : UDINT(32..10000); END_VAR TF6760 Version: 1.11.0 39
## Page 40

PLC API Parameter Name Type Description c Size Of Http Content Type UDINT(32..10000) String size definition of HTTP content type (in bytes). c Size Of Http Client Host Name UDINT(32..10000) String size definition of HTTP client hostname (in bytes). c Size Of Http Tls File Paths UDINT(32..10000) String size definition of HTTP TLS file path (in bytes). c Size Of Http Tls Key File UDINT(32..10000) String size definition of HTTP TLS key file (in bytes). c Size Of Http Tls Key Pwd UDINT(32..10000) String size definition of HTTP TLS private key password (in bytes). c Size Of Http Tls Ciphers UDINT(32..10000) String size definition of HTTP TLS cipher suites (in bytes). c Size Of Http Tls Psk Identity UDINT(32..10000) String size definition of HTTP TLS PSK identity (in bytes). c Size Of Http Tls Psk Key UDINT(32..10000) String size definition of HTTP TLS PSK (in bytes). 5.2 Tc3_Json Xml 5.2.1 Function blocks 5.2.1.1 FB_Json Dom Parser This function block is derived from the same internal function block as FB_Json Dyn Dom Parser [} 110] and thus offers the same interface. The two derived function blocks differ only in their internal memory management. FB_Json Dom Parser is optimized for the fast and efficient parsing and creation of JSON documents that are only changed a little. The function block FB_Json Dyn Dom Parser [} 110] is recommended for JSON documents to which many changes are made (e.g. the cyclic changing of a specific value in the JSON document). WARNING Use of router memory The function block occupies new memory with each change, e.g. with the methods Set Object() or Set Json(). As a result, the amount of router memory used can grow enormously after repeated actions. This allocated memory is only released again by calling the New Document [} 86]() or Parse Document [} 87]() methods. 40 Version: 1.11.0 TF6760
## Page 41

PLC API Strings in UTF-8 format The variables of type STRING used here are based on the UTF-8 format. This STRING formatting is common for MQTT communication as well as for JSON documents. In order to be able to receive special characters and texts from a wide range of languages, the character set in the Tc3_Iot Base and Tc3_Json Xml libraries is not limited to the typical character set of the data type STRING. Instead, the Unicode character set in UTF-8 format is used in conjunction with the data type STRING. If the ASCII character set is used, there is no difference between the typical formatting of a STRING and the UTF-8 formatting of a STRING. Further information on the UTF-8 STRING format and available display and conversion options can be found in the documentation for the Tc2_Utilities PLC library. Syntax FUNCTION_BLOCK FB_Json Dom Parser VAR_OUTPUT init Status : HRESULT; END_VAR Outputs Name Type init Status HRESULT TF6760 Version: 1.11.0 41
## Page 42

PLC API Methods 42 Version: 1.11.0 TF6760
## Page 43

PLC API Name Description Add Array Member [} 46] Adds an Array member to a JSON object. Add Base64Member [} 47] Adds a Base64 member to a JSON object. Add Bool Member [} 48] Adds a Bool member to a JSON object. Add Date Time Member [} 49] Adds a Date Time member to a JSON object. Add Dc Time Member [} 49] Adds a Dc Time member to a JSON object. Add Double Member [} 50] Adds a Double member to a JSON object. Add File Time Member [} 51] Adds a File Time member to a JSON object. Add Hex Binary Member [} 51] Adds a Hex Binary member to a JSON object. Add Int64Member [} 52] Adds an Int64 member to a JSON object. Add Int Member [} 53] Adds an Int member to a JSON object. Add Json Member [} 53] Adds a JSON member to a JSON object. Add Null Member [} 54] Adds a NULL member to a JSON object. Add Object Member [} 55] Adds an Object member to a JSON object. Add String Member [} 55] Adds a String member to a JSON object. Add Uint64Member [} 56] Adds an UInt64 member to a JSON object. Add Uint Member [} 57] Adds an UInt member to a JSON object. Array Begin [} 57] Returns the first element of an array. Array End [} 58] Returns the last element of an array. Clear Array [} 58] Deletes the contents of an array. Copy Document [} 59] Copies the contents of the DOM memory into a variable of data type STRING. Copy Json [} 60] Extracts a JSON object from a key and stores it in a variable of data type STRING. Copy String [} 61] Copies the value of a key into a variable of data type STRING. Find Member [} 62] Searches for a specific property in a JSON document. Find Member Path [} 63] Searches for a specific property in a JSON document (path-specific). Get Array Size [} 65] Returns the number of elements in a JSON array. Get Array Value [} 65] Returns the value at the current iterator position of an array. Get Array Value By Idx [} 66] Returns the value of an array at a specified index. Get Base64 [} 66] Decodes a Base64 value from a JSON property. Get Bool [} 67] Returns the value of a property of the data type BOOL. Get Date Time [} 67] Returns the value of a property of the data type DATE_AND_TIME. Get Dc Time [} 67] Returns the value of a property of the data type DCTIME. Get Document [} 68] Returns the content of the DOM memory as the data type STRING(255). Get Document Length [} 68] Returns the length of a JSON document in the DOM memory. Get Document Root [} 69] Returns the root node of a JSON document in the DOM memory. Get Double [} 69] Returns the value of a property of the data type LREAL. Get File Time [} 69] Returns the value of a property of the data type DCTIME. Get Hex Binary [} 70] Decodes the Hex Binary content of a property and writes it to a certain memory address, Get Int [} 71] Returns the value of a property of the data type DINT. Get Int64 [} 71] Returns the value of a property of the data type LINT. Get Json [} 71] Returns the value of a property of the data type STRING(255). Get Json Length [} 72] Returns the length of a property if this is a JSON document. TF6760 Version: 1.11.0 43
## Page 44

PLC API Name Description Get Max Decimal Places [} 73] Returns the current setting for Max Decimal Places. Get Member Name [} 73] Returns the name of a JSON property member at the position of the current iterator, Get Member Value [} 73] Returns the value of a JSON property member at the position of the current iterator, Get String [} 74] Returns the value of a property of the data type STRING(255). Get String Length [} 75] Returns the length of a property if its value is a string. Get Type [} 75] Returns the type of a property value. Get Uint [} 76] Returns the value of a property of the data type UDINT. Get Uint64 [} 76] Returns the value of a property of the data type ULINT. Has Member [} 77] Checks whether a certain property is present in the DOM memory. Is Array [} 77] Checks whether a given property is an array. Is Base64 [} 78] Checks whether the value of a given property is of the data type Base64. Is Bool [} 78] Checks whether the value of a given property is of the data type BOOL. Is Double [} 79] Checks whether the value of a given property is of the data type Double (PLC: LREAL). Is False [} 79] Checks whether the value of a given property is FALSE. Is Hex Binary [} 80] Checks whether the value of a property is in the Hex Binary format. Is Int [} 80] Checks whether the value of a given property is of the data type Integer (PLC: DINT) . Is Int64 [} 81] Checks whether the value of a given property is of the data type LINT. Is ISO8601Time Format [} 81] Checks whether the value of a given property has a time format according to ISO8601. Is Null [} 81] Checks whether the value of a given property is NULL. Is Number [} 82] Checks whether the value of a given property is a numerical value. Is Object [} 82] Checks whether the given property is a further JSON object. Is String [} 83] Checks whether the value of a given property is of the data type STRING. Is True [} 83] Checks whether the value of a given property is TRUE. Is Uint [} 84] Checks whether the value of a given property is of the data type UDINT. Is Uint64 [} 84] Checks whether the value of a given property is of the data type ULINT. Load Document From File [} 45] Loads a JSON document from a file. Member Begin [} 85] Returns the first child element below a JSON property. Member End [} 85] Returns the last child element below a JSON property. New Document [} 86] Generates a new empty JSON document in the DOM memory. Next Array [} 86] Returns the next element in an array. Next Member [} 86] Returns the next property in a JSON document. Parse Document [} 87] Loads a JSON object into the DOM memory for further processing. Popback Value Deletes the element at the end of an array. Pushback Base64Value [} 87] Appends a Base64 value to the end of an array. Pushback Bool Value [} 88] Appends a Base64 value to the end of an array. Pushback Date Time Value [} 89] Appends a value of the data type DATE_AND_TIME to the end of an array. Pushback Dc Time Value [} 90] Appends a value of the data type DCTIME to the end of an array. 44 Version: 1.11.0 TF6760
## Page 45

PLC API Name Description Pushback Double Value [} 90] Appends a value of the data type Double to the end of an array. Pushback File Time Value [} 91] Appends a value of the data type FILETIME to the end of an array. Pushback Hex Binary Value [} 91] This method appends a Hex Binary-coded value to the end of an array. Pushback Int64Value [} 92] Appends a value of the data type Int64 to the end of an array. Pushback Int Value [} 93] Appends a value of the data type INT to the end of an array. Pushback Json Value [} 93] Appends a JSON document to the end of an array. Pushback Null Value [} 94] Appends a NULL value to the end of an array. Pushback String Value [} 94] Appends a value of the data type String to the end of an array. Pushback Uint64Value [} 95] Appends a value of the data type UInt64 to the end of an array. Pushback Uint Value [} 95] Appends a value of the data type UInt to the end of an array. Remove All Members [} 96] Removes all child elements from a given property. Remove Array [} 96] Deletes the value of the current array iterator. Remove Member [} 97] Deletes the property at the current iterator. Remove Member By Name [} 98] Removes a child element from a given property. Save Document To File [} 99] Saves a JSON document in a file. Set Array [} 100] Sets the value of a property to the type "Array". Set Base64 [} 100] Sets the value of a property to a Base64-coded value. Set Bool [} 101] Sets the value of a property to a value of the data type BOOL. Set Date Time [} 102] Sets the value of a property to a value of the data type DATE_AND_TIME. Set Dc Time [} 102] Sets the value of a property to a value of the data type DCTIME. Set Double [} 103] Sets the value of a property to a value of the data type Double. Set File Time [} 103] Sets the value of a property to a value of the data type FILETIME. Set Hex Binary [} 104] Sets the value of a property to a Hex Binary-coded value. Set Int [} 104] Sets the value of a property to a value of the data type INT Set Int64 [} 105] Sets the value of a property to a value of the data type Int64. Set Json [} 105] Inserts a further JSON document into the value of a property. Set Max Decimal Places [} 106] Sets the current setting for Max Decimal Places. Set Null [} 106] Sets the value of a property to the value NULL. Set Object [} 107] Sets the value of a property to the type "Object". Set String [} 107] Sets the value of a property to a value of the data type STRING. Set Uint [} 108] Sets the value of a property to a value of the data type UInt. Set Uint64 [} 109] Sets the value of a property to a value of the data type UInt64. Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4022 x86, x64, Arm® Tc3_Json Xml 5.2.1.1.1 Load Document From File This method loads a JSON document from a file. TF6760 Version: 1.11.0 45
## Page 46

PLC API A rising edge on the input parameter b Exec triggers the loading procedure. The asynchronous process is terminated as soon as the reference b Exec is set back to FALSE from the method. When the process ends, the return value of the method indicates whether the loading of the file was successful (TRUE) or failed (FALSE) for the duration of one call. Encoding Please note that the imported files must be formatted in UTF-8. Formats such as UTF-16 are not supported. Syntax METHOD Load Document From File : BOOL VAR_IN_OUT CONSTANT s File : STRING; END_VAR VAR_INPUT b Exec : REFERENCE TO BOOL; END_VAR VAR_OUTPUT hr Error Code: HRESULT; END_VAR Return value Name Type Load Document From File BOOL Inputs Name Type b Exec REFERENCE TO BOOL / Inputs/outputs Name Type s File STRING Outputs Name Type hr Error Code HRESULT Sample call: IF b Load THEN b Loaded := fb Json. Load Document From File(s File, b Load); END_IF 5.2.1.1.2 Add Array Member This method adds an array member to a JSON object. Syntax METHOD Add Array Member : SJson Value VAR_INPUT v : SJson Value; 46 Version: 1.11.0 TF6760
## Page 47

PLC API END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR VAR_INPUT reserve : UDINT; END_VAR Return value Name Type Add Array Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) reserve UDINT / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Add Array Member(json Doc, 'Test Array', 0); 5.2.1.1.3 Add Base64Member This method adds a Base64 member to a JSON object. A structure, for example, can be addressed as an input parameter. The corresponding Base64 coding is done by the method. Syntax METHOD Add Base64Member : SJson Value VAR_INPUT v : SJson Value; p : PVOID; n : DINT; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Base64Member SJson Value (note possible invalidity) TF6760 Version: 1.11.0 47
## Page 48

PLC API Inputs Name Type v SJson Value (note possible invalidity) p PVOID n DINT / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Base64 := fb Json. Add Base64Member(json Doc, 'Test Base64', ADR(st Struct), SIZEOF(st Struct)); 5.2.1.1.4 Add Bool Member This method adds a Bool member to a JSON object. Syntax METHOD Add Bool Member : SJson Value VAR_INPUT v : SJson Value; value : BOOL; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Bool Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value BOOL / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Bool Member(json Doc, 'Test Bool', TRUE); 48 Version: 1.11.0 TF6760
## Page 49

PLC API 5.2.1.1.5 Add Date Time Member This method adds a Date Time member to a JSON object. Syntax METHOD Add Date Time Member : SJson Value VAR_INPUT v : SJson Value; value : DATE_AND_TIME; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Date Time Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value DATE_AND_TIME / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Date Time Member(json Doc, 'Test Date Time', DT#2018-11-22-12:12); 5.2.1.1.6 Add Dc Time Member This method adds a Dc Time member to a JSON object. Syntax METHOD Add Dc Time Member : SJson Value VAR_INPUT v : SJson Value; value : DCTIME; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR TF6760 Version: 1.11.0 49
## Page 50

PLC API Return value Name Type Add Dc Time Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value DCTIME / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Dc Time Member(json Doc, 'Test Dc Time', 1234); 5.2.1.1.7 Add Double Member This method adds a Double member to a JSON object. Syntax METHOD Add Double Member : SJson Value VAR_INPUT v : SJson Value; value : LREAL; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Double Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value LREAL / Inputs/outputs Name Type member STRING Sample call: 50 Version: 1.11.0 TF6760
## Page 51

PLC API json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Double Member(json Doc, 'Test Double', 42.42); 5.2.1.1.8 Add File Time Member This method adds a File Time member to a JSON object. Syntax METHOD Add File Time Member : SJson Value VAR_INPUT v : SJson Value; value : FILETIME; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add File Time Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value FILETIME / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add File Time Member(json Doc, 'Test File Time', ft Time); 5.2.1.1.9 Add Hex Binary Member This method adds a Hex Binary member to a JSON object. Syntax METHOD Add Hex Binary Member : SJson Value VAR_INPUT v : SJson Value; p : PVOID; n : DINT; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR TF6760 Version: 1.11.0 51
## Page 52

PLC API Return value Name Type Add Hex Binary Member Sjson Value (note possible invalidity) Inputs Name Type v Sjson Value (note possible invalidity) p PVOID n DINT / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Hex Binary Member(json Doc, 'Test Hex Binary', s Hex Binary, SIZEOF(s Hex Binary)); 5.2.1.1.10 Add Int64Member This method adds an Int64 member to a JSON object. Syntax METHOD Add File Time Member : Sjson Value VAR_INPUT v : Sjson Value; value : LINT; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Int64Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value LINT / Inputs/outputs Name Type member STRING 52 Version: 1.11.0 TF6760
## Page 53

PLC API Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Int64Member(json Doc, 'Test Int64', 42); 5.2.1.1.11 Add Int Member This method adds an Int member to a JSON object. Syntax METHOD Add Int Member : SJson Value VAR_INPUT v : SJson Value; value : DINT; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Int Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value DINT / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Int Member(json Doc, 'Test Int', 42); 5.2.1.1.12 Add Json Member This method adds a JSON member to a JSON object. Syntax METHOD Add Json Member: SJson Value VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT member : STRING; raw Json : STRING; END_VAR TF6760 Version: 1.11.0 53
## Page 54

PLC API Return value Name Type Add Json Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type member STRING raw Json STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Json Member(json Doc, 'Test Json', s Json); 5.2.1.1.13 Add Null Member This method adds a NULL member to a JSON object. Syntax METHOD Add Null Member : SJson Value VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Null Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Null Member(json Doc, 'Test Json'); 54 Version: 1.11.0 TF6760
## Page 55

PLC API 5.2.1.1.14 Add Object Member This method adds an Object member to a JSON object. Syntax METHOD Add Object Member : SJson Value VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Object Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Object Member(json Doc, 'Test Object'); 5.2.1.1.15 Add String Member This method adds a String member to a JSON object. Syntax METHOD Add String Member : SJson Value VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT member : STRING; value : STRING; END_VAR Return value Name Type Add String Member SJson Value (note possible invalidity) TF6760 Version: 1.11.0 55
## Page 56

PLC API Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type member STRING value STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add String Member(json Doc, 'Test String', 'Test'); 5.2.1.1.16 Add Uint64Member This method adds an UInt64 member to a JSON object. Syntax METHOD Add Uint64Member : SJson Value VAR_INPUT v : SJson Value; value : ULINT; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Uint64Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value ULINT / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Uint64Member(json Doc, 'Test Uint64', 42); 56 Version: 1.11.0 TF6760
## Page 57

PLC API 5.2.1.1.17 Add Uint Member This method adds an UInt member to a JSON object. Syntax METHOD Add Uint Member : SJson Value VAR_INPUT v : SJson Value; value : UDINT; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Add Uint Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value UDINT / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Mem := fb Json. Add Uint Member(json Doc, 'Test Uint', 42); 5.2.1.1.18 Array Begin This method returns the first element of an array and can be used together with the methods Array End() and Next Array() for iteration through a JSON array. Syntax METHOD Array Begin : SJson AIterator VAR_INPUT v : SJson Value; END_VAR Return value Name Type Array Begin SJson AIterator TF6760 Version: 1.11.0 57
## Page 58

PLC API Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Iterator := fb Json. Array Begin(json Array); json Iterator End := fb Json. Array End(json Array); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Array Value(json Iterator); json Iterator := fb Json. Next Array(json Iterator); END_WHILE 5.2.1.1.19 Array End This method returns the last element of an array and can be used together with the methods Array Begin() and Next Array() for iteration through a JSON array. Syntax METHOD Array End : SJson AIterator VAR_INPUT v : SJson Value; END_VAR Return value Name Type Array End SJson AIterator Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Iterator := fb Json. Array Begin(json Array); json Iterator End := fb Json. Array End(json Array); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Array Value(json Iterator); json Iterator := fb Json. Next Array(json Iterator); END_WHILE 5.2.1.1.20 Clear Array This method deletes the content of an array. Syntax METHOD Clear Array : BOOL VAR_INPUT v : SJson Value; i : SJson AIterator; END_VAR 58 Version: 1.11.0 TF6760
## Page 59

PLC API Return value Name Type Clear Array BOOL Inputs Name Type v SJson Value (note possible invalidity) i SJson AIterator Sample call: The following JSON document is to be loaded into the DOM memory: s Message := '{"serial Number":"123","battery Voltage":"1547m V","click Type":"SINGLE", "array": ["Hello",2,3]}'; The values of the JSON array "array" are to be deleted. First of all, the JSON document is searched iteratively for the "array" property, after which all elements of the array are deleted by calling the Clear Array() method. json Doc := fb Json. Parse Document(s Message); json Iterator := fb Json. Member Begin(json Doc); json Iterator End := fb Json. Member End(json Doc); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Member Name(json Iterator); json Value := fb Json. Get Member Value(json Iterator); IF s Name = 'array' THEN json Array Iterator := fb Json. Array Begin(json Value); fb Json. Clear Array(json Value, json Array Iterator); END_IF json Iterator := fb Json. Next Member(json Iterator); END_WHILE 5.2.1.1.21 Copy Document This method copies the contents of the DOM memory into a variable of data type STRING, which can have any length. The method returns the length of the string (including null termination). If the destination buffer is too small, it is emptied by a null termination and returned as length 0. Syntax METHOD Copy Document : UDINT VAR_INPUT n Doc : DINT; END_VAR VAR_IN_OUT CONSTANT p Doc : STRING; END_VAR Return value Name Type Copy Document UDINT Inputs Name Type n Doc DINT TF6760 Version: 1.11.0 59
## Page 60

PLC API / Inputs/Outputs Name Type p Doc STRING Sample call: n Len := fb Json. Copy Document(s Json, SIZEOF(s Json)); 5.2.1.1.22 Copy From Syntax METHOD Copy From : SJson Value VAR_INPUT v : SJson Value; w : SJson Value; END_VAR Return value Name Type Copy From SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) w SJson Value (note possible invalidity) 5.2.1.1.23 Copy Json This method extracts a JSON object from a key and stores it in a variable of data type STRING. This STRING can have any length. The method returns the length of the copied JSON object (including null termination). If the destination buffer is too small, it is emptied by a null termination and returned as length 0. Syntax METHOD Copy Json : UDINT VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT p Doc : STRING; n Doc : UDINT; END_VAR Return value Name Type Copy Json UDINT 60 Version: 1.11.0 TF6760
## Page 61

PLC API Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type p Doc STRING n Doc STRING Sample call: The following JSON document is to be loaded into the DOM memory: s Message := ' {"serial Number":"123","meta":{"battery Voltage":"1547m V","click Type":"SINGLE"}}'; The value of the JSON object "meta" is to be extracted and stored in a variable of data type STRING. First the JSON document is searched iteratively for the property "meta", then its value or sub-object is extracted by calling the method Copy Json(). json Doc := fb Json. Parse Document(s Message); json Iterator := fb Json. Member Begin(json Doc); json Iterator End := fb Json. Member End(json Doc); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Member Name(json Iterator); json Value := fb Json. Get Member Value(json Iterator); IF s Name = 'meta' THEN fb Json. Copy Json(json Value, s String, SIZEOF(s String)); END_IF json Iterator := fb Json. Next Member(json Iterator); END_WHILE After this run, the s String variable has the following content: {"battery Voltage":"1547m V","click Type":"SINGLE"} 5.2.1.1.24 Copy String This method copies the value of a key into a variable of the data type STRING, which can be of any length. The method returns the length of the copied string (including null termination). If the destination buffer is too small, it is emptied by a null termination and returned as length 0. Syntax METHOD Copy String : UDINT VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT p Str : STRING; n Str : UDINT; END_VAR Return value Name Type Copy String UDINT TF6760 Version: 1.11.0 61
## Page 62

PLC API Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type p Str STRING n Str UDINT Sample call: The following JSON document is to be loaded into the DOM memory: s Message := ' {"serial Number":"123","battery Voltage":"1547m V","click Type":"SINGLE"}'; The value of the key "click Type" is to be extracted and stored in a variable of data type STRING. First, the JSON document is iteratively searched for the property "click Type". json Doc := fb Json. Parse Document(s Message); json Iterator := fb Json. Member Begin(json Doc); json Iterator End := fb Json. Member End(json Doc); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Member Name(json Iterator); json Value := fb Json. Get Member Value(json Iterator); IF s Name = 'click Type' THEN fb Json. Copy String(json Value, s String, SIZEOF(s String)); END_IF json Iterator := fb Json. Next Member(json Iterator); END_WHILE After this run, the s String variable has the following content: SINGLE 5.2.1.1.25 Exception Raised Syntax METHOD Exception Raised : BOOL Return value Name Type Exception Raised BOOL 5.2.1.1.26 Find Member This method searches for a specific property in a JSON document and returns it. 0 is returned if no corresponding property is found. 62 Version: 1.11.0 TF6760
## Page 63

PLC API Syntax METHOD Find Member : SJson Value VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Find Member SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type member STRING Sample call: json Prop := fb Json. Find Member(json Doc, 'Property Name'); 5.2.1.1.27 Find Member Path This method searches for a specific property in a JSON document and returns it. The property is specified according to its path in the document. 0 is returned if no corresponding property is found. Syntax METHOD Find Member Path : SJson Value VAR_INPUT v : SJson Value END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Find Member Path SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) TF6760 Version: 1.11.0 63
## Page 64

PLC API / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member Path(json Doc, s Path); Accessing nested objects works according to the scheme a/b/c, to find a variable in a JSON hierarchy. The call for the variable c of the following JSON document is: json Prop := fb Json. Find Member Path(json Doc, 'a/b/c'); { "a":{ "b":{ "c": 123 } } } Support for arrays The method supports JSON documents with arrays from Twin CAT version >3.1.4024.35. The # character can be used to access elements of an array. json Prop := fb Json. Find Member Path(json Doc, '#1/Third#2'); [ { "First": 4 }, { "Second": 12, "Third": [ 1, 2, 3 ], "Fourth": { "a": true } }, ] The example call accesses the second element of the outer array (#1), then the third element of the array under the sub-element Third. Treatment of special cases Inserting the ~ character provides special treatment within a path. The following table lists the different possibilities. Expression Result Example ~0 ~ is used as a character in the Test/Hello~0123 becomes Test/ string. Hello~123 ~1 The expression is replaced by the Test/Hello~1123 becomes Test/ character /, which is not interpreted Hello/123 as a separator, but as part of the string. ~2 The expression is replaced by the Test/Hello~2123 becomes Test/ character # , which is not Hello#123 interpreted as an array index, but as part of the string. 64 Version: 1.11.0 TF6760
## Page 65

PLC API 5.2.1.1.28 Get Array Size This method returns the number of elements in a JSON array. Syntax METHOD Get Array Size : UDINT VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Array Size UDINT Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); n Size := fb Json. Get Array Size(json Array); 5.2.1.1.29 Get Array Value This method returns the value at the current iterator position of an array. Syntax METHOD Get Array Value : SJson Value VAR_INPUT i : SJson AIterator; END_VAR Return value Name Type Get Array Value SJson Value (note possible invalidity) Inputs Name Type i SJson AIterator Sample call: json Iterator := fb Json. Array Begin(json Array); json Iterator End := fb Json. Array End(json Array); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Array Value(json Iterator); json Iterator := fb Json. Next Array(json Iterator); END_WHILE TF6760 Version: 1.11.0 65
## Page 66

PLC API 5.2.1.1.30 Get Array Value By Idx This method returns the value of an array in a specified index. Syntax METHOD Get Array Value By Idx : SJson Value VAR_INPUT v : SJson Value; idx : UDINT; END_VAR Return value Name Type Get Array Value By Idx SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) idx UDINT Sample call: json Value := fb Json. Get Array Value By Idx(json Array, 1); 5.2.1.1.31 Get Base64 This method decodes a Base64 value from a JSON property. If the content of a data structure, for example, is located behind the Base64 value, the decoded content can also be placed on an identical structure again. Syntax METHOD Get Base64: DINT VAR_INPUT v : SJson Value; p : PVOID; n : DINT; END_VAR Return value Name Type Get Base64 DINT Inputs Name Type v SJson Value (note possible invalidity) p PVOID n DINT 66 Version: 1.11.0 TF6760
## Page 67

PLC API Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Base64 := fb Json. Find Member(json Doc, 'base64'); n Size := fb Json. Get Base64(json Base64, ADR(st Struct), SIZEOF(st Struct)); 5.2.1.1.32 Get Bool This method returns the value of a property of the data type BOOL. Syntax METHOD Get Bool : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Bool BOOL Inputs Name Type v Sjson Value (note possible invalidity) 5.2.1.1.33 Get Date Time This method returns the value of a property of the data type DATE_AND_TIME. Syntax METHOD Get Date Time : DATE_AND_TIME VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Date Time DATE_AND_TIME Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.34 Get Dc Time TF6760 Version: 1.11.0 67
## Page 68

PLC API This method returns the value of a property of the data type DCTIME. Syntax METHOD Get Dc Time : DCTIME VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Dc Time DCTIME Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); dc Time := fb Json. Get Dc Time(json Prop); 5.2.1.1.35 Get Document This method returns the content of the DOM memory as the data type STRING(255). With longer strings, the method will return a NULL string. In this case the method Copy Document [} 59]() must be used. Syntax METHOD Get Document : STRING(255) Return value Name Type Get Document STRING(255) Sample call: s Json := fb Json. Get Document(); 5.2.1.1.36 Get Document Length This method returns the length of a JSON document in the DOM memory. Syntax METHOD Get Document Length: UDINT 68 Version: 1.11.0 TF6760
## Page 69

PLC API Return value Name Type Get Document Length UDINT Sample call: n Len := fb Json. Get Document Length(); 5.2.1.1.37 Get Document Root This method returns the root node of a JSON document in the DOM memory. Syntax METHOD Get Document Root : SJson Value Return value Name Type Get Document Root Sjson Value (note possible invalidity) Sample call: json Root := fb Json. Get Document Root(); 5.2.1.1.38 Get Double This method returns the value of a property of the data type LREAL. Syntax METHOD Get Double : LREAL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Double LREAL Inputs Name Type v Sjson Value (note possible invalidity) 5.2.1.1.39 Get File Time TF6760 Version: 1.11.0 69
## Page 70

PLC API This method returns the value of a property of the data type DCTIME. Syntax METHOD Get File Time : FILETIME VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get File Time FILETIME Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); file Time := fb Json. Get File Time(json Prop); 5.2.1.1.40 Get Hex Binary This method decodes the Hex Binary content of a property and writes it to a certain memory address, e.g. to a data structure. Syntax METHOD Get Hex Binary : DINT VAR_INPUT v : SJson Value; p : PVOID; n : DINT; END_VAR Return value Name Type Get Hex Binary DINT Inputs Name Type v SJson Value (note possible invalidity) p PVOID n DINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); n Len := fb Json. Get Hex Binary(json Prop, ADR(st Struct), SIZEOF(st Struct)); 70 Version: 1.11.0 TF6760
## Page 71

PLC API 5.2.1.1.41 Get Int This method returns the value of a property of the data type DINT. Syntax METHOD Get Int : DINT VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Int DINT Inputs Name Type v Sjson Value (note possible invalidity) 5.2.1.1.42 Get Int64 This method returns the value of a property of the data type LINT. Syntax METHOD Get Int64 : LINT VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Int64 LINT Inputs Name Type v Sjson Value (note possible invalidity) 5.2.1.1.43 Get Json TF6760 Version: 1.11.0 71
## Page 72

PLC API This method returns the value of a property as data type STRING(255), if this is a JSON document itself. With longer strings, the method will return a NULL string. In this case the method Copy Json [} 60]() must be used. Syntax METHOD Get Json : STRING(255) VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Json STRING(255) Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); s Json := fb Json. Get Json(json Prop); 5.2.1.1.44 Get Json Length This method returns the length of a property if this is a JSON document. Syntax METHOD Get Json Length : UDINT VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Json Length UDINT Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); n Len := fb Json. Get Json Length(json Prop); 72 Version: 1.11.0 TF6760
## Page 73

PLC API 5.2.1.1.45 Get Max Decimal Places This method returns the current setting for Max Decimal Places. This influences the number of decimal places in the case of floating-point numbers. Syntax METHOD Get Max Decimal Places : DINT Return value Name Type Get Max Decimal Places DINT Sample call: n Dec := fb Json. Get Max Decimal Places(); 5.2.1.1.46 Get Member Name This method returns the name of a JSON property member at the position of the current iterator, e.g. during the iteration of a child element of a JSON property with the methods Member Begin(), Member End() and Next Member(). Syntax METHOD Get Member Name : STRING(255) VAR_INPUT i : SJson Iterator; END_VAR Return value Name Type Get Member Name STRING(255) Inputs Name Type i SJson Iterator Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Iterator := fb Json. Member Begin(json Doc); json Iterator End := fb Json. Member End(json Doc); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Member Name(json Iterator); json Iterator := fb Json. Next Member(json Iterator); END_WHILE 5.2.1.1.47 Get Member Value TF6760 Version: 1.11.0 73
## Page 74

PLC API This method returns the value of a JSON property member at the position of the current iterator, e.g. during the iteration of a child element of a JSON property with the methods Member Begin(), Member End() and Next Member(). Syntax METHOD Get Member Value : SJson Value VAR_INPUT i : SJson Iterator; END_VAR Return value Name Type Get Member Value SJson Value (note possible invalidity) Inputs Name Type i SJson Iterator Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Iterator := fb Json. Member Begin(json Doc); json Iterator End := fb Json. Member End(json Doc); WHILE json Iterator <> json Iterator End DO json Value := fb Json. Get Member Value(json Iterator); json Iterator := fb Json. Next Member(json Iterator); END_WHILE 5.2.1.1.48 Get String This method returns the value of a property of the data type STRING(255). With longer strings, the method will return a NULL string. In this case the method Copy String [} 61]() must be used. Syntax METHOD Get String : STRING(255) VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get String STRING(255) Inputs Name Type v SJson Value (note possible invalidity) 74 Version: 1.11.0 TF6760
## Page 75

PLC API 5.2.1.1.49 Get String Length This method returns the length of a property if its value is a string. Syntax METHOD Get String Length : UDINT VAR_INPUT v : SJson Value END_VAR Return value Name Type Get String Length UDINT Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); n Len := fb Json. Get String Length(json Prop); 5.2.1.1.50 Get Type This method returns the type of a property value. The return value can assume one of the values of the enum EJson Type. Syntax METHOD Get Type : EJson Type VAR_INPUT v : SJson Value END_VAR TYPE EJson Type : ( e Null Type := 0, e False Type := 1, e True Type := 2, e Object Type := 3, e Array Type := 4, e String Type := 5, e Number Type := 6 ) DINT; Return value Name Type Get Type EJson Type TF6760 Version: 1.11.0 75
## Page 76

PLC API Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); e Json Type := fb Json. Get Type(json Prop); 5.2.1.1.51 Get Uint This method returns the value of a property of the data type UDINT. Syntax METHOD Get Uint : UDINT VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Uint UDINT Inputs Name Type v Sjson Value (note possible invalidity) 5.2.1.1.52 Get Uint64 This method returns the value of a property of the data type ULINT. Syntax METHOD Get Uint64 : ULINT VAR_INPUT v : SJson Value; END_VAR Return value Name Type Get Uint64 ULINT 76 Version: 1.11.0 TF6760
## Page 77

PLC API Inputs Name Type v Sjson Value (note possible invalidity) 5.2.1.1.53 Has Member This method checks whether a certain property is present in the DOM memory. If the property is present the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Has Member : BOOL VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Has Member BOOL Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type member STRING Sample call: b Has Member := fb Json. Has Member(json Doc, 'Property Name'); 5.2.1.1.54 Is Array This method checks whether a given property is an array. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Array : BOOL VAR_INPUT v : SJson Value; END_VAR TF6760 Version: 1.11.0 77
## Page 78

PLC API Return value Name Type Is Array BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.55 Is Base64 This method checks whether the value of a given property is of the data type Base64. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Base64 : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is Base64 BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.56 Is Bool This method checks whether the value of a given property is of the data type BOOL. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Bool : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is Bool BOOL 78 Version: 1.11.0 TF6760
## Page 79

PLC API Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.57 Is Double This method checks whether the value of a given property is of the data type Double (PLC: LREAL). If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Double : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is Double BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.58 Is False This method checks whether the value of a given property is FALSE. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is False : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is False BOOL Inputs Name Type v SJson Value (note possible invalidity) TF6760 Version: 1.11.0 79
## Page 80

PLC API 5.2.1.1.59 Is Hex Binary This method checks whether the value of a property is in the Hex Binary format. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Hex Binary: BOOL VAR_INPUT v : SJson Value END_VAR Return value Name Type Is Hex Binary BOOL Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); b Ret := fb Json. Is Hex Binary(json Prop); 5.2.1.1.60 Is Int This method checks whether the value of a given property is of the data type Integer (PLC: DINT). If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Int : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is Int BOOL Inputs Name Type v SJson Value (note possible invalidity) 80 Version: 1.11.0 TF6760
## Page 81

PLC API 5.2.1.1.61 Is Int64 This method checks whether the value of a given property is of the data type LINT. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Int64 : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is Int64 BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.62 Is ISO8601Time Format This method checks whether the value of a given property has a time format according to ISO8601. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is ISO8601Time Format : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is ISO8601Time Format BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.63 Is Null TF6760 Version: 1.11.0 81
## Page 82

PLC API This method checks whether the value of a given property is NULL. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Null : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is Null BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.64 Is Number This method checks whether the value of a given property is a numerical value. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Number : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is Number BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.65 Is Object This method checks whether the given property is a further JSON object. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Object : BOOL VAR_INPUT v : SJson Value; END_VAR 82 Version: 1.11.0 TF6760
## Page 83

PLC API Return value Name Type Is Object BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.66 Is String This method checks whether the value of a given property is of the data type STRING. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is String : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is String BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.67 Is True This method checks whether the value of a given property is TRUE. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is True : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is True BOOL TF6760 Version: 1.11.0 83
## Page 84

PLC API Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.68 Is Uint This method checks whether the value of a given property is of the data type UDINT. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Uint : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is Uint BOOL Inputs Name Type v SJson Value (note possible invalidity) 5.2.1.1.69 Is Uint64 This method checks whether the value of a given property is of the data type ULINT. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Uint64 : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Is Uint64 BOOL Inputs Name Type v SJson Value (note possible invalidity) 84 Version: 1.11.0 TF6760
## Page 85

PLC API 5.2.1.1.70 Member Begin This method returns the first child element below a JSON property and can be used by a JSON property together with the methods Member End() and Next Member() for iteration. Syntax METHOD Member Begin : SJson Iterator VAR_INPUT v : SJson Value; END_VAR Return value Name Type Member Begin SJson Iterator Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Iterator := fb Json. Member Begin(json Doc); json Iterator End := fb Json. Member End(json Doc); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Member Name(json Iterator); json Iterator := fb Json. Next Member(json Iterator); END_WHILE 5.2.1.1.71 Member End This method returns the last child element below a JSON property and can be used by a JSON property together with the methods Member Begin() and Next Member() for iteration. Syntax METHOD Member End : SJson Iterator VAR_INPUT v : SJson Value; END_VAR Return value Name Type Member End SJson Iterator Inputs Name Type v SJson Value (note possible invalidity) TF6760 Version: 1.11.0 85
## Page 86

PLC API Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Iterator := fb Json. Member Begin(json Doc); json Iterator End := fb Json. Member End(json Doc); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Member Name(json Iterator); json Iterator := fb Json. Next Member(json Iterator); END_WHILE 5.2.1.1.72 New Document This method generates a new empty JSON document in the DOM memory. Syntax METHOD New Document : SJson Value Sample call: json Doc := fb Json. New Document(); Return value Name Type New Document SJson Value (note possible invalidity) 5.2.1.1.73 Next Array Syntax METHOD Next Array : SJson AIterator VAR_INPUT v : SJson AIterator; END_VAR Return value Name Type Next Array SJson AIterator Inputs Name Type i SJson Alterator 5.2.1.1.74 Next Member This method returns the next child element below a JSON property and can be used by a JSON property together with the methods Member Begin [} 85]() and Member End [} 85]() for iteration. 86 Version: 1.11.0 TF6760
## Page 87

PLC API Syntax METHOD Next Member : SJson Iterator VAR_INPUT v : SJson Iterator; END_VAR Return value Name Type Next Member SJson Iterator Inputs Name Type i SJson Iterator 5.2.1.1.75 Parse Document This method loads a JSON object into the DOM memory for further processing. The JSON object takes the form of a string and is transferred to the method as an input. A reference to the JSON document in the DOM memory is returned to the caller. Syntax METHOD Parse Document : SJson Value VAR_IN_OUT CONSTANT s Json : STRING; END_VAR Return value Name Type Parse Document SJson Value (note possible invalidity) Inputs Name Type s Json STRING Sample call: json Doc := fb Json. Parse Document(s Json String); 5.2.1.1.76 Pushback Base64Value This method appends a Base64 value to the end of an array. A structure, for example, can be addressed as an input parameter. The corresponding Base64 coding is done by the method. TF6760 Version: 1.11.0 87
## Page 88

PLC API Syntax METHOD Pushback Base64Value : SJson Value VAR_INPUT v : SJson Value; p : PVOID; n : DINT; END_VAR Return value Name Type Pushback Base64Value SJson Value (note possible invalidity) Inputs Name Type v s Json Value (note possible invalidity) p PVOID n DINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Base64Value(json Array, ADR(st Struct), SIZEOF(st Struct)); 5.2.1.1.77 Pushback Bool Value This method appends a value of the data type BOOL to the end of an array. Syntax METHOD Pushback Bool Value : SJson Value VAR_INPUT v : SJson Value; value : BOOL; END_VAR Return value Name Type Pushback Bool Value SJson Value (note possible invalidity) Inputs Name Type v s Json Value (note possible invalidity) value BOOL Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Bool Value(json Array, TRUE); 88 Version: 1.11.0 TF6760
## Page 89

PLC API 5.2.1.1.78 Pushback Copy Value This method adds a JSON document from the memory of a FB_Json Dom Parser [} 40] to the end of an array. Syntax METHOD Pushback Copy Value : SJson Value VAR_INPUT v : SJson Value; json : SJson Value; END_VAR Return value Name Type Pushback Copy Value Sjson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) json SJson Value (note possible invalidity) Sample call: json Copy:=fb Json Create. New Document(); fb Json Create. Add Int Member(json Copy,'a',1); fb Json Create. Add Int Member(json Copy,'b',2); json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Copy Value(json Array, json Copy); 5.2.1.1.79 Pushback Date Time Value This method appends a value of the data type DATE_AND_TIME to the end of an array. Syntax METHOD Pushback Date Time Value : SJson Value VAR_INPUT v : SJson Value; value : DATE_AND_TIME; END_VAR Return value Name Type Pushback Date Time Value SJson Value (note possible invalidity) TF6760 Version: 1.11.0 89
## Page 90

PLC API Inputs Name Type v s Json Value (note possible invalidity) value DATE_AND_TIME Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Date Time Value(json Array, dt Time); 5.2.1.1.80 Pushback Dc Time Value This method appends a value of the data type DCTIME to the end of an array. Syntax METHOD Pushback Dc Time Value : SJson Value VAR_INPUT v : SJson Value; value : DCTIME; END_VAR Return value Name Type Pushback Dc Time Value SJson Value (note possible invalidity) Inputs Name Type v s Json Value (note possible invalidity) value DCTIME Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Dc Time Value(json Array, dc Time); 5.2.1.1.81 Pushback Double Value This method appends a value of the data type Double to the end of an array. Syntax METHOD Pushback Double Value : SJson Value VAR_INPUT v : SJson Value; value : LREAL; END_VAR 90 Version: 1.11.0 TF6760
## Page 91

PLC API Return value Name Type Pushback Double Value SJson Value (note possible invalidity) Inputs Name Type v s Json Value (note possible invalidity) value LREAL Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Double Value(json Array, 42.42); 5.2.1.1.82 Pushback File Time Value This method appends a value of the data type FILETIME to the end of an array. Syntax METHOD Pushback File Time Value : SJson Value VAR_INPUT v : SJson Value; value : FILETIME; END_VAR Return value Name Type Pushback File Time Value SJson Value (note possible invalidity) Inputs Name Type v s Json Value (note possible invalidity) value FILETIME Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback File Time Value(json Array, file Time); 5.2.1.1.83 Pushback Hex Binary Value This method appends a Hex Binary value to the end of an array. The coding in the Hex Binary format is executed by the method. A data structure, for example, can be used as the source. TF6760 Version: 1.11.0 91
## Page 92

PLC API Syntax METHOD Pushback Hex Binary Value : SJson Value VAR_INPUT v : SJson Value; p : PVOID; n : DINT; END_VAR Return value Name Type Pushback Hex Binary Value SJson Value (note possible invalidity) Inputs Name Type v s Json Value (note possible invalidity) p PVOID n DINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Hex Binary Value(json Array, ADR(st Struct), SIZEOF(st Struct)); 5.2.1.1.84 Pushback Int64Value This method appends a value of the data type Int64 to the end of an array. Syntax METHOD Pushback Int64Value : SJson Value VAR_INPUT v : SJson Value; value : LINT; END_VAR Return value Name Type Pushback Int64Value SJson Value (note possible invalidity) Inputs Name Type v s Json Value (note possible invalidity) value LINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Int64Value(json Array, 42); 92 Version: 1.11.0 TF6760
## Page 93

PLC API 5.2.1.1.85 Pushback Int Value This method appends a value of the data type INT to the end of an array. Syntax METHOD Pushback Int Value : SJson Value VAR_INPUT v : SJson Value; value : DINT; END_VAR Return value Name Type Pushback Int Value SJson Value (note possible invalidity) Inputs Name Type v s Json Value (note possible invalidity) value DINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Int Value(json Array, 42); 5.2.1.1.86 Pushback Json Value This method appends a JSON document that exists as a STRING in the PLC to the end of an array. Syntax METHOD Pushback Json Value : SJson Value VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT raw Json : STRING; END_VAR Return value Name Type Pushback Json Value SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) TF6760 Version: 1.11.0 93
## Page 94

PLC API / Inputs/outputs Name Type raw Json STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Json Value(json Array, s Json); 5.2.1.1.87 Pushback Null Value This method appends a NULL value to the end of an array. Syntax METHOD Pushback Null Value : SJson Value VAR_INPUT v : SJson Value; END_VAR Return value Name Type Pushback Null Value SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Null Value(json Array); 5.2.1.1.88 Pushback String Value This method appends a value of the data type DCTIME to the end of an array. Syntax METHOD Pushback String Value : SJson Value VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT value : STRING; END_VAR Return value Name Type Pushback String Value SJson Value (note possible invalidity) 94 Version: 1.11.0 TF6760
## Page 95

PLC API Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type value STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback String Value(json Array, s String); 5.2.1.1.89 Pushback Uint64Value This method appends a value of the data type UInt64 to the end of an array. Syntax METHOD Pushback Uint64Value : SJson Value VAR_INPUT v : SJson Value; value : ULINT; END_VAR Return value Name Type Pushback Uint64Value SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value ULINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Uint64Value(json Array, 42); 5.2.1.1.90 Pushback Uint Value This method appends a value of the data type UInt to the end of an array. Syntax METHOD Pushback Uint Value : SJson Value VAR_INPUT v : SJson Value; value : UDINT; END_VAR TF6760 Version: 1.11.0 95
## Page 96

PLC API Return value Name Type Pushback Uint Value SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value UDINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Array := fb Json. Find Member(json Doc, 'array'); json Value := fb Json. Pushback Uint Value(json Array, 42); 5.2.1.1.91 Remove All Members This method removes all child elements from a given property. Syntax METHOD Remove All Members : BOOL VAR_INPUT v : SJson Value; END_VAR Return value Name Type Remove All Members BOOL Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); b Removed := fb Json. Remove All Members(json Prop); 5.2.1.1.92 Remove Array This method deletes the value of the current array iterator. Syntax METHOD Remove Array : BOOL VAR_INPUT v : SJson Value; i : SJson AIterator; END_VAR 96 Version: 1.11.0 TF6760
## Page 97

PLC API Return value Name Type Remove Array BOOL Inputs Name Type v SJson Value (note possible invalidity) i SJson AIterator Sample call: The following JSON document is to be loaded into the DOM memory: s Message := '{"serial Number":"123","battery Voltage":"1547m V","click Type":"SINGLE", "array": ["Hello",2,3]}'; The first array position is to be deleted. First of all, the JSON document is searched iteratively for the "array" property, after which the first element of the array is removed by calling the Remove Array() method. json Doc := fb Json. Parse Document(s Message); json Iterator := fb Json. Member Begin(json Doc); json Iterator End := fb Json. Member End(json Doc); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Member Name(json Iterator); json Value := fb Json. Get Member Value(json Iterator); IF s Name = 'array' THEN json Array Iterator := fb Json. Array Begin(json Value); fb Json. Remove Array(json Value, json Array Iterator); END_IF json Iterator := fb Json. Next Member(json Iterator); END_WHILE 5.2.1.1.93 Remove Member This method deletes the property at the current iterator. Syntax METHOD Remove Member : BOOL VAR_INPUT v : SJson Value; i : SJson Iterator; keep Order : BOOL; END_VAR Return value Name Type Remove Member BOOL Inputs Name Type v SJson Value (note possible invalidity) i SJson Iterator keep Order BOOL TF6760 Version: 1.11.0 97
## Page 98

PLC API Sample call: The following JSON document is to be loaded into the DOM memory: s Message := '{"serial Number":"123","battery Voltage":"1547m V","click Type":"SINGLE", "array": ["Hello",2,3]}'; The "array" property is to be deleted. First of all, the JSON document is searched for the "array" property, after which the property is removed. json Doc := fb Json. Parse Document(s Message); json Iterator := fb Json. Member Begin(json Doc); json Iterator End := fb Json. Member End(json Doc); WHILE json Iterator <> json Iterator End DO s Name := fb Json. Get Member Name(json Iterator); IF s Name = 'array' THEN fb Json. Remove Member(json Doc, json Iterator); END_IF json Iterator := fb Json. Next Member(json Iterator); END_WHILE 5.2.1.1.94 Remove Member By Name This method removes a child element from a given property. The element is referenced by its name. Syntax METHOD Remove Member By Name : BOOL VAR_INPUT v : SJson Value; keep Order : BOOL; END_VAR VAR_IN_OUT CONSTANT member : STRING; END_VAR Return value Name Type Remove Member By Name BOOL Inputs Name Type v SJson Value (note possible invalidity) keep Order BOOL / Inputs/outputs Name Type member STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Remove Member By Name(json Prop, 'Child Name'); 98 Version: 1.11.0 TF6760
## Page 99

PLC API 5.2.1.1.95 Save Document To File This method saves a JSON document in a file. A rising edge at the input parameter b Exec triggers the saving procedure. The asynchronous process is terminated as soon as the reference b Exec is set back to FALSE from the method. When the process ends, the return value of the method indicates for one call whether saving of the file was successful (TRUE) or failed (FALSE). Syntax METHOD Save Document To File : BOOL VAR_IN_OUT CONSTANT s File : STRING; END_VAR VAR_INPUT b Exec : REFERENCE TO BOOL; END_VAR VAR_OUTPUT hr Error Code: HRESULT; END_VAR Return value Name Type Save Document To File BOOL Inputs Name Type b Exec REFERENCE TO BOOL / Inputs/Outputs Name Type s File STRING Outputs Name Type hr Error Code HRESULT Sample call: IF b Save THEN b Saved := fb Json. Save Document To File(s File, b Save); END_IF 5.2.1.1.96 Set Ads Provider This method sets the context in which the file accesses are processed when loading and saving the JSON documents. If no ADS provider is specified, the current task is used. TF6760 Version: 1.11.0 99
## Page 100

PLC API Syntax METHOD Set Ads Provider : BOOL VAR_INPUT oid : OTCID; END_VAR Return value Name Type Description Set Ads Provider BOOL The method returns TRUE if the setting of the ADS provider was successful. Inputs Name Type Description oid OTCID Object ID of the task. Sample call: b Test := fb Json. Set Ads Provider(02010030); 5.2.1.1.97 Set Array This method sets the value of a property to the type "Array". New values can now be added to the array with the Pushback methods. Syntax METHOD Set Array : SJson Value VAR_INPUT v : SJson Value; END_VAR Return value Name Type Set Array SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Array(json Prop); 5.2.1.1.98 Set Base64 100 Version: 1.11.0 TF6760
## Page 101

PLC API This method sets the value of a property to a Base64-coded value. A data structure, for example, can be used as the source. Coding to the Base64 format takes place inside the method. Syntax METHOD Set Base64 : SJson Value VAR_INPUT v : SJson Value; p : PVOID; n : DINT; END_VAR Return value Name Type Set Base64 SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) p PVOID n DINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Base64(json Prop, ADR(st Struct), SIZEOF(st Struct)); 5.2.1.1.99 Set Bool This method sets the value of a property to a value of the data type BOOL. Syntax METHOD Set Bool : SJson Value VAR_INPUT v : SJson Value; value : BOOL; END_VAR Return value Name Type Set Bool SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value BOOL Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Bool(json Prop, TRUE); TF6760 Version: 1.11.0 101
## Page 102

PLC API 5.2.1.1.100 Set Date Time This method sets the value of a property to a value of the data type DATE_AND_TIME. Syntax METHOD Set Date Time : SJson Value VAR_INPUT v : SJson Value; value : DATE_AND_TIME; END_VAR Return value Name Type Set Date Time SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value DATE_AND_TIME Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Date Time(json Prop, dt Time); 5.2.1.1.101 Set Dc Time This method sets the value of a property to a value of the data type DCTIME. Syntax METHOD Set Dc Time : SJson Value VAR_INPUT v : SJson Value; value : DCTIME; END_VAR Return value Name Type Set Dc Time SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value DCTIME Sample call: 102 Version: 1.11.0 TF6760
## Page 103

PLC API json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Dc Time(json Prop, dc Time); 5.2.1.1.102 Set Double This method sets the value of a property to a value of the data type Double. Syntax METHOD Set Double : SJson Value VAR_INPUT v : SJson Value; value : LREAL; END_VAR Return value Name Type Set Double SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value LREAL Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Double(json Prop, 42.42); 5.2.1.1.103 Set File Time This method sets the value of a property to a value of the data type FILETIME. Syntax METHOD Set File Time : SJson Value VAR_INPUT v : SJson Value; value : FILETIME; END_VAR Return value Name Type Set File Time SJson Value (note possible invalidity) TF6760 Version: 1.11.0 103
## Page 104

PLC API Inputs Name Type v SJson Value (note possible invalidity) value FILETIME Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set File Time(json Prop, file Time); 5.2.1.1.104 Set Hex Binary This method sets the value of a property to a Hex Binary-coded value. A data structure, for example, can be used as the source. Coding to the Hex Binary format takes place inside the method. Syntax METHOD Set Hex Binary : SJson Value VAR_INPUT v : SJson Value; p : PVOID; n : DINT; END_VAR Return value Name Type Set Hex Binary SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) p PVOID n DINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Hex Binary(json Prop, ADR(st Struct), SIZEOF(st Struct)); 5.2.1.1.105 Set Int This method sets the value of a property to a value of the data type INT. Syntax METHOD Set Int : SJson Value VAR_INPUT v : SJson Value; value : DINT; END_VAR 104 Version: 1.11.0 TF6760
## Page 105

PLC API Return value Name Type Set Int SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value DINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Int(json Prop, 42); 5.2.1.1.106 Set Int64 This method sets the value of a property to a value of the data type Int64. Syntax METHOD Set Int64 : SJson Value VAR_INPUT v : SJson Value; value : LINT; END_VAR Return value Name Type Set Int64 SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value LINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Int64(json Prop, 42); 5.2.1.1.107 Set Json This method inserts a further JSON document into the value of a property. TF6760 Version: 1.11.0 105
## Page 106

PLC API Syntax METHOD Set Json : SJson Value VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT raw Json : STRING; END_VAR Return value Name Type Set Json SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type raw Json STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Json(json Prop, s Json); 5.2.1.1.108 Set Max Decimal Places This function specifies the number of decimal places after which a floating-point number is rounded. Syntax METHOD Set Max Decimal Places VAR_INPUT dp : DINT; END_VAR Inputs Name Type dp DINT Sample call: n Dec := fb Json. Set Max Decimal Places(); 5.2.1.1.109 Set Null This method sets the value of a property to the value NULL. 106 Version: 1.11.0 TF6760
## Page 107

PLC API Syntax METHOD Set Null : SJson Value VAR_INPUT v : SJson Value; END_VAR Return value Name Type Set Null SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Null(json Prop); 5.2.1.1.110 Set Object This method sets the value of a property to the type "Object". This enables the nesting of JSON documents. Syntax METHOD Set Object : SJson Value VAR_INPUT v : SJson Value; END_VAR Return value Name Type Set Object Sjson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Object(json Prop); 5.2.1.1.111 Set String This method sets the value of a property to a value of the data type STRING. TF6760 Version: 1.11.0 107
## Page 108

PLC API Syntax METHOD Set String : SJson Value VAR_INPUT v : SJson Value; END_VAR VAR_IN_OUT CONSTANT value : STRING; END_VAR Return value Name Type Set String SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) / Inputs/outputs Name Type value STRING Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set String(json Prop, 'Hello World'); 5.2.1.1.112 Set Uint This method sets the value of a property to a value of the data type UInt. Syntax METHOD Set Uint: SJson Value VAR_INPUT v : SJson Value; value : UDINT; END_VAR Return value Name Type Set Uint SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value UDINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Uint(json Prop, 42); 108 Version: 1.11.0 TF6760
## Page 109

PLC API 5.2.1.1.113 Set Uint64 This method sets the value of a property to a value of the data type UInt64. Syntax METHOD Set Uint64 : SJson Value VAR_INPUT v : SJson Value; value : ULINT; END_VAR Return value Name Type Set Uint64 SJson Value (note possible invalidity) Inputs Name Type v SJson Value (note possible invalidity) value ULINT Sample call: json Doc := fb Json. Parse Document(s Existing Json Document); json Prop := fb Json. Find Member(json Doc, 'property'); json Value := fb Json. Set Uint64(json Prop, 42); 5.2.1.1.114 Swap This method swaps the content of two pointers. Syntax METHOD Swap : BOOL VAR_INPUT v : SJson Value; w : SJson Value; END_VAR; END_VAR Return value Name Type Swap BOOL Inputs Name Type v SJson Value (note possible invalidity) w SJson Value (note possible invalidity) TF6760 Version: 1.11.0 109
## Page 110

PLC API 5.2.1.2 FB_Json Dyn Dom Parser This function block is derived from the same internal function block as FB_Json Dom Parser [} 40] and thus offers the same interface. The two derived function blocks differ only in their internal memory management. The FB_Json Dyn Dom Parser is optimized for JSON documents where many changes are made and the JSON document is not released in between. It releases the allocated memory after an action has been executed, e.g. in the methods Set Object() or Set Json(). This flexibility results in greater overhead, allowing the FB_Json Dom Parser [} 40] to improve the performance. Strings in UTF-8 format The variables of type STRING used here are based on the UTF-8 format. This STRING formatting is common for MQTT communication as well as for JSON documents. In order to be able to receive special characters and texts from a wide range of languages, the character set in the Tc3_Iot Base and Tc3_Json Xml libraries is not limited to the typical character set of the data type STRING. Instead, the Unicode character set in UTF-8 format is used in conjunction with the data type STRING. If the ASCII character set is used, there is no difference between the typical formatting of a STRING and the UTF-8 formatting of a STRING. Further information on the UTF-8 STRING format and available display and conversion options can be found in the documentation for the Tc2_Utilities PLC library. Syntax FUNCTION_BLOCK FB_Json Dyn Dom Parser VAR_OUTPUT init Status : HRESULT; END_VAR Outputs Name Type init Status HRESULT Methods All methods can be found in FB_Json Dom Parser [} 40]. Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4024.7 x86, x64, Arm® Tc3_Json Xml 3.3.8.0 5.2.1.3 FB_Json Sax Reader Syntax FUNCTION_BLOCK FB_Json Sax Reader VAR_OUTPUT init Status : HRESULT; END_VAR 110 Version: 1.11.0 TF6760
## Page 111

PLC API Outputs Name Type init Status HRESULT Methods Name Description Decode Base64 [} 111] Converts a Base64-formated string to binary data. Decode Date Time [} 112] Creates a PLC variable of the data type DATE_AND_TIME or DT from a standardized ISO8601 time format (e.g. YYYY-MM-DDThh:mm:ss). Decode Dc Time [} 113] Creates a PLC variable of the data type DCTIME from a standardized ISO8601 time format (e.g. YYYY-MM-DDThh:mm:ss). Decode File Time [} 113] Creates a PLC variable of the data type FILETIME from a standardized ISO8601 time format (e.g. YYYY-MM-DDThh:mm:ss). Decode Hex Binary [} 114] Converts a string containing hexadecimal values into binary data. Is Base64 [} 115] Checks whether the transferred string corresponds to the Base64 format. Is Hex Binary [} 115] Checks whether the transferred string consists of hexadecimal values. Is ISO8601Time Format Checks whether the transferred string corresponds to the standardized ISO8601 time format. [} 116] Parse [} 116] Starts the SAX reader parsing process. Parse Values [} 117] Starts the SAX reader parsing process. Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4022 x86, x64, Arm® Tc3_Json Xml 5.2.1.3.1 Decode Base64 This method converts a Base64-formated string to binary data. If the conversion was successful the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Decode Base64 : BOOL VAR_INPUT s Base64 : STRING; p Bytes : POINTER TO BYTE; n Bytes : REFERENCE TO DINT; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Decode Base64 BOOL TF6760 Version: 1.11.0 111
## Page 112

PLC API Inputs Name Type s Base64 STRING p Bytes POINTER TO BYTE n Bytes REFERENCE TO DINT Outputs Name Type hr Error Code HRESULT Sample call: b Success := fb Json. Decode Base64('SGVsb G8g VHdpbk NBVA==', ADR(byte Array), byte Array Size); 5.2.1.3.2 Decode Date Time This method enables the generation of a PLC variable of the type DATE_AND_TIME or DT from a standardized ISO8601 time format (e.g. YYYY-MM-DDThh:mm:ss). DT corresponds to the number of seconds starting from the date 01.01.1970. If the conversion was successful the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Decode Date Time : BOOL VAR_IN_OUT CONSTANT s DT : STRING; END_VAR VAR_OUTPUT n DT : DATE_AND_TIME; hr Error Code : HRESULT; END_VAR Return value Name Type Decode Date Time BOOL / Inputs/Outputs Name Type s DT STRING Outputs Name Type n DT DATE_AND_TIME hr Error Code HRESULT Sample call: b Success := fb Json. Decode Date Time('2017-08-09T06:54:00', n DT => date Time); 112 Version: 1.11.0 TF6760
## Page 113

PLC API 5.2.1.3.3 Decode Dc Time This method enables the generation of a PLC variable of the type DCTIME from a standardized ISO8601 time format (e.g. YYYY-MM-DDThh:mm:ss). DCTIME corresponds to the number of nanoseconds starting from the date 01.01.2000. If the conversion was successful the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Decode Dc Time : BOOL VAR_IN_OUT CONSTANT s DC : STRING; END_VAR VAR_OUTPUT n DC : DCTIME; hr Error Code : HRESULT; END_VAR Return value Name Type Decode Dc Time BOOL / Inputs/Outputs Name Type s DC STRING Outputs Name Type n DC DCTIME hr Error Code HRESULT Sample call: b Success := fb Json. Decode Dc Time('2017-08-09T06:54:00', n Dc => dc Time); 5.2.1.3.4 Decode File Time This method enables the generation of a PLC variable of the type FILETIME from a standardized ISO8601 time format (e.g. YYYY-MM-DDThh:mm:ss). FILETIME corresponds to the number of nanoseconds starting from the date 01.01.1601 – measured in 100 nanoseconds. If the conversion was successful the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Decode Date Time : BOOL VAR_IN_OUT CONSTANT s FT : STRING; END_VAR VAR_OUTPUT TF6760 Version: 1.11.0 113
## Page 114

PLC API n FT : FILETIME; hr Error Code : HRESULT; END_VAR Return value Name Type Decode Date Time BOOL / Inputs/Outputs Name Type s FT STRING Outputs Name Type n FT FILETIME hr Error Code HRESULT Sample call: b Success := fb Json. Decode File Time('2017-08-09T06:54:00', n FT => file Time); 5.2.1.3.5 Decode Hex Binary This method converts a string containing hexadecimal values into binary data. If the conversion was successful the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Decode Hex Binary : BOOL VAR_IN_OUT CONSTANT s Hex : STRING; END_VAR VAR_INPUT p Bytes : POINTER TO BYTE; n Bytes : REFERENCE TO DINT; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Decode Hex Binary BOOL Inputs Name Type p Bytes POINTER TO BYTE n Bytes REFERENCE TO DINT 114 Version: 1.11.0 TF6760
## Page 115

PLC API / Inputs/Outputs Name Type s Hex STRING Outputs Name Type hr Error Code HRESULT Sample call: b Success := fb Json. Decode Hex Binary('ABCEF93A', ADR(byte Array), byte Array Size); 5.2.1.3.6 Is Base64 This method checks whether the transferred string corresponds to the Base64 format. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Base64 : BOOL VAR_IN_OUT CONSTANT s Base64 : STRING; END_VAR Return value Name Type Is Base64 BOOL / Inputs/Outputs Name Type s Base64 STRING Sample call: b Is Base64 := fb Json. Is Base64('SGVsb G8g VHdpbk NBVA=='); 5.2.1.3.7 Is Hex Binary This method checks whether the transferred string consists of hexadecimal values. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is Hex Binary : BOOL VAR_IN_OUT CONSTANT s Hex : STRING; END_VAR TF6760 Version: 1.11.0 115
## Page 116

PLC API Return value Name Type Is Hex Binary BOOL / Inputs/Outputs Name Type s Hex STRING Sample call: b Success := fb Json. Is Hex Binary('ABCEF93A'); 5.2.1.3.8 Is ISO8601Time Format This method checks whether the transferred string corresponds to the standardized ISO8601 time format. If that is the case, the method returns TRUE, otherwise it returns FALSE. Syntax METHOD Is ISO8601Time Format : BOOL VAR_IN_OUT CONSTANT s DT : STRING; END_VAR Return value Name Type Is ISO8601Time Format BOOL / Inputs/Outputs Name Type s DT STRING Sample call: b Success := fb Json. Is ISO8601Time Format('2017-08-09T06:54:00'); 5.2.1.3.9 Parse This method starts the SAX reader parsing procedure. The JSON object to be parsed and a reference to a function block, which was derived from the interface ITc Json Sax Handler, are transferred as input parameters. This function block is then used for the callback methods of the SAX reader. Syntax METHOD Parse : BOOL VAR_IN_OUT CONSTANT s Json : STRING; END_VAR 116 Version: 1.11.0 TF6760
## Page 117

PLC API VAR_INPUT ip Hdl : ITc Json Sax Handler; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Parse BOOL Inputs Name Type ip Hdl ITc Json Sax Handler / Inputs/Outputs Name Type s Json STRING Outputs Name Type hr Error Code HRESULT 5.2.1.3.10 Parse Values This method starts the SAX reader parsing procedure. The JSON object to be parsed and a reference to a function block, which was derived from the interface ITc Json Sax Values, are transferred as input parameters. This function block is then used for the callback methods of the SAX reader. What is special about this method is that exclusively values are taken into account in the callback methods, i.e. there are no On Key() or On Start Object() callbacks. Syntax METHOD Parse Values : BOOL VAR_IN_OUT CONSTANT s Json : STRING; END_VAR VAR_INPUT ip Hdl : ITc Json Sax Values; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Parse Values BOOL TF6760 Version: 1.11.0 117
## Page 118

PLC API Inputs Name Type ip Hdl ITc Json Sax Values / Inputs/Outputs Name Type s Json STRING Outputs Name Type hr Error Code HRESULT 5.2.1.4 FB_Json Sax Writer Strings in UTF-8 format The variables of type STRING used here are based on the UTF-8 format. This STRING formatting is common for MQTT communication as well as for JSON documents. In order to be able to receive special characters and texts from a wide range of languages, the character set in the Tc3_Iot Base and Tc3_Json Xml libraries is not limited to the typical character set of the data type STRING. Instead, the Unicode character set in UTF-8 format is used in conjunction with the data type STRING. If the ASCII character set is used, there is no difference between the typical formatting of a STRING and the UTF-8 formatting of a STRING. Further information on the UTF-8 STRING format and available display and conversion options can be found in the documentation for the Tc2_Utilities PLC library. Syntax FUNCTION_BLOCK FB_Json Sax Writer VAR_OUTPUT init Status : HRESULT; END_VAR Outputs Name Type init Status HRESULT 118 Version: 1.11.0 TF6760
## Page 119

PLC API Methods TF6760 Version: 1.11.0 119
## Page 120

PLC API Name Description Add Base64 [} 121] Adds a value of the data type Base64 to a property. Add Bool [} 121] Adds a value of the data type BOOL to a property. Add Date Time [} 122] Adds a value of the data type DATE_AND_TIME to a property. Add Dc Time [} 122] Adds a value of the data type DCTIME to a property. Add Dint [} 122] Adds a value of the data type DINT to a property. Add File Time [} 123] Adds a value of the data type FILETIME to a property. Add Hex Binary [} 123] Adds a Hex Binary value to a property. Add Key [} 124] Adds a new property key at the current position of the SAX Writer. Add Key Bool [} 124] Creates a new property key and at the same time a value of the data type BOOL. Add Key Date Time [} 125] Creates a new property key and at the same time a value of the data type DATE_AND_TIME. Add Key Dc Time [} 125] Creates a new property key and at the same time a value of the data type DCTIME. Add Key File Time [} 126] Creates a new property key and at the same time a value of the data type FILETIME. Add Key Lreal [} 126] Creates a new property key and at the same time a value of the data type LREAL. Add Key Null [} 127] Creates a new property key and initializes its value with null. Add Key Number [} 127] Creates a new property key and at the same time a value of the data type DINT. Add Key String [} 128] Creates a new property key and at the same time a value of the data type STRING. Add Lint [} 128] Adds a value of the data type LINT to a property. Add Lreal [} 129] Adds a value of the data type LREAL to a property. Add Null [} 129] Adds the value null to a property. Add Raw Array [} 129] Adds a valid JSON array to a given property as a value. Add Raw Object [} 130] Adds a valid JSON object to a given property as a value. Add Real [} 130] Adds a value of the data type REAL to a property. Add String [} 131] Adds a value of the data type STRING to a property. Add Udint [} 131] Adds a value of the data type UDINT to a property. Add Ulint [} 131] Adds a value of the data type ULINT to a property. Copy Document [} 132] Copies the contents of the JSON object currently created with the SAX Writer into a target variable of the data type STRING. End Array [} 133] Creates the end of a started JSON array and inserts it at the current position of the SAX Writer. End Object [} 133] Creates the end of a started JSON object and inserts it at the current position of the SAX Writer. Get Document [} 133] Returns the content of the JSON object that is currently created with the SAX Writer and returns it as data type STRING(255). Get Document Length [} 134] Returns the length of the JSON object that is currently created with the SAX Writer and returns it as data type UDINT. Get Max Decimal Places [} 134] Is Complete Reset Document [} 135] Resets the JSON object currently created with the SAX Writer. Set Max Decimal Places [} 135] 120 Version: 1.11.0 TF6760
## Page 121

PLC API Name Description Start Array [} 135] Creates the start of a new JSON array and inserts it at the current position of the SAX Writer. Start Object [} 136] Creates the start of a new JSON object and inserts it at the current position of the SAX Writer. Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4022 x86, x64, Arm® Tc3_Json Xml 5.2.1.4.1 Add Base64 This method adds a value of the data type Base64 to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Base64 VAR_INPUT p Bytes : Pointer TO BYTE; n Bytes : DINT; END_VAR Inputs Name Type p Bytes POINTER TO BYTE n Bytes DINT 5.2.1.4.2 Add Bool This method adds a value of the data type BOOL to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Bool VAR_INPUT value : BOOL; END_VAR Inputs Name Type value BOOL Sample call: fb Json. Add Key('b Switch'); fb Json. Add Bool(TRUE); TF6760 Version: 1.11.0 121
## Page 122

PLC API 5.2.1.4.3 Add Date Time This method adds a value of the data type DATE_AND_TIME to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Date Time VAR_INPUT value : DATE_AND_TIME; END_VAR Inputs Name Type value DATE_AND_TIME Sample call: fb Json. Add Key('Timestamp'); fb Json. Add Date Time(dt Time); // dt Time is of type DATE_AND_TIME 5.2.1.4.4 Add Dc Time This method adds a value of the data type DCTIME to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Dc Time VAR_INPUT value : DCTIME; END_VAR Inputs Name Type value DCTIME Sample call: fb Json. Add Key('Timestamp'); fb Json. Add Dc Time(dc Time); // dc Time is of type DCTIME 5.2.1.4.5 Add Dint This method adds a value of the data type DINT to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. 122 Version: 1.11.0 TF6760
## Page 123

PLC API Syntax METHOD Add Dint VAR_INPUT value : DINT; END_VAR Inputs Name Type value DINT Sample call: fb Json. Add Key('n Number'); fb Json. Add Dint(42); 5.2.1.4.6 Add File Time This method adds a value of the data type FILETIME to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add File Time VAR_INPUT value : FILETIME; END_VAR Inputs Name Type value FILETIME Sample call: fb Json. Add Key('Timestamp'); fb Json. Add File Time(ft Time); // ft Time is of type FILETIME 5.2.1.4.7 Add Hex Binary This method adds a hex binary value to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Hex Binary VAR_INPUT p Bytes : POINTER TO BYTE; n Bytes : DINT; END_VAR TF6760 Version: 1.11.0 123
## Page 124

PLC API Inputs Name Type p Bytes POINTER TO BYTE n Bytes DINT Sample call: fb Json. Add Key('Hex Binary'); fb Json. Add Hex Binary(ADR(byte Hex Bin), SIZEOF(byte Hex Bin)); 5.2.1.4.8 Add Key This method adds a new property key at the current position of the SAX writer. The value of the new property is usually set afterwards. This can be done using one of the following methods, for example: Add Base64 [} 121], Add Bool [} 121], Add Date Time [} 122], Add Dc Time [} 122], Add Dint [} 122], Add File Time [} 123], Add Hex Binary [} 123], Add Lint [} 128], Add Lreal [} 129], Add Null [} 129], Add Raw Array [} 129], Add Raw Object [} 130], Add Real [} 130], Add String [} 131], Add Udint [} 131], Add Ulint [} 131]. Syntax METHOD Add Key VAR_IN_OUT CONSTANT key : STRING; END_VAR / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key('Property Name'); 5.2.1.4.9 Add Key Bool This method creates a new property key and at the same time a value of the data type BOOL. Syntax METHOD Add Key Bool VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : BOOL; END_VAR Inputs Name Type value BOOL 124 Version: 1.11.0 TF6760
## Page 125

PLC API / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Bool('b Switch', TRUE); 5.2.1.4.10 Add Key Date Time This method creates a new property key and at the same time a value of the data type DATE_AND_TIME. Syntax METHOD Add Key Date Time VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : DATE_AND_TIME; END_VAR Inputs Name Type value DATE_AND_TIME / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Date Time('Timestamp', dt Time); 5.2.1.4.11 Add Key Dc Time This method creates a new property key and at the same time a value of the data type DCTIME. Syntax METHOD Add Key Dc Time VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : DCTIME; END_VAR TF6760 Version: 1.11.0 125
## Page 126

PLC API Inputs Name Type value DCTIME / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Dc Time('Timestamp', dc Time); 5.2.1.4.12 Add Key File Time This method creates a new property key and at the same time a value of the data type FILETIME. Syntax METHOD Add Key File Time VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : FILETIME; END_VAR Inputs Name Type value FILETIME / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key File Time('Timestamp', ft Time); 5.2.1.4.13 Add Key Lreal This method creates a new property key and at the same time a value of the data type LREAL. Syntax METHOD Add Key Lreal VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : LREAL; END_VAR 126 Version: 1.11.0 TF6760
## Page 127

PLC API Inputs Name Type value LREAL / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Lreal('Property Name', 42.42); 5.2.1.4.14 Add Key Null This method creates a new property key and initializes its value with null. Syntax METHOD Add Key Null VAR_IN_OUT CONSTANT key : STRING; END_VAR / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Null('Property Name'); 5.2.1.4.15 Add Key Number This method creates a new property key and at the same time a value of the data type DINT. Syntax METHOD Add Key Number VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : DINT; END_VAR Inputs Name Type value DINT TF6760 Version: 1.11.0 127
## Page 128

PLC API / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Number('Property Name', 42); 5.2.1.4.16 Add Key String This method creates a new property key and at the same time a value of the data type STRING. Syntax METHOD Add Key String VAR_IN_OUT CONSTANT key : STRING; value : STRING; END_VAR / Inputs/Outputs Name Type key STRING value STRING Sample call: fb Json. Add Key String('Property Name', 'Hello World'); 5.2.1.4.17 Add Lint This method adds a value of the data type LINT to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Lint VAR_INPUT value : LINT; END_VAR Inputs Name Type value LINT Sample call: fb Json. Add Key('Property Name'); fb Json. Add Lint(42); 128 Version: 1.11.0 TF6760
## Page 129

PLC API 5.2.1.4.18 Add Lreal This method adds a value of the data type LREAL to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Lreal VAR_INPUT value : LREAL; END_VAR Inputs Name Type value LREAL Sample call: fb Json. Add Key('Property Name'); fb Json. Add Lreal(42.42); 5.2.1.4.19 Add Null This method adds the value null to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Null Sample call: fb Json. Add Key('Property Name'); fb Json. Add Null(); 5.2.1.4.20 Add Raw Array This method adds a valid JSON array to a given property as a value. The array to be added must be in a valid JSON format and may only be added if the SAX Writer is at a correspondingly valid position, e.g. directly after a preceding Add Key() [} 124], Start Array() [} 135] or as the first call after a Reset Document() [} 135]. Syntax METHOD Add Raw Array VAR_IN_OUT CONSTANT raw Json : STRING; END_VAR TF6760 Version: 1.11.0 129
## Page 130

PLC API Return value Name Type Add Raw Array BOOL / Inputs/Outputs Name Type raw Json STRING Sample call: fb Json. Add Key('Property Name'); fb Json. Add Raw Array('[1, 2, {"x":42, "y":42}, 4'); 5.2.1.4.21 Add Raw Object This method adds a valid JSON object to a given property as a value. The object to be added must be in a valid JSON format and may only be added if the SAX Writer is in an appropriately valid position, e.g. directly after a preceding Add Key() [} 124], Start Array() [} 135] or as the first call after a Reset Document() [} 135]. Syntax METHOD Add Raw Object VAR_IN_OUT CONSTANT raw Json : STRING; END_VAR / Inputs/Outputs Name Type raw Json STRING Sample call: fb Json. Add Key('Property Name'); fb Json. Add Raw Object('{"x":42, "y":42}'); 5.2.1.4.22 Add Real This method adds a value of the data type REAL to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Real VAR_INPUT value : REAL; END_VAR Inputs Name Type value REAL 130 Version: 1.11.0 TF6760
## Page 131

PLC API Sample call: fb Json. Add Key('Property Name'); fb Json. Add Real(42.42); 5.2.1.4.23 Add String This method adds a value of the data type STRING to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add String VAR_IN_OUT CONSTANT value : STRING; END_VAR / Inputs/Outputs Name Type value STRING Sample call: fb Json. Add Key('Property Name'); fb Json. Add String('Hello World'); 5.2.1.4.24 Add Udint This method adds a value of the data type UDINT to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. Syntax METHOD Add Udint VAR_INPUT value : UDINT; END_VAR Inputs Name Type value UDINT Sample call: fb Json. Add Key('Property Name'); fb Json. Add Udint(42); 5.2.1.4.25 Add Ulint This method adds a value of the data type ULINT to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 124]. TF6760 Version: 1.11.0 131
## Page 132

PLC API Syntax METHOD Add Ulint VAR_INPUT value : ULINT; END_VAR Inputs Name Type value ULINT Sample call: fb Json. Add Key('Property Name'); fb Json. Add Ulint(42); 5.2.1.4.26 Copy Document This method copies the content of the current JSON object created with the SAX Writer to a target variable of the data type STRING, which can be of any length. The method returns the length of the string (including null termination). If the destination buffer is too small, it is emptied by a null termination and returned as length 0. Syntax METHOD Copy Document : UDINT VAR_IN_OUT CONSTANT p Doc : STRING; END_VAR VAR_INPUT n Doc : UDINT; END_VAR VAR_OUTPUT hr Error Code: HRESULT; END_VAR Return value Name Type Copy Document UDINT Inputs Name Type n Doc UDINT / Inputs/Outputs Name Type p Doc STRING Outputs Name Type hr Error Code HRESULT Sample call: 132 Version: 1.11.0 TF6760
## Page 133

PLC API fb Json. Copy Document(s Target String, SIZEOF(s Target String)); 5.2.1.4.27 End Array This method generates the end of a started JSON array ("square closing bracket") and inserts it at the current position of the SAX writer. Syntax METHOD End Array : HRESULT Return value Name Type End Array HRESULT Sample call: fb Json. End Array(); 5.2.1.4.28 End Object This method generates the end of a started JSON object ("curly closing bracket") and inserts it at the current position of the SAX writer. Syntax METHOD End Object : HRESULT Return value Name Type End Object HRESULT Sample call: fb Json. End Object(); 5.2.1.4.29 Get Document This method returns the content of the JSON object that is currently created with the SAX Writer and returns it as data type STRING(255). The maximum size of the string returned by the method is 255 characters. With longer strings, the method will return a NULL string. In this case the method Copy Document [} 132]() must be used. Syntax METHOD Get Document : STRING(255) VAR_OUTPUT hr Error Code: HRESULT; END_VAR TF6760 Version: 1.11.0 133
## Page 134

PLC API Return value Name Type Get Document STRING(255) Outputs Name Type hr Error Code HRESULT Sample call: s Target String := fb Json. Get Document(); 5.2.1.4.30 Get Document Length This method returns the length of the JSON object that is currently created with the SAX Writer and returns it as data type UDINT. Syntax METHOD Get Document Length : UDINT VAR_OUTPUT hr Error Code: HRESULT; END_VAR Return value Name Type Get Document Length UDINT Outputs Name Type hr Error Code HRESULT Sample call: n Length := fb Json. Get Document Length(); 5.2.1.4.31 Get Max Decimal Places This function queries the currently set number of decimal places after which a floating point number is truncated. Syntax METHOD Get Max Decimal Places : DINT 134 Version: 1.11.0 TF6760
## Page 135

PLC API Return value Name Type Description Get Max Decimal Places DINT The currently set number of digits after which a floating point number is truncated. 5.2.1.4.32 Reset Document This method resets the JSON object currently created with the SAX writer. Syntax METHOD Reset Document : HRESULT Return value Name Type Reset Document HRESULT Sample call: fb Json. Reset Document(); 5.2.1.4.33 Set Max Decimal Places This function specifies the number of decimal places after which a floating-point number is rounded. Syntax METHOD Set Max Decimal Places : HRESULT VAR_INPUT decimal Places: DINT; END_VAR Return value Name Type Set Max Decimal Places HRESULT Inputs Name Type Description decimal Pla DINT The number of decimal places to be set after which a floating- ces point number is truncated. 5.2.1.4.34 Start Array TF6760 Version: 1.11.0 135
## Page 136

PLC API This method generates the start of a new JSON array ("square opening bracket") and inserts it at the current position of the SAX writer. Syntax METHOD Start Array : HRESULT Return value Name Type Start Array HRESULT Sample call: fb Json. Start Array(); 5.2.1.4.35 Start Object This method generates the start of a new JSON object ("curly opening bracket") and inserts it at the current position of the SAX writer. Syntax METHOD Start Object : HRESULT Return value Name Type Start Object HRESULT Sample call: fb Json. Start Object(); 5.2.1.5 FB_Json Sax Pretty Writer This function block has a difference from FB_Json Sax Writer [} 118]: it adds matching whitespaces for better readability of a JSON document. Strings in UTF-8 format The variables of type STRING used here are based on the UTF-8 format. This STRING formatting is common for MQTT communication as well as for JSON documents. In order to be able to receive special characters and texts from a wide range of languages, the character set in the Tc3_Iot Base and Tc3_Json Xml libraries is not limited to the typical character set of the data type STRING. Instead, the Unicode character set in UTF-8 format is used in conjunction with the data type STRING. If the ASCII character set is used, there is no difference between the typical formatting of a STRING and the UTF-8 formatting of a STRING. Further information on the UTF-8 STRING format and available display and conversion options can be found in the documentation for the Tc2_Utilities PLC library. 136 Version: 1.11.0 TF6760
## Page 137

PLC API Syntax FUNCTION_BLOCK FB_Json Sax Pretty Writer VAR_OUTPUT init Status : HRESULT; END_VAR Outputs Name Type init Status HRESULT Methods Name Description Set Format Options Adjusts the general formatting options for an instance of the [<=>] FB_Json Sax Pretty Writer. [} 151] Set Indent [} 152] Customizes the indentation. All other methods can be found at FB_Json Sax Writer [} 118]. Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4022 x86, x64, Arm® Tc3_Json Xml 5.2.1.5.1 Add Base64 This method adds a value of the data type Base64 to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Base64 VAR_INPUT p Bytes : Pointer TO BYTE; n Bytes : DINT; END_VAR Inputs Name Type p Bytes POINTER TO BYTE n Bytes DINT 5.2.1.5.2 Add Bool This method adds a value of the data type BOOL to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. TF6760 Version: 1.11.0 137
## Page 138

PLC API Syntax METHOD Add Bool VAR_INPUT value : BOOL; END_VAR Inputs Name Type value BOOL Sample call: fb Json. Add Key('b Switch'); fb Json. Add Bool(TRUE); 5.2.1.5.3 Add Date Time This method adds a value of the data type DATE_AND_TIME to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Date Time VAR_INPUT value : DATE_AND_TIME; END_VAR Inputs Name Type value DATE_AND_TIME Sample call: fb Json. Add Key('Timestamp'); fb Json. Add Date Time(dt Time); // dt Time is of type DATE_AND_TIME 5.2.1.5.4 Add Dc Time This method adds a value of the data type DCTIME to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Dc Time VAR_INPUT value : DCTIME; END_VAR Inputs Name Type value DCTIME 138 Version: 1.11.0 TF6760
## Page 139

PLC API Sample call: fb Json. Add Key('Timestamp'); fb Json. Add Dc Time(dc Time); // dc Time is of type DCTIME 5.2.1.5.5 Add Dint This method adds a value of the data type DINT to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Dint VAR_INPUT value : DINT; END_VAR Inputs Name Type value DINT Sample call: fb Json. Add Key('n Number'); fb Json. Add Dint(42); 5.2.1.5.6 Add File Time This method adds a value of the data type FILETIME to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add File Time VAR_INPUT value : FILETIME; END_VAR Inputs Name Type value FILETIME Sample call: fb Json. Add Key('Timestamp'); fb Json. Add File Time(ft Time); // ft Time is of type FILETIME 5.2.1.5.7 Add Hex Binary TF6760 Version: 1.11.0 139
## Page 140

PLC API This method adds a hex binary value to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Hex Binary VAR_INPUT p Bytes : POINTER TO BYTE; n Bytes : DINT; END_VAR Inputs Name Type p Bytes POINTER TO BYTE n Bytes DINT Sample call: fb Json. Add Key('Hex Binary'); fb Json. Add Hex Binary(ADR(byte Hex Bin), SIZEOF(byte Hex Bin)); 5.2.1.5.8 Add Key This method adds a new property key at the current position of the SAX writer. The value of the new property is usually set afterwards. This can be done using one of the following methods, for example: Add Base64 [} 137], Add Bool [} 137], Add Date Time [} 138], Add Dc Time [} 138], Add Dint [} 139], Add File Time [} 139], Add Hex Binary [} 139], Add Lint [} 144], Add Lreal [} 145], Add Null [} 145], Add Raw Array [} 145], Add Raw Object [} 146], Add Real [} 146], Add String [} 147], Add Udint [} 147], Add Ulint [} 148]. Syntax METHOD Add Key VAR_IN_OUT CONSTANT key : STRING; END_VAR / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key('Property Name'); 5.2.1.5.9 Add Key Bool This method creates a new property key and at the same time a value of the data type BOOL. Syntax METHOD Add Key Bool VAR_IN_OUT CONSTANT key : STRING; END_VAR 140 Version: 1.11.0 TF6760
## Page 141

PLC API VAR_INPUT value : BOOL; END_VAR Inputs Name Type value BOOL / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Bool('b Switch', TRUE); 5.2.1.5.10 Add Key Date Time This method creates a new property key and at the same time a value of the data type DATE_AND_TIME. Syntax METHOD Add Key Date Time VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : DATE_AND_TIME; END_VAR Inputs Name Type value DATE_AND_TIME / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Date Time('Timestamp', dt Time); 5.2.1.5.11 Add Key Dc Time This method creates a new property key and at the same time a value of the data type DCTIME. TF6760 Version: 1.11.0 141
## Page 142

PLC API Syntax METHOD Add Key Dc Time VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : DCTIME; END_VAR Inputs Name Type value DCTIME / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Dc Time('Timestamp', dc Time); 5.2.1.5.12 Add Key File Time This method creates a new property key and at the same time a value of the data type FILETIME. Syntax METHOD Add Key File Time VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : FILETIME; END_VAR Inputs Name Type value FILETIME / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key File Time('Timestamp', ft Time); 5.2.1.5.13 Add Key Lreal This method creates a new property key and at the same time a value of the data type LREAL. 142 Version: 1.11.0 TF6760
## Page 143

PLC API Syntax METHOD Add Key Lreal VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : LREAL; END_VAR Inputs Name Type value LREAL / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Lreal('Property Name', 42.42); 5.2.1.5.14 Add Key Null This method creates a new property key and initializes its value with null. Syntax METHOD Add Key Null VAR_IN_OUT CONSTANT key : STRING; END_VAR / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Null('Property Name'); 5.2.1.5.15 Add Key Number This method creates a new property key and at the same time a value of the data type DINT. Syntax METHOD Add Key Number VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT value : DINT; END_VAR TF6760 Version: 1.11.0 143
## Page 144

PLC API Inputs Name Type value DINT / Inputs/Outputs Name Type key STRING Sample call: fb Json. Add Key Number('Property Name', 42); 5.2.1.5.16 Add Key String This method creates a new property key and at the same time a value of the data type STRING. Syntax METHOD Add Key String VAR_IN_OUT CONSTANT key : STRING; value : STRING; END_VAR / Inputs/Outputs Name Type key STRING value STRING Sample call: fb Json. Add Key String('Property Name', 'Hello World'); 5.2.1.5.17 Add Lint This method adds a value of the data type LINT to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Lint VAR_INPUT value : LINT; END_VAR Inputs Name Type value LINT 144 Version: 1.11.0 TF6760
## Page 145

PLC API Sample call: fb Json. Add Key('Property Name'); fb Json. Add Lint(42); 5.2.1.5.18 Add Lreal This method adds a value of the data type LREAL to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Lreal VAR_INPUT value : LREAL; END_VAR Inputs Name Type value LREAL Sample call: fb Json. Add Key('Property Name'); fb Json. Add Lreal(42.42); 5.2.1.5.19 Add Null This method adds the value null to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Null Sample call: fb Json. Add Key('Property Name'); fb Json. Add Null(); 5.2.1.5.20 Add Raw Array This method adds a valid JSON array to a given property as a value. The array to be added must be in a valid JSON format and may only be added if the SAX Writer is at a correspondingly valid position, e.g. directly after a preceding Add Key() [} 140], Start Array() [} 153] or as the first call after a Reset Document() [} 151]. TF6760 Version: 1.11.0 145
## Page 146

PLC API Syntax METHOD Add Raw Array VAR_IN_OUT CONSTANT raw Json : STRING; END_VAR Return value Name Type Add Raw Array BOOL / Inputs/Outputs Name Type raw Json STRING Sample call: fb Json. Add Key('Property Name'); fb Json. Add Raw Array('[1, 2, {"x":42, "y":42}, 4'); 5.2.1.5.21 Add Raw Object This method adds a valid JSON object to a given property as a value. The object to be added must be in a valid JSON format and may only be added if the SAX Writer is in an appropriately valid position, e.g. directly after a preceding Add Key() [} 140], Start Array() [} 153] or as the first call after a Reset Document() [} 151]. Syntax METHOD Add Raw Object VAR_IN_OUT CONSTANT raw Json : STRING; END_VAR / Inputs/Outputs Name Type raw Json STRING Sample call: fb Json. Add Key('Property Name'); fb Json. Add Raw Object('{"x":42, "y":42}'); 5.2.1.5.22 Add Real This method adds a value of the data type REAL to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Real VAR_INPUT value : REAL; END_VAR 146 Version: 1.11.0 TF6760
## Page 147

PLC API Inputs Name Type value REAL Sample call: fb Json. Add Key('Property Name'); fb Json. Add Real(42.42); 5.2.1.5.23 Add String This method adds a value of the data type STRING to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add String VAR_IN_OUT CONSTANT value : STRING; END_VAR / Inputs/Outputs Name Type value STRING Sample call: fb Json. Add Key('Property Name'); fb Json. Add String('Hello World'); 5.2.1.5.24 Add Udint This method adds a value of the data type UDINT to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Udint VAR_INPUT value : UDINT; END_VAR Inputs Name Type value UDINT Sample call: fb Json. Add Key('Property Name'); fb Json. Add Udint(42); TF6760 Version: 1.11.0 147
## Page 148

PLC API 5.2.1.5.25 Add Ulint This method adds a value of the data type ULINT to a property. Usually, a corresponding property was created beforehand with the method Add Key() [} 140]. Syntax METHOD Add Ulint VAR_INPUT value : ULINT; END_VAR Inputs Name Type value ULINT Sample call: fb Json. Add Key('Property Name'); fb Json. Add Ulint(42); 5.2.1.5.26 Copy Document This method copies the content of the current JSON object created with the SAX Writer to a target variable of the data type STRING, which can be of any length. The method returns the length of the string (including null termination). If the destination buffer is too small, it is emptied by a null termination and returned as length 0. Syntax METHOD Copy Document : UDINT VAR_IN_OUT CONSTANT p Doc : STRING; END_VAR VAR_INPUT n Doc : UDINT; END_VAR VAR_OUTPUT hr Error Code: HRESULT; END_VAR Return value Name Type Copy Document UDINT Inputs Name Type n Doc UDINT 148 Version: 1.11.0 TF6760
## Page 149

PLC API / Inputs/Outputs Name Type p Doc STRING Outputs Name Type hr Error Code HRESULT Sample call: fb Json. Copy Document(s Target String, SIZEOF(s Target String)); 5.2.1.5.27 End Array This method generates the end of a started JSON array ("square closing bracket") and inserts it at the current position of the SAX writer. Syntax METHOD End Array : HRESULT Return value Name Type End Array HRESULT Sample call: fb Json. End Array(); 5.2.1.5.28 End Object This method generates the end of a started JSON object ("curly closing bracket") and inserts it at the current position of the SAX writer. Syntax METHOD End Object : HRESULT Return value Name Type End Object HRESULT Sample call: fb Json. End Object(); TF6760 Version: 1.11.0 149
## Page 150

PLC API 5.2.1.5.29 Get Document This method returns the content of the JSON object that is currently created with the SAX Writer and returns it as data type STRING(255). The maximum size of the string returned by the method is 255 characters. With longer strings, the method will return a NULL string. In this case the method Copy Document [} 148]() must be used. Syntax METHOD Get Document : STRING(255) VAR_OUTPUT hr Error Code: HRESULT; END_VAR Return value Name Type Get Document STRING(255) Outputs Name Type hr Error Code HRESULT Sample call: s Target String := fb Json. Get Document(); 5.2.1.5.30 Get Document Length This method returns the length of the JSON object that is currently created with the SAX Writer and returns it as data type UDINT. Syntax METHOD Get Document Length : UDINT VAR_OUTPUT hr Error Code: HRESULT; END_VAR Return value Name Type Get Document Length UDINT Outputs Name Type hr Error Code HRESULT Sample call: n Length := fb Json. Get Document Length(); 150 Version: 1.11.0 TF6760
## Page 151

PLC API 5.2.1.5.31 Get Max Decimal Places This function queries the currently set number of decimal places after which a floating point number is truncated. Syntax METHOD Get Max Decimal Places : DINT Return value Name Type Description Get Max Decimal Places DINT The currently set number of digits after which a floating point number is truncated. 5.2.1.5.32 Reset Document This method resets the JSON object currently created with the SAX writer. Syntax METHOD Reset Document : HRESULT Return value Name Type Reset Document HRESULT Sample call: fb Json. Reset Document(); 5.2.1.5.33 Set Format Options This method is used to customize the general formatting options for an instance of the FB_Json Sax Pretty Writer [} 136]. In addition to the default configuration, there is also the possibility that no line breaks are generated within an array. The array is then output in one line despite the inserted indentations. Syntax METHOD Set Format Options : HRESULT VAR_INPUT options : EJson Pretty Format Options; END_VAR TYPE EJson Pretty Format Options: ( e Format Default :=0, e Format Single Line Array:=1 ) DINT; TF6760 Version: 1.11.0 151
## Page 152

PLC API Return value Name Type Set Format Options HRESULT Inputs Name Type options EJson Pretty Format Options Sample call: fb Json. Set Format Options(EJson Pretty Format Options.e Format Single Line Array); 5.2.1.5.34 Set Indent This method is used to customize the indentation. Syntax METHOD Set Indent : HRESULT VAR_INPUT indent Char : SINT; indent Char Count : UDINT; END_VAR Return value Name Type Set Indent HRESULT Inputs Name Type indent Char SINT indent Char Count UDINT Sample call: fb Json. Set Indent(1,5); 5.2.1.5.35 Set Max Decimal Places This function specifies the number of decimal places after which a floating-point number is rounded. Syntax METHOD Set Max Decimal Places : HRESULT VAR_INPUT decimal Places: DINT; END_VAR 152 Version: 1.11.0 TF6760
## Page 153

PLC API Return value Name Type Set Max Decimal Places HRESULT Inputs Name Type Description decimal Pla DINT The number of decimal places to be set after which a floating- ces point number is truncated. 5.2.1.5.36 Start Array This method generates the start of a new JSON array ("square opening bracket") and inserts it at the current position of the SAX writer. Syntax METHOD Start Array : HRESULT Return value Name Type Start Array HRESULT Sample call: fb Json. Start Array(); 5.2.1.5.37 Start Object This method generates the start of a new JSON object ("curly opening bracket") and inserts it at the current position of the SAX writer. Syntax METHOD Start Object : HRESULT Return value Name Type Start Object HRESULT Sample call: fb Json. Start Object(); 5.2.1.6 FB_Json Read Write Data Type TF6760 Version: 1.11.0 153
## Page 154

PLC API In order to use UTF-8 characters, e.g. in the automatic generation of metadata via the function block FB_Json Read Write Data Type [} 153], the check box for the support of UTF-8 in the symbolism must be activated in the Twin CAT project. To do this, double-click on SYSTEM in the project tree, open the Settings tab and activate the corresponding check box. Strings in UTF-8 format The variables of type STRING used here are based on the UTF-8 format. This STRING formatting is common for MQTT communication as well as for JSON documents. In order to be able to receive special characters and texts from a wide range of languages, the character set in the Tc3_Iot Base and Tc3_Json Xml libraries is not limited to the typical character set of the data type STRING. Instead, the Unicode character set in UTF-8 format is used in conjunction with the data type STRING. If the ASCII character set is used, there is no difference between the typical formatting of a STRING and the UTF-8 formatting of a STRING. Further information on the UTF-8 STRING format and available display and conversion options can be found in the documentation for the Tc2_Utilities PLC library. Outputs Name Type init Status HRESULT 154 Version: 1.11.0 TF6760
## Page 155

PLC API Methods Name Description FB_Json Read Write Data Type Metadata can be added via PLC attributes to the JSON representation of a PLC data structure on an FB_Json Sax Writer object. Add Json Key Value From Symbol [} 156] Creates the JSON representation of a PLC data structure on an FB_Json Sax Writer object. Add Json Value From Symbol [} 157] Creates the JSON representation of a PLC data structure on an FB_Json Sax Writer object. Copy Json String From Symbol [} 158] Creates the JSON representation of a symbol and copies it to a variable of data type STRING. Copy Json String From Symbol Properties Creates a corresponding JSON representation of PLC attributes on a symbol. [} 159] Copy Symbol Name By Address [} 160] Returns the complete (ADS) symbol name of a transferred symbol. Get Data Type Name By Address [} 161] Returns the data type name of a transferred symbol. Get Json From Symbol [} 162] Creates the corresponding JSON representation of a symbol. Get Json String From Symbol [} 163] Creates the corresponding JSON representation of a symbol. Get Json String From Symbol Properties Creates a corresponding JSON representation of PLC attributes on a symbol. [} 164] Get Size Json String From Symbol [} 165] Reads the size of the JSON representation of a symbol. Get Size Json String From Symbol Properti Reads the size of the JSON representation of PLC attributes on a symbol. es [} 165] Get Symbol Name By Address [} 166] Returns the complete (ADS) symbol name of a transferred symbol. Set Symbol From Json [} 167] Extracts a string containing a valid JSON message. Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4022 x86, x64, Arm® Tc3_Json Xml 5.2.1.6.1 Add Json Key Properties From Symbol With the aid of this method, metadata can be added via PLC attributes to the JSON representation of a PLC data structure on an FB_Json Sax Writer [} 118] object. The method receives as its input parameters the instance of the FB_Json Sax Writer function block, the desired name of the JSON property that is to contain the metadata, the data type name of the structure and a string variable s Properties, which contains a list of the PLC attributes to be extracted, separated by a cross bar. Syntax METHOD Add Json Value From Symbol : BOOL VAR_IN_OUT fb Writer : FB_Json Sax Writer; END_VAR VAR_IN_OUT CONSTANT s Key : STRING; s Datatype : STRING; s Properties : STRING; END_VAR TF6760 Version: 1.11.0 155
## Page 156

PLC API VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Add Json Value From Symbol BOOL / Inputs/Outputs Name Type fb Writer FB_Json Sax Writer s Key STRING s Datatype STRING s Properties STRING Outputs Name Type hr Error Code HRESULT The PLC attributes can be specified in the following form on the structure elements: {attribute 'Unit' := 'm/s'} {attribute 'Display Name' := 'Speed'} Sensor1 : REAL; A complete sample of how to use this method can be found in section Tc3Json Xml Sample Json Data Type. Sample call: fb Json Sax Writer. Reset Document() fb Json Data Type. Add Json Key Properties From Symbol(fb Json Sax Writer, 'Meta Data','ST_Values','Unit| Display Name'); 5.2.1.6.2 Add Json Key Value From Symbol This method generates the JSON representation of a PLC data structure on an FB_Json Sax Writer [} 118] object. The method receives as its input parameters the instance of the FB_Json Sax Writer function block, the data type name of the structure, and the address and size of the source structure instance. As a result, the FB_Json Sax Writer instance contains a valid JSON representation of the structure. Unlike the method Add Json Value From Symbol() [} 157], the elements of the source structure are nested here in a JSON sub- object whose name can be specified via the input/output parameter s Key. Syntax METHOD Add Json Value From Symbol : BOOL VAR_IN_OUT fb Writer : FB_Json Sax Writer; END_VAR VAR_IN_OUT CONSTANT s Key : STRING; s Datatype : STRING; END_VAR VAR_INPUT n Data : UDINT; p Data : PVOID; 156 Version: 1.11.0 TF6760
## Page 157

PLC API END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Add Json Value From Symbol BOOL Inputs Name Type n Data UDINT p Data PVOID / Inputs/Outputs Name Type fb Writer FB_Json Sax Writer s Key STRING s Datatype STRING Outputs Name Type hr Error Code HRESULT A complete sample of how to use this method can be found in section Tc3Json Xml Sample Json Data Type. Sample call: fb Json Sax Writer. Reset Document() fb Json Data Type. Add Json Key Value From Symbol(fb Json Sax Writer, 'Values','ST_Values',SIZEOF(st Values), ADR(st Values)); 5.2.1.6.3 Add Json Value From Symbol This method generates the JSON representation of a PLC data structure on an FB_Json Sax Writer [} 118] object. The method receives as its input parameters the instance of the FB_Json Sax Writer function block, the data type name of the structure, and the address and size of the source structure instance. As a result, the FB_Json Sax Writer instance contains a valid JSON representation of the structure. Syntax METHOD Add Json Value From Symbol : BOOL VAR_IN_OUT fb Writer : FB_Json Sax Writer; END_VAR VAR_IN_OUT CONSTANT s Datatype : STRING; END_VAR VAR_INPUT n Data : UDINT; p Data : PVOID; END_VAR TF6760 Version: 1.11.0 157
## Page 158

PLC API VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Add Json Value From Symbol BOOL Inputs Name Type n Data UDINT p Data PVOID / Inputs/Outputs Name Type fb Writer FB_Json Sax Writer s Datatype STRING Outputs Name Type hr Error Code HRESULT A complete sample of how to use this method can be found in section Tc3Json Xml Sample Json Data Type. Sample call: fb Json Sax Writer. Reset Document() fb Json Data Type. Add Json Value From Symbol(fb Json Sax Writer,'ST_Values',SIZEOF(st Values), ADR(st Values)); 5.2.1.6.4 Copy Json String From Symbol This method generates the JSON representation of a symbol and copies it into a variable of the data type STRING, which can be of any length. The method returns the length of the string (including null termination). If the destination buffer is too small, it is emptied by a null termination and returned as length 0. Syntax METHOD Copy Json String From Symbol : UDINT VAR_INPUT n Data : UDINT; n Doc : UDINT; p Data : PVOID; END_VAR VAR_IN_OUT CONSTANT p Doc : STRING; s Datatype : STRING; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR 158 Version: 1.11.0 TF6760
## Page 159

PLC API Return value Name Type Copy Json String From Symbol UDINT Inputs Name Type n Data UDINT n Doc UDINT p Data PVOID / Inputs/Outputs Name Type p Doc STRING s Datatype STRING Outputs Name Type hr Error Code HRESULT Sample call: n Len := fb Json Data Type. Copy Json String From Symbol('ST_Test',SIZEOF(st Test),ADR(st Test),s String,SIZEOF(s String) ); 5.2.1.6.5 Copy Json String From Symbol Properties This method generates a corresponding JSON representation of PLC attributes on a symbol. In contrast to the Add Json Key Properties From Symbol [} 155] method, the result is not written to an instance of the function block FB_Json Sax Writer, but to a string variable. The method receives as its input parameters the data type name of the symbol and a string variable that represents a list of the PLC attributes to be extracted, separated by a cross bar. The method copies this JSON representation into a variable of the data type STRING, which can be of any length. The method returns the length of the string (including null termination). If the destination buffer is too small, it is emptied by a null termination and returned as length 0. Syntax METHOD Copy Json String From Symbol Properties : UDINT VAR_INPUT n Doc : UDINT; END_VAR VAR_IN_OUT CONSTANT p Doc : STRING; s Datatype : STRING; s Properties : STRING; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR TF6760 Version: 1.11.0 159
## Page 160

PLC API Return value Name Type Copy Json String From Symbol Properties UDINT Inputs Name Type n Doc UDINT / Inputs/Outputs Name Type p Doc STRING s Datatype STRING s Properties STRING Outputs Name Type hr Error Code HRESULT Sample call: n Len := fb Json Data Type. Copy Json String From Symbol Properties('ST_Test','Unit| Display Name',s String,SIZEOF(s String)); 5.2.1.6.6 Copy Symbol Name By Address This method returns the complete (ADS) symbol name of a transferred symbol. The method returns the size of the string (including null termination). If the destination buffer is too small, it is emptied by a null termination and returned as length 0. Syntax METHOD Copy Symbol Name By Address : UDINT VAR_INPUT n Data : UDINT; // size of symbol p Data : PVOID; // address of symbol END_VAR VAR_IN_OUT CONSTANT s Name : STRING; // target string buffer where the symbol name should be copied to END_VAR VAR_INPUT n Name : UDINT; // size in bytes of target string buffer END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Copy Symbol Name By Address UDINT 160 Version: 1.11.0 TF6760
## Page 161

PLC API Inputs Name Type n Data UDINT p Data PVOID n Name UDINT / Inputs/Outputs Name Type s Name STRING Outputs Name Type hr Error Code HRESULT Sample call: n Symbol Size := fb Json Data Type. Copy Symbol Name By Address(n Data:=SIZEOF(st Values), p Data:=ADR(st Values), s Name:=s Symbol Name, n Name:=SIZEOF(s Symbol Name)); Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4024.20 x86, x64, Arm® Tc3_Json Xml 3.3.15.0 5.2.1.6.7 Get Data Type Name By Address This method returns the data type name of a transferred symbol. Structures with a single variable If structures with a single variable are used, the data type cannot be read correctly using this method. The size and address information cannot be used to distinguish between the structure itself and the individual variables. Syntax METHOD Get Data Type Name By Address : STRING VAR_INPUT n Data : UDINT; p Data : PVOID; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Get Data Type Name By Address STRING TF6760 Version: 1.11.0 161
## Page 162

PLC API Inputs Name Type n Data UDINT p Data PVOID Outputs Name Type hr Error Code HRESULT Sample call: s Buffer := fb Json Data Type. Get Data Type Name By Address(SIZEOF(st Values),ADR(st Values)); 5.2.1.6.8 Get Json From Symbol This method generates the corresponding JSON representation of a symbol. In contrast to the Add Json Value From Symbol() [} 157] method, the result is not written to an instance of the function block FB_Json Sax Writer, but to a string variable. The method receives as its input parameters the data type name of the symbol as well as the address and size of the source symbol, e.g. of a structure instance. The address and size of the destination buffer that contains the JSON representation of the symbol after the call are transferred as further input parameters. Syntax METHOD Get Json From Symbol : BOOL VAR_IN_OUT CONSTANT s Datatype : STRING; END_VAR VAR_INPUT n Data : UDINT; p Data : PVOID; n Json : REFERENCE TO UDINT; p Json : POINTER TO STRING; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Get Json From Symbol BOOL Inputs Name Type n Data UDINT p Data PVOID n Json REFERENCE TO UDINT p Json POINTER TO STRING 162 Version: 1.11.0 TF6760
## Page 163

PLC API / Inputs/Outputs Name Type s Datatype STRING Outputs Name Type hr Error Code HRESULT Input parameter n Json The input parameter n Json contains the size of the destination buffer when the method is called, and the size of the actually written JSON object in the destination buffer when the method call is completed. Sample call: fb Json Data Type. Get Json From Symbol('ST_Values',SIZEOF(st Values), ADR(st Values), n Buffer Length, ADR(s Buffer)); 5.2.1.6.9 Get Json String From Symbol This method generates the corresponding JSON representation of a symbol. In contrast to the Add Json Value From Symbol() [} 157] method, the result is not written to an instance of the function block FB_Json Sax Writer, but to a string variable. The method receives as its input parameters the data type name of the symbol as well as the address and size of the source symbol of a structure instance, for example. The maximum size of the string returned by the method is 255 characters. With longer strings, the method will return a NULL string. In this case the method Copy Json String From Symbol [} 158]() must be used. Syntax METHOD Get Json String From Symbol : STRING(255) VAR_IN_OUT CONSTANT s Datatype : STRING; END_VAR VAR_INPUT n Data : UDINT; p Data : PVOID; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Get Json String From Symbol STRING(255) Inputs Name Type n Data UDINT p Data PVOID TF6760 Version: 1.11.0 163
## Page 164

PLC API / Inputs/Outputs Name Type s Datatype STRING Outputs Name Type hr Error Code HRESULT Sample call: s Buffer := fb Json Data Type. Get Json String From Symbol('ST_Values',SIZEOF(st Values), ADR(st Values)); 5.2.1.6.10 Get Json String From Symbol Properties This method generates a corresponding JSON representation of PLC attributes on a symbol. In contrast to the Add Json Key Properties From Symbol [} 155] method, the result is not written to an instance of the function block FB_Json Sax Writer, but to a string variable. The method receives as its input parameters the data type name of the symbol and a string variable that represents a list of the PLC attributes to be extracted, separated by a cross bar. The result is returned directly as the return value of the method. The maximum size of the string returned by the method is 255 characters. With longer strings, the method will return a NULL string. In this case the method Copy Json String From Symbol Properties [} 159]() must be used. Syntax METHOD Get Json String From Symbol Properties : STRING(255) VAR_IN_OUT CONSTANT s Datatype : STRING; s Properties : STRING; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Get Json String From Symbol Properties STRING(255) / Inputs/Outputs Name Type s Datatype STRING s Properties STRING Outputs Name Type hr Error Code HRESULT Sample call: s Buffer := fb Json Data Type. Get Json String From Symbol Properties('ST_Values', 'Unit|Display Name'); 164 Version: 1.11.0 TF6760
## Page 165

PLC API 5.2.1.6.11 Get Size Json String From Symbol This method reads the size of the JSON representation of a symbol. The value is specified with null termination. Syntax METHOD Get Size Json String From Symbol : UDINT VAR_INPUT n Data :UDINT; p Data :PVOID; END_VAR VAR_IN_OUT CONSTANT s Datatype : STRING; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Get Size Json String From Symbol UDINT Inputs Name Type n Data UDINT p Data PVOID / Inputs/Outputs Name Type s Datatype STRING Outputs Name Type hr Error Code HRESULT Sample call: n Len := fb Json Data Type. Get Size Json String From Symbol('BOOL',SIZEOF(b Bool),ADR(b Bool)); 5.2.1.6.12 Get Size Json String From Symbol Properties This method reads the size of the JSON representation of PLC attributes on a symbol. The value is specified with null termination. TF6760 Version: 1.11.0 165
## Page 166

PLC API Syntax METHOD Get Size Json String From Symbol Properties : UDINT VAR_IN_OUT CONSTANT s Datatype : STRING; s Properties : STRING; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Get Size Json String From Symbol Properties UDINT / Inputs/Outputs Name Type s Datatype STRING s Properties STRING Outputs Name Type hr Error Code HRESULT Sample call: n Len := fb Json Data Type. Get Size Json String From Symbol Properties('ST_Test','Display Name|Unit'); 5.2.1.6.13 Get Symbol Name By Address This method returns the complete (ADS) symbol name of a transferred symbol. The maximum size of the string returned by the method is 255 characters. With longer strings, the method will return a null string. In this case the method Copy Symbol Name By Address() [} 160] must be used. Syntax METHOD Get Symbol Name By Address : STRING(255) VAR_INPUT n Data : UDINT; p Data : PVOID; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Get Symbol Name By Address STRING(255) 166 Version: 1.11.0 TF6760
## Page 167

PLC API Inputs Name Type n Data UDINT p Data PVOID Outputs Name Type hr Error Code HRESULT Sample call: s Buffer := fb Json Data Type. Get Symbol Name By Address(SIZEOF(st Values), ADR(st Values)); 5.2.1.6.14 Set Symbol From Json This method extracts a string containing a valid JSON message and attempts to save the contents of the JSON object to an equivalent data structure. The method receives as its input parameters the string with the JSON object, the data type name of the target structure, and the address and size of the target structure instance. Syntax METHOD Set Symbol From Json : BOOL VAR_IN_OUT CONSTANT s Json : STRING; s Datatype : STRING; END_VAR VAR_INPUT n Data : UDINT; p Data : PVOID; END_VAR VAR_OUTPUT hr Error Code : HRESULT; END_VAR Return value Name Type Set Symbol From Json BOOL Inputs Name Type n Data UDINT p Data PVOID / Inputs/Outputs Name Type s Json STRING s Datatype STRING TF6760 Version: 1.11.0 167
## Page 168

PLC API Outputs Name Type hr Error Code HRESULT Sample call: fb Json Data Type. Set Symbol From Json(s Json,'ST_Values',SIZEOF(st Values Receive), ADR(st Values Receive)); 5.2.1.7 FB_Xml Dom Parser Strings in UTF-8 format The variables of type STRING used here are based on the UTF-8 format. This STRING formatting is common for MQTT communication as well as for JSON documents. In order to be able to receive special characters and texts from a wide range of languages, the character set in the Tc3_Iot Base and Tc3_Json Xml libraries is not limited to the typical character set of the data type STRING. Instead, the Unicode character set in UTF-8 format is used in conjunction with the data type STRING. If the ASCII character set is used, there is no difference between the typical formatting of a STRING and the UTF-8 formatting of a STRING. Further information on the UTF-8 STRING format and available display and conversion options can be found in the documentation for the Tc2_Utilities PLC library. Outputs Name Type init Status HRESULT 168 Version: 1.11.0 TF6760
## Page 169

PLC API Methods TF6760 Version: 1.11.0 169
## Page 170

PLC API Name Description Append Attribute [} 172] Appends a new attribute to an existing node. Append Attribute As Bool [} 173] Appends a new attribute to an existing node (Boolean). Append Attribute As Double Appends a new attribute to an existing node (Double). [} 174] Append Attribute As Float [} 174] Appends a new attribute to an existing node (Float). Append Attribute As Int [} 175] Appends a new attribute to an existing node (Integer). Append Attribute As Lint [} 176] Appends a new attribute to an existing node (Integer64). Append Attribute As Uint [} 177] Appends a new attribute to an existing node (Unsigned Integer). Append Attribute As Ulint [} 177] Appends a new attribute to an existing node (Unsigned Integer64). Append Attribute Copy [} 178] Appends a new attribute to an existing node. Append Child [} 179] Appends a new node below an existing node. Append Child As Bool [} 179] Appends a new node below an existing node (Boolean). Append Child As Double [} 180] Appends a new node below an existing node (Double). Append Child As Float [} 181] Appends a new node below an existing node (Float). Append Child As Int [} 182] Appends a new node below an existing node (Integer). Append Child As Lint [} 182] Appends a new node below an existing node (Integer64). Append Child As Uint [} 183] Appends a new node below an existing node (Unsigned Integer). Append Child As Ulint [} 184] Appends a new node below an existing node (Unsigned Integer64). Append Copy [} 184] Appends a new node below an existing node. Append Node [} 185] Appends a new node below an existing node. Attributes [} 186] Reads the attribute of a given XML node. Attribute As Bool [} 186] Returns the value of an attribute as data type Boolean. Attribute As Double [} 187] Returns the value of an attribute as data type Double. Attribute As Float [} 187] Returns the value of an attribute as data type Float. Attribute As Int [} 188] Returns the value of an attribute as data type Integer. Attribute As Lint [} 188] Returns the value of an attribute as data type Integer64. Attribute As Uint [} 189] Returns the value of an attribute as data type Unsigned Integer. Attribute As Ulint [} 189] Returns the value of an attribute as data type Unsigned Integer64. Attribute Begin [} 190] Returns an iterator over all attributes of an XML node. Attribute From Iterator [} 190] Converts the current position of an iterator to an XML attribute object. Attribute Name [} 191] Returns the name of a given attribute. Attributes [} 191] Used to navigate the DOM and returns an iterator for all attributes found at an XML node. Attribute Text [} 192] Returns the text of a given attribute. Begin [} 193] Returns an iterator over all child elements of an XML node. Begin By Name [} 193] Returns an iterator over all child elements of an XML node, starting at a particular element. Child [} 194] Used to navigate through the DOM. It returns a reference to the (first) child element of the current node. Child By Attribute [} 194] Used to navigate through the DOM. It returns a reference to a child element in the XML document. Child By Attribute And Name Used to navigate through the DOM. It returns a reference to a child element in the XML document. [} 195] Child By Name [} 196] Used to navigate through the DOM. It returns a reference to a child element in the XML document. 170 Version: 1.11.0 TF6760
## Page 171

PLC API Name Description Children [} 196] Used to navigate through the DOM. It returns an iterator for several child elements found in the XML document. Children By Name [} 197] Used to navigate through the DOM. It returns an iterator for several child elements found in the XML document. Clear Iterator [} 198] This method resets iterators that have already been used so that they can be used again the next time the program is run. Compare [} 198] Checks two iterators for equality. Copy Attribute Text [} 199] Reads the value of an XML attribute and writes it to a variable of data type String. Copy Document [} 200] Copies the contents of the DOM memory into a variable of data type String. Copy Node Text [} 200] Reads the value of an XML node and writes it to a variable of data type String. Copy Node Xml [} 201] Reads the XML structure of an XML node and writes it to a variable of data type String. End First Node By Path [} 202] Navigates through an XML document using a path that was transferred to the method. Get Attribute Text Length [} 202] Returns the length of the value of an XML attribute. Get Document Length [} 203] Returns the length of an XML document in bytes. Get Document Node [} 203] Returns the root node of an XML document. Get Node Text Length [} 204] Returns the length of the value of an XML node. Get Node Xml Length [} 204] Returns the length of the XML structure of an XML node. Get Root Node [} 205] Returns a reference to the first XML node in the XML document. Insert Attribute Copy [} 205] Inserts an attribute to an XML node, copying the name and value of an existing attribute. Insert Attribute [} 206] Inserts an attribute to an XML node. Insert Child [} 206] Inserts a node to an existing XML node. Insert Copy [} 207] Inserts a new node to an existing XML node and copies an existing node. Is End [} 208] Checks whether a given XML iterator is at the end of the iteration that is to be performed. Load Document From File [} 208] Loads a XML document from a file. New Document [} 209] Generates a new empty XML document in the DOM memory. Next [} 209] Sets an XML iterator for the next object that is to be processed. Next Attribute [} 210] Returns the next attribute for a given XML attribute. Next By Name [} 210] Sets an XML iterator for the next object that is to be processed, which is identified by its name. Next Sibling [} 211] Returns the next direct node for a given XML node at the same XML level. Next Sibling By Name [} 212] Returns the next direct node for a given XML node with a particular name at the same XML level. Node [} 212] Used in conjunction with an iterator to navigate through the DOM. Node As Bool [} 213] Returns the text of an XML node as data type Boolean. Node As Double [} 213] Returns the text of an XML node as data type Double. Node As Float [} 214] Returns the text of an XML node as data type Float. Node As Int [} 214] Returns the text of an XML node as data type Integer. Node As Lint [} 215] Returns the text of an XML node as data type Integer64. Node As Uint [} 215] Returns the text of an XML node as data type Unsigned Integer. Node As Ulint [} 216] Returns the text of an XML node as data type Unsigned Integer64. TF6760 Version: 1.11.0 171
## Page 172

PLC API Name Description Node Name [} 216] Returns the name of an XML node. Node Text [} 217] Returns the text of an XML node. Parse Document [} 217] Loads an XML object into the DOM memory for further processing. Remove Attribute Remove Attribute By Name Remove Child [} 218] Removes an XML child node from a given XML node. Remove Child By Name [} 218] Removes an XML child node from a given XML node. Save Document To File [} 219] Saves the current XML document in a file. Set Attribute [} 220] Sets the value of an attribute. Set Attribute As Bool [} 221] Sets the value of an attribute (Boolean). Set Attribute As Double [} 221] Sets the value of an attribute (double). Set Attribute As Float [} 222] Sets the value of an attribute (float). Set Attribute As Int [} 222] Sets the value of an attribute (integer). Set Attribute As Lint [} 223] Sets the value of an attribute (Integer64). Set Attribute As Uint [} 223] Sets the value of an attribute (Unsigned Integer). Set Attribute As Ulint [} 224] Sets the value of an attribute (Unsigned Integer64). Set Child [} 224] Sets the value of an XML node (String). Set Child As Bool [} 225] Sets the value of an XML node (Boolean). Set Child As Double [} 225] Sets the value of an XML node (Double). Set Child As Float [} 226] Sets the value of an XML node (Float). Set Child As Int [} 227] Sets the value of an XML node (Integer). Set Child As Lint [} 227] Sets the value of an XML node (Integer64). Set Child As Uint [} 228] Sets the value of an XML node (Unsigned Integer). Set Child As Ulint [} 228] Sets the value of an XML node (Unsigned Integer64). Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4022 x86, x64, Arm® Tc3_Json Xml 5.2.1.7.1 Append Attribute This method adds a new attribute to an existing node. The name and value of the new attribute and the existing XML node are transferred to the method as input parameters. The method returns a reference to the newly added attribute. Syntax METHOD Append Attribute : SXml Attribute VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; value : STRING; END_VAR 172 Version: 1.11.0 TF6760
## Page 173

PLC API Return value Name Type Append Attribute SXml Attribute Inputs Name Type n SXml Node / Inputs/Outputs Name Type name STRING value STRING Sample call: obj Attribute := fb Xml. Append Attribute(obj Machine, 'Name', 'some value'); 5.2.1.7.2 Append Attribute As Bool This method adds a new attribute to an existing node. The value of the attribute has the data type Boolean. The name and value of the new attribute and the existing XML node are transferred to the method as input parameters. The method returns a reference to the newly added attribute. Syntax METHOD Append Attribute As Bool : SXml Attribute VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : BOOL; END_VAR Return value Name Type Append Attribute As Bool SXml Attribute Inputs Name Type n SXml Node value BOOL TF6760 Version: 1.11.0 173
## Page 174

PLC API / Inputs/Outputs Name Type name STRING Sample call: obj Attribute := fb Xml. Append Attribute As Bool(obj Machine, 'Name', TRUE); 5.2.1.7.3 Append Attribute As Double This method adds a new attribute to an existing node. The value of the attribute has the data type Double. The name and value of the new attribute and the existing XML node are transferred to the method as input parameters. The method returns a reference to the newly added attribute. Syntax METHOD Append Attribute As Double : SXml Attribute VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : LREAL; END_VAR Return value Name Type Append Attribute As Double SXml Attribute Inputs Name Type n SXml Node value LREAL / Inputs/Outputs Name Type name STRING Sample call: obj Attribute := fb Xml. Append Attribute As Double(obj Machine, 'Name', 42.42); 5.2.1.7.4 Append Attribute As Float 174 Version: 1.11.0 TF6760
## Page 175

PLC API This method adds a new attribute to an existing node. The value of the attribute has the data type Float. The name and value of the new attribute and the existing XML node are transferred to the method as input parameters. The method returns a reference to the newly added attribute. Syntax METHOD Append Attribute As Float : SXml Attribute VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : REAL; END_VAR Return value Name Type Append Attribute As Float SXml Attribute Inputs Name Type n SXml Node value REAL / Inputs/Outputs Name Type name STRING Sample call: obj Attribute := fb Xml. Append Attribute As Float(obj Machine, 'Name', 42.42); 5.2.1.7.5 Append Attribute As Int This method adds a new attribute to an existing node. The value of the attribute has the data type Integer. The name and value of the new attribute and the existing XML node are transferred to the method as input parameters. The method returns a reference to the newly added attribute. Syntax METHOD Append Attribute As Int : SXml Attribute VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : DINT; END_VAR TF6760 Version: 1.11.0 175
## Page 176

PLC API Return value Name Type Append Attribute As Int SXml Attribute Inputs Name Type n SXml Node value DINT / Inputs/Outputs Name Type name STRING Sample call: obj Attribute := fb Xml. Append Attribute As Int(obj Machine, 'Name', 42); 5.2.1.7.6 Append Attribute As Lint This method adds a new attribute to an existing node. The value of the attribute has the data type Integer64. The name and value of the new attribute and the existing XML node are transferred to the method as input parameters. The method returns a reference to the newly added attribute. Syntax METHOD Append Attribute As Lint : SXml Attribute VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : LINT; END_VAR Return value Name Type Append Attribute As Lint SXml Attribute Inputs Name Type n SXml Node value LINT / Inputs/Outputs Name Type name STRING 176 Version: 1.11.0 TF6760
## Page 177

PLC API Sample call: obj Attribute := fb Xml. Append Attribute As Lint(obj Machine, 'Name', 42); 5.2.1.7.7 Append Attribute As Uint This method adds a new attribute to an existing node. The value of the attribute has the data type Unsigned Integer. The name and value of the new attribute and the existing XML node are transferred to the method as input parameters. The method returns a reference to the newly added attribute. Syntax METHOD Append Attribute As Uint : SXml Attribute VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : UDINT; END_VAR Return value Name Type Append Attribute As Uint SXml Attribute Inputs Name Type n SXml Node value UDINT / Inputs/Outputs Name Type name STRING Sample call: obj Attribute := fb Xml. Append Attribute As Uint(obj Machine, 'Name', 42); 5.2.1.7.8 Append Attribute As Ulint This method adds a new attribute to an existing node. The value of the attribute has the data type Unsigned Integer64. The name and value of the new attribute and the existing XML node are transferred to the method as input parameters. The method returns a reference to the newly added attribute. TF6760 Version: 1.11.0 177
## Page 178

PLC API Syntax METHOD Append Attribute As Ulint : SXml Attribute VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : ULINT; END_VAR Return value Name Type Append Attribute As Ulint SXml Attribute Inputs Name Type n SXml Node value ULINT / Inputs/Outputs Name Type name STRING Sample call: obj Attribute := fb Xml. Append Attribute As Ulint(obj Machine, 'Name', 42); 5.2.1.7.9 Append Attribute Copy This method adds a new attribute to an existing node. The name and value of the new attribute are copied from an existing attribute. The existing attribute is transferred to the method as input parameter. Syntax METHOD Append Attribute Copy : SXml Attribute INPUT_VAR n : SXml Node; copy : SXml Attribute; END_VAR Return value Name Type Append Attribute Copy SXml Attribute Inputs Name Type n SXml Node copy SXml Attribute Sample call: 178 Version: 1.11.0 TF6760
## Page 179

PLC API xml New Attribute := fb Xml. Append Attribute Copy(xml Node, xml Existing Attribute); 5.2.1.7.10 Append Child This method inserts a new node below an existing node. The value of the new node is of the data type STRING. The name and the value of the new node as well as a reference to the existing node are transferred to the method as input parameters. The method returns a reference to the newly added node. The input parameter cdata indicates whether the value of the node is to be encapsulated in a CDATA function block, so that certain special characters such as "<" and ">" are allowed as values. Syntax METHOD Append Child : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; value : STRING; END_VAR VAR_INPUT cdata : BOOL; END_VAR Return value Name Type Append Child SXml Node Inputs Name Type n SXml Node cdata BOOL / Inputs/Outputs Name Type name STRING value STRING Sample call: xml New Node := fb Xml. Append Child(xml Existing, 'Controller', 'CX5120', FALSE); 5.2.1.7.11 Append Child As Bool This method inserts a new node below an existing node. The value of the new node has the data type Boolean. The name and value of the new node and a reference to the existing node are transferred to the method as input parameters. The method returns a reference to the newly added node. TF6760 Version: 1.11.0 179
## Page 180

PLC API Syntax METHOD Append Child As Bool : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : BOOL; END_VAR Return value Name Type Append Child As Bool SXml Node Inputs Name Type n SXml Node value BOOL / Inputs/Outputs Name Type name STRING Sample call: xml New Node := fb Xml. Append Child As Bool(xml Existing, 'Some Name', TRUE); 5.2.1.7.12 Append Child As Double This method inserts a new node below an existing node. The value of the new node has the data type Double. The name and value of the new node and a reference to the existing node are transferred to the method as input parameters. The method returns a reference to the newly added node. Syntax METHOD Append Child As Double : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : LREAL; END_VAR Return value Name Type Append Child As Double SXml Node 180 Version: 1.11.0 TF6760
## Page 181

PLC API Inputs Name Type n SXml Node value LREAL / Inputs/Outputs Name Type name STRING Sample call: xml New Node := fb Xml. Append Child As Double(xml Existing, 'Some Name', 42.42); 5.2.1.7.13 Append Child As Float This method inserts a new node below an existing node. The value of the new node has the data type Float. The name and value of the new node and a reference to the existing node are transferred to the method as input parameters. The method returns a reference to the newly added node. Syntax METHOD Append Child As Float : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : REAL; END_VAR Return value Name Type Append Child As Float SXml Node Inputs Name Type n SXml Node value REAL / Inputs/Outputs Name Type name STRING Sample call: xml New Node := fb Xml. Append Child As Float(xml Existing, 'Some Name', 42.42); TF6760 Version: 1.11.0 181
## Page 182

PLC API 5.2.1.7.14 Append Child As Int This method inserts a new node below an existing node. The value of the new node has the data type Integer. The name and value of the new node and a reference to the existing node are transferred to the method as input parameters. The method returns a reference to the newly added node. Syntax METHOD Append Child As Int : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : DINT; END_VAR Return value Name Type Append Child As Int SXml Node Inputs Name Type n SXml Node value DINT / Inputs/Outputs Name Type name STRING Sample call: xml New Node := fb Xml. Append Child As Int(xml Existing, 'Some Name', 42); 5.2.1.7.15 Append Child As Lint This method inserts a new node below an existing node. The value of the new node has the data type Integer64. The name and value of the new node and a reference to the existing node are transferred to the method as input parameters. The method returns a reference to the newly added node. Syntax METHOD Append Child As Lint : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR 182 Version: 1.11.0 TF6760
## Page 183

PLC API VAR_INPUT value : LINT; END_VAR Return value Name Type Append Child As Lint SXml Node Inputs Name Type n SXml Node value LINT / Inputs/Outputs Name Type name STRING Sample call: xml New Node := fb Xml. Append Child As Lint(xml Existing, 'Some Name', 42); 5.2.1.7.16 Append Child As Uint This method inserts a new node below an existing node. The value of the new node has the data type Unsigned Integer. The name and value of the new node and a reference to the existing node are transferred to the method as input parameters. The method returns a reference to the newly added node. Syntax METHOD Append Child As Uint : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : UDINT; END_VAR Return value Name Type Append Child As Uint SXml Node Inputs Name Type n SXml Node value UDINT TF6760 Version: 1.11.0 183
## Page 184

PLC API / Inputs/Outputs Name Type name STRING Sample call: xml New Node := fb Xml. Append Child As Uint(xml Existing, 'Some Name', 42); 5.2.1.7.17 Append Child As Ulint This method inserts a new node below an existing node. The value of the new node has the data type Unsigned Integer64. The name and value of the new node and a reference to the existing node are transferred to the method as input parameters. The method returns a reference to the newly added node. Syntax METHOD Append Child As Ulint : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR VAR_INPUT value : ULINT; END_VAR Return value Name Type Append Child As Ulint SXml Node Inputs Name Type n SXml Node value ULINT / Inputs/Outputs Name Type name STRING Sample call: xml New Node := fb Xml. Append Child As Ulint(xml Existing, 'Some Name', 42); 5.2.1.7.18 Append Copy 184 Version: 1.11.0 TF6760
## Page 185

PLC API This method inserts a new node below an existing node. The name and value of the new node are copied from an existing node. The references to the existing nodes are transferred to the method as input parameters. The method returns a reference to the newly added node. Syntax METHOD Append Copy : SXml Node VAR_INPUT n : SXml Node; copy : SXml Node; END_VAR Return value Name Type Append Copy SXml Node Inputs Name Type n SXml Node copy SXml Node Sample call: xml New Node := fb Xml. Append Copy(xml Parent Node, xml Existing Node); 5.2.1.7.19 Append Node This method adds a new node to an existing node. The existing node and the name of the new node are transferred to the method as input parameters. The method returns a reference to the newly added node. Syntax METHOD Append Node : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR Return value Name Type Append Node SXml Node Inputs Name Type n SXml Node / Inputs/Outputs Name Type name STRING TF6760 Version: 1.11.0 185
## Page 186

PLC API Sample call: obj Machines := fb Xml. Append Node(obj Root, 'Machines'); 5.2.1.7.20 Attributes This method can be used to read the attribute of a given XML node. The XML node and the name of the attribute are transferred to the method as input parameters. After the method has been called, further methods have to be called, for example to read the value of the attribute, e.g. Attribute As Int(). Syntax METHOD Attribute : SXml Attribute VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR Return value Name Type Attributes SXml Attribute Inputs Name Type n SXml Node / Inputs/Outputs Name Type name STRING Sample call: xml Machine1Attribute := fb Xml. Attribute(xml Machine1, 'Type'); 5.2.1.7.21 Attribute As Bool This method returns the value of an attribute as data type Boolean. The attribute is transferred to the method as input parameter. Syntax METHOD Attribute As Bool : BOOL VAR_INPUT a : SXml Attribute; END_VAR 186 Version: 1.11.0 TF6760
## Page 187

PLC API Return value Name Type Attribute As Bool BOOL Inputs Name Type a SXml Attribute Sample call: b Value := fb Xml. Attribute As Bool(xml Attr); 5.2.1.7.22 Attribute As Double This method returns the value of an attribute as data type Double. The attribute is transferred to the method as input parameter. Syntax METHOD Attribute As Double : LREAL VAR_INPUT a : SXml Attribute; END_VAR Return value Name Type Attribute As Double LREAL Inputs Name Type a SXml Attribute Sample call: lr Value := fb Xml. Attribute As Double(xml Attr); 5.2.1.7.23 Attribute As Float This method returns the value of an attribute as data type Float. The attribute is transferred to the method as input parameter. Syntax METHOD Attribute As Float: REAL VAR_INPUT a : SXml Attribute; END_VAR TF6760 Version: 1.11.0 187
## Page 188

PLC API Return value Name Type Attribute As Float REAL Inputs Name Type a SXml Attribute Sample call: r Value := fb Xml. Attribute As Float(xml Attr); 5.2.1.7.24 Attribute As Int This method returns the value of an attribute as a data type Integer. The attribute is transferred to the method as input parameter. Syntax METHOD Attribute As Int : DINT VAR_INPUT a : SXml Attribute; END_VAR Return value Name Type Attribute As Int DINT Inputs Name Type a SXml Attribute Sample call: n Value := fb Xml. Attribute As Int(xml Attr); 5.2.1.7.25 Attribute As Lint This method returns the value of an attribute as a data type Integer64. The attribute is transferred to the method as input parameter. Syntax METHOD Attribute As Lint : LINT VAR_INPUT a : SXml Attribute; END_VAR 188 Version: 1.11.0 TF6760
## Page 189

PLC API Return value Name Type Attribute As Lint LINT Inputs Name Type a SXml Attribute Sample call: n Value := fb Xml. Attribute As Lint(xml Attr); 5.2.1.7.26 Attribute As Uint This method returns the value of an attribute as data type Unsigned Integer. The attribute is transferred to the method as input parameter. Syntax METHOD Attribute As Uint : UDINT VAR_INPUT a : SXml Attribute; END_VAR Return value Name Type Attribute As Uint UDINT Inputs Name Type a SXml Attribute Sample call: n Value := fb Xml. Attribute As Uint(xml Attr); 5.2.1.7.27 Attribute As Ulint This method returns the value of an attribute as data type Unsigned Integer64. The attribute is transferred to the method as input parameter. Syntax METHOD Attribute As Ulint : ULINT VAR_INPUT a : SXml Attribute; END_VAR TF6760 Version: 1.11.0 189
## Page 190

PLC API Return value Name Type Attribute As Ulint ULINT Inputs Name Type a SXml Attribute Sample call: n Value := fb Xml. Attribute As Ulint(xml Attr); 5.2.1.7.28 Attribute Begin This method returns an iterator over all attributes of an XML node. The XML node is transferred to the method as input parameter. Syntax METHOD Attribute Begin : SXml Iterator VAR_INPUT n : SXml Node; END_VAR Return value Name Type Attribute Begin SXml Iterator Inputs Name Type n SXml Node Sample call: xml Iterator := fb Xml. Attribute Begin(xml Node); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Attr := fb Xml. Attribute From Iterator(xml Iterator); n Attr Value := fb Xml. Attribute As Int(xml Attr); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.29 Attribute From Iterator This method converts the current position of an iterator to an XML attribute object. The iterator is transferred to the method as input parameter. 190 Version: 1.11.0 TF6760
## Page 191

PLC API Syntax METHOD Attribute From Iterator : SXml Attribute VAR_INPUT it : SXml Iterator; END_VAR Return value Name Type Attribute From Iterator SXml Attribute Inputs Name Type it SXml Iterator Sample call: xml Iterator := fb Xml. Attribute Begin(xml Node); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Attr := fb Xml. Attribute From Iterator(xml Iterator); n Attr Value := fb Xml. Attribute As Int(xml Attr); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.30 Attribute Name This method returns the name of a given attribute. The attribute is transferred to the method as input parameter. Syntax METHOD Attribute Name : STRING VAR_INPUT a : SXml Attribute; END_VAR Return value Name Type Attribute Name STRING Inputs Name Type a SXml Attribute Sample call: s Name := fb Xml. Attribute Name(xml Attr); 5.2.1.7.31 Attributes TF6760 Version: 1.11.0 191
## Page 192

PLC API This method is used to navigate through the DOM and returns an iterator for all attributes found at an XML node. The iterator can then be used for further navigation through the elements that were found. The node and a reference to the iterator are transferred to the method as input parameters. Syntax METHOD Attributes : SXml Attribute VAR_INPUT n : SXml Node; it : REFERENCE TO SXml Iterator; END_VAR Return value Name Type Attributes SXml Attribute Inputs Name Type it REFERENCE TO SXml Iterator Sample call: xml Ret := fb Xml. Attributes(xml Node, xml Iterator); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Machine Attr Ref := fb Xml. Attribute(xml Iterator); xml Machine Attr Text := fb Xml. Attribute Text(xml Machine Attr Ref); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.32 Attribute Text This method returns the text of a given attribute. The attribute is transferred to the method as input parameter. Syntax METHOD Attribute Text : STRING(255) VAR_INPUT a : SXml Attribute; END_VAR Return value Name Type Attribute Text STRING(255) Inputs Name Type a SXml Attribute Sample call: s Text := fb Xml. Attribute Text(xml Attr); 192 Version: 1.11.0 TF6760
## Page 193

PLC API 5.2.1.7.33 Begin This method returns an iterator over all child elements of an XML node, always starting from the first child element. The XML node is transferred to the method as input parameter. Syntax METHOD Begin : SXml Iterator VAR_INPUT n : SXml Node; END_VAR Return value Name Type Begin SXml Iterator Inputs Name Type n SXml Node Sample call: xml Iterator := fb Xml. Begin(xml Node); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Node Ref := fb Xml. Node(xml Iterator); xml Node Value := fb Xml. Node Text(xml Node Ref); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.34 Begin By Name This method returns an iterator over all child elements of an XML node, starting at a particular element. The XML node is transferred to the method as input parameter. Syntax METHOD Begin By Name : SXml Iterator VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR Return value Name Type Begin By Name SXml Iterator TF6760 Version: 1.11.0 193
## Page 194

PLC API Inputs Name Type n SXml Node / Inputs/Outputs Name Type name STRING Sample call: xml Node := fb Xml. Child By Name(xml Doc, 'Machines'); xml Iterator := fb Xml. Begin By Name(xml Node, 'Name X'); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Node Ref := fb Xml. Node(xml Iterator); xml Node Value := fb Xml. Node Text(xml Node Ref); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.35 Child This method is used to navigate through the DOM. It returns a reference to the (first) child element of the current node. The start node is transferred to the method as input parameter. Syntax METHOD Child By Name : SXml Node VAR_INPUT n : SXml Node; END_VAR Return value Name Type Inputs Name Type n SXml Node Sample call: xml Child := fb Xml. Child(xml Node); 5.2.1.7.36 Child By Attribute This method is used to navigate through the DOM. It returns a reference to a child element in the XML document. The start node and the name and value of the attribute are transferred to the method as input parameters. 194 Version: 1.11.0 TF6760
## Page 195

PLC API Syntax METHOD Child By Attribute : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT attr : STRING; value : STRING; END_VAR Return value Name Type Child By Attribute SXml Node Inputs Name Type n SXml Node / Inputs/Outputs Name Type attr STRING value STRING Sample call: xml Machine1 := fb Xml. Child By Attribute(xml Machines, 'Type', '1'); 5.2.1.7.37 Child By Attribute And Name This method is used to navigate through the DOM. It returns a reference to a child element in the XML document. The start node, the name and value of the attribute, and the name of the child element are transferred to the method as input parameters. Syntax METHOD Child By Attribute And Name : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT attr : STRING; value : STRING; child : STRING; END_VAR Return value Name Type Child By Attribute And Name SXml Node TF6760 Version: 1.11.0 195
## Page 196

PLC API Inputs Name Type n SXml Node / Inputs/Outputs Name Type attr STRING value STRING child STRING Sample call: xml Machine2 := fb Xml. Child By Attribute And Name(xml Machines, 'Type', '2', 'Machine'); 5.2.1.7.38 Child By Name This method is used to navigate through the DOM. It returns a reference to a child element in the XML document. The start node and the name of the element to be returned are transferred to the method as input parameters. Syntax METHOD Child By Name : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR Return value Name Type Child By Name SXml Node Inputs Name Type n SXml Node / Inputs/Outputs Name Type name STRING Sample call: xml Machines := fb Xml. Child By Name(xml Doc, 'Machines'); 5.2.1.7.39 Children 196 Version: 1.11.0 TF6760
## Page 197

PLC API This method is used to navigate through the DOM. It returns an iterator for several child elements found in the XML document. The iterator can then be used for further navigation through the elements that were found. The start node and a reference to the iterator are transferred to the method as input parameters. Syntax METHOD Children : SXml Node VAR_INPUT n : SXml Node; it : REFERENCE TO SXml Iterator; END_VAR Return value Name Type Children SXml Node Inputs Name Type n SXml Node Sample call: xml Ret := fb Xml. Children(xml Node, xml Iterator); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Machine Node Ref := fb Xml. Node(xml Iterator); xml Machine Node Text := fb Xml. Node Text(xml Machine Node Ref); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.40 Children By Name This method is used to navigate through the DOM. It returns an iterator for several child elements found in the XML document. The iterator can then be used for further navigation through the elements that were found. The start node, the name of the child elements to be found and a reference to the iterator are transferred to the method as input parameters. Syntax METHOD Children By Name : SXml Node VAR_INPUT n : SXml Node; it : REFERENCE TO SXml Iterator; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR Return value Name Type Children By Name SXml Node Inputs Name Type n SXml Node it REFERENCE TO SXml Iterator TF6760 Version: 1.11.0 197
## Page 198

PLC API / Inputs/Outputs Name Type name STRING Sample call: xml Machine Node := fb Xml. Children By Name(xml Machines, xml Iterator, 'Machine'); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Machine Node Ref := fb Xml. Node(xml Iterator); xml Machine Node Text := fb Xml. Node Text(xml Machine Node Ref); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.41 Clear Iterator This method resets iterators that have already been used so that they can be used again the next time the program is run. Syntax METHOD Clear Iterator : BOOL VAR_INPUT it : SXml Iterator; END_VAR Return value Name Type Clear Iterator BOOL Inputs Name Type it SXml Iterator Sample call: b Result := fb Xml. Clear Iterator(xml It); Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4024.56 x86, x64, Arm® Tc3_Json Xml 3.4.5.0 5.2.1.7.42 Compare This method checks two iterators for equality. 198 Version: 1.11.0 TF6760
## Page 199

PLC API Syntax METHOD Compare : BOOL VAR_INPUT it1 : SXml Iterator; it2 : SXml Iterator; END_VAR Return value Name Type Compare BOOL Inputs Name Type It1 SXml Iterator It2 SXml Iterator Sample call: b Result := fb Xml. Compare(xml It1, xml It2); 5.2.1.7.43 Copy Attribute Text This method reads the value of an XML attribute and writes it to a variable of data type String. The XML attribute as well as the target variable and the length to be written are passed to the method as input parameters. The method returns the actual size. Syntax METHOD Copy Attribute Text : UDINT VAR_INPUT a : SXml Attribute; END_VAR VAR_IN_OUT CONSTANT s Xml : STRING; END_VAR VAR_INPUT n Xml : UDINT; END_VAR Return value Name Type Copy Attribute Text UDINT Inputs Name Type a SXml Attribute n Xml UDINT TF6760 Version: 1.11.0 199
## Page 200

PLC API / Inputs/Outputs Name Type s Xml STRING Sample call: n Length := fb Xml. Copy Attribute Text(xml Attr, s Target, SIZEOF(s Target)); 5.2.1.7.44 Copy Document This method copies the contents of the DOM memory into a variable of data type String. The length to be written and the variable into which the resulting string is to be written are passed to the method as input parameters. The method returns the actually written length. Note that the size of the string variable is at least equal to the size of the XML document in the DOM. Syntax METHOD Copy Document : UDINT VAR_IN_OUT CONSTANT s Xml : STRING; END_VAR VAR_INPUT n Xml : UDINT; END_VAR Return value Name Type Copy Document UDINT Inputs Name Type n Xml UDINT / Inputs/Outputs Name Type s Xml STRING Sample call: n Length := fb Xml. Copy Document(s Target, SIZEOF(s Target)); 5.2.1.7.45 Copy Node Text This method reads the value of an XML node and writes it to a variable of data type String. The XML node as well as the target variable and the length to be written are passed to the method as input parameters. The method returns the actual size. 200 Version: 1.11.0 TF6760
## Page 201

PLC API Syntax METHOD Copy Node Text : UDINT VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT s Xml : STRING; END_VAR VAR_INPUT n Xml : UDINT; END_VAR Return value Name Type Copy Node Text UDINT Inputs Name Type n SXml Node n Xml UDINT / Inputs/Outputs Name Type s Xml STRING Sample call: n Length := fb Xml. Copy Node Text(xml Node, s Target, SIZEOF(s Target)); 5.2.1.7.46 Copy Node Xml This method reads the XML structure of an XML node and writes it to a variable of data type String. The XML node as well as the target variable and the length to be written are passed to the method as input parameters. The method returns the actual size. Syntax METHOD Copy Node Xml : UDINT VAR_INPUT a : SXml Node; END_VAR VAR_IN_OUT CONSTANT s Xml : STRING; END_VAR VAR_INPUT n Xml : UDINT; END_VAR Return value Name Type Copy Node Xml UDINT TF6760 Version: 1.11.0 201
## Page 202

PLC API Inputs Name Type a SXml Node n Xml UDINT / Inputs/Outputs Name Type s Xml STRING Sample call: n Length := fb Xml. Copy Node Xml(xml Node, s Target, SIZEOF(s Target)); 5.2.1.7.47 First Node By Path This method navigates through an XML document using a path that was transferred to the method. The path and the start node are transferred to the method as input parameters. The path is specified with "/" as separator. The method returns a reference to the XML node that was found. Syntax METHOD First Node By Path : SXml Node VAR_INPUT n : SXml Node; path : STRING; END_VAR Return value Name Type First Node By Path SXml Node Inputs Name Type n SXml Node path STRING Sample call: xml Found Node := fb Xml. First Node By Path(xml Start Node, 'Level1/Level2/Level3'); 5.2.1.7.48 Get Attribute Text Length This method returns the length of the value of an XML attribute. The XML attribute is transferred to the method as input parameter. 202 Version: 1.11.0 TF6760
## Page 203

PLC API Syntax METHOD Get Attribute Text Length : UDINT VAR_INPUT a : SXml Attribute; END_VAR Return value Name Type Get Attribute Text Length UDINT Inputs Name Type a SXml Attribute Sample call: n Length := fb Xml. Get Attribute Text Length(xml Attr); 5.2.1.7.49 Get Document Length This method returns the length of an XML document in bytes. Syntax METHOD Get Document Length : UDINT Return value Name Type Get Document Length UDINT Sample call: n Length := fb Xml. Get Document Length(); 5.2.1.7.50 Get Document Node This method returns the root node of an XML document. This is not the same as the first XML node in the document (the method Get Root Node() should be used for this). The method can also be used to create an empty XML document in the DOM. Syntax METHOD Get Document Node : SXml Node Return value Name Type Get Document Node SXml Node Sample call: TF6760 Version: 1.11.0 203
## Page 204

PLC API obj Root := fb Xml. Get Document Node(); 5.2.1.7.51 Get Node Text Length This method returns the length of the value of an XML node. The XML node is transferred to the method as input parameter. Syntax METHOD Get Node Text Length : UDINT VAR_INPUT n : SXml Node; END_VAR Return value Name Type Get Node Text Length UDINT Inputs Name Type n SXml Node Sample call: n Length := fb Xml. Get Node Text Length(xml Node); 5.2.1.7.52 Get Node Xml Length This method returns the length of the XML structure of an XML node. The XML node is transferred to the method as input parameter. Syntax METHOD Get Node Xml Length : UDINT VAR_INPUT n : SXml Node; END_VAR Return value Name Type Get Node Xml Length UDINT Inputs Name Type n SXml Node Sample call: n Length := fb Xml. Get Node Xml Length(xml Node); 204 Version: 1.11.0 TF6760
## Page 205

PLC API 5.2.1.7.53 Get Root Node This method returns a reference to the first XML node in the XML document. Syntax METHOD Get Root Node : SXml Node Return value Name Type Get Root Node SXml Node Sample call: xml Root Node := fb Xml. Get Root Node(); 5.2.1.7.54 Insert Attribute Copy This method adds an attribute to an XML node. The name and value of an existing attribute are copied. The attribute can be placed at a specific position. The XML node, the position and a reference to the existing attribute object are transferred to the method as input parameters. The method returns a reference to the newly added attribute. Syntax METHOD Insert Attribute Copy : SXml Attribute VAR_INPUT n : SXml Node; before : SXml Attribute; copy : SXml Attribute; END_VAR Return value Name Type Insert Attribute Copy SXml Attribute Inputs Name Type n SXml Node before SXml Attribute copy SXml Attribute Sample call: xml New Attr := fb Xml. Insert Attribute Copy(xml Node, xml Before Attr, xml Copy Attr); TF6760 Version: 1.11.0 205
## Page 206

PLC API 5.2.1.7.55 Insert Attribute This method adds an attribute to an XML node. The attribute can be placed at a specific position. The XML node and the position and name of the new attribute are transferred to the method as input parameters. The method returns a reference to the newly added attribute. A value for the attribute can then be entered using the Set Attribute() method, for example. Syntax METHOD Insert Attribute : SXml Attribute VAR_INPUT n : SXml Node; before : SXml Attribute; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR Return value Name Type Insert Attribute SXml Attribute Inputs Name Type n SXml Node before SXml Attribute / Inputs/Outputs Name Type name STRING Sample call: xml New Attr := fb Xml. Insert Attribute(xml Node, xml Before Attr, 'Some Name'); 5.2.1.7.56 Insert Child This method adds a node to an existing XML node. The new node can be placed at a specific location. The existing XML node and the position and name of the new node are transferred to the method as input parameters. The method returns a reference to the newly added node. A value for the node can then be entered using the Set Child() method, for example. Syntax METHOD Insert Child : SXml Node VAR_INPUT n : SXml Node; before : SXml Node; END_VAR 206 Version: 1.11.0 TF6760
## Page 207

PLC API VAR_IN_OUT CONSTANT name : STRING; END_VAR Return value Name Type Insert Child SXml Node Inputs Name Type n SXml Node before SXml Attribute / Inputs/Outputs Name Type name STRING Sample call: xml New Node := fb Xml. Insert Child(xml Node, xml Before Node, 'Some Name'); 5.2.1.7.57 Insert Copy This method adds a new node to an existing XML node and copies an existing node. The new node can be placed anywhere in the existing node. The XML node, the position and a reference to the existing node object are transferred to the method as input parameters. The method returns a reference to the newly added node. Syntax METHOD Insert Copy : SXml Node VAR_INPUT n : SXml Node; before : SXml Node; copy : SXml Node; END_VAR Return value Name Type Insert Copy SXml Node Inputs Name Type n SXml Node before SXml Node copy SXml Node Sample call: xml New Node := fb Xml. Insert Copy(xml Node, xml Before Node, xml Copy Node); TF6760 Version: 1.11.0 207
## Page 208

PLC API 5.2.1.7.58 Is End This method checks whether a given XML iterator is at the end of the iteration that is to be performed. Syntax METHOD Is End : BOOL VAR_INPUT it : SXml Iterator; END_VAR Return value Name Type Is End BOOL Inputs Name Type nit SXml Iterator Sample call: xml Iterator := fb Xml. Begin(xml Node); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Node Ref := fb Xml. Node(xml Iterator); xml Node Value := fb Xml. Node Text(xml Node Ref); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.59 Load Document From File This method loads an XML document from a file. The absolute path to the file is transferred to the method as input parameter. A rising edge on the input parameter b Exec triggers the loading procedure. The asynchronous process is terminated as soon as the reference b Exec is set back to FALSE from the method. When the process ends, the return value of the method indicates whether the loading of the file was successful (TRUE) or failed (FALSE) for the duration of one call. Encoding Please note that the imported files must be formatted in UTF-8. Formats such as UTF-16 are not supported. Syntax METHOD Load Document From File : BOOL VAR_IN_OUT CONSTANT s File : STRING; END_VAR VAR_INPUT b Exec : REFERENCE TO BOOL; END_VAR VAR_OUTPUT hr Error Code: HRESULT; END_VAR 208 Version: 1.11.0 TF6760
## Page 209

PLC API Return value Name Type Load Document From File BOOL Inputs Name Type b Exec REFERENCE TO BOOL / Inputs/outputs Name Type s File STRING Outputs Name Type hr Error Code HRESULT Sample call: IF b Load THEN b Loaded := fb Xml. Load Document From File('C:\Test.xml', b Load); END_IF 5.2.1.7.60 New Document This method creates an empty XML document in the DOM memory. Syntax METHOD New Document : BOOL Return value Name Type New Document BOOL Sample call: fb Xml. New Document(); 5.2.1.7.61 Next This method sets an XML iterator for the next object that is to be processed. Syntax METHOD Next : SXml Iterator VAR_INPUT it : SXml Iterator; END_VAR TF6760 Version: 1.11.0 209
## Page 210

PLC API Return value Name Type Next SXml Iterator Inputs Name Type it SXml Iterator Sample call: xml Iterator := fb Xml. Begin(xml Node); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Node Ref := fb Xml. Node(xml Iterator); xml Node Value := fb Xml. Node Text(xml Node Ref); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.62 Next Attribute This method returns the next attribute for a given XML attribute. Syntax METHOD Next Attribute : SXml Attribute VAR_INPUT a : SXml Attribute; END_VAR Return value Name Type Next Attribute SXml Attribute Inputs Name Type a SXml Attribute Sample call: xml Next Attr := fb Xml. Next Attribute(xml Attr); 5.2.1.7.63 Next By Name This method sets an XML iterator for the next object that is to be processed, which is identified by its name. Syntax METHOD Next By Name : SXml Iterator VAR_INPUT it : SXml Iterator; END_VAR 210 Version: 1.11.0 TF6760
## Page 211

PLC API VAR_IN_OUT CONSTANT name : STRING; END_VAR Return value Name Type Next By Name SXml Iterator Inputs Name Type it SXml Iterator / Inputs/Outputs Name Type name STRING Sample call: xml Iterator := fb Xml. Begin(xml Node); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Node Ref := fb Xml. Node(xml Iterator); xml Node Value := fb Xml. Node Text(xml Node Ref); xml Iterator := fb Xml. Next By Name(xml Iterator, 'Some Name'); END_WHILE 5.2.1.7.64 Next Sibling This method returns the next direct node for a given XML node at the same XML level. Syntax METHOD Next Sibling : SXml Node VAR_INPUT n : SXml Node; END_VAR Return value Name Type Next Sibling SXml Node Inputs Name Type n SXml Node Sample call: xml Sibling := fb Xml. Next Sibling(xml Node); TF6760 Version: 1.11.0 211
## Page 212

PLC API 5.2.1.7.65 Next Sibling By Name This method returns the next direct node for a given XML node with a particular name at the same XML level. Syntax METHOD Next Sibling By Name : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR Return value Name Type Next Sibling By Name SXml Node Inputs Name Type n SXml Node / Inputs/Outputs Name Type name STRING Sample call: xml Sibling := fb Xml. Next Sibling By Name(xml Node, 'Some Name'); 5.2.1.7.66 Node This method is used in conjunction with an iterator to navigate through the DOM. The iterator is transferred to the method as input parameter. The method then returns the current XML node as return value. Syntax METHOD Node : SXml Node VAR_INPUT it : SXml Iterator; END_VAR Return value Name Type Node SXml Node 212 Version: 1.11.0 TF6760
## Page 213

PLC API Inputs Name Type it SXml Iterator Sample call: xml Machine Node := fb Xml. Children By Name(xml Machines, xml Iterator, 'Machine'); WHILE NOT fb Xml. Is End(xml Iterator) DO xml Machine Node := fb Xml. Node(xml Iterator); xml Machine Node Value := fb Xml. Node Text(xml Machine Node); xml Iterator := fb Xml. Next(xml Iterator); END_WHILE 5.2.1.7.67 Node As Bool This method returns the text of an XML node as data type Boolean. The XML node is transferred to the method as input parameter. Syntax METHOD Node As Bool : BOOL VAR_INPUT n : SXml Node; END_VAR Return value Name Type Node As Bool BOOL Inputs Name Type n SXml Node Sample call: b Xml Node:= fb Xml. Node As Bool(xml Machine1); 5.2.1.7.68 Node As Double This method returns the text of an XML node as data type Double. The XML node is transferred to the method as input parameter. Syntax METHOD Node As Double : LREAL VAR_INPUT n : SXml Node; END_VAR Return value Name Type Node As Double LREAL TF6760 Version: 1.11.0 213
## Page 214

PLC API Inputs Name Type n SXml Node Sample call: lr Xml Node:= fb Xml. Node As Double(xml Machine1); 5.2.1.7.69 Node As Float This method returns the text of an XML node as data type Float. The XML node is transferred to the method as input parameter. Syntax METHOD Node As Float : REAL VAR_INPUT n : SXml Node; END_VAR Return value Name Type Node As Float REAL Inputs Name Type n SXml Node Sample call: r Xml Node:= fb Xml. Node As Float(xml Machine1); 5.2.1.7.70 Node As Int This method returns the text of an XML node as a data type Integer. The XML node is transferred to the method as input parameter. Syntax METHOD Node As Int : DINT VAR_INPUT n : SXml Node; END_VAR Return value Name Type Node As Int DINT 214 Version: 1.11.0 TF6760
## Page 215

PLC API Inputs Name Type n SXml Node Sample call: n Xml Node:= fb Xml. Node As Int(xml Machine1); 5.2.1.7.71 Node As Lint This method returns the text of an XML node as a data type Integer64. The XML node is transferred to the method as input parameter. Syntax METHOD Node As Lint : LINT VAR_INPUT n : SXml Node; END_VAR Return value Name Type Node As Lint LINT Inputs Name Type n SXml Node Sample call: n Xml Node:= fb Xml. Node As Lint(xml Machine1); 5.2.1.7.72 Node As Uint This method returns the text of an XML node as data type Unsigned Integer. The XML node is transferred to the method as input parameter. Syntax METHOD Node As Uint : UDINT VAR_INPUT n : SXml Node; END_VAR Return value Name Type Node As Uint UDINT TF6760 Version: 1.11.0 215
## Page 216

PLC API Inputs Name Type n SXml Node Sample call: n Xml Node:= fb Xml. Node As Uint(xml Machine1); 5.2.1.7.73 Node As Ulint This method returns the text of an XML node as data type Unsigned Integer64. The XML node is transferred to the method as input parameter. Syntax METHOD Node As Ulint : ULINT VAR_INPUT n : SXml Node; END_VAR Return value Name Type Node As Ulint ULINT Inputs Name Type n SXml Node Sample call: n Xml Node:= fb Xml. Node As Ulint(xml Machine1); 5.2.1.7.74 Node Name This method returns the name of an XML node. A reference to the XML node is transferred to the method as input parameter. Syntax METHOD Node Name : STRING VAR_INPUT n : SXml Node; END_VAR Return value Name Type Node Name STRING 216 Version: 1.11.0 TF6760
## Page 217

PLC API Inputs Name Type n SXml Node Sample call: s Node Name := fb Xml. Node Name(xml Machine1); 5.2.1.7.75 Node Text This method returns the text of an XML node. The XML node is transferred to the method as input parameter. If the text of an XML node is longer than 255 characters, the method Copy Node Text [} 200] must be used. Syntax METHOD Node Text : STRING(255) VAR_INPUT n : SXml Node; END_VAR Return value Name Type Node Text STRING(255) Inputs Name Type n SXml Node Sample call: s Machine1Name := fb Xml. Node Text(xml Machine1); 5.2.1.7.76 Parse Document This method loads an XML document into the DOM memory for further processing. The XML document exists as a string and is transferred to the method as input parameter. A reference to the XML document in the DOM is returned to the caller. Syntax METHOD Parse Document : SXml Node VAR_IN_OUT CONSTANT s Xml : STRING; END_VAR Return value Name Type Parse Document SXml Node TF6760 Version: 1.11.0 217
## Page 218

PLC API / Inputs/Outputs Name Type s Xml STRING Sample call: xml Doc := fb Xml. Parse Document(s Xml To Parse); 5.2.1.7.77 Remove Child This method removes an XML child node from a given XML node. The two XML nodes are transferred to the method as input parameters. The method returns TRUE if the operation was successful and the XML node was removed. Syntax METHOD Remove Child : BOOL VAR_INPUT n : SXml Node; child : SXml Node; END_VAR Return value Name Type Remove Child BOOL Inputs Name Type n SXml Node child SXml Node Sample call: b Removed := fb Xml. Remove Child(xml Parent, xml Child); 5.2.1.7.78 Remove Child By Name This method removes an XML child node from a given XML node. The node to be removed is addressed by its name. If there is more than one child node, the last child node is removed. The method returns TRUE if the operation was successful and the XML node was removed. Syntax METHOD Remove Child By Name : BOOL VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT name : STRING; END_VAR 218 Version: 1.11.0 TF6760
## Page 219

PLC API Return value Name Type Remove Child By Name BOOL Inputs Name Type n SXml Node / Inputs/Outputs Name Type name STRING Sample call: b Removed := fb Xml. Remove Child By Name(xml Parent, 'Some Name'); 5.2.1.7.79 Save Document To File This method saves the current XML document in a file. The absolute path to the file is transferred to the method as input parameter. A rising edge at the input parameter b Exec triggers the saving procedure. The asynchronous process is terminated as soon as the reference b Exec is set back to FALSE from the method. When the process ends, the return value of the method indicates for one call whether saving of the file was successful (TRUE) or failed (FALSE). Syntax METHOD Save Document To File : BOOL VAR_IN_OUT CONSTANT s File : STRING; END_VAR VAR_INPUT b Exec : REFERENCE TO BOOL; END_VAR VAR_OUTPUT hr Error Code: HRESULT; END_VAR Return value Name Type Save Document To File BOOL Inputs Name Type b Exec REFERENCE TO BOOL / Inputs/Outputs Name Type s File STRING TF6760 Version: 1.11.0 219
## Page 220

PLC API Outputs Name Type hr Error Code HRESULT Sample call: IF b Save THEN b Saved = fb Xml. Save Document To File('C:\Test.xml', b Save); END_IF 5.2.1.7.80 Set Ads Provider Syntax METHOD Set Ads Provider : BOOL VAR_IN_OUT CONSTANT oid : OTCID; END_VAR Return value Name Type Set Ads Provider BOOL / Inputs/Outputs Name Type oid OTCID 5.2.1.7.81 Set Attribute This method sets the value of an attribute. The value has the data type String. Syntax METHOD Set Attribute : SXml Attribute VAR_INPUT a : SXml Attribute; END_VAR VAR_IN_OUT CONSTANT value : STRING; END_VAR Return value Name Type Set Attribute SXml Attribute Inputs Name Type a SXml Attribute 220 Version: 1.11.0 TF6760
## Page 221

PLC API / Inputs/Outputs Name Type value STRING Sample call: xml Attr := fb Xml. Set Attribute(xml Existing Attr, 'Test'); 5.2.1.7.82 Set Attribute As Bool This method sets the value of an attribute. The value has the data type Boolean. Syntax METHOD Set Attribute As Bool : SXml Attribute VAR_INPUT a : SXml Attribute; value : BOOL; END_VAR Return value Name Type Set Attribute As Bool SXml Attribute Inputs Name Type a SXml Attribute value BOOL Sample call: xml Attr := fb Xml. Set Attribute As Bool(xml Existing Attr, TRUE); 5.2.1.7.83 Set Attribute As Double This method sets the value of an attribute. The value here has the data type Double. Syntax METHOD Set Attribute As Double : SXml Attribute VAR_INPUT a : SXml Attribute; value : LREAL; END_VAR Return value Name Type Set Attribute As Double SXml Attribute TF6760 Version: 1.11.0 221
## Page 222

PLC API Inputs Name Type a SXml Attribute value LREAL Sample call: xml Attr := fb Xml. Set Attribute As Double(xml Existing Attr, 42.42); 5.2.1.7.84 Set Attribute As Float This method sets the value of an attribute. The value has the data type Float. Syntax METHOD Set Attribute As Float : SXml Attribute VAR_INPUT a : SXml Attribute; value : REAL; END_VAR Return value Name Type Set Attribute As Float SXml Attribute Inputs Name Type a SXml Attribute value REAL Sample call: xml Attr := fb Xml. Set Attribute As Float(xml Existing Attr, 42.42); 5.2.1.7.85 Set Attribute As Int This method sets the value of an attribute. The value has the data type Integer. Syntax METHOD Set Attribute As Int : SXml Attribute VAR_INPUT a : SXml Attribute; value : DINT; END_VAR Return value Name Type Set Attribute As Int SXml Attribute 222 Version: 1.11.0 TF6760
## Page 223

PLC API Inputs Name Type a SXml Attribute value DINT Sample call: xml Attr := fb Xml. Set Attribute As Int(xml Existing Attr, 42); 5.2.1.7.86 Set Attribute As Lint This method sets the value of an attribute. The value has the data type Integer64. Syntax METHOD Set Attribute As Lint : SXml Attribute VAR_INPUT a : SXml Attribute; value : LINT; END_VAR Return value Name Type Set Attribute As Lint SXml Attribute Inputs Name Type a SXml Attribute value LINT Sample call: xml Attr := fb Xml. Set Attribute As Lint(xml Existing Attr, 42); 5.2.1.7.87 Set Attribute As Uint This method sets the value of an attribute. The value has the data type Unsigned Integer. Syntax METHOD Set Attribute As Uint : SXml Attribute VAR_INPUT a : SXml Attribute; value : UDINT; END_VAR Return value Name Type Set Attribute As Uint SXml Attribute TF6760 Version: 1.11.0 223
## Page 224

PLC API Inputs Name Type a SXml Attribute value UDINT Sample call: xml Attr := fb Xml. Set Attribute As Uint(xml Existing Attr, 42); 5.2.1.7.88 Set Attribute As Ulint This method sets the value of an attribute. The value has the data type Unsigned Integer64. Syntax METHOD Set Attribute As Ulint : SXml Attribute VAR_INPUT a : SXml Attribute; value : ULINT; END_VAR Return value Name Type Set Attribute As Ulint SXml Attribute Inputs Name Type a SXml Attribute value ULINT Sample call: xml Attr := fb Xml. Set Attribute As Ulint(xml Existing Attr, 42); 5.2.1.7.89 Set Child This method sets the value of an XML node. The value is transferred to the method as input parameter of data type String. The input parameter cdata indicates whether the value of the node is to be encapsulated in a CDATA function block, so that certain special characters such as "<" and ">" are allowed as values. Syntax METHOD Set Child : SXml Node VAR_INPUT n : SXml Node; END_VAR VAR_IN_OUT CONSTANT value : STRING; END_VAR VAR_INPUT cdata : BOOL; END_VAR 224 Version: 1.11.0 TF6760
## Page 225

PLC API Return value Name Type Set Child SXml Node Inputs Name Type n SXml Node cdata BOOL / Inputs/Outputs Name Type value STRING Sample call: xml Node := fb Xml. Set Child(xml Existing Node, 'Some Text', FALSE); 5.2.1.7.90 Set Child As Bool This method sets the value of an XML node. The value is transferred to the method as input parameter of data type Boolean. Syntax METHOD Set Child As Bool : SXml Node VAR_INPUT n : SXml Node; value : BOOL; END_VAR Return value Name Type Set Child As Bool SXml Node Inputs Name Type n SXml Node value BOOL Sample call: xml Node := fb Xml. Set Child(xml Existing Node, TRUE); 5.2.1.7.91 Set Child As Double TF6760 Version: 1.11.0 225
## Page 226

PLC API This method sets the value of an XML node. The value is transferred to the method as input parameter of data type Double. Syntax METHOD Set Child As Double : SXml Node VAR_INPUT n : SXml Node; value : LREAL; END_VAR Return value Name Type Set Child As Double SXml Node Inputs Name Type n SXml Node value LREAL Sample call: xml Node := fb Xml. Set Child As Double(xml Existing Node, 42.42); 5.2.1.7.92 Set Child As Float This method sets the value of an XML node. The value is transferred to the method as input parameter of data type Float. Syntax METHOD Set Child As Float : SXml Node VAR_INPUT n : SXml Node; value : REAL; END_VAR Return value Name Type Set Child As Float SXml Node Inputs Name Type n SXml Node value REAL Sample call: xml Node := fb Xml. Set Child As Float(xml Existing Node, 42.42); 226 Version: 1.11.0 TF6760
## Page 227

PLC API 5.2.1.7.93 Set Child As Int This method sets the value of an XML node. The value is transferred to the method as input parameter of data type Integer. Syntax METHOD Set Child As Int : SXml Node VAR_INPUT n : SXml Node; value : DINT; END_VAR Return value Name Type Set Child As Int SXml Node Inputs Name Type n SXml Node value DINT Sample call: xml Node := fb Xml. Set Child As Int(xml Existing Node, 42); 5.2.1.7.94 Set Child As Lint This method sets the value of an XML node. The value is transferred to the method as input parameter of data type Integer64. Syntax METHOD Set Child As Lint : SXml Node VAR_INPUT n : SXml Node; value : LINT; END_VAR Return value Name Type Set Child As Lint SXml Node Inputs Name Type n SXml Node value LINT TF6760 Version: 1.11.0 227
## Page 228

PLC API Sample call: xml Node := fb Xml. Set Child As Lint(xml Existing Node, 42); 5.2.1.7.95 Set Child As Uint This method sets the value of an XML node. The value is transferred to the method as input parameter of data type Unsigned Integer. Syntax METHOD Set Child As Uint : SXml Node VAR_INPUT n : SXml Node; value : UDINT; END_VAR Return value Name Type Set Child As Uint SXml Node Inputs Name Type n SXml Node value UDINT Sample call: xml Node := fb Xml. Set Child As Uint(xml Existing Node, 42); 5.2.1.7.96 Set Child As Ulint This method sets the value of an XML node. The value is transferred to the method as input parameter of data type Unsigned Integer64. Syntax METHOD Set Child As Ulint : SXml Node VAR_INPUT n : SXml Node; value : ULINT; END_VAR Return value Name Type Set Child As Ulint SXml Node 228 Version: 1.11.0 TF6760
## Page 229

PLC API Inputs Name Type n SXml Node value ULINT Sample call: xml Node := fb Xml. Set Child As Ulint(xml Existing Node, 42); 5.2.1.8 FB_Jwt Encode The function block enables the creation and signing of a JSON Web Token (JWT). Syntax Definition: FUNCTION_BLOCK FB_Jwt Encode VAR_INPUT b Execute : BOOL; s Header Alg : STRING(46); s Payload : STRING(1023); s Key File Path : STRING(511); t Timeout : TIME; p Key : PVOID; n Key Size : UDINT; n Jwt Size : UDINT; END_VAR VAR_IN_OUT CONSTANT s Jwt : STRING; END_VAR VAR_OUTPUT b Busy : BOOL; b Error : BOOL; hr Error Code : HRESULT; init Status : HRESULT; END_VAR TF6760 Version: 1.11.0 229
## Page 230

PLC API Inputs Name Type Description b Execute BOOL A rising edge activates processing of the function block. s Header Alg STRING(46) The algorithm to be used for the JWT header, e.g. RS256. s Payload STRING(1023) The JWT payload to be used. s Key File Path STRING(511) Path to the private key to be used for the signature of the JWT. t Timeout TIME ADS timeout, which is used internally for file access to the private key. p Key PVOID Buffer for the private key to be read. n Key Size UDINT Maximum size of the buffer. s Jwt STRING Contains the fully coded and signed JWT after the function block has been processed. n Jwt Size UDINT Size of the generated JWT including zero termination. Outputs Name Type Description b Busy BOOL Is TRUE as long as processing of the function block is in progress. b Error BOOL Becomes TRUE as soon as an error situation occurs. hr Error Code HRESULT Returns an error code if the b Error output is set. An explanation of the possible error codes can be found in the Appendix. init Status HRESULT Returns an error code in case of a failed initialization of the function block. Requirements Twin CAT version Hardware Libraries to be integrated Twin CAT 3.1, Build 4024.4 x86, x64, Arm® Tc3_Json Xml 3.3.6.0 5.2.2 Interfaces 5.2.2.1 ITc Json Sax Handler 5.2.2.1.1 On Bool This callback method is triggered if a value of the data type BOOL was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Bool : HRESULT VAR_INPUT value : BOOL; END_VAR 5.2.2.1.2 On Dint This callback method is triggered if a value of the data type DINT was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. 230 Version: 1.11.0 TF6760
## Page 231

PLC API Syntax METHOD On Dint : HRESULT VAR_INPUT value : DINT; END_VAR 5.2.2.1.3 On End Array This callback method is triggered if a square closing bracket, which corresponds to the JSON synonym for an ending array, was found at the position of the SAX reader. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On End Array : HRESULT 5.2.2.1.4 On End Object This callback method is triggered if a curly closing bracket, which corresponds to the JSON synonym for an ending object, was found at the position of the SAX reader. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On End Object : HRESULT 5.2.2.1.5 On Key This callback method is triggered if a property was found at the position of the SAX reader. The property name lies on the input/output parameter key and its length on the input parameter len. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Key : HRESULT VAR_IN_OUT CONSTANT key : STRING; END_VAR VAR_INPUT len : UDINT; END_VAR 5.2.2.1.6 On Lint This callback method is triggered if a value of the data type LINT was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Lint : HRESULT VAR_INPUT value : LINT; END_VAR 5.2.2.1.7 On Lreal This callback method is triggered if a value of the data type LREAL was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. TF6760 Version: 1.11.0 231
## Page 232

PLC API Syntax METHOD On Lreal : HRESULT VAR_INPUT value : LREAL; END_VAR 5.2.2.1.8 On Null This callback method is triggered if a NULL value was found at the position of the SAX reader. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Null : HRESULT 5.2.2.1.9 On Start Array This callback method is triggered if a square opening bracket, which corresponds to the JSON synonym for a starting array, was found at the position of the SAX reader. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Start Array : HRESULT 5.2.2.1.10 On Start Object This callback method is triggered if a curly opening bracket, which corresponds to the JSON synonym for a starting object, was found at the position of the SAX reader. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Start Object : HRESULT 5.2.2.1.11 On String This callback method is triggered if a value of the data type STRING was found at the position of the SAX reader. The In/Out parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On String : HRESULT VAR_IN_OUT CONSTANT value : STRING; END_VAR VAR_INPUT len : UDINT; END_VAR 5.2.2.1.12 On Udint This callback method is triggered if a value of the data type UDINT was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Udint : HRESULT VAR_INPUT value : UDINT; END_VAR 232 Version: 1.11.0 TF6760
## Page 233

PLC API 5.2.2.1.13 On Ulint This callback method is triggered if a value of the data type ULINT was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Ulint : HRESULT VAR_INPUT value : ULINT; END_VAR 5.2.2.2 ITc Json Sax Values 5.2.2.2.1 On Bool Value This callback method is triggered if a value of the data type BOOL was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Bool Value : HRESULT VAR_INPUT level : UDINT; infos : POINTER TO Tc Json Level Info; value : BOOL; END_VAR 5.2.2.2.2 On Dint Value This callback method is triggered if a value of the data type DINT was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Dint Value : HRESULT VAR_INPUT level : UDINT; infos : POINTER TO Tc Json Level Info; value : DINT; END_VAR 5.2.2.2.3 On Lint Value This callback method is triggered if a value of the data type LINT was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Lint Value : HRESULT VAR_INPUT level : UDINT; infos : POINTER TO Tc Json Level Info; value : LINT; END_VAR 5.2.2.2.4 On Lreal Value This callback method is triggered if a value of the data type LREAL was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. TF6760 Version: 1.11.0 233
## Page 234

PLC API Syntax METHOD On Lreal Value : HRESULT VAR_INPUT level : UDINT; infos : POINTER TO Tc Json Level Info; value : LREAL; END_VAR 5.2.2.2.5 On Null Value This callback method is triggered if a NULL value was found at the position of the SAX reader. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Null : HRESULT VAR_INPUT level : UDINT; infos : POINTER TO Tc Json Level Info; END_VAR 5.2.2.2.6 On String Value This callback method is triggered if a value of the data type STRING was found at the position of the SAX reader. The input/output parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On String Value : HRESULT VAR_IN_OUT CONSTANT value : STRING; END_VAR VAR_INPUT len : UDINT; level : UDINT; infos : POINTER TO Tc Json Level Info; END_VAR 5.2.2.2.7 On Udint Value This callback method is triggered if a value of the data type UDINT was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Udint Value : HRESULT VAR_INPUT level : UDINT; infos : POINTER TO Tc Json Level Info; value : UDINT; END_VAR 5.2.2.2.8 On Ulint Value This callback method is triggered if a value of the data type ULINT was found at the position of the SAX reader. The input parameter value contains the value found. The SAX parsing procedure is aborted by setting the return value HRESULT to S_FALSE. Syntax METHOD On Ulint Value : HRESULT VAR_INPUT level : UDINT; infos : POINTER TO Tc Json Level Info; value : ULINT; END_VAR 234 Version: 1.11.0 TF6760
## Page 235

Samples 6 Samples 6.1 Iot Http Samples Each sample is provided as a separate PLC project. The following table shows a list of the available samples: Sample Short description Postman Echo Postman Echo is a test web service for REST clients. There are samples for HTTP GET, HTTP POST and HTPP PUT. There is also another HTTP GET sample with header authentication. Open Weather Map Open Weather Map is a REST API for querying weather data. In the sample, weather data is queried via HTTP GET in JSON format. Philips Hue Philips Hue is a smart home solution with a REST API. In the sample, values for a Hue lamp are changed using HTTP PUT. Telegram Telegram is a messenger with a REST API. In the sample, messages are sent from Twin CAT to a Telegram user via a so-called Telegram bot. AWS Io T AWS Io T is the cloud service from Amazon Web Services. The sample shows an HTTP GET to an AWS Io T Shadow and an HTTP POST to the AWS Io T Core Message Broker. AWS Service Configuration It is also possible to access various AWS services via HTTP. In this sample, an AWS service is accessed via HTTP GET. Sample code and configurations for this product can be obtained from the corresponding repository on Git Hub: https://github.com/Beckhoff/TF6760_Samples. There you have the option to clone the repository or download a ZIP file containing the sample. PLC projects are divided into a MAIN part and various function blocks. HTTP command-specific functions (GET, POST, PUT) are encapsulated in the named function blocks, in order to keep the program uncluttered. The MAIN part of each sample is used to configure the HTTP client function blocks. Once the client function blocks are configured, the various HTTP commands can be triggered from the MAIN part. The instantiated HTTP client function blocks are then passed through the various encapsulated function blocks. TF6760 Version: 1.11.0 235
## Page 236

Samples 6.1.1 Open Weather Map This sample illustrates the communication with an HTTPS/REST API. HTTPS GET requests are sent to obtain weather data from the Open Weather Map REST API. The response of the web service containing the data is in a JSON format. To send requests to the Open Weather Map REST API, the user must create an account for Open Weather Map to receive an application ID. In combination with a location identifier (e.g. latitude/ longitude, city ID, city name), the application ID can be used to query weather data. API documentation for various use cases (16-day forecast, current data etc.) can be found here: https:// openweathermap.org/api. 6.1.2 Postman Echo This part of the sample includes three HTTP commands (GET, POST, PUT) to communicate with Postman Echo, which is a test web service for REST clients. Additionally, there is also a sample for a GET request with header authentication. The Postman Echo API is designed specifically for developers to test HTTP functions. It offers many more possibilities than our sample shows. For example different authentication methods can be tested with Postman Echo. 6.1.3 AWS Io T This sample shows two different scenarios with AWS Io T. A GET request on an Io T Shadow and a POST request on the AWS Io T Core message broker are shown. The user is required to have an AWS account in order to have an Io T Core endpoint and the possibility to create certificates for the communication with Twin CAT. 6.1.4 Philips Hue This part of the sample includes a PUT request to a Philips Hue Bridge (required Twin CAT version: 3.1.4024.10). The Bridge's REST API enables Twin CAT users to control Philips Hue devices from the PLC. The user must have a Philips Hue Bridge available in his network and at least one device connected to it. Basically, the HTTP client, in this case Twin CAT, sends different values as a JSON document to the bridge (e.g. saturation, brightness, state and color value for a bulb). The bridge answers with another JSON document which shows if the commands have been successful. Within the setup process, the Philips Hue Bridge randomly generates a user name for a device that acts as HTTP client. This user name can then be used for the communication with the bridge. 236 Version: 1.11.0 TF6760
## Page 237

Samples Philips offers a “Getting started” tutorial here, which explains how to find the bridge in a network and how to implement a client application: https://developers.meethue.com/develop/get-started-2/ The API description can be found on the same website, but registration is required. The following sample implements on the one hand a single PUT request and on the other hand a toggling PUT request that is used for a so-called “Blinking mode”. This mode triggers a Philips Hue Go lamp to change the color (between 0 and 65000) every time the timer output is set. 6.1.5 Telegram This part of the sample includes a GET request to the REST API of the Telegram Messenger (required Twin CAT version: 3.1.4024.10). With the help of the so-called “Telegram-Bot”, a Twin CAT user can send messages to a specific telegram chat. The first step of establishing a connection is the creation of the “Telegram-Bot”. To do this, the user needs a Telegram account from which they can contact the Bot Father. The Bot Father is a generally available account for the creation of new bots. TF6760 Version: 1.11.0 237
## Page 238

Samples The Bot Father returns an API token that must be used when sending requests from Twin CAT to the Telegram API. With access to this token, a HTTP client can control every function that the bot delivers. A description of the BOT API can be found here: https://core.telegram.org/bots/api 238 Version: 1.11.0 TF6760
## Page 239

Samples The requests are basically structured according to the following scheme: https://api.telegram.org/bot<token>/METHOD_NAME Sending messages from a Twin CAT PLC to a Telegram Bot can proceed as shown in the following figure. In this sample, a message from the Telegram browser version to the bot is used to request the Chat ID. To do this, a message is first written to the bot's chat via the browser or the Telegram app. The Chat ID can then be determined using the get Updates method. Here, Postman is used as an example of an HTTP client: TF6760 Version: 1.11.0 239
## Page 240

Samples Using this Chat ID, the send Message method used in the sample can then be used to send chat messages from the Twin CAT program. 6.1.6 AWS Service Configuration This sample shows how to access services of the cloud provider Amazon Web Services (AWS) from the PLC using a GET request (required Twin CAT version: 3.1.4024.12). The REST API provides all the functionality that a user would have in the AWS management console. For example, virtual machines can be instantiated or configured using the AWS EC2 service. The chapter AWS Signature Version 4 [} 23] briefly outlines the background of the AWS signing function. For all other features please refer to the AWS documentation. As already described in the chapter URL redirects [} 23], the Io T driver does not evaluate URL redirection and forwarding. Therefore, when accessing the local endpoint of an AWS data center, the exact address must always be specified. Again referring to the EC2 services sample, this means that a user cannot connect from Twin CAT to ec2.amazonaws.com but must directly provide the region in the link: ec2.eu- central-1.amazonaws.com. A possible approach would be: fetch all available regions via a location-independent AWS REST API function and extract the region endpoint for the desired region from it. This would have the advantage over static programming of the endpoint that changes in the endpoint URL of a region would not result in changes in the program code. Alphabetical sorting required The request URL must be sorted alphabetically, ditto the signed header. In the case of the signed header, this is handled by the Io T driver; in the case of the request URL, it is the responsibility of the user, otherwise an error message will be issued by the HTTP server. 240 Version: 1.11.0 TF6760
## Page 241

Appendix 7 Appendix 7.1 ADS Return Codes Grouping of error codes: Global error codes: 0x0000 [} 241]... (0x9811_0000 ...) Router error codes: 0x500 [} 241]... (0x9811_0500 ...) General ADS errors: 0x700 [} 242]... (0x9811_0700 ...) RTime error codes: 0x1000 [} 244]... (0x9811_1000 ...) Global error codes Hex Dec HRESULT Name Description 0x0 0 0x98110000 ERR_NOERROR No error. 0x1 1 0x98110001 ERR_INTERNAL Internal error. 0x2 2 0x98110002 ERR_NORTIME No real time. 0x3 3 0x98110003 ERR_ALLOCLOCKEDMEM Allocation locked – memory error. 0x4 4 0x98110004 ERR_INSERTMAILBOX Mailbox full – the ADS message could not be sent. Reducing the number of ADS messages per cycle will help. 0x5 5 0x98110005 ERR_WRONGRECEIVEHMSG Wrong HMSG. 0x6 6 0x98110006 ERR_TARGETPORTNOTFOUND Target port not found – ADS server is not started, not reachable or not installed. 0x7 7 0x98110007 ERR_TARGETMACHINENOTFOUND Target computer not found – AMS route was not found. 0x8 8 0x98110008 ERR_UNKNOWNCMDID Unknown command ID. 0x9 9 0x98110009 ERR_BADTASKID Invalid task ID. 0x A 10 0x9811000A ERR_NOIO No IO. 0x B 11 0x9811000B ERR_UNKNOWNAMSCMD Unknown AMS command. 0x C 12 0x9811000C ERR_WIN32ERROR Win32 error. 0x D 13 0x9811000D ERR_PORTNOTCONNECTED Port not connected. 0x E 14 0x9811000E ERR_INVALIDAMSLENGTH Invalid AMS length. 0x F 15 0x9811000F ERR_INVALIDAMSNETID Invalid AMS Net ID. 0x10 16 0x98110010 ERR_LOWINSTLEVEL Installation level is too low –Twin CAT 2 license error. 0x11 17 0x98110011 ERR_NODEBUGINTAVAILABLE No debugging available. 0x12 18 0x98110012 ERR_PORTDISABLED Port disabled – Twin CAT system service not started. 0x13 19 0x98110013 ERR_PORTALREADYCONNECTED Port already connected. 0x14 20 0x98110014 ERR_AMSSYNC_W32ERROR AMS Sync Win32 error. 0x15 21 0x98110015 ERR_AMSSYNC_TIMEOUT AMS Sync Timeout. 0x16 22 0x98110016 ERR_AMSSYNC_AMSERROR AMS Sync error. 0x17 23 0x98110017 ERR_AMSSYNC_NOINDEXINMAP No index map for AMS Sync available. 0x18 24 0x98110018 ERR_INVALIDAMSPORT Invalid AMS port. 0x19 25 0x98110019 ERR_NOMEMORY No memory. 0x1A 26 0x9811001A ERR_TCPSEND TCP send error. 0x1B 27 0x9811001B ERR_HOSTUNREACHABLE Host unreachable. 0x1C 28 0x9811001C ERR_INVALIDAMSFRAGMENT Invalid AMS fragment. 0x1D 29 0x9811001D ERR_TLSSEND TLS send error – secure ADS connection failed. 0x1E 30 0x9811001E ERR_ACCESSDENIED Access denied – secure ADS access denied. Router error codes TF6760 Version: 1.11.0 241
## Page 242

Appendix Hex Dec HRESULT Name Description 0x500 1280 0x98110500 ROUTERERR_NOLOCKEDMEMORY Locked memory cannot be allocated. 0x501 1281 0x98110501 ROUTERERR_RESIZEMEMORY The router memory size could not be changed. 0x502 1282 0x98110502 ROUTERERR_MAILBOXFULL The mailbox has reached the maximum number of possible messages. 0x503 1283 0x98110503 ROUTERERR_DEBUGBOXFULL The Debug mailbox has reached the maximum number of possible messages. 0x504 1284 0x98110504 ROUTERERR_UNKNOWNPORTTYPE The port type is unknown. 0x505 1285 0x98110505 ROUTERERR_NOTINITIALIZED The router is not initialized. 0x506 1286 0x98110506 ROUTERERR_PORTALREADYINUSE The port number is already assigned. 0x507 1287 0x98110507 ROUTERERR_NOTREGISTERED The port is not registered. 0x508 1288 0x98110508 ROUTERERR_NOMOREQUEUES The maximum number of ports has been reached. 0x509 1289 0x98110509 ROUTERERR_INVALIDPORT The port is invalid. 0x50A 1290 0x9811050A ROUTERERR_NOTACTIVATED The router is not active. 0x50B 1291 0x9811050B ROUTERERR_FRAGMENTBOXFULL The mailbox has reached the maximum number for fragmented messages. 0x50C 1292 0x9811050C ROUTERERR_FRAGMENTTIMEOUT A fragment timeout has occurred. 0x50D 1293 0x9811050D ROUTERERR_TOBEREMOVED The port is removed. General ADS error codes 242 Version: 1.11.0 TF6760
## Page 243

Appendix Hex Dec HRESULT Name Description 0x700 1792 0x98110700 ADSERR_DEVICE_ERROR General device error. 0x701 1793 0x98110701 ADSERR_DEVICE_SRVNOTSUPP Service is not supported by the server. 0x702 1794 0x98110702 ADSERR_DEVICE_INVALIDGRP Invalid index group. 0x703 1795 0x98110703 ADSERR_DEVICE_INVALIDOFFSET Invalid index offset. 0x704 1796 0x98110704 ADSERR_DEVICE_INVALIDACCESS Reading or writing not permitted. Several causes are possible. For example, an incorrect password was entered when creating routes. 0x705 1797 0x98110705 ADSERR_DEVICE_INVALIDSIZE Parameter size not correct. 0x706 1798 0x98110706 ADSERR_DEVICE_INVALIDDATA Invalid data values. 0x707 1799 0x98110707 ADSERR_DEVICE_NOTREADY Device is not ready to operate. 0x708 1800 0x98110708 ADSERR_DEVICE_BUSY Device is busy. 0x709 1801 0x98110709 ADSERR_DEVICE_INVALIDCONTEXT Invalid operating system context. This can result from use of ADS blocks in different tasks. It may be possible to resolve this through multitasking synchronization in the PLC. 0x70A 1802 0x9811070A ADSERR_DEVICE_NOMEMORY Insufficient memory. 0x70B 1803 0x9811070B ADSERR_DEVICE_INVALIDPARM Invalid parameter values. 0x70C 1804 0x9811070C ADSERR_DEVICE_NOTFOUND Not found (files, ...). 0x70D 1805 0x9811070D ADSERR_DEVICE_SYNTAX Syntax error in file or command. 0x70E 1806 0x9811070E ADSERR_DEVICE_INCOMPATIBLE Objects do not match. 0x70F 1807 0x9811070F ADSERR_DEVICE_EXISTS Object already exists. 0x710 1808 0x98110710 ADSERR_DEVICE_SYMBOLNOTFOUND Symbol not found. 0x711 1809 0x98110711 ADSERR_DEVICE_SYMBOLVERSIONINVALID Invalid symbol version. This can occur due to an online change. Create a new handle. 0x712 1810 0x98110712 ADSERR_DEVICE_INVALIDSTATE Device (server) is in invalid state. 0x713 1811 0x98110713 ADSERR_DEVICE_TRANSMODENOTSUPP Ads Trans Mode not supported. 0x714 1812 0x98110714 ADSERR_DEVICE_NOTIFYHNDINVALID Notification handle is invalid. 0x715 1813 0x98110715 ADSERR_DEVICE_CLIENTUNKNOWN Notification client not registered. 0x716 1814 0x98110716 ADSERR_DEVICE_NOMOREHDLS No further handle available. 0x717 1815 0x98110717 ADSERR_DEVICE_INVALIDWATCHSIZE Notification size too large. 0x718 1816 0x98110718 ADSERR_DEVICE_NOTINIT Device not initialized. 0x719 1817 0x98110719 ADSERR_DEVICE_TIMEOUT Device has a timeout. 0x71A 1818 0x9811071A ADSERR_DEVICE_NOINTERFACE Interface query failed. 0x71B 1819 0x9811071B ADSERR_DEVICE_INVALIDINTERFACE Wrong interface requested. 0x71C 1820 0x9811071C ADSERR_DEVICE_INVALIDCLSID Class ID is invalid. 0x71D 1821 0x9811071D ADSERR_DEVICE_INVALIDOBJID Object ID is invalid. 0x71E 1822 0x9811071E ADSERR_DEVICE_PENDING Request pending. 0x71F 1823 0x9811071F ADSERR_DEVICE_ABORTED Request is aborted. 0x720 1824 0x98110720 ADSERR_DEVICE_WARNING Signal warning. 0x721 1825 0x98110721 ADSERR_DEVICE_INVALIDARRAYIDX Invalid array index. 0x722 1826 0x98110722 ADSERR_DEVICE_SYMBOLNOTACTIVE Symbol not active. 0x723 1827 0x98110723 ADSERR_DEVICE_ACCESSDENIED Access denied. Several causes are possible. For example, a unidirectional ADS route is used in the opposite direction. 0x724 1828 0x98110724 ADSERR_DEVICE_LICENSENOTFOUND Missing license. 0x725 1829 0x98110725 ADSERR_DEVICE_LICENSEEXPIRED License expired. 0x726 1830 0x98110726 ADSERR_DEVICE_LICENSEEXCEEDED License exceeded. 0x727 1831 0x98110727 ADSERR_DEVICE_LICENSEINVALID Invalid license. 0x728 1832 0x98110728 ADSERR_DEVICE_LICENSESYSTEMID License problem: System ID is invalid. 0x729 1833 0x98110729 ADSERR_DEVICE_LICENSENOTIMELIMIT License not limited in time. 0x72A 1834 0x9811072A ADSERR_DEVICE_LICENSEFUTUREISSUE Licensing problem: time in the future. 0x72B 1835 0x9811072B ADSERR_DEVICE_LICENSETIMETOLONG License period too long. 0x72C 1836 0x9811072C ADSERR_DEVICE_EXCEPTION Exception at system startup. 0x72D 1837 0x9811072D ADSERR_DEVICE_LICENSEDUPLICATED License file read twice. 0x72E 1838 0x9811072E ADSERR_DEVICE_SIGNATUREINVALID Invalid signature. 0x72F 1839 0x9811072F ADSERR_DEVICE_CERTIFICATEINVALID Invalid certificate. 0x730 1840 0x98110730 ADSERR_DEVICE_LICENSEOEMNOTFOUND Public key not known from OEM. 0x731 1841 0x98110731 ADSERR_DEVICE_LICENSERESTRICTED License not valid for this system ID. TF6760 Version: 1.11.0 243
## Page 244

Appendix Hex Dec HRESULT Name Description 0x732 1842 0x98110732 ADSERR_DEVICE_LICENSEDEMODENIED Demo license prohibited. 0x733 1843 0x98110733 ADSERR_DEVICE_INVALIDFNCID Invalid function ID. 0x734 1844 0x98110734 ADSERR_DEVICE_OUTOFRANGE Outside the valid range. 0x735 1845 0x98110735 ADSERR_DEVICE_INVALIDALIGNMENT Invalid alignment. 0x736 1846 0x98110736 ADSERR_DEVICE_LICENSEPLATFORM Invalid platform level. 0x737 1847 0x98110737 ADSERR_DEVICE_FORWARD_PL Context – forward to passive level. 0x738 1848 0x98110738 ADSERR_DEVICE_FORWARD_DL Context – forward to dispatch level. 0x739 1849 0x98110739 ADSERR_DEVICE_FORWARD_RT Context – forward to real-time. 0x740 1856 0x98110740 ADSERR_CLIENT_ERROR Client error. 0x741 1857 0x98110741 ADSERR_CLIENT_INVALIDPARM Service contains an invalid parameter. 0x742 1858 0x98110742 ADSERR_CLIENT_LISTEMPTY Polling list is empty. 0x743 1859 0x98110743 ADSERR_CLIENT_VARUSED Var connection already in use. 0x744 1860 0x98110744 ADSERR_CLIENT_DUPLINVOKEID The called ID is already in use. 0x745 1861 0x98110745 ADSERR_CLIENT_SYNCTIMEOUT Timeout has occurred – the remote terminal is not responding in the specified ADS timeout. The route setting of the remote terminal may be configured incorrectly. 0x746 1862 0x98110746 ADSERR_CLIENT_W32ERROR Error in Win32 subsystem. 0x747 1863 0x98110747 ADSERR_CLIENT_TIMEOUTINVALID Invalid client timeout value. 0x748 1864 0x98110748 ADSERR_CLIENT_PORTNOTOPEN Port not open. 0x749 1865 0x98110749 ADSERR_CLIENT_NOAMSADDR No AMS address. 0x750 1872 0x98110750 ADSERR_CLIENT_SYNCINTERNAL Internal error in Ads sync. 0x751 1873 0x98110751 ADSERR_CLIENT_ADDHASH Hash table overflow. 0x752 1874 0x98110752 ADSERR_CLIENT_REMOVEHASH Key not found in the table. 0x753 1875 0x98110753 ADSERR_CLIENT_NOMORESYM No symbols in the cache. 0x754 1876 0x98110754 ADSERR_CLIENT_SYNCRESINVALID Invalid response received. 0x755 1877 0x98110755 ADSERR_CLIENT_SYNCPORTLOCKED Sync Port is locked. 0x756 1878 0x98110756 ADSERR_CLIENT_REQUESTCANCELLED The request was canceled. RTime error codes Hex Dec HRESULT Name Description 0x1000 4096 0x98111000 RTERR_INTERNAL Internal error in the real-time system. 0x1001 4097 0x98111001 RTERR_BADTIMERPERIODS Timer value is not valid. 0x1002 4098 0x98111002 RTERR_INVALIDTASKPTR Task pointer has the invalid value 0 (zero). 0x1003 4099 0x98111003 RTERR_INVALIDSTACKPTR Stack pointer has the invalid value 0 (zero). 0x1004 4100 0x98111004 RTERR_PRIOEXISTS The request task priority is already assigned. 0x1005 4101 0x98111005 RTERR_NOMORETCB No free TCB (Task Control Block) available. The maximum number of TCBs is 64. 0x1006 4102 0x98111006 RTERR_NOMORESEMAS No free semaphores available. The maximum number of semaphores is 64. 0x1007 4103 0x98111007 RTERR_NOMOREQUEUES No free space available in the queue. The maximum number of positions in the queue is 64. 0x100D 4109 0x9811100D RTERR_EXTIRQALREADYDEF An external synchronization interrupt is already applied. 0x100E 4110 0x9811100E RTERR_EXTIRQNOTDEF No external sync interrupt applied. 0x100F 4111 0x9811100F RTERR_EXTIRQINSTALLFAILED Application of the external synchronization interrupt has failed. 0x1010 4112 0x98111010 RTERR_IRQLNOTLESSOREQUAL Call of a service function in the wrong context 0x1017 4119 0x98111017 RTERR_VMXNOTSUPPORTED Intel VT-x extension is not supported. 0x1018 4120 0x98111018 RTERR_VMXDISABLED Intel VT-x extension is not enabled in the BIOS. 0x1019 4121 0x98111019 RTERR_VMXCONTROLSMISSING Missing function in Intel VT-x extension. 0x101A 4122 0x9811101A RTERR_VMXENABLEFAILS Activation of Intel VT-x fails. Specific positive HRESULT Return Codes: 244 Version: 1.11.0 TF6760
## Page 245

Appendix HRESULT Name Description 0x0000_0000 S_OK No error. 0x0000_0001 S_FALSE No error. Example: successful processing, but with a negative or incomplete result. 0x0000_0203 S_PENDING No error. Example: successful processing, but no result is available yet. 0x0000_0256 S_WATCHDOG_TIMEOUT No error. Example: successful processing, but a timeout occurred. TCP Winsock error codes Hex Dec Name Description 0x274C 10060 WSAETIMEDOUT A connection timeout has occurred - error while establishing the connection, because the remote terminal did not respond properly after a certain period of time, or the established connection could not be maintained because the connected host did not respond. 0x274D 10061 WSAECONNREFUSED Connection refused - no connection could be established because the target computer has explicitly rejected it. This error usually results from an attempt to connect to a service that is inactive on the external host, that is, a service for which no server application is running. 0x2751 10065 WSAEHOSTUNREACH No route to host - a socket operation referred to an unavailable host. More Winsock error codes: Win32 error codes TF6760 Version: 1.11.0 245
## Page 246

Trademark statements Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Arm, Arm9 and Cortex are trademarks or registered trademarks of Arm Limited (or its subsidiaries or affiliates) in the US and/or elsewhere. Intel, the Intel logo, Intel Core, Xeon, Intel Atom, Celeron and Pentium are trademarks of Intel Corporation or its subsidiaries. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 247

More Information: www.beckhoff.com/TF6760/ Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
