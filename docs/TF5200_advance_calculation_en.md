---
title: "TF5200_advance_calculation_en"
product: "TF5200"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.25"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5200_advance_calculation_en.pdf"
release_date: "2024-07-09"
---
Functional description | EN TF5200 | Twin CAT 3 CNC Advanced calculation 7/9/2024 | Version: 1.25
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5200 | Twin CAT 3 CNC Version: 1.25 3 Advanced calculation
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.25 TF5200 | Twin CAT 3 CNC Advanced calculation
## Page 5

Table of contents Table of contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Description................................................................................................................................................ 9 3 Programming........................................................................................................................................... 11 4 Parameter................................................................................................................................................. 12 4.1 Overview......................................................................................................................................... 12 4.1.1 Start-up parameters......................................................................................................... 12 4.1.2 Channel parameter.......................................................................................................... 12 4.2 Description...................................................................................................................................... 12 4.2.1 Start-up parameters......................................................................................................... 12 4.2.2 Channel parameter.......................................................................................................... 13 4.3 CNC objects.................................................................................................................................... 14 4.3.1 Channel-specific CNC objects......................................................................................... 14 4.3.2 Axis-specific CNC objects................................................................................................ 15 4.4 HLI parameters............................................................................................................................... 16 5 Support and Service............................................................................................................................... 18 Index......................................................................................................................................................... 19 TF5200 | Twin CAT 3 CNC Version: 1.25 5 Advanced calculation
## Page 6

Table of contents 6 Version: 1.25 TF5200 | Twin CAT 3 CNC Advanced calculation
## Page 7

List of figures List of figures Fig. 1 Chronological sequence............................................................................................................... 9 TF5200 | Twin CAT 3 CNC Version: 1.25 7 Advanced calculation
## Page 8

Overview 1 Overview Task When it is used in particular in additive manufacturing, a predictive control of the applying unit may help to compensate for dead times within the system and so improve the machining result. This function is available as of CNC Build V3.1.3074.0. Properties Starting from the momentary point in time, the state at a specified future time is determined by a pre- calculation and then provided for use. This function is an additional option requiring a license. Parameterisation The function must be activated by P-STUP-00070. P-CHAN-00324 defines the point in time for the future state. Programming The points in time can also be defined by the NC command #CHANNEL SET[ESA_TIME<i>=…] [} 11]. Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. 8 Version: 1.25 TF5200 | Twin CAT 3 CNC Advanced calculation
## Page 9

Description 2 Description The precalculation of future data elements function provides users with a prediction of future date elements at a configurable future point in time starting from the present point in time. This function is activated by P-STUP-00070: configuration.channel[0].interpolator.function FCT_DEFAULT | FCT_CALC_STATE_AT_T Depending on the mode setting (P-CHAN-00325), the function permits the precalculation. Mode 1: Precalculation of path velocities at up to 10 future points in time Mode 2: In addition to the path velocities of Mode 1, the axis positions, velocities and accelerations of all axes located in the channel are precalculated in the first time entry. V 0:00 v1 0:05 v2 0:06 t Tnow time[0] time[1] Fig. 1: Chronological sequence Precalculation of path velocity The results for future path velocities can be read by CNC objects [} 14] (ESA pathfeed). Precalculation is limited to the look-ahead function. If no prediction is possible for path velocity planning (time offset too great), the value -1.0 is output. If the result -1 is output for future path velocity, no value could be calculated. Adapt the look-ahead buffer by P-STUP-00071 As of CNC Build V3.3104.08 future path velocities [} 17] can also be read over the HLI interface [} 16]. The data element esa_data_valid [} 17] indicates whether the future data element is valid. TF5200 | Twin CAT 3 CNC Version: 1.25 9 Advanced calculation
## Page 10

Description Precalculation of an axis state The results of these calculations are also contained in corresponding CHC objects to precalculate the axis position [} 15], velocity [} 15] or acceleration [} 15] of axes. Only the value of the first time entry is used to precalculate at axis level. The first time entry is defined by P-CHAN-00324 [} 13] (esa.time[0]) or by #CHANNEL SET [ESA_TIME0=…] [} 11]. As of CNC Build V3.3104.08 future axis states can also be read over the HLI interface [} 16]. The data element esa_data_valid [} 16] indicates whether the future data element is valid. Recommendation for look-ahead buffer Setting for the available look-ahead buffer (P-STUP-00071): configuration.channel[0].interpolator.number_blocks_lah 500 10 Version: 1.25 TF5200 | Twin CAT 3 CNC Advanced calculation
## Page 11

Programming 3 Programming The offset time can also be defined in the NC program by the following command as an alternative to configuration in the channel parameter list with P-CHAN-00324 [} 13]: Syntax: #CHANNEL SET [ ESA_TIME<i>=.. ] ESA_TIME<i>=<expr> Offset time i in [s] where i = 0 ... 9. 10 ESA times (Estimated State of Arrival) can be defined. Only time values greater than 0 are considered. Setting 3 ESA times #CHANNEL SET [ESA_TIME0=0.3 ESA_TIME1=0.5 ESA_TIME2= 0.8] TF5200 | Twin CAT 3 CNC Version: 1.25 11 Advanced calculation
## Page 12

Parameter 4 Parameter 4.1 Overview 4.1.1 Start-up parameters ID Parameter Description P-STUP-00070 configuration.channel[i] Define interpolator functionality .interpolator.function P-STUP-00071 configuration.channel[i] User-specific size of look-ahead buffer .interpolator.number_bl ocks_lah 4.1.2 Channel parameter ID Parameter Description P-CHAN-00324 esa.time[i] Precalculation - time offset P-CHAN-00325 esa.mode Precalculation - mode 4.2 Description 4.2.1 Start-up parameters P-STUP-00070 Definition of interpolator functionalities Description This parameter defines individual functionalities and the size of the look-ahead buffer in the interpolator, i.e. it defines the number of blocks to calculate deceleration distance and dynamic planning. Parameter configuration.channel[i].interpolator.function Data type STRING Data range See Interpolation function table. Dimension ---- Default value FCT_IPO_DEFAULT Remarks P-STUP-00071 User-specific size of look-ahead buffer Description This parameter permits the user-defined definition of the number of NC blocks in the look- ahead buffer. The parameter is only evaluated if P-STUP-00070 is set with FCT_LOOK_AHEAD_CUSTOM. Parameter configuration.channel[i].interpolator.number_blocks_lah * Data type UNS32 Data range 0 ... 10000 Dimension ---- Default value 120 Remarks As of Build V2.11.20 and higher, the default size of the look-ahead buffer is 70 blocks. As of Build V2.11.28 and higher, the default size is 120 blocks. As the size increases, the additional calculations make greater demands on the controller hardware. 12 Version: 1.25 TF5200 | Twin CAT 3 CNC Advanced calculation
## Page 13

Parameter As of Build V3.1.3067.07 the upper limit of the data range is 500 blocks. If #SLOPE[TYPE=STEP] is used, the upper limit is 10000 blocks as of Build V3.1.3060.0. * P-STUP-00071 in V2.11.20 and higher : configuration.channel[i].interpolator.parameter 4.2.2 Channel parameter P-CHAN-00324 Default offset time to calculate future states Description At a set time greater than 0, the • path velocity • attempts to calculate axis position, velocity and acceleration at the parameterised point in the future. Parameter esa.time[i] where i = 0 ... 9 Data type REAL64 Data range 0 ≤ time[i] ≤ MAX_REAL64 Dimension s Default value 0.0 Remarks The maximum possible number of entries is limited to 10. Axis position, velocity and acceleration only estimated with the entry esa.time[0]. P-CHAN-00325 Precalculation mode Description This parameter sets the precalculation mode. • Mode 1: Precalculation of path velocity at up to 10 future points in time • Mode 2: in addition to Mode 1, the precalculation of axis positions, velocities and accelerations of all the axes in the channel is conducted for the first time entry Parameter esa.mode Data type UNS32 Data range 1 / 2 Dimension ---- Default value 1 Remarks TF5200 | Twin CAT 3 CNC Version: 1.25 13 Advanced calculation
## Page 14

Parameter 4.3 CNC objects 4.3.1 Channel-specific CNC objects Name ESA: Active time [0] Description First configured time at which feedrate is detected. Task GEO (Port 551) Index group 0x12130<C > Index offset 0x112 ID Data type REAL64 Length 8 Attributes read Unit [s] Remarks Name ESA: Pathfeed [0] Description Calculated pathfeed at first configured point in time. Determining the point of time: P-CHAN-00324 [} 13] (esa.time[0] ) or #CHANNEL SET[ESA_TIME0 = <value>] [} 11] Task GEO (Port 551) Index group 0x12130<C > Index offset 0x113 ID Data type REAL64 Length 8 Attributes read Unit [µm/s] Remarks Additional points in time can be read similarly to the first point in time (Active time [0]/ ESA: Pathfeed [0]). Point in time i Offset ESA: Active time [i] Offset ESA: Pathfeed [i] 0 0x112 0x113 1 0x114 0x115 2 0x116 0x117 3 0x12b 0x12c 4 0x12d 0x12e 5 0x12f 0x130 6 0x131 0x132 7 0x133 0x134 8 0x135 0x136 9 0x137 0x138 Points in time can also be specified in analogy, either using P-CHAN-00324 [} 13] (esa.time[i] ) or #CHANNEL SET[ESA_TIME<i> = <value>] ] 14 Version: 1.25 TF5200 | Twin CAT 3 CNC Advanced calculation
## Page 15

Parameter 4.3.2 Axis-specific CNC objects Name ESA: position in future Description Predicted axis position at defined point in time. The point in time is defined by P-CHAN-00324 [} 13] (esa.time[0]) or by #CHANNEL SET [ESA_TIME0=<value>) [} 11] Task GEO (Port 551) Index group 0x12130<C > Index offset 0x<A >0087 ID ID Data type REAL64 Length 8 Attributes read Unit [0.1 µm or 0.0001°] Remarks Name ESA: velocity in future Description Predicted axis velocity at defined point in time. The point in time is defined by P-CHAN-00324 [} 13] (esa.time[0]) or by #CHANNEL SET [ESA_TIME0=<value>) [} 11] Task GEO (Port 551) Index group 0x12130<C > Index offset 0x<A >0088 ID ID Data type REAL64 Length 8 Attributes read Unit [1µm/s or 0.001°/s] Remarks Name ESA: acceleration in future Description Predicted axis acceleration at defined point in time. The point in time is defined by P-CHAN-00324 [} 13] (esa.time[0]) or by #CHANNEL SET [ESA_TIME0=<value>) [} 11] Task GEO (Port 551) Index group 0x12130<C > Index offset 0x<A >0089 ID ID Data type REAL64 Length 8 Attributes read Unit [mm/s^2 bzw. °/s^2] Remarks TF5200 | Twin CAT 3 CNC Version: 1.25 15 Advanced calculation
## Page 16

Parameter 4.4 HLI parameters Connection to the HLI interface is available as of CNC Build V3.3104.08. Precalculated axis-specific states Precalculated data is valid, axis Description This data element indicates whether precalculated axis data is valid. If the data element is TRUE, the values are valid for the precalculation of position [} 16], velocity [} 16] and acceleration [} 16] at a future point in time. FALSE indicates that no data could be calculated for the future point in time. The point in time is defined by the Index 0 in P-CHAN-00324 [} 13] or by #CHANNEL SET[ ESA_TIME0=...] [} 11]. Signal flow CNC →PLC ST Path gp Ax[axis_idx]^.ipo_state.esa_data_valid Data type BOOL Value range TRUE/FALSE Access PLC is reading Special feature Available as of Build V3.1.3104.08 Precalculated position, axis Description Axis position at a future point in time. The point in time is defined by the Index 0 in P-CHAN-00324 [} 13] or by #CHANNEL SET[ ESA_TIME0=...] [} 11]. Signal flow CNC →PLC ST Path gp Ax[axis_idx]^.ipo_state.esa_pos Data type LREAL Access PLC is reading Special feature Available as of Build V3.1.3104.08 Precalculated velocity, axis Description Axis velocity at a future point in time. The point in time is defined by the Index 0 in P-CHAN-00324 [} 13] or by #CHANNEL SET[ ESA_TIME0=...] [} 11]. Signal flow CNC →PLC ST Path gp Ax[axis_idx]^.ipo_state.esa_vel Data type LREAL Access PLC is reading Special feature Available as of Build V3.1.3104.08 Precalculated acceleration, axis Description Axis acceleration at a future point in time. The point in time is defined by the Index 0 in P-CHAN-00324 [} 13] or by #CHANNEL SET[ ESA_TIME0=...] [} 11]. Signal flow CNC →PLC ST Path gp Ax[axis_idx]^. ipo_state.esa_acc Data type LREAL Access PLC is reading 16 Version: 1.25 TF5200 | Twin CAT 3 CNC Advanced calculation
## Page 17

Parameter Special feature Available as of Build V3.1.3104.08 Precalculated axis-specific states Up to 3 precalculated velocities can be read by the HLI interface. Precalculated data is valid, path Description If a data element in the field is TRUE, path velocity was precalculated for a future point in time and is therefore valid. This is indicated by the same index as precalculated velocity [} 17]. FALSE indicates that no value could be calculated for the future point in time. Several points in time were defined by P-CHAN-00324 [} 13]. Times can also be defined by #CHANNEL SET[ESA_TIME<i>=…] [} 11]. Signal flow CNC →PLC ST Path gp Ch[channel_idx]^.bahn_state.esa_data_valid[ ] Data type ARRAY[0..2] OF BOOL Value range TRUE/FALSE Access PLC is reading Special feature Available as of Build V3.1.3104.08 Precalculated velocity, path Description Path velocity at a future point in time. Several points in time were defined by P-CHAN-00324 [} 13]. The index of a configured point in time corresponds with the index of the precalculated path velocity. Times can also be defined by #CHANNEL SET[ESA_TIME<i>=…] [} 11]. Signal flow CNC →PLC ST Path gp Ch[channel_idx]^.bahn_state.esa_vb[ ] Data type ARRAY[0..2] OF LREAL Access PLC is reading Special feature Available as of Build V3.1.3104.08 TF5200 | Twin CAT 3 CNC Version: 1.25 17 Advanced calculation
## Page 18

Support and Service 5 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 18 Version: 1.25 TF5200 | Twin CAT 3 CNC Advanced calculation
## Page 19

Index Index A Achse Vorabberechnung:Beschleunigung 16 Vorabberechnung:Geschwindigkeit 16 Vorabberechnung:Position 16 axis precalculated:valid 16 validity:precalculated 16 axis:validity code precalculated 16 B Beschleunigung Vorabberechnung 16 G Geschwindigkeit Vorabberechnung 16 P Path precalculated:valid 17 precalculated:velocity 17 validity:precalculated 17 path:validity code precalculated 17 P-CHAN-00324 13 P-CHAN-00325 13 Position Vorabberechnung 16 precalculated path:velocity 17 P-STUP-00070 12 P-STUP-00071 12 V Velocity precalculated 17 Vorabberechnung Achse:Beschleunigung 16 Achse:Geschwindigkeit 16 Achse:Position 16 TF5200 | Twin CAT 3 CNC Version: 1.25 19 Advanced calculation
## Page 21

More Information: www.beckhoff.com/TF5200 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
