---
title: "TF3500 Twin CAT 3"
product: "TF3500"
category: "Analytics"
tags: ["CAT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.3.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF3500_TC3_Analytics_Logger_EN.pdf"
release_date: "2025-07-21"
---
Manual | EN TF3500 Twin CAT 3 | Analytics Logger 2025-07-21 | Version: 1.3.0

## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation under Twin CAT 4026...................................................................................................... 9 3.3 Licensing........................................................................................................................................... 9 4 Analytics Workflow - First Steps........................................................................................................... 12 4.1 Recording data from the machine................................................................................................... 12 4.2 Communication............................................................................................................................... 15 4.3 Historicize data................................................................................................................................ 16 4.4 Analyse data................................................................................................................................... 23 4.5 24h Analytics application................................................................................................................. 28 5 Technical introduction............................................................................................................................ 37 5.1 Basic Concepts............................................................................................................................... 37 5.2 MQTT basics................................................................................................................................... 38 5.3 Data Compression.......................................................................................................................... 44 6 Configuration........................................................................................................................................... 45 6.1 Basic settings.................................................................................................................................. 45 6.1.1 TLS................................................................................................................................... 47 6.1.2 Timestamp correction....................................................................................................... 50 6.1.3 Device-specific information.............................................................................................. 52 6.2 Data Streams.................................................................................................................................. 53 6.2.1 Data Handling.................................................................................................................. 56 7 API............................................................................................................................................................ 59 7.1 PLC................................................................................................................................................. 59 7.1.1 Analytics Communication Library..................................................................................... 59 7.1.2 Obsolete........................................................................................................................... 82 7.2 Automation Interface....................................................................................................................... 83 8 Samples................................................................................................................................................... 84 9 Appendix.................................................................................................................................................. 85 9.1 FAQ - frequently asked questions and answers............................................................................. 85 10 Support and Service............................................................................................................................... 86 TF3500 Version: 1.3.0 3

## Page 4

Table of contents 4 Version: 1.3.0 TF3500

## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF3500 Version: 1.3.0 5

## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.3.0 TF3500

## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF3500 Version: 1.3.0 7

## Page 8

Overview 2 Overview The Twin CAT Analytics Logger records process and application data of the machine controller in synchronization with task cycles. The logger is characterized by its high performance as it operates directly in the real-time context of the Twin CAT controller. The Twin CAT Analytics Logger may either act as an MQTT client and transmit the data to a MQTT message broker on a regular basis (called MQTT-mode) or store the data locally in a file on the hard disk of the machine controller (called file-mode). The configuration required is performed in Microsoft Visual Studio®. All variables of the process image and the PLC application can be added easily to the configuration via check boxes without the need for programming. When used as an MQTT Client the Logger is able to bypass short disconnects to the Message Broker using a ring buffer functionality to prevent loss of data temporarily. Used in file-mode, a ring buffer can also be configured, which may be useful in case of limited storage capacity or if there is no need for data to be recorded (henceforth referred to as logged) permanently, instead focusing on a fixed time interval. The logged data may be used in various ways but its main intention is data analysis with Twin CAT Analytics as wells as data visualization with Twin CAT Scope. Components • Configuration surface in Twin CAT project tree • Description files Tc Analytics.tmc and Tc Iot Base.tmc • Drivers Tc Anayltics.sys and Tc Iot Drivers.sys List of key features Functionality Twin CAT 3 Analytics Logger Twin CAT 3 Analytics Logger as MQTT client for local storage Programable record control Yes Yes Configuration Interface Yes Yes RT Context Yes Yes MQTT Yes No Analytics Binary Format Yes Yes JSON Format No No File Storage No Yes Ring Buffer Yes Yes Authentication Yes No Encryption Yes Yes Compression Yes Yes 8 Version: 1.3.0 TF3500

## Page 9

Installation 3 Installation The Twin CAT Analytics Logger is installed on the Twin CAT Engineering system via a workload. Once configuration is complete, all necessary data is downloaded to the target system upon activation. No additional installation on the target system is necessary. To use the Analytics Logger, a “TC3 Analytics Logger” license is required for each target device. This can be either a perpetual license or a 7-day trial license. General information on installation and licensing can be found in the following subchapters. 3.1 System requirements Technical data TF3500 | Twin CAT 3 Analytics Logger Operating system Windows 10, Twin CAT/BSD, Beckhoff RT Linux® PC (x86, x64 and Arm®) Min. Twin CAT version 3.1.4022.31 Min. Twin CAT level TC1100 | Twin CAT 3 I/O 3.2 Installation under Twin CAT 4026 Twin CAT Package Manager If you are using Twin CAT 3.1 Build 4026 (and higher) on the Microsoft Windows operating system, you can install this function via the Twin CAT Package Manager, see Installation documentation. Normally you install the function via the corresponding workload; however, you can also install the packages contained in the workload individually. This documentation briefly describes the installation process via the workload. Command line program Tc Pkg You can use the Tc Pkg Command Line Interface (CLI) to display the available workloads on the system: tcpkg list TF3500 You can use the following command to install the workloads of the TF3500 Twin CAT 3 Analytics Logger function. tcpkg install TF3500. Analytics Logger. XAE tcpkg install TF3500. Analytics Logger. XAR Twin CAT Package Manager UI You can use the User Interface (UI) to display all available workloads and install them if required. To do this, follow the corresponding instructions in the interface. 3.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". TF3500 Version: 1.3.0 9

## Page 10

Installation Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 10 Version: 1.3.0 TF3500

## Page 11

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. TF3500 Version: 1.3.0 11

## Page 12

Analytics Workflow - First Steps 4 Analytics Workflow - First Steps This step by step documentation presents the complete Twin CAT Analytics workflow. From the data acquisition over the communication and historizing up to the evaluation and analysis of the data and to the presentation of the data in web-based dashboard. 4.1 Recording data from the machine On the machine side is the Analytics Logger the recorder of process data from the machine image, PLC, NC and so on. The Logger is working in the real-time context of Twin CAT. The Twin CAT Analytics Logger is installed with Twin CAT XAE and XAR. The Logger can act as MQTT Client to communicate the recorded data to a native MQTT Message Broker or store the data in the same data format in a local binary file. By the usage as MQTT Client the Logger is able to bypass short disconnects to the Message Broker with a ring buffer functionality. You can configure a ring buffer as well for the local binary file storage. • To configure the Analytics Logger you have to navigate in your existing Twin CAT Project to the Analytics tree node 12 Version: 1.3.0 TF3500

## Page 13

Analytics Workflow - First Steps • Right click on this node and click on “Add Data Logger” to add one new instance to your configuration • For configuring the base settings, please double click on the new tree item You can make your specific Analytics Logger settings -Data Format: Binary file or MQTT stream -FILE format: Analytics Logger stores the data in local binary files and all other settings are not necessary anymore. The files will be stored in C:\Twin CAT\3.1\Boot\Analytics. -BINARY: Data will be sent to the configured MQTT Message Broker. You can have multiple Logger in one Twin CAT project to communicate data to different MQTT Message Broker. -Data Compression: on (default) or off TF3500 Version: 1.3.0 13

## Page 14

Analytics Workflow - First Steps -Max Compression: mode of the compression -MQTT host name -MQTT Tcp port -MQTT main topic for own hierarchical levels to keep the identification easy -MQTT Client ID should be unique in the network -MQTT username -MQTT password to make authentication at the message broker -At the TLS (Transport Layer Security) tab, security settings can be configured. TLS is a secure communication channel between client and server. By the usage of certificates, the TCP port 8883 is exclusively reserved for MQTT over TLS. Analytics Logger is supporting the modes CA Certificates, CA Certificates & Client Certificate and Preshared Key (PSK) mode. • If variables in your PLC application are marked in the declaration with the attribute {attribute 'Tc Analytics'} they will be shown automatically as a stream below the Data Logger tree node. An additional device stream will be shown if your configuration provides an Ether CAT Process Image. 14 Version: 1.3.0 TF3500

## Page 15

Analytics Workflow - First Steps • In the stream a Selection tab is available to choose the variables that should be recorded • Finally it is possible to change the package size for the frames or to configure the ring buffer for disconnects and file in the Data Handling tab. 4.2 Communication Currently, the Analytics workflow is fully mappable via MQTT. The engineering tools can also access the data of the machines via ADS and carry out analyzes. TF3500 Version: 1.3.0 15

## Page 16

Analytics Workflow - First Steps If you choose for the Io T communication protocol MQTT you have to setup a native MQTT Message Broker somewhere in the network (VM in a cloud system is also possible). This Message Broker provides a decoupling of the different applications in the Analytics Workflow. 4.3 Historicize data After the Twin CAT Analytics Storage Provider has been installed, the service running in the background can be configured. You will find the Twin CAT Analytics. Storage Provider. Configurator application in the folder C: \Twin CAT\Functions\TF3520-Analytics-Storage Provider\Tools. 16 Version: 1.3.0 TF3500

## Page 17

Analytics Workflow - First Steps The main part of the topic can be defined in the configuration as well as the comment, which is used for identification if more than one Storage Provider is registered with the message broker. You can make the message broker settings and decide on a storage type: • Analytics File (binary file) • CSV file • Microsoft SQL (binary / plain text) • Inlfux DB (plain text) • Microsoft Azure Blob (Azure Cloud required) At last you can save the configuration and start the service. The next step is to configure the specific recording. For this you should select the Storage Provider Manager in your development environment. TF3500 Version: 1.3.0 17

## Page 18

Analytics Workflow - First Steps With the Storage Provider Recorder recording definitions can be created, started and managed. In addition, it is possible to manage the data memories of individual Analytics Storage Providers. All important properties of the found Analytics Storage Providers and historized data are clearly displayed. 18 Version: 1.3.0 TF3500

## Page 19

Analytics Workflow - First Steps Toolbar Manager window ("OVERVIEW") 1 Add new broker 2 Remove selected broker 3 Refresh display 4 Collapse all nodes 5 View switch between dark/light mode Function Manager window ("OVERVIEW") First assign a Recorder Alias. This helps to group the started recordings and to find its self started ones again. After that, one or more brokers can be set up. This is done via the already known input mask for MQTT connection properties. Once a connection to the broker could be established, all Analytics Storage Providers connected to it will be listed. "Storage" status TF3500 Version: 1.3.0 19

## Page 20

Analytics Workflow - First Steps 1 Storage Online 2 Storage Offline 3 Storage starts 4 Storage starts with error. Still trying to start it 5 Storage is shut down 6 Storage is in the error state Toolbar Manager window ("CONFIGURATIONS") 1 Create a new pipeline 2 Create a new pipeline with Rule Engine 3 Open Target Browser for connecting simple pipelines 4 Edit a selected pipeline 5 Delete a selected pipeline 6 Start a selected pipeline Function Manager window ("CONFIGURATIONS") The window is divided into two tabs. Pipelines and Live Status. Under Pipelines you will find the configurations of your pipelines. You can define new pipelines from here. Edit existing. Delete or start. To create a new simple pipeline, click the "Create new pipeline" button. The following dialog opens. 20 Version: 1.3.0 TF3500

## Page 21

Analytics Workflow - First Steps You can now drag and drop the symbols you want to record from the Target Browser into the dialog. You also assign a Recording Alias and a Record Name. Various placeholders are available for the Record Name: "{Auto ID}" "{Topic}" "{System ID}" "{Layout}" "{Cycle Time}" "{Sample Size}" "{Record Start}" You can also configure recording names and a duration (otherwise the recording will run endlessly until it is stopped manually). A ring buffer can be set according to storage space or time. The entries are confirmed with OK and a new local recording definition is created. It is now possible to start this definition directly via the toolbar or the context menu. However, it is also possible to make the definition globally accessible. This can be done via the context menu with the entry Publish Recording. The following dialog then opens: TF3500 Version: 1.3.0 21

## Page 22

Analytics Workflow - First Steps Here you can now select the desired Analytics Storage Provider via which the definition is to be published. In addition, the definition is assigned a Storage and a Data Broker of the selected Analytics Storage Provider. After the selection, the recording definition is confirmed with OK and published to the selected Analytics Storage Provider. This means that it can be found by any Storage Provider Manager that is connected to the MQTT Broker. After starting a pipeline, the view automatically jumps to the second tab, the Live Status. All active recordings from all users are listed here. The recordings can be ended in this tab and it is also possible to jump to the resulting record. Use historized data After and also during recording, you can select the historical data as input for your analysis in Target Browser. In the Target Browser, you will find a new control on the right side for the historical data. There you can select the timespan for your data. 22 Version: 1.3.0 TF3500

## Page 23

Analytics Workflow - First Steps 4.4 Analyse data ü Open your Twin CAT Engineering environment to start the data analysis. 1. Open Visual Studio® > File > New > Project… TF3500 Version: 1.3.0 23

## Page 24

Analytics Workflow - First Steps 2. Select the Analytics project template from Twin CAT Measurement. ð The new project is displayed in the Solution Explorer. After clicking the Analytics Project tree node element a start window opens where you can select your first action. From here you can add a network, open the Toolbox, open the Target Browser or open the Analytics Storage Provider Recorder. In the following steps you will perform all these actions. 24 Version: 1.3.0 TF3500

## Page 25

Analytics Workflow - First Steps 3. It makes sense to open the Toolbox of Visual Studio® first. There you will find all the algorithms supported by Twin CAT Analytics. Algorithms need to be grouped and organized into networks. Right- click Analytics Project to add a new network, or add a network using the start page. The first network is always generated by default. 4. When you click on the network, an editor opens. Now you can drag and drop the desired algorithm into the editor interface. 5. After selecting the algorithm, you need to connect input variables to the modules (algorithm). To do this, open the Target Browser. Twin CAT > Target Browser > Target Browser 6. Now select the Tc Analytics or Tc Analytics File tab in the Target Browser. Continue with the tab Tc Analytics (MQTT). TF3500 Version: 1.3.0 25

## Page 26

Analytics Workflow - First Steps 7. Click the icon highlighted in green in the toolbar of this Analytics extension. A window opens in which you can specify the connectivity data of your message broker. 8. Select your MQTT Analytics client (Twin CAT Analytics Logger, Twin CAT Io T Data Agent or Beckhoff EK9160). There is a unique ID for each control. This ID is displayed in the Target Browser. 9. Clicking on the gear icon, you will get to the Machine Administration page. Here you can assign a system alias name that will be displayed in the Target Browser instead of the ID. 10. In the next step, you can choose between live data and historical data for each MQTT Analytics client. In this case, the historical data is provided by the Twin CAT Analytics Storage Provider. 26 Version: 1.3.0 TF3500

## Page 27

Analytics Workflow - First Steps 11. You can drag and drop the variables into the inputs of the specific algorithm. In most algorithms, conditions such as thresholds, time intervals, logical operators etc. can be specified. These settings are made in the middle of each module. ð Finally, your first Analytics Project is complete. To start the analysis, click Start Analytics. To stop the analysis, click Stop Analytics. ð Before starting the analysis or during runtime, you can click the Add Reference Scope button. This will automatically create a Scope configuration that matches your Analytics project. TF3500 Version: 1.3.0 27

## Page 28

Analytics Workflow - First Steps ð The analysis results can be displayed in the Scope View graphs using drag-and-drop. For example, a mean value can be displayed as a new channel in the view. Timestamps as markers on the X-axes show significant values. 4.5 24h Analytics application The last major step in the Twin CAT Analytics workflow is the continuous 24-hour machine analysis. It runs in parallel with the machine applications in the field. To make this very easy, the Twin CAT Analytics Workbench can automatically generate PLC code and an HTML5-based dashboard of your Analytics configuration. Both can be downloaded into a Twin CAT Analytics Runtime (TC3 PLC and HMI Server) and provide the same analysis results as the configurator tool in the engineering environment. ü First, save your configuration and open the Analytics Deploy Runtime Wizard. This can be done from the context menu in the Analytics Project tree item or from the start page. 1. When the wizard is open, you can click through some tabs. The first one is called Solution. Here you can decide how your Analytics project should be used in the PLC code: As... completely new solution. 28 Version: 1.3.0 TF3500

## Page 29

Analytics Workflow - First Steps part of an existing solution. update of an existing Analytics solution. TF3500 Version: 1.3.0 29

## Page 30

Analytics Workflow - First Steps 2. In the Twin CAT PLC Target tab you can select the ADS target system that runs the Twin CAT Analytics Runtime (TF3550). The created project is immediately executable. For this purpose you can set the Activate PLC Runtime option. In addition, it can be selected that a boot project is created directly. 3. Especially for virtual machines, it is important to run the project on isolated cores, which is also an option in this tab. The next tab Results is needed only if you have selected the Stream Results option in the algorithm properties. If you want to send results, you can decide here in which way (locally in a file/ through MQTT) and which format (binary/JSON) this should be done. This is also generated automatically and executed immediately after activation. 30 Version: 1.3.0 TF3500

## Page 31

Analytics Workflow - First Steps Downsampling of the results is possible by specifying a cycle time. The next tab is for the HMI Dashboard. A prerequisite for the automatic generation of the dashboard is the selection of HMI Controls for the corresponding algorithms whose results are to be displayed in the dashboard. TF3500 Version: 1.3.0 31

## Page 32

Analytics Workflow - First Steps 4. You can choose different options for your Analytics Dashboard, such as a start page with a map, layouts, sorting algorithms, custom colors and logos. If you select multiple languages for the Analytics Controls, a language switching menu will also be generated. 32 Version: 1.3.0 TF3500

## Page 33

Analytics Workflow - First Steps 5. Select one of the installed versions of Visual Studio® and, whether the instance should start visibly or just be set up and activated in the background. TF3500 Version: 1.3.0 33

## Page 34

Analytics Workflow - First Steps ð At last you can find an overview. 34 Version: 1.3.0 TF3500

## Page 35

Analytics Workflow - First Steps 6. Now you can click the Deploy button to start the generation process. The PLC project and the HMI dashboard are now generated. TF3500 Version: 1.3.0 35

## Page 36

Analytics Workflow - First Steps ð After the "Deploy Runtime succeeded" message, you will find a new Visual Studio®/XAE shell instance on your desktop. The new Solution and both projects are created. 36 Version: 1.3.0 TF3500

## Page 37

Technical introduction 5 Technical introduction 5.1 Basic Concepts Variables and Datatypes There are several types of variables that can be logged. Variables that are part of: • PLC or NC process images • PLC programs • process images of devices e.g. an Ether CAT master and • data areas of generic Tc Com objects. Moreover, they may be of any datatype defined in IEC 61131 or the C++ standard in case of generic Tc Com- objects. Structured datatypes may recursively contain other structured datatypes and may be logged as a whole or partially. For more information on this topic, refer to the Configuration section. Operation modes This documentation makes use of the terminology and concepts described in the MQTT section. Please refer to that section for general information about the protocol. A key concept of Twin CAT Analytics are streams, which form the basic unit of transaction between a data source and a destination. One Data Logger can control several streams. A stream may comprise four components: • stream description • stream Tx-description • symbol info • and stream data. In MQTT-mode, Analytics participants coordinate by means of the first three components using an MQTT broker and a specific MQTT topic for each component. The topics are generally structured as illustrated in the following table, where <> brackets indicate variables as opposed to the other parts that are fixed. Component Topic structure Format Purpose Description <Main Topic>/<Stream Topic>/Descr JSON Provides information on whether a stream source is online or offline. Includes a timestamp for the information. Tx description <Main Topic>/<Stream Topic>/Bin/Tx/ JSON Provides information about the Descr transmission parameters when a stream source is actively transmitting data. Symbol info <Main Topic>/<Stream Topic>/Bin/Tx/ Binary Contains meta information about the Symbols variables i.e. excluding the actual value. Data <Main Topic>/<Stream Topic>/Bin/Tx/Data Binary Contains the plain variable values. The main topic is the only subtopic that can freely be set by the user. A stream can be started and stopped. A stream can be started by default via the System Manager configuration as soon as Twin CAT starts in Run Mode. Additionally, streams can be started and stopped from PLC code. Once connected to a broker, the Logger first sends the stream description. Then, as soon as the stream starts, it sends the Tx description and symbol info. This enables recipients to take all measures that are needed before data arrives. Finally, data is sent cyclically. TF3500 Version: 1.3.0 37

## Page 38

Technical introduction In File Mode, the Twin CAT Boot directory on the target device is used as a base for a dedicated Analytics directory, which in turn contains one subdirectory per stream as soon as the respective Twin CAT project has been activated. A specific .tas file in the stream directory contains the symbol information, while .tay files, which are created cyclically, contain the stream data. Relation of Logger and Streams One data logger can control several streams. As will be described more detailed in the Configuration section a user can add one or more data loggers to the Analytics configuration. Streams then are added automatically, depending on what variables are available to be logged. To understand how streams are assigned to a logger it is useful to understand that every stream has specific characteristics. One characteristic, the cycle time, comes from the fact that every variable that is acted upon cyclically is subject to a cyclic task; therefore, cycle times that underlie different variables can vary. Since a stream has a fixed cycle time by definition and to decouple tasks with the same cycle time, one stream is created for every task that drives relevant variables. Additionally, it is purposeful to further divide streams depending on the stream source, meaning the origin PLC instance or Tc Com object. This enables users to send variables of different sources to different MQTT topics and start/stop the transmission independently. Eventually it all comes down to the following scheme: For every stream source and every task that drives variables of that source, a stream is created. When configuring the data logger, there are configuration parameters that all streams have in common and those that are stream specific. The logger specifies the destination, the compression method, MQTT credentials etc. whereas e.g. the data size and start/stop-functionality are stream specific. In most cases it might not be necessary to send or write data every task cycle, so the data of a stream recorded in a cycle, a so-called sample, can be buffered before sending it to the broker or writing it to file. The number of samples in a buffer and thus the cycle time of a buffer being sent/written can be configured. Moreover, the number of buffers in a file and thus the file size can be configured. 5.2 MQTT basics MQTT (Message Queueing Telemetry Transport) is a publisher/subscriber-based communication protocol which enables message-based transfer between applications. The message broker is a central component of this transfer type. It distributes messages between the individual applications or the sender and receiver of a message. The message broker decouples the sender and receiver, so that it is not necessary for the sender and receiver to know and exchange each other's address information. During sending and receiving, all communication devices contact the message broker, which handles the distribution of the messages. 38 Version: 1.3.0 TF3500

## Page 39

Technical introduction Client ID When establishing a connection with the message broker, the client transmits a Client ID, which is used to uniquely identify the client on the message broker. The MQTT communication driver from Twin CAT 3 automatically generates its own Client ID, which is based on the following naming scheme: Plc Project Name-Tc Mqtt Client%n %n is an incremental counter for the number of the respective MQTT client instance. Each instance of the FB_Iot Mqtt Client function block increments this counter. In most cases, using this Client ID format is sufficient. In special cases, e.g. depending on the message broker or also due to the own MQTT application, an application-specific Client ID must be assigned. This can be done via a corresponding input at the FB_Iot Mqtt Client and FB_Iot Mqtt5Client function blocks. If a unique Client ID is to be generated automatically at the start of the PLC project, the use of a GUID is recommended, which can be generated via the FB_Create Guid function block from the Tc2_System library. The following sample code illustrates the use of this function block. PROGRAM MAIN VAR fb Guid : FB_Create GUID; obj Guid : GUID; s Guid : STRING; n State : UINT; b Start : BOOL; // set to TRUE to start this sample END_VAR CASE n State OF 0 : IF b Start THEN b Start := FALSE; n State := n State + 1; END_IF 1 : // create GUID using FB_Create Guid from Tc2_System library fb Guid(b Execute := TRUE, p Guid Buffer := ADR(obj Guid), n Guid Buffer Size := SIZEOF(obj Guid)); IF NOT fb Guid.b Busy THEN fb Guid(b Execute := FALSE); TF3500 Version: 1.3.0 39

## Page 40

Technical introduction IF NOT fb Guid.b Error THEN n State := n State + 1; ELSE n State := 255; // go to error state END_IF END_IF 2: // GUID has been created, now convert to STRING s Guid := GUID_TO_STRING(obj Guid); n State := n State + 1; 3: // done 255: // error state END_CASE After execution of this State Machine, the variable s Guid contains the generated GUID as STRING. This can then be used at the FB_Iot Mqtt Client and FB_Iot Mqtt5Client function blocks as Client ID. Payload The content of an MQTT message is referred to as payload. Data of any type can be transferred, e.g. text, individual numerical values or a whole information structure. Message payload formatting Note that the data type and the formatting of the content must be known to the sender and receiver side, particularly when binary information (alignment) or strings (with or without zero termination) are sent. Topics If a message broker is used that is based on the MQTT protocol, sending (publish mode) and subscribing (subscribe mode) of messages is organized with the aid of so-called topics. The message broker filters incoming messages based on these topics for each connected client. A topic may consist of several levels; the individual levels are separated by “/”. Example: Campus / Building1 / Floor2 / Room3 / Temperature When a publisher sends a message, it always specifies for which topic it is intended. A subscriber indicates which topic it is interested in. The message broker forwards the message accordingly. 40 Version: 1.3.0 TF3500

## Page 41

Technical introduction Communication example 1 from the diagram above: • An application subscribes to “topic1”. • A controller publishes a message to “topic1”. • The message broker forwards the message to the application accordingly. Communication example 2 from the diagram above: • A controller subscribes to “topic2”. • An application publishes a message to “topic2”. • The message broker forwards the message to the controller accordingly. Wildcards It is possible to use wildcards in conjunction with topics. A wildcard is used to represent part of the topic. In this case a subscriber may receive messages from several topics. A distinction is made between two types of wildcards: • Single-level wildcards • Multi-level wildcards Example for single-level wildcard: The + symbol describes a single-level wildcard. If it is used by the subscriber as described below, for example, corresponding messages to the topics are either received by the subscriber or not. • The receiver subscribes to Campus/Building1/Floor2/+/Temperature • The publisher sends to Campus/Building1/Floor2/Room1/Temperature - OK • The publisher sends to Campus/Building1/Floor2/Room2/Temperature - OK • The publisher sends to Campus/Building42/Floor1/Room1/Temperature - NOK • The publisher sends to Campus/Building1/Floor2/Room1/Fridge/Temperature - NOK Example for multi-level wildcard: TF3500 Version: 1.3.0 41

## Page 42

Technical introduction The # symbol describes a multi-level wildcard. If it is used by the subscriber as described below, for example, corresponding messages to the topics are either received by the subscriber or not. The # symbol must always be the last symbol in a topic string. • The receiver subscribes to Campus/Building1/Floor2/# • The publisher sends to Campus/Building1/Floor2/Room1/Temperature - OK • The publisher sends to Campus/Building1/Floor2/Room2/Temperature - OK • The publisher sends to Campus/Building42/Floor1/Room1/Temperature - NOK • The publisher sends to Campus/Building1/Floor2/Room1/Fridge/Temperature - OK • The publisher sends to Campus/Building1/Floor2/Room1/Humidity - OK Qo S (Quality of Service) Qo S is an arrangement between the sender and receiver of a message with regard to guaranteeing of the message transfer. MQTT features three different levels: • 0 – not more than once • 1 – at least once • 2 – exactly once Both types of communication (publish/subscribe) with the message broker must be taken into account and considered separately. The Qo S level that a client uses for publishing a message is set by the respective client. When the broker forwards the message to client that has subscribed to the topic, the subscriber uses the Qo S level that was specified when the subscription was established. This means that a Qo S level that may have been specified as 2 by the publisher can be “overwritten” with 0 by the subscriber. Qo S-Level 0 At this Qo S level the receiver does not acknowledge receipt. The message is not sent a second time. Qo S-Level 1 At this Qo S level the system guarantees that the message arrives at the receiver at least once, although the message may arrive more than once. The sender stores the message internally until it has received an acknowledgement from the receiver in the form of a PUBACK message. If the PUBACK message fails to arrive within a certain time, the message is resent. 42 Version: 1.3.0 TF3500

## Page 43

Technical introduction Qo S-Level 2 At this Qo S level the system guarantees that the message arrives at the receiver no more than once. On the MQTT side this is realized through a handshake mechanism. Qo S level 2 is the safest level (from a message transfer perspective), but also the slowest. When a receiver receives a message with Qo S level 2, it acknowledges the message with a PUBREC. The sender of the message remembers it internally until it has received a PUBCOMP. This additional handshake (compared with Qo S 1) is important for avoiding duplicate transfer of the message. Once the sender of the message receives a PUBREC, it can discard the initial publish information, since it knows that the message was received once by the receiver. In other words, it remembers the PUBREC internally and sends a PUBREL. Once the receiver has received a PUBREL, it can discard the previously remembered states and respond with a PUBCOMP, and vice versa. Whenever a package is lost, the respective communication device is responsible for resending the last message after a certain time. The Last Will is a message sent by the broker to all clients subscribed to the matching topic in the event of an abnormal connection failure. If the MQTT client in the PLC loses the connection to the broker and a Last Will was stored when the connection was established, this Last Will is communicated by the broker without the client having to do it. In the event of a planned disconnect, the Last Will is not necessarily transmitted according to the specification. From the PLC programmer's point of view, he can decide whether he wants to publish the Last Will before calling the disconnect. To this end, the Last Will message is published again on the Last Will topic. This is necessary because the broker would not publish the Last Will message due to the regular disconnection. In the event of a Twin CAT context change and a resulting restart of the MQTT communication, the Io T driver sends the previously specified Last Will to the broker, because at this point, doing this from the PLC is not an option. If no Last Will was defined when the connection was established, no message will be transmitted before the disconnect. Safety When a connection to the message broker is established, security mechanisms such as TLS can be used to encrypt the communication connection or to execute authentication between client and message broker. TF3500 Version: 1.3.0 43

## Page 44

Technical introduction Sources For further and more detailed information about MQTT, we recommend the following sites: Hive Mq Blog: http://www.hivemq.com/blog/mqtt-essentials/ (the main basis for this article) 5.3 Data Compression In order to reduce the amount of data to be sent without reducing the amount of information and thus enhance the performance, a compression method derived from the Run Length Encoding method can be used. It utilizes the fact, that data of two consecutive samples in a buffer may not vary in parts. Thus knowing what parts of a previously sent buffer are equal in conjunction with the varying data, a recipient can reconstruct the next buffer without the need to receive the whole buffer. After sending the first buffer uncompressed, the logger constructs the compressed buffer by comparing user-specified units of data (e.g. every byte, every 8 byte etc.) one after another. The logger counts the amount of data units (called Compression Compare Width) that are equal and places this information in the buffer instead of the data. Dependent on the kind of data this can lead to a data saving or overhead. To decide whether a compression is purposeful or not the user is provided with a data compression saving value, which can be found on the Online-tab of every stream dialog window. A positive value indicates saving and a negative value indicates overhead. 44 Version: 1.3.0 TF3500

## Page 45

Configuration 6 Configuration 6.1 Basic settings To configure the Twin CAT Analytics Logger the user is provided with a dedicated Analytics configuration inside of a XAE project. To add a data logger choose the respective item in the context menu of this configuration node. TF3500 Version: 1.3.0 45

## Page 46

Configuration This may either result in the additional Data Logger node alone or subordinate stream nodes in case there already are variables that can be logged. By double clicking the new Data Logger node the editor window will be open. In the Parameter tab you can make your specific Analytics Logger settings. 46 Version: 1.3.0 TF3500

## Page 47

Configuration • Data Format: Here the user can choose between IOT_FORMAT_FILE and IOT_FORMAT_BINARY. By using the FILE format the Analytics Logger stores the data in local binary files. The files will be stored in C:\Twin CAT\3.1\Boot\Analytics. By using MQTT_BINARY the data will send to the configured MQTT Message Broker. • Data Compression: Data compression can be switched on and off here. • Max. Compression Compare Width: Sets the compression mode. • MQTT Host Name: Provide here the host name or IP address of your native MQTT Message Broker. • MQTT Tcp Port: Set the Tcp port for the communication here. Default MQTT port: 1883 • MQTT Main Topic: It is possible to provide an own and individual main topic. Sample: Beckhoff/Verl/ Production/Drives/Machine5 – the Analytics Logger will add automatically his own specific subtopics: Beckhoff/Verl/Production/Drives/Machine5/Bin/Tx/Data • MQTT Client ID: The client identifier is an identifier of each MQTT client connecting to a native MQTT Message Broker. It should be unique per Broker. • MQTT User Name: MQTT allows to send a username for authenticating the client. • MQTT Password: MQTT also allows to send a password for authenticating the client and authorization. It is possible to have multiple Logger in one Twin CAT project to communicate data to different MQTT Message Broker or to have partly a storage in a local binary file. 6.1.1 TLS TLS (Transport Layer Security) provide a secure communication channel between a client and a server. At its core, TLS is cryptographic protocols which use a handshake mechanism to negotiate various parameters to create a secure connection between the client and the server. The Twin CAT Analytics Logger is supporting TLS version 1.2. MQTT communication with TLS By the usage of certificates the TCP port 8883 is exclusively reserved for MQTT over TLS! On the TLS tab of the Data Logger your first choice is the TLS Mode in a drop down box. Depending on the Message Broker it is possible to use different TLS mechanism/modes. The Analytics Logger is supporting the modes CA Certificates, CA Certificates & Client Certificate and the Preshared Key (PSK) mode. TF3500 Version: 1.3.0 47

## Page 48

Configuration CA Certificate Encryption and authentication via TLS can also be accomplished through a certificate authority (CA). The CA provides a signature via the public key for all communication clients. In this case an MQTT client connect to a Message Broker without a dedicated client certificate. 48 Version: 1.3.0 TF3500

## Page 49

Configuration CA Certificate & Client Certificate Encryption and authentication via TLS can also be accomplished through a certificate authority (CA). The CA provides a signature via the public key for the message broker (the so-called server key) and usually also for all connecting clients. All communication devices can then trust each other, because the issuing certificate authority is trusted. Preshared Key (PSK) The TLS Pre Shared Key (PSK) method offers a simple option for realizing encryption between client and message broker. Client and broker recognize a common password, which is used to encrypt and decrypt the packages. TF3500 Version: 1.3.0 49

## Page 50

Configuration 6.1.2 Timestamp correction The Twin CAT time, which is used by default for timestamps in the Data Logger, deviates more and more from the actual system time the longer a controller is in Run Mode. This is due to the fact that different hardware counters are used as clock generators. With the concept of timestamp correction, which Twin CAT offers, it is possible to append corrected timestamps to the recorded samples. The correction using the External Time Provider, which Twin CAT provides, can be made both in relation to an external time source via NTP (Network Time Protocol) and in relation to the Ether CAT Distributed Clock via PTP (Precision Time Protocol). The settings for timestamp correction can be found under the Data Logger project node in the tab Time Source. If the desired Precision Category is selected, any External Time Provider is displayed. If none exists yet, a provider can be created via the button Create. 50 Version: 1.3.0 TF3500

## Page 51

Configuration This then appears in the project under the Tc Com-Objects node, which you can access via the button Config. Here you should ensure that the Task that controls the Time Provider object is selected in the Context tab. TF3500 Version: 1.3.0 51

## Page 52

Configuration In addition, the cycle time of the provider's synchronization with the NTP server and the server host name can be set via the Init parameter. This creates timestamp corrections that the Logger uses to correct an offset resulting from the difference between the Twin CAT time and the NTP-synchronous time. 6.1.3 Device-specific information You can enter information about the control device under the Analytics project node in the tab Device Info. This includes the address, coordinates and a system-ID alias, which makes it easier for the user to identify the device in the analytics workflow. 52 Version: 1.3.0 TF3500

## Page 53

Configuration This information is sent as part of the Stream Description on the corresponding MQTT topic and is the same for all Data Loggers and Streams. 6.2 Data Streams If variables are available for recording they will be shown automatically as a so called Stream. At the moment it is possible to record data directly from the Ether CAT process image or from the PLC application. PLC Application: If variables from PLC should recorded by the Analytics Logger, the user must set an attribute in front of each variable in the variable declaration. The attribute syntax is: {attribute 'Tc Analytics'} TF3500 Version: 1.3.0 53

## Page 54

Configuration As already described a new stream is automatically add to the Analytics Logger configuration after rebuild of the PLC project. In the stream a Selection tab is available to choose finally the variables by checkboxes who should be recorded. Process Image: If an Ether CAT process image is available in the given configuration, an additional stream will be shown under the Data Logger tree node. 54 Version: 1.3.0 TF3500

## Page 55

Configuration On the Selection tab the user can choose again the values who should be recorded by the Analytics Logger. TF3500 Version: 1.3.0 55

## Page 56

Configuration Start Record With the activation of the Twin CAT configuration the Analytics Logger starts logging. Depending on the basic settings to a MQTT Message Broker or into a local binary file. By the given format there are different settings possibilities on the Data Handling tab of each Stream. See therefore the following chapter. 6.2.1 Data Handling You can set general settings for the package size for the recorded data in the Handling Data tab. Additional settings may be present, dependent on the given data format. Autostart Stream: Specifies whether the stream should start automatically as soon as Twin CAT enters Run Mode. If this option is not chosen, the stream can be started via a PLC program. Data Size: This is a write-protected, automatically determined value that states the size of the given variable selection for this stream, i.e. the sample size. 56 Version: 1.3.0 TF3500

## Page 57

Configuration Max ADS Buffer: You can set the number of buffered samples before writing to file or sending to Message Broker here. With a sample rate of 1 ms and 32 samples per buffer, the Analytics Logger needs 32 ms before it sends the buffer via MQTT or writes it to a file. This is an individual setting that is dependent on the system resources. Sampling Divider: This allows you to reduce the sampling rate, which can be determined by dividing the inverses of the task cycle time by the value specified here. Data format: MQTT If the data format is IOT_FORMAT_BINARY, an additional checkbox can be activated for queuing messages when the connection is broken. File Store: If this option is activated the queued messages will stored in a temporary file on the hard disk. Otherwise the data will be stored in the RAM when connection to the Message Broker is broken. Queue Size: This is the number of the configured ADS Buffer which should be stored in the event of a lost connection. Data format: File If the IOT_FORMAT_FILE data format is selected, a number of other setting options are available. TF3500 Version: 1.3.0 57

## Page 58

Configuration Max File Size: The maximum number of buffers that can be written to a file before a new file is started can be specified here. This results in a maximum file size. The files will be stored under C: \Twin CAT\3.1\Boot\Analytics. File Directory: An Analytics subfolder is created by default in C:\Twin CAT\3.1\Boot\ (%TC_BOOTPRJPATH%) for each stream. A subfolder containing a .tas file (symbols) and the .tay files (data) is created for each stream. The path to the folder that the Analytics directory should be stored in can be defined here. Max. unconfirmed: Specifies how many ADS requests may accumulate while writing files that do not have a corresponding ADS confirmation. This parameter enables flow control to prevent an overflow of the ADS router queues. It can usually remain at the pre-set value. However, if a large number of write operations occur in a short period of time and the router is also under further load at the same time, this can lead to overfilled queues, which is indicated by error messages. Ring Buffer: Activates a ring buffer where the binary files are buffered. Each time Twin CAT is restarted, the current content is transferred to a backup folder and a new ring buffer is started, which overwrites the content of the backup folder. File Count: The File Count parameter is used to state a number of files that should be part of the ring buffer. The ring buffer time depends on the given Max File Size. 58 Version: 1.3.0 TF3500

## Page 59

API 7 API 7.1 PLC 7.1.1 Analytics Communication Library 7.1.1.1 Overview The Twin CAT Analytics Communication Library is a PLC library that provides the user with an interface to the Analytics Logger and its counterpart, the Analytics Stream Helper. This enables you to start, stop and reconfigure an Analytics Stream from the PLC code during runtime. For example, you can change the endpoint, a directory or a message broker from within the application. This opens up many new application possibilities for your Analytics application. Product components • Driver Tc Analytics.sys • PLC library Tc3Analytics Communication.compiled-library 7.1.1.2 Installation The Twin CAT Analytics Communication Library is installed with Twin CAT XAE and XAR version >= 4024.47. It should therefore always be available. No separate license is required to use it, but the Analytics Logger requires a TF3500 Twin CAT 3 Analytics Logger license, either perpetual or as a 7-day license. 7.1.1.3 PLC API 7.1.1.3.1 Function blocks 7.1.1.3.1.1 FB_ALYC_Mqtt Stream This function block represents an Analytics MQTT stream. The connection to a stream can be established using the Object Id as an input variable. The requirement is an existing stream, e.g. created in the System Manager under the Data Logger node in the project tree. The stream can be controlled using the Start/Stop methods and reconfigured using Reconfigure. A structure of the type ST_ALYC_Mqtt Stream Config containing the new configuration parameters is transferred to the method for this purpose. During reconfiguration, starting from the OP state, the Tc Com states SAFEOP, PREOP, SAFEOP, OP are run through in this order. Since all states below SAFEOP no longer run in real-time mode, but the remaining Twin CAT runtime does, the reconfiguration must take place asynchronously to the task cycle, whereby the Reconfig method should be called cyclically as long as the OP state is not reached again. The properties b Connected, b Started etc. provide information about the current state of the stream. Errors can be recorded via the b Error output and the corresponding ip Result Message. Definition: FUNCTION_BLOCK FB_ALYC_Mqtt Stream VAR_INPUT {attribute 'tcinitsymbol'} n Object ID : OTCID := 0; END_VAR VAR_OUTPUT b Initialized : BOOL := FALSE; b Error : BOOL := FALSE; ip Result Message : I_Tc Message := fb Result; e Reconfig State : E_ALYC_Reconfig State := E_ALYC_Reconfig State. DONE; END_VAR TF3500 Version: 1.3.0 59

## Page 60

API Inputs Name Type Description n Object ID OTCID Tc Com-Object ID of the referenced stream. This can be initialized under the 'Init symbols' tab of the corresponding PLC instance node in the System Manager project tree. Outputs Name Type Description b Initialized BOOL TRUE if the function block is initialized and can be used. Initialization takes place automatically after setting Twin CAT to Run Mode. b Error BOOL TRUE if an error has occurred. ip Result Message I_Tc Message Message Event Logger e Reconfig State E_ALYC_Reconfig State The state of the state machine during reconfiguration. Methods Name Return type Description Reconfigure BOOL Reconfigure the stream. Parameter: ST_ALYC_Mqtt Stream Config. TRUE if successful. Start BOOL Start the stream. TRUE if successful. Stop BOOL Stop the stream. TRUE if successful. Properties Name Type Direction Description b Connected BOOL get TRUE if MQTT connection exists. b Started BOOL get TRUE if stream started. n Data Size UDINT get Sample data size n Samples Issued ULINT get Number of samples that have been written. n Samples Lost ULINT get Number of discarded samples. t Cycle Time LTIME get Cycle time in ns n Comp Data Saving DINT get Percentage of data volume saved compared to the uncompressed alternative. If negative, there is additional work instead of data savings. 7.1.1.3.1.2 FB_ALYC_File Stream This function block represents an Analytics Stream in file mode. The connection to a stream can be established using the Object Id as an input variable. The requirement is an existing stream that is in file mode, e.g. created in the System Manager under the Data Logger node in the project tree. The symbols that are to be logged must also be configured via the System Manager. The stream can be controlled using the Start/Stop methods and reconfigured using Reconfigure. A structure of the type ST_ALYC_File Stream Config containing the new configuration parameters is transferred to the method for this purpose. During reconfiguration, starting from the OP state, the Tc Com states SAFEOP, PREOP, SAFEOP, OP are run through in this order. Since all states below SAFEOP no longer operate in real-time mode, but the remaining Twin CAT runtime does, the reconfiguration must take place asynchronously to the task cycle, whereby the Reconfigure method should be called cyclically as long as the OP state is not reached again. The properties b Started, n Sample Issued etc. provide information about the current state of the stream. Errors can be recorded via the b Error output and the corresponding ip Result Message. 60 Version: 1.3.0 TF3500

## Page 61

API Definition: FUNCTION_BLOCK FB_ALYC_File Stream VAR_INPUT {attribute 'tcinitsymbol'} n Object ID : OTCID := 0; END_VAR VAR_OUTPUT b Initialized : BOOL := FALSE; b Error : BOOL := FALSE; ip Result Message : I_Tc Message := fb Result; e Reconfig State : E_ALYC_Reconfig State := E_ALYC_Reconfig State. DONE; END_VAR Inputs Name Type Description n Object ID OTCID Tc Com-Object ID of the referenced stream. This can be initialized under the 'Init symbols' tab of the corresponding PLC instance node in the System Manager project tree. Outputs Name Type Description b Initialized BOOL TRUE if the function block is initialized and can be used. Initialization takes place automatically after setting Twin CAT to Run Mode. b Error BOOL TRUE if an error has occurred. ip Result Message I_Tc Message Message Event Logger e Reconfig State E_ALYC_Reconfig State The state of the state machine during reconfiguration. Methods Name Return type Description Reconfigure BOOL Reconfigure the stream. Parameter: ST_ALYC_File Stream Config. TRUE if successful. Start BOOL Start the stream. TRUE if successful. Stop BOOL Stop the stream. TRUE if successful. Properties Name Type Direction Description b Started BOOL get TRUE if stream started. n Data Size UDINT get Sample data size n Samples Issued ULINT get Number of samples that have been written. n Samples Lost ULINT get Number of discarded samples. t Cycle Time LTIME get Cycle time in ns n Comp Data Saving DINT get Percentage of data volume saved compared to the uncompressed alternative. If negative, there is additional work instead of data savings. n Unconf File Writes ULINT get Number of file write requests that have not yet been confirmed by the AMS router. Can prevent an overflow of the router message queue. TF3500 Version: 1.3.0 61

## Page 62

API 7.1.1.3.1.3 FB_ALYC_Mqtt Stream Helper This function block represents an Analytics Stream Helper in MQTT mode. The connection to an existing Stream Helper can be established via the Object Id as an input variable. This must be configured in MQTT mode. The stream can be controlled using the Start/Stop methods and reconfigured using Reconfigure. For this purpose, a structure of the type ST_ALYC_Mqtt Stream Helper Config is transferred to the method, which contains the new configuration parameters. During reconfiguration, starting from the OP state, the Tc Com states SAFEOP, PREOP, SAFEOP, OP are run through in this order. Since all states below SAFEOP no longer run in real-time mode, but the remaining Twin CAT runtime does, the reconfiguration must take place asynchronously to the task cycle, whereby the Reconfigure method should be called cyclically as long as the OP state is not reached again. The properties b Connected, b Started etc. provide information about the current state of the Stream Helper. Errors can be recorded via the b Error output and the corresponding ip Result Message. Definition: FUNCTION_BLOCK FB_ALYC_Mqtt Stream Helper VAR_INPUT {attribute 'tcinitsymbol'} n Object ID : OTCID := 0; n Num Input Buffer : UDINT := 20; END_VAR VAR_OUTPUT ip Result Message : I_Tc Message := fb Result; b Error : BOOL := FALSE; b New Result : BOOL := FALSE; b Initialized : BOOL := FALSE; n Num Elements : UDINT; e Reconfig State : E_ALYC_Reconfig State := E_ALYC_Reconfig State. DONE; END_VAR Inputs Name Type Description n Object ID OTCID Tc Com-Object ID of the referenced Stream Helper. This can be initialized under the 'Init symbols' tab of the corresponding PLC instance node in the System Manager project tree. n Num Input Buffer UDINT Maximum number of buffered symbol values (samples) in the symbol queues. Outputs Name Type Description b Initialized BOOL TRUE if the function block is initialized and can be used. Initialization takes place automatically after setting Twin CAT to Run Mode. b Error BOOL TRUE if an error has occurred. ip Result Message I_Tc Message Message Event Logger e Reconfig State E_ALYC_Reconfig State The state of the state machine during reconfiguration. b New Result BOOL TRUE if new values have been read into the symbol queues. n Num Elements UDINT Number of new values in the symbol queues 62 Version: 1.3.0 TF3500

## Page 63

API Methods Name Return type Description Reconfigure BOOL Reconfigure the Stream Helper with a ST_ALYC_Mqtt Stream Helper Config as parameter. Returns TRUE if successful. Call BOOL Main method that should always be called cyclically. TRUE if successful. Add Iot Symbol BOOL Add a symbol of type I_ALYC_Iot Symbol to the internal symbol list whose values are to be received. TRUE if successful. Release Iot Symbol BOOL Remove a symbol of type I_ALYC_Iot Symbol from the internal symbol list. TRUE if successful. Release All Iot Symbol BOOL TRUE if successful. s Contains Iot Symbol BOOL TRUE if symbol of type I_ALYC_Iot Symbol is in the internal symbol list. Properties Name Type Direction Description b Connected BOOL get TRUE if an MQTT connection exists. b Reconnect BOOL get/set If TRUE, interrupt the MQTT connection, if FALSE, renew the MQTT connection. s Stream STRING(25 get/set MQTT receive topic in the format <Main Topic>/ 5) <Stream Topic> n Num Iot Symbols Re UDINT get/set Number of Iot symbols added. gistered 7.1.1.3.1.4 FB_ALYC_File Stream Helper This function block represents an Analytics Stream Helper in file mode. The connection to an existing Stream Helper can be established via the Object Id as an input variable. This must be configured in file mode. The stream can be controlled using the Start/Stop methods and reconfigured using Reconfigure. For this purpose, a structure of the type ST_ALYC_File Stream Helper Config is transferred to the method, which contains the new configuration parameters. During reconfiguration, starting from the OP state, the Tc Com states SAFEOP, PREOP, SAFEOP, OP are run through in this order. Since all states below SAFEOP no longer run in real-time mode, but the remaining Twin CAT runtime does, the reconfiguration must take place asynchronously to the task cycle, whereby the Reconfigure method should be called cyclically as long as the OP state is not reached again. The properties b Started etc. provide information about the current state of the Stream Helper. Errors can be recorded via the b Error output and the corresponding ip Result Message. Definition: FUNCTION_BLOCK FB_ALYC_Mqtt Stream Helper VAR_INPUT {attribute 'tcinitsymbol'} n Object ID : OTCID := 0; n Num Input Buffer : UDINT := 20; END_VAR VAR_OUTPUT ip Result Message : I_Tc Message := fb Result; b Error : BOOL := FALSE; b New Result : BOOL := FALSE; b Initialized : BOOL := FALSE; n Num Elements : UDINT; e Reconfig State : E_ALYC_Reconfig State := E_ALYC_Reconfig State. DONE; END_VAR TF3500 Version: 1.3.0 63

## Page 64

API Inputs Name Type Description n Object ID OTCID Tc Com-Object ID of the referenced Stream Helper. This can be initialized under the 'Init symbols' tab of the corresponding PLC instance node in the System Manager project tree. n Num Input Buffer UDINT Maximum number of buffered symbol values (samples) in the symbol queues. Outputs Name Type Description b Initialized BOOL TRUE if the function block is initialized and can be used. Initialization takes place automatically after setting Twin CAT to Run Mode. b Error BOOL TRUE if an error has occurred. ip Result Message I_Tc Message Message Event Logger e Reconfig State E_ALYC_Reconfig State The state of the state machine during reconfiguration. b New Result BOOL TRUE if new values have been read into the symbol queues. n Num Elements UDINT Number of new values in the symbol queues st Current Config ST_ALYC_File Stream Helper Config [} 81] st Current State ST_ALYC_File Stream Hel Current state information on the Stream Helper. per State Methods Name Return type Description Reconfigure BOOL Reconfigure the Stream Helper with a ST_ALYC_Mqtt Stream Helper Config as parameter. Returns TRUE if successful. Call BOOL Main method that should always be called cyclically. TRUE if successful. Add Iot Symbol BOOL Add a symbol of type I_ALYC_Iot Symbol to the internal symbol list whose values are to be received. TRUE if successful. Release Iot Symbol BOOL Remove a symbol of type I_ALYC_Iot Symbol from the internal symbol list. TRUE if successful. Release All Iot Symbols BOOL TRUE if successful. Contains Iot Symbol BOOL TRUE if symbol of type I_ALYC_Iot Symbol is in the internal symbol list. Properties Name Type Direction Description n Num Iot Symbols Re UDINT get/set Number of Iot symbols added. gistered 64 Version: 1.3.0 TF3500

## Page 65

API 7.1.1.3.1.5 Io T symbol 7.1.1.3.1.5.1 FB_ALYC_Iot Symbol_BOOL Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_BOOL VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3500 Version: 1.3.0 65

## Page 66

API 7.1.1.3.1.5.2 FB_ALYC_Iot Symbol_BYTE Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_BYTE VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 66 Version: 1.3.0 TF3500

## Page 67

API 7.1.1.3.1.5.3 FB_ALYC_Iot Symbol_DINT Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_DINT VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3500 Version: 1.3.0 67

## Page 68

API 7.1.1.3.1.5.4 FB_ALYC_Iot Symbol_DWORD Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_DWORD VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 68 Version: 1.3.0 TF3500

## Page 69

API 7.1.1.3.1.5.5 FB_ALYC_Iot Symbol_INT Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_INT VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3500 Version: 1.3.0 69

## Page 70

API 7.1.1.3.1.5.6 FB_ALYC_Iot Symbol_LINT Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_LINT VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 70 Version: 1.3.0 TF3500

## Page 71

API 7.1.1.3.1.5.7 FB_ALYC_Iot Symbol_LREAL Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_LREAL VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3500 Version: 1.3.0 71

## Page 72

API 7.1.1.3.1.5.8 FB_ALYC_Iot Symbol_LWORD Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_LWORD VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 72 Version: 1.3.0 TF3500

## Page 73

API 7.1.1.3.1.5.9 FB_ALYC_Iot Symbol_REAL Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_REAL VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3500 Version: 1.3.0 73

## Page 74

API 7.1.1.3.1.5.10 FB_ALYC_Iot Symbol_SINT Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_SINT VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 74 Version: 1.3.0 TF3500

## Page 75

API 7.1.1.3.1.5.11 FB_ALYC_Iot Symbol_STRING Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_STRING VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3500 Version: 1.3.0 75

## Page 76

API 7.1.1.3.1.5.12 FB_ALYC_Iot Symbol_UDINT Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_UDINT VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 76 Version: 1.3.0 TF3500

## Page 77

API 7.1.1.3.1.5.13 FB_ALYC_Iot Symbol_UINT Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_UINT VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3500 Version: 1.3.0 77

## Page 78

API 7.1.1.3.1.5.14 FB_ALYC_Iot Symbol_ULINT Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_ULINT VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 78 Version: 1.3.0 TF3500

## Page 79

API 7.1.1.3.1.5.15 FB_ALYC_Iot Symbol_USINT Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_USINT VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3500 Version: 1.3.0 79

## Page 80

API 7.1.1.3.1.5.16 FB_ALYC_Iot Symbol_WORD Syntax Definition: FUNCTION_BLOCK FB_ALYC_Iot Symbol_WORD VAR_INPUT st Config : ST_ALYC_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALYC_Iot Symbol_Co Structure for the configuration of the FB. nfig Outputs Name Type Description ip Result Message I_Tc Message Event Logger b Error BOOL TRUE if an error has occurred. b New Result BOOL TRUE if a new result has been calculated. b Configured BOOL TRUE if the FB is successfully configured. b Symbol Handler Assi BOOL TRUE if the symbol handler has been assigned. gned b Variable Found BOOL TRUE if a variable was found in the stream. s Symbol Path STRING(255) Theam/Stream. Symbol t Cycle Time LTIME Cycle time of the publishing system. n Max Num Elements UDINT Maximum number of saved symbols influenced by Stream Helper. Methods Name Definition location Description Get Value Local Get the value of the specified element. Get Oversampling Val Local Get the oversampling values of the specified element. ues Get Array Values Local Get the array values of the specified element. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 80 Version: 1.3.0 TF3500

## Page 81

API 7.1.1.3.2 Data types 7.1.1.3.2.1 ST_ALYC_Mqtt Stream Config TYPE ST_ALYC_Mqtt Stream Config : STRUCT b Auto Start Stream : BOOL := TRUE; n Ads Buffer : DINT := 32; // Samples in buffer n Sampling Divider : UDINT := 1; e Compression Method : ANALYTICS_COMPRESSION := ANALYTICS_COMPRESSION. ANALYTICS_COMPRESSION_RL; e Compression Width : ANALYTICS_COMPRESSION_WIDTH := ANALYTICS_COMPRESSION_WIDTH. ANALYTICS_COMP_W IDTH_8; e External Time Type : ETc External Time Type := ETc External Time Type. System Time; st Device Location: ST_ALYC_Address := (s Address := '', s Longitude := '', s Latitude := ''); s System Id Alias : STRING; st Connection : ST_ALYC_Mqtt Connection Settings; n Queue Size : UDINT := 0; s Mqtt Topic : STRING(255) := ''; // Combination of main topic and stream topic: Main Topic/ Stream Topic b Queue When Disconnected : BOOL := FALSE; b Queue In File : BOOL := FALSE; END_STRUCT END_TYPE 7.1.1.3.2.2 ST_ALYC_File Stream Config TYPE ST_ALYC_File Stream Config : STRUCT b Auto Start Stream : BOOL := TRUE; n Ads Buffer : DINT := 32; // Samples in buffer n Sampling Divider : UDINT := 1; e Compression Method : ANALYTICS_COMPRESSION := ANALYTICS_COMPRESSION. ANALYTICS_COMPRESSION_RL; e Compression Width : ANALYTICS_COMPRESSION_WIDTH := ANALYTICS_COMPRESSION_WIDTH. ANALYTICS_COMP_W IDTH_8; e External Time Type : ETc External Time Type := ETc External Time Type. System Time; st Device Location : ST_ALYC_Address := (s Address := '', s Longitude := '', s Latitude := ''); s System Id Alias : STRING; n Max File Size : UDINT := 16; n Files In Ring Buffer : UDINT := 2; // Number of files in ring buffer s File Dir : STRING(255) := ''; // Optional, Default: %TC_BOOTPRJPATH% b Enable Ring Buffer : BOOL := TRUE; n Max Unconf Writes: UDINT := 1000; // Number of file writes without a confirmation from ADS router END_STRUCT END_TYPE 7.1.1.3.2.3 ST_ALYC_Mqtt Stream Helper Config TYPE ST_ALYC_Mqtt Stream Helper Config : STRUCT st Connection : ST_ALYC_Mqtt Connection Settings; s Mqtt Topic : STRING(255); // Combination of main topic and stream topic b Autostart Receive : BOOL := TRUE; END_STRUCT END_TYPE 7.1.1.3.2.4 ST_ALYC_File Stream Helper Config TYPE ST_ALYC_File Stream Helper Config : STRUCT n Samples In Read Buf : UINT := 32; //How many samples to read from file every cycle n Read Bufs In Stream Buf : UINT := 32; //How many read buffers to put into a stream buffer (treated as ring buffer) s File Dir : STRING(255) := ''; //Directory in which to find the Analytics data files b Read Files Cyclically : BOOL := TRUE; //If all files have been read, start over reading them from the beginning END_STRUCT END_TYPE TF3500 Version: 1.3.0 81

## Page 82

API 7.1.1.4 Samples 7.1.1.4.1 Analytics Streams and MQTT Stream Helper. The sample shows how an MQTT stream and a stream in File mode can be configured. At the same time, a Stream Helper is configured to receive the data from the MQTT stream. The next sample shows how the file stream data can be analyzed. The most important function blocks of the type FB_ALYC_Mqtt Stream [} 59], FB_ALYC_File Stream [} 60] and FB_ALYC_Mqtt Stream Helper [} 62] are used. The sample is available for download here: https://infosys.beckhoff.com/content/1033/tf3500_tc3_analytics_logger/Resources/14831744651.zip Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.47 PC or CX (x64, x86) Tc3_Analytics Communication 7.1.1.4.2 File Stream Helper The sample shows how a File-Stream Helper can be used to read Analytics Files and integrate them into the PLC program. The function block FB_ALYC_File Stream Helper [} 63] is used. The Analytics Files from the previous sample can be used here. The sample is available for download here: https://infosys.beckhoff.com/content/1033/tf3500_tc3_analytics_logger/Resources/14831745163.zip Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.47 PC or CX (x64, x86) Tc3_Analytics Communication 7.1.2 Obsolete 7.1.2.1 Using the Programming Interface As described in the Technical Introduction a stream can be started and stopped from PLC code using Structured Text. For that, the streams of a data logger, themselves being Tc Com-objects provide an interface called ITc Analytics Stream comprising two methods, Start Analytics Stream() and Stop Analytics Stream(). Follow the following steps to use the interface, the code samples may be useful, too: Declare a variable of the type ITc Analytics Stream and another one of the type OTCID for the object ID of the correspondent stream. For diagnostic purposes, an HRESULT variable is advisable. HR : HRESULT := S_OK; {attribute 'tcinitsymbol'} oid Plc Stream1 : OTCID; ip Plc Stream1 : ITc Analytics Stream; Next, add the attribute ‘tcinitsymbol’ above the OTCID variable. This way, it doesn’t need to be initialized statically in the source code, instead it be initialized at configuration time by double clicking the PLC instance node in the project tree and selecting the relevant stream in the combo box as illustrated in the following picture. 82 Version: 1.3.0 TF3500

## Page 83

API Fig. 1: After that, get an interface pointer using following the Tc Com-object server method and the interface’s IID. IF ip Plc Stream1 = 0 AND oid Plc Stream1 <> 0 THEN HR := FW_Obj Mgr_Get Object Instance(oid Plc Stream1, IID_ITc Analytics Stream, ADR(ip Plc Stream1)); END_IF Now you can use the interface pointer to call interface’s methods. As shown in the following example: IF ip Plc Stream1 <> 0 THEN IF b Start Plc Stream1 THEN ip Plc Stream1. Start Analytics Stream(); b Start Plc Stream1 := FALSE; END_IF IF b Stop Plc Stream1 THEN ip Plc Stream1. Stop Analytics Stream(); b Stop Plc Stream1 := FALSE; END_IF END_IF The stream is started in the same cycle Start Analytics Stream() is called and will include the logged variable values. The stream is stopped in the same cycle Stop Analytics Stream() is called but will not include the variable values of this cycle. In the Samples section of this documentation you can find a sample program that includes the here presented code snippets. 7.2 Automation Interface Please refer to the Automation Interface documentation: Creating and using the Data Logger and Stream Helper TF3500 Version: 1.3.0 83

## Page 84

Samples 8 Samples Data Logger Start/Stop stream from PLC code sample: https://infosys.beckhoff.com/content/1033/tf3500_tc3_analytics_logger/Resources/6904617099.zip 84 Version: 1.3.0 TF3500

## Page 85

Appendix 9 Appendix 9.1 FAQ - frequently asked questions and answers In this section frequently asked questions are answered in order to make your work with Twin CAT Analytics Logger easier. If you have any further questions, please contact our Support [} 86] team. Should I always use TLS with MQTT? [} 85] Is it possible to have multiple connections? [} 85] Is it possible to control the Analytics Logger by a PLC function block? [} 85] I still have a 4024 system and would like to use the Logger. How do I install it? [} 85] ? Should I always use TLS with MQTT? ! Yes, you should if you can. If you can afford the overhead in CPU and bandwidth, then a secure communication channel is invaluable. Depending on the general CPU performance it could be possible to have a noticeable reduction of communication performance. ? Is it possible to have multiple connections? ! Yes, you can connect the Analytics Logger at the same time to different Message Broker just by adding a new instance of the Logger. Also it is possible to have one instance of the Logger for an MQTT communication to a Message Broker and at the same time one instance for writing data into Analytics File to the local system. Is it possible to control the Analytics Logger by a PLC function block? ! Yes, it is possible to control the Logger with the Analytics Communication Library. Details and examples can be found on the Overview [} 59] page in the API chapter. I still have a 4024 system and would like to use the Logger. How do I install it? ! The drivers and the configuration interface for the Analytics Logger are already available in every 4024 XAE and XAR system. Nothing needs to be installed additionally. Only the configuration needs to be carried out and activated on the target system. Due to continuous development, the Logger functionalities differ from one Twin CAT Build to the next. The newer a Twin CAT Build is, the more functionalities are available. TF3500 Version: 1.3.0 85

## Page 86

Support and Service 10 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 86 Version: 1.3.0 TF3500

## Page 87

Trademark statements Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements The registered trademark Linux® is used pursuant to a sublicense from the Linux Foundation, the exclusive licensee of Linus Torvalds, owner of the mark on a worldwide basis. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.

## Page 88

More Information: www.beckhoff.com/tf3500 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
