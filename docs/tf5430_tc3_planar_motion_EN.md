---
title: "TF5430 Twin CAT 3"
product: "tf5430"
category: "Motion_Control"
tags: ["CAT", "NC", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.8.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/tf5430_tc3_planar_motion_EN.pdf"
release_date: "2025-09-02"
---
Manual | EN TF5430 Twin CAT 3 | Planar Motion 2025-09-02 | Version: 1.8.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Overview of the new functions................................................................................................................ 8 3 Introduction............................................................................................................................................... 9 4 States and modes................................................................................................................................... 10 4.1 Planar objects state diagram........................................................................................................... 10 4.2 Planar mover command diagram.................................................................................................... 11 4.3 Planar track operation modes......................................................................................................... 12 5 Parts......................................................................................................................................................... 14 5.1 Parts and coordinate systems......................................................................................................... 14 5.2 Configuration................................................................................................................................... 15 5.3 Positions with Reference Id.............................................................................................................. 16 6 Planar Motion components.................................................................................................................... 17 6.1 Planar mover................................................................................................................................... 17 6.1.1 Configuration.................................................................................................................... 17 6.1.2 Creating a PLC................................................................................................................. 20 6.1.3 Example: "Creating and moving Planar movers"............................................................. 21 6.1.4 Example "Moving a Planar mover to Planar parts".......................................................... 24 6.1.5 Example: "Creating and moving a Planar mover with auxiliary axes".............................. 27 6.1.6 Example "Creating and moving a Planar mover with External Setpoint Generation"...... 30 6.1.7 Example "Moving a Planar mover with External Setpoint Generation to Planar parts".... 33 6.1.8 Example "Moving the Planar mover in CRotation Free Movement mode"......................... 37 6.1.9 Limits and options of the motion commands.................................................................... 39 6.2 Planar track..................................................................................................................................... 42 6.2.1 Configuration.................................................................................................................... 42 6.2.2 Track networks and collision avoidance........................................................................... 44 6.2.3 Geometric definition......................................................................................................... 48 6.2.4 Tracks and parts.............................................................................................................. 49 6.2.5 Example "Joining and moving a Planar mover on the track"........................................... 51 6.2.6 Example "Moving Planar movers on tracks with Planar parts"........................................ 55 6.2.7 Example "Couple planar mover to track and moving it with Dynamics Reduction Mode".. 60 6.2.8 Example "Coupling a Planar mover to a track and moving it in CRotation On Track mode"............................................................................................................................... 64 6.2.9 Example "Coupling a Planar mover to a track and moving it with Adopt Track Orientation".................................................................................................... 68 6.2.10 Example "Synchronizing a Planar mover on a track with one axis"................................. 71 6.2.11 Example: "Synchronizing a Planar mover on a track with another Planar mover"........... 78 6.2.12 Example "Connecting Planar tracks to a network"........................................................... 81 6.2.13 Example "Connecting Planar tracks to network on Planar parts".................................... 85 6.2.14 Example: "Following a Planar mover through a Track Network"...................................... 89 6.2.15 Options for the "Start From Track Advanced" and "End At Track Advanced" commands..... 94 TF5430 Version: 1.8.0 3
## Page 4

Table of contents 6.3 Planar group.................................................................................................................................... 95 6.3.1 Configuration.................................................................................................................... 95 6.3.2 Example: "Creating and moving Planar movers with group"............................................ 97 6.4 Planar environment....................................................................................................................... 102 6.4.1 Configuration.................................................................................................................. 102 6.4.2 Example "Configuring the stator area and boundary".................................................... 104 6.5 Example: "Creating and moving Planar movers with track and group"......................................... 108 6.6 Planar part..................................................................................................................................... 112 6.6.1 Example "Activating a Planar part position and moving a Planar mover"...................... 113 6.7 Planar Feedback........................................................................................................................... 119 6.7.1 Example "Creating a Planar mover and Planar Feedback"........................................... 119 6.7.2 Example "Planar motion components: averting collision".............................................. 122 6.7.3 Specialized feedback types............................................................................................ 126 6.8 Planar Track Trail........................................................................................................................... 127 6.8.1 Example "Synchronization movement over two Planar tracks"...................................... 128 7 PLC Libraries......................................................................................................................................... 132 7.1 Inserting libraries........................................................................................................................... 132 7.2 Tc3_Mc3Planar Motion API........................................................................................................... 132 7.2.1 Data Types..................................................................................................................... 132 7.2.2 Function Blocks.............................................................................................................. 142 8 Support and Service............................................................................................................................. 183 4 Version: 1.8.0 TF5430
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF5430 Version: 1.8.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.8.0 TF5430
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF5430 Version: 1.8.0 7
## Page 8

Overview of the new functions 2 Overview of the new functions From version V3.3.77: • New: Additional option for the Move On Track command ("Dynamics Reduction Mode") From version V3.3.62: • New: Support for Bodeplot in all coordinates of the Planar Mover (requires TE1320 Twin CAT 3 Bode Plot Base v34.48.35 or higher) From version V3.3.39: • New: Support for tiles with a side length of 160 mm and/or 320 mm • New: Additional option for the Move On Track command (“Gap Mode”) • New: “Mover Hardware Oid” property and “Get Track Trail Information” method of the MC_Planar Mover in the PLC From version V3.3.19: • New: Timeouts for the state transitions (Enabling, Disabling, Resetting) of the Planar State Machine for Planar movers and Planar parts • New: A large part of the initial parameters of the Planar mover can be changed in the Enabled state (previously only in Disabled) From version V3.2.60: • New: The surface that the movers travel on is divided into Planar parts that can be moved during runtime. Movers can cross boundaries between connected or adjacent Planar parts. • Requires Twin CAT V3.1.4024.40 or higher From version V3.1.10.63: • Requires Twin CAT V3.1.4024.24 or higher From version V3.1.10.51: • New: Adopt Track Orientation rotates the mover on the track to align it with the track orientation. This changes the C coordinate mode from independent to dependent. • Advanced: Move C now always works for standing movers on the track. This may change the C coordinate mode from dependent to independent. From version V3.1.10.44: • New: Gear In Pos On Track and Gear In Pos On Track With Master Mover commands for coupling a Planar mover to a master axis or a master mover, respectively • Advanced: Parameters of the Planar track Tc COM module • Requires Twin CAT V3.1.4024.17 or higher From version V3.1.10.30: • New: CRotation command mode (360° rotation) with modulo positioning • New: Constraints as a new variant to limit the dynamics of the motion commands • Advanced: Parameters for modulo positioning on “Closed Loop” tracks From version V3.1.10.11: • First version of Planar Motion released • Requires Twin CAT V3.1.4024.12 or higher 8 Version: 1.8.0 TF5430
## Page 9

Introduction 3 Introduction The Twin CAT 3 Planar Motion software package TF5430 is installed together with the software package TF5400. Target system Windows 10 (only 64-bit) Twin CAT 3 Planar Motion Base The TF5430 Twin CAT 3 Planar Motion software combines a wide range of functionalities for controlling XPlanar movers and enables efficient and intelligent implementation of individual XPlanar applications. TF5430 Twin CAT 3 Planar Motion is part of TF5890 Twin CAT 3 XPlanar. All associated function blocks are included in the library Tc3_Mc3Planar Motion, which is to be used in combination with the library Tc3_Physics. Additional licensing requirements TF5430 Twin CAT 3 Planar Motion requires the TC1250 license. TF5430 Version: 1.8.0 9
## Page 10

States and modes 4 States and modes 4.1 Planar objects state diagram The Planar State Machine is used by the Planar mover, the Planar track and the Planar group. All these components can be in the following seven Planar States: Enabling, Enabled, Disabling, Disabled, Resetting, Error Pending, Error. The error reaction depends on how serious the error is. For minor errors, the normal error reaction is a Quick Stop. The user can also force the error reaction Abort by Disable() in this case. The command must be sent in one of the following three states: Error Pending, Error or Resetting. Enabling In the Enabling state, the Enable command is executed. At the end of this command, the component is in the Enabled state. In the Enabling state, a Disable command can be sent that cancels the Enable command and causes the state to change to Disabling. Enabled In the Enabled state the component is fully functional and can be used by the user. In this state a Disable command can be sent. The state then switches to Disabling. Disabling In the Disabling state the Disable command is executed. At the end of this command, the component is in the Disabled state. In the Disabling state, a Enable command can be sent that cancels the Disable command and causes the state to change to Enabling. Disabled After the system is booted the components are in the Disabled state. They can be placed in the Enabling state using an Enable command. The components are not functional in the Disabled state. Resetting The component is in the process of rectifying the error. Depending on the error reaction it is then in the Enabled or Disabled state. 10 Version: 1.8.0 TF5430
## Page 11

States and modes Error Pending When an error occurs the component reaches the Error Pending state from all other states except the Resetting state. Once the error has been processed correctly, the state switches to Error. Error The Error state means that an error has occurred and the component can now be placed in the Resetting state using the Reset command in order to correct the error. Timeouts of the transition states From version V3.3.19: Timeouts are available for Planar movers and Planar parts. The transition states Enabling, Disabling and Resetting have an adjustable timeout. If these transition states are triggered by the user and not exited within the timeout, the system switches to the Error Pending state and the transition command (Enable/Disable/Reset) is canceled (timeout error). 4.2 Planar mover command diagram The Planar mover has six different command modes that indicate what type of command the mover executes: On Track, Leaving Track, Joining Track, External Setpoint Generation and CRotation Free Movement/- On Track (from Version V3.1.10.51). In all modes except External Setpoint Generation mode, collision avoidance is active for the mover when it is in a group. On Track In the On Track mode the mover joins a track and can be moved on it (Move On Track). The mover can also leave the track again (Leave Track), which changes the mode to Leaving Track. Move C commands cause a change to CRotation On Track mode if necessary. Leaving Track In Leaving Track mode the mover does not accept any further commands. The mode is quit automatically when the mover has ended the Leave Track command. The mover is then in Free Movement mode. TF5430 Version: 1.8.0 11
## Page 12

States and modes Joining Track In Joining Track mode the mover does not accept any further commands. The mode is quit automatically when the mover has ended the Join Track command. The mover is then in the On Track mode. Free Movement After enabling the mover, it is automatically in this command mode, unless the mover is twisted too much. Then it is in CRotation Free Movement mode. The mover can be moved freely with Move To Position commands. If the user starts the external setpoint generation via a command, the mode switches to External Setpoint Generation. Join Track commands are also possible that change the mode to Joining Track. Move C commands may cause a change to the CRotation Free Movement mode. CRotation Free Movement/-On Track This mode is started by the Move C command if the C-movement that is in progress does not take place entirely within a C-position window. The windows are defined by the position limits of the C-axis of the mover and exist 4 times each rotated by 90° (the 90° rotation results from the mover symmetry: e.g. limits +-15° -> window 1. [-15°,+15°], 2. [75°,105°], 3. [165°,195°], 4. [255°,285°]). Depending on whether you were previously in Free Movement or On Track mode, the mode will be CRotation Free Movement or CRotation On Track accordingly. The mode is finished when the C-movement is completed and the end position is within one of the four windows. The mover then automatically returns to the previous mode. The mover thus changes from CRotation Free Movement to Free Movement or from CRotation On Track to On Track. Otherwise, it remains in Crotation Free Movement/-On Track mode. In both CRotation modes, the X and Y-axes of the mover cannot be moved. If the mover already has an orientation outside the 4 windows when it starts up, it is immediately in CRotation Free Movement mode instead of Free Movement. External Setpoint Generation In External Setpoint Generation mode, the mover executes a corresponding command. This mode begins (or ends) with the beginning (or end) of the corresponding command. In the External Setpoint Generation mode, the mover follows the external setpoints that the user provides cyclically. External setpoint generation can be used in conjunction with the other modes. In this case, the external setpoints are simply added as relative offsets from the setpoints of the other modes. However, the mover is then not in External Setpoint Generation mode. 4.3 Planar track operation modes The Planar track has four different operation modes that indicate whether and how the track performs or can perform its function as a "Street for Movers": Moving, Standing, Configuring and Uninitialized. 12 Version: 1.8.0 TF5430
## Page 13

States and modes Moving In Moving mode, one or more movers are about to move on the track (Move On Track). The first mover to start a movement on the track in Standing mode automatically changes the mode from Standing to Moving. Accordingly, the last mover that completes its movement changes the mode back to Standing. No mover is allowed to execute a Join Track or Leave Track command while the track is in Moving mode. If the track is in a Planar group, it blocks its surface. Standing In Standing mode the track is usable by movers. All movers on the track are standing and waiting for travel commands. Join Track, Leave Track and Move On Track commands are allowed for the movers in this mode. Each of these commands ends the Standing mode of the track. If the track is in a Planar group, it does not block its surface. Configuring In Configuring mode, one or more movers are about to leave the track (Leave Track) or join the track (Join Track). The first mover to leave (or join) the track in Standing mode automatically changes the mode from Standing to Configuring. Accordingly, the last mover to complete leaving or joining changes the mode back to Standing. No mover is allowed to execute a Move On Track command while the track is in Configuring mode. If the track is in a Planar group, it does not block its surface. Uninitialized The track is not usable by movers in the Uninitialized mode. It does not have a finished geometric description yet. When the user creates and enables this geometric description, the track switches to Standing mode. TF5430 Version: 1.8.0 13
## Page 14

Parts 5 Parts 5.1 Parts and coordinate systems From version V3.2.60: The Part feature, which is the subject of this section, is available. The surface that the XPlanar movers move on is made up of stators. These are, for example, squares with a side length of 240 mm or rectangles/squares with a side length of 160 or 320 mm. The entire base area is divided into one or more parts consisting of one or more stators. A stator can only belong to one part, i.e. the parts do not overlap. The total number of stators of a part must be assembled in a contiguous surface. This geometric configuration of the XPlanar system is usually static; it does not change during system runtime. To create a dynamic configuration, the user must move or relocate individual parts by assigning them more than one position and activating them at runtime. In general, an issue arises: the positions are no longer unique or there is no absolute coordinate system. The user can define several (2D) coordinate systems and place his parts in these. A 2D position (e.g. of a mover or track) is now incomplete without an indication of which coordinate system it is located in. Example There are four parts, 1-4, and two coordinate systems, A and B. Part 3 is either in coordinate system A or B. The other parts are permanently assigned to a coordinate system. The position P1 is located in the coordinate system A at the position X=480 and y=480 (P1=(480,480,A) for short). The position P2 is located in the coordinate system B at the position X=480 and y=480 (P2=(480,480,B) for short). 14 Version: 1.8.0 TF5430
## Page 15

Parts Without specifying the coordinate system A, the position P1 would not be distinguishable from the position P2 in coordinate system B (480,480,B). However, both positions are different and are not even in the same coordinate system, i.e. there is no geometric connection between them (e.g. a mover cannot travel from P1 to P2). In addition to coordinate systems A and B, there are also local part coordinate systems for each of the parts 1-4. These coordinate systems each have their origin in the bottom left-hand corner of their part. This means that P1 = (0,0,3) = (0,480,2) = (480,480,1) in the part coordinate systems of parts 1-3. This is only true for part 3 as long as it lies in coordinate system A. The transparent representation of part 3 in coordinate system B shows that part 3 can change its position from coordinate system A to coordinate system B. The position of a part is identical to the origin of its coordinate system. Part 3 would therefore be moved from position P1 (in coordinate system A) to position P2, and now P1 can no longer be specified in the coordinate system of part 3. Instead, the position P2 = (0,0,3) = (480,480,4) can be specified in the coordinate system of part 3 (and 4). Overall, you can see that positions in part coordinate systems are not static if the part is moved with its coordinate system. 5.2 Configuration From version V3.2.60: The Part feature, which is the subject of this section, is available. The configuration of the stators of a part (i.e. the geometric extent) and the part positions in the various coordinate systems takes place in the XPlanar driver and not in the MC Configuration. Therefore we will not describe how to create this configuration here. However, this information is important for both the MC Configuration and for PLC control, so it is read from the XPlanar driver by the Planar environment when it is activated and distributed from there to all Planar objects within the MC Configuration. In the PLC, a separate MC_Planar Part [} 167] object is used to control the part position and states. TF5430 Version: 1.8.0 15
## Page 16

Parts The item objects, Position XYC and Position XY, are extended to specify items uniquely. They now contain the ID of the coordinate system (Reference Id) in addition to the coordinate values. As the positions are no longer unique, the position of the mover can now be specified in two ways: 1. As the position in the higher-level coordinate system (that the part that the mover is on is located in). 2. As a position in the part coordinate system. The position in the higher-level coordinate system is specified in the cyclical interface. In addition, its position in the part coordinate system can be queried using the method Get Position On Current Part [} 166]. Tracks can be connected to various other tracks depending on the part position. These connections can be made using two methods, Start From Track Advanced [} 175] and End At Track Advanced [} 176]. For external setpoint generation, the coordinate system in which the external setpoint is located must also be specified. This is done using the method Set External Setpoint Reference Id. These functionalities of the MC Configuration are described in detail below. 5.3 Positions with Reference Id From version V3.2.60: The Part feature, which is the subject of this section, is available. With the introduction of parts and coordinate systems, positions no longer make sense without specifying the reference system in which they are located. For this purpose, the "Reference Id" property has been added for the Position XYC and Position XY objects. You now also save the ID of the reference system. These two position objects, Position XYC and Position XY, can (and should) now always be used with the explicit ID of the reference system. Stating a specific reference system is safer, as this makes it explicitly clear which system is meant. Not specifying a reference system or specifying the "zero" reference system is only permitted in exceptional cases if there is only one static coordinate system in which all parts have a fixed position. The ID "zero" is then converted internally into the ID of the sole coordinate system. In all other cases, the reference system "zero" is rejected. Non-valid reference systems (invalid object ID of a part/coordinate system) other than "zero" are always rejected. 16 Version: 1.8.0 TF5430
## Page 17

Planar Motion components 6 Planar Motion components 6.1 Planar mover The Planar mover is a software object that represents an XPlanar mover. It summarizes the state of the real mover (position, velocity, etc.) for the user. In addition, the user has the possibility to influence or control the state of the real mover via the Planar mover. 6.1.1 Configuration ü In order to create a Planar mover, an MC Configuration must first be created. 1. Select MOTION > Add New Item…. 2. In the following dialog box, select MC Configuration and confirm with OK. ð You have created an MC Project. 3. Select MC Project > Axes > Add New Item…. TF5430 Version: 1.8.0 17
## Page 18

Planar Motion components 4. In the following dialog box, create one (or more) Planar movers and confirm with OK. ð The Planar mover is now created and can be parameterized. Open detailed description • Select the Planar mover in the tree and double-click it. Purposes of the individual tabs Object: General information (name, type, ID and so on) is shown here. Parameter (Init): Specifies initial parameters that the user can change in order to affect the behavior of the mover. 18 Version: 1.8.0 TF5430
## Page 19

Planar Motion components Parameter (Init) should be put into simulation mode (TRUE) before parameterizing if no hardware driver is linked. The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. The initial parameters are initially set so that the Planar mover (ready linked) can be moved with the hardware. If the user wants to move without hardware, the "Simulation Mode" parameter must be set to TRUE. In simulation mode, the "Initial Position" and "Part OID" parameters (from version V3.2.60) should be set. If the real mover does not have standard dimensions, the "Mover width" and "Mover height" parameters must be adjusted. From version V3.1.10.30: The hidden "Minimum/Maximum Position" parameters are used to define when the mover switches to the CRotation command mode for the C-axis. For all target positions of C-movements, the "C coordinate modulus" and "C coordinate modulo tolerance window" parameters (the latter for modulo positioning) define the conversion to the absolute target position. For details see Modulo positioning. From version V3.1.10.51: Adopt Track Orientation is also a C-movement and is accordingly influenced by "C coordinate modulus" and "C coordinate modulo tolerance window". For details, see Adopt Track Orientation [} 68]. From version V3.2.60: The "Part OID" parameter specifies the part that the "Initial Position" is located on for the simulation mode. The "Part OID", "Simulation Mode", and "Initial Position" parameters are all hidden and in their own "Simulation" grouping. From version V3.3.19: The default values for the following parameters have been increased: "Minimum/ Maximum Position" of the C-axis (from 10° to 11°) and for the "Maximum Dynamic C" parameter (from [10,100,100,1000] to [7000,7000,7000,35000]). The "Timeout for state machine" parameter specifies the maximum time the mover remains in Enabling, Disabling or Resetting, see "Timeouts of the transition states" in Planar objects state diagram [} 10]. The parameters "Minimal/Maximal Position", " Default /Maximal Dynamic(s)", "C coordinate modulus, "C coordinate modulo tolerance window" and all "Monitoring" parameters (position monitoring/timeout) can be changed in the Enabled state of the mover (previously this was only possible with Disabled). Other parameters are the "Maximum Dynamic(s)" and the "Default Dynamic(s)". In addition, there are "monitoring" parameters that activate or parameterize position monitoring of the real mover. From version V3.3.77: 1. Renaming of existing parameters: The parameters "Maximum dynamic XY" and "Default dynamic XY" have been renamed to "Maximum dynamic path XY" and "Default dynamic path XY". This renaming serves to make it clearer that these TF5430 Version: 1.8.0 19
## Page 20

Planar Motion components dynamic limits apply along the current direction of movement of the mover. This means that the limits apply tangentially to the track when moving along a track or in the direction of movement when moving freely. 2. New parameters added: "Maximum dynamic X" and "Maximum dynamic Y": These new parameters have been introduced. Currently, only the acceleration parameter A has an effect. It is used to set the maximum radial acceleration in curves when the "Acceleration Limited Velocity" option is activated in "Dynamics Reduction Mode" and driving on a track. For details, see Limits and options of the motion commands [} 39] . The default values for the dynamic parameters V, D and J are currently invalid and must remain unchanged as they currently have no effect. Parameter (Online): Shows the state of the mover during the runtime of the object. The current preset position ("Set Pos") and real position ("Act Pos") are displayed along with the state information. From version V3.1.10.30: The parameter "External setpoint generation" indicates whether the mover follows (absolute or relative) external setpoints of the user. From version V3.2.60: The "Coordinate System OID" parameter specifies the coordinate system that Set Pos and Act Pos are specified in and the coordinate system that the mover is located in. Data Area: Shows memory areas via which the mover is linked to other objects and exchanges information. Settings: The user can establish links here. With the two "Link To ..." buttons, the Planar mover can be linked to the movers in the PLC and the XPlanar driver. 6.1.2 Creating a PLC ü A PLC must be created to control the mover, track or group, to create the geometry of an environment or to use Planar Feedback. 1. Select PLC > Add New Item... 20 Version: 1.8.0 TF5430
## Page 21

Planar Motion components 2. In the following dialog box, select Standard PLC Project and confirm with OK. 3. Add the libraries "Tc3_Physics" and "Tc3_Mc3Planar Motion" to the PLC project; see Inserting libraries [} 132]. ð The PLC is created and you can issue commands to the corresponding objects as described in the following examples. 6.1.3 Example: "Creating and moving Planar movers" Using this short guide you will create a Twin CAT project that contains a Planar mover and moves it in a simple way. Creating a Planar mover ü See Configuration [} 17]. 1. Create a Planar mover for this example. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. Creating a PLC ü See preliminary steps Creating a PLC [} 20]. 1. Use MAIN to create the mover(s) ("MC_Planar Mover [} 151]") as follows. TF5430 Version: 1.8.0 21
## Page 22

Planar Motion components ð This/these represent(s) the mover(s) in the MC Configuration. 2. Create a Planar mover, a state variable for a state machine and a target position for a travel command of the mover, as shown below. PROGRAM MAIN VAR mover : MC_Planar Mover; state : UDINT; target_position : Position XYC; END_VAR 3. Then program a sequence in MAIN. ð This program code activates the mover and moves it to position x = 100 and y = 100. CASE state OF 0: mover. Enable(0); state := 1; 1: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: target_position. Set Values XY(100, 100); mover. Move To Position(0, target_position, 0, 0); state := 3; END_CASE Sending the command 4. To send the command, you must call the mover cyclically with its update method after END_CASE: mover. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar mover in the "MC Project" (double-click) can be linked with the Link To PLC... button on the Settings tab. 22 Version: 1.8.0 TF5430
## Page 23

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state=3), the mover is in the desired position. TF5430 Version: 1.8.0 23
## Page 24

Planar Motion components 6.1.4 Example "Moving a Planar mover to Planar parts" In this example, a Planar mover is moved onto two Planar parts. Starting point You start with a solution that contains a fully configured XPlanar Processing Unit. Two parts, a coordinate system and a mover are created under the XPlanar Processing Unit. A tile is created under each of the two parts. The following geometric situation is set: the two parts are next to each other and the mover starts in the middle of the left part (position P1). Both parts are not movable and the configuration is therefore static. The example is developed on the basis of this configuration. 24 Version: 1.8.0 TF5430
## Page 25

Planar Motion components The creation of the initial situation is described in the XPlanar Processing Unit documentation. Creating a Planar mover and a Planar environment 1. Create a Planar mover for this example, see Configuration [} 17]. 2. Create a Planar environment, see Configuration [} 102]. 3. Set the initial parameter XPlanar processing unit OID to the object ID of the XPlanar Processing Unit. This activates the Part feature for all MC Configuration objects (especially for the created Planar mover). Creating a PLC ü See preliminary steps Creating a PLC [} 20]. 1. Use MAIN to create the mover(s) ("MC_Planar Mover [} 151]") as follows. ð This/these represent(s) the mover(s) in the MC Configuration. 2. Create a Planar mover, a state variable for a state machine and a target position for a travel command of the mover, as shown below. PROGRAM MAIN VAR mover : MC_Planar Mover; state : UDINT; target_position : Position XYC; END_VAR 3. Then program a sequence in MAIN. ð This program code activates the mover and moves it to the position x=100 and y=100, which is specified in the part coordinate system of the right part (its object Id is 16#01010030). CASE state OF 0: mover. Enable(0); state := 1; 1: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: target_position. Set Values XYCReference Id(100, 100, 0, 16#01010030); mover. Move To Position(0, target_position, 0, 0); state := 3; END_CASE Sending the command 4. To send the command, you must call the mover cyclically with its update method after END_CASE: mover. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. TF5430 Version: 1.8.0 25
## Page 26

Planar Motion components 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar mover in the "MC Project" (double-click) can be linked with the Link To PLC... button on the Settings tab. ð In addition, the Planar mover in the "MC Project" (double-click) can be linked with the Link To I/O... button on the Settings tab. Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 26 Version: 1.8.0 TF5430
## Page 27

Planar Motion components 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state=3), the mover is in the desired position. The position is specified in the coordinate system and not, like the target_position, in the part coordinate system of the right-hand part (its object Id is 16#01010030). Both systems are shifted by 240 mm in the x-direction. It can also be seen that the axes a, b and z exhibit a slight noise. This is generated by the simulation of the XPlanar Processing Unit and has an effect on the initially accepted position when starting up. 6.1.5 Example: "Creating and moving a Planar mover with auxiliary axes" Using this short guide you will create a Twin CAT project that contains a Planar mover and moves it in a simple way. Creating a Planar mover ü See Configuration [} 17]. 1. Create a Planar mover. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. Creating a PLC ü See preliminary steps Creating a PLC [} 20]. 1. Use MAIN to create the mover(s) ("MC_Planar Mover [} 151]") as follows. TF5430 Version: 1.8.0 27
## Page 28

Planar Motion components ð This/these represent(s) the mover(s) in the MC Configuration. 2. Create a Planar mover, a state variable for a state machine and a target position for a travel command of the mover, as shown below. PROGRAM MAIN VAR mover : MC_Planar Mover; state : UDINT; target_a : LREAL := 1.0; target_b : LREAL := -1.0; target_c : LREAL := 3.0; target_z : LREAL := 5.0; END_VAR 3. Then program a sequence in MAIN. ð This program code activates the mover and moves the four auxiliary axes. CASE state OF 0: mover. Enable(0); state := 1; 1: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: mover. Move A(0, target_a, 0); mover. Move B(0, target_b, 0); // Since Version V3.1.10.11 Move C has an options parameter, // details can be found in the CRotation example // and the options descriptions //mover. Move C(0, target_c, 0); // until version V3.1.10.11 mover. Move C(0, target_c, 0, 0); // since version V3.1.10.30 mover. Move Z(0, target_z, 0); state := 3; END_CASE Further information: • Example "Moving the Planar mover in CRotation mode" [} 37] • Limits and options of the motion commands [} 39] Sending the command 4. To send the command, you must call the mover cyclically with its update method after END_CASE: mover. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. 28 Version: 1.8.0 TF5430
## Page 29

Planar Motion components ð Subsequently, the Planar mover in the "MC Project" (double-click) can be linked with the Link To PLC... button on the Settings tab. Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state=3), the mover is in the desired position. TF5430 Version: 1.8.0 29
## Page 30

Planar Motion components 6.1.6 Example "Creating and moving a Planar mover with External Setpoint Generation" Using this short guide you will create a Twin CAT project that contains a Planar mover and moves it in a simple way by means of external setpoint generation. Creating a Planar mover ü See Configuration [} 17]. 1. Create a Planar mover. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. Creating a PLC ü See preliminary steps Creating a PLC [} 20]. 1. Use MAIN to create the mover(s) ("MC_Planar Mover [} 151]") as follows. ð This/these represent(s) the mover(s) in the MC Configuration. 30 Version: 1.8.0 TF5430
## Page 31

Planar Motion components 2. Create a Planar mover, a state variable for a state machine and variables for the external setpoint, as shown below. PROGRAM MAIN VAR mover : MC_Planar Mover; state : UDINT; p,v,a : Mover Vector; deltat : LREAL := 0.001; velo, acc, jerk : LREAL; END_VAR 3. Then program a sequence in MAIN. ð This program code activates the mover and starts the external setpoint generation. A profile is then followed that ends with a positive velocity. The subsequent stopping of the external setpoint generation ensures that the mover reduces its velocity to zero and is in the Free Movement state after stopping (this is done with the maximum dynamics of the mover). CASE state OF 0: mover. Enable(0); state := 1; 1: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: p.x := 0.0; v.x := 0.0; a.x := 0.0; mover. Start External Setpoint Generation(0,0); mover. Set External Setpoint(p,v,a); state := 3; 3: velo := v.x; acc := a.x; p.x := p.x + deltat * velo + deltat * deltat / 2 * acc + deltat * deltat * deltat / 6 * jerk; v.x := v.x + deltat * acc + deltat * deltat / 2 * jerk; a.x := a.x + deltat * jerk; mover. Set External Setpoint(p,v,a); IF a.x >= 10.0 THEN jerk := -1; END_IF; IF a.x <= 0.0 THEN state := 4; END_IF; 5: mover. Stop External Setpoint Generation(0); state := 6; END_CASE Sending the command 4. To send the commands you need to trigger the update method of the mover after the END_CASE: mover. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar mover in the "MC Project" (double-click) can be linked with the Link To PLC... button on the Settings tab. TF5430 Version: 1.8.0 31
## Page 32

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state = 6), the mover is in the desired positive x-position. 32 Version: 1.8.0 TF5430
## Page 33

Planar Motion components 6.1.7 Example "Moving a Planar mover with External Setpoint Generation to Planar parts" In this example, a Planar mover is moved to two Planar parts with external setpoint generation. Starting point You start with a solution that contains a fully configured XPlanar Processing Unit. Two parts, a coordinate system and a mover are created under the XPlanar Processing Unit. A tile is created under each of the two parts. The following geometric situation is set: the two parts are next to each other and the mover starts in the middle of the left part (position P1). Both parts cannot be moved; the configuration is therefore static. TF5430 Version: 1.8.0 33
## Page 34

Planar Motion components The example is developed on the basis of this configuration. The creation of the initial situation is described in the XPlanar Processing Unit documentation. Creating a Planar mover and a Planar environment 1. Create a Planar mover for this example, see Configuration [} 17]. 2. Create a Planar environment, see Configuration [} 102]. 3. Set the initial parameter XPlanar processing unit OID to the object ID of the XPlanar Processing Unit. This activates the Part feature for all MC Configuration objects (especially for the created Planar mover). Creating a PLC ü See preliminary steps Creating a PLC [} 20]. 1. Use MAIN to create the mover(s) ("MC_Planar Mover [} 151]") as follows. ð This/these represent(s) the mover(s) in the MC Configuration. 2. Create a Planar mover, a state variable for a state machine and variables for the external setpoint, as shown below. PROGRAM MAIN VAR mover : MC_Planar Mover; state : UDINT; p,v,a : Mover Vector; deltat : LREAL := 0.01; refsys : OTCID := 0; velo, acc, jerk : LREAL; feedback : MC_Planar Feedback; END_VAR 3. Then program a sequence in MAIN. ð This program code activates the mover and starts the external setpoint generation. A profile is then followed that ends with a positive velocity. The subsequent stopping of the external setpoint generation ensures that the mover reduces its velocity to zero and is in the Free Movement state after stopping (this is done with the maximum dynamics of the mover). CASE state OF 0: mover. Enable(0); state := 1; 1: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: p := mover. MCTOPLC. SET. Set Pos; v.x := 0.0; a.x := 0.0; mover. Start External Setpoint Generation(0,0); mover. Set External Setpoint Reference Id(feedback,p,v,a,refsys); jerk := 10; 34 Version: 1.8.0 TF5430
## Page 35

Planar Motion components state := 3; 3: velo := v.x; acc := a.x; p.x := p.x + deltat * velo + deltat * deltat / 2 * acc + deltat * deltat * deltat / 6 * jerk; v.x := velo + deltat * acc + deltat * deltat / 2 * jerk; a.x := acc + deltat * jerk; mover. Set External Setpoint Reference Id(feedback,p,v,a,refsys); IF a.x >= 100.0 THEN jerk := -10; END_IF; IF a.x <= 0.0 THEN state := 4; END_IF; 4: mover. Stop External Setpoint Generation(0); state := 5; END_CASE Sending the command 4. To send the commands you need to trigger the update method of the mover after the END_CASE: mover. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar mover in the "MC Project" (double-click) can be linked with the Link To PLC... button on the Settings tab. ð In addition, the Planar mover in the "MC Project" (double-click) can be linked with the Link To I/O... button on the Settings tab. TF5430 Version: 1.8.0 35
## Page 36

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state = 5), the mover is in the desired positive x-position. It has not left the first part, so in this case you could also specify the object ID of the first part or the coordinate system as refsys. If the object ID of the first part is specified and the limit to the second part is exceeded, the object ID of the second part must be used and the x-coordinate reduced by 240 (at the same time!). The object ID of the global coordinate system works regardless of which part the mover is on. As the configuration is static, zero is accepted as an alternative for the global coordinate system ID. 36 Version: 1.8.0 TF5430
## Page 37

Planar Motion components Comments on the feedback: In this example, the feedback was only created and entered in the Set External Setpoint Ref Sys call without doing anything with it. As no errors occur in this example, the feedback is busy from state 2. Otherwise, you should ALWAYS implement error handling with this feedback in order to handle errors such as an incorrect Ref Sys Id for the position. The special feature of this feedback is that it is passed cyclically and the same feedback must be passed in every call. If errors occur in the external setpoint generation, these errors are displayed in the feedback after the next call of Set External Setpoint Ref Sys with feedback. An update call for the feedback is not necessary here. In addition, the feedback is not done when Stop External Setpoint Generation is called, or aborted when Halt is called. Even if the information is available in the feedback after the Set External Setpoint Ref Sys call, the errors do not have to come directly from this call, but can also result from previous calls. 6.1.8 Example "Moving the Planar mover in CRotation Free Movement mode" Using this short guide you will create a Twin CAT project that contains a Planar mover and moves it in a simple way. Creating a Planar mover ü See Configuration [} 17]. 1. Create a Planar mover. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. Creating a PLC ü See preliminary steps Creating a PLC [} 20]. 1. Use MAIN to create the mover(s) ("MC_Planar Mover [} 151]") as follows. TF5430 Version: 1.8.0 37
## Page 38

Planar Motion components ð This/these represent(s) the mover(s) in the MC Configuration. 2. Create a Planar mover, a state variable for a state machine and a target position for a travel command of the mover, as shown below. PROGRAM MAIN VAR mover : MC_Planar Mover; state : UDINT; target_position_c : LREAL; END_VAR 3. Then program a sequence in MAIN. ð This program code activates the mover and rotates it to position c=20. CASE state OF 0: mover. Enable(0); state := 1; 1: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: target_position_c := 20.0; mover. Move C(0, target_position_c, 0, 0); state := 3; END_CASE Sending the command 4. To send the command, you must call the mover cyclically with its update method after END_CASE: mover. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar mover in the "MC Project" (double-click) can be linked with the Link To PLC... button on the Settings tab. Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. The mover is at the end of the state machine (state=3) at the desired (rotated) position and is in command mode CRotation Free Movement, since the angle is greater than 15°. A further movement of the C-axis up to e.g. 90° would change the command mode back to Free Movement after completion of the command. 38 Version: 1.8.0 TF5430
## Page 39

Planar Motion components 6.1.9 Limits and options of the motion commands The Planar mover can execute different types of motion commands. Except for the special case of external setpoint generation, these are similar in structure. The following applies to the rest of the motion commands. The first parameter of the method call is always the feedback for the command that the user transfers. If he transfers a “0”, this implies that he does not want to have (or use) feedback. The next one or two parameters describe the destination of the motion and they cannot be completely omitted. The next parameters are the dynamic limits that should be observed during motion. If the user transfers a “0” here, the default values are used (TCOM parameters of the mover in the MC Project). The last parameter is the option object, which differs depending on the command. Limits Each motion command runs in the optimal time. For the resulting trajectory to be continuous, the time derivatives of the position must be limited. The limits include maximum values for the velocity, positive and negative acceleration, and jerk. If the values specified here exceed the maximum dynamic limits of the mover (TCOM parameters of the mover in the MC Project), they are reduced accordingly, a warning is issued and the command is executed with reduced dynamic values. There is only one Limit or Constraint object. This is understood to be a limitation of the dynamics tangential to the direction of movement of the mover. For external setpoint generation, the only parameters are Feedback and Options. From version V3.1.10.30: The limits should be replaced by Constraints, see Dynamics. Options The options vary depending on the command: Move To Position/Join Track/Leave Track: The only option of these commands is the “Use Orientation” flag. This flag indicates whether or not the C coordinate of the XYC target position should also be used. If not, the C-coordinate can be moved separately via “Move C”. TF5430 Version: 1.8.0 39
## Page 40

Planar Motion components Move On Track: The first option is the “gap”. This numerical value indicates the distance to the mover in front during the motion (and after that until the next motion command on the track). This distance is measured along the track (difference between the track positions of the two movers). Therefore, curvatures in the track must be taken into account, as they reduce the real 2D distance. The gap is calculated from center to center, therefore the width of the movers must be taken into account. The second option is “Direction”, the direction of travel on the track towards the destination. This can assume the values “Non Modulo” (= absolute), “Positive” (= forward), “Shortest Way” (= shortest way) and “Negative” (= backward). If the destination is reachable in the appropriate direction, the command is executed. From version V3.1.10.30: The third option is “Additional Turns”: the number of additional laps driven on a “Closed Loop” track with “Direction” “Positive” or “Negative”. For other “Direction” cases, “Additional Turns” must be zero. The fourth option is “Modulo Tolerance”. This parameter is used to avoid unintended rotations when the start and target positions are very similar. If the distance between the start and target position is less than or equal to the “Modulo Tolerance”, the target position is approached by the shortest route (as with “Direction” = “Shortest Way”), i.e. against the specified “Direction”. For the “Direction” “Non Modulo” the Modulo Tolerance must be zero. For details, see Modulo positioning. From version V3.3.39: The sixth option is the “Gap Mode”. This setting can be set to either “Standard1D” or “Fast1D”. Standard1D: This is the default value and corresponds to the previous behavior. This mode generally results in the distance between two movers being greater than the minimum gap passed as the “Gap” option. The distance between two movers typically increases with greater velocity. This causes a mover chain to fan out while driving. NOTICE Damage due to possible collisions Please note that changing the parameters during movement can cause damage under the following conditions. Reducing one or more of the dynamic parameters A, D or J during the movement may result in a violation of the parameterized minimum “Gap”. However, in this mode, any increase in one or more of these parameters can be made without causing such a violation. Similarly, the dynamic parameter V can be changed in this mode without causing such a violation. Fast1D: This is a new mode that aims to intervene in the motion profiles as late as possible without falling below the distance set as the “Gap” option. This typically results in smaller distances between neighboring movers during movement than in “Standard1D” mode. This allows mover chains to be moved more quickly. NOTICE Damage due to possible collisions Please note that changing the parameters during movement can cause damage under the following conditions. Any changes (i.e. both increases and decreases) to one or more of the dynamic parameters A, D or J during movement may result in a violation of the minimum “Gap”. As in “Standard1D” mode, the dynamic parameter V can be changed as required in this mode without causing such a violation. From version V3.3.77: The fifth option is the "Dynamics Reduction Mode". This function can be used to automatically adjust the dynamic behavior of a mover along a track, for example to limit radial acceleration in curves. This setting has two possible values: "None" and "Acceleration Limited Velocity". None: This is the default value and corresponds to the previous behavior. In this mode, the mover does not experience any additional restriction of the dynamics due to external conditions. The mover moves with the dynamic parameters defined for it without any additional adjustments. Acceleration Limited Velocity: This new mode ensures that a defined maximum radial acceleration in curves is not exceeded. This is achieved by reducing the tangential speed of the mover according to the current curve radius of the track. It is necessary that the limits in the X and Y directions of the mover are set the same. An error is output if the limits are set differently and as soon as a movement is started on a track. An example can be found under Coupling planar mover to track and moving it with Dynamics Reduction Mode [} 60]. 40 Version: 1.8.0 TF5430
## Page 41

Planar Motion components Higher overall acceleration possible Only the radial acceleration is reduced. The overall acceleration can still be higher, for example if the mover also accelerates tangentially in a curve. From version V3.1.10.30: Move C: The first option is “Additional Turns”: the number of additional whole C- turns related to the “C coordinate modulus” parameter of the mover with “Direction” “Positive” or “Negative”. For other “Direction” cases, “Additional Turns” must be zero. The second option is “Direction”: the direction of rotation of the C coordinate towards the target. This can assume the values “Non Modulo” (= absolute), “Positive” (= forward), “Shortest Way” (= shortest way) and “Negative” (= backward). For details, see Modulo positioning. From version V3.1.10.51: Adopt Track Orientation: The first option is “Additional Turns”: The number of additional whole C-turns related to the “C coordinate modulus” parameter of the mover with “Direction”, “Positive”, or “Negative”. For other “Direction” cases, “Additional Turns” must be zero. The second option is “Direction”: the direction of rotation of the C-coordinate towards the target. This can assume the values “Non Modulo” (= absolute), “Positive” (= forward), “Shortest Way” (= shortest way) and “Negative” (= backward). For details, see Modulo positioning. From version V3.1.10.44: Gear In Pos On Track: The first option is the “Gap”, which has the same interpretation here as with Move On Track. The second parameter is the “In Sync Tolerance Distance”. It specifies how far the master and slave may move away from each other before the active Planar mover loses its synchronicity. The following two options are “Direction” and “Modulo Tolerance”, which both refer to the parameter “Slave Sync Position” (as input at the function call). These options are only available if the Planar track that the Planar mover performs its synchronization movement on is a closed loop. In this case, the interpretation of these options is analogous to that for Move C, where here the modulus is given by the length of the Planar track. For details, see Modulo positioning. The last parameter “Allowed Slave Sync Directions” specifies in which direction, i.e. positive (default), negative or both, the Planar mover is allowed to move during the synchronization phase. This parameter can be used, for example, to prevent a back oscillation, which would occur with the option “Both”, in order to achieve the fastest possible synchronization. If the Planar mover is in sync, or has been in sync, and is currently trying to get back in sync, this parameter has no further effect. From version V3.1.10.30: Gear In Pos On Track With Master Mover: The first four options, “Gap”, “In Sync Tolerance Distance”, as well as the two modulo options for the Slave Sync Position, are identical to the first four options of the Gear In Pos On Track command in terms of their meaning. This is followed by two parameters “Direction” and “Modulo Tolerance” for the Master Sync Position, which are available in the same way as the modulo parameters for the Slave Sync Position when the Master Planar Mover is on a closed-loop track. The following option “Allowed Slave Sync Directions” has exactly the same function as the Gear In Pos On Track command. If the last option, “Follow Mover”, is set, it ensures that the Slave Planar Mover does not necessarily have to obtain a Planar Track Trail [} 127] to know which Planar tracks it will perform its movement over. The Slave Planar Mover will simply follow the Master Planar Mover as it moves through the network. If the Master Planar Mover and the Slave Planar Mover are on different Planar tracks when the motion command is received and the “Follow Mover” option is set, the slave will try to reach the Planar track that the Master Sync Position is commanded on by the shortest route. In addition to the “Follow Mover” option, a Planar Track Trail can be specified for the Slave Planar Mover. In this case, it is used to command the path to the Planar track that the Master Sync Position lies on (e.g. if it is to deviate from the shortest path). If it does not fully reach this Planar track, the remaining path is filled with the shortest route. If a Planar Track Trail is specified when the “Follow Mover” option is set, the Slave Sync Position can be specified on a different Planar track than its initial one. In general, the following rule applies: if the “Follow Mover” option is set, the Slave Planar Mover follows the master from the Planar track that the Master Sync Position is located on, regardless of whether a Planar Track Trail object has been specified. Addition version V3.1.10.30 – Option was already available before with a different type: Start External Setpoint Generation: Here the user has the choice between the mode “Absolute” and “Relative”. In absolute mode, the mover follows only the external setpoints specified by the user and is in External Setpoint Generation command mode; otherwise, the mover is in any other command mode and adds the user's external setpoints as an offset to its current setpoint. TF5430 Version: 1.8.0 41
## Page 42

Planar Motion components 6.2 Planar track The Planar track is a software object that represents a (virtual) one-dimensional path on the two-dimensional XPlanar stator surface. Several Planar movers can be lined up and moved on this path. Collisions are prevented by keeping a preset distance between the movers. 6.2.1 Configuration ü In order to create a Planar track, an MC Configuration must first be created. 1. Select MOTION > Add New Item…. 2. In the following dialog box, select MC Configuration and confirm with OK. ð You have created an MC Project. 3. Select MC Project > Groups > Add New Item…. 4. In the following dialog box, create one (or more) Planar tracks and confirm with OK. 42 Version: 1.8.0 TF5430
## Page 43

Planar Motion components ð The Planar track is now created and can be parameterized. Open detailed description • Select the Planar track in the tree and double-click it. Purposes of the individual tabs Object: General information (name, type, ID and so on) is shown here. Parameter (Init): Specifies initial parameters that the user can change in order to affect the behavior of the track. The initial parameters are first set so that the Planar track (ready linked) can be traversed with the hardware. If the movers on the track are larger or smaller, the two "Maximum mover width/height" parameters should be adjusted. The parameter "Check collision against static objects" determines whether a track in a Planar group is checked for collisions with other static objects (tracks/edge of the stator surface). The parameter "Collision range mode" determines whether the "Collision range at start/end" is specified by the user via the TF5430 Version: 1.8.0 43
## Page 44

Planar Motion components corresponding parameters or whether it is automatically calculated internally by the track. The "Collision range" is the distance from the start/end of the track from which a Planar mover is taken into account for collision avoidance for Planar movers on other tracks. From version V3.1.10.44: The parameters "Geometric information", "Closed loop", "Starts from tracks" and "Ends at tracks" can be used to define the geometry of the track and its connection to other tracks. The parameters act exactly like the corresponding PLC commands. From version V3.2.60: The "Part OID" parameter specifies which part this track is permanently assigned to. If there is a unique part or the part feature is not used (no reading of the processing unit by the environment), the parameter does not need to be set. Otherwise, the parameter must be set so that the track starts. All positions in the Init and online parameters (Geometric [online] information) are specified in this part system. The "Starts from tracks" and "Ends at tracks" parameters have been extended to reflect the additional functionality of the corresponding PLC commands for the part feature. Parameters (Online): Shows the state of the track at runtime, e.g. the number of Planar movers or the length. From version V3.1.10.30: The parameters "Previous Tracks" and "Subsequent Tracks" are arrays that contain the OIDs of all tracks directly before or directly after this track. From version V3.1.10.44: The "Geometric online information" parameter shows the geometry of the track available at runtime. This results from the corresponding initial parameter and/or the PLC commands used. From version V3.2.1: The "Closed loop online information" parameter specifies whether the track forms a closed loop (a circle). Data Area: Shows the memory area via which the track communicates with the PLC track. 6.2.2 Track networks and collision avoidance Tracks and track networks Tracks are user-specified static paths on the stator surface. Multiple tracks can be connected continuously (including direction and curvature) at one point so that movers can switch from one track to another. If more than two tracks are connected at one point in such a way, a switch is created there. This allows you to create a network of contiguous tracks. A mover can move both forward and backward on a single track. A transition to another track can only be done from a track end to a track start, not the other way around. Collision avoidance in a track network Movers that move on a track network avoid collisions with other movers in the same track network. Excluded from this are places where tracks cross without a switch or pass too close to each other or lead past themselves (see illustrations). Such configurations should be avoided. 44 Version: 1.8.0 TF5430
## Page 45

Planar Motion components Negative examples: This is no switch. Each mover has a minimum gap set for it, which it must maintain to the mover in front of it on its path. This gap is measured between the positions of the movers on the track and can be reset with each travel command. In the vicinity of a switch, a mover must, if necessary, additionally pay attention to potential collisions with movers that are located on other tracks connected to the switch, even if these tracks are not part of the planned path of the mover. Whether this additional collision avoidance is active for a mover at a point in time depends on four factors: • the current position of the mover, • the earliest possible resting position of the mover (resulting from the current dynamics and dynamic limits), • the set gap of the mover, • the corresponding Collision Range parameter of the current track. If the distance between the current position and the earliest possible resting position of the mover is at any point less than Gap + Collision Range from the switch, the additional collision avoidance for this mover is active. If this is the case, all other movers for which this condition is also met are included in the dynamic planning. TF5430 Version: 1.8.0 45
## Page 46

Planar Motion components Definition of the Collision Ranges The importance of the Collision Range parameters for collision avoidance was described in the previous section. “Collision Range at start” refers to the distance to the switch at the starting point of the track and “Collision Range at end” refers to the distance to the switch at the end point of the track. A more intuitive understanding of the Collision Range parameters arises from the following recommendation: the Collision Range should be set so that a mover that is at this distance from the associated switch (at the start or end of the track) cannot collide with movers on other tracks that connect to the switch. In order to simplify the configuration, the corresponding values for the Collision Ranges are automatically calculated and applied when the “Collision range mode” parameter is set to “Automatic”. If “Manual” is selected instead of “Automatic”, the values entered by the user are used instead. If these are set too small, this may result in collisions. If, on the other hand, they are set much too large, movers may block one another on different tracks that are actually far apart and cannot collide at all. If a track at the starting point (end point) either has no switch, or if no other tracks start (end) at the switch, the corresponding Collision Range can be set to 0. Examples and illustrations: In this example, the “Collision range at end” for track 1 can be set to zero, because, although two other tracks start at the switch, no other tracks end. The parameter “Collision range at start” for tracks 2 and 3 should be set so that a mover with this distance to the switch cannot collide with movers on the respective other track. Collision Range Collision Range Example of the determination of meaningful Collision Range parameters (T1, T2 and T3 end at the start of T4): If R is the maximum mover radius of movers on the track, a “hose” with radius 2*R can be placed around a track (in this case around track 2) in order to determine a minimum for the Collision Ranges on the other tracks. In this example, track 1 has a smaller “Collision range at end” as it quickly moves away from the other tracks and track 3 and track 2 have a larger “Collision range at end” as they run close together for longer. T1 Collision Range at end (Track 1) M1 Gap (Mover 2) T3 M2 T2 In this example, the additional collision avoidance at the switch is active for Mover 1, since its distance to the switch alone is smaller than the set Collision Range. Mover 2 is standing still in this example and is further away from the switch than Gap or Collision Range. The additional collision avoidance is therefore not active and the two movers do not have to take each other into consideration at this time. 46 Version: 1.8.0 TF5430
## Page 47

Planar Motion components T1 Collision Range at end (Track 1) M1 T3 Gap (Mover 2) M2 (v>0) T2 In this example, mover 1 is on track 1 within the Collision Range, so mover 1 blocks the movement of mover 2 to track 3. Mover 2 stops exactly at the start of the Collision Range of track 2, as this is the last safe stopping point. If the gap between mover 1 and mover 2 would allow it, mover 2 would move to a correspondingly later stop. T1 Collision Range at end (Track 1) M1 T3 Gap (Mover 2) M2 (v>0) T2 In this example, mover 1 is on track 1 within the Collision Range, so mover 1 blocks the movement of mover 2 to track 3. Mover 2 stops exactly at the distance of its gap to the end of track 2. If the gap between mover 1 and mover 2 would allow it, mover 2 would move to a correspondingly later stop. In the last two examples, mover 2 moves on when mover 1 has moved so far forward that both movers have a minimum distance that is greater than the gap between the two movers. Gap (Mover 2) T2 M2 M1 T1 T3 In this example, mover 2 is further away from the switch than the Gap or Collision Range, so mover 1 can drive onto track 3 unhindered. If mover 2 moves back, a blockage may occur if the distance to the switch is less than the Gap or Collision Range. TF5430 Version: 1.8.0 47
## Page 48

Planar Motion components This is an example of a design to be avoided where the end of a track (in this case T2) affects the Collision Range at the start of another track (T3) (and vice versa). In the case of Automatic Collision Range Mode, such a situation is not detected. If it is still desired, however, a manual adjustment of the Collision Ranges is necessary here. However, Tracks with such tight curves as T2 in this example are also strongly discouraged due to the strong limitation of the dynamics (tight curves generate large centrifugal forces even when driving through at low velocities). 6.2.3 Geometric definition Planar tracks are defined step-by-step using connected straight lines, arcs and points. The connection between these elements is made automatically via C2-continuous interpolation (“blending”). • Straight lines are defined via a start and an end point, see Append Line. • Arcs are defined by a start, an end and a center point and by specifying the direction clockwise or counterclockwise, see Append Circle. • Positions are only defined via a point, see Append Position. Example In the following example, the automatically generated parts of the track are shown in red. PROGRAM MAIN VAR track : MC_Planar Track; pos1, pos2 : Position XYC; center : Position XY; state : UDINT; END_VAR CASE state OF 0: pos1. Set Values XY(0, 0); pos2. Set Values XY(400, 0); track. Append Line(0, pos1, pos2); pos1. Set Values XY(450, 50); pos2. Set Values XY(450, 450); track. Append Line(0, pos1, pos2); pos1. Set Values XY(450, 500); pos2. Set Values XY(550, 500); center. Set Values XY(500, 500); track. Append Circle(0, pos1, pos2, center, TRUE); pos1. Set Values XY(600, 400); pos2. Set Values XY(700, 150); track. Append Line(0, pos1, pos2); pos1. Set Values XY(600, 50); track. Append Position(0, pos1); 48 Version: 1.8.0 TF5430
## Page 49

Planar Motion components pos1. Set Values XY(700, 0); pos2. Set Values XY(900, 0); track. Append Line(0, pos1, pos2); END_CASE 6.2.4 Tracks and parts From version V3.2.60: The Part feature, which is the subject of this section, is available. Tracks can be used together with parts, but there are a few special features to bear in mind: • A track is always permanently assigned to a single part. This is done via the initial parameter "Part OID". • The track must be geometrically complete on the corresponding part. • The track has a fixed static geometry relative to its part. So if the position of his part changes, the position of the track changes accordingly. • If more than one part exists in the configuration, the initial parameter "Part OID" must be specified, otherwise (each) track is automatically assigned to the only part. • Tracks on the same part can be easily connected. The start and end of each track can only be connected to another track once. This means that Start From Track [} 174] and End At Track [} 175] can be successfully called up a maximum of once per track. • Tracks on different parts can only be connected if the connection between them lies exactly on the boundary of both parts. This means that the start or end of one of the two tracks must already be on the part boundary so that the other can be connected. This connection can only be crossed if both parts are at this point. If one of the parts is moved to a different position, the connection can no longer be crossed (like any open end of a track). In this case, however, both tracks can be connected to other tracks on other parts in other positions. To close all these different connections between tracks, the methods Start From Track [} 174] and End At Track [} 175] can be called more than once for each track. TF5430 Version: 1.8.0 49
## Page 50

Planar Motion components In this example, parts 1 and 2 are static. Part 3 has 2 positions, so that it is connected once to part 1 and once to part 2. Once tracks 1 and 2 have been defined on parts 1 and 2, track 3 on part 3 can be connected to both. Depending on the direction of the tracks, either track 3 must be connected to positions 1 and 2 (or tracks 1 and 2) with two Start From Track [} 174] calls or with two End At Track [} 175] calls. The first call defines the geometry and a logical connection of the start or end of track 3, while the second call only defines a logical connection and only assumes (and checks) that the geometric connection is suitable. 50 Version: 1.8.0 TF5430
## Page 51

Planar Motion components In this example, part 1 is static and part 3 has 2 positions so that it touches part 1 at different points. After track 3 is defined, it is unclear how to interpret a End At Track [} 175] from track 1 to track 3. Should track 1 be geometrically connected to track 3 in the upper or lower configuration? This can be realized with the new methods End At Track Advanced [} 176] and Start From Track Advanced [} 175]. The exact position of the two parts of the tracks involved is specified in order to connect the tracks in this configuration. 6.2.5 Example "Joining and moving a Planar mover on the track" Using this guide, you will to create a Twin CAT project that contains two Planar movers and one Planar track. Both movers are joined and moved on the track. Creating a Planar mover ü See Configuration [} 17]. 1. Create two Planar movers. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. 3. Change the start position of the second mover to x = 240. Creating a Planar track 4. Add the Planar track via Groups > Add New Item…, see Configuration [} 42]. Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. TF5430 Version: 1.8.0 51
## Page 52

Planar Motion components 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. ð These represent movers and tracks in the MC Configuration. 2. Create two Planar movers, a Planar track, a state variable for a state machine and two auxiliary positions for the track, as shown below. PROGRAM MAIN VAR mover_one, mover_two : MC_Planar Mover; track : MC_Planar Track; state : UDINT; pos1, pos2 : Position XYC; END_VAR 3. Then program a sequence in MAIN. ð This program code creates and activates a track and both movers. After that, both movers are joined and moved on the track. CASE state OF 0: pos1. Set Values XY(0, 0); pos2. Set Values XY(400, 0); track. Append Line(0, pos1, pos2); track. Enable(0); state := 1; 1: IF track. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: mover_one. Enable(0); mover_two. Enable(0); state := 3; 3: IF mover_one. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled AND mover_two. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 4; END_IF 4: mover_one. Join Track(0, track, 0, 0); mover_two. Join Track(0, track, 0, 0); state := 5; 5: IF mover_one. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track AND mover_two. MCTOPLC. STD. Command Mode=MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := 6; END_IF 6: mover_one. Move On Track(0, 0, 150.0, 0, 0); mover_two. Move On Track(0, 0, 350.0, 0, 0); state := 7; 7: IF mover_one. MCTOPLC. SETONTRACK. Set Pos >= 149.9 AND mover_two. MCTOPLC. SETONTRACK. Set Pos >= 349.9 THEN state := 8; END_IF END_CASE 52 Version: 1.8.0 TF5430
## Page 53

Planar Motion components Sending the command 4. To send the command, you must call the movers and the track cyclically with their update method after the END_CASE: mover_one. Update(); mover_two. Update(); track. Update(); Building the PLC creates symbols of the "PLC mover" and “track”, which can then be linked to the mover and track instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar movers in the "MC Project" can be linked with the Link To PLC... button on the Settings tab. ð The track must be linked separately via the following dialog boxes. TF5430 Version: 1.8.0 53
## Page 54

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state=8), the movers are in the desired positions. 54 Version: 1.8.0 TF5430
## Page 55

Planar Motion components 6.2.6 Example "Moving Planar movers on tracks with Planar parts" In this example, a Planar mover is moved on two Planar tracks over two Planar parts. Starting point You start with a solution that contains a fully configured XPlanar Processing Unit. Two parts, a coordinate system and a mover are created under the XPlanar Processing Unit. A tile is created under each of the two parts. TF5430 Version: 1.8.0 55
## Page 56

Planar Motion components The following geometric situation is set: the two parts are next to each other and the mover starts in the middle of the left part (position P1). Both parts are not movable and the configuration is therefore static. The example is developed on the basis of this configuration. The creation of the initial situation is described in the XPlanar Processing Unit documentation. Creating Planar movers, Planar tracks and Planar environment 1. Create a Planar mover for this example, see Configuration [} 17]. 2. Create a Planar environment, see Configuration [} 102]. 56 Version: 1.8.0 TF5430
## Page 57

Planar Motion components 3. Set the initial parameter XPlanar processing unit OID to the object ID of the XPlanar Processing Unit. This activates the Part feature for all MC Configuration objects (especially for the created Planar mover). 4. Add two Planar tracks via Groups > Add New Item…, see Configuration [} 42]. 5. Set the initial parameter “Part OID” of the two tracks to the corresponding part; in this example, the first track is set to part 1 and the second track to part 2. Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. ð These represent movers and tracks in the MC Configuration. 2. Create a Planar mover, two Planar tracks, a state variable for a state machine and two auxiliary positions for the tracks, as shown below. PROGRAM MAIN VAR mover : MC_Planar Mover; track_one, track_two : MC_Planar Track; state : UDINT; pos1, pos2 : Position XYC; END_VAR 3. Then program a sequence in MAIN. ð This program code creates and activates two tracks and the mover. The mover is then coupled onto the first track and driven onto the second track, crossing the boundary between Part 1 and Part 2. CASE state OF 0: pos1. Set Values XYCReference Id(40, 120, 0, 16#01010060); pos2. Set Values XYCReference Id(240, 120, 0, 16#01010060); track_one. Append Line(0, pos1, pos2); track_two. Start From Track(0, track_one); pos1. Set Values XYCReference Id(260, 120, 0, 16#01010060); pos2. Set Values XYCReference Id(440, 120, 0, 16#01010060); track_two. Append Line(0, pos1, pos2); track_one. Enable(0); track_two. Enable(0); state := 1; 1: IF track_one. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled AND track_two. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: mover. Enable(0); state := 3; 3: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 4; END_IF 4: mover. Join Track(0, track_one, 0, 0); state := 5; 5: IF mover. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN TF5430 Version: 1.8.0 57
## Page 58

Planar Motion components state := 6; END_IF 6: mover. Move On Track(0, track_two, 150.0, 0, 0); state := 7; END_CASE Sending the command 4. To send the command, you must call the movers and the track cyclically with their update method after the END_CASE: mover. Update(); track_one. Update(); track_two. Update(); Building the PLC creates symbols of the "PLC mover" and “track”, which can then be linked to the mover and track instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar movers in the “MC Project” can be linked with the Link To PLC... button on the Settings tab. ð In addition, the Planar mover in the “MC Project” (double-click) can be linked with the Link To I/O... button on the Settings tab. 58 Version: 1.8.0 TF5430
## Page 59

Planar Motion components The tracks must be linked separately via the following dialog boxes. Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . TF5430 Version: 1.8.0 59
## Page 60

Planar Motion components 4. Start the PLC via the Play button in the menu bar. The mover is at the end of the state machine (state=7) on the second track on part two. The positions of the Append Line commands were specified in the global coordinate system, as was the end position of the mover. 6.2.7 Example "Couple planar mover to track and moving it with Dynamics Reduction Mode" Using these instructions, you will create a Twin CAT project that contains a planar mover and a planar track with a curve. The mover is coupled to the track and moved with the "Acceleration Limited Velocity" option of the Dynamics Reduction Mode. Creating a Planar mover ü See Configuration [} 17]. 1. Create a Planar mover. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. Creating a Planar track 3. Add the Planar track via Groups > Add New Item…, see Configuration [} 42]. Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 60 Version: 1.8.0 TF5430
## Page 61

Planar Motion components 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. ð These represent movers and tracks in the MC Configuration. 2. As shown below, create a planar mover, a planar track, a state variable for a state machine as well as two auxiliary positions and a variable for the approximate curve radius of the track. Declare a feedback to be able to monitor the course of the command and an option variable to adjust the Dynamics Reduction Mode. In addition, create three auxiliary variables to measure the time required and one auxiliary variable to check the maximum speed in the curve. PROGRAM MAIN VAR mover : MC_Planar Mover; track : MC_Planar Track; state : UDINT := 0; pos1, pos2 : Position XYC; approx_radius : LREAL := 10; feedback : MC_Planar Feedback; options : ST_Move On Track Options; max_velo_in_curve : LREAL := 0; start_time, end_time, elapsed_time : TIME; END_VAR 3. Then program a sequence in MAIN ð This program code creates and activates a track and both movers. Both movers are then coupled to the track and moved. CASE state OF pos1. Set Values XY(0, 0); pos2. Set Values XY(400, 0); track. Append Line(0, pos1, pos2); pos1. Set Values XY(400 + approx_radius, approx_radius); pos2. Set Values XY(400 + approx_radius, 400 + approx_radius); track. Append Line(0, pos1, pos2); track. Enable(0); state := 1; 1: IF track. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: mover. Enable(0); state := 3; 3: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 4; END_IF 4: mover. Join Track(0, track, 0, 0); state := 5; 5: IF mover. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := 6; END_IF 6: options.dynamic Mode := MC. MC_DYNAMICS_REDUCTION_MODE. Acceleration Limited Velocity; mover. Move On Track(feedback, 0, track. Get Length(), 0, options); start_time := TIME(); state := 7; 7: TF5430 Version: 1.8.0 61
## Page 62

Planar Motion components IF mover. MCTOPLC. SETONTRACK. Set Pos >= 400.0 AND mover. MCTOPLC. SETONTRACK. Set Pos <= 400.0 + PI*approx_radius/2 AND mover. MCTOPLC. SETONTRACK. Set Velo > max_velo_in_curve THEN max_velo_in_curve := mover. MCTOPLC. SETONTRACK. Set Velo; END_IF IF mover. MCTOPLC. SETONTRACK. Set Pos >= track. Get Length()-1.0 AND NOT mover. MCTOPLC. STD. Busy.busy Mover THEN state := 8; END_IF 8: end_time := TIME(); elapsed_time := end_time - start_time; state := 9; END_CASE Sending the command 4. To send the command, you must call the movers and the track cyclically with their update method after the END_CASE: mover. Update(); track. Update(); feedback. Update(); Building the PLC creates symbols of the "PLC mover" and “track”, which can then be linked to the mover and track instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar movers in the “MC Project” can be linked with the Link To PLC... button on the Settings tab. ð The track must be linked separately via the following dialog boxes. 62 Version: 1.8.0 TF5430
## Page 63

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. In this example, a track is created that contains a curve that is parameterized by the approximated radius "approx_radius". The mover moves along this track, whereby the dynamics are limited to a speed that ensures that the maximum radial acceleration is not exceeded. This maximum radial acceleration "max_radial_acc" is set in the mover configuration via the "A" acceleration values of the "Maximum Dynamic X/Y" parameter [} 19]. Both values must be the same, otherwise the command will be rejected. The parameters can be written using ADSWRITE, as in the example above. As before, the tangential acceleration "max_total_acc" is parameterized directly on the movement command. The maximum total acceleration "max_total_acc" results from the specified maximum radial and tangential accelerations. This can be greater than either of the two individual accelerations. In the example, the maximum speed within the curve is monitored and saved during the movement. As soon as the mover reaches the end of the track, the elapsed time is measured. Changes to the parameters for the radial acceleration "Maximum dynamic X/ Maximum dynamic Y", the approximated curve radius "approx_radius" and the "Dynamics Reduction Mode" influence both the time "elapsed_time" required for the movement along the track and the maximum speed in the curve "max_velo_in_curve". TF5430 Version: 1.8.0 63
## Page 64

Planar Motion components 6.2.8 Example "Coupling a Planar mover to a track and moving it in CRotation On Track mode" Using this guide, you will to create a Twin CAT project that contains two Planar movers and one Planar track. Both movers are joined and moved on the track. Creating a Planar mover ü See Configuration [} 17]. 1. Create two Planar movers. 2. Put “Parameter (Init)” into simulation mode (TRUE). The parameter is hidden and only becomes visible if the “Show Hidden Parameters” checkbox is activated. 3. Change the start position of the second mover to x = 240. Creating a Planar track 4. Add the Planar track via Groups > Add New Item…, see Configuration [} 42]. Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. ð These represent movers and tracks in the MC Configuration. 2. Create two Planar movers, a Planar track, a state variable for a state machine and two auxiliary positions for the track, as shown below. 64 Version: 1.8.0 TF5430
## Page 65

Planar Motion components PROGRAM MAIN VAR mover_one, mover_two : MC_Planar Mover; track : MC_Planar Track; state : UDINT; pos1, pos2 : Position XYC; join_track_options : ST_Join Track Options; END_VAR 3. Then program a sequence in MAIN. ð This program code creates and activates a track and both movers. Then both movers are coupled on the track and rotated. CASE state OF 0: pos1. Set Values XY(0, 0); pos2. Set Values XY(400, 0); track. Append Line(0, pos1, pos2); track. Enable(0); state := 1; 1: IF track. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: mover_one. Enable(0); mover_two. Enable(0); state := 3; 3: IF mover_one. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled AND mover_two. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 4; END_IF 4: join_track_options.use Orientation := FALSE; mover_one. Join Track(0, track, 0, join_track_options); mover_two. Join Track(0, track, 0, join_track_options); state := 5; 5: IF mover_one. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track AND mover_two. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := 6; END_IF 6: mover_one. Move C(0, 20.0, 0, 0); mover_two. Move C(0, 90.0, 0, 0); state := 7; 7: IF mover_one. MCTOPLC. SET. Set Pos.c >= 19.9 AND mover_two. MCTOPLC. SET. Set Pos.c >= 89.9 THEN state := 8; END_IF END_CASE Sending the command 4. To send the command, you must call the movers and the track cyclically with their update method after the END_CASE: mover_one. Update(); mover_two. Update(); track. Update(); Building the PLC creates symbols of the "PLC mover" and “track”, which can then be linked to the mover and track instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. TF5430 Version: 1.8.0 65
## Page 66

Planar Motion components ð Subsequently, the Planar movers in the “MC Project” can be linked with the Link To PLC... button on the Settings tab. ð In addition, the Planar mover in the “MC Project” (double-click) can be linked with the Link To I/O... button on the Settings tab. The track must be linked separately via the following dialog boxes. 66 Version: 1.8.0 TF5430
## Page 67

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state=8), the movers are in the desired positions. Mover two is (again) in the On Track state and mover one is in the CRotation On Track state after both were in the CRotation On Track state during the movement. Mover one can now only continue to rotate, while mover two can continue to move on the track or even leave the track. TF5430 Version: 1.8.0 67
## Page 68

Planar Motion components 6.2.9 Example "Coupling a Planar mover to a track and moving it with Adopt Track Orientation" Using this guide, you will to create a Twin CAT project that contains two Planar movers and one Planar track. Both movers are joined and moved on the track. Creating a Planar mover ü See Configuration [} 17]. 1. Create two Planar movers. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. 3. Change the start position of the second mover to x = 240. Creating a Planar track 4. Add the Planar track via Groups > Add New Item…, see Configuration [} 42]. Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. 68 Version: 1.8.0 TF5430
## Page 69

Planar Motion components ð These represent movers and tracks in the MC Configuration. 2. Create two Planar movers, a Planar track, a state variable for a state machine and two auxiliary positions for the track, as shown below. PROGRAM MAIN VAR mover_one, mover_two : MC_Planar Mover; track : MC_Planar Track; state : UDINT; pos1, pos2 : Position XYC; join_track_options : ST_Join Track Options; END_VAR 3. Then program a sequence in MAIN. ð This program code creates and activates a track and both movers. Then both movers are coupled on the track and rotated. CASE state OF 0: pos1. Set Values XY(0, 0); pos2. Set Values XY(400, 0); track. Append Line(0, pos1, pos2); track. Enable(0); state := 1; 1: IF track. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: mover_one. Enable(0); mover_two. Enable(0); state := 3; 3: IF mover_one. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled AND mover_two. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 4; END_IF 4: join_track_options.use Orientation := TRUE; mover_one. Join Track(0, track, 0, join_track_options); mover_two. Join Track(0, track, 0, join_track_options); state := 5; 5: IF mover_one. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track AND mover_two. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := 6; END_IF 6: mover_one. Move C(0, 20.0, 0, 0); mover_two. Move C(0, 190.0, 0, 0); state := 7; 7: IF mover_one. MCTOPLC. SET. Set Pos.c >= 19.9 AND NOT mover_one. MCTOPLC. STD. Busy.busy Mover AND mover_two. MCTOPLC. SET. Set Pos.c >= 189.9 AND NOT mover_two. MCTOPLC. STD. Busy.busy Mover THEN state := 8; END_IF 8: mover_one. Adopt Track Orientation(0, 0, 0); TF5430 Version: 1.8.0 69
## Page 70

Planar Motion components mover_two. Adopt Track Orientation (0, 0, 0); state := 9; END_CASE Sending the command 4. To send the command, you must call the movers and the track cyclically with their update method after the END_CASE: mover_one. Update(); mover_two. Update(); track. Update(); Building the PLC creates symbols of the "PLC mover" and “track”, which can then be linked to the mover and track instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar movers in the "MC Project" can be linked with the Link To PLC... button on the Settings tab. ð The track must be linked separately via the following dialog boxes. Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. 70 Version: 1.8.0 TF5430
## Page 71

Planar Motion components Both movers are added to the track with orientation coupled to the track. Afterwards the orientation is decoupled from the track by a Move C. At the end of the state machine (state=9), the movers are in the desired positions. Both movers are (again) in the On Track state and have the orientation coupled to the track again by the Adopt Track Orientation command. The command has 3 parameters: first, an optional Feedback object, second, an optional Constraints object, and third, an optional Options object. 6.2.10 Example "Synchronizing a Planar mover on a track with one axis" Using these instructions, you will create a Twin CAT project in which a Planar mover located on a track is coupled to an axis whose setpoints it then follows. In this case, the Planar mover is not controlled directly by a Move On Track command, in which a specified target position is approached with subsequent halt, see Example "Joining and moving a Planar mover on the track" [} 51]. Instead, the Planar mover remains coupled to an axis until a subsequent command terminates this coupling, or an error occurs. After sending the Gear In Pos On Track [} 156] command that initiates the coupling to an axis, the Planar mover will attempt to be at the specified slave Sync Position if the axis it is coupled to is at the master Sync Position and simultaneously assumes the dynamics of the master axis. If synchronicity can be reached earlier TF5430 Version: 1.8.0 71
## Page 72

Planar Motion components (i.e. the Planar mover already has the same dynamics at slave Sync Position – x as the master axis, which is at master Sync Position – x at this time), then the Planar mover will activate this configuration and become synchronous earlier. If synchronicity cannot be reached at the specified time, the Planar mover will attempt to synchronize with the master axis until a subsequent command is received or an error occurs. If the Planar mover loses its synchronization status, e.g. due to rapidly changing dynamics of the master axis, it will try to synchronize again as soon as possible. The synchronization status can be accessed at any time from the PLC via the corresponding feedback object. Synchronization can also be lost if maintaining the specified distance from the Planar mover that is ahead requires the synchronous Planar mover to decelerate. Again, the system tries to regain synchronization as quickly as possible once the obstacle is removed. An example of an error that causes the command to abort is a master axis behavior that would force the Planar mover to move at negative velocity beyond the start of a Planar track. Such a movement is not permitted even with a Move On Track [} 155] command. In such a case, the Planar mover will remain in sync (or try to sync, if it isn't already) until it is forced to stop so that it comes to a halt at the beginning of the Planar track. In addition, an error is reported back. The exact position at which the Planar mover initiates its stop depends on the current dynamic limits. If the Gear In Pos On Track [} 156] command is given dynamic limits whose velocity limit is below the current velocity of the master axis, the Planar mover will nevertheless attempt to synchronize, since it cannot be ruled out that the master axis will decelerate at a later point in time in such a way that it can be reached again. In particular, no error is returned in such a case. Creating a Planar mover ü See Configuration [} 17]. 1. Create a Planar mover. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. Creating a Planar track 3. Add the Planar track via Groups > Add New Item…, see Configuration [} 42]. ð The Solution Explorer has the following entries: Creating a master axis ü To create a master axis, an NC/PTP NCI configuration must first be created. 72 Version: 1.8.0 TF5430
## Page 73

Planar Motion components 1. Select MOTION > Add New Item…. 2. In the following dialog box, select NC/PTP NCI Configuration and confirm with OK. ð You have created an NC/PTP NCI Project. TF5430 Version: 1.8.0 73
## Page 74

Planar Motion components 3. Right-click in the created NC project Axes > Add New Item.... 4. In the following dialog box, create one (or more) axes and confirm with OK Creating a PLC For this PLC project, you must also add "Tc2_MC2" to control the master axis, see Inserting libraries [} 132]. ü See preliminary steps under Creating a PLC [} 20]. 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. 74 Version: 1.8.0 TF5430
## Page 75

Planar Motion components ð These represent movers and tracks in the MC Configuration. 2. Create the following variables. PROGRAM MAIN VAR mover : MC_Planar Mover; track : MC_Planar Track; axis : AXIS_REF; power_axis : MC_Power; move_axis : MC_Move Absolute; state : UDINT; pos1, pos2 : Position XYC; END_VAR 3. Build the PLC to create symbols of the "PLC mover", the "PLC track" and the "PLC axis". 4. Link the Planar mover, Planar track (see Example "Joining and moving a Planar mover on the track" [} 51]) and the axis, as described in the next section. Linking an axis 5. Double-click Axis 1 in the Solution Explorer. 6. Switch to the Settings tab. TF5430 Version: 1.8.0 75
## Page 76

Planar Motion components 7. Click Link to PLC... and select in the dialog that follows the entry MAIN.axis and confirm with OK. Programming state machines With the following state machine, which is programmed in MAIN, the Planar track is geometrically defined and activated (State 0), the Planar mover is activated and coupled to the Planar track (State 2 or 4), and the master axis is enabled (State 6) and moved (State 7). Finally, the command to start synchronization with the master axis ("Gear In Pos On Track [} 156]") is sent to the Planar mover (State 8). Here, too, the Planar objects are updated cyclically and the axis FBs are called (after END_CASE statement): CASE state OF 0: pos1. Set Values XYC(100, 100, 0); pos2. Set Values XYC(860, 100, 0); track. Append Line(0, pos1, pos2); track. Enable(0); state := state + 1; 1: IF track. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 2: mover. Enable(0); state := state + 1; 3: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 4: mover. Join Track(0, track, 0, 0); state := state + 1; 5: IF mover. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := state + 1; END_IF 6: power_axis(Axis := axis, Enable := TRUE, Enable_Positive := TRUE); IF power_axis. Status THEN move_axis(Axis := axis, Execute := FALSE); state := state + 1; END_IF 7: move_axis(Axis := axis, Position := 600, Velocity := 30, Acceleration := 100, Deceleration := 100, Jerk := 100, Execute := TRUE); state := state + 1; 8: mover. Gear In Pos On Track(0, axis. Drive Address. Tc Axis Object Id, 0, 100, 100, track, 0, 0); state := state + 1; END_CASE 76 Version: 1.8.0 TF5430
## Page 77

Planar Motion components mover. Update(); track. Update(); power_axis(Axis := axis); move_axis(Axis := axis); axis. Read Status(); Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. The master axis will move to the given target position (600 in this case), and the Planar mover will follow its movement. The position of the Planar mover can be tracked in the online view (by clicking the button). The mover comes to a halt at position 600, since the master axis also reaches zero dynamics here. If a value greater than the length of the track (760 in this case) is programmed in State 7 for the target position of the master axis, the Planar mover comes to a halt at the end of the Planar track in order not to derail and does not follow the master axis any further. The error in such a scene is potentially returned to the PLC by the MC, but is not accepted by the above PLC code in this case. A feedback [} 126] object is required for this purpose and for monitoring the synchronization status. In the function call in State 8, the sync positions of the master axis (third argument) or the Slave Planar Mover (fourth argument) are passed to the Planar mover. These are the respective positions at which the slave becomes synchronous with the master, i.e. at which it reaches its dynamic values. The fifth argument in the function call specifies the Planar track to which the position in the previous argument refers. In fact, it is possible for the slave to get in sync with its master significantly sooner. A synchronization movement over a sequence of consecutive tracks is possible by using a Planar Track Trail [} 127] object. In such a case, a transition from one Planar track to the next is possible during the synchronization phase or when synchronicity already exists. The deceleration of the Planar mover analogous to the above example with only one Planar track would only occur at the end of the last Planar track, if the movement of the master axis would require it to be exceeded. TF5430 Version: 1.8.0 77
## Page 78

Planar Motion components 6.2.11 Example: "Synchronizing a Planar mover on a track with another Planar mover" Guided by these instructions you will create a Twin CAT project in which a Planar mover located on a Planar track is coupled to another Planar mover on a parallel Planar track and then follows its setpoints. Coupling a Planar mover to another Planar mover is largely analogous to coupling a Planar mover to an axis; see Example "Synchronizing a Planar mover on a track with one axis" [} 71]. This example is short and builds on the above example. Creating a Planar mover ü See Configuration [} 17]. 1. Create two Planar movers. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. Creating a Planar track 3. Add two Planar tracks via Groups > Add New Item…, see Configuration [} 42]. ð The Solution Explorer has the following entries: Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. 78 Version: 1.8.0 TF5430
## Page 79

Planar Motion components ð These represent movers and tracks in the MC Configuration. 2. Create the following variables. PROGRAM MAIN VAR master_mover : MC_Planar Mover; slave_mover : MC_Planar Mover; master_track : MC_Planar Track; slave_track : MC_Planar Track; state : UDINT; pos1, pos2 : Position XYC; END_VAR 3. Build the PLC to create symbols of the "PLC movers" and "PLC tracks". 4. Link the Planar movers and the Planar tracks (see Example "Joining and moving a Planar mover on the track" [} 51]). Programming state machines With the following state machine, which is programmed in MAIN, the Planar tracks are geometrically defined and activated (states 0 to 3), the Planar movers are activated and coupled to the respective Planar track (states 4 to 11), and the Planar mover acting as master moves on its track (state 12). Finally, the command to start synchronization with the Master Planar Mover (Gear In Pos On Track With Master Mover [} 157]) is sent to the Slave Planar Mover (state 13). After the END_CASE statement, the Planar objects are updated cyclically. CASE state OF 0: pos1. Set Values XYC(100, 620, 0); pos2. Set Values XYC(860, 620, 0); master_track. Append Line(0, pos1, pos2); master_track. Enable(0); state := state + 1; 1: IF master_track. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 2: pos1. Set Values XYC(100, 100, 0); pos2. Set Values XYC(860, 100, 0); slave_track. Append Line(0, pos1, pos2); slave_track. Enable(0); TF5430 Version: 1.8.0 79
## Page 80

Planar Motion components state := state + 1; 3: IF slave_track. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 4: master_mover. Enable(0); state := state + 1; 5: IF master_mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 6: master_mover. Join Track(0, master_track, 0, 0); state := state + 1; 7: IF master_mover. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := state + 1; END_IF 8: slave_mover. Enable(0); state := state + 1; 9: IF slave_mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 10: slave_mover. Join Track(0, slave_track, 0, 0); state := state + 1; 11: IF slave_mover. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := state + 1; END_IF 12: master_mover. Move On Track(0, 0, 500.0, 0, 0); state := state + 1; 13: slave_mover. Gear In Pos On Track With Master Mover(0, master_mover, 0, 100.0, master_track, 100.0, slav e_track, 0, 0); state := state + 1; END_CASE master_mover. Update(); slave_mover. Update(); master_track. Update(); slave_track. Update(); Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. The Master Planar Mover will move to the given target position (in this case 500) on the specified Planar track, and the Slave Planar Mover will follow its movement. The positions of the Planar movers can be tracked in the online view (by clicking the button). The Slave Planar Mover stops at position 500, since the Master Planar Mover also reaches zero dynamics here. In the function call in State 13, the sync positions of the master (arguments 4 and 5) or slave (arguments 6 and 7) are passed to the Slave Planar Mover. These are the respective positions at which the slave becomes synchronous with the master, i.e. at which it reaches its dynamic values. In fact, here as well as in Example "Synchronizing a Planar mover on a track with one axis" [} 71], it is possible for the slave to get in sync with its master significantly sooner. Like with synchronization with an axis, a special Specialized feedback types [} 126] object is required for monitoring synchronicity status and possible errors. 80 Version: 1.8.0 TF5430
## Page 81

Planar Motion components Like with synchronization with a master axis, the synchronization movement of the slave can be programmed over several tracks by specifying a Planar Track Trail [} 127] object. If the Master Planar Mover moves across a track boundary during an active synchronization command, the position it passes to its slave is simply summed across the track boundary. If a master sync position is to be specified on a Planar track passed by the Master Planar Mover in the future, make sure that the Master Planar Mover has already commanded a move involving that Planar track at the time the Gear In Pos On Track With Master Mover [} 157] command is sent. 6.2.12 Example "Connecting Planar tracks to a network" Using this guide, you will create a Twin CAT project that connects four Planar tracks to a network. Creating a Planar track 1. Add four Planar tracks via Groups > Add New Item…, see Configuration [} 42]. Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. ð These represent movers and tracks in the MC Configuration. 2. Create four tracks as shown below, plus a state variable for a state machine and two auxiliary positions for the tracks. TF5430 Version: 1.8.0 81
## Page 82

Planar Motion components PROGRAM MAIN VAR track_one, track_two, track_three, track_four : MC_Planar Track; state : UDINT; pos1, pos2 : Position XYC; END_VAR 3. Then program a sequence in MAIN. ð This program code creates and activates four tracks that are connected to a network, as shown in the figure above. The so-called “blendings” (see Geometric definition [} 48]), i.e. the non-linear parts of the track in this example, are generated automatically here. You only specify the straight sections. CASE state OF 0: pos1. Set Values XY(250, 120); pos2. Set Values XY(650, 120); track_one. Append Line(0, pos1, pos2); pos1. Set Values XY(700, 170); pos2. Set Values XY(800, 450); track_one. Append Line(0, pos1, pos2); pos1. Set Values XY(650, 500); pos2. Set Values XY(250, 500); track_one. Append Line(0, pos1, pos2); state := 1; 1: pos1. Set Values XY(200, 450); pos2. Set Values XY(200, 170); track_two. Start From Track(0,track_one); track_two. Append Line(0, pos1, pos2); track_two. End At Track(0,track_one); state := 2; 2: pos1. Set Values XY(200, 500); pos2. Set Values XY(120, 500); track_three. Start From Track(0,track_one); track_three. Append Line(0, pos1, pos2); state := 3; 3: pos1. Set Values XY(200, 550); pos2. Set Values XY(200, 750); track_four. Start From Track(0,track_one); track_four. Append Line(0, pos1, pos2); state := 4; 4: track_one. Enable(0); track_two. Enable(0); track_three. Enable(0); track_four. Enable(0); state := 5; 5: IF track_one. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled AND track_two. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled AND track_three. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled AND track_four. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := 6; END_IF END_CASE Tracks must be C2-continuous at all points. This means that their positions, directions, and curvatures must merge seamlessly. The automatically generated blendings take this requirement into account, see Geometric definition [} 48]. Even if the corner pieces look like quarter circles, they are not, because circles have a positive (constant) curvature at each point and straight lines have a zero curvature. Sending the command 4. To send the command, you must trigger the tracks cyclically with their Update method after the END_CASE: track_one. Update(); track_two. Update(); track_three. Update(); track_four. Update(); Building the PLC creates symbols of the "PLC mover" and “track”, which can then be linked to the mover and track instance in the MC project. 82 Version: 1.8.0 TF5430
## Page 83

Planar Motion components 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð The tracks must each be linked separately via the following dialog boxes. Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . TF5430 Version: 1.8.0 83
## Page 84

Planar Motion components 4. Start the PLC via the Play button in the menu bar. The creation of the track network is finished at the end of the state machine (state = 6). The length of each track is in the online parameters of the TCOM objects in the MC Project. 84 Version: 1.8.0 TF5430
## Page 85

Planar Motion components 6.2.13 Example "Connecting Planar tracks to network on Planar parts" In this example, a network of Planar tracks is created on moving Planar parts. Starting point We start with a solution that contains a fully configured XPlanar Processing Unit. Two parts, a coordinate system and a mover are created under the XPlanar Processing Unit. There are 8 tiles under the first part and 2 tiles under the second part. The following geometric situation is set: the two parts are next to each other and part 2 can occupy two positions. This means that there are two different connections between the parts, depending on the part positions. TF5430 Version: 1.8.0 85
## Page 86

Planar Motion components The example is developed on the basis of this configuration. The creation of the initial situation is described in the XPlanar Processing Unit documentation. Creating Planar tracks and a Planar environment 1. Create a Planar environment, see Configuration [} 102]. 2. Set the initial parameter XPlanar processing unit OID to the object ID of the XPlanar Processing Unit. This activates the Part feature for all MC Configuration objects (especially for the created Planar mover). 3. Add three Planar tracks via Groups > Add New Item…, see Configuration [} 42]. 4. Set the initial parameter "Part OID" of the three tracks to the corresponding parts. In this example, the first and second tracks are on part 1 and the third track is on part 2. Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. 86 Version: 1.8.0 TF5430
## Page 87

Planar Motion components ð These represent movers and tracks in the MC Configuration. 2. Create three planar tracks as shown below, a state variable for a state machine and two auxiliary positions for the tracks. PROGRAM MAIN VAR track_one, track_two, track_three : MC_Planar Track; state : UDINT; pos1, pos2 : Position XYC; part_one_oid : OTCID := 16#01010020; part_two_oid : OTCID := 16#01010030; start_options : ST_Start From Track Advanced Options; end_options : ST_End At Track Advanced Options; END_VAR 3. Then program a sequence in MAIN. ð This program code creates three tracks on the parts. Depending on the active part position, the tracks are connected at different positions. First, track 3 is created on part 2 (state=0). Track 2 is then started at track 3, with part 2 in the upper position (index=2). Track 2 also ends at track 3, but part 2 is in the lower position (index=1). Finally, track 1 is started at track 3, part 2 is in the lower position (index=1), and finished, part 2 is in the upper position (index=2). CASE state OF 0: pos1. Set Values XYCReference Id(0, 360, 0, part_two_oid); pos2. Set Values XYCReference Id(80, 360, 0, part_two_oid); track_three. Append Line(0, pos1, pos2); pos1. Set Values XYCReference Id(120, 320, 0, part_two_oid); pos2. Set Values XYCReference Id(120, 160, 0, part_two_oid); track_three. Append Line(0, pos1, pos2); pos1. Set Values XYCReference Id(80, 120, 0, part_two_oid); pos2. Set Values XYCReference Id(0, 120, 0, part_two_oid); track_three. Append Line(0, pos1, pos2); state := 1; 1: start_options.this Track Part Position Index := 1; start_options.other Track Part Position Index := 2; track_two. Start From Track Advanced(0, track_three, start_options); pos1. Set Values XYCReference Id(440, 600, 0, part_one_oid); pos2. Set Values XYCReference Id(400, 600, 0, part_one_oid); track_two. Append Line(0, pos1, pos2); pos1. Set Values XYCReference Id(360, 560, 0, part_one_oid); pos2. Set Values XYCReference Id(360, 400, 0, part_one_oid); track_two. Append Line(0, pos1, pos2); pos1. Set Values XYCReference Id(400, 360, 0, part_one_oid); pos2. Set Values XYCReference Id(440, 360, 0, part_one_oid); track_two. Append Line(0, pos1, pos2); end_options.this Track Part Position Index := 1; end_options.other Track Part Position Index := 1; track_two. End At Track Advanced(0, track_three, end_options); state := 2; 2: start_options.this Track Part Position Index := 1; start_options.other Track Part Position Index := 1; track_one. Start From Track Advanced(0, track_three, start_options); pos1. Set Values XYCReference Id(440, 120, 0, part_one_oid); pos2. Set Values XYCReference Id(160, 120, 0, part_one_oid); track_one. Append Line(0, pos1, pos2); pos1. Set Values XYCReference Id(120, 160, 0, part_one_oid); pos2. Set Values XYCReference Id(120, 800, 0, part_one_oid); TF5430 Version: 1.8.0 87
## Page 88

Planar Motion components track_one. Append Line(0, pos1, pos2); pos1. Set Values XYCReference Id(160, 840, 0, part_one_oid); pos2. Set Values XYCReference Id(440, 840, 0, part_one_oid); track_one. Append Line(0, pos1, pos2); end_options.this Track Part Position Index := 1; end_options.other Track Part Position Index := 2; track_one. End At Track Advanced(0, track_three, end_options); state := 3; END_CASE Sending the command 4. To send the commands, you must call the track cyclically with its update method after the END_CASE: track_one. Update(); track_two. Update(); track_three. Update(); Building the PLC creates symbols of the "PLC mover" and “track”, which can then be linked to the mover and track instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð The tracks can now be linked via the following dialog boxes. 88 Version: 1.8.0 TF5430
## Page 89

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state=3), the three tracks are configured as shown. The start of track 3 is connected to the end of track 2 at position 2 and the end of track 3 is connected to the start of track 1 and position 2 when part 2 is in the lower position. In the upper position, the start of track 3 is connected to the end of track 1 at position 4 and the end of track 3 is connected to the start of track 2 and position 1. Track 2 and track 3 are the same length. 6.2.14 Example: "Following a Planar mover through a Track Network" Guided by these instructions, you will create a Twin CAT project in which a Planar mover located on a Planar track follows a preceding Planar mover on the same Planar track on its path through a track network. Following through a track network is realized by the command Gear In Pos On Track With Master Mover [} 157], which is described in more detail in Example: "Synchronizing a Planar mover on a track with another Planar mover" [} 78]. Creating and building a network of Planar tracks is explained in more detail in the Example "Connecting Planar tracks to a network" [} 81]. This example is short and builds on the above examples. TF5430 Version: 1.8.0 89
## Page 90

Planar Motion components Creating a Planar mover ü See Configuration [} 17]. 1. Create two Planar movers. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. Creating a Planar track 3. Add three Planar tracks via Groups > Add New Item…, see Configuration [} 42]. ð The Solution Explorer has the following entries: Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 1. Create the desired number of movers ("MC_Planar Mover") and tracks ("MC_Planar Track") via MAIN. ð These represent movers and tracks in the MC Configuration. 2. Create the following variables. 90 Version: 1.8.0 TF5430
## Page 91

Planar Motion components PROGRAM MAIN VAR master_mover : MC_Planar Mover; slave_mover : MC_Planar Mover; track_in : MC_Planar Track; track_out1 : MC_Planar Track; track_out2 : MC_Planar Track; move_feedback : MC_Planar Feedback; options : ST_Gear In Pos On Track With Master Mover Options; state : UDINT; pos1, pos2 : Position XYC; END_VAR 3. Build the PLC to create symbols of the "PLC movers" and "PLC tracks". 4. Link the Planar movers and the Planar tracks (see Example "Joining and moving a Planar mover on the track" [} 51]). Programming state machines With the following state machine, which is programmed in MAIN, first the Planar tracks are geometrically defined and activated (states 0 to 7), so that they represent the following switch configuration: In states 8 to 19 the two Planar movers are activated, coupled to the Planar track in front of the switch (track_in) and moved to position 200 (master_mover) or 0 (slave_mover). The Master Planar Mover is then commanded to position 500 on the upper of the two branching Planar tracks (track_out1) (State 20). Finally, in State 21, the Gear In Pos On Track With Master Mover [} 157] command is sent to the Slave Planar Mover. As usual, the Planar objects are updated cyclically after the END_CASE statement. CASE state OF 0: pos1. Set Values XYC(100, 360, 0); pos2. Set Values XYC(400, 360, 0); track_in. Append Line(0, pos1, pos2); track_in. Enable(0); state := state + 1; 1: IF track_in. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF TF5430 Version: 1.8.0 91
## Page 92

Planar Motion components 2: track_out1. Start From Track(0, track_in); state := state + 1; 3: pos1. Set Values XYC(450, 410, 0); pos2. Set Values XYC(860, 620, 0); track_out1. Append Line(0, pos1, pos2); track_out1. Enable(0); state := state + 1; 4: IF track_out1. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 5: track_out2. Start From Track(0, track_in); state := state + 1; 6: pos1. Set Values XYC(450, 310, 0); pos2. Set Values XYC(860, 100, 0); track_out2. Append Line(0, pos1, pos2); track_out2. Enable(0); state := state + 1; 7: IF track_out2. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 8: master_mover. Enable(0); state := state + 1; 9: IF master_mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 10: master_mover. Join Track(0, track_in, 0, 0); state := state + 1; 11: IF master_mover. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := state + 1; END_IF 12: master_mover. Move On Track(move_feedback, track_in, 200, 0, 0); state := state + 1; 13: IF move_feedback. Done THEN state := state + 1; END_IF 14: slave_mover. Enable(0); state := state + 1; 15: IF slave_mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 16: slave_mover. Join Track(0, track_in, 0, 0); state := state + 1; 17: IF slave_mover. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := state + 1; END_IF 18: slave_mover. Move On Track(move_feedback, track_in, 0, 0, 0); state := state + 1; 19: IF move_feedback. Done THEN state := state + 1; END_IF 20: master_mover. Move On Track(0, track_out1, 500, 0, 0); state := state + 1; 21: options.follow Mover := TRUE; slave_mover. Gear In Pos On Track With Master Mover(0, master_mover, 0, 210, track_in, 10, track_in, 0, options); state := state + 1; END_CASE master_mover. Update(); slave_mover. Update(); 92 Version: 1.8.0 TF5430
## Page 93

Planar Motion components track_in. Update(); track_out1. Update(); track_out2. Update(); move_feedback. Update(); Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. The Master Planar Mover will move to the given target position (in this case 500) on the specified Planar track, and the Slave Planar Mover will follow its movement. The positions of the Planar movers can be tracked in the online view (by clicking the button ). Since the positions 210 for the master and 10 for the slave were specified as the sync positions of the two Planar movers in the function call in State 21, the Slave Planar Mover will follow its master through the network at a distance of 200. It stops at position 300 on the upper of the two branching Planar tracks (on which the Master Planar Mover is also located), which can be checked in the online view: TF5430 Version: 1.8.0 93
## Page 94

Planar Motion components Note that setting the "Follow Mover" option in the Options object and passing it in the function call in State 21 avoids the need to specify a Planar Track Trail [} 127] object. The path through the network that the Slave Planar Mover should take does not have to be explicitly determined, since it automatically follows the Master Planar Mover and turns to the correct Planar track at the switch. With the set option this behavior is also reproduced in a larger network, where the Master Planar Mover moves across multiple track boundaries. 6.2.15 Options for the "Start From Track Advanced" and "End At Track Advanced" commands As described in the introduction and shown in the examples, it is not always clear what a Start From Track [} 174] or a End At Track [} 175] command means. Therefore, both commands are offered in "Advanced" variants (Start From Track Advanced [} 175], End At Track Advanced [} 176]) and extended by an option argument. This extension is also mapped in the init parameters. The option argument has three components: "this Track Part Position Index", "other Track Part Position Index" and "link Only In Specified Part Positions". The first component "this Track Part Position Index" specifies the position of the part on which the called track is located. The unique index of the position must be specified. The second component has the same meaning for the track that is passed as an argument. The third component specifies whether both tracks are only connected in the specified position or also in all other geometrically compatible positions. 94 Version: 1.8.0 TF5430
## Page 95

Planar Motion components If both indices are zero and the flag false, the behavior is identical to the previous commands. This can also be achieved by simply passing "0" as an option argument for the "Advanced" commands. 6.3 Planar group The Planar group is a software object that prevents collisions between Planar movers as well as collisions of Planar movers with the boundary of the stator area on the two-dimensional XPlanar stator area. To do this, the 2D areas of all objects in the group are blocked. When a motion command is transferred to a mover, the required area is requested from the Planar group and the motion command is rejected if this area would collide with already reserved areas. If the motion command can be executed, the area is added to the set of reserved area and blocked accordingly. 6.3.1 Configuration ü In order to create a Planar group, an MC Configuration must first be created. 1. Select MOTION > Add New Item… . 2. In the following dialog box, select MC Configuration and confirm with OK. ð You have created an MC Project. 3. Select MC Project > Groups > Add New Item…. TF5430 Version: 1.8.0 95
## Page 96

Planar Motion components 4. In the following dialog box, create one (or more) Planar groups and confirm with OK. ð The Planar group is now created and can be parameterized. Open detailed description • Select the Planar group in the tree and double-click it. Meaning of the individual tabs Object: General information (name, type, ID and so on) is shown here. 96 Version: 1.8.0 TF5430
## Page 97

Planar Motion components Parameter (Init): The group has no initial parameters. Parameter (Online): The number of objects managed in the group (movers, tracks, environment) is displayed here. The state of the group is also displayed. Data Area: Shows the memory area via which the group communicates with the PLC track. 6.3.2 Example: "Creating and moving Planar movers with group" Using this guide, you will create a Twin CAT project that contains two Planar movers and one Planar group. Both movers are added to the group and moved. Creating a Planar mover ü See Configuration [} 17]. 1. Create two Planar movers. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. 3. Change the start position of the second mover to x = 240. Creating a Planar group 4. Add the Planar group via Groups > Add New Item…, see Configuration [} 95]. Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 1. Create two movers ("MC_Planar Mover") and a Planar group "MC_Planar Group" via MAIN. TF5430 Version: 1.8.0 97
## Page 98

Planar Motion components ð These represent the movers and the group in the MC Configuration. 2. Create a state variable for a state machine as shown below, plus two auxiliary positions for the Move To Position [} 153] commands of the movers. PROGRAM MAIN VAR mover_one, mover_two : MC_Planar Mover; group : MC_Planar Group; state : UDINT; pos1, pos2 : Position XYC; END_VAR 3. Then program a sequence in MAIN. ð This program code activates the group and both movers. Both movers are then added to the group. CASE state OF 0: mover_one. Enable(0); mover_two. Enable(0); state := 1; 1: IF mover_one. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled AND mover_two. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: group. Enable(0); state := 3; 3: IF group. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := 4; END_IF 4: mover_one. Add To Group(0, group); mover_two. Add To Group(0, group); state := 5; 5: IF mover_one. MCTOPLC. STD. Group OID = group. MCTOPLC_STD. Group OID AND mover_two. MCTOPLC. STD. Group OID = group. MCTOPLC_STD. Group OID THEN state := 6; END_IF 6: pos1. Set Values XY(0, 240); pos2. Set Values XY(0, 0); mover_one. Move To Position(0, pos1, 0, 0); mover_two. Move To Position(0, pos2, 0, 0); state := 7; END_CASE Sending the command 4. To send the command you must trigger the movers and the group cyclically using the update methods: mover_one. Update(); mover_two. Update(); group. Update(); Building the PLC creates symbols of the "PLC mover" and the "PLC group", which can then be linked to the mover or group instance in the MC project. 98 Version: 1.8.0 TF5430
## Page 99

Planar Motion components 5. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar movers in the "MC Project" can be linked with the Link To PLC... button on the Settings tab. 6. Double-click Mover one first, then Mover two. ð The group must be linked separately via the following dialog boxes. TF5430 Version: 1.8.0 99
## Page 100

Planar Motion components 100 Version: 1.8.0 TF5430
## Page 101

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. After logging into the PLC and starting, you will see that the movers are not both in the target positions at the end of the state machine (state=7). Mover one has moved to x = 0 and y = 240. Mover two has not moved to the origin because Mover one still stood there and the command was therefore rejected because both are in a common group. Since the dynamic limits of the movers are quite high by default, the change of positions after logging in may be difficult to follow with the naked eye. For the dynamic limits, see Planar mover [} 17]. TF5430 Version: 1.8.0 101
## Page 102

Planar Motion components 6.4 Planar environment The Planar Environment is a software object that represents the two-dimensional XPlanar stator surface. Together with Planar movers in a group, it prevents collisions of the movers with the edge of the surface. From version V3.3.39: The Planar Environment also supports tiles (squares or rectangles) with side lengths of 160 or 320 mm. In addition, tiles can now be shifted relative to each other in a 20 mm grid. As a result, boundary elements are now shorter (20 mm) and there are correspondingly more of them in the outer boundary. 6.4.1 Configuration ü In order to create a Planar environment, an MC Configuration must first be created. 1. Select MOTION > Add New Item…. 2. In the following dialog box, select MC Configuration and confirm with OK. ð You have created an MC Project. 3. Select MC Project > Groups > Add New Item…. 4. In the following dialog box, create one (or more) Planar environments and confirm with OK. 102 Version: 1.8.0 TF5430
## Page 103

Planar Motion components ð The Planar environment is now created and can be parameterized. Open detailed description • Select the Planar environment in the tree and double-click it. Purposes of the individual tabs Object: General information (name, type, ID and so on) is shown here. Parameter (Init): Specifies initial parameters that the user can change in order to affect the behavior of the environment. TF5430 Version: 1.8.0 103
## Page 104

Planar Motion components The environment has the initial parameter "XPlanar processing unit OID". When this (>0) is set to the object ID of the XPlanar processing unit, the environment automatically reads the stator configuration from the XPlanar processing unit and generates the boundary elements for collision detection from this information. This takes place as soon as the user calls the Create Boundary() command in the PLC. From version V3.2.60: If the "XPlanar processing unit OID" parameter is set to the object ID of the XPlanar processing unit, the environment also reads the part configuration from the XPlanar processing unit and generates an internal representation of all parts. This is used both to perform collision checks with the edge of the parts when the environment is in the Planar group and to provide all components (movers, tracks, group) with a complete system description. From version V3.3.19: The "Timeout for state machine" parameter specifies the maximum time the Planar parts remain in Enabling or Resetting, see "Timeouts of the transition states" in Planar objects state diagram [} 10]. Parameter (Online): Shows the state of the environment during the runtime of the object. The number of stators inserted into the environment and the boundary elements calculated from them are displayed here. From version V3.2.60: The "Part Count" parameter specifies the number of parts read out and created internally. The "Planar Parts Info" parameter displays information for all parts. This information consists of the object ID of the part, the Planar state of the part, the active position index, the position of the part consisting of the object ID of the coordinate system and x/y coordinates, and the "disable Forced" flag of the part. Data Area: Shows the memory area via which the group communicates with the PLC environment. 6.4.2 Example "Configuring the stator area and boundary" Using this guide you will be able to create a Twin CAT project that contains a Planar environment and you will configure its stator surface and boundary. Creating a Planar environment 1. Create a Planar environment, see Configuration [} 102]. 104 Version: 1.8.0 TF5430
## Page 105

Planar Motion components Creating a PLC ü See preliminary steps Creating a PLC [} 20]. 1. Create an "MC_Planar Environment" via MAIN. ð This represents the environment in the MC configuration. 2. Create a state variable for a state machine as shown below. PROGRAM MAIN VAR environment : MC_Planar Environment; state : UDINT; END_VAR 3. Then program a sequence in MAIN. ð This program code adds four stators to the environment. The lower left corner of the square stators (side length 240 mm) is specified in each case. Create Boundary() then calculates the outer boundary of the stator surface. The stators (red) and boundary elements (blue) are shown schematically in the following illustration. CASE state OF 0: environment. Add Stator(0,0.0,0.0); environment. Add Stator(0,240.0,0.0); environment. Add Stator(0,0.0,240.0); environment. Add Stator(0,240.0,240.0); environment. Create Boundary(0); state := 1; END_CASE TF5430 Version: 1.8.0 105
## Page 106

Planar Motion components Sending the command 4. To send the command, you must call the environment cyclically with its update method after the END_CASE: environment. Update(); When creating the PLC, a symbol of the "PLC environment" is created, which can then be linked to the Planar environment in the MC project. 5. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð The Planar environment can then be linked in the "MC Project". 106 Version: 1.8.0 TF5430
## Page 107

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. The environment is in the desired state at the end of the state machine (state = 1). TF5430 Version: 1.8.0 107
## Page 108

Planar Motion components 6.5 Example: "Creating and moving Planar movers with track and group" Using this guide you will create a Twin CAT project that includes two Planar movers, a Planar track and a Planar group, and moves the movers both on and alongside the track. Creating a Planar mover ü See Configuration [} 17]. 1. Create two Planar movers. 2. Put “Parameter (Init)” into simulation mode (TRUE). The parameter is hidden and only becomes visible if the “Show Hidden Parameters” checkbox is activated. 3. Change the start position of the second mover to x = 240. Creating a Planar track and Planar group 4. Add the Planar track via Groups > Add New Item…, see Configuration [} 42]. 5. Proceed in the same way for the Planar group. Creating a PLC ü To control the movers, the track and the group, a PLC must be created from which the user can issue commands to the mover, see Creating a PLC [} 20]. 6. Create two movers (MC_Planar Movers [} 151]), an MC_Planar Track [} 170] and an MC_Planar Group [} 149] via MAIN. ð These represent the movers, the track and the group in the MC Configuration. 108 Version: 1.8.0 TF5430
## Page 109

Planar Motion components 7. Create a state variable for a state machine and two auxiliary positions for the track, as shown below. 8. Also create a feedback, see Planar Feedback [} 119]. ð The feedback can be associated with any commands. It provides detailed information about the command execution and the execution time. PROGRAM MAIN VAR mover_one, mover_two : MC_Planar Mover; track : MC_Planar Track; group : MC_Planar Group; state : UDINT; pos1, pos2 : Position XYC; feedback : MC_Planar Feedback; END_VAR 9. Then program a sequence in MAIN. ð This program code creates and activates a track, a group and both movers. Both the movers and the track are added to the group. After that, Mover 1 is joined and moved on the track. When moving, feedback is provided via which we receive the rejection of the command as an error. The command is rejected because Mover 2 is blocking the track (collision error). CASE state OF 0: pos1. Set Values XY(0, 0); pos2. Set Values XY(400, 0); track. Append Line(0, pos1, pos2); track. Enable(0); group. Enable(0); state := 1; 1: IF track. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled AND group. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := 2; END_IF 2: mover_one. Enable(0); mover_two. Enable(0); state := 3; 3: IF mover_one. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled AND mover_two. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 4; END_IF 4: mover_one. Add To Group(0,group); mover_two. Add To Group(0,group); track. Add To Group(0,group); state := 5; 5: IF mover_one. MCTOPLC. STD. Group OID > 0 AND mover_two. MCTOPLC. STD. Group OID > 0 AND track. MCTOPLC_STD. Group OID > 0 THEN state := 6; END_IF 6: mover_one. Join Track(0, track, 0, 0); state := 7; 7: IF mover_one. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := 8; END_IF 8: mover_one. Move On Track(feedback, 0, 150.0, 0, 0); pos2. Set Values XY(240, 320); mover_two. Move To Position(0, pos2, 0, 0); state := 9; 9: IF mover_two. MCTOPLC. SET. Set Pos.x >= 240 AND mover_two. MCTOPLC. SET. Set Pos.y >= 320 THEN state := 10; END_IF 10: mover_one. Move On Track(0, 0, 150.0, 0, 0); state := 11; 11: IF mover_one. MCTOPLC. SETONTRACK. Set Pos >= 150.0 THEN state := 12; TF5430 Version: 1.8.0 109
## Page 110

Planar Motion components END_IF END_CASE Sending the command 10. To send the command, you must call the mover, the track and the group cyclically with their update method after the END_CASE: mover_one. Update(); mover_two. Update(); track. Update(); group. Update(); feedback. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar mover in the “MC Project” (double-click) can be linked with the Link To PLC... button on the Settings tab. The track and the group must be linked separately. 110 Version: 1.8.0 TF5430
## Page 111

Planar Motion components TF5430 Version: 1.8.0 111
## Page 112

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state=12), the movers are in the desired position. The feedback indicates the collision error. In addition, in case of collision errors in the feedback, the blocking object is displayed with its OID. It would now be possible, after Mover 2 has been moved out of the way, to move Mover 1 on the track. 6.6 Planar part From version V3.2.60: The Part feature, which is the subject of this section, is available. 112 Version: 1.8.0 TF5430
## Page 113

Planar Motion components The MC_Planar Part [} 167] is a PLC software object that represents the part in the PLC. It displays the state of the part and offers methods for changing the status. The connection of the MC_Planar Part [} 167] is established indirectly via the MC_Planar Environment [} 142]. To do this, the initialize method of the MC_Planar Part [} 167] must be called with the correct object ID of the part after starting the PLC. The state of the MC_Planar Part [} 167] can then be both read and changed by method calls. Possible commands for the MC_Planar Part [} 167] are the Activate Position [} 168] method and the Allow Enable [} 169], Force Disable [} 169] and Reset [} 170] methods. The Activate Position [} 168] method moves the part to one of the possible positions. The methods Allow Enable [} 169], Force Disable [} 169] and Reset [} 170] change the Planar State of the MC_Planar Part [} 167]. From version V3.3.19: The Force Enable method of the Planar part cancels a previous Force Disable command if necessary and switches the Planar part on. Both Force Enable and Reset are now terminated with a timeout error if the time is exceeded, see parameter "Timeout for state machine" in Configuration [} 102]. After calling the Allow Enable [} 169] method, the Planar Part is allowed to start up the Planar State Machine (up to the Co E state Operation Enabled). As soon as the first mover in a coordinate system is activated with an Enable() command, all parts in this system are activated. Activating the part that the mover is located on is necessary for activating the mover and takes place first. Activating the remaining parts in a coordinate system is optional and may fail without preventing or canceling the activation. Conversely, calling the Disable() command on the last active mover in a coordinate system causes all parts to be switched off. The parts do not have to be switched off in order to switch off the mover and this takes place after the mover has been switched off. Similarly, parts are activated or deactivated when the first/last activated mover enters or leaves a coordinate system by calling the Activate Position [} 168] method of its part. The parts are also deactivated if the last active mover has an error with an "abort" error reaction. If a mover has an error with the "quick stop" error reaction, the parts remain activated. This applies during the error and the subsequent reset until the part is reactivated. If the error reaction is changed to "abort" by a Disable() command from the mover during the error or the Reset [} 170] command, the parts switch off. If a part is forced into the disabled state by calling the Force Disable [} 169] method, all movers on this part are set to the error state and other parts in the coordinate system may be switched off if there are no other active movers in the coordinate system. The part remains in the disabled state until at least the next Allow Enable [} 169] call. Error states of the part force errors of all movers on this part. The errors of the movers are attained before the part error. Other movers or parts in the coordinate system are not affected by these errors. In the event of a part error, a Reset [} 170] command can be triggered to rectify the error. Any mover errors are not affected by this. Conversely, a Reset [} 170] command from a mover triggers a Reset [} 170] command for all parts in the coordinate system with an error. The Reset [} 170] command of the mover has as a necessary condition that its own part is error-free; accordingly, the part is reset before the mover. 6.6.1 Example "Activating a Planar part position and moving a Planar mover" In this example, a Planar mover is moved to three Planar parts while the movable one of the parts is moved. Starting point You start with a solution that contains a fully configured XPlanar Processing Unit. Three parts, two coordinate systems and a mover are created under the XPlanar Processing Unit. A tile is created under each of the three parts. TF5430 Version: 1.8.0 113
## Page 114

Planar Motion components The following geometric situation is set: the first two parts are fixed in the two coordinate systems at the origin and the third part can change position between the two coordinate systems. It is conceivable, for example, that the two coordinate systems are arranged one above the other in two planes and Part 3 is an elevator between the two systems. The mover starts in the middle of the first part in coordinate system 1, while the third part starts in coordinate system 2. 114 Version: 1.8.0 TF5430
## Page 115

Planar Motion components Creating a Planar mover and a Planar environment 1. Create a Planar mover for this example, see Configuration [} 17]. 2. Create a Planar environment, see Configuration [} 102]. 3. Set the initial parameter XPlanar processing unit OID to the object ID of the XPlanar Processing Unit. This activates the Part feature for all MC Configuration objects (especially for the created Planar mover). Creating a PLC ü See preliminary steps Creating a PLC [} 20]. 1. Use MAIN to create the mover(s) ("MC_Planar Mover [} 151]") as follows. ð This/these represent(s) the mover(s) in the MC Configuration. 2. Create a Planar mover, a Planar environment, a Planar part, a state variable for a state machine and a target position for a travel command of the mover, as shown below. PROGRAM MAIN VAR mover : MC_Planar Mover; environment : MC_Planar Environment; part_three : MC_Planar Part; state : UDINT; target_position : Position XYC; END_VAR 3. Then program a sequence in MAIN. ð This program code initializes part 3, activates the mover, moves part 3 to coordinate system 1, moves the mover to part 3, moves part 3 back to coordinate system 2 and finally moves the mover to part 2 in coordinate system 2. CASE state OF 0: part_three. Initialize(0, 16#01010080, environment); state := 1; 1: IF part_three. Is Initialized THEN state := 2; END_IF 2: mover. Enable(0); state := 3; 3: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := 4; END_IF 4: part_three. Activate Position(0,1); state := 5; 5: IF part_three. Position Index = 1 THEN state := 6; END_IF 6: target_position. Set Values XYCReference Id(120, 120, 0, part_three. Part OID); mover. Move To Position(0, target_position, 0, 0); state := 7; TF5430 Version: 1.8.0 115
## Page 116

Planar Motion components 7: IF mover. MCTOPLC. SET. Set Pos.y > 300 AND NOT mover. MCTOPLC. STD. Busy.busy XYC THEN state := 8; END_IF 8: part_three. Activate Position(0,2); state := 9; 9: IF part_three. Position Index = 2 THEN state := 10; END_IF 10: target_position. Set Values XYCReference Id(120, 120, 0, 16#01010030); // Position on part two mover. Move To Position(0, target_position, 0, 0); state := 11; END_CASE Sending the command 4. To send the motion command, you must call the mover cyclically with its update method after the END_CASE; to send the commands of the Planar part, the environment must be called cyclically with its update method: mover. Update(); environment. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar mover in the "MC Project" (double-click) can be linked with the Link To PLC... button on the Settings tab. ð In addition, the Planar mover in the "MC Project" (double-click) can be linked with the Link To I/O... button on the Settings tab. 116 Version: 1.8.0 TF5430
## Page 117

Planar Motion components ð The Planar environment can then be linked in the "MC Project". TF5430 Version: 1.8.0 117
## Page 118

Planar Motion components Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state = 11, shown in hexadecimal in the figure below as B), the mover is in the desired position. The position is specified in coordinate system two (object Id 16#010100A0). The mover has changed the coordinate system together with part 3, or has moved to a different level with the elevator. Overall, the example clearly shows that the Planar-Part PLC objects are only lightweight environment wrappers that have to be initialized with the environment and send their commands via the environment. 118 Version: 1.8.0 TF5430
## Page 119

Planar Motion components 6.7 Planar Feedback The MC Planar Feedback [} 145] is a PLC software object that bundles all the status information for a command that is given by the user to a mover, track, group or other Planar component. This ranges from the sending of the command by the user to the processing of the command by the components and from the subsequent acceptance (or possibly rejection) to the execution and termination of the command. The user can track all of this using a feedback object if he so desires. To do this, he must transfer a feedback object in the PLC as the first argument when the command method is called. Subsequently, whenever the user triggers the feedback object (or calls its update method), he can retrieve the current command state. In order for a Planar Feedback to be used, it must be declared in the PLC. The Planar Feedback has no fixed equivalent in a TCOM object on the Motion Control side. From there, it receives the information directly from the corresponding TCOM object (e.g. Planar mover), which executes the corresponding command. Therefore, feedback does not need to be created, parameterized or linked separately in the MC project. 6.7.1 Example "Creating a Planar mover and Planar Feedback" Using this short guide you will create a Twin CAT project that contains a Planar mover and a Planar Feedback. Creating a Planar mover ü See Configuration [} 17]. 1. Create a Planar mover. 2. Put "Parameter (Init)" into simulation mode (TRUE). The parameter is hidden and only becomes visible if the "Show Hidden Parameters" checkbox is activated. TF5430 Version: 1.8.0 119
## Page 120

Planar Motion components Creating a PLC ü See preliminary steps under Creating a PLC [} 20]. 1. Create a mover ("MC_Planar Mover") and a Planar Feedback ("MC_Planar Feedback") via MAIN as follows. ð These represent the mover and the Planar Feedback in the MC Configuration. PROGRAM MAIN VAR mover : MC_Planar Mover; feedback : MC_Planar Feedback; state : UDINT; target_position : Position XYC; END_VAR In this simple example you have created a state variable for a state machine and a target position for a travel command of the Mover. A feedback is also declared in order to monitor the command process, with which a sequence can subsequently be programmed in the MAIN: CASE state OF 0: mover. Enable(feedback); state := 1; 1: IF feedback. Done THEN state := 2; END_IF 2: target_position. Set Values XY(1000, 1000); mover. Move To Position(feedback, target_position, 0, 0); state := 3; END_CASE This program code activates the mover and moves it to position x = 1000 and y = 1000. Note that the state machine will only be advanced when the feedback signals the successful termination of the command via its "Done" flag. Sending the command 2. To issue the command and monitor the feedback, you must call the mover and feedback cyclically with their update methods after the END_CASE: mover. Update(); feedback. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. 120 Version: 1.8.0 TF5430
## Page 121

Planar Motion components ð Subsequently, the Planar mover in the "MC Project" (double-click) can be linked with the Link To PLC... button on the Settings tab. Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. The mover is in the desired position at the end of the state machine (state = 3) and the feedback signals the termination of the command with the "Done" flag. TF5430 Version: 1.8.0 121
## Page 122

Planar Motion components 6.7.2 Example "Planar motion components: averting collision" Using this brief guide you will create a Twin CAT project that contains a Planar mover whose travel command is rejected due to a collision with the Planar environment. Creating a Planar mover ü See Configuration [} 17]. 1. Create a Planar mover. 2. Put “Parameter (Init)” into simulation mode (TRUE). The parameter is hidden and only becomes visible if the “Show Hidden Parameters” checkbox is activated. Creating a Planar environment 3. Create a Planar environment, see Configuration [} 102]. Creating a Planar group 4. Create a Planar group, see Configuration [} 95]. Creating a PLC ü In order to create the geometry of the environment and control the mover, a PLC must be created from which the user can send commands to both. 122 Version: 1.8.0 TF5430
## Page 123

Planar Motion components 5. Add the libraries Tc3_Physics and Tc3_Mc3Planar Motion to the PLC project, see Inserting libraries [} 132]. 6. Create an MC_Planar Mover [} 151] and an MC_Planar Environment [} 142] via MAIN. ð These represent the mover and the environment in the MC Configuration. PROGRAM MAIN VAR mover : MC_Planar Mover; environment : MC_Planar Environment; group : MC_Planar Group; feedback : MC_Planar Feedback; state : UDINT; target_position : Position XYC; END_VAR In this example you have created a state variable for a simple state machine and a target position for a travel command of the mover, with which a sequence can subsequently be programmed in the MAIN: CASE state OF 0: environment. Add Stator(0,-120.0,-120.0); TF5430 Version: 1.8.0 123
## Page 124

Planar Motion components environment. Create Boundary(0); state := 1; 1: mover. Enable(0); group. Enable(0); state := 2; 2: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled AND group. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := 3; END_IF 3: mover. Add To Group(0,group); environment. Add To Group(0,group); state := 4; 4: IF mover. MCTOPLC. STD. Group OID > 0 AND environment. MCTOPLC_STD. Group OID > 0 THEN state := 5; END_IF 5: target_position. Set Values XY(100, 100); mover. Move To Position(feedback, target_position, 0, 0); state := 6; END_CASE This program code activates the mover and creates an environment from a tile on which the mover is located. An attempt is then made to move the mover to the position x = 100 and y = 100. Sending the command 7. In order to issue the command and monitor the feedback, you must call the objects cyclically with their update methods after the END_CASE: mover. Update(); environment. Update(); group. Update(); feedback. Update(); When creating the PLC, a symbol of the "PLC Mover" is created, which can then be linked to the mover instance in the MC project. 1. To build, use the path PLC > Untitled1 > Untitled1 Project > Build. ð Subsequently, the Planar mover in the “MC Project” (double-click) can be linked with the Link To PLC... button on the Settings tab. 124 Version: 1.8.0 TF5430
## Page 125

Planar Motion components ð Subsequently, the Planar environment can be linked via the following dialog boxes in the “MC Project”. ð The group is linked in the same way. Activating and starting the project 1. Activate the configuration via the button in the menu bar . TF5430 Version: 1.8.0 125
## Page 126

Planar Motion components 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. At the end of the state machine (state=6), the mover is in the desired position. The mover did not move because the command was rejected. The feedback shows a collision error and the environment is specified as the collision partner in the Object Info. 6.7.3 Specialized feedback types In addition to the general MC_Planar Feedback type, which is accepted by most commands, certain commands may require a specialized feedback type. Planar Feedback [} 119] that apply to the general feedback also apply to these types. Specialized feedbacks can have a subset of the outputs of the general feedback, depending on their type. This includes information about whether a command is active or whether it caused an error, etc. In addition, specialized feedback types may have other outputs or functions that correspond to their scope of application. MC_Planar Feedback Gear In Pos On Track This feedback type is accepted by a Example "Synchronizing a Planar mover on a track with one axis" [} 71]. It has an additional output in Sync, which indicates whether the executing mover is synchronous with the master axis. 126 Version: 1.8.0 TF5430
## Page 127

Planar Motion components MC_Planar Feedback Gear In Pos On Track With Master Mover This feedback type is accepted by a Example: "Synchronizing a Planar mover on a track with another Planar mover" [} 78]. It has an additional output in Sync, which indicates whether the executing mover is synchronous with the Master Planar Mover. 6.8 Planar Track Trail The MC_Planar Track Trail [} 180] is an object that defines a path of contiguous Planar tracks in a network. In contrast to the individual Planar tracks from which the Planar track trail is built, the Planar track trail has no fixed equivalent in a TCOM object on the MC side, but is declared solely in the PLC, similar to a Planar feedback [} 119]. A Planar track trail can be used to define a path of Planar tracks via which a synchronization movement of a Slave Planar Mover with a master axis [} 71] or with a Master Planar Mover [} 78] should take place (if this path consists of more than the current Planar track of the Slave Planar Mover). The Planar-Track Trail offers methods for adding a Planar track to its end and for emptying its configuration. These methods only modify the Planar-Track Trail and leave the underlying Planar tracks and the network untouched. When adding a Planar track, make sure that it connects to the end of the current last Planar track in the Planar-Track Trail. It is also impossible to add a Planar track more than once. From version V3.3.39: A Planar Track Trail can be initialized by calling the method “Get Track Trail Information [} 166]” of the MC_Planar Mover. After the method call, the Planar Track Trail represents the route planned by the mover through the track network to its target. When stationary on the track, for example, the trail only contains the current track on which the mover is located. When the mover is actively moving to another track, at least the current track and the target track are included in the trail; as the first and last track. TF5430 Version: 1.8.0 127
## Page 128

Planar Motion components 6.8.1 Example "Synchronization movement over two Planar tracks" This example is an extension of the example “Synchronizing a Planar mover on a track with an axis [} 71]”, in which the synchronization movement of the Planar mover is carried out via two Planar tracks. The above example is modified so that two Planar tracks are created in the MC Configuration so that the Solution Explorer has the following entries: Adapting the PLC project 1. Add the libraries Tc3_Mc3Planar Motion, Tc3_Physics, and Tc2_MC2 to the PLC project, see Inserting libraries [} 132]. 2. Declare the following variables in MAIN: PROGRAM MAIN VAR mover : MC_Planar Mover; track1 : MC_Planar Track; track2 : MC_Planar Track; trail : MC_Planar Track Trail; axis : AXIS_REF; power_axis : MC_Power; move_axis : MC_Move Absolute; state : UDINT; pos1, pos2 : Position XYC; END_VAR 128 Version: 1.8.0 TF5430
## Page 129

Planar Motion components 3. Build the PLC to create symbols of the “PLC mover”, the “PLC track” and the “PLC axis”. 4. Link Planar movers, Planar tracks (see example “Coupling a Planar mover to a track and moving it [} 21]”) and the axis (see example “Synchronizing a Planar mover on a track with an axis [} 71]”). All previous steps are identical to those in the example “Synchronizing a Planar mover on a track with an axis [} 71]”, except for the doubling of the number of Planar tracks and the slightly modified code. Programming state machines In the next step, the program code is modified so that the Planar Track Trail is passed to the Gear In Pos On Track command. The latter is populated beforehand with both Planar tracks, which in this example form a simple network [} 81] consisting of an L configuration with a blending piece (see Geometric definition [} 48]): CASE state OF 0: pos1. Set Values XYC(100, 100, 0); pos2. Set Values XYC(400, 100, 0); track1. Append Line(0, pos1, pos2); track1. Enable(0); state := state + 1; 1: IF track1. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 2: track2. Start From Track(0, track1); state := state + 1; 3: pos1. Set Values XYC(500, 100, 0); pos2. Set Values XYC(860, 100, 0); track2. Append Line(0, pos1, pos2); track2. Enable(0); state := state + 1; 4: IF track2. MCTOPLC_STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 5: mover. Enable(0); state := state + 1; 6: IF mover. MCTOPLC. STD. State = MC_PLANAR_STATE. Enabled THEN state := state + 1; END_IF 7: mover. Join Track(0, track1, 0, 0); state := state + 1; 8: IF mover. MCTOPLC. STD. Command Mode = MC_PLANAR_MOVER_COMMAND_MODE. On Track THEN state := state + 1; END_IF 9: power_axis(Axis := axis, Enable := TRUE, Enable_Positive := TRUE); IF power_axis. Status THEN move_axis(Axis := axis, Execute := FALSE); TF5430 Version: 1.8.0 129
## Page 130

Planar Motion components state := state + 1; END_IF 10: move_axis(Axis := axis, Position := 700, Velocity := 30, Acceleration := 100, Deceleration := 100, Jerk := 100, Execute := TRUE); state := state + 1; 11: trail. Add Track(track1); trail. Add Track(track2); mover. Gear In Pos On Track(0, axis. Drive Address. Tc Axis Object Id, trail, 100, 100, track1, 0, 0); state := state + 1; END_CASE mover. Update(); track1. Update(); track2. Update(); power_axis(Axis := axis); move_axis(Axis := axis); axis. Read Status(); The two Planar tracks are added to the Planar Track Trail in State 11. The order is decisive here, as track2 follows track1 and not vice versa. The Planar Track Trail is passed to the Gear In Pos On Track command as the third argument. Activating and starting the project 1. Activate the configuration via the button in the menu bar . 2. Set the Twin CAT system to the "Run" state via the button . 3. Log in the PLC via the button in the menu bar . 4. Start the PLC via the Play button in the menu bar. Observe the process in the online view 5. Observe in the online view how the planar mover initially moves along the first Planar track towards its end: 6. You will then see how it switches to the subsequent Planar track (see the Track OIDs): 130 Version: 1.8.0 TF5430
## Page 131

Planar Motion components 7. Finally, you can see how it comes to a standstill on the second Planar track: ð In this example, the Planar mover also aborts its synchronization movement if the behavior of the master axis requires it to cross the end of the second Planar track (e.g. by selecting the target position of the master axis to be greater than the sum of the lengths of the two Planar tracks). In this case, the Planar mover comes to a standstill at the end of the second track, loses its potential synchronization status and reports an error. In the event that another Planar track is added to the end of the first, so that a switch is created at its end, the Planar mover clearly “knows” through the Planar Track Trail which of the two Planar tracks it should turn to and thus continue its synchronization movement (the master axis ultimately produces its setpoints independently of Planar tracks). In this way, a Planar Track Trail can be used to perform a synchronization movement through arbitrarily complicated track networks on a unique path of any length. Since the Planar Track Trail is a pure PLC object that does not communicate via TCOM, but only acts as a container, no cyclic update, such as for the Planar mover, the Planar tracks, or even planar feedbacks [} 119] (which do not occur in this example), is necessary and a corresponding method is not available. TF5430 Version: 1.8.0 131
## Page 132

PLC Libraries 7 PLC Libraries 7.1 Inserting libraries ü The libraries "Tc3_Physics" and "Tc3_Mc3Planar Motion" must be integrated in order to control XPlanar components. 1. Add the desired libraries to your project one after the other via References > Add library... ð Once the libraries are integrated, you can program the rest of the process in the PLC. To control a master axis, the library "Tc2_MC2" must also be included. 7.2 Tc3_Mc3Planar Motion API 7.2.1 Data Types 7.2.1.1 Enums 7.2.1.1.1 EPlanar Object Type Identifies a planar object type. 132 Version: 1.8.0 TF5430
## Page 133

PLC Libraries Syntax Definition: TYPE EPlanar Object Type : ( Invalid := 0, None := 301, Mover := 302, Track := 303, Environment := 304 )UINT; END_TYPE Values Name Description Invalid Indicates invalid information, e.g. no connection or component not yet ready. None No planar object. Mover Planar Mover. Track Planar Track. Environment Planar Environment. 7.2.1.1.2 MC_DIRECTION Indicates the movement direction of the Planar Mover on a Planar Track. Syntax Definition: TYPE MC_DIRECTION : ( mc Direction Non Modulo := 0, mc Direction Positive := 1, mc Direction Shortest Way := 2, mc Direction Negative := 3 )UINT; END_TYPE Values Name Description mc Direction Non Modulo The Planar Mover moves to the absolute value of the target position. Depending on the current position, this may induce forward or backward movement. On looped tracks, multiple passes are possible. mc Direction Positive The Planar Mover moves to the target position in a forward direction. No backward movement is allowed. mc Direction Shortest Way The Planar Mover takes the shortest way to the target position. May induce forward or backward movement. mc Direction Negative The Planar Mover moves to the target position in a backward direction. No forward movement is allowed. In combination with the Tc2_MC2 library it is possible that the data type cannot be resolved uniquely (ambiguous use of name 'MC_Direction'). In this case you have to specify the namespace when using the data type (Tc3_Mc3Planar Motion. MC_DIRECTION, Tc3_Mc3Definitions. MC_DIRECTION or Tc2_MC2. MC_DIRECTION). 7.2.1.1.3 MC_GAP_MODE_ON_TRACK Indicates the way in which gap control is done on track. TF5430 Version: 1.8.0 133
## Page 134

PLC Libraries Syntax Definition: TYPE MC_GAP_MODE_ON_TRACK : ( Standard1D := 1, Fast1D := 2 )UINT; END_TYPE Values Name Description Standard1D The Planar Mover keeps a distance to its neighbours on track that is at least the sum of gap and stop distance. Fast1D The Planar Mover keeps a distance to its neighbours on track that is at least the gap. 7.2.1.1.4 MC_SYNC_DIRECTIONS Directions in which a slave is allowed to move during synchronizing phase. Syntax Definition: TYPE MC_SYNC_DIRECTIONS : ( Positive := 1, Negative := 2, Both := 3 )UINT; END_TYPE Values Name Description Positive Movement is allowed only in positive direction while synchronizing. Negative Movement is allowed only in negative direction while synchronizing. Both Movement is allowed in any direction while synchronizing. 7.2.1.2 Structs 7.2.1.2.1 CDT_MCTOPLC_PLANAR_MOVER Contains the information of the Planar Mover passed from MC to PLC. Syntax Definition: TYPE CDT_MCTOPLC_PLANAR_MOVER : STRUCT STD : Reference To CDT_MCTOPLC_PLANAR_MOVER_STD; SET : Reference To CDT_MCTOPLC_PLANAR_MOVER_SET; ACT : Reference To CDT_MCTOPLC_PLANAR_MOVER_ACT; COORDMODE : Reference To CDT_MCTOPLC_PLANAR_MOVER_COORDMODE; SETONTRACK : Reference To CDT_MCTOPLC_PLANAR_MOVER_TRACK; END_STRUCT END_TYPE 134 Version: 1.8.0 TF5430
## Page 135

PLC Libraries Parameters Name Type Description STD Reference To Mover standard data that is CDT_MCTOPLC_PLANAR_MOVE transferred from the Planar Mover R_STD to this function block. SET Reference To Mover setpoint data that is CDT_MCTOPLC_PLANAR_MOVE transferred from the Planar Mover R_SET to this function block. ACT Reference To Mover actpoint data that is CDT_MCTOPLC_PLANAR_MOVE transferred from the Planar Mover R_ACT to this function block. COORDMODE Reference To Mover coordinate mode information CDT_MCTOPLC_PLANAR_MOVE that is transferred from the Planar R_COORDMODE Mover to this function block. SETONTRACK Reference To Mover busy information that is CDT_MCTOPLC_PLANAR_MOVE transferred from the Planar Mover R_TRACK to this function block. 7.2.1.2.2 CDT_PLCTOMC_PLANAR_MOVER Contains the information of the Planar Mover passed from PLC to MC. Syntax Definition: TYPE CDT_PLCTOMC_PLANAR_MOVER : STRUCT STD : Reference To CDT_PLCTOMC_PLANAR_MOVER_STD; END_STRUCT END_TYPE Parameters Name Type Description STD Reference To Mover standard data that is CDT_PLCTOMC_PLANAR_MOVE transferred from this function block R_STD to the Planar Mover. 7.2.1.2.3 Planar Object Info Identifies a planar object uniquely by object id and type. Syntax Definition: TYPE Planar Object Info : STRUCT Object Type : EPlanar Object Type; Id : UDINT; END_STRUCT END_TYPE Parameters Name Type Description Object Type EPlanar Object Type [} 132] Object type. Id UDINT Object id. TF5430 Version: 1.8.0 135
## Page 136

PLC Libraries 7.2.1.2.4 ST_Adopt Track Orientation Options Options for the "Adopt Track Orientation" command of the Planar Mover. Syntax Definition: TYPE ST_Adopt Track Orientation Options : STRUCT additional Turns : UDINT; direction : MC_DIRECTION; END_STRUCT END_TYPE Parameters Name Type Default Description additional Turns UDINT 0 Addition turns to move in modulo movement (positive or negative). direction MC_DIRECTION [} 133] MC_DIRECTION.mc Direc Direction in which the tion Shortest Way target is approached. 7.2.1.2.5 ST_End At Track Advanced Options Options for the "End At Track Advanced" command of the Planar Track. Syntax Definition: TYPE ST_End At Track Advanced Options : STRUCT this Track Part Position Index : UDINT; other Track Part Position Index : UDINT; link Only In Specified Part Positions : BOOL; END_STRUCT END_TYPE Parameters Name Type Default Description this Track Part Position Inde UDINT 0 The index of the position x in which the part of this track is for track connection. other Track Part Position Ind UDINT 0 The index of the position ex in which the part of the other track is for track connection. link Only In Specified Part Po BOOL FALSE If false the tracks are sitions connected not only in the given positions configuration of their parts but also in all other (geometrically compatible) locations, otherwise only the specified location is connected. 7.2.1.2.6 ST_External Setpoint Generation Options Options for the "External Setpoint Generation" command of the Planar Mover. 136 Version: 1.8.0 TF5430
## Page 137

PLC Libraries Syntax Definition: TYPE ST_External Setpoint Generation Options : STRUCT mode : MC_EXTERNAL_SET_POSITION_MODE; END_STRUCT END_TYPE Parameters Name Type Default Description mode MC_EXTERNAL_SET_P MC_EXTERNAL_SET_P Mode can be relative or OSITION_MODE OSITION_MODE. Absolut absolute, relative can be e used parallel to all other commands, absolute only alone. 7.2.1.2.7 ST_Gear In Pos On Track Options Options for the "Gear In Pos On Track" command of the Planar Mover. Syntax Definition: TYPE ST_Gear In Pos On Track Options : STRUCT gap : LREAL; in Sync Tolerance Distance : LREAL; direction Slave Sync Position : MC_DIRECTION; modulo Tolerance Slave Sync Position : LREAL; allowed Slave Sync Directions : MC_SYNC_DIRECTIONS; END_STRUCT END_TYPE Parameters Name Type Default Description gap LREAL 200.0 Minimal distance [mm] to next Planar Mover on track. in Sync Tolerance Distance LREAL 0.0 Tolerance in absolute value [mm] of position difference to master axis for in Sync flag. direction Slave Sync Positio MC_DIRECTION [} 133] MC_DIRECTION.mc Direc Direction in which the n tion Non Modulo slave sync position is approached. This parameter is interpreted only in case the slave mover is on a closed-loop track. Otherwise, it must be set to its default value. modulo Tolerance Slave Sy LREAL 0.0 Tolerance "window" for nc Position slave sync position. This parameter is interpreted only in case the slave mover is on a closed-loop track. Otherwise, it must be set to its default value. TF5430 Version: 1.8.0 137
## Page 138

PLC Libraries Name Type Default Description allowed Slave Sync Directio MC_SYNC_DIRECTIONS MC_SYNC_DIRECTIONS Directions in which the ns . Positive slave is allowed to move [} 134] while in synchronizing phase. 7.2.1.2.8 ST_Gear In Pos On Track With Master Mover Options Options for the "Gear In Pos On Track With Master Mover" command of the Planar Mover. Syntax Definition: TYPE ST_Gear In Pos On Track With Master Mover Options : STRUCT gap : LREAL; in Sync Tolerance Distance : LREAL; direction Slave Sync Position : MC_DIRECTION; modulo Tolerance Slave Sync Position : LREAL; direction Master Sync Position : MC_DIRECTION; modulo Tolerance Master Sync Position : LREAL; allowed Slave Sync Directions : MC_SYNC_DIRECTIONS; follow Mover : BOOL; END_STRUCT END_TYPE Parameters Name Type Default Description gap LREAL 200.0 Minimal distance [mm] to next Planar Mover on track. in Sync Tolerance Distance LREAL 0.0 Tolerance in absolute value [mm] of position difference to master axis for in Sync flag. direction Slave Sync Positio MC_DIRECTION [} 133] MC_DIRECTION.mc Direc Direction in which the n tion Non Modulo slave sync position is approached. This parameter is interpreted only in case the slave mover is on a closed-loop track. Otherwise, it must be set to its default value. modulo Tolerance Slave Sy LREAL 0.0 Tolerance "window" [mm] nc Position for slave sync position. This parameter is interpreted only in case the slave mover is on a closed-loop track. Otherwise, it must be set to its default value. direction Master Sync Positi MC_DIRECTION [} 133] MC_DIRECTION.mc Direc Direction in which the on tion Non Modulo master sync position is approached. This parameter is interpreted only in case the master mover is on a closed-loop track. Otherwise, it must be set to its default value. 138 Version: 1.8.0 TF5430
## Page 139

PLC Libraries Name Type Default Description modulo Tolerance Master S LREAL 0.0 Tolerance "window" [mm] ync Position for master sync position. This parameter is interpreted only in case the master mover is on a closed-loop track. Otherwise, it must be set to its default value. allowed Slave Sync Directio MC_SYNC_DIRECTIONS MC_SYNC_DIRECTIONS Directions in which the ns . Positive slave is allowed to move [} 134] while in synchronizing phase. follow Mover BOOL FALSE If true, the slave Planar Mover will proceed to follow the master Planar Mover after the latter has traversed the master Sync Position. In this case the Planar Track Trail describes the slave's path towards the master Sync Position. If false, the slave moves exclusively on the Planar Track Trail specified. 7.2.1.2.9 ST_Join Track Options Options for the "Join Track" command of the Planar Mover. Syntax Definition: TYPE ST_Join Track Options : STRUCT use Orientation : BOOL; END_STRUCT END_TYPE Parameters Name Type Default Description use Orientation BOOL TRUE If true, the target orientation is also reached at the end of the movement. 7.2.1.2.10 ST_Leave Track Options Options for the "Leave Track" command of the Planar Mover. Syntax Definition: TF5430 Version: 1.8.0 139
## Page 140

PLC Libraries TYPE ST_Leave Track Options : STRUCT use Orientation : BOOL; END_STRUCT END_TYPE Parameters Name Type Default Description use Orientation BOOL TRUE If true, the target orientation is also reached at the end of the movement. 7.2.1.2.11 ST_Move COptions Options for the "Move C" command of the Planar Mover. Syntax Definition: TYPE ST_Move COptions : STRUCT additional Turns : UDINT; direction : MC_DIRECTION; END_STRUCT END_TYPE Parameters Name Type Default Description additional Turns UDINT 0 Addition turns to move in modulo movement (positive or negative). direction MC_DIRECTION [} 133] MC_DIRECTION.mc Direc Direction in which the tion Non Modulo target is approached. 7.2.1.2.12 ST_Move On Track Options Options for the "Move On Track" command of the Planar Mover. Syntax Definition: TYPE ST_Move On Track Options : STRUCT gap : LREAL; direction : MC_DIRECTION; additional Turns : UDINT; modulo Tolerance : LREAL; dynamic Mode : MC_DYNAMICS_REDUCTION_MODE; gap Mode : MC_GAP_MODE_ON_TRACK; END_STRUCT END_TYPE Parameters Name Type Default Description gap LREAL 200.0 Minimal distance [mm] to next Planar Mover on track. direction MC_DIRECTION [} 133] MC_DIRECTION.mc Direc Direction in which the tion Non Modulo target is approached. 140 Version: 1.8.0 TF5430
## Page 141

PLC Libraries Name Type Default Description additional Turns UDINT 0 Addition turns to move in modulo movement (positive or negative). modulo Tolerance LREAL 0.0 Tolerance "window" [mm] in modulo movement. dynamic Mode MC_DYNAMICS_REDUC MC_DYNAMICS_REDUC The way in which TION_MODE TION_MODE. None dynamics are planned on track. gap Mode MC_GAP_MODE_ON_TRA MC_GAP_MODE_ON_TR The way in which gap ACK. Standard1D control is done with all CK [} 133] neighbours on track. 7.2.1.2.13 ST_Move To Position Options Options for the "Move To Position" command of the Planar Mover. Syntax Definition: TYPE ST_Move To Position Options : STRUCT use Orientation : BOOL; END_STRUCT END_TYPE Parameters Name Type Default Description use Orientation BOOL TRUE If true, the target orientation is also reached at the end of the movement. 7.2.1.2.14 ST_Start From Track Advanced Options Options for the "Start From Track Advanced" command of the Planar Track. Syntax Definition: TYPE ST_Start From Track Advanced Options : STRUCT this Track Part Position Index : UDINT; other Track Part Position Index : UDINT; link Only In Specified Part Positions : BOOL; END_STRUCT END_TYPE Parameters Name Type Default Description this Track Part Position Inde UDINT 0 The index of the position x in which the part of this track is for track connection. other Track Part Position Ind UDINT 0 The index of the position ex in which the part of the other track is for track connection. TF5430 Version: 1.8.0 141
## Page 142

PLC Libraries Name Type Default Description link Only In Specified Part Po BOOL FALSE If false the tracks are sitions connected not only in the given positions configuration of their parts but also in all other (geometrically compatible) locations, otherwise only the specified location is connected. 7.2.2 Function Blocks 7.2.2.1 MC_Planar Environment A Planar Environment object specifies the environment that Planar Movers can move in. It contains information about the stator objects and boundaries of the movement area. Do not call the main FB directly. Only use the available methods. Methods Name Description Clear [} 142] Clears the Planar Environment (stators and boundary). Add Stator [} 143] Adds a stator to the Planar Environment. Create Boundary [} 143] Creates a boundary for the Planar Environment based on the previously added stator information or hardware information. Update [} 144] Updates internal state of the object, must be triggered each cycle. Add To Group [} 144] Adds the Planar Environment to the given Planar Group. Remove From Group [} 144] Removes the Planar Environment from its current Planar Group, i.e. disables collision checks. Get Planar Object Info [} 145] Returns environment object info (type: environment, id: OID of nc environment). Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.1.10.11 7.2.2.1.1 Clear Clear command Feedback Reference To MC_Planar Feedback Clears the Planar Environment (stators and boundary). Syntax Definition: 142 Version: 1.8.0 TF5430
## Page 143

PLC Libraries METHOD Clear VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.1.2 Add Stator Add Stator command Feedback Reference To MC_Planar Feedback lower X LREAL lower Y LREAL Adds a stator to the Planar Environment. Syntax Definition: METHOD Add Stator VAR_INPUT command Feedback : Reference To MC_Planar Feedback; lower X : LREAL; lower Y : LREAL; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] lower X LREAL The lower x position [mm] of the stator. lower Y LREAL The lower y position [mm] of the stator. 7.2.2.1.3 Create Boundary Create Boundary command Feedback Reference To MC_Planar Feedback Creates a boundary for the Planar Environment based on the previously added stator information or hardware information. Syntax Definition: METHOD Create Boundary VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR TF5430 Version: 1.8.0 143
## Page 144

PLC Libraries Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.1.4 Update Update Updates internal state of the object, must be triggered each cycle. Syntax Definition: METHOD Update 7.2.2.1.5 Add To Group Add To Group command Feedback Reference To MC_Planar Feedback ↔ group MC_Planar Group Adds the Planar Environment to the given Planar Group. Syntax Definition: METHOD Add To Group VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT group : MC_Planar Group; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] In/Outputs Name Type Description group MC_Planar Group [} 149] The Planar Group that the mover joins. 7.2.2.1.6 Remove From Group Remove From Group command Feedback Reference To MC_Planar Feedback Removes the Planar Environment from its current Planar Group, i.e. disables collision checks. 144 Version: 1.8.0 TF5430
## Page 145

PLC Libraries Syntax Definition: METHOD Remove From Group VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.1.7 Get Planar Object Info Get Planar Object Info Planar Object Info Get Planar Object Info Returns environment object info (type: environment, id: OID of nc environment). Syntax Definition: METHOD Get Planar Object Info : Planar Object Info Return value Planar Object Info [} 135] 7.2.2.2 MC_Planar Feedback MC_Planar Feedback BOOL Active BOOL Busy BOOL Aborted BOOL Error UDINT Error Id Planar Object Info object Info BOOL Done Displays specific command status information for an associated command, given back by the MC Project. Syntax Definition: FUNCTION_BLOCK MC_Planar Feedback VAR_OUTPUT Active : BOOL; Busy : BOOL; Aborted : BOOL; Error : BOOL; Error Id : UDINT; object Info : Planar Object Info; Done : BOOL; END_VAR TF5430 Version: 1.8.0 145
## Page 146

PLC Libraries Outputs Name Type Description Active BOOL Indicates an active command, i.e. command was accepted and is being executed. Busy BOOL Indicates a busy command, i.e. command is being processed, waiting for execution, or already executing (= also active). Aborted BOOL Indicates the command is aborted, i.e. execution of the command finished due the start of other commands. Error BOOL Indicates the command has an error. Error Id UDINT Indicates the error id of the command error. object Info Planar Object Info [} 135] Indicates which object one would collide with. Done BOOL Indicates the command is done, i.e. execution of the command finished successfully. Methods Name Description Update [} 146] Updates internal state of the object. Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.1.10.11 7.2.2.2.1 Update Update Updates internal state of the object. Syntax Definition: METHOD Update 7.2.2.3 MC_Planar Feedback Base Displays general command status information for an associated command, given back by the MC Project. Do not call the main FB directly. Only use the available methods. Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics 146 Version: 1.8.0 TF5430
## Page 147

PLC Libraries Development environment Target system type PLC libraries to include Advanced Motion Pack V3.1.10.11 7.2.2.4 MC_Planar Feedback Gear In Pos On Track MC_Planar Feedback Gear In Pos On Track BOOL Active BOOL Busy BOOL Aborted BOOL Error UDINT Error Id Planar Object Info object Info BOOL in Sync Displays specific command status information for an associated Gear In Pos On Track command, given back by the MC Project. Syntax Definition: FUNCTION_BLOCK MC_Planar Feedback Gear In Pos On Track VAR_OUTPUT Active : BOOL; Busy : BOOL; Aborted : BOOL; Error : BOOL; Error Id : UDINT; object Info : Planar Object Info; in Sync : BOOL; END_VAR Outputs Name Type Description Active BOOL Indicates an active command, i.e. command was accepted and is being executed. Busy BOOL Indicates a busy command, i.e. command is being processed, waiting for execution, or already executing (= also active). Aborted BOOL Indicates the command is aborted, i.e. execution of the command finished due the start of other commands. Error BOOL Indicates the command has an error. Error Id UDINT Indicates the error id of the command error. object Info Planar Object Info [} 135] Indicates which object one would collide with. in Sync BOOL Indicates whether the mover is currently in sync with the master (within tolerance specified in the command options). Methods Name Description Update [} 148] Updates internal state of the object. Required License TC3 Planar Motion Base TF5430 Version: 1.8.0 147
## Page 148

PLC Libraries System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.1.10.11 7.2.2.4.1 Update Update Updates internal state of the object. Syntax Definition: METHOD Update 7.2.2.5 MC_Planar Feedback Gear In Pos On Track With Master Mover MC_Planar Feedback Gear In Pos On Track With Master Mover BOOL Active BOOL Busy BOOL Aborted BOOL Error UDINT Error Id Planar Object Info object Info BOOL in Sync Displays specific command status information for an associated Gear In Pos On Track command, given back by the MC Project. Syntax Definition: FUNCTION_BLOCK MC_Planar Feedback Gear In Pos On Track With Master Mover VAR_OUTPUT Active : BOOL; Busy : BOOL; Aborted : BOOL; Error : BOOL; Error Id : UDINT; object Info : Planar Object Info; in Sync : BOOL; END_VAR Outputs Name Type Description Active BOOL Indicates an active command, i.e. command was accepted and is being executed. Busy BOOL Indicates a busy command, i.e. command is being processed, waiting for execution, or already executing (= also active). Aborted BOOL Indicates the command is aborted, i.e. execution of the command finished due the start of other commands. Error BOOL Indicates the command has an error. Error Id UDINT Indicates the error id of the command error. object Info Planar Object Info [} 135] Indicates which object one would collide with. 148 Version: 1.8.0 TF5430
## Page 149

PLC Libraries Name Type Description in Sync BOOL Indicates whether the mover is currently in sync with the master (within tolerance specified in the command options). Methods Name Description Update [} 149] Updates internal state of the object. Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.1.10.11 7.2.2.5.1 Update Update Updates internal state of the object. Syntax Definition: METHOD Update 7.2.2.6 MC_Planar Feedback In Sync Base class for all specialized feedbacks featuring an in Sync output. Do not call the main FB directly. Only use the available methods. Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.1.10.11 7.2.2.7 MC_Planar Group A Planar Group object. Planar Movers and other objects added to the group perform collision checks against each other. Do not call the main FB directly. Only use the available methods. TF5430 Version: 1.8.0 149
## Page 150

PLC Libraries Methods Name Description Enable [} 150] Starts enabling the Planar Group. Disable [} 150] Starts disabling the Planar Group. Reset [} 151] Starts resetting the Planar Group. Update [} 151] Updates internal state of the object, must be triggered each cycle. Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.1.10.11 7.2.2.7.1 Enable Enable command Feedback Reference To MC_Planar Feedback Starts enabling the Planar Group. Syntax Definition: METHOD Enable VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.7.2 Disable Disable command Feedback Reference To MC_Planar Feedback Starts disabling the Planar Group. Syntax Definition: METHOD Disable VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR 150 Version: 1.8.0 TF5430
## Page 151

PLC Libraries Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.7.3 Reset Reset command Feedback Reference To MC_Planar Feedback Starts resetting the Planar Group. Syntax Definition: METHOD Reset VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.7.4 Update Update Updates internal state of the object, must be triggered each cycle. Syntax Definition: METHOD Update 7.2.2.8 MC_Planar Mover A Planar Mover object capable of moving within a plane. Limited movement vertical to the plane is available. Do not call the main FB directly. Only use the available methods. Methods Name Description Move To Position [} 153] Initiates a direct movement to the specified position. Join Track [} 153] Initiates a direct movement to the specified track. At the end of the movement the mover joins the track. Leave Track [} 154] Initiates a direct movement to the specified position. At the beginning of the movement the track is left. Move On Track [} 155] Initiates a movement on the track to the specified position. TF5430 Version: 1.8.0 151
## Page 152

PLC Libraries Name Description Gear In Pos On Track [} 156] Initiates a Gear In Pos movement along a specified trail. Gear In Pos On Track With Master M Initiates a Gear In Pos movement along a specified trail, in which the master setpoints are provided by another Planar Mover. over [} 157] Move Z [} 158] Initiates a movement for the z component. Move A [} 158] Initiates a movement for the a component. Move B [} 159] Initiates a movement for the b component. Move C [} 159] Initiates a movement for the c component. Adopt Track Orientation [} 160] Initiates a movement for the c component. Halt [} 161] Initiates a halt. Enable [} 161] Starts enabling the Planar Mover. Disable [} 161] Starts disabling the Planar Mover. Reset [} 162] Starts resetting the Planar Mover. Update [} 162] Updates internal state of the object, must be triggered each cycle. Set Position [} 162] Sets the position of the Planar Mover. Only possible if the Planar Mover is disabled. Start External Setpoint Generation Starts the external setpoint generation, the user must supply setpoints from this PLC cycle on in every PLC cycle. [} 163] Stop External Setpoint Generation Ends the external setpoint generation, called after last Set External Setpoint (in the same PLC cycle). [} 163] Set External Setpoint [} 164] Sets the external setpoint for the Planar Mover without ref sys id (for relative mode), must be called each PLC cycle during external setpoint generation. Set External Setpoint Reference Id Sets the external setpoint for the Planar Mover with corresponing reference system id, must be called each PLC cycle during external setpoint [} 164] generation. Add To Group [} 165] Adds the Planar Mover to the given Planar Group. Remove From Group [} 165] Removes the Planar Mover from its current Planar Group, i.e. disables collision checks. Get Position On Current Part Sets the values of the given position to the movers position values on the current part. [} 166] Get Track Trail Information Sets the values of the given track trail to the movers internally planned track trail. [} 166] Get Planar Object Info [} 167] Returns mover object info (type: mover, id: OID of nc mover). Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.1.10.11 152 Version: 1.8.0 TF5430
## Page 153

PLC Libraries 7.2.2.8.1 Move To Position Move To Position command Feedback Reference To MC_Planar Feedback ↔ target Position Position XYC constraint Reference To IPlc Dynamic Constraint options Reference To ST_Move To Position Options Initiates a direct movement to the specified position. Syntax Definition: METHOD Move To Position VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT target Position : Position XYC; END_VAR VAR_INPUT constraint : Reference To IPlc Dynamic Constraint; options : Reference To ST_Move To Position Options; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] constraint Reference To Dynamic constraints for this movement. IPlc Dynamic Constraint options Reference To Options for the movement. ST_Move To Position Option s [} 141] In/Outputs Name Type Description target Position Position XYC Target position for the movement. 7.2.2.8.2 Join Track Join Track command Feedback Reference To MC_Planar Feedback ↔ target Track MC_Planar Track constraint Reference To IPlc Dynamic Constraint options Reference To ST_Join Track Options Initiates a direct movement to the specified track. At the end of the movement the mover joins the track. Syntax Definition: METHOD Join Track VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR TF5430 Version: 1.8.0 153
## Page 154

PLC Libraries VAR_IN_OUT target Track : MC_Planar Track; END_VAR VAR_INPUT constraint : Reference To IPlc Dynamic Constraint; options : Reference To ST_Join Track Options; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] constraint Reference To Dynamic constraints for this movement. IPlc Dynamic Constraint options Reference To Options for the movement. ST_Join Track Options [} 139] In/Outputs Name Type Description target Track MC_Planar Track [} 170] Target track for the movement. 7.2.2.8.3 Leave Track Leave Track command Feedback Reference To MC_Planar Feedback ↔ target Position Position XYC constraint Reference To IPlc Dynamic Constraint options Reference To ST_Leave Track Options Initiates a direct movement to the specified position. At the beginning of the movement the track is left. Syntax Definition: METHOD Leave Track VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT target Position : Position XYC; END_VAR VAR_INPUT constraint : Reference To IPlc Dynamic Constraint; options : Reference To ST_Leave Track Options; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] constraint Reference To Dynamic constraints for this movement. IPlc Dynamic Constraint 154 Version: 1.8.0 TF5430
## Page 155

PLC Libraries Name Type Description options Reference To Options for the movement. ST_Leave Track Options [} 139] In/Outputs Name Type Description target Position Position XYC Target position for the movement. 7.2.2.8.4 Move On Track Move On Track command Feedback Reference To MC_Planar Feedback target Track Reference To MC_Planar Track target Position On Track LREAL constraint Reference To Dynamic Constraint_Path XY options Reference To ST_Move On Track Options Initiates a movement on the track to the specified position. Syntax Definition: METHOD Move On Track VAR_INPUT command Feedback : Reference To MC_Planar Feedback; target Track : Reference To MC_Planar Track; target Position On Track : LREAL; constraint : Reference To Dynamic Constraint_Path XY; options : Reference To ST_Move On Track Options; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] target Track Reference To Target track for the movement. If none is specified, this defaults MC_Planar Track [} 170] to the current track. target Position O LREAL Target position [mm] on the target track. n Track constraint Reference To Constraint on maximal dynamics during the movement Dynamic Constraint_Path X (V,A,D,J). Y options Reference To Options for the movement. ST_Move On Track Options TF5430 Version: 1.8.0 155
## Page 156

PLC Libraries 7.2.2.8.5 Gear In Pos On Track Gear In Pos On Track command Feedback Reference To MC_Planar Feedback Gear In Pos On Track master Axis OTCID track Trail Reference To MC_Planar Track Trail master Sync Position LREAL slave Sync Position LREAL ↔ slave Sync Position Track MC_Planar Track constraint Reference To Dynamic Constraint_Path XY options Reference To ST_Gear In Pos On Track Options Initiates a Gear In Pos movement along a specified trail. Syntax Definition: METHOD Gear In Pos On Track VAR_INPUT command Feedback : Reference To MC_Planar Feedback Gear In Pos On Track; master Axis : OTCID; track Trail : Reference To MC_Planar Track Trail; master Sync Position : LREAL; slave Sync Position : LREAL; END_VAR VAR_IN_OUT slave Sync Position Track : MC_Planar Track; END_VAR VAR_INPUT constraint : Reference To Dynamic Constraint_Path XY; options : Reference To ST_Gear In Pos On Track Options; END_VAR Inputs Name Type Description command Feed Reference To The command specific feedback object for the command. back MC_Planar Feedback Gear In Pos On Track [} 147] master Axis OTCID Master axis being followed. track Trail Reference To Track trail determining along which tracks the Gear In Pos MC_Planar Track Trail movement is allowed to proceed. [} 180] master Sync Po LREAL Position of the master axis (interpreted as [mm]) at which the sition slave is in Sync. slave Sync Posit LREAL Arc length [mm] on track given by slave Sync Position Track OID ion at which the slave is in Sync. Possibly interpreted in modulo fashion, depending on options. constraint Reference To Constraint on maximal dynamics during the movement Dynamic Constraint_Path X (V,A,D,J). Y options Reference To Options for the movement. ST_Gear In Pos On Track Opti ons [} 137] In/Outputs Name Type Description slave Sync Posit MC_Planar Track [} 170] Track on which the slave is in Sync. ion Track 156 Version: 1.8.0 TF5430
## Page 157

PLC Libraries 7.2.2.8.6 Gear In Pos On Track With Master Mover Gear In Pos On Track With Master Mover command Feedback Reference To MC_Planar Feedback Gear In Pos On Track With Master Mover ↔ master Mover MC_Planar Mover track Trail Reference To MC_Planar Track Trail master Sync Position LREAL ↔ master Sync Position Track MC_Planar Track slave Sync Position LREAL ↔ slave Sync Position Track MC_Planar Track constraint Reference To Dynamic Constraint_Path XY options Reference To ST_Gear In Pos On Track With Master Mover Options Initiates a Gear In Pos movement along a specified trail, in which the master setpoints are provided by another Planar Mover. Syntax Definition: METHOD Gear In Pos On Track With Master Mover VAR_INPUT command Feedback : Reference To MC_Planar Feedback Gear In Pos On Track With Master Mover; END_VAR VAR_IN_OUT master Mover : MC_Planar Mover; END_VAR VAR_INPUT track Trail : Reference To MC_Planar Track Trail; master Sync Position : LREAL; END_VAR VAR_IN_OUT master Sync Position Track : MC_Planar Track; END_VAR VAR_INPUT slave Sync Position : LREAL; END_VAR VAR_IN_OUT slave Sync Position Track : MC_Planar Track; END_VAR VAR_INPUT constraint : Reference To Dynamic Constraint_Path XY; options : Reference To ST_Gear In Pos On Track With Master Mover Options; END_VAR Inputs Name Type Description command Feed Reference To The command specific feedback object for the command. back MC_Planar Feedback Gear In Pos On Track With Master M over [} 148] track Trail Reference To Track trail determining along which tracks the Gear In Pos MC_Planar Track Trail movement is allowed to proceed. [} 180] master Sync Po LREAL Position of the master axis (interpreted as [mm]) at which the sition slave is in Sync. slave Sync Posit LREAL Arc length on track [mm] given by slave Sync Position Track OID ion at which the slave is in Sync. Possibly interpreted in modulo fashion, depending on options. constraint Reference To Constraint on maximal dynamics during the movement Dynamic Constraint_Path X (V,A,D,J). Y TF5430 Version: 1.8.0 157
## Page 158

PLC Libraries Name Type Description options Reference To Options for the movement. ST_Gear In Pos On Track With Master Mover Options [} 138] In/Outputs Name Type Description master Mover MC_Planar Mover [} 151] Master mover being followed. master Sync Po MC_Planar Track [} 170] Track on which the master is in Sync. sition Track slave Sync Posit MC_Planar Track [} 170] Track on which the slave is in Sync. ion Track 7.2.2.8.7 Move Z Move Z command Feedback Reference To MC_Planar Feedback target Position LREAL constraint Reference To IPlc Dynamic Constraint Initiates a movement for the z component. Syntax Definition: METHOD Move Z VAR_INPUT command Feedback : Reference To MC_Planar Feedback; target Position : LREAL; constraint : Reference To IPlc Dynamic Constraint; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] target Position LREAL Target position [mm] for the movement. constraint Reference To Dynamic constraints for this movement. IPlc Dynamic Constraint 7.2.2.8.8 Move A Move A command Feedback Reference To MC_Planar Feedback target Position LREAL constraint Reference To IPlc Dynamic Constraint Initiates a movement for the a component. Syntax Definition: 158 Version: 1.8.0 TF5430
## Page 159

PLC Libraries METHOD Move A VAR_INPUT command Feedback : Reference To MC_Planar Feedback; target Position : LREAL; constraint : Reference To IPlc Dynamic Constraint; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] target Position LREAL Target position [deg] for the movement. constraint Reference To Dynamic constraints for this movement. IPlc Dynamic Constraint 7.2.2.8.9 Move B Move B command Feedback Reference To MC_Planar Feedback target Position LREAL constraint Reference To IPlc Dynamic Constraint Initiates a movement for the b component. Syntax Definition: METHOD Move B VAR_INPUT command Feedback : Reference To MC_Planar Feedback; target Position : LREAL; constraint : Reference To IPlc Dynamic Constraint; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] target Position LREAL Target position [deg] for the movement. constraint Reference To Dynamic constraints for this movement. IPlc Dynamic Constraint 7.2.2.8.10 Move C Move C command Feedback Reference To MC_Planar Feedback target Position LREAL constraint Reference To IPlc Dynamic Constraint options Reference To ST_Move COptions Initiates a movement for the c component. TF5430 Version: 1.8.0 159
## Page 160

PLC Libraries Syntax Definition: METHOD Move C VAR_INPUT command Feedback : Reference To MC_Planar Feedback; target Position : LREAL; constraint : Reference To IPlc Dynamic Constraint; options : Reference To ST_Move COptions; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] target Position LREAL Target position [deg] for the movement. constraint Reference To Dynamic constraints for this movement. IPlc Dynamic Constraint options Reference To Options for the rotation. ST_Move COptions [} 140] 7.2.2.8.11 Adopt Track Orientation Adopt Track Orientation command Feedback Reference To MC_Planar Feedback constraint Reference To IPlc Dynamic Constraint options Reference To ST_Adopt Track Orientation Options Initiates a movement for the c component. Syntax Definition: METHOD Adopt Track Orientation VAR_INPUT command Feedback : Reference To MC_Planar Feedback; constraint : Reference To IPlc Dynamic Constraint; options : Reference To ST_Adopt Track Orientation Options; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] constraint Reference To Dynamic constraints for this movement. IPlc Dynamic Constraint options Reference To Options for the rotation. ST_Adopt Track Orientation Options [} 136] 160 Version: 1.8.0 TF5430
## Page 161

PLC Libraries 7.2.2.8.12 Halt Halt command Feedback Reference To MC_Planar Feedback constraint Reference To IPlc Dynamic Constraint Initiates a halt. Syntax Definition: METHOD Halt VAR_INPUT command Feedback : Reference To MC_Planar Feedback; constraint : Reference To IPlc Dynamic Constraint; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] constraint Reference To Dynamic constraints for this movement. IPlc Dynamic Constraint 7.2.2.8.13 Enable Enable command Feedback Reference To MC_Planar Feedback Starts enabling the Planar Mover. Syntax Definition: METHOD Enable VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.8.14 Disable Disable command Feedback Reference To MC_Planar Feedback Starts disabling the Planar Mover. TF5430 Version: 1.8.0 161
## Page 162

PLC Libraries Syntax Definition: METHOD Disable VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.8.15 Reset Reset command Feedback Reference To MC_Planar Feedback Starts resetting the Planar Mover. Syntax Definition: METHOD Reset VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.8.16 Update Update Updates internal state of the object, must be triggered each cycle. Syntax Definition: METHOD Update 7.2.2.8.17 Set Position Set Position command Feedback Reference To MC_Planar Feedback ↔ position Position XYC Sets the position of the Planar Mover. Only possible if the Planar Mover is disabled. 162 Version: 1.8.0 TF5430
## Page 163

PLC Libraries Syntax Definition: METHOD Set Position VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT position : Position XYC; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] In/Outputs Name Type Description position Position XYC New position of the Planar Mover. 7.2.2.8.18 Start External Setpoint Generation Start External Setpoint Generation command Feedback Reference To MC_Planar Feedback options Reference To ST_External Setpoint Generation Options Starts the external setpoint generation, the user must supply setpoints from this PLC cycle on in every PLC cycle. Syntax Definition: METHOD Start External Setpoint Generation VAR_INPUT command Feedback : Reference To MC_Planar Feedback; options : Reference To ST_External Setpoint Generation Options; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] options Reference To Options for the movement. ST_External Setpoint Gener ation Options [} 136] 7.2.2.8.19 Stop External Setpoint Generation Stop External Setpoint Generation command Feedback Reference To MC_Planar Feedback Ends the external setpoint generation, called after last Set External Setpoint (in the same PLC cycle). TF5430 Version: 1.8.0 163
## Page 164

PLC Libraries Syntax Definition: METHOD Stop External Setpoint Generation VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.8.20 Set External Setpoint Set External Setpoint set Position Mover Vector set Velocity Mover Vector set Acceleration Mover Vector Sets the external setpoint for the Planar Mover without ref sys id (for relative mode), must be called each PLC cycle during external setpoint generation. Syntax Definition: METHOD Set External Setpoint VAR_INPUT set Position : Mover Vector; set Velocity : Mover Vector; set Acceleration : Mover Vector; END_VAR Inputs Name Type Description set Position Mover Vector Position that is send to the Planar Mover. set Velocity Mover Vector Velocity that is send to the Planar Mover. set Acceleration Mover Vector Acceleration that is send to the Planar Mover. 7.2.2.8.21 Set External Setpoint Reference Id Set External Setpoint Reference Id command Feedback Reference To MC_Planar Feedback set Position Mover Vector set Velocity Mover Vector set Acceleration Mover Vector reference System Oid OTCID Sets the external setpoint for the Planar Mover with corresponing reference system id, must be called each PLC cycle during external setpoint generation. Syntax Definition: 164 Version: 1.8.0 TF5430
## Page 165

PLC Libraries METHOD Set External Setpoint Reference Id VAR_INPUT command Feedback : Reference To MC_Planar Feedback; set Position : Mover Vector; set Velocity : Mover Vector; set Acceleration : Mover Vector; reference System Oid : OTCID; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] set Position Mover Vector Position that is send to the Planar Mover. set Velocity Mover Vector Velocity that is send to the Planar Mover. set Acceleration Mover Vector Acceleration that is send to the Planar Mover. reference Syste OTCID Part or coordinate system id. m Oid 7.2.2.8.22 Add To Group Add To Group command Feedback Reference To MC_Planar Feedback ↔ group MC_Planar Group Adds the Planar Mover to the given Planar Group. Syntax Definition: METHOD Add To Group VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT group : MC_Planar Group; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] In/Outputs Name Type Description group MC_Planar Group [} 149] The Planar Group that the Planar Mover joins. 7.2.2.8.23 Remove From Group Remove From Group command Feedback Reference To MC_Planar Feedback TF5430 Version: 1.8.0 165
## Page 166

PLC Libraries Removes the Planar Mover from its current Planar Group, i.e. disables collision checks. Syntax Definition: METHOD Remove From Group VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.8.24 Get Position On Current Part Get Position On Current Part ↔ position Position XYC Sets the values of the given position to the movers position values on the current part. Syntax Definition: METHOD Get Position On Current Part VAR_IN_OUT position : Position XYC; END_VAR In/Outputs Name Type Description position Position XYC The position on the planar part. 7.2.2.8.25 Get Track Trail Information Get Track Trail Information ↔ track Trail MC_Planar Track Trail Sets the values of the given track trail to the movers internally planned track trail. Syntax Definition: METHOD Get Track Trail Information VAR_IN_OUT track Trail : MC_Planar Track Trail; END_VAR In/Outputs Name Type Description track Trail MC_Planar Track Trail Track trail determining along which tracks the mover will move with the current mvoement on track. 166 Version: 1.8.0 TF5430
## Page 167

PLC Libraries 7.2.2.8.26 Get Planar Object Info Get Planar Object Info Planar Object Info Get Planar Object Info Returns mover object info (type: mover, id: OID of nc mover). Syntax Definition: METHOD Get Planar Object Info : Planar Object Info Return value Planar Object Info [} 135] 7.2.2.9 MC_Planar Part A Planar Part object represents the area that Planar Movers can move on. It contains information about the stator objects. Do not call the main FB directly. Only use the available methods. Methods Name Description Initialize [} 167] Initialize the Planar Part, i.e. connecting it to the MC via its OID. Activate Position [} 168] Activates the position given by part position index. Force Enable [} 168] Removes force disable and enables the part. Allow Enable [} 169] From now on the part can be enabled until Force Disable Part is called. Force Disable [} 169] Disables the part and keeps it disabled until Allow Enabled Part is called. Reset [} 170] Resets the part. Get Position [} 170] Sets the values of the given position to the parts position values. Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.40 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.2.60 7.2.2.9.1 Initialize Initialize command Feedback Reference To MC_Planar Feedback part OID OTCID ↔ environment MC_Planar Environment Initialize the Planar Part, i.e. connecting it to the MC via its OID. TF5430 Version: 1.8.0 167
## Page 168

PLC Libraries Syntax Definition: METHOD Initialize VAR_INPUT command Feedback : Reference To MC_Planar Feedback; part OID : OTCID; END_VAR VAR_IN_OUT environment : MC_Planar Environment; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] part OID OTCID OID of the part. In/Outputs Name Type Description environment MC_Planar Environment Environment the part is in. [} 142] 7.2.2.9.2 Activate Position Activate Position command Feedback Reference To MC_Planar Feedback position Index UDINT Activates the position given by part position index. Syntax Definition: METHOD Activate Position VAR_INPUT command Feedback : Reference To MC_Planar Feedback; position Index : UDINT; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] position Index UDINT Index of the position. 7.2.2.9.3 Force Enable Force Enable command Feedback Reference To MC_Planar Feedback Removes force disable and enables the part. 168 Version: 1.8.0 TF5430
## Page 169

PLC Libraries Syntax Definition: METHOD Force Enable VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback 7.2.2.9.4 Allow Enable Allow Enable command Feedback Reference To MC_Planar Feedback From now on the part can be enabled until Force Disable Part is called. Syntax Definition: METHOD Allow Enable VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.9.5 Force Disable Force Disable command Feedback Reference To MC_Planar Feedback Disables the part and keeps it disabled until Allow Enabled Part is called. Syntax Definition: METHOD Force Disable VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] TF5430 Version: 1.8.0 169
## Page 170

PLC Libraries 7.2.2.9.6 Reset Reset command Feedback Reference To MC_Planar Feedback Resets the part. Syntax Definition: METHOD Reset VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.9.7 Get Position Get Position ↔ position Position XYC Sets the values of the given position to the parts position values. Syntax Definition: METHOD Get Position VAR_IN_OUT position : Position XYC; END_VAR In/Outputs Name Type Description position Position XYC The position of the Planar Part. 7.2.2.10 MC_Planar Track A track within a plane which Planar Movers can follow. Planar Movers on the track automatically avoid collisions with each other. The Planar Track can consist of several consecutive segments and be joined with other Planar Tracks at its start/end. Do not call the main FB directly. Only use the available methods. Methods Name Description Clear [} 171] Clears the geometric information of the Planar Track. Append Position [} 172] Appends a position to the Planar Track. Append Line [} 172] Appends a line to the Planar Track. 170 Version: 1.8.0 TF5430
## Page 171

PLC Libraries Name Description Append Circle [} 173] Appends a circular arc to the Planar Track. Close Loop [} 174] Closes the loop of the Planar Track, no further part can be appended. Start From Track [} 174] Sets the other Planar Track's endpoint as start point of this Planar Track, transition is smooth. The other Planar Track is blocked for further changes (until it is cleared). End At Track [} 175] Appends a smooth transition from the end of this Planar Track to the other Planar Track's start point. The Planar Track is blocked for further changes (until it is cleared). Start From Track Advanced Sets the other Planar Track's endpoint as start point of this Planar Track, transition is smooth. The other Planar Track is blocked for further [} 175] geometrical changes (until it is cleared). End At Track Advanced [} 176] Appends a smooth transition from the end of this Planar Track to the other Planar Track's start point. The Planar Track is blocked for further geometrical changes (until it is cleared). Enable [} 177] Starts enabling the Planar Track. Disable [} 177] Starts disabling the Planar Track. Reset [} 177] Starts resetting the Planar Track. Get Arc Length Closest To [} 178] Calculate the arc length value [mm] where the Planar Track is closest to a geometry's center point. Get Position At [} 178] Get a position on the Planar Track at a specific arc length value. Get Length [} 179] Returns the Planar Track's length [mm], -1 return value indicates no connection to Nc Track. Get Planar Object Info [} 179] Returns track object info (type: track, id: OID of nc track). Update [} 179] Updates internal state of the object, must be triggered each cycle. Add To Group [} 180] Adds the Planar Track to the given Planar Group. Remove From Group [} 180] Removes the Planar Track from its current Planar Group, i.e. disables collision checks. Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.1.10.11 7.2.2.10.1 Clear Clear command Feedback Reference To MC_Planar Feedback Clears the geometric information of the Planar Track. Syntax Definition: METHOD Clear VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR TF5430 Version: 1.8.0 171
## Page 172

PLC Libraries Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.10.2 Append Position Append Position command Feedback Reference To MC_Planar Feedback ↔ position Position XYC Appends a position to the Planar Track. Syntax Definition: METHOD Append Position VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT position : Position XYC; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] In/Outputs Name Type Description position Position XYC Position that is the new endpoint of the Planar Track. 7.2.2.10.3 Append Line Append Line command Feedback Reference To MC_Planar Feedback ↔ start Position XYC ↔ end Position XYC Appends a line to the Planar Track. Syntax Definition: METHOD Append Line VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT start : Position XYC; end : Position XYC; END_VAR 172 Version: 1.8.0 TF5430
## Page 173

PLC Libraries Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] In/Outputs Name Type Description start Position XYC Start position of the line. end Position XYC End position of the line, this position is the new endpoint of the Planar Track. 7.2.2.10.4 Append Circle Append Circle command Feedback Reference To MC_Planar Feedback ↔ start Position XYC ↔ end Position XYC ↔ center Position XY clockwise BOOL Appends a circular arc to the Planar Track. Syntax Definition: METHOD Append Circle VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT start : Position XYC; end : Position XYC; center : Position XY; END_VAR VAR_INPUT clockwise : BOOL; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] clockwise BOOL Indicates if the clockwise circle is appended. In/Outputs Name Type Description start Position XYC Start position of the circular arc. end Position XYC End position of the circular arc, this position is the new endpoint of the Planar Track. center Position XY Center of the circular arc. TF5430 Version: 1.8.0 173
## Page 174

PLC Libraries 7.2.2.10.5 Close Loop Close Loop command Feedback Reference To MC_Planar Feedback Closes the loop of the Planar Track, no further part can be appended. Syntax Definition: METHOD Close Loop VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.10.6 Start From Track Start From Track command Feedback Reference To MC_Planar Feedback ↔ track MC_Planar Track Sets the other Planar Track's endpoint as start point of this Planar Track, transition is smooth. The other Planar Track is blocked for further changes (until it is cleared). Syntax Definition: METHOD Start From Track VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT track : MC_Planar Track; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] In/Outputs Name Type Description track MC_Planar Track [} 170] The other Planar Track. 174 Version: 1.8.0 TF5430
## Page 175

PLC Libraries 7.2.2.10.7 End At Track End At Track command Feedback Reference To MC_Planar Feedback ↔ track MC_Planar Track Appends a smooth transition from the end of this Planar Track to the other Planar Track's start point. The Planar Track is blocked for further changes (until it is cleared). Syntax Definition: METHOD End At Track VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT track : MC_Planar Track; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] In/Outputs Name Type Description track MC_Planar Track [} 170] The other Planar Track. 7.2.2.10.8 Start From Track Advanced Start From Track Advanced command Feedback Reference To MC_Planar Feedback ↔ track MC_Planar Track options Reference To ST_Start From Track Advanced Options Sets the other Planar Track's endpoint as start point of this Planar Track, transition is smooth. The other Planar Track is blocked for further geometrical changes (until it is cleared). Syntax Definition: METHOD Start From Track Advanced VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT track : MC_Planar Track; END_VAR VAR_INPUT options : Reference To ST_Start From Track Advanced Options; END_VAR TF5430 Version: 1.8.0 175
## Page 176

PLC Libraries Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] options Reference To Options for the connection, i.e. which connections are closed. ST_Start From Track Advanc ed Options [} 141] In/Outputs Name Type Description track MC_Planar Track [} 170] The other Planar Track. 7.2.2.10.9 End At Track Advanced End At Track Advanced command Feedback Reference To MC_Planar Feedback ↔ track MC_Planar Track options Reference To ST_End At Track Advanced Options Appends a smooth transition from the end of this Planar Track to the other Planar Track's start point. The Planar Track is blocked for further geometrical changes (until it is cleared). Syntax Definition: METHOD End At Track Advanced VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT track : MC_Planar Track; END_VAR VAR_INPUT options : Reference To ST_End At Track Advanced Options; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] options Reference To Options for the connection, i.e. which connections are closed. ST_End At Track Advanced O ptions [} 136] In/Outputs Name Type Description track MC_Planar Track [} 170] The other Planar Track. 176 Version: 1.8.0 TF5430
## Page 177

PLC Libraries 7.2.2.10.10 Enable Enable command Feedback Reference To MC_Planar Feedback Starts enabling the Planar Track. Syntax Definition: METHOD Enable VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.10.11 Disable Disable command Feedback Reference To MC_Planar Feedback Starts disabling the Planar Track. Syntax Definition: METHOD Disable VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.10.12 Reset Reset command Feedback Reference To MC_Planar Feedback Starts resetting the Planar Track. Syntax Definition: TF5430 Version: 1.8.0 177
## Page 178

PLC Libraries METHOD Reset VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.10.13 Get Arc Length Closest To Get Arc Length Closest To ↔ geometry IPlc Geometry2D LREAL Get Arc Length Closest To Calculate the arc length value [mm] where the Planar Track is closest to a geometry's center point. Syntax Definition: METHOD Get Arc Length Closest To : LREAL VAR_IN_OUT geometry : IPlc Geometry2D; END_VAR In/Outputs Name Type Description geometry IPlc Geometry2D The geometry to check the arc length for. Return value LREAL 7.2.2.10.14 Get Position At Get Position At arc Length LREAL ↔ position Position XYC Get a position on the Planar Track at a specific arc length value. Syntax Definition: METHOD Get Position At VAR_INPUT arc Length : LREAL; END_VAR VAR_IN_OUT position : Position XYC; END_VAR 178 Version: 1.8.0 TF5430
## Page 179

PLC Libraries Inputs Name Type Description arc Length LREAL Arc length value where the position is evaluated. In/Outputs Name Type Description position Position XYC The position at the specified arc parameter. 7.2.2.10.15 Get Length Get Length LREAL Get Length Returns the Planar Track's length [mm], -1 return value indicates no connection to Nc Track. Syntax Definition: METHOD Get Length : LREAL Return value LREAL 7.2.2.10.16 Get Planar Object Info Get Planar Object Info Planar Object Info Get Planar Object Info Returns track object info (type: track, id: OID of nc track). Syntax Definition: METHOD Get Planar Object Info : Planar Object Info Return value Planar Object Info [} 135] 7.2.2.10.17 Update Update Updates internal state of the object, must be triggered each cycle. Syntax Definition: METHOD Update TF5430 Version: 1.8.0 179
## Page 180

PLC Libraries 7.2.2.10.18 Add To Group Add To Group command Feedback Reference To MC_Planar Feedback ↔ group MC_Planar Group Adds the Planar Track to the given Planar Group. Syntax Definition: METHOD Add To Group VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR VAR_IN_OUT group : MC_Planar Group; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] In/Outputs Name Type Description group MC_Planar Group [} 149] The Planar Group that the mover joins. 7.2.2.10.19 Remove From Group Remove From Group command Feedback Reference To MC_Planar Feedback Removes the Planar Track from its current Planar Group, i.e. disables collision checks. Syntax Definition: METHOD Remove From Group VAR_INPUT command Feedback : Reference To MC_Planar Feedback; END_VAR Inputs Name Type Description command Feed Reference To The feedback object for the command. back MC_Planar Feedback [} 145] 7.2.2.11 MC_Planar Track Trail A list of distinct tracks each starting at the ending vertex of its predecessor. 180 Version: 1.8.0 TF5430
## Page 181

PLC Libraries Do not call the main FB directly. Only use the available methods. Methods Name Description Clear [} 181] Clears the Track Trail. Add Track [} 181] Adds a track to the Track Trail. The track should start at the end vertex of the currently last track. Get Track Oid At [} 182] Returns the oid of the track at the specified index [1, ..., size] in the trail. Zero is returned on error. Required License TC3 Planar Motion Base System Requirements Development environment Target system type PLC libraries to include Twin CAT V3.1.4024.12 PC or CX (x64) Tc3_Mc3Planar Motion, Tc3_Physics Advanced Motion Pack V3.1.10.11 7.2.2.11.1 Clear Clear Clears the Track Trail. Syntax Definition: METHOD Clear 7.2.2.11.2 Add Track Add Track ↔ track MC_Planar Track Adds a track to the Track Trail. The track should start at the end vertex of the currently last track. Syntax Definition: METHOD Add Track VAR_IN_OUT track : MC_Planar Track; END_VAR In/Outputs Name Type Description track MC_Planar Track [} 170] The track to be added to the end of the Track Trail. TF5430 Version: 1.8.0 181
## Page 182

PLC Libraries 7.2.2.11.3 Get Track Oid At Get Track Oid At index UDINT OTCID Get Track Oid At Returns the oid of the track at the specified index [1, ..., size] in the trail. Zero is returned on error. Syntax Definition: METHOD Get Track Oid At : OTCID VAR_INPUT index : UDINT; END_VAR Inputs Name Type Description index UDINT Index of the track in the trail [1, ..., size]. Return value OTCID 182 Version: 1.8.0 TF5430
## Page 183

Support and Service 8 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF5430 Version: 1.8.0 183
## Page 184

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H.
## Page 185

More Information: www.beckhoff.com/TF5430 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
