---
title: "TF6310_sACN_EN"
product: "TF6310"
category: "Communication"
tags: ["ACN"]
language: "EN"
document_type: "Manual"
version: "1.2"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6310_sACN_EN.pdf"
release_date: "2021-01-21"
---
AS2000 Manual | EN s ACN 2016 Blindtext Blindtext Blindtext Twin CAT 3 2021-01-21 | Version: 1.2
## Page 3

Table of Contents Table of Contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation.............................................................................................................. 5 1.2 Safety instructions............................................................................................................................. 6 2 Overview..................................................................................................................................................... 7 2.1 Update History................................................................................................................................... 8 3 Programming............................................................................................................................................. 9 3.1 Function Blocks................................................................................................................................. 9 3.1.1 FB_s ACN........................................................................................................................... 9 3.1.2 FB_s ACN_Ex................................................................................................................... 12 3.1.3 FB_UDP_Connection...................................................................................................... 16 3.2 Structures, Interfaces...................................................................................................................... 17 3.2.1 Structures........................................................................................................................ 17 3.2.2 Interfaces......................................................................................................................... 17 4 Example.................................................................................................................................................... 20 5 Appendix.................................................................................................................................................. 22 5.1 Properties about time...................................................................................................................... 22 5.2 Status indicator................................................................................................................................ 22 5.3 Target host and target universe....................................................................................................... 22 5.4 Multicast Group............................................................................................................................... 24 s ACN 2016 Version: 1.2 3
## Page 4

Table of Contents 4 Version: 1.2 s ACN 2016
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilization of this document as well as the communication of its contents to others without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. s ACN 2016 Version: 1.2 5
## Page 6

Foreword 1.2 Safety instructions Safety regulations Please note the following safety instructions and explanations! Product-specific safety instructions can be found on following pages or in the areas mounting, wiring, commissioning etc. Exclusion of liability All the components are supplied in particular hardware and software configurations appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation and drive engineering who are familiar with the applicable national standards. Description of symbols In this documentation the following symbols are used with an accompanying safety instruction or note. The safety instructions must be read carefully and followed without fail! DANGER Serious risk of injury! Failure to follow the safety instructions associated with this symbol directly endangers the life and health of persons. WARNING Risk of injury! Failure to follow the safety instructions associated with this symbol endangers the life and health of per- sons. CAUTION Personal injuries! Failure to follow the safety instructions associated with this symbol can lead to injuries to persons. NOTE Damage to the environment or devices Failure to follow the instructions associated with this symbol can lead to damage to the environment or equipment. Tip or pointer This symbol indicates information that contributes to better understanding. 6 Version: 1.2 s ACN 2016
## Page 7

Overview 2 Overview Note This documentation refers to the ANSI standard E1.31-2016 and the use of Twin CAT3. DMX is a standard that is widely used for controlling lighting elements in stage and building services applications. Beckhoff offers the EL6851 DMX master terminal and the EL6851-0010 DMX slave terminal for this purpose. ESTA (Entertainment Services and Technology Association) developed Streaming Architecture for Control Networks (s ACN in the following) to enable the benefits of Ethernet to be utilised for DMX. It transfers DMX universe data via UDP/IP. The DMX data is embedded in the s ACN frame as a complete universe and tunneled through UDP/IP. s ACN is defined through ANSI standard E1.31-2009 (in short s ACN-2009) and represents a subset of the ACN standard (ANSI standard E1.17). In 2016, ESTA has enrolled the new version of s ACN standard, E1.31-2016 (in short s ACN-2016), which added two new frame types, the “Synchronization Frame” and “Universe Discovery Frame”. The Synchronization Frame is a packet that contains only universe synchronization information and it is used to trigger synchronization. The Universe Discovery Frame is a packet that contains a packed list of the universe on which a source is actively operating. This frame allows other devices interested in network traffic to monitor which universes are currently active without to join every multicast group. s ACN data can be mapped to any data types in Twin CAT. s ACN is a protocol specification for transmitting DMX data and was developed by ESTA. s ACN is simplified to Art-Net™ and the information about Art-Net™ can also be found at our website. Further information about the market activities of Beckhoff in the market stage and show can be found on our website at: PC-based Control for Stage and Show Technology. System Requirement: s ACN 2016 Version: 1.2 7
## Page 8

Overview Technical Data Requirement Twin CAT version Twin CAT 3.1 build 4022.20 or higher Visual Studio version Visual Studio 2013 or higher Required Twin CAT license TF6310 licence 2.1 Update History [Version 3.0.0.0] – 2020.12.15 Changed: • Changed the major version number of this library to 3.x.x.x because of Twin CAT 3. • Move this library file into the library category “Entertainment_Industry”. 8 Version: 1.2 s ACN 2016
## Page 9

Programming 3 Programming This sample generally consists of two modules, an encoder / decoder module and a communication module. For the sending process, a DMX frame is wrapped by the encoder / decoder module following the s ACN structure. Then the wrapped s ACN frame is internally transfered through the interface to the communication module. The communication module will send the s ACN frame to the target client via UDP. For the receiving process, an s ACN frame is received and validated by the communication module and then transfered to the encoder / decoder function block. This function block will identify the type of s ACN frame and extract the DMX frame and the related information about the sending server. 3.1 Function Blocks The function blocks FB_s ACN and FB_s ACN_Ex belong to the encoder / decoder module. The communication module consists of one function block FB_UDP_Connection. The two interfaces are ICommunication and I_s ACN. The function block FB_s ACN implemented s ACN-2009, and the function block FB_s ACN_Ex that derived from FB_s ACN, implemented s ACN-2016. FB_UDP_Connection enbables sending and receiving of frames via UDP. It is an implementation of interface ICommunication and it should be instanced and linked to the function block FB_s ACN or FB_s ACN_Ex. According to the s ACN specification the usage of s ACN frame is carried in UDP packets and in the future, the frame maybe allowed to carry over other networks supported by ACN. 3.1.1 FB_s ACN This function block enables sending and receiving of s ACN data frame. With the help of the function block FB_UDP_Communication, frames can be sent and received via UDP. Because Send and Receive methods are asynchronous, they need more than one cycle to finish working. Only one method could be invoked at the same time. Therefore, always check the output parameter b Busy when calling these methods. Syntax FUNCTION_BLOCK FB_s ACN IMPLEMENTS I_s ACN VAR_OUTPUT b Busy : BOOL; b Error : BOOL; b Communicated : BOOL; ip Result Message : I_Tc Message; END_VAR VAR_OUTPUT b Busy: Is set if an s ACN frame is being sent/received. b Error: Is set if an error occurs. You can find error details included Error ID in the “Error List” window. s ACN 2016 Version: 1.2 9
## Page 10

Programming b Communicated: Is set after the first s ACN frame is successfully sent or received. More information can be found at section Status indicator [} 22]. ip Result Message: Enables error handling with the Tc3_Event Logger. METHODS FB_init: Initialization method. Send: Sending s ACN frames (s ACN-2009). Receive: Receiving s ACN frames. INTERFACE I_s ACN: Defines the interface of send and receive methods. 3.1.1.1 FB_init VAR_INPUT Method FB_init : BOOL VAR_INPUT ip Communication : ICommunication; a CID : ARRAY[1..16] OF BYTE; END_VAR ip Communication: Communication function block that implements the interface ICommunication. a CID: Component Identifier. Sender's unique ID. Example: Declaration of the function block FB_s ACN. PROGRAM MAIN VAR fbs ACN : FB_s ACN(fb UDP, a CID); fb UDP : FB_UDP_CONNECTION; a CID : ARRAY[1..16] OF BYTE; END_VAR 3.1.1.2 I_s ACN The function block FB_s ACN and its derived function block FB_s ACN_Ex both implemented the interface I_s ACN. With its help these two function blocks can be switched online only when the b Busy is FALSE. METHODS Send: Send frames. Receive: Receive frames. Example: MAIN VAR fbs ACN : FB_s ACN(ip Communication:= fb UDP, a CID := a CID); is ACN : I_s ACN := fbs ACN; fbs ACNex : FB_s ACN_Ex(ip Communication:= fb UDP, a CID:= a CID); fb UDP : FB_UDP_Connection(s Local Host:= '192.168.1.100', n Local Port:= 200, s Srv Net Id:= ''); a CID : ARRAY[1..16] OF BYTE; b Switch : BOOL; b Extended : BOOL; b Busy : BOOL; END_VAR 10 Version: 1.2 s ACN 2016
## Page 11

Programming IF b Switch AND NOT b Busy THEN b Extended := NOT b Extended; b Switch := FALSE; END_IF IF b Extended THEN is ACN := fbs ACNex; b Busy := fbs ACNex.b Busy OR fb UDP.b Busy; ELSE is ACN := fbs ACN; b Busy := fbs ACN.b Busy OR fb UDP.b Busy; END_IF 3.1.1.2.1 Send This method enables to send UDP frames. The method returns TRUE if a valid s ACN frame has been sent. Syntax Method Send: BOOL VAR_INPUT s Source Name : STRING; s Remote Host : T_IPv4Addr := ‘239.255.0.1’; n DMXUniverse : UINT := 1; n Priority : USINT := 100; b Preview Data : BOOL := FALSE; b Stream Terminated : BOOL := FALSE; p DMXData : POINTER TO BYTE; b Force Synchron : BOOL := TRUE; n Synchron Universe : UINT := 0; END_VAR VAR_INPUT s Source Name : Source Name. s Remote Host : Target IPv4 address. Unicast and multicast addresses are possible. n DMXUniverse : Target DMX Universe. n Priority : Data priority if multiple sources. b Preview Data : Option Bit: Preview_Data. b Stream Terminated : Option Bit: Stream_Terminated. p DMXData : Pointer to DMX data. b Force Synchron : New Option Bit of s ACN-2016: Force_Synchronization. n Synchron Universe : Synchronization Universe, ignored in s ACN-2009. 1. After the rising edge of b Stream Terminated was triggered, the client will continue sending 3 s ACN data frames that include the same DMX data, an incremented sequence number, and the ter- minated flag. After a timeout is expired, the opened socket will be closed and then the sending process is completely terminated unless the falling edge of b Stream Terminated is triggered. (More details see this [} 22]) 2. b Force Synchron and b Synchron Universe are new features that are defined in s ACN-2016. At function block FB_s ACN these two variables are set to 0 internally and any other input values will be ignored. 3.1.1.2.2 Receive This method enables to receive UDP frame. The method returns TRUE if a s ACN frame has been received. Syntax Method Receive : BOOL VAR_INPUT s Target Host : T_IPv4Addr := ‘239.255.0.1’; s ACN 2016 Version: 1.2 11
## Page 12

Programming n Target Universe : UINT; s Source Name : REFERENCE TO STRING(64); n DMXUniverse : REFERENCE TO UINT; a DMXData : REFERENCE TO ARRAY[1..512] OF BYTE; s Src Host : REFERENCE TO T_IPv4Addr; n Src Port : REFERENCE TO UDINT; b Stream Terminated : REFERENCE TO BOOL; st Frame Counter : REFERENCE TO ST_Frame Counter; n Synchron Universe : REFERENCE TO UINT; s Discovered Universe : REFERENCE TO T_Max String; END_VAR VAR_INPUT s Target Host: Target IPv4 address from which s ACN frames will be received. Unicast and multicast addresses are possible. n Target Universe : Target universe from which the s ACN frame will be received. REFERENCE TO … (OUTPUT) s Source Name: Source Name of received s ACN data frames. n DMXUniverse : DMX universe of received s ACN data frames. a DMXData : Received DMX Data. s Src Host : IPv4 address of remote device from which the s ACN frames have been received. n Src Port : IPv4 port number of remote device from which the s ACN frames have been received. b Stream Terminated : Is TRUE if data source for the universe has terminated transmission. In consequence this client will stop receiving s ACN frames. st Frame Counter : Counter of received s ACN frames. n Synchron Universe : Synchronization universe of received s ACN data frames. s Discovered Universe : A list of universes from which s ACN data and synchronization frames have been transmitted within 10s. 1. s Discovered Universe presents which universes are currently active. It refreshes after a new Universe Discovery frame has been arrived. It presents nothing (empty string) at FB_s ACN. 2. The Universe Discovery Frame and Synchronization Frame are new types of s ACN frames and they are defined in s ACN-2016. These two types of frames cannot be recognized by the counter of FB_s ACN (s ACN-2009). These frames can be received but are counted as "Unknown" frames. 3.1.2 FB_s ACN_Ex This function block is derived from FB_s ACN and it implements the s ACN-2016. Because the Send, Receive, and Send Synchronization Frame methods are asynchronous and they need more than one cycle to finish working, only one method could be invoked at the same time. Therefore, always check the output parameter b Busy when calling these methods. Syntax FUNCTION_BLOCK FB_s ACN_Ex EXTENDS FB_s ACN VAR_OUTPUT b Busy : BOOL; b Error : BOOL; 12 Version: 1.2 s ACN 2016
## Page 13

Programming b Communicated : BOOL; ip Result Message : I_Tc Message; END_VAR VAR_OUTPUT b Busy: Is set if a valid s ACN frame is being sent/received. b Error: Is set if an error occurs. You can find error details included Error ID in logged event. b Communicated: Is set after the first streaming ACN frame is successfully sent or received. More information can be found at section Status indicator [} 22]. ip Result Message: Enables error handling with the Tc3_Event Logger. METHODS FB_init: Initialization method Send: Sending s ACN frames (s ACN-2016). Receive: Receiving s ACN frames. Send Synchronization Frame: Send s ACN synchronization frame. 3.1.2.1 FB_init Method FB_init : BOOL VAR_INPUT ip Communication : ICommunication; a CID : ARRAY[1..16] OF BYTE; END_VAR VAR_INPUT ip Communication: Communication function block that implements the interface ICommunication. a CID: Component Identifier. Sender's unique ID. Example: Declaration of the function block FB_s ACN_Ex: PROGRAM MAIN VAR fbs ACNex : FB_s ACN_Ex(fb UDP, a CID); fb UDP : FB_UDP_CONNECTION; a CID : ARRAY[1..16] OF BYTE; END_VAR 3.1.2.2 Send Synchronization Frame This method enables to send s ACN synchronization frame that is used to trigger synchronization. • This method returns TRUE as soon as the request of sending an s ACN synchronization frame is terminated. • This method returns FALSE if the asynchronous request is still active. The method must be called until it was successfully executed, and the return value is TRUE. Method Send Synchronization Frame : BOOL VAR_INPUT n Synchron Universe : UINT := 0; END_VAR VAR_INPUT n Synchron Universe: Universe from which synchronization frames are transmitted. s ACN 2016 Version: 1.2 13
## Page 14

Programming This Method can only be invoked if b Busy is FALSE. 3.1.2.3 I_s ACN The function block FB_s ACN and its derived function block FB_s ACN_Ex both implemented the interface I_s ACN. With its help these two function blocks can be switched online only when the b Busy is FALSE. METHODS Send: Send frames. Receive: Receive frames. Example: MAIN VAR fbs ACN : FB_s ACN(ip Communication:= fb UDP, a CID := a CID); is ACN : I_s ACN := fbs ACN; fbs ACNex : FB_s ACN_Ex(ip Communication:= fb UDP, a CID:= a CID); fb UDP : FB_UDP_Connection(s Local Host:= '192.168.1.100', n Local Port:= 200, s Srv Net Id:= ''); a CID : ARRAY[1..16] OF BYTE; b Switch : BOOL; b Extended : BOOL; b Busy : BOOL; END_VAR IF b Switch AND NOT b Busy THEN b Extended := NOT b Extended; b Switch := FALSE; END_IF IF b Extended THEN is ACN := fbs ACNex; b Busy := fbs ACNex.b Busy OR fb UDP.b Busy; ELSE is ACN := fbs ACN; b Busy := fbs ACN.b Busy OR fb UDP.b Busy; END_IF 3.1.2.3.1 Send This method enables to send UDP frames. The method returns TRUE if a valid s ACN frame has been sent. Syntax Method Send: BOOL VAR_INPUT s Source Name : STRING; s Remote Host : T_IPv4Addr := ‘239.255.0.1’; n DMXUniverse : UINT := 1; n Priority : USINT := 100; b Preview Data : BOOL := FALSE; b Stream Terminated : BOOL := FALSE; p DMXData : POINTER TO BYTE; b Force Synchron : BOOL := TRUE; n Synchron Universe : UINT := 0; END_VAR VAR_INPUT s Source Name : Source Name. s Remote Host : Target IPv4 address. Unicast and multicast addresses are possible. n DMXUniverse : Target DMX Universe. n Priority : Data priority if multiple sources. 14 Version: 1.2 s ACN 2016
## Page 15

Programming b Preview Data : Option Bit: Preview_Data. b Stream Terminated : Option Bit: Stream_Terminated. p DMXData : Pointer to DMX data. b Force Synchron : New Option Bit of s ACN-2016: Force_Synchronization. n Synchron Universe : Synchronization Universe, ignored in s ACN-2009. 1. After the rising edge of b Stream Terminated was triggered, the client will continue sending 3 s ACN data frames that include the same DMX data, an incremented sequence number, and the ter- minated flag. After a timeout is expired, the opened socket will be closed and then the sending process is completely terminated unless the falling edge of b Stream Terminated is triggered. (More details see this [} 22]) 2. b Force Synchron and b Synchron Universe are new features that are defined in s ACN-2016. At function block FB_s ACN these two variables are set to 0 internally and any other input values will be ignored. 3.1.2.3.2 Receive This method enables to receive UDP frame. The method returns TRUE if a s ACN frame has been received. Syntax Method Receive : BOOL VAR_INPUT s Target Host : T_IPv4Addr := ‘239.255.0.1’; n Target Universe : UINT; s Source Name : REFERENCE TO STRING(64); n DMXUniverse : REFERENCE TO UINT; a DMXData : REFERENCE TO ARRAY[1..512] OF BYTE; s Src Host : REFERENCE TO T_IPv4Addr; n Src Port : REFERENCE TO UDINT; b Stream Terminated : REFERENCE TO BOOL; st Frame Counter : REFERENCE TO ST_Frame Counter; n Synchron Universe : REFERENCE TO UINT; s Discovered Universe : REFERENCE TO T_Max String; END_VAR VAR_INPUT s Target Host: Target IPv4 address from which s ACN frames will be received. Unicast and multicast addresses are possible. n Target Universe : Target universe from which the s ACN frame will be received. REFERENCE TO … (OUTPUT) s Source Name: Source Name of received s ACN data frames. n DMXUniverse : DMX universe of received s ACN data frames. a DMXData : Received DMX Data. s Src Host : IPv4 address of remote device from which the s ACN frames have been received. n Src Port : IPv4 port number of remote device from which the s ACN frames have been received. b Stream Terminated : Is TRUE if data source for the universe has terminated transmission. In consequence this client will stop receiving s ACN frames. st Frame Counter : Counter of received s ACN frames. n Synchron Universe : Synchronization universe of received s ACN data frames. s Discovered Universe : A list of universes from which s ACN data and synchronization frames have been transmitted within 10s. s ACN 2016 Version: 1.2 15
## Page 16

Programming 1. s Discovered Universe presents which universes are currently active. It refreshes after a new Universe Discovery frame has been arrived. It presents nothing (empty string) at FB_s ACN. 2. The Universe Discovery Frame and Synchronization Frame are new types of s ACN frames and they are defined in s ACN-2016. These two types of frames cannot be recognized by the counter of FB_s ACN (s ACN-2009). These frames can be received but are counted as "Unknown" frames. 3.1.3 FB_UDP_Connection This function block enables to create or terminate a UDP connection. This function block can only be used as the initial variable of function block FB_s ACN and FB_s ACN_Ex. It cannot be invoked directly. Syntax FUNCTION_BLOCK FB_UDP_Connection IMPLEMENTS ICommunication VAR_OUTPUT b Busy : BOOL; b Error : BOOL; b Connected : BOOL; ip Result Message : I_Tc Message; END_VAR VAR_OUTPUT b Busy: Is TRUE as long as the asynchronous request is still active. Is FALSE if the request is completed. (More information can be found at section Status indicator [} 22]) b Error: Is set if an error occurs during execution of the function block. Error details can be found at “Error List” window. b Connected: Is TRUE as long as a socket is opened without error; is FALSE if socket is closed. ip Result Message: Enables error handling with the Tc3_Event Logger. METHODS FB_init: Initialization method INTERFACE ICommunication: Defines the interface of communication methods. 3.1.3.1 FB_init Method FB_init : BOOL VAR_INPUT s Local Host : T_IPv4Addr; n Local Port : UINT := 200; s Srv Net Id : T_Ams Net Id; END_VAR VAR_INPUT s Local Host: The Local IP address (IPv4) of the UDP socket as a string 16 Version: 1.2 s ACN 2016
## Page 17

Programming n Local Port: The local IP port number of the UDP socket. Default value is 200. s Srv Net Id: AMS Net Id. For the local computer (default) an empty string may be specified. Variable n Local Port is only for the socket that is used for the sending process. During the receiv- ing process the port number must be 5568, other values will be ignored. Example: Declaration of the function block FB_UDP_CONNECTION: PROGRAM MAIN VAR fb UDP : FB_UDP_CONNECTION (s Local Host:= ‘192.168.1.100’, n Local Port:= 200, s Srv Net Id:= ‘ ’); END_VAR 3.1.3.2 ICommunication This interface defines a communication interface in order to make data exchange between two function blocks possible. This interface has been implemented internally and users do not need to implement it. 3.2 Structures, Interfaces 3.2.1 Structures 3.2.1.1 ST_Frame Counter TYPE ST_Frame Counter: STRUCT n DMX_Frames : UDINT; n Synchronization_Frames : UDINT; n Universe_Discovery_Frames : UDINT; n Unknown_s ACN_Frames : UDINT; END_STRUCT END_TYPE The Universe Discovery frame and Synchronization frame are new types of s ACN frames and de- fined in s ACN-2016. They can also be received by FB_s ACN (s ACN-2009), but they are counted as "Unknown" frames. 3.2.2 Interfaces 3.2.2.1 ICommunication This interface defines a communication interface in order to make data exchange between two function blocks possible. This interface has been implemented internally and users do not need to implement it. 3.2.2.2 I_s ACN The function block FB_s ACN and its derived function block FB_s ACN_Ex both implemented the interface I_s ACN. With its help these two function blocks can be switched online only when the b Busy is FALSE. METHODS Send: Send frames. s ACN 2016 Version: 1.2 17
## Page 18

Programming Receive: Receive frames. Example: MAIN VAR fbs ACN : FB_s ACN(ip Communication:= fb UDP, a CID := a CID); is ACN : I_s ACN := fbs ACN; fbs ACNex : FB_s ACN_Ex(ip Communication:= fb UDP, a CID:= a CID); fb UDP : FB_UDP_Connection(s Local Host:= '192.168.1.100', n Local Port:= 200, s Srv Net Id:= ''); a CID : ARRAY[1..16] OF BYTE; b Switch : BOOL; b Extended : BOOL; b Busy : BOOL; END_VAR IF b Switch AND NOT b Busy THEN b Extended := NOT b Extended; b Switch := FALSE; END_IF IF b Extended THEN is ACN := fbs ACNex; b Busy := fbs ACNex.b Busy OR fb UDP.b Busy; ELSE is ACN := fbs ACN; b Busy := fbs ACN.b Busy OR fb UDP.b Busy; END_IF 3.2.2.2.1 Send This method enables to send UDP frames. The method returns TRUE if a valid s ACN frame has been sent. Syntax Method Send: BOOL VAR_INPUT s Source Name : STRING; s Remote Host : T_IPv4Addr := ‘239.255.0.1’; n DMXUniverse : UINT := 1; n Priority : USINT := 100; b Preview Data : BOOL := FALSE; b Stream Terminated : BOOL := FALSE; p DMXData : POINTER TO BYTE; b Force Synchron : BOOL := TRUE; n Synchron Universe : UINT := 0; END_VAR VAR_INPUT s Source Name : Source Name. s Remote Host : Target IPv4 address. Unicast and multicast addresses are possible. n DMXUniverse : Target DMX Universe. n Priority : Data priority if multiple sources. b Preview Data : Option Bit: Preview_Data. b Stream Terminated : Option Bit: Stream_Terminated. p DMXData : Pointer to DMX data. b Force Synchron : New Option Bit of s ACN-2016: Force_Synchronization. n Synchron Universe : Synchronization Universe, ignored in s ACN-2009. 18 Version: 1.2 s ACN 2016
## Page 19

Programming 1. After the rising edge of b Stream Terminated was triggered, the client will continue sending 3 s ACN data frames that include the same DMX data, an incremented sequence number, and the ter- minated flag. After a timeout is expired, the opened socket will be closed and then the sending process is completely terminated unless the falling edge of b Stream Terminated is triggered. (More details see this [} 22]) 2. b Force Synchron and b Synchron Universe are new features that are defined in s ACN-2016. At function block FB_s ACN these two variables are set to 0 internally and any other input values will be ignored. 3.2.2.2.2 Receive This method enables to receive UDP frame. The method returns TRUE if a s ACN frame has been received. Syntax Method Receive : BOOL VAR_INPUT s Target Host : T_IPv4Addr := ‘239.255.0.1’; n Target Universe : UINT; s Source Name : REFERENCE TO STRING(64); n DMXUniverse : REFERENCE TO UINT; a DMXData : REFERENCE TO ARRAY[1..512] OF BYTE; s Src Host : REFERENCE TO T_IPv4Addr; n Src Port : REFERENCE TO UDINT; b Stream Terminated : REFERENCE TO BOOL; st Frame Counter : REFERENCE TO ST_Frame Counter; n Synchron Universe : REFERENCE TO UINT; s Discovered Universe : REFERENCE TO T_Max String; END_VAR VAR_INPUT s Target Host: Target IPv4 address from which s ACN frames will be received. Unicast and multicast addresses are possible. n Target Universe : Target universe from which the s ACN frame will be received. REFERENCE TO … (OUTPUT) s Source Name: Source Name of received s ACN data frames. n DMXUniverse : DMX universe of received s ACN data frames. a DMXData : Received DMX Data. s Src Host : IPv4 address of remote device from which the s ACN frames have been received. n Src Port : IPv4 port number of remote device from which the s ACN frames have been received. b Stream Terminated : Is TRUE if data source for the universe has terminated transmission. In consequence this client will stop receiving s ACN frames. st Frame Counter : Counter of received s ACN frames. n Synchron Universe : Synchronization universe of received s ACN data frames. s Discovered Universe : A list of universes from which s ACN data and synchronization frames have been transmitted within 10s. 1. s Discovered Universe presents which universes are currently active. It refreshes after a new Universe Discovery frame has been arrived. It presents nothing (empty string) at FB_s ACN. 2. The Universe Discovery Frame and Synchronization Frame are new types of s ACN frames and they are defined in s ACN-2016. These two types of frames cannot be recognized by the counter of FB_s ACN (s ACN-2009). These frames can be received but are counted as "Unknown" frames. s ACN 2016 Version: 1.2 19
## Page 20

Example 4 Example This https://infosys.beckhoff.com/content/1033/TF6310_s ACN/Resources/zip/9007207188597515.zip contains a PLC program for Twin CAT 3 that presents general sending and receiving of s ACN frames. In any use case the user data of the s ACN frame can be linked with any PLC variables. This allows a very flexible use of this example. Users can create their own programs based on their needs. The individual function blocks of the example are explained in the Programming section. For example, a state machine can be used to realize a logic, where listening in the receiving method is basically used and followed by the sending method on a special event or timer. Alternatively, if the sending method and receiving method should be triggered at the same time, two instances could be declared: One instance for sending and the other for receiving. There is in addition a Twin CAT 2 sample available which support only the s ACN version 2009. Both s ACN versions “s ACN 2009” and “s ACN 2016” are implemented in this Twin CAT 3 example. So that users who want to use the “s ACN 2009” version on the Twin CAT 3 platform can do this. The main idea of this sample is to be used for s ACN applications using version s ACN 2016, nevertheless the online switching of both s ACN versions is demonstrated in this sample. It is possible to switch online between these two s ACN versions with the help of instantiating the interface “is ACN” and triggering the variable “b Switch”. 20 Version: 1.2 s ACN 2016
## Page 21

Example s ACN 2016 Version: 1.2 21
## Page 22

Appendix 5 Appendix 5.1 Properties about time In this project some time properties are defined internally, and they cannot be modified by users. In the following, these time properties and the associated running logic are explained. Sending process: • According to s ACN-2016, the Universe Discovery Frame is sent every 10s. • After data frames with the terminate flag have been sent, the socket kept opened in 2.5s, in order to keep receiving s ACN frames arriving from other sources during this period. After time has been expired, this socket is closed and b Communicated and b Connected are set back to FALSE. Socket cannot be reopened unless a falling edge of terminate variable b Stream Terminated occurs. Receiving process: • According to the s ACN specification the receiving process will be terminated, and the client will change to idle state, if no new s ACN Data Frame has been received in a period of 2.5s. The socket keeps opened if no error occurs during the idle time. • If no error occurs during idle state, the receiving process will restart after 5s. 5.2 Status indicator b Communicated It is an output variable of FB_s ACN and FB_s ACN_ex. It indicates the state of the sender / receiver process. • It sets TRUE if an s ACN frame has been successfully sent or received. • It sets FALSE if terminated flag has been fired. The client goes in idle state if no error occurs. b Connected It is an output variable of the function block FB_UDP_Connection. It indicates the connection status. • It sets TRUE if a UDP socket has been successfully opened without an error. • It sets FALSE if socket has been closed or an error occurred. b Busy It is an output variable of all function blocks. • It sets TRUE as long as the processing is not completed. Each new input variable of methods or switching of s ACN function blocks can be accepted ONLY when b Busy is FALSE. • It sets FALSE as long as a processing is completed without error (b Error is FALSE) or a processing is not completed but an error occurs (b Error is TRUE). b Error It sets TRUE if an error occurs. 5.3 Target host and target universe The target host variable s Target Host and target universe variable n Target Universe are the target IPv4 address and the port where the s ACN frames are sent to and come from. 22 Version: 1.2 s ACN 2016
## Page 23

Appendix According to the s ACN specification, in multicast mode the last two bytes of a multicast address are defined by high-byte and low-byte of the universe. If the target host is mismatched to the target universe, the universe is dominated. In this case multicast address must be corrected. In consequence the original multicast address is ignored (Situation 1). However, if the target universe is invalid (universe > 63999 or universe = 0) but the target host is a multicast address, the universe should be converted based on the target host and the invalid target universe will be ignored (Situation 2). Especially if both variables are invalid, or the target host is a unicast address while the target universe is invalid, then an error occurs, and the error information can be found in the "Error List" window (Situation 3). If the target universe is valid and target host is a unicast address, these rules are not concerned (Situation 4). Here are some examples. Example for Situation 1: The target host is 239.255.0.1 and the target universe is 2. Because the target universe is valid and the target host is a multicast address, the target host will be changed to 239.255.0.2. Example for Situation 2: The target host is 239.255.0.1 and the target universe is 0. Because the target universe is invalid and the target host is a multicast address, the target universe will be changed to 1. s ACN 2016 Version: 1.2 23
## Page 24

Appendix Example for Situation 3: The target host is 0.0.0.0 or 192.168.0.1 and the target universe is 0. An error occurs. Example for Situation 4: The target host is 192.168.0.100 and the target universe is 1. Both values are accepted without conversion. 5.4 Multicast Group In order to receive s ACN frames from different Multicast Groups (MCGs in short), joining more MCGs is supported in this project. Users could either give the new MCG address at input s Target Host or write associated new universe at input n Target Universe. All joined MCGs will be saved and users do not need to give new MCG address in 2nd time. The array capacity of saved MCGs is 100, and the first joined MCG will be overwritten if the array is overloaded. 24 Version: 1.2 s ACN 2016
## Page 26

More Information: www.beckhoff.com/stage Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
