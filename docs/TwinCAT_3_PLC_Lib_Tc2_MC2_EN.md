---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "2.15.4"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_MC2_EN.pdf"
release_date: "2025-08-04"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc2_MC2 2025-08-04 | Version: 2.15.4
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 7 1.1 Notes on the documentation............................................................................................................. 7 1.2 For your safety.................................................................................................................................. 7 1.3 Notes on information security............................................................................................................ 9 2 Overview.................................................................................................................................................. 10 3 State diagram.......................................................................................................................................... 11 4 General rules for MC function blocks................................................................................................... 14 5 Organization blocks................................................................................................................................ 17 5.1 Axis functions.................................................................................................................................. 17 5.1.1 MC_Power....................................................................................................................... 17 5.1.2 MC_Reset........................................................................................................................ 18 5.1.3 MC_Set Position............................................................................................................... 19 5.2 Status and parameter...................................................................................................................... 21 5.2.1 MC_Read Actual Position.................................................................................................. 21 5.2.2 MC_Read Actual Velocity.................................................................................................. 22 5.2.3 MC_Read Axis Components.............................................................................................. 23 5.2.4 MC_Read Axis Error.......................................................................................................... 24 5.2.5 MC_Read Bool Parameter................................................................................................. 25 5.2.6 MC_Read Parameter........................................................................................................ 27 5.2.7 MC_Read Parameter Set................................................................................................... 28 5.2.8 MC_Read Status............................................................................................................... 29 5.2.9 MC_Write Bool Parameter................................................................................................. 31 5.2.10 MC_Write Parameter........................................................................................................ 32 5.2.11 MC_Write Bool Parameter Persistent................................................................................. 33 5.2.12 MC_Write Parameter Persistent........................................................................................ 34 5.3 Touch probe.................................................................................................................................... 35 5.3.1 MC_Touch Probe.............................................................................................................. 35 5.3.2 MC_Abort Trigger.............................................................................................................. 39 5.4 External set value generator........................................................................................................... 40 5.4.1 MC_Ext Set Point Gen Enable............................................................................................. 40 5.4.2 MC_Ext Set Point Gen Disable............................................................................................ 42 5.4.3 MC_Ext Set Point Gen Feed................................................................................................ 43 5.4.4 MC_Ext Set Point Gen Feed With Torque............................................................................. 44 5.5 Special extensions.......................................................................................................................... 45 5.5.1 Drive Operation Mode........................................................................................................ 45 5.5.2 MC_Backlash Compensation............................................................................................ 47 5.5.3 MC_Calc Dynamics By Ramp Time..................................................................................... 49 5.5.4 MC_Override Filter............................................................................................................ 51 5.5.5 MC_Position Correction Limiter......................................................................................... 52 5.5.6 MC_Read Drive Address................................................................................................... 54 5.5.7 MC_Select Control Loop.................................................................................................... 55 5.5.8 MC_Set Accept Blocked Drive Signal.................................................................................. 56 5.5.9 MC_Set Encoder Scaling Factor......................................................................................... 57 TE1000 Version: 2.15.4 3
## Page 4

Table of contents 5.5.10 MC_Set Override.............................................................................................................. 58 5.5.11 MC_Write Nc Io Output....................................................................................................... 59 5.5.12 MC_Table Based Position Compensation.......................................................................... 60 5.5.13 MC_Convert Inc Pos To Pos................................................................................................ 63 5.5.14 MC_Convert Pos To Inc Pos................................................................................................ 64 6 Motion function blocks........................................................................................................................... 65 6.1 Point to point motion....................................................................................................................... 65 6.1.1 MC_Move Absolute........................................................................................................... 65 6.1.2 MC_Move Relative............................................................................................................ 67 6.1.3 MC_Move Additive............................................................................................................ 69 6.1.4 MC_Move Modulo............................................................................................................. 71 6.1.5 Notes on modulo positioning............................................................................................ 74 6.1.6 MC_Move Velocity............................................................................................................ 79 6.1.7 MC_Move Continuous Absolute......................................................................................... 81 6.1.8 MC_Move Continuous Relative.......................................................................................... 83 6.1.9 MC_Halt........................................................................................................................... 85 6.1.10 MC_Stop.......................................................................................................................... 87 6.2 Superposition.................................................................................................................................. 89 6.2.1 MC_Move Super Imposed................................................................................................. 89 6.2.2 Application examples for MC_Move Super Imposed......................................................... 91 6.2.3 MC_Abort Superposition................................................................................................... 95 6.3 Homing............................................................................................................................................ 96 6.3.1 MC_Home........................................................................................................................ 96 6.4 Manual motion................................................................................................................................. 98 6.4.1 MC_Jog............................................................................................................................ 98 6.5 Axis coupling................................................................................................................................. 101 6.5.1 MC_Gear In..................................................................................................................... 101 6.5.2 MC_Gear In Dyn.............................................................................................................. 102 6.5.3 MC_Gear Out.................................................................................................................. 104 6.5.4 MC_Gear In Multi Master.................................................................................................. 106 6.6 Phasing......................................................................................................................................... 109 6.6.1 MC_Halt Phasing............................................................................................................ 109 6.6.2 MC_Phasing Absolute..................................................................................................... 111 6.6.3 MC_Phasing Relative...................................................................................................... 113 6.7 Torque Control.............................................................................................................................. 115 6.7.1 MC_Torque Control......................................................................................................... 115 7 Data types.............................................................................................................................................. 119 7.1 Axis interface................................................................................................................................. 119 7.1.1 ST_Ads Address............................................................................................................. 119 7.1.2 AXIS_REF...................................................................................................................... 119 7.1.3 NCTOPLC_AXIS_REF................................................................................................... 120 7.1.4 NCTOPLC_AXIS_REF_OPMODE................................................................................. 123 7.1.5 NCTOPLC_AXIS_REF_STATE..................................................................................... 124 7.1.6 NCTOPLC_AXIS_REF_STATE2................................................................................... 125 7.1.7 NCTOPLC_AXIS_REF_STATE2_FLAGS..................................................................... 125 4 Version: 2.15.4 TE1000
## Page 5

Table of contents 7.1.8 NCTOPLC_AXIS_REF_CAMCOUPLINGSTATE.......................................................... 126 7.1.9 PLCTONC_AXIS_REF................................................................................................... 126 7.1.10 PLCTONC_AXIS_REF_CTRL....................................................................................... 127 7.2 Drive Operation Mode..................................................................................................................... 128 7.2.1 E_Drive Operation Mode.................................................................................................. 128 7.3 External setpoint generator........................................................................................................... 129 7.3.1 ST_Ext Set Point Enable Options...................................................................................... 129 7.4 Gearing......................................................................................................................................... 129 7.4.1 E_Gear In Multi Master Sync Mode.................................................................................... 129 7.4.2 ST_Gear In Dyn Options................................................................................................... 129 7.4.3 ST_Gear In Multi Master Options....................................................................................... 130 7.4.4 ST_Gear In Options......................................................................................................... 130 7.5 Homing.......................................................................................................................................... 130 7.5.1 E_Encoder Reference Mode............................................................................................ 130 7.5.2 MC_Homing Mode.......................................................................................................... 131 7.5.3 ST_Homing Options........................................................................................................ 131 7.6 Motion........................................................................................................................................... 132 7.6.1 E_Jog Mode.................................................................................................................... 132 7.6.2 E_Position Type.............................................................................................................. 133 7.6.3 MC_Buffer Mode............................................................................................................. 133 7.6.4 MC_Direction................................................................................................................. 136 7.6.5 ST_Move Options........................................................................................................... 136 7.7 Nc Process Data........................................................................................................................... 137 7.7.1 E_Nc Io Device................................................................................................................ 137 7.7.2 E_Nc Io Output................................................................................................................. 137 7.8 Phasing......................................................................................................................................... 137 7.8.1 E_Phasing Type.............................................................................................................. 137 7.9 Position Correction........................................................................................................................ 138 7.9.1 E_Axis Position Correction Mode...................................................................................... 138 7.9.2 ST_Position Compensation Table Element...................................................................... 138 7.9.3 ST_Position Compensation Table Parameter................................................................... 138 7.10 Select Control Loop......................................................................................................................... 139 7.10.1 E_Select Control Loop Type............................................................................................. 139 7.11 Status and parameter.................................................................................................................... 139 7.11.1 E_Axis Error Codes.......................................................................................................... 139 7.11.2 E_Nc Axis Type................................................................................................................ 139 7.11.3 E_Nc Drive Type.............................................................................................................. 140 7.11.4 E_Nc Encoder Type......................................................................................................... 141 7.11.5 E_Read Mode................................................................................................................. 142 7.11.6 E_Set Scaling Factor Mode.............................................................................................. 142 7.11.7 E_Work Direction............................................................................................................ 143 7.11.8 MC_Axis Parameter........................................................................................................ 143 7.11.9 MC_Axis States............................................................................................................... 145 7.11.10 ST_Axis Components..................................................................................................... 145 7.11.11 ST_Axis Op Modes.......................................................................................................... 146 7.11.12 ST_Axis Parameter Set.................................................................................................... 146 TE1000 Version: 2.15.4 5
## Page 6

Table of contents 7.11.13 ST_Axis Status................................................................................................................ 147 7.11.14 ST_Drive Address........................................................................................................... 149 7.11.15 ST_Mc Outputs............................................................................................................... 149 7.11.16 ST_Nc Application Request............................................................................................. 149 7.11.17 ST_Set Encoder Scaling Options...................................................................................... 149 7.11.18 ST_Set Position Options.................................................................................................. 149 7.11.19 ST_Nc Position Conversion Options................................................................................. 150 7.12 Stepper.......................................................................................................................................... 150 7.12.1 E_Destall Detect Mode.................................................................................................... 150 7.12.2 E_Destall Mode............................................................................................................... 150 7.12.3 ST_Power Stepper Struct................................................................................................ 151 7.13 Superposition................................................................................................................................ 151 7.13.1 E_Superposition Mode.................................................................................................... 151 7.13.2 E_Superposition Abort Option.......................................................................................... 152 7.13.3 ST_Superposition Options.............................................................................................. 153 7.14 Torque Control.............................................................................................................................. 154 7.14.1 ST_Torque Control Options............................................................................................. 154 7.15 Touch probe.................................................................................................................................. 154 7.15.1 E_Signal Edge................................................................................................................ 154 7.15.2 E_Signal Source............................................................................................................. 154 7.15.3 MC_Touch Probe Recorded Data..................................................................................... 155 7.15.4 TRIGGER_REF.............................................................................................................. 155 7.15.5 E_Touch Probe Mode...................................................................................................... 156 7.15.6 E_Touch Probe.............................................................................................................. 157 8 Global constants................................................................................................................................... 158 8.1 Library version............................................................................................................................... 158 9 Examples............................................................................................................................................... 159 10 Support and Service............................................................................................................................. 160 11 Appendix................................................................................................................................................ 161 11.1 NC Backlash Compensation......................................................................................................... 161 11.1.1 Mechanical backlash...................................................................................................... 161 11.1.2 NC Implementing of the Twin CAT Position Correction.................................................. 162 11.1.3 NC Implementing the Twin CAT Backlash Compensation.............................................. 163 6 Version: 2.15.4 TE1000
## Page 7

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1000 Version: 2.15.4 7
## Page 8

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 8 Version: 2.15.4 TE1000
## Page 9

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 2.15.4 9
## Page 10

Overview 2 Overview The Twin CAT Motion Control PLC library Tc2_MC2 contains function blocks for programming machine applications. It is based on the PLCopen specification for Motion Control function blocks V2.0 (www. PLCopen.org). This is a converted Twin CAT 2 Tc MC2 library. Existing projects that still use the Twin CAT 2 Tc MC library must first be adapted to the Tc MC2 library before they can be converted for Twin CAT 3. 10 Version: 2.15.4 TE1000
## Page 11

State diagram 3 State diagram The following state diagram defines the behavior of an axis in situations where several function blocks are simultaneously active for this axis. The combination of several function blocks is useful for generating more sophisticated motion profiles or for dealing with exceptional situations during program execution. TE1000 Version: 2.15.4 11
## Page 12

State diagram Note 1 From any state in which an error occurs Note 2 From any state if MC_Power. Enable = FALSE and the axis has no error Note 3 MC_Reset and MC_Power. Status = FALSE 12 Version: 2.15.4 TE1000
## Page 13

State diagram Note 4 MC_Reset and MC_Power. Status = TRUE and MC_Power. Enable = TRUE Note 5 MC_Power. Status = TRUE and MC_Power. Enable = TRUE Note 6 MC_Stop. Done = TRUE and MC_Stop. Execute = FALSE Motion commands are always processed sequentially. All commands operate in the described state diagram. The axis is always in one of the defined states. Each motion command that causes a transition changes the state of the axis and thus the motion profile. The state diagram is an abstraction layer that reflects the real axis state, comparable to the process image for I/O points. The axis state changes immediately when the command is issued. The state diagram refers to single axes. Multi-axis blocks such as MC_Cam In or MC_Gear In influence the states of several axes, which can always be traced back to individual axis states of the axes involved in the process. For example, a cam plate master can be in "Continuous Motion" state, while the associated slave is in "Synchronized Motion" state. Coupling of a slave has no influence on the state of the master. The "Disabled" state is the default state of an axis. In this state can the axis cannot be moved through a function block. When the MC_Power function block is called with Enable = TRUE, the axis changes to the "Standstill" state or, in the event of an error, to "Error Stop" state. If the function block MC_Power is called with Enable = FALSE, the state changes to "Disabled". The purpose of "Error Stop" state is to stop the axis and then block further commands, until a reset was triggered. The "Error" state transition only refers to actual axis errors and not to execution errors of a function block. Axis errors can also be displayed at the error output of a function block. Function blocks that are not listed in the state diagram do not affect the state of the axis (MC_Read Status, MC_Read Axis Error, MC_Read Parameter, MC_Read Bool Parameter, MC_Write Parameter, MC_Write Bool Parameter, MC_Read Actual Position and MC_Cam Table Select). The "Stopping" state indicates that the axis is in a stop ramp. The state changes after the complete stop after "Standstill". Motion commands such as MC_Move Absolute that lead out of the "Synchronized Motion" state are possible only if they are explicitly permitted in the axis parameters. Uncoupling commands such as MC_Gear Out are possible independent of that. TE1000 Version: 2.15.4 13
## Page 14

General rules for MC function blocks 4 General rules for MC function blocks The rules described below apply to all MC function blocks. They ensure a defined processing by the PLC program. Exclusivity of the outputs The outputs "Busy", "Done", "Error" and "Command Aborted" are mutually exclusive, i.e. only one of these outputs can be TRUE on a function block at the same time. When the "Execute" input becomes TRUE, one of the outputs must become TRUE. At the same time, however, only one of the outputs "Active", "Done", "Error" and "Command Aborted" can be TRUE. An exception is the motion command MC_Stop [} 87]. This sets the "Done" output to TRUE as soon as the axis is stopped. Nevertheless, the "Busy" and "Active" outputs remain TRUE because the axis is locked. The axis is unlocked and the "Busy" and "Active" outputs set to FALSE only after the "Execute" input is set to FALSE. Initial state If the function block is not active, the outputs "Done", "In Gear", "In Velocity", "Error", "Error ID" and "Command Aborted" are reset with a falling edge at input "Execute". However, the falling edge at input "Execute" does not affect the command execution. If the "Execute" input is already reset during command execution, this ensures that one of the outputs is set at the end of the command for a PLC cycle. Only then are the outputs reset. If the "Execute" input is triggered more than once during the execution of a command, the function block does not provide any feedback, nor does it execute any further commands. Input parameters The input parameters become active with a positive edge. To change the parameters the command has to be triggered again once it is completed, or a second instance of the function block must be triggered with new parameters during command execution. If an input parameter is not passed to the function block, the last value passed to this function block remains valid. A meaningful default value is used for the first call. Position and Distance The "Position" input designates a defined value within a coordinate system. The "Distance" input, on the other hand, is a relative dimension, i.e. the distance between two positions. "Position" and "Distance" are specified in technical units, e.g. mm or °, according to the axis scaling. Dynamic parameters The dynamic parameters for Move functions are specified in technical units with second as timebase. For example, if an axis is scaled in millimeters, the parameters have the following units: Velocity mm/s Acceleration mm/s2 Deceleration mm/s2 Jerk mm/s3 Error handling All function blocks have two error outputs for indicating errors during command execution. The "Error" output indicates the error and the "Error ID" output contains a supplementary error number. The "Done", "In Velocity", "In Gear" and "In Sync" outputs indicate successful command execution and are not set if the "Error" output is TRUE. Errors of different type are signaled at the function block output. The error type is not specified explicitly. It depends on the unique and global error number. 14 Version: 2.15.4 TE1000
## Page 15

General rules for MC function blocks Error types • Function block errors only concern the function block, not the axis (e.g. incorrect parameterization). Function block errors do not have to be reset explicitly. They are reset automatically when the "Execute" input is reset. • Communication errors (the function block cannot address the axis, for example). Communication errors usually indicate incorrect configuration or parameterization. A Reset is not possible. The function block can be retriggered after the configuration has been corrected. • Axis errors (logical NC axis) usually occur during the motion (e.g. lag error). They cause the axis to switch to error state. An axis error must be reset with the motion command MC_Reset [} 18]. • Drive errors (controller) may cause an axis error, i.e. an error of the logical NC axis. In many cases, axis and drive errors can be reset together via the motion command MC_Reset [} 18]. Depending on the drive controller, a separate reset mechanism may be required (e.g. connection of a reset line to the control device). Behavior of the Done output The output "Done" (or alternatively "In Velocity", "In Gear", "In Sync" etc.) is set if a command was executed successfully. If several function blocks are used for an axis and the running command is interrupted through a further function block, the Done output for the first function block is not set. Behavior of the Command Aborted output The "Command Aborted" output is set if a command is interrupted by another function block. Behavior of the Busy output The "Busy" output indicates that the function block is active. The function block can only be triggered by a rising edge at the "Execute" input if the "Busy" output is FALSE. "Busy" is immediately set with the positive edge at the "Execute" input and is not reset until the command has been successfully or unsuccessfully terminated. As long as the "Busy" output is TRUE, the function block must be called cyclically in order to be able to execute the command. Behavior of the Active output If the axis movement is controlled by several function blocks, the "Active" output of a function block indicates that the axis executes the command. The state Busy = TRUE and Active = FALSE means that the command has not yet been executed or is no longer executed. Enable input and Valid output In contrast to the "Execute" input, the "Enable" input causes an action to be executed continuously and repeatedly, as long as "Enable" is TRUE. For example, the function block MC_Read Status [} 29] cyclically updates the status of an axis as long as "Enable" is TRUE. A function block with an "Enable" input indicates through the "Valid" output that the data indicated at the outputs are valid. However, the data can be updated continuously as long as the "Valid" output is TRUE. Buffer Mode Some function blocks have a "Buffer Mode" input for controlling the command flow with several function blocks. For example, Buffer Mode can specify that a command interrupts another command (unbuffered mode) or that the following command is only executed after the previous command (buffered mode). Buffer Mode can be used to specify the movement transition from one command to the next. This is referred to as "Blending", which specifies the velocity at the transition point. A second function block is always required to use the Buffer Mode. It is not possible to trigger a move function block with new parameters while it is active. In unbuffered mode a subsequent command leads to termination of a running command. The previous command then sets the output "Command Aborted". In Buffer Mode a subsequent command waits until a running command is completed. Note that a continuous motion does not allow a buffered follow-on command. Buffered commands always lead immediately to an endless movement being aborted, as in unbuffered operation. TE1000 Version: 2.15.4 15
## Page 16

General rules for MC function blocks Only one command is buffered while another command is executed. If more than one command is triggered during a running command, then the last-started command to be buffered is rejected with an error (error 0x4292 Buffer Full). However, if the last command is started unbuffered, it becomes active in any case and interrupts the current and an already buffered command. Buffer Modes • Aborting: Default mode without buffering. The command is executed immediately and interrupts any other command that may be running. • Buffered: The command is executed once no other command is running on the axis. The previous movement continues until it has stopped. The following command is started from standstill. • Blending Low: The command is executed once no other command is running on the axis. In contrast to Buffered the axis does not stop at the previous target, but passes through this position with the lower velocity of two commands. • Blending High The command is executed once no other command is running on the axis. In contrast to Buffered the axis does not stop at the previous target, but passes through this position with the higher velocity of two commands. • Blending Next: The command is executed once no other command is running on the axis. In contrast to Buffered the axis does not stop at the previous target, but passes through this position with the velocity of the last command. • Blending Previous: The command is executed once no other command is running on the axis. In contrast to Buffered the axis does not stop at the previous target, but passes through this position with the velocity of the first command. See also: Diagram of the Buffer Modes [} 133] Optional blending position Blending in the different Buffer Modes takes place in each case at the target position of the currently running command. In the case of the motion command MC_Move Velocity [} 79] no target position is defined, and in other cases it may make sense to change the blending position. For this purpose, a blending position can be defined via the "Options" input of the function block (see Options input [} 16]), which is then used for the new command. The optional blending position must be located before the target position of the previous command, otherwise the new command will be rejected with an error message (0x4296). If the optional blending position has already been passed, the new command is implemented instantaneously. In other words, the command behaves like an aborting command. Option input Many function blocks have an "Options" input with a data structure containing additional, infrequently required options. To execute the basic function of the function block these options are often not required, so that the input can remain open. The user only has to occupy the Options data structure in cases where the documentation explicitly refers to certain options. Slave axes Motion commands can be applied to coupled slave axes, if this option was explicitly activated in the axis parameters. A motion command such as MC_Move Absolute [} 65] then automatically leads to uncoupling of the axis, after which the command is executed. In this case the only available Buffer Mode is "Aborting". 16 Version: 2.15.4 TE1000
## Page 17

Organization blocks 5 Organization blocks 5.1 Axis functions 5.1.1 MC_Power MC_Power Enable BOOL BOOL Status Enable_Positive BOOL BOOL Busy Enable_Negative BOOL BOOL Active Override LREAL BOOL Error Buffer Mode MC_Buffer Mode UDINT Error ID Options ST_Power Options ↔ Axis Reference To AXIS_REF The function block is used to switch the software enable of an axis. Enable can be activated for both directions of travel or only one direction. At "Status" output operational readiness of the axis is indicated. A velocity override influences the velocity of all travel commands by a specified percentage. Depending on the drive type, "Status" also signals operational readiness of the drive. Digital drives provide feedback on operational readiness, while analog drives are unable to indicate their operational readiness. In the latter case Status only indicated operational readiness of the control side. In addition to software enable it may be necessary to activate a hardware enable signal in order to enable a drive. This signal is not influenced by MC_Power and must be activated separately by the PLC. Inputs VAR_INPUT Enable : BOOL; (* B *) Enable_Positive : BOOL; (* E *) Enable_Negative : BOOL; (* E *) Override : LREAL (* V *) := 100.0; (* in percent - Beckhoff proprietary input *) Buffer Mode : MC_Buffer Mode; (* V *) Options : ST_Power Options; END_VAR Name Type Description Enable BOOL General software enable for the axis. Enable_Positive BOOL Feed enable in positive direction. Only takes effect if Enable = TRUE. Enable_Negative BOOL Feed enable in negative direction. Only takes effect if Enable = TRUE. Override LREAL Velocity override in % for all movement commands. (0 ≤ Override ≤ 100.0) Buffer Mode MC_Buffer Mode [} 133] This is evaluated when "Enable" is reset. MC_Aborting mode leads to immediate deactivation of the axis enable. Otherwise, e.g. in "MC_Buffered" mode, the function block waits until the axis no longer executes a command. Options ST_Power Options Not implemented. See also: General rules for MC function blocks [} 14] TE1000 Version: 2.15.4 17
## Page 18

Organization blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Status : BOOL; (* B *) Busy : BOOL; (* V *) Active : BOOL; (* V *) Error : BOOL; (* B *) Error ID : UDINT; (* E *) END_VAR Name Type Description Status BOOL TRUE when the axis is ready for operation. Busy BOOL TRUE, as long as the function block is called with Enable = TRUE. Active BOOL Indicates that the command is executed. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.1.2 MC_Reset MC_Reset Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Error UDINT Error ID The function block is used to reset the NC axis. In many cases this also leads to a reset of a connected drive device. Depending on the bus system or drive types, in some cases a separate reset may be required for the drive device. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. 18 Version: 2.15.4 TE1000
## Page 19

Organization blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE, if the reset was executed successfully. Busy BOOL TRUE, as long as the function block is called with Enable = TRUE. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.1.3 MC_Set Position MC_Set Position Execute BOOL BOOL Done Position LREAL BOOL Busy Mode BOOL BOOL Error Options ST_Set Position Options UDINT Error ID ↔ Axis Reference To AXIS_REF The function block sets the current axis position to a parameterizable value. In absolute mode, the actual position is set to the parameterized absolute Position value. In relative mode, the actual position is offset by the parameterized Position value. In both cases, the set position of the axis is set so that any potential lag error is retained. The Options. Clear Position Lag switch can be used to clear the lag error. Relative mode can be used to change the axis position during the motion. As of Twin CAT 3.1.4024.51 and Tc2_MC2 3.3.56, the position offset can be deleted and the position can be reset to the originally referenced coordinate system via the Options. Clear Position Offset switch. From this version onwards, the offset can also be read via ADS and displayed in the User Data variable of the AXIS_REF structure so that the value is available for the current cycle. Inputs VAR_INPUT Execute : BOOL; Position : LREAL; TE1000 Version: 2.15.4 19
## Page 20

Organization blocks Mode : BOOL; (* RELATIVE=True, ABSOLUTE=False (Default) *) Options : ST_Set Position Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Position LREAL Position value that the axis position will be set to. In absolute mode, the actual position is set to this value, in relative mode it is shifted by this value. Mode BOOL The axis position is set to an absolute value set if Mode = FALSE. Otherwise the axis position is changed relative to the specified Position value. Relative mode can be used for changing the position of an axis during motion. Options ST_Set Position Options [} 149] Data structure containing additional rarely used parameters. The input can normally remain open. • Clear Position Lag: can optionally be used to set the set and actual positions to the same value. In this instance, the following error is cleared. • Select Encoder Index: can optionally be set if an axis with several encoders is used and the position of a certain encoder is to be set (Options. Encoder Index). • Encoder Index: indicates the encoder (0..n) if Select Encoder Index is TRUE. • Clear Position Offset: Can be set to delete the position offset selected with MC_Set Position and thus reset the position to the originally referenced coordinate system; available from Twin CAT 3.1.4024.51 and Tc2_MC2 3.3.56. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE, if the reset was executed successfully. Busy BOOL TRUE, as long as the function block is called with Enable = TRUE. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] 20 Version: 2.15.4 TE1000
## Page 21

Organization blocks Reading the MC_Set Position offset As of Twin CAT 3.1.4024.51, the position offset set by MC_Set Position can be read out via ADS: Function ADS Read Port 501 (dec) Index Group 0x4100 + axis ID 0x5100 + axis ID Index Offset 0x00n10017 0x0017 Data REAL64 Merging the MC_Set Position offset into the AXIS_REF The AXIS_REF axis structure contains a User Data variable that can be configured so that the current value of the MC_Set Position offset is displayed here from Twin CAT version 3.1.4024.51 onwards. The value is then available for the current cycle. The User Data variable must be configured as follows via ADS: Function ADS Write Port 501 (dec) Index Group 0x4000 + axis ID Index Offset 0x010D Data 0x00000000: Deactivated (default) 0x00010017: Activates the MC_Set Position Offset value Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2 Status and parameter 5.2.1 MC_Read Actual Position MC_Read Actual Position Enable BOOL BOOL Valid ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Error UDINT Error ID LREAL Position The actual axis position can be read with the function block. The actual position value is the position value that is returned from the drive amplifier to the axis. Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL Reads the parameter once or cyclically depending on the Read Mode. TE1000 Version: 2.15.4 21
## Page 22

Organization blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Valid : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; Position : LREAL; END_VAR Name Type Description Valid BOOL TRUE if the output "Position" has a valid value. Busy BOOL TRUE, as long as the function block is called with Enable = TRUE. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Position LREAL Current axis position Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.2 MC_Read Actual Velocity MC_Read Actual Velocity Enable BOOL BOOL Valid ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Error UDINT Error ID LREAL Actual Velocity The actual axis velocity value can be read with the function block. The actual velocity value is the velocity value that is returned from the servo drive to the axis. Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL Reads the parameter once or cyclically depending on the Read Mode. 22 Version: 2.15.4 TE1000
## Page 23

Organization blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Valid : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; Actual Velocity : LREAL; END_VAR Name Type Description Valid BOOL Signals with TRUE that the value read at output Value is valid. Busy BOOL TRUE, as long as the function block is called with Enable = TRUE. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Actual Velocity LREAL Current axis velocity Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.3 MC_Read Axis Components MC_Read Axis Components Execute BOOL BOOL Done ↔ Axis Components Reference To ST_Axis Components BOOL Busy ↔ Axis Reference To AXIS_REF BOOL Error UDINT Error ID The function block can be used to read information about the subelements encoder, drive and controller of an axis. In this case "axis" refers to the Twin CAT NC axis and its parameters, and not the drive. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. TE1000 Version: 2.15.4 23
## Page 24

Organization blocks Inputs/outputs VAR_IN_OUT Axis Components : ST_Axis Components; Axis : AXIS_REF; END_VAR Name Type Description Axis Compone ST_Axis Components [} 145] Data structure used to return the components (encoders, nts controllers and drives) of the axis. Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the components have been read successfully. Busy BOOL TRUE as soon as the Execute input of the function block has been set to TRUE and component reading has not yet been completed. Afterwards either the output is Done or Error TRUE and Busy is set to FALSE again. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.4 MC_Read Axis Error MC_Read Axis Error Enable BOOL BOOL Valid ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Error DWORD Error ID DWORD Axis Error ID The function block is used to read the axis error of an axis. Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL If Enable = TRUE, the axis error is output at the "Axis Error ID" output. See also: General rules for MC function blocks [} 14] 24 Version: 2.15.4 TE1000
## Page 25

Organization blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Valid : BOOL; (* B *) Busy : BOOL; (* E *) Error : BOOL; (* B *) Error ID : UDINT; (* B *) Axis Error ID : DWORD; (* B *) END_VAR Name Type Description Valid BOOL TRUE if the error signaled at the "Axis Error ID" output is valid. Busy BOOL TRUE as soon as the command is started with Enable and as long as the command is processed. If Busy is FALSE, the function block is ready for a new order. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Axis Error ID DWORD Error number for the axis See also: General rules for MC function blocks [} 14] Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.5 MC_Read Bool Parameter MC_Read Bool Parameter Enable BOOL BOOL Valid Parameter Number INT BOOL Busy Read Mode E_Read Mode BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID BOOL Value The function block MC_Read Bool Parameter is used to read a boolean axis parameter. In this case "axis" refers to the Twin CAT NC axis and its parameters, and not the drive. TE1000 Version: 2.15.4 25
## Page 26

Organization blocks Inputs VAR_INPUT Enable : BOOL; (* B *) Parameter Number : MC_Axis Parameter; (* B *) Read Mode : E_Read Mode (* V *) END_VAR Name Type Description Enable BOOL Reads the parameter once or cyclically depending on the Read Mode. Parameter Numb MC_Axis Parameter [} 143] Number of the parameter to be read er Read Mode E_Read Mode [} 142] Read mode of the parameter to be read (once or cyclic) Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Valid : BOOL; (* B *) Busy : BOOL; (* E *) Error : BOOL; (* B *) Error ID : UDINT; (* E *) Value : BOOL; (* B *) END_VAR Name Type Description Valid BOOL Signals with TRUE that the value read at output Value is valid. Busy BOOL TRUE as soon as the command is started with Enable and as long as the command is processed. If Busy is FALSE, the function block is ready for a new order. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Value BOOL Shows the read Boolean value. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 26 Version: 2.15.4 TE1000
## Page 27

Organization blocks 5.2.6 MC_Read Parameter MC_Read Parameter Enable BOOL BOOL Valid Parameter Number INT BOOL Busy Read Mode E_Read Mode BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID LREAL Value The function block MC_Read Parameter is used to read an axis parameter. In this case "axis" refers to the Twin CAT NC axis and its parameters, and not the drive. Inputs VAR_INPUT Enable : BOOL; (* B *) Parameter Number : MC_Axis Parameter; (* B *) Read Mode : E_Read Mode (* V *) END_VAR Name Type Description Enable BOOL Reads the parameter once or cyclically depending on the Read Mode. Parameter Numb MC_Axis Parameter [} 143] Number of the parameter to be read er Read Mode E_Read Mode [} 142] Read mode of the parameter to be read (once or cyclic) Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Valid : BOOL; (* B *) Busy : BOOL; (* E *) Error : BOOL; (* B *) Error ID : DWORD; (* E *) Value : LREAL; (* B *) END_VAR Name Type Description Valid BOOL Signals with TRUE that the value read at output Value is valid. Busy BOOL TRUE as soon as the command is started with Enable and as long as the command is processed. If Busy is FALSE, the function block is ready for a new order. Error BOOL TRUE, if an error occurs. Error ID DWORD If the error output is set, this parameter supplies the error number. TE1000 Version: 2.15.4 27
## Page 28

Organization blocks Name Type Description Value LREAL Shows the read value. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.7 MC_Read Parameter Set MC_Read Parameter Set Execute BOOL BOOL Done ↔ Parameter Reference To ST_Axis Parameter Set BOOL Busy ↔ Axis Reference To AXIS_REF BOOL Error UDINT Error ID The function block MC_Read Parameter Set can be used to read the entire parameter set of an axis. In this case "axis" refers to the Twin CAT NC axis and its parameters, and not the drive. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Inputs/outputs VAR_IN_OUT Parameter : ST_Axis Parameter Set; Axis : AXIS_REF; END_VAR Name Type Description Parameter ST_Axis Parameter Set [} 146] Parameter data structure into which the parameters are read. Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the parameters were read successfully. Busy BOOL TRUE, as long as the function block is called with Enable = TRUE. Error BOOL TRUE, if an error occurs. 28 Version: 2.15.4 TE1000
## Page 29

Organization blocks Name Type Description Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.8 MC_Read Status MC_Read Status Enable BOOL BOOL Valid ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Error UDINT Error ID BOOL Error Stop BOOL Disabled BOOL Stopping BOOL Stand Still BOOL Discrete Motion BOOL Continuous Motion BOOL Synchronized Motion BOOL Homing BOOL Constant Velocity BOOL Accelerating BOOL Decelerating ST_Axis Status Status The MC_Read Status function block determines the current operating state of an axis and signals it at the function block outputs. The updated operating state is additionally stored in the Status output data structure and in the Axis. Status axis data structure. This means the operating state only has to be read once at the start of each PLC cycle and can then be accessed via Axis. Status. The Axis variable (type AXIS_REF [} 119]) already includes an instance of the function block MC_Read Status. This means that the operating state of an axis can be updated at the start of a PLC cycle by calling up Axis. Read Status. Sample: PROGRAM MAIN VAR Axis1 : AXIS_REF END_VAR (* call the read status function *) Axis1. Read Status; Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL If Enable = TRUE, the axis operating state is updated with each call of the function block. See also: General rules for MC function blocks [} 14] TE1000 Version: 2.15.4 29
## Page 30

Organization blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Valid : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; (* motion control statemachine states: *) Error Stop : BOOL; Disabled : BOOL; Stopping : BOOL; Stand Still : BOOL; Discrete Motion : BOOL; Continuous Motion : BOOL; Synchronized Motion : BOOL; Homing : BOOL; (* additional status *) Constant Velocity : BOOL; Accelerating : BOOL; Decelerating : BOOL; (* status data structure *) Status : ST_Axis Status; END_VAR Name Type Description Valid BOOL Indicates that the axis operating state indicated at the other outputs is valid. Busy BOOL TRUE, as long as the function block is called with Enable = TRUE. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Error Stop BOOL Axis status according to the Plc Open state diagram [} 11] Disabled BOOL Axis status according to the Plc Open state diagram [} 11] Stopping BOOL Axis status according to the Plc Open state diagram [} 11] Stand Still BOOL Axis status according to the Plc Open state diagram [} 11] Discrete Motion BOOL Axis status according to the Plc Open state diagram [} 11] Continuous Motio BOOL Axis status according to the Plc Open state diagram [} 11] n Synchronized Moti BOOL Axis status according to the Plc Open state diagram [} 11] on Homing BOOL Axis status according to the Plc Open state diagram [} 11] Constant Velocity BOOL The axis is moving with constant velocity. Accelerating BOOL The axis accelerates. Decelerating BOOL The axis decelerates. Status ST_Axis Status Extended status data structure [} 147] with additional status information. (Type: ST_Axis Status [} 147]) See also: General rules for MC function blocks [} 14] 30 Version: 2.15.4 TE1000
## Page 31

Organization blocks Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.9 MC_Write Bool Parameter MC_Write Bool Parameter Execute BOOL BOOL Done Parameter Number INT BOOL Busy Value BOOL BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID Boolean parameters for the axis can be written with the function block MC_Write Bool Parameter. In this case "axis" refers to the Twin CAT NC axis and its parameters, and not the drive. Inputs VAR_INPUT Execute : BOOL; Parameter Number : MC_Axis Parameter; Value : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Parameter Numbe MC_Axis Parameter [} 143] Number of the parameter to be written. r Value BOOL Boolean value that is written. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the parameters were written successfully. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done" or "Error" is set. TE1000 Version: 2.15.4 31
## Page 32

Organization blocks Name Type Description Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.10 MC_Write Parameter MC_Write Parameter Execute BOOL BOOL Done Parameter Number INT BOOL Busy Value LREAL BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID Axis parameters can be written with the function block MC_Write Parameter. In this case "axis" refers to the Twin CAT NC axis and its parameters, and not the drive. Inputs VAR_INPUT Execute : BOOL; Parameter Number : MC_Axis Parameter; Value : LREAL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Parameter Numbe MC_Axis Parameter [} 143] Number of the parameter to be written. r Value LREAL LREAL value that is written. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR 32 Version: 2.15.4 TE1000
## Page 33

Organization blocks Name Type Description Done BOOL TRUE if the parameters were written successfully. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done" or "Error" is set. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Sample VAR Axis1 : Axis_REF; fb Write Parameter: MC_Write Parameter; END_VAR fb Write Parameter( Execute := TRUE; Axis:= Axis1 , Parameter Number:= MC_Axis Parameter. Sw Limit Pos, Value:= 2000 ); Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.11 MC_Write Bool Parameter Persistent MC_Write Bool Parameter Persistent Execute BOOL BOOL Done Parameter Number INT BOOL Busy Value BOOL BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID Boolean axis parameters can be written persistently with the function block MC_Write Bool Parameter Persistent. The persistent parameter to be written is stored in an initialization list. At system startup, the system initially starts with the originally configured values and overwrites these with the persistent data from the initialization list before the start of the task. The initialization list is cleared when a new system configuration is registered. The system then starts with the unchanged data from the new configuration. In this case, "axis" refers to the Twin CAT NC axis and its parameters, and not the drive. Inputs VAR_INPUT Execute : BOOL; Parameter Number : MC_Axis Parameter; Value : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Parameter Numbe MC_Axis Parameter [} 143] Number of the parameter to be written. r Value BOOL Boolean value that is written. TE1000 Version: 2.15.4 33
## Page 34

Organization blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the parameters were written successfully. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done" or "Error" is set. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.2.12 MC_Write Parameter Persistent MC_Write Parameter Persistent Execute BOOL BOOL Done Parameter Number INT BOOL Busy Value LREAL BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID Axis parameters can be written persistently with the function block MC_Write Parameter Persistent. The persistent parameter to be written is stored in an initialization list. At system startup, the system initially starts with the originally configured values and overwrites these with the persistent data from the initialization list before the start of the task. The initialization list is cleared when a new system configuration is registered. The system then starts with the unchanged data from the new configuration. In this case, "axis" refers to the Twin CAT NC axis and its parameters, and not the drive. Inputs VAR_INPUT Execute : BOOL; Parameter Number : MC_Axis Parameter; Value : LREAL; END_VAR 34 Version: 2.15.4 TE1000
## Page 35

Organization blocks Name Type Description Execute BOOL The command is executed with a rising edge. Parameter Numbe MC_Axis Parameter [} 143] Number of the parameter to be written. r Value LREAL LREAL value that is written. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the parameters were written successfully. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done" or "Error" is set. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.3 Touch probe 5.3.1 MC_Touch Probe MC_Touch Probe Execute BOOL BOOL Done Window Only BOOL BOOL Busy First Position LREAL BOOL Command Aborted Last Position LREAL BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID ↔ Trigger Input Reference To TRIGGER_REF LREAL Recorded Position MC_Touch Probe Recorded Data Recorded Data The function block MC_Touch Probe records an axis position at the time of a digital signal (touch probe function). The position is usually not recorded directly in the PLC environment, but via an external hardware latch and is therefore highly accurate and independent of the cycle time. The function block controls this mechanism and determines the externally recorded position. TE1000 Version: 2.15.4 35
## Page 36

Organization blocks The function block was extended, compared to Twin CAT 2. It has the same functionality as the existing function block MC_Touch Probe_V2. Requirements The prerequisite for the position detection is suitable encoder hardware that is able to latch the recorded position. Support is offered for: • SERCOS drives In contrast to MC_Touch Probe, the drive must be configured with an extended interface, in which the parameters S 0 0405 and S-0 0406 are included in the process image. • Ether CAT So E drives (E.g. AX5000) In contrast to MC_Touch Probe, the drive must be configured with an extended interface, in which the parameters S 0 0405 and S-0 0406 are included in the process image. • Ether CAT Co E drives The drive must be configured with the parameter 0x60B9 (touch probe status) in the process image. • EL5101, KL5101 Latching of the C track and the digital input is possible. This hardware can only record one signal or edge at a time. Continuous mode is not supported. The digital trigger signal is wired into this hardware and, independently of the PLC cycle, triggers the recording of the current axis position. These end devices have to be configured to some extent so that a position detection is possible. Beckhoff Ether CAT drives can be configured with the System Manager. Note that the probe unit has to be configured with the "Extended NC Probe Unit" interface. After a touch probe cycle has been initiated by a rising edge on the "Execute" input, this is only terminated if the outputs "Done", "Error" or" Command Aborted" become TRUE. If the process is to be interrupted at an intermediate point in time, the function block MC_Abort Trigger [} 39] with the same Trigger Input [} 155] data structure must be called up. Otherwise no new cycle can be initiated. 36 Version: 2.15.4 TE1000
## Page 37

Organization blocks Signal curve Inputs VAR_INPUT Execute : BOOL; Window Only : BOOL; First Position : LREAL; Last Position : LREAL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Window Only BOOL If Window Only = TRUE, only one position within the window between "First Position" and "Last Position" is recorded. Positions outside the window are rejected and the external position latch is automatically newly activated. Only if the recorded position lies inside the window, "Done" becomes TRUE. The recording window can be interpreted in terms of absolute or modulo values. For this purpose, the "Modulo Positions" flag must be set accordingly in the Trigger Input [} 155] data structure. In the case of absolute value positions there is exactly one window. With modulo positions, the window is repeated within the modulo cycle defined in the axis parameters (e.g. 0 to 360 degrees). TE1000 Version: 2.15.4 37
## Page 38

Organization blocks Name Type Description First Position LREAL Initial position of the recording window, if "Window Only" is TRUE. This position can be interpreted as an absolute or modulo value. For this purpose, the "Modulo Positions" flag must be set accordingly in the Trigger Input [} 155] data structure. Last Position LREAL End position of the recording window, if "Window Only" is TRUE. This position can be interpreted as an absolute or modulo value. For this purpose, the "Modulo Positions" flag must be set accordingly in the Trigger Input [} 155] data structure. 38 Version: 2.15.4 TE1000
## Page 39

Organization blocks Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; Recorded Position : LREAL; Recorded Data : MC_Touch Probe Recorded Data; END_VAR Name Type Description Done BOOL TRUE if an axis position was successfully detected. The position is sent to the output "Recorded Position". Busy BOOL TRUE as soon as the function block is active. FALSE if it is in the default state. Command Aborte BOOL TRUE if the process is interrupted by an external event, d e.g. by the call up of MC_Abort Trigger [} 39]. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Recorded Position LREAL Axis position recorded at the point in time of the trigger signal Recorded Data MC_Touch Probe Recorded Data Data structure with complementary information relating to the logged axis position at the time of the trigger signal [} 155] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; Trigger Input : TRIGGER_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure Trigger Input TRIGGER_REF [} 155] Data structure for describing the trigger source. This data structure must be parameterized before the function block is called for the first time. 5.3.2 MC_Abort Trigger MC_Abort Trigger Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF BOOL Busy ↔ Trigger Input Reference To TRIGGER_REF BOOL Error UDINT Error ID The function block MC_Abort Trigger is used to abort a touch probe cycle started by MC_Touch Probe. MC_Touch Probe initiates a touch probe cycle by activating a position latch in external encoder or drive hardware. The function block MC_Abort Trigger can be used to terminate the procedure before the trigger signal has activated the position latch. If the touch probe cycle has completed successfully, it is not necessary to call up this function block. TE1000 Version: 2.15.4 39
## Page 40

Organization blocks Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with the rising edge and the external position latch is disabled. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; Trigger Input : TRIGGER_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure Trigger Input TRIGGER_REF [} 155] Data structure for describing the trigger source. This data structure must be parameterized before the function block is called for the first time. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE as soon as the touch probe cycle has been successfully terminated. Busy BOOL TRUE as soon as the function block is active. FALSE if it is in the default state. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.4 External set value generator 5.4.1 MC_Ext Set Point Gen Enable MC_Ext Set Point Gen Enable ↔ Axis Reference To AXIS_REF BOOL Done Execute BOOL BOOL Busy Position LREAL BOOL Error Position Type E_Position Type UDINT Error ID Options ST_Ext Set Point Enable Options BOOL Enabled 40 Version: 2.15.4 TE1000
## Page 41

Organization blocks The external setpoint generator of an axis can be switched on with the MC_Ext Set Point Gen Enable function block. The axis then adopts the set value specifications from its cyclic axis interface (Axis. Plc To Nc. Ext Set Pos, Ext Set Velo, Ext Set Acc, and Ext Set Direction). An external setpoint generator is usually a PLC function block that calculates cyclic set values for an axis and can therefore substitute the internal setpoint generator in an NC axis. Additional information can be found under MC_Ext Set Point Gen Disable [} 42] and MC_Ext Set Point Gen Feed [} 43]. Inputs VAR_INPUT Execute : BOOL; Position : LREAL; Position Type : E_Position Type; Options : ST_Ext Set Point Enable Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Position LREAL Position for target position monitoring. Setting this position does not mean that the axis moves to this position, only the external setpoint generator is responsible for this movement. Instead, setting this position activates the target position monitoring. The In Target Position flag becomes TRUE when this position is reached. Position Type E_Position Type [} 133] Position type: POSITION TYPE_ABSOLUTE or POSITION TYPE_RELATIVE Options ST_Ext Set Point Enable Option Use Torque Offset: Must be set to TRUE so that the s Torque Offset is also transmitted to the drive controller cyclically when the MC_Ext Set Point Gen Feed With Torque is used. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; Enabled : BOOL; END_VAR Name Type Description Done BOOL TRUE if the command was executed successfully. Busy BOOL TRUE as soon as the function block is active. FALSE if it is in the default state. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. TE1000 Version: 2.15.4 41
## Page 42

Organization blocks Name Type Description Enabled BOOL Shows the current state of the external setpoint generator, regardless of the function execution. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.4.2 MC_Ext Set Point Gen Disable MC_Ext Set Point Gen Disable Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Error UDINT Error ID BOOL Enabled The external setpoint generator of an axis can be switched off with the MC_Ext Set Point Gen Disable function block. The axis then no longer adopts the set value specifications from its cyclic axis interface (Axis. Plc To Nc. Ext Set Pos, Ext Set Velo, Ext Set Acc, and Ext Set Direction). An external setpoint generator is usually a PLC function block that calculates cyclic set values for an axis and can therefore substitute the internal setpoint generator in an NC axis. Additional information can be found under MC_Ext Set Point Gen Enable [} 40] and MC_Ext Set Point Gen Feed [} 43]. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; Enabled : BOOL; END_VAR Name Type Description Done BOOL TRUE if the command was executed successfully. 42 Version: 2.15.4 TE1000
## Page 43

Organization blocks Name Type Description Busy BOOL TRUE as soon as the function block is active. FALSE if it is in the default state. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Enabled BOOL Shows the current state of the external setpoint generator, regardless of the function execution. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.4.3 MC_Ext Set Point Gen Feed MC_Ext Set Point Gen Feed Position LREAL BOOL MC_Ext Set Point Gen Feed Velocity LREAL Acceleration LREAL Direction DINT ↔ Axis Reference To AXIS_REF The MC_Ext Set Point Gen Feed function is used to feed set values from an external setpoint generator to an axis. The function copies the data into the cyclic axis interface instantaneously (f Ext Set Pos, f Ext Set Velo, f Ext Set Acc and n Ext Set Direction). The MC_Ext Set Point Gen Feed function result is not used and therefore always FALSE. An external setpoint generator is usually a PLC function block that calculates cyclic set values for an axis and can therefore substitute the internal setpoint generator in an NC axis. Additional information can be found under MC_Ext Set Point Gen Enable [} 40] and MC_Ext Set Point Gen Disable [} 42]. Inputs VAR_INPUT Position : LREAL; Velocity : LREAL; Acceleration : LREAL; Direction : DINT; END_VAR Name Type Description Position LREAL Set position from an external setpoint generator Velocity LREAL Set velocity from an external setpoint generator Acceleration LREAL Set acceleration from an external setpoint generator Direction DINT Set direction from an external setpoint generator. ( -1 = negative direction, 0 = standstill, 1 = positive direction) Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR TE1000 Version: 2.15.4 43
## Page 44

Organization blocks Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.4.4 MC_Ext Set Point Gen Feed With Torque MC_Ext Set Point Gen Feed With Torque Position LREAL BOOL MC_Ext Set Point Gen Feed With Torque Velocity LREAL Acceleration LREAL Torque Offset LREAL Direction DINT ↔ Axis Reference To AXIS_REF The MC_Ext Set Point Gen Feed With Torque function is used to feed set values from an external setpoint generator to an axis. Compared to the MC_Ext Set Point Gen Feed function, this function is extended by the transfer of a Torque Offset. To ensure that the Torque Offset is also transferred cyclically from the NC to the drive, this must be activated explicitly when the FB_Ext Set Point Gen Enable is called via Options. Use Torque Offset. The function copies the data to the cyclic axis interface instantaneously (Ext Set Pos, Ext Set Velo, Ext Set Acc, Ext Set Direction, and Ext Torque) of the axis. The MC_Ext Set Point Gen Feed With Torque function result is unused and therefore always FALSE. An external setpoint generator is usually a PLC function block that calculates cyclic set values for an axis and can therefore substitute the internal setpoint generator in an NC axis. Additional information can be found under MC_Ext Set Point Gen Enable [} 40] and MC_Ext Set Point Gen Disable [} 42]. Inputs VAR_INPUT Position : LREAL; Velocity : LREAL; Acceleration : LREAL; Torque Offset : LREAL; Direction : DINT; END_VAR Name Type Description Position LREAL Set position from an external setpoint generator Velocity LREAL Set velocity from an external setpoint generator Acceleration LREAL Set acceleration from an external setpoint generator Torque Offset LREAL Torque Offset from an external setpoint generator Direction DINT Set direction from an external setpoint generator. ( -1 = negative direction, 0 = standstill, 1 = positive direction) Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR 44 Version: 2.15.4 TE1000
## Page 45

Organization blocks Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024 PC or CX (x86 or x64) Tc2_MC2 (from v3.3.68.0) 5.5 Special extensions 5.5.1 Drive Operation Mode 5.5.1.1 MC_Read Drive Operation Mode MC_Read Drive Operation Mode Execute BOOL BOOL Done Options ST_Drive Operation Mode Options BOOL Busy ↔ Axis Reference To AXIS_REF BOOL Error UDINT Error ID E_Drive Operation Mode Drive Operation Mode The function block MC_Read Drive Operation Mode reads the currently active operation mode of the drive device linked to the NC axis. Inputs VAR_INPUT Execute : BOOL; Options : ST_Drive Operation Mode Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Options ST_Drive Operation Mode Options Not implemented. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; Drive Operation Mode : E_Drive Operation Mode; END_VAR TE1000 Version: 2.15.4 45
## Page 46

Organization blocks Name Type Description Done BOOL Becomes TRUE, if the command was completed successfully. Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. If Busy becomes FALSE again, the function block is ready for a new order. At the same time one of the outputs, Done, Command Aborted or Error, is set. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Drive Operation Mode E_Drive Operation Mode Currently active operation mode of the connected drive device (E_Drive Operation Mode [} 128]). Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.5.1.2 MC_Write Drive Operation Mode MC_Write Drive Operation Mode Execute BOOL BOOL Done Drive Operation Mode E_Drive Operation Mode BOOL Busy Options ST_Drive Operation Mode Options BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID The function block MC_Write Drive Operation Mode initiates the change to the parameterized operation mode for a drive device linked to the NC axis. Inputs VAR_INPUT Execute : BOOL; Drive Operation Mode : E_Drive Operation Mode; Options : ST_Drive Operation Mode Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Drive Operation Mode E_Drive Operation Mode [} 128] Operation mode which is to be activated for the connected drive device. Options ST_Drive Operation Mode Options Not implemented. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. 46 Version: 2.15.4 TE1000
## Page 47

Organization blocks Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the command was executed without errors. Busy BOOL The Busy output becomes TRUE when the command is started with Execute and remains TRUE as long as the command is processed. If Busy becomes FALSE again, the function block is ready for a new order. Error BOOL Becomes TRUE, as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.5.2 MC_Backlash Compensation MC_Backlash Compensation Enable BOOL BOOL Enabled Backlash LREAL BOOL Busy Compensation In Positive Direction BOOL BOOL Error Ramp LREAL UDINT Error ID Disable Mode E_Disable Mode LREAL Current Backlash Options ST_Backlash Compensation Options BOOL Limiting ↔ Axis Reference To AXIS_REF The MC_Backlash Compensation function block is used together with the axis parameter Position Correction to compensate backlash. It is possible to compensate negative as well as positive backlash. Instructions for use and necessary settings in Twin CAT: • The functionality described here works with the parameter Position Correction. This parameter must be activated in Twin CAT XAE or via ADS (see also Twin CAT 3 NC PTP Axes). The Backlash Compensation function offered in the XAE is only still present for compatibility reasons. Do not use it on new projects. • If the user also wants to use the function Position Correction in parallel to the function block MC_Backlash Compensation (whose implementation is based on the function Position Correction) for other purposes, then this "double use" of the parameter can be solved by a workaround in the PLC by feeding in the sum of both requirements using the function block MC_Position Correction Limiter. Inputs VAR_INPUT Enable : BOOL; Backlash : LREAL; Compensation In Positive Direction : BOOL; Ramp : LREAL; Disable Mode : E_Disable Mode; Options : ST_Backlash Compensation Options; END_VAR TE1000 Version: 2.15.4 47
## Page 48

Organization blocks Name Type Description Enable BOOL The command is executed as long as Enable is active. Backlash compensation is hereby enabled. Backlash LREAL Compensation value with sign [mm]. If the default value is used, the internal NC backlash value is read via ADS and used in this function block. Compensation In P BOOL Compensation takes place in the selected working ositive Direction direction. FALSE (default): Backlash compensation must be executed when moving in negative direction. TRUE: Backlash compensation must be executed when moving in positive direction. Ramp LREAL Velocity limit for entered backlash compensation (constant velocity and linear position as subprofiles for backlash compensation [mm/s]). Disable Mode E_Disable Mode Disable mode: (0)=HOLD, (1)=RESET Options ST_Backlash Compensation O Optional parameters (not implemented) ptions Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Enabled : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; Current Backlash : LREAL; Limiting : BOOL; END_VAR Name Type Description Enabled BOOL This output becomes TRUE, if the backlash compensation has been enabled without error. Busy BOOL This output becomes TRUE when the command is started with Enable and remains so as long as the function block executes the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Current Backlash LREAL Current compensation value [mm]. Limiting BOOL This output becomes TRUE if the function block currently limits the backlash compensation. TYPE E_Disable Mode: ( Disable Mode Hold :=0, (* hold on the last output value (default) *) Disable Mode Reset :=1 (* reset the output value to zero (jump to zero) *)); END_TYPE 48 Version: 2.15.4 TE1000
## Page 49

Organization blocks Requirements Development environment Target platform PLC libraries to include Twin CAT V3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.5.3 MC_Calc Dynamics By Ramp Time MC_Calc Dynamics By Ramp Time Velocity LREAL BOOL Error Ramp Time LREAL UDINT Error ID Stiffness LREAL LREAL Acceleration LREAL Deceleration LREAL Jerk The MC_Calc Dynamics By Ramp Time function block is used to calculate the acceleration, deceleration and jerk dynamic parameters, which are required to achieve a specified velocity in a defined time. The function block assumes that the specified velocity can actually be achieved. If the calculated dynamic parameters are used on a short travel distance, the achieved velocity and the associated acceleration time may be smaller. The function block calculates the acceleration ramp and outputs an identical value as deceleration. The calculated acceleration, deceleration and jerk dynamic parameters can be used with all MC_Move... function blocks, as well as MC_Halt and MC_Stop. Inputs VAR_INPUT Velocity : LREAL; Ramp Time : LREAL; Stiffness : LREAL; END_VAR Name Type Description Velocity LREAL Velocity to be achieved Ramp Time LREAL Time required to achieve the velocity. Stiffness LREAL Stiffness of the acceleration profile [0..1]. A large value means higher jerk in the profile. Outputs VAR_OUTPUT Error : BOOL; Error ID : UDINT; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; END_VAR Name Type Description Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Acceleration LREAL Calculated acceleration Deceleration LREAL Calculated deceleration (Deceleration=Acceleration) Jerk LREAL Calculated jerk Examples t : internal acceleration ramp time / jerk time 1 t : internal constant acceleration time 2 TE1000 Version: 2.15.4 49
## Page 50

Organization blocks t : acceleration ramp time, t = 2 t + t 1 2 c = 0% → t = ½ t t = 0 s 1 2 ramp up diagram 3000 2500 2000 1500 1000 500 0 0 0,2 0,4 0,6 0,8 1 1,2 1,4 1,6 acceleration velocity c = 50% → t = t = 1/3 t s 1 2 ramp up diagram 2500 2000 1500 1000 500 0 0 0,2 0,4 0,6 0,8 1 1,2 1,4 1,6 acceleration velocity c = 99% → t = 0 t = t s 1 2 50 Version: 2.15.4 TE1000
## Page 51

Organization blocks ramp up diagram 2500 2000 1500 1000 500 0 0 0,2 0,4 0,6 0,8 1 1,2 1,4 1,6 acceleration velocity Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.42 PC or CX (x86 or x64) Tc2_MC2 5.5.4 MC_Override Filter MC_Override Filter Override Value Raw DINT DWORD Override Value Filtered Lower Override Threshold DINT LREAL Override Percent Filtered Upper Override Threshold DINT BOOL Error Override Steps UDINT UDINT Error ID Override Recovery Time TIME The function block MC_Override Filter can be used to convert an unfiltered override value consisting of digits (e.g. a voltage value of an analog input terminal) into a filtered override value that matches the cyclic axis interface (Plc To Nc) (DWORD in the range 0...1000000). This filtered override is also available in percent (LREAL in the range 0...100%). The raw input value is limited to a validity range by "Lower Override Threshold" and "Upper Override Threshold", and implemented as parameterizable steps (resolution) ("Override Steps"). After each override change at the output of the FB, the system internally waits for a minimum recovery time ("Override Recovery Time") before a new override value can be applied. The only exceptions are the override values 0% and 100%, which are always implemented without delay for safety reasons. Due to the gradation of the output override value ("Override Value Filtered"), the filtered override can become zero with very small override input values ("Override Value Raw"). A zero override leads to standstill of the axis. If total standstill is undesired, "Override Value Raw" should not fall below the smallest level. Inputs VAR_INPUT Override Value Raw : DINT; Lower Override Threshold : DINT := 0; (* 0...32767 digits *) Upper Override Threshold : DINT := 32767; (* 0...32767 digits *) Override Steps : UDINT := 200; (* 200 steps => 0.5 percent *) Override Recovery Time : TIME := T#150ms; (* 150 ms *) END_VAR TE1000 Version: 2.15.4 51
## Page 52

Organization blocks Name Type Description Override Value Ra DINT Raw, unfiltered override value (e.g. a voltage value of an w analog input terminal). Lower Override Th DINT Lower threshold that limits the raw override value. reshold Upper Override Th DINT Upper threshold that limits the raw override value. reshold Override Steps UDINT The specified steps (override resolution). Override Recover TIME Minimum recovery time, after which a new filtered y Time override value is applied to the output. However, the override values 0% and 100% are implemented without delay. Outputs VAR_OUTPUT Override Value Filtered : DWORD; (* 0...1000000 counts *) Override Percent Filtered : LREAL; (* 0...100 % *) Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Override Value Filt DWORD The filtered override value in digits (the data type matches ered the override in the cyclic axis interface 0..1000000). Override Percent F LREAL Filtered override value in percent (0..100%). iltered Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Possible error number Possible causes MC_ERROR_PARAMETER_NOT_CORRECT • Override Steps <= 1 • Lower Override Threshold >= Upper Override Threshold Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.5.5 MC_Position Correction Limiter MC_Position Correction Limiter Enable BOOL BOOL Busy Position Correction Value LREAL BOOL Error Correction Mode E_Axis Position Correction Mode UDINT Error ID Acceleration LREAL BOOL Limiting Correction Length LREAL ↔ Axis Reference To AXIS_REF The function block MC_Position Correction Limiter writes a correction value (Position Correction Value) at the actual position of an axis. Depending on the correction mode the data are fed either directly or filtered to the axis. To use this function block successfully, the "Position Correction" parameter must be activated in the System Manager. The function block should only be executed on enabled axes. 52 Version: 2.15.4 TE1000
## Page 53

Organization blocks Inputs VAR_INPUT Enable : BOOL; Position Correction Value : LREAL; Correction Mode : E_Axis Position Correction Mode; Acceleration : LREAL; Correction Length : LREAL; END_VAR Name Type Description Enable BOOL Activates continuous writing of the correction value "Position Correction Value". It must be TRUE as long as new correction values are to be accepted. Position Correctio LREAL Correction value to be added to the actual value of the n Value axis. Correction Mode E_Axis Position Correction Mode Depending on this mode, the correction value "Position Correction Value" is written either directly or [} 138] filtered. Acceleration LREAL Depending on the "Correction Mode" the maximum acceleration to reach the new correction value is specified here. In the case of Position Correction Mode_Fast this value has a direct effect on the position delta by PLC-tick. Maximum permissible correction value Position delta = acceleration * (PLC cycle time)2. If acceleration is parameterized as 0.0, the position correction is not limited. Correction Length LREAL Becomes active when the "Correction Mode" matches Position Correction Mode_Full Length [} 138]. A change in the "Positon Correction Value" is distributed over this correction length. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Busy : BOOL; Error : BOOL; Error ID : UDINT; Limiting : BOOL; END_VAR Name Type Description Busy BOOL TRUE as soon as the function block is active. FALSE when it returns to its original state. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Limiting BOOL TRUE if the required correction value "Position Correction Value" is not yet fully accepted. TE1000 Version: 2.15.4 53
## Page 54

Organization blocks Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.5.6 MC_Read Drive Address MC_Read Drive Address Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Error UDINT Error ID ST_Drive Address Drive Address The function block MC_Read Drive Address reads the ADS access data for a drive device connected to the axis. This information is required for accessing the device, e.g. for special parameterization. Inputs VAR_INPUT Execute : BOOL; (* B *) END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; (* B *) Busy : BOOL; (* E *) Error : BOOL; (* B *) Error ID : DWORD; (* B *) Drive Address : ST_Drive Address; (* B *) END_VAR Name Type Description Done BOOL TRUE if the command was executed without errors. Busy BOOL TRUE as soon as the command is started with Execute and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. Error BOOL TRUE, if an error occurs. Error ID DWORD If the error output is set, this parameter supplies the error number. Drive Address ST_Drive Address [} 149] ADS access data of a drive device connected to the axis. See also: General rules for MC function blocks [} 14] 54 Version: 2.15.4 TE1000
## Page 55

Organization blocks Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.5.7 MC_Select Control Loop MC_Select Control Loop Execute BOOL BOOL Done Encoder Index UINT BOOL Busy Select Type E_Select Control Loop Type BOOL Error Sync Value LREAL UDINT Error ID Ext Set Point Gen BOOL ↔ Axis Reference To AXIS_REF The function block MC_Select Control Loop is used to switch between control loops of an axis. The prerequisite is that two or more control loops have been created below the axis in the system configuration. See example "Control loop switching in an AX5000 with two existing encoders [} 159]". Inputs VAR_INPUT Execute : BOOL; Encoder Index : UINT; Select Type : E_Select Control Loop Type; Sync Value : LREAL; Ext Set Point Gen : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Encoder Index UINT The sequential number [0..9] of the axis control loop to be activated. Select Type E_Select Control Loop Type Defines how the control loop switching is performed. Currently only applicable with the [} 139] Select Control Loop Type_Standard value. Sync Value LREAL Currently not applicable. Ext Set Point Gen BOOL Currently not applicable. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR TE1000 Version: 2.15.4 55
## Page 56

Organization blocks Name Type Description Done BOOL TRUE if the command was executed without errors. Busy BOOL TRUE as soon as the command is started with Execute and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024 PC or CX (x86) Tc2_MC2 5.5.8 MC_Set Accept Blocked Drive Signal There are situations in which a drive no longer follows the NC setpoints, e.g. if an axis reaches a limit switch. The NC interprets such a situation as an error, and the drive is stopped. In some cases the user may want to provoke such a situation deliberately, e.g. in order to move to a limit switch for a reference run. The function MC_Set Accept Blocked Drive Signal can be used to temporarily prevent the NC axis generating an error in situations where the drive no longer follows the NC setpoints. • See also bit 8 of the Control DWord in AXIS_REF [} 119]. • A SERCOS/So E drive reports "Drive follows the command values" via status bit 3 of drive status word S-0-0135. • A CANopen/Co E drive reports "Drive follows the command values" via status bit 12 of object 6041h. FUNCTION MC_Set Accept Blocked Drive Signal: BOOL Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL NC controller enable for the axis Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 56 Version: 2.15.4 TE1000
## Page 57

Organization blocks 5.5.9 MC_Set Encoder Scaling Factor MC_Set Encoder Scaling Factor Execute BOOL BOOL Done Scaling Factor LREAL BOOL Busy Mode E_Set Scaling Factor Mode BOOL Error Options ST_Set Encoder Scaling Options UDINT Error ID ↔ Axis Reference To AXIS_REF The function block MC_Set Encoder Scaling Factor changes the scaling factor of the active encoder of an axis, either at standstill or in motion. The change can be absolute or relative. This mode is only suitable at standstill, since in absolute mode the change in scaling factor leads to a position discontinuity. In relative mode an internal position offset is adapted at the same time such that no discontinuity occurs. Note that an intervention during the motion results in a change in the actual axis velocity, while the real velocity remains constant. Therefore only small changes can be implemented during the motion. Inputs VAR_INPUT Execute : BOOL; Scaling Factor : LREAL; Mode : E_Set Scaling Factor Mode; Options : ST_Set Encoder Scaling Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Scaling Factor LREAL Scaling factor of the active encoder of an axis. The scaling factor is specified in physical positioning units [u] divided by the number of encoder increments. Mode E_Set Scaling Factor Mode The scaling factor can be set in absolute or relative mode (ENCODERSCALINGMODE_ABSOLUTE, [} 142] ENCODERSCALINGMODE_RELATIVE). In absolute mode, counting starts at the zero point of the axis coordinate system, therefore a position jump results when the scaling factor is changed. In relative mode the actual position of the axis does not change. This mode is therefore also suitable for changes during motion. Options ST_Set Encoder Scaling Options Data structure containing additional, rarely used parameters. The input can normally remain open. [} 149] • Select Encoder Index: can be set if an axis with several encoders is used and the position of a certain encoder is to be set (Options. Encoder Index). • Encoder Index: indicates the encoder (0..n) if "Select Encoder Index" is TRUE. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. TE1000 Version: 2.15.4 57
## Page 58

Organization blocks Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the position was set successfully. Busy BOOL TRUE as soon as the command is started with Execute and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done" or "Error" is set. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.5.10 MC_Set Override MC_Set Override Enable BOOL BOOL Enabled Vel Factor LREAL BOOL Busy Acc Factor LREAL BOOL Error Jerk Factor LREAL UDINT Error ID ↔ Axis Reference To AXIS_REF The override for an axis can be specified with the function block MC_Set Override. Inputs VAR_INPUT Enable : BOOL; (* B *) Vel Factor : LREAL (* B *) := 1.0; (* 1.0 = 100% *) Acc Factor : LREAL (* E *) := 1.0; (* 1.0 = 100% *) (* not supported *) Jerk Factor : LREAL (* E *) := 1.0; (* 1.0 = 100% *) (* not supported *) END_VAR Name Type Description Enable BOOL TRUE as long as the command is executed. Vel Factor LREAL Velocity override factor Acc Factor LREAL Not supported Jerk Factor LREAL Not supported Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR 58 Version: 2.15.4 TE1000
## Page 59

Organization blocks Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Enabled : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Enabled BOOL The parameterized override is set. Busy BOOL TRUE as soon as the command is started with Enable and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 5.5.11 MC_Write Nc Io Output MC_Write Nc Io Output Execute BOOL BOOL Done Device E_Nc Io Device BOOL Busy Nc Io Output E_Nc Io Output BOOL Error Bit Select Mask UDINT UDINT Error Id Bit Values UDINT ↔ Axis Reference To AXIS_REF Fig. 1: The MC_Write Nc Io Output function block can be used to write to unused IO outputs of the axis. Inputs VAR_INPUT Execute : BOOL; Device : E_Nc Io Device := E_Nc Io Device. Nc Io Device Drive; Nc Io Output : E_Nc Io Output := E_Nc Io Output. Nc Io Outputn Ctrl1; Bit Select Mask : UDINT := 16#0; Bit Values : UDINT; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Device E_Nc Io Device [} 137] Selection of the Nc axis component whose IO object is to be modified (encoder or drive) Nc Io Output E_Nc Io Output [} 137] Selection of the subobject whose value is to be modified (e.g. n Ctrl1) Bit Select Mask UDINT Mask for selecting which bits are to be modified TE1000 Version: 2.15.4 59
## Page 60

Organization blocks Name Type Description Bit Values UDINT Values of the corresponding bits to be modified Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the command was executed without errors. Busy BOOL TRUE as soon as the command is started with Execute and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024 PC or CX (x86) Tc2_MC2 5.5.12 MC_Table Based Position Compensation MC_Table Based Position Compensation ↔ Axis Reference To AXIS_REF BOOL Enabled Enable BOOL BOOL Busy p Table Pointer To ST_Position Compensation Table Element BOOL Error Table Size UDINT UDINT Error ID Table Parameter ST_Position Compensation Table Parameter LREAL Current Correction Ramp LREAL BOOL Limiting Disable Mode E_Disable Mode Options ST_Position Compensation Options The MC_Table Based Position Compensation function block is used to correct the axis position with a correction factor depending on the current axis position. The correction values must be stored in an equidistant, monotonically increasing table. Inputs VAR_INPUT Enable : BOOL; p Table : POINTER To ST_Position Compensation Table Element; Table Size : UDINT; Table Parameter : ST_Position Compensation Table Parameter; Ramp : LREAL; 60 Version: 2.15.4 TE1000
## Page 61

Organization blocks Disable Mode : E_Disable Mode; Options : ST_Position Compensation Options; END_VAR Name Type Description Enable BOOL The command is executed as long as Enable is active. p Table POINTER To Pointer to the compensation table, which is an array of the type ST_Position Compe St_Position Compensation Table Element. nsation Table Eleme nt [} 138] Table Size UDINT Size of the compensation table Table Parameter ST_Position Compe Data structure with additional parameters for the compensation table. nsation Table Param eter [} 138] Ramp LREAL Velocity limit for the entered compensation (constant velocity and linear position as subprofiles for table compensation [mm/ s]). Disable Mode E_Disable Mode Disable mode: Disable Mode Hold = last correction is retained Disable Mode Reset = last correction is set to 0 Options ST_Position Comp Optional parameters (not implemented) ensation Options Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Enabled : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; Current Correction : LREAL; Limiting : BOOL; END_VAR Name Type Description Enabled BOOL This output becomes TRUE when the table compensation was enabled without errors. Busy BOOL This output becomes TRUE when the command is started with Enable and remains so as long as the function block executes the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error ID UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Current Correction LREAL Current compensation value, in the unit of the axis. Limiting BOOL This output is TRUE if the correction value associated with the position has not yet been fully applied. TE1000 Version: 2.15.4 61
## Page 62

Organization blocks Further information The following is an example of a position table and the corresponding table parameters: VAR_INPUT … st Parameter : ST_Position Compensation Table Parameter := (Min Position := -10.0, Max Position := 10.0, No Of Table Elements := 21, Direction := Work Direction Both); st Pos Table : ARRAY[0..20] OF ST_Position Compensation Table Element := [ ( Position := -10.0, Compensation := 1.0 ), ( Position := -9.0, Compensation := 0.9 ), ( Position := -8.0, Compensation := 0.8 ), ( Position := -7.0, Compensation := 0.7 ), ( Position := -6.0, Compensation := 0.6 ), ( Position := -5.0, Compensation := 0.5 ), ( Position := -4.0, Compensation := 0.4 ), ( Position := -3.0, Compensation := 0.3 ), ( Position := -2.0, Compensation := 0.2 ), ( Position := -1.0, Compensation := 0.1 ), ( Position := 0.0, Compensation := 0.0 ), ( Position := 1.0, Compensation := 0.1 ), ( Position := 2.0, Compensation := 0.2 ), ( Position := 3.0, Compensation := 0.3 ), ( Position := 4.0, Compensation := 0.4 ), ( Position := 5.0, Compensation := 0.5 ), ( Position := 6.0, Compensation := 0.4 ), ( Position := 7.0, Compensation := 0.3 ), ( Position := 8.0, Compensation := 0.2 ), ( Position := 9.0, Compensation := 0.1 ), ( Position := 10.0, Compensation := 0.0 ) ]; … END_VAR As shown graphically, the table results in the following correction behavior: Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024 PC or CX (x86/x64) Tc2_MC2 62 Version: 2.15.4 TE1000
## Page 63

Organization blocks 5.5.13 MC_Convert Inc Pos To Pos MC_Convert Inc Pos To Pos Axis AXIS_REF BOOL Valid Inc Pos UDINT LREAL Position Options ST_Nc Position Conversion Options BOOL Error UDINT Error ID The function block MC_Convert Inc Pos To Pos converts incremental encoder positions into a corresponding NC axis position. The incremental position is scaled with the scaling factor and the currently valid position offset is applied. The determined NC axis position is in the same coordinate system as the actual position of the axis. Please note: For the incremental position, bear in mind that the incremental encoder position regularly overflows. The conversion does not take past or future overflows into account and the result is based on current encoder feedback. Inputs VAR_INPUT Axis : AXIS_REF; Inc Pos : UDINT; Options : ST_Nc Position Conversion Options; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. It contains the current axis status, including position, velocity or error state, among other parameters. In Pos UDINT Incremental encoder position Options ST_Nc Position Conve Optional parameters rsion Options [} 150] Outputs VAR_OUTPUT Valid : BOOL; Position : LREAL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Valid BOOL Supplies the NC axis position corresponding to dc Time. This is an NC axis position that has been scaled and provided with an offset, with, for instance, physical units: degrees or millimeters. Position LREAL Position of the NC axis Error BOOL TRUE, if an error occurs. Error ID UDINT Returns the error number if an error occurs, e.g. error 0x4012 (axis ID is not allowed, or axis does not exist within the system). Prerequisites Library Version Tc2_MC2 3.3.59 TE1000 Version: 2.15.4 63
## Page 64

Organization blocks 5.5.14 MC_Convert Pos To Inc Pos MC_Convert Pos To Inc Pos Axis AXIS_REF BOOL Valid Position LREAL UDINT Inc Pos Options ST_Nc Position Conversion Options BOOL Error UDINT Error ID The function block MC_Convert Pos To Inc Pos converts an NC axis position into a corresponding incremental encoder position. The incremental position is scaled with the scaling factor and the currently valid position offset is applied. The determined NC axis position is in the same coordinate system as the actual position of the axis. Please note: For the incremental position, bear in mind that the incremental encoder position regularly overflows. If the NC axis position is too far away from the actual position of the NC axis, the function block returns an error. Inputs VAR_INPUT Axis : AXIS_REF; Position : LREAL; Options : ST_Nc Position Conversion Options; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. It contains the current axis status, including position, velocity or error state, among other parameters. Position LREAL Position of the NC axis Options ST_Nc Position Conve Optional parameters rsion Options [} 150] Outputs VAR_OUTPUT Valid : BOOL; Inc Pos : UDINT; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Valid BOOL Supplies the NC axis position corresponding to dc Time. This is an NC axis position that has been scaled and provided with an offset, with, for instance, physical units: degrees or millimeters. In Pos UDINT Incremental encoder position Error BOOL TRUE, if an error occurs. Error ID UDINT Returns the error number if an error occurs, e.g. error 0x4012 (axis ID is not allowed, or axis does not exist within the system). Prerequisites Library Version Tc2_MC2 3.3.59 64 Version: 2.15.4 TE1000
## Page 65

Motion function blocks 6 Motion function blocks 6.1 Point to point motion 6.1.1 MC_Move Absolute MC_Move Absolute Execute BOOL BOOL Done Position LREAL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Buffer Mode MC_Buffer Mode Options ST_Move Options ↔ Axis Reference To AXIS_REF The function block MC_Move Absolute starts the positioning to an absolute target position and monitors the axis movement over the entire travel path. The "Done" output is set once the target position has been reached. Otherwise, the output "Command Aborted" or, in case of an error, the output "Error" is set. MC_Move Absolute is predominantly used for linear axis systems. For modulo axes the position is not interpreted as a modulo position, but as an absolute position in continuous absolute coordinate system. Alternatively, the function block MC_Move Modulo [} 71] can be used for modulo positioning. Motion commands can be applied to coupled slave axes, if this option was explicitly activated in the axis parameters. A motion command such as MC_Move Absolute then automatically leads to decoupling of the axis, after which the command is executed. In this case the only available Buffer Mode is "Aborting". Inputs VAR_INPUT Execute : BOOL; Position : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Position LREAL Absolute target position to be used for positioning. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0) If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0) If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0) At a value of 0, the standard jerk from the axis configuration in the System Manager is applied. TE1000 Version: 2.15.4 65
## Page 66

Motion function blocks Name Type Description Buffer Mode MC_Buffer Mode [} 133] Is evaluated if the axis is already executing another command. MC_Move Absolute becomes active after the current command or aborts it. Transition conditions from the current to the next command are also determined by the Buffer Mode. If the command is applied to a coupled slave axis, the only available Buffer Mode is "Aborting". A second function block is always required to use the Buffer Mode. It is not possible to trigger a move function block with new parameters while it is active. Options ST_Move Options [} 136] Data structure containing additional, rarely used parameters. The input can normally remain open. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE when the target position has been reached. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] 66 Version: 2.15.4 TE1000
## Page 67

Motion function blocks • "Target Position Monitoring" is activated (standard case): when the logical positioning end is reached (the NC setpoint generation is finished and the Has Job bit is FALSE) AND afterwards the In Position Area bit has become TRUE, then the Done output is set to TRUE. • "Position Range Monitoring" is activated ("Target Position Monitoring" is not active): when the logical positioning end is reached (the NC setpoint generation is finished and the Has Job bit is FALSE) AND afterwards the In Position Area bit has become TRUE, then the Done output is set to TRUE. • Neither "Target Position Monitoring" nor "Position Range Monitoring" is activated: the Done output is set immediately when the logical positioning end is reached (the NC setpoint generation is ended and the Has Job bit is FALSE). Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.1.2 MC_Move Relative MC_Move Relative Execute BOOL BOOL Done Distance LREAL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Buffer Mode MC_Buffer Mode Options ST_Move Options ↔ Axis Reference To AXIS_REF The function block MC_Move Relative starts a relative positioning procedure based on the current set position and monitors the axis movement over the whole travel path. The "Done" output is set once the target position has been reached. Otherwise, the output "Command Aborted" or, in case of an error, the output "Error" is set. Motion commands can be applied to coupled slave axes, if this option was explicitly activated in the axis parameters. A motion command such as MC_Move Relative then automatically leads to decoupling of the axis, after which the command is executed. In this case the only available Buffer Mode is "Aborting". Inputs VAR_INPUT Execute : BOOL; Distance : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Distance LREAL Relative distance to be used for positioning. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0) If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. TE1000 Version: 2.15.4 67
## Page 68

Motion function blocks Name Type Description Deceleration LREAL Deceleration (≥0) If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0) At a value of 0, the standard jerk from the axis configuration in the System Manager is applied. Buffer Mode MC_Buffer Mode [} 133] Is evaluated if the axis is already executing another command. MC_Move Relative becomes active after the current command or aborts it. Transition conditions from the current to the next command are also determined by the Buffer Mode. If the command is applied to a coupled slave axis, the only available Buffer Mode is "Aborting". A second function block is always required to use the Buffer Mode. It is not possible to trigger a move function block with new parameters while it is active. Options ST_Move Options [} 136] Data structure containing additional, rarely used parameters. The input can normally remain open. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE when the target position has been reached. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] 68 Version: 2.15.4 TE1000
## Page 69

Motion function blocks • "Target Position Monitoring" is activated (standard case): when the logical positioning end is reached (the NC setpoint generation is finished and the Has Job bit is FALSE) AND afterwards the In Position Area bit has become TRUE, then the Done output is set to TRUE. • "Position Range Monitoring" is activated ("Target Position Monitoring" is not active): when the logical positioning end is reached (the NC setpoint generation is finished and the Has Job bit is FALSE) AND afterwards the In Position Area bit has become TRUE, then the Done output is set to TRUE. • Neither "Target Position Monitoring" nor "Position Range Monitoring" is activated: the Done output is set immediately when the logical positioning end is reached (the NC setpoint generation is ended and the Has Job bit is FALSE). Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.1.3 MC_Move Additive MC_Move Additive Execute BOOL BOOL Done Distance LREAL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Buffer Mode MC_Buffer Mode Options ST_Move Options ↔ Axis Reference To AXIS_REF The function block MC_Move Additive starts relative positioning procedure based on the last target position instruction, irrespective of whether this was reached. The "Done" output is set once the target position has been reached. Otherwise, the output "Command Aborted" or, in case of an error, the output "Error" is set. If no last target position is known or the axis is moving continuously, the movement is executed based on the current set position for the axis. MC_Move Additive is not implemented for high/low speed axes. Inputs VAR_INPUT Execute : BOOL; Distance : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Distance LREAL Relative distance to be used for positioning. Velocity LREAL Maximum travel velocity (>0). TE1000 Version: 2.15.4 69
## Page 70

Motion function blocks Name Type Description Acceleration LREAL Acceleration (≥0) If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0) If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0) At a value of 0, the standard jerk from the axis configuration in the System Manager is applied. Buffer Mode MC_Buffer Mode [} 133] Is evaluated if the axis is already executing another command. MC_Move Additive becomes active after the current command or aborts it. Transition conditions from the current to the next command are also determined by the Buffer Mode. A second function block is always required to use the Buffer Mode. It is not possible to trigger a move function block with new parameters while it is active. Options ST_Move Options [} 136] Data structure containing additional, rarely used parameters. The input can normally remain open. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE when the target position has been reached. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. 70 Version: 2.15.4 TE1000
## Page 71

Motion function blocks See also: General rules for MC function blocks [} 14] • "Target Position Monitoring" is activated (standard case): when the logical positioning end is reached (the NC setpoint generation is finished and the Has Job bit is FALSE) AND afterwards the In Position Area bit has become TRUE, then the Done output is set to TRUE. • "Position Range Monitoring" is activated ("Target Position Monitoring" is not active): when the logical positioning end is reached (the NC setpoint generation is finished and the Has Job bit is FALSE) AND afterwards the In Position Area bit has become TRUE, then the Done output is set to TRUE. • Neither "Target Position Monitoring" nor "Position Range Monitoring" is activated: the Done output is set immediately when the logical positioning end is reached (the NC setpoint generation is ended and the Has Job bit is FALSE). Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.1.4 MC_Move Modulo MC_Move Modulo Execute BOOL BOOL Done Position LREAL BOOL Busy Velocity LREAL BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Direction MC_Direction Buffer Mode MC_Buffer Mode Options ST_Move Options ↔ Axis Reference To AXIS_REF The function block MC_Move Modulo is used to execute a positioning operation, which refers to the modulo position of an axis. A modulo rotation is based on the adjustable axis parameter modulo factor (e.g. 360°). A distinction is made between three possible start types, depending on the "Direction" input. • Positioning in positive direction • Positioning in negative direction • Positioning along shortest path Motion commands can be applied to coupled slave axes, if this option was explicitly activated in the axis parameters. A motion command such as MC_Move Modulo then automatically leads to decoupling of the axis, after which the command is executed. In this case the only available Buffer Mode is "Aborting". Starting an axis from standstill If an axis is started from standstill with MC_Move Modulo , it is possible to specify positions greater than or equal to 360°, in order to perform additional full turns. The same applies to a start with the Buffer Mode "MC_Buffered". Starting an axis during motion If an axis is already in motion, certain special considerations apply. The user is not able to specify the number of additional turns. The system automatically calculates how the axis can be moved to the target position on the shortest possible path. TE1000 Version: 2.15.4 71
## Page 72

Motion function blocks The error output must be analyzed, because under certain conditions an oriented stop is not possible. For example, a standard stop may have been triggered just before, or an oriented stop would cause an active software limit switch to be exceeded. For all fault conditions, the axis is stopped safely, but it may subsequently not be at the required oriented position. Special cases Particular attention should be paid to the behavior when requesting one or more complete modulo rotations. If the axis is located at an exact set position, such as 90 degrees, and if positioning to 90 degrees is required, no movement is carried out. If required to turn 450 degrees in a positive direction, it will perform just one rotation. The behavior can be different following an axis reset, because the reset will cause the current actual position to be adopted as the set position. The axis will then no longer be exactly at 90 degrees, but will be a little under or over. These cases will give rise either to a minimum positioning to 90 degrees, or on the other hand a complete rotation. Depending on the particular case, it may be more effective for complete modulo rotations to calculate the desired target position on the basis of the current absolute position, and then to position using the function block MC_Move Absolute [} 65]. Modulo positioning and absolute positioning are available for all axes, irrespective of the modulo setting in the Twin CAT System Manager. For each axis, the current absolute position "Set Pos" can be read from the cyclic axis interface data type NCTOPLC_AXIS_REF [} 120]. See also: Notes on modulo positioning [} 74] Inputs VAR_INPUT Execute : BOOL; Position : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Direction : MC_Direction; Buffer Mode : MC_Buffer Mode; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Position LREAL Modulo target position to be used for positioning. If the axis is started from standstill, positions greater than 360° result in additional turns. Negative positions are not permitted. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0) If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0) If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0) At a value of 0, the standard jerk from the axis configuration in the System Manager is applied. Direction MC_Direction [} 136] Positive or negative direction of travel. If the axis is started during a motion, the direction may not be reversed. Buffer Mode MC_Buffer Mode [} 133] Is evaluated if the axis is already executing another command. MC_Move Modulo becomes active after the current command or aborts it. Transition conditions from the current to the next command are also determined by the Buffer Mode. A second function block is always 72 Version: 2.15.4 TE1000
## Page 73

Motion function blocks Name Type Description required to use the Buffer Mode. It is not possible to trigger a move function block with new parameters while it is active. Options ST_Move Options [} 136] Data structure containing additional, rarely used parameters. The input can normally remain open. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE when the target position has been reached. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] • "Target Position Monitoring" is activated (standard case): when the logical positioning end is reached (the NC setpoint generation is finished and the Has Job bit is FALSE) AND afterwards the In Position Area bit has become TRUE, then the Done output is set to TRUE. • "Position Range Monitoring" is activated ("Target Position Monitoring" is not active): when the logical positioning end is reached (the NC setpoint generation is finished and the Has Job bit is FALSE) AND afterwards the In Position Area bit has become TRUE, then the Done output is set to TRUE. • Neither "Target Position Monitoring" nor "Position Range Monitoring" is activated: the Done output is set immediately when the logical positioning end is reached (the NC setpoint generation is ended and the Has Job bit is FALSE). TE1000 Version: 2.15.4 73
## Page 74

Motion function blocks Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.1.5 Notes on modulo positioning Modulo positioning (MC_Move Modulo [} 71]) is possible irrespective of the axis type. If may be used both for linear or rotary axes, because Twin CAT makes no distinction between these types. A modulo axis has a consecutive absolute position in the range ±∞. The modulo position of the axis is simply a piece of additional information about the absolute axis position. Modulo positioning represents the required target position in a different way. Unlike absolute positioning, where the user specifies the target unambiguously, modulo positioning has some risks, because the required target position may be interpreted in different ways. Settings in the Twin CAT System Manager Modulo positioning refers to a modulo period that can be set in the Twin CAT System Manager. The examples on this page assume a rotary axis with a modulo period of 360 degrees. The modulo tolerance window defines a position window around the current modulo set position of the axis. The window width is twice the specified value (set position ± tolerance value). A detailed description of the tolerance window is provided below. Special features of axis resets Axis positioning always refers to the set position. The set position of an axis is normally the target position of the last travel command. An axis reset (MC_Reset [} 18], controller activation with MC_Power [} 17]) can lead to a set position that is different from that expected by the user, because in this case the current actual position is used as the set position. The axis reset resets any lag error that may have occurred as a result of this procedure. If this possibility is not considered, subsequent positioning may lead to unexpected behavior. Example: An axis is positioned to 90°, with the result that subsequently the set position of the axis is exactly 90°. A further modulo travel command to 450° in positive direction results in a full turn, with the subsequent modulo position of the axis is once again exactly 90°. If an axis reset is then carried out, the set position can randomly be somewhat smaller or slightly larger than 90°. The new value depends on the actual value of the axis at the time of the reset. However, the next travel command will lead to different results. If the set position is slightly less than 90°, a new travel command to 90° in positive direction only leads to minimum motion. The deviation created by the reset is compensated, and the subsequent set position is once again exactly 90°. However, if the set position after the axis reset is slightly more than 90°, the same travel 74 Version: 2.15.4 TE1000
## Page 75

Motion function blocks command leads to a full turn to reach the exact set position of 90°. This problem occurs if complete turns by 360° or multiples of 360° were initiated. For positioning to an angle that is significantly different from the current modulo position, the travel command is unambiguous. To solve the problem, a modulo tolerance window can be parameterized in the Twin CAT System Manager. This ensures that small deviations from the position that are within the window do not lead to different axis behavior. If, for example, a window of 1° is parameterized, in the case described above the axis will behave identically, as long the set position is between 89° and 91°. If the set position exceeds 90° by less than 1°, the axis is re-positioned in positive direction at a modulo start. In both cases, a target position of 90° therefore leads to minimum movement to exactly 90°. A target position of 450° leads to a full turn in both cases. Effect of the modulo tolerance window: Modulo target position 90° in positive direction For values that are within the window range, the modulo tolerance window can therefore lead to movements against the specified direction. For small windows this is usually not a problem, because system deviations between set and actual position are compensated in both directions. This means that the tolerance window may also be used for axes that may only be moved in one direction due to their construction. Modulo positioning by less than one turn Modulo positioning from a starting position to a non-identical target position is unambiguous and requires no special consideration. A modulo target position in the range [0 ≤; position < 360] reaches the required target in less than one whole turn. No motion occurs if target position and starting position are identical. Target positions of more than 360 degrees lead to one or more full turns before the axis travels to the required target position. For a movement from 270° to 0°, a modulo target position of 0° (not 360°) should therefore be specified, because 360° is outside the basic range and would lead to an additional turn. TE1000 Version: 2.15.4 75
## Page 76

Motion function blocks For modulo positioning, a distinction is made between three different directions, i.e. positive direction, negative direction and along shortest path (MC_Direction [} 136]). For positioning along the shortest path, target positions of more than 360° are not sensible, because the movement towards the target is always direct. In contrast to positive or negative direction, it is therefore not possible to carry out several turns before the axis moves to the target. For modulo positioning with start type "along shortest path", only modulo target positions within the basic period (e.g. less than 360°) are permitted, otherwise an error is returned. The following table shows some positioning examples: Direction Absolute starting Modulo target posi- Relative travel path Absolute end posi- Modulo end posi- (modulo start type) position tion tion tion Positive direction 90.00 0.00 270.00 360.00 0.00 Positive direction 90.00 360.00 630.00 720.00 0.00 Positive direction 90.00 720.00 990.00 1080.00 0.00 Negative direction 90.00 0.00 -90.00 0.00 0.00 Negative direction 90.00 360.00 -450.00 -360.00 0.00 Negative direction 90.00 720.00 -810.00 -720.00 0.00 Along shortest path 90.00 0.00 -90.00 0.00 0.00 Modulo positioning with full turns In principle, modulo positioning by one or full turns are no different than positioning to an angle that differs from the starting position. No motion occurs if target position and starting position are identical. For a full turn, 360° has to be added to the starting position. The reset behavior described above shows that positioning with full turns requires particular attention. The following table shows positioning examples for a starting position of approximately 90°. The modulo tolerance window (TW) is set to 1°. Special cases for which the starting position is outside this window are identified. Direction Absolute start- Modulo target Relative travel Absolute end po- Modulo end po- Note (modulo start ing position position path sition sition type) Positive direction 90.00 90.00 0.00 90.00 90.00 Positive direction 90.90 90.00 -0.90 90.00 90.00 Positive direction 91.10 90.00 358.90 450.00 90.00 outside TW Positive direction 89.10 90.00 0.90 90.00 90.00 Positive direction 88.90 90.00 1.10 90.00 90.00 outside TW Positive direction 90.00 450.00 360.00 450.00 90.00 Positive direction 90.90 450.00 359.10 450.00 90.00 Positive direction 91.10 450.00 718.90 810.00 90.00 outside TW Positive direction 89.10 450.00 360.90 450.00 90.00 Positive direction 88.90 450.00 361.10 450.00 90.00 outside TW Positive direction 90.00 810.00 720.00 810.00 90.00 Positive direction 90.90 810.00 719.10 810.00 90.00 Positive direction 91.10 810.00 1078.90 1,170.00 90.00 outside TW Positive direction 89.10 810.00 720.90 810.00 90.00 Positive direction 88.90 810.00 721.10 810.00 90.00 outside TW Negative direction 90.00 90.00 0.00 90.00 90.00 Negative direction 90.90 90.00 -0.90 90.00 90.00 Negative direction 91.10 90.00 -1.10 90.00 90.00 outside TW Negative direction 89.10 90.00 0.90 90.00 90.00 Negative direction 88.90 90.00 -358.90 -270.00 90.00 outside TW 76 Version: 2.15.4 TE1000
## Page 77

Motion function blocks Direction Absolute start- Modulo target Relative travel Absolute end po- Modulo end po- Note (modulo start ing position position path sition sition type) Negative direction 90.00 450.00 -360.00 -270.00 90.00 Negative direction 90.90 450.00 -360.90 -270.00 90.00 Negative direction 91.10 450.00 -361.10 -270.00 90.00 outside TW Negative direction 89.10 450.00 -359.10 -270.00 90.00 Negative direction 88.90 450.00 -718.90 -630.00 90.00 outside TW Negative direction 90.00 810.00 -720.00 -630.00 90.00 Negative direction 90.90 810.00 -720.90 -630.00 90.00 Negative direction 91.10 810.00 -721.10 -630.00 90.00 outside TW Negative direction 89.10 810.00 -719.10 -630.00 90.00 Negative direction 88.90 810.00 -1078.90 -990.00 90.00 outside TW Modulo calculations within the PLC program In Twin CAT NC, all axis positioning tasks are executed based on the set position. The current actual position is only used for control purposes. If a PLC program is to calculate a new target position based on the current position, the current set position of the axis has to be used in the calculation (Axis. Nc To Plc. Modulo Set Pos and Axis. Nc To Plc. Modulo Set Turns). It is not advisable to perform order calculations based on the actual modulo position, which is available in the cyclical axis interface (Modulo Act Pos and Modulo Act Turns). Due to the greater or lesser control deviation of the axis, errors in the programmed sequence, such as undesired rotations, could occur. Application example Within a system, a rotational axis carries out an operation. The starting position for each operation is 90°, and with each cycle the axis is to be positioned by 360° in positive direction. Reverse positioning is not permitted for mechanical reasons. Small reverse positioning is acceptable as part of position control movements. The modulo tolerance window is set to 1.5° in the System Manager. This prevents undesired axis rotations after an axis reset. Since the axis may only be pre-positioned, the motion command MC_Move Modulo [} 71] with the modulo startup type "positive direction" (MC_Positive_Direction) is used. The modulo target position is specified as 450°, since the original orientation is to be reached again after a full turn by 360°. A modulo target position of 90° would not lead to any motion. The process starts with a basic positioning movement (MC_Move Modulo [} 71]) to ensure that the starting position is accurate. The step sequence then changes into an execution cycle. In the event of a fault, the axis is reset with MC_Reset [} 18] and subsequently (at the start of the step sequence) moved to its valid starting position. In this case, 90° is specified as the target position to enable this position to be reached as quickly as possible. No motion occurs if the axis is already at the starting position. TE1000 Version: 2.15.4 77
## Page 78

Motion function blocks Basic positioning with MC_Move Modulo Position = 90 Direction = MC_Positive_Direction Start Waiting for clock signal Clock signal Positioning by a full turn with MC_Move Modulo Position = 450 no Direction = MC_Positive_Direction Axis error? yes Axis reset with MC_Reset Alternatively, the reset step may be carried out at the start of the step sequence, so that the axis is initialized at the start of the process. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 78 Version: 2.15.4 TE1000
## Page 79

Motion function blocks 6.1.6 MC_Move Velocity MC_Move Velocity Execute BOOL BOOL In Velocity Velocity LREAL BOOL Busy Acceleration LREAL BOOL Active Deceleration LREAL BOOL Command Aborted Jerk LREAL BOOL Error Direction MC_Direction UDINT Error ID Buffer Mode MC_Buffer Mode Options ST_Move Options ↔ Axis Reference To AXIS_REF The function block MC_Move Velocity is used to start an endless travel with a specified velocity and direction. The movement can be stopped through a Stop command. The In Velocity output is set once the constant velocity is reached. Once constant velocity has been reached, the block function is complete, and no further monitoring of the movement takes place. If the command is aborted during the acceleration phase, the output "Command Aborted" or, in the event of an error, the output "Error" is set. Motion commands can be applied to coupled slave axes, if this option was explicitly activated in the axis parameters. A motion command such as MC_Move Absolute then automatically leads to decoupling of the axis, after which the command is executed. In this case the only available Buffer Mode is "Aborting". Inputs VAR_INPUT Execute : BOOL; (* B *) Velocity : LREAL; (* E *) Acceleration : LREAL; (* E *) Deceleration : LREAL; (* E *) Jerk : LREAL; (* E *) Direction : MC_Direction := MC_Positive_Direction; (* E *) Buffer Mode : MC_Buffer Mode; (* E *) Options : ST_Move Options; (* V *) END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0) If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0) If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0) At a value of 0, the standard jerk from the axis configuration in the System Manager is applied. Direction MC_Direction [} 136] Positive or negative direction of travel. Buffer Mode MC_Buffer Mode [} 133] Is evaluated if the axis is already executing another command. MC_Move Velocity becomes active after the current command or aborts it. Transition conditions from the current to the next command are also determined by the Buffer Mode. If the command is applied to a coupled slave axis, the only available Buffer Mode is "Aborting". A second function block is always required to use the Buffer Mode. It is not possible to trigger a move function block with new parameters while it is active. TE1000 Version: 2.15.4 79
## Page 80

Motion function blocks Name Type Description Options ST_Move Options [} 136] Data structure containing additional, rarely used parameters. The input can normally remain open. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT In Velocity : BOOL; (* B *) Busy : BOOL; (* E *) Active : BOOL; (* E *) Command Aborted : BOOL; (* E *) Error : BOOL; (* B *) Error ID : UDINT; (* E *) END_VAR Name Type Description In Velocity BOOL After the axis acceleration, the In Velocity output assumes the value TRUE once the requested target velocity has been reached. The In Velocity output remains TRUE until the axis velocity is changed by another command. As soon as a velocity deviation is determined, the output signals FALSE. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the function block is active. If "Busy" is FALSE, the function block is ready for a new order. At the same time one of the outputs "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. In Velocity and Override If the override value is changed, the In Velocity output signals the value FALSE. At the same time, after a change in velocity, the Command Aborted output assumes the value TRUE and the function block no longer displays the status "busy". In Velocity during a velocity overlay with MC_Move Super Imposed A change in velocity due to the function block MC_Move Super Imposed is permitted and does not lead to a cancellation of the activity of the function block. Although the velocity changes, the In Velocity output remains TRUE because the total velocity is made up of the basic velocity, which has not changed, and a velocity superimposed on this basic velocity (Superposition). 80 Version: 2.15.4 TE1000
## Page 81

Motion function blocks The function block remains "Busy" and "Active" until a new command is issued. See also: General rules for MC function blocks [} 14] Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.1.7 MC_Move Continuous Absolute MC_Move Continuous Absolute Execute BOOL BOOL In End Velocity Position LREAL BOOL Busy Velocity LREAL BOOL Active End Velocity LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error ID Jerk LREAL Buffer Mode MC_Buffer Mode Options ST_Move Options ↔ Axis Reference To AXIS_REF The function block MC_Move Continuous Absolute starts the positioning to an absolute target position and monitors the axis movement over the entire travel path. At the target position a constant end velocity is reached, which is maintained. The "In End Velocity" output is set once the target position was reached. Otherwise, the output "Command Aborted" or, in case of an error, the output "Error" is set. Once the target position has been reached, the function of the function block is terminated and the axis is no longer monitored. MC_Move Continuous Absolute is not implemented for high/low speed axes. Inputs VAR_INPUT Execute : BOOL; Position : LREAL; Velocity : LREAL; End Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Position LREAL Absolute target position Velocity LREAL Maximum velocity for the movement to the target position (>0). End Velocity LREAL End velocity to be maintained once the target position has been reached. Acceleration LREAL Acceleration (≥0) If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. TE1000 Version: 2.15.4 81
## Page 82

Motion function blocks Name Type Description Deceleration LREAL Deceleration (≥0) If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0) At a value of 0, the standard jerk from the axis configuration in the System Manager is applied. Buffer Mode MC_Buffer Mode [} 133] Is evaluated if the axis is already executing another command. MC_Move Continuous Absolute becomes active after the current command or aborts it. Transition conditions from the current to the next command are also determined by the Buffer Mode. A second function block is always required to use the Buffer Mode. It is not possible to trigger a move function block with new parameters while it is active. Options ST_Move Options [} 136] Data structure containing additional, rarely used parameters. The input can normally remain open. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT In End Velocity : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description In End Velocity BOOL TRUE when the target position has been reached. The function block remains "Busy" and "Active" until a new command is issued. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time one of the outputs "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] 82 Version: 2.15.4 TE1000
## Page 83

Motion function blocks Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.1.8 MC_Move Continuous Relative MC_Move Continuous Relative Execute BOOL BOOL In End Velocity Distance LREAL BOOL Busy Velocity LREAL BOOL Active End Velocity LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error ID Jerk LREAL Buffer Mode MC_Buffer Mode Options ST_Move Options ↔ Axis Reference To AXIS_REF The function block MC_Move Continuous Relative is used to start a positioning by a relative distance and to monitor the axis movement over the entire travel path. At the target position a constant end velocity is reached, which is maintained. The "In End Velocity" output is set once the target position was reached. Otherwise, the output "Command Aborted" or, in case of an error, the output "Error" is set. Once the target position has been reached, the block function is complete and the axis is no longer monitored. MC_Move Continuous Relative is not implemented for fast/slow axes. Inputs VAR_INPUT Execute : BOOL; Distance : LREAL; Velocity : LREAL; End Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Distance LREAL Relative distance to be used for positioning. Velocity LREAL Maximum velocity for the movement over the "Distance" (>0). End Velocity LREAL End velocity to be maintained after the relative "Distance". Acceleration LREAL Acceleration (≥0) If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0) If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. TE1000 Version: 2.15.4 83
## Page 84

Motion function blocks Name Type Description Jerk LREAL Jerk (≥0) At a value of 0, the standard jerk from the axis configuration in the System Manager is applied. Buffer Mode MC_Buffer Mode [} 133] Is evaluated if the axis is already executing another command. MC_Move Continuous Relative becomes active after the current command or aborts it. Transition conditions from the current to the next command are also determined by the Buffer Mode. A second function block is always required to use the Buffer Mode. It is not possible to trigger a move function block with new parameters while it is active. Options ST_Move Options [} 136] Data structure containing additional, rarely used parameters. The input can normally remain open. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT In End Velocity : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description In End Velocity BOOL TRUE when the target position has been reached. The function block remains "Busy" and "Active" until a new command is issued. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time one of the outputs "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] 84 Version: 2.15.4 TE1000
## Page 85

Motion function blocks Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.1.9 MC_Halt MC_Halt Execute BOOL BOOL Done Deceleration LREAL BOOL Busy Jerk LREAL BOOL Active Buffer Mode MC_Buffer Mode BOOL Command Aborted Options ST_Move Options BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error ID The function block MC_Halt is used to stop an axis with a defined deceleration ramp. In contrast to MC_Stop [} 87], the axis is not locked against further movement commands. The axis can therefore be restarted through a further command during the deceleration ramp or after it has come to a halt. Motion commands can be applied to coupled slave axes, if this option was explicitly activated in the axis parameters. A motion command such as MC_Halt then automatically leads to decoupling of the axis, after which the command is executed. In this case the only available Buffer Mode is "Aborting". Inputs VAR_INPUT Execute : BOOL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Deceleration LREAL Deceleration If the value is ≤ 0, the deceleration parameterized with the last Move command is used. For safety reasons MC_Halt and MC_Stop [} 87] cannot be executed with weaker dynamics than the currently active motion command. The parameterization is adjusted automatically, if necessary. Jerk LREAL Jerk If the value is ≤ 0, the jerk parameterized with the last Move command takes effect. For safety reasons MC_Halt and MC_Stop [} 87] cannot be executed with weaker dynamics than the currently active motion command. The parameterization is adjusted automatically, if necessary. Buffer Mode MC_Buffer Mode [} 133] Is evaluated if the axis is already executing another command. MC_Halt becomes active after the current command or aborts it. Transition conditions from the current to the next command are also determined by the Buffer Mode. If the command is applied to a coupled slave axis, only the Buffer Mode "Aborting" is possible. Special characteristics of MC_Halt: the Buffer Mode "Buffered" shows no effect, because the command is executed only at standstill. The blending modes "MC_Blending Next" and "MC_Blending Low" do not change the last target position, although they can result in TE1000 Version: 2.15.4 85
## Page 86

Motion function blocks Name Type Description a change in dynamics (deceleration) of the stop ramp. The modes "MC_Blending Previous" and "MC_Blending High" extend the travel to the original target position. The stop ramp is only initiated when this position is reached (defined braking point). Options ST_Move Options [} 136] Data structure containing additional, rarely used parameters. The input can normally remain open. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the axis has been stopped and is stationary. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the function block is active. If "Busy" is FALSE, the function block is ready for a new order. At the same time one of the outputs "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 86 Version: 2.15.4 TE1000
## Page 87

Motion function blocks 6.1.10 MC_Stop MC_Stop Execute BOOL BOOL Done Deceleration LREAL BOOL Busy Jerk LREAL BOOL Active Options ST_Move Options BOOL Command Aborted ↔ Axis Reference To AXIS_REF BOOL Error UDINT Error ID The function block MC_Stop is used to stop an axis with a defined deceleration ramp and to lock the axis against other motion commands. The function block is therefore suitable for stops in special situations, in which further axis movements are to be prevented. At the same time the axis is blocked for other motion commands. The axis can only be restarted once the Execute signal has been set to FALSE after the axis has stopped. A few cycles are required to release the axis after a falling edge of Execute. During this phase the "Busy" output remains TRUE, and the function block has to be called until "Busy" becomes FALSE. The locking of the axis is canceled with an MC_Reset [} 18]. Alternatively, the axis can be stopped with MC_Halt [} 85] without locking. MC_Halt is preferable for normal movement sequences. Motion commands can be applied to coupled slave axes, if this option was explicitly activated in the axis parameters. A motion command such as MC_Stop then automatically leads to decoupling of the axis, after which the command is executed. Inputs VAR_INPUT Execute : BOOL; Deceleration : LREAL; Jerk : LREAL; Options : ST_Move Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. The axis is locked during the stop. The axis can only be restarted once the Execute signal has been set to FALSE after the axis has stopped. Deceleration LREAL Deceleration If the value is ≤ 0, the deceleration parameterized with the last Move command is used. For safety reasons MC_Stop and MC_Halt cannot be executed with weaker dynamics than the currently active motion command. The parameterization is adjusted automatically, if necessary. Jerk LREAL Jerk If the value is ≤ 0, the jerk parameterized with the last Move command is used. For safety reasons MC_Stop and MC_Halt cannot be executed with weaker dynamics than the currently active motion command. The parameterization is adjusted automatically, if necessary. Options ST_Move Options [} 136] Data structure containing additional, rarely used parameters. The input can normally remain open. See also: General rules for MC function blocks [} 14] TE1000 Version: 2.15.4 87
## Page 88

Motion function blocks Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the axis has been stopped and is stationary. Busy BOOL TRUE as soon as the command is started with Execute and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. "Busy" remains TRUE as long as the axis is locked. The axis is only unlocked and "Busy" becomes FALSE when Execute is set to FALSE. Active BOOL Indicates that the function block controls the axis. Remains TRUE as long as the axis is locked. The axis is only unlocked and "Active" becomes FALSE when Execute is set to FALSE. Command Aborte BOOL TRUE if the command could not be executed completely. d Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 88 Version: 2.15.4 TE1000
## Page 89

Motion function blocks 6.2 Superposition 6.2.1 MC_Move Super Imposed MC_Move Super Imposed Execute BOOL BOOL Done Mode E_Superposition Mode BOOL Busy Distance LREAL BOOL Active Velocity Diff LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error ID Jerk LREAL BOOL Warning Velocity Process LREAL UDINT Warning Id Length LREAL LREAL Actual Velocity Diff Options ST_Superposition Options LREAL Actual Distance ↔ Axis Reference To AXIS_REF LREAL Actual Length LREAL Actual Acceleration LREAL Actual Deceleration The function block MC_Move Super Imposed starts a relative superimposed movement while the axis is already moving. The current movement is not interrupted. The "Done" output is set once the superimposed movement is completed. The original subordinate movement may continue to be active and is monitored by the associated Move function block. The function of the superimposition becomes clear when considering two axes that operate with the same velocity. If one of the axes is superimposed by MC_Move Super Imposed, it moves ahead or behind by the "Distance" parameter. Once the superimposed movement is completed, the "Distance" between the two axes is maintained. MC_Move Super Imposed can be executed on single axes as well as on master or slave axes. In a slave axis, the superimposed movement acts solely on the slave axis. If the function is applied to a master axis, the slave mimics the superimposed movement of the master due to the axis coupling. Since MC_Move Super Imposed executes a relative superimposed movement, the target position for the subordinate travel command changes by Distance. The superimposed movement depends on the position of the main movement. This means that a velocity change of the main movement also results in a velocity change in the superimposed movement, and that the superimposed movement is inactive if the main movement stops. The "Options" parameter can be used to specify whether the superimposed movement is to be aborted or continued if the main movement stops. See also: Application examples for MC_Move Super Imposed [} 91] Inputs VAR_INPUT Execute : BOOL; Mode : E_Superposition Mode; Distance : LREAL; Velocity Diff : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Velocity Process : LREAL; Length : LREAL; Options : ST_Superposition Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Mode E_Superposition Mode Determines the type of the superimposed motion. (Type: E_Superposition Mode [} 151]) TE1000 Version: 2.15.4 89
## Page 90

Motion function blocks Name Type Description Distance LREAL Relative distance to catch up. A positive value means an increase in velocity by an amount required to cover the additional distance, compared with the unaffected movement. A negative value results in braking and falling back by this distance. Velocity Diff LREAL Maximum velocity difference to the current velocity (basic velocity) of the axis (>0). For this parameter a distinction may have to be made, depending on the superimposition direction (acceleration or deceleration). If, for example, a direction reversal is not permitted, the maximum available acceleration corresponds to the maximum velocity, and the maximum deceleration to stop. Therefore, there are two possible maximum values for "Velocity Diff": • Distance > 0 (axis accelerates) Velocity Diff = maximum velocity -basic velocity • Distance < 0 (axis decelerates) Velocity Diff = basic velocity Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. Deceleration LREAL Deceleration (≥0). If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL The Jerk parameter is not implemented. Velocity Process LREAL Mean process velocity in the axis (>0). If the basic velocity during superposition is constant, the set axis velocity can be specified. Length LREAL Distance over which the superimposed movement is available. The "Mode" parameter defines how this distance is interpreted. Options ST_Superposition Options Data structure containing additional, rarely used parameters. The input can normally remain open. [} 153] • Abort Option: defines the behavior when the subordinate movement stops. The superimposed movement can be aborted or continued later. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; Warning : BOOL; Warning ID : UDINT; 90 Version: 2.15.4 TE1000
## Page 91

Motion function blocks Actual Velocity Diff : LREAL; Actual Distance : LREAL; Actual Length : LREAL; Actual Acceleration : LREAL; Actual Deceleration : LREAL; END_VAR Name Type Description Done BOOL TRUE if the superimposed movement was successfully completed. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. Command Aborte BOOL Becomes TRUE, if the command was aborted by another d command and could therefore not be completed. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Warning BOOL TRUE if the action cannot be executed completely. Warning ID UDINT The function block returns warning 4243 (16963) if the hex compensation was incomplete due to the parameterization (distance, velocity, etc.). In this case compensation is implemented as far as possible. The user has to decide whether to interpret this warning message within his application as a proper error or merely as a warning. Actual Velocity Diff LREAL Actual velocity difference during the superimposed motion (Actual Velocity Diff ≤ Velocity Diff). Actual Distance LREAL Actual superimposed distance. The function block tries to reach the full "Distance" as specified. Depending on the parameterization ("Velocity Diff", "Acceleration", "Deceleration", "Length", "Mode") this distance may not be fully reached. In this case the maximum possible distance is superimposed. (Actual Distance ≤ Distance). Actual Length LREAL Actual travel during superimposed motion (Actual Lenght ≤ Length). Actual Acceleratio LREAL Actual acceleration of the superimposed movement n (Actual Acceleration ≤ Acceleration). Actual Deceleratio LREAL Actual deceleration of the superimposed movement n (Actual Deceleration ≤ Deceleration). See also: General rules for MC function blocks [} 14] Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.2.2 Application examples for MC_Move Super Imposed The function block MC_Move Super Imposed [} 89] starts a superimposed movement on an axis that is already moving. For this superposition various applications are available that are described below. TE1000 Version: 2.15.4 91
## Page 92

Motion function blocks Distance correction for products on a conveyor belt A conveyor belt consists of individual segments, each driven by an axis. The conveyor belt is used for transporting packages, the spacing of which is to be corrected. To this end a conveying segment must briefly run faster or slower relative to a following segment. The measured distance is 1800 mm and is to be reduced to 1500 mm. Conveyor belt 1 should be accelerated in order to reduce the distance. The correction must be completed by the time the end of belt 1 is reached in order to prevent the package being pushed onto the slower belt 2. Since in this situation conveyor 1 has to be accelerated the drive system requires a velocity reserve, assumed to be 500 mm/s in this case. In practice this value can be determined from the difference between the maximum conveyor velocity and the current set velocity. For parameterization of function block MC_Move Super Imposed [} 89] this means: Distance = 1800 mm - 1500 mm = 300 mm (distance correction) Length = 1000 mm (available distance up to the end of belt 1) Mode = SUPERPOSITIONMODE_VELOREDUCTION_LIMITEDMOTION Velocity Diff = 500 mm/s The "mode" defines that the distance "Length" up to the end of the conveyor belt is used for the correction and that the correction is completed at this point. The system uses the internally calculated velocity as degree of freedom. "Velocity Diff" therefore is the upper limit for the velocity change in this case. Alternatively the correction could be achieved by decelerating belt 2. In this case, "Distance" must be specified as a negative value, and the available correction distance "Length" is the distance between the packet on the right and the end of the belt. The maximum possible velocity change "Velocity Diff" corresponds to the current set velocity. Belt 2 could therefore be decelerated down to zero, if necessary. Phase shift of a print roller A print roller rotates with constant peripheral velocity at the same velocity as conveyor belt on which a workpiece to be printed is transported. For synchronization with the workpiece the print roller is to be advanced by a certain angle (phase shift). 92 Version: 2.15.4 TE1000
## Page 93

Motion function blocks The phase shift can be implemented in two ways: • The angle can be corrected as quickly as possible, resulting in a short-term strong increase in the velocity of the print roller. • A correction distance can be defined within which the correction can take place, e.g. a full roller revolution. This results in the following possibilities for parameterization of the function block MC_Move Super Imposed [} 89]. Fast correction: Distance = 7.1° Length = 360° (maximum possible correction distance) Mode = SUPERPOSITIONMODE_LENGTHREDUCTION_LIMITEDMOTION Velocity Diff = 30°/s (velocity reserve) The "mode" specifies that the correction distance should be as short as possible. The stated value for "Length" therefore is an upper limit that can be chosen freely (but not too small). Alternatively SUPERPOSITIONMODE_VELOREDUCTION_ADDITIVEMOTION can be used as "Mode". In this case the whole correction distance would be up to 367.1°. Since the distance should be as short as possible both modes are equivalent in this case. Slow correction: Distance = 7.1° Length = 360° (correction distance) Mode = SUPERPOSITIONMODE_VELOREDUCTION_LIMITEDMOTION Velocity Diff = 30°/s (velocity reserve) The mode specifies that the correction distance should be utilized fully and the velocity change should be kept as small as possible. The stated value for "Velocity Diff" therefore is an upper limit that can be chosen freely (but not too small). Drilling unit A drilling unit should drill two holes in a moving workpiece. Synchronization for the first hole is assumed to be achieved via the flying saw (MC_Gear In Pos) and is not be considered here. After the first operation the device must be moved by certain distance relative to the moving workpiece. TE1000 Version: 2.15.4 93
## Page 94

Motion function blocks The drilling unit is to be advanced by 250 mm relative to the workpiece after the first hole has been drilled. Meanwhile the workpiece covers a distance of 400 mm. From this position the drilling unit is once again synchronous with the workpiece and the second hole can be drilled. Here too two options are available that differ in terms of the velocity change of the drilling device and therefore in the mechanical strain. Parameterization of function block MC_Move Super Imposed [} 89]: Fast correction: Distance = 250 mm Length = 400 mm Mode = SUPERPOSITIONMODE_LENGTHREDUCTION_ADDITIVEMOTION Velocity Diff = 500 mm/s (velocity reserve of the drilling device) The mode specifies that the correction distance should be as short as possible. The stated value for "Length" therefore is an upper limit that can be chosen freely (but not too small). The drilling unit can travel a larger distance since "Length" refers to the workpiece plus a relative change in position. Slow correction: Distance = 250 mm Length = 400 mm Mode = SUPERPOSITIONMODE_VELOREDUCTION_ADDITIVEMOTION Velocity Diff = 500 mm/s (velocity reserve of the drilling device) "Mode" specifies that the correction distance should be utilized fully and the velocity change should be kept as small as possible. The stated value for "Velocity Diff" therefore is an upper limit that can be chosen freely (but not too small). During the change in position the workpiece covers the distance "Length", the drilling unit travels 650 mm due to the additional correction distance (Length + Distance). Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 94 Version: 2.15.4 TE1000
## Page 95

Motion function blocks 6.2.3 MC_Abort Superposition MC_Abort Superposition Execute BOOL BOOL Done ↔ Axis Reference To AXIS_REF BOOL Busy BOOL Error UDINT Error ID The function block MC_Abort Superposition terminates a superimposed movement started by MC_Move Super Imposed [} 89], without stopping the subordinate axis movement. A full axis stop can be achieved with MC_Stop [} 87] or MC_Halt [} 85], if necessary. In this case MC_Abort Superposition does not have to be called. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge and the superimposed movement is completed. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the superimposed movement was successfully completed. Busy BOOL TRUE as soon as the function block is active. FALSE when it returns to its initial state. Error BOOL TRUE as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 TE1000 Version: 2.15.4 95
## Page 96

Motion function blocks 6.3 Homing 6.3.1 MC_Home MC_Home Execute BOOL BOOL Done Position LREAL BOOL Busy Homing Mode MC_Homing Mode BOOL Active Buffer Mode MC_Buffer Mode BOOL Command Aborted Options ST_Homing Options BOOL Error b Calibration Cam BOOL UDINT Error ID ↔ Axis Reference To AXIS_REF An axis reference run is carried out with the function block MC_Home. The referencing mode is set in the Twin CAT System Manager with the encoder parameter "Reference Mode". Depending on the connected encoder system, different sequences are possible (see also Reference mode for incremental encoders in the Twin CAT 3 ADS Interface NC documentation). Inputs VAR_INPUT Execute : BOOL; Position : LREAL := DEFAULT_HOME_POSITION; Homing Mode : MC_Homing Mode; Buffer Mode : MC_Buffer Mode; Options : ST_Homing Options; b Calibration Cam : BOOL; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Position LREAL Absolute reference position to which the axis is set after homing. Alternatively, the constant DEFAULT_HOME_POSITION can be used here. In this case, the "Reference position for homing" specified in the Twin CAT System Manager is used. Homing Mode MC_Homing Mode [} 131] Determines how the calibration is performed. • MC_Default Homing Initiates default homing. • MC_Direct Sets the axis position directly to Position without executing a movement. • MC_Force Calibration Enforces the "axis is calibrated" state. No movement takes place, and the position remains unchanged. • MC_Reset Calibration Resets the calibration state of the axis. No movement takes place, and the position remains unchanged. Buffer Mode MC_Buffer Mode Currently not implemented. Options ST_Homing Options [} 131] Data structure containing additional, rarely used parameters. The input can normally remain open. • Clear Position Lag: is only effective in "MC_Direct" mode. Can optionally be used to set the set and actual positions to the same value. In this case the following error is cleared. 96 Version: 2.15.4 TE1000
## Page 97

Motion function blocks Name Type Description b Calibration Cam BOOL Reflects the signal of a referencing cam that can be applied to the controller via a digital input. Since the reference position is generally set during the motion, the axis will not stop exactly at this position. The standstill position differs by the braking distance of the axis, although the calibration is nevertheless exact. See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF Axis data structure of the type AXIS_REF [} 119], which uniquely addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Referencing process The referencing process has several phases. The calibration state is signaled in the cyclic interface of the axis (Axis. Nc To Plc. Homing State). The following diagram shows the process flow after starting function block MC_Home with the individual phases. If an axis is to be referenced without referencing cam, i.e. only based on the sync pulse of the encoder, the referencing cam can be simulated via the PLC program. The "b Calibration Cam" signal is initially activated and then canceled, if Axis. Nc To Plc. Homing State [} 120] is equal or greater 4. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE when the axis has been calibrated and the movement is complete. TE1000 Version: 2.15.4 97
## Page 98

Motion function blocks Name Type Description Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the movement command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Currently not implemented - "Active" indicates that the command is running. If the command has been buffered, it may only become active after a running command has been terminated. Command Aborte BOOL TRUE if the command could not be executed completely. d Error BOOL TRUE as soon as an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.4 Manual motion 6.4.1 MC_Jog MC_Jog Jog Forward BOOL BOOL Done Jog Backwards BOOL BOOL Busy Mode E_Jog Mode BOOL Active Position LREAL BOOL Command Aborted Velocity LREAL BOOL Error Acceleration LREAL UDINT Error ID Deceleration LREAL Jerk LREAL ↔ Axis Reference To AXIS_REF The function block MC_Jog enables an axis to be moved via manual keys. The key signal can be linked directly with the "Jog Forward" and "Jog Backwards" inputs. The required operation mode is specified via the "mode" input. An inching mode for moving the axis by a specified distance whenever the key is pressed is also available. The velocity and dynamics of the motion can be specified depending on the operation mode. Inputs VAR_INPUT Jog Forward : BOOL; Jog Backwards : BOOL; Mode : E_Jog Mode; Position : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; END_VAR 98 Version: 2.15.4 TE1000
## Page 99

Motion function blocks Name Type Description Jog Forward BOOL The command is executed with a rising edge, and the axis is moved in positive direction of travel. Depending on the operation mode (see "Mode" input), the axis moves as long as the signal remains TRUE, or it stops automatically after a specified distance. During the motion no further signal edges are accepted (this includes the "Jog Backwards" input). If a simultaneous signal edge occurs at the inputs "Jog Forward" and "Jog Backwards", "Jog Forward" has priority. Jog Backwards BOOL The command is executed with a rising edge, and the axis is moved in negative direction of travel. "Jog Forward" and "Jog Backwards" should be triggered alternatively, although they are also mutually locked internally. Mode E_Jog Mode [} 132] Determines the operation mode in which the manual function is executed. • MC_JOGMODE_STANDARD_SLOW the axis moves as long as the signal at one of the jog inputs is TRUE. The "low velocity for manual functions" specified in the Twin CAT System Manager and standard dynamics are used. In this operation mode the position, velocity and dynamics data specified in the function block have no effect. • MC_JOGMODE_STANDARD_FAST the axis moves as long as the signal at one of the jog inputs is TRUE. The "high velocity for manual functions" specified in the Twin CAT System Manager and standard dynamics are used. In this operation mode the position, velocity and dynamics data specified in the function block have no effect. • MC_JOGMODE_CONTINOUS The axis moves as long as the signal at one of the jog inputs is TRUE. The velocity and dynamics data specified by the user are used. The position has no effect. • MC_JOGMODE_INCHING With a rising edge at one of the jog inputs the axis is moved by a certain distance which is specified via the "Position" input. The axis stops automatically, irrespective of the state of the jog inputs. A new movement step is only executed once a further rising edge is encountered. With each start the velocity and dynamics data specified by the user are used. • MC_JOGMODE_INCHING_MODULO With a rising edge at one of the jog inputs the axis is moved by a certain distance which is specified via the "Positions" input. The axis position will snap to an integer multiple of the position parameter. The axis stops automatically, irrespective of the state of the jog inputs. A new movement step is only executed once a further rising edge is encountered. With each start the velocity and dynamics data specified by the user are used. Position LREAL Relative distance for movements in MC_JOGMODE_INCHING operation mode. Velocity LREAL Maximum travel velocity (>0). Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. TE1000 Version: 2.15.4 99
## Page 100

Motion function blocks Name Type Description Deceleration LREAL Deceleration (≥0). If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. Jerk LREAL Jerk (≥0). At a value of 0, the standard jerk from the axis configuration in the System Manager is applied. The parameters "Position", "Velocity", "Acceleration", "Deceleration" and "Jerk" are not used in the operation modes MC_JOGMODE_STANDARD_SLOW and MC_JOGMODE_STANDARD_FAST and can remain unassigned. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if a movement was successfully completed. Busy BOOL TRUE as soon as the function block is active. FALSE if it is in the default state. Only then can a further edge be accepted at the jog inputs. Active BOOL Indicates that the axis is moved via the jog function. Command Aborte BOOL TRUE if the process is interrupted by an external event, d e.g. by the call up of MC_Stop [} 87]. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 100 Version: 2.15.4 TE1000
## Page 101

Motion function blocks 6.5 Axis coupling 6.5.1 MC_Gear In MC_Gear In Execute BOOL BOOL In Gear Ratio Numerator LREAL BOOL Busy Ratio Denominator UINT BOOL Active Acceleration LREAL BOOL Command Aborted Deceleration LREAL BOOL Error Jerk LREAL UDINT Error ID Buffer Mode MC_Buffer Mode Options ST_Gear In Options ↔ Master Reference To AXIS_REF ↔ Slave Reference To AXIS_REF The function block MC_Gear In activates a linear master-slave coupling (gear coupling). The function block accepts a fixed gear ratio in numerator/denominator format. The slave axis can be coupled to the master axis at standstill. With this function block it is not possible to synchronize to a moving master axis. The flying saw function blocks MC_Gear In Velo or MC_Gear In Pos can be used for this purpose. The slave axis can be decoupled with the function block MC_Gear Out [} 104]. If the slave is decoupled while it is moving, then it retains its velocity and can be halted using MC_Stop [} 87] or MC_Halt [} 85]. Alternatively, the function block MC_Gear In Dyn [} 102] with dynamically changeable gear ratio is available. Inputs VAR_INPUT Execute : BOOL; Ratio Numerator : LREAL; Ratio Denominator : UINT; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Gear In Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Ratio Numerator LREAL Gear ratio numerator. Alternatively, the gear ratio can be specified in the numerator as a floating point value, if the denominator is 1. Ratio Denominato UINT Gear ratio denominator r Acceleration LREAL Acceleration (≥0). (Currently not implemented) Deceleration LREAL Deceleration (≥0). (Currently not implemented) Jerk LREAL Jerk (≥0). (Currently not implemented) Buffer Mode MC_Buffer Mode Currently not implemented Options ST_Gear In Options Currently not implemented For a 1:4 ratio the Ratio Numerator must be 1, the Ratio Denominator must be 4. Alternatively, the Ratio Denominator may be 1, and the gear ratio can be specified as floating point number 0.25 under Ratio Numerator. The Ratio Numerator may be negative. TE1000 Version: 2.15.4 101
## Page 102

Motion function blocks Inputs/outputs VAR_IN_OUT Master : AXIS_REF; Slave : AXIS_REF; END_VAR Name Type Description Master AXIS_REF Axis data structure of the master Slave AXIS_REF Axis data structure of the slave The axis data structure of type AXIS_REF [} 119] addresses an axis unambiguously within the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT In Gear : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description In Gear BOOL TRUE if the coupling was successful. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "In Gear", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. (Currently Active = Busy) Command Aborte BOOL TRUE if the command could not be executed completely. d The axis may have become decoupled during the coupling process (simultaneous command execution). Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.5.2 MC_Gear In Dyn MC_Gear In Dyn Enable BOOL BOOL In Gear Gear Ratio LREAL BOOL Busy Acceleration LREAL BOOL Active Deceleration LREAL BOOL Command Aborted Jerk LREAL BOOL Error Buffer Mode MC_Buffer Mode UDINT Error ID Options ST_Gear In Dyn Options ↔ Master Reference To AXIS_REF ↔ Slave Reference To AXIS_REF 102 Version: 2.15.4 TE1000
## Page 103

Motion function blocks The function block MC_Gear In Dyn activates a linear master-slave coupling (gear coupling). The gear ratio can be adjusted dynamically during each PLC cycle. Hence a controlled master/slave coupling can be build up. The "Acceleration" parameter has a limiting effect in situations with large gear ratio variations. The slave axis can be decoupled with the function block MC_Gear Out [} 104]. If the slave is decoupled while it is moving, then it retains its velocity and can be halted using MC_Stop [} 87] or MC_Halt [} 85]. Alternatively, the function block MC_Gear In [} 101] with fixed gear ratio is available. Inputs VAR_INPUT Enable : BOOL; Gear Ratio : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Gear In Dyn Options; END_VAR Name Type Description Enable BOOL If "Enable" is TRUE, the function block establishes a coupling. If an MC_Gear Out is executed while the MC_Gear In Dyn continues to be called with "Enable" TRUE, it is only decoupled for a short time and then immediately attempts to re-establish the coupling. As long as "Enable" is TRUE, the gear factor can be changed cyclically. If "Enable" becomes FALSE after coupling, the command is terminated. The gear factor is frozen at its last value, but the slave is not decoupled. Gear Ratio LREAL Gear ratio as floating point value. The gear ratio can be changed cyclically as long as "Enable" is TRUE. If "Enable" is FALSE, the gear ratio remains unchanged. Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. The parameter limits the acceleration of the slave in situations with large gear ratio variations. The maximum acceleration is only reached at the maximum master velocity. Otherwise the slave acceleration is below this value when the gear ratio changes significantly. Deceleration LREAL Deceleration (≥0). (Not implemented) Jerk LREAL Jerk (≥0). (Not implemented) Buffer Mode MC_Buffer Mode Currently not implemented Options ST_Gear In Dyn Options Currently not implemented Inputs/outputs VAR_IN_OUT Master : AXIS_REF; Slave : AXIS_REF; END_VAR Name Type Description Master AXIS_REF Axis data structure of the master Slave AXIS_REF Axis data structure of the slave The axis data structure of type AXIS_REF [} 119] addresses an axis unambiguously within the system. Among other parameters it contains the current axis status, including position, velocity or error state. TE1000 Version: 2.15.4 103
## Page 104

Motion function blocks Outputs VAR_OUTPUT In Gear : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description In Gear BOOL TRUE if the coupling was successful. Busy BOOL TRUE as soon as the command is started and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "In Gear", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. (Currently Active = Busy) Command Aborte BOOL TRUE if the command could not be executed completely. d The axis may have become decoupled during the coupling process (simultaneous command execution). Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.5.3 MC_Gear Out MC_Gear Out Execute BOOL BOOL Done Options ST_Gear Out Options BOOL Busy ↔ Slave Reference To AXIS_REF BOOL Error UDINT Error ID The function block MC_Gear Out disables a master-slave coupling. WARNING No standstill of the axis due to decoupling When a slave axis is uncoupled during the movement, it is not stopped automatically but reaches a constant velocity at which it continues to travel infinitely. You can stop the axis with the function blocks MC_Halt [} 85] or MC_Stop [} 87]. Setpoint generator type If the setpoint generator type of the axis is set to "7 phases (optimized)", the slave axis assumes an acceleration-free state after decoupling and continues to move with the resulting constant velocity. There is no positioning based on the master travel path calculated with the coupling factor. Instead, the behavior matches the behavior after a MC_Move Velocity command. In Twin CAT 2.10, the setpoint generator type can be selected by the user. From Twin CAT 2.11, the setpoint generator type is set to "7 phases (optimized)". The behavior described here is the result of a project update from Twin CAT 2.10 to Twin CAT 2.11. Depending on the circumstances, an update of existing applications to version 2.11 may necessitate an adaptation of the PLC program. 104 Version: 2.15.4 TE1000
## Page 105

Motion function blocks Inputs VAR_INPUT Execute : BOOL; Options : ST_Gear Out Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Options ST_Gear Out Options Currently not implemented Inputs/outputs VAR_IN_OUT Slave : AXIS_REF; END_VAR Name Type Description Slave AXIS_REF Axis data structure of the slave The axis data structure of type AXIS_REF [} 119] addresses an axis unambiguously within the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description Done BOOL TRUE if the axis has been successfully decoupled. Busy BOOL TRUE as soon as the command is started and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done" or "Error" is set. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 TE1000 Version: 2.15.4 105
## Page 106

Motion function blocks 6.5.4 MC_Gear In Multi Master MC_Gear In Multi Master Master1 Reference To AXIS_REF BOOL In Gear Master2 Reference To AXIS_REF BOOL Busy Master3 Reference To AXIS_REF BOOL Active Master4 Reference To AXIS_REF BOOL Command Aborted Enable BOOL BOOL Error Gear Ratio1 LREAL UDINT Error ID Gear Ratio2 LREAL Gear Ratio3 LREAL Gear Ratio4 LREAL Acceleration LREAL Deceleration LREAL Jerk LREAL Buffer Mode MC_Buffer Mode Options ST_Gear In Multi Master Options ↔ Slave Reference To AXIS_REF The function block MC_Gear In Multi Master is used to activate linear master/slave coupling (gear coupling) for up to four different master axes. The gear ratio can be adjusted dynamically during each PLC cycle. The slave movement is determined by the superimposed master movements. The "Acceleration" parameter has a limiting effect in situations with large gear ratio variations. The slave axis can be decoupled with the function block MC_Gear Out [} 104]. If the slave is decoupled while it is moving, then it retains its velocity and can be halted using MC_Stop [} 87]. If less than four masters are used, an empty data structure can be transferred for each of the parameters "Master2" to "Master4" (the axis ID must be 0). Inputs VAR_INPUT Master1 : Reference To AXIS_REF; Master2 : Reference To AXIS_REF; Master3 : Reference To AXIS_REF; Master4 : Reference To AXIS_REF; Enable : BOOL; Gear Ratio1 : LREAL; Gear Ratio2 : LREAL; Gear Ratio3 : LREAL; Gear Ratio4 : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Gear In Multi Master Options; END_VAR Name Type Description Master1 Reference To AXIS_REF Axis data structure of the first master [} 119] Master2 Reference To AXIS_REF Axis data structure of the second master [} 119] Master3 Reference To AXIS_REF Axis data structure of the third master [} 119] Master4 Reference To AXIS_REF Axis data structure of the fourth master [} 119] Enable BOOL If "Enable" is TRUE, the function block establishes a coupling. 106 Version: 2.15.4 TE1000
## Page 107

Motion function blocks Name Type Description If an MC_Gear Out is executed while the MC_Gear In Multi Master continues to be called with "Enable" TRUE, it is only decoupled briefly and then immediately attempts to re-establish the coupling. As long as "Enable" is TRUE, the gear factors can be changed cyclically. If "Enable" becomes FALSE after coupling, the command is terminated. The gear factors are frozen at their last values, but the slave is not decoupled. Gear Ratio1 LREAL Gear ratio as floating point value for the first master axis. The gear ratio can be changed cyclically as long as "Enable" is TRUE. If "Enable" is FALSE, the gear ratio remains unchanged. Gear Ratio2 LREAL Gear ratio as floating point value for the second master axis. The gear ratio can be changed cyclically as long as "Enable" is TRUE. If "Enable" is FALSE, the gear ratio remains unchanged. Gear Ratio3 LREAL Gear ratio as floating point value for the third master axis. The gear ratio can be changed cyclically as long as "Enable" is TRUE. If "Enable" is FALSE, the gear ratio remains unchanged. Gear Ratio4 LREAL Gear ratio as floating point value for the fourth master axis. The gear ratio can be changed cyclically as long as "Enable" is TRUE. If "Enable" is FALSE, the gear ratio remains unchanged. Acceleration LREAL Acceleration (≥0). If the value is 0, the standard acceleration from the axis configuration in the System Manager is used. The parameter limits the acceleration of the slave in situations with large gear ratio variations. Deceleration LREAL Deceleration (≥0). If the value is 0, the standard deceleration from the axis configuration in the System Manager is used. The parameter limits the deceleration of the slave in situations with large gear ratio variations. Used only for the option "Advanced Slave Dynamics". Jerk LREAL Jerk (≥0). If the value is 0, the standard jerk from the axis configuration in the System Manager is used. The parameter limits the jerk of the slave in situations with large gear ratio variations. Used only for the option "Advanced Slave Dynamics". Buffer Mode MC_Buffer Mode Currently not implemented Options ST_Gear In Multi Master Options • Advanced Slave Dynamics: swaps the internal algorithm of the function block. This makes it possible [} 130] to synchronize to masters already in motion. In this case, "Acceleration" and "Deceleration" should only be parameterized symmetrically. If jerk presets are too large, this is reduced to the extent that a change from zero to the parameterized acceleration / deceleration can take place in one NC cycle. The resolution of the acceleration / deceleration thus depends directly on the suitable parameterization of the jerk value. • Sync Mode (available from TC3.1.4024.11): the Sync Mode specifies how the axis coupling behaves if the movement of the slave axis is limited in the Advanced Slave Dynamics mode (limitation of velocity, acceleration and jerk). The following parameters can be set: TE1000 Version: 2.15.4 107
## Page 108

Motion function blocks Name Type Description ◦ VELOSYNC: The slave axis and the master axes move with a synchronized velocity. In the case of a dynamic limitation, the slave establishes a position difference that is not caught up again. ◦ POSSYNC1: The slave axis moves to the master axes with synchronized velocity and position. In the case of a dynamic limitation, the slave establishes a position difference that is then caught up at a later time. Changes in the gear ratios during the journey are executed taking into account the dynamics. The position difference between master and slave resulting from this is not caught up. ◦ POSSYNC2: The slave axis moves to the master axes with synchronized velocity and position. In the case of a dynamic limitation, the slave establishes a position difference that is then caught up at a later time. Changes in the gear ratios during the journey are immediately calculated internally and the slave continuously synchronizes itself to the new position. Overview: Which user command results in a permanent position difference or catches it up depending on the Sync Mode? User commands Change Dynamic limitation Coupling during the journey Gearing factor (Velo, Acc, Jerk) Permanent position difference Permanent position difference Permanent position difference Permanent position difference Permanent position difference Catch up position difference Catch up position difference Catch up position difference Catch up position difference 108 Version: 2.15.4 TE1000 edo Mcny S VELOSYNC (default) POSSYNC1 POSSYNC2 If coupling takes place with a constant gear ratio with the axes at a standstill (and the gear ratio no longer changes during the course of coupling), then the two Sync Modes POSSYNC1 and POSSYNC2 behave identically. Inputs/outputs VAR_IN_OUT Slave : AXIS_REF; END_VAR Name Type Description Slave AXIS_REF Axis data structure of the slave The axis data structure of type AXIS_REF [} 119] addresses an axis unambiguously within the system. Among other parameters it contains the current axis status, including position, velocity or error state.
## Page 109

Motion function blocks Outputs VAR_OUTPUT In Gear : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR Name Type Description In Gear BOOL TRUE if the coupling was successful. Busy BOOL TRUE as soon as the command is started with "Enable" and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "In Gear", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. (Currently Active = Busy) Command Aborte BOOL TRUE if the command could not be executed completely. d The axis may have become decoupled during the coupling process (simultaneous command execution). Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 6.6 Phasing 6.6.1 MC_Halt Phasing MC_Halt Phasing Execute BOOL BOOL Done Deceleration LREAL BOOL Busy Jerk LREAL BOOL Active Buffer Mode MC_Buffer Mode BOOL Command Aborted Options ST_Phasing Options BOOL Error ↔ Master Reference To AXIS_REF UDINT Error ID ↔ Slave Reference To AXIS_REF The function block MC_Halt Phasing is used to bring about a controlled stop of the phase shift of a slave axis relative to the master axis. The "Halt" is always jerk-limited, based on the constant jerk value for the braking delay set in the "Jerk" parameter. MC_Halt Phasing terminates a superimposed movement through MC_Phasing Absolute or MC_Phasing Relative. Inputs VAR_INPUT Execute : BOOL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Phasing Options; END_VAR TE1000 Version: 2.15.4 109
## Page 110

Motion function blocks Name Type Description Execute BOOL The command is executed with a rising edge. Deceleration LREAL Maximum deceleration value Jerk LREAL Maximum jerk value Buffer Mode MC_Buffer Mode MC_Aborting only Options ST_Phasing Options Not implemented Inputs/outputs VAR_IN_OUT Master : AXIS_REF; Slave : AXIS_REF; END_VAR Name Type Description Master AXIS_REF Axis data structure of the master Slave AXIS_REF Axis data structure of the slave The axis data structure of type AXIS_REF [} 119] addresses an axis unambiguously within the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL TRUE if velocity = 0 is reached. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 110 Version: 2.15.4 TE1000
## Page 111

Motion function blocks 6.6.2 MC_Phasing Absolute MC_Phasing Absolute Execute BOOL BOOL Done Continuous Update BOOL BOOL Busy Phase Shift LREAL BOOL Active Velocity LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error ID Jerk LREAL LREAL Absolute Phase Shift Buffer Mode MC_Buffer Mode Options ST_Phasing Options ↔ Master Reference To AXIS_REF ↔ Slave Reference To AXIS_REF The function block MC_Phasing Absolute can be used to set a phase shift between a master axis and a slave axis. The function block executes a superimposed movement of the slave axis and thus sets a position difference "Phase Shift" between master and slave. The dynamic values "velocity", "acceleration" and "deceleration" refer to the superimposed movement with which the phase shift is carried out. The movement is always jerk-limited, based on the constant jerk value set in the Jerk parameter. This value applies both to "Acceleration" and "Deceleration". The phase shift can be used for a simple MC_Gear In [} 101] coupling, as well as for a coupling with dynamic coupling factor. In the latter case, note that MC_Gear In Multimaster [} 106] is used with Options. Advanced Slave Dynamics = TRUE (gearing) or MC_Cam In_V2 (camming). MC_Gear In Dyn [} 102] is not supported. Inputs VAR_INPUT Execute : BOOL; Continuous Update : BOOL; Phase Shift : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Phasing Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Continuous Updat BOOL If this input is TRUE at the rising edge at the "Execute" e input, the "Phase Shift", "Velocity", "Acceleration", "Deceleration" and "Jerk" inputs can be changed during the execution of the command and made effective as quickly as possible. Phase Shift LREAL Phase shift to be set between master and slave axis Velocity LREAL Maximum velocity that may be reached during the phase shift (>=0.01). Acceleration LREAL Maximum acceleration value Deceleration LREAL Maximum deceleration value Jerk LREAL Maximum jerk value Buffer Mode MC_Buffer Mode MC_Aborting only Options ST_Phasing Options Not implemented TE1000 Version: 2.15.4 111
## Page 112

Motion function blocks Inputs/outputs VAR_IN_OUT Master : AXIS_REF; Slave : AXIS_REF; END_VAR Name Type Description Master AXIS_REF Axis data structure of the master Slave AXIS_REF Axis data structure of the slave The axis data structure of type AXIS_REF [} 119] addresses an axis unambiguously within the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; Absolute Phase Shift : LREAL; END_VAR Name Type Description Done BOOL TRUE when the absolute phase shift is established. Busy BOOL TRUE as soon as the command is started with Execute and as long as the phase shift occurs. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Absolute Phase Sh LREAL Absolute phase shift ift Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 112 Version: 2.15.4 TE1000
## Page 113

Motion function blocks 6.6.3 MC_Phasing Relative MC_Phasing Relative Execute BOOL BOOL Done Continuous Update BOOL BOOL Busy Phase Shift LREAL BOOL Active Velocity LREAL BOOL Command Aborted Acceleration LREAL BOOL Error Deceleration LREAL UDINT Error ID Jerk LREAL LREAL Covered Phase Shift Buffer Mode MC_Buffer Mode Options ST_Phasing Options ↔ Master Reference To AXIS_REF ↔ Slave Reference To AXIS_REF The function block MC_Phasing Relative can be used to set a phase shift between a master and a slave axis. The function block executes a superimposed movement of the slave axis, thereby changing the position difference between master and slave by the distance "Phase Shift". The dynamic values "velocity", "acceleration" and "deceleration" refer to the superimposed movement with which the phase shift is carried out. The movement is always jerk-limited, based on the constant jerk value set in the Jerk parameter. This value applies both to "Acceleration" and "Deceleration". The phase shift can be used for a simple MC_Gear In [} 101] coupling, as well as for a coupling with dynamic coupling factor. In the latter case, note that MC_Gear In Multimaster [} 106] is used with Options. Advanced Slave Dynamics = TRUE (gearing) or MC_Cam In_V2 (camming). MC_Gear In Dyn [} 102] is not supported. Inputs VAR_INPUT Execute : BOOL; Continuous Update : BOOL; Phase Shift : LREAL; Velocity : LREAL; Acceleration : LREAL; Deceleration : LREAL; Jerk : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Phasing Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Continuous Updat BOOL If this input is TRUE at the rising edge at the Execute e input, the "Phase Shift", "Velocity", "Acceleration", "Deceleration" and "Jerk" inputs can be changed during the execution of the command and made effective as quickly as possible. Phase Shift LREAL Amount by which the phase shift between master and slave axis is changed. Velocity LREAL Maximum velocity that may be reached during the phase shift (>=0.01). Acceleration LREAL Maximum acceleration value Deceleration LREAL Maximum deceleration value Jerk LREAL Maximum jerk value Buffer Mode MC_Buffer Mode MC_Aborting only Options ST_Phasing Options Not implemented TE1000 Version: 2.15.4 113
## Page 114

Motion function blocks Inputs/outputs VAR_IN_OUT Master : AXIS_REF; Slave : AXIS_REF; END_VAR Name Type Description Master AXIS_REF Axis data structure of the master Slave AXIS_REF Axis data structure of the slave The axis data structure of type AXIS_REF [} 119] addresses an axis unambiguously within the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; Covered Phase Shift : LREAL; END_VAR Name Type Description Done BOOL TRUE when the absolute phase shift is established. Busy BOOL TRUE as soon as the command is started with "Execute" and as long as the phase shift occurs. If "Busy" is FALSE, the function block is ready for a new order. At the same time, one of the outputs "Done", "Command Aborted" or "Error" is set. Active BOOL Indicates that the command is executed. If the command was buffered, it becomes active once a running command is completed. Command Aborte BOOL TRUE if the command could not be executed completely. d The axis was stopped or the current command was replaced by another Move command. Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. Covered Phase Sh LREAL Absolute phase shift ift Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 114 Version: 2.15.4 TE1000
## Page 115

Motion function blocks 6.7 Torque Control 6.7.1 MC_Torque Control MC_Torque Control Execute BOOL BOOL In Torque Continuous Update BOOL BOOL Busy Relative BOOL BOOL Active Torque LREAL BOOL Command Aborted Torque Ramp LREAL BOOL Error Velocity Limit High LREAL UDINT Error Id Velocity Limit Low LREAL Buffer Mode MC_Buffer Mode Options ST_Torque Control Options ↔ Axis Reference To AXIS_REF The MC_Torque Control function block switches an axis under NC control to the “Cyclic Synchronous Torque Mode” (CST) and sets a torque setpoint for it. In this operation mode, the NC also provides the parameterized “Velocity Limit High” & “Velocity Limit Low” as linkable objects to the drive controller (Axis->Drive->Outputs->n Data Out5/n Data Out6) in the cyclic interface. To change the operation mode without jerking, the dead time compensation must be activated in the NC axis. Supported Beckhoff hardware AX5xxx AX8xxx / AMP8xxx / MD8xxx Compact drive technology (servo) from FW v2.14 b0001 from FW v1.05 b0001 from FW v01 (ELM72xx and AMI8xxx) DANGER Danger to life or risk of serious injury or damage to property due to unintentional movements of the axis When using the function block, the axis is switched to CST mode. After using the function block (especially after error situations), the axis may still be in CST mode. This can lead to sudden and unplanned movements (especially with lifting axes) when the axis is released. • Ensure that there is no hazard as defined by the risk assessment. • Check the current operation mode via the function block MC_Read Drive Operation Mode [} 45]. • If the axis is not in a position-related operation mode (CSV/CSP), transfer it before an enable: – directly with MC_Write Drive Operation Mode [} 46] into the desired position-related operation mode (CSV/CSP) or – indirectly with MC_Halt [} 85] / MC_Stop [} 87] into the desired position-related operation mode (CSV/ CSP) (from Twin CAT 3.1.4024.40) Other function blocks that switch the axis indirectly into a position-related operation mode can only do this to a limited extent and are therefore not to be used for a deliberate operation mode change. ð Subsequently, it is necessary to check again whether the axis is really in a position-related operation mode (CSV/CSP), if not, an abort with error handling is required. For this module to be used effectively, the drive controller must support on-the-fly switching between operating modes and speed limitations in torque mode. The relevant parameters are available for scaling the actual and setpoint torque in the Drive area in the NC axis parameters. TE1000 Version: 2.15.4 115
## Page 116

Motion function blocks Inputs VAR_INPUT Execute : BOOL; Continuous Update : BOOL; Relative : BOOL; Torque : LREAL; Torque Ramp : LREAL; Velocity Limit High : LREAL; Velocity Limit Low : LREAL; Buffer Mode : MC_Buffer Mode; Options : ST_Torque Control Options; END_VAR Name Type Description Execute BOOL The command is executed with a rising edge. Continuous Updat BOOL If this input is TRUE on the rising edge at the "Execute" e input, the "Torque", "Torque Ramp", "Velocity Limit High" and "Velocity Limit Low" inputs can be changed during the execution of the command and made effective as quickly as possible. Relative BOOL If this input is TRUE, the torque value is changed relatively by the specified value "Torque". Torque LREAL Torque setpoint with which the drive is operated ("Relative" = FALSE) or by which the torque is to be changed ("Relative" = TRUE). (e.g. %) Here, a positive torque setting means torque in a logically positive direction of movement. Torque Ramp LREAL Rate of change of the torque setpoint ( e.g. %/s) Velocity Limit High LREAL Upper velocity limit for limitation in CST mode (e.g. mm/ s). This limitation must be configured accordingly in the process image. Velocity Limit Low LREAL Lower velocity limit for limitation in CST mode (e.g. mm/ s). This limitation must be configured accordingly in the process image. Buffer Mode MC_Buffer Mode [} 133] Currently only "Aborting" is supported. Options ST_Torque Control Options Data structure containing additional, rarely used parameters. The input can normally remain open. [} 154] See also: General rules for MC function blocks [} 14] Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF [} 119] Axis data structure that unambiguously addresses an axis in the system. Among other parameters it contains the current axis status, including position, velocity or error state. Outputs VAR_OUTPUT In Torque : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_VAR 116 Version: 2.15.4 TE1000
## Page 117

Motion function blocks Name Type Description In Torque BOOL TRUE, if the axis has built up the set torque and no velocity limitation is active. Busy BOOL TRUE as soon as the command is started with Execute and as long as the command is processed. If "Busy" is FALSE, the function block is ready for a new order. Active BOOL Indicates that the function block controls the axis. Command Aborte BOOL TRUE if the command could not be executed completely. d Error BOOL TRUE, if an error occurs. Error ID UDINT If the error output is set, this parameter supplies the error number. See also: General rules for MC function blocks [} 14] Example MC_Torque Control for AX8xxx VAR Axis_Main : AXIS_REF; b Execute_Torque Control : BOOL; f Torque : LREAL; END_VAR f Torque := 35; fb Torque Control( Axis := Axis_Main, Execute := b Execute_Torque Control, Continuous Update := TRUE, Relative := FALSE, Torque := f Torque, Torque Ramp := 10, Velocity Limit High := 400, Velocity Limit Low := -500, Buffer Mode := , Options := , In Torque => , Busy => , Active => , Command Aborted => , Error => , Error Id => ); TE1000 Version: 2.15.4 117
## Page 118

Motion function blocks Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024 PC or CX (x86) Tc2_MC2 118 Version: 2.15.4 TE1000
## Page 119

Data types 7 Data types 7.1 Axis interface 7.1.1 ST_Ads Address ADS data structure used in the AXIS_REF [} 119] and containing the ADS communication parameters of an axis needed for direct ADS communication. Normally this structure does not have to be populated. The user can use it to stored information for controlling an axis on another target system or via a special port number. TYPE ST_Ads Address STRUCT Net Id : STRING(23); Port : UINT; Channel : UINT; END_STRUCT END_TYPE Name Type Description Net Id STRING(23) Ams Net Id of the target system Port UINT Port number Channel UINT Channel number 7.1.2 AXIS_REF The AXIS_REF data type contains axis information. AXIS_REF is an interface between the PLC and the NC. It is added to MC function blocks as axis reference. TYPE AXIS_REF : VAR_INPUT Plc To Nc AT %Q* : PLCTONC_AXIS_REF; END_VAR VAR_OUTPUT Nc To Plc AT %I* : NCTOPLC_AXIS_REF; ADS : ST_Ads Address; Status : ST_Axis Status; Drive Address : ST_Drive Address; END_VAR END_TYPE AXIS_REF elements Description Plc To Nc Data structure which is cyclically exchanged between PLC and NC. Via this data structure the MC function blocks communicate with the NC and send control information from the PLC to the NC. This data structure is automatically placed in the output process image of the PLC and must be linked in Twin CAT System Manager with the input process image of an NC axis. (Type: PLCTONC_AXIS_REF [} 126]) Nc To Plc Data structure which is cyclically exchanged between PLC and NC. Via this data structure the MC function blocks communicate with the NC and receive status information from the NC. This data structure is automatically placed in the input process image of the PLC and must be linked in Twin CAT System Manager with the output process image of an NC axis. The NCTOPLC structure contains all main state data for an axis such as position, velocity and instruction state. Since data exchange takes place cyclically, the PLC can access the current axis state at any time without additional communication effort. (Type: NCTOPLC_AXIS_REF [} 120]) ADS The ADS data structure contains the ADS communication parameters for an axis that are required for direct ADS communication. Normally this structure does not have to be populated. The user can use it to stored information for controlling an axis on another target system or via a special port number. TE1000 Version: 2.15.4 119
## Page 120

Data types AXIS_REF elements Description Status Data structure containing additional or processed status information for an axis (type: ST_Axis Status [} 147]). This data structure is not refreshed cyclically, but has to be updated through the PLC program. For this purpose MC_Read Status [} 29] or alternatively the action "Read Status" of AXIS_REF can be called: Drive Address Data structure containing the ADS access data of a drive device. These data are not filled until the function block MC_Read Drive Address [} 54] has been called implicitly or explicitly. Sample: VAR Axis1 : AXIS_REF (* axis data structure for Axis-1 *) END_VAR (* program code at the beginning of each PLC cycle *) Axis1. Read Status(); (* alternative program code at the beginning of each PLC cycle *) Axis1(); The call of "Read Status" or "Axis1" should be made once at the beginning of each PLC cycle. The current status information can then be accessed in AXIS_REF from the whole PLC program. Within a cycle the status does not change. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.1.3 NCTOPLC_AXIS_REF The data structure NCTOPLC_AXIS_REF is part of the AXIS_REF [} 119] data structure and is automatically updated by the NC, so that updated information is available during each PLC cycle. NCTOPLC_AXIS_REF is also referred to as axis interface between NC and PLC. TYPE NCTOPLC_AXIS_REF STRUCT State DWord : NCTOPLC_AXIS_REF_STATE; (* Status double word *) Error Code : DWORD; (* Axis error code *) Axis State : DWORD; (* Axis moving status *) Axis Mode Confirmation : DWORD; (* Axis mode confirmation (feedback from NC) *) Homing State : DWORD; (* State of axis calibration (homing) *) Couple State : DWORD; (* Axis coupling state *) Svb Entries : DWORD; (* SVB entries/orders (SVB = Set preparation task) *) Saf Entries : DWORD; (* SAF entries/orders (SAF = Set execution task) *) Axis Id : DWORD; (* Axis ID *) Op Mode DWord : NCTPPLC_AXIS_REF_OPMODE; (* Current operation mode *) Act Pos : LREAL; (* Actual position (absolut value from NC) *) Modulo Act Pos : LREAL; (* Actual modulo position *) Active Control Loop Index : WORD; (* Active control loop index *) Control Loop Index : WORD; (* Axis control loop index (0, 1, 2, when multiple control loops are used) *) Modulo Act Turns : DINT; (* Actual modulo turns *) Act Velo : LREAL; (* Actual velocity *) Pos Diff : LREAL; (* Position difference (lag distance) *) Set Pos : LREAL; (* Setpoint position *) Set Velo : LREAL; (* Setpoint velocity *) Set Acc : LREAL; (* Setpoint acceleration *) Target Pos : LREAL; (* Estimated target position *) Modulo Set Pos : LREAL; (* Setpoint modulo position *) Modulo Set Turns : DINT; (* Setpoint modulo turns *) Cmd No : WORD; (* Continuous actual command number *) Cmd State : WORD; (* Command state *) Set Jerk : LREAL; Set Torque : LREAL; Act Torque : LREAL; State DWord2 : NCTOPLC_AXIS_REF_STATE2; State DWord3 : DWORD; Touch Probe State : DWORD; Touch Probe Counter : DWORD; 120 Version: 2.15.4 TE1000
## Page 121

Data types Cam Coupling State : ARRAY [0..7] OF NCTOPLC_AXIS_REF_CAMCOUPLINGSTATE; Cam Coupling Table ID : ARRAY [0..7] OF UINT; Act Torque Derivative : LREAL; Set Torque Derivative : LREAL; Abs Phasing Pos : LREAL; Torque Offset : LREAL Act Pos Without Pos Correction : LREAL; Act Acc : LREAL; Dc Time Stamp : UDINT; {attribute 'hide'} _reserved2 : ARRAY [1..4] OF USINT; User Data : LREAL; END_TYPE Variable name Data type Definition range Description State DWord NCTOPLC_AXIS_R - State double word. EF_STATE [} 124] Error Code DWORD ≥0 Axis error code Axis State DWORD ENUM [} 122] Present state of the axis movement Axis Mode Confirmation DWORD ENUM Axis operating mode (feedback from the NC) Homing State DWORD ENUM [} 122] Reference status of the axis ("calibration status") Couple State DWORD ENUM [} 123] Axis coupling state Svb Entries DWORD ≥0 SVB entries/tasks Saf Entries DWORD ≥0 SAF entries/tasks (NC interpreter, FIFO group) Axis Id DWORD >0 axis ID Op Mode DWord. NCTOPLC_AXIS_R - Axis operation mode double word EF_OPMODE [} 123] Act Pos LREAL ±∞ Actual position (calculated absolute value) Modulo Act Pos LREAL ≥0 Modulo actual position (calculated value in, for example, degrees) Active Control Loop Index WORD ≥0 Active axis control loop index Control Loop Index WORD ≥0 Axis control loop index (0, 1, 2, etc. if more than one axis control loop is used) Modulo Act Turns DINT ±∞ Modulo actual rotations Act Velo LREAL ±∞ Actual velocity (optional) Pos Diff LREAL ±∞ Lag error (position) Set Pos LREAL ±∞ Set position (calculated absolute value) Set Velo LREAL ±∞ Set velocity Set Acc LREAL ±∞ Set acceleration Target Pos LREAL ±∞ Estimated target position of the axis Modulo Set Pos LREAL ≥0 Modulo set position (calculated value in, for example, degrees) Modulo Set Turns DINT ≥0 Modulo set rotations Cmd No WORD ≥0 Command number of the active axis job (see Buffer Mode) Cmd State WORD ≥0 Command status information (see Buffer Mode) Set Jerk LREAL Set jerk Set Torque LREAL Set torque Act Torque LREAL Actual torque TE1000 Version: 2.15.4 121
## Page 122

Data types Variable name Data type Definition range Description State DWord2 NCTOPLC_AXIS_R State double word 2 EF_STATE2 [} 125] State DWord3 DWORD State double word 3 Touch Probe State DWORD Touch Probe status Touch Probe Counter DWORD Touch Probe counter Cam Coupling State ARRAY [0..7] OF Cam coupling information for multitables NCTOPLC_AXIS_R (from Twin CAT 3.1.4020.0) EF_CAMCOUPLIN GSTATE [} 126] Cam Coupling Table Id ARRAY [0..7] OF Cam coupling ID for multitables (from UINT Twin CAT 3.1.4020.0) Act Torque Derivative LREAL First derivative of the actual torque Set Torque Derivative LREAL First derivative of the set torque Abs Phasing Pos LREAL Absolute phasing offset Torque Offset LREAL Additive torque part Act Pos Without Pos Correction LREAL Actual position without position correction Act Acc LREAL Actual acceleration Dc Time Stamp UDINT Current NC timestamp User Data LREAL Configurable axis state parameter Define Master: motion state / drive phase of the continuous master axis (servo) (Axis- State) 0 Setpoint generator not active (INACTIVE) 1 Setpoint generator active (RUNNING) 2 Velocity override is zero (OVERRIDE_ZERO) 3 Constant velocity (PHASE_VELOCONST) 4 Acceleration phase (PHASE_ACCPOS) 5 Deceleration phase (PHASE_ACCNEG) Define Master: motion state / drive phase of the discrete master axis (fast/creep) (Axis State) 0 Setpoint generator not active 1 Moving phase (rapid or slow traverse) 2 Switchover delay from rapid to slow traverse 3 Creep motion (within the creep distance) 4 Deceleration time (starting from the braking distance in front of the target) Define Slave: motion state / drive phase of the continuous slave axis (servo) (Axis State) 0 Slave generator not active (INACTIVE) 11 Slave is in a movement pre-phase (PRE-PHASE) 12 Slave is synchronizing (SYNCHRONIZING) 13 Slave is synchronized and moves synchronously (SYNCHRON) Define Calibration state of the axis (Homing State) 0 Referencing process completed (READY) 1 Continuous start in the direction of the referencing cam. If the cam is occupied at the beginning, then the program starts directly with calibration state 3. 2 Wait for positive edge of the referencing cam and initiate axis stop 3 Wait until the axis is stopped (check whether cam is still occupied) and then endless start of the referencing cam in the direction of the sync pulse 122 Version: 2.15.4 TE1000
## Page 123

Data types Define Calibration state of the axis (Homing State) 4 Wait for falling edge of the referencing cam 5 Activate latch, wait until latch has become valid and then initiate axis stop 6 If axis has stopped, then set actual position (actual position = reference position + braking distance) See also function block description and remarks for MC_Home [} 96] Define Coupling state of the axis (Couple State) 0 Single axis that is neither a master nor a slave (SINGLE) 1 Master axis with any number of slaves (MASTER) 2 Slave axis that is the master of another slave (MASTERSLAVE) 3 Just a slave axis (SLAVE) Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.1.4 NCTOPLC_AXIS_REF_OPMODE The structure NCTOPLC_AXIS_REF_OPMODE is part of the structure NCTOPLC_AXIS_REF [} 120]. TYPE NCTOPLC_AXIS_REF_OPMODE : DWORD; END_TYPE The individual items of information are provided in the status structure of the AXIS_REF at the following points: Bit Variable name Description 0 Status. Opmode. Position Area Monitoring Position range monitoring 1 Status. Opmode. Target Position Monitoring Target position window monitoring 2 Status. Opmode. Loop Mode Loop movement 3 Status. Opmode. Motion Monitoring Physical movement monitoring 4 Status. Opmode. PEHTime Monitoring PEH time monitoring 5 Status. Opmode. Backlash Compensation Backlash compensation 6 Status. Opmode. Delayed Error Reaction Delayed error reaction of the NC 7 Status. Opmode. Modulo Modulo axis (modulo display) 8 Status. Opmode. Simulation Axis Simulation axis 9-11 12 Status. Opmode. Stop Monitoring Standstill monitoring 13-15 16 Status. Opmode. Position Lag Monitoring Lag monitoring - position 17 Status. Opmode. Velo Lag Monitoring Lag monitoring - velocity 18 Status. Opmode. Soft Limit Min Monitoring End position monitoring min. 19 Status. Opmode. Soft Limit Max Monitoring End position monitoring max. 20 Status. Opmode. Position Correction Position correction ("Measuring system error compensation") 21 Status. Opmode. Allow Slave Commands Allow motion commands to slave axes 22 Status. Opmode. Allow Ext Set Axis Comman Allow motion commands to an axis that is fed by an ds external setpoint generator 23 Status. Nc Application Request Request bit for the application software (PLC code), e.g. for an "Application Homing Request" 24-31 Status. Nc Cycle Counter NC cycle counter TE1000 Version: 2.15.4 123
## Page 124

Data types Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.1.5 NCTOPLC_AXIS_REF_STATE The structure NCTOPLC_AXIS_REF_STATE is part of the structure NCTOPLC_AXIS_REF [} 120]. TYPE NCTOPLC_AXIS_REF_STATE : DWORD; END_TYPE The individual items of information are provided in the status structure of the AXIS_REF at the following points: Bit Variable name Description 0 Status. Operational Axis is ready for operation 1 Status. Homed Axis is referenced ("axis calibrated") 2 Status. Not Moving Axis is logically stationary ("Axis not moving") 3 Status. In Position Area Axis is in position window (physical feedback) 4 Status. In Target Position Axis is at target position (PEH) (physical feedback) 5 Status. Protected Axis in protected operation mode (e.g. slave axis) 6 Status. Error Propagation Delayed Axis signals a preliminary error warning (from TC 2.11) 7 Status. Has Been Stopped Axis has been stopped or is presently executing a stop 8 Status. Has Job Axis has job, is executing job 9 Status. Positive Direction Axis moving to logically larger values 10 Status. Negative Direction Axis moving to logically smaller values 11 Status. Homing Busy Axis is referencing ("axis is being calibrated") 12 Status. Constant Velocity Axis has reached its constant velocity or rotary speed 13 Status. Compensating Section compensation passive[0]/active[1] (see MC_Move Super Imposed) 14 Status. Ext Set Point Gen Enabled Enable external setpoint generation 15 Operation mode not yet executed (Busy). Not yet released! 16 Status. External Latch Valid External latch value or measuring probe has become valid 17 Status. New Target Pos Axis has received a new end position or a new velocity 18 Axis not in target position or cannot/will not reach it (e.g. axis stop). Not yet released! 19 Status. Continuous Motion Axis executing endless positioning task 20 Status. Control Loop Closed Axis ready to operate and axis control loop closed (e.g. position control) 21 Status. Cam Table Queued New table ready for "Online Change" and waiting for activation 22 Status. Cam Data Queued Table data (MF) ready for "Online Change" and waiting for activation 23 Cam Scaling Pending Table scalings ready for "Online Change" and waiting for activation 24 Status. Cmd Buffered Follow-up command is available in the command buffer (see Buffer Mode) (from Twin CAT V2.10 Build 1311) 25 Status. PTPmode Axis in PTP operating mode (no slave, no NCI axis, no FIFO axis) (from TC 2.10 Build 1326) 26 Status. Soft Limit Min Exceeded Software minimum end position is active/occupied (from TC 2.10 Build 1327) 27 Status. Soft Limit Max Exceeded Software maximum end position is active/occupied (from TC 2.10 Build 1327) 124 Version: 2.15.4 TE1000
## Page 125

Data types Bit Variable name Description 28 Status. Drive Device Error Drive hardware has an error (no warning); interpretation possible only if drive is in I/O data exchange. e.g. Ether CAT "OP" state (from TC 2.10 Build 1326) 29 Status. Motion Commands Locked Axis is blocked for motion commands (Tc Mc2) 30 Status. Io Data Invalid IO data invalid (e.g. "Wc State" or "Cdl State" of the fieldbus) 31 Error Axis is in an error state Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.1.6 NCTOPLC_AXIS_REF_STATE2 The structure NCTOPLC_AXIS_REF_STATE2 is part of the structure NCTOPLC_AXIS_REF [} 120]. TYPE NCTOPLC_AXIS_REF_STATE2 : UNION Value : DWORD; Flags : NCTOPLC_AXIS_REF_STATE2_FLAGS; END_TYPE See also: NCTOPLC_AXIS_REF_STATE2_FLAGS [} 125] Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.1.7 NCTOPLC_AXIS_REF_STATE2_FLAGS The structure NCTOPLC_AXIS_REF_STATE2_FLAGS is part of the structure NCTOPLC_AXIS_REF_STATE2 [} 125]. TYPE NCTOPLC_AXIS_REF_STATE2_FLAGS : STRUCT Avoiding Collision : BIT; {attribute 'hide'} _reserved1 : BIT; {attribute 'hide'} _reserved2 : BIT; {attribute 'hide'} _reserved3 : BIT; {attribute 'hide'} _reserved4 : BIT; {attribute 'hide'} _reserved5 : BIT; {attribute 'hide'} _reserved6 : BIT; {attribute 'hide'} _reserved7 : BIT; {attribute 'hide'} _reserved8 : ARRAY [1..3] OF USINT; END_STRUCT; END_TYPE Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 TE1000 Version: 2.15.4 125
## Page 126

Data types 7.1.8 NCTOPLC_AXIS_REF_CAMCOUPLINGSTATE TYPE NCTOPLC_AXIS_REF_CAMCOUPLINGSTATE : STRUCT Cam Activation Pending : BIT; Cam Deactivation Pending : BIT; Cam Active : BIT; {attribute 'hide'} _reserved1 : BIT; {attribute 'hide'} _reserved2 : BIT; {attribute 'hide'} _reserved3 : BIT; Cam Data Queued : BIT; Cam Scaling Pending : BIT; END_STRUCT END_TYPE Bit Variable name Description 0 Cam Activation Pending Table waiting for activation 1 Cam Deactivation Pending Table waiting for deactivation 2 Cam Active Table is active 3-5 RESERVE 6 Cam Data Queued Table data (MF) ready for "Online Change" and waiting for activation 7 Cam Scaling Pending Table scalings ready for "Online Change" and waiting for activation Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4020 PC or CX (x86) Tc2_MC2 7.1.9 PLCTONC_AXIS_REF The data structure PLCTONC_AXIS_REF is part of the AXIS_REF [} 119] data structure and cyclically transfers information to the NC. PLCTONC_AXIS_REF is also referred to as axis interface between PLC and NC. TYPE PLCTONC_AXIS_REF STRUCT Control DWord : PLCTONC_AXIS_REF_CTRL; (* Control double word *) Override : UDINT; (* Velocity override *) Axis Mode Request : UDINT; (* Axis operating mode (PLC request) *) Axis Mode DWord : UDINT; (* optional mode parameter *) Axis Mode LReal : LREAL; (* optional mode parameter *) Position Correction : LREAL; (* Correction value for current position *) Ext Set Pos : LREAL; (* external position setpoint *) Ext Set Velo : LREAL; (* external velocity setpoint *) Ext Set Acc : LREAL; (* external acceleration setpoint *) Ext Set Direction : DINT; (* external direction setpoint *) {attribute 'hide'} _reserved1 : UDINT; (* reserved *) Ext Controller Output : LREAL; (* external controller output *) Gear Ratio1 : LREAL; (* Gear ratio for dynamic multi master coupling modes *) Gear Ratio2 : LREAL; (* Gear ratio for dynamic multi master coupling modes *) Gear Ratio3 : LREAL; (* Gear ratio for dynamic multi master coupling modes *) Gear Ratio4 : LREAL; (* Gear ratio for dynamic multi master coupling modes *) Map State : BOOL; (* reserved - internal use *) Plc Cycle Control : BYTE; Plc Cycle Count : BYTE; {attribute 'hide'} _reserved2 : ARRAY [1..5] OF USINT; Ext Torque : LREAL; {attribute 'hide'} _reserved3 : ARRAY [1..8] OF USINT; END_STRUCT END_TYPE 126 Version: 2.15.4 TE1000
## Page 127

Data types Variable name Data type Definition range Description Control DWord PLCTONC_AXSI_REF_CTR 0/1 Control double word L [} 127] Override UDINT 0...1000000 Velocity override (0% to 100%) Axis Mode Reque UDINT Axis operating mode. Only provided st for internal use! Axis Mode DWor UDINT Only provided for internal use! d Axis Mode LReal LREAL Only provided for internal use! Position Correcti LREAL Actual position correction value on Ext Set Pos LREAL External set position Ext Set Velo LREAL External set velocity Ext Set Acc LREAL External set acceleration Ext Set Direction DINT External set travel direction [-1,0,1] Ext Controller Out LREAL External controller output. Not yet put released! Gear Ratio1 LREAL ±∞ Gear ratio (coupling factor) 1 Gear Ratio2 LREAL ±∞ Gear ratio (coupling factor) 2 Gear Ratio3 LREAL ±∞ Gear ratio (coupling factor) 3 Gear Ratio4 LREAL ±∞ Gear ratio (coupling factor) 4 Map State BOOL Internal use only Plc Cycle Control BYTE Internal use only Plc Cycle Count BYTE Internal use only Ext Torque LREAL Torque for MC_Torque Control with "Continuous Update Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.1.10 PLCTONC_AXIS_REF_CTRL The structure PLCTONC_AXIS_REF_CTRL is part of the structure NCTOPLC_AXIS_REF [} 126]. TYPE PLCTONC_AXIS_REF_CTRL : DWORD; END_TYPE Bit Variable name Description 0 Enable Enable controller 1 Feed Enable Plus Feed enable plus 2 Feed Enable Minus Feed enable minus 3-4 - RESERVE 5 Homing Sensor Referencing cam or referencing sensor 6-7 - RESERVE 8 Accept Blocked Drive Accept blocking of the drive setpoint adoption (e.g. hardware end positions) from Twin CAT V2.10 Build 1311 9 Blocked Drive Detected User signal "Axis is blocked" (e.g. mechanical fixed stop). Not yet released! 10-29 - RESERVE 30 Plc Debug Flag PLC debug function. For internal use only! TE1000 Version: 2.15.4 127
## Page 128

Data types Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.2 Drive Operation Mode 7.2.1 E_Drive Operation Mode The data type E_Drive Operation Mode is used in conjunction with the function blocks MC_Read Drive Operation Mode [} 45] and MC_Write Drive Operation Mode [} 46] to read or set the currently active operation mode. This enum abstracts the switching between operating modes for Co E and So E drives. For Co E, switching between operating modes is triggered via the mapped object 0x6060 “Drive operation mode” and reported back to the nc via the mapped object 0x6061 “Drive operation mode display”. Mapping of these two objects is mandatory for the function. For So E, operating modes are switched via the mapped “Drive control word”. TYPE E_Drive Operation Mode : ( Drive Operation Mode_Default := 0, // default => reactivate the nc default op mode (if default mode is known!) // general operation modes Drive Operation Mode_Torque := 1, // Co E: CST = 10 cyclic synchronous torq ue mode / So E: torque/force control (1) Drive Operation Mode_Velo1 := 2, // Co E: CSV = 9 cyclic synchronous veloc ity mode / So E: velo control (2) with feedback 1 Drive Operation Mode_Velo2 := 3, // Co E: CSV2 = 16 cyclic synchronous vel ocity mode with feedback 2 Drive Operation Mode_Pos1 := 4, // Co E: CSP = 8 cyclic synchronous posit ion mode / So E: pos control (11) with feedback 1, lag less Drive Operation Mode_Pos2 := 5, // Co E: CSP2 = 15 cyclic synchronous pos ition mode with feedback 2 / So E: pos control (12) with feedback 2, lag less Drive Operation Mode_Torque And Commutation Angle := 6, // Co E: CSTCA = 11 cyclic synchronous to rque mode with commutation angle Drive Operation Mode_Velocity Mode := 34, // Co E: VL = 2 velocity mode Drive Operation Mode_Drive Based Homing := 38, // Co E: HM = 6 homing mode // special indirect index based operation modes (only for So E). In most cases the general operat ion modes shall be used Drive Operation Mode_Index0 := 100, // So E primary operation mode, s. S-0-00 32) Drive Operation Mode_Index1 := 101, // So E secondary operation mode 1, s. S- 0-0033) Drive Operation Mode_Index2 := 102, // So E secondary operation mode 2, s. S- 0-0034) Drive Operation Mode_Index3 := 103 // So E secondary operation mode 3, s. S-0 -0035) ) DINT; END_TYPE Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 128 Version: 2.15.4 TE1000
## Page 129

Data types 7.3 External setpoint generator 7.3.1 ST_Ext Set Point Enable Options TYPE ST_Ext Set Point Enable Options STRUCT Use Torque Offset : BOOL; END_STRUCT END_TYPE Name Type Description Use Torque Offset BOOL Must be set to TRUE if a Torque Offset is to be transferred to the drive controller cyclically using the MC_Ext Set Point Gen Feed With Torq ue function. 7.4 Gearing 7.4.1 E_Gear In Multi Master Sync Mode E_Gear In Multi Master Sync Mode defines the possible synchronization modes for axis coupling at MC_Gear In Multi Master [} 106], if the slave axis motion is limited in Advanced Slave Dynmaics mode (limitation of velocity, acceleration and jerk). TYPE E_Gear In Multi Master Sync Mode : ( VELOSYNC := 0, POSSYNC1 := 1, POSSYNC2 := 2 )INT; END_TYPE E_Gear In Multi Master Sync Mode Description VELOSYNC The slave axis and the master axes move with a synchronized velocity. In the case of a dynamic limitation, the slave establishes a position difference that is not caught up again. (Standard) POSSYNC1 The slave axis and the master axes move with synchronized velocity and position. In the case of a dynamic limitation, the slave establishes a position difference that is then caught up at a later time. Changes in the gear ratios during the journey are executed taking into account the dynamics. The position difference between master and slave resulting from this is not caught up. POSSYNC2 The slave axis and the master axes move with synchronized velocity and position. In the case of a dynamic limitation, the slave establishes a position difference that is then caught up at a later time. Changes in the gear ratios during the journey are immediately calculated internally and the slave continuously synchronizes itself to the new position. 7.4.2 ST_Gear In Dyn Options TYPE ST_Gear In Dyn Options STRUCT CCVmode : BOOL; END_STRUCT END_TYPE TE1000 Version: 2.15.4 129
## Page 130

Data types Name Type Description CCVmode BOOL Constant circumference velocity mode 7.4.3 ST_Gear In Multi Master Options The data structure extends the function block MC_Gear In Multi Master [} 106] with additional input parameters. TYPE ST_Gear In Multi Master Options : STRUCT Advanced Slave Dynamics : BOOL; Sync Mode : E_Gear In Multi Master Sync Mode; END_STRUCT END_TYPE Name Type Description Advanced Slave Dynamics BOOL Swaps the internal algorithm of the function block. This makes it possible to synchronize to masters already in motion. In this case, "Acceleration" and "Deceleration" should only be parameterized symmetrically. If jerk presets are too large, this is reduced to the extent that a change from zero to the parameterized acceleration / deceleration can take place in one NC cycle. The resolution of the acceleration / deceleration thus depends directly on the suitable parameterization of the jerk value. Sync Mode E_Gear In Multi Master Sync Mode The Sync Mode specifies how the axis coupling behaves if the [} 129] movement of the slave axis is limited in the Advanced Slave Dynamics mode (limitation of velocity, acceleration and jerk). (available from Twin CAT 3.1.4024.11) 7.4.4 ST_Gear In Options TYPE ST_Gear In Options STRUCT Slave Type : _E_Tc NC_Slave Types; END_STRUCT END_TYPE Name Type Description Slave Type _E_Tc NC_Slave Types not used 7.5 Homing 7.5.1 E_Encoder Reference Mode This data type is used in conjunction with the MC_Home [} 96] function block and the ... structure to select a reference mode other than the one set in the configuration on the encoder, if required. Type E_Encoder Reference Mode : ( ENCODERREFERENCEMODE_DEFAULT := 0, 130 Version: 2.15.4 TE1000
## Page 131

Data types ENCODERREFERENCEMODE_PLCCAM := 1, ENCODERREFERENCEMODE_HARDWARESYNC := 2, ENCODERREFERENCEMODE_HARDWARELATCHPOS := 3, ENCODERREFERENCEMODE_HARDWARELATCHNEG := 4, ENCODERREFERENCEMODE_SOFTWARESYNC := 5, ENCODERREFERENCEMODE_SOFTDRIVELATCHPOS := 6, ENCODERREFERENCEMODE_SOFTDRIVELATCHNEG := 7, )UDINT; END_TYPE 7.5.2 MC_Homing Mode This data type is used to parameterize the function block MC_Home [} 96]. TYPE MC_Homing Mode : ( MC_Default Homing, (* default homing as defined in the System Manager encoder parameters *) MC_Direct, (* Static Homing forcing position from user reference *) MC_Force Calibration, (* set the calibration flag without performing any motion or changing the p osition *) MC_Reset Calibration (* resets the calibration flag without performing any motion or changing th e position *) ); END_TYPE MC_Homing Mode Description MC_Default Homing Executes the default homing. MC_Direct Sets the axis position directly to Position without executing a movement. MC_Force Calibration Forces the state "Axis is calibrated". No movement takes place, and the position remains unchanged. MC_Reset Calibration Resets the calibration status of the axis. No movement takes place, and the position remains unchanged. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.5.3 ST_Homing Options The data structure extends the function block MC_Home [} 96] with additional input parameters. TYPE ST_Homing Options : STRUCT Clear Position Lag : BOOL; Search Direction : MC_Direction := MC_Direction. MC_Undefined_Direction; Search Velocity : LREAL; Sync Direction : MC_Direction := MC_Direction. MC_Undefined_Direction; Sync Velocity : LREAL; Reference Mode : E_Encoder Reference Mode := E_Encoder Reference Mode. ENCODERREFERENCEMODE_DEFAULT; END_STRUCT END_TYPE Name Type Default Description Clear Position Lag BOOL Only works if MC_Homing Mode [} 131] = MC_Direct. Can optionally be used to set the set and actual positions to the same value. In this case the lag error is cleared. Search Direction MC_Direction [} 136] MC_Undefined_Di The search of the calibration cam can rection be done in positive or negative direction of travel. If nothing is specified, the search is performed in the positive direction of travel. TE1000 Version: 2.15.4 131
## Page 132

Data types Name Type Default Description Search Velocity LREAL Axis velocity at which the calibration cam is searched. Sync Direction MC_Direction [} 136] MC_Undefined_Di The search of the sync pulse can be rection done in positive or negative direction of travel. If nothing is specified, the search is performed in the positive direction of travel. Sync Velocity LREAL Axis velocity at which the sync pulse is searched for. Reference Mode E_Encoder Reference Mode Parameterizes which signal is used for the sync pulse search. [} 130] 7.6 Motion 7.6.1 E_Jog Mode This data type is used in conjunction with the function block MC_Jog [} 98]. TYPE E_Jog Mode : ( MC_JOGMODE_STANDARD_SLOW, (* motion with standard jog parameters for slow motion *) MC_JOGMODE_STANDARD_FAST, (* motion with standard jog parameters for fast motion *) MC_JOGMODE_CONTINOUS, (* axis moves as long as the jog button is pressed using parameterized dyn amics *) MC_JOGMODE_INCHING, (* axis moves for a certain relative distance *) MC_JOGMODE_INCHING_MODULO (* axis moves for a certain relative distance - stop position is rounded to the distance value *) ); END_TYPE E_Jog Mode Description MC_JOGMODE_STANDARD_SLOW The axis moves as long as the signal at one of the jog inputs is TRUE. The "low velocity for manual functions" specified in the Twin CAT System Manager and standard dynamics are used. In this operation mode the position, velocity and dynamics data specified in the function block have no effect. MC_JOGMODE_STANDARD_FAST The axis moves as long as the signal at one of the jog inputs is TRUE. The "high velocity for manual functions" specified in the Twin CAT System Manager and standard dynamics are used. In this operation mode the position, velocity and dynamics data specified in the function block have no effect. MC_JOGMODE_CONTINOUS The axis moves as long as the signal at one of the jog inputs is TRUE. The velocity and dynamics data specified by the user are used. The position has no effect. MC_JOGMODE_INCHING The axis is moved with a rising edge at one of the jog inputs by a certain distance, which is defined via the "Position" input. The axis stops automatically, irrespective of the state of the jog inputs. A new movement step is only executed once a further rising edge is encountered. With each start the velocity and dynamics data specified by the user are used. MC_JOGMODE_INCHING_MODULO The axis is moved with a rising edge at one of the jog inputs by a certain distance, which is defined via the "Positions" input. The axis position will snap to an integer multiple of the position parameter. The axis stops automatically, irrespective of the state of the jog inputs. A new movement step is only executed once a further rising edge is encountered. With each start the velocity and dynamics data specified by the user are used. 132 Version: 2.15.4 TE1000
## Page 133

Data types Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.6.2 E_Position Type E_Position Type is used for external setpoint generation MC_Ext Set Point Gen Enable [} 40] to define how the given position is to be interpreted. TYPE E_Position Type : ( POSITIONTYPE_ABSOLUTE := 1, (*Absolute position*) POSITIONTYPE_RELATIVE (*Relative position*) ); END_TYPE E_Position Type Description POSITIONTYPE_ABSOLUTE Absolute position POSITIONTYPE_RELATIVE Relative position Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.6.3 MC_Buffer Mode This data type is used with various function blocks of the Motion Control library. Buffer Mode is used to specify how successive motion commands are to be processed. TYPE MC_Buffer Mode : ( MC_Aborting, MC_Buffered, MC_Blending Low, MC_Blending Previous, MC_Blending Next, MC_Blending High ); END_TYPE A second function block is always required to use the Buffer Mode. It is not possible to trigger a move function block with new parameters while it is active. See also: General rules for MC function blocks [} 14] Examples: In the following example, a move command is used to move an axis from position P to P and then to P . 0 1 2 The second command is issued during the movement to P , but before the braking ramp with different 1 Buffer Modes. The reference point for the different velocity profiles is always P . The mode specifies the 1 velocity v or v at this point. 1 2 TE1000 Version: 2.15.4 133
## Page 134

Data types Since the speed of the first command is lower than the second, the modes Blending Low/Blending Previous and Blending High/Blending Next have the same result. The difference in the next example is that the speed of the second command is lower than the first. Now, the modes Blending Low/Blending Next and Blending High/Blending Previous are equivalent. 134 Version: 2.15.4 TE1000
## Page 135

Data types The velocity profiles described here assume that the following command is issued in time, i.e. before the braking ramp of the first command. Otherwise, blending is implemented as best as possible. TE1000 Version: 2.15.4 135
## Page 136

Data types Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.6.4 MC_Direction This enumeration type contains the possible directions of movement for the function blocks MC_Move Velocity [} 79] and MC_Move Modulo [} 71]. TYPE MC_Direction : ( MC_Positive_Direction := 1, MC_Shortest_Way , MC_Negative_Direction, MC_Current_Direction, MC_Undefined_Direction := 128 ); END_TYPE MC_Direction Description MC_Positive_Direction Positive direction of movement MC_Shortest_Way Shortest way MC_Negative_Direction Negative direction of movement MC_Current_Direction Current direction of movement is maintained MC_Undefined_Direction Undefined direction of movement Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.6.5 ST_Move Options This data type contains optional settings for travel commands such as MC_Move Absolute [} 65] or MC_Halt [} 85]. TYPE ST_Move Options : STRUCT // Command activation at defined Activation Position // Extends the buffer mode when enabled Enable Blending Position : BOOL; Blending Position : LREAL; // Position Area Monitoring, Target Position Monitoring // and Stop Monitoring can be ignored using this flag Ignore Position Monitoring : BOOL; // Position Area Monitoring, Target Position Monitoring // can be enabled for MC_Stop and MC_Halt commands Enable Stop Position Monitoring : BOOL; END_STRUCT END_TYPE ST_Move Options Type Description Enable Blending Position BOOL This flag can be activated in order to define a different blending position for a command. In the normal case, the blending position is the target of the running command. With an active MC_Move Velocity [} 79], no target is defined at first. Blending Position LREAL Blending position used with active Enable Blending Position flag. 136 Version: 2.15.4 TE1000
## Page 137

Data types ST_Move Options Type Description Ignore Position Monitoring BOOL The target window monitor can be switched off for a single travel command with this flag. The target window monitor waits until the actual value is within a defined target window after reaching the target position. The target window monitor can be activated in the axis parameters. Enable Stop Position Monitoring BOOL MC_Stop [} 87] and MC_Halt [} 85] commands do not define a target position. However, a target window monitor can still be activated for these commands with this flag. The travel command then waits until the actual position of the axis is also within a defined window at the stopping position. The target window monitor must be activated in the axis parameters for this. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024 PC or CX (x86) Tc2_MC2 7.7 Nc Process Data 7.7.1 E_Nc Io Device TYPE E_Nc Io Device : ( Nc Io Device Drive := 0, Nc Io Device Encoder := 1 )INT; END_TYPE 7.7.2 E_Nc Io Output TYPE E_Nc Io Output : ( Nc Io Outputn Ctrl1 := 0, Nc Io Outputn Ctrl2 := 1, Nc Io Outputn Ctrl3 := 2, Nc Io Outputn Ctrl4 := 3, Nc Io Outputn Ctrl5 := 4, Nc Io Outputn Ctrl6 := 5, Nc Io Outputn Ctrl7 := 6, Nc Io Outputn Ctrl8 := 7, Nc Io Outputn Data Out1 := 8, Nc Io Outputn Data Out2 := 9, Nc Io Outputn Data Out3 := 10, Nc Io Outputn Data Out4 := 11, Nc Io Outputn Data Out5 := 12, Nc Io Outputn Data Out6 := 13 ); END_TYPE 7.8 Phasing 7.8.1 E_Phasing Type TYPE E_Phasing Type : ( NC_PHASINGTYPE_ABSOLUTE := 1, NC_PHASINGTYPE_RELATIVE := 2, NC_PHASINGTYPE_STOP := 4096 )UINT; END_TYPE TE1000 Version: 2.15.4 137
## Page 138

Data types 7.9 Position Correction 7.9.1 E_Axis Position Correction Mode TYPE E_Position Correction Mode: ( POSITIONCORRECTION_MODE_UNLIMITED, (* no limitation - pass correction immediately *) POSITIONCORRECTION_MODE_FAST, (* limitatation to maximum position change per cycle *) POSITIONCORRECTION_MODE_FULLLENGTH (* limitation uses full length to adapt to correction in smal l steps *) ); END_TYPE E_Axis Position Correction Mode Description POSITIONCORRECTION_MODE_UNLIMITED No filtering, the correction is executed immediately. Note that large changes in the correction value can lead to high accelerations. POSITIONCORRECTION_MODE_FAST The position correction is limited to the extent that a maximum acceleration is not exceeded. However, the correction is completely executed as fast as possible. POSITIONCORRECTION_MODE_FULLLENGTH The position correction is accomplished distributed over a distance of the axis (Correction Length). This results in smaller changes per time unit. 7.9.2 ST_Position Compensation Table Element TYPE ST_Position Compensation Table Element : STRUCT Position : LREAL; Compensation : LREAL; END_STRUCT END_TYPE Name Type Description Position LREAL Uncorrected position value (e.g. Set Pos) Compensation LREAL Additive compensation value 7.9.3 ST_Position Compensation Table Parameter TYPE ST_Position Compensation Table Parameter : STRUCT Min Position : LREAL; Max Position : LREAL; No Of Table Elements : UDINT; Direction : E_Work Direction := Work Direction Both; Modulo : BOOL; END_STRUCT END_TYPE Name Type Default Description Min Position LREAL Start position for position compensation Max Position LREAL End position for position compensation No Of Table Elements UDINT Number of table entries Direction E_Work Direction [} 143] Work Direction Both The position compensation is performed only in the selected direction. Modulo BOOL FALSE: linear axis TRUE: modulo axis with cyclic period 138 Version: 2.15.4 TE1000
## Page 139

Data types 7.10 Select Control Loop 7.10.1 E_Select Control Loop Type Defines how the function block MC_Select Control Loop [} 55] performs the control loop switching. Type E_Select Control Loop : ( Select Control Loop Type_Undefined, Select Control Loop Type_Standard, Select Control Loop Type_Internal Sync Value, Select Control Loop Type_User Sync Value )UDINT; END_TYPE E_Select Control Loop Description Select Control Loop Type_Undefined Not defined. Select Control Loop Type_Standard Simple switching (similar to an axis reset) Select Control Loop Type_Internal Sync Value Switching/synchronization by means of I/D-part of the controller to an internal initial value (jerk-free/ smooth). Select Control Loop Type_User Sync Value Switching/synchronization by means of I/D-part of the controller to a parameterizable initial value. 7.11 Status and parameter 7.11.1 E_Axis Error Codes Axis error codes and error codes that can be returned by the function blocks of Tc2_MC2 are defined in the enum E_Axis Error Codes. A description of the NC error codes can be found here. 7.11.2 E_Nc Axis Type Twin CAT supports different axis types, which are defined in the enum E_Nc Axis Type. TYPE E_Nc Axis Type ( Nc Axis Type_undefined := 0, Nc Axis Type_Continious := 1, Nc Axis Type_Discrete_Two Speed := 2, Nc Axis Type_Low Cost Stepper_Dig IO := 3, Nc Axis Type_Encoder := 5, Nc Axis Type_Hydraulic := 6, Nc Axis Type_Time Generator := 7, Nc Axis Type_Specific := 100 )DWORD; END_TYPE E_Nc Axis Type Description Nc Axis Type_undefined Nc Axis Type_Continious Continuous axis (also SERCOS) Nc Axis Type_Discrete_Two Speed Discrete axis (high/low speed) Nc Axis Type_Low Cost Stepper_Dig IO Stepper motor axis (without PWM terminal KL2502/30 and without pulse train KL2521) Nc Axis Type_Encoder Encoder axis Nc Axis Type_Hydraulic Continuous axis with operation mode switching for position/ pressure control Nc Axis Type_Time Generator Time Base Generator Nc Axis Type_Specific TE1000 Version: 2.15.4 139
## Page 140

Data types 7.11.3 E_Nc Drive Type Twin CAT supports different drives, these are defined in the enum E_Nc Drive Type. TYPE E_Nc Drive Type : ( Nc Drive Type_undefined := 0, Nc Drive Type_M2400_DAC1 := 1, Nc Drive Type_M2400_DAC2 := 2, Nc Drive Type_M2400_DAC3 := 3, Nc Drive Type_M2400_DAC4 := 4, Nc Drive Type_KL4xxx := 5, Nc Drive Type_KL4xxx_Non Linear := 6, Nc Drive Type_Discete_Two Speed := 7, Nc Drive Type_Stepper := 8, Nc Drive Type_Sercos := 9, Nc Drive Type_KL5051 := 10, Nc Drive Type_AX2000_B200 := 11, Nc Drive Type_Profil Drive := 12, Nc Drive Type_Universal := 13, Nc Drive Type_Nc Backplane := 14, Nc Drive Type_CANopen_Lenze := 15, Nc Drive Type_CANopen_DS402_MDP742 := 16, Nc Drive Type_AX2000_B900 := 17, Nc Drive Type_KL2531_Stepper := 20, Nc Drive Type_KL2532_DC := 21, Nc Drive Type_TCOM := 22, Nc Drive Type_MDP_733 := 23, Nc Drive Type_MDP_703 := 24 )DWORD; END_TYPE E_Nc Drive Type Description Nc Drive Type_undefined Nc Drive Type_M2400_DAC1 Nc Drive Type_M2400_DAC2 Nc Drive Type_M2400_DAC3 Nc Drive Type_M2400_DAC4 Nc Drive Type_KL4xxx MDP 252/253: KL4xxx, PWM KL2502_30K (Frq-Cnt pulse mode), KL4132 (16-bit), Pulse-Train KL2521, IP2512 Nc Drive Type_KL4xxx_Non Linear MDP 252/253: analog type for non-linear characteristics Nc Drive Type_Discete_Two Speed Nc Drive Type_Stepper Nc Drive Type_Sercos Nc Drive Type_KL5051 MDP 510: Bi SSI Drive KL5051 with 32 bits (see KL4xxx) Nc Drive Type_AX2000_B200 AX2000-B200 Lightbus, incremental with 32 bits (AX2000) Nc Drive Type_Profil Drive Incremental with 32 Bit Nc Drive Type_Universal Variable bit mask (max. 32 bits, signed value) Nc Drive Type_Nc Backplane Variable bit mask (max. 32 bits, signed value) Nc Drive Type_CANopen_Lenze CANopen Lenze (max. 32 bits, signed value) Nc Drive Type_CANopen_DS402_MDP742 MDP 742 (DS402): CANopen and Ether CAT (AX2000- B510, AX2000-B1x0, EL7201, AX8000) Nc Drive Type_AX2000_B900 AX2000-B900 Ethernet (max. 32 bits, signed value) Nc Drive Type_KL2531_Stepper Stepper motor terminal KL2531/KL2541 Nc Drive Type_KL2532_DC 2-channel DC motor stage KL2532/KL2542, 2-channel PWM DC motor stage KL2535/KL2545 Nc Drive Type_TCOM TCOM Drive -> Interface to Soft Drive Nc Drive Type_MDP_733 MDP 733: Modular Device Profile MDP 733 for DC (e.g. EL7332/EL7342) 140 Version: 2.15.4 TE1000
## Page 141

Data types E_Nc Drive Type Description Nc Drive Type_MDP_703 MDP 703: Modular Device Profile MDP 703 for stepper (e.g. EL7031/EL7041) 7.11.4 E_Nc Encoder Type Twin CAT supports different encoders, these are defined in the enum E_Nc Encoder Type. TYPE E_Nc Encoder Type : ( Nc Encoder Type_undefined, Nc Encoder Type_Simulation, Nc Encoder Type_ABS_M3000, Nc Encoder Type_INC_M31X0, Nc Encoder Type_INC_KL5101, Nc Encoder Type_ABS_KL5001_SSI, Nc Encoder Type_INC_KL5051, Nc Encoder Type_ABS_KL30XX, Nc Encoder Type_INC_Sercos_P, Nc Encoder Type_INC_Sercos_PV, Nc Encoder Type_INC_Binary, Nc Encoder Type_ABS_M2510, Nc Encoder Type_ABS_FOX50, Nc Encoder Type_HYDRAULIC_FORCE, Nc Encoder Type_AX2000_B200, Nc Encoder Type_PROFIDRIVE, Nc Encoder Type_UNIVERSAL, Nc Encoder Type_NCBACKPLANE, Nc Encoder Type_CANOPEN_LENZE, Nc Encoder Type_CANOPEN_DS402_MDP513_MDP742, Nc Encoder Type_AX2000_B900, Nc Encoder Type_KL5151, Nc Encoder Type_IP5209, Nc Encoder Type_KL2531_Stepper, Nc Encoder Type_KL2532_DC, Nc Encoder Type_TIMEBASEGENERATOR, Nc Encoder Type_INC_TCOM, Nc Encoder Type_CANOPEN_MDP513_64BIT, Nc Encoder Type_SPECIFIC )DWORD; END_TYPE E_Nc Encoder Type Description Nc Encoder Type_undefined Nc Encoder Type_Simulation Simulation Nc Encoder Type_ABS_M3000 Absolute, with 24 or 25 bits, and 12 and 13 bits single turn encoders (M3000) Nc Encoder Type_INC_M31X0 Incremental, with 24 bits (M31x0, M3200, M3100, M2000) Nc Encoder Type_INC_KL5101 MDP 511: Incremental with 16 bits and latch (MDP511: EL7041, EL5101, EL5151, EL2521, EL5021(Sin Cos); KL5101, IP5109, KL5111) Nc Encoder Type_ABS_KL5001_SSI MDP 500/501: Absolute SSI with 24 bits (KL5001, IP5009) (MDP 501: EL5001) Nc Encoder Type_INC_KL5051 MDP 510: Absolute/Incremental Bi SSI with 16 bits (KL5051, PWM KL2502_30K(Frq-Cnt pulse mode), Pulse-Train KL2521, IP2512) Nc Encoder Type_ABS_KL30XX Absolute analog input with 16 bits (KL30xx) Nc Encoder Type_INC_Sercos_P SERCOS "Encoder" position Nc Encoder Type_INC_Sercos_PV SERCOS "Encoder" position and velocity Nc Encoder Type_INC_Binary Binary incremental encoders (0/1) Nc Encoder Type_ABS_M2510 Absolute analog input with 12 bits (M2510) Nc Encoder Type_ABS_FOX50 T&R Fox 50 module (24 bits absolute (SSI)) Nc Encoder Type_HYDRAULIC_FORCE MMW type: force acquisition from Pa, Pb, Aa, Ab TE1000 Version: 2.15.4 141
## Page 142

Data types E_Nc Encoder Type Description Nc Encoder Type_AX2000_B200 Incremental AX2000-B200 Lightbus with 16/20 bits (AX2000) Nc Encoder Type_PROFIDRIVE Incremental with 32 Bit Nc Encoder Type_UNIVERSAL Incremental with variable bit mask (max. 32 bits) Nc Encoder Type_NCBACKPLANE Incremental NC backplane Nc Encoder Type_CANOPEN_LENZE Incremental CANopen Lenze Nc Encoder Type_CANOPEN_DS402_MDP513_M MDP 513 / MDP 742 (DS402): CANopen and Ether CAT DP742 (AX2000-B510, AX2000-B1x0, EL7201, EL5032/32 Bit) Nc Encoder Type_AX2000_B900 Incremental AX2000-B900 Ethernet Nc Encoder Type_KL5151 Incremental with 16-bit counter and int. + ext 32-bit latch (KL5151_0000) (only switchable), the 2-channel KL5151_0050 has no latch. Nc Encoder Type_IP5209 Incremental with 16-bit counter and int. 32-bit latch (IP5209) Nc Encoder Type_KL2531_Stepper Incremental with 16-bit counter and int. + ext. 15-bit latch (only switchable) (stepper motor terminal KL2531/ KL2541) Nc Encoder Type_KL2532_DC Incremental with 16-bit counter and ext. 16-bit latch (only switchable) (2-channel DC motor output stage KL2532/ KL2542), 2-channel PWM DC motor output stage KL2535/KL2545 Nc Encoder Type_TIMEBASEGENERATOR Time Base Generator Nc Encoder Type_INC_TCOM TCOM Encoder -> Interface to Soft Drive Encoder Nc Encoder Type_CANOPNE_MDP513_64BIT MDP 513 (DS402, En Dat2.2, 64 Bit): EL5032/64 Bit Nc Encoder Type_SPECIFIC 7.11.5 E_Read Mode This data type is used in conjunction with the function blocks MC_Read Parameter [} 27] and MC_Read Bool Parameter [} 25] to specify a single or cyclic operation. TYPE E_Read Mode : ( READMODE_ONCE := 1, READMODE_CYCLIC ); END_TYPE Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.11.6 E_Set Scaling Factor Mode The E_Set Scaling Factor Mode enum is used in conjunction with the function block MC_Set Encoder Scaling Factor [} 57] to change the scaling factor of the active encoder. TYPE E_Set Scaling Factor Mode : ( ENCODERSCALINGMODE_ABSOLUTE, ENCODERSCALINGMODE_RELATIVE )UINT; END_TYPE E_Set Scaling Factor Mode Description ENCODERSCALINGMODE_ABSOL UTE 142 Version: 2.15.4 TE1000
## Page 143

Data types E_Set Scaling Factor Mode Description ENCODERSCALINGMODE_RELATI VE 7.11.7 E_Work Direction The enum E_Work Direction is used to specify a work direction for a command. TYPE E_Work Direction : ( Work Direction None := 0, Work Direction Both := 1, Work Direction Positive := 2, Work Direction Negative := 3 )INT; END_TYPE E_Work Direction Description Work Direction None No direction specification Work Direction Both Positive and negative work direction Work Direction Positive Positive work direction Work Direction Negative Negative work direction 7.11.8 MC_Axis Parameter This data type is used in conjunction with function blocks for reading and writing axis parameters. TYPE MC_Axis Parameter : ( (* PLCopen specific parameters *) (* Index-Group 0x4000 + ID*) Commanded Position := 1, (* lreal *) (* taken from Nc To Plc *) SWLimit Pos, (* lreal *) (* Index Offset= 16#0001_000E *) SWLimit Neg, (* lreal *) (* Index Offset= 16#0001_000D *) Enable Limit Pos, (* bool *) (* Index Offset= 16#0001_000C *) Enable Limit Neg, (* bool *) (* Index Offset= 16#0001_000B *) Enable Pos Lag Monitoring, (* bool *) (* Index Offset= 16#0002_0010 *) Max Position Lag, (* lreal *) (* Index Offset= 16#0002_0012 *) Max Velocity System, (* lreal *) (* Index Offset= 16#0000_0027 *) Max Velocity Appl, (* lreal *) (* Index Offset= 16#0000_0027 *) Actual Velocity, (* lreal *) (* taken from Nc To Plc *) Commanded Velocity, (* lreal *) (* taken from Nc To Plc *) Max Acceleration System, (* lreal *) (* Index Offset= 16#0000_0101 *) Max Acceleration Appl, (* lreal *) (* Index Offset= 16#0000_0101 *) Max Deceleration System, (* lreal *) (* Index Offset= 16#0000_0102 *) Max Deceleration Appl, (* lreal *) (* Index Offset= 16#0000_0102 *) Max Jerk System, (* lreal *) (* Index Offset= 16#0000_0103 *) Max Jerk Appl, (* lreal *) (* Index Offset= 16#0000_0103 *) (* Beckhoff specific parameters *) (* Index-Group 0x4000 + ID*) Axis Id := 1000, (* lreal *) (* Index Offset= 16#0000_0001 *) Axis Velo Man Slow, (* lreal *) (* Index Offset= 16#0000_0008 *) Axis Velo Man Fast, (* lreal *) (* Index Offset= 16#0000_0009 *) Axis Velo Max, (* lreal *) (* Index Offset= 16#0000_0027 *) Axis Acc, (* lreal *) (* Index Offset= 16#0000_0101 *) Axis Dec, (* lreal *) (* Index Offset= 16#0000_0102 *) Axis Jerk, (* lreal *) (* Index Offset= 16#0000_0103 *) Max Jerk, (* lreal *) (* Index Offset= 16#0000_0103 *) Axis Max Velocity, (* lreal *) (* Index Offset= 16#0000_0027 *) Axis Rapid Traverse Velocity, (* lreal *) (* Index Offset= 16#0000_000A *) Axis Manual Velocity Fast, (* lreal *) (* Index Offset= 16#0000_0009 *) Axis Manual Velocity Slow, (* lreal *) (* Index Offset= 16#0000_0008 *) Axis Calibration Velocity Forward, (* lreal *) (* Index Offset= 16#0000_0006 *) Axis Calibration Velocity Backward, (* lreal *) (* Index Offset= 16#0000_0007 *) Axis Jog Increment Forward, (* lreal *) (* Index Offset= 16#0000_0018 *) Axis Jog Increment Backward, (* lreal *) (* Index Offset= 16#0000_0019 *) Axis En Min Soft Pos Limit, (* bool *) (* Index Offset= 16#0001_000B *) Axis Min Soft Pos Limit, (* lreal *) (* Index Offset= 16#0001_000D *) Axis En Max Soft Pos Limit, (* bool *) (* Index Offset= 16#0001_000C *) Axis Max Soft Pos Limit, (* lreal *) (* Index Offset= 16#0001_000E *) Axis En Position Lag Monitoring, (* bool *) (* Index Offset= 16#0002_0010 *) Axis Max Pos Lag Value, (* lreal *) (* Index Offset= 16#0002_0012 *) Axis Max Pos Lag Filter Time, (* lreal *) (* Index Offset= 16#0002_0013 *) Axis En Position Range Monitoring, (* bool *) (* Index Offset= 16#0000_000F *) TE1000 Version: 2.15.4 143
## Page 144

Data types Axis Position Range Window, (* lreal *) (* Index Offset= 16#0000_0010 *) Axis En Target Position Monitoring, (* bool *) (* Index Offset= 16#0000_0015 *) Axis Target Position Window, (* lreal *) (* Index Offset= 16#0000_0016 *) Axis Target Position Monitoring Time, (* lreal *) (* Index Offset= 16#0000_0017 *) Axis En In Target Timeout, (* bool *) (* Index Offset= 16#0000_0029 *) Axis In Target Timeout, (* lreal *) (* Index Offset= 16#0000_002A *) Axis En Motion Monitoring, (* bool *) (* Index Offset= 16#0000_0011 *) Axis Motion Monitoring Window, (* lreal *) (* Index Offset= 16#0000_0028 *) Axis Motion Monitoring Time, (* lreal *) (* Index Offset= 16#0000_0012 *) Axis Delay Time Velo Position, (* lreal *) (* Index Offset= 16#0000_0104 *) Axis En Looping Distance, (* bool *) (* Index Offset= 16#0000_0013 *) Axis Looping Distance, (* lreal *) (* Index Offset= 16#0000_0014 *) Axis Backlash, (* lreal *) (* Index Offset= 16#0000_002C *) Axis En Data Persistence, (* bool *) (* Index Offset= 16#0000_0030 *) Axis Ref Velo On Ref Output, (* lreal *) (* Index Offset= 16#0003_0101 *) Axis Override Type, (* lreal *) (* Index Offset= 16#0000_0105 *) (* new since 4/2007 *) Axis Encoder Scaling Factor, (* lreal *) (* Index Offset= 16#0001_0006 *) Axis Encoder Offset, (* lreal *) (* Index Offset= 16#0001_0007 *) Axis Encoder Direction Inverse, (* bool *) (* Index Offset= 16#0001_0008 *) Axis Encoder Mask, (* dword *) (* Index Offset= 16#0001_0015 *) Axis Encoder Modulo Value, (* lreal *) (* Index Offset= 16#0001_0009 *) Axis Modulo Tolerance Window, (* lreal *) (* Index Offset= 16#0001_001B *) Axis Enable Pos Correction, (* bool *) (* Index Offset= 16#0001_0016 *) Axis Pos Correction Filter Time, (* lreal *) (* Index Offset= 16#0001_0017 *) (* new since 1/2010 *) Axis Unit Interpretation, (* lreal *) (* Index Offset= 16#0000_0026 *) Axis Motor Direction Inverse, (* bool *) (* Index Offset= 16#0003_0006 *) (* new since 1/2011 *) Axis Cycle Time, (* lreal *) (* Index Offset= 16#0000_0004 *) (* new since 5/2011 *) Axis Fast Stop Signal Type, (* dword *) (* Index Offset= 16#0000_001E *) Axis Fast Acc, (* lreal *) (* Index Offset= 16#0000_010A *) Axis Fast Dec, (* lreal *) (* Index Offset= 16#0000_010B *) Axis Fast Jerk, (* lreal *) (* Index Offset= 16#0000_010C *) (* new since 1/2012 *) Axis Encoder Scaling Numerator, (* lreal *) (* Index Offset= 16#0001_0023 - available in Tc3 *) Axis Encoder Scaling Denominator, (* lreal *) (* Index Offset= 16#0001_0024 - available in Tc3 *) (* new since 7/2016 *) Axis Maximum Acceleration, (* lreal *) (* Index Offset= 16#0000_00F1 - available in Tc3 *) Axis Maximum Deceleration, (* lreal *) (* Index Offset= 16#0000_00F2 - available in Tc3 *) Axis Velo Jump Factor, (* lreal *) (* Index Offset= 16#0000_0106 *) Axis Tolerance Ball Aux Axis, (* lreal *) (* Index Offset= 16#0000_0108 *) Axis Max Position Deviation Aux Axis, (* lreal *) (* Index Offset= 16#0000_0109 *) Axis Error Propagation Mode, (* dword *) (* Index Offset= 16#0000_001A *) Axis Error Propagation Delay, (* lreal *) (* Index Offset= 16#0000_001B *) Axis Couple Slave To Actual Values, (* bool *) (* Index Offset= 16#0000_001C *) Axis Allow Motion Cmd To Slave Axis, (* bool *) (* Index Offset= 16#0000_0020 *) Axis Allow Motion Cmd To Ext Set Axis, (* bool *) (* Index Offset= 16#0000_0021 *) Axis Encoder Sub Mask, (* dword *) (* Index Offset= 16#0001_0108 *) Axis Encoder Reference System, (* dword *) (* Index Offset= 16#0001_0019 *) Axis Encoder Position Filter PT1, (* lreal *) (* Index Offset= 16#0001_0010 *) Axis Encoder Velocity Filter PT1, (* lreal *) (* Index Offset= 16#0001_0011 *) Axis Encoder Acceleration Filter PT1, (* lreal *) (* Index Offset= 16#0001_0012 *) Axis Encoder Mode, (* dword *) (* Index Offset= 16#0001_000A *) Axis Encoder Homing Inv Dir Cam Search, (* bool *) (* Index Offset= 16#0001_0101 *) Axis Encoder Homing Inv Dir Sync Search, (* bool *) (* Index Offset= 16#0001_0102 *) Axis Encoder Homing Calib Value, (* lreal *) (* Index Offset= 16#0001_0103 *) Axis Encoder Reference Mode, (* dword *) (* Index Offset= 16#0001_0107 *) Axis Ref Velo Output Ratio, (* lreal *) (* Index Offset= 16#0003_0102 *) Axis Drive Position Output Scaling, (* lreal *) (* Index Offset= 16#0003_0109 *) Axis Drive Velocity Output Scaling, (* lreal *) (* Index Offset= 16#0003_0105 *) Axis Drive Velocity Output Delay, (* lreal *) (* Index Offset= 16#0003_010D *) Axis Drive Min Output Limitation, (* lreal *) (* Index Offset= 16#0003_000B *) Axis Drive Max Output Limitation, (* lreal *) (* Index Offset= 16#0003_000C *) Axis Torque Input Scaling, (* lreal *) (* Index Offset= 16#0003_0031 - available in Tc3 *) Axis Torque Input Filter PT1, (* lreal *) (* Index Offset= 16#0003_0032 - available in Tc3 *) Axis Torque Derivation Input Filter PT1, (* lreal *) (* Index Offset= 16#0003_0033 - available in Tc3 *) Axis Torque Output Scaling, (* lreal *) (* Index Offset= 16#0003_010B *) Axis Torque Output Delay, (* lreal *) (* Index Offset= 16#0003_010F *) Axis Acceleration Output Scaling, (* lreal *) (* Index Offset= 16#0003_010A *) Axis Acceleration Output Delay, (* lreal *) (* Index Offset= 16#0003_010E *) Axis Drive Pos Output Smooth Filter Type, (* dword *) (* Index Offset= 16#0003_0110 *) Axis Drive Pos Output Smooth Filter Time, (* lreal *) (* Index Offset= 16#0003_0111 *) Axis Drive Pos Output Smooth Filter Order,(* dword *) (* Index Offset= 16#0003_0112 *) Axis Drive Mode, (* dword *) (* Index Offset= 16#0003_000A *) Axis Drift Compensation Offset, (* lreal *) (* Index Offset= 16#0003_0104 *) Axis Position Control Kv, (* lreal *) (* Index Offset= 16#0002_0102 *) Axis Ctrl Velocity Pre Ctrl Weight, (* lreal *) (* Index Offset= 16#0002_000B *) Axis Controller Mode, (* dword *) (* Index Offset= 16#0002_000A *) 144 Version: 2.15.4 TE1000
## Page 145

Data types Axis Ctrl Auto Offset, (* bool *) (* Index Offset= 16#0002_0110 *) Axis Ctrl Auto Offset Timer, (* lreal *) (* Index Offset= 16#0002_0115 *) Axis Ctrl Auto Offset Limit, (* lreal *) (* Index Offset= 16#0002_0114 *) Axis Slave Coupling Control Kcp, (* lreal *) (* Index Offset= 16#0002_010F *) Axis Ctrl Output Limit, (* lreal *) (* Index Offset= 16#0002_0100 *) (* Beckhoff specific axis status information - READ ONLY *) (* Index-Group 0x4100 + ID*) Axis Target Position := 2000, (* lreal *) (* Index Offset= 16#0000_0013 *) Axis Remaining Time To Go, (* lreal *) (* Index Offset= 16#0000_0014 *) Axis Remaining Distance To Go, (* lreal *) (* Index Offset= 16#0000_0022, 16#0000_0042 *) Axis Mc Set Position Offset, (* lreal *) (* Index Offset= 16#00n1_0017 *) (* Beckhoff specific axis functions *) (* read/write gear ratio of a slave *) Axis Gear Ratio := 3000, (* lreal *) (* read: Index Group=0x4100+ID, Idx Offset=16#0000_00 22, *) (* write:Index Group=0x4200+ID, Idx Offset=16#0000_0042 *) (* Beckhoff specific other parameters *) (* new since 1/2011 *) Nc Saf Cycle Time := 4000, (* lreal *) (* Index Offset= 16#0000_0010 *) Nc Svb Cycle Time (* lreal *) (* Index Offset= 16#0000_0012 *) ); END_TYPE The Axis Gear Ratio parameter can only be read or written if the axis is coupled as a slave. Only very small changes are allowed during motion. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.11.9 MC_Axis States This data type describes the operating states according to the Plc Open state diagram [} 11]. TYPE MC_Axis States : ( MC_AXISSTATE_UNDEFINED, MC_AXISSTATE_DISABLED, MC_AXISSTATE_STANDSTILL, MC_AXISSTATE_ERRORSTOP, MC_AXISSTATE_STOPPING, MC_AXISSTATE_HOMING, MC_AXISSTATE_DISCRETEMOTION, MC_AXISSTATE_CONTINOUSMOTION, MC_AXISSTATE_SYNCHRONIZEDMOTION ); END_TYPE See also: General rules for MC function blocks [} 14]. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.11.10 ST_Axis Components TYPE ST_Axis Components STRUCT Encoder IDs : ARRAY[1..9] OF DWORD; Controller IDs : ARRAY[1..9] OF DWORD; Drive IDs : ARRAY[1..9] OF DWORD; END_STRUCT END_TYPE TE1000 Version: 2.15.4 145
## Page 146

Data types 7.11.11 ST_Axis Op Modes This data type contains information about the parameterization of the operation modes of an axis. TYPE ST_Axis Op Modes : STRUCT Position Area Monitoring : BOOL; (* bit 0 - Op Mode DWord *) Target Position Monitoring : BOOL; (* bit 1 - Op Mode DWord *) Loop Mode : BOOL; (* bit 2 - Op Mode DWord - loop mode for two speed axes *) Motion Monitoring : BOOL; (* bit 3 - Op Mode DWord *) PEHTime Monitoring : BOOL; (* bit 4 - Op Mode DWord *) Backlash Compensation : BOOL; (* bit 5 - Op Mode DWord *) Delayed Error Reaction : BOOL; (* bit 6 - Op Mode DWord *) Modulo : BOOL; (* bit 7 - Op Mode DWord - axis is parameterized as modulo axis *) Simulation Axis : BOOL; (* bit 8 - Op Mode DWord *) Position Lag Monitoring : BOOL; (* bit 16 - Op Mode DWord *) Velocity Lag Monitoring : BOOL; (* bit 17 - Op Mode DWord *) Soft Limit Min Monitoring : BOOL; (* bit 18 - Op Mode DWord *) Soft Limit Max Monitoring : BOOL; (* bit 19 - Op Mode DWord *) Position Correction : BOOL; (* bit 20 - Op Mode DWord *) Allow Slave Commands : BOOL; (* bit 21 - Op Mode DWord *) Allow Ext Set Axis Commands : BOOL; (* bit 22 - Op Mode DWord *) END_STRUCT END_TYPE Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.11.12 ST_Axis Parameter Set This data type contains the entire parameter data set of an axis that can be read with the MC_Read Parameter Set [} 28] function block. Individual parameters that can be changed during runtime can be written with MC_Write Parameter [} 32]. It is not possible to write back the parameter dataset as a whole. The individual parameters are described in the NC ADS documentation. TYPE ST_Axis Parameter Set : STRUCT (* AXIS: *) Axis Id : DWORD; (* 0x00000001 *) n Axis Type : E_Nc Axis Type; (* 0x00000003 *) s Axis Name : STRING(31); (* 0x00000002 *) f Axis Cycle Time : LREAL; (* 0x00000004 *) b Enable Position Area Control : WORD; (* 0x0000000F *) f Position Area Control Range : LREAL; (* 0x00000010 *) b Enable Motion Control : WORD; (* 0x00000011 *) f Motion Control Time : LREAL; (* 0x00000012 *) b Enable Loop : WORD; (* 0x00000013 *) f Loop Distance : LREAL; (* 0x00000014 *) b Enable Target Pos Control : WORD; (* 0x00000015 *) f Target Pos Control Range : LREAL; (* 0x00000016 *) f Target Pos Control Time : LREAL; (* 0x00000017 *) f Velo Maximum : LREAL; (* 0x00000027 *) f Ref Velo Search : LREAL; (* 0x00000006 *) f Ref Velo Sync : LREAL; (* 0x00000007 *) f Velo Slow Manual : LREAL; (* 0x00000008 *) f Velo Fast Manual : LREAL; (* 0x00000009 *) f Motion Control Range : LREAL; (* 0x00000028 *) b Enable PEHTime Control : WORD; (* 0x00000029 *) f PEHControl Time : LREAL; (* 0x0000002A *) b Enable Backlash Compensation : WORD; (* 0x0000002B *) f Backlash : LREAL; (* 0x0000002C *) s Ams Net Id : T_Ams Net Id; (* 0x00000031 *) n Port : WORD; (* 0x00000031 *) n Chn No : WORD; (* 0x00000031 *) f Acceleration : LREAL; (* 0x00000101 *) f Deceleration : LREAL; (* 0x00000102 *) f Jerk : LREAL; (* 0x00000103 *) 146 Version: 2.15.4 TE1000
## Page 147

Data types (* ENCODER: *) n Enc Id : DWORD; (* 0x00010001 *) n Enc Type : E_Nc Encoder Type;(* 0x00010003 *) s Enc Name : STRING(31); (* 0x00010002 *) f Enc Scale Factor Numerator : LREAL; (* 0x00010023 *) f Enc Scale Factor Denominator : LREAL; (* 0x00010024 *) f Enc Scale Factor : LREAL; (* 0x00010006 *) f Enc Offset : LREAL; (* 0x00010007 *) b Enc Is Inverse : WORD; (* 0x00010008 *) f Enc Modulo Factor : LREAL; (* 0x00010009 *) n Enc Mode : DWORD; (* 0x0001000A *) b Enc Enable Soft End Min Control : WORD; (* 0x0001000B *) b Enc Enable Soft End Max Control : WORD; (* 0x0001000C *) f Enc Soft End Min : LREAL; (* 0x0001000D *) f Enc Soft End Max : LREAL; (* 0x0001000E *) n Enc Max Increment : DWORD; (* 0x00010015 *) n Enc Ref Soft Sync Mask : DWORD; (* 0x00010108 *) b Enc Enable Pos Correction : WORD; (* 0x00010016 *) n Enc Reference System : DWORD; (* 0x00010019 *) f Enc Pos Correction Filter Time : LREAL; (* 0x00010017 *) b Enc Ref Search Inverse : UINT; (* 0x00010101 *) b Enc Ref Sync Inverse : UINT; (* 0x00010102 *) n Enc Ref Mode : UDINT; (* 0x00010107 *) f Enc Ref Position : LREAL; (* 0x00010103 *) (* CONTROLLER: *) n Ctrl Id : DWORD; (* 0x00020001 *) n Ctrl Type : DWORD; (* 0x00020003 *) s Ctrl Name : STRING(31); (* 0x00020002 *) b Ctrl Enable Pos Diff Control : WORD; (* 0x00020010 *) b Ctrl Enable Velo Diff Control : WORD; (* 0x00020011 *) f Ctrl Pos Diff Max : LREAL; (* 0x00020012 *) f Ctrl Pos Diff Max Time : LREAL; (* 0x00020013 *) f Ctrl Pos Kp : LREAL; (* 0x00020102 *) f Ctrl Pos Tn : LREAL; (* 0x00020103 *) f Ctrl Pos Tv : LREAL; (* 0x00020104 *) f Ctrl Pos Td : LREAL; (* 0x00020105 *) f Ctrl Pos Ext Kp : LREAL; (* 0x00020106 *) f Ctrl Pos Ext Velo : LREAL; (* 0x00020107 *) f Ctrl Acc Ka : LREAL; (* 0x00020108 *) (* DRIVE: *) n Drive Id : DWORD; (* 0x00030001 *) n Drive Type : E_Nc Drive Type;(* 0x00030003 *) s Drive Name : STRING(31); (* 0x00030002 *) b Drive Is Inverse : WORD; (* 0x00030006 *) n Drive Control DWord : DWORD; (* 0x00030010 *) f Drive Velo Referenz : LREAL; (* 0x00030101 *) f Drive Output Referenz : LREAL; (* 0x00030102 *) f Drive Output Scaling Acc : LREAL; (* 0x0003000A *) f Drive Output Scaling Torque : LREAL; (* 0x0003000B *) f Drive Input Scaling Torque : LREAL; (* 0x00030031 *) f Drive Input Filtertime Torque : LREAL; (* 0x00030032 *) f Drive Input Filtertime Torque Derivative: LREAL;(* 0x00030033 *) f Acceleration Max : LREAL; (* 0x000300F1 *) f Deceleration Max : LREAL; (* 0x000300F2 *) END_STRUCT END_TYPE Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.11.13 ST_Axis Status This data type contains extensive status information about an axis. The data structure must be updated in each PLC cycle by calling MC_Read Status [} 29] or by calling the action Axis. Read Status() (AXIS_REF [} 119]). TYPE ST_Axis Status : STRUCT Update Task Index : BYTE; (* Task-Index of the task that updated this data set *) Update Cycle Time : LREAL; (* task cycle time of the task which calls the status function TE1000 Version: 2.15.4 147
## Page 148

Data types *) Cycle Counter : UDINT; (* PLC cycle counter when this data set updated *) Nc Cycle Counter : UDINT; (* NC cycle counter incremented after NC task updated Nc To Plc data structures *) Motion State : MC_Axis States; (* motion state in the PLCopen state diagram *) Error : BOOL; (* axis error state *) Error Id : UDINT; (* axis error code *) (* PLCopen motion control statemachine states: *) Error Stop : BOOL; Disabled : BOOL; Stopping : BOOL; Stand Still : BOOL; Discrete Motion : BOOL; Continuous Motion : BOOL; (* State DWord bit 19 *) Synchronized Motion : BOOL; Homing : BOOL; (* additional status - (PLCopen definition)*) Constant Velocity : BOOL; (* State DWord bit 12 *) Accelerating : BOOL; Decelerating : BOOL; (* Axis. Nc To Plc. State DWord *) Operational : BOOL; (* State DWord bit 0 *) Control Loop Closed : BOOL; (* State DWord bit 20 - operational and position control active *) Has Job : BOOL; (* State DWord bit 8 *) Has Been Stopped : BOOL; (* State DWord bit 7 *) New Target Position : BOOL; (* State DWord bit 17 *- * new target position commanded during move *) In Position Area : BOOL; (* State DWord bit 3 *) In Target Position : BOOL; (* State DWord bit 4 *) Protected Mode : BOOL; (* State DWord bit 5 *) Homed : BOOL; (* State DWord bit 1 *) Homing Busy : BOOL; (* State DWord bit 11 *) Motion Commands Locked : BOOL; (* State DWord bit 29 *-* stop 'n hold *) Soft Limit Min Exceeded : BOOL; (* State DWord bit 26 *-* reverse soft travel limit exceeded *) Soft Limit Max Exceeded : BOOL; (* State DWord bit 27 *-* forward soft travel limit exceeded *) Moving : BOOL; (* State DWord bit 9 or 10 *) Positive Direction : BOOL; (* State DWord bit 9 *) Negative Direction : BOOL; (* State DWord bit 10 *) Not Moving : BOOL; (* State DWord bit 2 *) Compensating : BOOL; (* State DWord bit 13 *-* superposition - overlayed motion *) Ext Set Point Gen Enabled : BOOL; (* State DWord bit 14 *) Phasing Active : BOOL; (* State DWord bit 15 *) External Latch Valid : BOOL; (* State DWord bit 16 *) Cam Data Queued : BOOL; (* State DWord bit 22 *) Cam Table Queued : BOOL; (* State DWord bit 21 *) Cam Scaling Pending : BOOL; (* State DWord bit 23 *) Cmd Buffered : BOOL; (* State DWord bit 24 *) PTPmode : BOOL; (* State DWord bit 25 *) Drive Device Error : BOOL; (* State DWord bit 28 *) Io Data Invalid : BOOL; (* State DWord bit 30 *) Error Propagation Delayed : BOOL; (* State DWord bit 6 *) Drive Limit Active : BOOL; (* State DWord bit 18 *) (* Axis. Nc To Plc. Couple State *) Coupled : BOOL; (* axis operation mode feedback from Nc To Plc *) Op Mode : ST_Axis Op Modes; Nc Application Request : BOOL; (* Op Mode DWord bit 23 *) END_STRUCT END_TYPE Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 148 Version: 2.15.4 TE1000
## Page 149

Data types 7.11.14 ST_Drive Address This data type contains the ADS access data of a drive device. The data is read with the function block MC_Read Drive Address [} 54]. TYPE ST_Drive Address : STRUCT Net ID : T_Ams Net Id; (* AMS Net ID of the drive as a string *) Net Id Bytes : T_Ams Net Id Arr; (* AMS Net ID of the drive as a byte array (same informatio n as Net ID) *) Slave Address : T_Ams Port; (* slave address of the drive connected to a bus master *) Channel : BYTE; (* channel number of the drive *) (* new since 2013-04-04 - just available with versions after this date, otherwise zero *) Nc Drive Id : DWORD; (* ID [1..255] of the NC software drive of an axis *) Nc Drive Index : DWORD; (* index [0..9] of the NC software drive of an axis *) Nc Drive Type : E_Nc Drive Type; (* type enumeration of the NC software drive of an axis *) Nc Encoder Id : DWORD; (* ID [1..255] of the NC software encoder of an axis *) Nc Encoder Index : DWORD; (* index [0..9] of the NC software encoder of an axis *) Nc Encoder Type : E_Nc Encoder Type;(* type enumeration of the NC encoder drive of an axis *) Nc Axis Id : DWORD; (* ID [1..255] of the NC axis *) Nc Axis Type : E_Nc Axis Type; (* type enumeration of the NC axis *) (* new since 2016-04-11 - just available with versions after this date, otherwise zero *) Tc Drive Object Id : DWORD; Tc Encoder Object Id : DWORD; Tc Axis Object Id : DWORD; END_STRUCT END_TYPE Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.11.15 ST_Mc Outputs TYPE ST_Mc Outputs STRUCT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error ID : UDINT; END_STRUCT END_TYPE 7.11.16 ST_Nc Application Request TYPE ST_Nc Application Request STRUCT b Appl Request Bit : UINT; n Appl Request Type : UINT; n Appl Request Counter : UDINT; n Appl Request Version : UDINT; END_STRUCT END_TYPE 7.11.17 ST_Set Encoder Scaling Options TYPE ST_Set Encoder Scaling Options STRUCT Select Encoder Index : BOOL; Encoder Index : UINT; END_STRUCT END_TYPE 7.11.18 ST_Set Position Options This data type contains the optional settings for the function block MC_Set Position [} 19]. TE1000 Version: 2.15.4 149
## Page 150

Data types TYPE ST_Set Position Options STRUCT Clear Position Lag : BOOL; Select Encoder Index : BOOL; Encoder Index : UINT; Clear Position Offset : BOOL; END_STRUCT END_TYPE Clear Position Offset – deleting the MC_Set Position offset The position offset totaled by the MC_Set Position [} 19] call can be deleted with this function block. To do this, the Clear Position Offset switch is set in the options; the position transferred to the block is not relevant in this case. This option is available from Twin CAT 3.1.4024.51 and Tc2_MC2 3.3.56. VAR mc Set Position Clear: MC_Set Position; END_VAR mc Set Position Clear. Options. Clear Position Offset := TRUE; mc Set Position Clear ( Axis:= Axis, Position:= , // not relevant Execute:= TRUE); Homing the axis, e.g. with MC_Home, produces a newly referenced coordinate system for the axis and also deletes the offset. 7.11.19 ST_Nc Position Conversion Options This data type contains the optional settings for the MC_Convert Inc Pos To Pos [} 63] and MC_Convert Pos To Inc Pos [} 64] function blocks. TYPE ST_Nc Position Conversion Options STRUCT Sub Index : UINT; Ctrl Mask : UINT; END_STRUCT END_TYPE 7.12 Stepper 7.12.1 E_Destall Detect Mode TYPE E_Destall Detect Mode : ( Pw St Detect Mode_None := 0, Pw St Detect Mode_Encoderless, Pw St Detect Mode_Lagging(* use encoder signals for stall detection *) ); END_TYPE E_Destall Detect Mode Description Pw St Detect Mode_None No blocking detection Pw St Detect Mode_Encoderless Use of status signals of the KL2531/KL2541 for blocking detection Pw St Detect Mode_Lagging Use of encoder signals for blocking detection 7.12.2 E_Destall Mode TYPE E_Destall Mode : ( Pw St Mode_None := 0, Pw St Mode_Set Error, Pw St Mode_Set Err Non Ref, 150 Version: 2.15.4 TE1000
## Page 151

Data types Pw St Mode_Use Override ); END_TYPE 7.12.3 ST_Power Stepper Struct TYPE ST_Power Stepper Struct : STRUCT Destall Detect Mode : E_Destall Detect Mode; Destall Mode : E_Destall Mode; Destall Enable : BOOL; Status Mon Enable : BOOL; Retries : INT; Timeout : TIME; END_STRUCT END_TYPE Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.13 Superposition 7.13.1 E_Superposition Mode TYPE E_Superposition Mode : ( SUPERPOSITIONMODE_VELOREDUCTION_ADDITIVEMOTION := 1, SUPERPOSITIONMODE_VELOREDUCTION_LIMITEDMOTION, SUPERPOSITIONMODE_LENGTHREDUCTION_ADDITIVEMOTION, SUPERPOSITIONMODE_LENGTHREDUCTION_LIMITEDMOTION, SUPERPOSITIONMODE_ACCREDUCTION_ADDITIVEMOTION, SUPERPOSITIONMODE_ACCREDUCTION_LIMITEDMOTION ); END_TYPE E_Superposition Mode determines how a superimposed motion is carried out with the function block MC_Move Super Imposed [} 89]. The modes referred to as "Veloreduction" execute a superimposed movement with minimum velocity change, preferentially over the full parameterized compensation section. Conversely, the modes referred to as "Lengthreduction" use the maximum possible velocity and therefore reduce the required distance. In both cases same distance is compensated. In cases referred to as "Additivemotion", the superimposed axis executes a longer or shorter movement than indicated by "Length", with the difference described by Distance. These modes are used, for example, if the Length parameter refers to a reference axis and the superimposed axis may move by a longer or shorter distance in comparison. In cases referred to as "Limitedmotion", the superposition is completed within the parameterized distance. These modes are used, for example, if the Length parameter refers to the superimposed axis itself. With these modes it should be noted that the superimposed Distance must be significantly shorter than the available "Length". E_Superposition Mode Description SUPERPOSITIONMODE_VELOREDUCTION_ADDI The superimposed movement takes place over the TIVEMOTION whole "Length". The specified maximum change in velocity "Velocity Diff" is reduced in order to reach the required "Distance" over this length. "Length" refers to a reference axis without superimposed movement (e.g. master axis). The travel path of the axis affected by this compensation is Length + Distance. TE1000 Version: 2.15.4 151
## Page 152

Data types E_Superposition Mode Description SUPERPOSITIONMODE_VELOREDUCTION_LIMIT The superimposed movement takes place over the EDMOTION whole "Length". The specified maximum change in velocity "Velocity Diff" is reduced in order to reach the required "Distance" over this length. The "Length" refers to the axis affected by the compensation. During compensation, the travel path of this axis is "Length". SUPERPOSITIONMODE_LENGTHREDUCTION_AD The distance of the superimposed motion is as short DITIVEMOTION as possible and the velocity is as high as possible. Although neither the maximum velocity change "Velocity Diff" nor the maximum "Length" are exceeded. "Length" refers to a reference axis without superimposed movement (e.g. master axis). The maximum travel path of the axis affected by this compensation is "Length + Distance". SUPERPOSITIONMODE_LENGTHREDUCTION_LI The distance of the superimposed motion is as short MITEDMOTION as possible and the velocity is as high as possible. Although neither the maximum velocity change "Velocity Diff" nor the maximum "Length" are exceeded. The "Length" refers to the axis affected by the compensation. During compensation, the maximum travel path of this axis is "Length". SUPERPOSITIONMODE_ACCREDUCTION_ADDITI The superimposed movement takes place over the VEMOTION (from Twin CAT 2.11) whole "Length". The specified maximum acceleration (parameter "Acceleration" or "Deceleration") is reduced as far as possible, in order to reach the specified "Distance" on this path. "Length" refers to a reference axis without superimposed movement (e.g. master axis). The travel path of the axis affected by this compensation is "Length + Distance". SUPERPOSITIONMODE_ACCREDUCTION_LIMITE The superimposed movement takes place over the DMOTION (from Twin CAT 2.11) whole "Length". The specified maximum acceleration (parameter "Acceleration" or "Deceleration") is reduced as far as possible, in order to reach the specified "Distance" on this path. The "Length" refers to the axis affected by the compensation. During compensation, the travel path of this axis is "Length". Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.13.2 E_Superposition Abort Option TYPE E_Superposition Abort Option : ( SUPERPOSITIONOPTION_ABORTATSTANDSTILL := 0, SUPERPOSITIONOPTION_RESUMEAFTERSTANDSTILL, SUPERPOSITIONOPTION_RESUMEAFTERMOTIONSTOP ) UINT; END_TYPE Description, see ST_Superposition Options [} 153]. 152 Version: 2.15.4 TE1000
## Page 153

Data types 7.13.3 ST_Superposition Options TYPE ST_Superposition Options : STRUCT Abort Option : E_Superposition Abort Option; END_STRUCT END_TYPE TYPE E_Superposition Abort Option : ( SUPERPOSITIONOPTION_ABORTATSTANDSTILL := 0, SUPERPOSITIONOPTION_RESUMEAFTERSTANDSTILL, SUPERPOSITIONOPTION_RESUMEAFTERMOTIONSTOP ); END_TYPE Abort Option is an optional parameter of the function block MC_Move Super Imposed [} 89], which determines the behavior of a superimposed movement at a standstill of the main movement. Abort Option Description SUPERPOSITIONOPTION_ABORTATSTANDSTILL The superimposed movement is aborted as soon as the subordinate movement leads to a standstill of the axis. The only exception to this is a standstill caused by a velocity override of zero. In this case the superimposed movement is also continued as soon as the override is not equal to zero. Abort At Standstill is the default behavior if the option is not assigned by the user. SUPERPOSITIONOPTION_RESUMEAFTERSTAND The superimposed movement is not aborted in the STILL case of a temporary standstill of the main movement, but is continued as soon as the axis moves again. This can occur in particular in the case of a reversal of direction or with cam disc movements. The superimposed movement is terminated only if the target position of the axis has been reached or the axis has been stopped. SUPERPOSITIONOPTION_RESUMEAFTERMOTIO The superimposed movement is not aborted in the NSTOP case of a standstill of the main movement, even if the axis has reached its target position or has been stopped. In this case, the superimposed movement is continued after the axis restarts. This case is not of importance if the superimposed movement is applied to a slave axis, since this cannot be started or stopped actively. For slave axes, the operation modes RESUMEAFTERSTANDSTILL and RESUMEAFTERMOTIONSTOP are equivalent. The superimposed movement would thus also be continued after a restart of the master axis. Overview of the abort conditions for a superimposed movement (MC_Move Super Imposed) ABORTATSTAND RESUMEAFTER RESUMEAFTER STILL STANDSTILL MOTIONSTOP 1. override = 0% resume resume resume 2. temporary standstill of abort resume resume the main movement 3. motion reversal abort resume resume 4. axis has reached the abort abort resume target position or is stopped 5. axis reset or switch-off abort abort abort of the enable signal 6. For slave axes: abort abort abort Decoupling TE1000 Version: 2.15.4 153
## Page 154

Data types Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.14 Torque Control 7.14.1 ST_Torque Control Options This data type contains optional settings for MC_Torque Control. TYPE ST_Torque Control Options : STRUCT Enable Manual Torque Start Value : BOOL; Manual Torque Start Value : LREAL; END_STRUCT END_TYPE ST_Torque Control Options Description Enable Manual Torque Start Value The flag can be enabled to specify a start value that differs from the current torque. Manual Torque Start Value Start value for the torque that is used when the Enable Manual Torque Start Value flag is enabled. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4024 PC or CX (x86) Tc2_MC2 7.15 Touch probe 7.15.1 E_Signal Edge Edge defines whether the rising or falling edge of the trigger signal is evaluated. TYPE E_Signal Edge : ( Rising Edge, Falling Edge ) UINT; END_TYPE Name Description Rising Edge Rising signal edge Falling Edge Falling signal edge 7.15.2 E_Signal Source TYPE E_Signal Source : ( Signal Source_Default, (* undefined or externally configured *) Signal Source_Input1, (* digital drive input 1 *) Signal Source_Input2, (* digital drive input 2 *) Signal Source_Input3, (* digital drive input 3 *) Signal Source_Input4, (* digital drive input 4 *) Signal Source_Zero Pulse := 128, (* encoder zero pulse *) Signal Source_Drive Defined (* defined by drive parameters - e. g. CAN object 0x60D0 *) ) UINT; END_TYPE Name Description Signal Source Optionally defines the signal source, if it can be selected via the controller. 154 Version: 2.15.4 TE1000
## Page 155

Data types Name Description Example: • AX5000 (So E): Signal Source_Default • AX8000 (Co E DS402): Signal Source_Drive Defined 7.15.3 MC_Touch Probe Recorded Data TYPE MC_Touch Probe Recorded Data : STRUCT Counter : LREAL; Recorded Position : LREAL; Absolute Position : LREAL; Modulo Position : LREAL; END_STRUCT END_TYPE MC_Touch Probe Recorded- Data type Description Data Counter LREAL Counter indicating how many valid edges were detected in the last cycle. Detection of multiple edges is only implemented in mode TOUCHPROBEMODE_CONTINOU S under SERCOS/SOE and must be supported explicitly by the hardware (e.g. AX5000). Recorded Position LREAL Axis position recorded at the point in time of the trigger signal. This corresponds to the absolute axis position or the modulo axis position, depending on the parameterization. Absolute Position LREAL Absolute axis position detected at the point in time of the trigger signal. Modulo Position LREAL Modulo axis position recorded at the point in time of the trigger signal. 7.15.4 TRIGGER_REF TYPE TRIGGER_REF : STRUCT Encoder ID : UDINT; (* 1..255 *) Touch Probe : E_Touch Probe; (* probe unit definition *) Signal Source : E_Signal Source; (* optional physical signal source used by the probe unit *) Edge : E_Signal Edge; (* rising or falling signal edge *) Mode : E_Touch Probe Mode; (* single shot or continous monitoring *) Plc Event : BOOL; (* PLC trigger signal input when Touch Probe signal source is set to 'Plc Event' *) Modulo Positions : BOOL; (* interpretation of First Position, Last Position and Recorded Position as modulo positions when TRUE *) END_STRUCT END_TYPE Name Data type Description Encoder ID UDINT The ID of an encoder is indicated in the Twin CAT System Manager. Touch Probe E_Touch Probe [} 157] Defines the latch unit (probe unit) within the encoder hardware used. Signal Source E_Signal Source [} 154] Optionally defines the signal source, if it can be selected via the controller. In many cases the signal source is permanently configured in the drive and should then be set to the default value "Signal Source_Default". TE1000 Version: 2.15.4 155
## Page 156

Data types Name Data type Description Edge E_Signal Edge [} 154] Edge defines whether the rising or falling edge of the trigger signal is evaluated. Mode E_Touch Probe Mode Specifies the operation mode of the latch unit. In single mode only the first edge is recorded. In [} 156] continous mode each PLC cycle edge is signaled. Plc Event BOOL If the signal source "Touch Probe" is set to the type "Plc Event", a rising edge on these variables triggers the recording of the current axis position. "Plc Event" is not a real latch function, but depends on the cycle time. Modulo Positions BOOL If the variable "Modulo Positions" is FALSE, the axis position is interpreted in an absolute linear range from -∞ to +∞. The "First Position", "Last Position" and "Recorded Position" positions of the function block MC_Touch Probe [} 35] are then also absolute. If "Modulo Positions" is TRUE, all positions are interpreted modulo in the modulo range of the axis used (e.g. 0..359.9999). At the same time this means that a defined trigger window repeats itself cyclically. Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 7.15.5 E_Touch Probe Mode Specifies the operation mode of the latch unit. In single mode only the first edge is recorded. In Continuous mode, each PLC cycle edge is signaled. TYPE E_Touch Probe Mode : ( TOUCHPROBEMODE_SINGLE_COMPATIBILITYMODE, (* for Twin CAT 2.10 and 2.11 before Build 2022 *) TOUCHPROBEMODE_SINGLE, (* multi probe interface - from 2.11 Build 2022 *) 156 Version: 2.15.4 TE1000
## Page 157

Data types TOUCHPROBEMODE_CONTINOUS (* multi probe interface - from 2.11 Build 2022 *) ) UINT; END_TYPE For the SINGLE or CONTINUOUS modes the probe unit must be configured as an "Extended Nc Probe Unit". 7.15.6 E_Touch Probe TYPE E_Touch Probe : ( Touch Probe1 := 1, (* 1st hardware probe unit with Sercos, Can Open, KL5xxx and others *) Touch Probe2, (* 2nd probe unit *) Touch Probe3, (* currently not available *) Touch Probe4, (* currently not available *) Plc Event := 10 (* simple PLC signal TRUE/FALSE *) ) UINT; END_TYPE TE1000 Version: 2.15.4 157
## Page 158

Global constants 8 Global constants 8.1 Library version All libraries have a certain version. The version is indicated in the PLC library repository, for example. A global constant contains the information about the library version: Global_Version VAR_GLOBAL CONSTANT st Lib Version_Tc2_MC2 : ST_Lib Version; END_VAR st Lib Version_Tc2_MC2: version information of the Tc2_MC2 library (Typ: ST_Lib Version). To check whether the version you have is the version you need, use the function F_Cmp Lib Version (defined in Tc2_System library). All other options for comparing library versions, which you may know from Twin CAT 2, are outdated. 158 Version: 2.15.4 TE1000
## Page 159

Examples 9 Examples The sample programs use the Tc2_MC2 library and run entirely in simulation mode. Progress can be monitored in Twin CAT Scope View with the configuration provided. PTP – point to point movement The sample program manages and moves an axis in PTP mode. The axis is moved with two instances of an MC_Move Absolute function block in buffered mode over several intermediate positions and velocity levels. Download: https://infosys.beckhoff.com/content/1033/Tc Plc Lib_Tc2_MC2/Resources/2386997515.zip Master/slave coupling The sample program couples two axes and moves them together. The slave axis is uncoupled and positioned during the journey. Download: https://infosys.beckhoff.com/content/1033/Tc Plc Lib_Tc2_MC2/Resources/2386995851.zip Dancer control The sample program shows how the velocity of a slave axis can be controlled according to the position of a dancer. Download: https://infosys.beckhoff.com/content/1033/Tc Plc Lib_Tc2_MC2/Resources/2386992523.zip Superimposed movement (superposition) The sample shows the overlay of a movement while an axis is driving. Download: https://infosys.beckhoff.com/content/1033/Tc Plc Lib_Tc2_MC2/Resources/2386999179.zip Compensation of the backlash of an axis The sample program shows how the backlash of an axis can be compensated for. Download: https://infosys.beckhoff.com/content/1033/Tc Plc Lib_Tc2_MC2/Resources/2386989195.zip External setpoint generation The sample shows how an axis can be moved via the external setpoint generator. The movement of the NC axis "Axis" is generated as the sum of the individual movements of the other two Nc axes. Download: https://infosys.beckhoff.com/content/1033/Tc Plc Lib_Tc2_MC2/Resources/2386994187.zip Control loop switching in an AX5000 with two existing encoders The sample illustrates switching between two axis control loops. Suitable hardware is required for this sample. Download: https://infosys.beckhoff.com/content/1033/Tc Plc Lib_Tc2_MC2/Resources/2386990859.zip Writing outputs in the IO interface of the encoder or drive of an axis The example shows how the IO outputs not used by the Nc can be written from the PLC Download: https://infosys.beckhoff.com/content/1033/Tc Plc Lib_Tc2_MC2/Resources/13977016971.zip Requirements Development environment Target system type PLC libraries to include Twin CAT v3.0.0 PC or CX (x86 or x64) Tc2_MC2 TE1000 Version: 2.15.4 159
## Page 160

Support and Service 10 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 160 Version: 2.15.4 TE1000
## Page 161

Appendix 11 Appendix 11.1 NC Backlash Compensation 11.1.1 Mechanical backlash Mechanical backlash is the difference in position between a drive or an encoder and the load. Mechanical backlash arises due mechanical tolerances in the drivetrain. This causes a difference between the required and the actual position of the load. This is especially important when the direction of motion is reversed. There are three types of mechanical backlash: Positive backlash Positive backlash occurs in systems where the measuring system is directly coupled to the drive. In this case the backlash exists between the drive and the load. When the direction of motion is reversed, the measuring system will detect a change in position before the load has moved. So the encoder, which here measures the position of the load indirectly, leads the actual position of the load. As a consequence, the load will not reach the set position, it will be shorten by the length of the backlash. In the figure below, a movement from left to right is defined as a positive movement. The encoder leads the load (e.g. machine table), so the measured encoder position, leads the actual position of the table. Therefore the table’s movement will be too short. In this case enter a positive correction value for the backlash (= normal case). Negative backlash Negative backlash occurs in systems where a mechanical tolerance exists between the drive and the measuring system. When the direction of motion is reversed the load immediately moves in the new direction and the measuring system won’t detect the changed position. In this case the load will travel further than required. The encoder, which measures the position of the load directly, lags behind the actual position of the machine part. The encoder lags behind the actual position of the load (e.g. machine table). Therefore the table will travel too far. In this case enter a negative correction value for the backlash. TE1000 Version: 2.15.4 161
## Page 162

Appendix Neutral backlash In systems, neutral backlash is an exception. In this case the measuring system is directly coupled to the load and electrically connected with the drive. Here the encoder position and the load position are the same. Now when the drive’s direction of motion is reversed, the backlash will be automatically compensated. The position control loop is closed around the drivetrain because the encoder is coupled to the load directly. The set position can be reached with no further compensation. The encoder is directly coupled with the load (e.g. machine table) and ensuring steady state accuracy. No special settings are required. General Hints and Notes: • Implemention of positive or negative backlash compensation is the same in Twin CAT (only the sign of the backlash value differs). A positive backlash is parameterized as positive value, a negative as negative value. • A negative backlash is undesirable, because an axis with a backlash in the encoder system is difficult to control (stationery vibrations / oscillations). Typically there are further steps necessary to solve this problem. • It is not necessary to differentiate between position interface (position control in the drive) and velocity interface (position control in Twin CAT), because they have the same effect. This applies to all variants of backlashes. • In case of neutral backlash there is no compensation action necessary, even though there is a mechanical backlash. The encoder system is coupled to the machine table therefore enforcing steady state accuracy. • If a referencing (homing) of an axis is necessary, do the homing with backlash compensation deactivated also position correction deactivated. The last driving direction defines if the left or the right edge is the point of reference by defining a reference position (see NC Implementing the Twin CAT Backlash Compensation [} 163]). 11.1.2 NC Implementing of the Twin CAT Position Correction Twin CAT position correction is used for the backlash compensation. The following table shows a description of Twin CAT position correction for drives in cyclic position and velocity interfaces. Implementation and effect of Position Correction resp. Backlash Compensation Implementation 1. The backlash correction is subtracted from the set position which is transmitted to the drive. 2. The backlash correction is added to the actual position which is transmitted from the encoder. Effect in the Position Interface Description / Effect: (position control in the Drive) 162 Version: 2.15.4 TE1000
## Page 163

Appendix Implementation and effect of Position Correction resp. Backlash Compensation By manipulating the set position which is transmitted to the drive the backlash will be driven (subtraction of position correction, see case 1). To realize that the monitored actual value is correct, this backlash correction is subtracted from the transmitted actual value (addition of the position correction, see case 2). Effect in the Velocity Interface Description / Effect: (position control in Twin CAT) In the velocity interface no set position is transmitted to the drive, so correcting the set position would have no effect. By correcting the actual position which is transmitted from the encoder to the drive a position difference is created. The closed loop position controller in Twin CAT controls, by means of this position difference (“lag error”) that the backlash is driven (addition of the position correction, see case 2). 11.1.3 NC Implementing the Twin CAT Backlash Compensation Overview of the effect of the backlash compensation differentiating by type of backlash and reference position (left or right edge): • Positive backlash: Drive resp. external encoder has no backlash – backlash value is positive. • Negative backlash: Additional external encoder has a backlash – backlash value is negative. Implementation and effect of backlash compensation Reference position at the left edge Backlash compensation in negative direction Positive direction: • No manipulation Negative direction: • Manipulation of the actual position +backlash • Manipulation of the set position -backlash Reference position at the right edge Backlash compensation in positive direction Positive direction: • Manipulation of the actual position -backlash • Manipulation of the set position +backlash Negative direction: • No manipulation TE1000 Version: 2.15.4 163
## Page 164

Trademark statements Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Bi SS is a trademark of IC Haus Gmb H. En Dat is a trademark of Dr. Johannes Heidenhain Gmb H.
## Page 165

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
