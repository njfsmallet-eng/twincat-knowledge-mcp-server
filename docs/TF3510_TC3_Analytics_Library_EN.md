---
title: "TF3510 Twin CAT 3"
product: "TF3510"
category: "Analytics"
tags: ["CAT", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.5.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF3510_TC3_Analytics_Library_EN.pdf"
release_date: "2025-08-11"
---
Manual | EN TF3510 Twin CAT 3 | Analytics Library 2025-08-11 | Version: 1.5.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Installation............................................................................................................................................... 12 3.1 System requirements...................................................................................................................... 12 3.2 Installation under Twin CAT4026..................................................................................................... 12 3.3 Installation....................................................................................................................................... 12 3.4 Licensing......................................................................................................................................... 15 4 Technical Introduction............................................................................................................................ 18 5 PLC API.................................................................................................................................................... 20 5.1 Function blocks............................................................................................................................... 20 5.1.1 Algorithms........................................................................................................................ 20 5.1.2 System........................................................................................................................... 396 5.1.3 Io T.................................................................................................................................. 403 5.2 Functions....................................................................................................................................... 426 5.2.1 F_Raw Timespan_TO_Structured.................................................................................. 426 5.2.2 F_Structured Timespan_TO_Raw.................................................................................. 426 5.3 Data types..................................................................................................................................... 427 5.3.1 General.......................................................................................................................... 427 5.3.2 Config............................................................................................................................. 428 5.3.3 Time............................................................................................................................... 434 6 Samples................................................................................................................................................. 436 6.1 Combination of algorithms with local inputs.................................................................................. 436 7 Appendix................................................................................................................................................ 437 7.1 Return codes................................................................................................................................. 437 7.2 FAQ - frequently asked questions and answers........................................................................... 439 TF3510 Version: 1.5.0 3
## Page 4

Table of contents 4 Version: 1.5.0 TF3510
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF3510 Version: 1.5.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.5.0 TF3510
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF3510 Version: 1.5.0 7
## Page 8

Overview 2 Overview The Twin CAT Analytics Library is a collection of base analysis algorithm. Functions such as time and life cycle analysis, peak detection, comperators, basic math operations, logical operators and much more are available. This library can be used as standard PLC library for your machine application, but also in a Twin CAT Analytics Runtime (TF3550) for a central PLC-based 24h analysis application. In the second case the library will be used in an automatic PLC code generation powered by TE3500 Twin CAT Analytics Workbench. Components • Driver Tc Analytics Kernel.sys • PLC Library Tc3_Analytics.compiled-library 8 Version: 1.5.0 TF3510
## Page 9

Overview List of algorithm TF3510 Version: 1.5.0 9
## Page 10

Overview Base FB_ALY_Continuous Piece Counter_1Ch [} 24] FB_ALY_Downsampling Buffer_1Ch [} 28] FB_ALY_Edge Counter_1Ch [} 31] FB_ALY_Edge Counter On Off_1Ch [} 35] FB_ALY_Edge Counter On Off_2Ch [} 39] FB_ALY_Event Timing Analysis_1Ch [} 43] FB_ALY_Event Timing Analysis_2Ch [} 47] FB_ALY_Interval Piece Counter_1Ch [} 55] FB_ALY_Lifecycle Analysis_1Ch [} 64] FB_ALY_Lifetime Analysis_1Ch [} 67] FB_ALY_Min Max Avg_1Ch [} 71] FB_ALY_Min Max Avg Interval_1Ch [} 73] FB_ALY_Moving Avg_1Ch [} 77] FB_ALY_Moving Interval Counter_1Ch [} 79] FB_ALY_Productivity Diagnosis_3Ch [} 86] FB_ALY_Productivity Interval_1Ch [} 90] FB_ALY_Signal Generator_1Ch [} 94] FB_ALY_Time Clock_1Ch [} 96] FB_ALY_Timer_1Ch [} 99] FB_ALY_Timing Analysis_1Ch [} 103] Classification FB_ALY_Bandwidth Classificator_1Ch [} 112] FB_ALY_Bandwidth Classificator_3Ch [} 114] FB_ALY_Curve Sketcher_1Ch [} 116] FB_ALY_Histogram_1Ch [} 120] FB_ALY_Section Timer_1Ch [} 124] FB_ALY_State Histogram_1Ch [} 128] FB_ALY_Threshold Classificator_1Ch [} 132] FB_ALY_Threshold String Classificator_1Ch [} 135] FB_ALY_Time Based Envelope_1Ch [} 138] Clustering FB_ALY_Den Stream [} 153] FB_ALY_Sequential KMeans [} 160] Compare FB_ALY_Demultiplexer [} 167] FB_ALY_Detect String Change_1Ch [} 170] FB_ALY_Logic Operation Counter [} 184] FB_ALY_Multiplexer [} 188] FB_ALY_Numerical Compare_1Ch [} 192] FB_ALY_Numerical Compare_2Ch [} 195] FB_ALY_String Compare_1Ch [} 198] FB_ALY_String Compare_2Ch [} 201] Math FB_ALY_Integrator_1Ch [} 238] 10 Version: 1.5.0 TF3510
## Page 11

Overview FB_ALY_Math Operation [} 241] FB_ALY_Math Operation_1Ch [} 245] FB_ALY_RMS_1Ch [} 247] FB_ALY_Slope Analysis_1Ch [} 251] Statistics FB_ALY_Correlation Function [} 313] FB_ALY_Correlation Function Reference [} 322] FB_ALY_Standard Deviation [} 346] FB_ALY_Linear Regression Fitting [} 334] FB_ALY_Linear Regression Inference [} 341] Training Base FB_ALY_Time Based Teach Path_1Ch [} 361] Wind Turbine FB_ALY_Wt Turbulence_1Ch [} 300] XTS FB_ALY_Xts Acceleration Analysis_1Ch [} 293] FB_ALY_Xts Distance Integrator_1Ch [} 295] FB_ALY_Xts Velocity Analysis_1Ch [} 298] XY Path Analysis FB_ALY_Xy Gate Monitor_2Ch [} 383] FB_ALY_Xy Shape Monitor_Circle_2Ch [} 387] FB_ALY_Xy Shape Monitor_Rectangle_2Ch [} 390] FB_ALY_Xy Shape Monitor_Triangle_2Ch [} 393] TF3510 Version: 1.5.0 11
## Page 12

Installation 3 Installation The Twin CAT Analytics Library can be used as a normal PLC library independently of other Twin CAT Analytics products. To do this, a corresponding workload must be installed on your engineering system. No additional installation is required on the target system, as all necessary components are automatically downloaded to the target system during project activation. General information on installation and licensing can be found in the following subchapters. 3.1 System requirements Technical data TF3510 | Twin CAT 3 Analytics Library Target System Windows 10, Win CE, Twin CAT/BSD PC (x86, x64 and Arm®) Min. Twin CAT version 3.1.4022.29 Min. Twin CAT level TC1200 | Twin CAT 3 PLC 3.2 Installation under Twin CAT4026 Twin CAT Package Manager If you are using Twin CAT 3.1 Build 4026 (and higher) on the Microsoft Windows operating system, you can install this function via the Twin CAT Package Manager, see Installation documentation. Normally you install the function via the corresponding workload; however, you can also install the packages contained in the workload individually. This documentation briefly describes the installation process via the workload. Command line program Tc Pkg You can use the Tc Pkg Command Line Interface (CLI) to display the available workloads on the system: tcpkg list TF3510 You can install the workload of the TF3510 Twin CAT 3 Analytics Library function using the following command. tcpkg install TF3510. Analytics Library. XAE Twin CAT Package Manager UI You can use the User Interface (UI) to display all available workloads and install them if required. To do this, follow the corresponding instructions in the interface. 3.3 Installation Setup installation (Twin CAT 3.1 Build 4024) The following section describes how to install the Twin CAT 3 function for Windows-based operating systems. ü The Twin CAT 3 function setup file was downloaded from the Beckhoff website. 1. Run the setup file as administrator. To do this, select the Run As Admin command in the context menu of the file. ð The installation dialog opens. 12 Version: 1.5.0 TF3510
## Page 13

Installation 2. Accept the end user licensing agreement and click Next. 3. Enter your user data. TF3510 Version: 1.5.0 13
## Page 14

Installation 4. If you want to install the full version of the Twin CAT 3 function, select Complete as the installation type. If you want to install the Twin CAT 3 function components separately, select Custom. 5. Click Next, then Install to start the installation. ð A dialog box informs you that the Twin CAT system must be stopped to proceed with the installation. 14 Version: 1.5.0 TF3510
## Page 15

Installation 6. Confirm the dialog with Yes. 7. Click Finish to exit the setup. ð The Twin CAT 3 function has been installed successfully. 3.4 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. TF3510 Version: 1.5.0 15
## Page 16

Installation 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 16 Version: 1.5.0 TF3510
## Page 17

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. TF3510 Version: 1.5.0 17
## Page 18

Technical Introduction 4 Technical Introduction There are two main use cases for the Twin CAT Analytics Library. 1. The library is used by the automatic PLC code generation of the Twin CAT Analytics Workbench. All base algorithm of the Toolbox in the Analytics configurator are also available in the Twin CAT Analytics Library. The generated code can be downloaded to the Analytics Runtime, where it runs 24h 7 days a week parallel to the applications in the field. 2. The library can be used also as standard PLC library on the target device in the field. In fact, it is not necessary to use the library always together with MQTT communication. You can take also just local variables and put them to the algorithm of the library. This you can see in the sample code [} 436] of this document. Where it works in the Twin CAT Analytics workflow is shown in the picture below. Princip and handling The function blocks of the algorithm provide different methods. With the exception of a few algorithms, each function block has a configuration method. This method will be called first to configure the algorithm with e.g. thresholds or operators etc. An additional “Set Channel Value” method provide the specific input variable to the algorithm. The input value is not processed until the “Call” method has been invoked. Therefore every function block has a call method which starts finally the calculation. The results are outputs at the body of the function block. 18 Version: 1.5.0 TF3510
## Page 19

Technical Introduction Timestamps The timestamps and timespans in a Twin CAT analytics system are based on the DC time used in Ether CAT. Timestamps are expressed in nanoseconds since 1.01.2000 UTC. They are represented in a unsigned 64 bit integer value. Timespans are represented in a signed 64 bit integer value. For a better visualization the algorithms provide function blocks in their outputs to store timestamps or timespans. For timespans the function block FB_ALY_Date Time [} 396] is used. Timespans are stored in the function block FB_ALY_Timespan [} 399]. By using this function blocks it is easy to calculate with or to provide them as strings for an HMI application. TF3510 Version: 1.5.0 19
## Page 20

PLC API 5 PLC API 5.1 Function blocks 5.1.1 Algorithms 5.1.1.1 Base 5.1.1.1.1 FB_ALY_Batch NShift_1Ch The Batch NShift 1Ch buffers the values of the input signal according to the buffer size and the sample mode. The number of output channels in which the buffered input values are stored corresponds to the buffer size. With the help of the sample mode it is possible to distinguish between two different operating modes of the algorithm. If the sample mode Flow is selected, a ring buffer or shift register is realized (Shift). The values are written to the buffer one after the other and shifted by one position of the buffer in each cycle. If the buffer is full, the last value falls out. In the Wait mode, the buffer is instead completely emptied and filled with new values whenever it is completely full, so that the values are processed in the form of batches (batch). At the beginning of an analysis, the system also waits until the buffer is completely filled before writing the values to the buffer. Therefore, the function block supplies valid values only from the cycle (Buffer Size + 1). Syntax Definition: FUNCTION_BLOCK FB_ALY_Batch NShift_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. 20 Version: 1.5.0 TF3510
## Page 21

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. FB_init() Local Initialize the number of output channels (size of the internal buffer). Get Channel Output Valu Local Method for getting individual output values from the output e() array. Get Output Array() Local Method for getting the entire output array. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Batch NShift : FB_ALY_Batch NShift_1Ch(n Buffer Size := 100); e Sample Mode : E_ALY_Sample Mode := E_ALY_Sample Mode. Flow; b Configure : BOOL := TRUE; n Input : INT; a Buffer : ARRAY[1..100] OF LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Batch NShift. Configure(e Sample Mode); END_IF // Call algorithm fb Batch NShift. Set Channel Value(n Input); fb Batch NShift. Call(); fb Batch NShift. Get Output Array(ADR(a Buffer), SIZEOF(a Buffer)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.1.1 FB_init Initialization of the buffer size. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Buffer Size: UDINT := 1; END_VAR Inputs Name Type Description n Buffer Size UDINT Indicates the size of the buffer and thus the number of values that are stored. The number of output channels equals the buffer size. TF3510 Version: 1.5.0 21
## Page 22

PLC API Return value Name Type Description FB_init BOOL Not used. 5.1.1.1.1.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.1.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL e Sample Mode : E_ALY_Sample Mode; VAR_INPUT END_VAR Inputs Name Type Description e Sample Mode E_ALY_Sample Mode The values from the buffer can be passed to the output channels in two different modes: Flow: The buffer is filled like a ring buffer. At the start of the analysis all output values are set to zero. Each change to the ring buffer is transferred to the output channels immediately. The New Result flag is set to TRUE, once all output channels got assigned a value and is always true, when a new value is saved in the buffer. Wait: At the start of the analysis or after reset all output channels are set to zero. Only when the internal buffer is full, these values are transferred to the output channels and the New Result flag is set to TRUE. These values stay as output values until all the values in the internal buffer are renewed. Only then they are transferred to the output channels. Return value Name Type Description Configure BOOL Returns TRUE if successful. 22 Version: 1.5.0 TF3510
## Page 23

PLC API 5.1.1.1.1.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.1.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.1.6 Get Channel Output Value Fetching a channel-specific output value. The output value is only updated if the Call() method was called previously. Syntax Definition: METHOD Get Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) output ANY Output value of any data type. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alue TF3510 Version: 1.5.0 23
## Page 24

PLC API 5.1.1.1.1.7 Get Output Array Getting the entire output array. The number of elements corresponds to the configured buffer size. Syntax Definition: METHOD Get Output Array : BOOL VAR_INPUT p Array Out : POITNER TO LREAL; n Array Out Size : UDINT; END_VAR Inputs Name Type Description p Array Out POINTER TO LREAL Pointer to the output array: Dim: n Buffer Size n Array Out Size UDINT Size of the output array Return value Name Type Description Get Output Array BOOL Returns TRUE if successful. 5.1.1.1.2 FB_ALY_Continuous Piece Counter_1Ch The Continuous Piece Counter 1Ch counts the number of pieces within the configured interval. The counter is increased when the signal of the input channel passes the configured edge at a specific threshold. The calculation restarts when the time of the interval has elapsed. The algorithm provides the amount of pieces, the minimal and the maximal number of pieces as well as the time values of minimum and maximum. Syntax Definition: FUNCTION_BLOCK FB_ALY_Continuous Piece Counter_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; n Num Intervals: ULINT; n Count Last Interval: ULINT; n Count Current Interval: ULINT; n Count Min: ULINT; n Count Max: ULINT; fb Time Count Min: FB_ALY_Date Time; fb Time Count Max: FB_ALY_Date Time; fb Time Current Interval: FB_ALY_Timespan; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. 24 Version: 1.5.0 TF3510
## Page 25

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. n Num Intervals ULINT Number of elapsed intervals. n Count Last Interval ULINT Number of events in the last interval. n Count Current Interv ULINT Number of events in the current interval. al n Count Min ULINT Minimum number of events in the current interval. n Count Max ULINT Maximum number of events in the current interval. fb Time Count Min FB_ALY_Date Time Timestamp of n Count Min. fb Time Count Max FB_ALY_Date Time Timestamp of n Count Max. fb Time Current Interv FB_ALY_Timespan Elapsed time in the current interval. al Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Pause() Local Method to pause the execution including the internal time intervals. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Continuous Piece Counter : FB_ALY_Continuous Piece Counter_1Ch; fb System Time : FB_ALY_Get System Time; st Threshold Edge : ST_ALY_Threshold; t Interval : LTIME := LTIME#5M; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge.e Comparison Operator := E_ALY_Comparison Operator. Equals; TF3510 Version: 1.5.0 25
## Page 26

PLC API st Threshold Edge.f Threshold := 1; fb Continuous Piece Counter. Configure Channel(st Threshold Edge); fb Continuous Piece Counter. Configure(t Interval); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Continuous Piece Counter. Set Channel Value(n Input); fb Continuous Piece Counter. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.2.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.2.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT t Interval : LTIME; END_VAR Inputs Name Type Description t Interval LTIME Interval time in which the events are to be considered 26 Version: 1.5.0 TF3510
## Page 27

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.2.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.2.4 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Edge : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.2.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. TF3510 Version: 1.5.0 27
## Page 28

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.2.6 Pause With the Pause method it is possible to pause the execution of the function block. The internally running time interval does not continue after calling the pause function. A single call of the method is sufficient. The interval is not continued until the next call of the Call method. Syntax Definition: METHOD Pause : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Pause BOOL Returns TRUE if successful. 5.1.1.1.3 FB_ALY_Downsampling_1Ch Downsampling 1Ch processes the values of the input channel with a configurable downsampling factor. This achieves downsampling so that the output signal is a representation of the input signal at a lower sampling rate. This can be useful, for example, to better identify trends or to perform subsequent compression of highly sampled signals if only lower sampling rates are required within the analysis. This is a simple way to increase the performance of the analysis. Syntax Definition: FUNCTION_BLOCK FB_ALY_Downsampling_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Out: LREAL; fb Time Last Sample: FB_ALY_Date Time; END_VAR 28 Version: 1.5.0 TF3510
## Page 29

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Out LREAL Output signal with the sampling rate lower by the downsampling factor. fb Time Last Sample FB_ALY_Date Time Stores the timestamp of the last data point output to f Out. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Downsampling : FB_ALY_Downsampling_1Ch; fb System Time : FB_ALY_Get System Time; n Downsampling Factor : UDINT := 10; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Downsampling. Configure(n Downsampling Factor); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Downsampling. Set Channel Value(n Input); fb Downsampling. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.3.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: TF3510 Version: 1.5.0 29
## Page 30

PLC API METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.3.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL n Downsampling Factor : UDINT; VAR_INPUT END_VAR Inputs Name Type Description n Downsampling Fact UDINT The factor used for downsampling. For example, if the or downsampling factor is 100, only every 100th value is saved. The sample time is thus 100 times the original cycle time, which lies between two sampled data points. If the downsampling factor is set to one, all values are buffered. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.3.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.3.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. 30 Version: 1.5.0 TF3510
## Page 31

PLC API Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.4 FB_ALY_Edge Counter_1Ch The Edge Counter 1Ch counts the amount of raised events. An event is raised when the signal of the input channel passes the configured edge at a specific threshold. Syntax Definition: FUNCTION_BLOCK FB_ALY_Edge Counter_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Edge: BOOL; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Edge BOOL TRUE if an edge has been detected. n Count ULINT Counts the number of edges detected. fb Time Last Event FB_ALY_Date Time Stores the timestamp of the last detected edge. TF3510 Version: 1.5.0 31
## Page 32

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Inital() Local Method for setting initial values for the algorithms, e.g. already expired lifetime. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Edge Counter : FB_ALY_Edge Counter_1Ch; fb System Time : FB_ALY_Get System Time; st Threshold Edge : ST_ALY_Threshold; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge.f Threshold := 1; fb Edge Counter. Configure Channel(st Threshold Edge); fb Edge Counter. Configure(); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Edge Counter. Set Channel Value(n Input); fb Edge Counter. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.4.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: 32 Version: 1.5.0 TF3510
## Page 33

PLC API METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.4.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT END_VAR Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.4.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Edge : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 33
## Page 34

PLC API 5.1.1.1.4.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.4.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.4.6 Set Inital Initialize internal values of the algorithm. Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT n Count : ULINT; END_VAR Inputs Name Type Description n Count ULINT Initializes the number of detected edges. Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 34 Version: 1.5.0 TF3510
## Page 35

PLC API 5.1.1.1.5 FB_ALY_Edge Counter On Off_1Ch The Edge Counter On Off 1Ch counts the amount of raised on- and off-events. An on-event is raised when the signal of the input channel passes the configured edge at a specific on-threshold and an off-event is raised when the off-threshold is passed by the same signal. Syntax Definition: FUNCTION_BLOCK FB_ALY_Edge Counter On Off_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Is On: BOOL; b Edge On: BOOL; b Edge Off: BOOL; n Count On: ULINT; n Count Off: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Is On BOOL TRUE within the timespan between the On event and the Off result, otherwise FALSE. b Edge On BOOL TRUE if an On event has been detected. b Edge Off BOOL TRUE if an Off event has been detected. n Count On ULINT Counts the number of On events that were triggered. n Count Off ULINT Counts the number of Off events that were triggered. fb Time Last Event FB_ALY_Date Time Timestamp of the last event. TF3510 Version: 1.5.0 35
## Page 36

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Inital() Local Method for setting initial values for the algorithms, e.g. already expired lifetime. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Edge Counter On Off : FB_ALY_Edge Counter On Off_1Ch; fb System Time : FB_ALY_Get System Time; st Threshold Edge : ST_ALY_Threshold On Off; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge. On.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge. On.f Threshold := 1; st Threshold Edge. Off.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge. Off.f Threshold := 0; fb Edge Counter On Off. Configure Channel(st Threshold Edge); fb Edge Counter On Off. Configure(); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Edge Counter On Off. Set Channel Value(n Input); fb Edge Counter On Off. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.5.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: 36 Version: 1.5.0 TF3510
## Page 37

PLC API METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.5.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT END_VAR Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.5.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Edge : ST_ALY_Threshold On Off; END_VAR Inputs Name Type Description st Threshold Edge ST_ALY_Threshold On Off Combination of comparison operator and threshold for on- state and off-state [} 427] Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 37
## Page 38

PLC API 5.1.1.1.5.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.5.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.5.6 Set Inital Initialize internal values of the algorithm. Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT n Count On : ULINT; n Count Off : ULINT; END_VAR Inputs Name Type Description n Count On ULINT Initializes the number of detected On events. n Count Off ULINT Initializes the number of detected Off events. Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 38 Version: 1.5.0 TF3510
## Page 39

PLC API 5.1.1.1.6 FB_ALY_Edge Counter On Off_2Ch The Edge Counter On Off 2Ch counts the amount of raised on- and off-events. An on-event is raised when the signal of the first input channel passes the configured edge at a specific on-threshold and an off-event is raised when the off-threshold is passed by the signal of the second channel. Syntax Definition: FUNCTION_BLOCK FB_ALY_Edge Counter On Off_2Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Is On: BOOL; b Edge On: BOOL; b Edge Off: BOOL; n Count On: ULINT; n Count Off: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Is On BOOL TRUE within the timespan between the On event and the Off result, otherwise FALSE. b Edge On BOOL TRUE if an On event has been detected. b Edge Off BOOL TRUE if an Off event has been detected. n Count On ULINT Counts the number of On events that were triggered. n Count Off ULINT Counts the number of Off events that were triggered. fb Time Last Event FB_ALY_Date Time Timestamp of the last event. TF3510 Version: 1.5.0 39
## Page 40

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Inital() Local Method for setting initial values for the algorithms, e.g. already expired lifetime. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Edge Counter On Off : FB_ALY_Edge Counter On Off_2Ch; fb System Time : FB_ALY_Get System Time; st Threshold Edge : ST_ALY_Threshold On Off; b Reset On Multiple On : BOOL := FALSE; b Configure : BOOL := TRUE; n Input : INT; f Input : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge. On.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge. On.f Threshold := 1; st Threshold Edge. Off.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge. Off.f Threshold := 0; fb Edge Counter On Off. Configure Channel(1, st Threshold Edge. On); fb Edge Counter On Off. Configure Channel(2, st Threshold Edge. Off); fb Edge Counter On Off. Configure(b Reset On Multiple On); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Edge Counter On Off. Set Channel Value(1, n Input); fb Edge Counter On Off. Set Channel Value(2, f Input); fb Edge Counter On Off. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.6.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). 40 Version: 1.5.0 TF3510
## Page 41

PLC API Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.6.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT b Reset On Multiple On : BOOL; END_VAR Inputs Name Type Description b Reset On Multiple On BOOL Reset in case of multiple On event Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.6.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT n Channel : UDINT; st Threshold Edge : ST_ALY_Threshold; END_VAR TF3510 Version: 1.5.0 41
## Page 42

PLC API Inputs Name Type Description n Channel UDINT Channel index 1: On 2: Off st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.6.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.6.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: On 2: Off Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.6.6 Set Inital Initialize internal values of the algorithm. 42 Version: 1.5.0 TF3510
## Page 43

PLC API Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT n Count On : ULINT; n Count Off : ULINT; END_VAR Inputs Name Type Description n Count On ULINT Initializes the number of detected On events. n Count Off ULINT Initializes the number of detected Off events. Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 5.1.1.1.7 FB_ALY_Event Timing Analysis_1Ch The Event Timing Analysis 1Ch measures time differences between on- and off-event and counts the amount of raised events. An on-event is raised when the signal of the input channel passes the configured edge at a specific on-threshold and an off-event is raised when the off-threshold is passed by the same signal. Syntax Definition: FUNCTION_BLOCK FB_ALY_Event Timing Analysis_1Ch VAR_INPUT b Persistent: BOOL; b Init With Threshold Level: BOOL END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Is On: BOOL; n Count On: ULINT; fb Time Current Interval: FB_ALY_Timespan; fb Time Last On Interval: FB_ALY_Timespan; fb Time Last Off Interval: FB_ALY_Timespan; fb Time On Min: FB_ALY_Timespan; fb Time On Max: FB_ALY_Timespan; fb Time On Avg: FB_ALY_Timespan; fb Time On Total: FB_ALY_Timespan; fb Time Off Min: FB_ALY_Timespan; fb Time Off Max: FB_ALY_Timespan; fb Time Off Avg: FB_ALY_Timespan; fb Time Off Total: FB_ALY_Timespan; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. b Init With Threshold L BOOL If the value is TRUE, the algorithm uses a threshold to evel initialize the internal state, instead of waiting for an edge. TF3510 Version: 1.5.0 43
## Page 44

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Is On BOOL TRUE within the timespan between the On event and the Off result, otherwise FALSE. n Count On ULINT Counts the number of On events that were triggered. fb Time Current Interv FB_ALY_Timespan Timespan of the current interval. al fb Time Last On Interv FB_ALY_Timespan Timespan of the last completed interval between On event al and Off event. fb Time Last Off Interv FB_ALY_Timespan Timespan of the last completed interval between Off event al and On event. fb Time On Min FB_ALY_Timespan Minimum time between On event and Off event. fb Time On Max FB_ALY_Timespan Maximum time between On event and Off event. fb Time On Avg FB_ALY_Timespan Average time between On event and Off event. fb Time On Total FB_ALY_Timespan Total time between On events and Off events. fb Time Off Min FB_ALY_Timespan Minimum time between Off event and On event fb Time Off Max FB_ALY_Timespan Maximum time between Off event and On event fb Time Off Avg FB_ALY_Timespan Average time between Off event and On event fb Time Off Total FB_ALY_Timespan Total time between Off events and On events. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Event Timing Analysis : FB_ALY_Event Timing Analysis_1Ch; fb System Time : FB_ALY_Get System Time; st Threshold Edge : ST_ALY_Threshold On Off; 44 Version: 1.5.0 TF3510
## Page 45

PLC API b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge. On.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge. On.f Threshold := 1; st Threshold Edge. Off.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge. Off.f Threshold := 0; fb Event Timing Analysis. Configure Channel(st Threshold Edge); fb Event Timing Analysis. Configure(); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Event Timing Analysis. Set Channel Value(n Input); fb Event Timing Analysis. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.7.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.7.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT END_VAR TF3510 Version: 1.5.0 45
## Page 46

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.7.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Edge : ST_ALY_Threshold On Off; END_VAR Inputs Name Type Description st Threshold Edge ST_ALY_Threshold On Off Combination of comparison operator and threshold for on- state and off-state. [} 427] It is possible to configure only the condition for the On event. In this case, only this event is taken into account when the algorithm is executed. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.7.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.7.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR 46 Version: 1.5.0 TF3510
## Page 47

PLC API Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.8 FB_ALY_Event Timing Analysis_2Ch The Event Timing Analysis 2Ch measures time differences between on- and off-event and counts the amount of raised events. An on-event is raised when the signal of the first input channel passes the configured edge at a specific on-threshold and an off-event is raised when the off-threshold is passed by the signal of the second channel. Syntax Definition: FUNCTION_BLOCK FB_ALY_Event Timing Analysis_2Ch VAR_INPUT b Persistent: BOOL; b Init With Threshold Level: BOOL END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Is On: BOOL; n Count On: ULINT; fb Time Current Interval: FB_ALY_Timespan; fb Time Last On Interval: FB_ALY_Timespan; fb Time Last Off Interval: FB_ALY_Timespan; fb Time On Min: FB_ALY_Timespan; fb Time On Max: FB_ALY_Timespan; fb Time On Avg: FB_ALY_Timespan; fb Time On Total: FB_ALY_Timespan; fb Time Off Min: FB_ALY_Timespan; fb Time Off Max: FB_ALY_Timespan; fb Time Off Avg: FB_ALY_Timespan; fb Time Off Total: FB_ALY_Timespan; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. b Init With Threshold L BOOL If the value is TRUE, the algorithm uses a threshold to evel initialize the internal state, instead of waiting for an edge. TF3510 Version: 1.5.0 47
## Page 48

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Is On BOOL TRUE within the timespan between the On event and the Off result, otherwise FALSE. n Count On ULINT Counts the number of On events that were triggered. fb Time Current Interv FB_ALY_Timespan Timespan of the current interval. al fb Time Last On Interv FB_ALY_Timespan Timespan of the last completed interval between On event al and Off event. fb Time Last Off Interv FB_ALY_Timespan Timespan of the last completed interval between Off event al and On event. fb Time On Min FB_ALY_Timespan Minimum time between On event and Off event. fb Time On Max FB_ALY_Timespan Maximum time between On event and Off event. fb Time On Avg FB_ALY_Timespan Average time between On event and Off event. fb Time On Total FB_ALY_Timespan Total time between On events and Off events. fb Time Off Min FB_ALY_Timespan Minimum time between Off event and On event. fb Time Off Max FB_ALY_Timespan Maximum time between Off event and On event. fb Time Off Avg FB_ALY_Timespan Average time between Off event and On event. fb Time Off Total FB_ALY_Timespan Total time between Off events and On events. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Event Timing Analysis : FB_ALY_Event Timing Analysis_2Ch; fb System Time : FB_ALY_Get System Time; st Threshold Edge : ST_ALY_Threshold On Off; b Reset On Multiple On : BOOL := FALSE; 48 Version: 1.5.0 TF3510
## Page 49

PLC API b Configure : BOOL := TRUE; n Input : INT; f Input : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge. On.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge. On.f Threshold := 1; st Threshold Edge. Off.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge. Off.f Threshold := 0; fb Event Timing Analysis. Configure Channel(1, st Threshold Edge. On); fb Event Timing Analysis. Configure Channel(2, st Threshold Edge. Off); fb Event Timing Analysis. Configure(b Reset On Multiple On); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Event Timing Analysis. Set Channel Value(1, n Input); fb Event Timing Analysis. Set Channel Value(2, f Input); fb Event Timing Analysis. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.8.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.8.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL b Reset On Multiple On : BOOL; VAR_INPUT END_VAR TF3510 Version: 1.5.0 49
## Page 50

PLC API Inputs Name Type Description b Reset On Multiple On BOOL Reset in case of multiple On event Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.8.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT n Channel : UDINT; st Threshold Edge : ST_ALY_Threshold; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: On 2: Off st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.8.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.8.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: 50 Version: 1.5.0 TF3510
## Page 51

PLC API METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: On 2: Off Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.9 FB_ALY_Flip Flop_2Ch The Flip Flop 2Ch implements a bistable flip-flop. The dominance for setting (RS) or resetting (SR) the output value can be configured. Syntax Definition: FUNCTION_BLOCK FB_ALY_Flip Flop_2Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Out: BOOL; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. TF3510 Version: 1.5.0 51
## Page 52

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Out BOOL Result of the bistable flip-flop. n Count ULINT Incremented when the output value is TRUE. The behavior depends on the configuration parameter e Count Mode. fb Time Last Event FB_ALY_Date Time Timestamp of the last event. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Inital() Local Method for setting initial values for the algorithms, e.g. already expired lifetime. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Flip Flop : FB_ALY_Flip Flop_2Ch; fb System Time : FB_ALY_Get System Time; st Config S : ST_ALY_Threshold :=(e Comparison Operator:=E_ALY_Comparison Operator. Greater Than, f Thre shold:= 0.5); st Config R : ST_ALY_Threshold :=(e Comparison Operator:=E_ALY_Comparison Operator. Greater Than, f Thre shold:= 0.5); b Set Is Dominant : BOOL := TRUE; e Count Mode : E_ALY_Count Mode := E_ALY_Count Mode. Cyclic; b Configure : BOOL := TRUE; n In S : INT; b In R : BOOL; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; 52 Version: 1.5.0 TF3510
## Page 53

PLC API fb Flip Flop. Configure Channel(1, st Config S); fb Flip Flop. Configure Channel(2, st Config R); fb Flip Flop. Configure(b Set Is Dominant, e Count Mode); END_IF // Call algorithm fb Flip Flop. Set Channel Value(1, n In S); fb Flip Flop. Set Channel Value(2, b In R); fb Flip Flop. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.9.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.9.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT b Set Is Dominant : BOOL; e Count Mode : E_ALY_Count Mode; END_VAR TF3510 Version: 1.5.0 53
## Page 54

PLC API Inputs Name Type Description b Set Is Dominant BOOL The dominance of setting (RS) or resetting (SR) can be configured. e Count Mode E_ALY_Count Mode [} 429] Mode of the result counter. On Change: The counter counts every time the result changes to TRUE. Cyclic: The counter increments every cycle when the condition is TRUE. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.9.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT n Channel : UDINT; st Threshold Level : ST_ALY_Threshold; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Set (S) 2: Reset (R) st Threshold Level ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for threshold value consideration. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.9.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 54 Version: 1.5.0 TF3510
## Page 55

PLC API 5.1.1.1.9.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Set (S) 2: Reset (R) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.9.6 Set Inital Initialize internal values of the algorithm. Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT n Count : ULINT; END_VAR Inputs Name Type Description n Count ULINT Initializes the counter value. Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 5.1.1.1.10 FB_ALY_Interval Piece Counter_1Ch The Interval Piece Counter 1Ch counts the amount of raised events within a configured interval, which starts when the value of the start interval flag is TRUE. An event is raised when the signal of the input channel passes the configured edge at a specific threshold. The calculation restarts when the time of the interval has elapsed and the value of the start interval flag is True again. TF3510 Version: 1.5.0 55
## Page 56

PLC API Syntax Definition: FUNCTION_BLOCK FB_ALY_Interval Piece Counter_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Executing Interval: BOOL; n Num Intervals: ULINT; n Count Last Interval: ULINT; n Count Current Interval: ULINT; n Count Min: ULINT; n Count Max: ULINT; fb Time Count Min: FB_ALY_Date Time; fb Time Count Max: FB_ALY_Date Time; fb Time Current Interval: FB_ALY_Timespan; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Executing Interval BOOL TRUE when the interval is executed. n Num Intervals ULINT Number of elapsed intervals. n Count Last Interval ULINT Number of events in the last interval. n Count Current Interval ULINT Number of events in the current interval. n Count Min ULINT Minimum number of events in the current interval. n Count Max ULINT Maximum number of events in the current interval. fb Time Count Min FB_ALY_Date Tim Timestamp of n Count Min. e fb Time Count Max FB_ALY_Date Tim Timestamp of n Count Max. e fb Time Current Interval FB_ALY_Timespa Elapsed time in the current interval. n Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons 56 Version: 1.5.0 TF3510
## Page 57

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Pause() Local Method to pause the execution including the internal time intervals. Sample VAR fb Interval Piece Counter : FB_ALY_Interval Piece Counter_1Ch; fb System Time : FB_ALY_Get System Time; st Threshold Edge : ST_ALY_Threshold; b Reset On Multiple Start : BOOL := FALSE; t Interval : LTIME := LTIME#5M; b Configure : BOOL := TRUE; b Start Interval : BOOL := FALSE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge.f Threshold := 1; fb Interval Piece Counter. Configure Channel(st Threshold Edge); fb Interval Piece Counter. Configure(b Reset On Multiple Start, t Interval); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Interval Piece Counter. Set Channel Value(n Input); fb Interval Piece Counter. Call(fb System Time.t System Time, b Start Interval) Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.10.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; b Start Interval : BOOL; END_VAR TF3510 Version: 1.5.0 57
## Page 58

PLC API Inputs Name Type Description t Timestamp ULINT Current timestamp. b Start Interval BOOL Start processing the configured interval. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.10.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT b Reset On Multiple Start : BOOL; t Interval : LTIME END_VAR Inputs Name Type Description b Reset On Multiple St BOOL Reset in case of multiple "Start" event art t Interval LTIME Interval time in which the events are to be considered Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.10.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Edge : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. 58 Version: 1.5.0 TF3510
## Page 59

PLC API Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.10.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.10.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.10.6 Pause With the Pause method it is possible to pause the execution of the function block. The internally running time interval does not continue after calling the pause function. A single call of the method is sufficient. The interval is not continued until the next call of the Call method. Syntax Definition: METHOD Pause : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. TF3510 Version: 1.5.0 59
## Page 60

PLC API Return value Name Type Description Pause BOOL Returns TRUE if successful. 5.1.1.1.11 FB_ALY_Latching Switch_1Ch The Latching Switch 1Ch realizes a virtual impulse switch. The output alternates between TRUE and FALSE on each edge detected at the input. Syntax Definition: FUNCTION_BLOCK FB_ALY_Flip Flop_2Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Out: BOOL; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Out BOOL Result of the virtual impulse switch. n Count ULINT Incremented when the output value changes. fb Time Last Event FB_ALY_Date Time Timestamp of the last event. 60 Version: 1.5.0 TF3510
## Page 61

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Inital() Local Method for setting initial values for the algorithms, e.g. already expired lifetime. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Latching Switch : FB_ALY_Latching Switch_1Ch; fb System Time : FB_ALY_Get System Time; st Config: ST_ALY_Threshold :=(e Comparison Operator:=E_ALY_Comparison Operator. Greater Than, f Thresh old:= 0.5); b Configure : BOOL := TRUE; n Input : INT; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Latching Switch. Configure Channel(st Config); fb Latching Switch. Configure(); END_IF // Call algorithm fb Latching Switch. Set Channel Value(n Input); fb Latching Switch. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.11.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: TF3510 Version: 1.5.0 61
## Page 62

PLC API METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.11.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT END_VAR Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.11.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Edge : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 62 Version: 1.5.0 TF3510
## Page 63

PLC API 5.1.1.1.11.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.11.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.11.6 Set Inital Initialize internal values of the algorithm. Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT n Count : ULINT; END_VAR Inputs Name Type Description n Count ULINT Initializes the counter value. Return value Name Type Description Set Initial BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 63
## Page 64

PLC API 5.1.1.1.12 FB_ALY_Lifecycle Analysis_1Ch The Lifecycle Analysis 1Ch calculates the elapsed and the estimated remaining cycles of a device. When the signal of the input channel passes the configured edge at a specific threshold, the elapsed cycles are increased and the remaining cycles are decreased. Syntax Definition: FUNCTION_BLOCK FB_ALY_Lifecycle Analysis_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; n Cycles Elapsed: ULINT; n Cycles Remaining: LINT; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. n Cycles Elapsed ULINT Number of cycles elapsed. n Cycles Remaining LINT Remaining cycles. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Inital() Local Method for setting initial values for the algorithms, e.g. already expired lifetime. 64 Version: 1.5.0 TF3510
## Page 65

PLC API Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Lifecycle Analysis : FB_ALY_Lifecycle Analysis_1Ch; st Threshold Edge : ST_ALY_Threshold; n Cycles Estimated : ULINT := 1_000_000; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge.f Threshold := 1; fb Lifecycle Analysis. Configure Channel(st Threshold Edge); fb Lifecycle Analysis. Configure(n Cycles Estimated); END_IF // Call algorithm fb Lifecycle Analysis. Set Channel Value(n Input); fb Lifecycle Analysis. Call(); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.12.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.12.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Cycles Estimated : ULINT; END_VAR TF3510 Version: 1.5.0 65
## Page 66

PLC API Inputs Name Type Description n Cycles Estimated ULINT Estimated component cycles Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.12.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Edge : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.12.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.12.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR 66 Version: 1.5.0 TF3510
## Page 67

PLC API Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.12.6 Set Initial Initialize internal values of the algorithm. Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT n Cycles Elapsed : ULINT; END_VAR Inputs Name Type Description n Cycles Elapsed ULINT Initializes the number of elapsed cycles. Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 5.1.1.1.13 FB_ALY_Lifetime Analysis_1Ch The Lifetime Analysis 1Ch calculates the elapsed and the estimated remaining lifetime of a device. If the input value met the configured condition the lifetime will be reduced. Syntax Definition: FUNCTION_BLOCK FB_ALY_Lifetime Analysis_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; fb Lifetime Elapsed: FB_ALY_Timespan; fb Lifetime Remaining: FB_ALY_Timespan; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. TF3510 Version: 1.5.0 67
## Page 68

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. fb Lifetime Elapsed FB_ALY_Timespan Time elapsed from the lifetime. fb Lifetime Remaining FB_ALY_Timespan Expected remaining lifetime. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Inital() Local Method for setting initial values for the algorithms, e.g. already expired lifetime. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Lifetime Analysis : FB_ALY_Lifetime Analysis_1Ch; fb System Time : FB_ALY_Get System Time; st Threshold Level : ST_ALY_Threshold; t Lifetime Estimated : LTIME := LTIME#10000H; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Level.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Level.f Threshold := 1; fb Lifetime Analysis. Configure Channel(st Threshold Level); fb Lifetime Analysis. Configure(t Lifetime Estimated); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Lifetime Analysis. Set Channel Value(n Input); fb Lifetime Analysis. Call(fb System Time.t System Time); 68 Version: 1.5.0 TF3510
## Page 69

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.13.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.13.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT t Lifetime Estimated : LTIME; END_VAR Inputs Name Type Description t Lifetime Estimated LTIME Estimated component lifetime Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.13.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. TF3510 Version: 1.5.0 69
## Page 70

PLC API Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Level : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Level ST_ALY_Threshold [} 427] Combination of comparison operator and used threshold for on-state. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.13.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.13.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.13.6 Set Inital Initialize internal values of the algorithm. 70 Version: 1.5.0 TF3510
## Page 71

PLC API Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT t Lifetime Elapsed : LTIME; END_VAR Inputs Name Type Description n Count ULINT Initializes the lifetime that has already expired. Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 5.1.1.1.14 FB_ALY_Min Max Avg_1Ch The Min Max Avg 1Ch calculates the minimum, maximum and the average of the input values from the beginning of the analysis up to the current moment. Furthermore, the time values of minimum and maximum are shown. Syntax Definition: FUNCTION_BLOCK FB_ALY_Min Max Avg_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Min: LREAL; f Max: LREAL; f Avg: LREAL; fb Time Min: FB_ALY_Date Time; fb Time Max: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. TF3510 Version: 1.5.0 71
## Page 72

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Min LREAL Minimum of the input values. f Max LREAL Maximum of the input values. f Avg LREAL Average of the input values. fb Time Min FB_ALY_Date Time Timestamp of f Min. fb Time Max FB_ALY_Date Time Timestamp of f Max. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Min Max Avg : FB_ALY_Min Max Avg_1Ch; fb System Time : FB_ALY_Get System Time; n Input : INT; END_VAR // Get current system time fb System Time. Call(); // Call algorithm fb Min Max Avg. Set Channel Value(n Input); fb Min Max Avg. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.14.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR 72 Version: 1.5.0 TF3510
## Page 73

PLC API Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.14.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.14.3 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.15 FB_ALY_Min Max Avg Interval_1Ch The Min Max Avg Interval 1Ch calculates the minimum, maximum and the average of the input values for the time period of the configured Interval. Furthermore the time values of minimum and maximum are shown. Note that all values are from the relative last interval and that they will only be updated when the interval is over. The calculation restarts when the time of the interval has elapsed. Syntax Definition: FUNCTION_BLOCK FB_ALY_Min Max Avg Interval_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; TF3510 Version: 1.5.0 73
## Page 74

PLC API f Min: LREAL; f Max: LREAL; f Avg: LREAL; fb Time Min: FB_ALY_Date Time; fb Time Max: FB_ALY_Date Time; fb Time Current Interval: FB_ALY_Timespan; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Min LREAL Minimum of the input values in the current time interval. f Max LREAL Maximum of the input values in the current time interval. f Avg LREAL Average of the input values in the current time interval. fb Time Min FB_ALY_Date Time Timestamp of f Min. fb Time Max FB_ALY_Date Time Timestamp of f Max. fb Time Current Interv FB_ALY_Timespan Elapsed time of the current interval. al Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Pause() Local Method to pause the execution including the internal time intervals. Sample VAR fb Min Max Avg Interval : FB_ALY_Min Max Avg Interval_1Ch; fb System Time : FB_ALY_Get System Time; t Interval : LTIME := LTIME#20S; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Min Max Avg Interval. Configure(t Interval); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Min Max Avg Interval. Set Channel Value(n Input); fb Min Max Avg Interval. Call(fb System Time.t System Time); 74 Version: 1.5.0 TF3510
## Page 75

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.15.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.15.2 Configure Configure the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT t Interval : LTIME; END_VAR Inputs Name Type Description t Interval LTIME Interval time Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.15.3 Reset Resetting the algorithm. TF3510 Version: 1.5.0 75
## Page 76

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.15.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.15.5 Pause With the Pause method it is possible to pause the execution of the function block. The internally running time interval does not continue after calling the pause function. A single call of the method is sufficient. The interval is not continued until the next call of the Call method. Syntax Definition: METHOD Pause : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Pause BOOL Returns TRUE if successful. 76 Version: 1.5.0 TF3510
## Page 77

PLC API 5.1.1.1.16 FB_ALY_Moving Avg_1Ch The Moving Average 1Ch calculates the moving average, the minimum and the maximum of the most recent input values in an interval of specified length. Furthermore the time values of minimum and maximum are shown. The calculation of the moving average depends on the configuration parameters Num Values and Startup Behaviour. Syntax Definition: FUNCTION_BLOCK FB_ALY_Moving Avg_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Moving Avg: LREAL; f Moving Min: LREAL; f Moving Max: LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Moving Avg LREAL Moving average value of the input value. f Moving Min LREAL Moving minimum of the input value. f Moving Max LREAL Moving maximum of the input value. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Moving Avg : FB_ALY_Moving Avg_1Ch; n Num Values : UDINT := 100; e Startup Behaviour : E_ALY_Moving Avg Startup Behaviour := E_ALY_Moving Avg Startup Behaviour. Avg Over Ex isting; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Moving Avg. Configure(n Num Values, e Startup Behaviour); END_IF TF3510 Version: 1.5.0 77
## Page 78

PLC API // Call algorithm fb Moving Avg. Set Channel Value(n Input); fb Moving Avg. Call(); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.16.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.16.2 Configure Configure the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Num Values : UDINT; e Startup Behaviour : E_ALY_Moving Avg Startup Behaviour; END_VAR Inputs Name Type Description n Num Values ULINT Number of values included in the calculation of the moving average. e Startup Behaviour E_ALY_Moving Avg Startup Calculation behavior at the beginning of the analysis with less values than configured in Num Values. Behaviour [} 430] Zero Padding: The missing values are filled with zeros. Use First Value: The first value is used until the number of values equals Num Values. Wait Until Filled: The first result is calculated when the number of values equals Num Values. Avg Over Existing: The average is calculated with the already existing values until the number of values equals Num Values. 78 Version: 1.5.0 TF3510
## Page 79

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.16.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.16.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.17 FB_ALY_Moving Interval Counter_1Ch The Moving Interval Counter 1Ch counts the amount of raised events within a configured interval. An event is raised when the signal of the input channel passes the configured edge at a specific threshold. The calculation restarts when the time of the interval has elapsed. Syntax Definition: FUNCTION_BLOCK FB_ALY_Moving Interval Counter_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Edge: BOOL; b Limited: BOOL; n Counts In Interval: ULINT; fb Time First Count: FB_ALY_Date Time; fb Time Last Count: FB_ALY_Date Time; END_VAR TF3510 Version: 1.5.0 79
## Page 80

PLC API Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Edge BOOL TRUE at the time the event is triggered, otherwise FALSE. b Limited BOOL TRUE if the number of edges in the current interval exceeds the set Count Limit. n Counts In Interval ULINT Number of triggered events in the current interval. fb Time First Count FB_ALY_Date Time Timestamp of the first event in the current interval. fb Time Last Count FB_ALY_Date Time Timestamp of the last event in the current interval. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Moving Interval Counter : FB_ALY_Moving Interval Counter_1Ch; fb System Time : FB_ALY_Get System Time; st Threshold Edge : ST_ALY_Threshold; t Interval : LTIME := LTIME#20S; n Count Limit : UDINT := 20; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge.e Comparison Operator := E_ALY_Comparison Operator. Equals; 80 Version: 1.5.0 TF3510
## Page 81

PLC API st Threshold Edge.f Threshold := 1; fb Moving Interval Counter. Configure Channel(st Threshold Edge); fb Moving Interval Counter. Configure(t Interval, n Count Limit); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Moving Interval Counter. Set Channel Value(n Input); fb Moving Interval Counter. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.17.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.17.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT t Interval : LTIME; n Count Limit : UDINT; END_VAR Inputs Name Type Description t Interval LTIME Time interval in which the values are to be calculated. n Count Limit UDINT Limit of counts in the configured interval TF3510 Version: 1.5.0 81
## Page 82

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.17.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Edge : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.17.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.17.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. 82 Version: 1.5.0 TF3510
## Page 83

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.18 FB_ALY_Overall Equipment Effectiveness The Overall Equipment Effectiveness (OEE) calculates key figures that make it possible to compare the current state of the manufacturing process with its maximum potential. Syntax Definition: FUNCTION_BLOCK FB_ALY_Overall Equipment Effectiveness VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f OEE: LREAL; e Oee Class: E_ALY_Classification_3Cls; fb Time Oee Event Warning: FB_ALY_Date Time; fb Time Oee Event Alarm: FB_ALY_Date Time; f Availability: LREAL; n Performance: LREAL; f Quality: LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f OEE LREAL Overall equipment effectiveness in percent. It is calculated by multiplying the availability factor, the performance factor and the quality factor. e Oee Class E_ALY_Classification_3Cls Result of the classification of the OEE. [} 428] fb Time Oee Event Wa FB_ALY_Date Time Timestamp of the last classification of the OEE as a rning warning. fb Time Oee Event Alar FB_ALY_Date Time Timestamp of the last classification of the OEE as an m alarm. f Availability LREAL Availability factor in percent. It is calculated from the ratio between the runtime and the operating time. f Performance LREAL Performance factor in percent. It is calculated from the ratio of units actually produced and the number of units produced in the ideal case. f Quality LREAL Quality factor in percent. It is calculated as the ratio of intact produced units to produced units. TF3510 Version: 1.5.0 83
## Page 84

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb OEE : FB_ALY_Overall Equipment Effectiveness; fb System Time : FB_ALY_Get System Time; t Ideal Cycle Time : LTIME := LTIME#1M30S; f Threshold Level Ok Warning : LREAL := 90.0; f Threshold Level Warning Alarm : LREAL := 75.0; b Configure : BOOL := TRUE; t Scheduled Time : LTIME; t Operating Time : LTIME; n Units Produced : ULINT; n Defective Units : ULINT; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb OEE. Configure(t Ideal Cycle Time, f Threshold Level Ok Warning, f Threshold Level Warning Alarm); END_IF // Call algorithm fb OEE. Set Channel Value(1, t Scheduled Time); fb OEE. Set Channel Value(2, t Operating Time); fb OEE. Set Channel Value(3, n Units Produced); fb OEE. Set Channel Value(4, n Defective Units); fb OEE. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.18.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. 84 Version: 1.5.0 TF3510
## Page 85

PLC API Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.18.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT t Ideal Cycle Time : LTIME; f Threshold Level Ok Warning : LREAL; f Threshold Level Warning Alarm : LREAL; END_VAR Inputs Name Type Description t Ideal Cycle Time BOOL Ideal cycle time for the production of one unit. f Threshold Level Ok LREAL The overall equipment effectiveness greater than the Warning configured threshold is classified as OK. If the overall equipment effectiveness is less than or equal to the configured threshold, it is classified as Warning. f Threshold Level War LREAL If the overall equipment effectiveness is greater than the ning Alarm configured threshold, it is classified as Warning. If the overall equipment effectiveness is less than or equal to the configured threshold, it is classified as Alarm . Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.18.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.18.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: TF3510 Version: 1.5.0 85
## Page 86

PLC API METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Scheduled Time: The operating time is calculated from the calendar time minus the scheduled non-production. 2: Operating Time: The running time is calculated from the operating time minus the downtimes. 3: Units Produced: Corresponds to the number of units produced including defective units. 4: Defective Units: Corresponds to the number of defective units. Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.19 FB_ALY_Productivity Diagnosis_3Ch The Productivity Diagnosis 3Ch algorithm calculates the productivity of the process during a production interval. The diagram below schematically illustrates the relationship between the production process and the individual production cycles. The production interval can be started and stopped via the input Is Producing. During the execution of the production interval, the production cycles are counted. Each production cycle corresponds to one piece produced. A production cycle starts with an edge at Start Cycle and stops with an edge at Stop Cycle. The productivity over the entire production interval (Productivity) is calculated after stopping the interval when the signal Is Producing no longer meets the condition for Threshold Level Producing. The completed production cycles and therefore all finished pieces are taken into account. Productivity is calculated as the ratio of pieces actually produced per time and the target value of pieces to be produced in a given time. The output Productivity Last Cycle is calculated from the time required for the last production cycle in relation to the configured time for a piece. Any break times between cycles are not taken into account. The output Expected Productivity estimates the total productivity during the production interval. For this purpose, the previous production time is extrapolated to the total productivity for the target value of the pieces to be produced. The algorithm can be configured with the target value for the Produced Pieces within a configured interval (Production Time), e.g. 1 piece in 30 seconds or 50 pieces per hour. Syntax Definition: FUNCTION_BLOCK FB_ALY_Productivity Diagnosis_3Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; 86 Version: 1.5.0 TF3510
## Page 87

PLC API b New Result: BOOL; b Configured: BOOL; b Producing: BOOL; b Cycle Finished: BOOL; f Productivity: LREAL; f Productivity Last Cycle: LREAL; f Expected Productivity: LREAL; fb Elapsed Time: FB_ALY_Timespan; n Production Cycles: ULINT; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Producing BOOL Indicates that the production interval is active. b Cycle Finished BOOL TRUE if a production cycle has been completed, otherwise FALSE. f Productivity LREAL Productivity of the entire production interval in percent. f Productivity Last Cycl LREAL Productivity of the last production cycle in percent. e f Expected Productivit LREAL Estimates the productivity of the production interval. y Specified in percent. fb Elapsed Time FB_ALY_Timespan Timespan since the start of the production interval. n Production Cycles ULINT Number of complete production cycles in the current production interval. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Productivity Diagnosis : FB_ALY_Productivity Diagnosis_3Ch; fb System Time : FB_ALY_Get System Time; st Threshold Is Producing : ST_ALY_Threshold; TF3510 Version: 1.5.0 87
## Page 88

PLC API st Threshold Start Cycle : ST_ALY_Threshold; st Threshold Stop Cycle : ST_ALY_Threshold; n Num Produced Pieces : ULINT := 40; t Production Time : LTIME := LTIME#1H; b Configure : BOOL := TRUE; b Is Producing : BOOL; b Start Production Cycle : BOOL; b Stop Production Cycle : BOOL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Is Producing.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Is Producing.f Threshold := 1; st Threshold Start Cycle.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Start Cycle.f Threshold := 1; st Threshold Stop Cycle.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Stop Cycle.f Threshold := 1; fb Productivity Diagnosis. Configure Channel(1, st Threshold Is Producing); fb Productivity Diagnosis. Configure Channel(2, st Threshold Start Cycle); fb Productivity Diagnosis. Configure Channel(3, st Threshold Stop Cycle); fb Productivity Diagnosis. Configure(n Num Produced Pieces, t Production Time); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Productivity Diagnosis. Set Channel Value(1, b Is Producing); fb Productivity Diagnosis. Set Channel Value(2, b Start Production Cycle); fb Productivity Diagnosis. Set Channel Value(3, b Stop Production Cycle); fb Productivity Diagnosis. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.19.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.19.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). 88 Version: 1.5.0 TF3510
## Page 89

PLC API Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Num Produced Pieces : ULINT; t Production Time : LTIME; END_VAR Inputs Name Type Description n Num Produced Piec ULINT Setpoint for pieces produced during the configured time es interval (Production Time). t Production Time LTIME Time interval in which n Num Produced Pieces are produced. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.19.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT n Channel : UDINT; st Threshold : ST_ALY_Threshold; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Is producing (level) 2: Start production cycle (edge) 2: Stop production cycle (level) st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold. Depending on n Channel. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.19.4 Reset Resetting the algorithm. TF3510 Version: 1.5.0 89
## Page 90

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.19.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Is producing (level) 2: Start production cycle (edge) 2: Stop production cycle (level) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.20 FB_ALY_Productivity Interval_1Ch The algorithm Productivity Interval 1Ch calculates the productivity of the process during a given interval. The interval can be defined by the inputs t Time Start and t Time Stop. The pieces produced are taken into account during execution. A produced element is counted when an edge is applied to the input. The estimated productivity of the current interval and the productivity of the last complete interval are provided as output values. The algorithm can be configured with the target value of the produced pieces within a given interval. Syntax Definition: FUNCTION_BLOCK FB_ALY_Productivity Interval_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Within Interval: BOOL; fb Current Timestamp: FB_ALY_Date Time; fb Interval Length: FB_ALY_Timespan; fb Elapsed Time: FB_ALY_Timespan; fb Remaining Time: FB_ALY_Timespan; n Produced In Interval: ULINT; n Remaining In Interval: ULINT; f Current Productivity: LREAL; f Expected Productivity: LREAL; f Last Full Period Productivity: LREAL; END_VAR 90 Version: 1.5.0 TF3510
## Page 91

PLC API Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Within Interval BOOL Indicates whether the current time is within the interval. fb Current Timestamp FB_ALY_Date Time Current timestamp. fb Interval Length FB_ALY_Timespan Length of the interval. fb Elapsed Time FB_ALY_Timespan Elapsed time within the interval. fb Remaining Time FB_ALY_Timespan Time remaining within the interval. n Produced In Interval ULINT Produced parts within the interval. n Remaining In Interva ULINT Remaining pieces within the interval. l f Current Productivity LREAL Current productivity of the interval in percent. Takes into account the length of the interval, the time already elapsed, the pieces to be produced and the pieces already produced. The output is in percent. f Expected Productivit LREAL Expected productivity of the interval in percent. To y determine the possible pieces that can be produced within the remaining time, the production time of the last part is used. f Last Full Period Prod LREAL Productivity of the last complete interval in percent. This is uctivity only calculated if the interval was fully processed. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons TF3510 Version: 1.5.0 91
## Page 92

PLC API Sample VAR fb Productivity Interval : FB_ALY_Productivity Interval_1Ch; fb System Time : FB_ALY_Get System Time; st Threshold : ST_ALY_Threshold; n Expected Pieces : ULINT := 40; b Configure : BOOL := TRUE; b Piece Produced : BOOL; t Time Start : LTIME := LTIME#8H; t Time Stop : LTIME := LTIME#16H; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold.f Threshold := 1; fb Productivity Interval. Configure Channel(st Threshold); fb Productivity Interval. Configure(n Expected Pieces); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Productivity Interval. Set Channel Value(b Piece Produced); fb Productivity Interval. Call(t Time Start, t Time Stop, fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.20.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Time Start : LTIME; t Time Stop : LTIME; t Timestamp : ULINT; END_VAR Inputs Name Type Description t Time Start LTIME Start time of the specified interval. Allows the interval to be specified from process data. Specified as time of day with a resolution of 1 ns. t Time Stop LTIME End time of the specified interval. Allows the interval to be specified from process data. Specified as time of day with a resolution of 1 ns. t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 92 Version: 1.5.0 TF3510
## Page 93

PLC API 5.1.1.1.20.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Expected Pieces: ULINT; END_VAR Inputs Name Type Description n Expected Pieces ULINT Specification of the pieces to be produced within the defined timespan. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.20.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold. This setting determines when a produced piece is counted. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.20.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. TF3510 Version: 1.5.0 93
## Page 94

PLC API 5.1.1.1.20.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.21 FB_ALY_Signal Generator_1Ch Signal Generator 1Ch can be used to generate various signal curves. The signal type, the frequency, the amplitude and the offset can be set individually. Syntax Definition: FUNCTION_BLOCK FB_ALY_Signal Generator_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Signal: LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Signal LREAL Output of the configured signal 94 Version: 1.5.0 TF3510
## Page 95

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Sample VAR fb Signal Generator : FB_ALY_Signal Generator_1Ch; e Function Type : E_ALY_Function Type := E_ALY_Function Type. Sine; f Sample Rate : LREAL := 1000.0; f Frequency : LREAL := 50.0; f Amplitude : LREAL := 100.0; f Offset : LREAL := 0.0; b Configure : BOOL := TRUE; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Signal Generator. Configure(e Function Type, f Sample Rate, f Frequency, f Amplitude, f Offset); END_IF // Call algorithm fb Signal Generator. Call(); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.21.1 Call Calling the algorithm. Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.21.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Function Type : E_ALY_Function Type; f Sample Rate : LREAL; TF3510 Version: 1.5.0 95
## Page 96

PLC API f Frequency : LREAL; f Amplitude : LREAL; f Offset : LREAL; END_VAR Inputs Name Type Description e Function Type E_ALY_Function Type Function type of the generated signal. Const: Constant [} 432] Rectangle: Rectangle function Sawtooth: Sawtooth function Sine: Sine function Triangle: Triangle function f Sample Rate LREAL Sample rate of the system to be analyzed. f Frequency LREAL Frequency of the generated signal. f Amplitude LREAL Configuration of the signal amplitude. f Offset LREAL Constant offset of the generated signal. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.21.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.22 FB_ALY_Time Clock_1Ch Time Clock 1Ch executes a time switch which can be configured with switch-on time, switch-off time and the days of the week on which the time switch should be active. A timestamp is required as a reference value because the algorithm needs a time context in which to operate. Syntax Definition: FUNCTION_BLOCK FB_ALY_Time Clock_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Is On: BOOL; fb Time Until Next Switch: FB_ALY_Timespan END_VAR 96 Version: 1.5.0 TF3510
## Page 97

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Is On BOOL TRUE if the current time is within the configured On time. fb Time Until Next Swit FB_ALY_Timespan Timespan until the next switching. ch Methods Name Definition Location Description Call() Local method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterize d conditions. Reset() Local Resets all internal states or the calculations made so far. Sample VAR fb Time Clock : FB_ALY_Time Clock_1Ch; fb System Time : FB_ALY_Get System Time; t Time On : LTIME := LTIME#8H; t Time Off : LTIME := LTIME#16H; n Day Of Week Mask : WORD := E_ALY_Day Of Week Mask. Monday To Friday; b Configure : BOOL := TRUE; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Time Clock. Configure(t Time On, t Time Off, n Day Of Week Mask); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Time Clock. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.22.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: TF3510 Version: 1.5.0 97
## Page 98

PLC API METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.22.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL t Time On : LTIME; t Time Off : LTIME; n Day Of Week Mask : WORD; VAR_INPUT END_VAR Inputs Name Type Description t Time On LTIME Time at which the timer should switch on t Time Off LTIME Time at which the timer should switch off n Day Of Week Mask WORD Bit mask for selecting the day of the week on which the timer program is to be executed. 1: Sunday 2: Monday 4: Tuesday 8: Wednesday 16: Thursday 32: Friday 64: Saturday The enumeration E_ALY_Day Of Week Mask [} 429] can be used. Multiple days can be combined with the operator OR. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.22.3 Reset Resetting the algorithm. 98 Version: 1.5.0 TF3510
## Page 99

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.23 FB_ALY_Timer_1Ch The Timer 1Ch starts a timer which can be configured by timer mode and interval. According to the specific timer mode the timer is started, if the configured condition becomes TRUE (TON, TP) or the condition becomes FALSE (TOF). Syntax Definition: FUNCTION_BLOCK FB_ALY_Timer_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Out: BOOL; fb Time Elapsed: FB_ALY_Timespan; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Out BOOL Output value affected by the configured timer. fb Time Elapsed FB_ALY_Timespan Elapsed time. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Pause() Local Method to pause the execution including the internal time intervals. TF3510 Version: 1.5.0 99
## Page 100

PLC API Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Timer : FB_ALY_Timer_1Ch; fb System Time : FB_ALY_Get System Time; e Timer Mode : E_ALY_Timer Mode := E_ALY_Timer Mode. TON; t Interval : LTIME := LTIME#20S; b Configure : BOOL := TRUE; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Timer. Configure(e Timer Mode, t Interval); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Timer. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.23.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.23.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). 100 Version: 1.5.0 TF3510
## Page 101

PLC API Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Timer MOde : E_ALY_Timer Mode; t Interval : LTIME; END_VAR Inputs Name Type Description e Timer Mode E_ALY_Timer Mode [} 431] Mode of the timer: TON: The TON timer is a switch-on delay timer that enables the output after the threshold condition becomes TRUE and the timespan specified in the interval has elapsed. TOF: The TOF timer is a switch-off delay timer that disables the output after the threshold condition becomes FALSE and the timespan specified in the interval has elapsed. TP: The TP timer is a pulse generator that activates the output for the time specified in the interval after the threshold condition becomes TRUE. t Interval LTIME Interval time in which the events are to be considered Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.23.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Level : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Level ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for the input condition. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 101
## Page 102

PLC API 5.1.1.1.23.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.23.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.23.6 Pause With the Pause method it is possible to pause the execution of the function block. The internally running time interval does not continue after calling the pause function. A single call of the method is sufficient. The interval is not continued until the next call of the Call method. Syntax Definition: METHOD Pause : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Pause BOOL Returns TRUE if successful. 102 Version: 1.5.0 TF3510
## Page 103

PLC API 5.1.1.1.24 FB_ALY_Timing Analysis_1Ch The Timing Analysis 1Ch measures time differences between on- and off-periods and counts the amount of on-periods. The on-period starts when the condition of operator and threshold is met. Syntax Definition: FUNCTION_BLOCK FB_ALY_Timing Analysis_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Is On: BOOL; n Count On: ULINT; fb Time Current Interval: FB_ALY_Timespan; fb Time Last Interval : FB_ALY_Timespan; fb Time On Total: FB_ALY_Timespan; fb Time Off Total: FB_ALY_Timespan; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Is On BOOL TRUE within the timespan between the On event and the Off result, otherwise FALSE. n Countn ULINT Counts the number of On events that were triggered. fb Time Current Interv FB_ALY_Timespan Timespan of the current interval. al fb Time Last Interval FB_ALY_Timespan Timespan of the last completed interval. fb Time On Total FB_ALY_Timespan Total time, for which b Is On=TRUE. fb Time Off Total FB_ALY_Timespan Total time, for which b Is On=FALSE. TF3510 Version: 1.5.0 103
## Page 104

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Timing Analysis : FB_ALY_Timing Analysis_1Ch; fb System Time : FB_ALY_Get System Time; st Threshold Edge : ST_ALY_Threshold; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; st Threshold Edge.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge.f Threshold := 1; fb Timing Analysis. Configure Channel(st Threshold Edge); fb Timing Analysis. Configure(); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Timing Analysis. Set Channel Value(n Input); fb Timing Analysis. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.1.24.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR 104 Version: 1.5.0 TF3510
## Page 105

PLC API Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.24.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT END_VAR Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.1.24.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT st Threshold Level : ST_ALY_Threshold; END_VAR Inputs Name Type Description st Threshold Level ST_ALY_Threshold [} 427] Combination of comparison operator and used threshold for on-state. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.1.24.4 Reset Resetting the algorithm. TF3510 Version: 1.5.0 105
## Page 106

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.1.24.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.1.25 FB_ALY_Calendar The Calendar creates a recurring event at certain times. The repeat mode can be set individually. The modes of daily, weekly, monthly or annual repetition are available. A timestamp is required as a reference value, as the algorithm needs a time context in which to work. This reference timestamp is set automatically, if there is another algorithm in the configuration. Therefore, it is not possible to use the Calendar individually. Syntax Definition: FUNCTION_BLOCK FB_ALY_Time Clock_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Event: BOOL; fb Time Until Next Event: FB_ALY_Timespan END_VAR 106 Version: 1.5.0 TF3510
## Page 107

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Event BOOL TRUE when the time for the event is reached. fb Time Until Next Swit FB_ALY_Timespan Timespan until the next event. ch Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure Daily() Local Configuration of the algorithm for daily events. Configure Weekly() Local Configuration of the algorithm for weekly events. Configure Monthly() Local Configuration of the algorithm for monthly events. Configure Yearly() Local Configuration of the algorithm for yearly events. Reset() Local Resets all internal states or the calculations performed so far. Sample VAR fb Calendar : FB_ALY_Calendar; fb System Time : FB_ALY_Get System Time; e Recurrence Mode : E_ALY_Recurrence Mode := E_ALY_Recurrence Mode. Yearly; t Time Event : LTIME := LTIME#8H; b Configure : BOOL := TRUE; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; CASE e Recurrence Mode OF E_ALY_Recurrence Mode. Daily: fb Calendar. Configure Daily(t Time Event); E_ALY_Recurrence Mode. Weekly: fb Calendar. Configure Weekly(t Time Event, E_ALY_Day Of Week Mask. Monday To Friday); E_ALY_Recurrence Mode. Monthly: fb Calendar. Configure Monthly(t Time Event, 0, E_ALY_Recurrence Specification. First, E_ALY_Da y Of Week. Monday); E_ALY_Recurrence Mode. Yearly: fb Calendar. Configure Yearly(t Time Event, 18, E_ALY_Recurrence Specification. Specific Day, E_ ALY_Day Of Week. Unspecified, E_ALY_Month Of Year Mask. November); END_CASE END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Calendar. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3510 Version: 1.5.0 107
## Page 108

PLC API 5.1.1.1.25.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.1.25.2 Configure Daily Configure the algorithm for a daily repetition of the events. Syntax Definition: METHOD Configure : BOOL t Time Event : LTIME; VAR_INPUT END_VAR Inputs Name Type Description t Time Event LTIME Time of the event. Return value Name Type Description Configure Daily BOOL Returns TRUE if successful. 5.1.1.1.25.3 Configure Weekly Configure the algorithm for a weekly repetition of the events. Syntax Definition: METHOD Configure : BOOL t Time Event : LTIME; n Day Of Week Mask : WORD; VAR_INPUT END_VAR 108 Version: 1.5.0 TF3510
## Page 109

PLC API Inputs Name Type Description t Time Event LTIME Time of the event. n Day Of Week Mask WORD Bit mask for selecting the day of the week on which the event is to be generated. 1: Sunday 2: Monday 4: Tuesday 8: Wednesday 16: Thursday 32: Friday 64: Saturday The enumeration E_ALY_Day Of Week Mask [} 429] can be used. Multiple days can be combined with the operator OR. Return value Name Type Description Configure Weekly BOOL Returns TRUE if successful. 5.1.1.1.25.4 Configure Monthly Configure the algorithm for a monthly repetition of the events. Syntax Definition: METHOD Configure : BOOL t Time Event : LTIME; n Day : UINT; e Recurrence Specification : E_ALY_Recurrence Specification; e Day Of Week : E_ALY_Day Of Week; VAR_INPUT END_VAR TF3510 Version: 1.5.0 109
## Page 110

PLC API Inputs Name Type Description t Time Event LTIME Time of the event. n Day UINT Day on which an event is to be created. e Recurrence Specific E_ALY_Recurrence Specific Recurrence specification ation ation [} 434] Specific Day: The event should be created on a specific day. This can be set using the Day parameter. First: The event should be created on the first specified day of the month. The specification is made via the Day Of Week parameter. Last: The event should be created on the last specified day of the month. Specification takes place via the Day Of Week parameter e Day Of Week E_ALY_Day Of Week [} 434] Weekday of the event Unspecified: The event is generated on the first or last day of the month, depending on the e Recurrence Specification parameter. Monday.. Sunday: The event is generated on the first or last set weekday of the month, depending on the e Recurrence Specification parameter. Return value Name Type Description Configure Monthly BOOL Returns TRUE if successful. 5.1.1.1.25.5 Configure Yearly Configure the algorithm for an annual repetition of the events. Syntax Definition: METHOD Configure : BOOL t Time Event : LTIME; n Day : UINT; e Recurrence Specification : E_ALY_Recurrence Specification; e Day Of Week : E_ALY_Day Of Week; n Month Of Year Mask : WORD; VAR_INPUT END_VAR 110 Version: 1.5.0 TF3510
## Page 111

PLC API Inputs Name Type Description t Time Event LTIME Time of the event n Day UINT Day on which an event is to be created. e Recurrence Specific E_ALY_Recurrence Specific Recurrence specification ation ation [} 434] Specific Day: The event should be created on a specific day. This can be set using the Day parameter. First: The event should be created on the first specified day of the month. The specification is made via the Day Of Week parameter. Last: The event should be created on the last specified day of the month. Specification takes place via the Day Of Week parameter e Day Of Week E_ALY_Day Of Week [} 434] Weekday of the event Unspecified: The event is generated on the first or last day of the month, depending on the e Recurrence Specification parameter. Monday.. Sunday: The event is generated on the first or last set weekday of the month, depending on the e Recurrence Specification parameter. n Day Of Week Mask WORD Bit mask for selecting the month on which the event is to be generated. 1: January 2: February 4: March 8: April 16: May 32: June 64: July 128: August 256: September 512: October 1024: November 2048: December The enumeration E_ALY_Month Of Year Mask [} 433] can be used. Multiple days can be combined with the operator OR. Return value Name Type Description Configure Yearly BOOL Returns TRUE if successful. 5.1.1.1.25.6 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. TF3510 Version: 1.5.0 111
## Page 112

PLC API 5.1.1.2 Classification 5.1.1.2.1 FB_ALY_Bandwidth Classificator_1Ch Bandwidth Classifier 1Ch determines whether the input signal is within the configured limits or is less than or greater than the limits. Syntax Definition: FUNCTION_BLOCK FB_ALY_Bandwidth Classificator_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; e Class: E_ALY_Classification_Bounds; fb Time Last Event: FB_ALY_Date Time; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. e Class E_ALY_Classification_Boun Class to which the input values belong (Within Bounds/ Smaller/Bigger). ds [} 428] fb Time Last Event FB_ALY_Date Time Timestamp of the last change of the classification result. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Bandwidth Classificator : FB_ALY_Bandwidth Classificator_1Ch; fb System Time : FB_ALY_Get System Time; f Lower Bound : LREAL := 10.0; f Upper Bound : LREAL := 20.0; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Bandwidth Classificator. Configure(f Lower Bound, f Upper Bound); END_IF 112 Version: 1.5.0 TF3510
## Page 113

PLC API // Get current system time fb System Time. Call(); // Call algorithm fb Bandwidth Classificator. Set Channel Value(n Input); fb Bandwidth Classificator. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.1.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Lower Bound : LREAL; f Upper Bound : LREAL; END_VAR Inputs Name Type Description f Lower Bound LREAL Lower limit for comparison. f Upper Bound LREAL Upper limit for comparison. Return value Name Type Description Configure BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 113
## Page 114

PLC API 5.1.1.2.1.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.2.1.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.2 FB_ALY_Bandwidth Classificator_3Ch Bandwidth Classifier 3Ch determines whether the input signal is within the limits or is less than or greater than the limits. The limits can be configured with input signals, so it is possible to use curves as lower and upper band. Syntax Definition: FUNCTION_BLOCK FB_ALY_Bandwidth Classificator_3Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; e Class: E_ALY_Classification_Bounds; fb Time Last Event: FB_ALY_Date Time; END_VAR 114 Version: 1.5.0 TF3510
## Page 115

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. e Class E_ALY_Classification_Boun Class to which the input values belong (Within Bounds/ Smaller/Bigger). ds [} 428] fb Time Last Event FB_ALY_Date Time Timestamp of the last change of the classification result. Methods Name Definition Location Description Call() Local Method calculates the outputs for a given configuration. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Bandwidth Classificator : FB_ALY_Bandwidth Classificator_3Ch; fb System Time : FB_ALY_Get System Time; f Input Lower Bound : LREAL; f Input Upper Bound : LREAL; n Input : INT; END_VAR // Get current system time fb System Time. Call(); // Call algorithm fb Bandwidth Classificator. Set Channel Value(1, n Input); fb Bandwidth Classificator. Set Channel Value(2, f Input Lower Bound); fb Bandwidth Classificator. Set Channel Value(3, f Input Upper Bound); fb Bandwidth Classificator. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.2.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR TF3510 Version: 1.5.0 115
## Page 116

PLC API Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.2.2 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Data in 2: Lower bound 3: Upper bound Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.3 FB_ALY_Curve Sketcher_1Ch Curve Sketcher 1Ch identifies inversions (peaks and valleys) in an input data stream. Furthermore, local maxima of the absolute difference between two consecutive values (referred to as Delta) can be identified. Analogous to a continuous curve, the identified peaks and valleys correspond to local maxima and minima. Delta corresponds to the slope, so that a maximum of the absolute values of Delta can be associated with an inflection point. Syntax Definition: FUNCTION_BLOCK FB_ALY_Curve Sketcher_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Last Peak: LREAL; fb Time Last Peak: FB_ALY_Date Time; n Count Peaks: ULINT; f Last Valley: LREAL; 116 Version: 1.5.0 TF3510
## Page 117

PLC API fb Time Last Valley: FB_ALY_Date Time; n Count Valleys: ULINT; f Value At Max Delta: LREAL; f Max Delta: LREAL; fb Time Max Delta: FB_ALY_Date Time; n Count Max Delta: ULINT; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Last Peak LREAL Y-value of the last identified peak. fb Time Last Peak FB_ALY_Date Time Timestamp of f Last Peak. n Count Peaks ULINT Total number of peaks counted. f Last Valley LREAL Y-value of the last identified valley. fb Time Last Valley FB_ALY_Date Time Timestamp of f Last Valley. n Count Valleys ULINT Number of valleys detected. f Value At Max Delta LREAL Input variable guided by the last detected maximum of Delta. The Delta value is the difference between this value and the input value from one cycle before. f Max Delta LREAL The last detected local maximum of the absolute difference between two successive values in the input current. fb Time Max Delta FB_ALY_Date Time Timestamp of f Value At Max Delta. n Count Max Delta ULINT Total number of counted local maxima of Delta. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Curve Sketcher : FB_ALY_Curve Sketcher_1Ch; fb System Time : FB_ALY_Get System Time; f Threshold Reversal : LREAL := 0.0; b Calc Inflection : BOOL := FALSE; f Threshold Delta : LREAL := 10.0; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Curve Sketcher. Configure(f Threshold Reversal, b Calc Inflection, f Threshold Delta); END_IF TF3510 Version: 1.5.0 117
## Page 118

PLC API // Get current system time fb System Time. Call(); // Call algorithm fb Curve Sketcher. Set Channel Value(n Input); fb Curve Sketcher. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.3.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.3.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.2.3.3 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR 118 Version: 1.5.0 TF3510
## Page 119

PLC API Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.3.4 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Configuration options • Calculate Inflection: Boolean flag. Maxima of the rate of change are only identified if this flag is True. Otherwise, the values for Count Max Delta, Max Delta, Time Max Delta and Value at Max Delta will not be calculated. • Threshold Reversal: threshold for identifying reversals. Reversals are only detected if their difference from the next reversal exceeds the value of Threshold Reversal. Below are three examples of peak identification using the parameter Threshold Reversal. (a) The value y is identified as a peak immediately after processing the value y because the 3 4 difference between y and y is greater than Threshold Reversal. 3 4 (b) The value y is not identified as a peak because the difference between y and y is smaller than 3 3 4 Threshold Reversal and the curve starts rising again after y . 4 (c) The value y is identified as a peak after processing the value y because the difference between y 2 5 2 and y exceeds Threshold Reversal. The value y cannot be identified as a peak beforehand because 5 2 the difference between y and y (y ) is less than/equal to Threshold Reversal and it is not known 2 3 4 whether the values will continue to decrease. • Threshold Delta: threshold for identifying Delta maxima. Maxima of the absolute difference of two successive values (delta) are detected only if the difference between successive deltas exceeds Threshold Delta. Below are three examples of identifying the Delta maxima with the parameter Threshold Delta . The upper diagrams show the original input signals, the lower ones the corresponding delta. (a) The value y is identified as a maximum after processing the value y because the difference 4 5 between the two deltas exceeds Threshold Delta. (b) No maximum is identified because the difference between the deltas is less than Threshold Delta. (c) The value y is identified as a maximum after processing the value y . 3 6 Regardless of Threshold Delta, at least one maximum of the Delta between two reversals is detected. TF3510 Version: 1.5.0 119
## Page 120

PLC API Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Threshold Reversal : LREAL; b Calc Inflection : BOOL; f Threshold Delta : LREAL; END_VAR Inputs Name Type Description f Threshold Reversal LREAL Threshold for peak analysis b Calc Inflection BOOL Max Delta evaluation f Threshold Delta LREAL Threshold for Delta analysis Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.2.4 FB_ALY_Histogram_1Ch The Histogram 1Ch calculates the distribution of a single channel input value cyclically. It can be configured with minimal bin, maximal bin and the total amount of bins. The dimension of the output array is the number of bins + 2. Because values that are less than the minimal bin are stored in the first array element and values greater than the maximal bin are stored in the last array element. Syntax Definition: FUNCTION_BLOCK FB_ALY_Histogram_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; n Num Values: ULINT; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. n Num Values ULINT Number of values included in the histogram. 120 Version: 1.5.0 TF3510
## Page 121

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Get Results() Local Getting the result array without adding new values. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Initial() Local Method for setting start values for the histogram Sample VAR fb Histogram : FB_ALY_Histogram_1Ch; e Hist Mode : E_ALY_Hist Mode := E_ALY_Hist Mode. Absolute; n Bins : UDINT := 20; f Min Binned : LREAL := 1; f Max Binned : LREAL:= 200; b Configure : BOOL := TRUE; n Input : INT; a Hist Array Out : ARRAY[0..21] OF ULINT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Histogram. Configure(e Hist Mode, n Bins, f Min Binned, f Max Binned); END_IF // Call algorithm fb Histogram. Set Channel Value(n Input); fb Histogram. Call(ADR(a Hist Array Out), SIZEOF(a Hist Array Out)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.4.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT p Hist Array Out : PVOID; n Hist Array Out Size : UDINT; END_VAR TF3510 Version: 1.5.0 121
## Page 122

PLC API Inputs Name Type Description p Hist Array Out PVOID Pointer to histogram array. Dim.: n Bins + 2 The data type depends on the configured mode. Abs: ULINT Rel: LREAL n Hist Array Out Size UDINT Size of the histogram array. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.4.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.2.4.3 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.4.4 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Hist Mode : E_ALY_Hist Mode; 122 Version: 1.5.0 TF3510
## Page 123

PLC API n Bins : UDINT; f Min Binned : LREAL; f Max Minned : LREAL; END_VAR Inputs Name Type Description e Hist Mode E_ALY_Hist Mode [} 433] Operation mode of the histogram. Abs: Absolute values Rel: Relative values to show the percentage distribution. n Bins UDINT Total number of histogram classes to be calculated. f Min Binned LREAL Minimum value to be analyzed. f Max Binned LREAL Maximum value to be analyzed. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.2.4.5 Get Results Get result array without adding new values. Syntax Definition: METHOD Get Results : BOOL VAR_INPUT p Hist Array Out: POINTER TO ULINT; n Hist Array Out Size : UDINT; END_VAR Inputs Name Type Description p Hist Array Out POINTER TO ULINT Pointer to the histogram array. Dim.: n Bins + 2 n Hist Array Out Size UDINT Size of the histogram array. Dim.: n Bins + 2 Return value Name Type Description Get Results BOOL Returns TRUE if successful 5.1.1.2.4.6 Set Inital Initialize internal values of the algorithm. Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT e Hist Mode : E_ALY_Hist Mode; n Num Values : ULINT; p Hist Array In : PVOID; n Hist Array In Size : UDINT; END_VAR TF3510 Version: 1.5.0 123
## Page 124

PLC API Inputs Name Type Description e State Hist Mode E_ALY_Hist Mode [} 433] Operation mode of the histogram. Abs: Absolute values Rel: Relative values to show the percentage distribution. n Num Values ULINT Number of values that will be stored in the histogram. p Hist Array In PVOID Pointer to the histogram array that is to be defined as the output values. The data type depends on the configured mode. Abs: ULINT Rel: LREAL n Hist Array In Size UDINT Size of the histogram array to be defined as the output values. Dim.: n Max – n Min + 3 Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 5.1.1.2.5 FB_ALY_Section Timer_1Ch The Section Timer 1Ch calculates the timespan the input is in range of each configured section. It can be configured with the amount of sections and the borders of each section. Each section is defined with lower border (greater than or equal to) and upper border (less than). The following sections lower border is set by the previous upper border. Values that are less than the minimal border are stored in the first array element. Values that are greater or equal than the maximal border are stored in the last array element. Syntax Definition: FUNCTION_BLOCK FB_ALY_Section Timer_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; n Section: UDINT; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. n Section UDINT Currently classified section of the input. 124 Version: 1.5.0 TF3510
## Page 125

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Get Results() Local Getting the result array without adding new values. Configure() Local General configuration of the algorithm with its parameterized conditions. Set Sections() Local Setting individual sections. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Initial() Local Method for setting start section times. Sample VAR fb Section Timer : FB_ALY_Section Timer_1Ch; fb System Time : FB_ALY_Get System Time; n Num Sections : UDINT := 4; f First Lower Border : LREAL := 10; a Upper Borders : ARRAY[1..4] OF LREAL := [20,30,40,50]; b Configure : BOOL := TRUE; n Input : INT; a Timespans Out : ARRAY [0..5] OF LINT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Section Timer. Configure(n Num Sections); fb Section Timer. Set Sections(f First Lower Border, ADR(a Upper Borders), SIZEOF(a Upper Borders)); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Section Timer. Set Channel Value(n Input); fb Section Timer. Call(fb System Time.t System Time, ADR(a Timespans Out), SIZEOF(a Timespans Out)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.5.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; p Timespan Array Out : POINTER TO LINT; n Timespan Array Out Size : UDINT; END_VAR TF3510 Version: 1.5.0 125
## Page 126

PLC API Inputs Name Type Description t Timestamp ULINT Current timestamp. p Timespan Array Out POINTER TO LINT Pointer to the timespan array. These values are: Dim.: n Num Sections + 2 n Timespan Array Out Size UDINT Size of the timespan array. Dim.: n Num Sections + 2 Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.5.2 Set Inital Initialize internal values of the algorithm. Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT p Timespan Array In : POINTER TO ULINT; n Timespan Array In Size : UDINT; END_VAR Inputs Name Type Description p Timespan Array In POINTER TO ULINT Pointer to timespan array to be set as output values: Dim.: n Num Sections + 2 n Timespan Array In Si UDINT Size of the timespan array to be set as output values. Dim.: ze n Num Sections + 2 Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 5.1.1.2.5.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Num Sections : UDINT; END_VAR Inputs Name Type Description n Num Sections UDINT Configures the number of sections. 126 Version: 1.5.0 TF3510
## Page 127

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.2.5.4 Set Sections Set sections after the FB has been configured. Each section is defined with lower border (greater than or equal to) and upper border (less than). The following sections lower border is set by the previous upper border. The first lower border is set separately. Syntax Definition: METHOD Set Sections : BOOL VAR_INPUT f First Lower Border : LREAL; p Section Config Array : POINTER TO LREAL; n Section Config Array Size : UDINT; END_VAR Inputs Name Type Description f First Lower Border LREAL Configuration of the first lower border. p Section Config Array POINTER TO LREAL Pointer to array of upper section limits: Dim: n Num Sections n Section Config Array UDINT Size of the section configuration array. Dim.: Size n Num Sections Return value Name Type Description Set Sections BOOL Returns TRUE if successful 5.1.1.2.5.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 127
## Page 128

PLC API 5.1.1.2.5.6 Get Results Get result array without adding new values. Syntax Definition: METHOD Get Results : BOOL VAR_INPUT p Timespan Array Out : POINTER TO LINT; n Timespan Array Out Size : UDINT; END_VAR Inputs Name Type Description p Timespan Array Out POINTER TO LINT Pointer to the timespan array. These values are: Dim.: n Num Sections + 2 n Timespan Array Out UDINT Size of the timespan array. Dim.: n Num Sections + 2 Size Return value Name Type Description Get Results BOOL Returns TRUE if successful 5.1.1.2.5.7 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.2.6 FB_ALY_State Histogram_1Ch The State Histogram 1Ch counts how often the input signal (INT) has a specific value between the configured minimum and maximum and shows the distribution in a histogram. The first bar represents the boundary values which are smaller than the minimum and the last bar represents the boundary values which are greater than the maximum. The State Histogram 1Ch is suitable for state-machines to show how often the different states are executed. Syntax Definition: FUNCTION_BLOCK FB_ALY_State Histogram_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; n Num Values: ULINT; END_VAR 128 Version: 1.5.0 TF3510
## Page 129

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. n Num Values ULINT Number of values included in the histogram. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Get Results() Local Getting the result array without adding new values. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Inital() Local Method for setting start values for the histogram Sample VAR fb State Histogram : FB_ALY_State Histogram_1Ch; e State Hist Mode : E_ALY_State Hist Mode := E_ALY_State Hist Mode. Absolute; n Min : LINT := 1; n Max : LINT:= 20; b Configure : BOOL := TRUE; n Input : INT; a Hist Array Out : ARRAY[0..21] OF ULINT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb State Histogram. Configure(e State Hist Mode, n Min, n Max); END_IF // Call algorithm fb State Histogram. Set Channel Value(n Input); fb State Histogram. Call(ADR(a Hist Array Out), SIZEOF(a Hist Array Out)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.6.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: TF3510 Version: 1.5.0 129
## Page 130

PLC API METHOD Call : BOOL VAR_INPUT p Hist Array Out : PVOID; n Hist Array Out Size : UDINT; END_VAR Inputs Name Type Description p Hist Array Out PVOID Pointer to histogram array. The data type depends on the configured mode. Abs: ULINT Rel: LREAL n Hist Array Out Size UDINT Size of the histogram array. Dim.: n Max – n Min + 3 Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.6.2 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.6.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT e State Hist Mode : E_ALY_State Hist Mode; n Min : LINT; n Max : LINT END_VAR 130 Version: 1.5.0 TF3510
## Page 131

PLC API Inputs Name Type Description e State Hist Mode E_ALY_State Hist Mode Operation mode of the histogram. [} 430] Abs: Absolute values Rel: Relative values to show the percentage distribution. n Min LINT Minimum value to be analyzed. n Max LINT Maximum value to be analyzed. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.2.6.4 Get Results Get result array without adding new values. Syntax Definition: METHOD Get Results : BOOL VAR_INPUT p Hist Array Out: PVOID; n Hist Array Out Size : UDINT; END_VAR Inputs Name Type Description p Hist Array Out PVOID Pointer to the histogram array. The data type depends on the configured mode. Abs: ULINT Rel: LREAL n Hist Array Out Size UDINT Size of the histogram array. Dim.: n Max – n Min + 3 Return value Name Type Description Get Results BOOL Returns TRUE if successful 5.1.1.2.6.5 Set Inital Initialize internal values of the algorithm. Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT e State Hist Mode : E_ALY_State Hist Mode; n Num Values : ULINT; p Hist Array In : PVOID; n Hist Array In Size : UDINT; END_VAR TF3510 Version: 1.5.0 131
## Page 132

PLC API Inputs Name Type Description e State Hist Mode E_ALY_State Hist Mode Operation mode of the histogram. [} 430] Abs: Absolute values Rel: Relative values to show the percentage distribution. n Num Values ULINT Number of values that will be stored in the histogram. p Hist Array In PVOID Pointer to the histogram array that is to be defined as the output values. The data type depends on the configured mode. Abs: ULINT Rel: LREAL n Hist Array In Size UDINT Size of the histogram array to be defined as the output values. Dim.: n Max – n Min + 3 Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 5.1.1.2.7 FB_ALY_Threshold Classificator_1Ch Threshold Classifier 1Ch classifies the input values into three different classes: OK, Warning and Alarm according to the configured thresholds. Syntax Definition: FUNCTION_BLOCK FB_ALY_Threshold Classificator_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; e Class: E_ALY_Classification_3Cls; fb Time Last Event Warning: FB_ALY_Date Time; fb Time Last Event Alarm: FB_ALY_Date Time; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. e Class E_ALY_Classification_3Cls Classification result. [} 428] fb Time Last Event Wa FB_ALY_Date Time Timestamp of the last classification as a warning. rning fb Time Last Event Alar FB_ALY_Date Time Timestamp of the last classification as an alarm. m 132 Version: 1.5.0 TF3510
## Page 133

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Threshold Classificator : FB_ALY_Threshold Classificator_1Ch; fb System Time : FB_ALY_Get System Time; f Threshold Level Ok Warning : LREAL := 10; f Threshold Level Warning Alarm : LREAL:= 20; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Threshold Classificator. Configure(f Threshold Level Ok Warning, f Threshold Level Warning Alarm); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Threshold Classificator. Set Channel Value(n Input); fb Threshold Classificator. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.7.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR TF3510 Version: 1.5.0 133
## Page 134

PLC API Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.7.2 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.7.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Threshold Level Ok Warning : LREAL; f Threshold Level Warning Alarm : LREAL; END_VAR Inputs Name Type Description f Threshold Level Ok LREAL The input values that are smaller than the configured Warning threshold are classified as OK. The input values greater than or equal to the configured threshold are classified as Warning. f Threshold Level War LREAL The input values that are smaller than the configured ning Alarm threshold are classified as Warning. The input values greater than or equal to the configured threshold are classified as Alarm. 134 Version: 1.5.0 TF3510
## Page 135

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.2.7.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.2.8 FB_ALY_Threshold String Classificator_1Ch The Threshold String Classifier 1Ch algorithm classifies the input values into three different classes according to the configured thresholds. The class names (output string) can be configured individually as String 1, String 2 and String 3. Syntax Definition: FUNCTION_BLOCK FB_ALY_Threshold String Classificator_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; s Result: STRING(255) := ''; fb Time Last Event: FB_ALY_Date Time; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. s Result STRING(255) Classification result fb Time Last Event FB_ALY_Date Time Timestamp of the last classification change. TF3510 Version: 1.5.0 135
## Page 136

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Threshold String Classificator : FB_ALY_Threshold String Classificator_1Ch; fb System Time : FB_ALY_Get System Time; f Threshold Level12 : LREAL := 10; f Threshold Level23 : LREAL:= 20; s Result1 : STRING := 'This string is set at level 1 ( < 10)'; s Result2 : STRING := 'This string is set at level 2 ( >= 10)'; s Result3 : STRING := 'This string is set at level 3 ( >= 20)'; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Threshold String Classificator. Configure(f Threshold Level12, f Threshold Level23, s Result1, s Result 2, s Result3); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Threshold String Classificator. Set Channel Value(n Input); fb Threshold String Classificator. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.8.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR 136 Version: 1.5.0 TF3510
## Page 137

PLC API Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.8.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.2.8.3 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.8.4 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Threshold Level12 : LREAL; f Threshold Level23 : LREAL; s String Level1 : STRING(255); s String Level2 : STRING(255); s String Level3 : STRING(255); END_VAR TF3510 Version: 1.5.0 137
## Page 138

PLC API Inputs Name Type Description f Threshold Level12 LREAL The input values that are smaller than the configured threshold are classified in the first class. The input values greater than or equal to the configured threshold are classified in the second class. f Upper Bound LREAL The input values that are smaller than the configured threshold are classified in the second class. The input values greater than or equal to the configured threshold are classified in the third class. s String Level1 STRING(255) String to be classified in class 1 s String Level2 STRING(255) String to be classified in class 2 s String Level3 STRING(255) String to be classified in class 3 Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.2.9 FB_ALY_Time Based Envelope_1Ch The Time Based Envelope 1Ch algorithm checks whether the periodic input data is within a configured range of values read from a file. This can be a reference signal that was previously learned with Time Based Teach Path 1Ch, for example. The comparison starts when the signal of the Start Period flag is TRUE. It is recommended not to use Time Based Envelope 1Ch simultaneously with Time Based Teach Path 1Ch due to concurrent file access. Instead, a reference signal should first be taught in with Time Based Teach Path 1Ch and only then should the evaluation be carried out with the aid of the Time Based Envelope 1Ch. Syntax Definition: FUNCTION_BLOCK FB_ALY_Time Based Envelope_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Busy: BOOL; e State: E_ALY_Read State; b Executing Compare: BOOL; n Value Number: ULINT; f Value Read: LREAL; f Band Lower: LREAL; f Band Upper: LREAL; b Within Band: BOOL; e Compare Result: E_ALY_Classification_Bounds; n Current Compared Cycles: ULINT; n Count Within Band: ULINT; n Count Smaller: ULINT; n Count Bigger: ULINT; st File Header: ST_ALY_File Header; END_VAR 138 Version: 1.5.0 TF3510
## Page 139

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Busy BOOL TRUE if the FB is active due to a file access. e State E_ALY_Read State [} 430] Current state of the FB. Necessary due to asynchronous file access. b Executing Compare BOOL TRUE, if the algorithm processes the envelope, otherwise FALSE. The envelope process begins when the flag is b Start Period=TRUE. n Value Number ULINT Value number of the data point in the file that is currently being compared. f Value Read LREAL Value of the data point that is read from a file. f Band Lower LREAL Calculated lower limit. b Within Band BOOL Calculated upper limit. e Compare Result E_ALY_Classification_Boun Class to which the input values belong (Within Bounds/ Smaller/Bigger). ds [} 428] n Current Compared C ULINT Number of cycles compared. ycles n Count Within Band ULINT Counts how often the values were within the band. n Count Smaller ULINT Counts how often the values were smaller than the band. n Count Bigger ULINT Counts how often the values were larger than the band. st File Header ST_ALY_File Header Header information of the file that was read. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Get Busy State() Local This method returns the Busy state of the function block. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Switch State_Idle() Local Initiating the change from state Read to state Idle. See state diagram. Switch State_Read() Local Initiating the change from state Idle to state Read. See state diagram. Update State() Local Updating the state after a state change has been initiated and while the target state has not been reached. State diagram Due to the asynchronous file access in real time applications this function block needs a state machine to prepare and finish file access. TF3510 Version: 1.5.0 139
## Page 140

PLC API At startup the function block is in Idle state. To compare the incoming data with data from file it has to be switched to state Read. Therefore the method Switch State_Read() has to be called once to set the function block to the Pending Read state. After that the method Update State() has to be called until the function block is in state Read. In this state one or multiple comparison cycles can be proceeded. If the function block should not compare additional cycles it can be set to Idle state again. To initiate the state switch the method Switch State_Idle() has to be called. After that the method Update State() has to be called until the function block is in state Idle. State diagram for the read procedure of the data: Sample VAR fb Time Based Envelope : FB_ALY_Time Based Envelope_1Ch; e Band Mode : E_ALY_Band Mode := E_ALY_Band Mode. Absolute; f Band : LREAL := 2.0; n Segment Size : UDINT := 200; t Timeout : TIME := T#5S; s File Path : STRING := 'C:\Twin CAT\3.1\Boot\Time Based Teach.tas'; b Negate Start Period : BOOL := FALSE; b Configure : BOOL := TRUE; e State : E_ALY_Read State := E_ALY_Read State. Idle; b Read : BOOL; f Input : LREAL; b Start Period : BOOL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Time Based Envelope. Configure(e Band Mode, f Band, n Segment Size, t Timeout, s File Path, b Negate Start P eriod); END_IF // Call algorithm e State := fb Time Based Envelope.e State; CASE e State OF E_ALY_Read State. Idle: IF b Read THEN fb Time Based Envelope. Switch State_Read(); fb Time Based Envelope. Update State(); END_IF E_ALY_Read State. Read: fb Time Based Envelope. Set Channel Value(f Input); fb Time Based Envelope. Call(b Start Period:=b Start Period); 140 Version: 1.5.0 TF3510
## Page 141

PLC API IF NOT b Read THEN fb Time Based Envelope. Switch State_Idle(); fb Time Based Envelope. Update State(); END_IF E_ALY_Read State. Pending, E_ALY_Read State. Pending Idle, E_ALY_Read State. Pending Read: fb Time Based Envelope. Update State(); e State := fb Time Based Envelope.e State; END_CASE Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.9.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT b Start Period : BOOL; END_VAR Inputs Name Type Description b Start Period BOOL Rising edge starts reading period. The FB must be in the Read state. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.9.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.2.9.3 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR TF3510 Version: 1.5.0 141
## Page 142

PLC API Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.9.4 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Band Mode : E_ALY_Band Mode; f Band : LREAL; n Segment Size : UDINT; t Timeout : TIME; s File Path : STRING(255); b Negate Start Period : BOOL; END_VAR Inputs Name Type Description e Band Mode E_ALY_Band Mode [} 428] Configuring the band mode Absolute: Upper bound: read value + f Band Lower bound: read value – f Band Relative: Upper bound: read value + (read value * f Band/100) Lower bound: read value - (read value * f Band/100) f Band LREAL Configuring the band depending on the band mode. n Segment Size UDINT Number of buffered elements for file operation. t Timeout TIME Timeout for asynchronous operations. s File Path STRING(255) Path to the taught file, e.g. C:\Twin CAT\3.1\Boot\Teach.tas b Negate Start Period BOOL Negates the input parameter b Start Period. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.2.9.5 Switch State_Idle Initiate switch from Read state to Idle state. See State diagram. Syntax Definition: 142 Version: 1.5.0 TF3510
## Page 143

PLC API METHOD Switch State_Idle : BOOL VAR_INPUT END_VAR Return value Name Type Description Switch State_Idle BOOL Returns TRUE if successful 5.1.1.2.9.6 Switch State_Read Initiate switch from Idle state to Read state. See State diagram. Syntax Definition: METHOD Switch State_Read : BOOL VAR_INPUT END_VAR Return value Name Type Description Switch State_Read BOOL Returns TRUE if successful 5.1.1.2.9.7 Update State Update state after state change was initiated and until target state is not reached. Syntax Definition: METHOD Update State : BOOL VAR_INPUT END_VAR Return value Name Type Description Update State BOOL Returns TRUE if successful 5.1.1.2.9.8 Get Busy State Returns TRUE if the function block is busy due to an asynchronous file access. Syntax Definition: METHOD Get Busy State : BOOL VAR_INPUT END_VAR Return value Name Type Description Get Busy State BOOL Returns TRUE if the FB is active. TF3510 Version: 1.5.0 143
## Page 144

PLC API 5.1.1.2.10 FB_ALY_Step Response_1Ch Step Response 1Ch identifies parameters of the step response of a PT2 track. These include the delay time T , the compensation time T , the settling time T , and the time of maximum t . e b cs m To detect whether the track is steady, a local minimum or maximum is searched for. If this is within the tolerance band (marked in gray), it is assumed that the track is steady. Only then is the settling time set. The algorithm starts when a new setpoint is outside the previously stored tolerance band. Syntax Definition: FUNCTION_BLOCK FB_ALY_Step Response_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Executing: BOOL; fb Equivalent Dead Time: FB_ALY_Timespan; fb Equivalent Time Constant: FB_ALY_Timespan; fb Settling Time: FB_ALY_Timespan; fb Time Max: FB_ALY_Date Time; f Error: LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Executing BOOL TRUE if the parameter identification is active. fb Equivalent Dead Ti FB_ALY_Timespan Delay time of the track. Timespan between the start of the me step response and the intersection of the inflectional tangents with the start value. fb Equivalent Time Co FB_ALY_Timespan Compensation time of the track. Timespan between the nstant intersection point of the inflectional tangents with the start value and the intersection point of the inflectional tangents with the setpoint. fb Settling Time FB_ALY_Timespan Settling time of the track. fb Time Max FB_ALY_Date Time Time of the maximum overshoot. f Error LREAL Difference between input value and setpoint. 144 Version: 1.5.0 TF3510
## Page 145

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Step Response : FB_ALY_Step Response_1Ch; fb System Time : FB_ALY_Get System Time; f Threshold Reversal : LREAL; b Use Relative Tolerance : BOOL; f Error Tolerance : LREAL; b Configure : BOOL := TRUE; f Input : LREAL; f Setpoint : LREAL; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Step Response. Configure(f Threshold Reversal, b Use Relative Tolerance, f Error Tolerance); END_IF // Call algorithm fb Step Response. Set Channel Value(1, f Input); fb Step Response. Set Channel Value(2, f Setpoint); fb Step Response. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.10.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. TF3510 Version: 1.5.0 145
## Page 146

PLC API Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.10.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.2.10.3 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Data In 2: Setpoint Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.10.4 Configure Configuring the algorithm. Configuration options • Threshold Reversal: threshold for identifying reversals. Reversals are only detected if their difference from the next reversal exceeds the value of Threshold Reversal. Below are three examples of peak identification using the parameter Threshold Reversal. (a) The value y is identified as a peak immediately after processing the value y because the 3 4 difference between y and y is greater than Threshold Reversal. 3 4 (b) The value y is not identified as a peak because the difference between y and y is smaller than 3 3 4 Threshold Reversal and the curve starts rising again after y . 4 (c) The value y is identified as a peak after processing the value y because the difference between y 2 5 2 and y exceeds Threshold Reversal. The value y cannot be identified as a peak beforehand because 5 2 the difference between y and y (y ) is less than/equal to Threshold Reversal and it is not known 2 3 4 whether the values will continue to decrease. 146 Version: 1.5.0 TF3510
## Page 147

PLC API Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Threshold Reversal : LREAL; b Use Relative Tolerance : BOOL; f Error Tolerance : LREAL; END_VAR Inputs Name Type Description f Threshold Reversal LREAL Threshold for peak analysis b Use Relative Tolera BOOL Boolean flag. If this flag is True, the parameter Error nce Tolerance refers to the setpoint at the input as a percentage. Otherwise, an absolute tolerance band is taken into account. f Error Tolerance LREAL Specifies the size of the tolerance band in relation to the parameter Relative Tolerance. Since tolerance band is updated when parameter identification is restarted. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.2.11 FB_ALY_Pareto Analysis The Pareto Analysis module allows you to combine different input data to display a Pareto chart. This is used in the following applications, among others: Error analysis: Identifying the most common sources of errors Quality management: Determining the main causes of quality problems Time management: Diagnosis of which tasks take up most of the time Syntax Definition: FUNCTION_BLOCK FB_ALY_Pareto Analysis VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; END_VAR TF3510 Version: 1.5.0 147
## Page 148

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration. FB_init Local Initializes the number of input channels. Get Output Array() Local Getting the result array without adding new values. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Initial() Local Method for setting start values. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample with several input channels VAR fb Pareto Analysis : FB_ALY_Pareto Analysis(n Num Channels := 3); fb System Time : FB_ALY_Get System Time; st Config : ST_ALY_Threshold :=(e Comparison Operator := E_ALY_Comparison Operator. Equals, f Threshol d := 1.0); a Channel Names : ARRAY[1..3] OF STRING(255) := ['First Channel', 'Second Channel', 'Third Channel ']; b Configure : BOOL := TRUE; f Input1 : LREAL; b Input2 : BOOL; n Input3 : INT; a Result : ARRAY[1..3] OF ULINT; a Rel Result : ARRAY[1..3] OF LREAL; a Channel Names Result : ARRAY[1..3] OF STRING(255); END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Pareto Analysis. Configure Channel(1, st Config, a Channel Names[1]); fb Pareto Analysis. Configure Channel(2, st Config, a Channel Names[2]); fb Pareto Analysis. Configure Channel(3, st Config, a Channel Names[3]); fb Pareto Analysis. Configure(E_ALY_Pareto Mode. Timespan); 148 Version: 1.5.0 TF3510
## Page 149

PLC API END_IF // Call algorithm fb Pareto Analysis. Set Channel Value(1, f Input1); fb Pareto Analysis. Set Channel Value(2, b Input2); fb Pareto Analysis. Set Channel Value(3, n Input3); fb Pareto Analysis. Call(fb System Time.t System Time); fb Pareto Analysis. Get Output Array(1, ADR(a Result), SIZEOF(a Result)); fb Pareto Analysis. Get Output Array(2, ADR(a Rel Result), SIZEOF(a Rel Result)); fb Pareto Analysis. Get Output Array(3, ADR(a Channel Names Result), SIZEOF(a Channel Names Result)); Sample with one input channel VAR fb Pareto Analysis : FB_ALY_Pareto Analysis(b Single Input := TRUE, n Num Channels := 3); fb System Time : FB_ALY_Get System Time; st Config : ST_ALY_Threshold :=(e Comparison Operator := E_ALY_Comparison Operator. Equals, f Threshol d := 1.0); a Channel Names : ARRAY[1..3] OF STRING(255) := ['Idle', 'Run', 'Error']; b Configure : BOOL := TRUE; n State : INT; a Result : ARRAY[1..3] OF ULINT; a Rel Result : ARRAY[1..3] OF LREAL; a Channel Names Result : ARRAY[1..3] OF STRING(255); END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; st Config.f Threshold := 0; fb Pareto Analysis. Configure Channel(1, st Config, a Channel Names[1]); st Config.f Threshold := 10; fb Pareto Analysis. Configure Channel(2, st Config, a Channel Names[2]); st Config.f Threshold := 99; fb Pareto Analysis. Configure Channel(3, st Config, a Channel Names[3]); fb Pareto Analysis. Configure(E_ALY_Pareto Mode. Timespan); END_IF // Call algorithm fb Pareto Analysis. Set Channel Value(1, n State); fb Pareto Analysis. Call(fb System Time.t System Time); fb Pareto Analysis. Get Output Array(1, ADR(a Result), SIZEOF(a Result)); fb Pareto Analysis. Get Output Array(2, ADR(a Rel Result), SIZEOF(a Rel Result)); fb Pareto Analysis. Get Output Array(3, ADR(a Channel Names Result), SIZEOF(a Channel Names Result)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.2.11.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. TF3510 Version: 1.5.0 149
## Page 150

PLC API Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.2.11.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Pareto Mode : E_ALY_Pareto Mode; END_VAR Inputs Name Type Description e Pareto Mode E_ALY_Pareto Mode Mode for calculating the output values [} 433] Count: The cycles in which the respective input is TRUE are counted. Timespan: The timespans in which the input is TRUE are added up. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.2.11.3 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT n Channel : UDINT st Threshold Level : ST_ALY_Threshold; s Channel Name : STRING(255); END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for monitoring input values s Channel Name STRING(255) Alias of the input channel 150 Version: 1.5.0 TF3510
## Page 151

PLC API Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.2.11.4 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT b Single Input : BOOL : FALSE; n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description b Single Input BOOL If TRUE, the number of input channels is limited to one. This can be used for processing enumerations, for example. n Num Channels UDINT Initializes the number of channels. If b Single Input is False, this also corresponds to the number of input channels. Return value Name Type Description FB_init BOOL Not used. 5.1.1.2.11.5 Get Output Array Get result array without adding new values. Syntax Definition: METHOD Get Output Array : BOOL VAR_INPUT n Selection : UDINT; p Array Out: PVOID; n Array Out Size: UDINT; END_VAR TF3510 Version: 1.5.0 151
## Page 152

PLC API Inputs Name Type Description n Selection UDINT Selection of the array to be output. 1: Sorted absolute values. The data type depends on the Pareto mode (Count: ULINT | Timespan: LTIME) 2: Accumulated relative output values (LREAL) 3: Sorted alias names of the input channels (STRING(255)) 4: Input index of the sorted absolute values. Start index: 1 p Array Out PVOID Pointer to output array. Dim.: n Num Channels n Array Out Size UDINT Size of the output array. Dim.: n Num Channels Return value Name Type Description Get Results BOOL Returns TRUE if successful 5.1.1.2.11.6 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.2.11.7 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.2.11.8 Set Inital Initialize internal values of the algorithm. 152 Version: 1.5.0 TF3510
## Page 153

PLC API Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT p Array Abs In : POINTER TO ULINT; n Array Abs In Size : UDINT; p Array Idx In : POINTER TO UDINT; n Array Idx In Size : UDINT; END_VAR Inputs Name Type Description p Array Abs In POINTER TO ULINT Pointer to an array with sorted absolute values to be defined as output values. The data type depends on the configured Pareto mode Count: ULINT Timespan: LTIME n Array Abs In Size UDINT Size of the array of sorted absolute values. Dim.: n Num Channels p Array Idx In POINTER TO UDINT Pointer to an array in which the input indices of the sorted absolute values are set. n Array Idx In Size UDINT Size of the index array to be set as the start. Dim.: n Num Channels Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 5.1.1.3 Clustering 5.1.1.3.1 FB_ALY_Den Stream Den Stream is an implementation of the unmonitored, density-based clustering algorithm of the same name [1]. The latter is based on the well-known clustering algorithm DBSCAN [2, 3] and is particularly suitable for data streams whose structures change over time. The number of input channels (referred to below as n) for this algorithm can be selected by the user. These inputs form the n-dimensional feature space in which clusters can be found. In each analysis cycle, the data stream provides the algorithm with a new feature vector that can be interpreted as a data point in this feature space. Clusters are separable areas with a high density of data points in the feature space. In the first phase of the algorithm, the incoming data points are assigned to so-called micro-clusters (MCs). These micro clusters have properties (such as center point, weight and variance) that depend on the data points they contain. Only micro-clusters whose weight exceeds a certain threshold enter the second phase and are clustered by the DBSCAN algorithm. Thus, it is not necessary to retain the information about each data point. This reduces memory requirements, because over time there are far fewer micro-clusters than data points. Also, the computing effort for the DBSCAN algorithm is much lower since it runs over the reduced set of micro-clusters rather than all the data points. It is also possible to apply a fading function to the weights of the micro clusters. In this way, old data points lose their importance to the clustering process over time. This allows the algorithm to capture changes (such as the movement of clusters or their disappearance/appearance over time). The Den Stream algorithm has further advantages over other clustering algorithms. The user does not need to know the number of micro-clusters in advance, as the Den Stream algorithm determines this number automatically. In addition, the algorithm is able to detect outliers in the data that does not belong to any cluster. Since it is a density-based algorithm, it is even possible to detect separate clusters of any shape (even if they are intertwined). TF3510 Version: 1.5.0 153
## Page 154

PLC API Parameter setting Here we give a short introduction to how the algorithm works, mainly to give the reader a quick introduction to the parameter setting. For a deep understanding of the algorithm and its parameters, we refer the reader to the publications mentioned. Most of the terms and parameter names used here come directly from these publications. The parameters of the Den Stream algorithm mainly affect the following properties of the algorithm: • the coarseness of the micro-clusters, • the maximum distance between data points/micro-clusters so that they are assigned to the same cluster, • the minimum density so that data points are identified as clusters and not as outliers, • The fading rate at which older data points lose their significance. The Parameters Epsilon, Lambda and Mu x Beta belong to the first phase of the algorithm, the formation of micro-clusters. If possible, a data point is inserted into the micro-cluster whose center is closest to the data point. For this purpose, the Euclidean distances between the data point and the center points of all micro-clusters are compared and the micro-cluster with the smallest distance is selected. The data point can only be inserted into the micro-cluster if the radius of the micro-cluster does not exceed the Epsilon threshold after insertion. The radius is analogous to the variance of all data points contained in the micro-cluster. This means that data points can also be integrated into a micro-cluster even if their Euclidean distance to the center of the cluster is greater than Epsilon, as long as there are enough other points in the micro cluster with a smaller distance. If the data point cannot be inserted into the nearest micro-cluster, a new micro-cluster is created with that data point. The weight of the respective micro-cluster is increased by one with the insertion of a data point. In the left-hand plot in the illustration, the assignment of the data points to the micro-clusters is sketched for two input channels as an example. 20 data points assigned to four different micro-clusters are shown. The first micro-cluster (#1, marked in red) contains six data points, the second (#2, marked in green) also contains six, the third (#3, marked in blue) contains seven and the fourth (#1, marked in gray) contains only one data point. The area around the center of the micro-cluster in which a new data point would have to be located in order to be accepted into the respective micro-cluster with the specified epsilon (marked by dashed line) is colored. This sphere of influence is greater if the micro-cluster already contains several data points and they have a lower variance (see, for example, micro-clusters #1 and #2). In addition, the spheres of influence of multiple micro-clusters can overlap and mutually influence one another through their existence, see micro-cluster #2 (green) and #3 (blue). The data points are always assigned to the closer micro-cluster, for which reason the spheres of influence are separated by a straight line. In the plot, a data point can be seen that is assigned to the micro-cluster #2, but if the latter did not exist, then it would be assigned to micro-cluster #3. Like in the original study [1], micro-clusters are divided into potential and outlier micro-clusters depending on their weight. Only potential micro-clusters are subsequently clustered by the DBSCAN algorithm. The data points in the outlier micro-clusters are marked as outliers. However, outlier micro-clusters are also stored and updated with new data points, as they can still develop into potential micro-clusters. The weight of a micro- cluster must exceed the Beta x Mu threshold in order to be counted as a potential micro-cluster. In the left- hand sketch in the illustration, for example, the micro-cluster #4 (gray) contains only one data point, thus has a weight of less than or equal to one and would be counted as an outlier micro-cluster for Beta x Mu = 1. When a fading function is applied, the weight of the micro-clusters decreases over time. This fading rate is determined by the parameter Lambda. If the value is set to zero, no fading function is applied, otherwise the weights decrease by a factor of 2^(-Lambda) every second. If the weight of an outlier micro-cluster falls below an internal threshold (depending on Mu x Beta and Lambda), it is deleted from the memory. The parameters Epsilon (DBSCAN) and Min Weight (DBSCAN) affect the second phase. These parameters were adopted from the DBSCAN algorithm [3]. The DBSCAN algorithm runs over the set of potential micro-clusters and assigns them cluster designations. This can be either the index of the cluster to which they belong, or the designation outlier. The data point currently being processed is then assigned the name of the micro-cluster to which it belongs. 154 Version: 1.5.0 TF3510
## Page 155

PLC API How does DBSCAN cluster the micro-clusters? The algorithm works according to the concept of density accessibility. Objects (in this case micro-clusters) belong to the same cluster if they are density-connected. This means that there must be a chain of micro-clusters with a maximum distance Epsilon (DBSCAN). All micro-clusters forming this chain must satisfy a second condition. The sum of the weights of all micro- clusters within the distance Epsilon (DBSCAN) around each individual micro-cluster in this chain must exceed the threshold Min Weight (DBSCAN). Micro-clusters that are not density-connected to at least one micro-cluster that meets this second condition are marked as outliers. This is shown in the right-hand sketch in the illustration. For simplicity, it is assumed here that the weight of all micro-clusters is equal to 1. This corresponds to the case where there is exactly one data point in each micro-cluster and no fading function has been applied. The two clusters (marked with an x (turquoise) and a plus (orange)) with the two outlier micro-clusters result when the Min Weight (DBSCAN) parameter is set to four. The micro-clusters marked with a capital "x" or "+" are core micro-clusters. This means that at least three more micro-clusters (plus the micro cluster considered = 4) have a maximum distance of Epsilon (DBSCAN) to these micro-clusters. The micro-clusters marked with a small "x" or "+" are not core micro- clusters, but are located in the Epsilon (DBSCAN) neighborhood of a core micro-cluster and therefore belong to the same cluster. The micro-cluster in the upper right corner, marked with a small dot, is an outlier micro- cluster. Although it is located in the Epsilon (DBSCAN) neighborhood of a micro-cluster that is counted as belonging to a cluster, it is not a core micro-cluster. Likewise, the two micro-clusters at the bottom right are outliers. Although they are in the immediate Epsilon (DBSCAN) neighborhood, there are only two of them. The Min Weight (DBSCAN) threshold of the weights is not exceeded. The parameters out MCs Buffer Size and pot MCs Buffer Size are specific to this implementation of the algorithm and are required because the memory for outliers and potential micro-clusters must be allocated before execution. Thus, out MCs Buffer Size and pot MCs Buffer Size limit the possible number of outliers and potential micro-clusters during runtime. The user must find values for these parameters so that this limit is not exceeded. The maximum number of outliers and potential micro-clusters during the execution of the algorithm depends on the distribution of the input data, but also on the setting of the other parameters. There are fewer micro- clusters at higher values of Epsilon as this results in coarser micro-clusters that can contain data points from a wider range. In general, the number of outlier micro-clusters increases at the beginning of the analysis, but decreases again when outlier micro-clusters transform into potential micro-clusters. If the patterns in the data stream do not change over time, the number of micro-clusters settles after an initial phase. The more micro-clusters there are, the higher the computing requirements. For all outliers and potential micro-clusters we compare the distance to a data point and then all potential micro-clusters must be included in the calculation of the DBSCAN algorithm. A compromise must therefore be reached between the computing speed and the coarseness of the micro-clusters. TF3510 Version: 1.5.0 155
## Page 156

PLC API What happens if the values of out MCs Buffer Size and pot MCs Buffer Size are set too low and at some point during the analysis more micro-clusters are required to capture the input data points? In this case, the algorithm continues to assign the data points to the existing micro-clusters and marks the data points accordingly, but the existing micro-clusters are no longer updated to prevent the buffer from overflowing. This means that the clustering of the data points continues, but with an overall stagnated feature space (older set of micro-clusters). Changes in the pattern of the data stream could then no longer be detected. [1] F. Cao, M. Ester, W. Qian, A. Zhou. Density-Based Clustering over an Evolving Data Stream with Noise. In Proceedings of the 2006 SIAM International Conference on Data Mining, S. 326-337. SIAM. [2] M. Ester, H.-P. Kriegel, J. Sander and X. Xu. A density-based algorithm for discovering clusters in large spatial databases with noise. In Proc. of KDD, 1996. [3] J. Sander, M. Ester, H.-P. Kriegel, X. Xu. Density-Based Clustering in Spatial Databases: The Algorithm GDBSCAN and its Applications. Data Mining and Knowledge Discovery 2, 169-194 (1998) Syntax Definition: FUNCTION_BLOCK FB_ALY_Den Stream VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; n Cluster Idx: DINT; n Num Clusters: DINT; fb Time Last Event: FB_ALY_Date Time; fb Time Last Switch: FB_ALY_Date Time; b Overflow: BOOL; n Num Pot MCs: UDINT; n Num Out MCs: UDINT; END_VAR 156 Version: 1.5.0 TF3510
## Page 157

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. n Cluster Idx DINT Specifies the cluster index that the DBSCAN algorithm outputs for the data point of the current cycle. n Num Clusters DINT Specifies the total number of clusters detected by the DBSCAN algorithm. fb Time Last Event FB_ALY_Date Time This is the timestamp of the last cycle with a change of the cluster index fb Time Last Switch FB_ALY_Date Time This is the timestamp of the last cycle with an alternation between updating and not updating micro-clusters (either by setting input b Update Micro Cluster to TRUE or by internally preventing an overflow of n Pot MCs Buffer Size or n Out MCBuffer Size) b Overflow BOOL TRUE when the micro-cluster update is stopped to prevent n Pot MCs Buffer Size or n Out MCs Buffer Size from overflowing. n Num Pot MCs UDINT Indicates the number of potential micro-clusters currently present. n Num Out MCs UDINT Indicates the number of outlier micro-clusters currently present. Sample VAR fb Den Stream : FB_ALY_Den Stream(n Num Channels := 2); fb System Time : FB_ALY_Get System Time; f Eps : LREAL := 0.15; f Mu Beta : LREAL := 2; f Lambda : LREAL := 0; f Eps_DBSCAN : LREAL := 0.8; f Min Weight_DBSCAN : LREAL := 2; n Pot MCs Buffer Size : UDINT := 100; n Out MCs Buffer Size : UDINT := 100; b Configure : BOOL := TRUE; n Input Ch1 : UDINT; f Input Ch2 : LREAL; b Update MCs : BOOL := TRUE; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Den Stream. Configure( f Eps := f Eps, f Mu Beta := f Mu Beta, f Lambda := f Lambda, f Eps DBSCAN := f Eps_DBSCAN, f Min Weight DBSCAN:= f Min Weight_DBSCAN, n Pot MCs Buffer Size := n Pot MCs Buffer Size, n Out MCs Buffer Size := n Out MCs Buffer Size); END_IF // Get current system time fb System Time. Call(); TF3510 Version: 1.5.0 157
## Page 158

PLC API // Call algorithm fb Den Stream. Set Channel Value(1, n Input Ch1); fb Den Stream. Set Channel Value(2, f Input Ch2); fb Den Stream. Call(t Timestamp := fb System Time.t System Time, b Update MCs := b Update MCs); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. 5.1.1.3.1.1 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.3.1.2 FB_init Initializes the number of input channels, the number of cluster centers and the size of the aggregation buffer. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; 158 Version: 1.5.0 TF3510
## Page 159

PLC API n Num Clusters : UDIn T := 1; n Agg Buffer Size : UDINT := 10; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. n Num Clusters UDINT Defines the number of clusters. n Agg Buffer Size UDINT Specifies the number of cycles after which the cluster centers are updated. The input values over this number of cycles are buffered internally (in the aggregation buffer). Return value Name Type Description FB_init BOOL Not used. 5.1.1.3.1.3 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; b Update MCs : BOOL; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. b Update MCs BOOL TRUE: The micro-clusters are updated by the incoming data. FALSE: The existing micro-clusters remain unchanged and are only used to determine the cluster index of the incoming data points. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.3.1.4 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Eps : LREAL; TF3510 Version: 1.5.0 159
## Page 160

PLC API f Mu Beta : LREAL; f Lambda : LREAL; f Eps DBSCAN : LREAL; f Min Weight DBSCAN : LREAL; n Pot MCs Buffer Size : UDINT; n Out MCs Buffer Size : UDINT; END_VAR Inputs Name Type Description n Eps LREAL Threshold for the maximum radius of micro-clusters. f Mu Beta LREAL Threshold for the weight of a micro-cluster between outlier and potential micro-cluster. f Lambda LREAL Specifies the forgetting rate of the algorithm. The weight of each data point decreases by a factor of 2^(-f Lambda) every second. f Eps DBSCAN LREAL Specifies the epsilon parameter of the DBSCAN algorithm. f Min Weight DBSCAN LREAL Threshold for the sum of weights in the epsilon neighborhood of a micro-cluster for the DBSCAN algorithm. n Pot MCs Buffer Size UDINT Maximum number of potential micro-clusters. The memory is allocated to pot MCs Buffer Size micro-clusters. n Out MCs Buffer Size UDINT Maximum number of outlier micro-clusters. The memory is allocated to out MCs Buffer Size micro-clusters. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.3.1.5 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.3.2 FB_ALY_Sequential KMeans The Sequential k-Means algorithm is an implementation of the unmonitored clustering algorithm of the same name. It is a sequential variant of the widely used k-Means clustering algorithm for streaming data. The aim of the algorithm is to find clusters based on the structure of the data, each of which contains similar data points and separates different data points from each other. The number of input channels (referred to below as n) for this algorithm can be freely selected by the user. These inputs span the n-dimensional feature space in which the clusters are found. In each analysis cycle, the data stream provides the algorithm with a new feature vector that can be interpreted as a data point in this feature space. Data points that are close to each other in this feature space are assigned to the same cluster. The number of clusters present must be set by the user before the analysis begins and remains fixed. 160 Version: 1.5.0 TF3510
## Page 161

PLC API In contrast to the k-Means algorithm for conventional batch analysis, the data for the Sequential k-Means are not fully available at the time of analysis. Instead, the data points arrive one by one in the form of streaming data. They are therefore processed sequentially and assigned to the corresponding cluster closest to them. This approach results in a number of differences, two of which are particularly relevant to the use of the algorithm as well as the parameter settings. On the one hand, all data points and thus the value ranges of the individual features are already available at the beginning of a batch analysis, whereas this is not the case with sequential analysis, so that the value ranges are not necessarily fixed in advance. However, it is helpful to know the value ranges of the input channels in advance, even if the actual values only arrive during the course of the analysis. This is particularly important for the initialization of cluster centers. Three different approaches are available for initialization. The center points can be specified in the form of specific values via a parameter array. Alternatively, the center points can be set randomly or equidistantly in a defined range of values. For the initialization modes Random and Equidistant the value ranges are required and have to be set via the parameters Lower Bounds and Upper Bounds for the individual input channels. On the other hand, in a batch analysis all data points are typically traversed multiple times to update the cluster centers until they change only minimally. This is not possible within the framework of the sequential analysis. However, in order to still be able to adjust the cluster centers and traverse data points multiple times, the algorithm Sequential k-Means has a buffering mechanism referred to as Aggregation Buffer, which makes it possible to store a limited number of values temporarily. When filling the buffer, all incoming data points are assigned to the closest cluster. The distance between a data point and the cluster centers is determined by the Euclidean norm. Only when the buffer is filled are the cluster centers updated based on the newly allocated data points in the buffer. The new cluster center corresponds to the mean value of all data points contained in the cluster. This can be calculated incrementally, so that the old data points are not needed for the calculation. The size of the buffer is set by the parameter Aggregation Buffer Size; the default value is 10. The parameter Max Iterations can be used to specify the number of iterations through the buffer. The default value is one. If the value is set to two, for example, after the first adjustment of the cluster centers the data points in the buffer are reassigned to the clusters and then the cluster centers are adjusted again. Due to the shift in cluster centers, it is possible for individual data points to be assigned to different clusters from one iteration to the next. Due to the limited computing capacity for data processing between two cycles, excessively high values should be avoided for the parameters Aggregation Buffer Size and Max Iterations, otherwise the update of the cluster centers may not be guaranteed. If the cluster centers are not updated for large values for these parameters but are updated for smaller parameter values, this is an indication that the computing capacity is insufficient for the set parameter values and smaller values should be selected. Syntax Definition: FUNCTION_BLOCK FB_ALY_Sequential KMeans VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; n Cluster Idx: DINT; f Distance: LREAL; END_VAR TF3510 Version: 1.5.0 161
## Page 162

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. n Cluster Idx DINT Specifies the cluster index that the DBSCAN algorithm outputs for the data point of the current cycle. f Distance LREAL Specifies the total number of clusters detected by the DBSCAN algorithm. Sample VAR fb Sequential KMeans : FB_ALY_Sequential KMeans(n Num Channels := 2, n Num Clusters := 3, n Agg Buffer Siz e := 10); n Max Iterations : UDINT :=1; e Init Mode : E_ALY_KMeans Init Mode := E_ALY_KMeans Init Mode. Values; a Initial Cluster Centers : ARRAY[1..3] OF ARRAY[1..2] OF LREAL := [[-30, 0], [10, 2], [30, 4]]; b Configure : BOOL := TRUE; n Input Ch1 : UDINT; f Input Ch2 : LREAL; b Update Cluster Centers : BOOL := TRUE; a Cluster Centers : ARRAY[1..3] OF ARRAY[1..2] OF LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Sequential KMeans. Configure(n Max Iterations := n Max Iterations, e Init Mode := e Init Mode); fb Sequential KMeans. Set Initial Cluster Centers(ADR(a Initial Cluster Centers), SIZEOF(a Initial Cluster C enters)); END_IF // Call algorithm fb Sequential KMeans. Set Channel Value(1, n Input Ch1); fb Sequential KMeans. Set Channel Value(2, f Input Ch2); fb Sequential KMeans. Call(b Update Cluster Centers, ADR(a Cluster Centers), SIZEOF(a Cluster Centers)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 162 Version: 1.5.0 TF3510
## Page 163

PLC API Methods Name Definition lo- Description cation Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. FB_init() Local Initializes the number of input channels. Get Results() Local Getting the result matrix without adding new values Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Initial Bounds() Local Sets the initial boundaries. Depends on the configured initialization mode. Set Initial Cluster Centers() Local Sets the initial cluster centers. Depends on the configured initialization mode. 5.1.1.3.2.1 FB_init Initializes the number of input channels, the number of cluster centers and the size of the aggregation buffer. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; n Num Clusters : UDIn T := 1; n Agg Buffer Size : UDINT := 10; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. n Num Clusters UDINT Defines the number of clusters. n Agg Buffer Size UDINT Specifies the number of cycles after which the cluster centers are updated. The input values over this number of cycles are buffered internally (in the aggregation buffer). Return value Name Type Description FB_init BOOL Not used. 5.1.1.3.2.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: TF3510 Version: 1.5.0 163
## Page 164

PLC API METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; b Update MCs : BOOL; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. b Update MCs BOOL TRUE: The micro-clusters are updated by the incoming data. FALSE: The existing micro-clusters remain unchanged and are only used to determine the cluster index of the incoming data points. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.3.2.3 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Max Iterations : UDINT; e Init Mode : E_ALYKMeans Init Mode; END_VAR Inputs Name Type Description n Max Iterations UDINT Specifies how often to iterate over the values in the aggregation buffer. The default is 1. e Init Mode E_ALY_KMeans Init Mode Specifies which method is used to set the initial values for the cluster centers: [} 432] Random: The cluster centers are set randomly in the bounds set by Lower Bounds and Upper Bounds. The bounds can be set after configuration with the method Set Initial Bounds [} 165]. Euqidistant: The cluster centers are distributed equidistantly in the range of values defined by the Lower Bounds and Upper Bounds. The bounds can be set after configuration with the method Set Initial Bounds [} 165]. Values: The cluster centers are initialized with the values set by initial cluster centers. The cluster centers can be set after configuration using the Set Initial Cluster Centers [} 166] method. 164 Version: 1.5.0 TF3510
## Page 165

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.3.2.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.3.2.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.3.2.6 Set Initial Bounds Sets the initial boundaries. Depends on the configured initialization mode. Syntax Definition: METHOD Set Initial Bounds : BOOL VAR_INPUT p Lower Bounds Config Array : POINTER TO LREAL; n Lower Bounds Config Array Size : UDINT; p Upper Bounds Config Array : POINTER TO LREAL; n Upper Bounds Config Array Size : UDINT; END_VAR TF3510 Version: 1.5.0 165
## Page 166

PLC API Inputs Name Type Description p Lower Bounds Confi POINTER TO LREAL Pointer to an array containing the lower values of the g Array bounds to be initialized. Dim.: n Num Channels n Lower Bounds Confi UDINT Size of the array with the lower values of the limits to be g Array Size initialized. p Upper Bounds Confi POINTER TO LREAL Pointer to an array containing the upper values of the g Array bounds to be initialized. Dim.: n Num Channels n Upper Bounds Confi UDINT Size of the array with the upper values of the limits to be g Array Size initialized. Return value Name Type Description Set Initial Bounds BOOL Returns TRUE if successful. 5.1.1.3.2.7 Set Initial Cluster Centers Sets the initial cluster centers. Depends on the configured initialization mode. Syntax Definition: METHOD Set Initial Cluster Centers : BOOL VAR_INPUT p Initial Cluster Center Matrix : POINTER TO LREAL; n Initial Cluster Center Matrix Size : UDINT; END_VAR Inputs Name Type Description p Initial Cluster Center POINTER TO LREAL Pointer to a matrix with initial cluster centers. Dim.: Matrix n Num Channels*n Num Clusters n Initial Cluster Center UDINT Size of the matrix with initial cluster centers. Matrix Size Return value Name Type Description Set Initial Cluster Cent BOOL Returns TRUE if successful. ers 5.1.1.3.2.8 Get Results Retrieves the result matrix without adding new values. Syntax Definition: METHOD Get Results : BOOL VAR_INPUT p Cluster Center Matrix Out : POINTER TO LREAL; n Cluster Center Matrix Out Size : UDINT; END_VAR 166 Version: 1.5.0 TF3510
## Page 167

PLC API Inputs Name Type Description p Cluster Center Matri POINTER TO LREAL Pointer to cluster center matrix. Dim.: x Out n Num Channels*n Num Clusters n Cluster Center Matri UDINT Size of the cluster center matrix x Out Return value Name Type Description Get Results BOOL Returns TRUE if successful. 5.1.1.4 Compare 5.1.1.4.1 FB_ALY_Demultiplexer The demultiplexer selects an output channel based on the input value. For this purpose, the input value is interpreted as an integer. This value corresponds to the output channel. If the value is outside the configured number of channels, the output channel is set to 0. Syntax Definition: FUNCTION_BLOCK FB_ALY_Demultiplexer VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Switched: BOOL; n Current Channel: UDINT; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Switched BOOL TRUE if a channel change has taken place. n Current Channel UDINT Indicates the number of the selected channel. The value is 0 if the selected channel is outside the configured channels. n Count ULINT Starts with 1 for the channel selected at the start of the analysis and increments each time another channel is selected. fb Time Last Event FB_ALY_Date Time Timestamp of the last channel change. TF3510 Version: 1.5.0 167
## Page 168

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Get Results() Local Getting the result array without adding new values FB_init() Local Initializes the number of output channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing channel-specific values to the algorithm. Sample VAR fb Demultiplexer : FB_ALY_Demultiplexer(n Num Channels := 3); fb System Time : FB_ALY_Get System Time; n Input : INT := 1; a Results : ARRAY[0..3] OF BOOL; END_VAR // Get current system time fb System Time. Call(); // Call algorithm fb Demultiplexer. Set Channel Value(n Input); fb Demultiplexer. Call(fb System Time.t System Time, ADR(a Results), SIZEOF(a Results)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.1.1 FB_init Initializes the number of output channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used. 5.1.1.4.1.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). 168 Version: 1.5.0 TF3510
## Page 169

PLC API Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; p Data Out : POINTER TO BOOL; n Data Out Size : UDINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. p Data Out POINTER TO BOOL Pointer to the result array of the output channels. Dim.: n Num Channels+1 n Data Out Size UDINT Size of the result array. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.1.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.1.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 169
## Page 170

PLC API 5.1.1.4.1.5 Get Results Retrieves a result array without adding new values. Syntax Definition: METHOD Get Results : BOOL VAR_INPUT p Data Out : POINTER TO BOOL; n Data Out Size : UDINT; END_VAR Inputs Name Type Description p Data Out POINTER TO BOOL Pointer to the result array of the output channels. Dim.: n Num Channels+1 n Data Out Size UDINT Size of the result array. Return value Name Type Description Get Results BOOL Returns TRUE if successful. 5.1.1.4.2 FB_ALY_Detect String Change_1Ch The Detect String Change 1Ch detects and counts changes of string values. Therefore, case sensitivity can be taken into account or not. Syntax Definition: FUNCTION_BLOCK FB_ALY_Detect String Change_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b String Changed: BOOL; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. 170 Version: 1.5.0 TF3510
## Page 171

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b String Changed BOOL TRUE, if a change in the input string was detected, otherwise FALSE. n Count ULINT Count up each time, if b String Changed=TRUE. fb Time Last Event FB_ALY_Date Time Timestamp of the last detected string change. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Detect String Change : FB_ALY_Detect String Change_1Ch; fb System Time : FB_ALY_Get System Time; b Case Sensitive : BOOL := TRUE; b Configure : BOOL := TRUE; s Input : STRING := 'Modify'; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Detect String Change. Configure(b Case Sensitive); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Detect String Change. Set Channel Value(s Input); fb Detect String Change. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.2.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). TF3510 Version: 1.5.0 171
## Page 172

PLC API Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.2.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.2.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT b Case Sensitive : BOOL; END_VAR Inputs Name Type Description b Case Sensitive BOOL If TRUE, upper and lower case is taken into account. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.4.2.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: 172 Version: 1.5.0 TF3510
## Page 173

PLC API METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.4.3 FB_ALY_Dynamic Time Warping The Dynamic Time Warping algorithm compares input data with previously recorded templates. The special feature of the algorithm is that signals with different speeds or even shifted signals can be compared. As a result, the distance between the input signal and the respective template is output. The smaller the distance, the more equal the compared signals are. If the distance is 0, both signals are identical. The amount of distance depends on the equality but also on the length of the signals. The comparison starts when the signal of the Start Period flag is TRUE. A result is output if the signal of the Stop Period flag is TRUE or the Start Period flag is TRUE again. It is recommended not to use Dynamic time Warping simultaneously with Time Based Teach Path 1Ch due to concurrent file access. Instead, a reference signal should first be taught in with the Time Based Teach Path 1Ch and only then should the evaluation be carried out with the aid of the Dynamic time Warping. The templates contain reference signals previously recorded with the Time Based Teach Path 1Ch. As a rule, the templates are a few hundred supporting points. Therefore, a reduction of the data with the function block Downsampling 1Ch is often useful. Syntax Definition: FUNCTION_BLOCK FB_ALY_Dynamic Time Warping VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Busy: BOOL; e State: E_ALY_Read State; b Executing Compare: BOOL; n Best Match Idx: ULINT; f Value Read: LREAL; st File Header: ST_ALY_File Header; END_VAR TF3510 Version: 1.5.0 173
## Page 174

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Busy BOOL TRUE if the FB is active due to a file access. e State E_ALY_Read State [} 430] Current state of the FB due to asynchronous file accesses. b Executing Compare BOOL TRUE, if the algorithm processes the envelope, otherwise FALSE. The envelope process begins when the flag is b Start Period=TRUE. n Best Match Idx UDINT Outputs the index of the template with the smallest distance to the input channel. st File Header ST_ALY_File Header Header information of the last read file. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Configures the file paths of the templates. FB_init() Local Initializes the number of templates. Get Busy State() Local This method returns the Busy state of the function block. Get Channel Output Vaue Local Method for getting individual output values from the output () array Get Channel Output Array Local Method for getting the entire output array. () Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Switch State_Idle() Local Initiating the change from state Read to state Idle. See state diagram. Switch State_Read() Local Initiating the change from state Idle to state Read. See state diagram. Update State() Local Updating the state after a state change has been initiated and while the target state has not been reached. State diagram Due to the asynchronous file access in real time applications this function block needs a state machine to prepare and finish file access. At startup the function block is in Idle state. To compare the incoming data with data from file it has to be switched to state Read. Therefore the method Switch State_Read() has to be called once to set the function block to the Pending Read state. After that the method Update State() has to be called until the function block is in state Read. In this state one or multiple comparison cycles can be proceeded. If the function block 174 Version: 1.5.0 TF3510
## Page 175

PLC API should not compare additional cycles it can be set to Idle state again. To initiate the state switch the method Switch State_Idle() has to be called. After that the method Update State() has to be called until the function block is in state Idle. State diagram for the read procedure of the data: Sample VAR fb Dynamic Time Warping : FB_ALY_Dynamic Time Warping(n Num Channels := 3); t Timeout : TIME := T#5S; s File Path1 : STRING := 'C:\Twin CAT\3.1\Boot\Template1.tas'; s File Path2 : STRING := 'C:\Twin CAT\3.1\Boot\Template2.tas'; s File Path3 : STRING := 'C:\Twin CAT\3.1\Boot\Template3.tas'; b Configure : BOOL := TRUE; e State : E_ALY_Read State := E_ALY_Read State. Idle; b Read : BOOL; f Input : LREAL; b Start Period : BOOL; b Stop Period : BOOL; a Distances : ARRAY[1..3] OF LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Dynamic Time Warping. Configure Channel(1, s File Path1); fb Dynamic Time Warping. Configure Channel(2, s File Path2); fb Dynamic Time Warping. Configure Channel(3, s File Path3); fb Dynamic Time Warping. Configure(t Timeout); END_IF // Call algorithm e State := fb Dynamic Time Warping.e State; CASE e State OF E_ALY_Read State. Idle: IF b Read THEN fb Dynamic Time Warping. Switch State_Read(); fb Dynamic Time Warping. Update State(); END_IF E_ALY_Read State. Read: fb Dynamic Time Warping. Set Channel Value(f Input); fb Dynamic Time Warping. Call(b Start Period:=b Start Period, b Stop Period:=b Stop Period); IF NOT b Read THEN fb Dynamic Time Warping. Switch State_Idle(); TF3510 Version: 1.5.0 175
## Page 176

PLC API fb Dynamic Time Warping. Update State(); END_IF E_ALY_Read State. Pending, E_ALY_Read State. Pending Idle, E_ALY_Read State. Pending Read: fb Dynamic Time Warping. Update State(); e State := fb Dynamic Time Warping.e State; END_CASE // Get results fb Dynamic Time Warping. Get Output Array(p Array Out:=ADR(a Distances), n Array Out Size:=SIZEOF(a Distances)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.3.1 FB_init Initializes the number of comparison channels (templates). Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Number of comparison channels (templates) Return value Name Type Description FB_init BOOL Not used. 5.1.1.4.3.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT b Start Period : BOOL; b Stop Period : BOOL; END_VAR Inputs Name Type Description b Start Period BOOL Rising edge starts the calculation. The FB must be in the Read state. b Stop Period BOOL Rising edge stops the calculation. The results are output. The FB must be in the Read state. 176 Version: 1.5.0 TF3510
## Page 177

PLC API Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.3.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT t Timeout : TIME; END_VAR Inputs Name Type Description t Timeout TIME Timeout for asynchronous operations. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.4.3.4 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT n Channel : UDINT; s File Path : STRING(255); END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) s File Path STRING(255) Path to the taught file, e.g. C:\Twin CAT\3.1\Boot\Teach.tas Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.4.3.5 Reset Resetting the algorithm. TF3510 Version: 1.5.0 177
## Page 178

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.3.6 Get Busy State Returns TRUE if the function block is busy due to an asynchronous file access. Syntax Definition: METHOD Get Busy State : BOOL VAR_INPUT END_VAR Return value Name Type Description Get Busy State BOOL Returns TRUE if the FB is active. 5.1.1.4.3.7 Get Channel Output Value Fetching a channel-specific output value. The output value corresponds to the distance between the input signal and the respective template. The smaller the distance, the more equal the compared signals are. The value is updated only if the Call() method has been called before. Syntax Definition: METHOD Get Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) output ANY Output value of any data type. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alue 5.1.1.4.3.8 Get Output Array Getting the entire output array. The array elements correspond to the distance between the input signal and the respective template. The smaller the distance, the more equal the compared signals are. The number of elements corresponds to the configured number of comparison channels (templates). The values are updated only if the Call() method has been called before. 178 Version: 1.5.0 TF3510
## Page 179

PLC API Syntax Definition: METHOD Get Output Array : BOOL VAR_INPUT p Array Out : POITNER TO LREAL; n Array Out Size : ANY; END_VAR Inputs Name Type Description p Array Out POINTER TO LREAL Pointer to the output array: Dim: n Buffer Size n Array Out Size UDINT Size of the output array Return value Name Type Description Get Output Array BOOL Returns TRUE if successful. 5.1.1.4.3.9 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.4.3.10 Switch State_Idle Initiate switch from Read state to Idle state. See State diagram. Syntax Definition: METHOD Switch State_Idle : BOOL VAR_INPUT END_VAR Return value Name Type Description Switch State_Idle BOOL Returns TRUE if successful TF3510 Version: 1.5.0 179
## Page 180

PLC API 5.1.1.4.3.11 Switch State_Read Initiate switch from Idle state to Read state. See State diagram. Syntax Definition: METHOD Switch State_Read : BOOL VAR_INPUT END_VAR Return value Name Type Description Swithc State_Read BOOL Returns TRUE if successful 5.1.1.4.3.12 Update State Update state after state change was initiated and until target state is not reached. Syntax Definition: METHOD Update State : BOOL VAR_INPUT END_VAR Return value Name Type Description Update State BOOL Returns TRUE if successful 5.1.1.4.4 FB_ALY_Dynamic Time Warping Interval The Dynamic Time Warping Interval algorithm compares several input data with each other. The special feature of the algorithm is that signals with different speeds or even shifted signals can be compared. Only the signal interval of a configured window is considered for the comparison. New results are output after the window expires. As a result, the distance between the reference signal and the respective input signal is output. The smaller the distance, the more equal the compared signals are. If the distance is 0, both signals are identical. The amount of distance depends on the equality but also on the length of the signals. Syntax Definition: FUNCTION_BLOCK FB_ALY_Dynamic Time Warping Interval VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; n Best Match Idx: UDINT; END_VAR 180 Version: 1.5.0 TF3510
## Page 181

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. n Best Match Idx UDINT Outputs the index of the input channel with the smallest distance to the reference channel. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local Configuration of the algorithm. FB_init() Local Initializes the number of input channels. Get Channel Output Vaue Local Method for getting individual output values from the output () array Get Channel Output Array Local Method for getting the entire output array. () Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Dynamic Time Warping Interval : FB_ALY_Dynamic Time Warping Interval(n Num Channels := 3); n Window Size : UDINT := 100; b Configure : BOOL := TRUE; f Reference : LREAL; f Input1 : LREAL; f Input2 : LREAL; f Input3 : LREAL; a Distances : ARRAY[1..3] OF LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Dynamic Time Warping Interval. Configure(n Window Size); END_IF // Call algorithm fb Dynamic Time Warping Interval. Set Channel Value(0, f Reference); fb Dynamic Time Warping Interval. Set Channel Value(1, f Input1); fb Dynamic Time Warping Interval. Set Channel Value(2, f Input2); fb Dynamic Time Warping Interval. Set Channel Value(3, f Input3); fb Dynamic Time Warping Interval. Call(); // Get results fb Dynamic Time Warping Interval. Get Output Array(p Array Out:=ADR(a Distances), n Array Out Size:=SIZEOF(a Dista nces)); TF3510 Version: 1.5.0 181
## Page 182

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.4.1 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used. 5.1.1.4.4.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.4.3 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Window Size : UDINT END_VAR 182 Version: 1.5.0 TF3510
## Page 183

PLC API Inputs Name Type Description n Window Size UDINT Specifies the number of cycles over which a calculation is made. The memory requirement of the algorithm is proportional to this parameter. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.4.4.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.4.5 Get Channel Output Value Fetching a channel-specific output value. The output value corresponds to the distance between the reference channel and the input channel. The smaller the distance, the more equal the compared signals are. The value is updated only if the Call() method has been called before. Syntax Definition: METHOD Get Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) output ANY Output value of any data type. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alue 5.1.1.4.4.6 Get Output Array Getting the entire output array. The array elements correspond to the distance between the reference channel and the input channels. The smaller the distance, the more equal the compared signals are. The number of elements corresponds to the configured number of input channels. The values are updated only if the Call() method has been called before. TF3510 Version: 1.5.0 183
## Page 184

PLC API Syntax Definition: METHOD Get Output Array : BOOL VAR_INPUT p Array Out : POITNER TO LREAL; n Array Out Size : ANY; END_VAR Inputs Name Type Description p Array Out POINTER TO LREAL Pointer to the output array: Dim: n Buffer Size n Array Out Size UDINT Size of the output array Return value Name Type Description Get Output Array BOOL Returns TRUE if successful. 5.1.1.4.4.7 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 0: reference channel 1 to n Channels: comparison channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.4.5 FB_ALY_Logic Operation Counter The Logic Operation Counter executes a logical operation on the values of two or more channels and provides the result of this logical operation. Therefore, each input value can be combined with a threshold and an operator. Furthermore, the logic operator and the count mode can be configured individually. Syntax Definition: FUNCTION_BLOCK FB_ALY_Logic Operation Counter VAR_INPUT b Persistent: BOOL; 184 Version: 1.5.0 TF3510
## Page 185

PLC API END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Operation Out: BOOL; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Operation Out BOOL Result of the logical operation. n Count ULINT Incremented when the output value is b Operation Out=TRUE. The behavior depends on the configuration parameter e Count Mode. fb Time Last Event FB_ALY_Date Time Timestamp of last change from b Operation Out=TRUE. Methods Name Definition Location Description Call() Local Method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. FB_init() Local Initialize the number of input channels. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Logic Operation Counter : FB_ALY_Logic Operation Counter(n Num Channels := 3); fb System Time : FB_ALY_Get System Time; e Logic Operator : E_ALY_Logic Operator := E_ALY_Logic Operator. AND_; e Count Mode : E_ALY_Count Mode := E_ALY_Count Mode. On Change; st Threshold Level : ARRAY[1..3] OF ST_ALY_Threshold := TF3510 Version: 1.5.0 185
## Page 186

PLC API [(e Comparison Operator := E_ALY_Comparison Operator. Greater Than, f Threshold := 10), (e Comparison Operator := E_ALY_Comparison Operator. Less Than, f Threshold := 2), (e Comparison Operator := E_ALY_Comparison Operator. Equals, f Threshold := 1)]; b Configure : BOOL := TRUE; n Input Ch1 : INT := 11; f Input Ch2 : LREAL := 1.5; b Input Ch3 : BOOL := TRUE; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Logic Operation Counter. Configure Channel(1, st Threshold Level[1]); fb Logic Operation Counter. Configure Channel(2, st Threshold Level[2]); fb Logic Operation Counter. Configure Channel(3, st Threshold Level[3]); fb Logic Operation Counter. Configure(e Logic Operator, e Count Mode); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Logic Operation Counter. Set Channel Value(1, n Input Ch1); fb Logic Operation Counter. Set Channel Value(2, f Input Ch2); fb Logic Operation Counter. Set Channel Value(3, b Input Ch3); fb Logic Operation Counter. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.5.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.5.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: 186 Version: 1.5.0 TF3510
## Page 187

PLC API METHOD Configure : BOOL VAR_INPUT e Logic Operator : E_ALY_Logic Operator; e Count Mode : E_ALY_Count Mode; END_VAR Inputs Name Type Description e Logic Operator E_ALY_Logic Operator Configured logical operator. [} 430] e Count Mode E_ALY_Count Mode [} 429] Mode of the result counter. On Change: The counter counts every time the result changes to TRUE. Cyclic: The counter increments every cycle when the condition is TRUE. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.4.5.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.5.4 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT n Channel : UDINT st Threshold Level : ST_ALY_Threshold; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) st Threshold Level ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for monitoring input values Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 187
## Page 188

PLC API 5.1.1.4.5.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.4.5.6 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used. 5.1.1.4.6 FB_ALY_Multiplexer The Multiplexer selects one channel out of one or more input channels. For each input channel a boolean input has to be provided additionally. The output corresponds to the first input channel, where the conditional input is TRUE. The priority of the configured channels is the order of configuration. If the condition is not met for any of the channels, the provided default channel is returned. Syntax Definition: 188 Version: 1.5.0 TF3510
## Page 189

PLC API FUNCTION_BLOCK FB_ALY_Multiplexer VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Result: LREAL; n Current Channel: UDINT; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Result LREAL Returns the signal of the selected input channel. n Current Channel UDINT Indicates the number of the selected channel. The value is 0 if the default result is selected. The input channels are numbered in the order of their configuration. n Count ULINT Starts with 1 for the channel selected at the start of the analysis and increments each time another channel is selected. fb Time Last Event FB_ALY_Date Time Timestamp of the last channel change. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Values() Local Method for passing channel-specific values to the algorithm. Set Default Channel Valu Local Method to pass a value to the algorithm that will be e() selected as default if no channel is selected. Sample VAR fb Multiplexer : FB_ALY_Multiplexer(n Num Channels := 3); fb System Time : FB_ALY_Get System Time; n Input Ch1 : INT := 11; f Input Ch2 : LREAL := 1.5; n Input Ch3 : UDINT := 123; TF3510 Version: 1.5.0 189
## Page 190

PLC API f Default : LREAL := 3.1415; b Condition Ch1 : BOOL; b Condition Ch2 : BOOL; b Condition Ch3 : BOOL; END_VAR // Get current system time fb System Time. Call(); // Call algorithm fb Multiplexer. Set Channel Values(1, b Condition Ch1, n Input Ch1); fb Multiplexer. Set Channel Values(2, b Condition Ch2, f Input Ch2); fb Multiplexer. Set Channel Values(3, b Condition Ch3, n Input Ch3); fb Multiplexer. Set Default Channel Value(f Default); fb Multiplexer. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.6.1 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used. 5.1.1.4.6.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the methods Set Channel Condition And Value () and Set Channel Default Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. 190 Version: 1.5.0 TF3510
## Page 191

PLC API Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.6.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.6.4 Set Channel Values Set channel specific input value and condition. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Values: BOOL VAR_INPUT n Channel : UDINT; b Condition : BOOL; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) b Condition BOOL Channel condition. Input ANY Input value of any data type. Return value Name Type Description Set Channel Values BOOL Returns TRUE if successful 5.1.1.4.6.5 Set Default Channel Value Set default value which is set if no channel condition is TRUE. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Default Channel Value: BOOL VAR_INPUT input : ANY; END_VAR TF3510 Version: 1.5.0 191
## Page 192

PLC API Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Default Channel V BOOL Returns TRUE if successful alue 5.1.1.4.7 FB_ALY_Numerical Compare_1Ch The Numerical Compare 1Ch compares the input values with a reference value and provides the result of this comparison operation. The operator, the reference value and the count mode can be configured individually. Syntax Definition: FUNCTION_BLOCK FB_ALY_Numerical Compare_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Operation Out: BOOL; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Operation Out BOOL Result of the comparison operation. n Count ULINT Incremented when the output value is b Operation Out=TRUE. The behavior depends on the configuration parameter e Count Mode. fb Time Last Event FB_ALY_Date Time Timestamp of the last change to b Operation Out=TRUE. 192 Version: 1.5.0 TF3510
## Page 193

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Numerical Compare : FB_ALY_Numerical Compare_1Ch; fb System Time : FB_ALY_Get System Time; f Reference : LREAL := 40; e Comparison Operator : E_ALY_Comparison Operator := E_ALY_Comparison Operator. Greater Than; e Count Mode : E_ALY_Count Mode := E_ALY_Count Mode. On Change; b Use Abs Values : BOOL := FALSE; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Numerical Compare. Configure(f Reference, e Comparison Operator, e Count Mode, b Use Abs Values); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Numerical Compare. Set Channel Value(n Input); fb Numerical Compare. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.7.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR TF3510 Version: 1.5.0 193
## Page 194

PLC API Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.7.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Reference : LREAL; e Comparison Operator : E_ALY_Comparison Operator; e Count Mode : E_ALY_Count Mode; b Use Abs Values : BOOL; END_VAR Inputs Name Type Description f Reference LREAL Reference value for the comparison operation. e Comparison Operat E_ALY_Comparison Operat Specifies whether the input value should be greater than, or greater than or equal to, less than or equal to, less than or or [} 429] not equal to the reference value. e Count Mode E_ALY_Count Mode [} 429] Mode of the result counter. On Change: The counter counts every time the result changes to TRUE. Cyclic: The counter increments every cycle when the condition is TRUE. b Use Abs Values BOOL If TRUE, the absolute values of the input signals and the reference are used. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.4.7.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 194 Version: 1.5.0 TF3510
## Page 195

PLC API 5.1.1.4.7.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.4.8 FB_ALY_Numerical Compare_2Ch The Numerical Compare 2Ch compares the input values of the first channel with the input values of the second channel and provides the result of this comparison operation. The operator and the count mode can be configured individually. Syntax Definition: FUNCTION_BLOCK FB_ALY_Numerical Compare_2Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Operation Out: BOOL; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. TF3510 Version: 1.5.0 195
## Page 196

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Operation Out BOOL Result of the comparison operation. n Count ULINT Incremented when the output value is b Operation Out=TRUE. The behavior depends on the configuration parameter e Count Mode. fb Time Last Event FB_ALY_Date Time Timestamp of the last change to b Operation Out=TRUE. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Numerical Compare : FB_ALY_Numerical Compare_2Ch; fb System Time : FB_ALY_Get System Time; e Comparison Operator : E_ALY_Comparison Operator := E_ALY_Comparison Operator. Greater Than; e Count Mode : E_ALY_Count Mode := E_ALY_Count Mode. On Change; b Use Abs Values : BOOL := FALSE; b Configure : BOOL := TRUE; n Input Ch1 : INT; f Input Ch2 : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Numerical Compare. Configure(e Comparison Operator, e Count Mode, b Use Abs Values); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Numerical Compare. Set Channel Value(1, n Input Ch1); fb Numerical Compare. Set Channel Value(2, f Input Ch2); fb Numerical Compare. Call(fb System Time.t System Time); 196 Version: 1.5.0 TF3510
## Page 197

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.8.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.8.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Comparison Operator : E_ALY_Comparison Operator; e Count Mode : E_ALY_Count Mode; b Use Abs Values : BOOL; END_VAR Inputs Name Type Description e Comparison Operat E_ALY_Comparison Operat Specifies whether the input value should be greater than, or greater than or equal to, less than or equal to, less than or or [} 429] not equal to the reference value. e Count Mode E_ALY_Count Mode [} 429] Mode of the result counter. On Change: The counter counts every time the result changes to TRUE. Cyclic: The counter increments every cycle when the condition is TRUE. b Use Abs Values BOOL If TRUE, the absolute values of the input signals are used. TF3510 Version: 1.5.0 197
## Page 198

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.4.8.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.8.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Channel 1 2: Channel 2 Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.4.9 FB_ALY_String Compare_1Ch The String Compare 1Ch compares the input string with a reference string and counts the string matches. Therefore, case sensitivity can be taken into account or not and the count mode can be changed. Syntax Definition: FUNCTION_BLOCK FB_ALY_String Compare_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b String Match: BOOL; 198 Version: 1.5.0 TF3510
## Page 199

PLC API n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b String Match BOOL Result of the string comparison. n Count ULINT Incremented when the output value is b String Match=TRUE. The behavior depends on the configuration parameter e Count Mode. fb Time Last Event FB_ALY_Date Time Timestamp of the last change to b String Match=TRUE. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb String Compare : FB_ALY_String Compare_1Ch; fb System Time : FB_ALY_Get System Time; s Reference : STRING := 'String to compare with'; e String Compare Mode : E_ALY_String Compare Mode := E_ALY_String Compare Mode. Equals; e Count Mode : E_ALY_Count Mode := E_ALY_Count Mode. On Change; b Case Sensitive : BOOL := TRUE; b Configure : BOOL := TRUE; s Input : STRING := 'Input string'; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb String Compare. Configure(s Reference, e String Compare Mode, e Count Mode, b Case Sensitive); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb String Compare. Set Channel Value(s Input); fb String Compare. Call(fb System Time.t System Time) TF3510 Version: 1.5.0 199
## Page 200

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.9.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.9.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT s Reference : STRING(255); e String Compare Mode : E_ALY_String Compare Mode; e Count Mode : E_ALY_Count Mode; b Case Sensitive : BOOL; END_VAR Inputs Name Type Description s Reference STRING(255) Reference string for the comparison. e String Compare Mod E_ALY_String Compare Mod String compare mode: e e [} 431] Equals: Input string corresponds to the reference string. Begins With: Input string starts with the reference string. Contains: Input string contains the reference string. e Count Mode E_ALY_Count Mode [} 429] Mode of the result counter. On Change: The counter counts every time the result changes to TRUE. Cyclic: The counter increments every cycle when the condition is TRUE. b Case Sensitive BOOL If TRUE, upper and lower case is taken into account. 200 Version: 1.5.0 TF3510
## Page 201

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.4.9.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.9.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY_STRING; END_VAR Inputs Name Type Description Input ANY_STRING Input value of a string data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.4.10 FB_ALY_String Compare_2Ch The String Compare 2Ch compares the values of the first input string with the values of the second string and counts the string matches. Therefore case sensitivity can be taken into account or not and the count mode can be changed. Syntax Definition: FUNCTION_BLOCK FB_ALY_String Compare_2Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b String Match: BOOL; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR TF3510 Version: 1.5.0 201
## Page 202

PLC API Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b String Match BOOL Result of the string comparison. n Count ULINT Incremented when the output value is b String Match=TRUE. The behavior depends on the configuration parameter e Count Mode. fb Time Last Event FB_ALY_Date Time Timestamp of the last change to b String Match=TRUE. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb String Compare : FB_ALY_String Compare_2Ch; fb System Time : FB_ALY_Get System Time; e String Compare Mode : E_ALY_String Compare Mode := E_ALY_String Compare Mode. Equals; e Count Mode : E_ALY_Count Mode := E_ALY_Count Mode. On Change; b Case Sensitive : BOOL := TRUE; b Configure : BOOL := TRUE; s Input Ch1 : STRING := 'Input string'; s Input Ch2 : STRING := 'String to compare with'; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb String Compare. Configure(e String Compare Mode, e Count Mode, b Case Sensitive); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb String Compare. Set Channel Value(1, s Input Ch1); fb String Compare. Set Channel Value(2, s Input Ch2); fb String Compare. Call(fb System Time.t System Time); 202 Version: 1.5.0 TF3510
## Page 203

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.10.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.10.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT e String Compare Mode : E_ALY_String Compare Mode; e Count Mode : E_ALY_Count Mode; b Case Sensitive : BOOL; END_VAR Inputs Name Type Description e String Compare Mod E_ALY_String Compare Mod String compare mode: e e [} 431] Equals: Input string corresponds to the reference string. Begins With: Input string starts with the reference string. Contains: Input string contains the reference string. e Count Mode E_ALY_Count Mode [} 429] Mode of the result counter. On Change: The counter counts every time the result changes to TRUE. Cyclic: The counter increments every cycle when the condition is TRUE. b Case Sensitive BOOL If TRUE, upper and lower case is taken into account. TF3510 Version: 1.5.0 203
## Page 204

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.4.10.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.10.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Channel 1 2: Channel 2 Input ANY_STRING Input value of a string data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.4.11 FB_ALY_Detect Value Change_1Ch The Detect Value Change 1Ch detects and counts changes in numeric input values. Syntax Definition: FUNCTION_BLOCK FB_ALY_Detect Value Change_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Value Changed: BOOL; 204 Version: 1.5.0 TF3510
## Page 205

PLC API n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Value Changed BOOL TRUE, if a change of value was detected, otherwise FALSE. n Count ULINT Incremented when the output value is b Value Changed=TRUE. fb Time Last Event FB_ALY_Date Time Timestamp of the last detected value change. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Detect Value Change : FB_ALY_Detect Value Change_1Ch; fb System Time : FB_ALY_Get System Time; f Tolerance : LREAL := 0.1; b Configure : BOOL := TRUE; f In : LREAL; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Detect Value Change. Configure(f Tolerance); END_IF // Call algorithm fb Detect Value Change. Set Channel Value(f In); fb Detect Value Change. Call(fb System Time.t System Time); TF3510 Version: 1.5.0 205
## Page 206

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.4.11.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.11.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Tolerance : LREAL; END_VAR Inputs Name Type Description f Tolerance LREAL The tolerance refers to the input value of the last detected value change. If the input value is outside this tolerance, a value change is detected. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.4.11.3 Reset Resetting the algorithm. 206 Version: 1.5.0 TF3510
## Page 207

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.11.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.4.12 FB_ALY_Timespan Compare_1Ch The Timespan Compare 1Ch compares the input value with a reference value and returns the result of this comparison operation. A timespan with a resolution of 1 ns is supported as an input. The operator, the reference value and the count mode can be configured individually. Syntax Definition: FUNCTION_BLOCK FB_ALY_Timespan Compare_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Operation Out: BOOL; n Count: ULINT; fb Time Last Event: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. TF3510 Version: 1.5.0 207
## Page 208

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Operation Out BOOL Result of the comparison operation. n Count ULINT Incremented when the output value is b Operation Out=TRUE. The behavior depends on the configuration parameter e Count Mode. fb Time Last Event FB_ALY_Date Time Timestamp of the last change to b Operation Out=TRUE. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Resolution of the time values in 1 ns. Sample VAR fb Timespan Compare : FB_ALY_Timespan Compare_1Ch; fb System Time : FB_ALY_Get System Time; t Reference : FB_ALY_Timespan :=(w Seconds := 42); e Comparison Operator : E_ALY_Comparison Operator := E_ALY_Comparison Operator. Greater Than; e Count Mode : E_ALY_Count Mode := E_ALY_Count Mode. On Change; b Use Abs Values : BOOL := FALSE; b Configure : BOOL := TRUE; t Input : LTIME; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Timespan Compare. Configure(t Reference, e Comparison Operator, e Count Mode, b Use Abs Values); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Timespan Compare. Set Channel Value(t Input); fb Timespan Compare. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 208 Version: 1.5.0 TF3510
## Page 209

PLC API 5.1.1.4.12.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.4.12.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT t Reference : FB_ALY_Timespan; e Comparison Operator : E_ALY_Comparison Operator; e Count Mode : E_ALY_Count Mode; b Use Abs Values : BOOL; END_VAR Inputs Name Type Description t Reference FB_ALY_Timespan [} 399] Reference value for the comparison operation. Resolution in 1 ns. e Comparison Operat E_ALY_Comparison Operat Specifies whether the input value should be greater than, or greater than or equal to, less than or equal to, less than or or [} 429] not equal to the reference value. e Count Mode E_ALY_Count Mode [} 429] Mode of the result counter. On Change: The counter counts every time the result changes to TRUE. Cyclic: The counter increments every cycle when the condition is TRUE. b Use Abs Values BOOL If TRUE, the absolute values of the input signals and the reference are used. Return value Name Type Description Configure BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 209
## Page 210

PLC API 5.1.1.4.12.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.4.12.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.5 Energy 5.1.1.5.1 FB_ALY_Energy The Energy module is suitable for energy monitoring of various electrical components. The input data for current and voltage are averaged over a configurable interval and then calculated. Syntax Definition: FUNCTION_BLOCK FB_ALY_Energy VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Electrical Power: LREAL; f Electrical Energy: LREAL; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. 210 Version: 1.5.0 TF3510
## Page 211

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Electrical Power LREAL Electrical power in watts. f Electrical Energy LREAL Electrical energy in watt-hours. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Energy : FB_ALY_Energy; fb System Time : FB_ALY_Get System Time; f Sample Rate : LREAL := 1000.0; t Interval : LTIME := LTIME#1S; f Voltage Scale Factor : LREAL := 10.0; f Current Scale Factor : LREAL := 10.0; b Configure : BOOL := TRUE; f In Voltage : LREAL; f In Current : LREAL; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Energy. Configure(f Sample Rate, t Interval, f Voltage Scale Factor, f Current Scale Factor); END_IF // Call algorithm fb Energy. Set Channel Value(1, f In Voltage); fb Energy. Set Channel Value(2, f In Current); fb Energy. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.5.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). TF3510 Version: 1.5.0 211
## Page 212

PLC API Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.5.1.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Sample Rate : LREAL; t Interval : LTIME; f Voltage Scale Factor: LREAL; f Current Scale Factor: LREAL; END_VAR Inputs Name Type Description f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. t Interval LTIME Interval time of averaging. Used to calculate the electrical energy. f Voltage Scale Factor LREAL Scaling factor for the input voltage. f Current Scale Factor LREAL Scaling factor for the input current. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.5.1.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 212 Version: 1.5.0 TF3510
## Page 213

PLC API 5.1.1.5.1.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT (1..2); input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Voltage 2: Current Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.5.2 FB_ALY_Energy_AX5xxx The Energy AX5xxx module is suitable for energy monitoring of servo drives from the AX5xxx series. The input data is averaged over a configurable interval and then calculated. To ensure that the required input data is available, it must be added to the process image. Syntax Definition: FUNCTION_BLOCK FB_ALY_Energy_AX5xxx VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Electrical Power: LREAL; f Mechanical Power: LREAL; f Braking Power: LREAL; f Electrical Energy: LREAL; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. TF3510 Version: 1.5.0 213
## Page 214

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Electrical Power LREAL Electrical power in watts. f Mechanical Power LREAL Mechanical power in watts. f Braking Power LREAL Braking power in watts. f Electrical Energy LREAL Electrical energy in watt-hours. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Energy : FB_ALY_Energy_AX5xxx; fb System Time : FB_ALY_Get System Time; f Sample Rate : LREAL := 1000.0; t Interval : LTIME := LTIME#1S; n Peak Torque : DINT := 1000; b Configure : BOOL := TRUE; n In Dc Bus Voltage : UINT; n In Dc Bus Current : DINT; n In Velocity Feedback Value : DINT; n In Torque Feedback Value : INT; n In Internal Braking Resistor Power : UINT; n In External Braking Resistor Power : UINT; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Energy. Configure(f Sample Rate, t Interval, n Peak Torque); END_IF // Call algorithm fb Energy. Set Channel Value(1, n In Dc Bus Voltage); fb Energy. Set Channel Value(2, n In Dc Bus Current); fb Energy. Set Channel Value(3, n In Velocity Feedback Value); fb Energy. Set Channel Value(4, n In Torque Feedback Value); fb Energy. Set Channel Value(5, n In Internal Braking Resistor Power); fb Energy. Set Channel Value(6, n In External Braking Resistor Power); fb Energy. Call(fb System Time.t System Time); 214 Version: 1.5.0 TF3510
## Page 215

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.5.2.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.5.2.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Sample Rate : LREAL; t Interval : LTIME; n Peak Torque : DINT; END_VAR Inputs Name Type Description f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. t Interval LTIME Interval time of averaging. Used to calculate the electrical energy. n Peak Torque DINT Peak value of the torque (Co E: P-0-0094). Return value Name Type Description Configure BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 215
## Page 216

PLC API 5.1.1.5.2.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.5.2.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT (1..6); input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: DC bus voltage (Co E: S-0-0016 -> Add Co E S-0-0380 "DC bus voltage" to PDO content) 2: DC bus current (Co E: S-0-0016 -> Add Co E S-0-0381 "DC bus current" to PDO content) 3: Velocity feedback value (Co E: S-0-0016 -> Add Co E S-0-0040 "Velocity feedback 1 value" to PDO content) 4: Torque feedback value (Co E: S-0-0016 -> Add Co E S-0-0084 "Torque/force feedback value" to PDO content) 5: Internal braking resistor power (Co E: S-0-0016 -> Add Co E P-0-0209 "Internal braking resistor actual averaged power" to PDO content) 6: External braking resistor power (Co E: S-0-0016 -> Add Co E P-0-0210 "External braking resistor actual averaged power" to PDO content) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.5.3 FB_ALY_Energy_AX81xx The Energy AX81xx module is suitable for energy monitoring of servo drives from the AX81xx series. The input data is averaged over a configurable interval and then calculated. To ensure that the required input data is available, it must be added to the process image. 216 Version: 1.5.0 TF3510
## Page 217

PLC API Syntax Definition: FUNCTION_BLOCK FB_ALY_Energy_AX81xx VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Electrical Power: LREAL; f Mechanical Power: LREAL; f Braking Power: LREAL; f Electrical Energy: LREAL; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Electrical Power LREAL Electrical power in watts. f Mechanical Power LREAL Mechanical power in watts. f Braking Power LREAL Braking power in watts. f Electrical Energy LREAL Electrical energy in watt-hours. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Energy : FB_ALY_Energy_AX81xx; fb System Time : FB_ALY_Get System Time; f Sample Rate : LREAL := 1000.0; t Interval : LTIME := LTIME#1S; b Configure : BOOL := TRUE; f In Electrical Power : REAL; f In Mechanical Power : REAL; TF3510 Version: 1.5.0 217
## Page 218

PLC API n In Dc Link Voltage : UDINT; f In Motor Brake Current : REAL; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Energy. Configure(f Sample Rate, t Interval); END_IF // Call algorithm fb Energy. Set Channel Value(1, f In Electrical Power); fb Energy. Set Channel Value(2, f In Mechanical Power); fb Energy. Set Channel Value(3, n In Dc Link Voltage); fb Energy. Set Channel Value(4, f In Motor Brake Current); fb Energy. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.5.3.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.5.3.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Sample Rate : LREAL; t Interval : LTIME; END_VAR 218 Version: 1.5.0 TF3510
## Page 219

PLC API Inputs Name Type Description f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. t Interval LTIME Interval time of averaging. Used to calculate the electrical energy. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.5.3.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.5.3.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT (1..4); input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Electrical power (Enable PDO-Input 0x1A32 -> Add Co E 0x3242:12 "Electrical power" to PDO content) 2: Mechanical power (Enable PDO-Input 0x1A32 -> Add Co E 0x3242:13 "Mechanical power" to PDO content) 3: DC link voltage (Enable PDO-Input 0x1A00 -> Add Co E 0x6079 "DC link cirquit voltage" to PDO content) 4: Motor brake current (Enable PDO-Input 0x1A20 -> Add Co E 0x3001:01 "Actual motor brake current" to PDO content) Input ANY Input value of any data type. TF3510 Version: 1.5.0 219
## Page 220

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.5.4 FB_ALY_Energy_AX82xx The Energy AX82xx module is suitable for energy monitoring of servo drives from the AX82xx series. The input data is averaged over a configurable interval and then calculated. To ensure that the required input data is available, it must be added to the process image. Syntax Definition: FUNCTION_BLOCK FB_ALY_Energy_AX82xx VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Electrical Power: LREAL; f Mechanical Power: LREAL; f Braking Power: LREAL; f Electrical Energy: LREAL; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Electrical Power LREAL Electrical power in watts. f Mechanical Power LREAL Mechanical power in watts. f Braking Power LREAL Braking power in watts. f Electrical Energy LREAL Electrical energy in watt-hours. 220 Version: 1.5.0 TF3510
## Page 221

PLC API Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Energy : FB_ALY_Energy_AX82xx; fb System Time : FB_ALY_Get System Time; f Sample Rate : LREAL := 1000.0; t Interval : LTIME := LTIME#1S; b Configure : BOOL := TRUE; f In Electrical Power Ch A : REAL; f In Mechanical Power Ch A : REAL; f In Electrical Power Ch B : REAL; f In Mechanical Power Ch B : REAL; n In Dc Link Voltage : UDINT; f In Motor Brake Current Ch A : REAL; f In Motor Brake Current Ch B : REAL; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Energy. Configure(f Sample Rate, t Interval); END_IF // Call algorithm fb Energy. Set Channel Value(1, f In Electrical Power Ch A); fb Energy. Set Channel Value(2, f In Mechanical Power Ch A); fb Energy. Set Channel Value(3, f In Electrical Power Ch B); fb Energy. Set Channel Value(4, f In Mechanical Power Ch B); fb Energy. Set Channel Value(5, n In Dc Link Voltage); fb Energy. Set Channel Value(6, f In Motor Brake Current Ch A); fb Energy. Set Channel Value(7, f In Motor Brake Current Ch B); fb Energy. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.5.4.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR TF3510 Version: 1.5.0 221
## Page 222

PLC API Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.5.4.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Sample Rate : LREAL; t Interval : LTIME; END_VAR Inputs Name Type Description f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. t Interval LTIME Interval time of averaging. Used to calculate the electrical energy. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.5.4.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.5.4.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT (1..7); input : ANY; END_VAR 222 Version: 1.5.0 TF3510
## Page 223

PLC API Inputs Name Type Description n Channel UDINT Channel index 1: Electrical power Ch A (Enable PDO-Input 0x1A32 -> Add Co E 0x3242:12 "Electrical power" to PDO content) 2: Mechanical power Ch B (Enable PDO-Input 0x1A32 -> Add Co E 0x3242:13 "Mechanical power" to PDO content) 3: Electrical power Ch A (Enable PDO-Input 0x1A52 -> Add Co E 0x3642:12 "Electrical power" to PDO content) 4: Mechanical power Ch B (Enable PDO-Input 0x1A52 -> Add Co E 0x3642:13 "Mechanical power" to PDO content) 5: DC link voltage (Enable PDO-Input 0x1A00 -> Add Co E 0x6079 "DC link cirquit voltage" to PDO content) 6: Motor brake current Ch A (Enable PDO-Input 0x1A20 -> Add Co E 0x3001:01 "Actual motor brake current" to PDO content) 7: Motor brake current Ch A (Enable PDO-Input 0x1A40 -> Add Co E 0x3401:01 "Actual motor brake current" to PDO content) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.5.5 FB_ALY_Energy_AX86xx The Energy AX86xx module is suitable for energy monitoring of AX86xx series power supply modules. The input data is averaged over a configurable interval and then calculated. To ensure that the required input data is available, it must be added to the process image. Syntax Definition: FUNCTION_BLOCK FB_ALY_Energy_AX86xx VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Electrical Power: LREAL; f Braking Power: LREAL; f Electrical Energy: LREAL; END_VAR TF3510 Version: 1.5.0 223
## Page 224

PLC API Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Electrical Power LREAL Electrical power in watts. f Braking Power LREAL Braking power in watts. f Electrical Energy LREAL Electrical energy in watt-hours. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Energy : FB_ALY_Energy_AX86x0; fb System Time : FB_ALY_Get System Time; f Sample Rate : LREAL := 1000.0; t Interval : LTIME := LTIME#1S; b Configure : BOOL := TRUE; n In Dc Link Voltage : UDINT; n In Dc Link Current : INT; f In Brake Resistor Continuous Power : UINT; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Energy. Configure(f Sample Rate, t Interval); END_IF // Call algorithm fb Energy. Set Channel Value(1, n In Dc Link Voltage); fb Energy. Set Channel Value(2, n In Dc Link Current); fb Energy. Set Channel Value(3, f In Brake Resistor Continuous Power); fb Energy. Call(fb System Time.t System Time); 224 Version: 1.5.0 TF3510
## Page 225

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.5.5.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.5.5.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Sample Rate : LREAL; t Interval : LTIME; END_VAR Inputs Name Type Description f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. t Interval LTIME Interval time of averaging. Used to calculate the electrical energy. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.5.5.3 Reset Resetting the algorithm. TF3510 Version: 1.5.0 225
## Page 226

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.5.5.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT (1..3); input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: DC link voltage (Enable PDO-Input 0x1A05) 2: DC link current (Enable PDO-Input 0x1A06) 3: Brake resistor continuous power (Enable PDO-Input 0x1A07) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.5.6 FB_ALY_Energy_EL259x The Energy EL259x module is suitable for energy monitoring of EL259x Ether CAT Terminals. The input data is averaged over a configurable interval and then calculated. To ensure that the required input data is available, it must be added to the process image. Syntax Definition: FUNCTION_BLOCK FB_ALY_Energy_EL259x VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Electrical Power: LREAL; f Electrical Energy: LREAL; END_VAR 226 Version: 1.5.0 TF3510
## Page 227

PLC API Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Electrical Power LREAL Electrical power in watts. f Electrical Energy LREAL Electrical energy in watt-hours. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Energy : FB_ALY_Energy_EL259x; fb System Time : FB_ALY_Get System Time; f Sample Rate : LREAL := 1000.0; t Interval : LTIME := LTIME#1S; b Configure : BOOL := TRUE; n In Supply Voltage : UINT; n In Supply Current : UINT; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Energy. Configure(f Sample Rate, t Interval); END_IF // Call algorithm fb Energy. Set Channel Value(1, n In Supply Voltage); fb Energy. Set Channel Value(2, n In Supply Current); fb Energy. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3510 Version: 1.5.0 227
## Page 228

PLC API 5.1.1.5.6.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.5.6.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Sample Rate : LREAL; t Interval : LTIME; END_VAR Inputs Name Type Description f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. t Interval LTIME Interval time of averaging. Used to calculate the electrical energy. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.5.6.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 228 Version: 1.5.0 TF3510
## Page 229

PLC API 5.1.1.5.6.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT (1..2); input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Supply voltage (PDO-Input: 0x1A01 -> Select Co E 0x F900:05 "Supply voltage" in Co E 0x8002:11) 2: Supply current (PDO-Input: 0x1A01 -> Select Co E 0x F900:06 "Supply current" in Co E 0x8002:19) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.5.7 FB_ALY_Energy_EL72xx_EL74xx The Energy AX72xx EL74xx module is suitable for energy monitoring of EL72xx and EL74xx Ether CAT Terminals. The input data is averaged over a configurable interval and then calculated. To ensure that the required input data is available, it must be added to the process image. Syntax Definition: FUNCTION_BLOCK FB_ALY_Energy_EL72xx_EL74xx VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Electrical Power: LREAL; f Mechanical Power: LREAL; f Electrical Energy: LREAL; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. TF3510 Version: 1.5.0 229
## Page 230

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Electrical Power LREAL Electrical power in watts. f Mechanical Power LREAL Mechanical power in watts. f Electrical Energy LREAL Electrical energy in watt-hours. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Energy : FB_ALY_Energy_EL72xx_EL74xx; fb System Time : FB_ALY_Get System Time; f Sample Rate : LREAL := 1000.0; t Interval : LTIME := LTIME#1S; n Rated Current : UDINT := 1000; n Torque Constant : UDINT := 2; n Motor Current Type : UDINT := 1; b Configure : BOOL := TRUE; n In Actual Velocity : DINT; n In Actual Torque : INT; n In Dc Link Voltage : UINT; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Energy. Configure(f Sample Rate, t Interval, n Rated Current, n Torque Constant, n Motor Current Type); END_IF // Call algorithm fb Energy. Set Channel Value(1, n In Actual Velocity); fb Energy. Set Channel Value(2, n In Actual Torque); fb Energy. Set Channel Value(3, n In Dc Link Voltage); fb Energy. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 230 Version: 1.5.0 TF3510
## Page 231

PLC API 5.1.1.5.7.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.5.7.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Sample Rate : LREAL; t Interval : LTIME; n Rated Current : UDINT; n Torque Constant : UDINT; n Motor Current Type : UDINT; END_VAR Inputs Name Type Description f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. t Interval LTIME Interval time of averaging. Used to calculate the electrical energy. n Rated Current UDINT Nominal current in m A (Co E: 0x8011:12) n Torque Constant UDINT Torque constant in m Nm / A (Co E: 0x8011:16) n Motor Current Type UDINT Type of specification of the nominal current (Co E: 0x8010:54) 0: Nominal current as peak value 1: Nominal current as RMS Return value Name Type Description Configure BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 231
## Page 232

PLC API 5.1.1.5.7.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.5.7.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT (1..3); input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Actual velocity (Enable PDO-Input 0x1A02) 2: Actual torque (Enable PDO-Input 0x1A03) 3: DC link voltage (Enable PDO-Input 0x1A04 -> Select "DC link voltage (m V) in Co E 0x8010:39") Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.5.8 FB_ALY_Energy_EP9224 The Energy EP9224 module is suitable for the energy monitoring of EP9224 Ether CAT Box modules. The input data is averaged over a configurable interval and then calculated. To ensure that the required input data is available, it must be added to the process image. Syntax Definition: FUNCTION_BLOCK FB_ALY_Energy_EP9224 VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; 232 Version: 1.5.0 TF3510
## Page 233

PLC API f Electrical Power: LREAL; f Electrical Energy: LREAL; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Electrical Power LREAL Electrical power in watts. f Electrical Energy LREAL Electrical energy in watt-hours. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Energy : FB_ALY_Energy_EP9224; fb System Time : FB_ALY_Get System Time; f Sample Rate : LREAL := 1000.0; t Interval : LTIME := LTIME#1S; b Configure : BOOL := TRUE; n In Device Voltage Us : INT; n In Device Current Us : INT; n In Device Voltage Up : INT; n In Device Current Up : INT; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Energy. Configure(f Sample Rate, t Interval); END_IF // Call algorithm fb Energy. Set Channel Value(1, n In Device Voltage Us); fb Energy. Set Channel Value(2, n In Device Current Us); fb Energy. Set Channel Value(3, n In Device Voltage Up); fb Energy. Set Channel Value(4, n In Device Current Up); fb Energy. Call(fb System Time.t System Time); TF3510 Version: 1.5.0 233
## Page 234

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.5.8.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.5.8.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Sample Rate : LREAL; t Interval : LTIME; END_VAR Inputs Name Type Description f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. t Interval LTIME Interval time of averaging. Used to calculate the electrical energy. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.5.8.3 Reset Resetting the algorithm. 234 Version: 1.5.0 TF3510
## Page 235

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.5.8.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT (1..4); input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Device voltage U s (PDO Inputs Device) 2: Device current U s (PDO Inputs Device) 3: Device voltage U p (PDO Inputs Device) 4: Device current U p (PDO Inputs Device) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.5.9 FB_ALY_Energy_EPP9022 The Energy EPP9022 module is suitable for the energy monitoring of EPP9022 Ether CAT Box modules. The input data is averaged over a configurable interval and then calculated. To ensure that the required input data is available, it must be added to the process image. Syntax Definition: FUNCTION_BLOCK FB_ALY_Energy_EPP9022 VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Electrical Power: LREAL; f Electrical Energy: LREAL; END_VAR TF3510 Version: 1.5.0 235
## Page 236

PLC API Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Electrical Power LREAL Electrical power in watts. f Electrical Energy LREAL Electrical energy in watt-hours. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Energy : FB_ALY_Energy_EPP9022; fb System Time : FB_ALY_Get System Time; f Sample Rate : LREAL := 1000.0; t Interval : LTIME := LTIME#1S; b Configure : BOOL := TRUE; n In Voltage Us : DINT; n In Current Is : DINT; n In Voltage Up : DINT; n In Current Ip : DINT; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Energy. Configure(f Sample Rate, t Interval); END_IF // Call algorithm fb Energy. Set Channel Value(1, n In Voltage Us); fb Energy. Set Channel Value(2, n In Current Is); fb Energy. Set Channel Value(3, n In Voltage Up); fb Energy. Set Channel Value(4, n In Current Ip); fb Energy. Call(fb System Time.t System Time); 236 Version: 1.5.0 TF3510
## Page 237

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.5.9.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.5.9.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Sample Rate : LREAL; t Interval : LTIME; END_VAR Inputs Name Type Description f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. t Interval LTIME Interval time of averaging. Used to calculate the electrical energy. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.5.9.3 Reset Resetting the algorithm. TF3510 Version: 1.5.0 237
## Page 238

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.5.9.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT (1..4); input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Voltage Us (EPM Inputs Channel 1) 2: Current Is (EPM Inputs Channel 1) 3: Voltage U p (EPM Inputs Channel 2) 4: Current I p (EPM Inputs Channel 2) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.6 Math 5.1.1.6.1 FB_ALY_Integrator_1Ch The Integrator 1Ch integrates the input value over time with a base unit of one second and provides the result of this integration operation. For the approximation of this integral the trapezoidal rule is used. The trapezoidal between two subsequent timestamps and with the values and is calculates as . 238 Version: 1.5.0 TF3510
## Page 239

PLC API If the integration mode "absolute" ("|x|") is chosen in the configuration, and are substituted by their absolute values in the above equation. In each cycle the trapezoidal between the current and the last timestamp is calculated and added to the sum of trapezoids starting from the beginning of the analysis. Additionally, this sum can be scaled by a factor that can be configured individually. Syntax Definition: FUNCTION_BLOCK FB_ALY_Integrator_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Result: LREAL; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Result LREAL Outputs the result of the integration. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Integrator : FB_ALY_Integrator_1Ch; fb System Time : FB_ALY_Get System Time; e Integration Mode : E_ALY_Integration Mode := E_ALY_Integration Mode. Direct; f Factor : LREAL := 1.0; TF3510 Version: 1.5.0 239
## Page 240

PLC API b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Integrator. Configure(e Integration Mode, f Factor); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Integrator. Set Channel Value(n Input); fb Integrator. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.6.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.6.1.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Integration Mode : E_ALY_Integration Mode; f Factor : LREAL; END_VAR 240 Version: 1.5.0 TF3510
## Page 241

PLC API Inputs Name Type Description e Integration Mode E_ALY_Integration Mode Integration mode [} 429] Direct: Integration of the input values Absolut: Integration of the absolute input values f Factor LREAL The integral is multiplied by this factor. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.6.1.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.6.1.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.6.2 FB_ALY_Math Operation The Math Operation executes a mathematical operation on two or more different input channels and provides the result of the mathematical operation. The operator is the same for all operands. Syntax Definition: FUNCTION_BLOCK FB_ALY_Math Operation VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; TF3510 Version: 1.5.0 241
## Page 242

PLC API b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Result: LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Result LREAL Outputs the result of the mathematical operation. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Math Operation : FB_ALY_Math Operation(n Num Channels := 3); e Math Operator : E_ALY_Math Operator := E_ALY_Math Operator. Addition; b Use Abs Values : BOOL := FALSE; b Configure : BOOL := TRUE; n Input Ch1 : INT; f Input Ch2 : LREAL; n Input Ch3 : UDINT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Math Operation. Configure(e Math Operator, b Use Abs Values); END_IF // Call algorithm fb Math Operation. Set Channel Value(1, n Input Ch1); fb Math Operation. Set Channel Value(2, f Input Ch2); fb Math Operation. Set Channel Value(3, n Input Ch3); fb Math Operation. Call(); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 242 Version: 1.5.0 TF3510
## Page 243

PLC API 5.1.1.6.2.1 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used. 5.1.1.6.2.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.6.2.3 Configure Configure the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Math Operator : E_ALY_Math Operator; b Use Abs Values : BOOL; END_VAR TF3510 Version: 1.5.0 243
## Page 244

PLC API Inputs Name Type Description e Math Operator E_ALY_Math Operator Mathematical operator [} 430] Addition Subtraction Multiplication Division Power Of Modulo b Use Abs Values BOOL If TRUE, the absolute values of the input signals are used. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.6.2.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.6.2.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 244 Version: 1.5.0 TF3510
## Page 245

PLC API 5.1.1.6.3 FB_ALY_Math Operation_1Ch The Math Operation 1Ch executes a mathematical operation on the signal of the input channel and a reference value. The algorithm provides the result of the mathematical operation and the operator can be configured individually. Syntax Definition: FUNCTION_BLOCK FB_ALY_Math Operation_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Result: LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Result LREAL Outputs the result of the mathematical operation. Methods Name Definition Lo- Description cation Call() Local Method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Math Operation : FB_ALY_Math Operation_1Ch; f Operand : LREAL := 50; e Math Operator : E_ALY_Math Operator := E_ALY_Math Operator. Addition; b Use Abs Values : BOOL := FALSE; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Math Operation. Configure(f Operand, e Math Operator, b Use Abs Values); END_IF // Call algorithm fb Math Operation. Set Channel Value(n Input); fb Math Operation. Call(); TF3510 Version: 1.5.0 245
## Page 246

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.6.3.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.6.3.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT f Operand : LREAL; e Math Operator : E_ALY_Math Operator; b Use Abs Values : BOOL; END_VAR Inputs Name Type Description f Operand LREAL Operand for the mathematical operation. e Math Operator E_ALY_Math Operator Mathematical operator [} 430] Addition Subtraction Multiplication Division Power Of Modulo b Use Abs Values BOOL If TRUE, the absolute values of the two operands are used. Return value Name Type Description Configure BOOL Returns TRUE if successful. 246 Version: 1.5.0 TF3510
## Page 247

PLC API 5.1.1.6.3.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.6.3.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.6.4 FB_ALY_RMS_1Ch RMS 1Ch calculates the root mean square over the input values according to the formula The number of samples N that are included in the calculation can be configured by specifying a time interval. A cascaded output can be configured to realize a long-term RMS in a resource-saving way and to pick up intermediate results. The time interval of the configured cascade must correspond to an integer multiple of the time interval of the previous cascade. Syntax Definition: FUNCTION_BLOCK FB_ALY_RMS_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; END_VAR TF3510 Version: 1.5.0 247
## Page 248

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Set Cascades() Local Method for configuring the cascades. The call is made after the call to the Configure method. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb RMS_1Ch : FB_ALY_RMS_1Ch; fb System Time : FB_ALY_Get System Time; n Num Cascades : UDINT := 5; f Sample Rate : UDINT := 1000; e Startup Behaviour : E_ALY_Cascade Startup Behaviour := E_ALY_Cascade Startup Behaviour. Use Previous Ca scade Value; a Cascades Config Array : ARRAY[1..5] OF LTIME := [LTIME#20MS, LTIME#1S, LTIME#1M, LTIME#1H, LTIME# 1D]; b Configure : BOOL := TRUE; f Input : LREAL; a RMS : ARRAY[1..5] OF LREAL; a New Result : ARRAY[1..5] OF BOOL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb RMS_1Ch. Configure(n Num Cascades, f Sample Rate, e Startup Behaviour); fb RMS_1Ch. Set Cascades(ADR(a Cascades Config Array), SIZEOF(a Cascades Config Array)); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb RMS_1Ch. Set Channel Value(f Input); fb RMS_1Ch. Call(fb System Time.t System Time, ADR(a RMS), SIZEOF(a RMS), ADR(a New Result), SIZEOF(a New Result )); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 248 Version: 1.5.0 TF3510
## Page 249

PLC API 5.1.1.6.4.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; p Rms Array Out : POINTER TO LREAL; n Rms Array Out Size : UDINT; p New Result Array Out : POINTER TO BOOL; n New Result Array Out Size : UDINT END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. p Rms Array Out POINTER TO LREAL Pointer to an array in which the RMS results are to be stored. The dimension corresponds to the number of configured cascades. n Rms Array Out Size UDINT Size of the RMS array. p New Result Array Ou POINTER TO BOOL Pointer to an array in which the state of new RMS results t are to be stored. The dimension corresponds to the number of configured cascades. n New Result Array Ou UDINT Size of the status array. t Size Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.6.4.2 Configure Configuring the algorithm. The output cascades can be set using the Set Cascades() method. Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Num Cascades : UDINT; f Sample Rate : LREAL; e Startup Behaviour : E_ALY_Cascade Startup Behaviour; END_VAR TF3510 Version: 1.5.0 249
## Page 250

PLC API Inputs Name Type Description n Num Cascades UDINT Number of output cascades f Sample Rate LREAL Sampling rate of the system to be analyzed in Hz e Startup Behaviour E_ALY_Cascade Startup Beh Start-up behavior aviour [} 429] Wait Until Filled Waits until the configured timespan of the cascade has elapsed. The RMS result and the Boolean flag "New Result" are only set for the first time after the timespan has elapsed. Use Previous Cascade Value The RMS cascades whose configured timespan has not yet expired use the next smallest RMS result already set. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.6.4.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.6.4.4 Set Cascades Configuration of the output cascades. Before that, the number of cascades must be set with the Configure() method. Syntax Definition: METHOD Set Cascades : BOOL VAR_INPUT p Cascades Config Array : POINTER TO LTIME; n Cascades Config Array Size : UDINT; END_VAR Inputs Name Type Description p Cascades Config Arr POINTER TO LTIME Pointer to an array used to configure the time intervals of ay the cascades. The time interval of the configured cascade must correspond to an integer multiple of the time interval of the previous cascade. n Cascades Config Arr UDINT Size of the configuration array. ay Size 250 Version: 1.5.0 TF3510
## Page 251

PLC API Return value Name Type Description Set Cascades BOOL Returns TRUE if successful. 5.1.1.6.4.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.6.5 FB_ALY_Slope Analysis_1Ch The Slope Analysis 1Ch calculates the slope between two values of the input stream. One of those two values is the current input value and the second value is the input value that occurred a defined number (configured by the parameter Num Values) of cycles before in the input stream. The difference between these two values is returned as Delta Value. The corresponding distance on the time-coordinate is calculated as the difference of the timestamps of these two values and is provided as the output value Delta Time. Note that the value Delta Time is displayed in nanoseconds, but for the calculation of the slope it is scaled to a second as base unit. The Slope is then calculated as the fraction of Delta Value and Delta Time (scaled to seconds) and estimates the gradient for the timestamp in the center of the two timestamps used in the calculation of Delta Time. This is the value returned as Time Slope if it corresponds to a timestamp of the input stream. For configurations, where Num Values is an uneven number there is no input value matching the exact centre timestamp. In this case the timestamp of the value that directly succeeded the calculated centre timestamp is returned as Time Slope. Further, the algorithm provides the minimal slope, the maximal slope and the time values of minimum and maximum. Syntax Definition: FUNCTION_BLOCK FB_ALY_Slope Analysis_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Slope: LREAL; TF3510 Version: 1.5.0 251
## Page 252

PLC API f Slope Min: LREAL; f Slope Max: LREAL; f Delta Value: LREAL; fb Delta Time: FB_ALY_Timespan; fb Time Slope: FB_ALY_Date Time; fb Time Slope Min: FB_ALY_Date Time; fb Time Slope Max: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Delta Value LREAL Difference of the values of the first and last element of the window. fb Delta Time FB_ALY_Timespan Difference of timestamp values of the first and last element of the window. It is scaled to seconds. f Slope LREAL Division of f Delta Value and f Delta Time. f Slope Min LREAL Minimum occurred value of f Slope. f Slope Max LREAL Maximum occurred value of f Slope. fb Time Slope FB_ALY_Date Time Timestamp of the calculated slope. It is placed in the center of the configured window. fb Time Slope Min FB_ALY_Date Time Timestamp of the last updated f Slope Min. fb Time Slope Max FB_ALY_Date Time Timestamp of the last updated f Slope Max. Methods Name Definition Location Description Call() Local Method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Slope Analysis : FB_ALY_Slope Analysis_1Ch; fb System Time : FB_ALY_Get System Time; n Num Values : UDINT := 200; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Slope Analysis. Configure(n Num Values); 252 Version: 1.5.0 TF3510
## Page 253

PLC API END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Slope Analysis. Set Channel Value(n Input); fb Slope Analysis. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.6.5.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.6.5.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Num Values : UDINT; END_VAR Inputs Name Type Description n Num Values UDINT Distance between the two data sets for the calculation of the slope. Return value Name Type Description Configure BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 253
## Page 254

PLC API 5.1.1.6.5.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.6.5.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.6.6 FB_ALY_Mean_1Ch The Mean 1Ch calculates the mean value over the input values according to the formula The number of samples N that are included in the calculation can be configured by specifying a time interval. A cascaded output can be configured to realize a long-term mean value in a resource-saving way and to pick up intermediate results. The time interval of the configured cascade must correspond to an integer multiple of the time interval of the previous cascade. Syntax Definition: FUNCTION_BLOCK FB_ALY_Mean_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; END_VAR 254 Version: 1.5.0 TF3510
## Page 255

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Set Cascades() Local Method for configuring the cascades. The call is made after the call to the Configure method. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Sample VAR fb Mean : FB_ALY_Mean_1Ch; fb System Time : FB_ALY_Get System Time; n Num Cascades : UDINT := 5; f Sample Rate : UDINT := 1000; e Startup Behaviour : E_ALY_Cascade Startup Behaviour := E_ALY_Cascade Startup Behaviour. Use Previous Ca scade Value; a Cascades Config Array : ARRAY[1..5] OF LTIME := [LTIME#20MS, LTIME#1S, LTIME#1M, LTIME#1H, LTIME# 1D]; b Configure : BOOL := TRUE; f Input : LREAL; a Mean : ARRAY[1..5] OF LREAL; a New Result : ARRAY[1..5] OF BOOL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Mean. Configure(n Num Cascades, f Sample Rate, e Startup Behaviour); fb Mean. Set Cascades(ADR(a Cascades Config Array), SIZEOF(a Cascades Config Array)); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Mean. Set Channel Value(f Input); fb Mean. Call(fb System Time.t System Time, ADR(a Mean), SIZEOF(a Mean), ADR(a New Result), SIZEOF(a New Result) ) Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3510 Version: 1.5.0 255
## Page 256

PLC API 5.1.1.6.6.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; p Mean Array Out: POINTER TO LREAL; n Mean Array Out Size: UDINT; p New Result Array Out : POINTER TO BOOL; n New Result Array Out Size : UDINT END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. p Mean Array Out POINTER TO LREAL Pointer to an array in which the mean value results are to be saved. The dimension corresponds to the number of configured cascades. n Mean Array Out Size UDINT Size of the mean result array. p New Result Array Ou POINTER TO BOOL Pointer to an array in which the state of new RMS results t are to be stored. The dimension corresponds to the number of configured cascades. n New Result Array Ou UDINT Size of the status array. t Size Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.6.6.2 Configure Configuring the algorithm. The output cascades can be set using the Set Cascades() method. Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Num Cascades : UDINT; f Sample Rate : LREAL; e Startup Behaviour : E_ALY_Cascade Startup Behaviour; END_VAR 256 Version: 1.5.0 TF3510
## Page 257

PLC API Inputs Name Type Description n Num Cascades UDINT Number of output cascades. f Sample Rate LREAL Sample rate of the system to be analyzed in Hz. e Startup Behaviour E_ALY_Cascade Startup Beh Start-up behavior aviour [} 429] Wait Until Filled Waits until the configured timespan of the cascade has elapsed. The mean value result and the “New Result” Boolean flag are only set for the first time after the timespan has elapsed. Use Previous Cascade Value The RMS cascades whose configured timespan has not yet expired use the next smallest mean value result that has already been set. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.6.6.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.6.6.4 Set Cascades Configuration of the output cascades. Before that, the number of cascades must be set with the Configure() method. Syntax Definition: METHOD Set Cascades : BOOL VAR_INPUT p Cascades Config Array : POINTER TO LTIME; n Cascades Config Array Size : UDINT; END_VAR Inputs Name Type Description p Cascades Config Arr POINTER TO LTIME Pointer to an array used to configure the time intervals of ay the cascades. The time interval of the configured cascade must correspond to an integer multiple of the time interval of the previous cascade. n Cascades Config Arr UDINT Size of the configuration array. ay Size TF3510 Version: 1.5.0 257
## Page 258

PLC API Return value Name Type Description Set Cascades BOOL Returns TRUE if successful. 5.1.1.6.6.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.6.7 FB_ALY_Timespan Operation The Timespan Operation performs a mathematical operation on two or more different input channels and returns the result of the mathematical operation. Timespans with a resolution of 1 ns are supported as inputs. Syntax Definition: FUNCTION_BLOCK FB_ALY_Math Operation VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; fb Timespan Result: FB_ALY_Timespan; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. fb Timespan Result FB_ALY_Timespan Outputs the result of the mathematical operation as a timespan. 258 Version: 1.5.0 TF3510
## Page 259

PLC API Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Resolution of the time values in 1 ns. Sample VAR fb Timespan Operation : FB_ALY_Timespan Operation(n Num Channels := 2); e Timespan Operator : E_ALY_Timespan Operator := E_ALY_Timespan Operator. Addition; b Configure : BOOL := TRUE; t Input Ch1 : LTIME; t Input Ch2 : LINT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Timespan Operation. Configure(e Timespan Operator); END_IF // Call algorithm fb Timespan Operation. Set Channel Value(1, t Input Ch1); fb Timespan Operation. Set Channel Value(2, t Input Ch2); fb Timespan Operation. Call(); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.6.7.1 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used. TF3510 Version: 1.5.0 259
## Page 260

PLC API 5.1.1.6.7.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.6.7.3 Configure Configure the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Timespan Operator : E_ALY_Timespan Operator; END_VAR Inputs Name Type Description e Timespan Operator E_ALY_Timespan Operator Timespan operator [} 433] Addition Subtraction Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.6.7.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.6.7.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. 260 Version: 1.5.0 TF3510
## Page 261

PLC API Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.7 Preprocessing 5.1.1.7.1 FB_ALY_Scaler Fitting The Scaler Fitting module can be used to determine the parameters for feature scaling and save them in a file. These parameters can then be used in the Scaler module. The parameters required for scaling are determined depending on the operation mode. Normalization: Standardization: Syntax Definition: FUNCTION_BLOCK FB_Scaler Fitting VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Scaling Param1: LREAL; f Scaling Param2: LREAL; b Busy: BOOL; e State: E_Teach State; END_VAR TF3510 Version: 1.5.0 261
## Page 262

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Scaling Param1 LREAL Outputs the first scaling parameter depending on the scaling mode: Normalization: Smallest value of the input channel. Standardization: Mean value of the input channel. f Scaling Param1 LREAL Outputs the second scaling parameter depending on the scaling mode: Normalization: Largest value of the input channel. Standardization: Standard deviation of the input channel. b Busy BOOL TRUE if the FB is active due to a file access. e State E_ALY_Teach State [} 431] Current state of the function block. See state diagram. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Get Busy State() Local This method returns the Busy state of the function block. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Switch State_Idle() Local Method for setting the function block to Idle state when the teach-in process is complete. Switch State_Teach() Local Method for putting the function block into teach-in mode. Update State() Local State update after a state change has been initiated with one of the Switch State methods. Is called up until the target state is reached. State diagram Due to the asynchronous file access in real time applications this function block needs a state machine to prepare and finish file access. At startup the function block is in Idle state. To write the incoming data to a file it has to be switched to state Teach. Therefore the method Switch State_Teach() has to be called once to set the function block to the Pending Teach state. After that the method Update State() has to be called until the function block is in state Teach. In this state one or multiple teach cycles can be proceeded. If the function block should not teach additional cycles it can be set to Idle state again. To initiate the state switch the method Switch State_Idle() has to be called. After that the method Update State() has to be called until the function block is in state Idle. State diagram for the teach procedure of the data: 262 Version: 1.5.0 TF3510
## Page 263

PLC API Sample VAR fb Scaler Fitting : FB_ALY_Scaler Fitting_1Ch; t Timeout : TIME := T#5S; e Scaling Mode : E_ALY_Scaling Mode := E_ALY_Scaling Mode. Normalization; s File Path : STRING := '%TC_BOOTPRJPATH%\Scaler.json'; b Configure : BOOL := TRUE; e State : E_ALY_Teach State := E_ALY_Teach State. Idle; b Teach : BOOL; f Input : LREAL; b Fit : BOOL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Scaler Fitting. Configure(e Scaling Mode, t Timeout, s File Path); END_IF // Call algorithm e State := fb Scaler Fitting.e State; CASE e State OF E_ALY_Teach State. Idle: IF b Teach THEN fb Scaler Fitting. Switch State_Teach(); fb Scaler Fitting. Update State(); END_IF E_ALY_Teach State. Teach: fb Scaler Fitting. Set Channel Value(f Input); fb Scaler Fitting. Call(b Fit); IF NOT b Teach THEN fb Scaler Fitting. Switch State_Idle(); fb Scaler Fitting. Update State(); END_IF E_ALY_Teach State. Pending, E_ALY_Teach State. Pending Idle, E_ALY_Teach State. Pending Teach: fb Scaler Fitting. Update State(); e State := fb Scaler Fitting.e State; END_CASE Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics TF3510 Version: 1.5.0 263
## Page 264

PLC API 5.1.1.7.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT b Fit : BOOL; END_VAR Inputs Name Type Description b Fit BOOL Parameter adjustment can be enabled or disabled. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.7.1.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Scaling Mode : E_ALY_Scaling Mode; t Timeout: LREAL; s File Path : STRING(255); END_VAR Inputs Name Type Description e Scaling Mode E_ALY_Scaling Mode Scaling mode Normalization [} 433] Standardization t Timeout TIME Timeout for asynchronous operations. s File Path STRING(255) Path to the taught file, e.g. C: \Twin CAT\3.1\Boot\Scaling.tas Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.7.1.3 Get Busy State Returns TRUE if the function block is busy due to an asynchronous file access. 264 Version: 1.5.0 TF3510
## Page 265

PLC API Syntax Definition: METHOD Get Busy State : BOOL VAR_INPUT END_VAR Return value Name Type Description Get Busy State BOOL Returns TRUE if the FB is active. 5.1.1.7.1.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.7.1.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.7.1.6 Switch State_Idle Initiate switch from Teach state to Idle state. See State diagram. Syntax Definition: METHOD Switch State_Idle : BOOL VAR_INPUT END_VAR TF3510 Version: 1.5.0 265
## Page 266

PLC API Return value Name Type Description Switch State_Idle BOOL Returns TRUE if successful 5.1.1.7.1.7 Switch State_Teach Initiate switch from Idle state to Teach state. See State diagram. Syntax Definition: METHOD Switch State_Teach : BOOL VAR_INPUT END_VAR Return value Name Type Description Switch State_Teach BOOL Returns TRUE if successful 5.1.1.7.1.8 Update State Update state after state change was initiated and until target state is not reached. Syntax Definition: METHOD Update State : BOOL VAR_INPUT END_VAR Return value Name Type Description Update State BOOL Returns TRUE if successful 5.1.1.7.2 FB_ALY_Scaler The Scaler module can be used to perform feature scaling. Depending on the operation mode, the scaling parameters are used in different ways. Normalization Standardization: The scaling parameters can be configured directly. Alternatively, they can be imported from a file. 266 Version: 1.5.0 TF3510
## Page 267

PLC API Syntax Definition: FUNCTION_BLOCK FB_ALY_Scaler VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Busy: BOOL; e State: E_ALY_Config State; st File Header: ST_ALY_File Header; f Result : LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Busy BOOL TRUE if the FB is active due to a file access. e State E_ALY_Config State [} 432] Configuration status of the function block. f Result LREAL Outputs the calculated value. This is calculated from the two scaling parameters depending on the scaling mode. Normalization: Result has a value range of 0..+1 Standardization: Result has a value range of -1..+1. Methods Name Definition lo- Description cation Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm after the individual coefficients have been set. Configure From File() Local Configuration of the algorithm via a previously created file. Get Busy State() Local This method returns the Busy state of the function block. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Update State() Local State update after a state change has been initiated with the Configure From File() method. Is called up until the target state is reached. Sample - Configuration by parameter VAR fb Scaler : FB_ALY_Scaler_1Ch; e Scaling Mode : E_ALY_Scaling Mode := E_ALY_Scaling Mode. Normalization; f Scaling Param1 : LREAL := 2.0; // high f Scaling Param2 : LREAL := 1.0; // low b Configure : BOOL := TRUE; f Input : LREAL; END_VAR TF3510 Version: 1.5.0 267
## Page 268

PLC API // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Scaler. Configure(e Scaling Mode, f Scaling Param1, f Scaling Param2); END_IF // Call algorithm fb Scaler. Set Channel Value(f Input); fb Scaler. Call(); Sample – Configuration by file VAR fb Scaler : FB_ALY_Scaler_1Ch; e Scaling Mode : E_ALY_Scaling Mode := E_ALY_Scaling Mode. Normalization; t Timeout : TIME := TIME#5S; s File Path : STRING := '%TC_BOOTPRJPATH%\Scaler.json'; b Configure : BOOL := TRUE; f Input : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Scaler. Configure From File(t Timeout, s File Path); END_IF // Update pending state IF fb Scaler.e State = E_ALY_Config State. Pending THEN fb Scaler. Update State(); END_IF // Call algorithm IF fb Scaler.e State = E_ALY_Config State. Configured THEN fb Scaler. Set Channel Value(f Input); fb Scaler. Call(); END_IF Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.7.2.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.7.2.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: 268 Version: 1.5.0 TF3510
## Page 269

PLC API METHOD Configure : BOOL VAR_INPUT e Scaling Mode : E_ALY_Scaling Mode; f Scaling Param1 : LREAL; f Scaling Param2 : LREAL; END_VAR Inputs Name Type Description e Scaling Mode E_ALY_Scaling Mode Scaling mode Normalization: Result has a value range of 0..+1. [} 433] Standardization: Result has a value range of -1..+1. f Scaling Param1 LREAL Scaling parameters depending on the scaling mode: Normalization: Smallest value of the input channel. Standardization: Mean value of the input channel. f Scaling Param2 LREAL Scaling parameters depending on the scaling mode: Normalization: Largest value of the input channel. Standardization: Standard deviation of the input channel. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.7.2.3 Configure From File Configures the algorithm based on a previously created file. After calling this method, the method Update State() must be called until the status of the function block is no longer Pending. Syntax Definition: METHOD Configure From File : BOOL VAR_INPUT t Timeout : TIME; s File Path : STRING(255); END_VAR Inputs Name Type Description t Timeout TIME Timeout for asynchronous operations. s File Path STRING(255) Path to the taught file, e.g. C: \Twin CAT\3.1\Boot\Teach.json Return value Name Type Description Configure From File BOOL Returns TRUE if successful. 5.1.1.7.2.4 Get Busy State Returns TRUE if the function block is busy due to an asynchronous file access. Syntax Definition: TF3510 Version: 1.5.0 269
## Page 270

PLC API METHOD Get Busy State : BOOL VAR_INPUT END_VAR Return value Name Type Description Get Busy State BOOL Returns TRUE if the FB is active. 5.1.1.7.2.5 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.7.2.6 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.7.2.7 Update State Updates the state after a state change has been initiated by calling the Configure From File() method. The method must be called cyclically until the state of the function block is no longer Pending. Syntax Definition: METHOD Update State : BOOL VAR_INPUT END_VAR Return value Name Type Description Update State BOOL Returns TRUE if successful. 270 Version: 1.5.0 TF3510
## Page 271

PLC API 5.1.1.8 Reporting 24/7 reporting can be implemented in Twin CAT Analytics using the algorithms in the Reporting category. The reporting collectors collect the data and send it to the reporting server. The reporting triggers trigger the creation of a report. 5.1.1.8.1 Reporting Collector The Reporting Collectors collect data and send it to the Reporting Server in a data message after an event. 5.1.1.8.1.1 Reporting Collector Edge The Reporting Collector Edge collects the data from the input channels and sends the data to the Reporting Server after an event or after the buffer is filled, depending on the configuration. An event is triggered when the signal of the input channel passes the configured edge at a certain threshold. Syntax Definition: FUNCTION_BLOCK FB_Rpt_Collector Edge VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; fb Time Last Event: FB_ALY_Date Time; n Buffer Count: UDINT; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. fb Time Last Event FB_ALY_Date Time Stores the timestamp of the last message sent to the reporting server. n Buffer Count UDINT Indicates the number of elements in the buffer. Methods Name Type Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Display Name() Local Method for describing the input channel. Set Edge Value() Local Method for passing values to the edge channel of the algorithm. TF3510 Version: 1.5.0 271
## Page 272

PLC API Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample The Reporting Server expects variables of type String with UTF-8 encoding. This attribute must be set accordingly via the declaration of the variable and the string values must be converted. VAR fb Rpt_Collector Edge: FB_Rpt_Collector Edge(s Net ID:='', n Num Channels:=3); fb System Time : FB_ALY_Get System Time; b Edge: BOOL; f Data In Ch1: LREAL; f Data In Ch2: LREAL; f Data In Ch3: LREAL; st Threshold Edge: ST_ALY_Threshold; {attribute 'Tc Encoding':='UTF-8'} s Report Name: STRING(255); f Tolerance: LREAL; {attribute 'Tc Encoding':='UTF-8'} s Data Key: STRING(255); n Buffer Size: UDINT; b Include Timestamps: BOOL; {attribute 'Tc Encoding':='UTF-8'} a Channel Names: ARRAY [1..3] OF STRING(255); END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; s Report Name:= 'Beckhoff Report Template'; f Tolerance:= 0; s Data Key:= 'Data Key101'; n Buffer Size:= 1; b Include Timestamps:= TRUE; a Channel Names[1]:= s Literal_TO_UTF8('Min'); a Channel Names[2]:= s Literal_TO_UTF8('Max'); a Channel Names[3]:= s Literal_TO_UTF8('Avg'); st Threshold Edge.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge.f Threshold := 1; fb Rpt_Collector Edge. Configure( s Config Id:= s Report Name, s Data Key:= s Data Key, n Buffer Size:= n Buffer Size, b Buffer On Event:= b Buffer On Event, b Include Timestamps:= b Include Timestamps, st Threshold Edge:= st Threshold Edge); fb Rpt_Collector Edge.f Tolerance:= f Tolerance; fb Rpt_Collector Edge. Set Display Name(n Channel:= 1, s Display Name:= a Channel Names[1]); fb Rpt_Collector Edge. Set Display Name(n Channel:= 2, s Display Name:= a Channel Names[2]); fb Rpt_Collector Edge. Set Display Name(n Channel:= 3, s Display Name:= a Channel Names[3]); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Rpt_Collector Edge. Set Channel Value(n Channel:= 1, Input:= f Data In Ch1); fb Rpt_Collector Edge. Set Channel Value(n Channel:= 2, Input:= f Data In Ch2); fb Rpt_Collector Edge. Set Channel Value(n Channel:= 3, Input:= f Data In Ch3); fb Rpt_Collector Edge. Call(fb System Time.t System Time); 272 Version: 1.5.0 TF3510
## Page 273

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.8.1.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.8.1.1.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT s Config Id : STRING; s Data Key : STRING; st Threshold Edge : ST_ALY_Threshold; b Include Timestamps : BOOL; n Buffer Size : UDINT; b Buffer On Event : BOOL; END_VAR TF3510 Version: 1.5.0 273
## Page 274

PLC API Inputs Name Type Description s Config Id STRING Indicates the name of the report. The name must correspond to the name of the configuration file at the Reporting Server. s Data Key STRING The data key should be unique within a report. The data object can be uniquely assigned to the report via the data key. st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. b Include Timestamps BOOL Inserts a column with the timestamps. n Buffer Size UDINT Indicates the size of the buffered data. If the buffer size is equal to one, a key-value structure is built. If the buffer size is greater than one, the data is presented in a table. b Buffer On Event BOOL Indicates how the data is to be collected and buffered. If the parameter is True, the data of the inputs is buffered at each edge signal at the input. As soon as the Buffer Count output has the same value as the Buffer Size parameter, the data is sent to the Tc Reporting Server. If the parameter is False, the data of the inputs are buffered in the buffer at each cycle. Once the buffer size is reached, the new data replaces the previous data. If there is an edge signal at the input, the data is sent to the Tc Reporting Server. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.8.1.1.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.8.1.1.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR 274 Version: 1.5.0 TF3510
## Page 275

PLC API Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.8.1.1.5 Set Display Name Setting a channel-specific description. In reporting, the description serves as a table heading for a table and as a key value for a key-value pair. Syntax Definition: METHOD Set Display Name : BOOL VAR_INPUT n Channel : UDINT; s Display Name : STRING(255); END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) s Display Name STRING(255) Input value of type string. Return value Name Type Description Set Display Name BOOL Returns TRUE if successful. 5.1.1.8.1.1.6 Set Edge Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Edge Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. TF3510 Version: 1.5.0 275
## Page 276

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.8.1.2 Reporting Collector Interval The Reporting Collector Interval collects the data from the input channels and sends the data to the Reporting Server after an event or after the buffer is filled, depending on the configuration. An event is triggered when the timespan of the configured interval has expired. Syntax Definition: FUNCTION_BLOCK FB_Rpt_Collector Interval VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; fb Time Last Event: FB_ALY_Date Time; fb Time Current Interval: FB_ALY_Timespan; n Buffer Count: UDINT; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. fb Time Last Event FB_ALY_Date Time Stores the timestamp of the last message sent to the reporting server. fb Time Current Interv FB_ALY_Timespan Indicates the timespan until the next event. al n Buffer Count UDINT Indicates the number of elements in the buffer. Methods Name Type Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Display Name() Local Method for describing the input channel. Pause() Local Method to pause the execution including the internal time intervals. 276 Version: 1.5.0 TF3510
## Page 277

PLC API Sample The Reporting Server expects variables of type String with UTF-8 encoding. This attribute must be set accordingly via the declaration of the variable and the string values must be converted. VAR fb Rpt_Collector Interval: FB_Rpt_Collector Interval(s Net ID:='', n Num Channels:=3); fb System Time : FB_ALY_Get System Time; f Data In Ch1: LREAL; f Data In Ch2: LREAL; f Data In Ch3: LREAL; t Interval : LTIME; {attribute 'Tc Encoding':='UTF-8'} s Report Name: STRING(255); {attribute 'Tc Encoding':='UTF-8'} s Data Key: STRING(255); n Buffer Size: UDINT; b Include Timestamps: BOOL; {attribute 'Tc Encoding':='UTF-8'} a Channel Names: ARRAY [1..3] OF STRING(255); END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; s Report Name:= 'Beckhoff Report Template'; s Data Key:= 'Data Key101'; n Buffer Size:= 1; b Include Timestamps:= TRUE; a Channel Names[1]:= s Literal_TO_UTF8('Min'); a Channel Names[2]:= s Literal_TO_UTF8('Max'); a Channel Names[3]:= s Literal_TO_UTF8('Avg'); t Interval := LTIME#5S; fb Rpt_Collector Interval. Configure( s Config Id:= s Report Name, s Data Key:= s Data Key, t Interval:= t Interval, n Buffer Size:= n Buffer Size, b Buffer On Event:= b Buffer On Event, b Include Timestamps:= b Include Timestamps); fb Rpt_Collector Interval. Set Display Name(n Channel:= 1, s Display Name:= a Channel Names[1]); fb Rpt_Collector Interval. Set Display Name(n Channel:= 2, s Display Name:= a Channel Names[2]); fb Rpt_Collector Interval. Set Display Name(n Channel:= 3, s Display Name:= a Channel Names[3]); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Rpt_Collector Interval. Set Channel Value(n Channel:= 1, Input:= f Data In Ch1); fb Rpt_Collector Interval. Set Channel Value(n Channel:= 2, Input:= f Data In Ch2); fb Rpt_Collector Interval. Set Channel Value(n Channel:= 3, Input:= f Data In Ch3); fb Rpt_Collector Interval. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.8.1.2.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: TF3510 Version: 1.5.0 277
## Page 278

PLC API METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.8.1.2.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT s Config Id : STRING; s Data Key : STRING; t Interval : LTIME; b Include Timestamps : BOOL; n Buffer Size : UDINT; b Buffer On Event : BOOL; END_VAR Inputs Name Type Description s Config Id STRING Indicates the name of the report. The name must correspond to the name of the configuration file at the Reporting Server. s Data Key STRING The data key should be unique within a report. The data object can be uniquely assigned to the report via the data key. t Interval LTIME Time interval at which the data should be sent to the Reporting Server. b Include Timestamps BOOL Inserts a column with the timestamps. n Buffer Size UDINT Indicates the size of the buffered data. If the buffer size is equal to one, a key-value structure is built. If the buffer size is greater than one, the data is presented in a table. b Buffer On Event BOOL Indicates how the data is to be collected and buffered. If the parameter is True, the data of the inputs is buffered at each edge signal at the input. As soon as the Buffer Count output has the same value as the Buffer Size parameter, the data is sent to the Tc Reporting Server. If the parameter is False, the data of the inputs are buffered in the buffer at each cycle. Once the buffer size is reached, the new data replaces the previous data. If there is an edge signal at the input, the data is sent to the Tc Reporting Server. 278 Version: 1.5.0 TF3510
## Page 279

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.8.1.2.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.8.1.2.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.8.1.2.5 Set Display Name Setting a channel-specific description. In reporting, the description serves as a table heading for a table and as a key value for a key-value pair. Syntax Definition: METHOD Set Display Name : BOOL VAR_INPUT n Channel : UDINT; s Display Name : STRING(255); END_VAR TF3510 Version: 1.5.0 279
## Page 280

PLC API Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) s Display Name STRING(255) Input value of type string. Return value Name Type Description Set Display Name BOOL Returns TRUE if successful. 5.1.1.8.1.2.6 Pause With the Pause method it is possible to pause the execution of the function block. The internally running time interval does not continue after calling the pause function. A single call of the method is sufficient. The interval is not continued until the next call of the Call method. Syntax Definition: METHOD Pause : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Pause BOOL Returns TRUE if successful. 5.1.1.8.1.3 Reporting Collector Time The Reporting Collector Time collects the data from the input channels and sends the data to the Reporting Server after an event or after the buffer is filled, depending on the configuration. An event is triggered when the configured switch-on time is reached. The switch-on time and the days of the weeks can be configured. Syntax Definition: FUNCTION_BLOCK FB_Rpt_Collector Time VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; fb Time Last Event: FB_ALY_Date Time; fb Time Until Next Switch: FB_ALY_Timespan; n Buffer Count: UDINT; END_VAR 280 Version: 1.5.0 TF3510
## Page 281

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. fb Time Last Event FB_ALY_Date Time Stores the timestamp of the last message sent to the reporting server. fb Time Until Next Swit FB_ALY_Timespan Indicates the timespan until the next event. ch n Buffer Count UDINT Indicates the number of elements in the buffer. Methods Name Type Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Display Name() Local Method for describing the input channel. Sample The Reporting Server expects variables of type String with UTF-8 encoding. This attribute must be set accordingly via the declaration of the variable and the string values must be converted. VAR fb Rpt_Collector Time: FB_Rpt_Collector Time(s Net ID:='', n Num Channels:=3); fb System Time : FB_ALY_Get System Time; f Data In Ch1: LREAL; f Data In Ch2: LREAL; f Data In Ch3: LREAL; t Time On : LTIME; n Day Of Week Mask : WORD; {attribute 'Tc Encoding':='UTF-8'} s Report Name: STRING(255); {attribute 'Tc Encoding':='UTF-8'} s Data Key: STRING(255); n Buffer Size: UDINT; b Include Timestamps: BOOL; {attribute 'Tc Encoding':='UTF-8'} a Channel Names: ARRAY [1..3] OF STRING(255); END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; s Report Name:= 'Beckhoff Report Template'; s Data Key:= 'Data Key101'; n Buffer Size:= 1; b Include Timestamps:= TRUE; a Channel Names[1]:= s Literal_TO_UTF8('Min'); a Channel Names[2]:= s Literal_TO_UTF8('Max'); a Channel Names[3]:= s Literal_TO_UTF8('Avg'); t Time On := LTIME#5H; n Day Of Week Mask := 2#0011_0101; TF3510 Version: 1.5.0 281
## Page 282

PLC API fb Rpt_Collector Time. Configure( s Config Id:= s Report Name, s Data Key:= s Data Key, t Time On:= t Time On, n Day Of Week Mask:= n Day Of Week Mask, n Buffer Size:= n Buffer Size, b Buffer On Event:= b Buffer On Event b Include Timestamps:= b Include Timestamps); fb Rpt_Collector Time. Set Display Name(n Channel:= 1, s Display Name:= a Channel Names[1]); fb Rpt_Collector Time. Set Display Name(n Channel:= 2, s Display Name:= a Channel Names[2]); fb Rpt_Collector Time. Set Display Name(n Channel:= 3, s Display Name:= a Channel Names[3]); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Rpt_Collector Time. Set Channel Value(n Channel:= 1, Input:= f Data In Ch1); fb Rpt_Collector Time. Set Channel Value(n Channel:= 2, Input:= f Data In Ch2); fb Rpt_Collector Time. Set Channel Value(n Channel:= 3, Input:= f Data In Ch3); fb Rpt_Collector Time. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.8.1.3.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.8.1.3.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT s Config Id : STRING; s Data Key : STRING; t Time On : LTIME; 282 Version: 1.5.0 TF3510
## Page 283

PLC API n Day Of Week Mask : WORD; b Include Timestamps : BOOL; n Buffer Size : UDINT; b Buffer On Event : BOOL; END_VAR Inputs Name Type Description s Config Id STRING Indicates the name of the report. The name must correspond to the name of the configuration file at the Reporting Server. s Data Key STRING The data key should be unique within a report. The data object can be uniquely assigned to the report via the data key. t Time On LTIME Indicates the switch-on time. n Day Of Week Mask WORD Indicates the days of the week when the timer should be active. b Include Timestamps BOOL Inserts a column with the timestamps. n Buffer Size UDINT Indicates the size of the buffered data. If the buffer size is equal to one, a key-value structure is built. If the buffer size is greater than one, the data is presented in a table. b Buffer On Event BOOL Indicates how the data is to be collected and buffered. If the parameter is True, the data of the inputs is buffered at each edge signal at the input. As soon as the Buffer Count output has the same value as the Buffer Size parameter, the data is sent to the Tc Reporting Server. If the parameter is False, the data of the inputs are buffered in the buffer at each cycle. Once the buffer size is reached, the new data replaces the previous data. If there is an edge signal at the input, the data is sent to the Tc Reporting Server. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.8.1.3.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.8.1.3.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: TF3510 Version: 1.5.0 283
## Page 284

PLC API METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.8.1.3.5 Set Display Name Setting a channel-specific description. In reporting, the description serves as a table heading for a table and as a key value for a key-value pair. Syntax Definition: METHOD Set Display Name : BOOL VAR_INPUT n Channel : UDINT; s Display Name : STRING(255); END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) s Display Name STRING(255) Input value of type string. Return value Name Type Description Set Display Name BOOL Returns TRUE if successful. 5.1.1.8.2 Reporting Trigger The Reporting Triggers send a trigger message to the Reporting Server after an event and thus trigger the creation of a report. 5.1.1.8.2.1 Reporting Trigger Edge The Reporting Trigger Edge triggers the creation of a report after an event is triggered. An event is triggered when the input channel signal exceeds the configured edge at a specified threshold. Internally, the inputs that were once True remain True. The inputs are only reset to False as soon as all inputs were True at least once. This allows the output b New Result to be used as one input by multiple Reporting Collectors and once all Reporting Collectors have sent a data message, a trigger message is sent. Syntax Definition: 284 Version: 1.5.0 TF3510
## Page 285

PLC API FUNCTION_BLOCK FB_Rpt_Trigger Edge VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; fb Time Last Event: FB_ALY_Date Time; s Overview: STRING(255) := ''; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. fb Time Last Event FB_ALY_Date Time Stores the timestamp of the last message sent to the reporting server. s Overview STRING Indicates which input channels were TRUE at least once. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Properties Name Type Access Definition location Initial value Description f Tolerance LREAL Get, Set Local 0.0 Tolerance value for the Equal / Not Equal comparisons Sample VAR fb Rpt Trigger Edge: FB_Rpt_Trigger Edge(s Net Id:= '', n Num Channels:=2); fb System Time : FB_ALY_Get System Time; f Edge Ch1: BOOL; f Edge Ch2: BOOL; st Threshold Edge: ST_ALY_Threshold; TF3510 Version: 1.5.0 285
## Page 286

PLC API f Tolerance: LREAL; s Report Name: STRING(255); END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; s Report Name:= 'Beckhoff Report Template'; f Tolerance:= 0; st Threshold Edge.e Comparison Operator := E_ALY_Comparison Operator. Equals; st Threshold Edge.f Threshold := 1; fb Rpt Trigger Edge. Configure(s Config Id:= s Report Name, st Threshold Edge := st Threshold Edge); END_IF fb Rpt Trigger Edge. Set Channel Value(n Channel:= 1, input:= f Edge Ch1); fb Rpt Trigger Edge. Set Channel Value(n Channel:= 2, input:= f Edge Ch1); fb Rpt Trigger Edge. Call(t Timestamp); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.8.2.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.8.2.1.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT s Config Id : STRING; st Threshold Edge : ST_ALY_Threshold; END_VAR 286 Version: 1.5.0 TF3510
## Page 287

PLC API Inputs Name Type Description s Config Id STRING Indicates the name of the report. The name must correspond to the name of the configuration file at the Reporting Server. st Threshold Edge ST_ALY_Threshold [} 427] Combination of comparison operator and threshold for edge detection. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.8.2.1.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.8.2.1.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.8.2.2 Reporting Trigger Interval The Reporting Trigger Interval triggers the creation of a report after an event has been triggered. An event is triggered when the timespan of the configured interval has expired. Syntax Definition: TF3510 Version: 1.5.0 287
## Page 288

PLC API FUNCTION_BLOCK FB_Rpt_Trigger Interval VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; fb Time Last Event: FB_ALY_Date Time; fb Time Current Interval: FB_ALY_Timespan; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. fb Time Last Event FB_ALY_Date Time Stores the timestamp of the last message sent to the reporting server. fb Time Current Interv FB_ALY_Timespan Indicates the timespan until the next event. al Methods Name Type Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Pause() Local Method to pause the execution including the internal time intervals. Sample VAR fb Rpt Trigger Interval: FB_Rpt_Trigger Interval(s Net Id:= '', n Num Channels:=2); fb System Time : FB_ALY_Get System Time; s Report Name: STRING(255); t Interval: LTIME; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; s Report Name:= 'Beckhoff Report Template'; t Interval := LTIME#5S; fb Rpt Trigger Interval. Configure(s Config Id:= s Report Name, t Interval:= t Interval); END_IF fb Rpt Trigger Interval. Call(t Timestamp); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 288 Version: 1.5.0 TF3510
## Page 289

PLC API 5.1.1.8.2.2.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.8.2.2.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT s Config Id : STRING; t Interval : LTIME; END_VAR Inputs Name Type Description s Config Id STRING Indicates the name of the report. The name must correspond to the name of the configuration file at the Reporting Server. t Interval LTIME Time interval at which the data should be sent to the Reporting Server. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.8.2.2.3 Reset Resetting the algorithm. TF3510 Version: 1.5.0 289
## Page 290

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.8.2.2.4 Pause With the Pause method it is possible to pause the execution of the function block. The internally running time interval does not continue after calling the pause function. A single call of the method is sufficient. The interval is not continued until the next call of the Call method. Syntax Definition: METHOD Pause : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Pause BOOL Returns TRUE if successful. 5.1.1.8.2.3 Reporting Trigger Time The Reporting Trigger Time triggers the creation of a report after an event has been triggered. An event is triggered when the configured switch-on time is reached. The switch-on time and the days of the weeks can be configured. Syntax Definition: FUNCTION_BLOCK FB_Rpt_Trigger Time VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; fb Time Last Event: FB_ALY_Date Time; fb Time Until Next Switch: FB_ALY_Timespan; END_VAR 290 Version: 1.5.0 TF3510
## Page 291

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. fb Time Last Event FB_ALY_Date Time Stores the timestamp of the last message sent to the reporting server. fb Time Until Next Swit FB_ALY_Timespan Indicates the timespan until the next event. ch Methods Name Type Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations performed so far. Pause() Local Method to pause the execution including the internal time intervals. Sample VAR fb Rpt Trigger Time: FB_Rpt_Trigger Time(s Net Id:= '', n Num Channels:=2); fb System Time : FB_ALY_Get System Time; s Report Name: STRING(255); n Day Of Week Mask : WORD; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; s Report Name:= 'Beckhoff Report Template'; t Time On := LTIME#5H; n Day Of Week Mask := 2#0011_0101; fb Rpt Trigger Time. Configure(s Config Id:= s Report Name, t Time On:= t Time On, n Day Of Week Mask:= n Day Of We ek Mask); END_IF fb Rpt Trigger Time. Call(t Timestamp); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.8.2.3.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). TF3510 Version: 1.5.0 291
## Page 292

PLC API Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.8.2.3.2 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT s Config Id : STRING; t Time On : LTIME; n Day Of Week Mask : WORD; END_VAR Inputs Name Type Description s Config Id STRING Indicates the name of the report. The name must correspond to the name of the configuration file at the Reporting Server. t Time On LTIME Indicates the switch-on time. n Day Of Week Mask WORD Indicates the days of the week when the timer should be active. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.8.2.3.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 292 Version: 1.5.0 TF3510
## Page 293

PLC API 5.1.1.9 Specific 5.1.1.9.1 XTS 5.1.1.9.1.1 FB_ALY_Xts Acceleration Analysis_1Ch The XTS Acceleration Analysis 1Ch calculates the current acceleration of a XTS mover. For this purpose, the length of the XTS in millimeters must be declared and as input signal the mover position is required. Syntax Definition: FUNCTION_BLOCK FB_ALY_Xts Acceleration Analysis_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Acceleration: LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Acceleration LREAL Current acceleration of the XTS mover in m/s². Methods Name Definition Location Description Call() Local method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Xts Acceleration : FB_ALY_Xts Acceleration Analysis_1Ch; fb System Time : FB_ALY_Get System Time; n Xts Lenght : UDINT := 4000; b Configure : BOOL := TRUE; f Position : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Xts Acceleration. Configure(n Xts Lenght); END_IF // Get current system time fb System Time. Call(); TF3510 Version: 1.5.0 293
## Page 294

PLC API // Call algorithm fb Xts Acceleration. Set Channel Value(f Position); fb Xts Acceleration. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.9.1.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.9.1.1.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Xts Length : UDINT; END_VAR Inputs Name Type Description n Xts Length UDINT Length of the given XTS system in millimeters. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.9.1.1.3 Reset Resetting the algorithm. 294 Version: 1.5.0 TF3510
## Page 295

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.9.1.1.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.9.1.2 FB_ALY_Xts Distance Integrator_1Ch The XTS Distance Integrator 1Ch calculates the distance covered by a XTS mover. The algorithm provides the total distance, the positive distance and the negative distance. For this purpose, the length of the XTS in millimeters must be declared and as input signal the mover position is required. Syntax Definition: FUNCTION_BLOCK FB_ALY_Xts Distance Integrator_1Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Distance: LREAL; f Distance Pos: LREAL; f Distance Neg: LREAL; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. TF3510 Version: 1.5.0 295
## Page 296

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Distance LREAL Total distance covered by the XTS mover. In m. f Distance Pos LREAL Positive distance covered by the XTS mover (direction: forward). In m. f Distance Neg LREAL Negative distance covered by the XTS mover (direction: backward). In m. Methods Name Definition Location Description Call() Local Method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Xts Distance : FB_ALY_Xts Distance Integrator_1Ch; n Xts Lenght : UDINT := 4000; b Configure : BOOL := TRUE; f Position : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Xts Distance. Configure(n Xts Lenght); END_IF // Call algorithm fb Xts Distance. Set Channel Value(f Position); fb Xts Distance. Call(); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.9.1.2.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR 296 Version: 1.5.0 TF3510
## Page 297

PLC API Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.9.1.2.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Xts Length : UDINT; END_VAR Inputs Name Type Description n Xts Length UDINT Length of the given XTS system in millimeters. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.9.1.2.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.9.1.2.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. TF3510 Version: 1.5.0 297
## Page 298

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.9.1.3 FB_ALY_Xts Velocity Analysis_1Ch The XTS Velocity Analysis 1Ch calculates the current velocity of a XTS mover. For this purpose, the length of the XTS in millimeters must be declared and as input signal the mover position is required. Syntax Definition: FUNCTION_BLOCK FB_ALY_Xts Velocity Analysis_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Velocity: LRAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Velocity LREAL Current velocity of the XTS mover in m/s. Methods Name Definition Location Description Call() Local Method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Xts Velocity : FB_ALY_Xts Velocity Analysis_1Ch; fb System Time : FB_ALY_Get System Time; n Xts Lenght : UDINT := 4000; b Configure : BOOL := TRUE; f Position : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Xts Velocity. Configure(n Xts Lenght); END_IF // Get current system time fb System Time. Call(); 298 Version: 1.5.0 TF3510
## Page 299

PLC API // Call algorithm fb Xts Velocity. Set Channel Value(f Position); fb Xts Velocity. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.9.1.3.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.9.1.3.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Xts Length : UDINT; END_VAR Inputs Name Type Description n Xts Length UDINT Length of the given XTS system in millimeters. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.9.1.3.3 Reset Resetting the algorithm. TF3510 Version: 1.5.0 299
## Page 300

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.9.1.3.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.9.2 Wind Turbine 5.1.1.9.2.1 FB_ALY_Wt Turbulence_1Ch The WT Turbulence 1Ch calculates the mean of the wind velocity, the turbulence, and the turbulence intensity according to the standard EN 61400-1. As input signal, the wind velocity is required. The output values are updated in a cycle of 10 minutes. Syntax Definition: FUNCTION_BLOCK FB_ALY_Wt Turbulence_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Mean: LREAL; f Turbulence: LREAL; f Turbulence Intensity: LREAL; END_VAR 300 Version: 1.5.0 TF3510
## Page 301

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Mean LREAL Mean value of the wind speed. f Turbulence LREAL Turbulence of the wind. According to the EN standard, this is the standard deviation of the wind speed during a time interval of 10 minutes. f Turbulence Intensity LREAL Intensity of wind turbulence. Methods Name Definition Location Description Call() Local Method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Wt Turbulence : FB_ALY_Wt Turbulence_1Ch; fb System Time : FB_ALY_Get System Time; n Num Cycles : UDINT; b Configure : BOOL := TRUE; n Input : INT; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Wt Turbulence. Configure(n Num Cycles); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Wt Turbulence. Set Channel Value(n Input); fb Wt Turbulence. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.9.2.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: TF3510 Version: 1.5.0 301
## Page 302

PLC API METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.9.2.1.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Num Cycles : UDINT; END_VAR Inputs Name Type Description n Num Cycles UDINT Indicates the number of PLC cycles that fit into the time interval for the calculation, according to EN 61400-1 this is an interval of ten minutes. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.9.2.1.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.9.2.1.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: 302 Version: 1.5.0 TF3510
## Page 303

PLC API METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.9.3 AM 5.1.1.9.3.1 FB_ALY_AM8xxx SSD The AM8xxx SSD enables the analysis of a motor equipped with the Smart System Diagnosis functionality. The built-in encoder records measured values from various internally installed sensors. These include the temperature and humidity in the encoder, as well as the acceleration in the X and Y directions. Various statistical parameters are calculated on the basis of these measured values and threshold monitoring is carried out to detect shocks. Syntax Definition: FUNCTION_BLOCK FB_ALY_Section Timer_1Ch VAR_OUTPUT ip Result Message : Tc3_Event Logger. I_Tc Message; b Error : BOOL; b New Result : BOOL; b Configured : BOOL; st Humidity : ST_ALY_Live Min Max Avg; st Temperature : ST_ALY_Live Min Max Avg; st XRms Acceleration : ST_ALY_Live Min Max Avg; st XKurtosis Acceleration : ST_ALY_Live Min Max Avg; st XPeak Peak Acceleration : ST_ALY_Live Min Max Avg; st YRms Acceleration : ST_ALY_Live Min Max Avg; st YKurtosis Acceleration : ST_ALY_Live Min Max Avg; st YPeak Peak Acceleration : ST_ALY_Live Min Max Avg; b XShock Detected : BOOL; n Count XShocks : ULINT; fb Last XShock Event : FB_ALY_Date Time; b YShock Detected : BOOL; n Count YShocks : ULINT; fb Last YShock Event : FB_ALY_Date Time; n Count Total Shocks : ULINT; END_VAR TF3510 Version: 1.5.0 303
## Page 304

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block has been configured successfully. st Humidity ST_ALY_Live Min Max Avg Humidity inside the encoder in %. [} 427] st Temperature ST_ALY_Live Min Max Avg Temperature inside the encoder in °C. [} 427] st XRms Acceleration ST_ALY_Live Min Max Avg RMS of the acceleration in the X direction in g. [} 427] st XKurtosis Accelerat ST_ALY_Live Min Max Avg Kurtosis of the acceleration in the X direction. ion [} 427] st XPeak Peak Accele ST_ALY_Live Min Max Avg Peak-to-peak value of the acceleration in the X direction in ration g. [} 427] st YRms Acceleration ST_ALY_Live Min Max Avg RMS of the acceleration in the Y direction in g. [} 427] st YKurtosis Accelerat ST_ALY_Live Min Max Avg Kurtosis of the acceleration in the Y direction. ion [} 427] st Peak Peak Accelera ST_ALY_Live Min Max Avg Peak-to-peak value of the acceleration in the Y direction in tion Y g. [} 427] b XShock Detected BOOL TRUE if a shock is detected in the X direction. The threshold value of the RMS acceleration is monitored for this purpose. n Count XShocks ULINT Number of shocks in the X direction. fb Last XShock Event FB_ALY_Date Time Timestamp of the last detected shock in the X direction. b YShock Detected BOOL TRUE if a shock is detected in the Y direction. The threshold value of the RMS acceleration is monitored for this purpose. n Count YShocks ULINT Number of shocks in the Y direction. fb Last YShock Event FB_ALY_Date Time Timestamp of the last detected shock in the Y direction. n Count Total Shocks ULINT Number of shocks in the X and Y directions. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Get Channel Output Array Local Getting the result array for a specific channel without () adding new values. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for transferring values to the algorithm. 304 Version: 1.5.0 TF3510
## Page 305

PLC API Sample VAR fb AM8SSD : FB_ALY_AM8xxx SSD; fb System Time : FB_ALY_Get System Time; // Config b Configure : BOOL := TRUE; n Num Sections Humidity : UDINT := 50; n Num Sections Temperature : UDINT := 50; n Num Bins Rms Acceleration : UDINT := 30; f Threshold Rms Acceleration : LREAL := 1.5; // Inputs n Update Counter AT%I* : ULINT; data Sensor0 AT%I* : ULINT; data Sensor1 AT%I* : ULINT; data Sensor2 AT%I* : ULINT; data Sensor3 AT%I* : ULINT; // Results a Timespans Humidity : ARRAY [1..50] OF LINT; a Timespans Temperature : ARRAY [1..50] OF LINT; a Histogram Rms Acceleration X : ARRAY [0..31] OF ULINT; a Histogram Rms Acceleration Y : ARRAY [0..31] OF ULINT; END_VAR // Get current system time fb System Time. Call(); // Configure algorithm IF b Configure THEN b Configure := FALSE; fb AM8SSD. Configure(n Num Sections Humidity, n Num Sections Temperature, n Num Bins Rms Acceleration, f Thre shold Rms Acceleration); END_IF // Call algorithm fb AM8SSD. Set Channel Value(1, n Update Counter); fb AM8SSD. Set Channel Value(2, data Sensor0); fb AM8SSD. Set Channel Value(3, data Sensor1); fb AM8SSD. Set Channel Value(4, data Sensor2); fb AM8SSD. Set Channel Value(5, data Sensor3); fb AM8SSD. Call(t Timestamp := fb System Time.t System Time); fb AM8SSD. Get Channel Output Array(1, ADR(a Timespans Humidity) , SIZEOF(a Timespans Humidity)); fb AM8SSD. Get Channel Output Array(2, ADR(a Timespans Temperature) , SIZEOF(a Timespans Temperature)); fb AM8SSD. Get Channel Output Array(3, ADR(a Histogram Rms Acceleration X) , SIZEOF(a Histogram Rms Acceleration X)); fb AM8SSD. Get Channel Output Array(4, ADR(a Histogram Rms Acceleration Y) , SIZEOF(a Histogram Rms Acceleration Y)); Sample project The code used in the example section is implemented in the example project below. The link to the required hardware is also shown here. Download: https://infosys.beckhoff.com/content/1033/tf3500_tc3_analytics_library/Resources/ 19422310155.zip To ensure that the required outputs are available, the drive must be prepared accordingly. This is described in the Preparation section below. The following packages are required to run the example project: • Twin CAT Standard • TF3510 | Twin CAT 3 Analytics Library • TE5950 | Twin CAT 3 Drive Manager 2 • TF5000 | Twin CAT 3 NC PTP TF3510 Version: 1.5.0 305
## Page 306

PLC API Preparation In order for the sensor values to be available for analysis, they must be added to the process image of the drive. This process is described below. 1. Create a Twin CAT project. 2. Scan the I/Os of the Twin CAT project. 3. Add a Drive Manager project to the solution. 4. Select the corresponding channel of the drive to which the motor with the B/SSD-capable encoder is connected. 5. Select the Advanced tab. 6. Further process data can be added in the Process data subitem. 7. Add the following process data: Int SHub: Update counter Int SHub: Data Sensor 0 Int SHub: Data Sensor 1 Int SHub: Data Sensor 2 Int SHub: Data Sensor 3 306 Version: 1.5.0 TF3510
## Page 307

PLC API ð Once the process data has been added, it is displayed in the I/O node and is available for analysis. Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.9.3.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.9.3.1.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Num Sections Humidity : UDINT; TF3510 Version: 1.5.0 307
## Page 308

PLC API n Num Sections Temperature : UDINT; n Num Bins Rms Acceleration : UDINT f Threshold Shock : UDINT END_VAR Inputs Name Type Description n Num Sections Humi UDINT Configure the number of sections for analyzing the dity humidity in the encoder. n Num Sections Temp UDINT Configure the number of sections for analyzing the erature temperature in the encoder. n Num Bins Rms Accel UDINT Configure the number of histogram bins for analyzing the eration acceleration. f Threshold Shock LREAL Threshold value for the RMS of the acceleration for detecting shocks. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.9.3.1.3 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index: 1: Update Counter 2: Data Sensor 0 3: Data Sensor 1 4: Data Sensor 2 5: Data Sensor 3 Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.9.3.1.4 Get Channel Output Array Retrieves a channel-specific output array. The output values were updated in the previously called Call() method. 308 Version: 1.5.0 TF3510
## Page 309

PLC API Syntax Definition: METHOD Get Channel Output Array : BOOL VAR_INPUT n Channel : UDINT; p Array Out : PVOID; n Array Out Size : UDINT; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to 4) 1: Temporal distribution of humidity within the encoder. (Section Timer) 2: Temporal distribution of the temperature within the encoder. (Section Timer) 3: Distribution of acceleration in the X direction. (Histogram) 4: Distribution of acceleration in the Y direction. (Histogram) p Array Out PVOID Pointer to an array into which the output values are to be written. Data types: 1: LINT 2: LINT 3: ULINT 4: ULINT n Array Out Size UDINT Array size Dimension: 1: n Num Sections Humidity 2: n Num Sections Temperature 3: n Num Bins Rms Acceleration 4: n Num Bins Rms Acceleration Return value Name Type Description Get Channel Output A BOOL Returns TRUE if successful. rray 5.1.1.9.3.1.5 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. TF3510 Version: 1.5.0 309
## Page 310

PLC API 5.1.1.10 Statistics 5.1.1.10.1 FB_ALY_Array Statistics The Array Statistics algorithm calculates various statistical quantities based on the input array. Syntax Definition: FUNCTION_BLOCK FB_ALY_Array Statistics VAR_OUTPUT ip Result Message : Tc3_Event Logger. I_Tc Message; b Error : BOOL; b New Result : BOOL; b Configured : BOOL; f Min : LREAL; n Idx Min : DINT f Max : LREAL; n Idx Max : DINT; f Max Delta : LREAL; n Idx Max Delta : DINT; n Count Peaks : ULINT; n Count Valleys : ULINT; f Sum : LREAL; f Mean : LREAL; f Standard Deviation : LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Min LREAL Smallest value in the input array. n Idx Min DINT Array index from f Min. The indexing starts at 1. f Max LREAL Largest value in the input array. n Idx Max DINT Array index from f Max. The indexing starts at 1. f Max Delta LREAL Maximum of the absolute difference between two consecutive values in the input array. n Idx Max Delta DINT Array index from f Max Delta. The indexing starts at 1. n Count Peaks ULINT Total number of peaks identified. n Count Valleys ULINT Total number of valleys identified. f Sum LREAL Sum over the entire input array. f Mean LREAL Mean value over the entire input array. f Standard Deviation LREAL Standard deviation over the entire input array. 310 Version: 1.5.0 TF3510
## Page 311

PLC API Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. The configuration is identical for all channels. Reset() Local Resets all internal states or the calculations performed so far. Sample VAR fb Array Statistics : FB_ALY_Array Statistics; b Use Bessel Correction : BOOL := TRUE; f Threshold Reversal : LREAL := 0.5; f Threshold Delta : LREAL := 0.5; n Lower Bound : DINT := 1; b Configure : BOOL := TRUE; a Input : ARRAY[1..20] OF LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Array Statistics. Configure(b Use Bessel Correction, f Threshold Reversal, f Threshold Delta, n Lower Bou nd); END_IF // Call algorithm fb Array Statistics. Call(ADR(a Input), SIZEOF(a Input)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.10.1.1 Call Calling the algorithm. Syntax Definition: METHOD Call : BOOL VAR_INPUT p Array In : PVOID; n Array In Size : UDINT; END_VAR Inputs Name Type Description p Array In PVOID Pointer to the input array. n Array In Size UDINT Size of the input array Return value Name Type Description Call BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 311
## Page 312

PLC API 5.1.1.10.1.2 Configure Configure the algorithm. Configuration options • Use Bessel Correction: if the checkbox is activated, Bessel correction will be applied. In order to obtain an expectation-true result for random samples, this parameter must be activated. The parameter is only relevant for the calculation of the standard deviation. The empirical standard deviation, without Bessel's correction The empirical standard deviation, with Bessel's correction • Threshold Reversal: threshold for identifying reversals. Reversals are only detected if their difference from the next reversal exceeds the value of Threshold Reversal. Below are three examples of peak identification using the parameter Threshold Reversal. (a) The value y is identified as a peak immediately after processing the value y because the 3 4 difference between y and y is greater than Threshold Reversal. 3 4 (b) The value y is not identified as a peak because the difference between y and y is smaller than 3 3 4 Threshold Reversal and the curve starts rising again after y . 4 (c) The value y is identified as a peak after processing the value y because the difference between y 2 5 2 and y exceeds Threshold Reversal. The value y cannot be identified as a peak beforehand because 5 2 the difference between y and y (y ) is less than/equal to Threshold Reversal and it is not known 2 3 4 whether the values will continue to decrease. • Threshold Delta: threshold for identifying Delta maxima. Maxima of the absolute difference of two successive values (delta) are detected only if the difference between successive deltas exceeds Threshold Delta. Below are three examples of identifying the Delta maxima with the parameter Threshold Delta . The upper diagrams show the original input signals, the lower ones the corresponding delta. (a) The value y is identified as a maximum after processing the value y because the difference 4 5 between the two deltas exceeds Threshold Delta. (b) No maximum is identified because the difference between the deltas is less than Threshold Delta. (c) The value y is identified as a maximum after processing the value y . 3 6 Regardless of Threshold Delta, at least one maximum of the Delta between two reversals is detected. 312 Version: 1.5.0 TF3510
## Page 313

PLC API Syntax Definition: METHOD Configure : BOOL VAR_INPUT b Use Bessel Correction : BOOL; f Threshold Reversal : LREAL; f Threshold Delta : LREAL; n Lower Bound : DINT; END_VAR Inputs Name Type Description b Use Bessel Correcti BOOL Use of the Bessel correction (see above). on f Threshold Reversal LREAL Threshold for identifying reversals (see above). f Threshold Delta LREAL Threshold for identifying Delta maxima (see above). n Lower Bound DINT Lower limit of the array. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.10.1.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.10.2 FB_ALY_Correlation Function The Correlation Function function block calculates the discrete correlation function between a reference signal (Channel Ref) and one or more other signals (Channel 00, ..., Channel 0n). The correlation coefficients are calculated for time shifts of m cycles between the two signals, with the maximum and minimum values for m being limited by the parameters Minimum Lag (negative integer) and Maximum Lag (positive integer). The Step Size parameter determines the number of cycles by which the signals are moved to calculate two consecutive correlation coefficients. I.e. m is always a multiple of Step Size. Accordingly, for Minimum Lag and Maximum Lag only multiples of Step Size are allowed. If the Step Size is set to one and Minimum Lag is set to -6 and Maximum Lag is set to +4 -for example-, correlation coefficients are calculated for shifts of -6, -5, -4, -3, -2, -1, 0, +1, +2, +3 and +4 cycles. If the Step Size is set to two, coefficients are calculated for shifts by -6, -4, -2, 0, +2 and +4 cycles. The coefficients can be calculated over different timeframes, which are set by the Window Mode parameter. In Continuous mode, all values since the beginning of the analysis are included in the calculations. In Sliding Window mode, the calculation runs continuously for the last number of cycles set by the Window Size. In Fix Window mode, the calculation is also done for the number of cycles set by the Window Size. However, the calculation restarts after each Window Size cycle and the output values are updated only when the last cycle of a window is run through. TF3510 Version: 1.5.0 313
## Page 314

PLC API If m is not zero, the window for the corresponding signal shifts by m cycles. The number of values included in the calculation of the coefficients is the same for all values of m. The only exceptions to this are the results from the first cycles after the start of the analysis. If the number of elapsed cycles is less than |m|, correspondingly fewer values are included in the calculation. For positive values of m, the values of the reference signal (Channel Ref) are stored in a ring memory, so that the respective value of the reference signal received before m cycles can be compared with the current values from Channel 00 to Channel 0n. This corresponds to a shift of the reference signal into the past. For negative values of m, the reference signal would accordingly have to be moved into the future. Since this is obviously not possible, the second signal (Channel 00, .. Channel0n) is saved and moved backward instead. The correlation coefficients can be calculated according to different calculation rules. This is determined by the Correlation Mode. In the Base and Normed modes, the coefficients are calculated analogously to the definition from signal processing, which calculates the correlation over the convolution. In Normed mode, the coefficients are also divided by the number of summands. Covariance and Covariance Bessel calculate the covariance without and with Bessel correction. Pearson mode uses the definition of the Pearson correlation coefficient commonly used in statistics. The exact calculation rules are mathematically listed in the configuration options. Here, x denotes the value of the reference signal and y denotes the value of the n n second signal (in each case Channel00, ..., Channel0n) at the timestamp t (corresponding to the nth cycle n since the start of the analysis or since reset, except for the cycles in which Enable Execution = FALSE). The value of N depends on the Window Mode you select. For Sliding Window mode and Fix Window mode, N is equal to the Window Size, provided a corresponding number of cycles have already elapsed since the start of the analysis, so that x (or y ) has been recorded, otherwise N will be reduced to n-m+1 or n+m+1 n-N-m n-N+m respectively. Note that in Fix Window mode the output values are only updated every Window Size cycle. In Continuous mode, N = n+1 always applies. In the illustration, the output values of the function block for two signals (Channel Ref and Channel 00) for a given cycle (n = 150) are shown as an example of a configuration (Correlation Mode = Pearson, Window Mode = Fix Window, Window Size = 75, Step Size = 5, Maximum Lag = 50, Minimum Lag = -50). In the two left plots, the input signals Channel Ref and Channel 00 are shown over time. The right plot shows the discrete correlation function (the Pearson correlation coefficients in relation to m). Coefficients are shown for the shifts m = -50, -45, -40, -35, -30, -25, -20, -15, -10, -5, 0, +5, +10, +15, +20, +25, +30, +35, +40, +45, +50. These are output as an array in the function block. In addition to the two parameters Minimum Lag and Maximum Lag, the output values Minimizing Lag and Maximizing Lag are marked on the abscissa. The corresponding coefficients Minimum Coefficient and Maximum Coefficient, which also represent outputs of the function block, are marked on the ordinate. For the shifts m = -25, m = 0 and m =+25 in the plots of the input channels (left), the time ranges included in the calculation of the respective coefficient are highlighted in color. In the right plot, the corresponding points are colored. Syntax Definition: 314 Version: 1.5.0 TF3510
## Page 315

PLC API FUNCTION_BLOCK FB_ALY_Correlation Function VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Get Channel Output Array() Local Retrieves the result array for a specific channel without adding new values. Get Channel Output Values() Local Retrieves the results (individual values) for a specific channel without adding new values. Sample VAR fb Correlation Function : FB_ALY_Correlation Function(n Min Lag := -50, n Max Lag := 50, n Step Size := 5 , n Num Channels := 1, e Window Mode := E_ALY_Window Mode. Fix Window, e Correlation Mode := E_ALY_Correlatio n Mode. Pearson, n Window Size := 75); // Configuration n Min Lag : DINT := -50; n Max Lag : DINT := 50; n Step Size : UDINT := 5; n Num Channels : UDINT := 1; e Window Mode : E_ALY_Window Mode := E_ALY_Window Mode. Fix Window; e Correlation Mode : E_ALY_Correlation Mode := E_ALY_Correlation Mode. Pearson; n Window Size : UDINT := 75; b Configure : BOOL := TRUE; // Inputs n Input Ref : INT; f Input Ch1 : LREAL; // Results f Min Coef : LREAL; f Max Coef : LREAL; n Minimizing Lag : DINT; n Maximizing Lag : DINT; a Coefficients : ARRAY[-10..10] OF LREAL; END_VAR TF3510 Version: 1.5.0 315
## Page 316

PLC API // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Correlation Function. Configure( n Min Lag := n Min Lag, n Max Lag := n Max Lag, n Step Size := n Step Size, n Num Channels := n Num Channels, e Window Mode := e Window Mode, e Correlation Mode := e Correlation Mode, n Window Size := n Window Size); END_IF // Call algorithm fb Correlation Function. Set Channel Value(0, n Input Ref); fb Correlation Function. Set Channel Value(1, f Input Ch1); fb Correlation Function. Call(); fb Correlation Function. Get Channel Output Array(1, ADR(a Coefficients), SIZEOF(a Coefficients)); fb Correlation Function. Get Channel Output Values(1, f Min Coef, f Max Coef, n Minimizing Lag, n Maximizing Lag); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.10.2.1 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used 5.1.1.10.2.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR 316 Version: 1.5.0 TF3510
## Page 317

PLC API Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.10.2.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Min Lag : DINT; n Max Lag : DINT; n Step Size : UDINT; n Num Channels : UDINT; e Window Mode : E_ALY_Window Mode; e Correlation Mode : E_ALY_Correlation Mode; n Window Size : UDINT; END_VAR TF3510 Version: 1.5.0 317
## Page 318

PLC API Inputs 318 Version: 1.5.0 TF3510
## Page 319

PLC API Name Type Description n Min Lag UDINT Specifies the minimum number of cycles by which the two signals are shifted to calculate the correlation to each other. This is a negative integer. n Max Lag UDINT Specifies the maximum number of cycles by which the two signals are shifted to calculate the correlation to each other. This is a positive integer. n Step Size UDINT Specifies by how many cycles the signals are shifted to calculate two consecutive correlation coefficients. n Num Channels UDINT The number of channels that are correlated with the reference signal. e Window Mode E_ALY_Window Mode Specifies the type of window used to calculate the coefficients: [} 432] Continuous: All values since the start of the analysis are included in the analysis with equal weighting. Sliding Window: The calculation is done via a window of the size Window Size. The current values are always included in the analysis and outputs are updated with each cycle. Fix Window: The outputs are updated every Window Size cycles and calculated via a window with the length Window Size. TF3510 Version: 1.5.0 319
## Page 320

PLC API Name Type Description e Correlation Mode E_ALY_Correlation Mode The coefficients are calculated based on one of the following definitions: [} 432] Base: Normed: Covariance: Covariance Bessel: Pearson: n Window Size UDINT For the Sliding Window and Fix Window window modes, specifies the number of cycles over which the coefficients are calculated. For the Window Mode Continuous the setting of n Window Size has no effect. In Sliding Window mode, Window Size values for all channels are buffered in addition to Maximum Lag values from the Reference Channel and Minimum Lag values for Channel 00 to Channel 0n. The size of the router memory must be taken into account when setting these parameters. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.10.2.4 Reset Resetting the algorithm. 320 Version: 1.5.0 TF3510
## Page 321

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.10.2.5 Get Channel Output Array Retrieves a channel-specific output array. The output values were updated in the previously called Call() method. Syntax Definition: METHOD Get Channel Output Array : BOOL VAR_INPUT n Channel : UDINT; p Corr Coefs Array Out : PVOID; n Corr Coefs Array Out Size : UDINT; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) p Corr Coefs Array Out PVOID Pointer to an array to which the coefficients are to be written. n Corr Coefs Array Out UDINT Array size Size Return value Name Type Description Get Channel Output A BOOL Returns TRUE if successful. rray 5.1.1.10.2.6 Get Channel Output Values Retrieves channel-specific output values. The output values were updated in the previously called Call() method. Syntax Definition: METHOD Get Channel Output Values : BOOL VAR_INPUT n Channel : UDINT; p Corr Coefs Array Out : PVOID; n Corr Coefs Array Out Size : UDINT; END_VAR VAR_IN_OUT f Min Coef : LREAL; f Max Coef : LREAL; n Minimizing Lag : DINT; n Maximizing Lag : DINT; END_VAR TF3510 Version: 1.5.0 321
## Page 322

PLC API Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) f Min Coef LREAL Writing to variable takes place with the minimum coefficient of the output array. f Max Coef LREAL Writing to variable takes place with the maximum coefficient of the output array. n Minimizing Lag DINT Writing to the variable takes place with the lag at which the coefficient is smallest. n Maximizing Lag DINT Writing to the variable takes place with the lag at which the coefficient is greatest. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alues 5.1.1.10.2.7 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (0 to n Num Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.10.3 FB_ALY_Correlation Function Reference The Correlation Function Reference function block calculates the discrete correlation function between a recorded signal (referred to below as reference signal), which is read from a tcab file, and one or more input signals (Channel 00, ..., Channel 0n). The correlation coefficients are calculated for time shifts of m cycles between the two signals, with the maximum and minimum values for m being limited by the parameters Minimum Lag (negative integer) and Maximum Lag (positive integer). The Step Size parameter determines the number of cycles by which the signals are moved to calculate two consecutive correlation coefficients. I.e. m is always a multiple of the Step Size. Accordingly, only multiples of the Step Size are also allowed for Minimum Lag and Maximum Lag. If the Step Size is set to one, 322 Version: 1.5.0 TF3510
## Page 323

PLC API Minimum Lag to -6 and Maximum Lag to +4, for example, coefficients are calculated for shifts by -6, -5, -4, -3, -2, -1, 0, +1, +2, +3, and +4 cycles. If the Step Size is set to two, coefficients are calculated for shifts by -6, -4, -2, 0, +2, and +4 cycles. From the start of the analysis, a value is processed from the read-in signal per cycle. When the end of the file is reached, the process starts again with the first value of the file. The read-in signal is therefore assumed to be periodic. If you only want to correlate certain periods of the input signal with the reference signal, you can control this via the Enable Execution and Reset inputs as well as via the New Result output. The correlation coefficients can be calculated over different timeframes. which are set by the Window Mode parameter. In Continuous mode, all values since the beginning of the analysis are included in the calculations. In Sliding Window mode, the calculation runs continuously for the last number of cycles set by the Window Size. In Fix Window mode, the calculation is done over the length of the reference signal and the output values are always updated at the end of the recorded sequence. If m is not zero, the window for the corresponding signal shifts by m cycles. The number of values included in the calculation of the coefficients is the same for all values of m. The only exceptions to this are the results from the first cycles after the start of the analysis. If the number of elapsed cycles is less than |m|, correspondingly fewer values are included in the calculation. For positive values of m, the values of the reference signal (Channel Ref) are stored in a ring memory, so that the respective value of the reference signal received before m cycles can be compared with the current values from Channel 00 to Channel 0n. This corresponds to a shift of the reference signal into the past. For negative values of m, the reference signal would accordingly have to be moved into the future. Since this is obviously not possible, the second signal (Channel 00, .. Channel0n) is saved and moved backward instead. The correlation coefficients can be calculated according to different calculation rules. This is determined by the Correlation Mode. In the Base and Normed modes, the coefficients are calculated analogously to the definition from signal processing, which calculates the correlation over the convolution. In Normed mode, the coefficients are also divided by the number of summands. Covariance and Covariance Bessel calculate the covariance without and with Bessel correction. Pearson mode uses the definition of the Pearson correlation coefficient commonly used in statistics. The exact calculation rules are mathematically listed in the configuration options. Here, x denotes the value of the reference signal and y denotes the value of the input n n signal (in each case Channel00, ..., Channel0n) at the timestamp t (corresponding to the nth cycle since the n start of the analysis or since reset, except for the cycles in which Enable Execution = FALSE). The value of N depends on the Window Mode you select. For Sliding Window mode and Fix Window mode, N is equal to the Window Size, provided a corresponding number of cycles have already elapsed since the start of the analysis, so that x (or y ) has been recorded, otherwise N will be reduced to n-m+1 or n+m+1 n-N-m n-N+m respectively. In Fix Window mode, the window size is not to be set manually, but corresponds to the length of the read-in signal section (reference signal) and the output values are updated at the end of the signal section. In Continuous mode, N = n+1 always applies. The illustration shows the different input and output values of the function block for a configuration (Correlation Mode = Pearson, Window Mode = Fix Window, Window Size = 120 (= number of values in the file), Step Size = 5, Maximum Lag = 20, Minimum Lag = -20) and an input channel. On the left side, the input signals Channel 00 and Reset are shown in the two lower plots, above which the read-in sequence is shown on the same timeline, according to its processing. The signal starts to be read in at the beginning of the analysis. If the last value from the file is processed in the 120th (or 240th) cycle, the process starts again with the first one. In the 300th cycle, a reset is performed and the process starts again with the first value of the file. In addition, all values are deleted from the internal memories and the calculation of the coefficients begins again. For example, it was detected here that Channel 00 did not contain valid values in the previous cycles and the vibration has now been re-energized. In this area the analysis could also be interrupted by Enable Execution = FALSE. Since Window Mode = Fix Window, the outputs are updated only in the 120th, 240th and 420th cycle. The corresponding coefficients (from Output00) are shown in the right plot. From the value pairs (Maximizing Lag, Maximum Coefficient) you can read how much the input signal is shifted with respect to the reference signal. For example, in the 420th cycle (Maximizing Lag, Maximum Coefficient) = (-10.1). This means that if the Reset had taken place 10 cycles earlier, the reference signal and Channel 00 would have matched each other exactly in this window. TF3510 Version: 1.5.0 323
## Page 324

PLC API Syntax Definition: FUNCTION_BLOCK FB_ALY_Correlation Function Reference VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Busy: BOOL; e State: E_ALY_Read State; f Value Read: LREAL; st File Header: ST_ALY_File Header; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Busy BOOL TRUE if the FB is active due to file accesses. e State E_ALY_Read State [} 430] Current state of the FB due to asynchronous file access. f Value Read LREAL Value of the data point that is read from a file. st File Header ST_ALY_File Header Header information of the file that was read. 324 Version: 1.5.0 TF3510
## Page 325

PLC API Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Get Channel Output Array() Local Retrieves the result array for a specific channel without adding new values. Get Channel Output Values() Local Retrieves the results (individual values) for a specific channel without adding new values. Switch State_Idle() Local Initiating the change from state Read to state Idle. See state diagram. Switch State_Read() Local Initiating the change from state Idle to state Read. See state diagram. Update State() Local Updating the state after a state change has been initiated and while the target state has not been reached. Get Busy State() Local Returns TRUE if the FB is active. State diagram Due to the asynchronous file access in real-time applications, this function block requires a state machine to prepare and complete the file access. At startup the function block is in Idle state. To read the data from the file, the state must switch to Read. Therefore, the method Switch State_Read() must be called once to set the function block to state Pending Read. Then the method Update State() must be called until the function block is in state Read. In this state the function block can run through one or more cycles. If the function block is not to compare any further cycles, it can be returned to the Idle state. To initiate the state switch, the method Switch State_Idle() must be called. Then the method Update State() must be called until the function block is in state Idle. State diagram for the data read operation: TF3510 Version: 1.5.0 325
## Page 326

PLC API Sample VAR fb Corr Fct Ref : FB_ALY_Correlation Function Reference( n Num Channels := 1, n Min Lag := 0, n Max Lag := 10, n Step Size := 1, e Window Mode := E_ALY_Window Mode. Fix Window, e Correlation Mode := E_ALY_Correlation Mode. Normed, n Window Size := 120, n Segment Size := 400, t Timeout := TIME#5S, s File Path := 'C:\Twin CAT\3.1\Boot\Unit Test_Correlation Function.tas'); // State e State : E_ALY_Read State := E_ALY_Read State. Idle; b Read : BOOL; // Inputs f Input Ch1 : LREAL; // Results f Min Coef : LREAL; f Max Coef : LREAL; n Minimizing Lag : DINT; n Maximizing Lag : DINT; a Coefficients : ARRAY[-10..10] OF LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Corr Fct Ref. Configure(e Correlation Mode := e Correlation Mode, s File Path := s File Path ); END_IF // Call algorithm e State := fb Corr Fct Ref.e State; CASE e State OF E_ALY_Read State. Idle: IF b Read THEN fb Corr Fct Ref. Switch State_Read(); fb Corr Fct Ref. Update State(); END_IF E_ALY_Read State. Read: fb Corr Fct Ref. Set Channel Value(1, f Input Ch1); fb Corr Fct Ref. Call(); fb Corr Fct Ref. Get Channel Output Array(1, ADR(a Coefficients), SIZEOF(a Coefficients)); 326 Version: 1.5.0 TF3510
## Page 327

PLC API fb Corr Fct Ref. Get Channel Output Values(1, f Min Coef, f Max Coef, n Minimizing Lag, n Maximizing Lag); IF NOT b Read THEN fb Corr Fct Ref. Switch State_Idle(); fb Corr Fct Ref. Update State(); END_IF E_ALY_Read State. Pending, E_ALY_Read State. Pending Idle, E_ALY_Read State. Pending Read: fb Corr Fct Ref. Update State(); e State := fb Corr Fct Ref.e State; END_CASE Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.10.3.1 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (0 to n Num Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.10.3.2 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. TF3510 Version: 1.5.0 327
## Page 328

PLC API Return value Name Type Description FB_init BOOL Not used. 5.1.1.10.3.3 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.10.3.4 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT n Min Lag : DINT; n Max Lag : DINT; n Step Size : UDINT; n Num Channels : UDINT; e Window Mode : E_ALY_Window Mode; e Correlation Mode : E_ALY_Correlation Mode; n Window Size : UDINT; END_VAR 328 Version: 1.5.0 TF3510
## Page 329

PLC API Inputs TF3510 Version: 1.5.0 329
## Page 330

PLC API Name Type Description n Min Lag UDINT Specifies the minimum number by which the two signals are shifted relative to each other for the calculation of the correlation. This is a negative integer. n Max Lag UDINT Specifies the maximum number of cycles by which the two signals are shifted to calculate the correlation to each other. This is a positive integer. n Step Size UDINT Specifies by how many cycles the signals are shifted to calculate two consecutive correlation coefficients. n Num Channels UDINT The number of channels that are correlated with the reference signal. e Window Mode E_ALY_Window Mode Specifies the type of window used to calculate the coefficients: [} 432] Continuous: All values since the start of the analysis are included in the analysis with equal weighting. Sliding Window: The calculation is done via a window of the size Window Size. The current values are always included in the analysis and outputs are updated with each cycle. Fix Window: The outputs are updated every Window Size cycles and calculated via a window with the length Window Size. 330 Version: 1.5.0 TF3510
## Page 331

PLC API Name Type Description e Correlation Mode E_ALY_Correlation Mode The coefficients are calculated based on one of the following definitions: [} 432] Base: Normed: Covariance: Covariance Bessel: Pearson: n Window Size UDINT For the Sliding Window and Fix Window window modes, specifies the number of cycles over which the coefficients are calculated. For the Window Mode Continuous the setting of n Window Size has no effect. In Sliding Window mode, Window Size values for all channels are buffered in addition to Maximum Lag values from the Reference Channel and Minimum Lag values for Channel 00 to Channel 0n. The size of the router memory must be taken into account when setting these parameters. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.10.3.5 Reset Resetting the algorithm. TF3510 Version: 1.5.0 331
## Page 332

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.10.3.6 Get Busy State Returns TRUE if the function block is busy due to an asynchronous file access. Syntax Definition: METHOD Get Busy State : BOOL VAR_INPUT END_VAR Return value Name Type Description Get Busy State BOOL Returns TRUE if the FB is active. 5.1.1.10.3.7 Get Channel Output Array Retrieves a channel-specific output array. The output values were updated in the previously called Call() method. Syntax Definition: METHOD Get Channel Output Array : BOOL VAR_INPUT n Channel : UDINT; p Corr Coefs Array Out : PVOID; n Corr Coefs Array Out Size : UDINT; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) p Corr Coefs Array Out PVOID Pointer to an array to which the coefficients are to be written. n Corr Coefs Array Out UDINT Array size Size Return value Name Type Description Get Channel Output A BOOL Returns TRUE if successful. rray 5.1.1.10.3.8 Get Channel Output Values Retrieves channel-specific output values. The output values were updated in the previously called Call() method. 332 Version: 1.5.0 TF3510
## Page 333

PLC API Syntax Definition: METHOD Get Channel Output Values : BOOL VAR_INPUT n Channel : UDINT; p Corr Coefs Array Out : PVOID; n Corr Coefs Array Out Size : UDINT; END_VAR VAR_IN_OUT f Min Coef : LREAL; f Max Coef : LREAL; n Minimizing Lag : DINT; n Maximizing Lag : DINT; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) f Min Coef LREAL Writing to variable takes place with the minimum coefficient of the output array. f Max Coef LREAL Writing to variable takes place with the maximum coefficient of the output array. n Minimizing Lag DINT Writing to the variable takes place with the lag at which the coefficient is smallest. n Maximizing Lag DINT Writing to the variable takes place with the lag at which the coefficient is greatest. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alues 5.1.1.10.3.9 Switch State_Idle Initiate switch from Read state to Idle state. See State diagram. Syntax Definition: METHOD Switch State_Idle : BOOL VAR_INPUT END_VAR Return value Name Type Description Switch State_Idle BOOL Returns TRUE if successful 5.1.1.10.3.10 Switch State_Read Initiate switch from Idle state to Read state. See State diagram. Syntax Definition: TF3510 Version: 1.5.0 333
## Page 334

PLC API METHOD Switch State_Read : BOOL VAR_INPUT END_VAR Return value Name Type Description Switch State_Read BOOL Returns TRUE if successful 5.1.1.10.3.11 Update State Update state after state change was initiated and until target state is not reached. Syntax Definition: METHOD Update State : BOOL VAR_INPUT END_VAR Return value Name Type Description Update State BOOL Returns TRUE if successful. 5.1.1.10.4 FB_ALY_Linear Regression Fitting The Linear Regression Fitting function block approximates one variable (the Dependent input) by linear combination of several other variables (Input 01 ... Input 0n). This is done by the incremental stochastic gradient method. At the end of the analysis, the calculated coefficients are written to a file. The linear combination is given by the following equation: In each cycle, the values for to are recalculated using the following rule: This corresponds to the minimization of the squared deviation of the calculated values y (output by the function block as result) from the corresponding input value Dependent. The parameter corresponds to the step size and specifies how strongly the parameters are adjusted. The larger the value, the faster the coefficients approach a local optimum. However, if the value is too large, the algorithm may not converge. Typically, the Linear Regression Fitting function block is first used to fit the weights for the regression of a target variable. Then, using the Linear Regression Inference function block and the fitted weights, the target variable can be predicted based on the input variables. Syntax Definition: 334 Version: 1.5.0 TF3510
## Page 335

PLC API FUNCTION_BLOCK FB_Linear Regression Fitting VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Result: LREAL; f MSE: LREAL; b Busy: BOOL; e State: E_Teach State; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Result LREAL Outputs the approximated value for the inputs of the current cycle with the coefficients updated from them. f MSE LREAL Specifies the MSE (mean squared error) between the calculated Result value and the Dependent input value. b Busy BOOL TRUE if the FB is active due to a file access. e State E_ALY_Teach State [} 431] Current state of the function block. See state diagram. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. FB_init() Local Initializes the number of input channels. Get Busy State() Local This method returns the Busy state of the function block. Get Channel Output Valu Local Method for receiving values from different output channels. e() Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Switch State_Idle() Local Method for setting the function block to Idle state when the teach-in process is complete. Switch State_Teach() Local Method for putting the function block into teach-in mode. Update State() Local Method to be used for the transition from one state to another state. State diagram Due to the asynchronous file access in real time applications this function block needs a state machine to prepare and finish file access. At startup the function block is in Idle state. To write the incoming data to a file it has to be switched to state Teach. Therefore the method Switch State_Teach() has to be called once to set the function block to the Pending Teach state. After that the method Update State() has to be called until the function block is in state TF3510 Version: 1.5.0 335
## Page 336

PLC API Teach. In this state one or multiple teach cycles can be proceeded. If the function block should not teach additional cycles it can be set to Idle state again. To initiate the state switch the method Switch State_Idle() has to be called. After that the method Update State() has to be called until the function block is in state Idle. State diagram for the teach procedure of the data: Sample VAR fb Linear Regression Fitting : FB_ALY_Linear Regression Fitting(n Num Channels := 1); b Bias : BOOL := TRUE; f Step Size : LREAL := 0.01; n Mini Batch Size : UDINT := 1; t Timeout : TIME := T#5S; b Involve Existing File : BOOL := TRUE; s File Path : STRING := 'C:\Twin CAT\3.1\Boot\Linear Regression Fitting.json'; b Configure : BOOL := TRUE; e State : E_ALY_Teach State := E_ALY_Teach State. Idle; b Teach : BOOL; b Fit : BOOL := TRUE; f Input X : LREAL; f Input Y : LREAL; f Out0 : LREAL; f Out1 : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Linear Regression Fitting. Configure(b Bias, f Step Size, n Mini Batch Size, t Timeout, b Involve Existing File, s File Path); END_IF // Call algorithm e State := fb Linear Regression Fitting.e State; CASE e State OF E_ALY_Teach State. Idle: IF b Teach THEN fb Linear Regression Fitting. Switch State_Teach(); fb Linear Regression Fitting. Update State(); END_IF E_ALY_Teach State. Teach: fb Linear Regression Fitting. Set Channel Value(1, f Input X); fb Linear Regression Fitting. Call(b Fit := b Fit, dependent := f Input Y); fb Linear Regression Fitting. Get Channel Output Value(0, f Out0); fb Linear Regression Fitting. Get Channel Output Value(1, f Out1); IF NOT b Teach THEN 336 Version: 1.5.0 TF3510
## Page 337

PLC API fb Linear Regression Fitting. Switch State_Idle(); fb Linear Regression Fitting. Update State(); END_IF E_ALY_Teach State. Pending, E_ALY_Teach State. Pending Idle, E_ALY_Teach State. Pending Teach: fb Linear Regression Fitting. Update State(); e State := fb Linear Regression Fitting.e State; END_CASE Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.10.4.1 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 1; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used 5.1.1.10.4.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT b Fit : BOOL; dependent : ANY; END_VAR Inputs Name Type Description b Fit BOOL Parameter adjustment can be enabled or disabled. dependent ANY Dependent value resulting from the linear combination of the input values. TF3510 Version: 1.5.0 337
## Page 338

PLC API Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.10.4.3 Configure Configuring the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT b Bias : BOOL; f Step Size : LREAL; n Mini Batch Size : UDINT t Timeout : TIME; n Set Num Teaches : UDINT; b Involve Existing File : BOOL; s File Path : STRING(255); END_VAR Inputs Name Type Description b Bias BOOL If FALSE, the Bias Output 00 is set to zero and is not approximated further. f Step Size LREAL Specifies how much the coefficients are adjusted after each new calculation. n Mini Batchsize UDINT Specifies over how many cycles the MSE is to be calculated before the coefficients are adjusted based on it. t Timeout TIME Timeout for asynchronous operations. b Involve Existing File BOOL If TRUE, include existing file (if any). If FALSE, create new file. s File Path STRING(255) Path to the taught file, e.g. C:\Twin CAT\3.1\Boot\Teach.tas Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.10.4.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.10.4.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. 338 Version: 1.5.0 TF3510
## Page 339

PLC API Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.10.4.6 Get Channel Output Value Fetching a channel-specific output value. The output value is only updated if the Call() method was called previously. Syntax Definition: METHOD Get Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (0 (bias) to n Num Channels) output ANY Output value of any data type. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alue 5.1.1.10.4.7 Switch State_Idle Initiate switch from Teach state to Idle state. See State diagram. Syntax Definition: METHOD Switch State_Idle : BOOL VAR_INPUT END_VAR TF3510 Version: 1.5.0 339
## Page 340

PLC API Return value Name Type Description Switch State_Idle BOOL Returns TRUE if successful 5.1.1.10.4.8 Switch State_Teach Initiate switch from Idle state to Teach state. See State diagram. Syntax Definition: METHOD Switch State_Teach : BOOL VAR_INPUT END_VAR Return value Name Type Description Switch State_Teach BOOL Returns TRUE if successful 5.1.1.10.4.9 Get Busy State Returns TRUE if the function block is busy due to an asynchronous file access. Syntax Definition: METHOD Get Busy State : BOOL VAR_INPUT END_VAR Return value Name Type Description Get Busy State BOOL Returns TRUE if the FB is active. 5.1.1.10.4.10 Update State Update state after state change was initiated and until target state is not reached. Syntax Definition: METHOD Update State : BOOL VAR_INPUT END_VAR Return value Name Type Description Update State BOOL Returns TRUE if successful 340 Version: 1.5.0 TF3510
## Page 341

PLC API 5.1.1.10.5 FB_ALY_Linear Regression Inference The Linear Regression Inference function block calculates the linear combination of the inputs (Input 01 .. Input 0n) with the coefficients (Weights 00.. Weights 0n). The parameters Weights 00 to Weights 0n can either be set manually or automatically via a file generated by the Linear Regression Fitting function block by dragging / dropping onto the parameter field. Typically, the Linear Regression Fitting function block is first used to fit the weights for the regression of a target variable. Then, using the Linear Regression Inference function block and the fitted weights, the target variable can be predicted based on the input variables. Syntax Definition: FUNCTION_BLOCK FB_ALY_Linear Regression Inference VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Busy: BOOL; e State: E_ALY_Config State; st File Header: ST_ALY_File Header; f Result : LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Busy BOOL TRUE if the FB is active due to a file access. e State E_ALY_Config State [} 432] Configuration status of the function block. st File Header ST_ALY_File Header Header information of the file that was read. f Result LREAL Specifies the value calculated from the linear combination. TF3510 Version: 1.5.0 341
## Page 342

PLC API Methods Name Definition lo- Description cation Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm after the individual coefficients have been set. Configure Channel() Local Configuration of the coefficients. Configure From File() Local Configuration of the algorithm via a previously created file. FB_init Local Initializes the number of input channels. Get Busy State() Local This method returns the Busy state of the function block. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Update State() Local Updating the state after a state change has been initiated and while the target state has not been reached. Sample - Configuration by parameter // Configure algorithm IF b Configure THENVAR fb Linear Regression Inference : FB_ALY_Linear Regression Inference(n Num Channels := 1); f Coefficient0 : LREAL := 10.0; f Coefficient1 : LREAL := 1.0; b Configure : BOOL := TRUE; f Input X : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Linear Regression Inference. Configure Channel(0, f Coefficient0); fb Linear Regression Inference. Configure Channel(1, f Coefficient1); fb Linear Regression Inference. Configure(); END_IF // Call algorithm fb Linear Regression Inference. Set Channel Value(1, f Input X); fb Linear Regression Inference. Call(); Sample – Configuration by file VAR fb Linear Regression Inference : FB_ALY_Linear Regression Inference(n Num Channels := 1); t Timeout : TIME := T#5S; s File Path : STRING := 'C:\Twin CAT\3.1\Boot\Linear Regression Fitting.json'; b Configure : BOOL := TRUE; f Input X : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Linear Regression Inference. Configure From File(t Timeout, s File Path); END_IF // Update pending state IF fb Linear Regression Inference.e State = E_ALY_Config State. Pending THEN fb Linear Regression Inference. Update State(); END_IF // Call algorithm IF fb Linear Regression Inference.e State = E_ALY_Config State. Configured THEN fb Linear Regression Inference. Set Channel Value(1, f Input X); fb Linear Regression Inference. Call(); END_IF 342 Version: 1.5.0 TF3510
## Page 343

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.10.5.1 FB_init Initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 1; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used 5.1.1.10.5.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.10.5.3 Configure Configuring the algorithm. The coefficients must be set beforehand with the Configure Channel() method. Syntax Definition: METHOD Configure : BOOL VAR_INPUT END_VAR TF3510 Version: 1.5.0 343
## Page 344

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.10.5.4 Configure Channel Configuration of the coefficients for the calculation of the linear combination. The coefficients are only applied after the Configure() method has been called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT n Channel : UDINT; f Coefficient : LREAL; END_VAR Inputs Name Type Description n Channel UDINT Channel index for the coefficients. Starting at zero. f Coefficient LREAL Coefficient for the calculation of the linear combination. Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.10.5.5 Configure From File Configures the algorithm based on a previously created file. After calling this method, the method Update State() must be called until the status of the function block is no longer Pending. Syntax Definition: METHOD Configure From File : BOOL VAR_INPUT t Timeout : TIME; s File Path : STRING(255); END_VAR Inputs Name Type Description t Timeout TIME Timeout for asynchronous operations. s File Path STRING(255) Path to the taught file, e.g. C: \Twin CAT\3.1\Boot\Teach.json Return value Name Type Description Configure From File BOOL Returns TRUE if successful. 344 Version: 1.5.0 TF3510
## Page 345

PLC API 5.1.1.10.5.6 Update State Updates the state after a state change has been initiated by calling the Configure From File() method. The method must be called cyclically until the state of the function block is no longer Pending. Syntax Definition: METHOD Update State : BOOL VAR_INPUT END_VAR Return value Name Type Description Update State BOOL Returns TRUE if successful 5.1.1.10.5.7 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.10.5.8 Get Busy State Returns TRUE if the function block is busy due to an asynchronous file access. Syntax Definition: METHOD Get Busy State : BOOL VAR_INPUT END_VAR Return value Name Type Description Get Busy State BOOL Returns TRUE if the FB is active. TF3510 Version: 1.5.0 345
## Page 346

PLC API 5.1.1.10.5.9 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.10.6 FB_ALY_Standard Deviation The Standard Deviation algorithm calculates the empirical standard deviation for a configurable number of input channels. The number of input data to be included in the calculation and the type of calculation can be configured. Syntax Definition: FUNCTION_BLOCK FB_ALY_Standard Deviation VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. The configuration is identical for all channels. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Get Channel Output Value() Local Method for receiving values from different output channels. Sample VAR fb Standard Deviation : FB_ALY_Standard Deviation(n Num Channels := 1); b Use Bessel Correction : BOOL := TRUE; e Window Mode : E_ALY_Window Mode := E_ALY_Window Mode. Fix Window; 346 Version: 1.5.0 TF3510
## Page 347

PLC API n Window Size : UDINT := 100; b Configure : BOOL := TRUE; f Input : LREAL; f Standard Deviation : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Standard Deviation. Configure(b Use Bessel Correction, e Window Mode, n Window Size); END_IF // Call algorithm fb Standard Deviation. Set Channel Value(1, f Input); fb Standard Deviation. Call(); fb Standard Deviation. Get Channel Output Value(1, f Standard Deviation); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.10.6.1 FB_init Initializes the number of independent input and output channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 1; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used 5.1.1.10.6.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 347
## Page 348

PLC API 5.1.1.10.6.3 Configure Configure the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT b Use Bessel Correction : BOOL; e Window Mode : E_ALY_Window Mode; n Window Size : UDINT; END_VAR Inputs Name Type Description b Use Bessel Correcti BOOL If the parameter b Use Bessel Correction is set to TRUE, on Bessel's correction is applied. This parameter must be enabled in order to obtain an expected result for random samples. The empirical standard deviation, without Bessel's correction The empirical standard deviation, with Bessel's correction e Window Mode E_ALY_Window Mode Used window mode. Influences the amount of input data included in the calculation and the timing of the [} 432] calculations. • Continuous: All input values since the start of the algorithm are included in the calculation. The calculation is performed cyclically. • Fix Window: Only the last N input values are included in the calculation. The calculation is done every N calls. • Sliding Window: Only the last N input values are included in the calculation. The calculation is performed cyclically. n Window Size UDINT Depending on the window mode used, you can configure the number of values N that will be included in the calculation. In the window mode Continuous this parameter is ignored. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.10.6.4 Reset Resetting the algorithm. 348 Version: 1.5.0 TF3510
## Page 349

PLC API Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.10.6.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.10.6.6 Get Channel Output Value Fetching a channel-specific output value. The output value is only updated if the Call() method was called previously. Syntax Definition: METHOD Get Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) output ANY Output value of any data type. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alue TF3510 Version: 1.5.0 349
## Page 350

PLC API 5.1.1.10.7 FB_ALY_Clearance Factor The algorithm Clearance Factor calculates the signal feature of the same name from the input values. The output value is calculated from the ratio of the peak value of the input signal to the squared mean of the square roots of the absolute input signal. The number of input data to be included in the calculation and the type of calculation can be configured. Syntax Definition: FUNCTION_BLOCK FB_ALY_Clearance Factor VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. The configuration is identical for all channels. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Get Channel Output Value() Local Method for receiving values from different output channels. Sample VAR fb Clearance Factor : FB_ALY_Clearance Factor(n Num Channels := 1); e Window Mode : E_ALY_Window Mode := E_ALY_Window Mode. Fix Window; n Window Size : UDINT := 100; b Configure : BOOL := TRUE; 350 Version: 1.5.0 TF3510
## Page 351

PLC API f Input : LREAL; f Clearance Factor : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Clearance Factor. Configure(e Window Mode, n Window Size); END_IF // Call algorithm fb Clearance Factor. Set Channel Value(1, f Input); fb Clearance Factor. Call(); fb Clearance Factor. Get Channel Output Value(1, f Clearance Factor); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.10.7.1 FB_init Initializes the number of independent input and output channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 1; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used 5.1.1.10.7.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 351
## Page 352

PLC API 5.1.1.10.7.3 Configure Configure the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Window Mode : E_ALY_Window Mode; n Window Size : UDINT; END_VAR Inputs Name Type Description e Window Mode E_ALY_Window Mode Used window mode. Influences the amount of input data included in the calculation and the timing of the [} 432] calculations. • Continuous: All input values since the start of the algorithm are included in the calculation. The calculation is performed cyclically. • Fix Window: Only the last N input values are included in the calculation. The calculation is done every N calls. • Sliding Window: Only the last N input values are included in the calculation. The calculation is performed cyclically. n Window Size UDINT Depending on the window mode used, you can configure the number of values N that will be included in the calculation. In the window mode Continuous this parameter is ignored. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.10.7.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.10.7.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR 352 Version: 1.5.0 TF3510
## Page 353

PLC API Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.10.7.6 Get Channel Output Value Fetching a channel-specific output value. The output value is only updated if the Call() method was called previously. Syntax Definition: METHOD Get Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) output ANY Output value of any data type. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alue 5.1.1.10.8 FB_ALY_Impulse Factor The algorithm Impulse Factor calculates the signal feature of the same name from the input values. The output value is calculated from the ratio of the peak value of the input signal to the mean value of the input signal. The number of input data to be included in the calculation and the type of calculation can be configured. Syntax Definition: FUNCTION_BLOCK FB_ALY_Impulse Factor VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; TF3510 Version: 1.5.0 353
## Page 354

PLC API b New Result: BOOL; b Configured: BOOL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. The configuration is identical for all channels. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Get Channel Output Value() Local Method for receiving values from different output channels. Sample VAR fb Impulse Factor : FB_ALY_Impulse Factor(n Num Channels := 1); e Window Mode : E_ALY_Window Mode := E_ALY_Window Mode. Fix Window; n Window Size : UDINT := 100; b Configure : BOOL := TRUE; f Input : LREAL; f Impulse Factor : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Impulse Factor. Configure(e Window Mode, n Window Size); END_IF // Call algorithm fb Impulse Factor. Set Channel Value(1, f Input); fb Impulse Factor. Call(); fb Impulse Factor. Get Channel Output Value(1, f Impulse Factor); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.10.8.1 FB_init Initializes the number of independent input and output channels. 354 Version: 1.5.0 TF3510
## Page 355

PLC API Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 1; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used 5.1.1.10.8.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.10.8.3 Configure Configure the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Window Mode : E_ALY_Window Mode; n Window Size : UDINT; END_VAR TF3510 Version: 1.5.0 355
## Page 356

PLC API Inputs Name Type Description e Window Mode E_ALY_Window Mode Used window mode. Influences the amount of input data included in the calculation and the timing of the [} 432] calculations. • Continuous: All input values since the start of the algorithm are included in the calculation. The calculation is performed cyclically. • Fix Window: Only the last N input values are included in the calculation. The calculation is done every N calls. • Sliding Window: Only the last N input values are included in the calculation. The calculation is performed cyclically. n Window Size UDINT Depending on the window mode used, you can configure the number of values N that will be included in the calculation. In the window mode Continuous this parameter is ignored. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.10.8.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.10.8.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) Input ANY Input value of any data type. 356 Version: 1.5.0 TF3510
## Page 357

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.10.8.6 Get Channel Output Value Fetching a channel-specific output value. The output value is only updated if the Call() method was called previously. Syntax Definition: METHOD Get Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) output ANY Output value of any data type. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alue 5.1.1.10.9 FB_ALY_Shape Factor The algorithm Shape Factor calculates the signal feature of the same name from the input values. The output value is calculated from the ratio of the root mean square (RMS) of the input signal to the mean of the absolute values of the input signal. The number of input data to be included in the calculation and the type of calculation can be configured. Syntax Definition: FUNCTION_BLOCK FB_ALY_Shape Factor VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; END_VAR TF3510 Version: 1.5.0 357
## Page 358

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. Methods Name Definition loca- Description tion Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. The configuration is identical for all channels. FB_init() Local Initializes the number of input channels. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Get Channel Output Value() Local Method for receiving values from different output channels. Sample VAR fb Shape Factor : FB_ALY_Shape Factor(n Num Channels := 1); e Window Mode : E_ALY_Window Mode := E_ALY_Window Mode. Fix Window; n Window Size : UDINT := 100; b Configure : BOOL := TRUE; f Input : LREAL; f Shape Factor : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Shape Factor. Configure(e Window Mode, n Window Size); END_IF // Call algorithm fb Shape Factor. Set Channel Value(1, f Input); fb Shape Factor. Call(); fb Shape Factor. Get Channel Output Value(1, f Shape Factor); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.10.9.1 FB_init Initializes the number of independent input and output channels. Syntax Definition: 358 Version: 1.5.0 TF3510
## Page 359

PLC API METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 1; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used 5.1.1.10.9.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.10.9.3 Configure Configure the algorithm. Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Window Mode : E_ALY_Window Mode; n Window Size : UDINT; END_VAR TF3510 Version: 1.5.0 359
## Page 360

PLC API Inputs Name Type Description e Window Mode E_ALY_Window Mode Used window mode. Influences the amount of input data included in the calculation and the timing of the [} 432] calculations. • Continuous: All input values since the start of the algorithm are included in the calculation. The calculation is performed cyclically. • Fix Window: Only the last N input values are included in the calculation. The calculation is done every N calls. • Sliding Window: Only the last N input values are included in the calculation. The calculation is performed cyclically. n Window Size UDINT Depending on the window mode used, you can configure the number of values N that will be included in the calculation. In the window mode Continuous this parameter is ignored. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.10.9.4 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.10.9.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) Input ANY Input value of any data type. 360 Version: 1.5.0 TF3510
## Page 361

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.10.9.6 Get Channel Output Value Fetching a channel-specific output value. The output value is only updated if the Call() method was called previously. Syntax Definition: METHOD Get Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) output ANY Output value of any data type. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alue 5.1.1.11 Traning Base 5.1.1.11.1 FB_ALY_Time Based Teach Path_1Ch Time Based Teach Path 1Ch periodically writes the input data to a file according to the configured number of teach operations. This means that the values are not written sequentially for each period, but the values of a new period are compared with the existing values. The period can be defined by the input values Start Period and Stop Period (boolean signals are required). According to the teach mode, each value is overwritten or retained, so that the result is a taught input signal that can later be used as a reference signal for the Time Based Envelope 1Ch algorithm, for example. Syntax Definition: FUNCTION_BLOCK FB_Time Based Teach Path_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Busy: BOOL; b Teaching: BOOL; e State: E_Teach State; n Written Values: ULINT; n Values In File: ULINT; n Current Teach Cycles: ULINT; END_VAR TF3510 Version: 1.5.0 361
## Page 362

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Busy BOOL TRUE if the FB is active due to a file access. b Teaching BOOL TRUE, if the algorithm processes the teach-in, otherwise FALSE. The teach-in process starts when the Start Period flag switches to TRUE and stops when the Stop Period flag switches to TRUE. e State E_ALY_Teach State [} 431] Current state of the function block. See state diagram. n Written Values ULIINT Total number of values written during the teach-in process. Not to be confused with the number of values in File, which are overwritten in each teach-in cycle. n Values In File ULINT Number of values currently being written to the file. n Current Teach Cycle ULINT Number of teach-in cycles in the file. s Methods Name Definition Location Description Call() Local Method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Get Busy State() Local This method provide the busy state of the function block. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Switch State_Idle() Local Method to set the function block into an idle state if the teach procedure is finished. Switch State_Teach() Local Method to set the function block into the teach mode. Update State() Local Method to use for the transaction from one state to another state. State diagram Due to the asynchronous file access in real time applications this function block needs a state machine to prepare and finish file access. At startup the function block is in Idle state. To write the incoming data to a file it has to be switched to state Teach. Therefore the method Switch State_Teach() has to be called once to set the function block to the Pending Teach state. After that the method Update State() has to be called until the function block is in state Teach. In this state one or multiple teach cycles can be proceeded. If the function block should not teach additional cycles it can be set to Idle state again. To initiate the state switch the method Switch State_Idle() has to be called. After that the method Update State() has to be called until the function block is in state Idle. State diagram for the teach procedure of the data: 362 Version: 1.5.0 TF3510
## Page 363

PLC API Sample VAR fb Time Based Teach : FB_ALY_Time Based Teach Path_1Ch; e Teach Mode : E_ALY_Teach Mode := E_ALY_Teach Mode. Mean; n Segment Size : UDINT := 200; t Timeout : TIME := T#5S; n Set Num Teaches : UDINT := 10; b Involve Existing File : BOOL := TRUE; s File Path : STRING := 'C:\Twin CAT\3.1\Boot\Time Based Teach.tas'; b Negate Start Period : BOOL := FALSE; b Negate Stop Period : BOOL := FALSE; b Configure : BOOL := TRUE; e State : E_ALY_Teach State := E_ALY_Teach State. Idle; b Teach : BOOL; f Input : LREAL; b Start Period : BOOL; b Stop Period : BOOL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Time Based Teach. Configure(e Teach Mode, n Segment Size, t Timeout, n Set Num Teaches, b Involve Existing F ile, s File Path, b Negate Start Period, b Negate Stop Period); END_IF // Call algorithm e State := fb Time Based Teach.e State; CASE e State OF E_ALY_Teach State. Idle: IF b Teach THEN fb Time Based Teach. Switch State_Teach(); fb Time Based Teach. Update State(); END_IF E_ALY_Teach State. Teach: fb Time Based Teach. Set Channel Value(f Input); fb Time Based Teach. Call(b Start Period := b Start Period, b Stop Period := b Stop Period); IF NOT b Teach THEN fb Time Based Teach. Switch State_Idle(); fb Time Based Teach. Update State(); END_IF E_ALY_Teach State. Pending, E_ALY_Teach State. Pending Idle, E_ALY_Teach State. Pending Teach: TF3510 Version: 1.5.0 363
## Page 364

PLC API fb Time Based Teach. Update State(); e State := fb Time Based Teach.e State; END_CASE Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.11.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT b Start Period : ULINT; b Stop Period : BOOL; END_VAR Inputs Name Type Description b Start Period BOOL Rising edge starts teach-in process. b Stop Period BOOL Rising edge stops teach-in process. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.11.1.2 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Teach Mode : E_ALY_Teach Mode; n Segment Size : UDINT; t Timeout : TIME; n Set Num Teaches : UDINT; b Involve Existing File : BOOL; s File Path : STRING(255); b Negate Start Period : BOOL; b Negate Stop Period : BOOL; END_VAR 364 Version: 1.5.0 TF3510
## Page 365

PLC API Inputs Name Type Description e Teach Mode E_ALY_Teach Mode [} 431] Configuring the teach-in mode Minimum: Minimum of the stored data point and input data point. Maximum: Maximum of the stored data point and input data point. Mean: Mean value of the stored data point and input data point in relation to n Current Teach Cycles. n Segment Size UDINT Number of buffered elements for file operation. t Timeout TIME Timeout for asynchronous operations. n Set Num Teaches UDINT Teach-in number to be added to the file in Read state. "0" = not limited. b Involve Existing File BOOL If TRUE, include existing file (if any). If FALSE, create new file. s File Path STRING(255) Path to the taught file, e.g. C:\Twin CAT\3.1\Boot\Teach.tas b Negate Start Period BOOL Negates the input parameter b Start Period. b Negate Stop Period BOOL Negates the input parameter b Stop Period. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.11.1.3 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.11.1.4 Get Busy State Returns TRUE if the function block is busy due to an asynchronous file access. Syntax Definition: METHOD Get Busy State : BOOL VAR_INPUT END_VAR Return value Name Type Description Get Busy State BOOL Returns TRUE if the FB is active. 5.1.1.11.1.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. TF3510 Version: 1.5.0 365
## Page 366

PLC API Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT input : ANY; END_VAR Inputs Name Type Description Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.11.1.6 Switch State_Idle Initiate switch from Teach state to Idle state. See State diagram. Syntax Definition: METHOD Switch State_Idle : BOOL VAR_INPUT END_VAR Return value Name Type Description Switch State_Idle BOOL Returns TRUE if successful 5.1.1.11.1.7 Switch State_Teach Initiate switch from Idle state to Teach state. See State diagram. Syntax Definition: METHOD Switch State_Teach : BOOL VAR_INPUT END_VAR Return value Name Type Description Switch State_Teach BOOL Returns TRUE if successful 5.1.1.11.1.8 Update State Update state after state change was initiated and until target state is not reached. Syntax Definition: 366 Version: 1.5.0 TF3510
## Page 367

PLC API METHOD Update State : BOOL VAR_INPUT END_VAR Return value Name Type Description Update State BOOL Returns TRUE if successful 5.1.1.12 Visualization Only 5.1.1.12.1 FB_ALY_Trend Line The Trend Line function block provides for the forwarding of trends of the input signals for later use in the HMI dashboard. Any channels can be selected for forwarding; the number of channels can be controlled via Num Channels. One value per minute is then stored for each channel. This means that the function block is not suitable for signal forwarding, but rather for displaying trends for signals that change slowly. Since the function of this function block is irrelevant for the analysis itself, it belongs to the Visualization Only category. Syntax Definition: FUNCTION_BLOCK FB_ALY_State Histogram_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; fb Last Value: FB_ALY_Date Time; n Count Values: ULINT; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. fb Last Value FB_ALY_Date Time Timestamp of the last data point added. n Count Values ULINT Number of valid values. TF3510 Version: 1.5.0 367
## Page 368

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Get Channel Output Array Local Getting the result array of a channel without adding new () values. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Initial() Local Initialization of the initial values of a channel, for example with persistent data. Set Channel Value() Local Method for passing values to the algorithm. Set Inital() Local Initialization of internal states, for example with persistent data. Sample VAR fb Trend Line : FB_ALY_Trend Line(n Num Channels := 2); fb System Time : FB_ALY_Get System Time; f Input1 : LREAL; n Input2 : ULINT; END_VAR VAR PERSISTENT a Trends : ARRAY[1..2] OF ARRAY[1..10080] OF LREAL; t Last Value : ULINT; n Count Values : UDINT; END_VAR // Get current system time fb System Time. Call(); IF b Set Persistent THEN b Set Persistent := FALSE; fb Trend Line. Set Channel Initial(1, ADR(a Trends[1]), SIZEOF(a Trends[1])); fb Trend Line. Set Channel Initial(2, ADR(a Trends[2]), SIZEOF(a Trends[2])); fb Trend Line. Set Initial(t Last Value, n Count Values); END_IF // Call algorithm fb Trend Line. Set Channel Value(1, f Input1); fb Trend Line. Set Channel Value(2, n Input2); fb Trend Line. Call(fb System Time.t System Time); fb Trend Line. Get Channel Output Array(1, ADR(a Trends[1]), SIZEOF(a Trends[1])); fb Trend Line. Get Channel Output Array(2, ADR(a Trends[2]), SIZEOF(a Trends[2])); t Last Value := fb Trend Line.fb Last Value.n Raw; n Count Values := fb Trend Line.n Count Values; Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.12.1.1 FB_init The Init method is used to initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 1; END_VAR 368 Version: 1.5.0 TF3510
## Page 369

PLC API Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used 5.1.1.12.1.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.12.1.3 Get Channel Output Array Retrieves a channel-specific output array. The output values were updated in the previously called Call() method. Syntax Definition: METHOD Get Channel Output Array : BOOL VAR_INPUT n Channel : UDINT; p Array Out : POINTER TO LREAL; n Array Out Size : UDINT; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) p Array Out POINTER TO LREAL Pointer to an array in which the trend results are to be written. Dim: 10080 elements n Array Out Size UDINT Array size. TF3510 Version: 1.5.0 369
## Page 370

PLC API Return value Name Type Description Get Channel Output A BOOL Returns TRUE if successful. rray 5.1.1.12.1.4 Set Channel Initial Initialization of the output values of a channel, for example with persistent data. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; p Array In : POINTER TO LREAL; n Array In Size : UDINT; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) p Array In POINTER TO LREAL Pointer to an array from which the trend results are to be initialized. Dim: 10080 elements n Array In Size UDINT Array size. Return value Name Type Description Set Channel Initial BOOL Returns TRUE if successful. 5.1.1.12.1.5 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 370 Version: 1.5.0 TF3510
## Page 371

PLC API 5.1.1.12.1.6 Set Inital Initialize internal values of the algorithm. Syntax Definition: METHOD Set Initial : BOOL VAR_INPUT t Last Value : ULINT; n Count Values : UDINT; END_VAR Inputs Name Type Description t Last Value ULINT Timestamp of the last data point added. n Count Values UDINT Number of valid values. Return value Name Type Description Set Initial BOOL Returns TRUE if successful. 5.1.1.12.1.7 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.12.2 FB_ALY_Pie Chart The Pie Chart function block can be used to create a pie chart for later use in the HMI Dashboard. The number of pie pieces can be parameterized via the parameter Num Channels. Since the function of this function block is irrelevant for the analysis itself, it belongs to the Visualization Only category. Syntax Definition: FUNCTION_BLOCK FB_ALY_State Histogram_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; END_VAR TF3510 Version: 1.5.0 371
## Page 372

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration FB_init Local Initializes the number of input channels. Get Channel Output Valu Local Method for getting individual output values from the output e() array. Get Output Array() Local Method for getting the entire output array. Reset() Local Resets all internal states or the calculations performed so far. Set Channel Value() Local Method for passing values to the algorithm. Set Input Array() Local Simultaneous setting of all input channels. Sample VAR fb Pie Chart : FB_ALY_Pie Chart(n Num Channels := 3); a Channel Names : ARRAY[1..3] OF STRING(255) := ['First Channel', 'Second Channel', 'Third Channel ']; b Relative Output : BOOL := TRUE; b Configure : BOOL := TRUE; f Input1 : LREAL; n Input2 : ULINT; n Input3 : INT; a Result : ARRAY[1..3] OF LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Pie Chart. Configure Channel(1, a Channel Names[1]); fb Pie Chart. Configure Channel(2, a Channel Names[2]); fb Pie Chart. Configure Channel(3, a Channel Names[3]); fb Pie Chart. Configure(b Relative Output); END_IF // Call algorithm fb Pie Chart. Set Channel Value(1, f Input1); fb Pie Chart. Set Channel Value(2, n Input2); fb Pie Chart. Set Channel Value(3, n Input3); fb Pie Chart. Call(); fb Pie Chart. Get Output Array(ADR(a Result), SIZEOF(a Result)); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 372 Version: 1.5.0 TF3510
## Page 373

PLC API 5.1.1.12.2.1 FB_init The Init method is used to initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels UDINT Initializes the number of input channels. Return value Name Type Description FB_init BOOL Not used 5.1.1.12.2.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.12.2.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT b Relative Output : BOOL; END_VAR Inputs Name Type Description b Relative Output BOOL If TRUE, the output is relative, otherwise absolute. TF3510 Version: 1.5.0 373
## Page 374

PLC API Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.12.2.4 Configure Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Channel : BOOL VAR_INPUT n Channel : UDINT s Channel Name : STRING(255); END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) s Channel Name STRING(255) Alias of the input channel Return value Name Type Description Configure Channel BOOL Returns TRUE if successful. 5.1.1.12.2.5 Get Channel Output Value Fetching a channel-specific output value. The output value is only updated if the Call() method was called previously. Syntax Definition: METHOD Get Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels) output ANY Output value of any data type. Return value Name Type Description Get Channel Output V BOOL Returns TRUE if successful. alue 374 Version: 1.5.0 TF3510
## Page 375

PLC API 5.1.1.12.2.6 Get Output Array Getting the entire output array. The number of elements corresponds to the configured buffer size. Syntax Definition: METHOD Get Output Array : BOOL VAR_INPUT p Array Out : POITNER TO LREAL; n Array Out Size : UDINT; END_VAR Inputs Name Type Description p Array Out POINTER TO LREAL Pointer to the output array: Dim: n Buffer Size n Array Out Size UDINT Size of the output array Return value Name Type Description Get Output Array BOOL Returns TRUE if successful. 5.1.1.12.2.7 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.12.2.8 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Channels) Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 375
## Page 376

PLC API 5.1.1.12.2.9 Set Input Array Simultaneous setting of all input channels. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT p Array In : PVOID; n Array In Size : UDINT; END_VAR Inputs Name Type Description p Array In PVOID Pointer to an array of input data. Dim: n Num Channels n Array In Size UDINT Array size. Return value Name Type Description Set Input Array BOOL Returns TRUE if successful. 5.1.1.12.3 FB_ALY_Sankey Diagram The Sankey Diagram function block can be used to create a Sankey diagram for later use in the HMI Dashboard. A distinction is made between inflows and outflows. The number of inflows and outflows can be individually parameterized via the parameters Num Channels Inflow and Num Channels Outflow respectively. Since the function of this function block is irrelevant for the analysis itself, it belongs to the Visualization Only category. Syntax Definition: FUNCTION_BLOCK FB_ALY_State Histogram_1Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; f Rest: LREAL; END_VAR Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. For this special interface pointer, it is ensured internally that it is always valid/assigned. b Error BOOL The output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. f Rest LREAL Residual value (Inflow - Outflow) in percent. 376 Version: 1.5.0 TF3510
## Page 377

PLC API Methods Name Definition location Description Call() Local Method for calculating the outputs for a specific configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Inflow Channel Local Configuration of the inflow channels. () Configure Outflow Chann Local Configuration of the outflow channels. el() FB_Init Local Initialize the number of inflow and outflow channels. Get Get Inflow Channel O Local Getting the result value from the Inflow result array without utput Value() adding new values. Get Get Inflow Output Arra Local Getting the Inflow result array without adding new values. y() Get Get Outflow Channel Local Getting the result value from the Outflow result array Output Value() without adding new values. Get Get Outflow Output Ar Local Getting the Outflow result array without adding new values. ray () Reset() Local Resets all internal states or the calculations performed so far. Set Inflow Channel Value( Local Method for passing Inflow values to the algorithm. ) Set Outflow Channel Valu Local Method for passing Outflow values to the algorithm. e() Sample VAR fb Sankey Diagram : FB_ALY_Sankey Diagram(n Num Channels Inflow := 2, n Num Channels Outflow := 3); a Channel Names Inflow : ARRAY [1..2] OF STRING(255) := ['Grid', 'PV']; a Channel Names Outflow : ARRAY [1..3] OF STRING(255) := ['HVAC', 'Server', 'Lights']; s Channel Name Rest : STRING(255) := 'Rest'; b Configure : BOOL := TRUE; f Inflow Grid : LREAL; f Inflow PV: LREAL; f Outflow HVAC: LREAL; f Outflow Server: LREAL; f Outflow Lights: LREAL; a Inflow : ARRAY[1..2] OF LREAL; a Outflow : ARRAY[1..3] OF LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Sankey Diagram. Configure Inflow Channel(1, a Channel Names Inflow[1]); fb Sankey Diagram. Configure Inflow Channel(2, a Channel Names Inflow[2]); fb Sankey Diagram. Configure Outflow Channel(1, a Channel Names Outflow[1]); fb Sankey Diagram. Configure Outflow Channel(2, a Channel Names Outflow[2]); fb Sankey Diagram. Configure Outflow Channel(3, a Channel Names Outflow[3]); fb Sankey Diagram. Configure(s Channel Name Rest); END_IF // Call algorithm fb Sankey Diagram. Set Inflow Channel Value(1, f Inflow Grid); fb Sankey Diagram. Set Inflow Channel Value(2, f Inflow PV); fb Sankey Diagram. Set Outflow Channel Value(1, f Outflow HVAC); fb Sankey Diagram. Set Outflow Channel Value(2, f Outflow Server); fb Sankey Diagram. Set Outflow Channel Value(3, f Outflow Lights); fb Sankey Diagram. Call(); fb Sankey Diagram. Get Inflow Output Array(ADR(a Inflow), SIZEOF(a Inflow)); fb Sankey Diagram. Get Outflow Output Array(ADR(a Outflow), SIZEOF(a Outflow)); TF3510 Version: 1.5.0 377
## Page 378

PLC API Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.12.3.1 FB_init The Init method is used to initialize the number of input channels. Syntax Definition: METHOD FB_init : BOOL VAR_INPUT n Num Channels Inflow : UDINT := 2; n Num Channels Outflow : UDINT := 2; END_VAR Inputs Name Type Description n Num Channels Inflo UDINT Initializes the number of Inflow channels. w n Num Channels Outfl UDINT Initializes the number of Outflow channels. ow Return value Name Type Description FB_init BOOL Not used 5.1.1.12.3.2 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT END_VAR Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.12.3.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: 378 Version: 1.5.0 TF3510
## Page 379

PLC API METHOD Configure : BOOL VAR_INPUT s Channel Name Rest : STRING(255); END_VAR Inputs Name Type Description s Channel Name Rest STRING(255) Name of the residual output channel. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.12.3.4 Configure Inflow Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Inflow Channel : BOOL VAR_INPUT n Channel : UDINT s Channel Name : STRING(255); END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels Inflow) s Channel Name STRING(255) Alias of the input channel. Return value Name Type Description Configure Inflow Cha BOOL Returns TRUE if successful. nnel 5.1.1.12.3.5 Configure Outflow Channel Configure channel specific parameters. The configuration will not be processed until the method Configure() is called. Syntax Definition: METHOD Configure Outflow Channel : BOOL VAR_INPUT n Channel : UDINT s Channel Name : STRING(255); END_VAR TF3510 Version: 1.5.0 379
## Page 380

PLC API Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels Outflow) s Channel Name STRING(255) Alias of the input channel. Return value Name Type Description Configure Outflow Ch BOOL Returns TRUE if successful. annel 5.1.1.12.3.6 Get Inflow Channel Output Value Fetching a channel-specific output value. The output value is only updated if the Call() method was called previously. Syntax Definition: METHOD Get Inflow Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels Inflow) output ANY Output value of any data type. Return value Name Type Description Get Inflow Channel Ou BOOL Returns TRUE if successful. tput Value 5.1.1.12.3.7 Get Inflow Output Array Getting the entire output array. The number of elements corresponds to the configured inflow channels. Syntax Definition: METHOD Get Inflow Output Array : BOOL VAR_INPUT p Array Out : POITNER TO LREAL; n Array Out Size : UDINT; END_VAR Inputs Name Type Description p Array Out POINTER TO LREAL Pointer to the output array: Dim: n Num Channels Outflow n Array Out Size UDINT Size of the output array. 380 Version: 1.5.0 TF3510
## Page 381

PLC API Return value Name Type Description Get Inflow Output Arra BOOL Returns TRUE if successful. y 5.1.1.12.3.8 Get Outflow Channel Output Value Fetching a channel-specific output value. The output value is only updated if the Call() method was called previously. Syntax Definition: METHOD Get Outflow Channel Output Value : BOOL VAR_INPUT n Channel : UDINT; output : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels Outflow) output ANY Output value of any data type. Return value Name Type Description Get Outflow Channel BOOL Returns TRUE if successful. Output Value 5.1.1.12.3.9 Get Outflow Output Array Getting the entire output array. The number of elements corresponds to the configured outflow channels. Syntax Definition: METHOD Get Outflow Oput Array : BOOL VAR_INPUT p Array Out : POITNER TO LREAL; n Array Out Size : UDINT; END_VAR Inputs Name Type Description p Array Out POINTER TO LREAL Pointer to the output array: Dim: n Num Channels Outflow n Array Out Size UDINT Size of the output array. Return value Name Type Description Get Outflow Oput Arra BOOL Returns TRUE if successful. y TF3510 Version: 1.5.0 381
## Page 382

PLC API 5.1.1.12.3.10 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.12.3.11 Set Inflow Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Inflow Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels Inflow) Input ANY Input value of any data type. Return value Name Type Description Set Inflow Channel Val BOOL Returns TRUE if successful. ue 5.1.1.12.3.12 Set Outflow Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Outflow Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index (1 to n Num Channels Outflow) Input ANY Input value of any data type. 382 Version: 1.5.0 TF3510
## Page 383

PLC API Return value Name Type Description Set Outflow Channel V BOOL Returns TRUE if successful. alue 5.1.1.13 XY Path Analysis 5.1.1.13.1 FB_ALY_Xy Gate Monitor_2Ch The XY Gate Monitor 2Ch counts the amount of intersections of an XY input with a specified gate or its projection (straight line between the gate points) depending on the configured Gate Mode. The analysis period can be started with the inputs Start and Stop. The algorithm is direction sensitive, which means that just intersection in the right direction are counted. The direction interpretation depends on the order of the gate points (X1/Y1) and (X2/Y2). The possible intersection directions are visualized below. Directions of the intersection points: The blue arrow represents the signal direction and the black lines illustrate the gate with its gate points (X1/ Y1) and (X2/Y2). The direction of the intersection points is counted when the signal rotates counterclockwise around the first gate point (X1/Y1). Syntax Definition: FUNCTION_BLOCK FB_ALY_Xy Gate Monitor_2Ch VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Executing: BOOL; b Gate Intersection: BOOL; b Outlier Intersection: BOOL; f Pos Intersection X: LREAL; f Pos Intersection Y: LREAL; n Count Gate Intersections: ULINT; n Count Outlier Intersections: ULINT; fb Time Last Intersection: FB_ALY_Date Time; e Classification: E_ALY_Classification_2Cls; END_VAR TF3510 Version: 1.5.0 383
## Page 384

PLC API Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Executing BOOL TRUE if the Call() method was called with b Start:=TRUE. FALSE if the call method was called with b Stop:=TRUE. b Gate Intersection BOOL TRUE if a gate intersection has been detected. b Outlier Intersection BOOL TRUE if an outlier intersection has been detected. f Pos Intersection X LREAL X coordinate of the last intersection. f Pos Intersection Y LREAL Y coordinate of the last intersection. n Count Gate Intersect ULINT Number of intersections detected. ions n Count Outlier Interse ULINT Number of outliers detected. ctions fb Time Last Intersecti FB_ALY_Date Time Timestamp of the last intersection. on e Classification E_ALY_Classification_2Cl Classification result. Depending on the configured gate s mode. Methods Name Definition Location Description Call() Local method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Xy Gate Monitor : FB_ALY_Xy Gate Monitor_2Ch; fb System Time : FB_ALY_Get System Time; e Gate Mode : E_ALY_Gate Mode := E_ALY_Gate Mode. Intersect Gate; st Gate Pos1 : ST_ALY_Xy Position := ( X:= 0.0, Y := 0.0); st Gate Pos2 : ST_ALY_Xy Position := ( X:= 0.0, Y := 4.0); b Configure : BOOL := TRUE; f Input Ch X : LREAL; f Input Ch Y : LREAL; b Start : BOOL; b Stop : BOOL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Xy Gate Monitor. Configure(e Gate Mode, st Gate Pos1, st Gate Pos2); END_IF // Get current system time fb System Time. Call(); // Call algorithm 384 Version: 1.5.0 TF3510
## Page 385

PLC API fb Xy Gate Monitor. Set Channel Value(1, f Input Ch X); fb Xy Gate Monitor. Set Channel Value(2, f Input Ch Y); fb Xy Gate Monitor. Call(b Start, b Stop, fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.13.1.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT b Start : BOOL; b Stop : BOOL; t Timestamp : ULINT; END_VAR Inputs Name Type Description b Start BOOL Start gate observe. b Stop BOOL Stop gate observe. t Timestamp ULINT Current timestamp. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.13.1.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.13.1.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT e Gate Mode : E_ALY_Gate Mode; st Gate Pos1 : ST_ALY_Xy Position; st Gate Pos2 : ST_ALY_Xy Position; END_VAR TF3510 Version: 1.5.0 385
## Page 386

PLC API Inputs Name Type Description e Gate Mode E_ALY_Gate Mode [} 431] Configured gate mode Intersect Gate: Determines whether the XY signal crosses the gate in the configured direction. If there is an intersection during the analysis period, this is classified as OK, otherwise NOK. Not Intersect Gate: Monitors whether the XY signal does not intersect with the gate in the configured direction during the analysis period. Then this is classified as OK, otherwise NOK. Intersect Projection: Determines whether the XY signal crosses the projection of the gate in the configured direction. If there is an intersection during the analysis period, this is classified as OK, otherwise NOK. Not Intersect Projection: Monitors whether the XY signal does not intersect with the projection of the gate in the configured direction during the analysis period. Then this is classified as OK, otherwise NOK. Intersect Gate Or Projection: Determines whether the XY signal intersects the gate or its projection in the configured direction. If there is an intersection during the analysis period, this is classified as OK, otherwise NOK. st Corner1 ST_ALY_Xy Position [} 427] Structure for saving the position of the first corner in XY coordinates. st Corner2 ST_ALY_Xy Position [} 427] Structure for saving the position of the second corner in XY coordinates. st Corner3 ST_ALY_Xy Position [} 427] Structure for saving the position of the third corner in XY coordinates. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.13.1.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Value of X-coordinate 2: Value of Y-coordinate Input ANY Input value of arbitrary data type. 386 Version: 1.5.0 TF3510
## Page 387

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.13.2 FB_ALY_Xy Shape Monitor_Circle_2Ch The XY Shape Monitor Circle 2Ch count the amount of intersections of an XY input with a specified circle shape. Syntax Definition: FUNCTION_BLOCK FB_ALY_Xy Shape Monitor_Circle_2Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Within Shape: BOOL; b Intersection: BOOL; n Count Intersections: ULINT; fb Time Last Intersection: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Within Shape BOOL TRUE if the input signal is currently within the specified shape. b Intersection BOOL TRUE if the input signal currently crosses the specified shape. n Count Intersections ULINT Total number of intersections of input signal and shape. fb Time Last Intersecti FB_ALY_Date Time Timestamp of the last intersection. on TF3510 Version: 1.5.0 387
## Page 388

PLC API Methods Name Definition Location Description Call() Local method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Xy Shape Monitor_Circle : FB_ALY_Xy Shape Monitor_Circle_2Ch; fb System Time : FB_ALY_Get System Time; st Centre : ST_ALY_Xy Position := ( X:= 4.0, Y := 2.0); f Radius : LREAL := 1.5; b Configure : BOOL := TRUE; f Input Ch X : LREAL; f Input Ch Y : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Xy Shape Monitor_Circle. Configure(st Centre, f Radius); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Xy Shape Monitor_Circle. Set Channel Value(1, f Input Ch X); fb Xy Shape Monitor_Circle. Set Channel Value(2, f Input Ch Y); fb Xy Shape Monitor_Circle. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.13.2.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. 388 Version: 1.5.0 TF3510
## Page 389

PLC API 5.1.1.13.2.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.13.2.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT st Centre : ST_ALY_Xy Position; f Radius : LREAL; END_VAR Inputs Name Type Description st Centre ST_ALY_Xy Position [} 427] Structure for saving the position of the circle center in XY coordinates. f Radius LREAL Radius of the circle. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.13.2.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Value of the X coordinate 2: Value of the Y coordinate Input ANY Input value of any data type. TF3510 Version: 1.5.0 389
## Page 390

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.13.3 FB_ALY_Xy Shape Monitor_Rectangle_2Ch The XY Shape Monitor Rectangle 2Ch count the amount of intersections of an XY input with a specified rectangle shape. Syntax Definition: FUNCTION_BLOCK FB_ALY_Xy Shape Monitor_Rectangle_2Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Within Shape: BOOL; b Intersection: BOOL; n Count Intersections: ULINT; fb Time Last Intersection: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Within Shape BOOL TRUE if the input signal is currently within the specified shape. b Intersection BOOL TRUE if the input signal currently crosses the specified shape. n Count Intersections ULINT Total number of intersections of input signal and shape. fb Time Last Intersecti FB_ALY_Date Time Timestamp of the last intersection. on 390 Version: 1.5.0 TF3510
## Page 391

PLC API Methods Name Definition Location Description Call() Local method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Xy Shape Monitor_Rectangle : FB_ALY_Xy Shape Monitor_Rectangle_2Ch; fb System Time : FB_ALY_Get System Time; st Lower Left Corner : ST_ALY_Xy Position := ( X:= 0.0, Y := 0.0); f Length_X : LREAL := 10; f Length_Y : LREAL := 5; b Configure : BOOL := TRUE; f Input Ch X : LREAL; f Input Ch Y : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Xy Shape Monitor_Rectangle. Configure(st Lower Left Corner, f Length_X, f Length_Y ); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Xy Shape Monitor_Rectangle. Set Channel Value(1, f Input Ch X); fb Xy Shape Monitor_Rectangle. Set Channel Value(2, f Input Ch Y); fb Xy Shape Monitor_Rectangle. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.13.3.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. Return value Name Type Description Call BOOL Returns TRUE if successful. TF3510 Version: 1.5.0 391
## Page 392

PLC API 5.1.1.13.3.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.13.3.3 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT st Lower Left Corner : ST_ALY_Xy Position; f Length_X : LREAL; f Length_Y : LREAL; END_VAR Inputs Name Type Description st Lower Left Corner ST_ALY_Xy Position [} 427] Structure for saving the position of the lower left corner of the rectangle in XY coordinates. f Lenght_X LREAL Length of the rectangle in positive X direction. f Lenght_Y LREAL Length of the rectangle in positive Y direction. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.1.13.3.4 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Value of the X coordinate 2: Value of the Y coordinate Input ANY Input value of any data type. 392 Version: 1.5.0 TF3510
## Page 393

PLC API Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.13.4 FB_ALY_Xy Shape Monitor_Triangle_2Ch The XY Shape Monitor Triangle 2Ch counts the amount of intersections of an XY input with a specified triangle shape. Syntax Definition: FUNCTION_BLOCK FB_ALY_Xy Shape Monitor_Triangle_2Ch VAR_INPUT b Persistent: BOOL; END_VAR VAR_OUTPUT ip Result Message: Tc3_Event Logger. I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Within Shape: BOOL; b Intersection: BOOL; n Count Intersections: ULINT; fb Time Last Intersection: FB_ALY_Date Time; END_VAR Inputs Name Type Description b Persistent BOOL If the value is TRUE, the internal data is stored persistently. Outputs Name Type Description ip Result Message I_Tc Message Contains more detailed information on the current return value. This special interface pointer is internally secured so that it is always valid/assigned. b Error BOOL This output is TRUE if an error occurs. b New Result BOOL When a new result has been calculated, the output is TRUE. b Configured BOOL Displays TRUE when the function block is successfully configured. b Within Shape BOOL TRUE if the input signal is currently within the specified shape. b Intersection BOOL TRUE if the input signal currently crosses the specified shape. n Count Intersections ULINT Total number of intersections of input signal and shape. fb Time Last Intersecti FB_ALY_Date Time Timestamp of the last intersection. on TF3510 Version: 1.5.0 393
## Page 394

PLC API Methods Name Definition Location Description Call() Local method calculates the outputs for a given configuration. Configure() Local General configuration of the algorithm with its parameterized conditions. Configure Channel() Local Channel-specific configuration for the respective algorithm. Reset() Local Resets all internal states or the calculations made so far. Set Channel Value() Local Method to pass values to the algorithm. Sample VAR fb Xy Shape Monitor_Triangle : FB_ALY_Xy Shape Monitor_Triangle_2Ch; fb System Time : FB_ALY_Get System Time; st Corner1 : ST_ALY_Xy Position := ( X:= 0.0, Y := 0.0); st Corner2 : ST_ALY_Xy Position := ( X:= 0.0, Y := 6.0); st Corner3 : ST_ALY_Xy Position := ( X:= 4.0, Y := 3.0); b Configure : BOOL := TRUE; f Input Ch X : LREAL; f Input Ch Y : LREAL; END_VAR // Configure algorithm IF b Configure THEN b Configure := FALSE; fb Xy Shape Monitor_Triangle. Configure(st Corner1, st Corner2, st Corner3); END_IF // Get current system time fb System Time. Call(); // Call algorithm fb Xy Shape Monitor_Triangle. Set Channel Value(1, f Input Ch X); fb Xy Shape Monitor_Triangle. Set Channel Value(2, f Input Ch Y); fb Xy Shape Monitor_Triangle. Call(fb System Time.t System Time); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.1.13.4.1 Call Call the algorithm after a new input value is set. A new input can be assigned by using the method Set Channel Value(). Syntax Definition: METHOD Call : BOOL VAR_INPUT t Timestamp : ULINT; END_VAR Inputs Name Type Description t Timestamp ULINT Current timestamp with a resolution of 1 ns. 394 Version: 1.5.0 TF3510
## Page 395

PLC API Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.1.13.4.2 Reset Resetting the algorithm. Return value Name Type Description Reset BOOL Returns TRUE if the reset was successful. 5.1.1.13.4.3 Set Channel Value Set channel specific input value. The input value is not processed until the Call() method has been invoked. Syntax Definition: METHOD Set Channel Value : BOOL VAR_INPUT n Channel : UDINT; input : ANY; END_VAR Inputs Name Type Description n Channel UDINT Channel index 1: Value of the X coordinate 2: Value of the Y coordinate Input ANY Input value of any data type. Return value Name Type Description Set Channel Value BOOL Returns TRUE if successful. 5.1.1.13.4.4 Configure Configure the algorithm. Channel specific parameter are set using the method Configue Channel(). Syntax Definition: METHOD Configure : BOOL VAR_INPUT st Corner1 : ST_ALY_Xy Position; st Corner2 : ST_ALY_Xy Position; st Corner3 : ST_ALY_Xy Position; END_VAR TF3510 Version: 1.5.0 395
## Page 396

PLC API Inputs Name Type Description st Corner1 ST_ALY_Xy Position [} 427] Structure for saving the position of the first corner in XY coordinates. st Corner2 ST_ALY_Xy Position [} 427] Structure for saving the position of the second corner in XY coordinates. st Corner3 ST_ALY_Xy Position [} 427] Structure for saving the position of the third corner in XY coordinates. Return value Name Type Description Configure BOOL Returns TRUE if successful. 5.1.2 System 5.1.2.1 FB_ALY_Date Time Function block to store and process timestamps. Timestamps are stored as raw values in accuracy of 1ns. Using the methods of this FB the timespan can be modified, compared or formatted. Methods Name Definition Location Description Add Raw Local Method to add a timespan in raw format. Add Timespan Local Method to add a timespan stored in FB_ALY_Timespan [} 399] Sub Raw Local Method to subtract a timespan in raw format. Sub Timespan Local Method to subtract a timespan stored in FB_ALY_Timespan [} 399] Equals To Local Method to compare two timestamps. To String Local Method to format the current raw value as string. Sample VAR fb Date Time : FB_ALY_Date Time; fb System Time : FB_ALY_Get System Time; s Formatted Date Time : STRING(29); END_VAR // Get current system time fb System Time. Call(); fb Date Time.n Raw := fb System Time.t System Time; fb Date Time. Add Raw(TO_LINT(LTIME#1H)); s Formatted Date Time := fb Date Time. To String() Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.2.1.1 Add Raw Call to add a timespan in raw format to the timestamp value. 396 Version: 1.5.0 TF3510
## Page 397

PLC API Syntax Definition: METHOD Add Raw : ULINT VAR_INPUT n Raw : LINT; END_VAR Inputs Name Type Description n Raw LINT Raw value to be added to the timestamp. Return value Name Type Description Add Raw ULINT Returns the resulting timestamp value. 5.1.2.1.2 Add Timespan Call to add a timespan to the timestamp value. Syntax Definition: METHOD Add Timespan : ULINT VAR_INPUT ip Timespan : I_ALY_Timespan; END_VAR Inputs Name Type Description ip Timespan I_ALY_Timespan Interface pointer to a timespan instance to be added to the timestamp. Return value Name Type Description Add Timespan ULINT Returns the resulting timestamp value. 5.1.2.1.3 Sub Raw Call to subtract a timespan in raw format from the timestamp value. Syntax Definition: METHOD Sub Raw : BOOL VAR_INPUT n Raw : LINT; END_VAR Inputs Name Type Description n Raw LINT Raw value to be subtracted from the timestamp. TF3510 Version: 1.5.0 397
## Page 398

PLC API Return value Name Type Description Sub Raw ULINT Returns resulting timestamp value. 5.1.2.1.4 Sub Timespan Call to subtract a timespan from the timestamp value. Syntax Definition: METHOD Sub Timespan : ULINT VAR_INPUT ip Timespan : I_ALY_Timespan; END_VAR Inputs Name Type Description ip Timespan I_ALY_Timespan Interface pointer to a timespan instance to be added to the timestamp. Return value Name Type Description Sub Timespan ULINT Returns the resulting timestamp value. 5.1.2.1.5 Equals To Call to compare the current timestamp with the input timestamp. Syntax Definition: METHOD Equals To : BOOL VAR_INPUT ip Date Time: I_ALY_Date Time; END_VAR Inputs Name Type Description ip Date Time I_ALY_Date Time Interface pointer to a Date Time instance for comparison. Return value Name Type Description Equals To BOOL Returns TRUE if the timestamps are equal. 5.1.2.1.6 To String Method to format the current raw value as string. The output format is YYYY-MM-DD-hh:mm:ss.nnnnnnnnn. 398 Version: 1.5.0 TF3510
## Page 399

PLC API Return value Name Type Description To String STRING(29) Returns the formatted string. 5.1.2.2 FB_ALY_Get System Time Gets the local system time in resolution of 1ns. The accuracy of this time is 100ns. The value is updated by the Call()-method. Syntax Definition: FUNCTION_BLOCK FB_ALY_Date Time t System Time : ULINT; END_VAR Outputs Name Type Description t System Time ULINT Current system time. Methods Name Definition location Description Call() Local Method for recording the current system time. Sample VAR fb System Time : FB_ALY_Get System Time; t System Time : ULINT; END_VAR // Gather current system time fb System Time. Call(); // Allocate system time t System Time := fb System Time.t System Time; Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.2.2.1 Call Call to gather the current system time. The system time is stored in the output data of the FB. Return value Name Type Description Call BOOL Returns TRUE if successful. 5.1.2.3 FB_ALY_Timespan Function block to store and process timespans. Timespans are stored as raw values in accuracy of 1ns. Using the methods of this FB the timespan can be modified, compared or formatted. TF3510 Version: 1.5.0 399
## Page 400

PLC API Methods Name Definition location Description Add Raw Local Method for adding a timespan in raw format. Add Timespan Local Method for adding a timespan stored in FB_ALY_Timespan [} 399]. Sub Raw Local Method for subtracting a timespan in raw format. Sub Timespan Local Method for subtracting a timespan stored in FB_ALY_Timespan [} 399]. Equals To Local Method for comparing two timestamps. To Format String Local Method for formatting the current raw value as a string. To String Local Method for formatting the current raw value as a string with configurable precision. Total Days Local Method to get the total number of days. Total Hours Local Method to get the total number of hours. Total Minutes Local Method to get the total number of minutes. Total Seconds Local Method to get the total number of seconds. Sample VAR fb Timespan : FB_ALY_Timespan; s Timespan : STRING; s Formatted Timespan : STRING; END_VAR fb Timespan. Add Raw(TO_LINT(LTIME#1S)); s Timespan := fb Timespan. To String(e Accuracy := E_ALY_Timestamp Accuracy. Second); s Formatted Timespan := fb Timespan. To Format String(); Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.2.3.1 Add Raw Call to add a timespan in raw format to the timespan value. Syntax Definition: METHOD Add Raw : ULINT VAR_INPUT n Raw : LINT; END_VAR Inputs Name Type Description n Raw LINT Raw value to be added to the timespan. Return value Name Type Description Add Raw ULINT Returns the resulting timespan value. 400 Version: 1.5.0 TF3510
## Page 401

PLC API 5.1.2.3.2 Add Timespan Call to add a timespan to the timespan value. Syntax Definition: METHOD Add Timespan : ULINT VAR_INPUT ip Timespan : I_ALY_Timespan; END_VAR Inputs Name Type Description ip Timespan I_ALY_Timespan Interface pointer to an Timespan instance to be added to the timespan. Return value Name Type Description Add Timespan ULINT Returns resulting timespan value. 5.1.2.3.3 Sub Raw Call to subtract a timespan in raw format from the timespan value. Syntax Definition: METHOD Sub Raw : BOOL VAR_INPUT n Raw : LINT; END_VAR Inputs Name Type Description n Raw LINT Raw value to be subtracted from the timespan. Return value Name Type Description Sub Raw ULINT Returns resulting timespan value. 5.1.2.3.4 Sub Timespan Call to subtract a timespan from the timespan value. Syntax Definition: METHOD Sub Timespan : ULINT VAR_INPUT ip Timespan : I_ALY_Timespan; END_VAR TF3510 Version: 1.5.0 401
## Page 402

PLC API Inputs Name Type Description ip Timespan I_ALY_Timespan Interface pointer to an Timespan instance to be added to the timespan. Return value Name Type Description Sub Timespan ULINT Returns resulting timespan value. 5.1.2.3.5 Equals To Call to compare the current timespan with the input timespan. Syntax Definition: METHOD Equals To : BOOL VAR_INPUT ip Timespan : I_ALY_Timespan; END_VAR Inputs Name Type Description ip Timespan I_ALY_Timespan Interface pointer to an Timespan instance to compare with. Return value Name Type Description Equals To BOOL Returns TRUE if timespans are equal. 5.1.2.3.6 To String Method to format the current raw value as string with configurable accuracy. An example output is 1d2m3s4ms5ns. Inputs Name Type Description e Accuracy E_ALY_Timestamp Accurac Define accuracy of output string. y [} 434] Return value Name Type Description To String STRING Returns formatted string. 5.1.2.3.7 To Format String Method to format the current raw value as string. The output format is dd:hh:mm:ss,f. 402 Version: 1.5.0 TF3510
## Page 403

PLC API Return value Name Type Description To Format String STRING Returns formatted string. 5.1.2.3.8 Total Days Method to get the amount of total days. Return value Name Type Description Total Days DINT Returns amount of total days. 5.1.2.3.9 Total Hours Method to get the amount of total hours. Return value Name Type Description Total Hours DINT Returns amount of total hours. 5.1.2.3.10 Total Minutes Mehod to get the amount of total minutes. Return value Name Type Description Total Minutes DINT Returns amount of total minutes. 5.1.2.3.11 Total Seconds Method to get the amount of total seconds. Return value Name Type Description Total Seconds LINT Returns amount of total seconds. 5.1.3 Io T 5.1.3.1 Io T Symbol 5.1.3.1.1 FB_ALY_Iot Symbol_BOOL Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_BOOL VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; TF3510 Version: 1.5.0 403
## Page 404

PLC API END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.2 FB_ALY_Iot Symbol_BYTE Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_BYTE VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; 404 Version: 1.5.0 TF3510
## Page 405

PLC API b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.3 FB_ALY_Iot Symbol_DINT Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_DINT VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; TF3510 Version: 1.5.0 405
## Page 406

PLC API b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.4 FB_ALY_Iot Symbol_DWORD Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_DWORD VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); 406 Version: 1.5.0 TF3510
## Page 407

PLC API t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.5 FB_ALY_Iot Symbol_INT Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_INT VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; TF3510 Version: 1.5.0 407
## Page 408

PLC API n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.6 FB_ALY_Iot Symbol_LINT Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_LINT VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR 408 Version: 1.5.0 TF3510
## Page 409

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.7 FB_ALY_Iot Symbol_LREAL Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_LREAL VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR TF3510 Version: 1.5.0 409
## Page 410

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.8 FB_ALY_Iot Symbol_LWORD Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_LWORD VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR 410 Version: 1.5.0 TF3510
## Page 411

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.9 FB_ALY_Iot Symbol_REAL Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_REAL VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR TF3510 Version: 1.5.0 411
## Page 412

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.10 FB_ALY_Iot Symbol_SINT Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_SINT VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR 412 Version: 1.5.0 TF3510
## Page 413

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.11 FB_ALY_Iot Symbol_STRING Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_STRING VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR TF3510 Version: 1.5.0 413
## Page 414

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.12 FB_ALY_Iot Symbol_UDINT Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_UDINT VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR 414 Version: 1.5.0 TF3510
## Page 415

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.13 FB_ALY_Iot Symbol_UINT Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_UINT VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR TF3510 Version: 1.5.0 415
## Page 416

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.14 FB_ALY_Iot Symbol_ULINT Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_ULINT VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR 416 Version: 1.5.0 TF3510
## Page 417

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.15 FB_ALY_Iot Symbol_USINT Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_USINT VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR TF3510 Version: 1.5.0 417
## Page 418

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.1.16 FB_ALY_Iot Symbol_WORD Syntax Definition: FUNCTION_BLOCK FB_ALY_Iot Symbol_WORD VAR_INPUT st Config : ST_ALY_Iot Symbol_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Symbol Handler Assigned: BOOL; b Variable Found: BOOL; s Symbol Path: STRING(255); t Cycle Time: LTIME; n Max Num Elements: UDINT; n Num Elements: UDINT; END_VAR 418 Version: 1.5.0 TF3510
## Page 419

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Symbol Handler Assi BOOL TRUE if symbol handler assigned gned b Variable Found BOOL TRUE if variable found in stream s Symbol Path STRING(255) Topic/Stream. Symbol t Cycle Time LTIME Cycle time of publishing system n Max Num Elements UDINT Maximum number of Symbols stored affected by Stream Helper n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Get Value Local Get the value of the specified element Get Oversampling Value Local Get the oversampling values of the specified element s Get Array Values Local Get the array values of the specified element Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.2 FB_ALY_Stream Helper Syntax Definition: FUNCTION_BLOCK FB_ALY_Stream Helper VAR_INPUT st Config : ST_ALY_Stream Helper_Config; END_VAR VAR_OUTPUT ip Result Message: I_Tc Message; b Error: BOOL; b New Result: BOOL; b Configured: BOOL; b Connected: BOOL; s Stream: STRING(255); n Num Iot Symbols Registered: UDINT; t Cycle Time: LTIME; n Num Elements: UDINT; END_VAR TF3510 Version: 1.5.0 419
## Page 420

PLC API Inputs Name Type Description st Config ST_ALY_Iot Symbol_Config Struct to configure the FB Outputs Name Type Description ip Result Message I_Tc Message Eventlogger b Error BOOL TRUE if an error has been occurred b New Result BOOL TRUE if a new result has been calculated b Configured BOOL TRUE if FB is configured successfully b Connected BOOL TRUE if Stream Helper connected to message broker s Stream STRING(255) Topic/Stream n Num Iot Symbols Re UDINT Amount of registered Io T symbols gistered t Cycle Time LTIME Cycle time of publishing system n Num Elements UDINT Number of elements received last call Methods Name Definition Location Description Call Local Configure Local Get Timestamp Element Local Add Iot Symbol Local Contains Iot Symbol Local Release All Iot Symbols Local Release Iot Symbol Local Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.3 Binary Stream 5.1.3.3.1 FB_ALY_Binary Stream_File Syntax Definition: FUNCTION_BLOCK FB_ALY_Stream Helper VAR_INPUT n Cycle Time: UDINT; st System ID: GUID; s Path: T_Max String; n Max File Size: UINT; END_VAR VAR_OUTPUT b Error: BOOL; ip Result Message: I_Tc Message; END_VAR 420 Version: 1.5.0 TF3510
## Page 421

PLC API Inputs Name Type Description n Cycle Time UDINT Logging cycle time st System ID GUID Twincat System ID s Path T_Max String Folder path to log in n Max File Size UINT Max file size Outputs Name Type Description b Error BOOL TRUE if an error has been occurred ip Result Message I_Tc Message Eventlogger Methods Name Definition Location Description Call [} 421] Local Method for background communication with the Twin CAT driver. The method must be called cyclically. Close [} 421] Local Close the opened tay file Create Description File Local Create *.tad file for stream desciption [} 422] Create Symbols File Local Create *.tas file for symbol description [} 422] Write Data [} 423] Local Write data to *.tay file Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.3.1.1 Call Syntax METHOD Call : BOOL Return value Name Type Description Call BOOL 5.1.3.3.1.2 Close Syntax METHOD Close : BOOL TF3510 Version: 1.5.0 421
## Page 422

PLC API Return value Name Type Description Close BOOL TRUE if done 5.1.3.3.1.3 Create Description File Syntax METHOD Create Description File : BOOL VAR_INPUT n Data Size: UDINT; s Layout: GUID; END_VAR Inputs Name Type Description n Data Size UDINT Size of one Sample s Layout GUID Layout Guid created by Create Symbolic Return value Name Type Description Create Descripti BOOL TRUE if done on File 5.1.3.3.1.4 Create Symbols File Syntax METHOD Create Symbols File : BOOL VAR_INPUT p Symbol: PVOID; n Symbol Size: UDINT; s Data Type: STRING; END_VAR VAR_OUTPUT s Layout: GUID; END_VAR Inputs Name Type Description p Symbol PVOID Pointer to ADS Symbol n Symbol Size UDINT Size of ADS Symbol s Data Type STRING Name of ADS Symbol Datatype Outputs Name Type Description s Layout GUID Layout hash of symbol description 422 Version: 1.5.0 TF3510
## Page 423

PLC API Return value Name Type Description Create Symbols BOOL TRUE if done File 5.1.3.3.1.5 Write Data Syntax METHOD Write Data : BOOL VAR_INPUT p Data: PVOID; n Data Size: UDINT; n Data Count: INT; s Layout: GUID; END_VAR Inputs Name Type Description p Data PVOID Pointer to sample array n Data Size UDINT Size of sample array n Data Count INT Count of sample array elements s Layout GUID Symbolic layout Return value Name Type Description Write Data BOOL TRUE if done 5.1.3.3.2 FB_ALY_Binary Stream_Mqtt Syntax Definition: FUNCTION_BLOCK FB_ALY_Binary Stream_Mqtt VAR_INPUT n Cycle Time: UDINT; st System ID: GUID; s Stream Topic: T_Max String; st Mqtt Conn Settings: ST_Mqtt Connection Settings; END_VAR VAR_OUTPUT b Error: BOOL; ip Result Message: I_Tc Message; e Connection State: ETc Iot Mqtt Client State; END_VAR Inputs Name Type Description n Cycle Time UDINT Logging cycle time st System ID GUID Twincat System ID s Stream Topic T_Max String Topic to stream to st Mqtt Conn Settings ST_Mqtt Connection Settings Settings for the mqtt connection to the message broker TF3510 Version: 1.5.0 423
## Page 424

PLC API Outputs Name Type Description b Error BOOL TRUE if an error has been occurred ip Result Message I_Tc Message Eventlogger e Connection State ETc Iot Mqtt Client State Indicates the state of the connection between client and broker as enumeration ETc Iot Mqtt Client State. Methods Name Definition Location Description Call [} 424] Local Method for background communication with the Twin CAT driver. The method must be called cyclically. Close Stream [} 424] Local Close the analytics binary stream Create Description Local Create binary stream description [} 425] Create Symbolic [} 425] Local Create binary stream symbolic Send Data [} 426] Local Send binary stream data Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 5.1.3.3.2.1 Call Syntax METHOD Call : BOOL Return value Name Type Description Call BOOL 5.1.3.3.2.2 Close Stream Syntax METHOD Close Stream : BOOL Return value Name Type Description Close Stream BOOL TRUE if done 424 Version: 1.5.0 TF3510
## Page 425

PLC API 5.1.3.3.2.3 Create Description Syntax METHOD Create Description : BOOL VAR_INPUT n Data Size: UDINT; s Layout: GUID; END_VAR Inputs Name Type Description n Data Size UDINT Size of one Sample s Layout GUID Layout Guid created by Create Symbolic Return value Name Type Description Create Descripti BOOL TRUE if done on 5.1.3.3.2.4 Create Symbolic Syntax METHOD Create Symbolic : BOOL VAR_INPUT p Symbol: PVOID; n Symbol Size: UDINT; s Data Type: STRING; END_VAR VAR_OUTPUT s Layout: GUID; END_VAR Inputs Name Type Description p Symbol PVOID Pointer to ADS Symbol n Symbol Size UDINT Size of ADS Symbol s Data Type STRING Name of ADS Symbol Datatype Outputs Name Type Description s Layout GUID Layout hash of symbol description Return value Name Type Description Create Symbolic BOOL TRUE if done TF3510 Version: 1.5.0 425
## Page 426

PLC API 5.1.3.3.2.5 Send Data Syntax METHOD Send Data : BOOL VAR_INPUT p Data: PVOID; n Data Size: UDINT; n Data Count: INT; s Layout: GUID; END_VAR Inputs Name Type Description p Data PVOID Pointer to sample array n Data Size UDINT Size of sample array n Data Count INT Count of sample array elements s Layout GUID Symbolic layout Return value Name Type Description Send Data BOOL TRUE if done 5.2 Functions 5.2.1 F_Raw Timespan_TO_Structured Function to convert an raw timespan input to an output of type ST_ALY_Timespan [} 434]. Inputs Name Type Description t Timespan LINT Timespan to be converted. Return value Name Type Description F_Raw Timespan_T ST_ALY_Timespan [} 434] Returns structured timespan. O_Structured 5.2.2 F_Structured Timespan_TO_Raw Function to convert an input of type ST_ALY_Timespan [} 434] to a raw timespan. Inputs Name Type Description st Timespan ST_ALY_Timespan [} 434] Structured timespan to be converted. 426 Version: 1.5.0 TF3510
## Page 427

PLC API Return value Name Type Description F_Structured Timesp LINT Returns raw timespan. an_TO_Raw 5.3 Data types 5.3.1 General 5.3.1.1 ST_ALY_Threshold TYPE ST_ALY_Threshold : STRUCT e Comparison Operator : E_ALY_Comparison Operator; f Threshold : LREAL; END_STRUCT END_TYPE 5.3.1.2 ST_ALY_Threshold On Off TYPE ST_ALY_Threshold On Off : STRUCT On : ST_ALY_Threshold; Off : ST_ALY_Threshold; END_STRUCT END_TYPE 5.3.1.3 ST_ALY_Xy Position TYPE ST_ALY_Xy Position : STRUCT X : LREAL; Y : LREAL; END_STRUCT END_TYPE 5.3.1.4 ST_ALY_Live Min Max Avg TYPE ST_ALY_Live Min Max Avg : STRUCT f Live : LREAL; f Min : LREAL; f Max : LREAL; f Avg : LREAL; END_STRUCT END_TYPE 5.3.1.5 E_ALY_Classification_2Cls {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Classification_2Cls : ( Not Initialized := 0, OK : =1, NOK := 2 ) := Not Initialized; END_TYPE TF3510 Version: 1.5.0 427
## Page 428

PLC API 5.3.1.6 E_ALY_Classification_3Cls {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Classification_3Cls : ( Not Initialized := 0, OK := 1, Warning := 2, Alarm := 3 ) := Not Initialized; END_TYPE 5.3.1.7 E_ALY_Classification_Bounds {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Classification_Bounds : ( Not Initialized := 0, Within Bounds := 1, Smaller := 2, Bigger := 3 ) := Not Initialized; END_TYPE 5.3.2 Config 5.3.2.1 ST_ALY_Iot Symbol String_Config TYPE ST_ALY_Iot Symbol String_Config : STRUCT s Symbol Name : STRING(255) := ''; // Symbol name (e.g. MAIN.b On) n String Size : UDINT := SIZEOF(STRING); // String lenth plus null termination n Oversampling Factor : UDINT := 1; // Oversampling factor n Array Elements : UDINT := 1; // Number of array elements END_STRUCT END_TYPE 5.3.2.2 ST_ALY_Iot Symbol_Config TYPE ST_ALY_Iot Symbol_Config : STRUCT s Symbol Name : STRING(255) := ''; // Symbol name (e.g. MAIN.b On) n Oversampling Factor : UDINT := 1; // Oversampling factor n Array Elements : UDINT := 1; // Number of array elements END_STRUCT END_TYPE 5.3.2.3 ST_ALY_Stream Helper_Config TYPE ST_ALY_Stream Helper_Config : STRUCT n Object ID : OTCID := 0; // Object ID of referenced Stream Helper n Num Input Buffer : UDINT := 20; // Number of input buffer to be reserved for every symbol END_STRUCT END_TYPE 5.3.2.4 E_ALY_Band Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Band Mode : ( Not Initialized := 0, Absolute := 1, Relative := 2, 428 Version: 1.5.0 TF3510
## Page 429

PLC API ) := Not Initialized; END_TYPE 5.3.2.5 E_ALY_Cascade Startup Behaviour {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Cascade Startup Behaviour : ( Not Initialized := 0, Wait Until Filled := 1, Use Previous Cascade Value := 2, ) := Not Initialized; END_TYPE 5.3.2.6 E_ALY_Comparison Operator {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Comparison Operator : ( Not Initialized := 0, Greater Than := 1, Greater Than Or Equal To := 2, Less Than := 3, Less Than Or Equal To := 4, Equals := 5, Not Equal To := 6 ) := Not Initialized; END_TYPE 5.3.2.7 E_ALY_Count Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Count Mode : ( Not Initialized := 0, Cyclic := 1, On Change := 2, ) := Not Initialized; END_TYPE 5.3.2.8 E_ALY_Day Of Week Mask {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Day Of Week Mask : ( None := 0, Sunday := 1, Monday := 2, Tuesday := 4, Wednesday := 8, Thursday := 16, Friday := 32, Saturday := 64, Every Day := 127, Monday To Friday := 62, Weekend := 65 ) := Not Initialized; END_TYPE 5.3.2.9 E_ALY_Integration Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Integration Mode : ( Not Initialized := 0, TF3510 Version: 1.5.0 429
## Page 430

PLC API Direct := 1, Absolute := 2, ) := Not Initialized; END_TYPE 5.3.2.10 E_ALY_Logic Operator {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Logic Operator : ( Not Initialized := 0, AND_ := 1, OR_ := 2, NAND_ := 3, NOR_ := 4, XOR_ := 5 ) := Not Initialized; END_TYPE 5.3.2.11 E_ALY_Math Operator {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Math Operator : ( Not Initialized := 0, Addition := 1, Subtraction := 2, Multiplication := 3, Division := 4, Power Of := 5, Modulo := 6, ) := Not Initialized; END_TYPE 5.3.2.12 E_ALY_Moving Avg Startup Behaviour {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Moving Avg Startup Behaviour : ( Not Initialized := 0, (* Not initialized *) Zero Padding := , (* All buffers are initialized with zero. *) Use First Value := 2, (* Use first occuring value to initialize buffers. *) Wait Until Filled := 3,(* Wait with calculation until filled. *) Avg Over Existing := 4 (* Average over existing elements. *) ) := Not Initialized; END_TYPE 5.3.2.13 E_ALY_Read State {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Read State : ( Idle := 0, Read := 1, Pending := 2, Pending Read := 3, Pending Idle := 4 ) := Idle; END_TYPE 5.3.2.14 E_ALY_State Hist Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_State Hist Mode : ( 430 Version: 1.5.0 TF3510
## Page 431

PLC API Not Initialized := 0, Absolute := 1, Relative := 2 ) := Not Initialized ; END_TYPE 5.3.2.15 E_ALY_String Compare Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_String Compare Mode : ( Not Initialized := 0, Equals := 1, Begins With := 2, Contains := 3 ) := Not Initialized; END_TYPE 5.3.2.16 E_ALY_Teach Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Teach Mode : ( Not Initialized := 0, Minimum := 1, Maximum := 2, Mean := 3, ) := Not Initialized; END_TYPE 5.3.2.17 E_ALY_Teach State {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Teach State : ( Idle := 0, Teach := 1, Pending := 2, Pending Teach := 3, Pending Idle := 4 ) := Idle; END_TYPE 5.3.2.18 E_ALY_Timer Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Timer Mode : ( Not Initialized := 0, (* Not initialized *) TON := 1, (* Switch-on delay *) TOF := 2, (* Switch-off delay *) TP := 3 (* Pulse *) ) := Not Initialized; END_TYPE 5.3.2.19 E_ALY_Gate Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Logic Operator : ( Not Initialized:=0, Intersect Gate:=1, Not Intersect Gate:=2, Intersect Projection:=3, Not Intersect Projection:=4, TF3510 Version: 1.5.0 431
## Page 432

PLC API Intersect Gate Or Projection:=5 ) := Not Initialized; END_TYPE 5.3.2.20 E_ALY_Correlation Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Correlation Mode : ( Not Initialized := 0, Base := 1, Normed := 2, Covariance := 3, Covariance Besel :=4, Pearson :=5 ) := Not Initialized; END_TYPE 5.3.2.21 E_ALY_Window Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Window Mode : ( Not Initialized := 0, Sliding Window := 1, Fix Window := 2, Continuous := 3 ) := Not Initialized; END_TYPE 5.3.2.22 E_ALY_KMeans Init Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_KMeans Init Mode : ( Not Initialized := 0, Random := 1, Equidistant := 2, Values := 3, ) := Not Initialized; END_TYPE 5.3.2.23 E_ALY_Function Type {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Function Type : ( Not Initialized := 0, Constt := 1, Sine := 2, Triangle := 3, Rectangle := 4, Sawtooth := 5, ) := Not Initialized; END_TYPE 5.3.2.24 E_ALY_Config State {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Config State : ( Not Configured := 0, Pending := 1, Configured := 2, 432 Version: 1.5.0 TF3510
## Page 433

PLC API ) := Not Configured ; END_TYPE 5.3.2.25 E_ALY_Hist Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Hist Mode : ( Not Initialized := 0, Absolute := 1, Relative := 2 ) := Not Initialized ; END_TYPE 5.3.2.26 E_ALY_Scaling Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Scaling Mode : ( Not Initialized := 0, Normalization := 1, Standardization := 2 ) := Not Initialized; END_TYPE 5.3.2.27 E_ALY_Pareto Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Pareto Mode : ( Not Initialized := 0, Count := 1 ) := Not Initialized; END_TYPE 5.3.2.28 E_ALY_Timespan Operator {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Timespan Operator : ( Not Initialized := 0, Addition := 1, Subtraction := 2 ) := Not Initialized; END_TYPE 5.3.2.29 E_ALY_Month Of Year Mask {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Month Of Year Mask: ( None := 0, January:=1, February:=2, March:=4, April:=8, May:=16, June:=32, July:=64, August:=128, September:=256, October:=512, November:=1024, December:=2048, Every Month:=4095 TF3510 Version: 1.5.0 433
## Page 434

PLC API ) := Not Initialized; END_TYPE 5.3.2.30 E_ALY_Day Of Week {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Day Of Week : ( Sunday := 0, Monday := 1, Tuesday := 2, Wednesday := 3, Thursday := 4, Friday := 5, Saturday := 6, Unspecified := 7 ) := Unspecified ; END_TYPE 5.3.2.31 E_ALY_Recurrence Specification {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Recurrence Specification : ( Not Initialized := 0, First := 1, Last := 2, Specific Day := 3 ) := Not Initialized; END_TYPE 5.3.2.32 E_ALY_Recurrence Mode {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Recurrence Mode : ( Not Initialized := 0, Daily := 1, Weekly := 2, Monthly := 3, Yearly := 4 ) := Not Initialized; END_TYPE 5.3.3 Time 5.3.3.1 ST_ALY_Timespan TYPE ST_ALY_Timespan : STRUCT b Is Negative : BOOL; w Days : WORD; w Hours : WORD; w Minutes : WORD; w Seconds : WORD; w Milliseconds : WORD; w Microseconds : WORD; w Nanoseconds : WORD; END_STRUCT END_TYPE 5.3.3.2 E_ALY_Timestamp Accuracy {attribute 'qualified_only'} {attribute 'strict'} TYPE E_ALY_Timestamp Accuracy : 434 Version: 1.5.0 TF3510
## Page 435

PLC API ( Day, Hour, Minute, Second, Millisecond, Microsecond, Nanosecond ); END_TYPE TF3510 Version: 1.5.0 435
## Page 436

Samples 6 Samples 6.1 Combination of algorithms with local inputs The sample shows how to include and combine analytics algorithms. Algorithms of Type FB_ALY_Edge Counter_1Ch [} 31], FB_ALY_Math Operation_1Ch [} 245] and FB_ALY_Min Max Avg_1Ch [} 71] are used. The sample is available for download from here: https://infosys.beckhoff.com/content/1033/tf3500_tc3_analytics_library/Resources/6917579531.zip Requirements Development environment Target platform Plc libraries to include Twin CAT v3.1.4024.0 PC or CX (x64, x86) Tc3_Analytics 436 Version: 1.5.0 TF3510
## Page 437

Appendix 7 Appendix 7.1 Return codes See the following list with return codes of the Twin CAT Analytics library. TF3510 Version: 1.5.0 437
## Page 438

Appendix Event ID (Hex) Event text 16#1001 Error during initialization. No router memory available. Check size of router memory. 16#1002 Error in Transition PREOP->SAFEOP 16#1003 Error in Transition SAFEOP->OP 16#1004 Error in Transition SAFEOP->OP: No Task assigned. Module will not be executed cyclically. 16#1005 Error in Transition OP->SAFEOP 16#1006 Error in Transition SAFEOP->PREOP 16#1007 Error during initialization. Invalid object ID. 16#1008 Error during initialization. Invalid symbol name. 16#1009 Error during initialization. Invalid symbol size. 16#100A Error during initialization. Invalid number of buffers. 16#100B Error during initialization. Invalid data area number. 16#100C Error during initialization. Invalid number of channels. 16#2001 Error during configuration. No router memory available. Check size of router memory. 16#2002 Error during configuration. A null pointer has been allocated. 16#2003 The configured Data Type is not valid. 16#2004 The configured count mode is not valid. 16#2005 The configured integration mode is not valid. 16#2006 The configured state histogram mode is not valid. 16#2007 The configured comparison operator is not valid. 16#2008 The configured teach mode is not valid 16#2009 The configured logic operator is not valid. 16#200A The configured mathematical operator is not valid. 16#200B The configured startup behavior is not valid. 16#200C The configured bounds are not valid. 16#200D The amount of configured values is not valid. 16#200E The configured sample rate is not valid. 16#200F The configured interval is not valid. 16#2010 The configured interval is too short. 16#2011 The amount of configured subsets is not valid. 16#2012 The amount of configured bins is not valid. 16#2013 The configured file path is not valid. 16#2014 The configured segment size is not valid. 16#2015 The configured timeout is not valid. 16#2016 The configured band mode is not valid. 16#2017 The configured length is not valid 16#2018 The configured timer mode is not valid. 16#2019 The configured days of week are not valid. 16#201A The configured threshold is not valid. 16#201B The configured string compare mode is not valid. 16#201C The configured gate mode is not valid. 16#201D Error during configuration. Invalid symbol name. 16#201E Error during configuration. Invalid symbol size. 16#201F Error during configuration. Invalid number of buffers. 16#2020 Error during configuration. Invalid number of bands. 16#2021 Error during configuration. Illegal threshold order. 438 Version: 1.5.0 TF3510
## Page 439

Appendix Event ID (Hex) Event text 16#2022 Error during configuration. Missing initialization. 16#3001 Error during runtime. No router memory available. Check size of router memory. 16#3002 Error during runtime. A null pointer has been allocated. 16#3003 Error during runtime. Invalid input size. 16#3004 Error during runtime. Invalid output size. 16#3005 Error during runtime. Division by zero. 16#3006 Error during runtime. Timestamp cannot be null. 16#3007 Error during runtime. Missing configuration. 16#3008 Error during runtime. Invalid state. 16#3009 Error during runtime. Cyclic caller is assigned. Methods can not be called. 16#300A Error during runtime. Out of range. 16#300B Error during runtime. Invalid header size. 16#300C Error during runtime. Invalid file. 16#300D Error during runtime. Invalid interval. 16#300E Error during runtime. Symbol already assigned. 16#300F Error during runtime. No stream helper assigned. 16#3010 Error during runtime. Invalid input channel. 16#3011 Error during runtime. Invalid data type. 16#3012 Error during runtime. Invalid unit. 7.2 FAQ - frequently asked questions and answers In this section frequently asked questions are answered in order to make your work with Twin CAT Analytics library easier. If you have further questions, please contact our support team support@beckhoff.com. Can I use the Analytics library independent from the Twin CAT Analytics workflow? [} 439] Is it possible to use TE3500 Analytics Workbench with automatic code generation, if I like to use the Analytics library in my local application? [} 439] ? Can I use the Analytics library independent from the Twin CAT Analytics workflow? ! Yes, for sure. You can use the library as a standard PLC library for your local machine application without any MQTT communication and other Analytics products. ? Is it possible to use TE3500 Analytics Workbench with automatic code generation, if I like to use the Analytics library in my local application? ! Yes, you can choose in TE3500 Analytics Workbench configurator the option “Add to existing Solution” in the Deploy Analytics Runtime dialog. This adds the Analytics part to your local application code by taking the right Solution in the path control. Also it is possible to add variables into the configurator from an ADS route. In the code generation is then a place holder where you have to do the mapping by hand. TF3510 Version: 1.5.0 439
## Page 440

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Arm, Arm9 and Cortex are trademarks or registered trademarks of Arm Limited (or its subsidiaries or affiliates) in the US and/or elsewhere. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 441

More Information: www.beckhoff.com/tf3510 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
