---
title: "TF8010 Twin CAT 3"
product: "TF8010"
category: "Building_Automation"
tags: ["CAT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.2.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF8010_TC3_BABasic_EN.pdf"
release_date: "2025-02-03"
---
Manual | EN TF8010 Twin CAT 3 | Building Automation Basic 2025-02-03 | Version: 1.2.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Integration in Twin CAT............................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation......................................................................................................................................... 9 3.3 Licensing......................................................................................................................................... 12 4 Programming........................................................................................................................................... 15 4.1 POUs............................................................................................................................................... 15 4.1.1 Conversion functions........................................................................................................ 15 4.1.2 Energy management........................................................................................................ 16 4.1.3 Facade............................................................................................................................. 20 4.1.4 Filter functions.................................................................................................................. 28 4.1.5 Lighting............................................................................................................................. 33 4.1.6 Scene management......................................................................................................... 58 4.1.7 Signal processing............................................................................................................. 68 4.1.8 Timer functions................................................................................................................. 72 4.1.9 Error Codes...................................................................................................................... 92 4.2 DUTs............................................................................................................................................... 93 4.2.1 Enumerations................................................................................................................... 93 4.2.2 Structures......................................................................................................................... 93 4.3 GVLs............................................................................................................................................... 95 4.3.1 Constants......................................................................................................................... 95 5 Appendix.................................................................................................................................................. 96 5.1 Support and Service........................................................................................................................ 96 TF8010 Version: 1.2.0 3
## Page 4

Table of contents 4 Version: 1.2.0 TF8010
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. It is absolutely necessary to comply with the documentation and the following notes and explanations when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS®, and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Patents The Ether CAT Technology is covered by the following patent applications and patents, without this constituting an exhaustive list: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 and similar applications and registrations in several other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party brands Third-party trademarks and wordmarks are used in this documentation. The trademark endorsements can be found at: https://www.beckhoff.com/trademarks TF8010 Version: 1.2.0 5
## Page 6

Foreword 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.2.0 TF8010
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF8010 Version: 1.2.0 7
## Page 8

Overview 2 Overview This library is used for the maintenance and servicing of existing projects! For new projects, please use the components of TF8040 Twin CAT Building Automation. The library offers users basic functions for room automation and building control. The user of this library requires basic knowledge of the following: • Twin CAT XAE • design and characteristics of Beckhoff IPCs and their bus terminal system • relevant safety regulations for technical building equipment This software library is intended for building automation system partners of Beckhoff Automation Gmb H & Co. KG. The system partners operate in the field of building automation and are concerned with the installation, commissioning, expansion, maintenance and servicing of measurement, control, and regulating systems for the technical equipment of buildings. The Tc3 Building Automation Basic library can be used on all hardware platforms that support Twin CAT 3.1 or higher. 8 Version: 1.2.0 TF8010
## Page 9

Integration in Twin CAT 3 Integration in Twin CAT 3.1 System requirements Technical data Requirement Operating system Windows 7/10, Windows Embedded Standard 7, Windows CE 7 Target platform PC architecture (x86, x64 or ARM) Twin CAT version Twin CAT 3.1 build 4020.32 or higher Required Twin CAT setup level Twin CAT 3 XAE, XAR Required Twin CAT license TF8010_TC3 Building Automation Basic 3.2 Installation The following section describes how to install the Twin CAT 3 Function for Windows-based operating systems. ü The Twin CAT 3 Function setup file was downloaded from the Beckhoff website. 1. Run the setup file as administrator. To do this, select the command Run as administrator in the context menu of the file. ð The installation dialog opens. 2. Accept the end user licensing agreement and click Next. TF8010 Version: 1.2.0 9
## Page 10

Integration in Twin CAT 3. Enter your user data. 4. If you want to install the full version of the Twin CAT 3 Function, select Complete as installation type. If you want to install the Twin CAT 3 Function components separately, select Custom. 10 Version: 1.2.0 TF8010
## Page 11

Integration in Twin CAT 5. Select Next, then Install to start the installation. ð A dialog box informs you that the Twin CAT system must be stopped to proceed with the installation. 6. Confirm the dialog with Yes. TF8010 Version: 1.2.0 11
## Page 12

Integration in Twin CAT 7. Select Finish to exit the setup. ð The Twin CAT 3 Function has been successfully installed. 3.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 12 Version: 1.2.0 TF8010
## Page 13

Integration in Twin CAT 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. TF8010 Version: 1.2.0 13
## Page 14

Integration in Twin CAT 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. 14 Version: 1.2.0 TF8010
## Page 15

Programming 4 Programming The Twin CAT PLC Building Automation library contains useful function blocks for building automation. 4.1 POUs 4.1.1 Conversion functions 4.1.1.1 F_Scale A raw analog value is scaled to the specified measuring range and returned as the function value. If the raw value extends beyond the upper or lower measuring range, the corresponding limit value is output. There must be a difference of at least 0.01 between the upper and lower limit values for the raw data. If this is not the case, the lower limit value is output. FUNCTION F_Scale: LREAL VAR_INPUT f Raw Data : LREAL; f Raw Data Lower Off Limit : LREAL; f Raw Data Upper Off Limit : LREAL; f Scale Data Lower Off Limit : LREAL; f Scale Data Upper Off Limit : LREAL; f Raw Data: raw value. f Raw Data Lower Off Limit: Lower limit for raw value. f Raw Data Upper Off Limit: Upper limit for raw value. f Scale Data Lower Off Limit: Lower limit of scaled measured value. f Scale Data Upper Off Limit: Upper limit of scaled measured value. TF8010 Version: 1.2.0 15
## Page 16

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.1.2 Temperature conversion functions between Kelvin, Celsius, Reaumur and Fahrenheit. F_TO_C K_TO_F C_TO_F R_TO_K F_TO_K K_TO_C C_TO_K R_TO_C F_TO_R K_TO_R C_TO_R R_TO_F Overview Kelvin (K) Degrees Celsius Reaumur (°R) Fahrenheit (°F) (°C) Absolute zero 0 -273.15 -218.52 -459.67 Melting point 273.15 0 0 32 Boiling point 373.15 100 80 212 (The melting and boiling points refer to pure water.) Conversion rules Kelvin (K) Degrees Celsius Reaumur (°R) Fahrenheit (°F) (°C) x = Kelvin (K) - x = degrees - Celsius (°C) x = Reaumur (°R) - x = Fahrenheit (°F) - 4.1.2 Energy management 4.1.2.1 FB_Maximum Demand Controller 16 Version: 1.2.0 TF8010
## Page 17

Programming Function block for peak load optimization, which ensures that the set power limit is maintained by switching up to eight consumers on or off. The consumers can be switched off according to their power and priority in such a manner that the production process is not disturbed. In order to distinguish the individual measurement cycles, a synchronization pulse is supplied by the electricity supply company. It indicates the start of a new measuring cycle and must be linked to the input b Period Pulse. The actual power is recorded via the KL1501 counter terminal. The function block works with a fixed measuring period of 15 minutes. If the synchronization pulse exceeds the 16 minute limit, the output b Emergency Signal is set. All consumers are switched on at the start of each measuring period. In the event that the power limit (f Agreed Power) threatens to be exceeded within the measuring period, the consumers are switched off one after the other. If the danger of an excess load no longer exists, the consumers are switched on again. Special items, such as minimum power-on time, minimum power-off time or maximum power-off time can be specified via an input variable. The priority of the individual consumers can similarly be determined. Consumers with a low priority will be switched off before consumers with a high priority. VAR_INPUT b Start : BOOL; f Meter Constant : LREAL; f Agreed Power : LREAL; b Period Pulse : BOOL; arr Load Parameter : ARRAY[1..8] OF ST_MDCLoad Parameters; b Start: The function block is activated by a positive edge at this input. f Meter Constant: Meter constant [pulses / k Wh]. f Agreed Power: This is the agreed power limit which, as far as possible, should not be exceeded in the operational case [k W]. TF8010 Version: 1.2.0 17
## Page 18

Programming b Period Pulse: Synchronization pulse sent by the electricity supply company (ESC). This pulse starts the measurement interval. arr Load Parameter: Parameter structure of the respective consumer (see ST_MDCLoad Parameters [} 94]). VAR_OUTPUT arr Load : ARRAY[1..8] OF BOOL; f Agreed Energy : LREAL; f Instantaneous Energy : LREAL; f Actual Energy : LREAL; t Remaining Time : TIME; f Last Period Energy : LREAL; b Emergency Signal : BOOL; b Error : BOOL; n Error Id : UDINT; arr Load: This is an array of data type BOOL; consumers that are switched on are TRUE. f Agreed Energy: Agreed energy consumption [k Wh]. f Instantaneous Energy: Current energy consumption [k Wh] over an integration period of 15s (internal measuring interval). f Actual Energy: Energy consumed at the "presently" observed point in time of the measuring period. t Remaining Time: Time remaining until the next measurement interval. f Last Period Energy: Rated power from the preceding measuring period [k Wh]. b Emergency Signal: This output is set as soon as the specified energy is exceeded. b Error: This output is switched to TRUE as soon as an error occurs during the execution of a command. n Error Id: Contains the error code [} 92]. VAR_IN_OUT st In Data KL1501 : ST_MDCIn Data KL1501; st Out Data KL1501 : ST_MDCOut Data KL1501; st In Data KL1501: Linked to KL1501 (see ST_MDCIn Data KL1501 [} 93]). st Out Data KL1501: Linked to KL1501 (see ST_MDCOut Data KL1502 [} 94]). Example VAR_GLOBAL arr Load Parameters AT %MB100 : ARRAY[1..8] OF ST_MDCLoad Parameters; (* KL1002 *) b Period Pulse AT %IX6.0 : BOOL; (* KL1501*) st In Data KL1501 AT %IB0 : ST_MDCIn Data KL1501; st Out Data KL1501 AT %QB0 : ST_MDCOut Data KL1501; (* KL2404 *) b Load Out1 AT %QX6.0 : BOOL; b Load Out2 AT %QX6.1 : BOOL; b Load Out3 AT %QX6.2 : BOOL; b Load Out4 AT %QX6.3 : BOOL; (* KL2404 *) b Load Out5 AT %QX6.4 : BOOL; b Load Out6 AT %QX6.5 : BOOL; b Load Out7 AT %QX6.6 : BOOL; b Emergency Signal AT %QX6.7 : BOOL; END_VAR PROGRAM MAIN VAR fb Maximum Demand Controller : FB_Maximum Demand Controller; END_VAR 18 Version: 1.2.0 TF8010
## Page 19

Programming arr Load Parameters[1].b Connected := TRUE; arr Load Parameters[1].n Degree Of Priority := 1; arr Load Parameters[1].t MINPower On Time := t#60s; arr Load Parameters[1].t MINPower Off Time := t#120s; arr Load Parameters[1].t MAXPower Off Time := t#600s; arr Load Parameters[2].b Connected := TRUE; arr Load Parameters[2].n Degree Of Priority := 2; arr Load Parameters[2].t MINPower On Time := t#60s; arr Load Parameters[2].t MINPower Off Time := t#120s; arr Load Parameters[2].t MAXPower Off Time := t#600s; arr Load Parameters[3].b Connected := TRUE; arr Load Parameters[3].n Degree Of Priority := 3; arr Load Parameters[3].t MINPower On Time := t#60s; arr Load Parameters[3].t MINPower Off Time := t#120s; arr Load Parameters[3].t MAXPower Off Time := t#300s; arr Load Parameters[4].b Connected := TRUE; arr Load Parameters[4].n Degree Of Priority := 4; arr Load Parameters[4].t MINPower On Time := t#20s; arr Load Parameters[4].t MINPower Off Time := t#30s; arr Load Parameters[4].t MAXPower Off Time := t#8m; arr Load Parameters[5].b Connected := TRUE; arr Load Parameters[5].n Degree Of Priority := 5; arr Load Parameters[5].t MINPower On Time := t#20s; arr Load Parameters[5].t MINPower Off Time := t#50s; arr Load Parameters[5].t MAXPower Off Time := t#20m; arr Load Parameters[6].b Connected := TRUE; arr Load Parameters[6].n Degree Of Priority := 6; arr Load Parameters[6].t MINPower On Time := t#30s; arr Load Parameters[6].t MINPower Off Time := t#1m; arr Load Parameters[6].t MAXPower Off Time := t#1m; arr Load Parameters[7].b Connected := TRUE; arr Load Parameters[7].n Degree Of Priority := 7; arr Load Parameters[7].t MINPower On Time := t#0s; arr Load Parameters[7].t MINPower Off Time := t#0s; arr Load Parameters[7].t MAXPower Off Time := t#1m; arr Load Parameters[8].b Connected := FALSE; fb Maximum Demand Controller(b Start := TRUE, f Meter Constant := 20000, f Agreed Power := 600, b Period Pulse := b Period Pulse, arr Load Parameters := arr Load Parameters, st In Data KL1501 := st In Data KL1501, st Out Data KL1501 := st Out Data KL1501); b Load Out1 := fb Maximum Demand Controller.arr Load[1]; b Load Out2 := fb Maximum Demand Controller.arr Load[2]; b Load Out3 := fb Maximum Demand Controller.arr Load[3]; b Load Out4 := fb Maximum Demand Controller.arr Load[4]; b Load Out5 := fb Maximum Demand Controller.arr Load[5]; b Load Out6 := fb Maximum Demand Controller.arr Load[6]; b Load Out7 := fb Maximum Demand Controller.arr Load[7]; b Emergency Signal := fb Maximum Demand Controller.b Emergency Signal; Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 TF8010 Version: 1.2.0 19
## Page 20

Programming 4.1.3 Facade 4.1.3.1 FB_Roof Window The outputs b Window Open or b Window Close are set through a positive edge at the inputs b Open or b Close. These remain asserted until the time t Turn Off Time has elapsed, or until the function block receives some other command. Both outputs are immediately reset by a positive edge at the b Stop input. The t Switch Over Dead Time can be used to prevent damage to the drive motor caused by immediate changes in direction. In most cases, this value is between 0.5 s and 1.0 s. The drive manufacturer can give you a precise value. Safety position Moving to the safety position (e.g. in strong wind) can be achieved by setting the input b Safety Position. The output b Window Close is set for the time t Turn Off Time, and the output b Window Open is reset. Window operation is disabled as long as the b Safety Position input is active. VAR_INPUT b Close : BOOL; b Open : BOOL; b Stop : BOOL; b Safety Position : BOOL; b Limit Switch Close : BOOL; b Limit Switch Open : BOOL; t Turn Off Time : TIME := t#60s; t Switch Over Dead Time : TIME := t#400ms; b Close: Set output b Window Close and reset output b Window Open. The output b Window Close remains latched. b Open: Set output b Window Open and reset output b Window Close. The output b Window Open remains latched. b Stop: Reset outputs b Window Close and b Window Open b Safety Position: The safety position is approached. The window is closed for the time t Turn Off Time. Window operation is blocked as long as the input is active. b Limit Switch Close: Optional limit switch. If b Close is set and is not set within t Turn Off Timeb Limit Switch Close, b Error Limit Switch Close is set. b Limit Switch Open: Optional limit switch. If b Open is set and is not set within t Turn Off Timeb Limit Switch Open, b Error Limit Switch Open is set. t Turn Off Time: If no input is activated, then the outputs are reset after this period of time. The outputs are not automatically reset if the specified duration is 0. The value given here should be about 10% larger than the travel time that is actually measured. t Switch Over Dead Time: Dwell time at a change of direction. Both outputs are reset during this period. 20 Version: 1.2.0 TF8010
## Page 21

Programming VAR_OUTPUT b Window Open : BOOL; b Window Close : BOOL; b Error Limit Switch Close : BOOL; b Error Limit Switch Open : BOOL; b Window Open: The window opens. b Window Close: The window closes. b Error Limit Switch Close: Error relating to the optional limit switch during closing. b Error Limit Switch Open: Error relating to the optional limit switch during opening. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.3.2 FB_Venetian Blind There are three different ways in which the blinds may be controlled: • A positive edge at the b Up or b Down inputs set the b Blind Up or b Blind Down outputs respectively. These remain asserted until the time t Turn Off Time has elapsed, or until the function block receives some other command. Both outputs are immediately reset by a positive edge at the b Stop input. • Static signals are provided to the b Switch Over Up or b Switch Over Down inputs (e.g. by buttons). These set the b Blind Up and b Blind Down outputs. If this signal is asserted for longer than t Switch Over Time, the outputs are latched. This means that the outputs will continue to be asserted, even if the signals at the inputs are removed again. In most cases, a value of 500 ms is sufficient for the t Switch Over Time parameter. However, the output only remains asserted for the time t Turn Off Time, or until a new command is given to the function block. • This last variation can be useful if the user wants to alter the setting of the blind step by step. Each positive edge at the b Step Up or b Step Down inputs sets the corresponding output for the time t Step Time. A value of 200 ms has been found effective for t Step Time. The t Switch Over Dead Time can be used to prevent damage to the drive motor caused by immediate changes in direction. In most cases, this value is between 0.5 s and 1.0 s. The drive manufacturer can give you a precise value. TF8010 Version: 1.2.0 21
## Page 22

Programming Safety position Travel to the safety position (e.g. because there is a strong wind or because maintenance is being carried out at the window) can be achieved by setting the b Safety Position input. The output b Blind Up is set and the output b Blind Down reset for the period specified by t Turn Off Time. Operation of the blinds is prevented for as long as the b Safety Position input is active. Shading position Under conditions of above-average sunshine, the blinds can be moved to the shading position. After presenting a positive edge to the b Shadow Position input, the blinds are lowered for the period of time specified by t Shadow Turn Off Time. The blind is then moved upwards again for the period of time specified by t Shadow Turn Around Time. A time of about 2 seconds is usually set for this. This prevents the room from being completely darkened. During a change of direction, a pause of duration t Switch Over Dead Time is maintained. Travel to the shading position can be interrupted at any time by a new command. VAR_INPUT b Up : BOOL; b Down : BOOL; b Stop : BOOL; b Switch Over Up : BOOL; b Switch Over Down : BOOL; t Switch Over Time : TIME := t#500ms; b Step Up : BOOL; b Step Down : BOOL; t Step Time : TIME := t#200ms; b Shadow Position : BOOL; t Shadow Turn Around Time : TIME := t#0s; t Shadow Turn Off Time : TIME := t#20s; b Safety Position : BOOL; t Turn Off Time : TIME := t#60s; t Switch Over Dead Time : TIME := t#400ms; b Up: Set the b Blind Up output and reset the b Blind Down output. The b Blind Up output remains latched. b Down: Set the b Blind Down output and reset the b Blind Up output. The b Blind Down output remains latched. b Stop: Reset the b Blind Up and b Blind Down outputs. b Switch Over Up: Set the b Blind Up output and reset the b Blind Down output. If the signal remains present for longer than t Switch Over Time, the output b Blind Up remains latched. b Switch Over Down: Set the b Blind Down output and reset the b Blind Up output. If the signal remains present for longer than t Switch Over Time, the output b Blind Down remains latched. t Switch Over Time: Gives the time for which the b Switch Up and b Switch Down inputs must remain asserted before the outputs are latched. If the value is 0, the outputs are latched immediately. b Step Up: Reset the b Blind Down output and set the b Blind Up output for the time t Step Time. b Step Down: Reset the b Blind Up output and set the b Blind Down output for the time t Step Time. t Step Time: If the blind is controlled through the b Step Up or b Step Down inputs, the outputs remain asserted for this period of time. The outputs are not set if the specified duration is 0. b Shadow Position: The shading position is approached. t Shadow Turn Around Time: The blind travels in the opposite direction for the period of time specified by t Shadow Turn Around Time after the shading position has been reached. t Shadow Turn Off Time: The time for which the b Blind Down output is set in order to reach the shading position. A time of greater than 0 is necessary for the shading position to be approached. b Safety Position: The safety position is approached. To do this, the blind is raised for the period of time specified by t Turn Off Time. It is not possible to operate the blinds while this input is set. t Turn Off Time: If no input is activated, then the outputs are reset after this period of time. The outputs are not automatically reset if the specified duration is 0. The value given here should be about 10% larger than the travel time that is actually measured. 22 Version: 1.2.0 TF8010
## Page 23

Programming t Switch Over Dead Time: Dwell time at a change of direction. Both outputs are reset during this period. VAR_OUTPUT b Blind Up : BOOL; b Blind Down : BOOL; b Blind Up: The blind opens. b Blind Down: The blind closes. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.3.3 FB_Venetian Blind Ex Four different methods are available for controlling the blind: • A positive edge at the b Up or b Down inputs set the b Blind Up or b Blind Down outputs respectively. These remain asserted until the time t Drive Time + 10% has elapsed, or until the function block receives some other command. Both outputs are immediately reset by a positive edge at the b Stop input. • Static signals are provided to the b Switch Over Up or b Switch Over Down inputs (e.g. by buttons). These set the b Blind Up and b Blind Down outputs. If this signal is asserted for longer than t Switch Over Time, the outputs are latched. This means that the outputs will continue to be asserted, even if the signals at the inputs are removed again. In most cases, a value of 500 ms is sufficient for the t Switch Over Time parameter. However, the output only remains asserted for the time t Drive Time + 10%, or until a new command is given to the function block. • In certain applications it may be useful for the operator to be able to alter the blind position step by step. Each positive edge at the b Step Up or b Step Down inputs sets the corresponding output for the time t Step Time. A value of 200 ms has been found effective for t Step Time. • Unlike the FB_Venetian Blind() [} 21] function block, this function block also enables movement to an absolute position. A percentage value is applied to input n Set Position, and subsequently a positive edge is applied to input b Position. TF8010 Version: 1.2.0 23
## Page 24

Programming The t Switch Over Dead Time can be used to prevent damage to the drive motor caused by immediate changes in direction. In most cases, this value is between 0.5 s and 1.0 s. The drive manufacturer can give you a precise value. Safety position Travel to the safety position (e.g. because there is a strong wind or because maintenance is being carried out at the window) can be achieved by setting the b Safety Position input. The output b Blind Up is set and the output b Blind Down reset for the period specified by t Drive Time + 10%. Operation of the blinds is prevented for as long as the b Safety Position input is active. Shading position Under conditions of above-average sunshine, the blinds can be moved to the shading position. After applying a positive edge to the input b Shadow Position, the blind is moved to the position n Shadow Set Position. The blind is then moved upwards again for the period of time specified by t Shadow Turn Around Time. This prevents the room from being completely darkened. If the blind had moved upwards during the approach of the shading position, it is moved downwards for the time period t Drive Switch Over Time - t Shadow Turn Around Time. The same angle will therefore be set as if the blind had been moved downwards for darkening purposes. During a change of direction, a pause of duration t Switch Over Dead Time is maintained. Travel to the shading position can be interrupted at any time by a new command. The set shading time t Shadow Turn Around Time must never be longer than the time for the change of direction t Drive Switch Over Time. Moving to an absolute position Comments In most cases a blind will not provide feedback about its current position. Therefore, this can only be calculated via the travel time. The precision depends on the uniformity of the blind speed. Furthermore, the speed differences between opening and closing should be as small as possible. The positions are always specified in percent. 0% corresponds to fully up, 100% to fully down. If a value greater than 100 is specified, it will be limited to 100 within the function block. Determining the parameters First of all, certain blind parameters have to be determined. One parameter is the travel time. This is the time it takes for the blind to open or close fully. The second parameter is the time required for a change of direction. During a change of direction, the angle between the individual blades will change. The travel time is transferred to the parameter t Drive Time. The duration for a direction change is transferred to t Drive Switch Over Time. Referencing a function block Since the current position of the blind has to be calculated, inaccuracies during operation will accumulate. In order to limit deviations, the function block will automatically reference itself as often as possible. This happens when the blind is moved fully up or down and the corresponding output is reset automatically. The corresponding time is t Drive Time + 10%. VAR_INPUT b Up : BOOL; b Down : BOOL; b Stop : BOOL; b Switch Over Up : BOOL; b Switch Over Down : BOOL; t Switch Over Time : TIME := t#500ms; b Step Up : BOOL; b Step Down : BOOL; t Step Time : TIME := t#200ms; b Position : BOOL; n Set Position : USINT; 24 Version: 1.2.0 TF8010
## Page 25

Programming b Shadow Position : BOOL; n Shadow Set Position : USINT := 80; t Shadow Turn Around Time : TIME:= t#0s; b Safety Position : BOOL; t Drive Time : TIME := t#60s; t Drive Switch Over Time : TIME := t#200ms; t Switch Over Dead Time : TIME := t#400ms; b Up: Set the b Blind Up output and reset the b Blind Down output. The b Blind Up output remains latched. b Down: Set the b Blind Down output and reset the b Blind Up output. The b Blind Down output remains latched. b Stop: Reset the b Blind Up and b Blind Down outputs. b Switch Over Up: Set the b Blind Up output and reset the b Blind Down output. If the signal remains present for longer than t Switch Over Time, the output b Blind Up remains latched. b Switch Over Down: Set the b Blind Down output and reset the b Blind Up output. If the signal remains present for longer than t Switch Over Time, the output b Blind Down remains latched. t Switch Over Time: Gives the time for which the b Switch Up and b Switch Down inputs must remain asserted before the outputs are latched. If the value is 0, the outputs are latched immediately. b Step Up: Reset the b Blind Down output and set the b Blind Up output for the time t Step Time. b Step Down: Reset the b Blind Up output and set the b Blind Down output for the time t Step Time. t Step Time: If the blind is controlled through the b Step Up or b Step Down inputs, the outputs remain asserted for this period of time. The outputs are not set if the specified duration is 0. b Position: Move blind to specified position. n Set Position: Position (0%-100%) to which the blind is to be moved, after a positive edge has been applied to input b Position. 0% corresponds to fully up, 100% corresponds to fully down. b Shadow Position: The shading position is approached. n Shadow Set Position: Shading position (0%-100%) to which the blind is to be moved, after a positive edge has been applied to input b Shadow Position. t Shadow Turn Around Time: Once the shading position has been reached, the blind is moved upwards for the period t Shadow Turn Around Time. b Safety Position: The safety position is approached. To do this, the blind is raised for the period t Drive Time + 10%. It is not possible to operate the blinds while this input is set. t Drive Time: Travel time of the blind from fully up to fully down. If no input is activated, the outputs are reset after the period t Drive Time + 10%. The outputs are not automatically reset if the specified duration is 0. In this case, the blind cannot be moved to absolute positions. t Drive Switch Over Time: Period of time required for a change of direction of the blind. t Switch Over Dead Time: Dwell time at a change of direction. Both outputs are reset during this period. VAR_OUTPUT b Blind Up : BOOL; b Blind Down : BOOL; n Actual Position : USINT; b Calibrated : BOOL; b Blind Up: The blind opens. b Blind Down: The blind closes. n Actual Position: Current position in percent. b Calibrated: Indicates whether the blind is calibrated. TF8010 Version: 1.2.0 25
## Page 26

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.3.4 FB_Venetian Blind Ex1Switch Blind function block with the same functionality as FB_Venetian Blind Ex() [} 23] but with an input b Switch for jogging up and down. Four different methods are available for controlling the blind: • A positive edge at the b Up or b Down inputs set the b Blind Up or b Blind Down outputs respectively. These remain asserted until the time t Drive Time + 10% has elapsed, or until the function block receives some other command. Both outputs are immediately reset by a positive edge at the b Stop input. • The input b Switch, which is usually linked to a push button, can be used to switch the blind movement between up or down. In contrast to FB_Venetian Blind Ex() [} 23], the outputs immediately switch to latching. Pressing the button switches between moving, stopping, moving in the opposite direction, stopping and moving again. The outputs remain active for a maximum period of t Drive Time + 10% or until a new command is issued for the function block. Switching is locked for the time t Switch Over Dead Time. • In certain applications it may be useful for the operator to be able to alter the blind position step by step. Each positive edge at the b Step Up or b Step Down inputs sets the corresponding output for the time t Step Time. A value of 200 ms has been found effective for t Step Time. • Unlike the FB_Venetian Blind() [} 21] function block, this function block also enables movement to an absolute position. A percentage value is applied to input n Set Position, and subsequently a positive edge is applied to input b Position. The t Switch Over Dead Time can be used to prevent damage to the drive motor caused by immediate changes in direction. In most cases, this value is between 0.5 s and 1.0 s. The drive manufacturer can give you a precise value. Safety position Travel to the safety position (e.g. because there is a strong wind or because maintenance is being carried out at the window) can be achieved by setting the b Safety Position input. The output b Blind Up is set and the output b Blind Down reset for the period specified by t Drive Time + 10%. Operation of the blinds is prevented for as long as the b Safety Position input is active. 26 Version: 1.2.0 TF8010
## Page 27

Programming Shading position Under conditions of above-average sunshine, the blinds can be moved to the shading position. After applying a positive edge to the input b Shadow Position, the blind is moved to the position n Shadow Set Position. The blind is then moved upwards again for the period of time specified by t Shadow Turn Around Time. This prevents the room from being completely darkened. If the blind had moved upwards during the approach of the shading position, it is moved downwards for the time period t Drive Switch Over Time - t Shadow Turn Around Time. The same angle will therefore be set as if the blind had been moved downwards for darkening purposes. During a change of direction, a pause of duration t Switch Over Dead Time is maintained. Travel to the shading position can be interrupted at any time by a new command. Moving to an absolute position Comments In most cases a blind will not provide feedback about its current position. Therefore, this can only be calculated via the travel time. The precision depends on the uniformity of the blind speed. Furthermore, the speed differences between opening and closing should be as small as possible. The positions are always specified in percent. 0% corresponds to fully up, 100% to fully down. If a value greater than 100 is specified, it will be limited to 100 within the function block. Determining the parameters First of all, certain blind parameters have to be determined. One parameter is the travel time. This is the time it takes for the blind to open or close fully. The second parameter is the time required for a change of direction. During a change of direction, the angle between the individual blades will change. The travel time is transferred to the parameter t Drive Time. The duration for a direction change is transferred to t Drive Switch Over Time. Referencing a function block Since the current position of the blind has to be calculated, inaccuracies during operation will accumulate. In order to limit deviations, the function block will automatically reference itself as often as possible. This happens when the blind is moved fully up or down and the corresponding output is reset automatically. The corresponding time is t Drive Time + 10%. VAR_INPUT b Up : BOOL; b Down : BOOL; b Stop : BOOL; b Switch : BOOL; b Step Up : BOOL; b Step Down : BOOL; t Step Time : TIME := t#200ms; b Position : BOOL; n Set Position : USINT; b Shadow Position : BOOL; n Shadow Set Position : USINT := 80; t Shadow Turn Around Time : TIME := t#0s; b Safety Position : BOOL; t Drive Time : TIME := t#60s; t Drive Switch Over Time : TIME := t#200ms; t Switch Over Dead Time : TIME := t#400ms; b Up: Set the b Blind Up output and reset the b Blind Down output. The b Blind Up output remains latched. b Down: Set the b Blind Down output and reset the b Blind Up output. The b Blind Down output remains latched. b Stop: Reset the b Blind Up and b Blind Down outputs. b Switch: Switching input for jogging the blind, see description above. Switches between moving, stopping, moving in the opposite direction, stopping and moving again. In each case the activated output immediately switches to latching. b Step Up: Reset the b Blind Down output and set the b Blind Up output for the time t Step Time. TF8010 Version: 1.2.0 27
## Page 28

Programming b Step Down: Reset the b Blind Up output and set the b Blind Down output for the time t Step Time. t Step Time: If the blind is controlled through the b Step Up or b Step Down inputs, the outputs remain asserted for this period of time. The outputs are not set if the specified duration is 0. b Position: Move blind to specified position. n Set Position: Position (0%-100%) to which the blind is to be moved after a positive edge has been applied to input b Position. 0% corresponds to fully up, 100% corresponds to fully down. b Shadow Position: The shading position is approached. n Shadow Set Position: Shading position (0%-100%) to which the blind is to be moved, after a positive edge has been applied to input b Shadow Position. t Shadow Turn Around Time: Once the shading position has been reached, the blind is moved upwards for the period t Shadow Turn Around Time. b Safety Position: The safety position is approached. To do this, the blind is moved upwards for the period t Drive Time + 10%. It is not possible to operate the blinds while this input is set. t Drive Time: Travel time of the blind from fully up to fully down. If no input is activated, the outputs are reset after the period t Drive Time + 10%. The outputs are not automatically reset if the specified duration is 0. In this case, the blind cannot be moved to absolute positions. t Drive Switch Over Time: Period of time required for a change of direction of the blind. t Switch Over Dead Time: Dwell time at a change of direction. Both outputs are reset during this period. VAR_OUTPUT b Blind Up : BOOL; b Blind Down : BOOL; n Actual Position : USINT; b Calibrated : BOOL; b Blind Up: The blind opens. b Blind Down: The blind closes. n Actual Position: Current position in percent. b Calibrated: Indicates whether the blind is calibrated. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.4 Filter functions 4.1.4.1 FB_PT1 PT element for smoothing of input variables. 1 This function block is active continuously. The output f Out always follows the input value f In multiplied by Kp with an exponential curve: 28 Version: 1.2.0 TF8010
## Page 29

Programming If Kp is 1 the output value directly follows the input value. f Out has reached 63% of the input value after the time t T1 has elapsed, after 3 x t T1 the value is 95%. The mathematical formula is: The following time-discrete formula is used for the calculation in the PLC: With a continuously changing input f In, f Out behaves as follows (f In= 0..33000, Kp= 1, T1= 5s ): TF8010 Version: 1.2.0 29
## Page 30

Programming Note on damping times: Since this function block is a time-discrete model of a PT element, it only works 1 correctly if the damping time is significantly longer than the set cycle time. To be on the safe side, if a damping time is entered that is less than twice the set cycle time it is internally set to zero. A damping time of 0s means that the output variable directly follows the input variable multiplied by Kp. VAR_INPUT f In : LREAL; f Kp : LREAL := 1; t T1 : TIME := t#10s; t Cycletime : TIME := t#10ms; b Set Actual : BOOL; f In: Input value. fk P: Gain factor, preset value: 1. t T1: Damping time, preset value: 10 s. t Cycle Time: PLC cycle time, preset value: 10 ms. b Set Actual: Sets the output f Out directly to the input value f In. VAR_OUTPUT f Out : LREAL; f Out: Output value. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 30 Version: 1.2.0 TF8010
## Page 31

Programming 4.1.4.2 FB_PT2 PT element for smoothing of input variables. 2 This function block is active continuously. The output f Out always follows the input value f In multiplied by Kp. This PT element consists of a series of two PT elements; the time constants T1 and T2 can have different 2 1 values. The step response (see above) shows a significantly more attenuated subsequent behavior compared to the PT element (dashed) right from the start. 1 With a continuously changing input f In, f Out behaves as follows (f In= 0..33000, Kp= 1, T1,T2= 5s ): TF8010 Version: 1.2.0 31
## Page 32

Programming In comparison, the dotted line shows the behavior of a PT1 element [} 28] with f In= 0..33000, Kp= 1, T1= 5s. Note on damping times: Since this function block is a time-discrete model of a PT element, it only works 2 correctly if the damping time is significantly longer than the set cycle time. To be on the safe side, if damping times are entered that are less than twice the set cycle time they are internally set to zero. As already mentioned, the PT element consists of two PT elements connected in series. If one of the two damping 2 1 times is set to zero, the PT element is reduced to a PT element. If both damping times are set to zero, the 2 1 output variable directly follows the input variable multiplied by Kp. VAR_INPUT f In : LREAL; f Kp : LREAL := 1; t T1 : TIME := t#10s; t T2 : TIME := t#10s; t Cycletime : TIME := t#10ms; b Set Actual : BOOL; f In: Input value. fk P: Gain factor, preset value: 1. t T1: Damping time 1, preset value: 10 s. t T2: Damping time 2, preset value: 10 s. t Cycle Time: PLC cycle time, preset value: 10 ms. b Set Actual: Sets the output f Out directly to the input value f In. VAR_OUTPUT f Out : LREAL; f Out: Output value. 32 Version: 1.2.0 TF8010
## Page 33

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.5 Lighting 4.1.5.1 FB_Constant Light Control Eco The function block is used for constant light control. The system tries to match a specified setpoint through cyclic dimming. The control dynamics are determined by a dead time (t Dead Time) and the step size (n Step Size). The dead time specifies the waiting time between the individual steps or increments of the control value, which are determined by the set step size. The smaller the dead time, the faster the control. A freely definable hysteresis (n Hysteresis) prevents continuous oscillation around the setpoint. If the actual value is within the hysteresis range around the setpoint, the lamps brightness remains unchanged. If the set step size n Step Size is too large or the hysteresis n Hysteresis is too small, the hysteresis range may be "missed". This cannot be prevented by the function block, because the light output n Light Level is only physically linked to the recorded actual light value, n Actual Level. VAR_INPUT b Enable : BOOL; b On : BOOL; b Off : BOOL; b Toggle : BOOL; n Setpoint Value : UINT := 16000; n Actual Value : UINT; n Hysteresis : UINT := 100; n Max Level : UINT := 32767; n Min Level : UINT := 3276; n Step Size : UINT := 10; t Dead Time : TIME := t#50ms; n Options : DWORD; b Enable: Enables the function block. If this input is FALSE, the inputs b On, b Off and b Toogle are disabled. The control value remains unchanged. b On: Switches the controlled devices to n Max Level and activates constant light control. b Off: Switches the addressed devices off and disables constant light control. b Toggle: The lighting is switched on or off, depending on the state of the reference device. TF8010 Version: 1.2.0 33
## Page 34

Programming n Setpoint Value: This input is used for specifying the setpoint. n Actual Value: The actual value is applied at this input. n Hysteresis: Control hysteresis around the setpoint. If the actual value is within this range, the control values for the lamps remain unchanged. n Max Level: Maximum value of the control value at n Light Level. n Min Level: Minimum value of the control value at n Light Level. If this value is to be undercut by a dimming process, n Light Level is set directly to "0". On the other hand, if n Light Level is set to "0" when control is active, the dimming process starts directly at this value. n Step Size: Step size with which the control value n Light Level is changed. t Dead Time: Dead time between the individual steps (up or down) of the control value. n Options: Currently not used. Reserved for future extensions. VAR_OUTPUT n Deviation : INT; b Controller Is Active : BOOL; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Deviation: Current control deviation (setpoint/actual value). b Controller Is Active: This output is set once the control is activated. b Busy: When the function block is activated, this output is always active when changes are made to the control value. b Error: This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id: Contains the command-specific error code of the most recently executed command. Is reset to "0" by the execution of a command at the inputs. See Error codes [} 92]. VAR_IN_OUT n Light Level : UINT; n Light Level: Output control value of the function block and reference to the light output value. This value is defined as In-Out variable because the function block reads and writes the light value. Flow diagram The following diagram illustrates the regular control behavior: 34 Version: 1.2.0 TF8010
## Page 35

Programming The control is enabled by a TRUE signal at input b Enable. When a positive edge is encountered at b On, n Light Level is set to the maximum value. This also influences the measured light value n Actual Value, which increases, so that dimming becomes necessary. n Light Level is now reduced step-by-step until the measured light value n Actual Value is in the hysteresis range around the setpoint (n Setpoint Value - 0.5*n Hysteresis < x < n Setpoint Value + 0.5*n Hysteresis). If, for example, the measured light value then falls, e.g. due to cloudiness, the control system counteracts this by gradually increasing the lighting level until the light value is back in the hysteresis band. If the step size n Step Size is too large or the hysteresis is too small, an oscillation around the setpoint can occur. Because the hysteresis is small compared to the step changes, the hysteresis range is constantly missed: TF8010 Version: 1.2.0 35
## Page 36

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 36 Version: 1.2.0 TF8010
## Page 37

Programming 4.1.5.2 FB_Dimmer1Switch The function block is used to dim lights with a switch. Operating by means of the b Switch Dimm input The light is switched on or off by a short signal at the b Switch Dimm input. Dimmer mode will be activated if the signal remains for longer than t Switch Over Time (typical recommended value: 200 ms). The output signal then cycles between n Out Min and n Out Max. In order to be able to set the maximum or minimum value more easily, the output signal pauses at the level of the maximum and minimum values for the time given by t Cycle Delay. When the signal is once more removed, the output signal being generated at that time is retained. Another pulse at the input will set the output to 0. Operation by means of the b On and b Off inputs The light is immediately switched on or off if a positive edge is applied to the b On or b Off inputs. For example, for global on/off functions. The output value is set to 0 when switching off. The switch-on behavior can be affected by the memory function (see below). Operation by means of the b Set Dimm Value and n Dimm Value inputs If the value of n Dimm Value changes, the signal will be passed through directly to the output. The significant point here is that the value changes. The lighting is switched off by changing the value to 0. If there is a positive edge at the b Set Dimm Value input, the value of n Dimm Value immediately appears at the output. Immediate modification of the output can be suppressed by a static 1- signal at the b Set Dimm Value input. This makes it possible to apply a value to the n Dimm Value input, but for this value only to be passed to the output at the next positive edge of b Set Dimm Value. The b Set Dimm Value and n Dimm Value inputs can be used to implement a variety of lighting scenarios. Direct setting of the output, by means of n Dimm Value, can be used to achieve particular brightness levels. Either directly or by continuously changing the value. n Dimm Value must have a value between n Out Min and n Out Max. The value 0 is an exception. If the value is outside this range, the output value is limited to the upper or lower limit, as appropriate. The memory function It is necessary to determine whether the memory function (b Memory Mode On input) is active or not at switch- on. If the memory function is active, then the last set value is placed at the output as soon as the lamp is switched on. If the memory function is not active, then the value specified by the n On Value Without Memory Mode parameter is output. It is irrelevant, in this case, whether the light it has been TF8010 Version: 1.2.0 37
## Page 38

Programming switched on by means of the b On input or the b Switch Dimm input. It should be noted that the n On Value Without Memory Mode parameter must lie between n Out Min and n Out Max. If this is not the case, the output value is adjusted to the upper or lower limit, as appropriate. Fast dimming up/down when switching on and off Lighting is particularly pleasant if sudden changes are replaced by a slow change to the desired value. This mode can be activated both for switching on and for switching off by means of the two inputs, b Dimm On Mode and b Dimm Off Mode. The t Dimm On Time and t Dimm Off Time parameters specify the time that will be taken by the switching processes. This value is always related to the minimum and maximum possible output values (n Out Min and n Out Max). The b On and b Off inputs are one way in which the switch on/off commands may be given. Alternatively, a short pulse can be provided to the b Switch Dimm input. If the n Dimm Value input is set to 0, the output is modified without delay. The same is true if the output is set by a positive edge at the b Set Dimm Value input. Comments on the t Switch Over Time and t Dimm Time parameters If a duration of 0 is specified for the t Switch Over Time parameter, while a value of greater than 0 is specified for t Dimm Time, then the t Switch Dimm input can only be used to dim the light. Switching on and off is only possible with the b On and b Off inputs. If the t Dimm Time parameter is 0, the b Switch Dimm input can only be used to switch the light on or off. In this case, the value of t Switch Over Time is irrelevant. VAR_INPUT b Switch Dimm : BOOL; b On : BOOL; b Off : BOOL; b Set Dimm Value : BOOL; n Dimm Value : UINT; t Switch Over Time : TIME := t#500ms; t Dimm Time : TIME := t#5s; t Cycle Delay : TIME := t#10ms; b Memory Mode On : BOOL := FALSE; n On Value Without Memory Mode : UINT := 20000; b Dimm On Mode : BOOL := FALSE; t Dimm On Time : TIME := t#0s; b Dimm Off Mode : BOOL := FALSE; t Dimm Off Time : TIME := t#0s; n Out Min : UINT := 5000; n Out Max : UINT := 32767; b Switch Dimm: Switches or dims the output. b On: Switches the output to the last output value, or to the value specified by n On Value Without Memory Mode. b Off: Switches the output to 0. b Set Dimm Value: Switches the output to the value n Dimm Value. n Dimm Value: The value is immediately applied to the output when there is a change. t Switch Over Time: Time for switching between the light on/off and dimming functions for the b Switch Dimm input. t Dimm Time: Time required for dimming to go from its minimum value to its maximum value. t Cycle Delay: Delay time, if either the minimum or maximum value is reached. b Memory Mode On: Switches over to use the memory function, so that the previous value is written to the output as soon as it is switched on. n On Value Without Memory Mode: Switch-on value if the memory function is not active. b Dimm On Mode: The output value is increased in steps when switching on. t Dimm On Time: Time period during which the light level is increased when the light is switched on. b Dimm On Mode must be active. 38 Version: 1.2.0 TF8010
## Page 39

Programming b Dimm Off Mode: The output value is reduced in steps when switching off t Dimm Off Time: Time period during which the light is reduced when the light is switched off. b Dimm Off Mode must be active. n Out Min: Minimum output value. n Out Max: Maximum output value. If the parameter n Out Min is not smaller than n Out Max, the output will remain at 0. VAR_OUTPUT n Out : UINT; b Light : BOOL; n Out: analog output value. b Light: digital output value. This is set if n Out is greater than 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.5.3 FB_Dimmer1Switch Eco This function block is a memory-saving variant of FB_Dimmer1Switch() [} 37]. It does not have the special functions "Set brightness value" and "Switch off memory function", which may not be required for many applications. Moreover, the values n Out Min and n Out Max of the FB_Dimmer1Switch() [} 37] are set internally here to 0 and 32767 respectively. This output span corresponds to the display range of an analog output terminal. The t PLCCycle input is important. This time is used to calculate internally the amount by which the n Out output must be increased per cycle - that saves additional time calculations. Operating by means of the b Switch Dimm input The light is switched on or off by a short signal at the b Switch Dimm input. Dimmer mode will be activated if the signal remains for longer than t Switch Over Time (typical recommended value: 200ms). The output signal moves cyclically between 0 and 32767. In order to be able to set the maximum or minimum value more easily, the output signal pauses at the level of the maximum and minimum values for the time given by t Cycle Delay. When the signal is once more removed, the output signal being generated at that time is retained. Another pulse at the input will set the output to 0. Operation by means of the b On and b Off inputs The light is immediately switched on or off if a positive edge is applied to the b On or b Off inputs. For example, for global on/off functions. The output value is set to 0 when switching off. TF8010 Version: 1.2.0 39
## Page 40

Programming The memory function In contrast to FB_Dimmer1Switch() [} 37], where the memory function can be activated or deactivated via the input b Memory Mode On , the memory function is always active in this memory-saving version. This means that the last-set value is adopted as the brightness value when switching on. It is irrelevant, in this case, whether the light it has been switched on by means of the b On input or the b Switch Dimm input. Comment on the t Switch Over Time parameter If a duration of 0 is specified for the parameter t Switch Over Time, the b Switch Dimm input can only be used to dim the light. Switching on and off is only possible with the b On and b Off inputs. VAR_INPUT b Switch Dimm : BOOL; b On : BOOL; b Off : BOOL; t Switch Over Time : TIME := t#500ms; t Dimm Time : TIME := t#5s; t Cycle Delay : TIME := t#500ms; t PLCCycle : TIME := t#10ms; b Switch Dimm: Switches or dims the output. b On: Switches the output to the last output value, or to the value specified by n On Value Without Memory Mode. b Off: Switches the output to 0. t Switch Over Time: Time for switching between the light on/off and dimming functions for the b Switch Dimm input. t Dimm Time: Time required for dimming to go from its minimum value to its maximum value. t Cycle Delay: Delay time, if either the minimum or maximum value is reached. t PLCCycle: the set PLC cycle time. VAR_OUTPUT n Out : UINT; b Light : BOOL; n Out: analog output value. b Light: digital output value. This is set if n Out is greater than 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 40 Version: 1.2.0 TF8010
## Page 41

Programming 4.1.5.4 FB_Dimmer2Switch The function range of the function block corresponds to that of the function block FB_Dimmer1Switch() [} 37]. The difference is that in the function block FB_Dimmer2Switch two switches are connected. This allows the user to choose specifically between dimming up or dimming down. Operation by means of the b Switch Dimm Up and b Switch Dimm Down inputs The light is switched on or off by a short signal at the b Switch Dimm Up or b Switch Dimm Down inputs. Dimmer mode will be activated if the signal remains for longer than t Switch Over Time (typical recommended value: 200ms). The output signal goes to n Out Min or n Out Max. When the signal is once more removed, the output signal being generated at that time is retained. Another pulse at one of the inputs will set the output to 0. Operation by means of the b On and b Off inputs The light is immediately switched on or off if a positive edge is applied to the b On or b Off inputs. For example, for global on/off functions. The output value is set to 0 when switching off. The switch-on behavior can be affected by the memory function (see below). Operation by means of the b Set Dimm Value and n Dimm Value inputs If the value of n Dimm Value changes, the signal will be passed through directly to the output. The significant point here is that the value changes. The lighting is switched off by changing the value to 0. If there is a positive edge at the b Set Dimm Value input, the value of n Dimm Value immediately appears at the output. Immediate modification of the output can be suppressed by a static 1- signal at the b Set Dimm Value input. This makes it possible to apply a value to the n Dimm Value input, but for this value only to be passed to the output at the next positive edge of b Set Dimm Value. The b Set Dimm Value and n Dimm Value inputs can be used to implement a variety of lighting scenarios. Direct setting of the output, by means of n Dimm Value, can be used to achieve particular brightness levels. Either directly or by continuously changing the value. n Dimm Value must have a value between n Out Min and n Out Max. The value 0 is an exception. If the value is outside this range, the output value is limited to the upper or lower limit, as appropriate. The memory function It is necessary to determine whether the memory function (b Memory Mode On input) is active or not at switch- on. If the memory function is active, then the last set value is placed at the output as soon as the lamp is switched on. If the memory function is not active, then the value specified by the n On Value Without Memory Mode parameter is output. It is irrelevant, in this case, whether the light it has been TF8010 Version: 1.2.0 41
## Page 42

Programming switched on by means of the b On input or one of the b Switch Dimm Up or b Switch Dimm Down inputs. It should be noted that the n On Value Without Memory Mode parameter must lie between n Out Min and n Out Max. If this is not the case, the output value is adjusted to the upper or lower limit, as appropriate. Fast dimming up/down when switching on and off Lighting is particularly pleasant if sudden changes are replaced by a slow change to the desired value. This mode can be activated both for switching on and for switching off by means of the two inputs, b Dimm On Mode and b Dimm Off Mode. The t Dimm On Time and t Dimm Off Time parameters specify the time that will be taken by the switching processes. This value is always related to the minimum and maximum possible output values (n Out Min and n Out Max). The b On and b Off inputs are one way in which the switch on/off commands may be given. Alternatively, a short pulse can be provided to either of the inputs b Switch Dimm Up or b Switch Dimm Down. If the n Dimm Value input is set to 0, the output is modified without delay. The same is true if the output is set by a positive edge at the b Set Dimm Value input. Comments on the t Switch Over Time and t Dimm Time parameters If a duration of 0 is specified for the t Switch Over Time parameter, while a value of greater than 0 is specified for t Dimm Time, then the b Switch Dimm Up or b Switch Dimm Down inputs can only be used to dim the light. Switching on and off is only possible with the b On and b Off inputs. If the t Dimm Time parameter is 0, the b Switch Dimm Up or b Switch Dimm Down inputs can only be used to switch the light on or off. In this case, the value of t Switch Over Time is irrelevant. VAR_INPUT b Switch Dimm Up : BOOL; b Switch Dimm Down : BOOL; b On : BOOL; b Off : BOOL; b Set Dimm Value : BOOL; n Dimm Value : UINT; t Switch Over Time : TIME := t#500ms; t Dimm Time : TIME := t#5s; b Memory Mode On : BOOL := FALSE; n On Value Without Memory Mode : UINT := 20000; b Dimm On Mode : BOOL := FALSE; t Dimm On Time : TIME := t#0s; b Dimm Off Mode : BOOL := FALSE; t Dimm Off Time : TIME := t#0s; n Out Min : UINT := 5000; n Out Max : UINT := 32767; b Switch Dimm Up: Switches or dims the output Up. b Switch Dimm Down: Switches or dims the output Down. b On: Switches the output to the last output value, or to the value specified by n On Value Without Memory Mode. b Off: Switches the output to 0. b Set Dimm Value: Switches the output to the value n Dimm Value. n Dimm Value: The value is immediately applied to the output when there is a change. t Switch Over Time: Time for switching between the light on/off and dimming functions for the b Switch Dimm Up and b Switch Dimm Down inputs. t Dimm Time: Time required for dimming to go from its minimum value to its maximum value. b Memory Mode On: Switches over to use the memory function, so that the previous value is written to the output as soon as it is switched on. n On Value Without Memory Mode: Switch-on value if the memory function is not active. b Dimm On Mode: The output value is increased in steps when switching on. t Dimm On Time: Time period during which the light level is increased when the light is switched on. b Dimm On Mode must be active. 42 Version: 1.2.0 TF8010
## Page 43

Programming b Dimm Off Mode: The output value is reduced in steps when switching off t Dimm Off Time: Time period during which the light is reduced when the light is switched off. b Dimm Off Mode must be active. n Out Min: Minimum output value. n Out Max: Maximum output value. If the parameter n Out Min is not smaller than n Out Max, the output will remain at 0. VAR_OUTPUT n Out : UINT; b Light : BOOL; n Out: analog output value. b Light: digital output value. This is set if n Out is greater than 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.5.5 FB_Dimmer2Switch Eco This function block is a memory-saving variant of FB_Dimmer2Switch() [} 41]. It does not have the special functions "Set brightness value" and "Switch off memory function", which may not be required for many applications. Moreover, the values n Out Min and n Out Max of the FB_Dimmer2Switch() [} 41] are set internally here to 0 and 32767 respectively. This output span corresponds to the display range of an analog output terminal. The t PLCCycle input is important. This time is used to calculate internally the amount by which the n Out output must be increased per cycle - that saves additional time calculations. Operation by means of the b Switch Dimm Up and b Switch Dimm Down inputs The light is switched on or off by a short signal at the b Switch Dimm Up or b Switch Dimm Down inputs. Dimmer mode will be activated if the signal remains for longer than t Switch Over Time (typical recommended value: 200ms). The output signal goes to n Out Min or n Out Max. When the signal is once more removed, the output signal being generated at that time is retained. Another pulse at one of the inputs will set the output to 0. Operation by means of the b On and b Off inputs The light is immediately switched on or off if a positive edge is applied to the b On or b Off inputs. For example, for global on/off functions. The output value is set to 0 when switching off. TF8010 Version: 1.2.0 43
## Page 44

Programming The memory function In contrast to FB_Dimmer2Switch() [} 41], where the memory function can be activated or deactivated via the input b Memory Mode On , the memory function is always active in this memory-saving version. This means that the last-set value is adopted as the brightness value when switching on. It is irrelevant, in this case, whether the light it has been switched on by means of the b On input or one of the b Switch Dimm Up or b Switch Dimm Down inputs. Comment on the t Switch Over Time parameter If a duration of 0 is specified for the parameter t Switch Over Time, the b Switch Dimm Up and b Switch Dimm Down inputs can only be used to dim the light. Switching on and off is only possible with the b On and b Off inputs. VAR_INPUT b Switch Dimm Up : BOOL; b Switch Dimm Down : BOOL; b On : BOOL; b Off : BOOL; t Switch Over Time : TIME := t#500ms; t Dimm Time : TIME := t#5s; t PLCCycle : TIME := t#10ms; b Switch Dimm Up: Switches or dims the output Up. b Switch Dimm Down: Switches or dims the output Down. b On: Switches the output to the last output value. b Off: Switches the output to 0. t Switch Over Time: Time for switching between the light on/off and dimming functions for the b Switch Dimm Up and b Switch Dimm Down inputs. t Dimm Time: Time required for dimming to go from its minimum value to its maximum value. t Cycle Delay: Delay time, if either the minimum or maximum value is reached. t PLCCycle: the set PLC cycle time. VAR_OUTPUT n Out : UINT; b Light : BOOL; n Out: analog output value. b Light: digital output value. This is set if n Out is greater than 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 44 Version: 1.2.0 TF8010
## Page 45

Programming 4.1.5.6 FB_Dimmer3Switch The functionality of the function block corresponds to the function blocks FB_Dimmer1Switch() [} 37] and FB_Dimmer2Switch() [} 41]. Operating by means of the b Switch Dimm input The light is switched on or off by a short signal at the b Switch Dimm input. Dimmer mode will be activated if the signal remains for longer than t Switch Over Time (typical recommended value: 200 ms). The output signal then cycles between n Out Min and n Out Max. In order to be able to set the maximum or minimum value more easily, the output signal pauses at the level of the maximum and minimum values for the time given by t Cycle Delay. When the signal is once more removed, the output signal being generated at that time is retained. Another pulse at the input will set the output to 0. Operation by means of the b Switch Dimm Up and b Switch Dimm Down inputs The light is switched on or off by a short signal at the b Switch Dimm Up or b Switch Dimm Down inputs. Dimmer mode will be activated if the signal remains for longer than t Switch Over Time (typical recommended value: 200ms). The output signal goes to n Out Min or n Out Max. When the signal is once more removed, the output signal being generated at that time is retained. Another pulse at one of the inputs will set the output to 0. Operation by means of the b On and b Off inputs The light is immediately switched on or off if a positive edge is applied to the b On or b Off inputs. For example, for global on/off functions. The output value is set to 0 when switching off. The switch-on behavior can be affected by the memory function (see below). Operation by means of the b Set Dimm Value and n Dimm Value inputs If the value of n Dimm Value changes, the signal will be passed through directly to the output. The significant point here is that the value changes. The lighting is switched off by changing the value to 0. If there is a positive edge at the b Set Dimm Value input, the value of n Dimm Value immediately appears at the output. Immediate modification of the output can be suppressed by a static 1-signal at the b Set Dimm Value input. This makes it possible to apply a value to the n Dimm Value input, but for this value only to be passed to the output at the next positive edge of b Set Dimm Value. The b Set Dimm Value and n Dimm Value inputs can be used to implement a variety of lighting scenarios. Direct setting of the output, by means of n Dimm Value, can be used to achieve particular brightness levels. TF8010 Version: 1.2.0 45
## Page 46

Programming Either directly or by continuously changing the value. n Dimm Value must have a value between n Out Min and n Out Max. The value 0 is an exception. If the value is outside this range, the output value is limited to the upper or lower limit, as appropriate. The memory function It is necessary to determine whether the memory function (b Memory Mode On input) is active or not at switch- on. If the memory function is active, then the last set value is placed at the output as soon as the lamp is switched on. If the memory function is not active, then the value specified by the n On Value Without Memory Mode parameter is output. It is irrelevant, in this case, whether the light it has been switched on by means of the b On input or one of the b Switch Dimm Up or b Switch Dimm Down inputs. It should be noted that the n On Value Without Memory Mode parameter must lie between n Out Min and n Out Max. If this is not the case, the output value is adjusted to the upper or lower limit, as appropriate. Fast dimming up/down when switching on and off Lighting is particularly pleasant if sudden changes are replaced by a slow change to the desired value. This mode can be activated both for switching on and for switching off by means of the two inputs, b Dimm On Mode and b Dimm Off Mode. The t Dimm On Time and t Dimm Off Time parameters specify the time that will be taken by the switching processes. This value is always related to the minimum and maximum possible output values (n Out Min and n Out Max). The b On and b Off inputs are one way in which the switch on/off commands may be given. Alternatively, a short pulse can be provided to either of the inputs b Switch Dimm Up or b Switch Dimm Down. If the n Dimm Value input is set to 0, the output is modified without delay. The same is true if the output is set by a positive edge at the b Set Dimm Value input. Comments on the t Switch Over Time and t Dimm Time parameters If a duration of 0 is specified for the t Switch Over Time parameter, while a value of greater than 0 is specified for t Dimm Time, then the b Switch Dimm Up or b Switch Dimm Down inputs can only be used to dim the light. Switching on and off is only possible with the b On and b Off inputs. If the t Dimm Time parameter is 0, the b Switch Dimm Up or b Switch Dimm Down inputs can only be used to switch the light on or off. In this case, the value of t Switch Over Time is irrelevant. VAR_INPUT b Switch Dimm : BOOL; b Switch Dimm Up : BOOL; b Switch Dimm Down : BOOL; b On : BOOL; b Off : BOOL; b Set Dimm Value : BOOL; n Dimm Value : UINT; t Switch Over Time : TIME := t#500ms; t Dimm Time : TIME := t#5s; t Cycle Delay : TIME := t#10ms; b Memory Mode On : BOOL := FALSE; n On Value Without Memory Mode : UINT := 20000; b Dimm On Mode : BOOL := FALSE; t Dimm On Time : TIME := t#0s; b Dimm Off Mode : BOOL := FALSE; t Dimm Off Time : TIME := t#0s; n Out Min : UINT := 5000; n Out Max : UINT := 32767; b Switch Dimm: Switches or dims the output. b Switch Dimm Up: Switches or dims the output Up. b Switch Dimm Down: Switches or dims the output Down. b On: Switches the output to the last output value, or to the value specified by n On Value Without Memory Mode. b Off: Switches the output to 0. b Set Dimm Value: Switches the output to the value n Dimm Value. n Dimm Value: The value is immediately applied to the output when there is a change. 46 Version: 1.2.0 TF8010
## Page 47

Programming t Switch Over Time: Time for switching between the light on/off and dimming functions for the b Switch Dimm Up and b Switch Dimm Down inputs. t Dimm Time: Time required for dimming to go from its minimum value to its maximum value. t Cycle Delay: Delay time, if either the minimum or maximum value is reached. b Memory Mode On: Switches over to use the memory function, so that the previous value is written to the output as soon as it is switched on. n On Value Without Memory Mode: Switch-on value if the memory function is not active. b Dimm On Mode: The output value is increased in steps when switching on. t Dimm On Time: Time period during which the light level is increased when the light is switched on. b Dimm On Mode must be active. b Dimm Off Mode: The output value is reduced in steps when switching off t Dimm Off Time: Time period during which the light is reduced when the light is switched off. b Dimm Off Mode must be active. n Out Min: Minimum output value. n Out Max: Maximum output value. If the parameter n Out Min is not smaller than n Out Max, the output will remain at 0. VAR_OUTPUT n Out : UINT; b Light : BOOL; n Out: analog output value. b Light: digital output value. This is set if n Out is greater than 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.5.7 FB_Light A positive edge at the b On input sets the b Light output. The output is reset by a positive edge at the b Off input. If a positive edge is presented to b Toggle, the output is negated; i.e., if On it goes Off, and if Off it goes On. VAR_INPUT b On : BOOL; b Off : BOOL; b Toggle : BOOL; b On: Switches the output on. b Off: Switches the output off. b Toggle: Negates the state of the output. TF8010 Version: 1.2.0 47
## Page 48

Programming VAR_OUTPUT b Light : BOOL; b Light: The output is set with a positive edge at b On . Example 1: In the following example a light is operated by two switches. If either the b Switch A or the b Switch B button is pressed, then the state of the light, as represented by the b Light output, is changed. Example 2: In the following example the b Switch Master Off switch is used to switch the b Lamp Kitchen and b Lamp Garage lights off together. This function can be used, for instance, for central control of an area of a building. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 48 Version: 1.2.0 TF8010
## Page 49

Programming 4.1.5.8 FB_Light Control Function block for daylight-dependent lighting control with up to 30 interpolation points. At the core of this function block is an input/control value table consisting of 30 elements with threshold switching. If the input value reaches the range of an interpolation point (arr Control Table[n].n Actual Value- arr Control Table[n].n Switch Range/2 ... arr Control Table[n].n Actual Value+arr Control Table[n].n Switch Range/2), the control value jumps to the corresponding function value arr Control Table[n].n Setpoint (see diagram). Coupled to this is a ramp block that runs up the control value over the time t Ramp Time. When switching on with a positive edge at b On, however, the light is initially switched directly to the nearest control value. Only then is the controller activated. While the control is active, "post-starting" can take place at any time with a positive edge at b On, thus directly controlling the light to the nearest control value. A positive edge at b Off switches the light off directly. The whole range of the table does not have to be used. The first table element (arr Control Table, see below) for which the parameter n Switchrange is 0 is considered the start of the unused area. TF8010 Version: 1.2.0 49
## Page 50

Programming VAR_INPUT b Enable : BOOL; b On : BOOL; b Off : BOOL; n Actual Value : UINT; t Ramp Time : TIME := t#30s; arr Control Table : ARRAY[1..30] OF ST_Control Table; n Options : DWORD; b Enable: The b On and b Off inputs are active as long as this input is TRUE. A negative state deactivates the inputs. b On: A rising edge directly switches n Light Level to the nearest control value. b Off: A rising edge directly switches n Light Level to "0". n Actual Value: Current brightness. t Ramp Time: Time period during which the brightness value is controlled to the next control value. (Preset value: 30 s). arr Control Table: Input value/control value table. arr Control Table[1] to arr Control Table[30] of type ST_Control Table [} 93]. n Options: Reserved for future developments. VAR_OUTPUT b Light : BOOL; b Busy : BOOL; b Control Active : BOOL; b Error : BOOL; n Error Id : UDINT; b Light: This output is set as long as n Light Level is greater than "0". b Busy: This output is always active as long as the processing of a command (b On, b Off, b Toggle or ramp) is active. b Control Active: This output is active as long as the control is active. b Error: This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id: Contains the specific error code of the most recently executed command. Is reset to "0" by the execution of a command at the inputs. See Error codes [} 92]. VAR_IN_OUT n Light Level : UINT; n Light Level: Output control value of the function block and reference to the light output value. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 50 Version: 1.2.0 TF8010
## Page 51

Programming 4.1.5.9 FB_Ramp Function block for realizing a light-ramp. A rising edge at input b On switches the light to the maximum value (32767). A rising edge at input b Off switches the light off again. Rising edges at the b Toggle input invert the respective light state. A positive edge at the b Start input allows the function block to dim the light from the current level to n End Level. The time required for this is defined by t Ramp Time. All inputs are only active as long as b Enable is TRUE, otherwise the function block is reset internally. VAR_INPUT b Enable : BOOL; b On : BOOL; b Off : BOOL; b Toggle : BOOL; b Start : BOOL; n End Level : BYTE; t Ramp Time : TIME := t#10s; n Options : DWORD; b Enable: The b On, b Off, b Toggle and b Start inputs are active as long as this input is TRUE. A negative state deactivates the inputs and resets the function block. b On: A rising edge directly switches n Light Level to the maximum value (32767). b Off: A rising edge directly switches n Light Level to "0". b Toggle: Switches the light state between On (32767) and Off (0). b Start: If a rising edge is applied to this input, the light is dimmed up or down from the current value to n End Level. The time required for this is defined by t Ramp Time. The dimming procedure can be interrupted at any time by b On, b Off or b Toggle. n End Level: Target value of the dimming procedure. t Ramp Time: Ramp time, see b Start. (Preset value: 10 seconds). n Options: Reserved for future developments. VAR_OUTPUT b Light : BOOL; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Light: This output is set as long as n Light Level is greater than 0. b Busy: This output is always active as long as the processing of a command (b On, b Off, b Toggle or ramp) is active. b Error: This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TF8010 Version: 1.2.0 51
## Page 52

Programming n Error Id: Contains the command-specific error code of the most recently executed command. Is reset to "0" by the execution of a command at the inputs. See Error codes [} 92]. VAR_IN_OUT n Light Level : UINT; n Light Level: Output control value of the function block and reference to the light output value. This value is defined as In-Out variable because the function block reads and writes the light value. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.5.10 FB_Sequencer Function block for realizing light sequences with up to 50 interpolation points. At the core of this function block is a ramp that approaches individual brightness values defined in a table within an adjustable time and then remains at this brightness value for a time that can also be defined. After the dwell time the next value is then driven to. As already mentioned, the table arr Sequence Table consists of 50 entries with the values for n Target Value (target value), t Ramp Time (time taken to reach the target value) and t Prolong Time (dwell time at the target value). It is not absolutely necessary to use all 50 values. A 0 entry of all 3 values marks the end of a sequence. Beyond that it is possible using the n Start Index input to have a light sequence begin at any desired place in the table. This allows several different light sequences to be programmed even within the 50 entries, the sequences being separated from one another by 0 entry elements: 52 Version: 1.2.0 TF8010
## Page 53

Programming Over the course of time sequence 1, for example, looks like the following (n Start Index=1, n Options.bit0=TRUE, see below for explanation): TF8010 Version: 1.2.0 53
## Page 54

Programming In addition, the function block can be switched on and off "normally" (On: n Light Level = 32767, Off: n Light Level = 0) or toggled between "On" and "Off" via the input b Toggle. However, none of the command inputs is active unless the b Enable input is TRUE. If it is reset to FALSE, no more commands are accepted and the light value retains its current state – even from a ramp. VAR_INPUT b Enable : BOOL; b On : BOOL; b Off : BOOL; b Toggle : BOOL; b Start : BOOL; n Start Index : USINT; arr Sequence Table : ARRAY[1..50] OF ST_Sequence Table; n Options : DWORD; b Enable: The b On, b Off, b Toggle and b Start inputs are active as long as this input is TRUE. A negative state deactivates the inputs and resets the function block. b On: A rising edge directly switches n Light Level to the maximum value (32767). b Off: A rising edge directly switches n Light Level to "0". b Toggle: Switches the light state between On (32767) and Off (0). b Start: A positive edge starts a light sequence from the beginning defined under n Start Index. n Start Index: See b Start. arr Sequence Table: Light value table with the corresponding ramp and dwell times (see ST_Sequence Table [} 94]). n Options: Parameterization input. The setting (or non-setting) of the individual bits of this variable of the type DWORD has the following effect: 54 Version: 1.2.0 TF8010
## Page 55

Programming Constant Description OPTION_INFINITE_LOOP Following the expiry of a sequence, the function block automatically continues at the point defined at n Start Index. If this option is not set, the sequence stops after it has elapsed. A new positive edge at b Start would be necessary to restart a sequence. VAR_OUTPUT n Actual Index : USINT; b Light : BOOL; b Sequence Active : BOOL; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Actual Index: Reference to the current element in the sequence table. If a sequence has been completed (b Sequence Active = FALSE, see below), this output goes to "0". b Light: This output is set as long as n Light Level is greater than "0". b Sequence Active: On processing a sequence this output is set to TRUE. b Busy: This output is always active as long as the processing of a command (b On, b Off, b Toggle or ramp) is active. b Error: This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id: Contains the specific error code of the most recently executed command. Is reset to "0" by the execution of a command at the inputs. See Error codes [} 92]. VAR_IN_OUT n Light Level : UINT; n Light Level: Output control value of the function block and reference to the light output value. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.5.11 FB_Stairwell Dimmer A rising edge at the input b Switch sets the analog output n Out to the value n Presence Value. A falling edge on b Switch starts or restarts a timer with the runtime t Presence Duration. Following the expiry of this timer, n Out is dimmed to the value n Prolong Value over the time period t Fade Off Duration. This value is maintained for the time period t Prolong Duration. After that, n Out is set to 0. A positive edge at the input b Off switches the output n Out to 0 immediately. The digital output value b Light is always set when n Out is greater than 0. TF8010 Version: 1.2.0 55
## Page 56

Programming VAR_INPUT b Switch : BOOL; b Off : BOOL; n Presence Value : UINT := 32767; n Prolong Value : UINT := 10000; t Presence Duration : TIME := t#120s; t Fade Off Duration : TIME := t#10s; t Prolong Duration : TIME := t#20s; b Switch: Upon a positive edge: n Out is set to n Presence Value. Upon a negative edge: start of the presence time (see diagram). b Off: Switches n Out off immediately. n Presence Value: Value to which n Out should be set during the presence time. (Preset value: 32767). n Prolong Value: Value to which n Out should be set during the dwell time. (Preset value: 10000). t Presence Duration: Duration of the presence time in which n Out is set to n Presence Value following a falling edge on b Switch. (Preset value: 120 seconds). t Fade Off Duration: Duration over which n Out is faded down to the dwell time following the presence time. (Preset value: 10 seconds). t Prolong Duration: Duration of the dwell time. (Preset value: 20 seconds). VAR_OUTPUT n Out : UINT; b Light : BOOL; n Out: Output of the momentary light value. b Light: This output is set as long as n Out is greater than 0. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 56 Version: 1.2.0 TF8010
## Page 57

Programming 4.1.5.12 FB_Stairwell Light A positive edge at the b Switch input sets the b Light output. The output is reset once the t Light Duration time has elapsed. If a signal is presented again to the b Switch input before this time has elapsed, the timer is restarted. When t Pre Warning Start has elapsed, the light is switched off (as a prewarning) for the period t Pre Warning Duration. If this prewarning is not to be given, the parameter t Pre Warning Start must be set to 0. A positive edge at the b Off input switches the output off immediately. VAR_INPUT b Switch : BOOL; b Off : BOOL; t Light Duration : TIME := t#120s; t Pre Warning Start : TIME := t#110s; t Pre Warning Duration : TIME := t#500ms; b Switch: Switches the output on for the period of time given by t Light Duration. b Off: Switches the output off. t Light Duration: Period of time for which the output is set. t Pre Warning Start: Warning time. t Pre Warning Duration: Duration of the prewarning. VAR_OUTPUT b Light : BOOL; b Light: The output is set for the duration of t Light Duration with a positive edge at b Switch. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 TF8010 Version: 1.2.0 57
## Page 58

Programming 4.1.6 Scene management 4.1.6.1 FB_Room Operation 58 Version: 1.2.0 TF8010
## Page 59

Programming TF8010 Version: 1.2.0 59
## Page 60

Programming The function block FB_Room Operation () is conceived for the management of lighting and blinds. Scenes are called and dimmed in a state of rest. Lighting and blinds can be set and saved in the appropriate mode. This function block is intended for use with the function blocks FB_Scenes Lighting() [} 63], FB_Scenes Venetian Blind() [} 66], FB_Dimmer1Switch() [} 37] and FB_Venetian Blind Ex() [} 23]. Calling saved scenes: A rising edge at the input b Switch_A, b Switch_B or b Switch_1..14 causes a pulse to be output at the output b Invoke Scene_A, b Invoke Scene_B or b Invoke Scene_1..14. Dimming saved scenes: A scene is called and dimmed up by a signal that is applied to the input b Switch_A, b Switch_B or b Switch_1..14 for a time exceeding t Cycle Delay Dimm Time. Setting blind and lighting values: A signal at the input b Switch Lighting Mode or b Switch Blinding Mode switches to the respective mode. The control values are changed by the inputs b Switch_1..14 via the outputs b Switch Lighting_1..14 or b Switch Blind Up / b Switch Blind Down_1..7. Saving the settings: By means of setting the input b Switch Lighting Mode or b Switch Blinding Mode and a signal at the input b Switch_A, b Switch_B or b Switch_1..14, a pulse is output at the output b Save Scene_A, b Save Scene_B or b Save Scene_1..14. The values are saved in the function block FB_Scenes Lighting() [} 63], FB_Scenes Venetian Blind() [} 66]. VAR_INPUT b Switch_A : BOOL; b Switch_B : BOOL; b Switch_1 : BOOL; b Switch_2 : BOOL; b Switch_3 : BOOL; b Switch_4 : BOOL; b Switch_5 : BOOL; b Switch_6 : BOOL; b Switch_7 : BOOL; b Switch_8 : BOOL; b Switch_9 : BOOL; b Switch_10 : BOOL; b Switch_11 : BOOL; b Switch_12 : BOOL; b Switch_13 : BOOL; b Switch_14 : BOOL; b Switch Lighting Mode : BOOL; b Switch Blinding Mode : BOOL; b Feedback Lighting_1 : BOOL; b Feedback Lighting_2 : BOOL; b Feedback Lighting_3 : BOOL; b Feedback Lighting_4 : BOOL; b Feedback Lighting_5 : BOOL; b Feedback Lighting_6 : BOOL; b Feedback Lighting_7 : BOOL; b Feedback Lighting_8 : BOOL; b Feedback Lighting_9 : BOOL; b Feedback Lighting_10 : BOOL; b Feedback Lighting_11 : BOOL; b Feedback Lighting_12 : BOOL; b Feedback Lighting_13 : BOOL; b Feedback Lighting_14 : BOOL; n Feedback Lighting_1 : UINT; n Feedback Lighting_2 : UINT; n Feedback Lighting_3 : UINT; n Feedback Lighting_4 : UINT; n Feedback Lighting_5 : UINT; n Feedback Lighting_6 : UINT; n Feedback Lighting_7 : UINT; n Feedback Lighting_8 : UINT; n Feedback Lighting_9 : UINT; n Feedback Lighting_10 : UINT; 60 Version: 1.2.0 TF8010
## Page 61

Programming n Feedback Lighting_11 : UINT; n Feedback Lighting_12 : UINT; n Feedback Lighting_13 : UINT; n Feedback Lighting_14 : UINT; n Feedback Blind_1 : USINT; n Feedback Blind_2 : USINT; n Feedback Blind_3 : USINT; n Feedback Blind_4 : USINT; n Feedback Blind_5 : USINT; n Feedback Blind_6 : USINT; n Feedback Blind_7 : USINT; t Cycle Delay Dimm Time : TIME := t#500ms; t Operation Time : TIME := t#60s; b Switch_A, B: calls the saved Scene A or Scene B. b Switch_1..14: sets and calls the saved scenes. b Switch Lighting Mode: switches to the lighting mode. b Switch Blinding Mode: switches to the blinding mode. b Feedback Lighting_1..14: current status of the respective lamp. Return value from the dimmer function block FB_Dimmer1Switch() [} 37]. n Feedback Lighting_1..14: current control value of the respective lamp. Return value from the dimmer function block FB_Dimmer1Switch() [} 37]. n Feedback Blind_1..7: current control value of the respective blind. Return value from the blind function block FB_Venetian Blind Ex() [} 23]. t Cycle Delay Dimm Time: switching time between dimming and calling a scene. t Operation Time: if the blinding or lighting mode is active and no operation takes place, the mode is automatically switched back to scene mode after the expiry of this time. VAR_OUTPUT b Enable Lighting Mode : BOOL; b Enable Blinding Mode : BOOL; b Switch Lighting_1 : BOOL; b Switch Lighting_2 : BOOL; b Switch Lighting_3 : BOOL; b Switch Lighting_4 : BOOL; b Switch Lighting_5 : BOOL; b Switch Lighting_6 : BOOL; b Switch Lighting_7 : BOOL; b Switch Lighting_8 : BOOL; b Switch Lighting_9 : BOOL; b Switch Lighting_10 : BOOL; b Switch Lighting_11 : BOOL; b Switch Lighting_12 : BOOL; b Switch Lighting_13 : BOOL; b Switch Lighting_14 : BOOL; b Switch Blind Up_1 : BOOL; b Switch Blind Down_1 : BOOL; b Switch Blind Up_2 : BOOL; b Switch Blind Down_2 : BOOL; b Switch Blind Up_3 : BOOL; b Switch Blind Down_3 : BOOL; b Switch Blind Up_4 : BOOL; b Switch Blind Down_4 : BOOL; b Switch Blind Up_5 : BOOL; b Switch Blind Down_5 : BOOL; b Switch Blind Up_6 : BOOL; b Switch Blind Down_6 : BOOL; b Switch Blind Up_7 : BOOL; b Switch Blind Down_7 : BOOL; b Invoke Scene_A : BOOL; b Invoke Scene_B : BOOL; b Invoke Scene_1 : BOOL; b Invoke Scene_2 : BOOL; b Invoke Scene_3 : BOOL; b Invoke Scene_4 : BOOL; b Invoke Scene_5 : BOOL; b Invoke Scene_6 : BOOL; TF8010 Version: 1.2.0 61
## Page 62

Programming b Invoke Scene_7 : BOOL; b Invoke Scene_8 : BOOL; b Invoke Scene_9 : BOOL; b Invoke Scene_10 : BOOL; b Invoke Scene_11 : BOOL; b Invoke Scene_12 : BOOL; b Invoke Scene_13 : BOOL; b Invoke Scene_14 : BOOL; b Save Scene_A : BOOL; b Save Scene_B : BOOL; b Save Scene_1 : BOOL; b Save Scene_2 : BOOL; b Save Scene_3 : BOOL; b Save Scene_4 : BOOL; b Save Scene_5 : BOOL; b Save Scene_6 : BOOL; b Save Scene_7 : BOOL; b Save Scene_8 : BOOL; b Save Scene_9 : BOOL; b Save Scene_10 : BOOL; b Save Scene_11 : BOOL; b Save Scene_12 : BOOL; b Save Scene_13 : BOOL; b Save Scene_14 : BOOL; b LEDSwitch_1 : BOOL; b LEDSwitch_2 : BOOL; b LEDSwitch_3 : BOOL; b LEDSwitch_4 : BOOL; b LEDSwitch_5 : BOOL; b LEDSwitch_6 : BOOL; b LEDSwitch_7 : BOOL; b LEDSwitch_8 : BOOL; b LEDSwitch_9 : BOOL; b LEDSwitch_10 : BOOL; b LEDSwitch_11 : BOOL; b LEDSwitch_12 : BOOL; b LEDSwitch_13 : BOOL; b LEDSwitch_14 : BOOL; b LEDLighting Mode : BOOL; b LEDBlinding Mode : BOOL; b Enable Lighting Mode: enables the memory function block FB_Scenes Lighting() [} 63]. b Enable Blinding Mode: enables the memory function block FB_Scenes Venetian Blind() [} 66]. b Switch Lighting_1..14: output for operating the dimmer function block FB_Dimmer1Switch() [} 37] via the input b Switch Dimm. b Switch Blind Up_1..7: output for operating the blind function block FB_Venetian Blind Ex() [} 23] via the input b Switch Over Up. b Switch Blind Down_1..7: output for operating the blind function block FB_Venetian Blind Ex() [} 23] via the input b Switch Over Down. b Invoke Scene_A, B, 1..14: output signal for loading a scene. Is passed on to the function blocks FB_Scenes Lighting() [} 63] und FB_Scenes Venetian Blind() [} 66]. b Save Scene_A, B, 1..14: output signal for saving a scene. Is passed on to the function blocks FB_Scenes Lighting() [} 63] und FB_Scenes Venetian Blind() [} 66]. b LEDSwitch_1..14: these outputs indicate the status of the respective lighting (on/off) or shading (0%/ 100%). These outputs are always FALSE in scene mode. b LEDLighting Mode: this output is TRUE if lighting mode is active. b LEDBlinding Mode: this output is TRUE if blinding mode is active. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 62 Version: 1.2.0 TF8010
## Page 63

Programming 4.1.6.2 FB_Scenes Lighting TF8010 Version: 1.2.0 63
## Page 64

Programming This function block is intended for the management of lighting scenes. The function block is enabled via the b Enable input. The loading of the saved scenes is started by a positive edge at the b Enable input. The input must remain TRUE until the operation is completed. The values of the scenes are saved non-volatile in the Twin CAT Boot directory as a *.bin file. The last data status is saved in a *.bak file as a backup. Save scene The values of the inputs n Actual Value Lighting_1..14 are saved in the respective scene by a rising edge at the input b Save Scene_1...16. Load scenes The saved values are output at the output n Dimm Value_1..14 by a rising edge at the input b Invoke Scene_1..16. Furthermore, a positive edge is generated at output b Set Dimm Value_1..14 for a PLC cycle. VAR_INPUT b Enable : BOOL; b Invoke Scene_1 : BOOL; b Invoke Scene_2 : BOOL; b Invoke Scene_3 : BOOL; b Invoke Scene_4 : BOOL; b Invoke Scene_5 : BOOL; b Invoke Scene_6 : BOOL; b Invoke Scene_7 : BOOL; b Invoke Scene_8 : BOOL; b Invoke Scene_9 : BOOL; b Invoke Scene_10 : BOOL; b Invoke Scene_11 : BOOL; b Invoke Scene_12 : BOOL; b Invoke Scene_13 : BOOL; b Invoke Scene_14 : BOOL; b Invoke Scene_15 : BOOL; b Invoke Scene_16 : BOOL; b Save Scene_1 : BOOL; b Save Scene_2 : BOOL; b Save Scene_3 : BOOL; b Save Scene_4 : BOOL; b Save Scene_5 : BOOL; b Save Scene_6 : BOOL; b Save Scene_7 : BOOL; b Save Scene_8 : BOOL; b Save Scene_9 : BOOL; b Save Scene_10 : BOOL; b Save Scene_11 : BOOL; b Save Scene_12 : BOOL; b Save Scene_13 : BOOL; b Save Scene_14 : BOOL; b Save Scene_15 : BOOL; b Save Scene_16 : BOOL; n Actual Value Lighting_1 : UINT; n Actual Value Lighting_2 : UINT; n Actual Value Lighting_3 : UINT; n Actual Value Lighting_4 : UINT; n Actual Value Lighting_5 : UINT; n Actual Value Lighting_6 : UINT; n Actual Value Lighting_7 : UINT; n Actual Value Lighting_8 : UINT; n Actual Value Lighting_9 : UINT; n Actual Value Lighting_10 : UINT; n Actual Value Lighting_11 : UINT; n Actual Value Lighting_12 : UINT; n Actual Value Lighting_13 : UINT; n Actual Value Lighting_14 : UINT; s File : STRING; n Options : UDINT; b Enable: enables the function block. b Invoke Scene_1..16: calls the respective scene. b Save Scene_1..16: saves the current analog value n Actual Value Lighting_1..14 in the respective scene. 64 Version: 1.2.0 TF8010
## Page 65

Programming n Actual Value Lighting_1..14: current control value of the respective lamp. Return value from the dimmer function block FB_Dimmer1Switch() [} 37]. s File: file name (without path and file extension) for saving the scenes. The file name must be unique in the entire project. If several instances of the function blocks FB_Scenes Lighting() or FB_Scenes Venetian Blind() [} 66] are created, then each instance must use a different file name. The file is always saved to the Twin CAT Boot directory and is given the extension .bin. Example: 'Control Panel A'. n Options: Reserved for future developments. VAR_OUTPUT b Set Dimm Value_1 : BOOL; n Dimm Value_1 : UINT; b Set Dimm Value_2 : BOOL; n Dimm Value_2 : UINT; b Set Dimm Value_3 : BOOL; n Dimm Value_3 : UINT; b Set Dimm Value_4 : BOOL; n Dimm Value_4 : UINT; b Set Dimm Value_5 : BOOL; n Dimm Value_5 : UINT; b Set Dimm Value_6 : BOOL; n Dimm Value_6 : UINT; b Set Dimm Value_7 : BOOL; n Dimm Value_7 : UINT; b Set Dimm Value_8 : BOOL; n Dimm Value_8 : UINT; b Set Dimm Value_9 : BOOL; n Dimm Value_9 : UINT; b Set Dimm Value_10 : BOOL; n Dimm Value_10 : UINT; b Set Dimm Value_11 : BOOL; n Dimm Value_11 : UINT; b Set Dimm Value_12 : BOOL; n Dimm Value_12 : UINT; b Set Dimm Value_13 : BOOL; n Dimm Value_13 : UINT; b Set Dimm Value_14 : BOOL; n Dimm Value_14 : UINT; b Init : BOOL; b Error : BOOL; n Error Id : UDINT; b Set Dimm Value_1..14: output with the edge for the input b Set Dimm Value of the function block FB_Dimmer1Switch() [} 37]. n Dimm Value_1..14: Output with the value for the input n Dimm Value of the function block FB_Dimmer1Switch() [} 37]. b Init: this output goes TRUE as soon as the initialization of the function block is complete. b Error: this output is set to TRUE as soon as an error is detected during execution. The error code is contained in n Error Id. n Error Id: contains the error code as soon as b Error goes TRUE. See Error codes [} 92]. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 TF8010 Version: 1.2.0 65
## Page 66

Programming 4.1.6.3 FB_Scenes Venetian Blind This function block is intended for the management of blind scenes. The function block is enabled via the b Enable input. The loading of the saved scenes is started by a positive edge at the b Enable input. The input must remain TRUE until the operation is completed. The values of the scenes are saved non-volatile in the Twin CAT Boot directory as a *.bin file. The last data status is saved in a *.bak file as a backup. 66 Version: 1.2.0 TF8010
## Page 67

Programming Save scene The values of the inputs n Actual Value Blinding_1..7 are saved in the respective scene by a rising edge at the input b Save Scene_1...16. Load scenes The saved values are output at the output n Blind Value_1..7 by a rising edge at the input b Invoke Scene_1..16. Furthermore, a positive edge is generated at the output b Set Blind Value_1..7 for one PLC cycle. VAR_INPUT b Enable : BOOL; b Invoke Scene_1 : BOOL; b Invoke Scene_2 : BOOL; b Invoke Scene_4 : BOOL; b Invoke Scene_5 : BOOL; b Invoke Scene_6 : BOOL; b Invoke Scene_7 : BOOL; b Invoke Scene_8 : BOOL; b Invoke Scene_9 : BOOL; b Invoke Scene_10 : BOOL; b Invoke Scene_11 : BOOL; b Invoke Scene_12 : BOOL; b Invoke Scene_13 : BOOL; b Invoke Scene_14 : BOOL; b Invoke Scene_15 : BOOL; b Invoke Scene_16 : BOOL; b Save Scene_1 : BOOL; b Save Scene_2 : BOOL; b Save Scene_3 : BOOL; b Save Scene_4 : BOOL; b Save Scene_5 : BOOL; b Save Scene_6 : BOOL; b Save Scene_7 : BOOL; b Save Scene_8 : BOOL; b Save Scene_9 : BOOL; b Save Scene_10 : BOOL; b Save Scene_11 : BOOL; b Save Scene_12 : BOOL; b Save Scene_13 : BOOL; b Save Scene_14 : BOOL; b Save Scene_15 : BOOL; b Save Scene_16 : BOOL; n Actual Value Blinding_1 : UINT; n Actual Value Blinding_2 : USINT; n Actual Value Blinding_3 : USINT; n Actual Value Blinding_4 : USINT; n Actual Value Blinding_5 : USINT; n Actual Value Blinding_6 : USINT; n Actual Value Blinding_7 : USINT; s File : STRING; n Options : DWORD; b Enable: enables the function block. b Invoke Scene_1..16: calls the respective scene. b Save Scene_1..16: saves the current analog value n Actual Value Blinding_1..14 in the respective scene. n Actual Value Blinding_1..7: current control value of the respective blind. Return value from the blind function block FB_Venetian Blind Ex() [} 23]. s File: file name (without path and file extension) for saving the scenes. The file name must be unique in the entire project. If several instances of the function blocks FB_Scenes Lighting() [} 63] or FB_Scenes Venetian Blind() are created, then each instance must use a different file name. The file is always saved to the Twin CAT Boot directory and is given the extension .bin. Example: 'Control Panel A'. n Options: Reserved for future developments. TF8010 Version: 1.2.0 67
## Page 68

Programming VAR_OUTPUT b Set Blind Value_1 : BOOL; n Blind Value_1 : USINT; b Set Blind Value_2 : BOOL; n Blind Value_2 : USINT; b Set Blind Value_3 : BOOL; n Blind Value_3 : USINT; b Set Blind Value_4 : BOOL; n Blind Value_4 : USINT; b Set Blind Value_5 : BOOL; n Blind Value_5 : USINT; b Set Blind Value_6 : BOOL; n Blind Value_6 : USINT; b Set Blind Value_7 : BOOL; n Blind Value_7 : USINT; b Init : BOOL; b Error : BOOL; n Error Id : UDINT; b Set Blind Value_1..7: output with the edge for the input b Position of the function block FB_Venetian Blind Ex() [} 23]. n Blind Value_1..7: output with the value for the input n Set Position of the function block FB_Venetian Blind Ex() [} 23]. b Init: this output goes TRUE as soon as the initialization of the function block is complete. b Error: this output is set to TRUE as soon as an error is detected during execution. The error code is contained in n Error Id. n Error Id: contains the error code as soon as b Error goes TRUE. See Error codes [} 92]. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.7 Signal processing 4.1.7.1 FB_Short Long Click If the b Switch input is longer than the t Switch Time, the b Long Click output is set for one PLC cycle. Otherwise, the b Short Click output is set. VAR_INPUT b Switch : BOOL; t Switch Time : TIME := t#50ms; b Switch: Input signal. t Switch Time: Duration above which the input signal is to be interpreted as a long button press. VAR_OUTPUT b Short Click : BOOL; b Long Click : BOOL; b Short Click: Indicates a short push of the button. b Long Click: Indicates a long push of the button. 68 Version: 1.2.0 TF8010
## Page 69

Programming Example In the following example, two push buttons are used to control two different lamps. A switch is assigned to each lamp. If a button is pressed for longer than 500 ms, both lamps are switched off. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.7.2 FB_Signalling Contact The two inputs t Delay On Time and t Delay Off Time allow slow operation and slow release delays to be set. If a message signal is to be acknowledged before this time can be ended, this is done by means of the b Quit Signal input. The state of the signaling contact is communicated to the function block via the b Contact input. The state of the message signal is indicated by the n Signal State output. A message signal can adopt one of altogether 6 different states. Corresponding constants are defined in the library: Constant Description TCSIGNAL_INVALID The message signal still does not have a defined state. TCSIGNAL_SIGNALED The message signal is active. TCSIGNAL_RESET The message signal has been reset. TCSIGNAL_CONFIRMED The message signal is confirmed, but has not yet been reset. TCSIGNAL_SIGNALCON The message signal is active and confirmed. TCSIGNAL_RESETCON The message signal is confirmed and reset. VAR_INPUT t Delay On Time : TIME := t#100ms; t Delay Off Time : TIME := t#100ms; b Quit Signal : BOOL; b Contact : BOOL; t Delay On Time: Delay before setting the message signal. t Delay Off Time: Delay before resetting the message signal. b Quit Signal: Input to acknowledge message signal. TF8010 Version: 1.2.0 69
## Page 70

Programming b Contact: Input for the signaling contact. VAR_OUTPUT n Signal State : WORD; n Signal State: Message status. Examples A message signal requiring acknowledgement is implemented in the following example. The variable b Gate Alert represents the state of the message signal. If the output n Signal State has the value TCSIGNAL_SIGNALED or TCSIGNAL_RESET, the message is active. A positive edge at the b Quit Signal input acknowledges the message signal. The following example illustrates the simplest case. A message signal not requiring acknowledgement. The slow release delay allows the message signal to remain active for a certain time. The slow operation delay can be used, for example, to suppress contact bounce. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.7.3 FB_Single Double Click If the input signal is presented twice within the time t Switch Time, the b Double Click output is set for one PLC cycle. Otherwise, the b Single Click output is set. VAR_INPUT b Switch : BOOL; t Switch Time : TIME := t#500ms; 70 Version: 1.2.0 TF8010
## Page 71

Programming b Switch: Input signal. t Switch Time: Duration above which the input signal is to be interpreted as a double button press. VAR_OUTPUT b Single Click : BOOL; b Doublelick : BOOL; b Single Click: Indicates a single push of the button. b Doublelick: Indicates a double push of the button. Example In the following example, two switches are used to control two different lamps. A switch is assigned to each lamp. If a switch is pressed twice in rapid succession, both lamps are switched off. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.7.4 FB_Threshold Switch If the input signal exceeds the limit value f Upper Limit for the duration specified by t Upper Limit Delay, the output b Cross Upper Limit is set for one PLC cycle. The b Switching Signal output is also set. This remains set until the input signal passes below the value of f Lower Limit for the duration specified by t Lower Limit Delay. In this case, the output f Cross Lower Limit is set for one PLC cycle. VAR_INPUT f Signal : LREAL; f Lower Limit : LREAL := 16000; f Upper Limit : LREAL := 17000; t Lower Limit Delay : TIME := t#100ms; t Upper Limit Delay : TIME := t#100ms; f Signal: Input signal. f Lower Limit: Lower limit value. f Upper Limit: Upper limit value. t Lower Limit Delay: Switching delay when passing beyond the lower limit. TF8010 Version: 1.2.0 71
## Page 72

Programming t Upper Limit Delay: Switching delay when passing beyond the upper limit. VAR_OUTPUT b Switching Signal : BOOL; b Cross Lower Limit : BOOL; b Cross Upper Limit : BOOL; b Switching Signal: State depends on b Cross Lower Limit and b Cross Upper Limit. b Cross Lower Limit: Becomes TRUE for a cycle if f Lower Limit has fallen below the time t Lower Limit Delay. At the same time b Switching Signal becomes FALSE. b Cross Upper Limit: Becomes TRUE for a cycle if f Upper Limit is exceeded for the time t Upper Limit Delay. At the same time b Switching Signal becomes TRUE. Example In the following example, the two lamps can each be controlled with one switch. The two lamps are automatically switched in response to the outside brightness and the threshold switch. The lamps are switched on if the outside brightness is less than 1000 lux for 15 minutes. The lamps are switched off as soon as the brightness is greater than 2000 lux for more than 15 minutes. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8 Timer functions The timer function blocks are intended to trigger actions on certain days in the year/ month/ week. The action can be triggered via a start event or a start time and terminated via an end event, end time or duration. The following combinations are possible: 72 Version: 1.2.0 TF8010
## Page 73

Programming The grey-blue fields indicate the timer type. The day is determined by the periodicity (red fields) and further discretization (orange). A common feature of all function blocks is that they have the same start and end criteria (green). The start criterion relates to the selected day, the end criterion depends on the starting point. For each instance of a function block only one start and end criterion can be defined. To trigger several actions on the same day several instances of the function block are required. Time overlaps Time overlaps of two consecutive switch-on and switch-off criteria may occur in the same instance of the function block if the switching duration is not limited to less than 1 day. In this case a start event may be followed by another start event before the end of the preceding period. The following overlap scenarios are possible in the situation described above: Starttime / Endtime (type TOD, TOD) No overlap possible since for Starttime<Endtime the start and end point are on same day, and for Starttime>=Endtime the end point is assumed to be on the next day. This means that the duration is this limited to less than 1 day. Starttime / Duration (type TOD, TIME) Overlap is possible, since the duration is freely selectable and the TIME variable type can be up to 50 days. It would therefore be possible to trigger an action with a duration of 3 days on a daily basis. The action would never be completed since it would be constantly restarted. Starttime / End event (type TOD, BOOL) Overlap possible, since the end event is variable and cannot occur before the next start time. Start event / Endtime (type BOOL, TOD) TF8010 Version: 1.2.0 73
## Page 74

Programming Overlap may be possible. The end time is calculated when the start event occurs. If Starttime<Endtime the end time is on the same day. In this case no overlap is possible. On the other hand, if Starttime>=Endtime the end point is on the next day. An overlap occurs if the start is triggered on this day before the end of the previous action has been reached. Start event / Duration (type BOOL, TIME) Overlap is possible, since the duration is freely selectable and the TIME variable type can be up to 50 days. It would therefore be possible to trigger an action with a duration of 3 days on a daily basis. The action would never be completed since it would be constantly restarted. Start event / End event (type BOOL, BOOL) Overlap possible, since the end event is variable and cannot occur before the next start event. An overlap means that the control output b Out for the respective function block does not change to FALSE. Instead, the system waits for the next period end. However, since the intention may also be that the function blocks merely trigger an action, the edge output b Trigger On is also linked to the function blocks. Further documentation The following table contains an overview of the documentation for the individual function blocks: FB_Daily Scheduler() FB_Weekly Sched- FB_Monthly Sched- FB_Monthly Sched- FB_Yearly Sched- [} 74] uler() [} 75] uler1() [} 76] uler2() [} 77] uler() [} 78] switches every n-th switches every n-th switches in certain switches in certain switches on a day week on certain months (multiple months (multiple certain day of the weekdays (multiple selection possible) selection possible) year selection possible) on a certain day of on a certain day of the week the month Sample program A sample program [} 79] uses a daily switching function block (FB_Daily Scheduler) to illustrate how the function blocks have to be parameterized. 4.1.8.1 FB_Daily Scheduler Function block for triggering actions every n-th day of the year. The function block triggers switching when the switching time is passed. Subsequent modification of the switching events or the time is therefore not permitted. VAR_INPUT ui Periodicity : UINT; ui Begin : UINT; e Start End : E_Start End; st Start End : ST_Start End; st Systemtime : TIMESTRUCT; ui Periodicity: Periodicity or interval. May be within the range 1...365. ui Begin: Starting value for the day counter. May be within the range 1...365. 74 Version: 1.2.0 TF8010
## Page 75

Programming Example1: ui Periodicity = 5, ui Begin = 2: Switching events on 2 Jan., 7 Jan. 12 Jan. etc. Example2: ui Periodicity = 3, ui Begin = 1: Switching events on 1 Jan., 4 Jan. 7 Jan. etc. e Start End: Selection of the start/end definition (see E_Start End [} 93]). st Start End: Structure with the parameters defining the start and end. Unused variables, for example the duration for the selection of start/end time, are ignored internally (see ST_Start End [} 95]). st Systemtime: current time in TIMESTRUCT format. It is important to count every second. VAR_OUTPUT b Out : BOOL; b Trigger On : BOOL; b No Event Next Year : BOOL; b Error : BOOL; n Error Id : UDINT; b Out: Control output that is switched on or off by the start and end event. b Trigger On: Trigger output for switch-on events. This output is intended for logging switch-on events. If two switch-on events occur consecutively they would not be detected via the control output b Out, since this output would remain TRUE. See also time overlaps in the overview. b No Event Next Year: No day matching the parameterization was found within the next 366 days. b Error: This output is set to TRUE if the parameterization is faulty. The command-specific error code is contained in n Error Id. Reset to FALSE once the parameterization is correct. n Error Id: Contains the command-specific error code. Reset to 0 once the parameterization is correct. See Error codes [} 92]. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8.2 FB_Weekly Scheduler Function block for triggering actions on certain weekdays in each n-th week of the year. The function block triggers switching when the switching time is passed. Subsequent modification of the switching events or the time is therefore not permitted. VAR_INPUT ui Periodicity : UINT; ui Begin : UINT; arr Active Weekday : ARRAY[0..6] OF BOOL; TF8010 Version: 1.2.0 75
## Page 76

Programming e Start End : E_Start End; st Start End : ST_Start End; st Systemtime : TIMESTRUCT; ui Periodicity: Periodicity or interval. May be within the range 1...52. ui Begin: Starting value for the week. May be within the range 1...52. Example1: ui Periodicity = 5, ui Begin = 2: Switching events in week 2, week 7, week 12 etc. Example 2: ui Periodicity = 3, ui Begin = 1: Switching events in week 1, week 4, week 7 etc. arr Active Weekday: Day of the week on which switching is to take place - arr Active Weekday[0] => Sunday .. arr Active Weekday[6] => Saturday. Multiple selections are possible. e Start End: Selection of the start/end definition (see E_Start End [} 93]). st Start End: Structure with the parameters defining the start and end. Unused variables, for example the duration for the selection of start/end time, are ignored internally (see ST_Start End [} 95]). st Systemtime: Current time in TIMESTRUCT format. It is important to count every second. VAR_OUTPUT b Out : BOOL; b Trigger On : BOOL; b No Event Next Year : BOOL; b Error : BOOL; n Error Id : UDINT; b Out: Control output that is switched on or off by the start and end event. b Trigger On: Trigger output for switch-on events. This output is intended for logging switch-on events. If two switch-on events occur consecutively they would not be detected via the control output b Out, since this output would remain TRUE. See also time overlaps in the overview. b No Event Next Year: No day matching the parameterization was found within the next 366 days. b Error: This output is set to TRUE if the parameterization is faulty. The command-specific error code is contained in n Error Id. Reset to FALSE once the parameterization is correct. n Error Id: Contains the command-specific error code. Reset to 0 once the parameterization is correct. See Error codes [} 92]. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8.3 FB_Monthly Scheduler1 Function block for triggering actions on a certain day of the week in certain months. 76 Version: 1.2.0 TF8010
## Page 77

Programming The function block triggers switching when the switching time is passed. Subsequent modification of the switching events or the time is therefore not permitted. VAR_INPUT arr Active Month : ARRAY[1..12] OF BOOL; ui Active Weekday : UINT; e Start End : E_Start End; st Start End : ST_Start End; st Systemtime : TIMESTRUCT; arr Active Month: Month in which an action is to be triggered - arr Active Month[1]=>January .. arr Active Month[12]=>December. Multiple selections are possible. ui Active Weekday: Day of the week on which an action is to be triggered in the selected months. 0=Sunday ... 6=Saturday. Multiple selections are not possible; the maximum value is 6 e Start End: Selection of the start/end definition (see E_Start End [} 93]). st Start End: Structure with the parameters defining the start and end. Unused variables, for example the duration for the selection of start/end time, are ignored internally (see ST_Start End [} 95]). st Systemtime: Current time in TIMESTRUCT format. It is important to count every second. VAR_OUTPUT b Out : BOOL; b Trigger On : BOOL; b No Event Next Year : BOOL; b Error : BOOL; n Error Id : UDINT; b Out: Control output that is switched on or off by the start and end event. b Trigger On: Trigger output for switch-on events. This output is intended for logging switch-on events. If two switch-on events occur consecutively they would not be detected via the control output b Out, since this output would remain TRUE. See also time overlaps in the overview. b No Event Next Year: No day matching the parameterization was found within the next 366 days. b Error: This output is set to TRUE if the parameterization is faulty. The command-specific error code is contained in n Error Id. Reset to FALSE once the parameterization is correct. n Error Id: Contains the command-specific error code. Reset to 0 once the parameterization is correct. See Error codes [} 92]. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8.4 FB_Monthly Scheduler2 Function block for triggering actions on a certain day in certain months. TF8010 Version: 1.2.0 77
## Page 78

Programming The function block triggers switching when the switching time is passed. Subsequent modification of the switching events or the time is therefore not permitted. VAR_INPUT arr Active Month : ARRAY[1..12] OF BOOL; ui Active Weekday : UINT; e Start End : E_Start End; st Start End : ST_Start End; st Systemtime : TIMESTRUCT; arr Active Month: Month in which an action is to be triggered - arr Active Month[1]=>January ... arr Active Month[12]=>December. Multiple selections are possible. ui Active Day: Day of the month on which an action is to be triggered. Multiple selections are not possible. e Start End: Selection of the start/end definition (see E_Start End [} 93]). st Start End: Structure with the parameters defining the start and end. Unused variables, for example the duration for the selection of start/end time, are ignored internally (see ST_Start End [} 95]). st Systemtime: Current time in TIMESTRUCT format. It is important to count every second. VAR_OUTPUT b Out : BOOL; b Trigger On : BOOL; b No Event Next Year : BOOL; b Error : BOOL; n Error Id : UDINT; b Out: Control output that is switched on or off by the start and end event. b Trigger On: Trigger output for switch-on events. This output is intended for logging switch-on events. If two switch-on events occur consecutively they would not be detected via the control output b Out, since this output would remain TRUE. See also time overlaps in the overview. b No Event Next Year: No day matching the parameterization was found within the next 366 days. b Error: This output is set to TRUE if the parameterization is faulty. The command-specific error code is contained in n Error Id. Reset to FALSE once the parameterization is correct. n Error Id: Contains the command-specific error code. Reset to 0 once the parameterization is correct. See Error codes [} 92]. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8.5 FB_Yearly Scheduler Function block for triggering actions on a certain day of the year. 78 Version: 1.2.0 TF8010
## Page 79

Programming The function block triggers switching when the switching time is passed. Subsequent modification of the switching events or the time is therefore not permitted. VAR_INPUT ui Month : UINT; ui Day : UINT; e Start End : E_Start End; st Start End : ST_Start End; st Systemtime : TIMESTRUCT; ui Month: Month in which an action is to be triggered. Multiple selections are not possible. ui Day: Day on which an action is to be triggered. Multiple selections are not possible. e Start End: Selection of the start/end definition (see E_Start End [} 93]). st Start End: Structure with the parameters defining the start and end. Unused variables, for example the duration for the selection of start/end time, are ignored internally (see ST_Start End [} 95]). st Systemtime: Current time in TIMESTRUCT format. It is important to count every second. VAR_OUTPUT b Out : BOOL; b Trigger On : BOOL; b No Event Next Year : BOOL; b Error : BOOL; n Error Id : UDINT; b Out: Control output that is switched on or off by the start and end event. b Trigger On: Trigger output for switch-on events. This output is intended for logging switch-on events. If two switch-on events occur consecutively they would not be detected via the control output b Out, since this output would remain TRUE. See also time overlaps in the overview. b No Event Next Year: No day matching the parameterization was found within the next 366 days. b Error: This output is set to TRUE if the parameterization is faulty. The command-specific error code is contained in n Error Id. Reset to FALSE once the parameterization is correct. n Error Id: Contains the command-specific error code. Reset to 0 once the parameterization is correct. See Error codes [} 92]. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8.6 Timer program example The following program example uses a day timer to illustrate how the function blocks should be parameterized, particularly with regard to the inputs e Start End, st Start End and st System Time. We recommend using the function block NT_Get Time, which is available in the library Tc2_Utilities, for reading the system time in PC- and CX-based systems. A program for reading might look as follows: TF8010 Version: 1.2.0 79
## Page 80

Programming It provides a timebase for parameterizing the scheduler function blocks with regard to the time input st System Time. The enumerator matching the required behavior is created at input e Start End: e STARTTIME_ENDTIME Start criterion: Time - End criterion: Time e STARTTIME_DURATION Start criterion: Time - End criterion: Duration e STARTTIME_ENDEVENT Start criterion: Time - End criterion: Event (boolean input) e STARTEVENT_ENDTIME Start criterion: Event (boolean input) - End criterion: Time e STARTEVENT_DURATION Start criterion: Event (boolean input) - End criterion: Duration e STARTEVENT_ENDEVENT Start criterion: Event (boolean input) - End criterion: Event (boolean input) For the input st Start End a structure variable of the same type has to be declared that is referred to in the example as st Start End. The program then describes the subvariables of this structure, which are important for the function type. For the example shown, these are tod Start Time and t Duration. All other variables are not read and therefore do not have to be described. 80 Version: 1.2.0 TF8010
## Page 81

Programming Both programs have to be called in the MAIN function block. The program part P_Scheduler Example may only be called once the program part P_System Time supplies valid data, i.e. once P_System Time Valid is TRUE. The reason for this protective logic is that reading the time takes several cycles which means that the time when the program starts is invalid and must not be used. If the program starts on 1 January, the sequences is as follows: The days on which actions are triggered start with the 2nd of the year (ui Begin:=2). The process is repeated every three days (ui Periodicity:=3). The switch-on time is 15:00 (st Start End.tod Start Time:=tod#15:00:00) and the switching duration is 6 hours (st Start End.t Duration:=t#6h). TF8010 Version: 1.2.0 81
## Page 82

Programming 4.1.8.7 FB_Weekly Time Switch The two parameters t Switch On Time and t Switch Off Time define a time period during which the output b Output is to be active. If the timer is only to apply on certain days of the week, this can be set via the inputs b Sunday, b Monday, ..., b Saturday. Several time channels can be switched by creating several instances of the function block. Each instance is responsible for one time channel. VAR_INPUT b Enable : BOOL; t Current Date Time : DATE_AND_TIME; t Switch On Time : TOD; t Switch Off Time : TOD; b Sunday : BOOL; b Monday : BOOL; b Tuesday : BOOL; b Wednesday : BOOL; b Thursday : BOOL; b Friday : BOOL; b Saturday : BOOL; b Enable: Function block enable. t Current Date Time: current date and time. t Switch On Time: switch-on time. t Switch Off Time: switch-off time. b Sunday: consider timer on Sundays. b Monday: consider timer on Mondays. b Tuesday: consider timer on Tuesdays. b Wednesday: consider timer on Wednesdays. b Thursday: consider timer on Thursdays. b Friday: consider timer on Fridays. b Saturday: consider timer on Saturdays. VAR_OUTPUT b Output : BOOL; b Edge On : BOOL; b Edge Off : BOOL; b Output: output becomes TRUE if the current time is between the switch-on time and the switch-off time. b Edge On: the output is set to TRUE for one PLC cycle when the time channel becomes active. b Edge Off: the output is set to TRUE for one PLC cycle when the time channel becomes deactivated. 82 Version: 1.2.0 TF8010
## Page 83

Programming Example In the following example, the blinds are to be raised at 6.30 a.m. at weekends and lowered at 7.00 p.m. The two timer outputs b Edge On and b Edge Off are linked to the inputs b Up and b Down of the blind function block. The pulses from the outputs then trigger raising or lowering of the blinds at the specified time. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8.8 FB_Calc Sun Position Calculation of sun position based on the date, time, longitude and latitude. Description The position of the sun for a given point in time can be calculated according to common methods with a defined accuracy. For applications with moderate requirements, the present function block is sufficient. As the basis for this, the SUNAE algorithm was used, which represents a favorable compromise between accuracy and computing effort. The position of the sun at a fixed observation point is normally determined by specifying two angles. One angle indicates the height above the horizon, where 0° means that the sun is in the horizontal plane of the observation site and 90° means that the sun is directly over the observer's head. The other angle indicates the direction in which the sun is standing. The SUNAE algorithm is used to distinguish whether the observer is standing on the northern hemisphere (longitude > 0 degrees) or on the southern hemisphere (longitude < 0 degrees) of the earth. If the observation point is in the northern hemisphere, a value of 0° is assigned for TF8010 Version: 1.2.0 83
## Page 84

Programming the northern direction of the sun and then moves clockwise around the compass, i.e. 90° is east, 180° is south, 270° west, etc. If the observation point is in the southern hemisphere, 0° corresponds to the southern direction and moves counterclockwise, i.e. 90° is east, 180° is north, 270° is west, etc. In specifying the time, the time according to Greenwich Mean Time (GMT) must be given. The latitude is specified as the distance of a place on the surface of the earth from the equator to the north or to the south in degrees. The latitude can assume a value from 0° (at the equator) to ±90° (at the poles). A positive sign thereby indicates a northern direction and a negative sign a southern direction. The longitude is an angle that can assume values up to ±180° starting from the prime meridian 0° (an artificially determined North-South line). A positive sign indicates a longitude in an eastern direction and a negative sign in a western direction. Examples: Location Longitude Latitude Sydney, Australia 151.2° -33.9° New York, USA 74.0° 40.7° London, England -0.1° 51.5° Moscow, Russia 37.6° 55.7° Beijing, China 116.3° 39.9° Dubai, United Arab Emirates 55.3° 25.4° Rio de Janeiro, Brazil -43.2° -22.9° Hawaii, USA -155.8° 20.2° Verl, Germany 8.5° 51.9° If the function block FB_Calc Sun Position() returns a negative value for the height of the sun (f Sun Elevation), then the sun is not visible. This can be used to determine sunrise and sunset. VAR_INPUT f Degree Of Longitude : LREAL := 8.5; f Degree Of Latitude : LREAL := 51.9; dt GMT : TIMESTRUCT; f Degree Of Longitude: Longitude in degrees. f Degreeof Latitude: Latitude in degrees. dt GMT: Current time as Greenwich Mean Time (GMT). VAR_OUTPUT f Sun Azimuth : LREAL; f Sun Elevation : LREAL; 84 Version: 1.2.0 TF8010
## Page 85

Programming f Sun Azimuth: Direction of the sun (northern hemisphere: 0° north ... 90° east ... 180° south ... 270° west ... / southern hemisphere: 0° south ... 90° east ... 180° north ... 270° west ...). f Sun Elevation: Height of the sun (0° horizontal ... 90° vertical). Example PROGRAM MAIN VAR fb Calc Sun Position : FB_Calc Sun Position; f Sun Azimuth : LREAL; f Sun Elevation : LREAL; fb Get System Time : GETSYSTEMTIME; file Time : T_FILETIME; END_VAR fb Get System Time(time Lo DW=>file Time.dw Low Date Time, time Hi DW=>file Time.dw High Date Time); fb Calc Sun Position( f Degree Of Longitude := 8.5, f Degree Of Latitude := 51.9, dt GMT := FILETIME_TO_SYSTEMTIME(file Time)); f Sun Azimuth := fb Calc Sun Position.f Sun Azimuth; f Sun Elevation := fb Calc Sun Position.f Sun Elevation; Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8.9 FB_Calc Sunrise Sunset Function block for calculating sunrise and sunset based on the longitude, latitude, reference meridian and time. The earth is divided into several time zones. Each time zone is associated with a reference meridian. Reference meridian for some of the time zones: Time zone Reference meridian GMT (Greenwich Mean Time) λ = 0° GMT CET (Central European Time) λ = 15° CET CEST (Central European Summer Time) λ = 30° CEST In specifying the time, the time according to Greenwich Mean Time (GMT) must be given. This function block is only available in the PC version of the library. VAR_INPUT f Degree Of Longitude : LREAL := 8.5; f Degree Of Latitude : LREAL := 51.9; f Reference Meridian : LREAL; d Current Date : DATE; f Degree Of Longitude: Longitude in degrees. f Degreeof Latitude: Latitude in degrees. TF8010 Version: 1.2.0 85
## Page 86

Programming f Reference Meridian: Reference meridian of the time zone. d Current Date: current date. VAR_OUTPUT tod Sunrise : TOD; tod Sunset : TOD; tod Sunrise: Sunrise. Output of hour and minute. tod Sunset: Sunset. Output of hour and minute. Example PROGRAM MAIN VAR fb Calc Sunrise Sunset : FB_Calc Sunrise Sunset; tod Sunrise : TOD; tod Sunset : TOD; fb Get System Time : GETSYSTEMTIME; file Time : T_FILETIME; dt Current Date : DT;END_VAR fb Get System Time(time Lo DW =>file Time.dw Low Date Time, time Hi DW =>file Time.dw High Date Time); dt Current Date := FILETIME_TO_DT(file Time); fb Calc Sunrise Sunset( f Degree Of Longitude := 8.5, (* Longitude of Verl *) f Degree Of Latitude := 51.9, (* Latitude of Verl *) f Reference Meridian := 30.0, (* Central European Summer Time *) d Current Date := DT_TO_DATE(dt Current Date), tod Sunrise => tod Sunrise, tod Sunset => tod Sunset); Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 86 Version: 1.2.0 TF8010
## Page 87

Programming 4.1.8.10 FB_Calc Public Holidays DE German holidays for the current year are calculated based on the date entered. A boolean output indicates whether the entered date matches one of the calculated holidays. To ensure international readability the function block was translated into English. The parameters have the following meaning: TF8010 Version: 1.2.0 87
## Page 88

Programming English name German name New Years Day Neujahr Epiphany Heilige Drei Könige Good Friday Karfreitag Easter Sunday Ostersonntag Easter Monday Ostermontag Labor Day Maifeiertag Ascension Day Christi Himmelfahrt Whit Sunday Pfingstsonntag Whit Monday Pfingstmontag Corpus Christi Fronleichnam Assumption Day Mariä Himmelfahrt German Unification Day Tag Der Deutschen Einheit Reformation Day Reformationstag All Saints Day Allerheiligen Penance Day Buß- und Bettag Christmas Eve Heiligabend 1st Christmas Day 1. Weihnachtstag 2nd Christmas Day 2. Weihnachtstag New Years Eve Silvester VAR_INPUT d Current Date : DATE; d Current Date: current date. VAR_OUTPUT d New Years Day : DATE; d Epiphany : DATE; d Good Friday : DATE; d Easter Sunday : DATE; d Easter Monday : DATE; d Labour Day : DATE; d Ascension Day : DATE; d Whit Sunday : DATE; d Whit Monday : DATE; d Corpus Christi : DATE; d Assumption Day : DATE; d German Unification Day : DATE; d Reformation Day : DATE; d All Saints Day : DATE; d Penance Day : DATE; d Christmas Eve : DATE; d1st Christmas Day : DATE; d2nd Christmas Day : DATE; d New Years Eve : DATE; b New Years Day : BOOL; b Epiphany : BOOL; b Good Friday : BOOL; b Easter Sunday : BOOL; b Easter Monday : BOOL; b Labour Day : BOOL; b Ascension Day : BOOL; b Whit Sunday : BOOL; b Whit Monday : BOOL; b Corpus Christi : BOOL; b Assumption Day : BOOL; b German Unification Day : BOOL; b Reformation Day : BOOL; b All Saints Day : BOOL; b Penance Day : BOOL; b Christmas Eve : BOOL; b1st Christmas Day : BOOL; b2nd Christmas Day : BOOL; b New Years Eve : BOOL; 88 Version: 1.2.0 TF8010
## Page 89

Programming dxxxxxx: Date of the respective holiday. bxxxxxx: Boolean statement indicating whether today is the respective holiday. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8.11 FB_Calc Public Holidays US Calculation of the United States public holidays. US public holidays for the current year are calculated based on the date entered. A boolean output indicates whether the entered date matches one of the calculated holidays. To ensure international readability the function block was translated into English. The parameters have the following meaning: TF8010 Version: 1.2.0 89
## Page 90

Programming English name German New Year's Day Neujahr Martin Luther King "JR" Day Martin Luther King Tag Presidents Day Tag der Präsidenten Good Friday Karfreitag Easter Sunday Ostersonntag Memorial Day Gedenktag Independence Day Unabhängigkeitstag Labor Day Maifeiertag Columbus Day Kolumbus-Tag Veterans Day Veteranentag Thanksgiving Day Erntedank Thanksgiving Friday Schwarzer Friday (Freitag nach Erntedank) Christmas Eve Heiligabend Christmas Day Weihnachtstag New Years Eve Silvester VAR_INPUT d Current Date : DATE; d Current Date: current date. VAR_OUTPUT d New Years Day : DATE; d Epiphany : DATE; d Good Friday : DATE; d Easter Sunday : DATE; d Easter Monday : DATE; d Labour Day : DATE; d Ascension Day : DATE; d Whit Sunday : DATE; d Whit Monday : DATE; d Corpus Christi : DATE; d Assumption Day : DATE; d German Unification Day : DATE; d Reformation Day : DATE; d All Saints Day : DATE; d Penance Day : DATE; d Christmas Eve : DATE; d1st Christmas Day : DATE; d2nd Christmas Day : DATE; d New Years Eve : DATE; b New Years Day : BOOL; b Epiphany : BOOL; b Good Friday : BOOL; b Easter Sunday : BOOL; b Easter Monday : BOOL; b Labour Day : BOOL; b Ascension Day : BOOL; b Whit Sunday : BOOL; b Whit Monday : BOOL; b Corpus Christi : BOOL; b Assumption Day : BOOL; b German Unification Day : BOOL; b Reformation Day : BOOL; b All Saints Day : BOOL; b Penance Day : BOOL; b Christmas Eve : BOOL; b1st Christmas Day : BOOL; b2nd Christmas Day : BOOL; b New Years Eve : BOOL; dxxxxxx: Date of the respective holiday. bxxxxxx: Boolean statement indicating whether today is the respective holiday. 90 Version: 1.2.0 TF8010
## Page 91

Programming Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.8.12 FB_Calc Federal Holidays US US federal holidays for the current year are calculated based on the date entered. A boolean output indicates whether the entered date matches one of the calculated holidays. To ensure international readability the function block was translated into English. The parameters have the following meaning: English name German name New Years Day Neujahr Martin Luther King "JR" Day Martin Luther King Tag Presidents Day Tag der Präsidenten Memorial Day Gedenktag Independence Day Unabhängigkeitstag Labor Day Labor Day Columbus Day Kolumbus-Tag Veterans Day Veteranentag Thanksgiving Day Erntedank Christmas Day Weihnachtstag VAR_INPUT d Current Date : DATE; d Current Date: current date. VAR_OUTPUT d New Years Day : DATE; d Martin Luther King Jr Day : DATE; d Presidents Day : DATE; TF8010 Version: 1.2.0 91
## Page 92

Programming d Memorial Day : DATE; d Independence Day : DATE; d Labor Day : DATE; d Columbus Day : DATE; d Veterans Day : DATE; d Thanksgiving Day : DATE; d Christmas Day : DATE; d New Years Day : BOOL; d Martin Luther King Jr Day : BOOL; d Presidents Day : BOOL; d Memorial Day : BOOL; d Independence Day : BOOL; d Labor Day : BOOL; d Columbus Day : BOOL; d Veterans Day : BOOL; d Thanksgiving Day : BOOL; d Christmas Day : BOOL;; dxxxxxx: Date of the respective holiday. bxxxxxx: Boolean statement indicating whether today is the respective holiday. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.1.9 Error Codes Value (hex) Value (dec) Description 0x0000 0 No error. 0x0001 1 FB_Maximum Demand Controller() [} 16]: -- reserved error code -- 0x0002 2 FB_Maximum Demand Controller() [} 16]: The input parameter f Meter Constant is "0". 0x0003 3 FB_Light Control() [} 49] : The switch range (n Switch Range) in the first or second element of the value table arr Control Table is 0. It is thus assumed that the table has only one value set or none at all. 0x0004 4 FB_Light Control() [} 49] : 2 neighboring input values n Actual Value in the value table arr Control Table lie too close together i.e. each in the switching range of the other. 0x0005 5 FB_Sequencer() [} 52] : The start index n Start Index is outside of the valid range [1..50]. 0x0006 6 FB_Sequencer() [} 52] : The start index n Start Index refers to a point that, for its part, marks the end of a sequence (zero entries). 0x0007 7 Scheduler function blocks: An input parameter is not in the valid range. 0x0008 8 Scheduler function blocks: None is set for the selection parameters (weekly time clock: selection of weekdays, monthly time clocks: selection of months). 0x0009 9 Scheduler function blocks: A day in the month was selected that is not valid. 0x000A 10 FB_Constant Light Control Eco() [} 33] : Input parameter n Min Level is greater than or equal to n Max Level. 0x000B 11 FB_Scenes Lighting() [} 63], FB_Scenes Venetian Blind() [} 66]: Input parameter s File is invalid (empty). 0x000C 12 FB_Scenes Lighting() [} 63], FB_Scenes Venetian Blind() [} 66]: Internal error. File with the scene values was not found. 0x000D 13 FB_Scenes Lighting() [} 63], FB_Scenes Venetian Blind() [} 66]: Internal error: No further free file handles available. 92 Version: 1.2.0 TF8010
## Page 93

Programming 4.2 DUTs 4.2.1 Enumerations 4.2.1.1 E_Start End TYPE E_Start End : ( e STARTTIME_ENDTIME := 1, e STARTTIME_DURATION := 2, e STARTTIME_ENDEVENT := 3, e STARTEVENT_ENDTIME := 4, e STARTEVENT_DURATION := 5, e STARTEVENT_ENDEVENT := 6 ) INT := Undefined; END_TYPE e STARTTIME_ENDTIME: Selection of start/end time. If the start time is equal or greater the end time, the end is allocated to the next day. e STARTTIME_DURATION: Selection of start time/duration. e STARTTIME_ENDEVENT: Selection of start time/end event. e STARTEVENT_ENDTIME: Selection of start event/end time. If the start time is equal or greater the end time, the end is allocated to the next day. e STARTEVENT_DURATION: Selection of start event/duration. e STARTEVENT_ENDEVENT: Selection of start event/end event. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.2.2 Structures 4.2.2.1 ST_Control Table TYPE ST_Control Table : STRUCT n Actual Value : UINT; n Control Value : UINT; n Switch Range : UINT; END_STRUCT END_TYPE n Actual Value: Current brightness. n Control Value: Corresponding switch point (control value). n Switch Range: Threshold value around the input value interpolation point at which switching takes place. The entry “0” marks the beginning of the unused area of the table. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.2.2.2 ST_MDCIn Data KL1501 TYPE ST_MDCIn Data KL1501 : STRUCT n Status : USINT; n Dummy1 : USINT; TF8010 Version: 1.2.0 93
## Page 94

Programming n Dummy2 : USINT; n Dummy3 : USINT; n Data : DWORD; END_STRUCT END_TYPE Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.2.2.3 ST_MDCLoad Parameters TYPE ST_MDCLoad Parameters : STRUCT b Connected : BOOL; n Degree Of Priority : INT; t MINPower On Time : TIME; t MAXPower Off Time : TIME; END_STRUCT END_TYPE b Connected: TRUE = consumer connected; FALSE = consumer not connected. n Degree Of Priority: Indicates the switch-off priority; consumers with a low priority will be switched off first. ( 1 => low; ... 8 => high priority) t MINPower On Time: The minimum power-on time (minimum ramp-up time) during which the consumer may not be switched off. t MINPower Off Time: The minimum power-off time (recovery time) during which the consumer may not be switched on again. t MAXPower Off Time: The maximum power-off time after which the consumer must be switched on again. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.2.2.4 ST_MDCOut Data KL1502 TYPE ST_MDCOut Data KL1501 : STRUCT n Ctrl : USINT; n Dummy1 : USINT; n Dummy2 : USINT; n Dummy3 : USINT; n Data : DWORD; END_STRUCT END_TYPE Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.2.2.5 ST_Sequence Table TYPE ST_Sequence Table : STRUCT n Target Value : UINT; t Ramp Time : TIME; t Prolong Time : TIME; END_STRUCT END_TYPE n Target Value: Target value. 94 Version: 1.2.0 TF8010
## Page 95

Programming t Ramp Time: Time to reach the target value. t Prolong Time: Dwell time at the target value. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.2.2.6 ST_Start End TYPE ST_Start End : STRUCT tod Start Time : TOD; b Start Event : BOOL; t Duration : TIME; tod End Time : TOD; b End Event : BOOL; END_STRUCT END_TYPE tod Start Time: Start time. b Start Event: Start event t Duration: Switching duration. tod End Time: End time. b End Event: End event. Requirements Development environment Required PLC library Twin CAT from v3.1.4020.32 Tc2_BABasic from v3.1.0.0 4.3 GVLs 4.3.1 Constants VAR_GLOBAL CONSTANT TCSIGNAL_INVALID : WORD := 16#0000; TCSIGNAL_SIGNALED : WORD := 16#0001; TCSIGNAL_RESET : WORD := 16#0002; TCSIGNAL_CONFIRMED : WORD := 16#0010; TCSIGNAL_SIGNALCON : WORD := 16#0011; TCSIGNAL_RESETCON : WORD := 16#0012; OPTION_INIFINITE_LOOP : DWORD := 16#0000_0001; END_VAR TF8010 Version: 1.2.0 95
## Page 96

Appendix 5 Appendix 5.1 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 96 Version: 1.2.0 TF8010
## Page 97

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Third-party trademark statements Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 98

Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
