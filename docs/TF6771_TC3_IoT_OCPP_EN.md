---
title: "TF6771 Twin CAT 3"
product: "TF6771"
category: "IoT"
tags: ["CAT", "IoT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.1.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6771_TC3_IoT_OCPP_EN.pdf"
release_date: "2024-10-31"
---
Manual | EN TF6771 Twin CAT 3 | Io T OCPP 2024-10-31 | Version: 1.1.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 1.4 Documentation issue status.............................................................................................................. 7 2 Overview.................................................................................................................................................... 8 3 Installation............................................................................................................................................... 11 3.1 System requirements...................................................................................................................... 11 3.2 Installation....................................................................................................................................... 11 3.3 Licensing......................................................................................................................................... 11 4 Technical introduction............................................................................................................................ 14 4.1 OCPP.............................................................................................................................................. 14 4.2 Terminology.................................................................................................................................... 14 4.3 Supported functions........................................................................................................................ 15 4.4 Quick Start...................................................................................................................................... 15 4.5 Logging........................................................................................................................................... 19 5 PLC API.................................................................................................................................................... 21 5.1 POUs............................................................................................................................................... 21 5.1.1 FB_OCPP1_Client........................................................................................................... 21 5.1.2 FB_OCPP1_Server.......................................................................................................... 76 5.1.3 FB_OCPP1_Station....................................................................................................... 131 5.1.4 FB_OCPP1_Charging Profile.......................................................................................... 180 5.1.5 FB_OCPP1_Configuration............................................................................................. 182 5.2 DUTs............................................................................................................................................. 189 5.2.1 Enumerations................................................................................................................. 189 5.2.2 Properties....................................................................................................................... 198 5.2.3 Types............................................................................................................................. 202 5.3 GVLs............................................................................................................................................. 209 5.3.1 Param_OCPP................................................................................................................ 209 6 Samples................................................................................................................................................. 210 7 Appendix................................................................................................................................................ 211 7.1 Hash calculation............................................................................................................................ 211 7.2 Configuration Keys........................................................................................................................ 211 7.3 Troubleshooting............................................................................................................................ 212 TF6771 Version: 1.1.0 3
## Page 4

Table of contents 4 Version: 1.1.0 TF6771
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. For installation and commissioning of the components, it is absolutely necessary to observe the documentation and the following notes and explanations. The qualified personnel is obliged to always use the currently valid documentation. The responsible staff must ensure that the application or use of the products described satisfies all requirements for safety, including all the relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. No claims to modify products that have already been supplied may be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of designations or trademarks used in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Patents The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 and similar applications and registrations in several other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document as well as the use and communication of its contents without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. TF6771 Version: 1.1.0 5
## Page 6

Foreword Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.1.0 TF6771
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. 1.4 Documentation issue status Version Change 1.1.0 New: Troubleshooting [} 212] TF6771 Version: 1.1.0 7
## Page 8

Overview 2 Overview With the Twin CAT Function TF6771 Io T OCPP, Twin CAT can act both as an OCPP client and as an OCPP server. The use cases are explained in more detail below. Product components The function TF6771 Io T OCPP consists of the following components, which can be used from Twin CAT version 3.1.4026.x: • Driver: Tc Iot Ocpp.tmx (included in the installation of TF6771. Iot OCPP. XAE) • PLC library: Tc3_OCPP (included in the installation of TF6771. Iot OCPP. XAE) TF6771 Io T OCPP is only installed on the engineering. As soon as a project is loaded onto the target system, the TMX driver is copied with the project files. Use cases Four categories of use cases can be mapped using TF6771. This includes use as an OCPP client, use as an OCPP server, implementation of an OCPP gateway and enabling an OCPP retrofit. Terminology The two versions of the OCPP protocol considered in this documentation use different terms. • In version 1.6, the name for the charging station is Charge Point, whereas in version 2.0.1 the name is Charging Station. • In version 1.6, the name for the higher-level management system is Central System, while in version 2.0.1 the name is Charging Station Management System (CSMS). • For ease of understanding, the terms from OCPP version 2.0.1 are used in the following description of the use cases and the associated graphics. Use case 1: Twin CAT Charging Station In the first use case, a Charging Station is automated with a Beckhoff control system. In addition to the TF6771 software, the EL6761 Ether CAT Terminal is used for this purpose. The following graphic illustrates use in conjunction with the EL6761. On the software side, the Charging Station automated with Twin CAT is connected to a CSMS as an OCPP client. Communication in the direction of the vehicle to be charged is realized via the EL6761. 8 Version: 1.1.0 TF6771
## Page 9

Overview Use case 2: OCPP retrofit In the second use case, existing Charging Stations without OCPP support are retrofitted for OCPP communication. In existing charging infrastructure, there may be Charging Stations that do not provide their information via OCPP. For example, there are Charging Stations that distribute information via Modbus TCP. This information can then be collected within Twin CAT and sent to the CSMS on behalf of the Charging Station. To do this, Twin CAT acts as an OCPP client and pretends to be the Charging Station that is to be retrofitted. Use case 3: Local CSMS Twin CAT can also be used to implement a local CSMS. Here Twin CAT acts as an OCPP server to which any number of Charging Stations can connect. At this point, all CSMS functions must be implemented locally. In addition to defining charging profiles, this also includes authentication and billing - if these functions are required. TF6771 Version: 1.1.0 9
## Page 10

Overview Use case 4: OCPP gateway The implementation of an OCPP gateway is also possible. Here Twin CAT acts both as an OCPP client and as an OCPP server. In such cases, the higher-level CSMS, which is cloud-based in most cases, is often used for authentication and billing. In this case, Twin CAT behaves mainly as a communication switch and forwards messages from the OCPP clients to the higher-level CSMS and vice versa. However, it is also possible to implement local load management via the local OCPP server in the OCPP gateway. Among other things, this can be advantageous due to the information available locally in the control system about the power grid at a location. 10 Version: 1.1.0 TF6771
## Page 11

Installation 3 Installation 3.1 System requirements Technical data Description Operating system Windows 7/10, Windows Embedded Standard 7, Twin CAT/BSD Target platform PC architecture (x86, x64 or ARM) Twin CAT Version Twin CAT 3.1 Build 4026.3 or higher Required Twin CAT setup level Twin CAT 3 XAE, XAR Required Twin CAT license TF6771 TC3 Io T OCPP 3.2 Installation Twin CAT Package Manager If you are using Twin CAT 3.1 Build 4026 (and higher) on the Microsoft Windows operating system, you can install this function via the Twin CAT Package Manager, see Installation documentation. Normally you install the function via the corresponding workload; however, you can also install the packages contained in the workload individually. This documentation briefly describes the installation process via the workload. Command line program Tc Pkg You can use the Tc Pkg Command Line Interface (CLI) to display the available workloads on the system: tcpkg list -t workload You can use the following command to install the workload of the TF6771 Iot OCPP Function. tcpkg install TF6771. Iot OCPP. XAE Twin CAT Package Manager UI You can use the User Interface (UI) to display all available workloads and install them if required. To do this, follow the corresponding instructions in the interface. 3.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. TF6771 Version: 1.1.0 11
## Page 12

Installation 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 12 Version: 1.1.0 TF6771
## Page 13

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. TF6771 Version: 1.1.0 13
## Page 14

Technical introduction 4 Technical introduction 4.1 OCPP The Open Charge Point Protocol (OCPP) is a standardized communication protocol that is used between charging stations for electric vehicles (EVSEs) and a central management system (CSMS). It is an open and vendor-independent standard that enables broad interoperability between different vendors of charging stations and the associated management system. Technically, the OCPP protocol establishes a Web Sockets connection between the OCPP client and the OCPP server. The protocol stipulates that an OCPP request can originate from both the client and the server. 4.2 Terminology The following is a brief explanation of some terms that are important for understanding this documentation. For a more detailed understanding of the OCPP protocol and an explanation of other terms from the OCPP protocol, the OCPP specification must be consulted. The first table explains the most important terms for a basic understanding of the components: Term Explanation Charging Station (2.0.1) The Charging Station is the physical system at which an electric vehicle can be charged. A Charging Station has one or more EVSEs. A Charging Station has the name Charge Point in OCPP version 1.6. Central System (1.6) Term for the central management system. This term is replaced by CSMS in version 2.0.1 of the OCPP specification. Charge Point (1.6) The Charge Point is the physical system at which an electric vehicle can be charged. A Charge Point has one or more Connectors. A Charge Point has the name Charging Station in OCPP version 2.0.1. Connector According to the OCPP specification, a Connector is an independently operated and managed socket at a Charge Point. CSMS (Charging Station Management Term for the central management system. This term replaces System) (2.0.1) the term Central System from version 1.6 of the OCPP specification. EVSE (2.0.1) An EVSE is considered an independently operated and managed part of the Charging Station that can supply energy to one vehicle at a time. The second table contains further explanations of terms relating to the OCPP protocol: 14 Version: 1.1.0 TF6771
## Page 15

Technical introduction Term Explanation Charging Profile Generic Charging Profile that is used for different types of profiles. Contains information about the profile and contains the Charging Schedule. Charging Schedule Part of a Charging Profile. Defines a block of limit values for the charging power or the charging current. Can contain a start time and a length. Charging Schedule Period Specific time period in a Charging Schedule. A Charging Schedule contains one or more Charging Schedule Periods. Configuration Key Configurable setting in a Charge Point/Charging Station. Local Authorization List The Local Authorization List enables the Charge Point/Charging Station to authorize charging processes even if it is temporarily unable to communicate with the Central System/CSMS. Meter Value Container for one or more Sampled Values at a specific point in time. Sampled Value Single sampled value that can contain various data. Transaction (1.6) The part of the charging process that begins when all relevant preconditions (e.g. authorization, plug inserted) are met. It ends the moment the charge point leaves this state irrevocably. Transaction (2.0.1) A transaction in OCPP is a part of the overall charging process of an electric vehicle that starts and ends based on configurable parameters. These configurable parameters relate to moments in the charging process, such as connecting the electric vehicle or the authorization of the driver. Unknown Offline Authorization The Charge Point/Charging Station has the option of admitting unknown users in an offline situation and checking their authorization afterwards. 4.3 Supported functions Supported versions and data formats The OCPP protocol in version 1.6 provides for either a SOAP-based data format or a JSON-based data format. In version 2.0.1 of the protocol, only the JSON variant is supported. The following table shows the support in this implementation of the TF6771. OCPP version Support? OCPP1.6S (SOAP) No OCPP1.6J (JSON) Yes OCPP2.0.1J (JSON) To follow 4.4 Quick Start The following chapter provides a quick start to the Twin CAT 3 Io T OCPP function. In these instructions, you will set up an OCPP client and an OCPP server and allow them to communicate with each other in a simplified form. Further functionalities can be found in the other sample projects. Exemplary implementation For reasons of simplicity, security is not taken into account in this Quick Start. In real applications, secure implementation should always be a central component of the considerations. Initialization OCPP client During initialization, either the function block can be used directly or an existing Tc COM object can be linked. In this Getting Started, initialization is carried out via the function block. TF6771 Version: 1.1.0 15
## Page 16

Technical introduction // Client param st Client Param : ST_OCPP1_Client Param :=(s Host:='127.0.0.1', n Port:=8080, s Identity:='Test Id ent', s Path:='ocpp', e Debug Level:=E_OCPP_Debug Level. Message Log File, e Trace Level:=Tc Trace Level.tl Verb ose); fb Client : FB_OCPP1_Client(st Client Param); e Action : E_OCPP1_Action; h Message Id : T_OCPP_Message Id; In this case, the OCPP client connects to the OCPP server also running on the same device at port 8080. For demonstration purposes, both the logfile is created and the Trace Level is increased. This is not absolutely necessary in normal operation. Details on logging can be found in the chapter Logging [} 19]. Initialization OCPP server // Server param st Server Param : ST_OCPP1_Server Param := (n Port:=8080, e Auth Mode:=E_OCPP1_Authentication Mode. None, e Encryption Mode := E_OCPP_Encryption Mode. None, e Debug Level:=E_OCPP_Debug Level. Message Log File, e Trace Level:=Tc Trace Level.tl Verbose); fb Ocpp Server : FB_OCPP1_Server(st Server Param); e Action : E_OCPP1_Action; h Message Id : T_OCPP_Message Id; h Station Id : UDINT; This OCPP server also runs on the local device, on port 8080. The logfile and Trace Level are also set here for demonstration purposes. Basic structure sample project In this Getting Started, a Twin CAT project is used in which both the OCPP client and the OCPP server are operated in a separate PLC project. The actions are initiated by the OCPP client. In a real scenario, actions are of course also triggered on the server side. 16 Version: 1.1.0 TF6771
## Page 17

Technical introduction Implementation OCPP client The sample includes two different processes on the client side. On the one hand, a simple Status Notification can be sent: // Send Status Notification IF b Send Status THEN b Send Status:=FALSE; e Error:=E_OCPP1_Charge Point Error. High Temperature; e Status:=E_OCPP1_Charge Point Status. Suspended EV; e Action:=E_OCPP1_Action. Status Notification; END_IF The values sent with the Status Notification can be adjusted using the e Error and e Status parameters. On the other hand, a streamlined process for simulated charging is implemented: // Charging sample CASE n State OF 0: IF b Start Charging THEN b Start Charging:=FALSE; e Action:=E_OCPP1_Action. Authorize; n State:=n State+1; END_IF 1: IF b Authorized THEN b Authorized:=FALSE; n Meter Start:=n Meter Stop; e Action:=E_OCPP1_Action. Start Transaction; n State:=n State+1; END_IF 2: IF b Charging Started THEN //10 seconds charging simulation timer Charge(IN:=TRUE); IF timer Charge. Q THEN b Charging Started:=FALSE; timer Charge(IN:=FALSE); n Meter Stop:=n Meter Start+10; e Action:=E_OCPP1_Action. Stop Transaction; n State:=n State+1; END_IF END_IF 3: IF b Charging Stopped THEN b Charging Stopped:=FALSE; n State:=0; END_IF END_CASE If the Charging Sample is started via b Start Charging, the client first calls the Authorize method. Following a successful Authorize, the Start Transaction method is then executed. After a successful Start Transaction, the system "loads" for 10 seconds and then executes a Stop Transaction. The specific OCPP communication is implemented via a CASE statement. The individual OCPP commands are implemented in this CASE statement: // Different OCPP commands implemented for OCPP client CASE e Action OF E_OCPP1_Action. None: IF NOT fb Client.b Error AND fb Client.b Valid THEN fb Client. Poll Request(h Message Id=> h Message Id, e Action=> e Action ); ELSE // Implement error handling here END_IF E_OCPP1_Action. Authorize: IF fb Client. Send Authorize(s Id Tag:=s Id Tag, e Status => st Id Tag Info.e Status) THEN IF st Id Tag Info.e Status = E_OCPP1_Authorization Status. Accepted THEN b Authorized := TRUE; e Action := E_OCPP1_Action. None; END_IF END_IF E_OCPP1_Action. Start Transaction: IF fb Client. Send Start Transaction(s Id Tag:=s Id Tag, n Connector Id:=n Connector Id, n Meter Start:=n M eter Start, e Status => st Id Tag Info.e Status, n Transaction Id => n Transaction Id) THEN IF st Id Tag Info.e Status = E_OCPP1_Authorization Status. Accepted THEN b Charging Started := TRUE; e Action := E_OCPP1_Action. None; END_IF END_IF TF6771 Version: 1.1.0 17
## Page 18

Technical introduction E_OCPP1_Action. Stop Transaction: IF fb Client. Send Stop Transaction(n Connector Id:=n Connector Id, n Meter Stop:=n Meter Stop, e Status => st Id Tag Info.e Status) THEN b Charging Stopped := TRUE; e Action := E_OCPP1_Action. None; END_IF E_OCPP1_Action. Status Notification: IF fb Client. Send Status Notification(n Connector Id:=n Connector Id, e Error, e Status) THEN e Action := E_OCPP1_Action. None; END_IF // Implement here more functionalities like: // E_OCPP1_Action. Trigger Message: ELSE e Action := E_OCPP1_Action. None; // not implemented... END_CASE Only the functions used for the sample are implemented here. Further functions would mean an extension of the CASE statement. Implementation OCPP server On the OCPP server side, the commands sent by the client are received and the appropriate response is sent: CASE e Action OF E_OCPP1_Action. None: IF NOT fb Ocpp Server.b Error AND fb Ocpp Server.b Valid THEN fb Ocpp Server. Poll Request(e Action => e Action, h Message Id => h Message Id, h Station Id => h St ation Id); ELSE // Implement error handling here END_IF E_OCPP1_Action. Boot Notification: IF fb Ocpp Server. Recv Boot Notification(h Station Id, h Message Id=>h Message Id, s Model => st Boot Notification.s Model, s Vendor => st Boot Notification.s Vendor, s Charge Box Serial => st Boot Notification.s Charge Box Serial, s Charge Point Serial => st Boot Notification.s Charge Point Serial, s Firmware Version => st Boot Notification.s Firmware Version, s Meter Serial => st Boot Notification.s Meter Serial, s Meter Type => st Boot Notification.s Meter Type) THEN fb Ocpp Server. Resp Boot Notification(h Station Id, h Message Id, E_OCPP1_Registration Status. Acc epted); e Action := E_OCPP1_Action. None; END_IF E_OCPP1_Action. Heartbeat: IF fb Ocpp Server. Recv Heartbeat(h Station Id) THEN fb Ocpp Server. Resp Heartbeat(h Station Id:=h Station Id,h Message Id:=h Message Id); e Action := E_OCPP1_Action. None; END_IF E_OCPP1_Action. Authorize: IF fb Ocpp Server. Recv Authorize(h Station Id, s Id Tag => s Id Tag) THEN IF s Id Tag='Test123' THEN fb Ocpp Server. Resp Authorize(h Station Id:=h Station Id, h Message Id:=h Message Id, E_OCPP1_A uthorization Status. Accepted); e Action := E_OCPP1_Action. None; END_IF END_IF E_OCPP1_Action. Start Transaction: IF fb Ocpp Server. Recv Start Transaction(h Station Id, h Message Id => h Message Id, s Id Tag => s Id Tag, n Connector Id => n Connector Id, n Meter Start => n Meter Start, n Timestamp => n Timestamp) THEN n Transaction Id:=n Transaction Id+1; fb Ocpp Server. Resp Start Transaction(h Station Id, h Message Id, E_OCPP1_Authorization Status. Ac cepted, n Transaction Id:=n Transaction Id); e Action := E_OCPP1_Action. None; END_IF E_OCPP1_Action. Stop Transaction: IF fb Ocpp Server. Recv Stop Transaction(h Station Id, h Message Id => h Message Id, s Id Tag => s Id Tag, n Transaction Id => n Transaction Id Recv, n Connector Id => n Connector Id, n Meter Stop => n Meter Stop, n Times tamp => n Timestamp, e Reason => e Reason) THEN fb Ocpp Server. Resp Stop Transaction(h Station Id, h Message Id, E_OCPP1_Authorization Status. Acc epted); e Action := E_OCPP1_Action. None; END_IF E_OCPP1_Action. Status Notification: IF fb Ocpp Server. Recv Status Notification(h Station Id, h Message Id => h Message Id, n Connector Id => 18 Version: 1.1.0 TF6771
## Page 19

Technical introduction n Connector Id Status, e Error => e Error, e Status => e Status) THEN fb Ocpp Server. Resp Status Notification(h Station Id, h Message Id); e Action := E_OCPP1_Action. None; END_IF END_CASE Compared to the client sample, two more functions are implemented here. The Heartbeat is sent internally by the client and can be configured via a Property on the function block. The Boot Notification is sent automatically when the client starts up and must therefore also be processed in the server. OCPP messages in server and client can also be implemented in the other direction. The server can send messages to the client. Conversely, the client can then receive these messages from the server. The logfile looks as follows after the client sample has been executed once (sending a Status Notification and executing the charging sample): 4.5 Logging Various logging functions are available to enable extended diagnostics. Twin CAT Output The first point to consider is the Twin CAT Output. Information is written here depending on the Trace Level. In the event of an error, you can first look there for a message corresponding to the error: The Trace Level can be adjusted via the structures ST_OCPP1_Client_Param [} 199] and ST_OCPP1_Server_Param [} 201]. This is not only possible at the start of the application, but also at runtime. To do this, the value must be changed and the respective Init method must be called by the client or server. The following table shows the different Tc Trace Levels and their effects: TF6771 Version: 1.1.0 19
## Page 20

Technical introduction Tc Trace Level Effect tl Always No messages are output via the Twin CAT Output. tl Error Only error messages are output. tl Warning Warnings and error messages are output. tl Info One-time status information, warnings, and error messages are output. tl Verbose All messages are output. This includes cyclic information, one- time status information, warnings and error messages. Logfile The second diagnostic option is to write a logfile. There are only two different options here, writing the logfile is either enabled or disabled. The Trace Level can be adjusted via the structures ST_OCPP1_Client_Param [} 199] and ST_OCPP1_Server_Param [} 201]. The OCPP messages are logged in the logfile. The following shows an example of an activated logfile in the OCPP client. The logfiles are stored in the Twin CAT boot directory: C:\Program Data\Beckhoff\Twin CAT\3.1\Boot\ Use of the logfile for debugging purposes only The logfile should only be used for debugging purposes. All OCPP messages are logged in the file so that large logfile sizes can be created over long periods of time. 20 Version: 1.1.0 TF6771
## Page 21

PLC API 5 PLC API 5.1 POUs 5.1.1 FB_OCPP1_Client This function block represents an OCPP client that can be connected to an OCPP server. There are two directions of communication. The send methods are used when sending requests to the server. In these methods, the response from the server is processed directly and stored in the output parameters of the methods. If, on the other hand, a request is received from the server using one of the Receive methods, the response must be sent using the appropriate Response method. The client sends an internal Heartbeat, the time interval of which can be adjusted using the Heartbeat Interval Property. If the client does not receive a response from the server to a Heartbeat, a Reconnect to the server is then attempted. For all other message types, a timeout error is output on the client function block if there is no response. Syntax FUNCTION BLOCK FB_OCPP1_Client VAR_OUTPUT b Valid : BOOL; b Busy : BOOL; b Error : BOOL; e Error Result : HRESULT; e Error Action : E_OCPP1_Action; END_VAR Outputs Name Type Description b Valid BOOL The interface to the driver in the background exists. b Busy BOOL Is TRUE as long as the function block is busy with processing. b Error BOOL Becomes TRUE when an error situation occurs. e Error Result HRESULT Last error present on the function block. e Error Action E_OCPP1_Action [} 189] OCPP command for which the error occurred. TF6771 Version: 1.1.0 21
## Page 22

PLC API Properties Name Type Access Description Heartbeat Interval TIME Get, Set Internal Heartbeat Interval from the client. Another Heartbeat can also be sent manually using the Send Heartbeat [} 69] method. With the internal Heartbeat Interval, it should be noted that the server responds in its Boot Notification.conf with a specified Heartbeat Interval for the client. This specified Heartbeat Interval is then set internally. However, the Heartbeat Interval can then be changed as required during runtime. Is Connected BOOL Get Status of the connection to the OCPP server. Is Pending BOOL Get Waiting for completion of the request. 5.1.1.1 Execute This method can be used to establish a connection or to disconnect a connection. No permanent call is required, only changes are transferred from b Connect to the driver. If a connection exists, FALSE is used to disconnect the connection; if a connection does not exist, TRUE is used to establish it. Syntax METHOD Execute : BOOL VAR_INPUT b Connect : BOOL; END_VAR Return value Name Type Description Execute BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 22 Version: 1.1.0 TF6771
## Page 23

PLC API Inputs Name Type Description b Connect BOOL If a connection exists, FALSE is used to disconnect the connection; if a connection does not exist, TRUE is used to establish it. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.2 FB_Exit Syntax METHOD FB_Exit : BOOL VAR_INPUT b In Copy Code : BOOL; END_VAR Return value Name Type Description FB_Exit BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description b In Copy Code BOOL If TRUE, the Exit method is called to exit an instance, which is then copied (online change). 5.1.1.3 FB_Init Syntax METHOD FB_Init : BOOL VAR_INPUT b Init Retains : BOOL; b In Copy Code : BOOL; st Param : REFERENCE TO ST_OCPP1_Client_Param REF=0; END_VAR TF6771 Version: 1.1.0 23
## Page 24

PLC API Return value Name Type Description FB_Init BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description b Init Retains BOOL If TRUE, the Retain variables are initialized (warm start/cold start). b In Copy Code BOOL If TRUE, the Exit method is called to exit an instance, which is then copied (online change). st Param REFERENCE TO Parameters for the Web Sockets ST_OCPP1_Client_Param [} 199] connection of the OCPP client. 5.1.1.4 Init This method is called when the function block is initialized in the FB_Init [} 23] method and specifies the parameters of the Web Sockets connection. If the connection parameters are to be changed afterwards, this method can be called again while the application is running. Syntax METHOD Init : BOOL VAR_INPUT st Param : REFERENCE TO ST_OCPP1_Client_Param; END_VAR Return value Name Type Description Init BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description st Param REFERENCE TO Parameters for the Web Sockets ST_OCPP1_Client_Param [} 199] connection of the OCPP client. 24 Version: 1.1.0 TF6771
## Page 25

PLC API 5.1.1.5 Init Boot Info This method can be used to set the Boot Notification sent by the OCPP client when an OCPP connection is established. If this method is not called after starting the application, default values are used. More detailed information can be found in ST_OCPP1_Client_Boot Info [} 198]. Syntax METHOD Init Boot Info : BOOL VAR_IN_OUT CONSTANT st Boot Info : ST_OCPP1_Client_Boot Info; END_VAR Return value Name Type Description Init Boot Info BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs/outputs Name Type Description st Boot Info ST_OCPP1_Client_Boot Info [} 198] Boot Info for the OCPP client. 5.1.1.6 Init Options This method can be used to set various options for the OCPP client. If this method is not called after starting the application, default values are used. More detailed information can be found in ST_OCPP1_Client_Options [} 199]. Syntax METHOD Init Options : BOOL VAR_IN_OUT CONSTANT st Options : ST_OCPP1_Client_Options; END_VAR Return value Name Type Description Init Options BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 25
## Page 26

PLC API Inputs/outputs Name Type Description st Options ST_OCPP1_Client_Options [} 199] Options for the OCPP client. 5.1.1.7 Init Settings This method can be used to make various settings for the OCPP client. If this method is not called after starting the application, default values are used. More detailed information can be found in ST_OCPP1_Client_Settings [} 200]. Syntax METHOD Init Settings : BOOL VAR_IN_OUT CONSTANT st Settings : ST_OCPP1_Client_Settings; END_VAR Return value Name Type Description Init Settings BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs/outputs Name Type Description st Settings ST_OCPP1_Client_Settings [} 200] Settings for the OCPP client. 5.1.1.8 Poll Request This method must be called in order to receive incoming requests from the OCPP server. The outputs of the method return both the message ID of the received message and the information about which OCPP request it is. Syntax METHOD Poll Request : BOOL VAR_OUTPUT e Action : E_OCPP1_Action; h Message Id : T_OCPP_Message Id; END_VAR 26 Version: 1.1.0 TF6771
## Page 27

PLC API Return value Name Type Description Poll Request BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description e Action E_OCPP1_Action [} 189] Type of OCPP request received from the server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.9 Recv Cancel Reservation With this method, an OCPP client receives a Cancel Reservation request from the corresponding OCPP server. To respond to the request, the method Resp Cancel Reservation [} 47] must be called. Syntax METHOD Recv Cancel Reservation : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Reservation Id : UDINT; END_VAR TF6771 Version: 1.1.0 27
## Page 28

PLC API Return value Name Type Description Recv Cancel Reservation BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Reservation Id UDINT ID of the reservation to be canceled. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.10 Recv Change Availability With this method, an OCPP client receives a Change Availability request from the corresponding OCPP server. To respond to the request, the method Resp Change Availability [} 48] must be called. Syntax METHOD Recv Change Availability : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; e Type : E_OCPP1_Availability Type; END_VAR 28 Version: 1.1.0 TF6771
## Page 29

PLC API Return value Name Type Description Recv Change Availability BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. e Type E_OCPP1_Availability Type [} 190] Type of availability change that the Charge Point is to carry out. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.11 Recv Change Configuration With this method, an OCPP client receives a Change Configuration request from the corresponding OCPP server. To respond to the request, the method Resp Change Configuration [} 49] must be called. Syntax METHOD Recv Change Configuration : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Key : T_OCPP1_Config Key; s Value : T_OCPP1_Config Value; END_VAR TF6771 Version: 1.1.0 29
## Page 30

PLC API Return value Name Type Description Recv Change Configuration BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Key T_OCPP1_Config Key [} 208] Name of the Configuration Key to be changed. e Type T_OCPP1_Config Value [} 208] New value for the Configuration Key. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.12 Recv Clear Cache With this method, an OCPP client receives a Clear Cache request from the corresponding OCPP server. To respond to the request, the method Resp Clear Cache [} 50] must be called. Syntax METHOD Recv Clear Cache : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; END_VAR 30 Version: 1.1.0 TF6771
## Page 31

PLC API Return value Name Type Description Recv Clear Cache BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.13 Recv Clear Charging Profile With this method, an OCPP client receives a Clear Charging Profile request from the corresponding OCPP server. To respond to the request, the method Resp Clear Charging Profile [} 51] must be called. Syntax METHOD Recv Clear Charging Profile : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Profile Id : UDINT; n Connector Id : UDINT; e Charging Profile Purpose : E_OCPP1_Charging Profile Purpose Type; n Stack Level : UDINT; END_VAR Return value Name Type Description Recv Clear Charging Profile BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 31
## Page 32

PLC API Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Profile Id UDINT ID of the Charging Profile to be deleted. n Connector Id UDINT ID of the Connector of a Charge Point for which the Charging Profiles are to be deleted. e Charging Profile Purpose E_OCPP1_Charging Profile Purpose T Specifies the Charging Profile Purpose Type ype [} 191] whose Charging Profiles are to be deleted. n Stack Level UDINT Specifies the Stack Level for which Charging Profiles are to be deleted if all other criteria in the request are met. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.14 Recv Data Transfer With this method, an OCPP client receives a Data Transfer request from the corresponding OCPP server. To respond to the request, the method Resp Data Transfer [} 52] must be called. Syntax METHOD Recv Data Transfer : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Vendor Id : STRING(255); s Message Id : STRING(63); END_VAR VAR_IN_OUT s Data : T_OCPP1_Data Transfer Data; END_VAR 32 Version: 1.1.0 TF6771
## Page 33

PLC API Return value Name Type Description Recv Data Transfer BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Vendor Id STRING(255) Identifier for the vendor, which identifies the vendor-specific implementation. s Message Id STRING(63) Additional identification field for a single message. Inputs/outputs Name Type Description s Data T_OCPP1_Data Transfer Data [} 208] Text without specified length and format. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.15 Recv Get Composite Schedule With this method, an OCPP client receives a Get Composite Schedule request from the corresponding OCPP server. To respond to the request, the method Resp Get Composite Schedule [} 53] must be called. Syntax METHOD Recv Get Composite Schedule : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; n Duration : UDINT; e Charging Rate Unit : E_OCPP1_Charging Rate Unit Type; END_VAR TF6771 Version: 1.1.0 33
## Page 34

PLC API Return value Name Type Description Recv Get Composite Schedule BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. n Duration UDINT Time of the requested schedule in seconds. e Charging Rate Unit E_OCPP1_Charging Rate Unit Type Can optionally be used to specify the unit of the requested schedule. [} 192] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.16 Recv Get Configuration With this method, an OCPP client receives a Get Configuration request from the corresponding OCPP server. To respond to the request, the method Resp Get Configuration [} 54] must be called. Syntax METHOD Recv Get Configuration : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Keys Count : UDINT := 0; a Keys : ARRAY[1.. Param_OCPP.n Config Keys Max] OF T_OCPP1_Config Key; END_VAR 34 Version: 1.1.0 TF6771
## Page 35

PLC API Return value Name Type Description Recv Get Configuration BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Keys Count UDINT Number of Configuration Keys following in this message. a Keys ARRAY[1.. Param_OCPP List of Configuration Keys for which the value of the configuration is [} 209].n Config Keys Max] OF requested. T_OCPP1_Config Key [} 208] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.17 Recv Get Diagnostics With this method, an OCPP client receives a Get Diagnostics request from the corresponding OCPP server. To respond to the request, the method Resp Get Diagnostics [} 55] must be called. TF6771 Version: 1.1.0 35
## Page 36

PLC API Syntax METHOD Recv Get Diagnostics : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Location : STRING(255); n Retries : UDINT; n Retry Interval : UDINT; n Start Time : ULINT; n Stop Time : ULINT; END_VAR Return value Name Type Description Recv Get Diagnostics BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Location STRING(255) Contains the directory to which the diagnostic file is to be uploaded. n Retries UDINT Optionally contains the number of attempts the Charge Point has made to upload the file. n Retry Interval UDINT Optionally contains the number of seconds after which the upload is retried. n Start Time ULINT Optionally marks the oldest point in time to be integrated into the diagnostic file. n Stop Time ULINT Optionally marks the most recent point in time to be integrated into the diagnostic file. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.18 Recv Get Local List Version With this method, an OCPP client receives a Get Local List Version request from the corresponding OCPP server. To respond to the request, the method Resp Get Local List Version [} 56] must be called. 36 Version: 1.1.0 TF6771
## Page 37

PLC API Syntax METHOD Recv Get Local List Version : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Recv Get Local List Version BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.19 Recv Local List With this method, an OCPP client receives a Send Local List request from the corresponding OCPP server. To respond to the request, the method Resp Local List [} 57] must be called. TF6771 Version: 1.1.0 37
## Page 38

PLC API Syntax METHOD Recv Local List : BOOL VAR_IN_OUT a Auth List : ARRAY[*] OF ST_OCPP1_Authorization Data; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; n List Version : UDINT; e Update Type : E_OCPP1_Update Type; n Auth Count : UDINT := 0; END_VAR Return value Name Type Description Recv Local List BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs/outputs Name Type Description a Auth List ARRAY[*] OF List of authorized ID tags. ST_OCPP1_Authorization Data [} 202] Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n List Version UDINT Contains the version number of the new list in the case of a complete update and the version number of the list after the update in the case of a differential update. e Update Type E_OCPP1_Update Type [} 197] Information on whether a complete or incremental update should be carried out. n Auth Count UDINT Number of following entries in the Local Authorization List. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.20 Recv Remote Start Transaction With this method, an OCPP client receives a Remote Start Transaction request from the corresponding OCPP server. To respond to the request, the method Resp Remote Start Transaction [} 58] must be called. 38 Version: 1.1.0 TF6771
## Page 39

PLC API Syntax METHOD Recv Remote Start Transaction : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; s Id Token : T_OCPP1_Id Token; END_VAR Return value Name Type Description Recv Remote Start Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. s Id Token T_OCPP1_Id Token [} 209] ID token of the Charge Point in the Central System. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.21 Recv Remote Stop Transaction With this method, an OCPP client receives a Remote Stop Transaction request from the corresponding OCPP server. To respond to the request, the method Resp Remote Stop Transaction [} 59] must be called. TF6771 Version: 1.1.0 39
## Page 40

PLC API Syntax METHOD Recv Remote Stop Transaction : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; END_VAR Return value Name Type Description Recv Remote Stop Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. The assignment of the Transaction Id sent by the server to the appropriate Connector is carried out internally by the OCPP driver and does not have to be observed separately by the user. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.22 Recv Reserve Now With this method, an OCPP client receives a Reserve Now request from the corresponding OCPP server. To respond to the request, the method Resp Reserve Now [} 60] must be called. 40 Version: 1.1.0 TF6771
## Page 41

PLC API Syntax METHOD Recv Reserve Now : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; n Expiry Date : ULINT; s Id Tag : T_OCPP1_Id Token; s Parent Id Tag : T_OCPP1_Id Token; n Reservation Id : UDINT; END_VAR Return value Name Type Description Recv Reserve Now BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT Contains the ID of the Connector to be reserved. n Expiry Date ULINT Date and time at which the reservation ends. s Id Tag T_OCPP1_Id Token [} 209] ID tag for which the Connector is to be reserved. s Parent Id Tag T_OCPP1_Id Token [} 209] Optional parent ID tag. n Reservation Id UDINT Unique ID for the reservation. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.23 Recv Reset With this method, an OCPP client receives a Reset request from the corresponding OCPP server. To respond to the request, the method Resp Reset [} 61] must be called. TF6771 Version: 1.1.0 41
## Page 42

PLC API Syntax METHOD Recv Reset : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; e Type : E_OCPP1_Reset Type; END_VAR Return value Name Type Description Recv Reset BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Type E_OCPP1_Reset Type [} 196] Type of reset that the Charge Point should perform. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.24 Recv Set Charging Profile With this method, an OCPP client receives a Set Charging Profile request from the corresponding OCPP server. To respond to the request, the method Resp Set Charging Profile [} 62] must be called. 42 Version: 1.1.0 TF6771
## Page 43

PLC API Syntax METHOD Recv Set Charging Profile : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; m Charging Profile : ST_OCPP1_Charging Profile Max; END_VAR Return value Name Type Description Recv Set Charging Profile BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. m Charging Profile ST_OCPP1_Charging Profile Max The Charging Profile to be used in the Charge Point. [} 204] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.25 Recv Trigger Message With this method, an OCPP client receives a Trigger Message request from the corresponding OCPP server. To respond to the request, the method Resp Trigger Message [} 63] must be called. TF6771 Version: 1.1.0 43
## Page 44

PLC API Syntax METHOD Recv Trigger Message : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; e Requested Message : E_OCPP1_Message Trigger; n Connector Id : UDINT; END_VAR Return value Name Type Description Recv Trigger Message BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Requested Message E_OCPP1_Message Trigger [} 194] Requested message that the Charge Point should send to the Central System. n Connector Id UDINT ID of the Connector of a Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.26 Recv Unlock Connector With this method, an OCPP client receives an Unlock Connector request from the corresponding OCPP server. To respond to the request, the method Resp Unlock Connector [} 64] must be called. 44 Version: 1.1.0 TF6771
## Page 45

PLC API Syntax METHOD Recv Unlock Connector : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; END_VAR Return value Name Type Description Recv Unlock Connector BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.27 Recv Update Firmware With this method, an OCPP client receives an Update Firmware request from the corresponding OCPP server. To respond to the request, the method Resp Update Firmware [} 64] must be called. TF6771 Version: 1.1.0 45
## Page 46

PLC API Syntax METHOD Recv Update Firmware : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Location : STRING(255); n Retries : UDINT; n Retry Interval : UDINT; n Retrieve Date : ULINT; END_VAR Return value Name Type Description Recv Update Firmware BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 46 Version: 1.1.0 TF6771
## Page 47

PLC API Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Location STRING(255) String with the URI from which the firmware is to be obtained. n Retries UDINT Optionally contains information on how often the Charge Point should try to download the firmware before it gives up. n Retry Interval UDINT Optionally contains the information after which time a new attempt should be made. n Retrieve Date ULINT Contains information on when the Charge Point is permitted to receive the new firmware. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.28 Reset This method is used to reset the last error present on the function block. Syntax METHOD Reset : BOOL Return value Name Type Description Reset BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 5.1.1.29 Resp Cancel Reservation With this method, an OCPP client responds to a Cancel Reservation request from the corresponding OCPP server. TF6771 Version: 1.1.0 47
## Page 48

PLC API Syntax METHOD Resp Cancel Reservation : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Cancel Reservation Status; END_VAR Return value Name Type Description Resp Cancel Reservation BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Cancel Reservation Status Response whether the Charge Point was able to perform the [} 190] requested cancellation. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.30 Resp Change Availability With this method, an OCPP client responds to a Change Availability request from the corresponding OCPP server. 48 Version: 1.1.0 TF6771
## Page 49

PLC API Syntax METHOD Resp Change Availability : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Availability Status; END_VAR Return value Name Type Description Resp Change Availability BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Availability Status [} 190] Response whether the Charge Point was able to implement the requested availability change. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.31 Resp Change Configuration With this method, an OCPP client responds to a Change Configuration request from the corresponding OCPP server. TF6771 Version: 1.1.0 49
## Page 50

PLC API Syntax METHOD Resp Change Configuration : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Configuration Status; END_VAR Return value Name Type Description Resp Change Availability BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Configuration Status Response whether the Charge Point was able to implement the [} 193] requested configuration change. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.32 Resp Clear Cache With this method, an OCPP client responds to a Clear Cache request from the corresponding OCPP server. 50 Version: 1.1.0 TF6771
## Page 51

PLC API Syntax METHOD Resp Clear Cache : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Clear Cache Status; END_VAR Return value Name Type Description Resp Clear Cache BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Clear Cache Status [} 192] Response whether the Charge Point has implemented the requested clearing of the cache. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.33 Resp Clear Charging Profile With this method, an OCPP client responds to a Clear Charging Profile request from the corresponding OCPP server. TF6771 Version: 1.1.0 51
## Page 52

PLC API Syntax METHOD Resp Clear Charging Profile : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Clear Charging Profile Status; END_VAR Return value Name Type Description Resp Clear Charging Profile BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Clear Charging Profile Statu Response whether the Charge Point was able to implement the s [} 192] requested clearing. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.34 Resp Data Transfer With this method, an OCPP client responds to a Data Transfer request from the corresponding OCPP server. 52 Version: 1.1.0 TF6771
## Page 53

PLC API Syntax METHOD Resp Data Transfer : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Data Transfer Status; END_VAR Return value Name Type Description Resp Data Transfer BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Data Transfer Status Response whether the Data Transfer request from the OCPP [} 193] server was successfully completed. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.35 Resp Get Composite Schedule With this method, an OCPP client responds to a Get Composite Schedule request from the corresponding OCPP server. Syntax METHOD Resp Get Composite Schedule : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Get Composite Schedule Status; n Connector Id : UDINT := 0; n Schedule Start : ULINT := 0; m Charging Schedule : REFERENCE TO ST_OCPP1_Charging Schedule REF= 0; END_VAR TF6771 Version: 1.1.0 53
## Page 54

PLC API Return value Name Type Description Resp Get Composite Schedule BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Get Composite Schedule St Response whether the Schedule could be queried on the Charge atus [} 194] Point side. n Connector Id UDINT Can optionally contain the ID of a Connector of a Charge Point. The returned Schedule would then apply to this Connector. n Schedule Start ULINT Optionally contains the time, all values contained here are displayed relative to this time. m Charging Schedule REFERENCE TO Optionally contains the planned ST_OCPP1_Charging Schedule Schedule over time. [} 205] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.36 Resp Get Configuration With this method, an OCPP client responds to a Get Configuration request from the corresponding OCPP server. Syntax METHOD Resp Get Configuration : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; n Keys Count : UDINT := 0; 54 Version: 1.1.0 TF6771
## Page 55

PLC API n Unknown Count : UDINT := 0; END_VAR VAR_IN_OUT CONSTANT a Keys : ARRAY[*] OF ST_OCPP1_Config Key Value; a Unknown : ARRAY[*] OF T_OCPP1_Config Key; END_VAR Return value Name Type Description Resp Get Configuration BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Keys Count UDINT Number of the following Configuration Keys. n Unknown Count UDINT Number of the following Unknown Configuration Keys. Inputs/outputs Name Type Description a Keys ARRAY[*] OF List of requested or known ST_OCPP1_Config Key Value [} 207] Configuration Keys. a Unknown ARRAY[*] OF T_OCPP1_Config Key Requested Configuration Keys that are not known. [} 208] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.37 Resp Get Diagnostics With this method, an OCPP client responds to a Get Diagnostics request from the corresponding OCPP server. TF6771 Version: 1.1.0 55
## Page 56

PLC API Syntax METHOD Resp Get Diagnostics : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; s File Name : STRING(255) := ''; END_VAR Return value Name Type Description Resp Get Diagnostics BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s File Name STRING(255) Optionally contains the file name of the diagnostic file that is uploaded. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.38 Resp Get Local List Version With this method, an OCPP client responds to a Get Local List Version request from the corresponding OCPP server. 56 Version: 1.1.0 TF6771
## Page 57

PLC API Syntax METHOD Resp Get Local List Version : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; n List Version : UDINT; END_VAR Return value Name Type Description Resp Get Local List Version BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n List Version UDINT Contains the current version number of the Local Authorization List in the Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.39 Resp Local List With this method, an OCPP client responds to a Send Local List request from the corresponding OCPP server. TF6771 Version: 1.1.0 57
## Page 58

PLC API Syntax METHOD Resp Local List : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Update Status; END_VAR Return value Name Type Description Resp Local List BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Update Status [} 197] Response whether the Charge Point was able to receive the sent Local Authorization List and perform the update. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.40 Resp Remote Start Transaction With this method, an OCPP client responds to a Remote Start Transaction request from the corresponding OCPP server. 58 Version: 1.1.0 TF6771
## Page 59

PLC API Syntax METHOD Resp Remote Start Transaction : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Remote Start Stop Status; END_VAR Return value Name Type Description Resp Remote Start Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Remote Start Stop Status The status shows whether the Charge Point has accepted the [} 196] request to start a transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.41 Resp Remote Stop Transaction With this method, an OCPP client responds to a Remote Stop Transaction request from the corresponding OCPP server. Syntax METHOD Resp Remote Stop Transaction : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Remote Start Stop Status; END_VAR TF6771 Version: 1.1.0 59
## Page 60

PLC API Return value Name Type Description Resp Remote Stop Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Remote Start Stop Status The status indicates whether the Charge Point has accepted the [} 196] request to stop a transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.42 Resp Reserve Now With this method, an OCPP client responds to a Reserve Now request from the corresponding OCPP server. Syntax METHOD Resp Reserve Now : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Reservation Status; END_VAR Return value Name Type Description Resp Reserve Now BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 60 Version: 1.1.0 TF6771
## Page 61

PLC API Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Reservation Status [} 196] Response whether the Charge Point has accepted or rejected the requested reservation. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.43 Resp Reset With this method, an OCPP client responds to a Reset request from the corresponding OCPP server. Syntax METHOD Resp Reset : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Reset Status; END_VAR Return value Name Type Description Resp Reset BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 61
## Page 62

PLC API Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Reset Status [} 196] The status shows whether the Charge Point was able to accept the Reset request. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.44 Resp Set Charging Profile With this method, an OCPP client responds to a Set Charging Profile request from the corresponding OCPP server. Syntax METHOD Resp Set Charging Profile : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Charging Profile Status; END_VAR Return value Name Type Description Resp Set Charging Profile BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 62 Version: 1.1.0 TF6771
## Page 63

PLC API Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Charging Profile Status Response whether the Charge Point was able to implement the [} 191] requested Charging Profile. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.45 Resp Trigger Message With this method, an OCPP client responds to a Trigger Message request from the corresponding OCPP server. Syntax METHOD Resp Trigger Message : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status :E_OCPP1_Trigger Message Status; END_VAR Return value Name Type Description Resp Trigger Message BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Trigger Message Status Response whether the Charge Point will send the requested [} 196] message or not. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. TF6771 Version: 1.1.0 63
## Page 64

PLC API 5.1.1.46 Resp Unlock Connector With this method, an OCPP client responds to an Unlock Connector request from the corresponding OCPP server. Syntax METHOD Resp Unlock Connector : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Unlock Status; END_VAR Return value Name Type Description Resp Unlock Connector BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Unlock Status [} 197] The status shows whether the Connector has been unlocked. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.47 Resp Update Firmware 64 Version: 1.1.0 TF6771
## Page 65

PLC API With this method, an OCPP client responds to an Update Firmware request from the corresponding OCPP server. Syntax METHOD Resp Update Firmware : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Update Firmware BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.48 Send Authorize With this method, an OCPP client sends an Authorize request to the corresponding OCPP server. The response from the OCPP server is processed directly within the method. TF6771 Version: 1.1.0 65
## Page 66

PLC API Syntax METHOD Send Authorize : BOOL VAR_INPUT s Id Tag : T_OCPP1_Id Token; END_VAR VAR_OUTPUT e Status : E_OCPP1_Authorization Status; END_VAR Return value Name Type Description Send Authorize BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description s Id Tag T_OCPP1_Id Token [} 209] ID token with which the Charge Point wants to be authorized on the Central System. Outputs Name Type Description e Status E_OCPP1_Authorization Status Status of the authorization as a response from the Central System. [} 190] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.49 Send Data Transfer 66 Version: 1.1.0 TF6771
## Page 67

PLC API With this method, an OCPP client sends a Data Transfer request to the corresponding OCPP server. The response from the OCPP server is processed directly within the method. Syntax METHOD Send Data Transfer : BOOL VAR_INPUT s Vendor Id : STRING(255); s Message Id : STRING(63) := ''; END_VAR VAR_IN_OUT CONSTANT s Data : T_OCPP1_Data Transfer Data; END_VAR VAR_OUTPUT e Status : E_OCPP1_Data Transfer Status; END_VAR Return value Name Type Description Send Data Transfer BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description s Vendor Id STRING(255) Identifier for the vendor, which identifies the vendor-specific implementation. s Message Id STRING(63) Additional identification field for a single message. Inputs/outputs Name Type Description s Data T_OCPP1_Data Transfer Data [} 208] Text without specified length and format. Outputs Name Type Description e Status E_OCPP1_Data Transfer Status Status of the Data Transfer as a response from the Central System. [} 193] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. TF6771 Version: 1.1.0 67
## Page 68

PLC API 5.1.1.50 Send Diagnostics Status Notification With this method, an OCPP client sends a Diagnostics Status Notification to the corresponding OCPP server. The response from the OCPP server is processed directly within the method. Syntax METHOD Send Diagnostics Status Notification : BOOL VAR_INPUT e Status : E_OCPP1_Diagnostics Status; END_VAR Return value Name Type Description Send Diagnostics Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description e Status E_OCPP1_Diagnostics Status [} 193] Contains the status of the upload of the diagnostic data. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.51 Send Firmware Status Notification With this method, an OCPP client sends a Firmware Status Notification to the corresponding OCPP server. The response from the OCPP server is processed directly within the method. 68 Version: 1.1.0 TF6771
## Page 69

PLC API Syntax METHOD Send Firmware Status Notification : BOOL VAR_INPUT e Status : E_OCPP1_Firmware Status; END_VAR Return value Name Type Description Send Firmware Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description e Status E_OCPP1_Firmware Status [} 193] Contains the progress of the firmware installation. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.52 Send Heartbeat With this method, an OCPP client sends a Heartbeat to the corresponding OCPP server. The client already sends a Heartbeat internally, which can be configured via the Heartbeat Interval Property. This method would configure another Heartbeat in parallel if necessary. TF6771 Version: 1.1.0 69
## Page 70

PLC API Syntax METHOD Send Heartbeat : BOOL Return value Name Type Description Send Heartbeat BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.53 Send Meter Value With this method, an OCPP client sends Meter Values to the corresponding OCPP server. The response from the OCPP server is processed directly within the method. Syntax METHOD Send Meter Value : BOOL VAR_INPUT n Connector Id : UDINT; n Transaction Id : UDINT := 0; n Sample Count : UDINT; END_VAR 70 Version: 1.1.0 TF6771
## Page 71

PLC API VAR_IN_OUT arr Sample Values : ARRAY[*] OF ST_OCPP1_Sampled Value; END_VAR Return value Name Type Description Send Meter Value BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. n Transaction Id UDINT Optionally contains the ID of the transaction to which the specified Meter Values belong. n Sample Count UDINT The number of the following sampled values. Inputs/outputs Name Type Description arr Sample Values ARRAY [*] OF The sampled values to be sent to ST_OCPP1_Sampled Value [} 207] the Central System. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.54 Send Security Event Notification With this method, an OCPP client sends a Security Event Notification to the corresponding OCPP server. The response from the OCPP server is processed directly within the method. TF6771 Version: 1.1.0 71
## Page 72

PLC API Syntax METHOD Send Security Event Notification : BOOL VAR_INPUT n Timestamp : ULINT; s Type : STRING(63); s Info : STRING(255) := ''; END_VAR Return value Name Type Description Send Diagnostics Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Timestamp ULINT Date and time when the Security Event occurs. s Type STRING(63) Type of the Security Event. s Info STRING(255) Optionally contains additional information about the Security Event that has occurred. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 72 Version: 1.1.0 TF6771
## Page 73

PLC API 5.1.1.55 Send Start Transaction With this method, an OCPP client sends a Start Transaction request to the corresponding OCPP server. The response from the OCPP server is processed directly within the method. The Transaction ID is managed internally so that the user does not have to pay attention to the administration. Syntax METHOD Send Start Transaction : BOOL VAR_INPUT s Id Tag : T_OCPP1_Id Token; n Connector Id : UDINT; n Meter Start : UDINT; n Reservation Id : UDINT := 0; END_VAR VAR_OUTPUT e Status : E_OCPP1_Authorization Status; END_VAR Return value Name Type Description Send Start Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description s Id Tag T_OCPP1_Id Token [} 209] ID token with which the transaction is to be started. n Connector Id UDINT ID of the Connector of a Charge Point. n Meter Start UDINT Value in watt-hours at the start of the transaction. If the value is 0, the value is not checked. For all values greater than 0, this value must be greater than or equal to the last n Meter Stop value. n Reservation Id UDINT Optional reservation ID. TF6771 Version: 1.1.0 73
## Page 74

PLC API Outputs Name Type Description e Status E_OCPP1_Authorization Status Status of the authorization in response from the OCPP server. [} 190] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.56 Send Status Notification With this method, an OCPP client sends a Status Notification to the corresponding OCPP server. The response from the OCPP server is processed directly within the method, but in this case it does not contain any separate variables anyway. The timestamp is set internally when the request is sent and cannot be set manually when the method is called. Syntax METHOD Send Status Notification : BOOL VAR_INPUT n Connector Id : UDINT; e Error : E_OCPP1_Charge Point Error; e Status : E_OCPP1_Charge Point Status; s Info : STRING(50) := ''; s Vendor Error : STRING(50) := ''; s Vendor Id : STRING(255) := ''; END_VAR Return value Name Type Description Send Status Notification Ex BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 74 Version: 1.1.0 TF6771
## Page 75

PLC API Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. e Error E_OCPP1_Charge Point Error [} 190] Error code to be sent in the Status Notification. e Status E_OCPP1_Charge Point Status Status to be sent in the Status Notification. [} 191] s Info STRING(50) Contains optional, freely definable additional information on the error. s Vendor Error STRING(50) Optionally contains the vendor- specific error code. s Vendor Id STRING(255) Optionally contains the identifier for the vendor-specific implementation. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.1.57 Send Stop Transaction With this method, an OCPP client sends a Stop Transaction request to the corresponding OCPP server. The response from the OCPP server is processed directly within the method. Syntax METHOD Send Stop Transaction : BOOL VAR_INPUT s Id Tag : T_OCPP1_Id Token := ''; n Transaction Id : UDINT := 0; n Connector Id : UDINT; n Meter Stop : UDINT; e Reason : E_OCPP1_Reason := E_OCPP1_Reason. None; END_VAR VAR_OUTPUT e Status : E_OCPP1_Authorization Status; END_VAR TF6771 Version: 1.1.0 75
## Page 76

PLC API Return value Name Type Description Send Stop Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description s Id Tag T_OCPP1_Id Token [} 209] ID token for which the transaction is to be stopped. n Transaction Id UDINT Alternatively, contains the Transaction ID received at Start Transaction if the Connector ID is 0. n Connector Id UDINT ID of the Connector of a Charge Point if the Transaction ID is 0. n Meter Stop UDINT Value in watt-hours at the end of the transaction. This value must be greater than or equal to the n Meter Start value with which the transaction was started. e Reason E_OCPP1_Reason [} 195] Optionally contains the reason for stopping the transaction. Outputs Name Type Description e Status E_OCPP1_Authorization Status Status of the authorization in response from the OCPP server. [} 190] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2 FB_OCPP1_Server This function block represents an OCPP server to which any number of OCPP clients can be connected. An OCPP client is identified via an ID. If a 1-to-1 relationship between OCPP client and OCPP server is required, the function block FB_OCPP1_Station [} 131] can be used instead of this function block. The Send methods are used when sending requests to the client. In these methods, the response from the client is processed directly and stored in the output parameters of the methods. If, on the other hand, a request is received from the client using one of the Receive methods, the response must be sent using the appropriate Response method. Syntax FUNCTION BLOCK FB_OCPP1_Server VAR_OUTPUT b Valid : BOOL; 76 Version: 1.1.0 TF6771
## Page 77

PLC API b Busy : BOOL; b Error : BOOL; e Error Result : HRESULT; e Error Action : E_OCPP1_Action; END_VAR Outputs Name Type Description b Valid BOOL The interface to the driver in the background exists. b Busy BOOL Is TRUE as long as the function block is busy with processing. b Error BOOL Becomes TRUE when an error situation occurs. e Error Result HRESULT Last error present on the function block. e Error Action E_OCPP1_Action [} 189] OCPP command for which the error occurred. Properties Name Type Access Description Is Open BOOL Get Connections can be established. Is Pending BOOL Get Waiting for completion of the request. 5.1.2.1 Create Station This method is used to create a new station in the OCPP server. Syntax METHOD Create Station : HRESULT VAR_INPUT s Ident : T_OCPP_Identity; s Auth Hash : T_OCPP_Hash; END_VAR VAR_OUTPUT h Station Id : UDINT; END_VAR Return value Name Type Description Create Station BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 77
## Page 78

PLC API Inputs Name Type Description s Ident T_OCPP_Identity [} 209] Identity of the OCPP client to be connected. s Auth Hash T_OCPP_Hash [} 209] Hash value for the respective OCPP client. The calculation is explained at Hash calculation [} 211]. Outputs h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.2 FB_Exit Syntax METHOD FB_Exit : BOOL VAR_INPUT b In Copy Code : BOOL; END_VAR Return value Name Type Description FB_Exit BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description b In Copy Code BOOL If TRUE, the Exit method is called to exit an instance, which is then copied (online change). 5.1.2.3 FB_Init 78 Version: 1.1.0 TF6771
## Page 79

PLC API Syntax METHOD FB_Init : BOOL VAR_INPUT b Init Retains : BOOL; b In Copy Code : BOOL; st Param : REFERENCE TO ST_OCPP1_Server Param REF=0; END_VAR Return value Name Type Description FB_Init BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description b Init Retains BOOL If TRUE, the Retain variables are initialized (warm start/cold start). b In Copy Code BOOL If TRUE, the Exit method is called to exit an instance, which is then copied (online change). st Param REFERENCE TO Parameters for the OCPP server. ST_OCPP1_Server Param [} 201] 5.1.2.4 Get Station Id This method can be used to query the Station Id of an OCPP client in the instance of the OCPP server. Syntax METHOD Get Station Id : BOOL VAR_INPUT s Ident : T_OCPP_Identity; END_VAR VAR_IN_OUT h Station Id : UDINT; END_VAR Return value Name Type Description Get Station Id BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 79
## Page 80

PLC API Inputs Name Type Description s Ident T_OCPP_Identity [} 209] Identity of the OCPP client. Inputs/outputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. 5.1.2.5 Init This method is called when the function block is initialized in the FB_Init [} 23] method and specifies the parameters of the Web Sockets server. If the connection parameters are to be changed afterwards, this method can be called again while the application is running. Syntax METHOD Init : BOOL VAR_INPUT st Param : REFERENCE TO ST_OCPP1_Server Param REF=0; END_VAR Return value Name Type Description Init BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description st Param REFERENCE TO Connection parameters for the ST_OCPP1_Server Param [} 201] OCPP server. 5.1.2.6 Poll Request This method must be called in order to receive incoming requests from OCPP clients. 80 Version: 1.1.0 TF6771
## Page 81

PLC API Syntax METHOD Poll Request : BOOL VAR_OUTPUT h Station Id : UDINT; e Action : E_OCPP1_Action; h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Poll Request BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. e Action E_OCPP1_Action [} 189] Type of OCPP request received from the server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.7 Recv Authorize With this method, an OCPP server receives an Authorize request from an OCPP client. To respond to the request, the method Resp Authorize [} 96] must be called. TF6771 Version: 1.1.0 81
## Page 82

PLC API Syntax METHOD Recv Authorize : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Id Tag : T_OCPP1_Id Token; END_VAR Return value Name Type Description Recv Authorize BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Id Tag T_OCPP1_Id Token [} 209] ID token with which the Charge Point wants to be authorized on the Central System. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.8 Recv Boot Notification With this method, an OCPP server receives a Boot Notification from an OCPP client. To respond to the Boot Notification, the method Resp Boot Notification [} 97] must be called. 82 Version: 1.1.0 TF6771
## Page 83

PLC API Syntax METHOD Recv Boot Notification : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Model : STRING(31); s Vendor : STRING(31); s Charge Box Serial : STRING(31); s Charge Point Serial : STRING(31); s Firmware Version : STRING(63); s Meter Serial : STRING(31); s Meter Type : STRING(31); END_VAR Return value Name Type Description Recv Boot Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Model STRING(31) Model of the Charge Point. s Vendor STRING(31) Vendor of the Charge Point. s Charge Box Serial STRING(31) Serial number of the Charge Box within the Charge Point. s Charge Point Serial STRING(31) Serial number of the Charge Point. s Firmware Version STRING(63) Firmware version of the Charge Point. s Meter Serial STRING(31) Serial number of the main electricity meter of the Charge Point. s Meter Type STRING(31) Type of main electricity meter of the Charge Point Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.9 Recv Data Transfer TF6771 Version: 1.1.0 83
## Page 84

PLC API With this method, an OCPP server receives a Data Transfer request from an OCPP client. To respond to the request, the method Resp Data Transfer [} 98] must be called. Syntax METHOD Recv Data Transfer : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Vendor Id : STRING(255); s Message Id : STRING(63); END_VAR VAR_IN_OUT s Data : T_OCPP1_Data Transfer Data; END_VAR Return value Name Type Description Recv Data Transfer BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Vendor Id STRING(255) Identifier for the vendor-specific implementation. s Message Id STRING(63) Identifier for the individual message. 84 Version: 1.1.0 TF6771
## Page 85

PLC API Inputs/outputs Name Type Description s Data T_OCPP1_Data Transfer Data [} 208] Text without specified length and format. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.10 Recv Diagnostics Status Notification With this method, an OCPP server receives a Diagnostics Status Notification from an OCPP client. To respond to the Diagnostics Status Notification, the method Resp Diagnostics Status Notification [} 99] must be called. Syntax METHOD Recv Diagnostics Status Notification : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Diagnostics Status; END_VAR Return value Name Type Description Recv Diagnostics Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. TF6771 Version: 1.1.0 85
## Page 86

PLC API Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Diagnostics Status [} 193] Status of the upload of the diagnostic data. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.11 Recv Firmware Status Notification With this method, an OCPP server receives a Firmware Status Notification from an OCPP client. To respond to the Firmware Status Notification, the method Resp Firmware Status Notification [} 101] must be called. Syntax METHOD Recv Firmware Status Notification : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Firmware Status; END_VAR Return value Name Type Description Recv Firmware Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. 86 Version: 1.1.0 TF6771
## Page 87

PLC API Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Firmware Status [} 193] Status of a firmware installation. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.12 Recv Heartbeat With this method, an OCPP server receives a Heartbeat from an OCPP client. To respond to the Heartbeat, the method Resp Heartbeat [} 102] must be called. Syntax METHOD Recv Heartbeat : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Recv Heartbeat BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. TF6771 Version: 1.1.0 87
## Page 88

PLC API Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.13 Recv Meter Value With this method, an OCPP server receives Meter Values from an OCPP client. To respond to the receipt of the Meter Values, the method Resp Meter Value [} 103] must be called. Contrary to the specification, it is possible to receive Meter Value messages without Meter Values in order to increase compatibility with other vendors. Syntax METHOD Recv Meter Value : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_IN_OUT arr Sample Values : ARRAY[*] OF ST_OCPP1_Sampled Value; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; n Transaction Id : UDINT; n Sample Count : UDINT; END_VAR Return value Name Type Description Recv Meter Value BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 88 Version: 1.1.0 TF6771
## Page 89

PLC API Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Inputs/outputs Name Type Description arr Sample Values ARRAY [*] OF The sampled values sent by the ST_OCPP1_Sampled Value [} 207] client. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. n Transaction Id UDINT The transaction to which the sampled values belong. n Sample Count UDINT The number of sampled values contained. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.14 Recv Security Event Notification With this method, an OCPP server receives a Security Event Notification from an OCPP client. To respond to the Security Event Notification, the method Resp Security Event Notification [} 104] must be called. TF6771 Version: 1.1.0 89
## Page 90

PLC API Syntax METHOD Recv Security Event Notification : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Timestamp : ULINT; s Type : STRING(63); s Info : STRING(256); END_VAR Return value Name Type Description Recv Security Event Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. 90 Version: 1.1.0 TF6771
## Page 91

PLC API Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Timestamp ULINT Date and time when the event occurs. s Type STRING(63) Type of the Security Event according to the OCPP specification. s Info STRING(256) Additional information about the Security Event that has occurred. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.15 Recv Start Transaction With this method, an OCPP server receives a Start Transaction request from an OCPP client. To respond to the request, the method Resp Start Transaction [} 105] must be called. Syntax METHOD Recv Start Transaction : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Id Tag : T_OCPP1_Id Token; n Connector Id : UDINT; n Meter Start : UDINT; n Reservation Id : UDINT; n Timestamp : ULINT; END_VAR Return value Name Type Description Recv Start Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 91
## Page 92

PLC API Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Id Tag T_OCPP1_Id Token [} 209] ID token with which the transaction is to be started. n Connector Id UDINT ID of the Connector of a Charge Point. n Meter Start UDINT Value in watt-hours at the start of the transaction. n Reservation Id UDINT Optional reservation ID. n Timestamp ULINT Date and time at the start of the transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.16 Recv Status Notification With this method, an OCPP server receives a Status Notification from an OCPP client. To respond to the Status Notification, the method Resp Status Notification [} 106] must be called. Syntax METHOD Recv Status Notification : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; e Error : E_OCPP1_Charge Point Error; e Status : E_OCPP1_Charge Point Status; n Timestamp : ULINT := 0; s Info : STRING(63) := ''; 92 Version: 1.1.0 TF6771
## Page 93

PLC API s Vendor Error : STRING(63) := ''; s Vendor Id : STRING(255) := ''; END_VAR Return value Name Type Description Recv Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. e Error E_OCPP1_Charge Point Error [} 190] Error code received in the Status Notification. e Status E_OCPP1_Charge Point Status Status received in the Status Notification. [} 191] n Timestamp ULINT The timestamp of the Status Notification. s Info STRING(63) Contains optional, freely definable additional information on the error. s Vendor Error STRING(63) Optionally contains the vendor- specific error code. s Vendor Id STRING(255) Optionally contains the identifier for the vendor-specific implementation. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.17 Recv Stop Transaction With this method, an OCPP server receives a Stop Transaction request from an OCPP client. To respond to the request, the method Resp Stop Transaction [} 106] must be called. TF6771 Version: 1.1.0 93
## Page 94

PLC API Syntax METHOD Recv Stop Transaction : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Id Tag : T_OCPP1_Id Token; n Transaction Id : UDINT; n Connector Id : UDINT; n Meter Stop : UDINT; n Timestamp : ULINT; e Reason : E_OCPP1_Reason; END_VAR Return value Name Type Description Recv Stop Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. 94 Version: 1.1.0 TF6771
## Page 95

PLC API Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Id Tag T_OCPP1_Id Token [} 209] ID token for which the transaction is to be stopped. n Transaction Id UDINT ID of the transaction to be stopped. This ID is contained in the Central System's response to a Start Transaction request. n Connector Id UDINT ID of the Connector of a Charge Point. n Meter Stop UDINT Value in watt-hours at the end of the transaction. n Timestamp ULINT Date and time when the transaction is stopped. e Reason E_OCPP1_Reason [} 195] Can optionally contain the reason for stopping the transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.18 Release Station This method is used to remove a connected station from the OCPP server. Syntax METHOD Release Station : HRESULT VAR_INPUT s Ident : T_OCPP_Identity; END_VAR VAR_OUTPUT h Station Id : UDINT; END_VAR Return value Name Type Description Release Station HRESULT Inputs Name Type Description s Ident T_OCPP_Identity [} 209] Identity of the OCPP client to be connected. TF6771 Version: 1.1.0 95
## Page 96

PLC API Outputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.19 Reset This method is used to reset the last error present on the function block. Syntax METHOD Reset : BOOL Return value Name Type Description Reset BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 5.1.2.20 Resp Authorize With this method, an OCPP server responds to an Authorize request from an OCPP client. 96 Version: 1.1.0 TF6771
## Page 97

PLC API Syntax METHOD Resp Authorize : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Authorization Status; END_VAR Return value Name Type Description Resp Authorize BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Authorization Status Status of the authorization in response to the OCPP client. [} 190] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.21 Resp Boot Notification With this method, an OCPP server responds to a Boot Notification from an OCPP client. Syntax METHOD Resp Boot Notification : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Registration Status; t Heartbeat Interval : TIME := T#5S; END_VAR TF6771 Version: 1.1.0 97
## Page 98

PLC API Return value Name Type Description Resp Boot Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Registration Status [} 196] Status of the registration in response to the OCPP client. t Heartbeat Interval TIME If the registration status is Accepted, this variable contains the Heartbeat Interval for the connection. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.22 Resp Data Transfer With this method, an OCPP server responds to a Data Transfer request from an OCPP client. Syntax METHOD Resp Data Transfer : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Data Transfer Status; END_VAR 98 Version: 1.1.0 TF6771
## Page 99

PLC API Return value Name Type Description Resp Data Transfer BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Data Transfer Status Status of the Data Transfer in response to the OCPP client. [} 193] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.23 Resp Diagnostics Status Notification With this method, an OCPP server responds to a Diagnostics Status Notification from an OCPP client. Syntax METHOD Resp Diagnostics Status Notification : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; END_VAR TF6771 Version: 1.1.0 99
## Page 100

PLC API Return value Name Type Description Resp Diagnostics Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.24 Resp Error With this method, an OCPP server responds to an OCPP client if the sent request has triggered an internal error. This may be the case, for example, if a requested action is not available. Syntax METHOD Resp Error : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; e Act : E_OCPP1_Action := E_OCPP1_Action. Heartbeat; e Err : E_OCPP1_Error := E_OCPP1_Error. None; END_VAR Return value Name Type Description Resp Error BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 100 Version: 1.1.0 TF6771
## Page 101

PLC API Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Act E_OCPP1_Action [} 189] Type of OCPP request for which the error occurred. e Err E_OCPP1_Error [} 193] OCPP error that will be the response to the request. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.25 Resp Firmware Status Notification With this method, an OCPP server responds to a Firmware Status Notification from an OCPP client. Syntax METHOD Resp Firmware Status Notification : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Firmware Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 101
## Page 102

PLC API Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.26 Resp Heartbeat With this method, an OCPP server responds to a Heartbeat from an OCPP client. The timestamp is set internally and does not need to be set separately in the PLC. Syntax METHOD Resp Heartbeat : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Heartbeat BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 102 Version: 1.1.0 TF6771
## Page 103

PLC API Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.27 Resp Meter Value With this method, an OCPP server responds to the sending of Meter Values from an OCPP client. Syntax METHOD Resp Meter Value : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Meter Value BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. TF6771 Version: 1.1.0 103
## Page 104

PLC API 5.1.2.28 Resp Security Event Notification With this method, an OCPP server responds to a Security Event Notification from an OCPP client. Syntax METHOD Resp Security Event Notification : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Security Event Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 104 Version: 1.1.0 TF6771
## Page 105

PLC API Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.29 Resp Start Transaction With this method, an OCPP server responds to a Start Transaction request from an OCPP client. Syntax METHOD Resp Start Transaction : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Authorization Status; n Transaction Id : UDINT; END_VAR Return value Name Type Description Resp Start Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Authorization Status Status of the authorization in response to the OCPP client. [} 190] n Transaction Id UDINT ID defined by the Central System for the transaction. TF6771 Version: 1.1.0 105
## Page 106

PLC API Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.30 Resp Status Notification With this method, an OCPP server responds to a Status Notification from an OCPP client. Syntax METHOD Resp Status Notification : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.31 Resp Stop Transaction With this method, an OCPP server responds to a Stop Transaction request from an OCPP client. 106 Version: 1.1.0 TF6771
## Page 107

PLC API Syntax METHOD Resp Stop Transaction : BOOL VAR_INPUT h Station Id : UDINT; h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Authorization Status; END_VAR Return value Name Type Description Resp Stop Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Authorization Status Status of the authorization in response to the OCPP client. [} 190] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.32 Send Cancel Reservation With this method, an OCPP server sends a Cancel Reservation request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. TF6771 Version: 1.1.0 107
## Page 108

PLC API Syntax METHOD Send Cancel Reservation : BOOL VAR_INPUT h Station Id : UDINT; n Reservation Id : UDINT; END_VAR VAR_OUTPUT e Status : E_OCPP1_Cancel Reservation Status; END_VAR Return value Name Type Description Send Cancel Reservation BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Reservation Id UDINT ID of the reservation to be canceled. Outputs Name Type Description e Status E_OCPP1_Cancel Reservation Status The status shows whether the reservation was successfully [} 190] canceled. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.33 Send Change Availability 108 Version: 1.1.0 TF6771
## Page 109

PLC API With this method, an OCPP server sends a Change Availability request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Change Availability : BOOL VAR_INPUT h Station Id : UDINT; n Connector Id : UDINT; e Type : E_OCPP1_Availability Type; END_VAR VAR_OUTPUT e Status : E_OCPP1_Availability Status; END_VAR Return value Name Type Description Send Change Availability BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Connector Id UDINT ID of the Connector of a Charge Point. e Type E_OCPP1_Availability Type [} 190] Type of availability change that the Charge Point is to carry out. Outputs Name Type Description e Status E_OCPP1_Availability Status [} 190] Response whether the Charge Point was able to implement the requested availability change. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. TF6771 Version: 1.1.0 109
## Page 110

PLC API 5.1.2.34 Send Change Configuration With this method, an OCPP server sends a Change Configuration request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Change Configuration : BOOL VAR_INPUT h Station Id : UDINT; s Key : T_OCPP1_Config Key; s Value : T_OCPP1_Config Value; END_VAR VAR_OUTPUT e Status : E_OCPP1_Configuration Status; END_VAR Return value Name Type Description Send Change Configuration BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. s Key T_OCPP1_Config Key [} 208] The name of the configuration setting to be changed. s Value T_OCPP1_Config Value [} 208] The new value of the configuration setting. 110 Version: 1.1.0 TF6771
## Page 111

PLC API Outputs Name Type Description e Status E_OCPP1_Configuration Status The status indicates whether the configuration change has been [} 193] accepted. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.35 Send Charging Profile With this method, an OCPP server sends a Charging Profile to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Charging Profile : BOOL VAR_INPUT h Station Id : UDINT; n Connector Id : UDINT; m Charging Profile : REFERENCE TO ST_OCPP1_Charging Profile Max; END_VAR VAR_OUTPUT e Status : E_OCPP1_Charging Profile Status; END_VAR Return value Name Type Description Send Charging Profile BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 111
## Page 112

PLC API Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Connector Id UDINT ID of the Connector of a Charge Point. m Charging Profile REFERENCE TO Charging Profile to be sent to the ST_OCPP1_Charging Profile Max client. [} 204] Outputs Name Type Description e Status E_OCPP1_Charging Profile Status The status indicates whether the Charging Profile has been [} 191] accepted by the Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.36 Send Clear Cache With this method, an OCPP server sends a Clear Cache request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Clear Cache : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT e Status : E_OCPP1_Clear Cache Status; END_VAR 112 Version: 1.1.0 TF6771
## Page 113

PLC API Return value Name Type Description Send Clear Cache BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Outputs Name Type Description e Status E_OCPP1_Clear Cache Status [} 192] The status indicates whether the clearing of the Cache Profile has been accepted by the Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.37 Send Clear Charging Profile With this method, an OCPP server sends a Clear Charging Profile request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Clear Charging Profile : BOOL VAR_INPUT h Station Id : UDINT; n Profile Id : UDINT := 0; n Connector Id : UDINT := 0; e Charging Profile Purpose : E_OCPP1_Charging Profile Purpose Type := E_OCPP_Charging Profile Purpose Typ e. None; n Stack Level : UDINT := 0; END_VAR VAR_OUTPUT e Status : E_OCPP1_Clear Charging Profile Status; END_VAR TF6771 Version: 1.1.0 113
## Page 114

PLC API Return value Name Type Description Send Clear Charging Profile BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Profile Id UDINT Identifier of the Charging Profile to be cleared. n Connector Id UDINT ID of the Connector of a Charge Point. The value 0 indicates that the clearing relates to the entire Charge Point. e Charging Profile Purpose E_OCPP1_Charging Profile Purpose T Specifies the purpose of the Charging Profiles to be cleared. ype [} 191] n Stack Level UDINT Specifies the Stack Level for which Charging Profiles are cleared. Outputs Name Type Description e Status E_OCPP1_Clear Charging Profile Statu The status indicates whether the Charging Profile could be cleared s [} 192] from the Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.38 Send Data Transfer With this method, an OCPP server sends a Data Transfer request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. 114 Version: 1.1.0 TF6771
## Page 115

PLC API Syntax METHOD Send Data Transfer : BOOL VAR_INPUT h Station Id : UDINT; s Vendor Id : STRING(255); s Message Id : STRING(63) := ''; END_VAR VAR_IN_OUT CONSTANT s Data : T_OCPP1_Data Transfer Data; END_VAR VAR_OUTPUT e Status : E_OCPP1_Data Transfer Status; END_VAR Return value Name Type Description Send Data Transfer BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. s Vendor Id STRING(255) Identifier for the vendor, which identifies the vendor-specific implementation. s Message Id STRING(63) Additional identification field for a single message. Inputs/outputs Name Type Description s Data T_OCPP1_Data Transfer Data [} 208] Text without specified length and format. Outputs Name Type Description e Status E_OCPP1_Data Transfer Status Status of the Data Transfer. [} 193] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.39 Send Get Composite Schedule With this method, an OCPP server sends a Get Composite Schedule request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. TF6771 Version: 1.1.0 115
## Page 116

PLC API Syntax METHOD Send Get Composite Schedule : BOOL VAR_INPUT h Station Id : UDINT; n Connector Id : UDINT; n Duration : UDINT; e Charging Rate Unit : E_OCPP1_Charging Rate Unit Type := E_OCPP_Charging Rate Unit Type. None; END_VAR VAR_OUTPUT e Status : E_OCPP1_Get Composite Schedule Status; n Connector Id Res : UDINT; n Schedule Start : ULINT := 0; m Charging Schedule : ST_OCPP1_Charging Schedule Max; END_VAR Return value Name Type Description Send Get Composite Schedule BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Connector Id UDINT ID of the Connector of a Charge Point. n Duration UDINT Length of the requested schedule. e Charging Rate Unit E_OCPP1_Charging Rate Unit Type Used to specify the unit for the request. [} 192] Outputs Name Type Description e Status E_OCPP1_Get Composite Schedule St The status shows whether the schedule request could be atus [} 194] answered by the Charge Point. n Connector Id Res UDINT Identifier of the Connector to which the schedule in the response refers. n Schedule Start ULINT Start time of the schedule. m Charging Schedule ST_OCPP1_Charging Schedule Max Requested schedule. [} 204] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 116 Version: 1.1.0 TF6771
## Page 117

PLC API 5.1.2.40 Send Get Configuration With this method, an OCPP server sends a Get Configuration request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Get Configuration : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_IN_OUT arr Keys : ARRAY[*] OF ST_OCPP1_Config Key Value; END_VAR VAR_OUTPUT n Keys Count : UDINT := 0; n Unknown Count : UDINT := 0; END_VAR Return value Name Type Description Send Get Configuration BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Inputs/outputs Name Type Description arr Keys ARRAY [*] OF List of requested or known ST_OCPP1_Config Key Value [} 207] configuration keys for which the configuration is requested. TF6771 Version: 1.1.0 117
## Page 118

PLC API Outputs Name Type Description n Keys Count UDINT Number of the following configuration keys. n Unknown Count UDINT Number of the following unknown configuration keys. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.41 Send Get Diagnostics With this method, an OCPP server sends a Get Diagnostics request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Get Diagnostics : BOOL VAR_INPUT h Station Id : UDINT; s Location : STRING(255); n Retries : UDINT := 0; n Retry Interval : UDINT := 0; n Start Time : ULINT := 0; n Stop Time : ULINT := 0; END_VAR VAR_OUTPUT s File Name : STRING(255); END_VAR 118 Version: 1.1.0 TF6771
## Page 119

PLC API Return value Name Type Description Send Get Diagnostics BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. s Location STRING(255) Directory to which the diagnostic file is to be uploaded. n Retries UDINT Number of attempts made by the Charge Point if the upload fails. n Retry Interval UDINT Interval after which a new upload is attempted. n Start Time ULINT Start time of the logging information contained in the diagnostics. n Stop Time ULINT End time of the logging information contained in the diagnostics. Outputs Name Type Description s File Name STRING(255) Contains the name of the diagnostic file that will be uploaded. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.42 Send Get Local List Version With this method, an OCPP server sends a Get Local List Version request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. TF6771 Version: 1.1.0 119
## Page 120

PLC API Syntax METHOD Send Get Local List Version : BOOL VAR_INPUT h Station Id : UDINT; END_VAR VAR_OUTPUT n List Version : UDINT; END_VAR Return value Name Type Description Send Get Local List Version BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. Outputs Name Type Description n List Version UDINT Contains the version number of the Local Authorization List currently available in the Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.43 Send Local List With this method, an OCPP server sends a Local List request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. 120 Version: 1.1.0 TF6771
## Page 121

PLC API Syntax METHOD Send Local List : BOOL VAR_INPUT h Station Id : UDINT; n List Version : UDINT; e Update Type : E_OCPP1_Update Type; n Auth Count : UDINT := 0; END_VAR VAR_IN_OUT arr Auth List : ARRAY[*] OF ST_OCPP1_Authorization Data; END_VAR VAR_OUTPUT e Status : E_OCPP1_Update Status; END_VAR Return value Name Type Description Send Local List BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n List Version UDINT Version of the Local Authorization List provided as an update. e Update Type E_OCPP1_Update Type [} 197] Definition of the update type, either as an update or as a complete replacement. n Auth Count UDINT Number of entries in the Local Authorization List. Inputs/outputs Name Type Description arr Auth List ARRAY [*] OF Either the values of the new Local ST_OCPP1_Authorization Data Authorization List (complete replacement) or values to be added [} 202] to the existing Local Authorization List (update). TF6771 Version: 1.1.0 121
## Page 122

PLC API Outputs Name Type Description e Status E_OCPP1_Update Status [} 197] The status indicates whether the Charge Point has received and carried out the Local Authorization List update. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.44 Send Remote Start Transaction With this method, an OCPP server sends a Remote Start Transaction request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Remote Start Transaction : BOOL VAR_INPUT h Station Id : UDINT; n Connector Id : UDINT := 0; s Id Token : T_OCPP1_Id Token; END_VAR VAR_OUTPUT e Status : E_OCPP1_Remote Start Stop Status; END_VAR Return value Name Type Description Send Remote Start Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Connector Id UDINT ID of the Connector of a Charge Point. s Id Token T_OCPP1_Id Token [} 209] ID token of the Charge Point in the Central System. 122 Version: 1.1.0 TF6771
## Page 123

PLC API Outputs Name Type Description e Status E_OCPP1_Remote Start Stop Status The status shows whether the Charge Point has accepted the [} 196] request to start a transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.45 Send Remote Start Transaction Profile With this method, an OCPP server sends a Remote Start Transaction request including a Charging Profile to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Remote Start Transaction Profile : BOOL VAR_INPUT h Station Id : UDINT; n Connector Id : UDINT := 0; s Id Token : T_OCPP1_Id Token; m Charging Profile : REFERENCE TO ST_OCPP1_Charging Profile := 0; END_VAR VAR_OUTPUT e Status : E_OCPP1_Remote Start Stop Status; END_VAR Return value Name Type Description Send Remote Start Transaction Profil BOOL The method returns the return e value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 123
## Page 124

PLC API Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Connector Id UDINT ID of the Connector of a Charge Point. s Id Token T_OCPP1_Id Token [} 209] ID token of the Charge Point in the Central System. m Charging Profile REFERENCE TO Charging Profile to be sent to the ST_OCPP1_Charging Profile Max client. [} 204] Outputs Name Type Description e Status E_OCPP1_Remote Start Stop Status The status shows whether the Charge Point has accepted the [} 196] request to start a transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.46 Send Remote Stop Transaction With this method, an OCPP server sends a Remote Stop Transaction request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Remote Stop Transaction : BOOL VAR_INPUT h Station Id : UDINT; n Transaction Id : UDINT; END_VAR VAR_OUTPUT e Status : E_OCPP1_Remote Start Stop Status; END_VAR 124 Version: 1.1.0 TF6771
## Page 125

PLC API Return value Name Type Description Send Remote Stop Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Transaction Id UDINT Identifier of the transaction to be stopped. Outputs Name Type Description e Status E_OCPP1_Remote Start Stop Status The status indicates whether the Charge Point has accepted the [} 196] request to stop a transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.47 Send Reserve Now With this method, an OCPP server sends a Reserve Now request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Reserve Now : BOOL VAR_INPUT h Station Id : UDINT; n Connector Id : UDINT; n Expiry Date : ULINT; s Id Tag : T_OCPP1_Id Token := ''; s Parent Id Tag : T_OCPP1_Id Token; n Reservation Id : UDINT; END_VAR VAR_OUTPUT e Status : E_OCPP1_Reservation Status; END_VAR TF6771 Version: 1.1.0 125
## Page 126

PLC API Return value Name Type Description Send Reserve Now BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Connector Id UDINT ID of the Connector of a Charge Point. n Expiry Date ULINT Date and time of the end of the reservation. s Id Tag T_OCPP1_Id Token [} 209] Identifier for which the Charge Point should reserve a Connector. s Parent Id Tag T_OCPP1_Id Token [} 209] The parent of the identifier for which the Charge Point is to reserve a Connector. n Reservation Id UDINT Unique ID of the reservation. Outputs Name Type Description e Status E_OCPP1_Reservation Status [} 196] The status indicates whether the reservation was successful. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.2.48 Send Reset With this method, an OCPP server sends a Reset Request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. 126 Version: 1.1.0 TF6771
## Page 127

PLC API Syntax METHOD Send Reset : BOOL VAR_INPUT h Station Id : UDINT; e Type : E_OCPP1_Reset Type; END_VAR VAR_OUTPUT e Status : E_OCPP1_Reset Status; END_VAR Return value Name Type Description Send Reset BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. e Type E_OCPP1_Reset Type [} 196] Type of reset that the Charge Point should perform. Outputs Name Type Description e Status E_OCPP1_Reset Status [} 196] The status shows whether the Charge Point was able to accept the Reset request. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. TF6771 Version: 1.1.0 127
## Page 128

PLC API 5.1.2.49 Send Trigger Message With this method, an OCPP server sends a Trigger Message request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Trigger Message : BOOL VAR_INPUT h Station Id : UDINT; e Requested Message : E_OCPP1_Message Trigger; n Connector Id : UDINT := 0; END_VAR VAR_OUTPUT e Status : E_OCPP1_Trigger Message Status; END_VAR Return value Name Type Description Send Trigger Message BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. e Requested Message E_OCPP1_Message Trigger [} 194] Type of message to be triggered. n Connector Id UDINT ID of the Connector of a Charge Point. Outputs Name Type Description e Status E_OCPP1_Trigger Message Status The status indicates whether the Charge Point will send the [} 196] requested message or not. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 128 Version: 1.1.0 TF6771
## Page 129

PLC API 5.1.2.50 Send Unlock Connector With this method, an OCPP server sends an Unlock Connector request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Unlock Connector : BOOL VAR_INPUT h Station Id : UDINT; n Connector Id : UDINT; END_VAR VAR_OUTPUT e Status : E_OCPP1_Unlock Status; END_VAR Return value Name Type Description Send Unlock Connector BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. n Connector Id UDINT ID of the Connector of a Charge Point. Outputs Name Type Description e Status E_OCPP1_Unlock Status [} 197] The status shows whether the Connector has been unlocked. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. TF6771 Version: 1.1.0 129
## Page 130

PLC API 5.1.2.51 Send Update Firmware With this method, an OCPP server sends an Update Firmware request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Update Firmware : BOOL VAR_INPUT h Station Id : UDINT; s Location : STRING(255); n Retries : UDINT := 0; n Retry Interval : UDINT := 0; n Retrieve Date : ULINT; END_VAR Return value Name Type Description Send Update Firmware BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 130 Version: 1.1.0 TF6771
## Page 131

PLC API Inputs Name Type Description h Station Id UDINT Identifier of the OCPP client in the instance of the OCPP server. s Location STRING(255) URI from which the firmware is to be retrieved. n Retries UDINT Number of attempts to download the firmware again if the download fails. n Retry Interval UDINT Time after which the download is attempted again. n Retrieve Date ULINT Time and date from which the Charge Point may receive the new firmware. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3 FB_OCPP1_Station Syntax FUNCTION BLOCK FB_OCPP1_Station VAR_OUTPUT b Busy : BOOL; b Error : BOOL; e Error Result : HRESULT; e Error Action : E_OCPP1_Action; END_VAR Outputs Name Type Description b Valid BOOL The interface to the driver in the background exists. b Busy BOOL Is TRUE as long as the function block is busy with processing. b Error BOOL Becomes TRUE when an error situation occurs. e Error Result HRESULT Last error present on the function block. e Error Action E_OCPP1_Action [} 189] OCPP command for which the error occurred. TF6771 Version: 1.1.0 131
## Page 132

PLC API Properties Name Type Access Description Is Connected BOOL Get Status of the connection to the OCPP server. Is Pending BOOL Get Waiting for completion of the request. Station Id UDINT Get Identifier of the OCPP client in the instance of the OCPP server. 5.1.3.1 FB_Exit Syntax METHOD FB_Exit : BOOL VAR_INPUT b In Copy Code : BOOL; END_VAR Return value Name Type Description FB_Exit BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description b In Copy Code BOOL If TRUE, the Exit method is called to exit an instance, which is then copied (online change). 5.1.3.2 FB_Init Syntax METHOD FB_Init : BOOL VAR_INPUT b Init Retains : BOOL; b In Copy Code : BOOL; s Ident : T_OCPP_Identity; 132 Version: 1.1.0 TF6771
## Page 133

PLC API s Auth Hash : T_OCPP_Hash; fb Server : REFERENCE TO FB_OCPP1_Server; END_VAR Return value Name Type Description FB_Init BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description b Init Retains BOOL If TRUE, the Retain variables are initialized (warm start/cold start). b In Copy Code BOOL If TRUE, the Exit method is called to exit an instance, which is then copied (online change). s Ident T_OCPP_Identity [} 209] Identity of the OCPP client. s Auth Hash T_OCPP_Hash [} 209] Hash generated from the identity and the password. More information on calculating the hash can be found in the appendix [} 211]. fb Server REFERENCE TO OCPP server instance to be used FB_OCPP1_Server [} 76] for this station function block. 5.1.3.3 Init This method is called when the function block is initialized in the FB_Init [} 132] method and specifies the parameters of the Web Sockets server. If the connection parameters are to be changed afterwards, this method can be called again while the application is running. Syntax METHOD Init : BOOL VAR_INPUT s Ident : T_OCPP_Identity; s Auth Hash : T_OCPP_Hash; fb Server : REFERENCE TO FB_OCPP1_Server; END_VAR Return value Name Type Description Init BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 133
## Page 134

PLC API Inputs Name Type Description s Ident T_OCPP_Identity [} 209] Identity of the OCPP client to be connected. s Auth Hash T_OCPP_Hash [} 209] Hash value for the respective OCPP client. The calculation is explained at Hash calculation [} 211]. fb Server REFERENCE TO Instance of the OCPP server for FB_OCPP1_Server [} 76] which the station should be created. 5.1.3.4 Poll Request This method must be called to receive incoming requests from the connected OCPP client. Syntax METHOD Poll Request : BOOL VAR_OUTPUT e Action : E_OCPP1_Action; h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Poll Request BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description e Action E_OCPP1_Action [} 189] Type of OCPP request received from the server. h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.5 Recv Authorize 134 Version: 1.1.0 TF6771
## Page 135

PLC API With this method, an OCPP server receives an Authorize request from the connected OCPP client. To respond to the request, the Resp Authorize [} 147] method must be called. Syntax METHOD Recv Authorize : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Id Tag : T_OCPP1_Id Token; END_VAR Return value Name Type Description Recv Authorize BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Id Tag T_OCPP1_Id Token [} 209] ID token with which the Charge Point wants to be authorized on the Central System. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.6 Recv Boot Notification TF6771 Version: 1.1.0 135
## Page 136

PLC API With this method, an OCPP server receives a Boot Notification from the connected OCPP client. To respond to the boot notification, the Resp Boot Notification [} 148] method must be called. Syntax METHOD Recv Boot Notification : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Model : STRING(31); s Vendor : STRING(31); s Charge Box Serial : STRING(31); s Charge Point Serial : STRING(31); s Firmware Version : STRING(63); s Meter Serial : STRING(31); s Meter Type : STRING(31); END_VAR Return value Name Type Description Recv Boot Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Model STRING(31) Model of the Charge Point. s Vendor STRING(31) Vendor of the Charge Point. s Charge Box Serial STRING(31) Serial number of the Charge Box within the Charge Point. s Charge Point Serial STRING(31) Serial number of the Charge Point. s Firmware Version STRING(63) Firmware version of the Charge Point. s Meter Serial STRING(31) Serial number of the main electricity meter of the Charge Point. s Meter Type STRING(31) Type of main electricity meter of the Charge Point Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 136 Version: 1.1.0 TF6771
## Page 137

PLC API 5.1.3.7 Recv Data Transfer With this method, an OCPP server receives a Data Transfer request from the connected OCPP client. To respond to the request, the Resp Data Transfer [} 149] method must be called. Syntax METHOD Recv Data Transfer : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Vendor Id : STRING(255); s Message Id : STRING(63); END_VAR VAR_IN_OUT s Data : T_OCPP1_Data Transfer Data; END_VAR Return value Name Type Description Recv Data Transfer BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Vendor Id STRING(255) Identifier for the vendor-specific implementation. s Message Id STRING(63) Identifier for the individual message. Inputs/outputs Name Type Description s Data T_OCPP1_Data Transfer Data [} 208] Text without specified length and format. TF6771 Version: 1.1.0 137
## Page 138

PLC API Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.8 Recv Diagnostics Status Notification With this method, an OCPP server receives a Diagnostics Status Notification from the connected OCPP client. To respond to the Diagnostics Status Notification, the Resp Diagnostics Status Notification [} 150] method must be called. Syntax METHOD Recv Diagnostics Status Notification : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Diagnostics Status; END_VAR Return value Name Type Description Recv Diagnostics Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Diagnostics Status [} 193] Status of the upload of the diagnostic data. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 138 Version: 1.1.0 TF6771
## Page 139

PLC API 5.1.3.9 Recv Firmware Status Notification With this method, an OCPP server receives a Firmware Status Notification from the connected OCPP client. To respond to the Firmware Status Notification, the Resp Firmware Status Notification [} 151] method must be called. Syntax METHOD Recv Firmware Status Notification : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Firmware Status; END_VAR Return value Name Type Description Recv Firmware Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Firmware Status [} 193] Status of a firmware installation. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.10 Recv Heartbeat TF6771 Version: 1.1.0 139
## Page 140

PLC API With this method, an OCPP server receives a Heartbeat from the connected OCPP client. To respond to the Heartbeat, the Resp Heartbeat [} 152] method must be called. Syntax METHOD Recv Heartbeat : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Recv Heartbeat BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.11 Recv Meter Value With this method, an OCPP server receives Meter Values from the connected OCPP client. To respond to the receipt of the Meter Values, the Resp Meter Value [} 153] method must be called. Contrary to the specification, it is possible to receive Meter Value messages without Meter Values in order to increase compatibility with other vendors. 140 Version: 1.1.0 TF6771
## Page 141

PLC API Syntax METHOD Recv Meter Value : BOOL VAR_IN_OUT arr Sample Values : ARRAY[*] OF ST_OCPP1_Sampled Value; END_VAR VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; n Transaction Id : UDINT; n Sample Count : UDINT; Return value Name Type Description Recv Meter Value BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs/outputs Name Type Description arr Sample Values ARRAY [*] OF The sampled values sent by the ST_OCPP1_Sampled Value [} 207] client. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. n Transaction Id UDINT The transaction to which the sampled values belong. n Sample Count UDINT The number of sampled values contained. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. TF6771 Version: 1.1.0 141
## Page 142

PLC API 5.1.3.12 Recv Security Event Notification With this method, an OCPP server receives a Security Event Notification from the connected OCPP client. To respond to the Security Event Notification, the Resp Security Event Notification [} 154] method must be called. Syntax METHOD Recv Security Event Notification : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Timestamp : ULINT; s Type : STRING(63); s Info : STRING(256); END_VAR Return value Name Type Description Recv Security Event Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 142 Version: 1.1.0 TF6771
## Page 143

PLC API Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Timestamp ULINT Date and time when the event occurs. s Type STRING(63) Type of the Security Event according to the OCPP specification. s Info STRING(256) Additional information about the Security Event that has occurred. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.13 Recv Start Transaction With this method, an OCPP server receives a Start Transaction request from the connected OCPP client. To respond to the request, the Resp Start Transaction [} 155] method must be called. Syntax METHOD Recv Start Transaction : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Id Tag : T_OCPP1_Id Token; n Connector Id : UDINT; n Meter Start : UDINT; n Reservation Id : UDINT; n Timestamp : ULINT; END_VAR Return value Name Type Description Recv Start Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 143
## Page 144

PLC API Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Id Tag T_OCPP1_Id Token [} 209] ID token with which the transaction is to be started. n Connector Id UDINT ID of the Connector of a Charge Point. n Meter Start UDINT Value in watt-hours at the start of the transaction. n Reservation Id UDINT Optional reservation ID. n Timestamp ULINT Date and time at the start of the transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.14 Recv Status Notification With this method, an OCPP server receives a Status Notification from the connected OCPP client. To respond to the Status Notification, the Resp Status Notification [} 156] method must be called. Syntax METHOD Recv Status Notification : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; n Connector Id : UDINT; e Error : E_OCPP1_Charge Point Error; e Status : E_OCPP1_Charge Point Status; n Timestamp : ULINT := 0; s Info : STRING(63) := ''; s Vendor Error : STRING(63) := ''; s Vendor Id : STRING(255) := ''; END_VAR 144 Version: 1.1.0 TF6771
## Page 145

PLC API Return value Name Type Description Recv Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. n Connector Id UDINT ID of the Connector of a Charge Point. e Error E_OCPP1_Charge Point Error [} 190] Error code received in the Status Notification. e Status E_OCPP1_Charge Point Status Status received in the Status Notification. [} 191] n Timestamp ULINT The timestamp of the Status Notification. s Info STRING(63) Contains optional, freely definable additional information on the error. s Vendor Error STRING(63) Optionally contains the vendor- specific error code. s Vendor Id STRING(255) Optionally contains the identifier for the vendor-specific implementation. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.15 Recv Stop Transaction With this method, an OCPP server receives a Stop Transaction request from the connected OCPP client. To respond to the request, the Resp Stop Transaction [} 157] method must be called. TF6771 Version: 1.1.0 145
## Page 146

PLC API Syntax METHOD Recv Stop Transaction : BOOL VAR_OUTPUT h Message Id : T_OCPP_Message Id; s Id Tag : T_OCPP1_Id Token; n Transaction Id : UDINT; n Connector Id : UDINT; n Meter Stop : UDINT; n Timestamp : ULINT; e Reason : E_OCPP1_Reason; END_VAR Return value Name Type Description Recv Stop Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. s Id Tag T_OCPP1_Id Token [} 209] ID token for which the transaction is to be stopped. n Transaction Id UDINT ID of the transaction to be stopped. Is contained in the Central System's response to a Start Transaction request. n Connector Id UDINT ID of the Connector of a Charge Point. n Meter Stop UDINT Value in watt-hours at the end of the transaction. n Timestamp ULINT Date and time when the transaction is stopped. e Reason E_OCPP1_Reason [} 195] Can optionally contain the reason for stopping the transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 146 Version: 1.1.0 TF6771
## Page 147

PLC API 5.1.3.16 Reset This method is used to reset the last error present on the function block. Syntax METHOD Reset : BOOL Return value Name Type Description Reset BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 5.1.3.17 Resp Authorize With this method, an OCPP server responds to an Authorize request from the connected OCPP client. Syntax METHOD Resp Authorize : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Authorization Status; END_VAR TF6771 Version: 1.1.0 147
## Page 148

PLC API Return value Name Type Description Resp Authorize BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Authorization Status Status of the authorization in response to the OCPP client. [} 190] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.18 Resp Boot Notification With this method, an OCPP server responds to a Boot Notification from the connected OCPP client. Syntax METHOD Resp Boot Notification : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Registration Status; t Heartbeat Interval : TIME := T#5S; END_VAR Return value Name Type Description Resp Boot Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 148 Version: 1.1.0 TF6771
## Page 149

PLC API Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Registration Status [} 196] Status of the registration in response to the OCPP client. t Heartbeat Interval TIME If the registration status is Accepted, this variable contains the Heartbeat Interval for the connection. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.19 Resp Data Transfer With this method, an OCPP server responds to a Data Transfer request from the connected OCPP client. Syntax METHOD Resp Data Transfer : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Data Transfer Status; END_VAR Return value Name Type Description Resp Data Transfer BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. TF6771 Version: 1.1.0 149
## Page 150

PLC API Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Data Transfer Status Status of the Data Transfer in response to the OCPP client. [} 193] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.20 Resp Diagnostics Status Notification With this method, an OCPP server responds to a Status Notification from the connected OCPP client. Syntax METHOD Resp Diagnostics Status Notification : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Diagnostics Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 150 Version: 1.1.0 TF6771
## Page 151

PLC API 5.1.3.21 Resp Error With this method, an OCPP server responds to the connected OCPP client if the sent request has triggered an internal error. This may be the case, for example, if a requested action is not available. Syntax METHOD Resp Error : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Act : E_OCPP1_Action := E_OCPP1_Action. Heartbeat; e Err : E_OCPP1_Error := E_OCPP1_Error. None; END_VAR Return value Name Type Description Resp Error BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Act E_OCPP1_Action [} 189] Type of OCPP request for which the error occurred. e Err E_OCPP1_Error [} 193] OCPP error that will be the response to the request. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.22 Resp Firmware Status Notification With this method, an OCPP server responds to a Firmware Status Notification from the connected OCPP client. TF6771 Version: 1.1.0 151
## Page 152

PLC API Syntax METHOD Resp Firmware Status Notification : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Firmware Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.23 Resp Heartbeat With this method, an OCPP server responds to a Heartbeat from the connected OCPP client. 152 Version: 1.1.0 TF6771
## Page 153

PLC API Syntax METHOD Resp Heartbeat : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Heartbeat BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.24 Resp Meter Value With this method, an OCPP server responds to the sending of Meter Values from the connected OCPP client. TF6771 Version: 1.1.0 153
## Page 154

PLC API Syntax METHOD Resp Meter Value : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Meter Value BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.25 Resp Security Event Notification With this method, an OCPP server responds to a Security Event Notification from the connected OCPP client. 154 Version: 1.1.0 TF6771
## Page 155

PLC API Syntax METHOD Resp Security Event Notification : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Security Event Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.26 Resp Start Transaction TF6771 Version: 1.1.0 155
## Page 156

PLC API With this method, an OCPP server responds to a Start Transaction request from the connected OCPP client. Syntax METHOD Resp Start Transaction : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Authorization Status; n Transaction Id : UDINT; END_VAR Return value Name Type Description Resp Start Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Authorization Status Status of the authorization in response to the OCPP client. [} 190] n Transaction Id UDINT ID defined by the Central System for the transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.27 Resp Status Notification With this method, an OCPP server responds to a Status Notification from the connected OCPP client. 156 Version: 1.1.0 TF6771
## Page 157

PLC API Syntax METHOD Resp Status Notification : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; END_VAR Return value Name Type Description Resp Status Notification BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.28 Resp Stop Transaction With this method, an OCPP server responds to a Stop Transaction request from the connected OCPP client. Syntax METHOD Resp Stop Transaction : BOOL VAR_INPUT h Message Id : T_OCPP_Message Id; e Status : E_OCPP1_Authorization Status; END_VAR TF6771 Version: 1.1.0 157
## Page 158

PLC API Return value Name Type Description Resp Stop Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description h Message Id T_OCPP_Message Id [} 209] Message Id of the received message. e Status E_OCPP1_Authorization Status Status of the authorization in response to the OCPP client. [} 190] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.29 Send Cancel Reservation With this method, an OCPP server sends a Cancel Reservation request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Cancel Reservation : BOOL VAR_INPUT n Reservation Id : UDINT; END_VAR VAR_OUTPUT e Status : E_OCPP1_Cancel Reservation Status; END_VAR 158 Version: 1.1.0 TF6771
## Page 159

PLC API Return value Name Type Description Send Cancel Reservation BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Reservation Id UDINT ID of the reservation to be canceled. Outputs Name Type Description e Status E_OCPP1_Cancel Reservation Status The status shows whether the reservation was successfully [} 190] canceled. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.30 Send Change Availability With this method, an OCPP server sends a Change Availability request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Change Availability : BOOL VAR_INPUT n Connector Id : UDINT; e Type : E_OCPP1_Availability Type; END_VAR VAR_OUTPUT e Status : E_OCPP1_Availability Status; END_VAR TF6771 Version: 1.1.0 159
## Page 160

PLC API Return value Name Type Description Send Change Availability BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. e Type E_OCPP1_Availability Type [} 190] Type of availability change that the Charge Point is to carry out. Outputs Name Type Description e Status E_OCPP1_Availability Status [} 190] Response whether the Charge Point was able to implement the requested availability change. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.31 Send Change Configuration With this method, an OCPP server sends a Change Configuration request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Change Configuration : BOOL VAR_INPUT s Key : T_OCPP1_Config Key; s Value : T_OCPP1_Config Value; END_VAR VAR_OUTPUT e Status : E_OCPP1_Configuration Status; END_VAR 160 Version: 1.1.0 TF6771
## Page 161

PLC API Return value Name Type Description Send Change Configuration BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description s Key T_OCPP1_Config Key [} 208] The name of the configuration setting to be changed. s Value T_OCPP1_Config Value [} 208] The new value of the configuration setting. Outputs Name Type Description e Status E_OCPP1_Configuration Status The status indicates whether the configuration change has been [} 193] accepted. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.32 Send Charging Profile With this method, an OCPP server sends a Charging Profile to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Charging Profile : BOOL VAR_INPUT n Connector Id : UDINT; TF6771 Version: 1.1.0 161
## Page 162

PLC API m Charging Profile : REFERENCE TO ST_OCPP1_Charging Profile Max; END_VAR VAR_OUTPUT e Status : E_OCPP1_Charging Profile Status; END_VAR Return value Name Type Description Send Charging Profile BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. m Charging Profile REFERENCE TO Charging Profile to be sent to the ST_OCPP1_Charging Profile Max client. [} 204] Outputs Name Type Description e Status E_OCPP1_Charging Profile Status The status indicates whether the Charging Profile has been [} 191] accepted by the Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.33 Send Clear Cache With this method, an OCPP server sends a Clear Cache request to the connected OCPP client. The response from the OCPP client is processed directly within the method. 162 Version: 1.1.0 TF6771
## Page 163

PLC API Syntax METHOD Send Clear Cache : BOOL VAR_OUTPUT e Status : E_OCPP1_Clear Cache Status; END_VAR Return value Name Type Description Send Clear Cache BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description e Status E_OCPP1_Clear Cache Status [} 192] The status indicates whether the clearing of the Cache Profile has been accepted by the Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.34 Send Clear Charging Profile With this method, an OCPP server sends a Clear Charging Profile request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Clear Charging Profile : BOOL VAR_INPUT n Profile Id : UDINT := 0; n Connector Id : UDINT := 0; e Charging Profile Purpose : E_OCPP1_Charging Profile Purpose Type := E_OCPP_Charging Profile Purpose Typ e. None; n Stack Level : UDINT := 0; END_VAR VAR_OUTPUT e Status : E_OCPP1_Clear Charging Profile Status; END_VAR TF6771 Version: 1.1.0 163
## Page 164

PLC API Return value Name Type Description Send Clear Charging Profile BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Profile Id UDINT Identifier of the Charging Profile to be cleared. n Connector Id UDINT ID of the Connector of a Charge Point. The value 0 indicates that the clearing relates to the entire Charge Point. e Charging Profile Purpose E_OCPP1_Charging Profile Purpose T Specifies the purpose of the Charging Profiles to be cleared. ype [} 191] n Stack Level UDINT Specifies the Stack Level for which Charging Profiles are cleared. Outputs Name Type Description e Status E_OCPP1_Clear Charging Profile Statu The status indicates whether the Charging Profile could be cleared s [} 192] from the Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.35 Send Data Transfer With this method, an OCPP server sends a Data Transfer request to the corresponding OCPP client. The response from the OCPP client is processed directly within the method. 164 Version: 1.1.0 TF6771
## Page 165

PLC API Syntax METHOD Send Data Transfer : BOOL VAR_INPUT s Vendor Id : STRING(255); s Message Id : STRING(63) := ''; END_VAR VAR_IN_OUT CONSTANT s Data : T_OCPP1_Data Transfer Data; END_VAR VAR_OUTPUT e Status : E_OCPP1_Data Transfer Status; END_VAR Return value Name Type Description Send Data Transfer BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description s Vendor Id STRING(255) Identifier for the vendor, which identifies the vendor-specific implementation. s Message Id STRING(63) Additional identification field for a single message. Inputs/outputs Name Type Description s Data T_OCPP1_Data Transfer Data [} 208] Text without specified length and format. Outputs Name Type Description e Status E_OCPP1_Data Transfer Status Status of the Data Transfer. [} 193] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.36 Send Get Composite Schedule With this method, an OCPP server sends a Get Composite Schedule request to the connected OCPP client. The response from the OCPP client is processed directly within the method. TF6771 Version: 1.1.0 165
## Page 166

PLC API Syntax METHOD Send Get Composite Schedule : BOOL VAR_INPUT n Connector Id : UDINT; n Duration : UDINT; e Charging Rate Unit : E_OCPP1_Charging Rate Unit Type := E_OCPP_Charging Rate Unit Type. None; END_VAR VAR_OUTPUT e Status : E_OCPP1_Get Composite Schedule Status; n Connector Id Res : UDINT; n Schedule Start : ULINT := 0; m Charging Schedule : ST_OCPP1_Charging Schedule Max; END_VAR Return value Name Type Description Send Get Composite Schedule BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. n Duration UDINT Length of the requested schedule. e Charging Rate Unit E_OCPP1_Charging Rate Unit Type Used to specify the unit for the request. [} 192] Outputs Name Type Description e Status E_OCPP1_Get Composite Schedule St The status shows whether the schedule request could be atus [} 194] answered by the Charge Point. n Connector Id Res UDINT Identifier of the Connector to which the schedule in the response refers. n Schedule Start ULINT Start time of the schedule. m Charging Schedule ST_OCPP1_Charging Schedule Max Requested schedule. [} 204] Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 166 Version: 1.1.0 TF6771
## Page 167

PLC API 5.1.3.37 Send Get Configuration With this method, an OCPP server sends a Get Configuration request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Get Configuration : BOOL VAR_IN_OUT arr Keys : ARRAY[*] OF ST_OCPP1_Config Key Value; END_VAR VAR_OUTPUT n Keys Count : UDINT := 0; n Unknown Count : UDINT := 0; END_VAR Return value Name Type Description Send Get Configuration BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs/outputs Name Type Description arr Keys ARRAY [*] OF List of requested or known ST_OCPP1_Config Key Value [} 207] configuration keys for which the configuration is requested. Outputs Name Type Description n Keys Count UDINT Number of the following configuration keys. n Unknown Count UDINT Number of the following unknown configuration keys. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. TF6771 Version: 1.1.0 167
## Page 168

PLC API 5.1.3.38 Send Get Diagnostics With this method, an OCPP server sends a Get Diagnostics request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Get Diagnostics : BOOL VAR_INPUT s Location : STRING(255); n Retries : UDINT := 0; n Retry Interval : UDINT := 0; n Start Time : ULINT := 0; n Stop Time : ULINT := 0; END_VAR VAR_OUTPUT s File Name : STRING(255); END_VAR Return value Name Type Description Send Get Diagnostics BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. 168 Version: 1.1.0 TF6771
## Page 169

PLC API Inputs Name Type Description s Location STRING(255) Directory to which the diagnostic file is to be uploaded. n Retries UDINT Number of attempts made by the Charge Point if the upload fails. n Retry Interval UDINT Interval after which a new upload is attempted. n Start Time ULINT Start time of the logging information contained in the diagnostics. n Stop Time ULINT End time of the logging information contained in the diagnostics. Outputs Name Type Description s File Name STRING(255) Contains the name of the diagnostic file that will be uploaded. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.39 Send Get Local List Version With this method, an OCPP server sends a Get Local List Version request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Get Local List Version : BOOL VAR_OUTPUT n List Version : UDINT; END_VAR TF6771 Version: 1.1.0 169
## Page 170

PLC API Return value Name Type Description Send Get Local List Version BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Outputs Name Type Description n List Version UDINT Contains the version number of the Local Authorization List currently available in the Charge Point. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.40 Send Local List With this method, an OCPP server sends a Send Local List request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Local List : BOOL VAR_INPUT n List Version : UDINT; e Update Type : E_OCPP1_Update Type; n Auth Count : UDINT := 0; END_VAR VAR_IN_OUT arr Auth List : ARRAY[*] OF ST_OCPP1_Authorization Data; END_VAR VAR_OUTPUT e Status : E_OCPP1_Update Status; END_VAR 170 Version: 1.1.0 TF6771
## Page 171

PLC API Return value Name Type Description Send Local List BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n List Version UDINT Version of the Local Authorization List provided as an update. e Update Type E_OCPP1_Update Type [} 197] Definition of the update type, either as an update or as a complete replacement. n Auth Count UDINT Number of entries in the Local Authorization List. Inputs/outputs Name Type Description arr Auth List ARRAY [*] OF Either the values of the new Local ST_OCPP1_Authorization Data Authorization List (complete replacement) or values to be added [} 202] to the existing Local Authorization List (update). Outputs Name Type Description e Status E_OCPP1_Update Status [} 197] The status indicates whether the Charge Point has received and carried out the Local Authorization List update. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.41 Send Remote Start Transaction With this method, an OCPP server sends a Remote Start Transaction request to the connected OCPP client. The response from the OCPP client is processed directly within the method. TF6771 Version: 1.1.0 171
## Page 172

PLC API Syntax METHOD Send Remote Start Transaction : BOOL VAR_INPUT n Connector Id : UDINT := 0; s Id Token : T_OCPP1_Id Token; END_VAR VAR_OUTPUT e Status : E_OCPP1_Remote Start Stop Status; END_VAR Return value Name Type Description Send Remote Start Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. s Id Token T_OCPP1_Id Token [} 209] ID token of the Charge Point in the Central System. Outputs Name Type Description e Status E_OCPP1_Remote Start Stop Status The status shows whether the Charge Point has accepted the [} 196] request to start a transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.42 Send Remote Start Transaction Profile With this method, an OCPP server sends a Remote Start Transaction request including a Charging Profile to the connected OCPP client. The response from the OCPP client is processed directly within the method. 172 Version: 1.1.0 TF6771
## Page 173

PLC API Syntax METHOD Send Remote Start Transaction Profile : BOOL VAR_INPUT n Connector Id : UDINT := 0; s Id Token : T_OCPP1_Id Token; m Charging Profile : REFERENCE TO ST_OCPP1_Charging Profile REF= 0; END_VAR VAR_OUTPUT e Status : E_OCPP1_Remote Start Stop Status; END_VAR Return value Name Type Description Send Remote Start Transaction Profil BOOL The method returns the return e value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. s Id Token T_OCPP1_Id Token [} 209] ID token of the Charge Point in the Central System. m Charging Profile REFERENCE TO Charging Profile to be sent to the ST_OCPP1_Charging Profile Max client. [} 204] Outputs Name Type Description e Status E_OCPP1_Remote Start Stop Status The status shows whether the Charge Point has accepted the [} 196] request to start a transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.43 Send Remote Stop Transaction TF6771 Version: 1.1.0 173
## Page 174

PLC API With this method, an OCPP server sends a Remote Stop Transaction request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Remote Stop Transaction : BOOL VAR_INPUT n Transaction Id : UDINT; END_VAR VAR_OUTPUT e Status : E_OCPP1_Remote Start Stop Status; END_VAR Return value Name Type Description Send Remote Stop Transaction BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Transaction Id UDINT Identifier of the transaction to be stopped. Outputs Name Type Description e Status E_OCPP1_Remote Start Stop Status The status indicates whether the Charge Point has accepted the [} 196] request to stop a transaction. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.44 Send Reserve Now 174 Version: 1.1.0 TF6771
## Page 175

PLC API With this method, an OCPP server sends a Reserve Now request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Reserve Now : BOOL VAR_INPUT h Station Id : UDINT; n Connector Id : UDINT; n Expiry Date : ULINT; s Id Tag : T_OCPP1_Id Token; s Parent Id Tag : T_OCPP1_Id Token := ''; n Reservation Id : UDINT; END_VAR VAR_OUTPUT e Status : E_OCPP1_Reservation Status; END_VAR Return value Name Type Description Send Reserve Now BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. n Expiry Date ULINT Date and time of the end of the reservation. s Id Tag T_OCPP1_Id Token [} 209] Identifier for which the Charge Point should reserve a Connector. s Parent Id Tag T_OCPP1_Id Token [} 209] The parent of the identifier for which the Charge Point is to reserve a Connector. n Reservation Id UDINT Unique ID of the reservation. Outputs Name Type Description e Status E_OCPP1_Reservation Status [} 196] The status indicates whether the reservation was successful. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.45 Send Reset With this method, an OCPP server sends a Reset request to the connected OCPP client. The response from the OCPP client is processed directly within the method. TF6771 Version: 1.1.0 175
## Page 176

PLC API Syntax METHOD Send Reset : BOOL VAR_INPUT e Type : E_OCPP1_Reset Type; END_VAR VAR_OUTPUT e Status : E_OCPP1_Reset Status; END_VAR Return value Name Type Description Send Reset BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description e Type E_OCPP1_Reset Type [} 196] Type of reset that the Charge Point should perform. Outputs Name Type Description e Status E_OCPP1_Reset Status [} 196] The status shows whether the Charge Point was able to accept the Reset request. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.46 Send Trigger Message 176 Version: 1.1.0 TF6771
## Page 177

PLC API With this method, an OCPP server sends a Trigger Message request to the connected OCPP client. The response from the OCPP client is processed directly within the method. Syntax METHOD Send Trigger Message : BOOL VAR_INPUT e Requested Message : E_OCPP1_Message Trigger; n Connector Id : UDINT := 0; END_VAR VAR_OUTPUT e Status : E_OCPP1_Trigger Message Status; END_VAR Return value Name Type Description Send Trigger Message BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description e Requested Message E_OCPP1_Message Trigger [} 194] Type of message to be triggered. n Connector Id UDINT ID of the Connector of a Charge Point. Outputs Name Type Description e Status E_OCPP1_Trigger Message Status The status indicates whether the Charge Point will send the [} 196] requested message or not. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.47 Send Unlock Connector With this method, an OCPP server sends an Unlock Connector request to the connected OCPP client. The response from the OCPP client is processed directly within the method. TF6771 Version: 1.1.0 177
## Page 178

PLC API Syntax METHOD Send Unlock Connector : BOOL VAR_INPUT n Connector Id : UDINT; END_VAR VAR_OUTPUT e Status : E_OCPP1_Unlock Status; END_VAR Return value Name Type Description Send Unlock Connector BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. Outputs Name Type Description e Status E_OCPP1_Unlock Status [} 197] The status shows whether the Connector has been unlocked. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. 5.1.3.48 Send Update Firmware With this method, an OCPP server sends an Update Firmware request to the connected OCPP client. The response from the OCPP client is processed directly within the method. 178 Version: 1.1.0 TF6771
## Page 179

PLC API Syntax METHOD Send Update Firmware : BOOL VAR_INPUT s Location : STRING(255); n Retries : UDINT := 0; n Retry Interval : UDINT := 0; n Retrieve Date : ULINT; END_VAR Return value Name Type Description Send Update Firmware BOOL The method returns the return value TRUE if the call was successful. A method call is also considered successfully completed in the event of an error. Inputs Name Type Description s Location STRING(255) URI from which the firmware is to be retrieved. n Retries UDINT Number of attempts to download the firmware again if the download fails. n Retry Interval UDINT Time after which the download is attempted again. n Retrieve Date ULINT Time and date from which the Charge Point may receive the new firmware. Possible errors are output at the outputs b Error and hr Error Code of the function block instance. TF6771 Version: 1.1.0 179
## Page 180

PLC API 5.1.4 FB_OCPP1_Charging Profile This function block can be used to query the currently available Charging Profiles. Syntax FUNCTION BLOCK FB_OCPP1_Charging Profile VAR_OUTPUT n Schedule Time : ULINT; END_VAR Outputs Name Type Description n Schedule Time ULINT The current timestamp used to schedule the Charging Profiles. 5.1.4.1 Execute This method must be called cyclically if the function block should be used. The instance of FB_OCPP1_Client [} 21] must be transferred. In addition, information is required on which connector is currently charging. This allows the starting point of the Charging Schedule to be calculated. Syntax METHOD PUBLIC Execute : BOOL VAR_INPUT arr Charging : ARRAY[1.. Param_OCPP.n Connector Count] OF BOOL; fb Client : REFERENCE TO FB_OCPP1_Client; END_VAR Return value Name Type Description Execute BOOL The return value of the method is not currently assigned and always returns the value FALSE. Inputs Name Type Description arr Charging ARRAY [1.. Param_OCPP Per connector within a Charge Point, the information as to whether [} 209].n Connector Count] OF charging is in progress or not. BOOL fb Client REFERENCE TO FB_OCPP1_Client Instance of the OCPP client. [} 21] 180 Version: 1.1.0 TF6771
## Page 181

PLC API 5.1.4.2 Get Current Period This method can be used to read the current Charging Schedule Period for a specific Connector of a Charge Point. Syntax METHOD PUBLIC Get Current Period : BOOL VAR_INPUT n Connector Id : UDINT; END_VAR VAR_IN_OUT m Period : ST_OCPP1_Charging Schedule Period; END_VAR Return value Name Type Description Get Current Period BOOL The return value of the method is not currently assigned and always returns the value FALSE. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. Inputs/outputs Name Type Description m Period ST_OCPP1_Charging Schedule Perio The current Charging Schedule Period at the Charge Point. d [} 206] 5.1.4.3 Get Current Schedule This method can be used to read the current Charging Schedule for a specific Connector of a Charge Point. Syntax METHOD PUBLIC Get Current Schedule : BOOL VAR_INPUT n Connector Id : UDINT; END_VAR VAR_IN_OUT m Charging Schedule : ST_OCPP1_Charging Schedule Max; END_VAR TF6771 Version: 1.1.0 181
## Page 182

PLC API Return value Name Type Description Get Current Schedule BOOL The return value of the method is not currently assigned and always returns the value FALSE. Inputs Name Type Description n Connector Id UDINT ID of the Connector of a Charge Point. Inputs/outputs Name Type Description m Charging Schedule ST_OCPP1_Charging Schedule Max The current Charging Schedule at the Charge Point. [} 205] 5.1.5 FB_OCPP1_Configuration This function block can be used to manage the Configuration Keys of an instance of FB_OCPP1_Client [} 21]. Various methods are provided for the following purposes: • Getting the last changes to Configuration Keys • Initializing new Configuration Keys • Initializing default values (for list see Configuration Keys [} 211]) • Setting new values for Configuration Keys • Receiving Change Configuration and Get Configuration requests from an OCPP server with automatic response within the OCPP client Syntax FUNCTION BLOCK FB_OCPP1_Configuration 5.1.5.1 Get Changed This method can be used to get the last change to the Config Keys that are part of the enumeration E_OCPP1_Config Key [} 192]. Syntax METHOD Get Changed : BOOL VAR_OUTPUT e Key : E_OCPP1_Config Key; s Value : T_OCPP1_Config Value; END_VAR 182 Version: 1.1.0 TF6771
## Page 183

PLC API Return value Name Type Description Get Changed BOOL The method returns TRUE if the method call is successful. Outputs Name Type Description e Key E_OCPP1_Config Key [} 192] Config Key for which the last change was made. s Value T_OCPP1_Config Value [} 208] The corresponding value. 5.1.5.2 Get Changed Ex This method can be used to get the last change to the Config Keys that are not part of the enumeration E_OCPP1_Config Key [} 192]. Syntax METHOD Get Changed Ex : BOOL VAR_OUTPUT s Key : T_OCPP1_Config Key; s Value : T_OCPP1_Config Value; END_VAR Return value Name Type Description Get Changed BOOL The method returns TRUE if the method call is successful. Outputs Name Type Description s Key T_OCPP1_Config Key [} 208] Config Key for which the last change was made. s Value T_OCPP1_Config Value [} 208] The corresponding value. 5.1.5.3 Get Value This method can be used to get the current value of a Config Key that is part of the enumeration E_OCPP1_Config Key [} 192]. TF6771 Version: 1.1.0 183
## Page 184

PLC API Syntax METHOD Get Value : T_OCPP1_Config Value VAR_INPUT e Key : E_OCPP1_Config Key; END_VAR Return value Name Type Description Get Value T_OCPP1_Config Value [} 208] Current value of the queried Config Key. Inputs Name Type Description e Key E_OCPP1_Config Key [} 192] Config Key for which the current value is to be queried. 5.1.5.4 Get Value Ex This method can be used to query the current value of a Config Key. Syntax METHOD Get Value Ex : T_OCPP1_Config Value VAR_INPUT s Key : T_OCPP1_Config Key; END_VAR Return value Name Type Description Get Value T_OCPP1_Config Value [} 208] Current value of the queried Config Key. Inputs Name Type Description s Key T_OCPP1_Config Key [} 208] Config Key for which the current value is to be queried. 5.1.5.5 Init Key Value This method can be used to add new Key/Value pairs for Configuration Keys that are part of the enumeration E_OCPP1_Config Key [} 192]. If a Key is transferred that is already known in the OCPP client, the value is overwritten. The method Init Key Value Ex [} 185] can be used to add user-defined Keys. 184 Version: 1.1.0 TF6771
## Page 185

PLC API Syntax METHOD Init Key Value : UDINT VAR_INPUT e Key : E_OCPP1_Config Key; s Value : T_OCPP1_Config Value; b Readonly : BOOL; END_VAR Return value Name Type Description Init Key Value UDINT The assigned index of the Config Key. At present, however, this index is only used internally and does not need to be taken into account during programming. Inputs Name Type Description e Key E_OCPP1_Config Key [} 192] Configuration Key to be overwritten or added. s Value T_OCPP1_Config Value [} 208] Value of the associated Configuration Key. b Readonly BOOL Determines the access right of the Central System, either the value may only be read (TRUE) or also written (FALSE). 5.1.5.6 Init Key Value Ex This method can be used to add new Key/Value pairs for Configuration Keys. If a Key is transferred that is already known in the OCPP client, the value is overwritten. The method can be used to add user-defined Keys that are not part of the enumeration E_OCPP1_Config Key [} 192]. Syntax METHOD Init Key Value Ex : UDINT VAR_INPUT s Key : T_OCPP1_Config Key; s Value : T_OCPP1_Config Value; b Readonly : BOOL; END_VAR Return value Name Type Description Init Key Value Ex UDINT The assigned index of the Config Key. At present, however, this index is only used internally and does not need to be taken into account during programming. TF6771 Version: 1.1.0 185
## Page 186

PLC API Inputs Name Type Description s Key T_OCPP1_Config Key [} 208] Configuration Key to be overwritten or added. s Value T_OCPP1_Config Value [} 208] Value of the associated Configuration Key. b Readonly BOOL Determines the access right of the Central System, either the value may only be read (TRUE) or also written (FALSE). 5.1.5.7 Init Standard This method is used to set default values for some of the Configuration Keys described in the OCPP specification. The list of Configuration Keys and their default assignment can be found in the appendix [} 211]. Syntax METHOD Init Standard : BOOL Return value Name Type Description Init Standard BOOL The return value of the method is not currently assigned and always returns the value FALSE. 5.1.5.8 Set Value This method can be used to write a new value for a Config Key from the enumeration E_OCPP1_Config Key [} 192]. Syntax METHOD Set Value : BOOL VAR_INPUT e Key : E_OCPP1_Config Key; END_VAR VAR_IN_OUT CONSTANT s Value : T_OCPP1_Config Value; END_VAR Return value Name Type Description Set Value BOOL The method returns TRUE if the method call is successful. 186 Version: 1.1.0 TF6771
## Page 187

PLC API Inputs Name Type Description e Key E_OCPP1_Config Key [} 192] Config Key that is to be rewritten. Inputs/outputs Name Type Description s Value T_OCPP1_Config Value [} 208] New value for the Config Key to be written. 5.1.5.9 Set Value Ex This method can be used to set a new value for a Config Key. Syntax METHOD Set Value Ex : BOOL VAR_INPUT s Key : T_OCPP1_Config Key; END_VAR VAR_IN_OUT CONSTANT s Value : T_OCPP1_Config Value; END_VAR Return value Name Type Description Set Value Ex BOOL The method returns TRUE if the method call is successful. Inputs Name Type Description s Key T_OCPP1_Config Key [} 208] Config Key that is to be rewritten. Inputs/outputs Name Type Description s Value T_OCPP1_Config Value [} 208] New value for the Config Key to be written. Also see about this 2 E_OCPP1_Config Key [} 192] TF6771 Version: 1.1.0 187
## Page 188

PLC API 5.1.5.10 Recv Change Configuration This method is an alternative way of receiving and responding to a Change Configuration Request from the corresponding OCPP server in the OCPP client. In contrast to the Recv Change Configuration [} 29] method at FB_OCPP1_Client [} 21], the response is sent automatically to the OCPP server. If the Configuration Keys to be written are read-only, they are not written. All writable Configuration Keys are saved by the method. Syntax METHOD Recv Change Configuration : BOOL VAR_INPUT fb Client : REFERENCE TO FB_OCPP1_Client; END_VAR Return value Name Type Description Recv Change Configuration BOOL Not currently implemented. In future versions: if the method call is successful, the method returns TRUE. Inputs/outputs Name Type Description fb Client REFERENCE TO FB_OCPP1_Client Instance of the client function block used. [} 21] 5.1.5.11 Recv Get Configuration This method is an alternative way of receiving and responding to a Get Configuration Request from the corresponding OCPP server in the OCPP client. In contrast to the Recv Get Configuration [} 34] method at FB_OCPP1_Client [} 21], the response is sent automatically to the OCPP server. Depending on the request, it contains all or specifically requested Configuration Keys. Syntax METHOD Recv Get Configuration : BOOL VAR_INPUT fb Client : REFERENCE TO FB_OCPP1_Client; END_VAR 188 Version: 1.1.0 TF6771
## Page 189

PLC API Return value Name Type Description Recv Get Configuration BOOL Not currently implemented. In future versions: if the method call is successful, the method returns TRUE. Inputs/outputs Name Type Description fb Client REFERENCE TO FB_OCPP1_Client Instance of the client function block used. [} 21] 5.2 DUTs 5.2.1 Enumerations 5.2.1.1 E_OCPP1_Action TYPE E_OCPP1_Action : ( None := 0, // Core Boot Notification := 10001, Heartbeat := 10002, Meter Values := 10003, Status Notification := 10004, Authorize := 10005, Start Transaction := 10006, Stop Transaction := 10007, Remote Start Transaction := 10011, Remote Stop Transaction := 10012, Change Availability := 10013, Change Configuration := 10014, Get Configuration := 10015, Unlock Connector := 10016, Clear Cache := 10017, Reset := 10018, // Remote Trigger Trigger Message := 10021, // Reservation Reserve Now := 10031, Cancel Reservation := 10032, // Smart Charging Set Charging Profile := 10041, Get Composite Schedule := 10042, Clear Charging Profile := 10043, // Authentication Get Local List Version := 10051, Send Local List := 10052, // Firmware Diagnostics Status Notification := 10061, Firmware Status Notification := 10062, Get Diagnostics := 10063, Update Firmware := 10064, // Vendor Data Transfer := 10091, // Security Security Event Notification := 11001, Extended Trigger Message := 11002, Log Status Notification := 11003, Get Log := 11004, Get Installed Certificate Ids := 11005, Certificate Signed := 11006, Sign Certificate := 11007, Install Certificate := 11008, Delete Certificate := 11009, TF6771 Version: 1.1.0 189
## Page 190

PLC API Signed Firmware Status Notification := 11010, Signed Update Firmware := 11011 ) UDINT; END_TYPE 5.2.1.2 E_OCPP1_Authentication Mode TYPE E_OCPP1_Authentication Mode : ( None := 0, // No Authentication Ident := 1, // Ident Authentication Basic := 2 // Basic Authentication ) UDINT; END_TYPE 5.2.1.3 E_OCPP1_Authorization Status TYPE E_OCPP1_Authorization Status : ( None := 0, // Any status not covered by this implementation Accepted, // Identifier is allowed for charging. Blocked, // Identifier has been blocked. Not allowed for charging. Expired, // Identifier has expired. Not allowed for charging. Invalid, // Identifier is unknown. Not allowed for charging. Concurrent Tx // Identifier is already involved in another transaction and multiple transacti ons are not allowed. ) UDINT; END_TYPE 5.2.1.4 E_OCPP1_Availability Status TYPE E_OCPP1_Availability Status : ( None := 0, // Any status not covered by this implementation Accepted, // Request has been accepted and will be executed. Rejected, // Request has not been accepted and will not be executed. Scheduled // Request has been accepted and will be executed when transaction(s) in progress have finished. ) UDINT; END_TYPE 5.2.1.5 E_OCPP1_Availability Type TYPE E_OCPP1_Availability Type : ( None := 0, // Any status not covered by this implementation Inoperative, // Charge point is not available for charging. Operative // Charge point is available for charging. ) UDINT; END_TYPE 5.2.1.6 E_OCPP1_Cancel Reservation Status TYPE E_OCPP1_Cancel Reservation Status : ( None := 0, // Any status not covered by this implementation Accepted, // Reservation for the identifier has been cancelled. Rejected // Reservation could not be cancelled, because there is no reservation active for the identifier. ) UDINT; END_TYPE 5.2.1.7 E_OCPP1_Charge Point Error TYPE E_OCPP1_Charge Point Error : ( None := 0, // Any status not covered by this implementation No Error, // No error to report. Connector Lock Failure, // Failure to lock or unlock connector. EVCommunication Error, // Communication failure with the vehicle, might be Mode 3 or other commun ication protocol problem. Ground Failure, // Ground fault circuit interrupter has been activated. High Temperature, // Temperature inside Charge Point is too high. 190 Version: 1.1.0 TF6771
## Page 191

PLC API Internal Error, // Error in internal hard - or software component. Local List Conflict, // The authorization information received from the Central System is in co nflict with the Local Authorization List. Over Current Failure, // Over current protection device has tripped. Over Voltage, // Voltage has risen above an acceptable level. Power Meter Failure, // Failure to read electrical / energy / power meter. Power Switch Failure, // Failure to control power switch. Reader Failure, // Failure with id Tag reader. Reset Failure, // Unable to perform a reset. Under Voltage, // Voltage has dropped below an acceptable level. Weak Signal, // Wireless communication device reports a weak signal. Other Error // Other type of error. More information in vendor Error Code. ) UDINT; END_TYPE 5.2.1.8 E_OCPP1_Charge Point Status TYPE E_OCPP1_Charge Point Status : ( None := 0, // Any status not covered by this implementation Available, // When a Connector becomes available for a new user. (Operative) Preparing, // When a Connector becomes no longer available for a new user but there is no on going Transaction. (Operative) Charging, // When the contactor of a Connector closes, allowing the vehicle to charge. (Ope rative) Suspended EVSE, // When the EV is connected to the EVSE but the EVSE is not offering energy to th e EV. (Operative) Suspended EV, // When the EV is connected to the EVSE and the EVSE is offering energy but the E V is not taking any energy. (Operative) Finishing, // When a Transaction has stopped at a Connector, but the Connector is not yet av ailable for a new user. (Operative) Reserved, // When a Connector becomes reserved as a result of a Reserve Now command. (Opera tive) Unavailable, // When a Connector becomes unavailable as the result of a Change Availability co mmand or an event upon which the Charge Point transitions to unavailable at its discretion. (Inopera tive) Faulted // When a Charge Point or connector has reported an error and is not available fo r energy delivery . (Inoperative) ) UDINT; END_TYPE 5.2.1.9 E_OCPP1_Charging Profile Kind Type TYPE E_OCPP1_Charging Profile Kind Type : ( None := 0, // Any status not covered by this implementation Absolute, // Schedule periods are relative to a fixed point in time defined in the schedule. Recurring, // The schedule restarts periodically at the first schedule period. Relative // Schedule periods are relative to a situation- specific start point that is determined by the charge point. ) UDINT; END_TYPE 5.2.1.10 E_OCPP1_Charging Profile Purpose Type TYPE E_OCPP1_Charging Profile Purpose Type : ( None := 0, // Any status not covered by this implementation Charge Point Max Profile, // Configuration for the maximum power or current available for an entire Charge Point. Tx Default Profile, // Default profile that can be configured in the Charge Point. Tx Profile // Profile with constraints to be imposed by the Charge Point on the curr ent transaction. ) UDINT; END_TYPE 5.2.1.11 E_OCPP1_Charging Profile Status TYPE E_OCPP1_Charging Profile Status : ( None := 0, // Any status not covered by this implementation Accepted, // Request has been acceptedand will be executed. Rejected, // Request has not been accepted and will not be executed. Not Supported // Charge Point indicates that the request is not supported. ) UDINT; END_TYPE TF6771 Version: 1.1.0 191
## Page 192

PLC API 5.2.1.12 E_OCPP1_Charging Rate Unit Type TYPE E_OCPP1_Charging Rate Unit Type : ( None := 0, // Any status not covered by this implementation W, // Watts (power). A // Amperes (current). ) UDINT; END_TYPE 5.2.1.13 E_OCPP1_Clear Cache Status TYPE E_OCPP1_Clear Cache Status : ( None := 0, // Any status not covered by this implementation Accepted, // Command has been executed. Rejected // Command has not been executed. ) UDINT; END_TYPE 5.2.1.14 E_OCPP1_Clear Charging Profile Status TYPE E_OCPP1_Clear Charging Profile Status : ( None := 0, // Any status not covered by this implementation Accepted, // Request has been accepted and will be executed. Unknown // No Charging Profile(s) were found matching the request. ) UDINT; END_TYPE 5.2.1.15 E_OCPP1_Config Key TYPE E_OCPP1_Config Key : ( None := 0, Allow Offline Tx For Unknown Id, // optional Authorization Cache Enabled, // optional Authorize Remote Tx Requests, Blink Repeat, // optional Clock Aligned Data Interval, Connection Time Out, Connector Phase Rotation, Connector Phase Rotation Max Length, // optional readonly Get Configuration Max Keys,// readonly Heartbeat Interval, Light Intensity, // optional Local Authorize Offline, Local Pre Authorize, Meter Values Aligned Data, Meter Values Aligned Data Max Length, // optional readonly Meter Values Sampled Data, Meter Values Sampled Data Max Length, // optional readonly Meter Value Sample Interval, Minimum Status Duration, // optional Number Of Connectors, // readonly Reset Retries, Stop Transaction On EVSide Disconnect, Stop Transaction On Invalid Id, Stop Txn Aligned Data, Stop Txn Aligned Data Max Length, // optional readonly Stop Txn Sampled Data, Stop Txn Sampled Data Max Length, // optional readonly Supported Feature Profiles, // readonly Supported Feature Profiles Max Length, // optional readonly Transaction Message Attempts, Transaction Message Retry Interval, Unlock Connector On EVSide Disconnect, Web Socket Ping Interval, // optional Local Auth List Enabled, Local Auth List Max Length, // readonly Send Local List Max Length, // readonly Reserve Connector Zero Supported, // optional readonly Charge Profile Max Stack Level, // Readonly Charging Schedule Allowed Charging Rate Unit, // readonly Charging Schedule Max Periods, // readonly Connector Switch3to1Phase Supported, // optional readonly Max Charging Profiles Installed, // readonly 192 Version: 1.1.0 TF6771
## Page 193

PLC API Max Keys // amount of keys +1, not a Configkey! ) UDINT; END_TYPE 5.2.1.16 E_OCPP1_Configuration Status TYPE E_OCPP1_Configuration Status : ( None := 0, // Any status not covered by this implementation Accepted, // Configuration key is supported and setting has been changed. Rejected, // Configuration key is supported, but setting could not be changed. Reboot Required, // Configuration key is supported and setting has been changed, but change will be available after reboot. Not Supported // Configuration key is not supported. ) UDINT; END_TYPE 5.2.1.17 E_OCPP1_Data Transfer Status TYPE E_OCPP1_Data Transfer Status : ( None := 0, // Any status not covered by this implementation Accepted, // Message has been accepted and the contained request is accepted. Rejected, // Message has been accepted but the contained request is rejected. Unknown Message Id, // Message could not be interpreted due to unknown message Id string. Unknown Vendor Id // Message could not be interpreted due to unknown vendor Id string. ) UDINT; END_TYPE 5.2.1.18 E_OCPP1_Diagnostics Status TYPE E_OCPP1_Diagnostics Status : ( None := 0, // Any status not covered by this implementation Idle, // Charge Point is not performing diagnostics related tasks. Uploaded, // Diagnostics information has been uploaded. Upload Failed, // Uploading of diagnostics failed. Uploading // File is being uploaded. ) UDINT; END_TYPE 5.2.1.19 E_OCPP1_Error TYPE E_OCPP1_Error : ( None := 0, // Any error not covered by this implementation Generic Error, // Any other error not covered by the previous ones Not Implemented, // Requested Action is not known by receiver Not Supported, // Requested Action is recognized but not supported by the receive r Internal Error, // An internal error occurred and the receiver was not able to pro cess the requested Action successfully Protocol Error, // Payload for Action is incomplete Security Error, // During the processing of Action a security issue occurred preve nting receiver from completing the Action successfully Formation Violation, // Payload for Action is syntactically incorrect or not conform th e PDU structure for Action Property Constraint Violation, // Payload is syntactically correct but at least one field contain s an invalid value Occurence Constraint Violation, // Payload for Action is syntactically correct but at least one of the fields violates occurence constraints Type Constraint Violation // Payload for Action is syntactically correct but at least one of the fields violates data type constraints ) UDINT; END_TYPE 5.2.1.20 E_OCPP1_Firmware Status TYPE E_OCPP1_Firmware Status : ( None := 0, // Any status not covered by this implementation Downloaded, // New firmware has been downloaded by Charge Point. Download Failed, // Charge point failed to download firmware. Downloading, // Firmware is being downloaded. Idle, // Charge Point is not performing firmware update related tasks. TF6771 Version: 1.1.0 193
## Page 194

PLC API Installation Failed, // Installation of new firmware has failed. Installing, // Firmware is being installed. Installed // New firmware has successfully been installed in charge point. ) UDINT; END_TYPE 5.2.1.21 E_OCPP1_Get Composite Schedule Status TYPE E_OCPP1_Get Composite Schedule Status : ( None := 0, // Any status not covered by this implementation Accepted, // Request has been accepted and will be executed. Rejected // Request has not been accepted and will not be executed. ) UDINT; END_TYPE 5.2.1.22 E_OCPP1_Location TYPE E_OCPP1_Location : ( None := 0, // Any status not covered by this implementation Body, // Measurement inside body of Charge Point(e.g. Temperature) Cable, // Measurement taken from cable between EV and Charge Point EV, // Measurement taken by EV Inlet, // Measurement at network("grid") inlet connection Outlet // Measurement at a Connector. Default value ) UDINT; END_TYPE 5.2.1.23 E_OCPP1_Measurand TYPE E_OCPP1_Measurand : ( None := 0, // Any status not covered by this implementation Current Export, // Instantaneous current flow from EV Current Import, // Instantaneous current flow to EV Current Offered, // Maximum current offered to EV Energy Active Export Register, // Numerical value read from the "active electrical energy" (Wh or k Wh) register of the (most authoritative) electrical meter measuring energy exported (to the grid). Energy Active Import Register, // Numerical value read from the "active electrical energy" (Wh or k Wh) register of the (most authoritative) electrical meter measuring energy imported (from the grid supply). Energy Reactive Export Register, // Numerical value read from the "reactive electrical energy" (VAR h or k VARh) register of the (most authoritative) electrical meter measuring energy exported (to the grid). Energy Reactive Import Register, // Numerical value read from the "reactive electrical energy" (VAR h or k VARh) register of the (most authoritative) electrical meter measuring energy imported (from th e grid supply). Energy Active Export Interval, // Absolute amount of "active electrical energy" (Wh or k Wh) expor ted (to the grid) during an associated time "interval". Energy Active Import Interval, // Absolute amount of "active electrical energy" (Wh or k Wh) impor ted(from the grid supply) during an associated time "interval". Energy Reactive Export Interval, // Absolute amount of "reactive electrical energy" (VARh or k VARh) exported (to the grid) during an associated time "interval". Energy Reactive Import Interval, // Absolute amount of "reactive electrical energy" (VARh or k VARh) imported (from the grid supply) during an associated time "interval". Frequency, // Instantaneous reading of powerline frequency. Power Active Export, // Instantaneous active power exported by EV. (W or k W) Power Active Import, // Instantaneous active power imported by EV. (W or k W) Power Factor, // Instantaneous power factor of total energy flow Power Offered, // Maximum power offered to EV Power Reactive Export, // Instantaneous reactive power exported by EV. (var or kvar) Power Reactive Import, // Instantaneous reactive power imported by EV. (var or kvar) RPM, // Fan speed in RPM So C, // State of charge of charging vehicle in percentage Temperature, // Temperature reading inside Charge Point. Voltage // Instantaneous AC RMS supply voltage ) UDINT; END_TYPE 5.2.1.24 E_OCPP1_Message Trigger TYPE E_OCPP1_Message Trigger : ( None := 0, // Any status not covered by this implementation Boot Notification, // To trigger a Boot Notification request 194 Version: 1.1.0 TF6771
## Page 195

PLC API Diagnostics Status Notification, // To trigger a Diagnostics Status Notification request Firmware Status Notification, // To trigger a Firmware Status Notification request Heartbeat, // To trigger a Heartbeat request Meter Values, // To trigger a Meter Values request Status Notification // To trigger a Status Notification request ) UDINT; END_TYPE 5.2.1.25 E_OCPP1_Phase TYPE E_OCPP1_Phase : ( None := 0, // Any status not covered by this implementation L1, // Measured on L1 L2, // Measured on L2 L3, // Measured on L3 N, // Measured on Neutral L1N, // Measured on L1 with respect to Neutral conductor L2N, // Measured on L2 with respect to Neutral conductor L3N, // Measured on L3 with respect to Neutral conductor L12, // Measured between L1 and L2 L23, // Measured between L2 and L3 L31 // Measured between L3 and L1 ) UDINT; END_TYPE 5.2.1.26 E_OCPP1_Reading Context TYPE E_OCPP1_Reading Context : ( None := 0, // Any status not covered by this implementation Interruption Begin, // Value taken at start of interruption. Interruption End, // Value taken when resuming after interruption. Other, // Value for any other situations. Sample Clock, // Value taken at clock aligned interval. Sample Periodic, // Value taken as periodic sample relative to start time of transaction. Transaction Begin, // Value taken at start of transaction. Transaction End, // Value taken at end of transaction. Trigger // Value taken in response to a Trigger Message ) UDINT; END_TYPE 5.2.1.27 E_OCPP1_Reason TYPE E_OCPP1_Reason : ( None := 0, // Any status not covered by this implementation De Authorized, // The transaction was stopped because of the authorization status in a Start Tra nsaction response Emergency Stop, // Emergency stop button was used. EVDisconnected, // Disconnecting of cable, vehicle moved away from inductive charge unit. Hard Reset, // A hard reset command was received. Local, // Stopped locally on request of the user at the Charge Point. Other, // Any other reason. Power Loss, // Complete loss of power. Reboot, // A locally initiated reset / reboot occurred. (for instance watchdog kicked in ) Remote, // Stopped remotely on request of the user. This is a regular termination of a t ransaction. Soft Reset, // A soft reset command was received. Unlock Command // Central System sent an Unlock Connector command. ) UDINT; END_TYPE 5.2.1.28 E_OCPP1_Recurrency Kind Type TYPE E_OCPP1_Recurrency Kind Type : ( None := 0, // Any status not covered by this implementation Daily, // The schedule restarts every 24 hours. Weekly // The schedule restarts every 7 days. ) UDINT; END_TYPE TF6771 Version: 1.1.0 195
## Page 196

PLC API 5.2.1.29 E_OCPP1_Registration Status TYPE E_OCPP1_Registration Status : ( None := 0, // Any status not covered by this implementation Accepted, // Charge point is accepted by Central System. Pending, // Central System is not yet ready to accept the Charge Point. Rejected // Charge point is not accepted by Central System. This may happen when the Charge Po int id is not known by Central System. ) UDINT; END_TYPE 5.2.1.30 E_OCPP1_Remote Start Stop Status TYPE E_OCPP1_Remote Start Stop Status : ( None := 0, // Any status not covered by this implementation Accepted, // Command will be executed. Rejected // Command will not be executed. ) UDINT; END_TYPE 5.2.1.31 E_OCPP1_Reservation Status TYPE E_OCPP1_Reservation Status : ( None := 0, // Any status not covered by this implementation Accepted, // Reservation has been made. Faulted, // Reservation has not been made, because connectors or specified connector are in a faulted state. Occupied, // Reservation has not been made. All connectors or the specified connector are occupi ed. Rejected // Reservation has not been made. Charge Point is not configured to accept reservation s. ) UDINT; END_TYPE 5.2.1.32 E_OCPP1_Reset Status TYPE E_OCPP1_Reset Status : ( None := 0, // Any status not covered by this implementation Accepted, // Configuration key is supported and setting has been changed. Rejected // Configuration key is supported, but setting could not be changed. ) UDINT; END_TYPE 5.2.1.33 E_OCPP1_Reset Type TYPE E_OCPP1_Reset Type : ( None := 0, // Any status not covered by this implementation Hard, // Restart(all) the hardware, the Charge Point is not required to gracefully stop ong oing transaction. Soft // Stop ongoing transactions gracefully and sending Stop Transaction for every ongoing transaction. ) UDINT; END_TYPE 5.2.1.34 E_OCPP1_Trigger Message Status TYPE E_OCPP1_Trigger Message Status : ( None := 0, // Any status not covered by this implementation Accepted, // Requested notification will be sent. Rejected, // Requested notification will not be sent. Not Implemented // Requested notification cannot be sent because it is either not implemented or unknown. ) UDINT; END_TYPE 196 Version: 1.1.0 TF6771
## Page 197

PLC API 5.2.1.35 E_OCPP1_Unit TYPE E_OCPP1_Unit : ( None := 0, // Any status not covered by this implementation Wh, // watt-hours (energy). Default. k Wh, // kilo-watt-hours (energy). VARh, // var-hours (reactive energy). k VARh, // kilo-var-hours (reactive energy). W, // watts (power). k W, // kilo-watts (power). VA, // volt-ampere (apparent power). k VA, // kilo-volt-ampere (apparent power). VARs, // vars (reactive power). k VAr, // kilo-vars (reactive power). A, // amperes (current). V, // voltage (RMS AC). Celsius, // degrees (temperature). Fahrenheit, // degrees (temperature). K, // degrees kelvin (temperature). Percent // percentage. ) UDINT; END_TYPE 5.2.1.36 E_OCPP1_Unlock Status TYPE E_OCPP1_Unlock Status : ( None := 0, // Any status not covered by this implementation Unlocked, // Connector has successfully been unlocked. Unlock Failed, // Failed to unlock the connector. Not Supported // Charge Point has no connector lock, or Connector Id is unknown. ) UDINT; END_TYPE 5.2.1.37 E_OCPP1_Update Status TYPE E_OCPP1_Update Status : ( None := 0, // Any status not covered by this implementation Accepted, // Local Authorization List successfully updated. Failed, // Failed to update the Local Authorization List. Not Supported, // Update of Local Authorization List is not supported by Charge Point. Version Mismatch // Version number in the request for a differential update is less or equal then version number of current list. ) UDINT; END_TYPE 5.2.1.38 E_OCPP1_Update Type TYPE E_OCPP1_Update Type : ( None := 0, // Any status not covered by this implementation Differential, // Indicates that the current Local Authorization List must be updated with the va lues in this message. Full // Indicates that the current Local Authorization List must be replaced by the val ues in this message. ) UDINT; END_TYPE 5.2.1.39 E_OCPP1_Value Format TYPE E_OCPP1_Value Format : ( None := 0, // Any status not covered by this implementation Raw, // Data is to be interpreted as integer / decimal numeric data. Signed Data // Data is represented as a signed binary data block, encoded as hex data. ) UDINT; END_TYPE 5.2.1.40 E_OCPP_Debug Level TYPE E_OCPP_Debug Level : ( None := 0, // No Encryption TF6771 Version: 1.1.0 197
## Page 198

PLC API Message Log File := 1 // Write a log file of all messages to the boot directory. ) UDINT; END_TYPE 5.2.1.41 E_OCPP_Encryption Mode TYPE E_OCPP_Encryption Mode : ( None := 0, // No Encryption Enable := 1, // TLS enable, but without certificate validation (insecure) Server Certificate := 2, // TLS enable, with server certificate validation Client Certificate := 3 // TLS enable, with client certificate authentication ) UDINT; END_TYPE 5.2.1.42 E_OCPP_Encryption Protocol TYPE E_OCPP_Encryption Protocol : ( None := 0, TLSv1p2 := 2, // TLS version 1.2 TLSv1p3 := 3 // TLS version 1.3 ) UDINT; END_TYPE 5.2.2 Properties 5.2.2.1 ST_OCPP1_Client_Boot Info The parameters sent in the Boot Notification are summarized in this structure. Syntax TYPE ST_OCPP_Client1_Boot Info : STRUCT s Charge Point Model : STRING(23) := 'Tc Iot Ocpp'; s Charge Point Vendor : STRING(23) := 'Beckhoff Automation'; s Charge Box Serial Number : STRING(23); s Charge Point Serial Number : STRING(23); s Firmware Version : STRING(23); s Meter Serial Number : STRING(23); s Meter Type : STRING(23); END_STRUCT END_TYPE Parameter Name Type Optional (OCPP) Description s Charge Point Model STRING(23) No Model of the Charge Point. s Charge Point Vendor STRING(23) No Vendor of the Charge Point. s Charge Box Serial Number STRING(23) Yes Serial number of the Charge Box within the Charge Point. s Charge Point Serial Numb STRING(23) Yes Serial number of the er Charge Point. s Firmware Version STRING(23) Yes Firmware version of the Charge Point. s Meter Serial Number STRING(23) Yes Serial number of the main electricity meter of the Charge Point. s Meter Type STRING(23) Yes Type of main electricity meter of the Charge Point. 198 Version: 1.1.0 TF6771
## Page 199

PLC API 5.2.2.2 ST_OCPP1_Client_Options This structure can be used to switch optional functions in the OCPP client on and off. Syntax TYPE ST_OCPP_Client1_Options : STRUCT b Allow Offline Tx For Unknown Id : BOOL := FALSE; b Auth List Enabled : BOOL := TRUE; b Auth Cache Enabled : BOOL := TRUE; b Local Auth Offline : BOOL := TRUE; b Local Pre Auth : BOOL := TRUE; END_STRUCT END_TYPE Parameter Name Type Optional (OCPP) Description b Allow Offline Tx For Unkno BOOL No If TRUE, Unknown Offline wn Id Authorization is enabled. b Auth List Enabled BOOL No If TRUE, the Local Authorization List is enabled. b Auth Cache Enabled BOOL Yes If TRUE, the Authorization Cache is enabled. b Local Auth Offline BOOL No If TRUE, the Charge Points start a Transaction for locally authorized identifiers. b Local Pre Auth BOOL No If TRUE, the Charge Points start a Transaction for locally authorized identifiers without waiting for the Central System. 5.2.2.3 ST_OCPP1_Client_Param This structure is used to set the parameters of the Web Sockets connection of the OCPP client. Syntax TYPE ST_OCPP_Client1_Param : STRUCT n OID : OTCID := 0; n Task OID : OTCID := 0; b Connect : BOOL := TRUE; s Host : T_Max String := ''; n Port : UINT := 443; s Path : T_Max String; s Identity : T_Max String; e Auth Mode : E_OCPP1_Authentication Mode; s Auth Key : T_Max String; e Encryption Mode : E_OCPP_Encryption Mode; e Encryption Prot : E_OCPP_Encryption Protocol; s Ca File : T_Max String := '%TC_TARGETPATH%\Certificates\CA.crt'; s Crt File : T_Max String := '%TC_TARGETPATH%\Certificates\OCPP.crt'; s Key File : T_Max String := '%TC_TARGETPATH%\Certificates\OCPP.key'; e Debug Level : E_OCPP_Debug Level := E_OCPP_Debug Level. None; e Trace Level : Tc Trace Level := Tc Trace Level.tl Warning; END_STRUCT END_TYPE TF6771 Version: 1.1.0 199
## Page 200

PLC API Parameter Name Type Description n OID OTCID Object ID of the Tc Iot Ocpp Client object. If this value is left at 0 (default), a new instance is created. n Task OID OTCID Object ID of the task used. If this value is left at 0 (default), the I/O Idle Task is used. b Connect BOOL If TRUE, the OCPP client automatically connects to the OCPP server. If FALSE, the connection must be established using the method Execute [} 22]. s Host T_Max String Host name or IP address of the OCPP server. n Port UINT Port of the OCPP server. s Path T_Max String Optionally specifies a URI of the OCPP server. s Identity T_Max String Specifies the Identity of the Client. e Auth Mode E_OCPP1_Authentication Mode Optional Authentication Mode. [} 190] s Auth Key T_Max String Optional Authentication Key. e Encryption Mode E_OCPP_Encryption Mode [} 198] Optional Encryption Mode. e Encryption Prot E_OCPP_Encryption Protocol [} 198] Defines the Encryption Protocol. s Ca File T_Max String Certificate of the Certificate Authority (CA) as a file path (PEM or DER format). s Crt File T_Max String Client certificate (Public Key) as file path (PEM or DER format). s Key File T_Max String Private Key of the client as a file path (PEM or DER format). e Debug Level E_OCPP_Debug Level [} 197] The Debug Level (None or Message Log File). Message Log File ensures that a logfile with all OCPP messages is written to the Twin CAT boot directory. e Trace Level Tc Trace Level The maximum Trace Level from ADS logging. 5.2.2.4 ST_OCPP1_Client_Settings This structure can be used to make further settings in the OCPP client. Syntax TYPE ST_OCPP_Client1_Settings : STRUCT t Connect Timeout: : TIME := T#10S; t Reconnect Timeout: : TIME := T#10S; t Boot Timeout: : TIME := T#5S; t Message Timeout: : TIME := T#5S; n Transaction Message Attempts : UDINT := 5; t Transaction Message Retry Interval : TIME := T#5S; END_STRUCT END_TYPE 200 Version: 1.1.0 TF6771
## Page 201

PLC API Parameter Name Type Description t Connect Timeout TIME Specifies the time after which a connection attempt is aborted. t Reconnect Timeout TIME Specifies the time after a Disconnect before the client attempts to reconnect. t Boot Timeout TIME Specifies the time to wait for a response to the Boot Notification. t Message Timeout TIME Specifies how long to wait for a response to a message. n Transaction Message Attempts UDINT Specifies how often the Charge Point attempts to resend messages relating to transactions if the Central System has not processed them. t Transaction Message Retry Interval TIME Specifies the time in seconds after which another attempt to send is made. 5.2.2.5 ST_OCPP1_Server_Param This structure is used to set the parameters of the Web Sockets connection of the OCPP server. Syntax TYPE ST_OCPP1_Server Param : STRUCT n OID : OTCID := 0; n Task OID : OTCID := 0; s Host : T_Max String := '0.0.0.0'; n Port : UINT := 443; s Path : T_Max String := 'ocpp'; e Auth Mode : E_OCPP1_Authentication Mode := E_OCPP1_Authentication Mode. Basic; e Encryption Mode : E_OCPP_Encryption Mode := E_OCPP_Encryption Mode. Enable; e Encryption Prot : E_OCPP_Encryption Protocol; s Ca File : T_Max String := '%TC_TARGETPATH%\Certificates\CA.crt'; s Crt File : T_Max String := '%TC_TARGETPATH%\Certificates\OCPP.crt'; s Key File : T_Max String := '%TC_TARGETPATH%\Certificates\OCPP.key'; e Debug Level : E_OCPP_Debug Level := E_OCPP_Debug Level. None; e Trace Level : Tc Trace Level := Tc Trace Level.tl Warning; END_STRUCT END_TYPE TF6771 Version: 1.1.0 201
## Page 202

PLC API Parameter Name Type Description n OID OTCID Object ID of the Tc Iot Ocpp Server object. If this value is left at 0 (default), a new instance is created. n Task OID OTCID Object ID of the task used. If this value is left at 0 (default), the I/O Idle Task is used. s Host T_Max String Defines the server address as a host name, domain name or IP address. n Port UINT Defines the server port. s Path T_Max String Defines the server path. e Auth Mode E_OCPP1_Authentication Mode Optional Authentication Mode. [} 190] e Encryption Mode E_OCPP_Encryption Mode [} 198] Optional Encryption Mode. e Encryption Prot E_OCPP_Encryption Protocol [} 198] Defines the Encryption Protocol. s Ca File T_Max String Certificate of the Certificate Authority (CA) as a file path (PEM or DER format). s Crt File T_Max String Server certificate (Public Key) as file path (PEM or DER format). s Key File T_Max String Private Key of the server as a file path (PEM or DER format). e Debug Level E_OCPP_Debug Level [} 197] The Debug Level (None or Message Log File). Message Log File ensures that a logfile with all OCPP messages is written to the Twin CAT boot directory. e Trace Level Tc Trace Level The maximum Trace Level from ADS logging. 5.2.3 Types 5.2.3.1 ST_OCPP1_Authorization Data Syntax TYPE ST_OCPP1_Authorization Data : STRUCT s Id Tag : T_OCPP1_Id Token; st Id Tag Info : ST_OCPP1_Id Tag Info; END_STRUCT END_TYPE Parameter Name Type Optional Description s Id Tag T_OCPP1_Id Token [} 209] No ID token to which this authorization information belongs. st Id Tag Info ST_OCPP1_Id Tag Info Yes Contains information on Authorization Status, [} 207] expiration date and parent ID. 202 Version: 1.1.0 TF6771
## Page 203

PLC API 5.2.3.2 ST_OCPP1_Charging Profile Syntax TYPE ST_OCPP1_Charging Profile : STRUCT n Profile Id : UDINT; n Transaction Id : UDINT; n Stack Level : UDINT; e Profile Purpose : E_OCPP1_Charging Profile Purpose Type; e Profile Kind : E_OCPP1_Charging Profile Kind Type; e Recurrency Kind : E_OCPP1_Recurrency Kind Type; n Valid From : ULINT; n Valid To : ULINT; m Schedule : ST_OCPP1_Charging Schedule; END_STRUCT END_TYPE Parameter Name Type Optional Description n Profile Id UDINT No Unique identifier for this Charging Profile. n Transaction Id UDINT Yes Only valid if e Profile Purpose is set to Tx Profile. The Transaction ID can be used to assign the profile to a specific transaction. n Stack Level UDINT No Value that defines the priority of a Charging Profile. The value 0 defines the lowest priority. e Profile Purpose E_OCPP1_Charging Profile No Purpose of the transmitted Charging Profile. Purpose Type [} 191] e Profile Child E_OCPP1_Charging Profile No Determines the Charging Profile type. Kind Type [} 191] e Recurrency Child E_OCPP1_Recurrency Kind Yes Specifies the starting point of a repetition. Type [} 195] n Valid From ULINT Yes Time from which the Charging Profile is valid. If no value is specified, the Charging Profile is valid as soon as it reaches the Charge Point. n Valid To ULINT Yes Time from which the Charging Profile is no longer valid. If no value is specified, the Charging Profile is valid until the Charge Point receives a new Charging Profile. m Schedule ST_OCPP1_Charging Sched No Contains the Charging Schedule and thus the ule [} 205] limit values for the available power or current over time. TF6771 Version: 1.1.0 203
## Page 204

PLC API 5.2.3.3 ST_OCPP1_Charging Profile Max Syntax TYPE ST_OCPP1_Charging Profile Max : STRUCT n Profile Id : UDINT; n Transaction Id : UDINT; n Stack Level : UDINT; e Profile Purpose : E_OCPP1_Charging Profile Purpose Type; e Profile Kind : E_OCPP1_Charging Profile Kind Type; e Recurrency Kind : E_OCPP1_Recurrency Kind Type; n Valid From : ULINT; n Valid To : ULINT; m Schedule : ST_OCPP1_Charging Schedule Max; END_STRUCT END_TYPE Parameter Name Type Optional Description n Profile Id UDINT No Unique identifier for this Charging Profile. n Transaction Id UDINT Yes Only valid if e Profile Purpose is set to Tx Profile. The Transaction ID can be used to assign the profile to a specific transaction. n Stack Level UDINT No Value that defines the priority of a Charging Profile. The value 0 defines the lowest priority. e Profile Purpose E_OCPP1_Charging Profile No Purpose of the transmitted Charging Profile. Purpose Type [} 191] e Profile Child E_OCPP1_Charging Profile No Determines the Charging Profile type. Kind Type [} 191] e Recurrency Child E_OCPP1_Recurrency Kind Yes Specifies the starting point of a repetition. Type [} 195] n Valid From ULINT Yes Time from which the Charging Profile is valid. If no value is specified, the Charging Profile is valid as soon as it reaches the Charge Point. n Valid To ULINT Yes Time from which the Charging Profile is no longer valid. If no value is specified, the Charging Profile is valid until the Charge Point receives a new Charging Profile. m Schedule ST_OCPP1_Charging Sched No Contains the Charging Schedule and thus the ule Max [} 205] limit values for the available power or current over time. 204 Version: 1.1.0 TF6771
## Page 205

PLC API 5.2.3.4 ST_OCPP1_Charging Schedule Syntax TYPE ST_OCPP1_Charging Schedule : STRUCT n Start : ULINT; n Duration : UDINT; e Rate Unit : E_OCPP1_Charging Rate Unit Type; f Rate Min : REAL; n Period Count : UDINT; END_STRUCT END_TYPE Parameter Name Type Optional Description n Start ULINT Yes Starting point of an absolute Charging Schedule. If the value is not specified, the schedule is relative to the start of the charging process. n Duration UDINT Yes Duration of the Charging Schedule in seconds. If the value is not specified, the last Charging Schedule Period is continued indefinitely or until the end of the transaction. e Rate Unit E_OCPP1_Charging Rate Un No The unit of the limit, expected in watts (power) it Type [} 192] or amperes (current). f Rate Min REAL Yes Minimum charging rate supported by the electric vehicle. The unit is defined by e Rate Unit. n Period Count UDINT No Number of subsequent Charging Schedule Periods. 5.2.3.5 ST_OCPP1_Charging Schedule Max Syntax TYPE ST_OCPP1_Charging Schedule Max : STRUCT n Start : ULINT; n Duration : UDINT; e Rate Unit : E_OCPP1_Charging Rate Unit Type; f Rate Min : REAL; n Period Count : UDINT; arr Periods : ARRAY[1..*] OF ST_OCPP1_Charging Schedule Period; END_STRUCT END_TYPE TF6771 Version: 1.1.0 205
## Page 206

PLC API Parameter Name Type Optional Description n Start ULINT Yes Starting point of an absolute Charging Schedule. If the value is not specified, the schedule is relative to the start of the charging process. n Duration UDINT Yes Duration of the Charging Schedule in seconds. If the value is not specified, the last Charging Schedule Period is continued indefinitely or until the end of the transaction. e Rate Unit E_OCPP1_Charging Rate Un No The unit of the limit, expected in watts (power) it Type [} 192] or amperes (current). f Rate Min REAL Yes Minimum charging rate supported by the electric vehicle. The unit is defined by e Rate Unit. n Period Count UDINT No Number of subsequent Charging Schedule Periods. arr Periods ARRAY[1.. Param_OCPP. No List of Charging Schedule n Schedule Periods Max] Period elements. OF ST_OCPP1_Charging Sched ule Period [} 206] 5.2.3.6 ST_OCPP1_Charging Schedule Period Syntax TYPE ST_OCPP1_Charging Schedule Period : STRUCT n Start : UDINT; f Limit : REAL; n Phases : UDINT := 0; END_STRUCT END_TYPE Parameter Name Type Optional Description n Start UDINT No Start of the Charging Schedule Period, in seconds from the start of the Charging Schedule. f Limit REAL No Charging Rate Limit during the respective Charging Schedule Period. n Phases UDINT Yes The number of phases that can be used for charging. 206 Version: 1.1.0 TF6771
## Page 207

PLC API 5.2.3.7 ST_OCPP1_Config Key Value Syntax TYPE ST_OCPP1_Config Key Value : STRUCT s Key : T_OCPP1_Config Key; s Value : T_OCPP1_Config Value; b Readonly : BOOL; END_STRUCT END_TYPE Parameter Name Type Optional Description s Key T_OCPP1_Config Key No Configuration Key to be overwritten or added. [} 208] s Value T_OCPP1_Config Value Yes Value of the associated Configuration Key. Can be [} 208] omitted if the Configuration Key is known and should not be reset. b Readonly BOOL No Determines the access right of the Central System, either the value may only be read (TRUE) or also written (FALSE). 5.2.3.8 ST_OCPP1_Id Tag Info Syntax TYPE ST_OCPP1_Id Tag Info : STRUCT e Status : E_OCPP1_Authorization Status; n Expiry Date : ULINT; s Parent Id Tag : T_OCPP1_Id Token; END_STRUCT END_TYPE Parameter Name Type Optional Description e Status E_OCPP1_Authorization Sta No Contains information on whether the ID tag has tus [} 190] been accepted by the Central System. n Expiry Date ULINT Yes Optionally contains the date on which the ID tag is to be removed from the Authorization Cache. s Parent Id Tag T_OCPP1_Id Token [} 209] Yes Optionally contains the parent ID tag 5.2.3.9 ST_OCPP1_Sampled Value From the point of view of the OCPP specification, a Meter Value is a Sampled Value with a timestamp. In this PLC library, the timestamp is also managed in the Sampled Value in order to have one structure level less. TF6771 Version: 1.1.0 207
## Page 208

PLC API Syntax TYPE ST_OCPP1_Sampled Value : STRUCT f Value : LREAL; n Timestamp : ULINT := 0; e Context : E_OCPP1_Reading Context := E_OCPP_Reading Context. Sample Periodic; e Format : E_OCPP1_Value Format := E_OCPP_Value Format. Raw; e Measurand : E_OCPP1_Measurand; e Phase : E_OCPP1_Phase; e Location : E_OCPP1_Location; e Unit : E_OCPP1_Unit; END_STRUCT END_TYPE Parameter Name Type Optional Description f Value LREAL No Sampled Value as a decimal number ("Raw"). "Signed Data" is not supported. n Timestamp ULINT Yes Timestamp of the Sampled Value. e Context E_OCPP1_Reading Context Yes Context in which the Sampled Value was [} 195] recorded (start, end or sample). e Format E_OCPP1_Value Format Yes In this implementation, it is always the "Raw" [} 197] format. e Measurand E_OCPP1_Measurand Yes Type of the Sampled Value. [} 194] e Phase E_OCPP1_Phase [} 195] Yes Information on the interpretation of the Sampled Value. e Location E_OCPP1_Location [} 194] Yes Location of the Sampled Value. e Unit E_OCPP1_Unit [} 197] Yes Unit of the Sampled Value. 5.2.3.10 T_OCPP1_Config Key Syntax TYPE T_OCPP1_Config Key : STRING(63); END_TYPE 5.2.3.11 T_OCPP1_Config Value Syntax TYPE T_OCPP1_Config Value : STRING(183); END_TYPE 5.2.3.12 T_OCPP1_Data Transfer Data Syntax TYPE T_OCPP1_Data Transfer Data : STRING(Param_OCPP.n Data Transfer Max); END_TYPE 208 Version: 1.1.0 TF6771
## Page 209

PLC API 5.2.3.13 T_OCPP1_Id Token Syntax TYPE T_OCPP1_Id Token : STRING(23); END_TYPE 5.2.3.14 T_OCPP_Hash Syntax TYPE T_OCPP_Hash : STRING(95); END_TYPE 5.2.3.15 T_OCPP_Identity Syntax TYPE T_OCPP_Identity : STRING(31); END_TYPE 5.2.3.16 T_OCPP_Message Id Syntax TYPE T_OCPP_Message Id : STRING(63); END_TYPE 5.3 GVLs 5.3.1 Param_OCPP Name Type Default value Description n Connector Count UDINT 2 Maximum number of Connectors per Charge Point. n Sampled Values Max UDINT 64 Maximum number of Sampled Values in a Meter Value. n Charging Profile Max UDINT 10 Maximum number of Charging Profiles. n Schedule Periods Max UDINT 24 Maximum number of Charging Schedule Periods in a Charging Schedule. n Config Keys Max UDINT 100 Maximum number of Configuration Keys in a Get Configuration call. n Auth List Max UDINT 10 Maximum number of entries in the Local Authorization List. f Charging Limit Max REAL 40 Standard charging power limit for schedules. n Data Transfer Max UDINT 1023 Maximum number of bytes in the payload for the Send Data Transfer method. TF6771 Version: 1.1.0 209
## Page 210

Samples 6 Samples Sample code and configurations for this product can be obtained from the corresponding repository on Git Hub: https://github.com/Beckhoff/TF6771_Samples. There you have the option to clone the repository or download a ZIP file containing the sample. The following table also provides an overview of the samples currently available in the documentation: Sample Short description TF6771_Iot Ocpp Getting Started This sample provides a simple Getting Started and is described in more detail in the chapter Quick Start [} 15]. TF6771_Iot Ocpp Client1 This sample shows the basic use of the OCPP client. TF6771_Iot Ocpp Server1 This sample shows the basic use of the OCPP server. 210 Version: 1.1.0 TF6771
## Page 211

Appendix 7 Appendix 7.1 Hash calculation The Hash consists of the identity (username) and password. These are separated by a colon. %username%:%password% The SHA256 algorithm is used for Hash calculation. Example: Identity (username): Beckhoff OCPP Password: 1234abc$ Calculated Hash: 30206a1e174ac04ea140234f2c1edd854d8dbca1d664b92d763cb5ef78c8e8dc Any SHA256 calculator can be used at this point. These can be found online or as functions in various libraries, for example. 7.2 Configuration Keys Here you will find all Configuration Keys that are initialized with the method Init Standard [} 186]. Name Profile Value Description Get Configuration Max Keys Core (9.1) Param_OCPP Maximum number of Configuration Keys in a [} 209].n Config Keys Max Get Configuration call. Number Of Connectors Core (9.1) Param_OCPP Maximum number of Connectors per Charge [} 209].n Connector Count Point. Supported Feature Profiles Core (9.1) Core, Reservation, List of all supported Smart Charging, Feature Profiles. Remote Trigger Local Auth List Max Length Local Auth List Param_OCPP Maximum number of Management (9.2) entries in the Local [} 209].n Auth List Max Authorization List. Send Local List Max Length Local Auth List Param_OCPP Maximum number of Management (9.2) entries that can be sent to [} 209].n Auth List Max the Charge Point in a Send Local List [} 120]. Charging Schedule Allowed Smart Charging (9.4) Current List of supported Charging Rate Unit quantities that may be used in a Charging Schedule. Permitted values are "Current" and "Power". Charging Schedule Max Per Smart Charging (9.4) Param_OCPP Maximum number of iods Charging Schedule [} 209].n Schedule Periods Periods in a Charging Max Schedule. Max Charging Profiles Instal Smart Charging (9.4) Param_OCPP Maximum number of led Charging Profiles that can [} 209].n Charging Profile M be installed in parallel. ax TF6771 Version: 1.1.0 211
## Page 212

Appendix 7.3 Troubleshooting Behavior Explanation The Heartbeat interval in the client has been In the Boot Notification.conf, the OCPP server sends changed. However, a different value is set once the a specified Heartbeat interval for the client. This is connection to the server has been established. also set internally in the client. However, it is then possible to change the internal Heartbeat Interval during runtime. 212 Version: 1.1.0 TF6771
## Page 214

More Information: www.beckhoff.com/tf6771 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
