---
title: "TF5200_interface_external_combination_en"
product: "TF5200"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.02"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5200_interface_external_combination_en.pdf"
release_date: "2025-06-05"
---
Manual | EN TF5200 | Twin CAT 3 CNC Interface to external compensation 6/5/2025 | Version: 1.02
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5200 | Twin CAT 3 CNC Version: 1.02 3 Interface to external compensation
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.02 TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 5

Table of contents Table of contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Description................................................................................................................................................ 9 3 Programming........................................................................................................................................... 11 4 Parameter................................................................................................................................................. 12 4.1 Overview of parameters.................................................................................................................. 12 4.2 Start-up parameters........................................................................................................................ 12 4.3 Axis parameters.............................................................................................................................. 12 5 Adding a compensation via Tc Com...................................................................................................... 14 5.1 Interface methods........................................................................................................................... 14 5.2 Instance data of the compensation................................................................................................. 15 5.3 Configuring and registering the compensation................................................................................ 16 5.4 Using the example project/template................................................................................................ 16 5.5 Loading the compensation object................................................................................................... 17 6 Error handling and diagnosis................................................................................................................ 18 6.1 Error messages............................................................................................................................... 18 6.2 Diagnostic data............................................................................................................................... 18 6.3 ADS objects.................................................................................................................................... 20 7 Support and Service............................................................................................................................... 21 Index......................................................................................................................................................... 22 TF5200 | Twin CAT 3 CNC Version: 5 Interface to external compensation
## Page 6

Table of contents 6 Version: TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 7

List of figures List of figures Fig. 1 Placing the external compensation.............................................................................................. 9 Fig. 2 Diagram of the interaction between PLC, CNC and Tc COM....................................................... 10 Fig. 3 Adding a Tc Com object in Twin CAT............................................................................................ 17 Fig. 4 Configuring the parameters.......................................................................................................... 17 TF5200 | Twin CAT 3 CNC Version: 1.02 7 Interface to external compensation
## Page 8

Overview 1 Overview Task The function description explains how to create and integrated a Tc COM object. The Tc COM object is called from the CNC context as a compensation. This function is an additional option requiring a license. This function is only available for Twin CAT3 as of CNC Build V3.1.3074. Parameterisation The interface for adding a compensation must be activated in the start-up list: • Activating the external compensation interface (P-STUP-00110 [} 12]) Limit values can be configured for each axis: • Offset limits P-AXIS-00743 [} 12] and P-AXIS-00744 [} 12] • Maximum acceleration (P-AXIS-00745 [} 13]) Programming An externally defined compensation can be used with the command #EXTCOMP ON/OFF[...], provided the CNC supplied a compensation object. 8 Version: 1.02 TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 9

Description 2 Description Point of action The compensation is added to the axes in the position controller. The dynamics of the movement were already pre-calculated there. Therefore, the compensation should not produce any large position jumps since they are not dynamically adapted. Limit values for acceleration and maximum offset value must be set for individual axes to prevent overloading the motors with excessive offsets or to avoid violating dynamic limits. The CNC then checks the offsets calculated by the compensation before passing them on to the motors. Fig. 1: Placing the external compensation Application More complex models may be required to compensate machines with highly complex kinematics. However, the NC kernel does not currently support this. There are many different methods to compensate industrial robots in order to obtain the most accurate behaviour possible when executing a movement. This is possible by using precise kinematics which can map the exact mechanical properties of a robot. This type of information is generally not available from the manufacturer. Besides the manufacturers themselves, there are also providers of other measurement techniques that improve the position of the machine. In order to add a compensation to the NC kernel, a special interface was developed to permit the addition of an externally implemented compensation. TF5200 | Twin CAT 3 CNC Version: 1.02 9 Interface to external compensation
## Page 10

Description Adding a user-defined compensation in Twin CAT 3.1 In Twin CAT 3, a compensation can be added to the CNC via the Tc COM infrastructure. Fig. 2: Diagram of the interaction between PLC, CNC and Tc COM An external compensation is a user-defined compensation that is implemented outside the CNC environment. The compensation is called from the CNC context. The compensation receives the next axis position and writes the calculated offset back to the CNC: The compensation always transfers the positions of all axes. This allows axes in different channels to also be compensated by the same compensation. The CNC has little control over the compensation function. Additional information provided with the axis positions are positive and negative software limit switches. The compensation must ensure that the offsets are continuous so that there are no excessive posi- tion jumps. In addition, the offsets are not part of the path preparation of the CNC. The dynamics are not adapted for use of the offsets. 10 Version: 1.02 TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 11

Programming 3 Programming Syntax: #EXTCOMP ON/OFF [ID=.. STRING=.. VALUE=..] ID=.. Compensation number STRING=<string> Optional additional information for the compensation as string VALUE=.. Optional additional information for the compensation as numeric value The compensation can be switched on or off in the NC program. An additional option is that a message consisting of a string 24 characters long and a REAL value can be sent via the NC program to the compensation. Sending a message followed by enabling the compensation %Example1 N010 G01 X10 Y10 F1000 N020 #EXTCOMP [ID0 STRING=”OP1” VALUE=41] N030 #EXTCOMP ON [ID0] N040 G90 G01 X10 Y10 Z0 F1000 N050 G201 X1 Y1 N060 #EXTCOMP OFF [ID0] Send a message to enable the compensation %Example2 N010 G01 X10 Y10 F1000 N020 #EXTCOMP ON [ID0 STRING=”OP1” VALUE=41] N030 G90 G01 X10 Y10 Z0 F1000 N040 G201 X1 Y1 N050 #EXTCOMP OFF [ID0] TF5200 | Twin CAT 3 CNC Version: 1.02 11 Interface to external compensation
## Page 12

Parameter 4 Parameter 4.1 Overview of parameters ID Parameter Description P-STUP-00110 configuration.position_ Enabling the external compensation interface controller.enable_exter nal_compensation_ifc P-AXIS-00743 lr_param.ext_comp.wa Maximum position change of the compensation - warning rn_limit P-AXIS-00744 lr_param.ext_comp.err Maximum position change of the compensation - error _limit P-AXIS-00745 lr_param.ext_comp.ma Maximum acceleration of the axes by compensation offset x_a 4.2 Start-up parameters P-STUP-00110 Enabling the external compensation Description This parameter enables the function in the NC channel. Parameter configuration.position_controller.enable_external_compensation_ifc Data type BOOLEAN Data range 0/1 Dimension ---- Default value 0 Remarks This parameter can only be used with Twin CAT3. This is because of the use of the Mc COM interface that is only available with Twin CAT3. This parameter is available as of CNC Build V3.1.3074 4.3 Axis parameters P-AXIS-00743 Maximum position change of the compensation - warning limit Description This parameter defines the warning limit for maximum position change of the external compensation. If the warning limit is exceeded, the warning is output with ID 70583. If the compensation value remains above the warning limit, no further warnings are output. A repeat warning is only output when the warning limit is again exceeded. Parameter lr_param.ext_comp.warn_limit Data type UNS32 Data range 0 ≤ P-AXIS-00743 <= MAX_UNS32 Dimension T: 0.1 µm R: 0.0001° Default value 0 Remarks Parameter available as of CNC Build V3.1.3074.0 and higher P-AXIS-00744 Maximum position change of the compensation - error limit Description This parameter defines the error limit for maximum position change of the external compensation. If the maximum position change is exceeded, the error ID 70584 is output and the CNC is stopped. Parameter lr_param.ext_comp.err_limit 12 Version: 1.02 TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 13

Parameter Data type UNS32 Data range 0 ≤ P-AXIS-00744 <= MAX_UNS32 Axis types T, R Dimension T: 0.1 µm R: 0.0001° Default value 0 Remarks Parameter available as of CNC Build V3.1.3074.0 and higher P-AXIS-00745 Maximum acceleration of the axes by a compensation offset Description This parameter defines the limit value for the maximum permitted acceleration generated by the offsets of the external compensation. Parameter lr_param.ext_comp.max_a Data type UNS32 Data range 0 ≤ P-AXIS-00745 <= MAX_UNS32 Axis types T, R Dimension T: mm/s² R: °/s² Default value P-AXIS-00008 Remarks Parameter available as of CNC Build V3.1.3074.0 and higher TF5200 | Twin CAT 3 CNC Version: 1.02 13 Interface to external compensation
## Page 14

Adding a compensation via Tc Com 5 Adding a compensation via Tc Com 5.1 Interface methods Methods to be implemented The following methods must be implemented when creating a compensation (Tc Nc Kinematics Inter-faces.h): • virtual HRESULT TCOMAPI compute Start Offsets(PTc Mc Com Ext Comp Parameter p) = 0; • virtual HRESULT TCOMAPI compute Offsets(PTc Mc Com Ext Comp Parameter p) = 0; • virtual HRESULT TCOMAPI write Nc Cmd(PTc Mc Com Cmd Parameter s) = 0; • virtual HRESULT TCOMAPI init Compensation(PTc Mc Com Ext Comp Parameter p) = 0; compute Start Offset Calculate the offset of an unknown axis position which reaches the axis positions transferred to the method when it is compensated (axis position + calculated offset). This method is used to enable the compensated position. This results in no movement when the compensation is enabled. compute Offsets Calculate the offset for the transferred axis position. write Nc Cmd The method of the user-specific commands from the NC program is received and processed. init Compensation Function to initialise the compensation. 14 Version: 1.02 TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 15

Adding a compensation via Tc Com 5.2 Instance data of the compensation Working data of the compensation Implementation of the compensation can provide any parameters as working data. The compensation is always invoked cyclically in the position controller as long as the compensation is enabled. The data provided by the CNC in cyclic operation are the axis positions and the software limit switches of the axes. Tc Mc Com Base – structure to transfer error information In the event of an error this structure can be filled to output compensation error information via the CNC. It forms the basis for the structures Tc Mc Com Ext Comp Parameter and Tc Mc Com Cmd Parameter: The data provided by the CNC in cyclic operation are the axis positions and the software limit switches of the axes. struct Tc Mc Com Base { double ret_value1; // out: additional error value double ret_value2; // out: additional error value char ret_text[24]; // out: additional error text, max. 24 bytes }; Tc Mc Com Ext Comp Parameter – structure for cyclic exchange Axis positions are provided in the array cyclic_i of length dim_cyclic_i in unit 10^-8 mm or °. The calculated offset is expected in the array cyclic_o in the same unit. The array parameter contains the software limit switches of all axes. The order is then [A1 swe pos, A1 swe neg, A2 swe pos, …]. struct Tc Mc Com Ext Comp Parameter : public Tc Mc Com Base { e Mc Com Ext Comp Parameter type; signed __int64* cyclic_i; long dim_cyclic_i; signed __int64* cyclic_o; long dim_cyclic_o; signed __int64* parameters; long dim_parameters; }; Tc Mc Com Cmd Parameter – structure to transfer NC messages The NC command #EXTCOMP ON/OFF [ID<0> STRING=<string> VALUE= <value>] sends a string consisting of 24 characters and a double value to the compensation. struct Tc Mc Com Cmd Parameter : public Tc Mc Com Base { char para_string[24]; double para_value; }; TF5200 | Twin CAT 3 CNC Version: 1.02 15 Interface to external compensation
## Page 16

Adding a compensation via Tc Com 5.3 Configuring and registering the compensation Registering the compensation in Twin CAT The following data is used to register a Tc COM object (Tc Cnc Services.h) • Type 6 (TCCNC_REGISTEROBJECT_TYPE_COMP) is default • Group 0 is default • Index 0 is default The transformation is registered in the following Tc COM interface, which is defined in the file Tc Cnc Interfaces.h. • virtual HRESULT TCOMAPI Register Object (Tc Cnc Regis-ter Object& id, ITc Unknown* ip Unk)=0; • virtual HRESULT TCOMAPI Unregister Object (Tc Cnc Regis-ter Object& id)=0; Registering the compensation in the CNC The first time the NC command of the external compensation is executed, the Tc COM object is loaded for the first time and the method “initialize Compensation” is invoked. The command is then executed. 5.4 Using the example project/template Example projects are also supplied. Ext Comp0.h Header file of the compensation object. The interfaces that the object inherits are declared here. The following are particularly important for the compensation object: ITc Cnc Base for the version check and IITc Mc Com Ext Comp for the methods. Ext Comp0.cpp Source file of the compensation object. This is where the compensation methods are implemented. Configurations can be loaded here in the previous status until the object is loaded in the RT context. Externe Kompensation.tmc This specifies which interfaces provided by the Twin CAT3 are to be loaded and it also defines the types. 16 Version: 1.02 TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 17

Adding a compensation via Tc Com 5.5 Loading the compensation object After the object is successfully generated, the object can be added to the XAE project. Fig. 3: Adding a Tc Com object in Twin CAT Then the type, index and group of the object must be configured. Fig. 4: Configuring the parameters The Tc COM object must be signed, otherwise it is not loaded. For more information on Tc COM objects and how to sign an object, go to Beckhoff Information System. TF5200 | Twin CAT 3 CNC Version: 1.02 17 Interface to external compensation
## Page 18

Error handling and diagnosis 6 Error handling and diagnosis 6.1 Error messages Error number Error text 70582 Function call of external compensation signals an error 70583 Caution: High compensation value of the external compensation 70584 Compensation value of the external compensation exceeded a critical limit 70585 Axis limits must be specified for the external compensation 70586 The external compensation exceeded the maximum acceleration 70587 Interface of external compensation is not enabled. 70588 Axis is already active in another channel when the external compensation was enabled 70589 Axis that is part of the external compensation has no enable 70590 Axis that is part of the external compensation is in error state 293101 Not enough memory to manage the COM interface 293102 The directory of the COM interface objects does not exist. 293103 ISGCtrl is not initialised yet. 293104 Specified ID of COM interface is not configured. 293105 Specified COM interface cannot be stored internally. 293106 The major interface version between CNC and Tc/Mc COM is different. 293107 The major interface version between CNC and Tc/Mc COM is different. 6.2 Diagnostic data General diagnostic data of the position controller (PC) The general diagnostic data of the position controller lists the state of the compensation and the last input and output of the compensation of the first 10 axes. State of the compensation enabled = 1, disabled = 0 In the event of an error the compensation is deactivated immediately and is then disabled. Registered: The Tc Com object was loaded and initialised. Registration takes place with the first #EXTCOMP command executed. Initialized: The interface of the external compensation is activated and the objects are initialised for communication. Input: Axis position in 10^-8 mm or 10^-8° Output: Compensation offset in 10^-8 mm or 10^-8° Axis-specific diagnostic data of the PC Active: The compensation values act on the axis. Last offset: The previous offset in increments. Actual offset: The current offset in increments. Next offset: The next offset. Diff: The offset acceleration in increments. 18 Version: 1.02 TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 19

Error handling and diagnosis Diagnostic data Axis-specific diagnostic data taken from diagdata.txt: ext_comp.initialized: 1 ext_comp[0].active: 1 ext_comp[0].last_offset: -110901232 ext_comp[0].actual_offset: -110901232 ext_comp[0].next_offset: -110901232 ext_comp[0].offset_delta: 0 ext_comp[0].diff: 0.000000 General diagnostic data: ext_comp[0].state 1 ext_comp[0].initialized 1 ext_comp[0].registered 1 ext_comp[0].extcomp_input[0] 897556 ext_comp[0].extcomp_output[0] -1503827 ext_comp[0].extcomp_input[1] -1701406850 ext_comp[0].extcomp_output[1] -4149410 ext_comp[0].extcomp_input[2] -1999519487 ext_comp[0].extcomp_output[2] -4234781 ext_comp[0].extcomp_input[3] 3519482 ext_comp[0].extcomp_output[3] -4374686 ext_comp[0].extcomp_input[4] -171975334 ext_comp[0].extcomp_output[4] -2019399 ext_comp[0].extcomp_input[5] 667959 ext_comp[0].extcomp_output[5] 4246058 ext_comp[0].extcomp_input[6] 0 ext_comp[0].extcomp_output[6] 0 ext_comp[0].extcomp_input[7] 0 ext_comp[0].extcomp_output[7] 0 ext_comp[0].extcomp_input[8] 0 ext_comp[0].extcomp_output[8] 0 ext_comp[0].extcomp_input[9] 0 ext_comp[0].extcomp_output[9] 0 TF5200 | Twin CAT 3 CNC Version: 1.02 19 Interface to external compensation
## Page 20

Error handling and diagnosis 6.3 ADS objects General diagnostic data of the PC In Twin CAT3 ADS objects are also provided by the external compensation. GEO platform Group index Name Type Unit 0x120300 0x1181 EXTC[0].initialized BOOLEAN - 0x120300 0x1182 EXTC[0].registered BOOLEAN - 0x120300 0x1183 EXTC[0].state SGN32 0: disabled 1: enabled 2: Error GEO axis Group index Name Type Unit 0x120300 0x[1,2,..]1180 EXTC[0].last_offset SGN32 /SGN64 Increment 0x120300 0x[1,2,..]1181 EXTC[0].actual_offs SGN32 /SGN64 Increment et 0x120300 0x[1,2,..]1182 EXTC[0].next_offset SGN32 /SGN64 Increment 0x120300 0x[1,2,..]1183 EXTC[0].offset_delta SGN32 /SGN64 Increment 0x120300 0x[1,2,..]1184 EXTC[0].diff REAL64 mm/s^2 20 Version: 1.02 TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 21

Support and Service 7 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF5200 | Twin CAT 3 CNC Version: 1.02 21 Interface to external compensation
## Page 22

Index Index P P-AXIS-00743 12 P-AXIS-00744 12 P-AXIS-00745 13 P-STUP-00110 12 22 Version: 1.02 TF5200 | Twin CAT 3 CNC Interface to external compensation
## Page 24

More Information: www.beckhoff.com/TF5200 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
