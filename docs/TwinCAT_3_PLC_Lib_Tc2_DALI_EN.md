---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "2.2.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_DALI_EN.pdf"
release_date: "2025-05-08"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc2_DALI 2025-05-08 | Version: 2.2.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 DALI............................................................................................................................................................ 9 4 Programming........................................................................................................................................... 11 4.1 POUs............................................................................................................................................... 11 4.1.1 High-Level commands..................................................................................................... 11 4.1.2 Low-Level commands...................................................................................................... 73 4.1.3 Third-party function blocks............................................................................................. 422 4.1.4 Error codes..................................................................................................................... 438 4.1.5 [obsolete]........................................................................................................................ 441 4.2 DUTs............................................................................................................................................. 461 4.2.1 Enums............................................................................................................................ 461 4.2.2 Structures....................................................................................................................... 464 4.2.3 [Obsolet]......................................................................................................................... 468 4.3 Integration into Twin CAT............................................................................................................... 468 4.3.1 KL6821 with PC system (CX5120)................................................................................. 468 5 Appendix................................................................................................................................................ 473 5.1 Support and Service...................................................................................................................... 473 TE1000 Version: 2.2.0 3
## Page 4

Table of contents 4 Version: 2.2.0 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS®, and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. TE1000 Version: 2.2.0 5
## Page 6

Foreword 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 2.2.0 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 2.2.0 7
## Page 8

Introduction 2 Introduction Update: Tc3_DALI library The Tc2_DALI Twin CAT 3 PLC library is the predecessor to Tc3_DALI. We recommend using the Tc3_DALI library. The Tc2_DALI library will no longer be updated in future. The Tc2_DALI library should not be used for new projects. All the functionalities of the Tc2_DALI library are also available in the new Tc3_DALI library. The user of this library requires basic knowledge of the following: • Twin CAT XAE • PC and network knowledge • Structure and properties of the Beckhoff Embedded PC and its Bus Terminal system • Technology of DALI devices • Relevant safety regulations for building technical equipment This software library is intended for building automation system partners of Beckhoff Automation Gmb H & Co. KG. The system partners operate in the field of building automation and are concerned with the installation, commissioning, expansion, maintenance and service of measurement, control and regulating systems for the technical equipment of buildings. The Tc2_DALI library is usable on all hardware platforms that support Twin CAT 3.1 or higher. 8 Version: 2.2.0 TE1000
## Page 9

DALI 3 DALI DALI (Digital Addressable Lighting Interface) is a definition for the standardization of digital interfaces between control gears (lamps) and control units (sensors). The standard (IEC 62386) allows the manufacturers of lighting components to implement complex lighting tasks easily and conveniently. The KL6811 (DALI/DSI master) and KL6821 (² master) Bus Terminals are integrated into the Bus Terminal system as normal Bus Terminals and are therefore fieldbus-independent. The DALI data is forwarded to the DALI devices via the respective Bus Coupler. Bus controllers also offer a facility for decentralized execution of PLC programs in IEC61131-3. IEC 62386 DALI is specified in the IEC 62386 standard and offers advantages such as flexibility, simplicity, user friendliness and robustness. IEC 62386 has been revised several times and was extended considerably in November 2014 with the publication of the second revision. While in the first revision only control gears (lamps) were considered, from the second revision onwards control units (sensors) are also included. These are described in the respective section of IEC 62386: IEC 62386-101 General system properties such as cabling, feed-in and telegram structure IEC 62386-102 General properties of the control gears IEC 62386-201: Fluorescent lamps (device type 0) IEC 62386-202: Emergency lighting (device type 1) IEC 62386-203: Discharge lamps (device type 2) … IEC 62386-103 General properties of the control devices IEC 62386-301: Push buttons IEC 62386-303: Occupancy sensor IEC 62386-304: Brightness sensor … The IEC 62386-101, IEC 62386-102 and IEC 62386-103 standards describe general properties, while the IEC 62386-2xx and IEC 62386-3xx standards specify the individual device types. IEC 62386-103 and IEC 62386-3xx were included in Revision 2 of the DALI standard. In each DALI line up to 64 control gears and up to 64 input devices can be connected. The KL6821 represents the DALI controller. One such device exists for each DALI line. Any number of DALI lines (KL6821) can be operated with a single Twin CAT controller. TE1000 Version: 2.2.0 9
## Page 10

DALI Communication With regard to the communication, a distinction is made between three telegram types: • 16-bit query, configuration and control telegram. • 24-bit query, configuration and control telegram. • 24-bit event telegram. BF: backward frame FF: forward frame 16-bit telegrams 16-bit telegrams are always sent from a DALI controller to a DALI control gear. They are used for configuring the devices, querying parameters or sending control commands. For certain DALI commands the DALI control gear sends an 8-bit response. DALI control gears only send an 8-bit telegram when requested. In the DALI library these commands are provided in the form of PLC function blocks with the prefix FB_DALIV2, e.g. FB_DALIV2Query Actual Level. 24-bit telegrams 24-bit telegrams are always sent from a DALI controller to a DALI input device. They are used for configuring the devices, querying parameters or sending control commands. For certain DALI commands the DALI input device sends an 8-bit response. In the DALI library these commands are provided in the form of PLC function blocks with the prefix FB_DALIV2x, e.g. FB_DALIV2x Query Operating Mode. 24-bit events DALI input devices are able to send events. They are always evaluated by the DALI controller and have a length of 24 bits. Individual events can be filtered out with the function block FB_DALIV2x Get Event Data [} 73] for further processing. Note Further information on DALI can be found on the website of the DALI Activity Group (http://www.dali-ag.org) or the Digital Illumination Interface Alliance (https://www.digitalilluminationinterface.org) and in the IEC 62386 standard. The KL6811 only supports the first revision of the DALI standard. It is not possible to operate control units (sensors) with the KL6811. The KL6821 is backward compatible with the KL6811, but it does not support DSI. 10 Version: 2.2.0 TE1000
## Page 11

Programming 4 Programming Further libraries required • Tc2_Standard • Tc2_System • Tc2_Utilities • Tc3_Module Memory usage Integrating the library already consumes PLC memory. Depending on the application program, therefore, the remaining memory may not be sufficient. 4.1 POUs 4.1.1 High-Level commands 4.1.1.1 Part 102 (control gears) 4.1.1.1.1 Addressing Function blocks Name Description FB_DALIV2Addressing Int Random Addressing [} 11] Addresses the control gears according to the random principle. The Bus Terminal’s internal addressing function is used here. FB_DALIV2Addressing Physical Selection [} 13] Addresses the control gears according to the ‘physical selection’ addressing method. FB_DALIV2Addressing Random Addressing [} 15] Addresses the control gears according to the random principle. FB_DALIV2Change Address List [} 17] The short addresses of several control gears can be changed using this function block. FB_DALIV2Swap Short Address [} 19] Swap the short addresses of two control gears. FB_DALIV2Swap Short Address List [} 20] Swaps the short addresses of several control gears. 4.1.1.1.1.1 FB_DALIV2Addressing Int Random Addressing The function block FB_DALIV2Addressing Int Random Addressing addresses the control gears at random. The user has no influence over which short address is assigned to which control gear. Short addresses are allocated in ascending order. Applying a positive edge to the b Start input starts the function block, and the output b Busy goes TRUE. Depending on the selected options (parameter n Options) the group membership and scenes are subsequently deleted. The terminal now addresses all control gears independently. Once all control gears have been addressed, the b Busy output switches back to FALSE. The n Addressed Devices output variable supplies information about how many control gears have received a short address. Processing this function block can take several minutes, depending on how many control gears are attached. Since the addressing is TE1000 Version: 2.2.0 11
## Page 12

Programming performed directly by the terminal, this method is somewhat faster than the function block FB_DALIV2Addressing Random Addressing. [} 15] However, this function block does not supply any feedback during addressing. In addition to that, addressing cannot be terminated prematurely. This function block can only be executed if the terminal has the firmware version 2A or newer. Inputs VAR_INPUT b Start : BOOL; n Start With Short Address : BYTE := 0; n Options : DWORD := DALIV2_OPTION_OPTICAL_FEEDBACK; END_VAR Name Type Description b Start BOOL A positive edge at this input activates the function block, thereby starting the addressing sequence. n Start With Short Addr BYTE Short address allocated to the first control gear (0 ... 63). ess n Options DWORD Options for addressing the control gears (see table). The individual constants must be linked with OR operators. Constant Description DALIV2_OPTION_COMPLETE_NEW All control gears are re-addressed, including control gears that _INSTALLATION already have a short address. DALIV2_OPTION_DELETE_ALL_GR Before addressing, the group assignments (see variables GROUP 0-7 OUP_ASSIGNMENTS [} 88] and GROUP 8-15 [} 88]) are deleted for all control gears, including those that may not be addressed. DALIV2_OPTION_DELETE_ALL_SC Before addressing, the scenes (see variables SCENE 0 [} 88] to ENE_ASSIGNMENTS SCENE 15 [} 88]) are deleted for all control gears, including those that may not be addressed. DALIV2_OPTION_OPTICAL_FEEDB Before addressing, all control gears are set to MIN LEVEL [} 88]. ACK Newly addressed control gears are assigned MAX LEVEL [} 88] brightness after assignment of the short address. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Addressed Devices : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 12 Version: 2.2.0 TE1000
## Page 13

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Addressed Devices BYTE If addressing has been completed (b Busy is FALSE), then the number of addressed control gears is shown at this output. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.1.2 FB_DALIV2Addressing Physical Selection The function block FB_DALIV2Addressing Physical Selection addresses the control gears through 'physical selection' based on the addressing technique. This means that the individual control gears are selected (and therefore addressed) by removing the lamps. Short addresses are assigned (ascending) in the same order in which the lamps are removed. Applying a positive edge to the b Start input starts the function block, and the output b Busy goes TRUE. Depending on the selected options (parameter n Options) the group membership and scenes are subsequently deleted. The e Current Addressing State output specifies the next required user operation. It determines whether for the next control gear the lamp should be removed or reinserted. The arr Addressed Devices output variable provides information about which control gears have already been assigned a short address. Once all control gears have been addressed, the addressing procedure is completed through a positive edge at input b Stop, and the output b Busy switches back to FALSE. Inputs VAR_INPUT b Start : BOOL; b Stop : BOOL; n Start With Short Address : BYTE := 0; n Options : DWORD := DALIV2_OPTION_OPTICAL_FEEDBACK; END_VAR Name Type Description b Start BOOL A positive edge at this input activates the function block, thereby starting the addressing sequence. b Stop BOOL A positive edge at this input disables the function block, thereby stopping the addressing sequence. n Start With Short Addr BYTE Short address allocated to the first control gear (0 ... 63). ess n Options DWORD Options for addressing the control gears (see table). The individual constants must be linked with OR operators. TE1000 Version: 2.2.0 13
## Page 14

Programming Constant Description DALIV2_OPTION_COMPLETE_NEW_INSTALLATIO All control gears are re-addressed, including control N gears that already have a short address. DALIV2_OPTION_DELETE_ALL_GROUP_ASSIGN Before addressing, the group assignments (see MENTS variables GROUP 0-7 [} 88] and GROUP 8-15 [} 88]) are deleted for all control gears, including those that may not be addressed. DALIV2_OPTION_DELETE_ALL_SCENE_ASSIGN Before addressing, the scenes (see variables SCENE MENTS 0 [} 88] to SCENE 15 [} 88]) are deleted for all control gears, including those that may not be addressed. DALIV2_OPTION_OPTICAL_FEEDBACK Before addressing, all control gears are set to MIN LEVEL [} 88]. Newly addressed control gears are assigned MAX LEVEL [} 88] brightness after assignment of the short address. Name Type Description b Start BOOL A positive edge at this input activates the function block, thereby starting the addressing sequence. n Start With Short Addr BYTE Short address allocated to the first control gear (0 ... 63). ess n Options DWORD Options for addressing the control gears (see table). The individual constants must be linked with OR operators. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; arr Addressed Devices : ARRAY [0..63] OF BOOL; e Current Addressing State : E_DALIV2Current Addressing State; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). arr Addressed Device ARRAY OF BOOL Once a short address is assigned to a control gear, the s associated element is set in the structure. The structure index reflects the short address of the control gear. 14 Version: 2.2.0 TE1000
## Page 15

Programming Name Type Description e Current Addressing E_DALIV2Current Addressi The output variable indicates the current step. State ng State [} 462] Element Description e DALIV2Addr State Idle No addressing takes place. e DALIV2Addr State Remove Lamp The function block waits for a lamp to be removed at a control gear. e DALIV2Addr State Reinsert Lamp The function block has detected the control gear on which the lamp was removed (the control gear is selected) and now waits for it to be inserted again. e DALIV2Addr State Addressing Lamp The selected control gear is addressed. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.1.3 FB_DALIV2Addressing Random Addressing The function block FB_DALIV2Addressing Random Addressing addresses the control gears at random. The user has no influence over which short address is assigned to which control gear. Short addresses are allocated in ascending order. Applying a positive edge to the b Start input starts the function block, and the output b Busy goes TRUE. Depending on the selected options (parameter n Options) the group membership and scenes are subsequently deleted. The function block now addresses all control gears independently. The output variable arr Addressed Devices provides information about which control gears have already been assigned a short address. Once all control gears have been addressed, the b Busy output switches back to FALSE. Addressing can be aborted through a positive edge at input b Cancel. Processing this function block can take several minutes, depending on how many control gears are attached. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; n Start With Short Address : BYTE := 0; n Options : DWORD := DALIV2_OPTION_OPTICAL_FEEDBACK; END_VAR Name Type Description b Start BOOL A positive edge at this input activates the function block, thereby starting the addressing sequence. b Cancel BOOL A positive edge at this input deactivates the function block, thereby interrupting the addressing sequence. n Start With Short Addr BYTE Short address allocated to the first control gear (0 ... 63). ess n Options DWORD Options for addressing the control gears (see table). The individual constants must be linked with OR operators. TE1000 Version: 2.2.0 15
## Page 16

Programming Constant Description DALIV2_OPTION_COMPLETE_NEW_INSTALLATIO All control gears are re-addressed, including control N gears that already have a short address. DALIV2_OPTION_DELETE_ALL_GROUP_ASSIGN Before addressing, the group assignments (see MENTS variables GROUP 0-7 [} 88] and GROUP 8-15 [} 88]) are deleted for all control gears, including those that may not be addressed. DALIV2_OPTION_DELETE_ALL_SCENE_ASSIGN Before addressing, the scenes (see variables SCENE MENTS 0 [} 88] to SCENE 15 [} 88]) are deleted for all control gears, including those that may not be addressed. DALIV2_OPTION_OPTICAL_FEEDBACK Before addressing, all control gears are set to MIN LEVEL [} 88]. Newly addressed control gears are assigned MAX LEVEL [} 88] brightness after assignment of the short address. DALIV2_OPTION_WITHOUT_RANDOMISE The RANDOMISE command is not called before the addressing sequence. This means that all control gears retain their existing random address (RANDOM ADDRESS [} 88]). Only use this option when necessary. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Current Search Address : UDINT; arr Addressed Devices : ARRAY [0..63] OF BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Current Search Addr UDINT Current search address (see SEARCH ADDRESS [} 88]) ess arr Addressed Device ARRAY OF BOOL Once a short address is assigned to a control gear, the s associated element is set in the structure. The structure index reflects the short address of the control gear. 16 Version: 2.2.0 TE1000
## Page 17

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.1.4 FB_DALIV2Change Address List The function block FB_DALIV2Change Address List can be used to change the short addresses of several control gears. In contrast to the FB_DALIV2Swap Short Address List [} 20] function block, it is not necessary for a free, unused short address to be available in the DALI line. A list of the control gears whose short addresses are to be changed is transferred in the arr Change Address List array of type ST_DALIV2Change Address List [} 464]. The list has 64 entries from 0 to 63. Each entry contains a variable n Old Address and n New Address with which the address assignment is parameterized. The end of the list is programmed with a 255 entry at n Old Address, so that the whole list does not necessarily have to be filled in. If this entry is missing, however, then all entries are accepted. When the function block is started (positive edge on b Start), the list end is first determined on the basis of the above-described entry and afterwards the valid list range is examined for the following false entries: • Address entries > 63 • Double address entry on the original page n Old Address (would not make sense) • Double address entry on the target page n New Address (leads to double assignment of an address and, hence, to errors) The function block then determines the internal long addresses of the DALI devices on the basis of the short addresses and enters them respectively in the parameters n Random Address High, n Random Address Middle and n Random Address Low of the list. If an error occurs during these queries, this leads to a false entry for the respective device in the list element n Errors (see ST_DALIV2Change Address List [} 464]). The further sequence in the function block now depends on the option DALIV2_OPTION_SAFE_ADDRESSING (input n Options). If it is set, secure re-addressing takes place: first, all short addresses of the selected DALI devices are deleted. Afterwards, status queries are sent to all desired new addresses in the DALI line. 2 cases are now possible: • If a device responds to this request, the desired new address has already been assigned elsewhere. The previously “deleted” DALI devices are programmed with their old addresses and an error message is output. • If no devices respond to this status query, then the previously “deleted” DALI devices are programmed with the desired new addresses. The reprogramming is checked afterwards in both cases. If errors occur during deletion, status query or reprogramming, this leads to an error entry for the respective device in the list element n Errors (see ST_DALIV2Change Address List [} 464]). If the DALIV2_OPTION_SAFE_ADDRESSING option (input n Options) is not set, the short addresses are not deleted and the status query for the existence of desired new addresses is omitted and the new addresses are programmed directly. This is possible because programming takes place via the long address determined beforehand. Reprogramming is not verified in this case. The individual bits in the list element n Errors have the following meaning: Bit Error 0 Error whilst reading the high byte of the long address (n Random Address High). 1 Error whilst reading the middle byte of the long address (n Random Address Middle). 2 Error whilst reading the low byte of the long address (n Random Address Low). TE1000 Version: 2.2.0 17
## Page 18

Programming Bit Error 3 Error whilst deleting a short address. 4 Error whilst verifying a short address. 5 Error whilst programming a short address. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority High; n Options : DWORD := DALIV2_OPTION_OPTICAL_FEEDBACK; END_VAR Name Type Description b Start BOOL A positive edge at this input activates the function block, thereby starting the addressing sequence. b Cancel BOOL A positive edge at this input deactivates the function block, thereby interrupting the addressing sequence. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Options DWORD Options for writing the variables (see table). The individual constants must be linked with OR operators. Constant Description DALIV2_OPTION_SAFE_ADDRESSING Safe addressing: Old short addresses are deleted, the new ones are checked to see if they already exist and reprogramming is verified. Inputs/outputs VAR_IN_OUT arr Change Address List : ARRAY [0.. 63] OF ST_DALIV2Change Address List; st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description arr Change Addres ST_DALIV2Change Address A reference to the list containing the short addresses to be s List List [} 464] changed st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 18 Version: 2.2.0 TE1000
## Page 19

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.1.5 FB_DALIV2Swap Short Address The short addresses of two control gears can be swapped using the function block FB_DALIV2Swap Short Address. However, this requires a free, unused short address to be available in the DALI line. Inputs VAR_INPUT b Start : BOOL; n Short Address01 : BYTE; n Short Address02 : BYTE; n Free Short Address : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Short Address01 BYTE Short address of the first control gear (0 ... 63) n Short Address02 BYTE Short address of the second control gear (0 ... 63) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 19
## Page 20

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.1.6 FB_DALIV2Swap Short Address List The short addresses of several control gears can be swapped using the function block FB_DALIV2Swap Short Address List. However, this requires a free, unused short address to be available in the DALI line. In the parameter arr Swap Short Address List, a list of the control gears whose short addresses are to be changed is transferred. The index of the structure thereby corresponds to the short address of the control gear. The element n New Short Address contains the new short address. b Short Address Valid must be set to TRUE, to ensure that the short address is changed in the corresponding control gear. Applying a positive edge to the b Start input starts the function block, and the output b Busy goes TRUE. Depending on the chosen options (parameter n Options), all lamps will be set to the value MIN LEVEL. The elements of the output arr Swaped Short Addresses are reset. If the new short address is set for a control gear, the corresponding element in the output arr Swaped Short Addresses is set to TRUE. If the option DALIV2_OPTION_OPTICAL_FEEDBACK is active, the lamp will in addition be set to the value MAX LEVEL. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; n Free Short Address : BYTE; n Options : DWORD := DALIV2_OPTION_OPTICAL_FEEDBACK; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. b Cancel BOOL A positive edge at this input deactivates the function block, thereby interrupting the addressing sequence. n Free Short Address BYTE Free short address (0 ... 63) n Options DWORD Options for swapping short addresses (see table). The individual constants must be linked with OR operators. 20 Version: 2.2.0 TE1000
## Page 21

Programming Constant Description DALIV2_OPTION_OPTICAL_FEEDBACK Before swapping the short addresses, all control gears are set to MIN LEVEL [} 88]. After assigning the new short address, the brightness of the respective control gear will be changed to MAX LEVEL [} 88]. Inputs/outputs VAR_IN_OUT arr Swap Short Address List : ARRAY [0..63] OF ST_DALIV2Swap Short Address List; st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description arr Swap Short Addres ARRAY OF A reference to the list containing the short addresses to be s List ST_DALIV2Swap Short Addr swapped ess List [} 467] st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; arr Swaped Short Addresses : ARRAY [0..63] OF BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). arr Swaped Short Add ARRAY OF BOOL If the new short address has been set for a control gear, resses the corresponding element will be set in the structure. The structure index reflects the short address of the control gear. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.2 Power control Function blocks Name Description FB_DALIV2Constant Light Control Eco [} 22] Simple function block for constant light control of DALI devices. TE1000 Version: 2.2.0 21
## Page 22

Programming Name Description FB_DALIV2Dimmer1Switch [} 25] Function block for dimming DALI devices with one switch. FB_DALIV2Dimmer1Switch Eco [} 28] Memory saving version of FB_DALIV2Dimmer1Switch [} 25] with no special functions. FB_DALIV2Dimmer1Switch Multiple [} 30] Function block for dimming DALI devices with one switch. For applications in which up to five DALI lines (0..4) can be installed. FB_DALIV2Dimmer2Switch [} 32] Function block for dimming DALI devices with two switches. FB_DALIV2Dimmer2Switch Eco [} 35] Memory saving version of FB_DALIV2Dimmer2Switch [} 32] with no special functions. FB_DALIV2Light [} 37] Function block for controlling lamps. FB_DALIV2Light Control [} 39] Function block for daylight-dependent lighting control with up to 30 interpolation points. FB_DALIV2Ramp [} 42] Function block for realizing a ramp. FB_DALIV2Sequencer [} 45] Function block for realizing light sequences with up to 50 interpolation points. FB_DALIV2Stairwell Dimmer [} 49] Function block for controlling stairwell lighting. 4.1.1.1.2.1 FB_DALIV2Constant Light Control Eco The function block FB_DALIV2Constant Light Control Eco is used for constant light control with DALI control gears. The system tries to match a specified setpoint through cyclic dimming. The control dynamics are determined by a dead time (t Dead Time). The dead time defines the delay between the individual commands for changing the control value. The smaller the dead time, the faster the control. A freely definable hysteresis (n Hysteresis) prevents continuous oscillation around the setpoint. If the actual value is within the hysteresis range around the setpoint, the lamps brightness remains unchanged. An option is available for specifying whether the lamps should be switched on and off automatically (see table below). Comment on the n Master Dev Addr parameter The DALI system provides facilities not just for controlling lamps individually, but also for addressing them as groups or through common commands. Since the individual devices may belong to different groups, the individual lamps may have different brightness states before a group or common control command. So that it is nevertheless possible to be clear whether the lamps now are to be switched on or off, a master device is assigned to each group, whose state is followed by the other devices. It is not necessary to specify a master device if the function block is to be used to control a single lamp, e Addr Type = e Addr Type Short. In this case, the n Master Dev Addr parameter has no significance. 22 Version: 2.2.0 TE1000
## Page 23

Programming Inputs VAR_INPUT b Enable : BOOL := TRUE; b On : BOOL; b Off : BOOL; b Toggle : BOOL; n Setpoint Value : UINT := 500; n Actual Value : UINT; n Hysteresis : UINT := 50; t Dead Time : TIME := t#10s; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; t Cycle Actual Level Master Dev : TIME := t#0s; n Options : DWORD := 0; END_VAR Name Type Description b Enable BOOL Enables the function block. If this input is FALSE, the inputs b On, b Off and b Toogle are disabled. No control values are output. b On BOOL Switches the addressed devices to MAX_LEVEL [} 88] and activates constant light control. b Off BOOL Switches the addressed devices off and disables constant light control. b Toggle BOOL The lighting is switched on or off, depending on the state of the reference device. n Setpoint Value UINT This input is used for specifying the setpoint. n Actual Value UINT The actual value is applied at this input. n Hysteresis UINT Control hysteresis around the setpoint. If the actual value is within this range, the control values for the lamps remain unchanged. t Dead Time TIME Dead time between the individual commands used for changing the control value for the DALI lamps. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations t Cycle Actual Level M TIME Cycle time required to read the current actual value of the aster Dev reference lamp in the background (see ACTUAL DIM LEVEL [} 88]). So that the controlling of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. The value read is output at the n Actual Level Master Dev output. n Options DWORD Options for swapping short addresses (see table). The individual constants must be linked with OR operators. Constant Description DALIV2_OPTION_SWITCH_ON_AND_OFF The DALI commands ON_AND_STEP_UP [} 119] and STEP_DOWN_AND_OFF [} 123] are used for changing the control value. This switches the lamps off after reaching the MIN_LEVEL [} 88]. If the control deviation is above the hysteresis, the lamps are switched on again. If this option is not set, the commands STEP_UP [} 124] and STEP_DOWN [} 122] are used. This keeps the lamps switched on at all times. TE1000 Version: 2.2.0 23
## Page 24

Programming Constant Description DALIV2_OPTION_SWITCH_ON_WITH_MIN_LEVEL If the light is switched on again by the constant light control, this option always uses the command MIN_LEVEL [} 88]. If the option is not set, MAX_LEVEL [} 88] is used. This option is available from v3.3.2.0 of the Tc2_DALI PLC library. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; n Deviation : INT; b Controller Is Active : BOOL; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) n Deviation INT Current control deviation (setpoint/actual value) b Controller Is Active BOOL This output is set once the control is activated. b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 24 Version: 2.2.0 TE1000
## Page 25

Programming 4.1.1.1.2.2 FB_DALIV2Dimmer1Switch The function block FB_DALIV2Dimmer1Switch switches and dims a single DALI lamp, a DALI group or a complete DALI line via a push button. Operating by means of the b Switch Dimm input The light is switched on or off by a short signal at the b Switch Dimm input. Dimmer mode will be activated if the signal remains for longer than t Switch Over Time (typical recommended value: 200 ms). The output signal then cycles between n Min Level Master Dev and n Max Level Master Dev. In order to be able to set the maximum or minimum value more easily, the output signal pauses at the level of the maximum and minimum values for the time given by t Cycle Delay. When the signal is once more removed, the output signal being generated at that time is retained. Another pulse at the input will set the output to 0. If the b Switch Dimm is briefly removed in dimmer mode, the function block changes the direction of dimming. Operation by means of the b On and b Off inputs The light is immediately switched on or off if a rising edge is applied to the b On or b Off inputs. The output value is set to 0 when switching off. The switch-on behavior can be affected by the memory function (see below). Operation by means of the b Set Dimm Value and n Dimm Value inputs If the value of n Dimm Value changes the devices concerned will be switched to this brightness value immediately. The significant point here is that the value changes. The lighting is switched off by changing the value to 0. If there is a rising edge at the b Set Dimm Value input, the value of n Dimm Value immediately appears at the output. Immediate modification of the output can be suppressed by a static 1- signal at the b Set Dimm Value input. This makes it possible to apply a value to the n Dimm Value input, but for this value only to be passed to the output at the next rising edge of b Set Dimm Value. The b Set Dimm Value and n Dimm Value inputs can be used to implement a variety of lighting scenarios. Using n Dimm Value to set the outputs directly can be used to achieve particular brightness levels, either directly or by continuously changing the value. n Dimm Value must have a value between n Min Level Master Dev and n Max Level Master Dev. The value 0 is an exception. If the value is outside this range, the output value is limited to the upper or lower limit, as appropriate. The memory function It is necessary to determine whether the memory function (b Memory Mode On input) is active or not at switch- on. If the memory function is active, then the last set value is adopted as the brightness value as soon as the device is switched on. If the memory function is not active, a brightness specified by the n On Value Without Memory Mode parameter is assigned to the devices concerned. It is irrelevant, in this case, whether the light it has been switched on by means of the b On input or the b Switch Dimm input. It should be TE1000 Version: 2.2.0 25
## Page 26

Programming noted that the n On Value Without Memory Mode parameter must lie between n Min Level Master Dev and n Max Level Master Dev. If this is not the case, the output value is adjusted to the upper or lower limit, as appropriate. Comment on the t Switch Over Time parameter If a duration of 0 is specified for the parameter t Switch Over Time, the b Switch Dimm input can only be used to dim the light. Switching on and off is only possible with the b On and b Off inputs. Comment on the n Master Dev Addr parameter The DALI system provides facilities not just for controlling lamps individually, but also for addressing them as groups or through common commands. Since the individual devices may belong to different groups, the individual lamps may have different brightness states before a group or common control command. So that it is nevertheless possible to be clear whether the lamps now are to be switched on or off, a master device is assigned to each group, whose state is followed by the other devices. It is not necessary to specify a master device if the function block is to be used to control a single lamp, e Addr Type = e Addr Type Short. In this case, the n Master Dev Addr parameter has no significance. Inputs VAR_INPUT b Switch Dimm : BOOL; b On : BOOL; b Off : BOOL; b Set Dimm Value : BOOL; n Dimm Value : BYTE; t Switch Over Time : TIME := t#400ms; t Cycle Delay : TIME := t#500ms; b Memory Mode On : BOOL := FALSE; n On Value Without Memory Mode : BYTE := 254; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; n Min Level Master Dev : BYTE := 126; n Max Level Master Dev : BYTE := 254; t Cycle Actual Level Master Dev : TIME := t#0s; END_VAR Name Type Description b Switch Dimm BOOL Switches or dims the addressed devices. b On BOOL Switches the addressed devices to the last output value, or to the value n On Value Without Memory Mode. b Off BOOL Switches the addressed devices off (value 0). b Set Dimm Value BOOL A positive edge at this input sets the addressed devices immediately to the brightness value that is present at input n Dimm Value. If the value of n Dimm Value changes, the brightness value is set immediately to the changed value if the input b Set Dimm Value is FALSE. n Dimm Value BYTE see b Set Dimm Value t Switch Over Time TIME Time for switching between the light on/off and dimming functions for the input b Switch Dimm t Cycle Delay TIME Delay time, if either the minimum or maximum value is reached. b Memory Mode On BOOL Switches to the memory function, so that the previous value is written to the output as soon as it is switched on. n On Value Without Me BYTE Switch-on value if the memory function is not switched on. mory Mode n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] 26 Version: 2.2.0 TE1000
## Page 27

Programming n Master Dev Addr BYTE The address of the master device for group and common switching operations n Min Level Master De BYTE Minimum value of the master device v n Max Level Master De BYTE Maximum value of the master device v t Cycle Actual Level Ma TIME Cycle time required to read the current actual value in the ster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 27
## Page 28

Programming 4.1.1.1.2.3 FB_DALIV2Dimmer1Switch Eco The function block FB_DALIDimmer1Switch Eco is the memory-saving variant of FB_DALIV2Dimmer1Switch [} 25]. It is not equipped with the special function “Switch off memory function”. Operating by means of the b Switch Dimm input The light is switched on or off by a short signal at the b Switch Dimm input. If the signal remains for longer than t Switch Over Time (recommended value: 200 ms), dimmer mode is activated and the brightness increases or decreases steadily. The dimming direction is changed by briefly removing the b Switch Dimm signal. Operation by means of the b On and b Off inputs The light is immediately switched on or off if a rising edge is applied to the b On or b Off inputs. The output value is set to 0 when switching off. Operation by means of the b Set Dimm Value and n Dimm Value inputs If the value of n Dimm Value changes the devices concerned will be switched to this brightness value immediately. The significant point here is that the value changes. The lighting is switched off by changing the value to 0. If there is a positive edge at the b Set Dimm Value input, the value of n Dimm Value immediately appears at the output. Immediate modification of the output can be suppressed by a static 1- signal at the b Set Dimm Value input. This makes it possible to apply a value to the n Dimm Value input, but for this value only to be passed to the output at the next positive edge of b Set Dimm Value. The b Set Dimm Value and n Dimm Value inputs can be used to implement a variety of lighting scenarios. Direct setting of the output, by means of n Dimm Value, can be used to achieve particular brightness levels. Either directly or by continuously changing the value. Memory function In contrast to FB_DALIV2Dimmer1Switch [} 25], where the memory function can be activated or deactivated via the input b Memory Mode On, the memory function is always active in this memory-saving version. This means that the last-set value is adopted as the brightness value when switching on. It does not matter whether the light is switched via the input b On or via the input b Switch Dimm. Comment on the t Switch Over Time parameter If a duration of 0 is specified for the parameter t Switch Over Time, the b Switch Dimm input can only be used to dim the light. Switching on and off is only possible with the b On and b Off inputs. Comment on the n Master Dev Addr parameter The DALI system provides facilities not just for controlling lamps individually, but also for addressing them as groups or through common commands. Since the individual devices may belong to different groups, the individual lamps may have different brightness states before a group or common control command. So that it is nevertheless possible to be clear whether the lamps now are to be switched on or off, a master device is 28 Version: 2.2.0 TE1000
## Page 29

Programming assigned to each group, whose state is followed by the other devices. It is not necessary to specify a master device if the function block is to be used to control a single lamp, e Addr Type = e Addr Type Short. In this case, the n Master Dev Addr parameter has no significance. Inputs VAR_INPUT b Switch Dimm : BOOL; b On : BOOL; b Off : BOOL; b Set Dimm Value : BOOL; n Dimm Value : BYTE; t Switch Over Time : TIME := t#400ms; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; t Cycle Actual Level Master Dev : TIME := t#0s; END_VAR Name Type Description b Switch Dimm BOOL Switches or dims the addressed devices. b On BOOL Switches the addressed devices to the last output value, or to the value n On Value Without Memory Mode. b Off BOOL Switches the addressed devices off (value 0). b Set Dimm Value BOOL A positive edge at this input sets the addressed devices immediately to the brightness value that is present at input n Dimm Value. If the value of n Dimm Value changes, the brightness value is set immediately to the changed value if the input b Set Dimm Value is FALSE. n Dimm Value BYTE see b Set Dimm Value t Switch Over Time TIME Time for switching between the light on/off and dimming functions for the input b Switch Dimm n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations t Cycle Actual Level M TIME Cycle time required to read the current actual value in the aster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR TE1000 Version: 2.2.0 29
## Page 30

Programming Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.2.4 FB_DALIV2Dimmer1Switch Multiple The function block FB_DALIV2Dimmer1Switch Multiple is used to switch and dim DALI devices with a push button. For applications in which up to five DALI lines (0..4) can be installed. The basic function of this function block can be found in the description of FB_DALIV2Dimmer1Switch [} 25]. Inputs VAR_INPUT b Switch Dimm : BOOL; b On : BOOL; b Off : BOOL; b Set Dimm Value : BOOL; n Dimm Value : BYTE; t Switch Over Time : TIME := t#400ms; t Cycle Delay : TIME := t#500ms; b Memory Mode On : BOOL := FALSE; n On Value Without Memory Mode : BYTE := 254; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; 30 Version: 2.2.0 TE1000
## Page 31

Programming n Master Dev Line : BYTE := 0; n Min Level Master Dev : BYTE := 126; n Max Level Master Dev : BYTE := 254; t Cycle Actual Level Master Dev : TIME := t#0s; n DALILine Enable : BYTE := 2#0000_0001; END_VAR Name Type Description b Switch Dimm BOOL Switches or dims the addressed devices. b On BOOL Switches the addressed devices to the last output value, or to the value n On Value Without Memory Mode. b Off BOOL Switches the addressed devices off (value 0). b Set Dimm Value BOOL A positive edge at this input sets the addressed devices immediately to the brightness value that is present at input n Dimm Value. If the value of n Dimm Value changes, the brightness value is set immediately to the changed value if the input b Set Dimm Value is FALSE. n Dimm Value BYTE see b Set Dimm Value t Switch Over Time TIME Time for switching between the light on/off and dimming functions for the input b Switch Dimm t Cycle Delay TIME Delay time, if either the minimum or maximum value is reached. b Memory Mode On BOOL Switches to the memory function, so that the previous value is written to the output as soon as it is switched on. n On Value Without Me BYTE Switch-on value if the memory function is not switched on. mory Mode n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations n Master Dev Line BYTE The line on which the master device for group and common configurations is located. Depending on the function block, there is only one master device that is to be selected from one of the activated DALI lines. Lines 0 to 4 are available. n Min Level Master De BYTE Minimum value of the master device v n Max Level Master De BYTE Maximum value of the master device v t Cycle Actual Level M TIME Cycle time required to read the current actual value in the aster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. n DALILine Enable Input variable in the form of a bit pattern. A 1 in the bit pattern indicates that the DALI line is activated. Example: 2#01001 means that DALI lines 0 and 3 are activated. Inputs/outputs VAR_IN_OUT st Command Buffer00 : ST_DALIV2Command Buffer; st Command Buffer01 : ST_DALIV2Command Buffer; st Command Buffer02 : ST_DALIV2Command Buffer; st Command Buffer03 : ST_DALIV2Command Buffer; st Command Buffer04 : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 31
## Page 32

Programming Name Type Description st Command Buffer00 ST_DALIV2Command Buff Reference to the internal structures for communication with - er the function blocks FB_KL6811Communication [} 77] st Command Buffer04 (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.2.5 FB_DALIV2Dimmer2Switch The function block FB_DALIDimmer2Switch corresponds to the function block FB_DALIV2Dimmer1Switch [} 25]. The difference is that two switches are connected to the function block FB_DALIDimmer2Switch. This allows the operator to specifically dim up or down. 32 Version: 2.2.0 TE1000
## Page 33

Programming Operation by means of the b Switch Dimm Up and b Switch Dimm Down inputs The light is switched on or off by a short signal at the b Switch Dimm Up or b Switch Dimm Down inputs. Dimmer mode will be activated if the signal remains for longer than t Switch Over Time (typical recommended value: 200 ms). The addressed devices are now dimmed to the levels specified by n Max Level Master Dev and n Min Level Master Dev. When the signal is once more removed, the output signal being generated at that time is retained. Another pulse at one of the inputs will set the output to 0. Operation by means of the b On and b Off inputs The light is immediately switched on or off if a rising edge is applied to the b On or b Off inputs. The output value is set to 0 when switching off. The switch-on behavior can be affected by the memory function (see below). Operation by means of the b Set Dimm Value and n Dimm Value inputs If the value of n Dimm Value changes the devices concerned will be switched to this brightness value immediately. The significant point here is that the value changes. The lighting is switched off by changing the value to 0. If there is a rising edge at the b Set Dimm Value input, the value of n Dimm Value immediately appears at the output. Immediate modification of the output can be suppressed by a static 1- signal at the b Set Dimm Value input. This makes it possible to apply a value to the n Dimm Value input, but for this value only to be passed to the output at the next rising edge of b Set Dimm Value. The b Set Dimm Value and n Dimm Value inputs can be used to implement a variety of lighting scenarios. Using n Dimm Value to set the outputs directly can be used to achieve particular brightness levels, either directly or by continuously changing the value. n Dimm Value must have a value between n Min Level Master Dev and n Max Level Master Dev. The value 0 is an exception. If the value is outside this range, the output value is limited to the upper or lower limit, as appropriate. The memory function It is necessary to determine whether the memory function (b Memory Mode On input) is active or not at switch- on. If the memory function is active, then the last set value is adopted as the brightness value as soon as the device is switched on. If the memory function is not active, a brightness specified by the n On Value Without Memory Mode parameter is assigned to the devices concerned. It is irrelevant, in this case, whether the light it has been switched on by means of the b On input or the b Switch Dimm input. It should be noted that the n On Value Without Memory Mode parameter must lie between n Min Level Master Dev and n Max Level Master Dev. If this is not the case, the output value is adjusted to the upper or lower limit, as appropriate. Comment on the t Switch Over Time parameter If a duration of 0 is specified for the parameter t Switch Over Time, the b Switch Dimm input can only be used to dim the light. Switching on and off is only possible with the b On and b Off inputs. Comment on the n Master Dev Addr parameter The DALI system provides facilities not just for controlling lamps individually, but also for addressing them as groups or through common commands. Since the individual devices may belong to different groups, the individual lamps may have different brightness states before a group or common control command. So that it is nevertheless possible to be clear whether the lamps now are to be switched on or off, a master device is assigned to each group, whose state is followed by the other devices. It is not necessary to specify a master device if the function block is to be used to control a single lamp, e Addr Type = e Addr Type Short. In this case, the n Master Dev Addr parameter has no significance. Inputs VAR_INPUT b Switch Dimm Up : BOOL; b Switch Dimm Down : BOOL; b On : BOOL; b Off : BOOL; b Set Dimm Value : BOOL; n Dimm Value : BYTE; t Switch Over Time : TIME := t#400ms; TE1000 Version: 2.2.0 33
## Page 34

Programming b Memory Mode On : BOOL := FALSE; n On Value Without Memory Mode : BYTE := 254; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; n Min Level Master Dev : BYTE := 126; n Max Level Master Dev : BYTE := 254; t Cycle Actual Level Master Dev : TIME := t#0s; END_VAR Name Type Description b Switch Dimm Up BOOL Switches or dims the addressed devices up. b Switch Dimm Down BOOL Switches or dims the addressed devices down. b On BOOL Switches the addressed devices to the last output value, or to the value n On Value Without Memory Mode. b Off BOOL Switches the addressed devices off (value 0). b Set Dimm Value BOOL A positive edge at this input sets the addressed devices immediately to the brightness value that is present at input n Dimm Value. If the value of n Dimm Value changes, the brightness value is set immediately to the changed value if the input b Set Dimm Value is FALSE. n Dimm Value BYTE see b Set Dimm Value t Switch Over Time TIME Time for switching between the light on/off and dimming functions for the inputs b Switch Dimm Up and b Switch Dim Down b Memory Mode On BOOL Switches to the memory function, so that the previous value is written to the output as soon as it is switched on. n On Value Without Me BYTE Switch-on value if the memory function is not switched on. mory Mode n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations n Min Level Master De BYTE Minimum value of the master device v n Max Level Master De BYTE Maximum value of the master device v t Cycle Actual Level M TIME Cycle time required to read the current actual value in the aster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; b Busy : BOOL; 34 Version: 2.2.0 TE1000
## Page 35

Programming b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.2.6 FB_DALIV2Dimmer2Switch Eco The function block FB_DALIDimmer2Switch Eco is the memory-saving variant of FB_DALIV2Dimmer2Switch [} 32]. It is not equipped with the special function “Switch off memory function”. Operation by means of the b Switch Dimm Up and b Switch Dimm Down inputs The light is switched on or off by a short signal at the b Switch Dimm Up or b Switch Dimm Down inputs. Dimmer mode will be activated if the signal remains for longer than t Switch Over Time (typical recommended value: 200ms). The addressed devices are now dimmed. When the signal is once more removed, the output signal being generated at that time is retained. Another pulse at one of the inputs will set the output to 0. Operation by means of the b On and b Off inputs The light is immediately switched on or off if a rising edge is applied to the b On or b Off inputs. The output value is set to 0 when switching off. TE1000 Version: 2.2.0 35
## Page 36

Programming Memory function In contrast to FB_DALIV2Dimmer2Switch [} 32], where the memory function can be activated or deactivated via the input b Memory Mode On, the memory function is always active in this memory-saving version. This means that the last-set value is adopted as the brightness value when switching on. It does not matter whether the light is switched via the input b On or via the input b Switch Dimm. Comment on the t Switch Over Time parameter If a duration of 0 is specified for the parameter t Switch Over Time, the b Switch Dimm input can only be used to dim the light. Switching on and off is only possible with the b On and b Off inputs. Comment on the n Master Dev Addr parameter The DALI system provides facilities not just for controlling lamps individually, but also for addressing them as groups or through common commands. Since the individual devices may belong to different groups, the individual lamps may have different brightness states before a group or common control command. So that it is nevertheless possible to be clear whether the lamps now are to be switched on or off, a master device is assigned to each group, whose state is followed by the other devices. It is not necessary to specify a master device if the function block is to be used to control a single lamp, e Addr Type = e Addr Type Short. In this case, the n Master Dev Addr parameter has no significance. Inputs VAR_INPUT b Switch Dimm Up : BOOL; b Switch Dimm Down : BOOL; b On : BOOL; b Off : BOOL; b Set Dimm Value : BOOL; n Dimm Value : BYTE; t Switch Over Time : TIME := t#400ms; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; t Cycle Actual Level Master Dev : TIME := t#0s; END_VAR Name Type Description b Switch Dimm Up BOOL Switches or dims the addressed devices up. b Switch Dimm Down BOOL Switches or dims the addressed devices down. b On BOOL Switches the addressed devices to the last output value, or to the value n On Value Without Memory Mode. b Off BOOL Switches the addressed devices off (value 0). b Set Dimm Value BOOL A positive edge at this input sets the addressed devices immediately to the brightness value that is present at input n Dimm Value. If the value of n Dimm Value changes, the brightness value is set immediately to the changed value if the input b Set Dimm Value is FALSE. n Dimm Value BYTE see b Set Dimm Value t Switch Over Time TIME Time for switching between the light on/off and dimming functions for the inputs b Switch Dimm Up and b Switch Dim Down n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations 36 Version: 2.2.0 TE1000
## Page 37

Programming Name Type Description t Cycle Actual Level M TIME Cycle time required to read the current actual value in the aster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.2.7 FB_DALIV2Light The function block FB_DALIV2Light is a simple function block for switching DALI lamps on and off. TE1000 Version: 2.2.0 37
## Page 38

Programming Operation A positive edge applied to the b On input will switch the light to the maximum value (MAX LEVEL [} 88]) of the control gear. If the function block is executed successfully, the b Light output is set to TRUE. Applying a positive edge to the b Off input will switch the light off, and the b Light output will be set to FALSE. If a positive edge is applied to b Toggle, the function block first reads the current light value from the master device, and then decides whether the status of the lamp is on or off. Once this decision has been reached, the lamp is then placed into whatever the other state is, i.e. it is switched from on to off or from off to on. Comment on the n Master Dev Addr parameter The DALI system provides facilities not just for controlling lamps individually, but also for addressing them as groups or through common commands. Since the individual devices may belong to different groups, the individual lamps may have different brightness states before a group or common control command. So that it is nevertheless possible to be clear whether the lamps now are to be switched on or off, a master device is assigned to each group, whose state is followed by the other devices. It is not necessary to specify a master device if the function block is to be used to control a single lamp, e Addr Type = e Addr Type Short. In this case, the n Master Dev Addr parameter has no significance. Inputs VAR_INPUT b On : BOOL; b Off : BOOL; b Toggle : BOOL; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; t Cycle Actual Level Master Dev : TIME := t#0s; END_VAR Name Type Description b On BOOL Switches the addressed devices on (to the value MAX LEVEL [} 88]). b Off BOOL Switches the addressed devices off (value 0). b Toggle BOOL Negates the status of the addressed devices. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations t Cycle Actual Level M TIME Cycle time required to read the current actual value in the aster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 38 Version: 2.2.0 TE1000
## Page 39

Programming Outputs VAR_INPUT b Light : BOOL; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Light BOOL The status of the lamp or group after the function block has been called b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.2.8 FB_DALIV2Light Control The function block FB_DALIV2Light Control is used for daylight-dependent lighting control with up to 30 interpolation points. At the core of this function block is an input/control value table of 30 elements with threshold switching. If the actual value of the brightness reaches the range of an interpolation point (arr Control Table[n].n Actual Value- arr Control Table[n].n Switch Range/2 ... arr Control Table[n].n Actual Value+arr Control Table[n].n Switch Range/2), the control value jumps to the corresponding value arr Control Table[n].n Control Value (see diagram). Coupled to this is a ramp block that runs up the control value over the time t Ramp Time. When switching on with a positive edge at b On, however, the light is initially switched directly to the nearest control value. Only then is the controller activated. While the controller is active, ‘post-starting’ can take place at any time with a positive edge at b On, thus directly controlling the light to the nearest control variable. A positive edge at b Off directly switches off all the controlled lamps. TE1000 Version: 2.2.0 39
## Page 40

Programming The whole range of the table does not have to be used. The first table element that has a 0 as the table end n Switch Range is regarded as the beginning of the unused range. Comment on the n Master Dev Addr parameter The DALI system provides facilities not just for controlling lamps individually, but also for addressing them as groups or through common commands. Since the individual devices may belong to different groups, the individual lamps may have different brightness states before a group or common control command. So that it is nevertheless possible to be clear whether the lamps now are to be switched on or off, a master device is assigned to each group, whose state is followed by the other devices. It is not necessary to specify a master device if the function block is to be used to control a single lamp, e Addr Type = e Addr Type Short. In this case, the n Master Dev Addr parameter has no significance. Inputs VAR_INPUT b Enable : BOOL := TRUE; b On : BOOL; b Off : BOOL; n Actual Value : UINT; t Ramp Time : TIME := t#30s; arr Control Table : ARRAY[1..30] OF ST_DALIV2Control Table; n Options : DWORD := 0; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; t Cycle Actual Level Master Dev : TIME := t#0s; END_VAR Name Type Description b Enable BOOL The inputs b On and b Off are active as long as this input is TRUE. A negative state deactivates the inputs and resets the function block after processing the last necessary DALI 40 Version: 2.2.0 TE1000
## Page 41

Programming Name Type Description commands. No further DALI commands are then output, apart from the cyclic querying of the brightness of the master device. b On BOOL A rising edge switches the controlled lamps directly to the nearest control value. b Off BOOL A rising edge immediately switches off the controlled lamps. n Actual Value UINT Actual value of the brightness t Ramp Time TIME Period during which the control value is controlled to the next value (preset value: 30 s). arr Control Table ARRAY OF Input/control value table: arr Control Table[1] to ST_DALIV2Control Table arr Control Table[30] of the type ST_DALIV2Control Table [} 464] n Options DWORD Reserved for future developments. n Addr BYTE Address of the single device for individual control or of the group for group control n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] t Cycle Actual Level M TIME Cycle time required to read the current control value in the aster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 41
## Page 42

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.2.9 FB_DALIV2Ramp The function block FB_DALIV2Ramp is used to implement a light ramp. A rising edge at the input b On switches the light to the maximum value of the master lamp. A rising edge at input b Off switches the light off. Rising edges at the input b Toggle invert the respective light state. A positive edge at the input b Start allows the function block to dim the light from the current level to n End Level. The time required for this is defined by t Ramp Time. All inputs are only active as long as b Enable is TRUE, otherwise the function block is reset internally and no further DALI commands are issued. Each time the dimming ramp is started, a check is carried out to ensure that the n End Level value is within the permissible limits (MIN LEVEL [} 88] ... MAX LEVEL [} 88]) of the master device. The value "0" is also allowed. Ramp implementation Basically, the function block is designed such that it issues the required number of On And Step Up or Step Down And Off commands at uniform intervals within the specified ramp time. The processing of these step and query commands, however, takes time. The further the ramp time is reduced, the more likely it is that the internally calculated time for a Step Up or Step Down command is no longer sufficient; the actual ramp time becomes longer and longer compared to the set time. In order to be able to realize small ramps, the function of the function block is switched from step mode to Direct Arc Power mode below an internally preset limit value of 11 s ramp time. The DALI command Direct Arc Power Control brings the corresponding lamps from their current value to the set end value within the FADE TIME [} 88]. There are a total of 16 different fade time values, which are stored in the control device of each lamp and can assume the following values: n Fade Time t Fade Time (s) 0 <0.0707 1 0.707 2 1.000 3 1.414 4 2.000 5 2.828 42 Version: 2.2.0 TE1000
## Page 43

Programming n Fade Time t Fade Time (s) 6 4.000 7 5.657 8 8.000 9 11.314 10 16.000 11 22.627 12 32.000 13 45.255 14 64.000 15 90.510 The next value for the ramp that is set at the function block is taken from the table and programmed for all control gears to be controlled. At 6 s, step 7 = 5.657 s would apply, for example. The same value would also be used for a ramp time of 5 s. Precise timing would then no longer be possible. After successful completion of the ramp control, the value that the master device had before the time setting is transferred back to all control gears. During the ramp, the output value n Actual Level Master Dev is output as an internally calculated value so as not to burden the DALI bus with constant query commands. This calculation is based on the difference between start and end value and the selected ramp time. Since it is a calculated value, it can be subject to errors caused by rounding and command delays and should only be used as a guide. After completion of the ramp the brightness is queried directly and the output value is exact again. Comment on the n Master Dev Addr parameter The DALI system provides facilities not just for controlling lamps individually, but also for addressing them as groups or through common commands. Since the individual devices may belong to different groups, the individual lamps may have different brightness states before a group or common control command. So that it is nevertheless possible to be clear whether the lamps now are to be switched on or off, a master device is assigned to each group, whose state is followed by the other devices. It is not necessary to specify a master device if the function block is to be used to control a single lamp, e Addr Type = e Addr Type Short. In this case, the n Master Dev Addr parameter has no significance. Inputs VAR_INPUT b Enable : BOOL := TRUE; b On : BOOL; b Off : BOOL; b Toggle : BOOL; b Start : BOOL; n End Level : BYTE; t Ramp Time : TIME := t#8s; n Options : DWORD := 0; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; t Cycle Actual Level Master Dev : TIME := t#0s; END_VAR Name Type Description b Enable BOOL The b On, b Off, b Toggle and b Start inputs are active as long as this input is TRUE. A negative state deactivates the inputs and resets the function block after processing the last necessary DALI commands. No further DALI commands are then output, apart from the cyclic querying of the brightness of the master device. b On BOOL A rising edge directly switches the controlled lamps to the maximum value of the master lamp. b Off BOOL A rising edge immediately switches off the controlled lamps. TE1000 Version: 2.2.0 43
## Page 44

Programming Name Type Description b Toggle BOOL A rising edge immediately switches the controlled lamps off if the master lamp is not switched off and switches them on if the master lamp is off. b Start BOOL If a rising edge is applied to this input, the light is dimmed up or down respectively from the current value (the master device is decisive here) to n End Level. The time required for this is defined by t Ramp Time. The dimming procedure can be interrupted at any time by b On, b Off or b Toggle. n End Level BYTE Target value of the dimming procedure. (Valid value range:0 or MIN LEVEL [} 88] ... MAX LEVEL [} 88]) t Ramp Time TIME Ramp time, see b Start. (Preset value: 8 seconds) n Options DWORD Reserved for future developments. n Addr BYTE Address of the single device for individual control or of the group for group control n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] t Cycle Actual Level M TIME Cycle time required to read the current actual value in the aster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). 44 Version: 2.2.0 TE1000
## Page 45

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.2.10 FB_DALIV2Sequencer The function block FB_DALIV2Sequencer is used to implement light sequences with up to 50 interpolation points. The core of this function block is a ramp block that drives over an adjustable time to individual brightness values defined in a table and then remains at this brightness value for a similarly definable time. After the dwell time the next value is then driven to. As already mentioned, the table arr Sequence Table consists of 50 entries with the values for n Target Value (target value), t Ramp Time (time taken to reach the target value) and t Prolong Time (dwell time at the target value). It is not absolutely necessary to use all 50 values. A 0 entry of all 3 values marks the end of a sequence. Beyond that it is possible using the n Start Index input to have a light sequence begin at any desired place in the table. This allows several different light sequences to be programmed even within the 50 entries, the sequences being separated from one another by 0 entry elements: TE1000 Version: 2.2.0 45
## Page 46

Programming Over the course of time sequence 1, for example, looks like the following (n Start Index=1, n Options.bit0=TRUE, see below for explanation): 46 Version: 2.2.0 TE1000
## Page 47

Programming Beyond that the function block can be switched "normally" on and off (On: maximum value of the lamps, Off: 0) and switched back and forth between "On" and "Off" using the b Toggle input. However, none of the command inputs is active unless the b Enable input is TRUE. If it is reset to FALSE, no more commands are accepted and the light value retains its current state – even from a ramp. As explained at the beginning, this function block is based on the FB_DALIV2Ramp [} 42]. The ramp block tries to map the set ramp time as accurately as possible. Nevertheless it is necessary to query data from the DALI control gears both once and cyclically, which takes a different amount of time depending on the set PLC cycle time. Therefore inaccuracies in the ramp time cannot be ruled out. Inputs VAR_INPUT b Enable : BOOL := TRUE; b On : BOOL; b Off : BOOL; b Toggle : BOOL; b Start : BOOL; n Start Index : USINT := 0; arr Sequence Table : ARRAY [1..n Max Sequence Values] OF ST_DALIV2Sequence Table; n Options : DWORD := 0; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE := 0; t Cycle Actual Level Master Dev : TIME := t#0s; END_VAR Name Type Description b Enable BOOL The b On, b Off, b Toggle and b Start inputs are active as long as this input is TRUE. A negative state deactivates the inputs and resets the function block. b On BOOL A rising edge directly switches n Actual Level Master Device to the maximum value. b Off BOOL A rising edge immediately switches n Actual Level Master Device to “0”. TE1000 Version: 2.2.0 47
## Page 48

Programming Name Type Description b Toggle BOOL Switches the light state back and forth respectively between On (maximum value) and Off (0). b Start BOOL A positive edge starts a light sequence from the beginning defined under n Start Index. n Start Index USINT see b Start. arr Sequence Table Light value table with the associated ramp and dwell times (see ST_DALIV2Sequence Table [} 466]) n Options DWORD Parameterization input. The setting (or non-setting) of the individual bits of this variable of the type DWORD has the following effect: Bit Description 0 not set: The function block ceases its activity following the expiry of a sequence. A new positive edge at b Start would be necessary for a sequence restart. set: Following the expiry of a sequence, the function block automatically continues at the point defined at n Start Index. 1..31 -- reserved for future options -- Name Type Description n Addr BYTE Address of the single device for individual control or of the group for group control e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations t Cycle Actual Level M TIME Cycle time required to read the current actual value in the aster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; n Actual Index : USINT; b Light : BOOL; b Sequence Active : BOOL; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) 48 Version: 2.2.0 TE1000
## Page 49

Programming Name Type Description n Actual Index USINT Reference to the current element in the sequence table. Once a sequence is finished (b Sequence Active = FALSE, see below), this output becomes "0". b Light BOOL This output is set as long as n Actual Level Master Dev is greater than "0". b Sequence Active BOOL On processing a sequence this output is set to TRUE. b Busy BOOL This output is always active as long as the processing of a command (b On, b Off, b Toggle or ramp) is active. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.2.11 FB_DALIV2Stairwell Dimmer The function block FB_DALIV2Stairwell Dimmer is used to control stairwell lighting. A rising edge at input b Switch switches the light to the value n Presence Value. A falling edge on b Switch starts or restarts a timer with the runtime t Presence Duration. On expiry of this timer the controlled lamps are dimmed within the time t Fade Time to the value n Prolong Value. This value is maintained for the duration t Prolong Duration. Following which the light is switched off. A positive edge at input b Off switches the light off immediately, another rising edge at input b Switch switches the light on again at any time - even during the dimming and waiting times. Each time the light is switched on, a check is carried out to ensure that the values n Presence Value and n Prolong Value are within the permissible limits (MIN LEVEL ... MAX LEVEL) of the master device. The value "0" is also allowed. It is also possible that n Presence Value is smaller than n Prolong Value or that both values are identical. Comment on the n Master Dev Addr parameter The DALI system provides facilities not just for controlling lamps individually, but also for addressing them as groups or through common commands. Because the individual devices can be members of a variety of groups, it can happen that, prior to the issue of a group or common control command, the individual lamps have different brightness levels. So that it is nevertheless possible to be clear whether the lamps now are to TE1000 Version: 2.2.0 49
## Page 50

Programming be switched on or off, a master device is assigned to each group, whose state is followed by the other devices. It is not necessary to specify a master device if the function block is to be used to control a single lamp, e Addr Type = e Addr Type Short. In this case, the n Master Dev Addr parameter has no significance. Inputs VAR_INPUT b Enable : BOOL := TRUE; b Switch : BOOL; b Off : BOOL; n Presence Value : BYTE; n Prolong Value : BYTE; t Presence Duration : TIME := t#30s; t Fade Off Duration : TIME := t#10s; t Prolong Duration : TIME := t#20s; n Options : DWORD := 0; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Master Dev Addr : BYTE; t Cycle Actual Level Master Dev : TIME := t#0s; END_VAR Name Type Description b Enable BOOL The inputs b On and b Off are active as long as this input is TRUE. A negative state deactivates the inputs and resets the function block after processing the last necessary DALI commands. No further DALI commands are then output, apart from the cyclic querying of the brightness of the master device. b Switch BOOL With a rising edge: the controlled lamps are switched directly to Presence Value. With a falling edge: start of the presence time (see diagram). b Off BOOL Immediately switches off the controlled lamps. n Presence Value BYTE Value to which the controlled lamps are to be switched during the presence time. (Valid value range:0 or MIN LEVEL [} 88] ... MAX LEVEL [} 88] -preset value: 254). n Prolong Value BYTE Value to which the controlled lamps are to be switched during the dwell time. (Valid value range:0 or MIN LEVEL [} 88] ... MAX LEVEL [} 88] -preset value: 200). 50 Version: 2.2.0 TE1000
## Page 51

Programming Name Type Description t Pesence Duration TIME Duration of the presence time for which the controlled lamps are switched to n Presence Value after a falling edge at b Switch. (Preset value: 30 seconds). t Fade Off Duration TIME Time duration in which the brightness value is controlled from n Presence Value to n Prolong Value. (Preset value: 10 seconds). t Prolong Duration TIME Duration of the dwell time. (Preset value: 20 seconds) n Options DWORD Reserved for future developments. n Addr BYTE Address of the single device for individual control or of the group for group control e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Master Dev Addr BYTE The address of the master device (reference device) for group and common switching operations t Cycle Actual Level M TIME Cycle time required to read the current actual value in the aster Dev background (see ACTUAL DIM LEVEL [} 88]). So that the dimming of the lamps is not disturbed, reading always has the lowest priority. If the value is set to 0, reading is prohibited. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT n Actual Level Master Dev : BYTE; b Busy : BOOL; b Cycle Active : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description n Actual Level Master BYTE Current output value of the master device (always the Dev respectively addressed device if e Addr Type = e Addr Type Short) b Busy BOOL This output is always set when a change of light is active, i.e. on, off and ramp. Start and target value are irrelevant. This output would also be set in the case of a ramp, for example, from 100 to 100 in 10 s. b Cycle Active BOOL When the function block is activated, the output is set and remains active until the cycle has been completed or the lamps have been switched off. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 51
## Page 52

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.3 Settings Function blocks Name Description FB_DALIV2Get Settings [} 52] Function block for reading all device data of all control gears in a DALI line. FB_DALIV2Get Settings Single Device [} 54] Function block for reading all device data of a control gear in a DALI line. FB_DALIV2Set Settings [} 57] Function block for setting all device data of all control gears in a DALI line. 4.1.1.1.3.1 FB_DALIV2Get Settings This function block FB_DALIV2Get Settings reads the variables (MIN LEVEL, MAX LEVEL, FADE TIME, ...) of all control gears within a DALI line and saves them in a structure of type ST_DALIV2Device Settings [} 465]. Applying a positive edge to the b Start input starts the function block, and the output b Busy goes TRUE. A check is first made as to whether a control gear is present at all. If this is the case, then the b Present bit is set in the corresponding structure (see ST_DALIV2Device Settings [} 465]), after which the settings of the control gear are read out one by one and written in the associated variables in the structure. If it is found that a device is not available, the reading is skipped and work continues with the next device. The structure index here reflects the address of the device. In other words, data for the device with short address 0 is located at arr DALIDevice Settings[0], and so on through to the device with short address 63 having its data at arr DALIDevice Settings[63]. If a read error occurs when reading from a device, the corresponding bit in n Errors is set for the respective structure without the function block itself switching to error mode. The following table shows which bit is set in the variable n Errors when an error occurs during the reading of a variable from a control gear. Bit Error 0 An error occurred whilst attempting to seek the control gear. 1 Error whilst reading the variable ACTUAL DIM LEVEL [} 88]. 2 Error whilst reading the variable POWER ON LEVEL [} 88]. 3 Error whilst reading the variable SYSTEM FAILURE LEVEL [} 88]. 4 Error whilst reading the variable MIN LEVEL [} 88]. 5 Error whilst reading the variable MAX LEVEL [} 88]. 6 Error whilst reading the variable FADE RATE [} 88]. 52 Version: 2.2.0 TE1000
## Page 53

Programming Bit Error 7 Error whilst reading the variable FADE TIME [} 88]. 8 Error whilst reading the variable RANDOM ADDRESS [} 88]. 9 Error whilst reading the variables GROUP 0-7 [} 88] and GROUP 8-15 [} 88]. 10 Error whilst reading the variables SCENE 0 [} 88] to SCENE 15 [} 88]. 11 Error whilst reading the variable STATUS INFORMATION [} 88]. 12 Error whilst reading the variable VERSION NUMBER [} 88]. 13 Error whilst reading the variable DEVICE TYPE [} 88]. 14 Error whilst reading the variable PHYSICAL MIN LEVEL [} 88]. After processing the function block, the output b Busy changes from TRUE to FALSE. Processing this function block can take several seconds, depending on how many control gears are connected. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Options : DWORD; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. b Cancel BOOL A positive edge at this input will disable the function block and hence abort the reading of the variables. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Options DWORD Options for reading the variables (see table). The individual constants must be linked with OR operators. Constant Description DALIV2_OPTION_ACTUAL_DIM_LEVEL The variable ACTUAL DIM LEVEL [} 88] is read. DALIV2_OPTION_POWER_ON_LEVEL The variable POWER ON LEVEL [} 88] is read. DALIV2_OPTION_SYSTEM_FAILURE_LEVEL The variable SYSTEM FAILURE LEVEL [} 88] is read. DALIV2_OPTION_MIN_LEVEL The variable MIN LEVEL [} 88] is read. DALIV2_OPTION_MAX_LEVEL Die Variable MAX LEVEL [} 88] is read. DALIV2_OPTION_FADE_RATE_FADE_TIME The variables FADE RATE [} 88] und FADE TIME [} 88] are read. DALIV2_OPTION_RANDOM_ADDRESS The variable RANDOM ADDRESS [} 88] is read. DALIV2_OPTION_GROUPS The variables GROUP 0-7 [} 88] and GROUP 8-15 [} 88] are read. DALIV2_OPTION_SCENE_LEVELS The variables SCENE 0 [} 88] to SCENE 15 [} 88] are read. DALIV2_OPTION_STATUS_INFORMATION The variable STATUS INFORMATION [} 88] is read. DALIV2_OPTION_VERSION_NUMBER The variable VERSION NUMBER [} 88] is read. DALIV2_OPTION_DEVICE_TYPE The variable DEVICE TYPE [} 88] is read. DALIV2_OPTION_PHYSICAL_MIN_LEVEL The variable PHYSICAL MIN LEVEL [} 88] is read. DALIV2_OPTION_DONT_CLEAR_DEVICE_SETTIN The variable arr DALIDevice Settings is not deleted GS before reading. TE1000 Version: 2.2.0 53
## Page 54

Programming Constant Description DALIV2_OPTION_ALL All variables are read. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; arr DALIDevice Settings : ARRAY [0..63] OF ST_DALIV2Device Settings; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). arr DALIDevice Settin ARRAY OF Reference to an array with 64 elements. The settings of gs ST_DALIV2Device Settings each individual DALI control gear are stored in this variable. [} 465] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Current Short Addr : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Current Short Addr BYTE Short address of the current control gear from which an attempt is being made to read the variables. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.1.3.2 FB_DALIV2Get Settings Single Device 54 Version: 2.2.0 TE1000
## Page 55

Programming In contrast to the function block FB_DALIV2Get Settings [} 52], the function block FB_DALIV2Get Settings Single Device reads the variables (MIN LEVEL, MAX LEVEL, FADE TIME, ...) from only one specific device and saves them in a structure of type ST_DALIV2Device Settings [} 465]. Applying a positive edge to the input b Start starts the function block, and the output b Busy goes TRUE. The settings of all control gears are then read sequentially and written into the respective variables of the structure. If a read error occurs when reading from a device, the element n Errors is set for the respective structure without the function block itself switching to error mode. The following table shows which bit is set in the variable n Errors when an error occurs during the reading of a variable from a control gear. Bit Error 0 An error occurred whilst attempting to seek the control gear. 1 Error whilst reading the variable ACTUAL DIM LEVEL [} 88]. 2 Error whilst reading the variable POWER ON LEVEL [} 88]. 3 Error whilst reading the variable SYSTEM FAILURE LEVEL [} 88]. 4 Error whilst reading the variable MIN LEVEL [} 88]. 5 Error whilst reading the variable MAX LEVEL [} 88]. 6 Error whilst reading the variable FADE RATE [} 88]. 7 Error whilst reading the variable FADE TIME [} 88]. 8 Error whilst reading the variable RANDOM ADDRESS [} 88]. 9 Error whilst reading the variables GROUP 0-7 [} 88] and GROUP 8-15 [} 88]. 10 Error whilst reading the variables SCENE 0 [} 88] to SCENE 15 [} 88]. 11 Error whilst reading the variable STATUS INFORMATION [} 88]. 12 Error whilst reading the variable VERSION NUMBER [} 88]. 13 Error whilst reading the variable DEVICE TYPE [} 88]. 14 Error whilst reading the variable PHYSICAL MIN LEVEL [} 88]. After processing the function block, the output b Busy changes from TRUE to FALSE. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; n Addr : BYTE; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Options : DWORD; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. b Cancel BOOL A positive edge at this input will disable the function block and hence abort the reading of the variables. n Addr BYTE The address of the device whose values are to be read. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Options DWORD Options for reading the variables (see table). The individual constants must be linked with OR operators. Constant Description DALIV2_OPTION_ACTUAL_DIM_LEVEL The variable ACTUAL DIM LEVEL [} 88] is read. DALIV2_OPTION_POWER_ON_LEVEL The variable POWER ON LEVEL [} 88] is read. DALIV2_OPTION_SYSTEM_FAILURE_LEVEL The variable SYSTEM FAILURE LEVEL [} 88] is read. DALIV2_OPTION_MIN_LEVEL The variable MIN LEVEL [} 88] is read. TE1000 Version: 2.2.0 55
## Page 56

Programming Constant Description DALIV2_OPTION_MAX_LEVEL Die Variable MAX LEVEL [} 88] is read. DALIV2_OPTION_FADE_RATE_FADE_TIME The variables FADE RATE [} 88] und FADE TIME [} 88] are read. DALIV2_OPTION_RANDOM_ADDRESS The variable RANDOM ADDRESS [} 88] is read. DALIV2_OPTION_GROUPS The variables GROUP 0-7 [} 88] and GROUP 8-15 [} 88] are read. DALIV2_OPTION_SCENE_LEVELS The variables SCENE 0 [} 88] to SCENE 15 [} 88] are read. DALIV2_OPTION_STATUS_INFORMATION The variable STATUS INFORMATION [} 88] is read. DALIV2_OPTION_VERSION_NUMBER The variable VERSION NUMBER [} 88] is read. DALIV2_OPTION_DEVICE_TYPE The variable DEVICE TYPE [} 88] is read. DALIV2_OPTION_PHYSICAL_MIN_LEVEL The variable PHYSICAL MIN LEVEL [} 88] is read. DALIV2_OPTION_DONT_CLEAR_DEVICE_SETTIN The variable st DALIDevice Settings is not deleted GS before reading. DALIV2_OPTION_ALL All variables are read. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; st DALIDevice Settings : ST_DALIV2Device Settings; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). st DALIDevice Setting ST_DALIV2Device Settings Reference to a structure: The settings of the DALI control s gear are stored in this variable. [} 465] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 56 Version: 2.2.0 TE1000
## Page 57

Programming 4.1.1.1.3.3 FB_DALIV2Set Settings The function block FB_DALIV2Set Settings initializes the variables (MIN LEVEL, MAX LEVEL, FADE TIME, ...) of all control gears of a DALI line with the values that are stored in a structure of type ST_DALIV2Device Settings [} 465]. Applying a positive edge to the input b Start starts the function block, and the output b Busy goes TRUE. The system first checks whether the bit b Present is set in the respective structure (see ST_DALIV2Device Settings [} 465]). If this is the case, all control gear variables that are not read-only are initialized with the respective values of the structure. The structure index here reflects the address of the control gear. In other words, data for the device with short address 0 is located at arr DALIDevice Settings[0], and so on through to the control gear with short address 63 having its data at arr DALIDevice Settings[63]. If a write error occurs for a device, the element n Errors is set for the respective structure without the function block itself switching to error mode. The following table shows which bit is set in the variable n Errors when an error occurs during the writing of a variable to a control gear. Bit Error 2 Error whilst writing the variable POWER ON LEVEL [} 88]. 3 Error whilst writing the variable SYSTEM FAILURE LEVEL [} 88]. 4 Error whilst writing the variable MIN LEVEL [} 88]. 5 Error whilst writing the variable MAX LEVEL [} 88]. 6 Error whilst writing the variable FADE RATE [} 88]. 7 Error whilst writing the variable FADE TIME [} 88]. 9 Error whilst writing the variables GROUP 0-7 [} 88] and GROUP 8-15 [} 88]. 10 Error whilst writing the variables SCENE 0 [} 88] to SCENE 15 [} 88]. After processing the function block, the output b Busy changes from TRUE to FALSE. Processing this function block can take several seconds, depending on how many control gears are connected. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Options : DWORD; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. b Cancel BOOL A positive edge at this input will disable the function block and hence abort the initialization of the variable. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Options DWORD Options for writing the variables (see table). The individual constants must be linked with OR operators. TE1000 Version: 2.2.0 57
## Page 58

Programming Constant Description DALIV2_OPTION_POWER_ON_LEVEL The variable POWER ON LEVEL [} 88] is initialized. DALIV2_OPTION_SYSTEM_FAILURE_LEVEL The variable SYSTEM FAILURE LEVEL [} 88] is initialized. DALIV2_OPTION_MIN_LEVEL The variable MIN LEVEL [} 88] is initialized. DALIV2_OPTION_MAX_LEVEL The variable MAX LEVEL [} 88] is initialized. DALIV2_OPTION_FADE_RATE The variable FADE RATE [} 88] is initialized. DALIV2_OPTION_FADE_TIME The variable FADE TIME [} 88] is initialized. DALIV2_OPTION_GROUPS The variables GROUP 0-7 [} 88] and GROUP 8-15 [} 88] are initialized. DALIV2_OPTION_SCENE_LEVELS The variables SCENE 0 [} 88] to SCENE 15 [} 88] are initialized. DALIV2_OPTION_ALL All variables are initialized. DALIV2_OPTION_PUSH_DALI_COMMANDS The buffer containing the feedback messages from the control gears is not read. Hence, writing becomes faster, but errors are not recognized. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; arr DALIDevice Settings : ARRAY [0..63] OF ST_DALIV2Device Settings; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). arr DALIDevice Settin ARRAY OF Reference to an array with 64 elements. The settings of gs ST_DALIV2Device Settings each individual DALI control gear are stored in this variable. [} 465] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Current Short Addr : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Current Short Addr BYTE Short address of the current control gear from which an attempt is being made to read the variables. 58 Version: 2.2.0 TE1000
## Page 59

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.2 Part 103 (control units) 4.1.1.2.1 Addressing Function blocks Name Description FB_DALIV2x Addressing Int Randomaddressing [} 59] Addresses the control units (sensors) at random. The internal addressing function of the Bus Terminal is used for this purpose. FB_DALIV2x Change Address List [} 60] This function block can be used to change the short addresses of several control units. 4.1.1.2.1.1 FB_DALIV2x Addressing Int Random Addressing The function block FB_DALIV2x Addressing Int Random Addressing addresses the control devices (sensors) at random. The user has no influence on which control device is assigned which short address. Short addresses are allocated in ascending order. Applying a positive edge to the b Start input starts the function block, and the output b Busy goes TRUE. The terminal now addresses all control devices independently. If all control devices are addressed, the output b Busy goes back to FALSE. The output variable n Addressed Devices provides information on how many control devices were assigned a short address. Depending on the number of connected control devices, processing of this function block can take several minutes. Inputs VAR_INPUT b Start : BOOL; n Start With Short Address : BYTE := 0; n Options : DWORD := DALIV2_OPTION_OPTICAL_FEEDBACK; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Start With Short Addr BYTE Short address assigned to the first control device (0 ... 63). ess n Options DWORD Options for addressing control devices (see table). The individual constants must be linked with OR operators. e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) TE1000 Version: 2.2.0 59
## Page 60

Programming Constant Description DALIV2_OPTION_COMPLETE_NEW_INSTALLATIO All control devices receive a new address, even N those that already have a short address. DALIV2_OPTION_OPTICAL_FEEDBACK Newly addressed control devices receive the DALI command IDENTIFY DEVICE once the short address has been assigned. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Addressed Devices : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Addressed Devices BYTE If addressing has been completed (b Busy is FALSE), then the number of addressed DALI control devices is shown at this output. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.1.2.1.2 FB_DALIV2x Change Address List The function block FB_DALIV2x Change Address List can be used to change the short addresses of several DALI control devices. 60 Version: 2.2.0 TE1000
## Page 61

Programming A list of the control devices for which the short address is to be changed is transferred in the array arr Change Address List of type ST_DALIV2Change Address List [} 464]. The list has 64 entries from 0 to 63. Each entry contains a variable n Old Address and n New Address with which the address assignment is parameterized. The end of the list is programmed with a 255 entry at n Old Address, so that the whole list does not necessarily have to be filled in. If this entry is missing, however, then all entries are accepted. When the function block is started (positive edge on b Start), the list end is first determined on the basis of the described entry and afterwards the valid list range is examined for the following false entries: • Address entries > 63 • Double address entry on the original page n Old Address (would not make sense) • Double address entry on the target page n New Address (leads to double assignment of an address and, hence, to errors) The function block then determines the internal long addresses of the DALI devices on the basis of the short addresses and enters them respectively to the parameters n Random Address High, n Random Address Middle and n Random Address Low in the list. If an error occurs during these queries, this leads to a false entry for the respective device in the list element n Errors (see ST_DALIV2Change Address List [} 464]). The further sequence in the function block now depends on the option DALIV2_OPTION_SAFE_ADDRESSING (input n Options). If it is set, secure re-addressing takes place: first, all short addresses of the selected DALI devices are deleted. Then, all required new address status requests are sent to the DALI line. Two cases are now possible: • If a device responds to this request, the desired new address has already been assigned elsewhere. The previously “deleted” DALI devices are programmed with their old addresses and an error message is output. • If no devices respond to this status query, then the previously “deleted” DALI devices are programmed with the desired new addresses. The reprogramming is checked afterwards in both cases. If an error occurs during deletion, during the status query or during the reprogramming, this leads to a false entry for the respective device in the list element n Errors (see ST_DALIV2Change Address List [} 464]). If the option DALIV2_OPTION_SAFE_ADDRESSING (input n Options) is not set, then the deletion of the short addresses and the status query for the presence of desired new addresses are omitted and the new addresses are programmed directly. This is possible because programming takes place via the long address determined beforehand. Reprogramming is not verified in this case. The individual bits in the list element n Errors have the following meaning: Bit Error 0 Error whilst reading the high byte of the long address (n Random Address High). 1 Error whilst reading the middle byte of the long address (n Random Address Middle). 2 Error whilst reading the low byte of the long address (n Random Address Low). 3 Error whilst deleting a short address. 4 Error whilst verifying a short address. 5 Error whilst programming a short address. 6 The value of the variable n Old Address is equal to the value of the variable n New Address The entry in the list is ignored (Tc2_DALI from v3.6.10.0). Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority [} 462] := e DALIV2Command Priority High; n Options : DWORD := 0; e Data Frame Type : E_DALIV2Data Frame Type [} 463] := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. TE1000 Version: 2.2.0 61
## Page 62

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Options DWORD Options for writing the variables (see table). The individual constants must be linked with OR operators. e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Constant Description DALIV2_OPTION_SAFE_ADDRESSING Safe addressing: Old short addresses are deleted, the new ones are checked to see if they already exist and reprogramming is verified. Inputs/outputs VAR_IN_OUT arr Change Address List : ARRAY [0..63] OF ST_DALIV2Change Address List; st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description arr Change Address Li ARRAY A reference to the list containing the short addresses to be st changed st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 62 Version: 2.2.0 TE1000
## Page 63

Programming 4.1.1.3 Part 202 (emergency lighting) Function blocks Name Description FB_DALIV2Emergency Lighting DT [} 63] This function block is for the duration test of a DALI emergency lighting device. At the end of the test the results are written over a FIFO buffer (IN-OUT variable fb String Ring Buffer), which in turn is read by the function block FB_DALIV2File Logging into a file. FB_DALIV2Emergency Lighting FT [} 65] This function block is for the function test of a DALI emergency lighting device. At the end of the test the results are written over a FIFO buffer (IN-OUT variable fb String Ring Buffer), which in turn is read by the function block FB_DALIV2File Logging into a file. FB_DALIV2File Logging [} 67] This function block reads the FIFO buffers (IN-OUT variable fb String Ring Buffer) described in function blocks FB_DALIV2Emergency Lighting FT and FB_DALIV2Emergency Lighting DT and writes the contents to a log file. FB_DALIV2Get Settings Type01 [} 68] This function block reads the variables (BATTERY CHARGE, DURATION TEST RESULT, LAMP EMERGENCY TIME…) from all emergency lighting control gears in a DALI line and stores them in a structure. FB_DALIV2Set Settings Type01 [} 71] This function block initializes the variables (EMERGENCY LEVEL, FUNCTION TEST DELAY TIME, DURATION TEST DELAY TIME…) of all emergency lighting control gears in a DALI line with the values that are stored in a structure. 4.1.1.3.1 FB_DALIV2Emergency Lighting DT The function block FB_DALIV2Emergency Lighting DT is used for the duration test of a DALI emergency lighting device. At the end of the test, the test results are written to a FIFO buffer (IN-OUT variable fb String Ring Buffer), which in turn is read into a file by the function block FB_DALIV2File Logging. Events that hinder or interrupt the test are displayed in addition to the result message at the b Error and n Error ID outputs. The following events prevent the execution of a duration test: • The device operates in automatic duration test mode, i.e. a test interval is programmed in the device. • The device is currently executing a test or a test is automatically pending (function test or duration test). • The emergency battery is not completely charged. • The device is not in emergency standby ("normal mode") at the start of the test. Events that interrupt an active duration test include the following: • The device has not reached the duration test mode after the test has started. TE1000 Version: 2.2.0 63
## Page 64

Programming • The test was not completed correctly, after the test start and a certain delay time the device is eventually neither in test mode nor (back) in emergency standby mode ("normal mode"). • A DALI command was incorrectly processed. • The timeout has expired. Inputs VAR_INPUT b Start : BOOL; b Stop : BOOL; n Addr : BYTE; s Controller : STRING(20); s Line Name : STRING(10); s Description : STRING(20); s Location : STRING(20); st Date Time : TIMESTRUCT; t Timeout : TIME := t#120m; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. b Stop BOOL If a duration test has been successfully started, the emergency mode [} 250] and the emergency status [} 250] are internally cyclically queried in order to assess when the test is completed and whether errors have occurred during the test. A positive edge at the input b Stop aborts the duration test in precisely this phase and records a corresponding message in the log file. This is useful if it is only necessary to assess whether the emergency lighting runs for a certain time (until the time of stopping). n Addr BYTE Address of the device to be tested s Controller STRING Controller to which the DALI device belongs. Serves the description in the log file. s Line Name STRING Line to which the DALI device belongs. Serves the description in the log file. s Description STRING Further supplementary description of the device in the log file s Location STRING Description of the installation location st Date Time TIMESTRUCT Input for current date and time t Timeout TIME Time within which the test must be completed. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; fb String Ring Buffer : FB_Mem Ring Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). fb String Ring Buffer FB_Mem Ring Buffer Reference to the FIFO buffer in which the log entries are stored. It is not possible for the log function block to write data to a file as long as that file is open. 64 Version: 2.2.0 TE1000
## Page 65

Programming Outputs VAR_INPUT t Elapsed Test Time : TIME; n Emergency Mode : BYTE; n Emergency Status : BYTE; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description t Elapsed Test Time TIME Test duration. The time output is set to 0 by a rising edge at b Start and then counts up as long as the function block is active. With a falling edge at b Busy, the output retains its current value so that the test duration is still available even after the function block has been processed. n Emergency Mode BYTE During the test, the presently internally queried emergency mode [} 250] of the DALI device is output at this output. n Emergency Status BYTE the same applies to emergency status [} 250] b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE if an error, as described above, occurs during the execution of the test. This output is reset on restarting a test. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.3.2 FB_DALIV2Emergency Lighting FT The function block FB_DALIV2Emergency Lighting FT is used for the function test of a DALI emergency lighting device. At the end of the test, the test results are written to a FIFO buffer (IN-OUT variable fb String Ring Buffer), which in turn is read into a file by the function block FB_DALIV2File Logging. Events that hinder or interrupt the test are displayed in addition to the result message at the b Error and n Error ID outputs. The following events prevent the execution of a function test: • The device operates in automatic function test mode, i.e. a test interval is programmed in the device. • The device is currently executing a test or a test is automatically pending (function test or duration test). • The device is not in emergency standby ("normal mode") at the start of the test. TE1000 Version: 2.2.0 65
## Page 66

Programming The events that interrupt a function test that has begun include: • The device has not reached the function test mode after the test has started. • The test has not been completed correctly, i.e. the device is neither in test mode nor (back) in emergency standby mode (“normal mode”) at some point after the test start and a certain delay time. • A DALI command was incorrectly processed. • The timeout has expired. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; s Controller : STRING(20); s Line Name : STRING(10); s Description : STRING(20); s Location : STRING(20); st Date Time : TIMESTRUCT; t Timeout : TIME := t#120m; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE Address of the device to be tested s Controller STRING Controller to which the DALI device belongs. Serves the description in the log file. s Line Name STRING Line to which the DALI device belongs. Serves the description in the log file. s Description STRING Further supplementary description of the device in the log file s Location STRING Description of the installation location st Date Time TIMESTRUCT Input for current date and time t Timeout TIME Time within which the test must be completed. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; fb String Ring Buffer : FB_Mem Ring Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). fb String Ring Buffer FB_Mem Ring Buffer Reference to the FIFO buffer in which the log entries are stored. It is not possible for the log function block to write data to a file as long as that file is open. Outputs VAR_INPUT t Elapsed Test Time : TIME; n Emergency Mode : BYTE; n Emergency Status : BYTE; b Busy : BOOL; 66 Version: 2.2.0 TE1000
## Page 67

Programming b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description t Elapsed Test Time TIME Test duration. The time output is set to 0 by a rising edge at b Start and then counts up as long as the function block is active. With a falling edge at b Busy, the output retains its current value so that the test duration is still available even after the function block has been processed. n Emergency Mode BYTE During the test, the presently internally queried emergency mode [} 250] of the DALI device is output at this output. n Emergency Status BYTE the same applies to emergency status [} 250] b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE if an error, as described above, occurs during the execution of the test. This output is reset on restarting a test. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.3.3 FB_DALIV2File Logging The function block FB_DALIV2File Logging reads the FIFO buffers written in the function blocks FB_DALIV2Emergency Lighting FT and FB_DALIV2Emergency Lighting DT (IN-OUT variable fb String Ring Buffer) and writes the contents to a log file. Inputs VAR_INPUT b Start : BOOL; s Path Name : STRING; s Net Id : STRING; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. s Path Name STRING Contains the path and file name for the buffer file to be opened s Net Id STRING A string containing the network address of the Twin CAT computer where the buffer file is to be written or read can be specified here. For the local computer an empty string may be specified. TE1000 Version: 2.2.0 67
## Page 68

Programming s Path Name: The path can only point to the local file system on the computer. This means that network paths cannot be specified here. Inputs/outputs VAR_IN_OUT fb String Ring Buffer : FB_Mem Ring Buffer; END_VAR Name Type Description fb String Ring Buffer FB_Mem Ring Buffer Reference to the FIFO buffer in which the log entries are stored. Outputs VAR_OUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated this output is set and remains set until the log buffer is cleared. b Error BOOL If an ADS error should occur during the transmission into the log file, then this output is set after the output b Busy has been reset. n Err Id UDINT Supplies the ADS error number or the command-specific error code (see error codes [} 438]) when the output b Error is set. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.3.4 FB_DALIV2Get Settings Type01 The function block FB_DALIV2Get Settings Type01 reads the variables (BATTERY CHARGE, DURATION TEST RESULT, LAMP EMERGENCY TIME ...) from all emergency lighting control gears on a DALI line and saves them in a structure of type ST_DALIV2Device Settings Type01 [} 465]. Applying a positive edge to the input b Start starts the function block, and the output b Busy goes TRUE. A check is first made as to whether a control gear is present at all. If this is the case, then the b Present bit is set in the corresponding structure (see ST_DALIV2Device Settings Type01 [} 465]), after which the settings of the control gear are read out one by one and written in the associated variables in the structure. If it is found that a device is not available, the reading is skipped and work continues with the next device. The structure index here reflects the address of the device. In other words, data for the device with short address 0 is located at arr DALIDevice Settings Type01[0], and so on through to the device with short address 63 having its data at arr DALIDevice Settings Type01[63]. If a read error occurs when reading from a device, the 68 Version: 2.2.0 TE1000
## Page 69

Programming corresponding bit in n Errors is set for the respective structure without the function block itself switching to error mode. The following table shows which bit is set in the variable n Errors when an error occurs during the reading of a variable from a control gear. Bit Error 0 An error occurred whilst attempting to seek the control gear. 1 Error whilst reading the variable BATTERY CHARGE [} 250] 2 Error whilst reading the variable DURATION TEST RESULT [} 250] 3 Error whilst reading the variable LAMP EMERGENCY TIME [} 250] 4 Error whilst reading the variable LAMP TOTAL OPERATION TIME [} 250] 5 Error whilst reading the variable EMERGENCY LEVEL [} 250] 6 Error whilst reading the variable EMERGENCY MIN LEVEL [} 250] 7 Error whilst reading the variable EMERGENCY MAX LEVEL [} 250] 8 Error whilst reading the variable RATED DURATION [} 250] 9 Error whilst reading the variable FUNCTION TEST DELAY TIME [} 250] 10 Error whilst reading the variable DURATION TEST DELAY TIME [} 250] 11 Error whilst reading the variable FUNCTION TEST INTERVAL [} 250] 12 Error whilst reading the variable DURATION TEST INTERVAL [} 250] 13 Error whilst reading the variable TEST EXECUTION TIMEOUT [} 250] 14 Error whilst reading the variable PROLONG TIME [} 250] 15 Error whilst reading the variable EMERGENCY MODE [} 250] 16 Error whilst reading the variable FEATURES [} 250] 17 Error whilst reading the variable FAILURE STATUS [} 250] 18 Error whilst reading the variable EMERGENCY STATUS [} 250] After processing the function block, the output b Busy changes from TRUE to FALSE. Processing this function block can take several seconds, depending on how many control gears are connected. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority High; n Options : DWORD; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. b Cancel BOOL A positive edge at this input will disable the function block and hence abort the reading of the variables. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Options DWORD Options for reading the variables (see table). The individual constants must be linked with OR operators. Constant Description DALIV2_OPTION_BATTERY_CHARGE The variable BATTERY CHARGE [} 250] is read. DALIV2_OPTION_DURATION_TEST_RESULT The variable DURATION TEST RESULT [} 250] is read. DALIV2_OPTION_LAMP_EMERGENCY_TIME The variable LAMP EMERGENCY TIME [} 250] is read. TE1000 Version: 2.2.0 69
## Page 70

Programming Constant Description DALIV2_OPTION_LAMP_TOTAL_OPERATION_TIM The variable LAMP TOTAL OPERATION TIME [} 250] E is read. DALIV2_OPTION_EMERGENCY_LEVEL The variable EMERGENCY LEVEL [} 250] is read. DALIV2_OPTION_EMERGENCY_MIN_LEVEL The variable EMERGENCY MIN LEVEL [} 250] is read. DALIV2_OPTION_EMERGENCY_MAX_LEVEL The variable EMERGENCY MAX LEVEL [} 250] is read. DALIV2_OPTION_RATED_DURATION The variable RATED DURATION [} 250] is read. DALIV2_OPTION_NEXT_FUNCTION_TEST The variable FUNCTION TEST DELAY TIME [} 250] is read. DALIV2_OPTION_NEXT_DURATION_TEST The variable DURATION TEST DELAY TIME [} 250] is read. DALIV2_OPTION_FUNCTION_TEST_INTERVAL The variable FUNCTION TEST INTERVAL [} 250] is read. DALIV2_OPTION_DURATION_TEST_INTERVAL The variable DURATION TEST INTERVAL [} 250] is read. DALIV2_OPTION_TEST_EXECUTION_TIMEOUT The variable TEST EXECUTION TIMEOUT [} 250] is read. DALIV2_OPTION_PROLONG_TIME The variable PROLONG TIME [} 250] is read. DALIV2_OPTION_EMERGENCY_MODE The variable EMERGENCY MODE [} 250] is read. DALIV2_OPTION_FEATURES The variable FEATURES [} 250] is read. DALIV2_OPTION_FAILURE_STATUS The variable FAILURE STATUS [} 250] is read. DALIV2_OPTION_EMERGENCY_STATUS The variable EMERGENCY STATUS [} 250] is read. DALIV2_OPTION_ALL All variables are read. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; arr DALIDevice Settings Type01 : ARRAY [0..63] OF ST_DALIV2Device Settings Type01; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). arr DALIDevice Settin ARRAY OF Reference to an array with 64 elements. The settings of gs Type01 ST_DALIV2Device Settings T each individual DALI control gear are stored in this variable. ype01 [} 465] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Current Short Addr : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 70 Version: 2.2.0 TE1000
## Page 71

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Current Short Addr BYTE Short address of the current control gear from which an attempt is being made to read the variables. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.1.3.5 FB_DALIV2Set Settings Type01 This function block initializes the variables (EMERGENCY LEVEL, FUNCTION TEST DELAY TIME, DURATION TEST DELAY TIME…) of all emergency lighting control gears in a DALI line with the values that are stored in a structure of type ST_DALIV2Device Settings Type01 [} 465]. Applying a positive edge to the input b Start starts the function block, and the output b Busy goes TRUE. The system first checks whether the b Present bit is set in the respective structure (see ST_DALIV2Device Settings Type01 [} 465]). If this is the case, all control gear variables that are not read-only are initialized with the respective values of the structure. The structure index here reflects the address of the control gear. In other words, data for the device with short address 0 is located at arr DALIDevice Settings Type01[0], and so on through to the control gear with short address 63 having its data at arr DALIDevice Settings Type01[63]. If a write error occurs for a device, the element n Errors is set for the respective structure without the function block itself switching to error mode. The following table shows which bit is set in the variable n Errors when an error occurs during the writing of a variable to a control gear. Bit Error 5 Error whilst writing the variable EMERGENCY LEVEL [} 250] 9 Error whilst writing the variable FUNCTION TEST DELAY TIME [} 250] 10 Error whilst writing the variable DURATION TEST DELAY TIME [} 250] 11 Error whilst writing the variable FUNCTION TEST INTERVAL [} 250] 12 Error whilst writing the variable DURATION TEST INTERVAL [} 250] 13 Error whilst writing the variable TEST EXECUTION TIMEOUT [} 250] 14 Error whilst writing the variable PROLONG TIME [} 250] When the function block has been processed, the output b Busy changes from TRUE to FALSE. Processing this function block can take several seconds, depending on how many control gears are connected. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority High; n Options : DWORD; END_VAR TE1000 Version: 2.2.0 71
## Page 72

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. b Cancel BOOL A positive edge at this input will disable the function block and hence abort the reading of the variables. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Options DWORD Options for reading the variables (see table). The individual constants must be linked with OR operators. Constant Description DALIV2_OPTION_EMERGENCY_LEVEL The variable EMERGENCY LEVEL [} 250] is initialized. DALIV2_OPTION_NEXT_FUNCTION_TEST The variable FUNCTION TEST DELAY TIME [} 250] is initialized. DALIV2_OPTION_NEXT_DURATION_TEST The variable DURATION TEST DELAY TIME [} 250] is initialized. DALIV2_OPTION_FUNCTION_TEST_INTERVAL The variable FUNCTION TEST INTERVAL [} 250] is initialized. DALIV2_OPTION_DURATION_TEST_INTERVAL The variable DURATION TEST INTERVAL [} 250] is initialized. DALIV2_OPTION_TEST_EXECUTION_TIMEOUT The variable TEST EXECUTION TIMEOUT [} 250] is initialized. DALIV2_OPTION_PROLONG_TIME The variable PROLONG TIME [} 250] is initialized. DALIV2_OPTION_ALL All variables are initialized. DALIV2_OPTION_PUSH_DALI_COMMANDS The buffer containing the feedback messages from the control gears is not read. Hence, writing becomes faster, but errors are not recognized. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; arr DALIDevice Settings Type01 : ARRAY [0..63] OF ST_DALIV2Device Settings Type01; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). arr DALIDevice Settin ARRAY OF Reference to an array with 64 elements. The settings of gs Type01 ST_DALIV2Device Settings T each individual DALI control gear are stored in this variable. ype01 [} 465] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Current Short Addr : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 72 Version: 2.2.0 TE1000
## Page 73

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Current Short Addr BYTE Short address of the current control gear from which an attempt is being made to read the variables. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2 Low-Level commands 4.1.2.1 Base Function blocks Name Description FB_DALIV2Get Event Data [} 73] Filters out an event specified by the event scheme. FB_DALIV2x Send DALICommand [} 75] This function block is for the general sending of a DALI command, defined by command number and, if necessary, transfer parameter. Replaces the function block FB_DALIV2Send DALICommand. FB_KL6811Communication [} 77] Reads the DALI commands from the buffers sequentially and forwards them to the KL6811. FB_KL6811Config New [} 79] This function block can be used to configure the KL6811. FB_KL6821Communication [} 82] Reads the DALI commands from the buffers sequentially and forwards them to the KL6821. FB_KL6821Config [} 84] This function block can be used to configure the KL6821. 4.1.2.1.1 FB_DALIV2Get Event Data The function block FB_DALIV2Get Event Data filters out an event specified by the event scheme. Each event sent by a DALI device contains two fields that provide information about the event source. These two fields are a combination of the short address, instance number, instance type, instance group or device group. The recipient of the event must know which address scheme is used to send the data. For each event that is to be received and processed further, an instance of FB_DALIV2Get Event Data must be created and configured with the correct event scheme. TE1000 Version: 2.2.0 73
## Page 74

Programming Inputs VAR_INPUT b Enable : BOOL; e Event Scheme : E_DALIV2Event Scheme := e DALIV2Event Scheme Device Instance; n Address Info01 : BYTE; n Address Info02 : BYTE; END_VAR Name Type Description b Enable BOOL Enables the function block. If this input is set to FALSE, no further events are output. e Event Scheme E_DALIV2Event Scheme The event scheme defines the address information required for filtering the desired event. n Address Info01 BYTE (see table below) n Address Info02 BYTE (see table below) e Event Scheme n Address Info01 n Address Info02 e DALIV2Event Scheme Instance Instance type (0-31) Instance number (0-31) e DALIV2Event Scheme Device Short address (0-63) Instance type (0-31) e DALIV2Event Scheme Device Insta Short address (0-63) Instance number (0-31) nce e DALIV2Event Scheme Device Grou Device group (0-31) Instance type (0-31) p e DALIV2Event Scheme Instance Gro Instance group (0-31) Instance type (0-31) up Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b New Data : BOOL; n Event Info : WORD; END_VAR Name Type Description b New Data BOOL If an event was received that corresponds to the event scheme and address information, this output is set to TRUE for one PLC cycle. n Event Info BOOL If the output b New Data is TRUE, further information about the event can be found at this output. The exact meaning depends on the device type and is described in the respective Part 3xx of IEC 62386. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 74 Version: 2.2.0 TE1000
## Page 75

Programming 4.1.2.1.2 FB_DALIV2x Send DALICommand The function block FB_DALIV2x Send DALICommand is used for the general sending of a DALI command, defined by command number and - if necessary - transfer parameter. Moreover, it is possible to set whether the command is sent twice in succession and whether to wait for a response. The latter can be used, for example, to realize a fast sequence of step-up commands. In contrast to the function block FB_DALIV2Send DALICommand [} 447], this function block is also able to control DALI control devices (sensors). Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Command : INT := 0; n Parameter01 : BYTE := 0; n Parameter02 : DINT := 0; b Waiting For DALISlave Response : BOOL := FALSE; b Repeat Command : BOOL := FALSE; b Suppress Response Buffer : BOOL := FALSE; n Device Type : BYTE := 0; n Options : DWORD := 0; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type16Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the device e Inst Addr Type E_DALIV2Inst Addr Type Defines the meaning of the variable n Inst Addr for addressing the instance (e.g. by instance number, instance type,...). e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Command INT Number of the DALI command to be sent TE1000 Version: 2.2.0 75
## Page 76

Programming Name Type Description n Command01 BYTE Parameter for the value transfer n Command02 DINT Parameter for the value transfer b Waiting For DALISla BOOL If FALSE, the system does not wait for the response from ve Response the DALI device. Its application makes no sense in connection with any kind of query command. b Repeat Command BOOL Decides whether the command is to be sent twice in succession. b Suppress Response BOOL If TRUE, the internal buffer is not filled with the response Buffer from the function block FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). n Device Type BYTE Identifier for the device type (see table below) n Options DWORD Reserved for future developments. e Data Frame Type E_DALIV2Data Frame Typ Output format of the DALI command e (e DALIV2Data Frame Type24Bit, e DALIV2Data Frame Type16Bit or e DALIV2Data Frame Type Osram) Identifiers for the device type Value Description 0 Standard device 1 Device for emergency lighting [} 248] 2 Device for discharge lamps [} 292] 3 Device for low-voltage halogen lamps 4 Device for dimming incandescent lamps 5 Device for converting digital signals into DC signals 6 Device for light emitting diodes (LEDs) [} 306] 7 Device for switching functions 8 Device for controlling the color/color temperature [} 336] 9 Sequencer Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; arr Response Data : ARRAY [0..3] OF BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 76 Version: 2.2.0 TE1000
## Page 77

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). arr Response Data ARRAY OF BYTE The value received from the DALI device if a query command was invoked. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.1.3 FB_KL6811Communication The function blocks for the DALI commands do not directly access the process image of the KL6811, but store the individual DALI commands in three different buffers. The function block FB_KL6811Communication sequentially reads the DALI commands from these three buffers and forwards the DALI commands to the KL6811. This prevents multiple function blocks accessing the KL6811 process image simultaneously. Each of these three buffers is processed with a different priority (high, medium or low). The parameter e Command Priority [} 462], which is available for most function blocks, can be used to influence the priority with which the respective DALI command is processed by the function block FB_KL6811Communication. All buffers in which the DALI commands are stored are associated with a variable of type ST_DALIV2Command Buffer. For each KL6811 there is one instance of the function block FB_KL6811Communication and one variable of type ST_DALIV2Command Buffer. If possible, the function block FB_KL6811Communication should be called in a separate, faster task. The extent to which the buffers are utilized can be determined from the outputs of the function block. Three arrays are output for this in which each element (0, 1 or 2) represents one of the three buffers (high, middle or low). If you detect regular overflow for one of the three buffers, you should consider the following: • How heavily are the individual PLC tasks utilized? The Twin CAT System Manager offers various appropriate utilities for the analysis. • Try to reduce the cycle time of the task in which the function block FB_KL6811Communication is called. The value should not exceed 6 ms. Ideally it should be 2 ms. • Check the cycle time of the PLC task in which the function blocks for the individual DALI commands are called. These values should be between 10 ms and 60 ms. • If possible avoid polling (regular reading) of values. Only read values when they are actually required. • Distribute the individual control gears evenly over several DALI lines. Overall data throughput is increased by the fact that several DALI lines are processed simultaneously during each PLC cycle. TE1000 Version: 2.2.0 77
## Page 78

Programming Inputs VAR_INPUT b Reset Maximum Demand Counter : BOOL; b Reset Overflow Counter : BOOL; END_VAR Name Type Description b Reset Maximum De BOOL A positive edge resets the stored value of the maximum mand Counter command buffer utilization, arr Buffer Maximum Demand Meter (0 - 100 %, see VAR_OUTPUT). b Reset Overflow Cou BOOL A positive edge resets the stored value of the number of nter command buffer overflows, arr Buffer Overflow Counter (see VAR_OUTPUT). Inputs/outputs VAR_IN_OUT st DALIIn Data : ST_KL6811In Data; st DALIOut Data : ST_KL6811Out Data; st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st DALIIn Data ST_KL6811In Data [} 467] Structure in the input process image of the KL6811. It is used for communication from the KL6811 to the PLC. st DALIOut Data ST_KL6811Out Data [} 467] Structure in the output process image of the KL6811. It is used for communication from the PLC to the KL6811. st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : BYTE; arr Buffer Demand Meter : ARRAY [0..2] OF BYTE; arr Buffer Maximum Demand Meter : ARRAY [0..2] OF BYTE; arr Buffer Overflow Counter : ARRAY [0..2] OF UINT; b Line Is Busy : BOOL; b Line Is Initialized : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). arr Buffer Demand Me ARRAY Demand of the respective buffer (0 - 100 %) ter arr Buffer Maximum D ARRAY Previous maximum demand of the respective buffer (0 - emand Meter 100 %) arr Buffer Overflow Co ARRAY Number of buffer overflows so far unter 78 Version: 2.2.0 TE1000
## Page 79

Programming Name Type Description b Line Is Busy BOOL This output is set as long as the function block FB_KL6811Communication [} 77] is active. b Line Is Initialized BOOL If the function block is called up for the first time (e.g. when starting the controller), initialization is carried out. No DALI commands can be processed during this time. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.1.4 FB_KL6811Config New The function block FB_KL6811Config New is used to configure the KL6811. The configuration is executed when the PLC program starts, or it can be triggered by a positive edge at the input b Configurate. The parameters are stored in the respective registers of the KL6811 in a fail-safe manner. In addition, some general information, such as the firmware version, is read from the KL6811. This function block replaces FB_KL6811Config from library version 3.6.2.0 Example: The function block is called in the same task as the function block FB_KL6811Communication [} 77]. TE1000 Version: 2.2.0 79
## Page 80

Programming The function block FB_KL6811Config New is linked to the process image of the KL6811. Once the configuration is complete, the function block FB_KL6811Communication New receives the process values of the KL6811. DALI commands cannot be sent during configuration. Sample: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_dali/Resources/4515401995.zip Inputs VAR_INPUT b Configurate : BOOL := FALSE; e Operation Mode : E_DALIV2Operation Mode := e D ALIV2Operation Mode DALI; b Disable Internal Power Supply : BOOL := FALSE; b Enable Counting Devices After Startup : BOOL := FALSE; n Options : DWORD := 0; END_VAR Name Type Description b Configurate BOOL Configuration of the bus terminal is started by a positive edge at this input. e Operation Mode E_DALIV2Operation Mode Defines the operation mode of the terminal (DALI or DSI). Corresponds to register 32, bits 12 to 15 of the bus [} 464] terminal. b Disable Internal Pow BOOL If this input is TRUE, the internal DALI power supply of the er Supply terminal is disabled by the configuration. Corresponds to register 32, bit 3 of the bus terminal. b Enable Counting De DWORD If this input is TRUE, the number of DALI devices is vices After Startup counted when the terminal starts. Corresponds to register 32, bit 4 of the bus terminal. n Options DWORD Reserved for future developments. Inputs/outputs VAR_IN_OUT st In Data Terminal : ST_KL6811In Data; st Out Data Terminal : ST_KL6811Out Data; st In Data : ST_KL6811In Data; st Out Data : ST_KL6811Out Data; END_VAR 80 Version: 2.2.0 TE1000
## Page 81

Programming Name Type Description st In Data Terminal ST_KL6811In Data [} 467] Reference to the structure for communication with the KL6811. st Out Data Terminal ST_KL6811Out Data [} 467] Reference to the structure for communication with the KL6811. st In Data ST_KL6811In Data [} 467] Reference to the structure for communication with the function block FB_KL6811Communication [} 77]. st Out Data ST_KL6811Out Data [} 467] Reference to the structure for communication with the function block FB_KL6811Communication [} 77]. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Terminal Description : WORD; n Firmware Version : WORD; s Description : STRING; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Terminal Descriptio WORD Contains the terminal name (e.g. 6811). Corresponds to n register 8 of the bus terminal. n Firmware Version WORD Contains the firmware version. Corresponds to register 9 of the bus terminal. s Description STRING Terminal name and firmware version as string (e.g. "Terminal KL6811 / Firmware 2H"). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 81
## Page 82

Programming 4.1.2.1.5 FB_KL6821Communication The function blocks for the DALI commands do not directly access the process image of the DALI Bus Terminal, but store the individual DALI commands in three different buffers. The function block FB_KL6821Communication sequentially reads the DALI commands from these three buffers and forwards the DALI commands to the KL6821. This prevents several function block accessing the process image of the bus terminal at the same time. Each of these three buffers is processed with a different priority (high, medium or low). The parameter e Command Priority, which is available for most function blocks, can be used by the PLC library user to influence the priority with which the respective DALI command is processed by the function block FB_KL6821Communication. All buffers in which the DALI commands are stored are associated with a variable of type ST_DALIV2Command Buffer. For each KL6821 there is one instance of the function block FB_KL6821Communication and one variable of type ST_DALIV2Command Buffer. If possible, the function block FB_KL6821Communication should be called in a separate, faster task. The extent to which the buffers are utilized can be determined from the outputs of the function block. Three arrays are output for this in which each element (0, 1 or 2) represents one of the three buffers (high, middle or low). If you find that one of the three buffers overflows on a regular basis, you should consider the following measures: How heavily are the individual PLC tasks utilized? The Twin CAT System Manager offers various appropriate utilities for the analysis. • Try to reduce the cycle time of the task in which the function block FB_KL6821Communication is called. The value should not exceed 6 ms. Ideally it should be 2 ms. • Check the cycle time of the PLC task in which the function blocks for the individual DALI commands are called. This value should be between 10 ms and 60 ms. • If possible avoid polling (regular reading) of values. Only read values when they are actually required. • Distribute the individual control gears evenly over several DALI lines. Overall data throughput is increased by the fact that several DALI lines are processed simultaneously during each PLC cycle. Inputs VAR_INPUT b Reset Maximum Demand Counter : BOOL; b Reset Overflow Counter : BOOL; b Reset Inactive Process Image : BOOL; n Options : DWORD := 0; END_VAR Name Type Description b Reset Maximum De BOOL A positive edge resets the stored value of the maximum mand Counter command buffer utilization, arr Buffer Maximum Demand Meter (0 - 100 %, see VAR_OUTPUT). 82 Version: 2.2.0 TE1000
## Page 83

Programming Name Type Description b Reset Overflow Cou BOOL A positive edge resets the stored value of the number of nter command buffer overflows, arr Buffer Overflow Counter (see VAR_OUTPUT). b Reset Inactive Proce BOOL A positive edge cancels the blocking of the process image ss Image of the terminal. The outputs b Process Image Inactive, b Digital Input1Active and b Digital Input2Active are again set to FALSE. The lock is activated when one of the two digital inputs on the terminal is activated. n Options DWORD Reserved for future developments. Inputs/outputs VAR_IN_OUT st In Data : ST_KL6821In Data; st Out Data : ST_KL6821Out Data; st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st In Data ST_KL6821In Data Structure in the input process image of the KL6821. It is used for communication from the KL6821 to the PLC. When using FB_KL6821Config [} 84], this structure is linked to the parameter st In Data. st Out Data ST_KL6821Out Data Structure in the output process image of the KL6821. It is used for communication from the PLC to the KL6821. When using FB_KL6821Config [} 84], this structure is linked to the parameter st Out Data. st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er the DALI function blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; arr Buffer Demand Meter : ARRAY [0..2] OF BYTE; arr Buffer Maximum Demand Meter : ARRAY [0..2] OF BYTE; arr Buffer Overflow Counter : ARRAY [0..2] OF UINT; b Line Is Busy : BOOL; b Line Is Initialized : BOOL; b Digital Input1Active : BOOL; b Digital Input2Active : BOOL; b Process Image Inactive : BOOL; b Collision Error : BOOL; b Power Supply Error : BOOL; b Short Circuit : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). arr Buffer Demand Me ARRAY OF BYTE Demand of the respective buffer (0 - 100 %) ter TE1000 Version: 2.2.0 83
## Page 84

Programming Name Type Description arr Buffer Maximum D ARRAY OF BYTE Previous maximum demand of the respective buffer (0 - emand Meter 100 %) arr Buffer Overflow Co ARRAY OF BYTE Number of buffer overflows so far unter b Line Is Busy BOOL The output is set as long as the function block FB_KL6821Communication [} 82] is active. b Line Is Initialized BOOL If the function block is called for the first time (e.g. when starting the controller), initialization is carried out. No DALI commands can be processed during this time. b Digital Input1Active BOOL The digital input 1 on the terminal was or is actuated (see also terminal documentation). The output b Process Image Inactive is set and no further DALI commands can be processed by the controller. b Digital Input2Active BOOL The digital input 2 on the terminal was or is actuated (see also terminal documentation). The output b Process Image Inactive is set and no further DALI commands can be processed by the controller. b Process Image Inact BOOL One of the two digital inputs was actuated at the terminal. ive No further DALI commands can be processed by the controller. The blockage must be released again via the input b Reset Inactive Process Image. b Collision Error BOOL A data collision on the DALI bus was detected while a command was sent. b Power Supply Error BOOL The KL6821 has detected an error in the internal DALI power supply. b Short Circuit BOOL Short circuit on the DALI bus Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.1.6 FB_KL6821Config The function block FB_KL6821Config is used to configure the KL6821. The configuration is executed when the PLC program starts, or it can be triggered by a positive edge at the input b Configurate. The parameters are stored in the respective registers of the KL6821 in a fail-safe manner. In addition, some general information, such as the firmware version, is read from the KL6821. Example The function block is called in the same task as the function block FB_KL6821Communication [} 82]. 84 Version: 2.2.0 TE1000
## Page 85

Programming The function block FB_KL6821Config is linked to the process image of the KL6821. Once the configuration is complete, the function block FB_KL6821Communication receives the process values of the KL6821. DALI commands cannot be sent during configuration. Sample: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_dali/Resources/4420035723.zip Inputs VAR_INPUT b Configurate : BOOL := FALSE; e Command KBus Watchdog : E_DALIV2Configuration Commands := e DALIV2Command Do Nothing; e Command DI1Rising Edge : E_DALIV2Configuration Commands := e DALIV2Command Off; e Command DI1Falling Edge : E_DALIV2Configuration Commands := e DALIV2Command Do Nothing; e Command DI2Rising Edge : E_DALIV2Configuration Commands := e DALIV2Command Recall Max Level; e Command DI2Falling Edge : E_DALIV2Configuration Commands := e DALIV2Command Do Nothing; e Power Supply Mode : E_DALIV2Power Supply Mode := e DALIV2Power Supply Mode On; n Options : DWORD := 0; END_VAR Name Type Description b Configurate BOOL Configuration of the bus terminal is started by a positive edge at this input. e Command KBus Wa E_DALIV2Configuration Co Defines the DALI command that is sent as soon as the bus tchdog terminal is no longer addressed via the K-bus. mmands [} 462] e Command DI1Risin E_DALIV2Configuration Co Defines the DALI command that is sent as soon as a rising g Edge edge is detected at input 1 of the bus terminal. mmands [} 462] e Command DI1Fallin E_DALIV2Configuration Co Defines the DALI command that is sent as soon as a falling g Edge edge is detected at input 1 of the bus terminal. mmands [} 462] e Command DI2Risin E_DALIV2Configuration Co Defines the DALI command that is sent as soon as a rising g Edge edge is detected at input 2 of the bus terminal. mmands [} 462] e Command DI2Fallin E_DALIV2Configuration Co Defines the DALI command that is sent as soon as a falling g Edge edge is detected at input 2 of the bus terminal. mmands [} 462] TE1000 Version: 2.2.0 85
## Page 86

Programming Name Type Description e Power Supply Mode E_DALIV2Power Supply Mo Defines the operation mode of the internal DALI power supply. de [} 464] n Options DWORD Reserved for future developments. Inputs/outputs VAR_IN_OUT st In Data Terminal : ST_KL6821In Data; st Out Data Terminal : ST_KL6821Out Data; st In Data : ST_KL6821In Data; st Out Data : ST_KL6821Out Data; END_VAR Name Type Description st In Data Terminal ST_KL6821In Data [} 467] Reference to the structure for communication with the KL6821 st Out Data Terminal ST_KL6821In Data [} 467] Reference to the structure for communication with the KL6821 st In Data ST_KL6821In Data [} 467] Reference to the internal structure for communication with the function block FB_KL6821Communication [} 82] st Out Data ST_KL6821In Data [} 467] Reference to the internal structure for communication with the function block FB_KL6821Communication [} 82] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Terminal Description : WORD; n Firmware Version : WORD; s Description : STRING; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Terminal Descriptio WORD Contains the terminal name (e.g. 6821). Corresponds to n register 8 of the bus terminal. n Firmware Version WORD Contains the firmware version. Corresponds to register 9 of the bus terminal. s Description STRING Terminal name and firmware version as string (e.g. "Terminal KL6821 / Firmware 2H"). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 86 Version: 2.2.0 TE1000
## Page 87

Programming 4.1.2.2 DSI Function blocks Name Description FB_DSIDirect Arc Power Control [} 87] Sends the control value to the DSI lamps via the KL6811. 4.1.2.2.1 FB_DSIDirect Arc Power Control The parameter n Arc Power Level specifies the brightness to which the lamp is switched. n Arc Power Level Comment 0 Lamp is switched off 1 Lamp is switched to the minimum brightness 255 Lamp is switched to the maximum brightness Control gears with a DSI interface do not have a short address. All the control gears on a DSI line receive the same value. The KL6811 must be switched to DSI mode. Details for this can be found in the operating instructions for the KL6811. DSI control gears and DALI control gears cannot be mixed on a line. However, it is possible to operate several KL6811s on one controller, each in different operation modes (DSI/DALI). Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Arc Power Level : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Arc Power Level BYTE Lamp power value (0 ... 255) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77]. TE1000 Version: 2.2.0 87
## Page 88

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3 Part 102 (control gears) 4.1.2.3.1 Variables Every DALI control gear has a certain number of variables (parameters ) from which it is possible to read a variety of information or to modify individual parameters. Name Default value Reset value Scope Size Comment ACTUAL DIM ? 254 0, MIN LEVEL ... 1 byte MAX LEVEL LEVEL [} 89] POWER ON 254 254 1 ... 254 1 byte LEVEL [} 89] SYSTEM FAILURE 254 254 0 ... 255 1 byte LEVEL [} 89] MIN LEVEL PHYSICAL MIN PHYSICAL MIN PHYSICAL MIN 1 byte LEVEL LEVEL LEVEL ... MAX [} 89] LEVEL MAX LEVEL 254 254 MIN LEVEL ... 1 byte 254 [} 89] FADE RATE 7 7 1 ... 15 1 byte [} 89] FADE TIME 0 0 0 ... 15 1 byte [} 90] SHORT ADDRESS 255 No change 0 ... 63, 255 1 byte [} 91] SEARCH FF FF FF FF FF FF 00 00 00 ... FF 3 bytes FF FF ADDRESS [} 91] RANDOM FF FF FF FF FF FF 00 00 00 ... FF 3 bytes FF FF ADDRESS [} 91] 88 Version: 2.2.0 TE1000
## Page 89

Programming Name Default value Reset value Scope Size Comment GROUP 0-7 0 0 0 ... 255 1 byte [} 91] GROUP 8-15 0 0 0 ... 255 1 byte [} 91] SCENE 0 [} 91] 255 255 0 ... 255 1 byte ... ... ... ... ... SCENE 15 [} 91] 255 255 0 ... 255 1 byte STATUS ???? ???? 0?10 0??? 0 ... 255 1 byte read only INFORMATION [} 91] VERSION Manufacturer Manufacturer 0 ... 255 1 byte read only dependent dependent NUMBER [} 92] DEVICE TYPE Manufacturer Manufacturer 0 ... 255 1 byte read only dependent dependent [} 92] PHYSICAL MIN Manufacturer Manufacturer 1 ... 254 1 byte read only dependent dependent LEVEL [} 92] ?: undetermined ACTUAL DIM LEVEL This variable contains the current power applied to the lamp. The function block FB_DALIV2Query Actual Level [} 128] can be used to read the value. POWER ON LEVEL When power is supplied to the control gear the lamp is controlled with the power value stored in the variable POWER ON LEVEL. This assumes that the DALI bus has already been supplied with power and is idle. The range of POWER ON LEVEL is limited by the two variables MIN LEVEL and MAX LEVEL. The variable can be read with the function block FB_DALIV2Query Power On Level [} 150] and written with the function block FB_DALIV2Store DTRAs Power On Level [} 455]. SYSTEM FAILURE LEVEL If an error occurs on the DALI bus (the open-circuit voltage remains below the specified level for longer than 500 ms) then the lamp is controlled with the power value from the variable SYSTEM FAILURE LEVEL. If the variable contains 255 (mask) the lamp power will not change. The value range is limited by MIN LEVEL and MAX LEVEL. The variable can be read with the function block FB_DALIV2Query System Failure Level [} 159] and written with the function block FB_DALIV2Store DTRAs System Failure Level [} 459]. MIN LEVEL / MAX LEVEL The ballast internally restricts the value of the output power to the lamp by means of the MIN LEVEL and MAX LEVEL variables. The exceptions to this are power values of 0 (off) and 255 (mask). FADE RATE The FADE RATE specifies the rate at which changes are made (in steps per second) in the value of the lamp's power. This variable has an effect on the commands FB_DALIV2Up [} 126] and FB_DALIV2Down [} 114]. The absolute fade rate is not entered directly, but it is calculated according to the following formula: TE1000 Version: 2.2.0 89
## Page 90

Programming T = absolute fade rate n = value that is stored in the FADE RATE variable The following values result: n absolute fade rate 0 not permitted 1 357.796 steps/s 2 253.000 steps/s 3 178.898 steps/s 4 126.500 steps/s 5 89.449 steps/s 6 63.250 steps/s 7 44.725 steps/s 8 31.625 steps/s 9 22.362 steps/s 10 15.813 steps/s 11 11.181 steps/s 12 7.906 steps/s 13 5.591 steps/s 14 3.953 steps/s 15 2.795 steps/s FADE TIME The FADE TIME specifies the time allowed for the current lamp power to be changed to the requested value. In the case of a lamp that is switched off, the pre-heating and ignition time is not included in the fade time. The function blocks FB_DALIV2Direct Arc Power Control [} 113] and FB_DALIV2Go To Scene [} 116] are affected. The absolute fade time is not entered directly, but it is calculated according to the following formula: T = absolute fade time n = value that is stored in the FADE TIME variable The following values result: n absolute fade time 0 < 0.707 s 1 0.707 s 2 1.000 s 3 1.414 s 4 2.000 s 5 2.828 s 6 4.000 s 7 5.657 s 8 8.000 s 9 11.314 s 10 16.000 s 11 22.627 s 90 Version: 2.2.0 TE1000
## Page 91

Programming n absolute fade time 12 32.000 s 13 45.255 s 14 64.000 s 15 90.510 s SHORT ADDRESS The short address is stored in this variable. A valid short address lies in the range between 0 and 63. The short address is regarded as having been deleted if 255 is written to the variable. The short address can be set with the function block FB_DALIV2Store DTRAs Short Address [} 458]. Calling the function block FB_DALIV2Query Missing Short Address [} 146] queries whether a control gear still does not have a short address. SEARCH ADDRESS The search address is only needed when assigning short addresses. RANDOM ADDRESS The random address, also called the long address, is specified by the manufacturer when the control gears are supplied. The 3-byte random address can be read using the function block FB_DALIV2Query Random Address [} 151]. GROUP 0-7 / GROUP 8-15 16 groups exist within a DALI network. Each control gear can belong to one, several or no group. Commands that are to be sent to a group have an effect on all the control gears that belong to that particular group. The function block FB_DALIV2Query Groups [} 136] reads the two 8-bit variables and combines them into a 16-bit value. Each bit indicates whether the control gear belongs to a particular group. SCENE 0-15 Each DALI control gear can store lamp power values for 16 different scenes. There is a value of the lamp power for every scene. If the command for calling up a scene (FB_DALIV2Go To Scene [} 116]) is sent to one device, a group, or to all the devices (broadcast), then each of the affected lamps is set to the saved value. The output is limited by the values of MAX LEVEL, MIN LEVEL and PHYSICAL MIN LEVEL. STATUS INFORMATION The status information contains the most important items describing the status of a control gear. The 8-bit value can be read with the function block FB_DALIV2Query Status [} 158]. The meaning of the individual bits is defined as follows: Bit Description 0 Status of the control gear. 0: OK. 1 Lamp failure. 0: OK. 2 Lamp power on. 0: OFF. 3 Limit value error. 0: the most recently requested lamp power was either between MIN LEVEL and MAX LEVEL or was OFF. 4 Fading completed: 0: fading finished. 1: fading active. 5 Reset status. 0: no. 6 Short address missing. 0: no. 7 Power supply fault. 0: No. A reset or a lamp power control command has been received since the last switch-on. TE1000 Version: 2.2.0 91
## Page 92

Programming VERSION NUMBER The version number corresponds to the version number of the IEC standard in accordance with which the ballast was developed and manufactured. The version number can only be read, and is specified by the manufacturer of the ballasts. The major version (n Major Version) and the minor version (n Minor Version) can each have a value in the range from 0 to 15 (4 bits). DEVICE TYPE The value can be read with the function block FB_DALIV2Query Device Type [} 134]. The following device types are defined according to the IEC 62386 standard: Value Description 0 Standard device 1 Device for emergency lighting. 2 Device for discharge lamps. 3 Device for low-voltage halogen lamps. 4 Device for dimming incandescent lamps. 5 Device for converting digital signals into DC signals. 6 Device for light emitting diodes (LEDs). PHYSICAL MIN LEVEL The lowest physically possible lamp power level is stored by the manufacturer in the variable PHYSICAL MIN LEVEL. The value can only be read, for which the function block FB_DALIV2Query Physical Minimum Level [} 147] is used. 4.1.2.3.2 Application-related expansion commands Function blocks Name Description FB_DALIV2Enable Device Type [} 92] Switching to application-related expansion command. FB_DALIV2Query Extended Version Number [} 94] The EXTENDED VERSION NUMBER [} 250] variable is read from the control gear. FB_DALIV2Start Identification [} 95] Starts a 10-second identification procedure of the control gear. 4.1.2.3.2.1 FB_DALIV2Enable Device Type This command must be sent every time prior to an application extended command. As a result, only those control gears that belong to the corresponding DEVICE TYPE [} 92] respond. The command does not have to be used for device type 0. The following device types are defined according to the IEC 62386 standard: Value Description 0 Standard device 1 Device for emergency lighting [} 248] 2 Device for discharge lamps [} 292] 3 Device for low-voltage halogen lamps 4 Device for dimming incandescent lamps 92 Version: 2.2.0 TE1000
## Page 93

Programming Value Description 5 Device for converting digital signals into DC signals 6 Device for light emitting diodes (LEDs) [} 306] 7 Device for switching functions 8 Device for controlling the color/color temperature [} 336] 9 Sequencer Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Device Type : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Device Type BYTE Identifier for the device type (see table above). Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 93
## Page 94

Programming 4.1.2.3.2.2 FB_DALIV2Query Extended Versionnumber The variable EXTENDED VERSION NUMBER [} 254] is read from the control gear. This command belongs to the application extended commands. These only work if they are preceded by the command Enable Device Type, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Device Type to be activated can be set at the n Device Type input. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Device Type : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Device Type BYTE Identifier for the device type (see table under FB_DALIV2Enable Device Type [} 92]) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Extended Version Number : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 94 Version: 2.2.0 TE1000
## Page 95

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Extended Version N BYTE Extended version number of the control gear umber Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.2.3 FB_DALIV2Start Identification The function block FB_DALIV2Start Identification is used to start a 10-second identification procedure of the control gear. The behavior is specified by the manufacturer. The lamp is usually switched on and off according to a certain pattern. This command belongs to the application extended commands. These only work if they are preceded by the command Enable Device Type, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Device Type to be activated can be set at the n Device Type input. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Device Type : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Device Type BYTE Identifier for the device type (see table under FB_DALIV2Enable Device Type [} 92]) TE1000 Version: 2.2.0 95
## Page 96

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.3 Configuration Function blocks Name Description FB_DALIV2Add To Group [} 97] Inserts one or more control gears into a group. FB_DALIV2Remove From Group [} 98] Remove one or more control gears from a group. FB_DALIV2Remove From Scene [} 99] Removes the control gear from the scene. FB_DALIV2Reset [} 100] All variables are reset to their reset values. FB_DALIV2Set Fade Rate [} 101] Writes a value to variable FADE RATE [} 88]. FB_DALIV2Set Fade Time [} 111] Writes a value to variable FADE TIME [} 88]. FB_DALIV2Set Max Level [} 104] Writes a value to variable MAX LEVEL [} 88]. FB_DALIV2Set Min Level [} 105] Writes a value to variable MIN LEVEL [} 88]. FB_DALIV2Set Power On Level [} 106] Writes a value to variable POWER ON LEVEL [} 88]. FB_DALIV2Set Scene [} 107] Writes a value as lamp power value in a scene FB_DALIV2Set Short Address [} 109] Control gears receive a (new) short address. FB_DALIV2Set System Failure Level [} 110] Writes a value to variable SYSTEM FAILURE LEVEL [} 88]. FB_DALIV2Store Actual Level In DTR0 [} 111] Writes the current value of the lamp power into the DTR0. 96 Version: 2.2.0 TE1000
## Page 97

Programming 4.1.2.3.3.1 FB_DALIV2Add To Group The function block FB_DALIV2Add To Group is used to add the addressed control gears to the corresponding group (n Group). A valid group number lies in the range between 0 and 15. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Group : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Group BYTE Group number (0…15) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 97
## Page 98

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.3.2 FB_DALIV2Remove From Group The function block FB_DALIV2Remove From Group is used to remove one or more control gears from a group. A valid group number lies in the range between 0 and 15. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Group : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Group BYTE The group from which the control gear is to be removed. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 98 Version: 2.2.0 TE1000
## Page 99

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.3.3 FB_DALIV2Remove From Scene The function block FB_DALIV2Remove From Scene is used to remove one or more control gears from a scene. A valid scene number lies in the range between 0 and 15. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Scene : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Scene BYTE The scene from which the control gear is to be removed. TE1000 Version: 2.2.0 99
## Page 100

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.3.4 FB_DALIV2Reset The function block FB_DALIV2Reset resets all variables of the control gear to the reset values. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group 100 Version: 2.2.0 TE1000
## Page 101

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.3.5 FB_DALIV2Set Fade Rate The function block FB_DALIV2Set Fade Rate writes a value to the variable FADE RATE [} 88]. The range of possible values extends from 1 to 15. TE1000 Version: 2.2.0 101
## Page 102

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Fade Rate : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Fade Rate BYTE Rate of change of the lamp power value. The range of possible values extends from 1 to 15. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 102 Version: 2.2.0 TE1000
## Page 103

Programming 4.1.2.3.3.6 FB_DALIV2Set Fade Time The function block FB_DALIV2Set Fade Time writes a value to the variable FADE TIME [} 88]. The range of possible values extends from 0 to 15. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Fade Time : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Fade Time BYTE Time required for changing the current lamp power value to the required value. The range of possible values extends from 0 to 15. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 103
## Page 104

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.3.3.7 FB_DALIV2Set Max Level The function block FB_DALIV2Set Max Level writes to the variable MAX LEVEL [} 89]. If the value provided is smaller than MIN LEVEL then the value is simply set to MIN LEVEL. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Max Level : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Max Level BYTE Maximum permitted lamp power (0 - 254) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 104 Version: 2.2.0 TE1000
## Page 105

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.3.3.8 FB_DALIV2Set Min Level The function block FB_DALIV2Set Min Level writes to the variable MIN LEVEL [} 89]. If the value provided is larger than MAX LEVEL then the value is simply set to MAX LEVEL. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Min Level : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Min Level BYTE Minimum permitted lamp power (0 - 254) TE1000 Version: 2.2.0 105
## Page 106

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.3.3.9 FB_DALIV2Set Power On Level With the help of the function block FB_DALIV2Set Power On Level, one or more control gears receive a defined switch-on value on the variable POWER ON LEVEL [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Power On Level : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. 106 Version: 2.2.0 TE1000
## Page 107

Programming Name Type Description n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Power On Level BYTE Switch-on value Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.3.3.10 FB_DALIV2Set Scene The function block FB_DALIV2Set Scene saves a lamp power value n Scene Level for a specified scene n Scene. The value range for the scene number extends from 0 to 15. TE1000 Version: 2.2.0 107
## Page 108

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Scene Level : BYTE; n Scene : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Scene Level BYTE Lamp power value for the desired scene n Scene BYTE The scene for which the value of the lamp power should be changed. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 108 Version: 2.2.0 TE1000
## Page 109

Programming 4.1.2.3.3.11 FB_DALIV2Set Short Address The function block FB_DALIV2Set Short Address is used to assign a (new) short address to one or more control gears. Valid short addresses lie in the range between 0 and 63. If 255 is specified as the short address, the short address in the control gear is deleted. If you want to give a short address to a device that does not yet have one, you must transmit the command as a broadcast (e Addr Type = e DALIV2Addr Type Broadcast). This gives all control gears connected to the DALI terminal the short address n New Short Address. This includes the control gears that previously did not have a short address. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n New Short Address : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n New Short Address BYTE New short address (0-63) or mask (255) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 109
## Page 110

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.3.12 FB_DALIV2Set System Failure Level The variable SYSTEM FAILURE LEVEL [} 88] (lamp power value at system error) is written to the control gear. If a fault (such as the absence of the supply voltage) is detected on the DALI bus, the control gear switches the lamp to this power value. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n System Failure Level : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n System Failure Leve BYTE Lamp power value in the event of a system error l Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 110 Version: 2.2.0 TE1000
## Page 111

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.3.3.13 FB_DALIV2Store Actual Level In DTR0 The function block writes the current lamp power value into the DTR0. This does not change the current value of the lamp power. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 111
## Page 112

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.3.4 Power control Function blocks Name Description FB_DALIV2Direct Arc Power Control [} 113] Directly specify the lamp power. FB_DALIV2Down [} 114] Reduce lamp power. FB_DALIV2Enable DAPCSequence [} 115] Start of a Direct Arc Power Control (DAPC) sequence. FB_DALIV2Go To Scene [} 116] Call up a scene. FB_DALIV2Off [} 117] Switch the lamp off. FB_DALIV2On And Step Up [} 119] Switch the lamp on if necessary, and increase the lamp power by one step. FB_DALIV2Recall Max Level [} 120] Set the lamp power to MAX LEVEL [} 88]. FB_DALIV2Recall Min Level [} 121] Set the lamp power to MIN LEVEL [} 88]. FB_DALIV2Step Down [} 122] Reduce the lamp power by one step. FB_DALIV2Step Down And Off [} 123] Reduce the lamp power by one step, and switch the lamp off if appropriate. FB_DALIV2Step Up [} 124] Increase the lamp power by one step. FB_DALIV2Up [} 126] Increase lamp power. 112 Version: 2.2.0 TE1000
## Page 113

Programming 4.1.2.3.4.1 FB_DALIV2Direct Arc Power Control If the parameter n Arc Power Level is outside of MAX VALUE [} 88] or MIN VALUE [} 88], the lamp is switched to the corresponding minimum or maximum value using the function block FB_DALIV2Direct Arc Power Control. If the lamp is switched off, it is switched on by the command. The rate at which the specified setpoint is to be reached is specified by the variable FADE TIME [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Arc Power Level : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Arc Power Level BYTE Lamp power value Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 113
## Page 114

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.4.2 FB_DALIV2Down The lamp is dimmed over a period of 200 ms. If the lamp power has already reached the MIN LEVEL [} 88] value the brightness is not changed. The lamp is not switched off with this command. The rate at which dimming is to take place within the 200 ms is specified by the variable FADE RATE [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 114 Version: 2.2.0 TE1000
## Page 115

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.4.3 FB_DALIV2Enable DAPCSequence This command starts a Direct Arc Power Control (DAPC) sequence. Following this command, Direct Arc Power Control commands must be sent using the function block FB_DALIV2Direct Arc Power Control [} 113]. There must be no more than 200 ms between the individual commands; otherwise the sequence is terminated. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] TE1000 Version: 2.2.0 115
## Page 116

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.4.4 FB_DALIV2Go To Scene This function block sets the lamp power value to the value saved for the scene n Scene. If the control gear does not belong to the scene, the lamp power value is not changed. If the lamp is switched off, it is switched on with the command. The rate at which the lamp power value is to be reached is specified by the variable FADE TIME [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Scene : BYTE; END_VAR 116 Version: 2.2.0 TE1000
## Page 117

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Scene BYTE Scene to be called (0 - 15). Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.4.5 FB_DALIV2Off The function block FB_DALIV2Off switches the DALI lamps off immediately. TE1000 Version: 2.2.0 117
## Page 118

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 118 Version: 2.2.0 TE1000
## Page 119

Programming 4.1.2.3.4.6 FB_DALIV2On And Step Up The function block FB_DALIV2On And Step Up immediately sets the current lamp power value one level higher. If the lamp is switched off then it is switched on and set to MIN LEVEL [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). TE1000 Version: 2.2.0 119
## Page 120

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.4.7 FB_DALIV2Recall Max Level The function block FB_DALIV2Recall Max Level sets the current lamp power value continuously to MAX LEVEL [} 88]. If the lamp is switched off this command will switch it on. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 120 Version: 2.2.0 TE1000
## Page 121

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.4.8 FB_DALIV2Recall Min Level The function block FB_DALIV2Recall Min Level sets the current lamp power value continuously to MIN LEVEL [} 88]. If the lamp is switched off this command will switch it on. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 121
## Page 122

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.4.9 FB_DALIV2Step Down The function block FB_DALIV2Step Down immediately sets the current lamp power value one level lower. The lamps are not switched off by this command. The power is not further reduced if the lamp power has already reached MIN LEVEL [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 122 Version: 2.2.0 TE1000
## Page 123

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.4.10 FB_DALIV2Step Down And Off The function block FB_DALIV2Step Down And Off immediately sets the current lamp power value one level lower. The lamp is switched off if the power value has already reached MIN LEVEL [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group TE1000 Version: 2.2.0 123
## Page 124

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.4.11 FB_DALIV2Step Up The function block FB_DALIV2Step Up immediately sets the current lamp power value one level higher. The lamps are not switched on by this command. The power is not further increased if the lamp power has already reached MAX LEVEL [} 88]. 124 Version: 2.2.0 TE1000
## Page 125

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 125
## Page 126

Programming 4.1.2.3.4.12 FB_DALIV2Up The lamp is dimmed brighter for 200 ms with the function block FB_DALIV2Up. If the lamp power has already reached the MAX LEVEL [} 88] the brightness is not changed. The lamp is not switched on with this command. The rate at which dimming is to take place within 200 ms is specified by the variable FADE RATE [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 126 Version: 2.2.0 TE1000
## Page 127

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5 Queries Function blocks Name Description FB_DALIV2Query Actual Level [} 128] Read the ACTUAL DIM LEVEL [} 88] variable (current lamp power). FB_DALIV2Query Content DTR0 [} 129] Read out the DTR0 (Data Transfer Register 0). FB_DALIV2Query Content DTR1 [} 130] Read out the DTR1 (Data Transfer Register 1). FB_DALIV2Query Content DTR2 [} 131] Read out the DTR2 (Data Transfer Register 2). FB_DALIV2Query Control Gear Present [} 133] Query whether the control gear is ready to operate. FB_DALIV2Query Device Type [} 134] Query the device type. FB_DALIV2Query Fade Time Fade Rate [} 135] Read out the variables FADE RATE [} 88] and FADE TIME [} 88]. FB_DALIV2Query Groups [} 136] Query the group membership. FB_DALIV2Query Groups0Up To7 [} 138] Query the group membership (groups 0 to 7). FB_DALIV2Query Groups8Up To15 [} 139] Query the group membership (groups 8 to 15). FB_DALIV2Query Lamp Failure [} 140] Query whether a lamp has failed. FB_DALIV2Query Lamp Power On [} 141] Query as to whether the lamp is switched on. FB_DALIV2Query Limit Error [} 142] Query whether the last lamp power value could be used or not. FB_DALIV2Query Max Level [} 144] Read the MAX LEVEL [} 88] variable (maximum permitted lamp power). FB_DALIV2Query Min Level [} 145] Read the MIN LEVEL [} 88] variable (minimum permitted lamp power). FB_DALIV2Query Missing Short Address [} 146] Query as to whether the control gear does not have a short address. FB_DALIV2Query Physical Min Level [} 147] Read the PHYSICAL MIN LEVEL [} 88] variable (lowest lamp power that is physically possible). FB_DALIV2Query Power Failure [} 148] Query whether the control gear has received a reset or a lamp power control command since it was switched on or not. FB_DALIV2Query Power On Level [} 150] Read the POWER ON LEVEL [} 88] variable (initial lamp power when switched on). FB_DALIV2Query Random Address [} 151] Read the RANDOM ADDRESS [} 88] variable (direct address/long address). FB_DALIV2Query Random Address H [} 152] Read the high byte of the variable RANDOM ADDRESS [} 88] (direct address/long address). FB_DALIV2Query Random Address L [} 153] Read the low byte of the variable RANDOM ADDRESS [} 88] (direct address/long address). TE1000 Version: 2.2.0 127
## Page 128

Programming Name Description FB_DALIV2Query Random Address M [} 154] Read the middle byte of the variable RANDOM ADDRESS [} 88] (direct address/long address). FB_DALIV2Query Reset State [} 155] Query whether the control gear is in the reset state. FB_DALIV2Query Scene Level [} 157] Query the lamp power value of a scene. FB_DALIV2Query Status [} 158] Read the STATUS INFORMATION [} 88] variable. FB_DALIV2Query System Failure Level [} 159] Read the SYSTEM FAILURE LEVEL [} 88] variable (the power value for the lamp in the presence of a system error). FB_DALIV2Query Version Number [} 160] Read the VERSION NUMBER [} 88] variable. FB_DALIV2Read Memory Location [} 162] Reading an 8-bit value from the control gear memory. 4.1.2.3.5.1 FB_DALIV2Query Actual Level The function block FB_DALIV2Query Actual Level reads the ACTUAL DIM LEVEL [} 88] variable (current lamp power) from the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 128 Version: 2.2.0 TE1000
## Page 129

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Actual Level : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Actual Level BYTE Lamp power Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.2 FB_DALIV2Query Content DTR0 The function block FB_DALIV2Query Content DTR0 reads the content of DTR0 (Data Transfer Register 0) from the control gear. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] TE1000 Version: 2.2.0 129
## Page 130

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Content DTR0 : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Content DTR0 BYTE Contents of DTR0 (Data Transfer Register0) Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.3.5.3 FB_DALIV2Query Content DTR1 The function block FB_DALIV2Query Content DTR1 reads the content of DTR1 (Data Transfer Register 1) from the control gear. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; 130 Version: 2.2.0 TE1000
## Page 131

Programming e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Content DTR1 : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Content DTR1 BYTE Contents of the DTR1 (Data Transfer Register) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.4 FB_DALIV2Query Content DTR2 TE1000 Version: 2.2.0 131
## Page 132

Programming The function block FB_DALIV2Query Content DTR2 reads the content of DTR2 (Data Transfer Register 2) from the control gear. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Content DTR2 : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Content DTR2 BYTE Contents of DTR2 (Data Transfer Register 2) 132 Version: 2.2.0 TE1000
## Page 133

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.5 FB_DALIV2Query Control Gear Present The function block FB_DALIV2Query Control Gear Present provides information on whether a specific control gear is ready to operate. Using this command, it can easily be determined whether or not any control gears at all are connected to a DALI line. To do this, the function block with the parameter e Addr Type = e DALIV2Addr Type Broadcast is called. If the output b Ballast is FALSE and output n Error is 0, there is no control gear connected to the DALI line. If the output n Error is 0 and the output b Ballast is TRUE, there is exactly one control gear connected to the DALI line. If several control gears are connected, n Error will return 5 (several control gears have responded). In this case it is irrelevant whether or not the control gears have short addresses. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Ballast : BOOL END_VAR TE1000 Version: 2.2.0 133
## Page 134

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Ballast BOOL If the output is active, the corresponding control gear is ready to operate. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.3.5.6 FB_DALIV2Query Device Type The function block FB_DALIV2Query Device Type reads the DEVICE TYPE [} 88] from the control gear. The following device types are defined according to the IEC 62386 standard: Value Description 0 Standard device 1 Device for emergency lighting. 2 Device for discharge lamps. 3 Device for low-voltage halogen lamps. 4 Device for dimming incandescent lamps. 5 Device for converting digital signals into DC signals. 6 Device for light emitting diodes (LEDs). Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 134 Version: 2.2.0 TE1000
## Page 135

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Device Type : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Device Type BYTE Identifier for the device type (see table above) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.7 FB_DALIV2Query Fade Time Fade Rate The function block FB_DALIV2Query Fade Time Fade Rate reads the variables FADE TIME [} 88] and FADE RATE [} 88] from the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR TE1000 Version: 2.2.0 135
## Page 136

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Fade Time : BYTE; n Fade Rate : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Fade Time BYTE Fade time (0 to 15) n Fade Rate BYTE Fade rate (1 to 15) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.8 FB_DALIV2Query Groups 136 Version: 2.2.0 TE1000
## Page 137

Programming The function block FB_DALIV2Query Groups reads the variables GROUP 0-7 [} 88] and GROUP 8-15 [} 88] from the control gear and links them to a 16-bit value. Each bit represents one group. Bit 0 represents group 0, while bit 15 represents group 15. If the bit is set, the control gear belongs to the corresponding group. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Groups : WORD; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Groups WORD Group assignment Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 137
## Page 138

Programming 4.1.2.3.5.9 FB_DALIV2Query Groups0Up To7 The function block FB_DALIV2Query Groups0Up To7 reads the GROUP 0-7 [} 88] variable from the control gear and links it to an 8-bit value. Each bit represents one group. Bit 0 group 0 and bit 7 group 7. If the bit is set, the control gear belongs to the corresponding group. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Groups0Up To7 : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 138 Version: 2.2.0 TE1000
## Page 139

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Groups0Up To7 BYTE Group assignment Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.10 FB_DALIV2Query Groups8Up To15 The function block FB_DALIV2Query Groups8Up To15 reads the GROUP 8-15 [} 88] variable from the control gear and links it to an 8-bit value. Each bit represents one group. Bit 0 represents group 8, while bit 7 represents group 15. If the bit is set, the control gear belongs to the corresponding group. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; TE1000 Version: 2.2.0 139
## Page 140

Programming n Error Id : UDINT; n Groups8Up To15 : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Groups8Up To15 BYTE Group assignment Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.11 FB_DALIV2Query Lamp Failure The function block FB_DALIV2Query Lamp Failure provides information on whether a particular control gear has a lamp problem. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 140 Version: 2.2.0 TE1000
## Page 141

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Lamp Failure : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Lamp Failure BOOL If the output is active there has been a lamp failure at the corresponding control gear. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.12 FB_DALIV2Query Lamp Power On The function block FB_DALIV2Query Lamp Power On provides information on whether the lamp is switched on by a specific control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] TE1000 Version: 2.2.0 141
## Page 142

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Lamp Power On : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Lamp Power On BOOL If the output is active the lamp at the corresponding control gear is switched on. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.13 FB_DALIV2Query Limit Error The function block FB_DALIV2Query Limit Error provides information on whether the last lamp power value on a specific control gear was not adhered to because it was above MAX LEVEL [} 88] or below MIN LEVEL [} 88]. 142 Version: 2.2.0 TE1000
## Page 143

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Limit Error : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Limit Error BOOL If the output is active, the last lamp power value cannot be used. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 143
## Page 144

Programming 4.1.2.3.5.14 FB_DALIV2Query Max Level The function block FB_DALIV2Query Max Level reads the variable MAX LEVEL [} 88] (maximum permitted lamp power) from the control gear. This value specifies the upper limit for lamp power commands. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Max Level : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). 144 Version: 2.2.0 TE1000
## Page 145

Programming Name Type Description n Max Level BYTE Maximum permitted lamp power (0 - 254) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.15 FB_DALIV2Query Min Level The variable MIN LEVEL [} 88] (minimum permissible lamp power) is read from the control gear. This value specifies the lower limit for lamp power commands. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Min Level : BYTE; END_VAR TE1000 Version: 2.2.0 145
## Page 146

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Min Level BYTE Minimum permitted lamp power (0 - 254) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.16 FB_DALIV2Query Missing Short Address The function block FB_DALIV2Query Missing Short Address provides information on whether a specific control gear does not have a short address. Using this command, it can be determined whether or not any control gears without a short address are connected to a DALI line. To do this, the function block with the parameter e Addr Type = e DALIV2Addr Type Broadcast is called. If output b Missing Short Address is FALSE and output n Error is 0, all control gears have a valid short address. If the output n Error is 0 and the output b Missing Short Address is TRUE, there is exactly one control gear that has no short address. If several control gears have no short address, n Error will return 5 (several control gears have responded). Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 146 Version: 2.2.0 TE1000
## Page 147

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Missing Short Address : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Missing Short Addre BOOL If the output is active the corresponding control gear does ss not have a short address. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.17 FB_DALIV2Query Physical Min Level The function block FB_DALIV2Query Physical Min Level reads the variable PHYSICAL MIN LEVEL [} 88] (physically lowest possible lamp power) from the control gear. This value can only be read, and is specified by the manufacturer. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR TE1000 Version: 2.2.0 147
## Page 148

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Physical Min Level : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Physical Min Level BYTE Lowest physically possible lamp power (0 - 254) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.18 FB_DALIV2Query Power Failure The function block FB_DALIV2Query Power Failure queries whether the control gear has not received a reset or lamp power control command since it was switched on. 148 Version: 2.2.0 TE1000
## Page 149

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Power Failure : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Power Failure BOOL If the output is active, no lamp power control command has yet been sent to the control gear. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 149
## Page 150

Programming 4.1.2.3.5.19 FB_DALIV2Query Power On Level The function block FB_DALIV2Query Power On Level reads the variable POWER ON LEVEL [} 88] (switch-on lamp power) from the control gear. The lamp switches itself to this power value immediately after the power is connected. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Power On Level : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 150 Version: 2.2.0 TE1000
## Page 151

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Power On Level BYTE Lamp power at switch-on (0 - 254) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.20 FB_DALIV2Query Random Address The variable RANDOM ADDRESS [} 88] is read from the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Random Address : UDINT; END_VAR TE1000 Version: 2.2.0 151
## Page 152

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Random Address UDINT Random address/long address of the control gear Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.21 FB_DALIV2Query Random Address H The high-order byte of the variable RANDOM ADDRESS [} 88] is read from the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 152 Version: 2.2.0 TE1000
## Page 153

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Random Address H : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Random Address H BYTE The high-order byte of the random address/long address Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.22 FB_DALIV2Query Random Address L The function block FB_DALIV2Query Random Address L reads the low-order byte of the variable RANDOM ADDRESS [} 88] from the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] TE1000 Version: 2.2.0 153
## Page 154

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Random Address L : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Random Address L BYTE The low-order byte of the random address/long address Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.23 FB_DALIV2Query Random Address M The function block FB_DALIV2Query Random Address M reads the middle byte of the variable RANDOM ADDRESS [} 88] from the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR 154 Version: 2.2.0 TE1000
## Page 155

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Random Address M : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Random Address M BYTE The middle byte of the random address/long address Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.24 FB_DALIV2Query Reset State The function block FB_DALIV2Query Reset State provides information on whether a specific control gear is in the reset state. TE1000 Version: 2.2.0 155
## Page 156

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Reset State : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Reset State BOOL If the output is active the corresponding control gear is in the reset state. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 156 Version: 2.2.0 TE1000
## Page 157

Programming 4.1.2.3.5.25 FB_DALIV2Query Scene Level The function block FB_DALIV2Query Scene Level reads the lamp power value of the corresponding scene from the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Scene : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Scene BYTE Scene from which the lamp power value is to be read (0 - 15). Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Scene Level : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 157
## Page 158

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Scene Level BYTE Lamp power value of the scene Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.26 FB_DALIV2Query Status The function block FB_DALIV2Query Status reads the variable STATUS INFORMATION [} 88] from the control gear. The status information contains the eight most important status messages of a control gear. The meaning of the individual bits is defined as follows: Bit Description 0 Status of the control gear. 0: OK. 1 Lamp failure. 0: OK. 2 Lamp power on. 0: OFF. 3 Limit value error. 0: the most recently requested lamp power was either between MIN LEVEL and MAX LEVEL or was OFF. 4 Fading completed: 0: fading finished. 1: fading active. 5 Reset status. 0: no. 6 Short address missing. 0: no. 7 Power supply fault. 0: No. A reset or a lamp power control command has been received since the last switch-on. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 158 Version: 2.2.0 TE1000
## Page 159

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Status : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Status BYTE Status information (see table above) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.27 FB_DALIV2Query System Failure Level The variable SYSTEM FAILURE LEVEL [} 88] (lamp power value on system error) is read from the control gear. If a fault (such as the absence of the supply voltage) is detected on the DALI bus, the control gear switches the lamp to this power value. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR TE1000 Version: 2.2.0 159
## Page 160

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n System Failure Level : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n System Failure Leve BYTE Lamp power value in the event of a system error l Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.28 FB_DALIV2Query Version Number 160 Version: 2.2.0 TE1000
## Page 161

Programming The variable VERSION NUMBER [} 88] is read from the control gear. The version number corresponds to the version number of the IEC standard in accordance with which the software and hardware of the control gear has been developed and manufactured. The version number can only be read, and is specified by the manufacturer. The major version (n Major Version) and the minor version (n Minor Version) can each have a value in the range from 0 to 15 (4-bit). Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Major Version : BYTE; n Minor Version : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Major Version BYTE Major version number n Minor Version BYTE Minor version number TE1000 Version: 2.2.0 161
## Page 162

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.5.29 FB_DALIV2Read Memory Location The function block FB_DALIV2Read Memory Location is used to read a byte from the memory of the control gear. The exact memory bank is specified by the parameter n Memory Bank and the address within the memory bank by the parameter n Offset. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Memory Bank : BYTE; n Offset : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Memory Bank BYTE The memory bank to be accessed. n Offset BYTE The address within the memory bank to be accessed. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 162 Version: 2.2.0 TE1000
## Page 163

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Value : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Value BYTE Byte read from the control gear memory Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6 Special commands Function blocks Name Description FB_DALIV2Compare [} 164] The control gear compares its RANDOM ADDRESS [} 88] with the SEARCH ADDRESS [} 88]. FB_DALIV2Initialise [} 165] Starts the addressing of the control gears. FB_DALIV2Physical Selection [} 166] All control gears that receive this command go into physical selection mode. FB_DALIV2Program Short Address [} 167] All the selected control gears save the value n Short Address (SHORT ADDRESS [} 88]) as their short address. FB_DALIV2Query Short Address [} 168] If the RANDOM ADDRESS [} 88] is the same as the SEARCH ADDRESS [} 88] then the control gear sends its short address. FB_DALIV2Randomise [} 169] The control gears generate a new RANDOM ADDRESS [} 88]. FB_DALIV2Search Addr [} 170] This function block sets the SEARCH ADDRESS [} 88]. FB_DALIV2Search Addr H [} 171] This function block sets the upper 8 bits of the 24-bit SEARCH ADDRESS [} 88]. FB_DALIV2Search Addr L [} 172] This function block sets the lower 8 bits of the 24-bit SEARCH ADDRESS [} 88]. FB_DALIV2Search Addr M [} 174] This function block sets the middle 8 bits of the 24-bit SEARCH ADDRESS [} 88]. FB_DALIV2Set DTR0 [} 175] Writes an 8-bit value into the DTR0 of all the control gears. FB_DALIV2Set DTR1 [} 176] Writes an 8-bit value into the DTR1 of all the control gears. TE1000 Version: 2.2.0 163
## Page 164

Programming Name Description FB_DALIV2Set DTR2 [} 177] Writes an 8-bit value into the DTR2 of all the control gears. FB_DALIV2Terminate [} 178] The addressing of all the control gears is terminated. FB_DALIV2Verify Short Address [} 179] If the short address in the control gear is equal to the parameter n Short Address, the output b Answer is set to TRUE. FB_DALIV2Withdraw [} 180] Control gears for which the RANDOM ADDRESS [} 88] is the same as the SEARCH ADDRESS [} 88] may no longer respond to the command FB_DALIV2Compare [} 164]. FB_DALIV2Write Memory Location [} 181] Writes an 8-bit value into the memory of a control gear. Access to the memory must first be enabled with the command FB_DALIV2Enable Write Memory [} 443]. 4.1.2.3.6.1 FB_DALIV2Compare The control gear compares its RANDOM ADDRESS [} 88] with the SEARCH ADDRESS [} 88]. If the random address is smaller than or equal to the search address, and if the control gear is not connected, then the output b Answer is set to TRUE. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; 164 Version: 2.2.0 TE1000
## Page 165

Programming n Error Id : UDINT; b Answer : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Answer BOOL The random address is smaller than or equal to the search address. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.2 FB_DALIV2Initialise The function block FB_DALIV2Initialise is used to start the addressing of the control gears. The addressing has to be terminated again with the function block FB_DALIV2Terminate [} 178]. The maximum duration is limited to 15 minutes. Each control gear ends addressing automatically after 15 minutes. The reaction of the control gears that receive this command depends on the parameter n Parameter: Value (binary) Description 0000 0000 All control gears respond. 0AAA AAA1 Control gears with the address AAA AAA respond. 1111 1111 Control gears with no short address respond. Inputs VAR INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Parameter : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Parameter BYTE Specifies which control gears should respond to this command (see table above). TE1000 Version: 2.2.0 165
## Page 166

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.3 FB_DALIV2Physical Selection The function block FB_DALIV2Physical Selection controls that all control gears that receive this command go into physical selection mode. In this mode, the comparison of the RANDOM ADDRESS [} 88] with the SEARCH ADDRESS [} 88] is blocked. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 166 Version: 2.2.0 TE1000
## Page 167

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.4 FB_DALIV2Program Short Address The function block FB_DALIV2Program Short Address controls that all selected control gears save the value n Short Address (SHORT ADDRESS [} 88]) as a short address. Selected means: • The RANDOM ADDRESS [} 88] of the control gear is the same as the SEARCH ADDRESS [} 88]. • Physical selection is determined by the control gear, as the lamp has been disconnected from the control gear (after receiving the command FB_DALIV2Physical Selection [} 166]). Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Short Address : BYTE; END_VAR TE1000 Version: 2.2.0 167
## Page 168

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Short Address BYTE Short address to be assigned to the selected control gears (0 - 63). Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.5 FB_DALIV2Query Short Address Once the control gear has been selected, it sends its SHORT ADDRESS [} 88]. Selected means: • The RANDOM ADDRESS [} 88] of the control gear is the same as the SEARCH ADDRESS [} 88]. • Physical selection is determined by the control gear, as the lamp has been disconnected from the control gear (after receiving the command FB_DALIV2Physical Selection [} 166]). 168 Version: 2.2.0 TE1000
## Page 169

Programming Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Short Address : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Short Address BYTE Short address of the control gear (0 - 63) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.6 FB_DALIV2Randomise The control gears generate a new RANDOM ADDRESS [} 88] with the function block FB_DALIV2Randomize. TE1000 Version: 2.2.0 169
## Page 170

Programming Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.7 FB_DALIV2Search Addr The function block FB_DALIV2Search Addr sets the SEARCH ADDRESS [} 88]. 170 Version: 2.2.0 TE1000
## Page 171

Programming Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Search Addr : UDINT; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Search Addr UDINT Search address Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.8 FB_DALIV2Search Addr H The function block FB_DALIV2Search Addr H sets the upper 8 bits of the 24-bit SEARCH ADDRESS [} 88]. TE1000 Version: 2.2.0 171
## Page 172

Programming Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n High Byte Search Addr : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n High Byte Search Ad BYTE The upper 8 bits of the 24-bit search address dr Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.9 FB_DALIV2Search Addr L 172 Version: 2.2.0 TE1000
## Page 173

Programming The function block FB_DALIV2Search Addr L sets the lower 8 bits of the 24-bit SEARCH ADDRESS [} 88]. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Low Byte Search Addr : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Low Byte Search Ad BYTE The lower 8 bits of the 24-bit search address dr Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 173
## Page 174

Programming 4.1.2.3.6.10 FB_DALIV2Search Addr M The function block FB_DALIV2Search Addr M sets the middle 8 bits of the 24-bit SEARCH ADDRESS [} 88]. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Mid Byte Search Addr : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Mid Byte Search Add BYTE The middle 8 bits of the 24-bit search address r Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 174 Version: 2.2.0 TE1000
## Page 175

Programming 4.1.2.3.6.11 FB_DALIV2Set DTR0 This command is only available as a broadcast. Data is written to the DTR0 of all the control gears. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n DTR0 : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n DTR0 BYTE The value that is to be written into the DTR0. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). TE1000 Version: 2.2.0 175
## Page 176

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.3.6.12 FB_DALIV2Set DTR1 This command is only available as a broadcast. Data is written to the DTR1 of all the control gears. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n DTR1 : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n DTR1 BYTE The value that is to be written into the DTR1. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 176 Version: 2.2.0 TE1000
## Page 177

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.13 FB_DALIV2Set DTR2 This command is only available as a broadcast. Data is written to the DTR2 of all the control gears. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n DTR2 : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n DTR2 BYTE The value that is to be written into the DTR2. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 177
## Page 178

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.14 FB_DALIV2Terminate The function block FB_DALIV2Terminate terminates addressing for all control gears. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 178 Version: 2.2.0 TE1000
## Page 179

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.15 FB_DALIV2Verify Short Address If the short address in the control gear is equal to the parameter n Short Address, the output b Answer is set to TRUE. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Short Address : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Short Address BYTE Short address with which the own short address is to be compared. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 179
## Page 180

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Answer : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Answer BOOL The parameter n Short Address is the same as its own short address. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.16 FB_DALIV2Withdraw Control gears for which the RANDOM ADDRESS [} 88] is the same as the SEARCH ADDRESS [} 88] may no longer respond to the command FB_DALIV2Compare [} 164]. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 180 Version: 2.2.0 TE1000
## Page 181

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.3.6.17 FB_DALIV2Write Memory Location The value n Value is written in the memory bank of the control gear. The exact memory bank is specified by n Memory Bank and the address within the memory bank by n Offset. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; TE1000 Version: 2.2.0 181
## Page 182

Programming e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Memory Bank : BYTE n Offset : BYTE n Value : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Memory Bank BYTE The memory bank to be accessed. n Offset BYTE The address within the memory bank to be accessed. n Value BYTE Value to be written to the memory bank of the control gear. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 182 Version: 2.2.0 TE1000
## Page 183

Programming 4.1.2.4 Part 103 (control units) 4.1.2.4.1 Configuration Function blocks Name Description FB_DALIV2x Add To Device Groups [} 183] Assigns the control unit to one or more groups. FB_DALIV2x Disable Instance [} 184] The control unit instance is disabled. FB_DALIV2x Disable Power Cycle Notification [} 186] Disables the Power Cycle Notification event. FB_DALIV2x Enable Instance [} 187] The control unit instance is enabled. FB_DALIV2x Enable Power Cycle Notification [} 188] Enables the Power Cycle Notification event. FB_DALIV2x Identify Device [} 189] Starts the identification routine for the control unit. FB_DALIV2x Remove From Device Groups [} 190] Removes the control unit from one or more groups. FB_DALIV2x Reset [} 192] Resets all parameters to their reset values. FB_DALIV2x Set Event Filter [} 193] This function block sets the event filter for the respective control unit instance. FB_DALIV2x Set Event Scheme [} 193] Sets the addressing scheme for the events of the respective control unit instance. FB_DALIV2x Set Operating Mode [} 195] Sets the Operating Mode for the control unit. FB_DALIV2x Set Short Address [} 197] Sets the short address of the control unit. FB_DALIV2x Start Quiescent Mode [} 198] The quiescent mode of the control unit is started. FB_DALIV2x Stop Quiescent Mode [} 199] The quiescent mode of the control unit is stopped. 4.1.2.4.1.1 FB_DALIV2x Add To Device Groups The function block FB_DALIV2x Add To Device Groups assigns one or more groups to the control device. A total of 32 groups are available to which a control device can be assigned. Each bit of the variable n Device Groups corresponds to one of these groups. If the bit is set, the control device is assigned to the respective group. Bit 0 corresponds to group 0, bit 31 to group 31. The function block FB_DALIV2x Remove From Device Groups [} 190] can be used to remove a control device from a group. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Device Groups : DWORD; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. TE1000 Version: 2.2.0 183
## Page 184

Programming Name Type Description n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Device Groups DWORD 32-bit variable where each bit represents the corresponding group to which the control device is to be assigned. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.2 FB_DALIV2x Disable Instance The function block FB_DALIV2x Disable Instance disables the instance of the control device. The function block FB_DALIV2x Enable Instance [} 187] enables the instance of the control device. 184 Version: 2.2.0 TE1000
## Page 185

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 185
## Page 186

Programming 4.1.2.4.1.3 FB_DALIV2x Disable Power Cycle Notification The function block FB_DALIV2x Disable Power Cycle Notification disables the Power Cycle Notification event. The function block FB_DALIV2x Enable Power Cycle Notification [} 188] can be used to enable the event. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). 186 Version: 2.2.0 TE1000
## Page 187

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.4 FB_DALIV2x Enable Instance The function block FB_DALIV2x Enable Instance enables the instance of the control device. The function block FB_DALIV2x Disable Instance [} 184] can be used to disable the instance. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR TE1000 Version: 2.2.0 187
## Page 188

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.5 FB_DALIV2x Enable Power Cycle Notification The function block FB_DALIV2x Enable Power Cycle Notification enables the Power Cycle Notification event. The function block FB_DALIV2x Disable Power Cycle Notification [} 186] can be used to lock the event. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). 188 Version: 2.2.0 TE1000
## Page 189

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.6 FB_DALIV2x Identify Device The function block FB_DALIV2x Identify Device starts the identification routine for the control device. It takes approx. 10 seconds and ends automatically. The exact scope of the identification routine depends on the manufacturer of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) TE1000 Version: 2.2.0 189
## Page 190

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.7 FB_DALIV2x Remove From Device Groups The function block FB_DALIV2x Remove From Device Groups removes the control device from one or more groups. A total of 32 groups are available to which a control device can be assigned. Each bit of the variable n Device Groups corresponds to one of these groups. If the bit is set, the control device is removed from the respective group. Bit 0 corresponds to group 0, bit 31 to group 31. The function block FB_DALIV2x Add To Device Groups [} 183] can be used to assign a control device to a group. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; 190 Version: 2.2.0 TE1000
## Page 191

Programming e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Device Groups : DWORD; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Device Groups DWORD 32-bit variable where each bit represents the corresponding group from which the control device is to be removed. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 191
## Page 192

Programming 4.1.2.4.1.8 FB_DALIV2x Reset The function block FB_DALIV2x Reset resets all parameters to the reset values. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 192 Version: 2.2.0 TE1000
## Page 193

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.9 FB_DALIV2x Set Event Filter The function block FB_DALIV2x Set Event Filter sets the event filter for the respective instance of the control device. Each bit in n Event Filter represents an event. If the bit is set, the associated event is enabled. The event is locked if the bit is not set. The meaning of the individual bits can be found in the documentation of the respective control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Event Filter : DWORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Event Filter DWORD Each bit represents an event to be enabled or disabled. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 193
## Page 194

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.10 FB_DALIV2x Set Event Scheme The function block FB_DALIV2x Set Event Scheme can be used to define the addressing scheme for the events of the respective instance of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Event Scheme : E_DALIV2Event Scheme := e DALIV2Event Scheme Instance; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group 194 Version: 2.2.0 TE1000
## Page 195

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Event Scheme E_DALIV2Event Scheme Addressing scheme for the events [} 463] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.11 FB_DALIV2x Set Operating Mode The function block FB_DALIV2x Set Operating Mode sets the Operating Mode for the control device. TE1000 Version: 2.2.0 195
## Page 196

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Operating Mode : BYTE := 0; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Operating Mode BYTE New Operating Mode Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 196 Version: 2.2.0 TE1000
## Page 197

Programming 4.1.2.4.1.12 FB_DALIV2x Set Short Address The function block FB_DALIV2x Set Short Address sets the short address of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Short Address : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Short Address BYTE New short address (0...63, 255) e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 197
## Page 198

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.13 FB_DALIV2x Start Quiescent Mode The function block FB_DALIV2x Start Quiescent Mode is used to start the Quiescent Mode of the control device. The mode is limited to 15 min +/- 1.5 min after the last reception. The Quiescent Mode can be stopped prematurely using the function block FB_DALIV2x Stop Quiescent Mode [} 199]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 198 Version: 2.2.0 TE1000
## Page 199

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.1.14 FB_DALIV2x Stop Quiescent Mode The function block FB_DALIV2x Stop Quiescent Mode is used to stop the quiescent mode of the control device. In Quiescent Mode the control device does not send commands or events. The Quiescent Mode is started by FB_DALIV2x Start Quiescent Mode [} 198]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group TE1000 Version: 2.2.0 199
## Page 200

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2 Query Function blocks Name Description FB_DALIV2x Query Content DTR0 [} 201] Read out the DTR0 (Data Transfer Register). FB_DALIVx2Query Content DTR1 [} 202] Read out the DTR1 (Data Transfer Register 1). FB_DALIV2x Query Content DTR2 [} 204] Read out the DTR2 (Data Transfer Register 2). FB_DALIV2x Query Device Groups [} 205] Queries the group allocations of the control unit. FB_DALIV2x Query Device Status [} 206] The function block reads the Device Status of the control unit. FB_DALIV2x Query Event Filter [} 207] Queries the event filter for the respective control unit instance. 200 Version: 2.2.0 TE1000
## Page 201

Programming Name Description FB_DALIV2x Query Event Scheme [} 209] Queries the addressing scheme for the events of the respective control unit instance FB_DALIV2x Query Input Device Error [} 210] Queries the Input Device Error of the control unit. FB_DALIV2x Query Input Value [} 211] Queries the first byte of the input value of the control unit instance. FB_DALIV2x Query Input Value Latch [} 212] Queries the following byte of the input value of the control unit instance. FB_DALIV2x Query Instance Enabled [} 214] Queries whether the control unit instance is enabled. FB_DALIV2x Query Instance Error [} 215] Queries the Instance Error of the control unit. FB_DALIV2x Query Instance Status [} 216] Queries the Instance Status of the control unit. FB_DALIV2x Query Missing Short Address [} 217] Queries whether the control unit does not have a valid short address. FB_DALIV2x Query Number Of Instances [} 219] Queries the number of instances that the control unit has. FB_DALIV2x Query Operating Mode [} 220] Queries the Operating Mode of the control unit. FB_DALIV2x Query Power Cycle Notification [} 221] Queries whether the Power Cycle Notification event is enabled. FB_DALIV2x Query Random Address H [} 222] The higher-order byte of the random address is read from the control unit. FB_DALIV2x Query Random Address L [} 223] The lower-order byte of the random address is read from the control unit. FB_DALIV2x Query Random Address M [} 225] The mean byte of the random address is read from the control unit. FB_DALIV2x Query Reset State [} 226] Queries whether the control gear parameters have their reset values. FB_DALIV2x Query Resolution [} 227] Queries the resolution of the input values of the control unit. FB_DALIV2x Query Version Number [} 228] Queries the version number of the control unit. FB_DALIV2x Read Memory Location [} 229] A byte is read from the memory of the control unit. 4.1.2.4.2.1 FB_DALIV2x Query Content DTR0 The function block FB_DALIV2x Query Content DTR0 is used to read the content of the DTR0 (Data Transfer Register) from the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR TE1000 Version: 2.2.0 201
## Page 202

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Content DTR0 : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Content DTR0 BYTE Contents of DTR0 (Data Transfer Register0) Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.2 FB_DALIV2x Query Content DTR1 202 Version: 2.2.0 TE1000
## Page 203

Programming The function block FB_DALIV2x Query Content DTR1 is used to read the content of the DTR1 (Data Transfer Register) from the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Content DTR1 : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Content DTR1 BYTE Contents of the DTR1 (Data Transfer Register) Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 203
## Page 204

Programming 4.1.2.4.2.3 FB_DALIV2x Query Content DTR2 The function block FB_DALIV2x Query Content DTR2 is used to read the content of the DTR2 (Data Transfer Register) from the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Content DTR2 : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 204 Version: 2.2.0 TE1000
## Page 205

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Content DTR2 BYTE Contents of the DTR2 (Data Transfer Register) Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.4 FB_DALIV2x Query Device Groups The function block FB_DALIV2x Query Device Groups queries the group assignments of the control device. A total of 32 groups are available to which a control device can be assigned. Each bit of the variable n Device Groups corresponds to one of these groups. If the bit is set, the control device is assigned to the respective group. Bit 0 corresponds to group 0, bit 31 to group 31. The function block FB_DALIV2x Add To Device Groups [} 183] can be used to assign a control device to a group. The function block FB_DALIV2x Remove From Device Groups [} 190] can be used to remove a control device from a group. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 205
## Page 206

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Device Groups : DWORD; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Device Groups DWORD 32-bit variable where each bit represents the corresponding group to which the control device has been assigned. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.5 FB_DALIV2x Query Device Status The function block FB_DALIV2x Query Device Status reads the Device Status of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 206 Version: 2.2.0 TE1000
## Page 207

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Device Status : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Device Status BYTE The Device Status of the control device Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.6 FB_DALIV2x Query Event Filter The function block FB_DALIV2x Query Event Filter queries the event filter for the respective instance of the control device. Each bit in n Event Filter represents an event. If the bit is set, the associated event is enabled. The event is locked if the bit is not set. The meaning of the individual bits can be found in the documentation of the respective control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; TE1000 Version: 2.2.0 207
## Page 208

Programming n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Event Filter : DWORD; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Event Filter DWORD Each bit represents an event that has been enabled or disabled. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 208 Version: 2.2.0 TE1000
## Page 209

Programming 4.1.2.4.2.7 FB_DALIV2x Query Event Scheme The function block FB_DALIV2x Query Event Scheme can be used to query the addressing scheme for the events of the respective instance of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; e Event Scheme : E_DALIV2Event Scheme; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 209
## Page 210

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). e Event Scheme E_DALIV2Event Scheme Addressing scheme for the events [} 463] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.8 FB_DALIV2x Query Input Device Error The function block FB_DALIV2x Query Input Device Error reads the Input Device Error of the control device. The meaning of the Input Device Error depends on the manufacturer of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). 210 Version: 2.2.0 TE1000
## Page 211

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Input Device Error : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Input Device Error BYTE The Input Device Error of the control device Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.9 FB_DALIV2x Query Input Value The function block FB_DALIV2x Query Input Value queries the first byte of the input value of the instance of the control device. The current input value is stored in memory, and the most significant byte (MSB) is returned. All other bytes can be read with the function block FB_DALIV2x Query Input Value Latch [} 212]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] TE1000 Version: 2.2.0 211
## Page 212

Programming Name Type Description n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Value : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Value BYTE The most significant byte (MSB) of the input value Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.10 FB_DALIV2x Query Input Value Latch The function block FB_DALIV2x Query Input Value Latch queries the following byte of the input value of the instance of the control device. The first byte is read with the function block FB_DALIV2x Query Input Value [} 211]. 212 Version: 2.2.0 TE1000
## Page 213

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Value : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Value BYTE The most significant byte (MSB) of the input value Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 213
## Page 214

Programming 4.1.2.4.2.11 FB_DALIV2x Query Instance Enabled The function block FB_DALIV2x Query Instance Enabled queries whether the instance of the control device is enabled. The function block FB_DALIV2x Disable Instance [} 184] can be used to disable the instance. The function block FB_DALIV2x Enable Instance [} 187] enables the instance of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Instance Enabled : BOOL; END_VAR 214 Version: 2.2.0 TE1000
## Page 215

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Instance Enabled BOOL Is TRUE if the instance has been enabled. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.12 FB_DALIV2x Query Instance Error The function block FB_DALIV2x Query Instance Error reads the Instance Error of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 215
## Page 216

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Instance Error : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Instance Error BYTE The Instance Error of the control device Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.13 FB_DALIV2x Query Instance Status The function block FB_DALIV2x Query Instance Status reads the Instance Status of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group 216 Version: 2.2.0 TE1000
## Page 217

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Instance Status : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Instance Status BYTE The Instance Status of the control device Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.14 FB_DALIV2x Query Missing Short Address The function block FB_DALIV2x Query Missing Short Address queries whether the control device does not have a valid short address. TE1000 Version: 2.2.0 217
## Page 218

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Missing Short Address : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Missing Short Addre BOOL Is TRUE if the control device does not have a valid short ss address. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 218 Version: 2.2.0 TE1000
## Page 219

Programming 4.1.2.4.2.15 FB_DALIV2x Query Number Of Instances The function block FB_DALIV2x Query Number Of Instances queries the number of instances that the control device has. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Number Of Instances: BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). TE1000 Version: 2.2.0 219
## Page 220

Programming Name Type Description n Number Of Instance BYTE Number of instances of the control device s Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.16 FB_DALIV2x Query Operating Mode The function block FB_DALIV2x Query Operating Mode queries the Operating Mode of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Operating Mode : BYTE; END_VAR 220 Version: 2.2.0 TE1000
## Page 221

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Operating Mode BYTE Value of OPERATING MODE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.17 FB_DALIV2x Query Power Cycle Notification The function block FB_DALIV2x Query Power Cycle Notification queries whether the Power Cycle Notification event has been enabled. The function block FB_DALIV2x Disable Power Cycle Notification [} 186] can be used to lock the event. The function block FB_DALIV2x Enable Power Cycle Notification [} 188] can be used to enable the event. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 221
## Page 222

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Power Cycle Notification : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Power Cycle Notifica BOOL Is TRUE if the Power Cycle Notification event is enabled. tion Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.18 FB_DALIV2x Query Random Address H The function block FB_DALIV2x Query Random Address H reads the high-order byte of the random address from the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group 222 Version: 2.2.0 TE1000
## Page 223

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Random Address H : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Random Address H BYTE The high-order byte of the random address/long address Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.19 FB_DALIV2x Query Random Address L The function block FB_DALIV2x Query Random Address L reads the low-order byte of the random address from the control device. TE1000 Version: 2.2.0 223
## Page 224

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Random Address L : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Random Address L BYTE The low-order byte of the random address/long address Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 224 Version: 2.2.0 TE1000
## Page 225

Programming 4.1.2.4.2.20 FB_DALIV2x Query Random Address M The function block FB_DALIV2x Query Random Address M reads the middle byte of the random address from the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_Data Frame Type [} 463] Output format of the DALI command (e DALIV2Data Frame Type24Bit or e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Random Address M : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 225
## Page 226

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Random Address M BYTE The middle byte of the random address/long address Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.21 FB_DALIV2x Query Reset State The function block FB_DALIV2x Query Reset State queries whether the parameters of the control device have their reset values. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Reset State : BOOL; END_VAR 226 Version: 2.2.0 TE1000
## Page 227

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Reset State BOOL Is TRUE if the control device parameters have the reset values. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.22 FB_DALIV2x Query Resolution The function block FB_DALIV2x Query Resolution queries the resolution of the input values of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] TE1000 Version: 2.2.0 227
## Page 228

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Resolution : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Resolution BYTE Resolution of the input values Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.23 FB_DALIV2x Query Version Number The function block FB_DALIV2x Query Version Number queries the version number of the control device. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group 228 Version: 2.2.0 TE1000
## Page 229

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Version : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Version BYTE The version number of the control device Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.2.24 FB_DALIV2x Read Memory Location The function block FB_DALIV2x Read Memory Location is used to read a byte from the control device's memory. The exact memory bank is specified by the parameter n Memory Bank and the address within the memory bank by the parameter n Offset. TE1000 Version: 2.2.0 229
## Page 230

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Memory Bank : BYTE := 0; n Offset : BYTE := 0; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Memory Bank BYTE The memory bank to be accessed. n Offset BYTE The address within the memory bank to be accessed. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Value : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Value BYTE Byte read from the control gear memory Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 230 Version: 2.2.0 TE1000
## Page 231

Programming 4.1.2.4.3 Special commands Function blocks Name Description FB_DALIV2x Compare [} 231] The control device compares its random address with the search address. FB_DALIV2x DTR0 [} 232] Writes an 8-bit value to the DTR0 of all control devices. FB_DALIV2x DTR1 [} 234] Writes an 8-bit value to the DTR1 of all control devices. FB_DALIV2x DTR2 [} 235] Writes an 8-bit value to the DTR2 of all control devices. FB_DALIV2x Initialise [} 236] Starts the addressing of the control devices. FB_DALIV2x Program Short Address [} 237] All selected control devices save the short address. FB_DALIV2x Query Short Address [} 238] If the random address is the same as the search address, the control device sends its short address. FB_DALIV2x Randomise [} 239] The control devices generate a new random address. FB_DALIV2x Search Addr H [} 240] This function block sets the upper 8 bits of the 24-bit search address. FB_DALIV2x Search Addr L [} 242] This function block sets the lower 8 bits of the 24-bit search address. FB_DALIV2x Search Addr M [} 243] This function block sets the middle 8 bits of the 24-bit search address. FB_DALIV2x Terminate [} 244] Addressing is terminated for all control devices. FB_DALIV2x Verify Short Address [} 245] If the short address of the control device is equal to the parameter n Short Address, the output b Answer is set to TRUE. FB_DALIV2x Withdraw [} 246] Control devices whose random address is the same as the search address may no longer respond to the command FB_DALIV2x Compare. FB_DALIV2x Write Memory Location [} 247] Writes an 8-bit value into the memory of a control gear. 4.1.2.4.3.1 FB_DALIV2x Compare The control gear compares its random address with the search address. If the random address is less than or equal to the search address and the control device is not excluded, then the output b Answer is set to TRUE. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. TE1000 Version: 2.2.0 231
## Page 232

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Answer : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Answer BOOL The random address is smaller than or equal to the search address. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.2 FB_DALIV2x DTR0 This command is only available as a broadcast. The DTR0 of all control devices is described. 232 Version: 2.2.0 TE1000
## Page 233

Programming Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n DTR0 : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n DTR0 BYTE The value that is to be written into the DTR0. e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 233
## Page 234

Programming 4.1.2.4.3.3 FB_DALIV2x DTR1 This command is only available as a broadcast. The DTR1 of all control devices is described. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n DTR1 : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n DTR1 BYTE The value that is to be written into the DTR1. e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). 234 Version: 2.2.0 TE1000
## Page 235

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.4 FB_DALIV2x DTR2 This command is only available as a broadcast. The DTR2 of all control devices is described. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n DTR2 : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n DTR2 BYTE The value that is to be written into the DTR2. e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 235
## Page 236

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.5 FB_DALIV2x Initialise This command starts the addressing procedure for the control devices. Addressing must be terminated again using the function block FB_DALIV2x Terminate [} 244]. The maximum duration is limited to 15 minutes. Each control device automatically terminates addressing after 15 minutes. The response of the control devices receiving this command depends on the parameter n Parameter: e Data Frame Type = e Data Frame Type Osram: Value (binary) Description 0000 0000 All control devices respond. 0AAA AAA1 Control devices with the address AAA AAA respond. 1111 1111 Control devices without a short address respond. e Data Frame Type = e Data Frame Type24Bit: Value (binary) Description 0111 1111 Control devices without a short address respond. 00AA AAAA Control devices with the address AAA AAA respond. 1111 1111 All control devices respond. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Parameter : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Parameter BYTE Specifies which control gears should respond to this command (see table above). e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) 236 Version: 2.2.0 TE1000
## Page 237

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.6 FB_DALIV2x Program Short Address All selected control devices save the value n Short Address as a short address. Selected means: • The random address of the control device matches the search address. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Short Address : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. TE1000 Version: 2.2.0 237
## Page 238

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Short Address BYTE Short address to be assigned to the selected control devices (0 - 63). e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.7 FB_DALIV2x Query Short Address If the control device is selected, it sends its short address. Selected means: • The random address of the control device matches the search address. 238 Version: 2.2.0 TE1000
## Page 239

Programming Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Short Address : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Short Address BYTE Short address of the control gear (0 - 63) Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.8 FB_DALIV2x Randomise TE1000 Version: 2.2.0 239
## Page 240

Programming The control devices generate a new random address. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.9 FB_DALIV2x Search Address H 240 Version: 2.2.0 TE1000
## Page 241

Programming The function block FB_DALIV2x Search Address H sets the upper 8 bits of the 24-bit search address. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n High Byte Search Addr : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n High Byte Search Ad BYTE The upper 8 bits of the 24-bit search address dr e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 241
## Page 242

Programming 4.1.2.4.3.10 FB_DALIV2x Search Address L The function block FB_DALIV2x Search Address L sets the lower 8 bits of the 24-bit search address. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Low Byte Search Addr : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Low Byte Search Ad BYTE The lower 8 bits of the 24-bit search address dr e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). 242 Version: 2.2.0 TE1000
## Page 243

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.11 FB_DALIV2x Search Address M The function block FB_DALIV2x Search Address M sets the middle 8 bits of the 24-bit search address. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Mid Byte Search Addr : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Mid Byte Search Add BYTE The middle 8 bits of the 24-bit search address r e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 243
## Page 244

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.12 FB_DALIV2x Terminate The function block FB_DALIV2x Terminate terminates addressing for all control devices. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 244 Version: 2.2.0 TE1000
## Page 245

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.13 FB_DALIV2x Verify Short Address If the short address of the control device is equal to the parameter n Short Address, the output b Answer is set to TRUE. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Short Address : BYTE; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Short Address BYTE Short address with which the own short address is to be compared. e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 245
## Page 246

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Answer : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Answer BOOL The parameter n Short Address is the same as its own short address. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.14 FB_DALIV2x Withdraw Control devices whose random address is the same as the search address may no longer respond to the command FB_DALIV2x Compare [} 231]. Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Data Frame Type : E_DALIV2Data Frame Type := e DALIV2Data Frame Type24Bit; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Data Frame Type E_DALIV2Data Frame Type Output format of the DALI command (e DALIV2Data Frame Type24Bit or [} 463] e DALIV2Data Frame Type Osram) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 246 Version: 2.2.0 TE1000
## Page 247

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.4.3.15 FB_DALIV2x Write Memory Location The value n Value is written to the memory bank of the control device. The exact memory bank is specified by n Memory Bank and the address within the memory bank by n Offset. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Memory Bank : BYTE n Offset : BYTE n Value : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group TE1000 Version: 2.2.0 247
## Page 248

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Memory Bank BYTE The memory bank to be accessed. n Offset BYTE The address within the memory bank to be accessed. n Value BYTE Value to be written to the memory bank of the control gear. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.5 Part 202 (emergency lighting) The function blocks and variables for emergency lighting supply units with DALI interface are described below. All function blocks described below call "application extended commands". According to the DALI standard (IEC 62386) these commands are within the range 224 to 255. Because of the existence of a variety of application extended commands, it is necessary to use the function block FB_DALIV2Enable Device Type [} 92] to specify which type of control gears (emergency lighting, discharge lamps, ...) should respond to these commands. A detailed description of the individual DALI commands and the variables for emergency lighting supply units can be found in Part 202 of the IEC 62386 standard. 248 Version: 2.2.0 TE1000
## Page 249

Programming Name Description FB_DALIV2Inhibit [} 255] Prevents the control gear from switching to emergency mode for 15 minutes. FB_DALIV2Query Battery Charge The variable BATTERY CHARGE [} 250] (state of battery charge) is read [} 256] from the control gear. FB_DALIV2Query Duration Test Re The variable DURATION TEST RESULT [} 250] is read from the control gear. sult [} 257] FB_DALIV2Query Emergency Leve The variable EMERGENCY LEVEL [} 250] (emergency illuminance) is read l [} 258] from the control gear. FB_DALIV2Query Emergency Max The variable EMERGENCY MAX LEVEL [} 250] (maximum emergency Level [} 260] illuminance) is read from the control gear. FB_DALIV2Query Emergency Min The variable EMERGENCY MIN LEVEL [} 250] (minimum emergency Level [} 261] illuminance) is read from the control gear. FB_DALIV2Query Emergency Mo The variable EMERGENCY MODE [} 250] is read from the control gear. de [} 262] FB_DALIV2Query Emergency Stat The variable EMERGENCY STATUS [} 250] is read from the control gear. us [} 264] FB_DALIV2Query Failure Status The variable FAILURE STATUS [} 250] is read from the control gear. [} 265] FB_DALIV2Query Features The variable FEATURES [} 250] is read from the control gear. [} 266] FB_DALIV2Query Lamp Emergenc The variable LAMP EMERGENCY TIME [} 250] is read from the control gear. y Time [} 268] FB_DALIV2Query Lamp Total Oper The variable LAMP TOTAL OPERATION TIME [} 250] is read from the ation Time [} 269] control gear. FB_DALIV2Query Rated Duration The variable RATED DURATION [} 250] is read from the control gear. [} 270] FB_DALIV2Query Test Timing Depending on the content of the DTR (data transfer register) the variables [} 272] FUNCTION TEST DELAY TIME [} 250], DURATION TEST DELAY TIME [} 250], FUNCTION TEST INTERVAL [} 250], DURATION TEST INTERVAL [} 250], TEST EXECUTION TIMEOUT [} 250] or PROLONG TIME [} 250] are read from the control gear. FB_DALIV2Re Light Reset Inhibit The control gear is switched back to emergency mode (in the absence of mains voltage). [} 273] FB_DALIV2Reset Duration Test Do The 'Duration test completed and result is valid' flag is reset. ne Flag [} 275] FB_DALIV2Reset Function Test Do The 'Function test completed and result is valid' flag is reset. ne Flag [} 276] FB_DALIV2Reset Lamp Time The variables LAMP EMERGENCY TIME [} 250] und LAMP TOTAL [} 277] OPERATION TIME [} 250] are reset. FB_DALIV2Rest [} 278] Switches the lamp off when emergency mode is active. FB_DALIV2Start Duration Test Starts the duration test. [} 280] FB_DALIV2Start Function Test Starts the function test. [} 281] FB_DALIV2Stop Test [} 282] Stops any type of function test or duration test. FB_DALIV2Store DTRAs Duration Writes the value of the DTR (data transfer register) into the variable Test Interval [} 283] DURATION TEST INTERVAL [} 250]. TE1000 Version: 2.2.0 249
## Page 250

Programming Name Description FB_DALIV2Store DTRAs Emergen Writes the value of the DTR (data transfer register) into the variable cy Level [} 284] EMERGENCY LEVEL [} 250]. FB_DALIV2Store DTRAs Function T Writes the value of the DTR (data transfer register) into the variable est Interval [} 286] FUNCTION TEST INTERVAL [} 250]. FB_DALIV2Store DTRAs Prolong Ti Writes the value of the DTR (data transfer register) into the variable me [} 287] PROLONG TIME [} 250]. FB_DALIV2Store DTRAs Test Delay Writes the value of the DTR (data transfer register) into the high-order byte Time High Byte [} 288] of variable TEST DELAY TIME [} 250]. FB_DALIV2Store DTRAs Test Delay Writes the value of the DTR (data transfer register) into the low-order byte Time Low Byte [} 289] of the variable TEST DELAY TIME [} 250]. FB_DALIV2Store DTRAs Test Execu Writes the value of the DTR (data transfer register) into the variable TEST tion Timeout [} 290] EXECUTION TIMEOUT [} 250]. These commands belong to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. 4.1.2.5.1 Variables Each DALI emergency lighting supply unit has a certain number of variables (parameters) from which various information can be read or individual parameters be modified. Name Default value Reset value Scope Size Comment EMERGENCY EMERGENCY No change EMERGENCY 1 byte MAX LEVEL MIN LEVEL ... LEVEL [} 251] EMERGENCY MAX LEVEL or MASK EMERGENCY Manufacturer No change 1 ... 1 byte read only dependent EMERGENCY MIN LEVEL MAX LEVEL or [} 251] MASK EMERGENCY Manufacturer No change EMERGENCY 1 byte read only dependent MIN LEVEL ... MAX LEVEL 254 or MASK [} 251] PROLONG TIME 4 No change 0 ... 255 1 byte [} 251] TEST DELAY TIME 0 0 00 00 ... FF FF 2 bytes [} 252] FUNCTION TEST 0 No change 00 00 ... FF FF 2 bytes DELAY TIME [} 252] DURATION TEST 0 No change 00 00 ... FF FF 2 bytes DELAY TIME [} 252] FUNCTION TEST 7 No change 0, 1 ... 255 1 byte INTERVAL [} 252] DURATION TEST 13 No change 0, 1 ... 97 1 byte INTERVAL [} 253] 250 Version: 2.2.0 TE1000
## Page 251

Programming Name Default value Reset value Scope Size Comment TEST EXECUTION 7 No change 0 ... 255 1 byte TIMEOUT [} 253] BATTERY ???? ???? No change 0 ... 255 1 byte CHARGE [} 253] DURATION TEST 0 No change 0 ... 255 1 byte RESULT [} 253] LAMP 0 No change 0 ... 255 1 byte EMERGENCY TIME [} 253] LAMP TOTAL 0 No change 0 ... 255 1 byte OPERATION TIME [} 253] RATED Manufacturer No change 0 ... 255 1 byte read only dependent DURATION [} 253] EMERGENCY ???? ???? No change 0 ... 255 1 byte MODE [} 253] FEATURES Manufacturer No change 0 ... 255 1 byte read only dependent [} 254] FAILURE STATUS ???? ???? No change 0 ... 255 1 byte [} 254] EMERGENCY ???? ???? No change 0 ... 255 1 byte STATUS [} 254] EXTENDED 1 No change 0 ... 255 1 byte read only VERSION NUMBER [} 254] ?: undetermined EMERGENCY LEVEL This variable contains the emergency illuminance of the lamp. This value is limited via the variables EMERGENCY MAX LEVEL and EMERGENCY MIN LEVEL. The function block FB_DALIV2Query Emergency Level [} 258] can be used to read the value. EMERGENCY MIN LEVEL/ EMERGENCY MAX LEVEL The emergency illuminance is limited via the variables EMERGENCY MIN LEVEL and EMERGENCY MAX LEVEL within the control gear. The exceptions to this are power values of 0 (off) and 255 (mask). The values EMERGENCY MIN LEVEL and EMERGENCY MAX LEVEL are specified by the manufacturer of the control gear. The function blocks FB_DALIV2Query Emergency Min Level [} 261] and FB_DALIV2Query Emergency Max Level [} 260] can be used to read the two variables from the control gear. PROLONG TIME The prolong time defines how long emergency mode is extended after mains voltage is available again. The unit is 30 seconds per step. The value can be read from the control gear via the function block FB_DALIV2Query Test Timing [} 272]. The function block FB_DALIV2Store DTRAs Prolong Time [} 287] is used to write to this variable. TE1000 Version: 2.2.0 251
## Page 252

Programming TEST DELAY TIME The variables FUNCTION TEST DELAY TIME, DURATION TEST DELAY TIME FUNCTION TEST INTERVAL and DURATION TEST INTERVAL are set by means of the TEST DELAY TIME variable. This specifies the time behavior associated with the function test and the duration test as follows: Function test: Use FB_DALIV2Set DTR [} 448] to write the high-order byte for the variable FUNCTION TEST DELAY TIME to the DTR (Data Transfer Register). Use FB_DALIV2Store DTRAs Test Delay Time High Byte [} 288] to write the content of the DTR to the high-order byte of the 16-bit variable TEST DELAY TIME. Use FB_DALIV2Set DTR [} 448] to write the low-order byte for the variable FUNCTION TEST DELAY TIME to the DTR (Data Transfer Register). Use FB_DALIV2Store DTRAs Test Delay Time Low Byte [} 289] to write the content of the DTR to the low-order byte of the 16-bit variable TEST DELAY TIME. Use FB_DALIV2Set DTR [} 448] to write the value for the variable FUNCTION TEST INTERVAL to the DTR (Data Transfer Register). Use FB_DALIV2Store DTRAs Function Test Interval [} 286] to write the content of the DTR to the variable FUNCTION TEST INTERVAL. The content of the variable TEST DELAY TIME is also copied into the variable FUNCTION TEST DELAY TIME. Duration test: Use FB_DALIV2Set DTR [} 448] to write the high-order byte for the variable DURATION TEST DELAY TIME to the DTR (Data Transfer Register). Use FB_DALIV2Store DTRAs Test Delay Time High Byte [} 288] to write the content of the DTR to the high-order byte of the 16-bit variable TEST DELAY TIME. Use FB_DALIV2Set DTR [} 448] to write the low-order byte for the variable DURATION TEST DELAY TIME to the DTR (Data Transfer Register). Use FB_DALIV2Store DTRAs Test Delay Time Low Byte [} 289] to write the content of the DTR to the low-order byte of the 16-bit variable TEST DELAY TIME. Use FB_DALIV2Set DTR [} 448] to write the value for the FUNCTION TEST INTERVAL variable (interval time for the function test) to the DTR (Data Transfer Register). Use FB_DALIV2Store DTRAs Duration Test Interval [} 283] to write the content of the DTR to the variable DURATION TEST INTERVAL. The content of the variable TEST DELAY TIME is also copied into the variable DURATION TEST DELAY TIME. FUNCTION TEST DELAY TIME This variable is used to specify the delay time for the function test. Once this time has elapsed, the function test is executed for the first time. The unit of this variable is 15 minutes per step. This variable can be queried via the function block FB_DALIV2Query Test Timing [} 272]. TEST DELAY TIME is used to write to this variable (see above). DURATION TEST DELAY TIME This variable is used to specify the delay time for the duration test. Once this time has elapsed, the duration test is executed for the first time. The unit of this variable is 15 minutes per step. This variable can be queried via the function block FB_DALIV2Query Test Timing [} 272]. TEST DELAY TIME is used to write to this variable (see above). FUNCTION TEST INTERVAL This variable is used to specify the interval time for the function test. The function test is executed periodically at these intervals. The unit of this variable is 1 day per step. This variable can be queried via the function block FB_DALIV2Query Test Timing [} 272]. TEST DELAY TIME is used to write to this variable (see above). 252 Version: 2.2.0 TE1000
## Page 253

Programming DURATION TEST INTERVAL This variable is used to specify the interval time for the duration test. The duration test is executed periodically at these intervals. The unit of this variable is 1 week per step. This variable can be queried via the function block FB_DALIV2Query Test Timing [} 272]. TEST DELAY TIME is used to write to this variable (see above). TEST EXECUTION TIMEOUT The function test or duration test can be interrupted through various events. The variable TEST EXECUTION TIMEOUT can be used to specify the maximum execution time within which the respective test must be completed. The unit of this variable is 1 day per step. This variable can be queried via the function block FB_DALIV2Query Test Timing [} 272]. The function block FB_DALIV2Store DTRAs Test Execution Timeout [} 290] is used to write to this variable. BATTERY CHARGE The current state of battery charge can be retrieved via this variable. 0 means minimum load, 254 means maximum load. If the control gear is unable to determine the state of charge, this variable contains the value 255. This variable can be read with the function block FB_DALI2Query Battery Charge [} 256]. DURATION TEST RESULT The result of a duration test is stored in this variable. The unit is 2 minutes per step. The value is only valid if bit 2 is set in the variable EMERGENCY STATUS (see below). The variable DURATION TEST RESULT can be queried with the function FB_DALIV2Query Duration Test Result [} 257]. LAMP EMERGENCY TIME The emergency mode operating period of the lamp (supply via rechargeable batteries) is stored in this variable. The unit is 1 hour per step. This variable can be queried with the function block FB_DALIV2Query Lamp Emergency Time [} 268] and reset with the function block FB_DALIV2Reset Lamp Time [} 277]. LAMP TOTAL OPERATION TIME The total lamp operation time is stored in this variable. The unit is 4 hours per step. This variable is queried with the function block FB_DALIV2Query Lamp Total Operation Time [} 269] and reset with the function block FB_DALIV2Reset Lamp Time [} 277]. RATED DURATION The nominal operation time of the rechargeable battery is stored in this variable. The unit is 2 minutes per step. The value is specified by the manufacturer of the control gear and can be read with the function block FB_DALIV2Query Rated Duration [} 270]. EMERGENCY MODE In EMERGENCY MODE the control gear stores the current mode. The variable can be read with the function block FB_DALIV2Query Emergency Mode [} 262]. Bit Description 0 Reset mode. 0: no. 1 Emergency mode readiness (normal operation). 0: no. 2 Emergency mode. 0: no. 3 Extended emergency mode once mains voltage is available again. 0: no. 4 Function test active. 0: no. 5 Duration test active. 0: no. 6 Connected suppress push button is active. 0: not active or not available. 7 Connected mains voltage is active. 0: OFF. TE1000 Version: 2.2.0 253
## Page 254

Programming FEATURES The supported features of the control gear can be read from this variable using the function block FB_DALIV2Query Features [} 266]. The content of this variable is specified by the manufacturer of the control gear and cannot be modified. Bit Description 0 Integrated emergency lighting supply unit. 0: no. 1 Emergency lighting supply unit in continuous mode. 0: no. 2 Switchable emergency lighting supply unit in continuous mode. 0: no. 3 Auto test capability. 0: no. 4 Adjustable emergency lighting illuminance. 0: no. 5 Connected suppress push button is supported. 0: no. 6 Physical selection is supported. 0: no. 7 reserve FAILURE STATUS Possible failure states are displayed in this variable and can be read with the function block FB_DALIV2Query Failure Status [} 265]. Bit Description 0 Error in the control gear circuit. 0: no. 1 Battery operation time fault. 0: no. 2 Battery fault. 0: no. 3 Emergency lamp fault. 0: no. 4 Timeout during function test. 0: no. 5 Timeout during duration test. 0: no. 6 Function test failed. 0: no. 7 Duration test failed. 0: no EMERGENCY STATUS The current state of the control gear is displayed. The function block FB_DALIV2Query Emergency Status [} 264] can be used to read the content of the variable. Bit Description 0 Inhibit mode. 0: no. 1 Function test is completed and result is valid. 0: no. 2 Duration test is completed and result is valid. 0: no. 3 Battery charger ready for operation. 0: running. 4 Start of function test delayed. 0: no. 5 Start of duration test delayed. 0: no. 6 Identification active. 0: no. 7 Selected. 0: no EXTENDED VERSION NUMBER The extended version number can be read with the function block FB_DALIV2Query Extended Version Number. The version number can only be read, and is specified by the manufacturer of the control gears. 254 Version: 2.2.0 TE1000
## Page 255

Programming 4.1.2.5.2 FB_DALIV2Inhibit Prevents the control gear from switching to emergency mode for 15 minutes. The function block FB_DALIRe Light Reset Inhibit [} 273] can be used to disable inhibition of emergency mode. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 255
## Page 256

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.3 FB_DALIV2Query Battery Charge The variable BATTERY CHARGE [} 250] (state of battery charge) is read from the control gear. 255 is returned if the control gear is unable to determine the value. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 256 Version: 2.2.0 TE1000
## Page 257

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Battery Charge : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Battery Charge BYTE Battery charge status. 0: empty / 254: full Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.4 FB_DALIV2Query Duration Test Result The variable DURATION TEST RESULT [} 250] is read from the control gear. The unit is 2 minutes per step. 255 means a maximum value of 8.5 hours or more. The value is only valid if bit 2 is set in the variable EMERGENCY STATUS [} 250]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] TE1000 Version: 2.2.0 257
## Page 258

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Duration Test Result : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Duration Test Result BYTE The result of the duration test in steps of 2 minutes Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.5 FB_DALIV2Query Emergency Level The variable EMERGENCY LEVEL [} 250] (emergency illuminance) is read from the control gear. 255 is returned if the control gear is unable to determine the value. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. 258 Version: 2.2.0 TE1000
## Page 259

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Emergency Level : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Emergency Level BYTE Emergency illuminance of the control device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 259
## Page 260

Programming 4.1.2.5.6 FB_DALIV2Query Emergency Max Level The variable EMERGENCY MAX LEVEL [} 250] is read from the control gear. 255 is returned if the control gear is unable to determine the value. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Emergency Max Level : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 260 Version: 2.2.0 TE1000
## Page 261

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Emergency Max Lev BYTE Maximum emergency illuminance of the control device el Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.7 FB_DALIV2Query Emergency Min Level The variable EMERGENCY MIN LEVEL [} 250] is read from the control gear. 255 is returned if the control gear is unable to determine the value. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 261
## Page 262

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Emergency Min Level : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Emergency Min Lev BYTE Minimum emergency illuminance of the control device el Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.8 FB_DALIV2Query Emergency Mode The EMERGENCY MODE [} 250] variable is read from the control gear. Bit Description 0 Reset mode. 0: no. 1 Emergency mode readiness (normal operation). 0: no. 2 Emergency mode. 0: no. 3 Extended emergency mode once mains voltage is available again. 0: no. 4 Function test active. 0: no. 5 Duration test active. 0: no. 6 Connected suppress push button is active. 0: not active or not available. 7 Connected mains voltage is active. 0: OFF. 262 Version: 2.2.0 TE1000
## Page 263

Programming This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Emergency Mode : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Emergency Mode BYTE Emergency mode (see table above) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 263
## Page 264

Programming 4.1.2.5.9 FB_DALIV2Query Emergency Status The variable EMERGENCY STATUS [} 250] is read from the control gear. Bit Description 0 Inhibit mode. 0: no. 1 Function test is completed and result is valid. 0: no. 2 Duration test is completed and result is valid. 0: no. 3 Battery charger ready for operation. 0: running. 4 Start of function test delayed. 0: no. 5 Start of duration test delayed. 0: no. 6 Identification active. 0: no. 7 Selected. 0: no This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 264 Version: 2.2.0 TE1000
## Page 265

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Emergency Status : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Emergency Status BYTE Emergency status (see table above) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.10 FB_DALIV2Query Failure Status The variable FAILURE STATUS [} 250] is read from the control gear. Bit Description 0 Error in the control gear circuit. 0: no. 1 Battery operation time fault. 0: no. 2 Battery fault. 0: no. 3 Emergency lamp fault. 0: no. 4 Timeout during function test. 0: no. 5 Timeout during duration test. 0: no. 6 Function test failed. 0: no. 7 Duration test failed. 0: no This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; TE1000 Version: 2.2.0 265
## Page 266

Programming e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Failure Status : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Failure Status BYTE Control gear failure status (see table above) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.11 FB_DALIV2Query Features 266 Version: 2.2.0 TE1000
## Page 267

Programming The variable FEATURES [} 250] is read from the control gear. Bit Description 0 Integrated emergency lighting supply unit. 0: no. 1 Emergency lighting supply unit in continuous mode. 0: no. 2 Switchable emergency lighting supply unit in continuous mode. 0: no. 3 Auto test capability. 0: no. 4 Adjustable emergency lighting illuminance. 0: no. 5 Connected suppress push button is supported. 0: no. 6 Physical selection is supported. 0: no. 7 Reserve This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Features : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 267
## Page 268

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Features BYTE Features of the control gear (see table above) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.12 FB_DALIV2Query Lamp Emergency Time The variable LAMP EMERGENCY TIME [} 250] is read from the control gear. The unit is 1 hour per step. 255 means a maximum value of 254 hours or more. The variable is always incremented at the start of the 1-hour interval. Once the maximum value of 255 is reached, it is not increased further. The variable is reset via the command FB_DALIV2Reset Lamp Time [} 277]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 268 Version: 2.2.0 TE1000
## Page 269

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Lamp Emergency Time : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Lamp Emergency Ti BYTE Emergency operation time of the lamp from the control me gear Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.13 FB_DALIV2Query Lamp Total Operation Time The variable LAMP TOTAL OPERATION TIME [} 250] is read from the control gear. The unit is 4 hours per step. 255 means a maximum value of 1016 hours or more. The variable is always incremented at the start of the 4-hour interval. Once the maximum value of 255 is reached, it is not increased further. The variable is reset via the command FB_DALIV2Reset Lamp Time [} 277]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR TE1000 Version: 2.2.0 269
## Page 270

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Lamp Total Operation Time : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Lamp Total Operatio BYTE Total operation time of the lamp from the control gear n Time Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.14 FB_DALIV2Query Rated Duration The variable RATED DURATION [} 250] is read from the control gear. The unit is 2 minutes per step. 270 Version: 2.2.0 TE1000
## Page 271

Programming This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Rated Duration : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Rated Duration BYTE Rated operation time from the control gear Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 271
## Page 272

Programming 4.1.2.5.15 FB_DALIV2Query Test Timing The function block FB_DALIV2Query Test Timing reads the test times (intervals, duration until the next event, etc.) from the control gear. This takes place depending on the value applied at the n DTR input. The background to this is that the DALI basic command 242 “Query test timing” works together with the contents of the Data Transfer Register (DTR), which must be written to accordingly beforehand. The function block FB_DALIV2Query Test Timing combines these two actions. The following data are read from the device, depending on the n DTR value: n DTR read value 0 (2#0000 0000) If automatic test is activated: time until next function test (high-byte) in quarter hours If automatic test is not activated: MASK (255) 1 (2#0000 0001) If automatic test is activated: time until next function test (low-byte) in quarter hours If automatic test is not activated: MASK (255) 2 (2#0000 0010) If automatic test is activated: time until next duration test (high-byte) in quarter hours If automatic test is not activated: MASK (255) 3 (2#0000 0011) If automatic test is activated: time until next duration test (low-byte) in quarter hours If automatic test is not activated: MASK (255) 4 (2#0000 0100) If automatic test is activated: test interval of the function test in days If automatic test is not activated: MASK (255) 5 (2#0000 0101) If automatic test is activated: test interval of the duration test in weeks If automatic test is not activated: MASK (255) 6 (2#0000 0110) Test execution timeout in days (maximum execution period for one test). Applies only to the automatic test! 7 (2#0000 0111) Lamp-on extension time after exiting from emergency operating mode, measured in 0.5-min steps This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type; e Command Priority : E_DALIV2Command Priority; n DTR : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] 272 Version: 2.2.0 TE1000
## Page 273

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n DTR BYTE The corresponding values are read in accordance to this input, see above. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Value : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Value BYTE Result Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.16 FB_DALIV2Re Light Reset Inhibit The control gear is switched back to emergency mode (in the absence of mains voltage). This deactivates the function of the function block FB_DALIV2Inhibit [} 255]. TE1000 Version: 2.2.0 273
## Page 274

Programming This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 274 Version: 2.2.0 TE1000
## Page 275

Programming 4.1.2.5.17 FB_DALIV2Reset Duration Test Done Flag The 'Duration test completed and result is valid' flag is reset. The flag is bit 2 of the variable EMERGENCY STATUS [} 250] and can be queried with the function block FB_DALIQuery Emergency Status [} 264]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 275
## Page 276

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.18 FB_DALIV2Reset Function Test Done Flag The 'Function test completed and result is valid' flag is reset. The flag is bit 1 of the variable EMERGENCY STATUS [} 250] and can be queried with the function block FB_DALIQuery Emergency Status [} 264]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 276 Version: 2.2.0 TE1000
## Page 277

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.19 FB_DALIV2Reset Lamp Time The function block FB_DALIV2Reset Lamp Time resets the variable LAMP EMERGENCY TIME [} 250] and LAMP TOTAL OPERATION TIME [} 250]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group TE1000 Version: 2.2.0 277
## Page 278

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.20 FB_DALIV2Rest The function block FB_DALIV2Rest is used to switch off the lamp when emergency operation is active. Otherwise the system switches to normal operation if mains voltage is available again, or if the function block FB_DALIV2Re Light Reset Inhibit [} 273] was called. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. 278 Version: 2.2.0 TE1000
## Page 279

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 279
## Page 280

Programming 4.1.2.5.21 FB_DALIV2Start Duration Test The function block FB_DALIV2Start Duration Test is used to start the duration test. If the duration test is started with a delay, this is indicated in bit 5 of the variable EMERGENCY STATUS [} 250]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 280 Version: 2.2.0 TE1000
## Page 281

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.22 FB_DALIV2Start Function Test The function block FB_DALIV2Start Function Test is used to start the function test. If the function test is started with a delay, this is indicated in bit 4 of the variable EMERGENCY STATUS [} 250]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 281
## Page 282

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.23 FB_DALIV2Stop Test The function block FB_DALIV2Stop Test stops any type of function test or duration test. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 282 Version: 2.2.0 TE1000
## Page 283

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.24 FB_DALIV2Store DTRAs Duration Test Interval The function block FB_DALIV2Store DTRAs Duration Test Interval writes the value of the DTR (Data Transfer Register) to the variable DURATION TEST INTERVAL [} 250]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR TE1000 Version: 2.2.0 283
## Page 284

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.25 FB_DALIV2Store DTRAs Emergency Level The function block FB_DALIV2Store DTRAs Emergency Level writes the value of the DTR (Data Transfer Register) to the variable EMERGENCY LEVEL [} 250]. 284 Version: 2.2.0 TE1000
## Page 285

Programming This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 285
## Page 286

Programming 4.1.2.5.26 FB_DALIV2Store DTRAs Function Test Interval The function block FB_DALIV2Store DTRAs Function Test Interval writes the value of the DTR (Data Transfer Register) to the variable FUNCTION TEST INTERVAL [} 250]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 286 Version: 2.2.0 TE1000
## Page 287

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.27 FB_DALIV2Store DTRAs Prolong Time The function block FB_DALIV2Store DTRAs Prolong Time writes the value of the DTR (Data Transfer Register) to the variable PROLONG TIME [} 250]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 287
## Page 288

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.28 FB_DALIV2Store DTRAs Test Delay Time High Byte The function block FB_DALIV2Store DTRAs Test Delay Time High Byte writes the value of the DTR (Data Transfer Register) to the high-order byte of the variable TEST DELAY TIME [} 250]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 288 Version: 2.2.0 TE1000
## Page 289

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.29 FB_DALIV2Store DTRAs Test Delay Time Low Byte The function block FB_DALIV2Store DTRAs Test Delay Time Low Byte writes the value of the DTR (Data Transfer Register) to the low-order byte of the variable TEST DELAY TIME [} 250]. This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR TE1000 Version: 2.2.0 289
## Page 290

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.5.30 FB_DALIV2Store DTRAs Test Execution Timeout The function block FB_DALIV2Store DTRAs Test Execution Timeout writes the value of the DTR (Data Transfer Register) to the variable TEST EXECUTION TIMEOUT [} 250] (maximum execution time for a test). 290 Version: 2.2.0 TE1000
## Page 291

Programming This command belongs to the application extended commands for DALI emergency lighting. These only work if they are preceded by the Enable Device Type 1 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 1 command is internally placed automatically before all application extended commands for DALI emergency lighting. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 291
## Page 292

Programming 4.1.2.6 Part 203 (discharge lamps) The function blocks and variables for discharge lamps with DALI interface are described below. All function blocks described below call "application extended commands". According to the DALI standard (IEC 62386) these commands are within the range 224 to 255. Because of the existence of a variety of application extended commands, it is necessary to use the function block FB_DALIV2Enable Device Type [} 92] to specify which type of control gears (emergency lighting, discharge lamps, ...) should respond to these commands. A precise description of the individual DALI commands and the variables for discharge lamps with DALI interface will be found in Part 203 of the IEC 62386 standard. Function blocks Name Description FB_DALIV2Query Actual HIDFailure [} 294] The variable ACTUAL HID FAILURE [} 292] (current failure status) is read from the control gear. FB_DALIV2Query HIDFeatures [} 296] The variable HID FEATURES [} 292] (performance characteristics) is read from the control gear. FB_DALIV2Query HIDStatus [} 297] The variable HID STATUS [} 292] is read from the control gear. FB_DALIV2Query Stored HIDFailure [} 299] The variable STORED HID FAILURE [} 292] (stored failure status) is read from the control gear. FB_DALIV2Query Thermal Load [} 300] The variable THERMAL LOAD [} 292] is read. FB_DALIV2Query Thermal Overload Time [} 301] The 16-bit variable THERMAL OVERLOAD TIME [} 292] is read. FB_DALIV2Query Thermal Overload Time HB [} 303] The high-order byte of the 16-bit variable THERMAL OVERLOAD TIME [} 292] is read. FB_DALIV2Query Thermal Overload Time LB [} 304] The low-order byte of the 16-bit variable THERMAL OVERLOAD TIME [} 292] is read. FB_DALIV2Reset Stored HIDFailure [} 305] The variable STORED HID FAILURE [} 292] (stored lamp faults) is reset. These commands belong to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. 4.1.2.6.1 Variables Every DALI ballast for discharge lamps has a certain number of variables (parameters ) from which it is possible to read a variety of information or to modify individual parameters. Name Default value Reset value Valid range Size Comment HID STATUS 0 0 0 ... 255 1 byte [} 293] ACTUAL HID ???? ???? No change 0 ... 255 1 byte FAILURE [} 293] STORED HID ???? ???? No change 0 ... 255 1 byte FAILURE [} 293] HID FEATURES Manufacturer- No change 0 ... 255 1 byte read only dependent [} 294] 292 Version: 2.2.0 TE1000
## Page 293

Programming Name Default value Reset value Valid range Size Comment THERMAL 0 No change 00 00 ... FF FF 2 bytes OVERLOAD TIME [} 294] THERMAL LOAD ???? ???? No change 0 ... 255 1 byte [} 294] EXTENDED 1 No change 0 ... 255 1 byte read only VERSION NUMBER [} 294] ?: not specified HID STATUS The current status of the control gear is stored in HID STATUS. The value can be read with the function block FB_DALIV2Query HIDStatus [} 297]. Bit Description 0 Start-up time, ready for operation. 0: no. 1 The lamp power has reached its required setpoint. 0: no. 2 Control gear is waiting for the lamp to ignite. 0: no. 3 reserve 4 reserve 5 reserve 6 Identification active. 0: no. 7 reserve ACTUAL HID FAILURE This variable contains all the information about the failure status of the control gear. The variable is read with the function block FB_DALIV2Query Actual HIDFailure [} 294]. The respective bits are set as soon as an error occurs and automatically reset again as soon as the error has been reset. As long as bit 4 or bit 7 are set, bit 1 in the variable STATUS INFORMATION [} 88] is also set. In this case, the function block FB_DALIV2Query Lamp Failure [} 140] returns a TRUE at output b Lamp Failure. Bit Description 0 Supply voltage too low. 0: no. 1 Supply voltage too high. 0: no. 2 Converter too hot. 0: no. 3 reserve 4 Time for lamp ignition exceeded. 0: no. 5 reserve 6 The lamp voltage outside specification. 0: no. 7 Lamp cycle error. 0: no. STORED HID FAILURE This variable contains all the information about the failure status of the control gear. The variable is read with the function block FB_DALIV2Query Stored HIDFailure [} 299]. The error messages are reset by switching off the control gear, or by the function block FB_DALIV2Reset Stored HIDFailure [} 305]. Bit Description 0 Supply voltage too low. 0: no. 1 Supply voltage too high. 0: no. 2 Converter too hot. 0: no. TE1000 Version: 2.2.0 293
## Page 294

Programming Bit Description 3 reserve 4 Time for lamp ignition exceeded. 0: no. 5 reserve 6 The lamp voltage outside specification. 0: no. 7 Lamp cycle error. 0: no. HID FEATURES The performance characteristics supported by the control gear can be read from this variable via the function block FB_DALIV2Query HIDFeatures [} 296]. The content of this variable is specified by the manufacturer of the control gear and cannot be modified. Bit Description 0 "Supply voltage too low" can be queried. 0: no. 1 "Supply voltage too high" can be queried. 0: no. 2 "Transformer too hot" can be queried. 0: no. 3 reserve 4 reserve 5 reserve 6 "Lamp voltage outside specification" can be queried. 0: no. 7 Physical selection is supported. 0: no. THERMAL OVERLOAD TIME As soon as thermal overload is detected, the variable THERMAL OVERLOAD TIME is incremented in steps of 15 minutes. This variable cannot be reset. Reaching 65535 (0x FFFF) here corresponds to a time of 16,383 hours and 45 minutes or more. The function blocks FB_DALIV2Query Thermal Overload Time HB [} 303] and FB_DALIV2Query Thermal Overload Time LB [} 304] can be used to read the variable THERMAL OVERLOAD TIME. The threshold value for detecting the thermal overload is defined by the variable THERMAL LOAD (see below). THERMAL LOAD A percentage value in the range between 0 % and 127.5 % is specified in steps of 0.5 % in the variable THERMAL LOAD. 255 corresponds here to a value of 127.5 %. The variable can be read with the function block FB_DALIV2Query Thermal Load [} 300]. EXTENDED VERSION NUMBER The extended version number can be read with the function block FB_Query V2Extended Version Number. The version number can only be read, and is specified by the manufacturer of the control gears. 4.1.2.6.2 FB_DALIV2Query Actual HIDFailure The variable ACTUAL HID FAILURE [} 292] (current failure status) is read from the control gear. Bit Description 0 Supply voltage too low. 0: no. 294 Version: 2.2.0 TE1000
## Page 295

Programming Bit Description 1 Supply voltage too high. 0: no. 2 Converter too hot. 0: no. 3 Reserve 4 Time for lamp ignition exceeded. 0: no. 5 Reserve 6 The lamp voltage outside specification. 0: no. 7 Lamp cycle error. 0: no. This command belongs to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Actual HIDFailure : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 295
## Page 296

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Actual HIDFailure BYTE Content of the variables (see ACTUAL HID FAILURE [} 292]) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.6.3 FB_DALIV2Query HIDFeatures The variable HID FEATURES [} 292] (performance characteristics) is read from the control gear. Bit Description 0 "Supply voltage too low" can be queried. 0: no. 1 "Supply voltage too high" can be queried. 0: no. 2 "Transformer too hot" can be queried. 0: no. 3 Reserve 4 Reserve 5 Reserve 6 "Lamp voltage outside specification" can be queried. 0: no. 7 Physical selection is supported. 0: no. This command belongs to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 296 Version: 2.2.0 TE1000
## Page 297

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n HIDFeatures : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n HIDFeatures BYTE Content of the variable (see HID FEATURES [} 292]) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.6.4 FB_DALIV2Query HIDStatus The variable HID STATUS [} 292] is read from the control gear. Bit Description 0 Start-up time, ready for operation. 0: no. 1 The lamp power has reached its required setpoint. 0: no. 2 Control gear is waiting for the lamp to ignite. 0: no. 3 Reserve 4 Reserve 5 Reserve 6 Identification active. 0: no. 7 Reserve TE1000 Version: 2.2.0 297
## Page 298

Programming This command belongs to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n HIDStatus : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n HIDStatus BYTE Content of the variable (see HID FEATURES [} 292]) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 298 Version: 2.2.0 TE1000
## Page 299

Programming 4.1.2.6.5 FB_DALIV2Query Stored HIDFailure The variable STORED HID FAILURE [} 292] (stored failure status) is read from the control gear. Bit Description 0 Supply voltage too low. 0: no. 1 Supply voltage too high. 0: no. 2 Converter too hot. 0: no. 3 Reserve 4 Time for lamp ignition exceeded. 0: no. 5 Reserve 6 The lamp voltage outside specification. 0: no. 7 Lamp cycle error. 0: no. This command belongs to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 299
## Page 300

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Stored HIDFailure : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Stored HIDFailure BYTE Content of the variable (see STORED HID FAILURE [} 292]) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.6.6 FB_DALIV2Query Thermal Load The variable THERMAL LOAD [} 292] is read. This contains a percentage figure in the range from 0 % to 127.5 % in steps of 0.5 %. This command belongs to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] 300 Version: 2.2.0 TE1000
## Page 301

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Thermal Load : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Thermal Load BYTE Content of the variable (see THERMAL LOAD [} 292]) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.6.7 FB_DALIV2Query Thermal Overload Time The 16-bit variable THERMAL OVERLOAD TIME [} 292] is read. This command belongs to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. TE1000 Version: 2.2.0 301
## Page 302

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Thermal Overload Time : WORD; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Thermal Overload Ti WORD The value of the 16-bit variable (see THERMAL OVERLOAD me TIME [} 292]) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 302 Version: 2.2.0 TE1000
## Page 303

Programming 4.1.2.6.8 FB_DALIV2Query Thermal Overload Time HB The high-order byte of the 16-bit variable THERMAL OVERLOAD TIME [} 292] is read. This command belongs to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Thermal Overload Time HB : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 303
## Page 304

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Thermal Overload Ti BYTE The high-order byte of the variable (see THERMAL me HB OVERLOAD TIME [} 292]) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.6.9 FB_DALIV2Query Thermal Overload Time LB The function block FB_DALIV2Query Thermal Overload Time LB reads the low-order byte of the 16-bit variable THERMAL OVERLOAD TIME [} 292]. This command belongs to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 304 Version: 2.2.0 TE1000
## Page 305

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Thermal Overload Time LB : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Thermal Overload Ti BYTE The low-order byte of the variable (see THERMAL me LB OVERLOAD TIME [} 292]) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.6.10 FB_DALIV2Reset Stored HIDFailure The variable STORED HID FAILURE [} 292] (stored lamp faults) is reset. This command belongs to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The Enable Device Type 2 command is internally placed automatically before all application extended commands for DALI discharge lamps. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR TE1000 Version: 2.2.0 305
## Page 306

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.7 Part 207 (LED modules) Function blocks The function blocks and variables for LED modules with DALI interface are described below. All function blocks described below call "application extended commands". According to the DALI standard (IEC 62386) these commands are within the range 224 to 255. Because of the existence of a variety of application extended commands, it is necessary to use the function block FB_DALIV2Enable Device Type [} 92] to specify which type of control gears (emergency lighting, discharge lamps, ...) should respond to these commands. A detailed description of the individual DALI commands and the variables for LED modules with DALI interface can be found in standard IEC 62386 Part 207. 306 Version: 2.2.0 TE1000
## Page 307

Programming Name Description FB_DALIV2Disable Current Protector [} 308] The command disables the current protection device of the control gear. FB_DALIV2Enable Current Protector [} 309] The command enables the current protection device of the control gear. FB_DALIV2Query Current Protector Active [} 310] The system queries whether the current protection device is active. FB_DALIV2Query Current Protector Enabled [} 311] The system queries whether the current protection device is enabled. FB_DALIV2Query Dimming Curve [} 313] The dimming curve of the control gear is read. FB_DALIV2Query Fast Fade Time [} 314] Queries the value of FAST FADE TIME. FB_DALIV2Query Gear Type [} 315] Queries the value of GEAR TYPE. FB_DALIV2Query Led Failure Status [} 316] Queries the value of FAILURE STATUS. FB_DALIV2Query Led Features [} 317] Queries the value of FEATURES. FB_DALIV2Query Load Decrease [} 319] The system queries whether a significant decrease in load (compared to the reference power of the system) has been detected. FB_DALIV2Query Load Increase [} 320] The system queries whether a significant increase in load (compared to the reference power of the system) has been detected. FB_DALIV2Query Min Fast Fade Time [} 321] Queries the value of MIN FAST FADE TIME. FB_DALIV2Query Open Circuit [} 322] The system queries whether an idle mode has been detected. FB_DALIV2Query Operating Mode [} 324] Queries the value of OPERATING MODE. FB_DALIV2Query Possible Operating Modes [} 325] Queries the value of POSSIBLE OPERATING MODE. FB_DALIV2Query Reference Measurement Failed [} 326] The system queries whether a started reference measurement has failed. FB_DALIV2Query Reference Running [} 327] The system queries whether a reference measurement of the system performance is active. FB_DALIV2Query Short Circuit [} 329] The system queries whether a short circuit has been detected. FB_DALIV2Query Thermal Overload [} 330] The system queries whether there is a thermal overload with reduction of the luminous flux. FB_DALIV2Query Thermal Shut Down [} 331] The system queries whether a thermal shutdown occurred. FB_DALIV2Reference System Power [} 332] The control gear measures and stores the performance level of the system, in order to detect load increase and decrease. FB_DALIV2Select Dimming Curve [} 334] The dimming curve of the control gear is selected. FB_DALIV2Set Fast Fade Time [} 335] Sets the FAST FADE TIME in the control gear. These commands belong to the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is already automatically internally prefixed to all application extended commands for LED modules with DALI interface. TE1000 Version: 2.2.0 307
## Page 308

Programming 4.1.2.7.1 FB_DALIV2Disable Current Protector The function block FB_DALIV2Disable Current Protector disables the current protection device of the control gear. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 308 Version: 2.2.0 TE1000
## Page 309

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.2 FB_DALIV2Enable Current Protector The function block FB_DALIV2Enable Current Protector enables the current protection device of the control gear. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 309
## Page 310

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.3 FB_DALIV2Query Current Protector Active The function block FB_DALIV2Query Current Protector Active queries whether the current protection device is active. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 310 Version: 2.2.0 TE1000
## Page 311

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Current Protector Active : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Current Protector Ac BOOL Current protection device active tive Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.4 FB_DALIV2Query Current Protector Enabled The function block FB_DALIV2Query Current Protector Enabled queries whether the current protection device is enabled. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; TE1000 Version: 2.2.0 311
## Page 312

Programming e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Current Protector Enabled : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Current Protector En BOOL Current protection device enabled abled Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 312 Version: 2.2.0 TE1000
## Page 313

Programming 4.1.2.7.5 FB_DALIV2Query Dimming Curve The function block FB_DALIV2Query Dimming Curve reads the dimming curve of the control gear. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; e Dimming Curve : E_DALIV2Dimming Curve; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 313
## Page 314

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). e Dimming Curve E_DALIV2Dimming Curve Dimming curve (linear or logarithmic) [} 463] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.6 FB_DALIV2Query Fast Fade Time The function block FB_DALIV2Query Fast Fade Time queries the value of FAST FADE TIME. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 314 Version: 2.2.0 TE1000
## Page 315

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Fast Fade Time : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Fast Fade Time BYTE Value of FAST FADE TIME Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.7 FB_DALIV2Query Gear Type The function block FB_DALIV2Query Gear Type queries the value of GEAR TYPE. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] TE1000 Version: 2.2.0 315
## Page 316

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Gear Type : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Gear Type BYTE Value of GEAR TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.8 FB_DALIV2Query Led Failure Status The function block FB_DALIV2Query Led Failure Status queries the value of FAILURE STATUS. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR 316 Version: 2.2.0 TE1000
## Page 317

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Failure Status : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Failure Status BYTE Value of FAILURE STATUS Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.9 FB_DALIV2Query Led Features The function block FB_DALIV2Query Led Features queries the value of FEATURES. TE1000 Version: 2.2.0 317
## Page 318

Programming This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Features : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Features BYTE Value of FEATURES Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 318 Version: 2.2.0 TE1000
## Page 319

Programming 4.1.2.7.10 FB_DALIV2Query Load Decrease The function block FB_DALIV2Query Load Decrease queries whether a significant load decrease (in comparison with the reference power of the system) has been detected. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Load Decrease : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 319
## Page 320

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Load Decrease BOOL Load decrease Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.11 FB_DALIV2Query Load Increase The function block FB_DALIV2Query Load Increase queries whether a significant load increase (in comparison with the reference power of the system) has been detected. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 320 Version: 2.2.0 TE1000
## Page 321

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Load Increase : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Load Increase BOOL Load increase Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.12 FB_DALIV2Query Min Fast Fade Time The function block FB_DALIV2Query Min Fast Fade Time queries the value of MIN FAST FADE TIME. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. TE1000 Version: 2.2.0 321
## Page 322

Programming Name Type Description n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Min Fast Fade Time : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Min Fast Fade Time BYTE Value of MIN FAST FADE TIME Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.13 FB_DALIV2Query Open Circuit The function block FB_DALIV2Query Open Circuit queries whether an open circuit has been detected. 322 Version: 2.2.0 TE1000
## Page 323

Programming This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Open Circuit : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Open Circuit BOOL Open circuit Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 323
## Page 324

Programming 4.1.2.7.14 FB_DALIV2Query Operating Mode The function block FB_DALIV2Query Operating Mode queries the value of OPERATING MODE. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Operating Mode : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 324 Version: 2.2.0 TE1000
## Page 325

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Operating Mode BYTE Value of OPERATING MODE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.15 FB_DALIV2Query Possible Operating Modes The function block FB_DALIV2Query Possible Operating Modes queries the value of OPERATING MODE. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 325
## Page 326

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Operating Modes : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Operating Modes BYTE Value of OPERATING MODE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.16 FB_DALIV2Query Reference Measurement Failed The function block FB_DALIV2Query Reference Measurement Failed queries whether a started reference measurement has failed. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] 326 Version: 2.2.0 TE1000
## Page 327

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Reference Measurement Failed : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Reference Measure BOOL Reference measurement failed ment Failed Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.17 FB_DALIV2Query Reference Running The function block FB_DALIV2Query Reference Running queries whether a reference measurement of the system power is active. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. TE1000 Version: 2.2.0 327
## Page 328

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Reference Running : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Reference Running BOOL Reference measurement of system power is active Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 328 Version: 2.2.0 TE1000
## Page 329

Programming 4.1.2.7.18 FB_DALIV2Query Short Circuit The function block FB_DALIV2Query Short Circuit queries whether a short circuit has been detected. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Short Circuit : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 329
## Page 330

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Short Circuit BOOL Short circuit Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.19 FB_DALIV2Query Thermal Overload The function block FB_DALIV2Query Thermal Overload queries whether there is a thermal overload with a reduction in luminous flux. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 330 Version: 2.2.0 TE1000
## Page 331

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Thermal Overload : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Thermal Overload BOOL Thermal overload Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.20 FB_DALIV2Query Thermal Shut Down The function block FB_DALIV2Query Thermal Shut Down queries whether a thermal shutdown has taken place. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] TE1000 Version: 2.2.0 331
## Page 332

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Thermal Shutdown : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Thermal Shutdown BOOL Thermal shutdown Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.21 FB_DALIV2Reference System Power The control gear measures and stores the performance level of the system, in order to detect load increase and load decrease. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. 332 Version: 2.2.0 TE1000
## Page 333

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 333
## Page 334

Programming 4.1.2.7.22 FB_DALIV2Select Dimming Curve The function block FB_DALIV2Select Dimming Curve selects the dimming curve of the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; e Dimming Curve : E_DALIV2Dimming Curve := e DALIV2Dimming Curve Logarithmic; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] e Dimming Curve E_DALIV2Dimming Curve Linear or logarithmic dimming curve [} 463] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 334 Version: 2.2.0 TE1000
## Page 335

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.7.23 FB_DALIV2Set Fast Fade Time The function block FB_DALIV2Set Fast Fade Time sets the FAST FADE TIME in the control gear. This command is one of the application extended commands for LED modules with DALI interface. These only work if they are preceded by the Enable Device Type 6 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 6 is automatically internally prefixed to all application extended commands for DALI LED modules. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Fast Fade Time : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Fast Fade Time BYTE The new value for the FAST FADE TIME (0 - 27) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 335
## Page 336

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.8 Part 209 (color/color temperature control) The function blocks and variables for lamps for color/color temperature control with DALI interface are described below. All function blocks described below call "application extended commands". According to the DALI standard (IEC 62386) these commands are within the range 224 to 255. Because of the existence of a variety of application extended commands, it is necessary to use the function block FB_DALIV2Enable Device Type [} 92] to specify which type of control gears (emergency lighting, discharge lamps, ...) should respond to these commands. A precise description of the individual DALI commands and the variables for lamps for color/color temperature control with DALI interface can be found in IEC 62386 part 209. Function blocks Name Description FB_DALIV2Activate [} 342] Starts a new cross-fade. A running cross-fade will be ended beforehand. FB_DALIV2Assign Colour To Linked Channel Linked output channels are assigned to the defined color. [} 344] FB_DALIV2Colour Temperature Tc Step Cooler The value COLOUR TEMPERATURE Tc [} 338] is decremented [} 345] by 1 Mirek. FB_DALIV2Colour Temperature Tc Step Warm The value COLOUR TEMPERATURE Tc [} 338] is incremented by er [} 347] 1 Mirek. FB_DALIV2Copy Report To Temporary [} 348] The color settings report is copied to the temporary color settings. FB_DALIV2Query Assigned Colour [} 349] Reads the assigned color of the specified output channel. FB_DALIV2Query Colour Status [} 351] The variable COLOUR STATUS [} 341] is read from the control gear. 336 Version: 2.2.0 TE1000
## Page 337

Programming Name Description FB_DALIV2Query Colour Type Features The color representations supported by the control gear are read. [} 353] FB_DALIV2Query Colour Value [} 354] The specified color value is read from the control gear. FB_DALIV2Query Gear Features Status [} 357] The variable GEAR FEATURES/STATUS [} 341] is read from the control gear. FB_DALIV2Query RGBWAFControl [} 359] The variable RGBWAF CONTROL [} 342] is read from the control gear. FB_DALIV2Set Temporary Colour Temperatur Saves the value in the variable TEMPORARY COLOUR e Tc [} 360] TEMPERATURE Tc [} 338] of the control gear. FB_DALIV2Set Temporary Primary NDimlevel Saves the value in the variable TEMPORARY PRIMARY N [} 362] DIMLEVEL [} 338] of the control gear. FB_DALIV2Set Temporary RGBDimlevel Saves the values in the variables TEMPORARY RED DIMLEVEL [} 363] [} 338], TEMPORARY GREEN DIMLEVEL [} 338] and TEMPORARY BLUE DIMLEVEL [} 338] of the control gear. FB_DALIV2Set Temporary RGBWAFControl Saves the value in the variable TEMPORARY RGBWAF [} 365] CONTROL [} 338] of the control gear. FB_DALIV2Set Temporary WAFDimlevel Saves the values in the variables TEMPORARY WHITE [} 367] DIMLEVEL [} 338], TEMPORARY AMBER DIMLEVEL [} 338] and TEMPORARY FREECOLOUR DIMLEVEL [} 338] of the control gear. FB_DALIV2Set Temporary XCoordinate Saves the value in the variable TEMPORARY x-COORDINATE [} 368] [} 338] of the control gear. FB_DALIV2Set Temporary YCoordinate Saves the value in the variable TEMPORARY y-COORDINATE [} 370] [} 338] of the control gear. FB_DALIV2Start Auto Calibration [} 371] The calibration procedure is started in order to measure the x- coordinate, the y-coordinate and the TY value of all supported primary colors. FB_DALIV2Store Colour Temperature Tc Limit Saves the value in the variable COLOUR TEMPERATURE Tc [} 373] COOLEST [} 338], COLOUR TEMPERATURE Tc WARMEST [} 338], COLOUR TEMPERATURE Tc PHYSICAL COOLEST [} 338] or COLOUR TEMPERATURE Tc PHYSICAL WARMEST [} 338] of the control gear. FB_DALIV2Store Gear Features Status [} 374] Saves the value in the variable GEAR FEATURES/STATUS [} 341] of the control gear. FB_DALIV2Store TYPrimary N [} 376] Saves the value in the variable TY PRIMARY N [} 338] of the control gear. FB_DALIV2Store Xy Coordinate Primary N Copies the value from the variables TEMPORARY x- [} 377] COORDINATE [} 338] and TEMPORARY y-COORDINATE [} 338] to the variables x-COORDINATE PRIMARY N [} 338] and y- COORDINATE PRIMARY N [} 338]. FB_DALIV2XCoordinate Step Down [} 379] The variable x-COORDINATE is reduced by 256 steps (256 / 65536) without cross-fading. FB_DALIV2XCoordinate Step Up [} 380] The variable x-COORDINATE is increased by 256 steps (256 / 65536) without cross-fading. FB_DALIV2YCoordinate Step Down [} 381] The variable y-COORDINATE is reduced by 256 steps (256 / 65536) without cross-fading. FB_DALIV2YCoordinate Step Up [} 383] The variable y-COORDINATE is increased by 256 steps (256 / 65536) without cross-fading. TE1000 Version: 2.2.0 337
## Page 338

Programming These commands belong to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. 4.1.2.8.1 Variables Every DALI control gear for color/color temperature control has a certain number of variables (parameters ) from which it is possible to read a variety of information or to modify individual parameters. Some variables can be read directly via DALI commands (e.g. FB_DALIV2Query Colour Status [} 351] or FB_DALIV2Query RGBWAFControl [} 359]). The function block FB_DALIV2Query Colour Value [} 354] can be used to read additional variables. Name Default Reset value Scope Size necessary Comment value color repre- sentation (1) [} 340] TEMPORARY x- 65535 65535 0 ...65535 2 bytes 0, 2 COORDINATE REPORT x-COORDINATE 65535 65535 0 ...65535 2 bytes 0 x-COORDINATE ? No change 0 ...65535 2 bytes 0 TEMPORARY y- 65535 65535 0 ...65535 2 bytes 0.2 COORDINATE REPORT y-COORDINATE 65535 65535 0 ...65535 2 bytes 0 y-COORDINATE ? No change 0 ...65535 2 bytes 0 TEMPORARY COLOUR 65535 65535 1 ... 65535 2 bytes 1 TEMPERATURE Tc REPORT COLOUR 65535 65535 1 ... 65535 2 bytes 1 TEMPERATURE Tc COLOUR TEMPERATURE ? No change 1 ... 65535 2 bytes 1 Tc COLOUR TEMPERATURE ? COLOUR COLOUR 2 bytes 1 read only Tc COOLEST TEMPERAT TEMPERATURE URE Tc Tc PHYSICAL PHYSICAL COOLEST COOLEST … COLOUR TEMPERATURE Tc WARMEST, 65535 COLOUR TEMPERATURE ? COLOUR COLOUR 2 bytes 1 read only Tc WARMEST TEMPERAT TEMPERATURE URE Tc Tc COOLEST PHYSICAL ... WARMEST COLOUR TEMPERATURE Tc PHYSICAL WARMEST, 65535 COLOUR TEMPERATURE ? No change 1 - COLOUR 2 bytes 1 read only Tc PHYSICAL COOLEST TEMPERATURE Tc PHYSICAL WARMEST, 65535 338 Version: 2.2.0 TE1000
## Page 339

Programming Name Default Reset value Scope Size necessary Comment value color repre- sentation (1) [} 340] COLOUR TEMPERATURE ? No change COLOUR 2 bytes 1 read only Tc PHYSICAL WARMEST TEMPERATURE Tc PHYSICAL COOLEST - 65534, 65535 TEMPORARY PRIMARY N 65535 65535 0 ...65535 up to 2 DIMLEVEL 12 bytes REPORT PRIMARY N 65535 65535 0 ...65535 up to 2 DIMLEVEL 12 bytes PRIMARY N DIMLEVEL ? No change 0 ...65535 up to 2 12 bytes x-COORDINATE PRIMARY ? No change 0 ...65535 up to 0.2 read only N 12 bytes y-COORDINATE PRIMARY ? No change 0 ...65535 up to 0.2 read only N 12 bytes TY PRIMARY N ? No change 0 ...65535 up to 0.2 read only 12 bytes TEMPORARY RED 255 255 0 ... 255 1 byte 3 DIMLEVEL REPORT RED DIMLEVEL 255 255 0 ... 255 1 byte 3 RED DIMLEVEL ? No change 0 ... 255 1 byte 3 TEMPORARY GREEN 255 255 0 ... 255 1 byte 3 DIMLEVEL REPORT GREEN 255 255 0 ... 255 1 byte 3 DIMLEVEL GREEN DIMLEVEL ? No change 0 ... 255 1 byte 3 TEMPORARY BLUE 255 255 0 ... 255 1 byte 3 DIMLEVEL REPORT BLUE DIMLEVEL 255 255 0 ... 255 1 byte 3 BLUE DIMLEVEL ? No change 0 ... 255 1 byte 3 TEMPORARY WHITE 255 255 0 ... 255 1 byte 3 DIMLEVEL REPORT WHITE 255 255 0 ... 255 1 byte 3 DIMLEVEL WHITE DIMLEVEL ? No change 0 ... 255 1 byte 3 TEMPORARY AMBER 255 255 0 ... 255 1 byte 3 DIMLEVEL REPORT AMBER 255 255 0 ... 255 1 byte 3 DIMLEVEL AMBER DIMLEVEL ? No change 0 ... 255 1 byte 3 TEMPORARY 255 255 0 ... 255 1 byte 3 FREECOLOUR DIMLEVEL REPORT FREECOLOUR 255 255 0 ... 255 1 byte 3 DIMLEVEL FREECOLOUR DIMLEVEL ? No change 0 ... 255 1 byte 3 TEMPORARY RGBWAF 255 255 0 ... 255 1 byte 3 CONTROL REPORT RGBWAF 255 255 0 ... 255 1 byte 3 CONTROL TE1000 Version: 2.2.0 339
## Page 340

Programming Name Default Reset value Scope Size necessary Comment value color repre- sentation (1) [} 340] RGBWAF CONTROL [} 342] 63 No change 0 ... 255 1 byte 3 ASSIGNED COLOUR [} 341] 0x0102 0x0102 0x0000 0000 0000 6 bytes 3 read only 0304 0506 0304 0506 ... MSB: 0x0606 0606 0606 channel 0 LSB: channel 5 TEMPORARY COLOUR TYPE 255 255 0x10, 0x20, 0x40, 1 byte 0, 1, 2, 3 0x80, 0x FF [} 341] REPORT COLOUR TYPE 255 255 0x10, 0x20, 0x40, 1 byte 0, 1, 2, 3 0x80, 0x FF [} 341] SCENE 0–15 COLOUR TYPE 65535 65535 0x10, 0x20, 0x40, 16 bytes 0, 1, 2, 3 read only 0x80, 0x FF [} 341] SCENE 0–15 COLOUR 65535 65535 0 ... 65535 32 0, 1, 2, 3 read only VALUE bytes ... 192 byte s POWER ON COLOUR TYPE Manufactur Manufacture 0x10, 0x20, 0x40, 1 byte 0, 1, 2, 3 read only er r dependent 0x80, 0x FF [} 341] dependent POWER ON COLOUR Manufactur Manufacture 0 ...65535 2 0, 1, 2, 3 read only VALUE er r dependent bytes ... dependent 12 bytes SYSTEM FAILURE COLOUR Manufactur Manufacture 0x10, 0x20, 0x40, 1 byte 0, 1, 2, 3 read only er r dependent 0x80, 0x FF TYPE [} 341] dependent SYSTEM FAILURE Manufactur Manufacture 0 ...65535 2 0, 1, 2, 3 read only COLOUR VALUE er r dependent bytes ... dependent 12 bytes GEAR FEATURES/STATUS ??00 ??00 0001b ??00 0000b, ??00 1 byte 0, 1, 2, 3 0001b 0001b [} 341] COLOUR STATUS [} 341] ? No change 0 ... 255 1 byte 0, 1, 2, 3 COLOUR TYPE FEATURES ? No change 0 ... 255 1 byte 0, 1, 2, 3 read only [} 342] ?: undetermined In the case of 1-byte values the value 255 is also called MASK. In the case of 2-byte values the value 65535 is also called MASK. (1): Specifies the color representation that the DALI control gear must support so that it contains the appropriate variable: Value Description 0 xy coordinates 1 Color temperature Tc 2 Primary (color) N 3 RGBWAF 340 Version: 2.2.0 TE1000
## Page 341

Programming ASSIGNED COLOUR The assignment between output channel and color is defined in ASSIGNED COLOR. Each byte contains the color of the corresponding channel. The function block FB_DALIV2Query Assigned Colour [} 349] can be used to read the value. Value Description 0 No color assigned 1 Red 2 Green 3 Blue 4 White 5 Amber 6 Freely selectable color COLOUR TYPE COLOR TYPE defines the color representations supported by the DALI control gear. The values can be read using the function block FB_DALIV2Query Color Value [} 354]. Values Description 0x10 xy coordinates 0x20 Color temperature Tc 0x40 Primary (color) N 0x80 RGBWAF 0x FF no color change COLOUR STATUS COLOUR STATUS contains information about the current status of the DALI control gear. The values can be read using the function block FB_DALIV2Query Color Status [} 351]. Bit Description 0 xy-coordinate color point lies outside of the valid range. 1 Color temperature Tc lies outside of the valid range. 2 Automatic calibration is active. 3 Automatic calibration was successful. 4 Color representation xy-coordinate active. 5 Color representation colour temperature Tc active. 6 Color representation primary N active. 7 Color representation RGBWAF active. GEAR FEATURES/STATUS GEAR FEATURES/STATUS contains information about the current status of the DALI control gear. The values can be read using the function block FB_DALIV2Query Gear Features Status [} 357] and written using the function block FB_DALIV2Store Gear Features Status [} 374]. Bit Description 0 Automatic activation. 1 - 5 Reserved. 6 Automatic calibration is supported. 7 Restoration of the automatic calibration is supported. TE1000 Version: 2.2.0 341
## Page 342

Programming RGBWAF CONTROL RGBWAF CONTROL contains further information about the assignment between output channel and color. The values can be read using the function block FB_DALIV2Query Color Value [} 354]. Bit Description 0 Output channel 0 / red 1 Output channel 1 / green 2 Output channel 2 / blue 3 Output channel 3 / white 4 Output channel 4 / amber 5 Output channel 5 / free selectable color 6 - 7 00 = channel control 01 = color control 10 = standardized color control 11 = reserved COLOUR TYPE FEATURES COLOUR TYPE FEATURES contains the color representations supported by the DALI control gear. The values can be read using the function block FB_DALIV2Query Colour Type Features [} 353]. Bit Description 0 The control gear supports the color representation by xy coordinates. 1 The control gear supports the color representation by color temperature Tc. 2 - 4 The number of primary colors supported by the control gear. A value of 0 means that this color representation by primary colors is not supported. 5 - 7 The number of RGBWAF channels supported by the control gear. A value of 0 means that this color representation by RGBWAF is not supported. 4.1.2.8.2 FB_DALIV2Activate A current cross-fade is ended and a new cross-fade is started. Only the color is changed here. The function block supports the color representations: • xy coordinates • Color temperature Tc • Primary (color) N • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. 342 Version: 2.2.0 TE1000
## Page 343

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 343
## Page 344

Programming 4.1.2.8.3 FB_DALIV2Assign Colour To Linked Channel Linked output channels are assigned to the defined color (see table). The linked channels are specified by bit 0 to bit 5 of the TEMPORARY RGBWAF CONTROL [} 338] variable. The channel assignment is not changed if TEMPORARY RGBWAF CONTROL contains the value 255 (MASK). All TEMPORARY COLOUR SETTINGS are set to MASK after the use of this command. Value Description 0 No color assigned 1 Red 2 Green 3 Blue 4 White 5 Amber 6 Freely selectable color The function block changes the DTR (Data Transfer Register) for all DALI control gears of the DALI line. The function block supports the color representations: • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Colour : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Colour BYTE Color that is assigned to the output channels (see table). Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 344 Version: 2.2.0 TE1000
## Page 345

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.4 FB_DALIV2Colour Temperature Tc Step Cooler The COLOUR TEMPERATURE Tc [} 338] value is decremented by 1 Mirek without cross-fading. If the value COLOUR TEMPERATURE Tc [} 338] already has the value COLOUR TEMPERATURE Tc COOLEST [} 338], no change is made. Bit 1 (Color temperature Tc out of range) is set in COLOR STATUS [} 338] if the color temperature cannot be reached by the DALI control gear. This command is executed by the DALI control gear only if bit 5 (Color type color temperature Tc active) is set in the variable COLOR STATUS [} 338]. The functions KELVIN_TO_MIREK [} 384] and MIREK_TO_KELVIN [} 385] are available for converting from or to Kelvin. The function block supports the color representations: • Color temperature Tc This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. TE1000 Version: 2.2.0 345
## Page 346

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 346 Version: 2.2.0 TE1000
## Page 347

Programming 4.1.2.8.5 FB_DALIV2Colour Temperature Tc Step Warmer The COLOUR TEMPERATURE Tc [} 338] value is incremented by 1 Mirek without cross-fading. If the value COLOUR TEMPERATURE Tc [} 338] already has the value COLOUR TEMPERATURE Tc WARMEST [} 338], no change is made. Bit 1 (Color temperature Tc out of range) is set in COLOR STATUS [} 338] if the color temperature cannot be reached by the DALI control gear. This command is executed by the DALI control gear only if bit 5 (Color type color temperature Tc active) is set in the variable COLOR STATUS [} 338]. The functions KELVIN_TO_MIREK [} 384] and MIREK_TO_KELVIN [} 385] are available for converting from or to Kelvin. The function block supports the color representations: • Color temperature Tc This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 347
## Page 348

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.6 FB_DALIV2Copy Report To Temporary The color settings report is copied to the temporary color settings. The function block supports the color representations: • xy coordinates • Color temperature Tc • Primary (color) N • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group 348 Version: 2.2.0 TE1000
## Page 349

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.7 FB_DALIV2Query Assigned Colour The variable ASSIGNED COLOUR [} 338] is read from the DALI control gear. This contains the color (see table) assigned to the specified output channel (0 - 5). 255 (MASK) is returned if a non-existent channel number is specified. Value Description 0 No color assigned 1 Red TE1000 Version: 2.2.0 349
## Page 350

Programming Value Description 2 Green 3 Blue 4 White 5 Amber 6 Freely selectable color The function block changes the DTR (Data Transfer Register) for all DALI control gears of the DALI line. The function block supports the color representations: • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Channel : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Channel BYTE Channel number (0 - 5) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Assigned Colour : BYTE; END_VAR 350 Version: 2.2.0 TE1000
## Page 351

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Assigned Colour BYTE Assigned color of the channel (see table) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.8 FB_DALIV2Query Colour Status The variable COLOUR STATUS [} 338] is read from the DALI control gear. Bit Description 0 xy-coordinate color point lies outside of the valid range. 1 Color temperature Tc lies outside of the valid range. 2 Automatic calibration is active. 3 Automatic calibration was successful. 4 Color representation xy-coordinate active. 5 Color representation colour temperature Tc active. 6 Color representation primary N active. 7 Color representation RGBWAF active. The function block supports the color representations: • xy coordinates • Color temperature Tc • Primary (color) N • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; TE1000 Version: 2.2.0 351
## Page 352

Programming e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Colour Status : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Colour Status BYTE Color status (see table above) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 352 Version: 2.2.0 TE1000
## Page 353

Programming 4.1.2.8.9 FB_DALIV2Query Colour Type Features The variable COLOUR TYPE FEATURES [} 338] is read from the DALI control gear. This contains the color representations supported by the DALI control gear. The function block supports the color representations: • xy coordinates • Color temperature Tc • Primary (color) N • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; TE1000 Version: 2.2.0 353
## Page 354

Programming b Supports Xy Coordinate : BOOL; b Supports Colour Temperature Tc : BOOL; n Number Of Primary Colors : BYTE; n Number Of RGBWAFChannels : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Supports Xy Coordin BOOL The control gear supports xy-coordinate. ate b Supports Colour Te BOOL The control gear supports Color temperature Tc. mperature Tc n Number Of Primary BYTE The number of primary colors supported by the control Colors gear. A value of 0 means that this color representation is not supported. n Number Of RGBWA BYTE The number of RGBWAF channels supported by the FChannels control gear. A value of 0 means that this color representation is not supported. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.10 FB_DALIV2Query Colour Value The specified variable (color value) is read from the DALI control gear. The value to be read is defined by n Parameter (see table below). Certain variables can be read directly via DALI commands (e.g. FB_Query Colour Status [} 351] or FB_Query RGBWAFControl [} 359]). Further details on the variables can be found in section Variables [} 338]. Value Description 0 x-COORDINATE 1 y-COORDINATE 2 COLOUR TEMPERATURE Tc 3 PRIMARY N DIMLEVEL 0 4 PRIMARY N DIMLEVEL 1 5 PRIMARY N DIMLEVEL 2 6 PRIMARY N DIMLEVEL 3 7 PRIMARY N DIMLEVEL 4 8 PRIMARY N DIMLEVEL 5 354 Version: 2.2.0 TE1000
## Page 355

Programming Value Description 9 RED DIMLEVEL 10 GREEN DIMLEVEL 11 BLUE DIMLEVEL 12 WHITE DIMLEVEL 13 AMBER DIMLEVEL 14 FREECOLOUR DIMLEVEL 15 RGBWAF CONTROL 64 x-COORDINATE PRIMARY N 0 65 y-COORDINATE PRIMARY N 0 66 TY PRIMARY N 0 67 x-COORDINATE PRIMARY N 1 68 y-COORDINATE PRIMARY N 1 69 TY PRIMARY N 1 70 x-COORDINATE PRIMARY N 2 71 y-COORDINATE PRIMARY N 2 72 TY PRIMARY N 2 73 x-COORDINATE PRIMARY N 3 74 y-COORDINATE PRIMARY N 3 75 TY PRIMARY N 3 76 x-COORDINATE PRIMARY N 4 77 y-COORDINATE PRIMARY N 4 78 TY PRIMARY N 4 79 x-COORDINATE PRIMARY N 5 80 y-COORDINATE PRIMARY N 5 81 TY PRIMARY N 5 82 NUMBER OF PRIMARIES 128 COLOUR TEMPERATURE Tc COOLEST 129 COLOUR TEMPERATURE Tc PHYSICAL COOLEST 130 COLOUR TEMPERATURE Tc WARMEST 131 COLOUR TEMPERATURE Tc PHYSICAL WARMEST 192 TEMPORARY x-COORDINATE 193 TEMPORARY y-COORDINATE 194 TEMPORARY COLOUR TEMPERATURE Tc 195 TEMPORARY PRIMARY N DIMLEVEL 0 196 TEMPORARY PRIMARY N DIMLEVEL 1 197 TEMPORARY PRIMARY N DIMLEVEL 2 198 TEMPORARY PRIMARY N DIMLEVEL 3 199 TEMPORARY PRIMARY N DIMLEVEL 4 200 TEMPORARY PRIMARY N DIMLEVEL 5 201 TEMPORARY RED DIMLEVEL 202 TEMPORARY GREEN DIMLEVEL 203 TEMPORARY BLUE DIMLEVEL 204 TEMPORARY WHITE DIMLEVEL 205 TEMPORARY AMBER DIMLEVEL 206 TEMPORARY FREECOLOUR DIMLEVEL 207 TEMPORARY RGBWAF CONTROL 208 TEMPORARY COLOUR TYPE 224 REPORT x-COORDINATE TE1000 Version: 2.2.0 355
## Page 356

Programming Value Description 225 REPORT y-COORDINATE 226 REPORT COLOUR TEMPERATURE Tc 227 REPORT PRIMARY N DIMLEVEL 0 228 REPORT PRIMARY N DIMLEVEL 1 229 REPORT PRIMARY N DIMLEVEL 2 230 REPORT PRIMARY N DIMLEVEL 3 231 REPORT PRIMARY N DIMLEVEL 4 232 REPORT PRIMARY N DIMLEVEL 5 233 REPORT RED DIMLEVEL 234 REPORT GREEN DIMLEVEL 235 REPORT BLUE DIMLEVEL 236 REPORT WHITE DIMLEVEL 237 REPORT AMBER DIMLEVEL 238 REPORT FREECOLOUR DIMLEVEL 239 REPORT RGBWAF CONTROL 240 REPORT COLOUR TYPE Responses that concern an active color representation are valid only if the color representation of the requested color value is active (see FB_DALIV2Query Colour Status [} 351]) or if the control gear is able to perform a recalculation of the demanded color value from the active color representation to a color value of another color representation. The response must be 255 (MASK) if the control gear does not know the coordinates or if the primary color is not present. The function block changes the DTR (Data Transfer Register) and DTR1 for all DALI control gears of the DALI line. The function block supports the color representations: • xy coordinates • Color temperature Tc • Primary (color) N • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Parameter : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] 356 Version: 2.2.0 TE1000
## Page 357

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Parameter BYTE Color value to be read (see table above). Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Value : UINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Value UINT Contains the read value. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.11 FB_DALIV2Query Gear Features Status The variable GEAR FEATURES/STATUS [} 357] is read from the DALI control gear. Bit Description 0 Automatic activation. 1 - 5 reserved. 6 Automatic calibration is supported. 7 Restoration of the automatic calibration is supported. TE1000 Version: 2.2.0 357
## Page 358

Programming The function block supports the color representations: • xy coordinates • Color temperature Tc • Primary (color) N • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Gear Features Status : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 358 Version: 2.2.0 TE1000
## Page 359

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Gear Features Statu BYTE Status information (see table above). s Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.12 FB_DALIV2Query RGBWAFControl The variable RGBWAF CONTROL [} 338] is read from the DALI control gear. Bit Description 0 Output channel 0 / red 1 Output channel 1 / green 2 Output channel 2 / blue 3 Output channel 3 / white 4 Output channel 4 / amber 5 Output channel 5 / free selectable color 6 - 7 00 = channel control 01 = color control 10 = standardized color control 11 = reserved If an output channel or a color is not supported, then the corresponding bit is FALSE. The function block supports the color representations: • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group TE1000 Version: 2.2.0 359
## Page 360

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n RGBWAFControl : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n RGBWAFControl BYTE Information about the channel assignment (see table above) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.13 FB_DALIV2Set Temporary Colour Temperature Tc Saves the value in the variable TEMPORARY COLOUR TEMPERATURE Tc [} 338] of the DALI control gear. The value can be read with the function block FB_DALIV2Query Colour Value [} 354]. The value is expressed in units of 1 Mirek. A value of 0 is ignored and therefore not saved. The color temperature Tc can vary from 1 Mirek (1000000 K) to 65534 Mirek (15.26 K). 360 Version: 2.2.0 TE1000
## Page 361

Programming The functions KELVIN_TO_MIREK [} 384] and MIREK_TO_KELVIN [} 385] are available for converting from or to Kelvin. The function block changes the DTR (Data Transfer Register) and DTR1 for all DALI control gears of the DALI line. The function block supports the color representations: • Color temperature Tc This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Value : UINT; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Value UINT The value that is written to the variable TEMPORARY COLOUR TEMPERATURE Tc. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 361
## Page 362

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.14 FB_DALIV2Set Temporary Primary NDimlevel Saves the value in the variable TEMPORARY PRIMARY N DIMLEVEL [} 338] of the control gear. The value can be read with the function block FB_DALIV2Query Colour Value [} 354]. The value is expressed in units of 1 / 65536. The maximum value of the PRIMARY N DIMLEVEL is 0.99997 and is interpreted on a linear scale. The function block changes the DTR (Data Transfer Register), DTR1 and DTR2 for all DALI control gears of the DALI line. The function block supports the color representations: • Primary (color) N This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Primary Colour : BYTE; n Value : UINT; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] 362 Version: 2.2.0 TE1000
## Page 363

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Value UINT The value that is written to the variable TEMPORARY PRIMARY N DIMLEVEL. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.15 FB_DALIV2Set Temporary RGBDimlevel Saves the values in the variables TEMPORARY RED DIMLEVEL [} 338], TEMPORARY GREEN DIMLEVEL [} 338] and TEMPORARY BLUE DIMLEVEL [} 338] of the DALI control gear. The values can be read with the function block FB_DALIV2Query Colour Value [} 354]. The function block changes the DTR (Data Transfer Register), DTR1 and DTR2 for all DALI control gears of the DALI line. TE1000 Version: 2.2.0 363
## Page 364

Programming The function block supports the color representations: • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Temporary Red Dimlevel : BYTE; n Temporary Green Dimlevel : BYTE; n Temporary Blue Dimlevel : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Temporary Red Diml BYTE The new value for TEMPORARY RED DIMLEVEL evel n Temporary Green Di BYTE The new value for TEMPORARY GREEN DIMLEVEL mlevel n Temporary Blue Dim BYTE The new value for TEMPORARY BLUE DIMLEVEL level Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 364 Version: 2.2.0 TE1000
## Page 365

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.16 FB_DALIV2Set Temporary RGBWAFControl Saves the value in the variable TEMPORARY RGBWAF CONTROL [} 338] of the DALI control gear. The value can be read with the function block FB_DALIV2Query Colour Value [} 354]. The input n Temporary RGBWAFControl contains the new assignment (see table). Bit Description 0 Output channel 0 / red 1 Output channel 1 / green 2 Output channel 2 / blue 3 Output channel 3 / white 4 Output channel 4 / amber 5 Output channel 5 / free selectable color 6 - 7 00 = channel control 01 = color control 10 = standardized color control 11 = reserved The function block changes the DTR (Data Transfer Register) for all DALI control gears of the DALI line. The function block supports the color representations: • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; TE1000 Version: 2.2.0 365
## Page 366

Programming e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Temporary RGBWAFControl : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Temporary RGBWA BYTE Contains the assignment (see table above) FControl Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 366 Version: 2.2.0 TE1000
## Page 367

Programming 4.1.2.8.17 FB_DALIV2Set Temporary WAFDimlevel Saves the values in the variables TEMPORARY WHITE DIMLEVEL [} 338], TEMPORARY AMBER DIMLEVEL [} 338] and TEMPORARY FREECOLOUR DIMLEVEL [} 338] of the DALI control gear. The values can be read with the function block FB_DALIV2Query Colour Value [} 354]. The function block changes the DTR (Data Transfer Register), DTR1 and DTR2 for all DALI control gears of the DALI line. The function block supports the color representations: • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Temporary White Dimlevel : BYTE; n Temporary Amber Dimlevel : BYTE; n Temporary Freecolour Dimlevel : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Temporary White Di BYTE The new value for TEMPORARY WHITE DIMLEVEL mlevel n Temporary Amber Di BYTE The new value for TEMPORARY AMBER DIMLEVEL mlevel n Temporary Freecolo BYTE The new value for TEMPORARY FREECOLOR ur Dimlevel DIMLEVEL Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 367
## Page 368

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.18 FB_DALIV2Set Temporary XCoordinate Saves the value in the variable TEMPORARY x-COORDINATE [} 338] of the DALI control gear. The value can be read with the function block FB_DALIV2Query Colour Value [} 354]. The function block changes the DTR (Data Transfer Register) and DTR1 for all DALI control gears of the DALI line. The function block supports the color representations: • xy coordinates • Primary (color) N This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; 368 Version: 2.2.0 TE1000
## Page 369

Programming e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Value : UINT; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Value UINT The value that is written to the variable TEMPORARY x- COORDINATE. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 369
## Page 370

Programming 4.1.2.8.19 FB_DALIV2Set Temporary YCoordinate Saves the value in the variable TEMPORARY y-COORDINATE [} 338] of the DALI control gear. The value can be read with the function block FB_DALIV2Query Colour Value [} 354]. The function block changes the DTR (Data Transfer Register) and DTR1 for all DALI control gears of the DALI line. The function block supports the color representations: • xy coordinates • Primary (color) N This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Value : UINT; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Value UINT The value that is written to the variable TEMPORARY y- COORDINATE. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). 370 Version: 2.2.0 TE1000
## Page 371

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.20 FB_DALIV2Start Auto Calibration The calibration procedure is started in order to measure the x-coordinate, the y-coordinate and the TY value of all supported primary colors. The command starts a 15-minute timer or initiates it again. Bit 2 of the variable COLOUR STATUS [} 338] is 1 as long as the timer is active (see FB_DALIV2Query Colour Status [} 351]). On expiry of the timer the last color representation, the last color value and the last lamp power level are directly saved again. During the timer period the DALI control gear carries out a calibration procedure in order to measure the x- coordinate, the y-coordinate and the TY value of all supported primary colors. Whilst the calibration procedure is running, the DALI control gear does not react to any commands apart from TERMINATE [} 178], QUERY COLOUR STATUS [} 351] and START AUTO CALIBRATION. In addition, bit 3 in the variable COLOUR STATUS [} 338] is set to 0 at the start of the calibration. The TERMINATE [} 178] command ends the procedure and stops the timer. If the calibration was successful, bit 3 in COLOUR STATUS [} 338] is set to 1 and the timer is stopped. If the calibration was not successful, then the last successful calibration data are restored if the DALI control gear is able to do so. Subsequently, bit 3 of COLOUR STATUS is set to 1. The ability to restore the last successful calibration data is a feature of the operating device (see QUERY GEAR FEATURES/STATUS [} 357] command). Due to the fact that calibration can take longer than 15 minutes, the status of the automatic calibration should be checked periodically with the QUERY COLOUR STATUS [} 351] command and the calibration timer should be restarted with the START AUTO CALIBRATION command (if necessary). The function block supports the color representations: • xy coordinates • Color temperature Tc TE1000 Version: 2.2.0 371
## Page 372

Programming • Primary (color) N • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). 372 Version: 2.2.0 TE1000
## Page 373

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.21 FB_DALIV2Store Colour Temperature Tc Limit Saves the value in the variable COLOUR TEMPERATURE Tc COOLEST [} 338], COLOUR TEMPERATURE Tc WARMEST [} 338], COLOUR TEMPERATURE Tc PHYSICAL COOLEST [} 338] or COLOUR TEMPERATURE Tc PHYSICAL WARMEST [} 338] of the DALI control gear. The values can be read with the function block FB_DALIV2Query Colour Value [} 354]. The n Select Limit Value input defines the new limit value to be set: Value Limit value Description 0 COLOUR TEMPERATURE Tc lowest possible value, but always equal to or warmer COOLEST than the lowest possible physical value. 1 COLOUR TEMPERATURE Tc highest possible value, but always equal to or cooler WARMEST than the highest possible physical value. 2 COLOUR TEMPERATURE Tc lowest possible physical value. PHYSICAL COOLEST 3 COLOUR TEMPERATURE Tc highest possible physical value. PHYSICAL WARMEST The functions KELVIN_TO_MIREK [} 384] and MIREK_TO_KELVIN [} 385] are available for converting from or to Kelvin. The function block changes the DTR (Data Transfer Register), DTR1 and DTR2 for all DALI control gears of the DALI line. The function block supports the color representations: • Color temperature Tc This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Select Limit Value : BYTE; n Value : UINT; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group TE1000 Version: 2.2.0 373
## Page 374

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Select Limit Value BYTE Specifies the new limit value to be set (see table above). n Value UINT The value that is written to the selected variable. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.22 FB_DALIV2Store Gear Features Status Saves the value in the variable GEAR FEATURES/STATUS [} 338] of the DALI control gear. The values can be read with the function block FB_DALIV2Query Gear Features Status [} 357]. If bit 0 is set to 1, all commands for the control of the lamp power, with the exception of ENABLE DAPC SEQUENCE [} 115], must automatically trigger a color transition. 374 Version: 2.2.0 TE1000
## Page 375

Programming Bit Description 0 Automatic activation. 1 - 7 reserved. The function block changes the DTR (Data Transfer Register) for all DALI control gears of the DALI line. The function block supports the color representations: • xy coordinates • Color temperature Tc • Primary (color) N • RGBWAF This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Gear Features Status : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Gear Features Statu BYTE Value that is written to the variable GEAR FEATURES/ s STATUS. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR TE1000 Version: 2.2.0 375
## Page 376

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.23 FB_DALIV2Store TYPrimary N Saves the value in the variable TY PRIMARY N [} 338] of the DALI control gear. The value is expressed in units of 0.5 lm, which results in a possible range of TYmin = 0 lm to TYmax = 32767 lm. A value of 65535 (MASK) means "unknown". The n Primary Colour parameter specifies the primary color and must be within the range of 0 to 5, depending on the available number of primary colors. The command is ignored for every other value. The function block changes the DTR (Data Transfer Register), DTR1 and DTR2 for all DALI control gears of the DALI line. The function block supports the color representations: • Primary (color) N This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Primary Colour : BYTE; n Value : UINT; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group 376 Version: 2.2.0 TE1000
## Page 377

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Value UINT The value that is written to the variable TY PRIMARY N. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.24 FB_DALIV2Store Xy Coordinate Primary N Copies the value from the variables TEMPORARY x-COORDINATE [} 338] and TEMPORARY y-COORDINATE [} 338] to the variables x-COORDINATE PRIMARY N [} 338] and y-COORDINATE PRIMARY N [} 338]. The n Primary Colour parameter specifies the primary color and must be within the range of 0 to 5, depending on the available number of primary colors. The command is ignored for every other value. TE1000 Version: 2.2.0 377
## Page 378

Programming This command can be used to store the current xy coordinates associated with the primary color. xy coordinates outside the color space chromaticity diagram are not meaningful and should therefore be avoided. The function block changes the DTR2 (Data Transfer Register) for all DALI control gears of the DALI line. The function block supports the color representations: • Primary (color) N This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Primary Colour : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Primary Colour BYTE Primary color (0 - 5) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 378 Version: 2.2.0 TE1000
## Page 379

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.25 FB_DALIV2XCoordinate Step Down The variable x-COORDINATE is reduced by 256 steps (256 / 65536) without cross-fading. If the new color value does not correspond to a color that can be achieved by the DALI control gear, this must be indicated by bit 0 of COLOUR STATUS [} 338] (xy-coordinate color point lies outside of the valid range). The command is executed only if bit 4 of COLOUR STATUS [} 338] (color representation xy- coordinate active) is set. The function block supports the color representations: • xy coordinates This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 379
## Page 380

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.26 FB_DALIV2XCoordinate Step Up The variable x-COORDINATE is increased by 256 steps (256 / 65536) without cross-fading. If the new color value does not correspond to a color that can be achieved by the DALI control gear, this must be indicated by bit 0 of COLOUR STATUS [} 338] (xy-coordinate color point lies outside of the valid range). The command is executed only if bit 4 of COLOUR STATUS [} 338] (color representation xy- coordinate active) is set. The function block supports the color representations: • xy coordinates This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; 380 Version: 2.2.0 TE1000
## Page 381

Programming e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.27 FB_DALIV2YCoordinate Step Down The variable y-COORDINATE is reduced by 256 steps (256 / 65536) without cross-fading. TE1000 Version: 2.2.0 381
## Page 382

Programming If the new color value does not correspond to a color that can be achieved by the DALI control gear, this must be indicated by bit 0 of COLOUR STATUS [} 338] (xy-coordinate color point lies outside of the valid range). The command is executed only if bit 4 of COLOUR STATUS [} 338] (color representation xy- coordinate active) is set. The function block supports the color representations: • xy coordinates This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. 382 Version: 2.2.0 TE1000
## Page 383

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.28 FB_DALIV2YCoordinate Step Up The variable y-COORDINATE is increased by 256 steps (256 / 65536) without cross-fading. If the new color value does not correspond to a color that can be achieved by the DALI control gear, this must be indicated by bit 0 of COLOUR STATUS [} 338] (xy-coordinate color point lies outside of the valid range). The command is executed only if bit 4 of COLOUR STATUS [} 338] (color representation xy- coordinate active) is set. The function block supports the color representations: • xy coordinates This command belongs to the application extended commands for lamps for the color/color temperature control with DALI interface. These only work if they are preceded by the Enable Device Type 8 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 8 is internally placed automatically before all application extended commands for lamps for the color/color temperature control with DALI interface. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR TE1000 Version: 2.2.0 383
## Page 384

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.29 KELVIN_TO_MIREK Conversion of the color temperature from Kelvin to Mirek. Mirek is the unit that is used with most DALI commands. The return value is limited and lies within the range from 0 ... 65535 (see table). Mirek = 1,000,000 / (color temperature in Kelvin). Kelvin Mirek 0 65535 15 65535 16 62500 1000 1000 10000 100 1000000 1 1000001 0 Inputs VAR_INPUT f Kelvin : LREAL; END_VAR Name Type Description f Kelvin LREAL Color temperature in Kelvin 384 Version: 2.2.0 TE1000
## Page 385

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.8.30 MIREK_TO_KELVIN Conversion of the color temperature from Mirek to Kelvin. Mirek is the unit that is used with most DALI commands. The return value is limited and lies within the range from approx. 15.259 ... 1000001 (see table). Mirek = 1,000,000 / (color temperature in Kelvin). Mirek Kelvin 0 1000001 1 1000000 100 10000 1000 1000 10000 100 65534 15.259 65535 15.259 Inputs VAR_INPUT n Mirek : UINT; END_VAR Name Type Description n Mirek UINT Color temperature in Mirek Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.2.9 Part 301 (button) Function blocks A detailed description of the individual DALI commands and the variables can be found in standard IEC 62386 Part 301. Name Description FB_DALIV2x301Query Double Timer [} 386] Queries the value of the DOUBLE TIMER. FB_DALIV2x301Query Double Timer Min [} 387] Queries the minimum value of the DOUBLE TIMER. FB_DALIV2x301Query Repeat Timer [} 388] Queries the value of the REPEAT TIMER. FB_DALIV2x301Query Short Timer [} 390] Queries the value of the SHORT TIMER. FB_DALIV2x301Query Short Timer Min [} 391] Queries the minimum value of the SHORT TIMER. FB_DALIV2x301Query Stuck Timer [} 392] Queries the value of the STUCK TIMER. FB_DALIV2x301Set Double Timer [} 394] Sets the value of the DOUBLE TIMER. FB_DALIV2x301Set Repeat Timer [} 395] Sets the value of the REPEAT TIMER. TE1000 Version: 2.2.0 385
## Page 386

Programming Name Description FB_DALIV2x301Set Short Timer [} 396] Sets the value of the SHORT TIMER. FB_DALIV2x301Set Stuck Timer [} 398] Sets the value of the STUCK TIMER. 4.1.2.9.1 FB_DALIV2x301Query Double Timer The function block FB_DALIV2x301Query Double Timer queries the value of the DOUBLE TIMER. The unit is 20 ms. The maximum permissible value is 2000 ms. The value 0 deactivates the timer. The smallest permitted value can be queried with the function block FB_DALIV2x301Query Double Timer Min. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; 386 Version: 2.2.0 TE1000
## Page 387

Programming n Error Id : UDINT; n Double : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Double BYTE Value of the DOUBLE TIMER [20 ms] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.9.2 FB_DALIV2x301Query Double Timer Min The function block FB_DALIV2x301Query Double Timer Min queries the minimum value of the DOUBLE TIMER. The unit is 20 ms. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] TE1000 Version: 2.2.0 387
## Page 388

Programming Name Type Description e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Double Min : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Double Min BYTE Value of the DOUBLE TIMER [20 ms] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.9.3 FB_DALIV2x301Query Repeat Timer The function block FB_DALIV2x301Query Repeat Timer queries the value of the REPEAT TIMER. The unit is 20 ms. The permissible value range is 100 ms to 2000 ms, i.e. from 5 to 100. 388 Version: 2.2.0 TE1000
## Page 389

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Repeat : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Repeat BYTE Value of the REPEAT TIMER [20 ms] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 389
## Page 390

Programming 4.1.2.9.4 FB_DALIV2x301Query Short Timer The function block FB_DALIV2x301Query Short Timer queries the value of the SHORT TIMER. The unit is 20 ms. The maximum permissible value is 5100 ms. The minimum permissible value can be queried with the function block FB_DALIV2x301Query Short Timer Min [} 391]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Short : BYTE; END_VAR 390 Version: 2.2.0 TE1000
## Page 391

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Short BYTE Value of the SHORT TIMER [20 ms] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.9.5 FB_DALIV2x301Query Short Timer Min The function block FB_DALIV2x301Query Short Timer Min queries the minimum value of the SHORT TIMER. The unit is 20 ms. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] TE1000 Version: 2.2.0 391
## Page 392

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Short Min : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Short Min BYTE Value of the SHORT TIMER [20 ms] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.9.6 FB_DALIV2x301Query Stuck Timer The function block FB_DALIV2x301Query Stuck Timer queries the value of the STUCK TIMER. The unit is 1 s. The permissible value range is from 5 s to 255 s. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR 392 Version: 2.2.0 TE1000
## Page 393

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Stuck : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Stuck BYTE Value of the STUCK TIMER [s] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 393
## Page 394

Programming 4.1.2.9.7 FB_DALIV2x301Set Double Timer The function block FB_DALIV2x301Set Double Timer sets the value of the DOUBLE TIMER. The unit is 20 ms. The maximum permissible value is 2000 ms. The value 0 deactivates the timer. The minimum permissible value can be queried with FB_DALIV2x301Query Double Timer Min [} 387]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Double : BYTE := 0; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Double BYTE Value of the DOUBLE TIMER [20 ms] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR 394 Version: 2.2.0 TE1000
## Page 395

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.9.8 FB_DALIV2x301Set Repeat Timer The function block FB_DALIV2x301Set Repeat Timer sets the value of the REPEAT TIMER. The unit is 20 ms. The permissible value range is 100 ms to 2000 ms, i.e. from 5 to 100. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Repeat : BYTE := 8; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Repeat BYTE Value of the REPEAT TIMER [20 ms] TE1000 Version: 2.2.0 395
## Page 396

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.9.9 FB_DALIV2x301Set Short Timer The function block FB_DALIV2x301Set Short Timer sets the value of the SHORT TIMER. The unit is 20 ms. The maximum permissible value is 5100 ms. The minimum permissible value can be queried with the function block FB_DALIV2x301Query Short Timer Min [} 391]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; 396 Version: 2.2.0 TE1000
## Page 397

Programming e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Short : BYTE := 25; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Short BYTE Value of the SHORT TIMER [20 ms] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 397
## Page 398

Programming 4.1.2.9.10 FB_DALIV2x301Set Stuck Timer The function block FB_DALIV2x301Set Stuck Timer sets the value of the STUCK TIMER. The unit is 1 s. The permissible value range is from 5 s to 255 s. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Stuck : BYTE := 20; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Stuck BYTE Value of the STUCK TIMER [s] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR 398 Version: 2.2.0 TE1000
## Page 399

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.10 Part 303 (occupancy sensor) Function blocks A detailed description of the individual DALI commands and the variables can be found in standard IEC 62386 Part 303. Name Description FB_DALIV2x303Cancel Hold Timer [} 399] Terminates the HOLD TIMER prematurely. FB_DALIV2x303Catch Movement [} 401] After calling this command, an event is only sent once if a movement is detected. FB_DALIV2x303Query Catching [} 402] Queries whether the system is waiting for the detection of movement. FB_DALIV2x303Query Deadtime Timer [} 403] Queries the value of the DEADTIME TIMER. FB_DALIV2x303Query Hold Timer [} 404] Queries the value of the HOLD TIMER. FB_DALIV2x303Query Report Timer [} 406] Queries the value of the REPORT TIMER. FB_DALIV2x303Set Deadtime Timer [} 407] Sets the value of the DEADTIME TIMER. FB_DALIV2x303Set Hold Timer [} 408] Sets the value of the HOLD TIMER. FB_DALIV2x303Set Report Timer [} 410] Sets the value of the REPORT TIMER. 4.1.2.10.1 FB_DALIV2x303Cancel Hold Timer The function block FB_DALIV2x303Cancel Hold Timer terminates the HOLD TIMER prematurely. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; TE1000 Version: 2.2.0 399
## Page 400

Programming n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 400 Version: 2.2.0 TE1000
## Page 401

Programming 4.1.2.10.2 FB_DALIV2x303Catch Movement After calling this command, an event is sent once if a movement is detected. For this function the event filter must be configured accordingly. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 401
## Page 402

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.10.3 FB_DALIV2x303Query Catching The function block FB_DALIV2x303Query Catching queries whether the system is waiting for a movement to be detected. This function can be activated by FB_DALIV2x303Catch Movement [} 401]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 402 Version: 2.2.0 TE1000
## Page 403

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Catching : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Catching BOOL Catching active Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.10.4 FB_DALIV2x303Query Deadtime Timer Queries the value of the DEADTIME TIMER. The unit is 50 ms. The permissible value range is from 0 s to 12.75 s. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group TE1000 Version: 2.2.0 403
## Page 404

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Deadtime : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Deadtime BYTE Value of the DEADTIME TIMER [50 ms] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.10.5 FB_DALIV2x303Query Hold Timer The function block FB_DALIV2x303Query Hold Timer queries the value of the HOLD TIMER. 404 Version: 2.2.0 TE1000
## Page 405

Programming The unit is 10 s. The permissible value range is from 1 s to 42.3 min. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Hold : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Hold BYTE Value of the HOLD TIMER [10 s] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 405
## Page 406

Programming 4.1.2.10.6 FB_DALIV2x303Query Report Timer The function block FB_DALIV2x303Query Report Timer queries the value of the REPORT TIMER. The unit is 1 s. The permissible value range is from 1 s to 4 min 15 s. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Report : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 406 Version: 2.2.0 TE1000
## Page 407

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Report BYTE Value of the REPORT TIMER [s] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.10.7 FB_DALIV2x303Set Deadtime Timer The function block FB_DALIV2x303Set Deadtime Timer sets the value of the DEADTIME TIMER. The unit is 50 ms. The permissible value range is from 0 s to 12.75 s. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Deadtime : BYTE := 2; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Deadtime BYTE Value of the DEADTIME TIMER [50 ms] TE1000 Version: 2.2.0 407
## Page 408

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.10.8 FB_DALIV2x303Set Hold Timer The function block FB_DALIV2x303Set Hold Timer sets the value of the HOLD TIMER. If the value 0 is transferred, the HOLD TIME is set to 1 s. Incrementing takes place in 10 s steps. The permissible value range is 1 s to 42.3 min. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Hold : BYTE := 90; END_VAR 408 Version: 2.2.0 TE1000
## Page 409

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Hold BYTE Value of the HOLD TIMER [10 s]. The value 0 corresponds to 1 s. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 409
## Page 410

Programming 4.1.2.10.9 FB_DALIV2x303Set Report Timer The function block FB_DALIV2x303Set Report Timer sets the value of the REPORT TIMER. The unit is 1 s. The permissible value range is from 1 s to 4 min 15 s. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Report : BYTE := 20; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Report BYTE Value of the REPORT TIMER [s] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR 410 Version: 2.2.0 TE1000
## Page 411

Programming Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.11 Part 304 (brightness sensors) Function blocks A detailed description of the individual DALI commands and the variables can be found in standard IEC 62386 Part 304. Name Description FB_DALIV2x304Query Deadtime Timer [} 411] Queries the value of the DEADTIME TIMER. FB_DALIV2x304Query Hysteresis [} 413] Queries the hysteresis value. FB_DALIV2x304Query Hysteresis Min [} 414] Queries the value for the minimum possible hysteresis. FB_DALIV2x304Query Report Timer [} 415] Queries the value of the REPORT TIMER. FB_DALIV2x304Set Deadtime Timer [} 416] Sets the value of the DEADTIME TIMER. FB_DALIV2x304Set Hysteresis [} 418] Sets the hysteresis value. FB_DALIV2x304Set Hysteresis Min [} 419] Sets the value for the minimum possible hysteresis. FB_DALIV2x304Set Report Timer [} 420] FB_DALIV2x304Set Report Timer 4.1.2.11.1 FB_DALIV2x304Query Deadtime Timer The function block FB_DALIV2x304Query Deadtime Timer queries the value of the DEADTIME TIMER. The unit is 50 ms. The permissible value range is from 0 s to 12.75 s. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; TE1000 Version: 2.2.0 411
## Page 412

Programming e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Deadtime : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Deadtime BYTE Value of the DEADTIME TIMER [50 ms] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 412 Version: 2.2.0 TE1000
## Page 413

Programming 4.1.2.11.2 FB_DALIV2x304Query Hysteresis The function block FB_DALIV2x304Query Hysteresis queries the value for the hysteresis. The hysteresis is given in % and is within the range 0 % to 25 %. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Hysteresis : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 413
## Page 414

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Hysteresis BYTE Hysteresis in %. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.11.3 FB_DALIV2x304Query Hysteresis Min The function block FB_DALIV2x304Query Hysteresis Min queries the value for the minimum possible hysteresis. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR 414 Version: 2.2.0 TE1000
## Page 415

Programming Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Hysteresis Min : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Hysteresis Min BYTE Minimum possible hysteresis Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.11.4 FB_DALIV2x304Query Report Timer The function block FB_DALIV2x304Query Report Timer queries the value of the REPORT TIMER. The unit is 1 s. The permissible value range is from 1 s to 4 min 15 s. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group TE1000 Version: 2.2.0 415
## Page 416

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Report : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Report BYTE Value of the REPORT TIMER [s] Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.11.5 FB_DALIV2x304Set Deadtime Timer 416 Version: 2.2.0 TE1000
## Page 417

Programming The function block FB_DALIV2x304Set Deadtime Timer sets the value of the DEADTIME TIMER. The unit is 50 ms. The permissible value range is from 0 s to 12.75 s. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Deadtime : BYTE := 2; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). TE1000 Version: 2.2.0 417
## Page 418

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.11.6 FB_DALIV2x304Set Hysteresis The function block FB_DALIV2x304Set Hysteresis sets the value of the hysteresis. The hysteresis is given in % and is within the range 0 % to 25 %. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Hysteresis : BYTE := 5; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Hysteresis BYTE Hysteresis in % Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). 418 Version: 2.2.0 TE1000
## Page 419

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.11.7 FB_DALIV2x304Set Hysteresis Min The function block FB_DALIV2x304Set Hysteresis Min sets the value for the minimum possible hysteresis. Since the hysteresis is given as a percentage, the absolute value of the hysteresis depends on the actual measured value. For very small measured values, the hysteresis is therefore also very small. This causes unnecessary events to be sent. For this reason, a minimum possible hysteresis can be set. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Hysteresis Min : BYTE := 0; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] TE1000 Version: 2.2.0 419
## Page 420

Programming Name Type Description n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Hysteresis Min BYTE Minimum possible hysteresis Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.2.11.8 FB_DALIV2x304Set Report Timer The function block FB_DALIV2x304Set Report Timer sets the value of the REPORT TIMER. The unit is 1 s. The permissible value range is from 1 s to 4 min 15 s. 420 Version: 2.2.0 TE1000
## Page 421

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; n Inst Addr : BYTE := 0; e Inst Addr Type : E_DALIV2Inst Addr Type := e DALIV2Inst Addr Type Number; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Report : BYTE := 30; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] n Inst Addr BYTE Address of the instance within the DALI control device e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Report BYTE Value of the REPORT TIMER [s] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 421
## Page 422

Programming 4.1.3 Third-party function blocks 4.1.3.1 Interior Automation The Interior Automation company has defined its own DALI commands for PIR sensors. These commands extend beyond the possible DALI commands in accordance with the IEC 62386 standard. Please contact Interior Automation for a more detailed description of the commands. Function blocks Description FB_DALIV2IAPIR [} 422] This function block cyclically reads the status of an IA PIR sensor and scales the measured brightness and detected presence based on the received value. FB_DALIV2IAPIRPhysical Indicator Off Deactivates the red LED. FB_DALIV2IAPIRPhysical Indicator On Activates the red LED. FB_DALIV2IAPIRQuery Extended Version Reads the software version number. FB_DALIV2IAPIRQuery Flags Reads the properties. FB_DALIV2IAPIRQuery Sensitivity Reads the sensor sensitivity. FB_DALIV2IAPIRQuery Timeout Reads the time-out. FB_DALIV2IAPIRStart Identification Makes the green LED flash for 10 seconds. FB_DALIV2IAPIRStore DTRAs Flags Saves the data in the Data Transfer Register (DTR) as properties. FB_DALIV2IAPIRStore DTRAs Sensitivity Saves the data in the Data Transfer Register (DTR) as sensor sensitivity. FB_DALIV2IAPIRStore DTRAs Timeout Saves the data in the Data Transfer Register (DTR) as Time-out. These commands belong to the application extended commands for DALI devices. These only work if they are preceded by the command Enable Device Type 128, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 128 is automatically placed internally before all application extended commands for DALI devices. 4.1.3.1.1 FB_DALIV2IAPIR This function block FB_DALIV2IAPIR cyclically reads the status of an IA PIR sensor and scales the measured brightness and detected occupancy based on the received value. Two different cycle times can be specified. One cycle time that is used if no occupancy is detected and one that is used in case of occupancy. In this way access to the DALI bus can be minimized. If occupancy is detected a slower cycle time (e.g. 20 s) can usually be selected, because light control and switching off the lighting is not time-critical. If there is no occupancy, then a shorter cycle time (e.g. 2 s) should be selected. As a result, the lighting is switched on with the shortest possible reaction time when the room is entered. Further information and a description of the electrical and physical properties can be found in the product description for the IA PIR sensor. 422 Version: 2.2.0 TE1000
## Page 423

Programming Inputs VAR_INPUT b Read Directly : BOOL := FALSE; t Cycle Time If Occupancy : TIME := t#20s; t Cycle Time If No Occupancy : TIME := t#2s; n Addr : BYTE := 0; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Read Directly BOOL The function block is activated by a positive edge at this input. t Cycle Time If Occupa TIME Cycle time if occupancy ncy t Cycle Time If No Occu TIME Cycle time if no occupancy pancy n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Inst Addr Type E_DALIV2Inst Addr Type Defines the access mode to the desired instance within the DALI control device. [} 463] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Occupancy : BOOL; n Brightness : INT; n Raw Value : BYTE; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Occupancy BOOL The output is set if the sensor detects occupancy. n Brightness INT Measured brightness in lux n Raw Value BYTE The value of the sensor read before the conversion b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. TE1000 Version: 2.2.0 423
## Page 424

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.3.2 B. E. G. Function blocks The company B. E. G. has defined its own special DALI commands. These commands extend beyond the possible DALI commands in accordance with the IEC 62386 standard. However, these commands can only be used for certain B. E. G devices. Please contact B. E. G for a more detailed description of the commands. Name Description FB_DALIV2x BEGLuxomat [} 424] This function block evaluates the measured brightness and presence of the B. E. G. Luxomat DALI control unit. This function block can also be used to initialize the DALI control units. 4.1.3.2.1 FB_DALIV2x BEGLuxomat The function block FB_DALIV2x BEGLuxomat serves as an example and is not included in the library. The function block can be downloaded as an export file and imported into the desired project. Adjustments can be made as required. The function block FB_DALIV2x BEGLuxomat evaluates the measured brightness and the occupancy of the B. E. G. Luxomat DALI control device. This function block can also be used to initialize the DALI control device. The DALI control device occupies a short address and contains two instances. Instance 0 is the motion sensor and complies with the IEC 62386-303 standard. The light sensor is stored in Instance 1 and complies with the IEC 62386-304 standard. A detected movement is sent as an event while the brightness is read cyclically. Each instance can be disabled individually as required. Download the Twin CAT 3 PLCopen XML file: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_dali/ Resources/4528383755.zip Inputs VAR_INPUT b Initialize : BOOL := FALSE; n Addr : BYTE; (* Occupancy Sensor Parameters *) 424 Version: 2.2.0 TE1000
## Page 425

Programming b PIREnable : BOOL := TRUE; n PIRHold : BYTE := 1; (* 10 s *) n PIRReport : BYTE := 30; (* 30 s *) (* Light Sensor Parameters *) b LSEnable : BOOL := TRUE; t LSCycle Time : TIME := t#1m; END_VAR Name Type Description b Initialize BOOL The DALI control device is initialized via a positive edge at this input. The parameters are written to the DALI control device, which must be accessible via the short address n Addr. The output b Initializing is TRUE during initialization. n Addr BYTE The address of a device or of a group b PIREnable BOOL Parameter: If this input is TRUE, the motion sensor (instance 0) is enabled. The occupancy sensor is disabled by FALSE. n PIRHold BYTE Parameter: Sets the value for the Hold Timer. If no movement is detected, the status of the motion sensor is only changed after the Hold Timer has expired. The unit is 10 s. This means that times of up to 42 min 20 s (value 254) are possible. The value 0 corresponds to 1 s while the value 255 is ignored. n PIRReport BYTE Sets the value for the Report Timer. The motion sensor status is retransmitted after the Report Timer has expired, even if the status has not changed. The unit is 1 s. A value of 0 deactivates the Report Timer. This means that times of up to 4 min 15 s (value 255) are possible. b LSEnable BOOL Parameter: If this input is TRUE, the light sensor (instance 1) is enabled. The light sensor is disabled by FALSE. t LSCycle Time TIME Cycle time in which the current actual value of the light sensor is read. Further details on the parameters can be found in the IEC 62386 standard and the manufacturer's documentation. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Initializing : BOOL; b Error : BOOL; n Error Id : UDINT; n Input Device Error : BYTE; (* Occupancy Sensor *) b PIROccupied : BOOL; (* Light Sensor *) n Actual Light Level : UINT; END_VAR Name Type Description b Initializing BOOL This output is TRUE during initialization. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. TE1000 Version: 2.2.0 425
## Page 426

Programming Name Type Description n Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 438]). n Input Device Error BYTE The status of the DALI control device (INPUT DEVICE ERROR) is queried before the initialization. 0 means no error. The individual error numbers are manufacturer- specific. b PIROccupied BOOL This output indicates the status of the motion sensor. n Actual Light Level UINT This output indicates the status of the light sensor. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.3.3 Osram Function blocks Osram has defined its own special DALI commands. These commands extend beyond the possible DALI commands in accordance with the IEC 62386 standard. However, these commands are only applicable to certain Osram devices. Please contact Osram for a more detailed description of the commands. Name Description FB_DALIV2x Osram Prof Sensor Coupler [} 428] This function block evaluates the measured brightness and occupancy of the Osram DALI Professional Sensor Coupler. This function block can also be used to initialize the DALI control devices. FB_DALIV2x Osram Prof Pushbutton Coupler [} 427] This function block evaluates the status of the digital input of the Osram DALI Professional Pushbutton Coupler. This function block can also be used to initialize the DALI control device. FB_DALIV2x Osram Disable Signal Mode Disables the Input Signal Mode for a channel. FB_DALIV2x Osram Enable Signal Mode Enables the Input Signal Mode for a channel. FB_DALIV2x Osram Query Configuration Id Reads the configuration for a channel. FB_DALIV2x Osram Query Input Device Type Reads the device type. FB_DALIV2x Osram Query Input Value Reads the input value of a channel. FB_DALIV2x Osram Query Resolution Queries the resolution of the input values of the control device. FB_DALIV2x Osram Store Configuration Id Writes the configuration for a channel. FB_DALIV2x Osram Identify Selected Device Starts the identification routine for the selected control device (random address and search address are the same). FB_DALIV2x Osram Query Channel Size Reads the number of channels supported by the control device. FB_DALIV2x Osram Query Configuration Feature Reads the possible configuration values for a channel. FB_DALIV2x Osram Query Device Error Queries whether the control device has detected an error FB_DALIV2x Osram Query Status Reads the device status. FB_DALIV2x Osram Read Memory Location A byte is read from the memory of the control device. 426 Version: 2.2.0 TE1000
## Page 427

Programming 4.1.3.3.1 FB_DALIV2x Osram Prof Pushbutton Coupler The function block FB_DALIV2x Osram Prof Pushbutton Coupler serves as an example and is not included in the library. The function block can be downloaded as an export file and imported into the desired project. Adjustments can be made as required. The function block FB_DALIV2x Osram Prof Pushbutton Coupler evaluates the state of the digital input of the Osram DALI Professional Pushbutton Coupler. This function block can also be used to initialize the DALI control device. The DALI control device occupies a short address. The device does not fully comply with the IEC 62386 standard and uses a company-specific protocol instead. Download the Twin CAT 3 PLCopen XML file: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_dali/ Resources/4528385931.zip Inputs VAR_INPUT b Initialize : BOOL := FALSE; n Addr : BYTE; END_VAR Name Type Description b Initialize BOOL The DALI control device is initialized via a positive edge at this input. The parameters are written to the DALI control device, which must be accessible via the short addresses n PIRAddr and n LSAddr. The output b Initializing is TRUE during initialization. n Addr BYTE Short address of the DALI control device Further details about the parameters can be found in the manufacturer's documentation. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Initializing : BOOL; b Error : BOOL; n Error Id : UDINT; n Device Status : BYTE; b Pushbutton : BOOL; END_VAR Name Type Description b Initializing BOOL This output is TRUE during initialization. TE1000 Version: 2.2.0 427
## Page 428

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. n Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 438]). n Device Status BYTE Before the initialization, the status of the DALI control device is queried and output to this output. b Pushbutton BOOL This output indicates the actual value of the digital input. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.3.3.2 FB_DALIV2x Osram Prof Sensor Coupler This function block is used as an example and is not included in the library. The function block can be downloaded as an export file and imported into the desired project. Adjustments can be made as required. The function block FB_DALIV2x Osram Prof Sensor Coupler evaluates the measured brightness and the occupancy of the Osram DALI Professional Sensor Coupler. This function block can also be used to initialize the DALI control device. The motion sensor and the light sensor have separate short addresses. The DALI control device thus occupies two short addresses. The device does not fully comply with the IEC 62386 standard and uses a company-specific protocol instead. A detected movement is sent as an event while the brightness is read cyclically. Download the Twin CAT 3 PLCopen XML file: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_dali/ Resources/4528413707.zip Inputs VAR_INPUT b Initialize : BOOL := FALSE; (* Occupancy Sensor Parameters *) n PIRAddr : BYTE; t PIRBlanking Time : TIME := T#1M; (* Light Sensor Parameters *) n LSAddr : BYTE; t LSCycle Time : TIME := T#1M; END_VAR Name Type Description b Initialize BOOL The DALI control device is initialized via a positive edge at this input. The parameters are written to the DALI control device, which must be accessible via the short addresses n PIRAddr and n LSAddr. The output b Initializing is TRUE during initialization. 428 Version: 2.2.0 TE1000
## Page 429

Programming Name Type Description n PIRAddr BYTE Short address of the DALI control device for the motion sensor t PIRBlanking Time TIME Parameter: Once the status of the motion sensor was sent, no further changes are sent for this time. The unit is 1 s. This means that times of up to 4 min 15 s (value 255) are possible. n LSAddr BYTE Short address of the DALI control device for the light sensor t LSCycle Time TIME Cycle time in which the current actual value of the light sensor is read. Further details about the parameters can be found in the manufacturer's documentation. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Initializing : BOOL; b Error : BOOL; n Error Id : UDINT; (* Occupancy Sensor *) n PIRStatus : BYTE; b PIROccupied : BOOL; (* Light Level *) n LSStatus : BYTE; n Actual Light Level : WORD; END_VAR Name Type Description b Initializing BOOL This output is TRUE during initialization. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. n Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 438]). n PIRStatus BYTE Before the initialization, the status of the DALI control device for the motion sensor is queried and output at this output. b PIROccupied BOOL This output indicates the actual value of the motion sensor. n LSStatus BYTE Before the initialization, the status of the DALI control device for the light sensor is queried and output at this output. n Actual Light Level WORD This output indicates the actual value of the light sensor. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 TE1000 Version: 2.2.0 429
## Page 430

Programming 4.1.3.4 Philips discharge lamps Function blocks The Philips company has defined its own DALI commands for special discharge lamps. These commands extend beyond the possible DALI commands in accordance with the standard IEC 62386 Part 203. However, these commands are only usable for certain Philips control gears. Please contact Philips for a more detailed description of the commands. Name Description FB_DALIV2Philips Change PAEC Activates or deactivates the "Application Extended Command Set". FB_DALIV2Philips Query Ctrl Gear Operation Time Reads the execution time of the control gear. FB_DALIV2Philips Query Ctrl Gear Overtemp Level Reads the overtemperature threshold value of the control gear. FB_DALIV2Philips Query Ctrl Gear Overtemp Time Reads the overtemperature time of the control gear. FB_DALIV2Philips Query Ctrl Gear Temperature Reads the temperature of the control gear. FB_DALIV2Philips Query Failure Status Reads the error state. FB_DALIV2Philips Query HIDLamp Level Reads the lamp status. FB_DALIV2Philips Query HIDMax Fade Down Rate Reads the maximum fade down rate. FB_DALIV2Philips Query HIDMax Fade Up Rate Reads the maximum fade up rate. FB_DALIV2Philips Query Lamp Type Reads the lamp type. FB_DALIV2Philips Query Lamp Voltage Reads the lamp voltage. FB_DALIV2Philips Query Mains Voltage Reads the mains voltage. FB_DALIV2Philips Query Timeout Reads the time-out. FB_DALIV2Philips Query UICByte Reads a byte of the UIC. FB_DALIV2Philips Set DTRAs Segment Address Saves the data contained in the Data Transfer Register (DTR) to the Segment Address Register. FB_DALIV2Philips Set Test Mode Sets the control gear to test mode. FB_DALIV2Philips Store DTRAs Lamp Type Saves the data in the Data Transfer Register (DTR) as lamp type. FB_DALIV2Philips Store DTRAs Overtemp Level Saves the data in the Data Transfer Register (DTR) as overtemperature threshold value. FB_DALIV2Philips Store DTRAs Segment Address Saves the data in the Data Transfer Register (DTR) as Segment Address Register. FB_DALIV2Philips Store DTRAs Timeout Saves the data in the Data Transfer Register (DTR) as Time-out. These commands belong to the application extended commands for DALI discharge lamps. These only work if they are preceded by the Enable Device Type 2 command, which can be sent with the function block FB_DALIV2Enable Device Type [} 92]. The command Enable Device Type 2 is automatically placed internally before all application extended commands for DALI discharge lamps. 4.1.3.4.1 Variables Name Default value Reset value Scope Size Comment PAEC_ENABLE 0 No change 0 ... 1 1 byte D CONTROL 0 No change 0 ... 255 1 byte GEAR SEGMENT ADDRESS SEGMENT 0 0 0 ... 255 1 byte ADDRESS 430 Version: 2.2.0 TE1000
## Page 431

Programming Name Default value Reset value Scope Size Comment UIC Manufacturer No change 00 00 00 00 00 8 bytes read only dependent 00 00 00 ... FF FF FF FF FF FF FF FF LAMPTYPE 0 No change 0 ... 255 1 byte HID LAMP ???? ???? 0 0 ... 255 1 byte LEVEL FADE UP 0 No change 0 ... 255 1 byte FADE DOWN 0 No change 0 ... 255 1 byte FAILURE 0 0 0 ... 255 1 byte STATUS OPERATION 0 No change 0 ... 255 1 byte TIME OVERTEMPERA 0 No change 0 ... 255 1 byte TURE TIME CONTROL 0 0 0 ... 255 1 byte GEAR TEMPERATURE OVERTEMPERA 255 No change 0 ... 255 1 byte TURE LEVEL TIMEOUT 0 No change 0 ... 255 1 byte MAINS 0 0 0 ... 255 1 byte VOLTAGE LAMP 0 0 0 ... 255 1 byte VOLTAGE ?: undetermined 4.1.3.5 Steinel Function blocks Steinel has defined its own DALI commands. These commands extend beyond the possible DALI commands in accordance with the IEC 62386 standard. However, these commands are only applicable to certain Steinel devices. Please contact Steinel for a more detailed description of the commands. Name Description FB_DALIV2x Steinel Live Link Motion Sensor [} 432] This function block evaluates the measured brightness and occupancy of the Steinel Live Link DALI control device. This function block can also be used to initialize the DALI control device. FB_DALIV2x Steinel Set Brightness Change Level Sets the Brightness Change Level value. FB_DALIV2x Steinel Set Brightness Change Timer Sets the time for the Brightness Change Timer. FB_DALIV2x Steinel Set Event Filter This function block sets the event filter for the respective control device instance. FB_DALIV2x Steinel Set Motion Detection Range Sets the size of the detection range. FB_DALIV2x Steinel Set Motion Timer Sets the time for the Motion Timer FB_DALIV2x Steinel Set Motion Timer Repeat Sets the time for Motion Timer Repeat. FB_DALIV2x Steinel Set Motion Verification Level Sets the sensitivity for the motion sensor. FB_DALIV2x Steinel Set Signal Led Status Switches the LEDs in the control device. FB_DALIV2x Steinel Query Brightness Change Level Queries the Brightness Change Level. FB_DALIV2x Steinel Query Brightness Change Timer Queries the time for the Brightness Change Timer. FB_DALIV2x Steinel Query Event Filter Queries the event filter for the respective control device instance. TE1000 Version: 2.2.0 431
## Page 432

Programming Name Description FB_DALIV2x Steinel Query Motion Detection Range Queries the size of the detection range. FB_DALIV2x Steinel Query Motion Timer Queries the time of the Motion Timer. FB_DALIV2x Steinel Query Motion Timer Repeat Queries the time of the Motion Timer Repeat. FB_DALIV2x Steinel Query Motion Verification Level Queries the sensitivity of the motion sensor. FB_DALIV2x Steinel Query Sensor Type Queries the sensor type. FB_DALIV2x Steinel Query Signal Led Status Queries the LEDs in the control device. 4.1.3.5.1 FB_DALIV2x Steinel Live Link Motion Sensor This function block FB_DALIV2x Steinel Live Link Motion Sensor serves as an example and is not included in the library. The function block can be downloaded as an export file and imported into the desired project. Adjustments can be made as required. The function block FB_DALIV2x Steinel Live Link Motion Sensor evaluates the measured brightness and the occupancy of the Steinel Live Link DALI control device. This function block can also be used to initialize the DALI control device. The DALI control device occupies a short address and contains 2 instances. Instance 1 contains the motion sensor, instance 0 the light sensor. The device does not fully comply with the IEC 62386 standard and uses a company-specific protocol instead. A detected movement is sent as an event while the brightness is read cyclically. Each instance can be disabled individually as required. Download the Twin CAT 3 PLCopen XML file: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_dali/ Resources/4528415883.zip Inputs VAR_INPUT b Initialize : BOOL := FALSE; n Addr : BYTE; (* Occupancy Sensor Parameters *) b PIREnable : BOOL := TRUE; n PIRMotion : BYTE := 4; (* 5 s + (n PIRMotion 5 s) *) n PIRRepeat : BYTE := 6; (* 5 s + (n PIRRepeat 5 s) *) n PIRVerification Level : BYTE := 1; (* standard *) n PIRDetection Range : BYTE := 255; (*(only for HF sensors) 100 % *) (* Light Sensor Parameters *) b LSEnable : BOOL := TRUE; t LSCycle Time : TIME := T#1M; END_VAR Name Type Description b Initialize BOOL The DALI control device is initialized via a positive edge at this input. The parameters are written to the DALI control device, which must be accessible via the short address n Addr. The output b Initializing is TRUE during initialization. 432 Version: 2.2.0 TE1000
## Page 433

Programming Name Type Description n Addr BYTE Short address of the DALI control device b PIREnable BOOL Parameter: If this input is TRUE, the motion sensor (instance 1) is enabled. The occupancy sensor is disabled by FALSE. n PIRMotion BYTE Parameter: Sets the value for the Motion Timer. If no movement is detected, the status of the motion sensor is not changed until the Motion Timer has expired. The time is calculated based on the formula 5 s + n PIRMotion * 5 s. This means that times from 5 s to 21 min 20 s are possible. n PIRRepeat BYTE Parameter: Sets the value for the Repeat Timer. The motion sensor status is retransmitted after the Repeat Timer has expired, even if the status has not changed. The time is calculated based on the formula 5 s + n PIRRepeat * 5 s. This means that times from 5 s to 21 min 20 s are possible. n PIRVerification Lev BYTE Parameter: The detection sensitivity can be adjusted (0: el motion detection disabled, 1: very sensitive to 15: very insensitive). n PIRDetection Rang BYTE Parameter: If an HF sensor is used, the size of the e detection range can be set (0: 0 % to 255: 100 %). b LSEnable BOOL Parameter: If this input is TRUE, the light sensor (instance 0) is enabled. The light sensor is disabled by FALSE. t LSCycle Time TIME Cycle time in which the current actual value of the light sensor is read. Further details on the parameters can be found in the IEC 62386 standard and the manufacturer's documentation. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Initializing : BOOL; b Error : BOOL; n Error Id : UDINT; n Input Device Error : BYTE; (* Occupancy Sensor *) b PIROccupied : BOOL; (* Light Sensor *) n Actual Light Level : UINT; END_VAR Name Type Description b Initializing BOOL This output is TRUE during initialization. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. n Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 438]). TE1000 Version: 2.2.0 433
## Page 434

Programming Name Type Description n Input Device Error BYTE The status of the DALI control device (INPUT DEVICE ERROR) is queried before the initialization. 0 means no error. The individual error numbers are manufacturer- specific. b PIROccupied BOOL This output indicates the status of the motion sensor. n Actual Light Level UINT This output indicates the actual value of the light sensor. Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.3.6 Tridonic Function blocks Name Description FB_DALIV2Smart SPOT [} 434] This function block cyclically reads the status of a smart SPOT sensor or MSensor 02 and scales the measured brightness and detected presence based on the received value. 4.1.3.6.1 FB_DALIV2Smart SPOT The function block FB_DALIV2Smart SPOT cyclically reads the status of a smart SPOT sensor or MSensor 02 and scales the measured brightness and the detected occupancy from the received value. Two different cycle times can be specified. One cycle time that is used if no occupancy is detected and one that is used in case of occupancy. In this way access to the DALI bus can be minimized. If occupancy is detected a slower cycle time (e.g. 20 s) can usually be selected, because light control and switching off the lighting is not time-critical. If there is no occupancy, then a shorter cycle time (e.g. 2 s) should be selected. As a result, the lighting is switched on with the shortest possible reaction time when the room is entered. The measured brightness of the sensor depends on the reflection of the furniture in the room. The measured value is only 20 % to 40 % of the actual brightness of the respective surface. Example: 500 lux on the table with a reflectivity of 30 % results in a brightness value of 150 lux. The measuring range of the sensor is designed so that the usual brightness at the workplace can be controlled from 200 lux to 1000 lux. If the function block with MSensor 02 is to be used, it must be in slave mode. Further information and a description of the electrical and physical properties can be found in the product description of the smart SPOT sensor or the MSensor 02. Inputs VAR_INPUT b Read Directly : BOOL := FALSE; t Cycle Time If Occupancy : TIME := t#20s; t Cycle Time If No Occupancy : TIME := t#2s; n Addr : BYTE := 0; 434 Version: 2.2.0 TE1000
## Page 435

Programming e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Read Directly BOOL The function block is enabled by a positive edge at this input. t Cycle Time If Occupa TIME Cycle time if occupancy ncy t Cycle Time If No Occu TIME Cycle time if no occupancy pancy n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Occupancy : BOOL; n Brightness : INT; n Raw Value : BYTE; b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Occupancy BOOL The output is set if the sensor detects occupancy. n Brightness INT Measured brightness in lux n Raw Value BYTE The value of the sensor read before the conversion b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 435
## Page 436

Programming 4.1.3.7 Theben HTS Function blocks The company Theben has defined its own DALI commands. These commands extend beyond the possible DALI commands in accordance with the IEC 62386 standard. However, these commands can only be used for certain Theben devices. Please contact Theben for a more detailed description of the commands. Name Description FB_DALIV2x Theben Plano Spot360 [} 436] This function block evaluates the 3 measured brightness values and the presence of the Theben HTS Plano Spot DALI control unit. This function block can also be used to initialize the DALI control units. 4.1.3.7.1 FB_DALIV2x Theben Plano Spot360 The function block FB_DALIV2x Theben Plano Spot360 serves as an example and is not included in the library. The function block can be downloaded as an export file and imported into the desired project. Adjustments can be made as required. The function block FB_DALIV2x Theben Plano Spot360 evaluates the measured brightness and the occupancy of the Theben HTS Plano Spot DALI control device. This function block can also be used to initialize the DALI control device. The DALI control device occupies a short address and contains 5 instances. Instance 0 is the motion sensor and complies with the IEC 62386-303 standard. The light sensors are stored in instances 1 to 4 and comply with the IEC 62386-304 standard. A detected movement is sent as an event, while the brightness values are read cyclically. Each instance can be disabled individually as required. Download the Twin CAT 3 PLCopen XML file: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_dali/ Resources/4528418059.zip Inputs VAR_INPUT b Initialize : BOOL := FALSE; n Addr : BYTE; (* Occupancy Sensor Parameters *) b PIREnable : BOOL := TRUE; n PIRHold : BYTE := 1; (* 10 s *) n PIRReport : BYTE := 30; (* 30 s *) n PIRSensitivity : BYTE := 3; (* standard *) n PIRDetection Range : BYTE := 0; (* standard *) (* Light Sensor Parameters *) arr LSEnable : ARRAY [1..4] OF BYTE := TRUE, TRUE, TRUE, TRUE; 436 Version: 2.2.0 TE1000
## Page 437

Programming arr LSRoom Correction Value : ARRAY [1..4] OF BYTE := 30, 30, 30, 30; (* 0.3 *) t LSCycle Time : TIME := T#1M; END_VAR Name Type Description b Initialize BOOL The DALI control device is initialized via a positive edge at this input. The parameters are written to the DALI control device, which must be accessible via the short address n Addr. The output b Initializing is TRUE during initialization. n Addr BYTE Short address of the DALI control device b PIREnable BOOL Parameter: If this input is TRUE, the motion sensor (instance 0) is enabled. The occupancy sensor is disabled by FALSE. n PIRHold BYTE Parameter: Sets the value for the Hold Timer. If no movement is detected, the status of the motion sensor is only changed after the Hold Timer has expired. The unit is 10 s. This means that times of up to 42 min 20 s (value 254) are possible. The value 0 corresponds to 1 s while the value 255 is ignored. n PIRReport BYTE Parameter: Sets the value for Report Timer. The motion sensor status is retransmitted after the Report Timer has expired, even if the status has not changed. The unit is 1 s. A value of 0 deactivates the Report Timer. This means that times of up to 4 min 15 s (value 255) are possible. n PIRSensitivity BYTE Parameters: The detection sensitivity can be adjusted in five levels (1: very insensitive to 5: very sensitive). n PIRDetection Rang BYTE Parameters: The sensor supports two different sizes for e the detection range (0: Standard and 1: Reduced). arr LSEnable ARRAY Parameter: If this input is TRUE, the light sensor (instance 1 to 4) is enabled. The light sensor is disabled by FALSE. arr LSRoom Correctio ARRAY Parameter: The room correction factor can be used to n Value compare the measured value of the light sensor with a reference device (luxmeter). t LSCycle Time TIME Cycle time in which the current actual value of the light sensor is read. Further details on the parameters can be found in the IEC 62386 standard and the manufacturer's documentation. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Initializing : BOOL; b Error : BOOL; n Error Id : UDINT; n Input Device Error : BYTE; (* Occupancy Sensor *) b PIROccupied : BOOL; (* Light Sensor *) n Actual Light Level01 : UINT; (* Light sensor 1 (integral) *) n Actual Light Level02 : UINT; (* Light sensor 2 (inner) *) TE1000 Version: 2.2.0 437
## Page 438

Programming n Actual Light Level03 : UINT; (* Light sensor 3 (middle) *) n Actual Light Level04 : UINT; (* Light sensor 4 (window) *) END_VAR Name Type Description b Initializing BOOL This output is TRUE during initialization. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Input Device Error BYTE The status of the DALI control device (INPUT DEVICE ERROR) is queried before the initialization. 0 means no error. The individual error numbers are manufacturer- specific. b PIROccupied UINT This output indicates the status of the motion sensor. n Actual Light Level01 UINT This output indicates the actual value of the light sensors. ... n Actual Light Level04 Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.1.4 Error codes Value (hex) Value (dec) Description 0x0000 0 No error. 0x0001 1 No response from the DALI terminal. 0x0002 2 No response from the DALI control gear. 0x0003 3 Communication buffer overflow. 0x0004 4 No response from the communication block. 0x0005 5 DALI collision detected on the backward channel: during the transfer of a DALI telegram, a collision with the send data of another DALI slave was detected. 0x0006 6 DALI collision detected on the forward channel: during the transfer of a DALI telegram, a collision with the send data of another DALI master was detected. The error also occurs if the 24 V supply is missing at the power contacts of the KL6811. 0x0007 7 When using the internal DALI power supply of the KL6811: Overload of the internal DALI power supply of the KL6811 (bus undervoltage). 0x0008 8 Parameter e Command Priority lies outside of the valid range. 0x0009 9 Parameter e Address Type lies outside of the valid range. 0x000A 10 Parameter n Addr is a short address and lies outside of the valid range. 0x000B 11 Parameter n Addr is a group address and lies outside of the valid range. 0x000C 12 Parameter n Group lies outside of the valid range. 0x000D 13 Parameter n Scene lies outside of the valid range. 0x000E 14 Parameter n Start With Short Address lies outside of the valid range. 0x000F 15 No further free short addresses. 0x0010 16 Parameter n New Short Address lies outside of the valid range. 0x0011 17 Parameter n Short Address01 lies outside of the valid range. 0x0012 18 Parameter n Short Address02 lies outside of the valid range. 438 Version: 2.2.0 TE1000
## Page 439

Programming Value (hex) Value (dec) Description 0x0013 19 Parameter n Free Short Address lies outside of the valid range. 0x0014 20 The short address in parameter n Free Short Address is occupied within the DALI line. 0x0015 21 Parameter arr Swap Short Address List contains invalid values. 0x0016 22 Parameter n Hysteresis lies outside of the valid range. 0x0017 23 Parameter n Prolong Value lies outside of the valid range. 0x0018 24 Lamp value of the master device is too long 255 -> possible fault. 0x0019 25 Parameter n End Level lies outside of the valid range. 0x001A 26 Target value n End Level has not yet been reached after double the ramp time. 0x001B 27 FB_DALIV2Light Control: There are setpoints (n Setpoint) in the value table arr Control Table that lie outside of the valid DALI range (0..254). 0x001C 28 FB_DALIV2Light Control: The switch range (n Switch Range) in the first or second element of the value table arr Control Table is 0, assuming that the table has no or only one value set. 0x001D 29 FB_DALIV2Light Control: 2 neighboring input values n Actual Value in the value table arr Control Table lie too close together i.e. each in the switching range of the other. 0x001E 30 FB_DALIV2Light Control: A setpoint (n Setpoint) of the value tablearr Control Table lies outside the valid range. Only queried after b Start. 0x001F 31 Internal status query of the master device returns "fading active" for too long after the dimming time. See STATUS INFORMATION [} 88] (Bit4). 0x0020 32 Parameter n Presence Value lies outside of the valid range. 0x0021 33 Timeout during internal addressing (see also FB_DALIV2Addressing Int Random Addressing [} 11]). The terminal has not sent a response following the start of internal addressing. 0x0022 34 The terminal has returned an error during internal addressing (see also FB_DALIV2Addressing Int Random Addressing [} 11]). 0x0023 35 At least one test is currently running or is automatically pending. 0x0024 36 The device is in automatic test mode. 0x0025 37 The batteries of the emergency light device are not fully charged for a duration test. 0x0026 38 Test aborted - no valid emergency mode / emergency status. 0x0027 39 Test aborted: test mode was not reached. 0x0028 40 Test aborted due to timeout. 0x0029 41 Error while processing a DALI command. 0x002A 42 Error while writing into the log file. 0x002B 43 Device is not in "normal mode" 0x002C 44 FB_DALIV2Sequencer: The start index n Start Index is outside the valid range [1..50]. 0x002D 45 FB_DALIV2Sequencer: The start index n Start Index refers to a position which in turn marks the end of a sequence (zero entries). 0x002E 46 FB_DALIV2Change Address List: The change list arr Change Address List is empty. 0x002F 47 FB_DALIV2Change Address List: The change list arr Change Address List contains an invalid short address entry (>63). 0x0030 48 FB_DALIV2Change Address List: The change list arr Change Address List contains a duplicate list entry for the short addresses. 0x0031 49 FB_DALIV2Change Address List: The change list arr Change Address List contains an entry for a new short address that is already assigned to a device that is not affected by the changes. The addresses have been changed back. 0x0032 50 FB_KL6811Config: An error occurred during the configuration of the terminal. TE1000 Version: 2.2.0 439
## Page 440

Programming Value (hex) Value (dec) Description 0x0033 51 FB_KL6811Config: Parameter e Operation Mode lies outside of the valid range. 0x0034 52 The constant DALI_MESSAGE_QUEUE_ENTRIES lies outside of the valid range (2-250). 0x0035 53 The constant DALI_RESPONSE_TABLE_ENTRIES lies outside of the valid range (2-250). 0x0036 54 The constant DALI_EVENT_TABLE_ENTRIES lies outside of the valid range (2-250). 0x0037 55 When using the internal DALI power supply: Power supply fault detected. 0x0038 56 The process image was disabled by the DI1 or DI2 inputs of the terminal. 0x0039 57 Parameter e Inst Addr Type lies outside of the valid range. 0x003A 58 Parameter e Data Frame Type lies outside of the valid range. 0x003B 59 DSI is not supported by the bus terminal. 0x003C 60 Parameter n Event Priority lies outside of the valid range. 0x003D 61 Parameter n Group lies outside of the valid range. 0x003E 62 Parameter n Instance Group lies outside of the valid range. 0x003F 63 Parameter e Event Scheme lies outside of the valid range. 0x0040 64 Parameter e Event Filter lies outside of the valid range. 0x0041 65 Parameter n Inst Addr lies outside of the valid range. 0x0042 66 Parameter e Power Supply Mode lies outside of the valid range. 0x0043 67 Parameter e Command KBus Watchdog lies outside of the valid range. 0x0044 68 Parameter e Command DI1Rising Edge lies outside of the valid range. 0x0045 69 Parameter e Command DI1Falling Edge lies outside of the valid range. 0x0046 70 Parameter e Command DI2Rising Edge lies outside of the valid range. 0x0047 71 Parameter e Command DI2Falling Edge lies outside of the valid range. 0x0048 72 During internal addressing (see also FB_DALIV2Addressing Int Random Addressing [} 11]) the terminal has detected that there is no free short address. 0x0049 73 During internal addressing (see also FB_DALIV2Addressing Int Random Addressing [} 11]), the terminal has recognized that several devices have the same long address. 0x004A 74 Internal addressing (see also FB_DALIV2Addressing Int Random Addressing [} 11]) has failed 3 times. 0x004B 75 The communication buffer for sending the DALI commands was blocked for longer than permitted. 0x004C 76 The constant DALIV2_TIMEOUT_LOCK_MESSAGE_QUEUE lies outside of the valid range (0-2 min). 0x004D 77 During internal addressing (see also FB_DALIV2Addressing Int Random Addressing [} 11]), the terminal has detected a short circuit on the bus. 0x004E 78 Short circuit detected on the DALI bus. Possible causes: - The 24 V supply to the KL6821 is missing. - There is a short circuit on the DALI bus. 0x004F 79 Undervoltage on the DALI bus. Possible causes: - Collision during telegram transmission (several DALI devices may have the same short address). - The internal power supply has been disabled and there is no external bus power supply. 0x0050 80 The received data is flawed. 440 Version: 2.2.0 TE1000
## Page 441

Programming 4.1.5 [obsolete] Function blocks Name Description FB_DALIV2Communication [} 441] Reads the DALI commands from the buffers sequentially and forwards them to the KL6811. FB_DALIV2Enable Write Memory [} 443] Enables write access via FB_DALIV2Write Memory Location [} 181] to the internal memory of the control gear. FB_DALIV2Query Ballast [} 444] Query whether the control gear is ready to operate. FB_DALIV2Query Content DTR [} 445] Reads the DTR (Data Transfer Register). FB_DALIV2Send DALICommand [} 447] This function block is for the general sending of a DALI command, defined by command number and, if necessary, transfer parameter. FB_DALIV2Set DTR [} 448] Writes an 8-bit value into the DTR of all the control gears. FB_DALIV2Store Actual Level In DTR [} 449] Writes the current value of the lamp power into the DTR. FB_DALIV2Store DTRAs Fade Rate [} 451] Writes the value of the DTR into the variable FADE RATE [} 88]. FB_DALIV2Store DTRAs Fade Time [} 452] Writes the value of the DTR into the variable FADE TIME [} 88]. FB_DALIV2Store DTRAs Max Level [} 453] Writes the value of the DTR into the variable MAX LEVEL [} 88]. FB_DALIV2Store DTRAs Min Level [} 454] Writes the value of the DTR into the variable MIN LEVEL [} 88]. FB_DALIV2Store DTRAs Power On Level Writes the value of the DTR into the variable POWER ON LEVEL [} 455] [} 88]. FB_DALIV2Store DTRAs Scene [} 456] Saves the contents of the DTR as the lamp power value for a scene. FB_DALIV2Store DTRAs Short Address Saves the contents of the DTR as a short address, or deletes the short address. [} 458] FB_DALIV2Store DTRAs System Failure Level Writes the value of the DTR into the variable SYSTEM FAILURE [} 459] LEVEL [} 88]. FB_KL6811Config [} 460] This function block can be used to configure the KL6821. 4.1.5.1 FB_DALIV2Communication The function blocks for the DALI commands do not directly access the process image of the KL6811, but store the individual DALI commands in three different buffers. The function block FB_DALIV2Communication sequentially reads the DALI commands from these three buffers and passes the DALI commands to the KL6811. This prevents several function blocks accessing the process image of the KL6811 at the same time. Each of these three buffers is processed with a different priority (high, medium or low). You can use the e Command Priority [} 462] parameter, which is available for most function blocks, to influence the priority with which the respective DALI command is to be processed by the function block FB_DALIV2Communication. All buffers in which the DALI commands are stored are associated with a variable of type ST_DALIV2Command Buffer. There is one instance of the function block FB_DALIV2Communication and a variable of type ST_DALIV2Command Buffer for each KL6811. If possible, the function block FB_DALIV2Communication should be called in a separate, faster task. TE1000 Version: 2.2.0 441
## Page 442

Programming The extent to which the buffers are utilized can be determined from the outputs of the function block. Three arrays are output for this in which each element (0, 1 or 2) represents one of the three buffers (high, middle or low). If you detect regular overflow for one of the three buffers, you should consider the following: • How heavily are the individual PLC tasks utilized? The Twin CAT System Manager offers various appropriate utilities for the analysis. • Try reducing the cycle time of the task in which the function block FB_DALIV2Communication is called. The value should not exceed 6 ms. Ideally it should be 2 ms. • Check the cycle time of the PLC task in which the function blocks for the individual DALI commands are called. This value should be between 10 ms and 60 ms. • If possible avoid polling (regular reading) of values. Only read values when they are actually required. • Distribute the individual control gears evenly over several DALI lines. Overall data throughput is increased by the fact that several DALI lines are processed simultaneously during each PLC cycle. Inputs VAR_INPUT b Reset Maximum Demand Counter : BOOL; b Reset Overflow Counter : BOOL; END_VAR Name Type Description b Reset Maximum De BOOL A positive edge resets the stored value of the maximum mand Counter command buffer utilization, arr Buffer Maximum Demand Meter (0 - 100 %, see outputs). b Reset Overflow Cou BOOL A positive edge resets the stored value of the number of nter command buffer overflows, arr Buffer Overflow Counter (see outputs). Inputs/outputs VAR_IN_OUT st DALIIn Data : ST_DALIV2In Data; st DALIOut Data : ST_DALIV2Out Data; st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st DALIIn Data ST_DALIV2In Data [} 468] Structure in the input process image of the KL6811. It is used for communication from the KL6811 to the PLC. st DALIOut Data ST_DALIV2Out Data [} 468] Structure in the output process image of the KL6811. It is used for communication from the PLC to the KL6811. st Command Buffer ST_DALIV2Command Buff Reference to the structure for communication (buffer) with er the function block FB_DALIV2Communication. Outputs VAR_OUTPUT arr Buffer Demand Meter : ARRAY [0..2] OF BYTE; arr Buffer Maximum Demand Meter : ARRAY [0..2] OF BYTE; arr Buffer Overflow Counter : ARRAY [0..2] OF UINT; b Line Is Busy : BOOL; b Line Is Initialized : BOOL; END_VAR Name Type Description arr Buffer Demand Me ARRAY Demand of the respective buffer (0 - 100 %) ter arr Buffer Maximum D ARRAY Previous maximum demand of the respective buffer (0 - emand Meter 100 %) arr Buffer Overflow Co ARRAY Number of buffer overflows so far unter 442 Version: 2.2.0 TE1000
## Page 443

Programming Name Type Description b Line Is Busy BOOL This output is set as long as the function block FB_DALIV2Communication is active. b Line Is Initialized BOOL If the function block is called for the first time (e.g. when starting the controller), initialization is carried out. No DALI commands can be processed during this time. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.2 FB_DALIV2Enable Write Memory Enables write access via FB_DALIV2Write Memory Location [} 181] to the internal memory of the control gear. This command can only be executed by DALI devices that comply with the IEC 62386 standard. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 443
## Page 444

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.3 FB_DALIV2Query Ballast The function block FB_DALIV2Query Ballast provides information on whether a specific control gear is ready to operate. Using this command, it can easily be determined whether or not any control gears at all are connected to a DALI line. To do this, the function block with the parameter e Addr Type = e DALIV2Addr Type Broadcast is called. If the output b Ballast is FALSE and output n Error is 0, there is no control gear connected to the DALI line. If the output n Error is 0 and the output b Ballast is TRUE, there is exactly one control gear connected to the DALI line. If several control gears are connected, n Error will return 5 (several control gears have responded). In this case it is irrelevant whether or not the control gears have short addresses. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 444 Version: 2.2.0 TE1000
## Page 445

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; b Ballast : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). b Ballast BOOL If the output is active, the corresponding control gear is ready to operate. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.4 FB_DALIV2Query Content DTR The content of the DTR (Data Transfer Register) is read from the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR TE1000 Version: 2.2.0 445
## Page 446

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Content DTR : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Content DTR BYTE Contents of the DTR (Data Transfer Register) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 446 Version: 2.2.0 TE1000
## Page 447

Programming 4.1.5.5 FB_DALIV2Send DALICommand The function block FB_DALIV2Send DALICommand is used for the general sending of a DALI command, defined by command number and, if necessary, transfer parameters. Moreover, it is possible to set whether the command is sent twice in succession and whether to wait for a response. The latter can be used, for example, to realize a fast sequence of step-up commands. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Command : INT := 0; n Parameter : BYTE := 0; b Waiting For DALISlave Response : BOOL := FALSE; b Repeat Command : BOOL := FALSE; b Suppress Response Buffer : BOOL := FALSE; n Device Type : BYTE := 0; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Command INT Number of the DALI command to be sent n Parameter BYTE Parameter for the value transfer b Waiting For DALISla BOOL If FALSE there is no waiting for the response of the DALI ve Response control gear. Its application makes no sense in connection with any kind of query command. b Repeat Command BOOL Decides whether the command is to be sent twice in succession. b Suppress Response BOOL If TRUE, the internal software buffer is not filled with the Buffer response from function block FB_DALIV2Communication [} 441]. n Device Type BYTE Identifier for the device type Value Description 0 Standard device 1 Device for emergency lighting. 2 Device for discharge lamps. TE1000 Version: 2.2.0 447
## Page 448

Programming Value Description 3 Device for low-voltage halogen lamps. 4 Device for dimming incandescent lamps. 5 Device for converting digital signals into DC signals. 6 Device for light emitting diodes (LEDs). Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Response Data : BYTE; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Response Data BYTE The value received from the DALI control gear, if a query command has been called. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.6 FB_DALIV2Set DTR This command is only available as a broadcast. Data is written to the DTR of all the control gears. 448 Version: 2.2.0 TE1000
## Page 449

Programming Inputs VAR_INPUT b Start : BOOL; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n DTR : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n DTR BYTE The value that is to be written into the DTR. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.7 FB_DALIV2Store Actual Level In DTR TE1000 Version: 2.2.0 449
## Page 450

Programming The function block FB_DALIV2Store Actual Level In DTR writes the current lamp power value to the DTR. This does not change the current value of the lamp power. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 450 Version: 2.2.0 TE1000
## Page 451

Programming 4.1.5.8 FB_DALIV2Store DTRAs Fade Rate The function block FB_DALIV2Store DTRAs Fade Rate writes the value of the DTR to the variable FADE RATE [} 88]. The range of possible values extends from 1 to 15. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). TE1000 Version: 2.2.0 451
## Page 452

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.9 FB_DALIV2Store DTRAs Fade Time The function block FB_DALIV2Store DTRAs Fade Time writes the value of the DTR to the variable FADE TIME [} 88]. The range of possible values extends from 0 to 15. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. 452 Version: 2.2.0 TE1000
## Page 453

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.10 FB_DALIV2Store DTRAs Max Level The function block FB_DALIV2Store DTRAs Max Level writes the value of the DTR to the variable MAX LEVEL [} 88]. If the value provided is smaller than MIN LEVEL then the value is simply set to MIN LEVEL. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). TE1000 Version: 2.2.0 453
## Page 454

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.11 FB_DALIV2Store DTRAs Min Level The function block FB_DALIV2Store DTRAs Min Level writes the value of the DTR to the variable MIN LEVEL [} 88] (minimum permitted lamp power). If the value provided is larger than MAX LEVEL [} 88] then the value is simply set to MAX LEVEL. If the value provided is smaller than the PHYSICAL MIN LEVEL [} 88] then MIN LEVEL will be set to PHYSICAL MIN LEVEL. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] 454 Version: 2.2.0 TE1000
## Page 455

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.12 FB_DALIV2Store DTRAs Power On Level The function block FB_DALIV2Store DTRAs Power On Level writes the value of the DTR to the variable POWER ON LEVEL [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group TE1000 Version: 2.2.0 455
## Page 456

Programming Name Type Description e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.13 FB_DALIV2Store DTRAs Scene The content of the DTR is saved as the value of the lamp power for the given scene. The value range for the scene number extends from 0 to 15. 456 Version: 2.2.0 TE1000
## Page 457

Programming Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; n Scene : BYTE; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] n Scene BYTE The scene for which the value of the lamp power should be changed. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 TE1000 Version: 2.2.0 457
## Page 458

Programming 4.1.5.14 FB_DALIV2Store DTRAs Short Address The content of the DTR (Data Transfer Register) is saved as the short address at the corresponding control gear. The structure of the DTR is 0AAA AAA1 (A: significant address bit) or 1111 1111 (mask). If the DTR contains 1111 1111 the short address is deleted from the control gear. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). 458 Version: 2.2.0 TE1000
## Page 459

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.15 FB_DALIV2Store DTRAs System Failure Level The function block FB_DALIV2Store DTRAs System Failure Level writes the value of the DTR to the variable SYSTEM FAILURE LEVEL [} 88]. Inputs VAR_INPUT b Start : BOOL; n Addr : BYTE; e Addr Type : E_DALIV2Addr Type := e DALIV2Addr Type Short; e Command Priority : E_DALIV2Command Priority := e DALIV2Command Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated by a positive edge at this input. n Addr BYTE The address of a device or of a group e Addr Type E_DALIV2Addr Type Short address, group address or broadcast [} 461] e Command Priority E_DALIV2Command Priorit Priority (high, medium or low) with which the command is processed by the library. y [} 462] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_DALIV2Command Buffer; END_VAR Name Type Description st Command Buffer ST_DALIV2Command Buff Reference to the internal structure for communication with er FB_KL6811Communication [} 77] (KL6811) or FB_KL6821Communication [} 82] (KL6821). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. TE1000 Version: 2.2.0 459
## Page 460

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.1.5.16 FB_KL6811Config The function block FB_KL6811Config is used to configure the KL6811. The configuration is executed when the PLC program starts, or it can be triggered by a positive edge at the input b Configurate. The parameters are stored in the respective registers of the KL6811 in a fail-safe manner. In addition, some general information, such as the firmware version, is read from the KL6811. Inputs VAR_INPUT b Configurate : BOOL := FALSE; e Operation Mode : E_DALIV2Operation Mode := e DALIV2Operation Mode DALI; b Disable Internal Power Supply : BOOL := FALSE; b Enable Counting Devices After Startup : BOOL := FALSE; n Options : DWORD := 0; END_VAR Name Type Description b Configurate BOOL Configuration of the bus terminal is started by a positive edge at this input. e Operation Mode E_DALIV2Operation Mode Defines the operation mode of the terminal (DALI or DSI). Corresponds to register 32, bits 12 to 15 of the bus [} 464] terminal. b Disable Internal Pow BOOL If this input is TRUE, the internal DALI power supply of the er Supply terminal is disabled by the configuration. Corresponds to register 32, bit 3 of the bus terminal. b Enable Counting De BOOL If this input is TRUE, the number of DALI devices is vices After Startup counted when the terminal starts. Corresponds to register 32, bit 4 of the bus terminal. n Options DWORD Reserved for future developments. Inputs/outputs VAR_IN_OUT st In Data Terminal : ST_DALIV2In Data; st Out Data Terminal : ST_DALIV2Out Data; 460 Version: 2.2.0 TE1000
## Page 461

Programming st In Data : ST_DALIV2In Data; st Out Data : ST_DALIV2Out Data; END_VAR Name Type Description st In Data Terminal ST_DALIV2In Data [} 468] Reference to the structure for communication with the KL6811 st Out Data Terminal ST_DALIV2Out Data [} 468] Reference to the structure for communication with the KL6811 st In Data ST_DALIV2In Data [} 468] Reference to the structure for communication with the function block FB_DALIV2Communication [} 441] st Out Data ST_DALIV2Out Data [} 468] Reference to the structure for communication with the function block FB_DALIV2Communication [} 441] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; n Terminal Description : WORD; n Firmware Version : WORD; s Description : STRING; END_VAR Name Type Description b Busy BOOL When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Error Id. Is reset to FALSE by the execution of a command at the inputs. n Error Id UDINT Contains the command-specific error code of the most recently executed command. Is reset to 0 by the execution of a command at the inputs (see error codes [} 438]). n Terminal Descriptio WORD Contains the terminal name (e.g. 6811). Corresponds to n register 8 of the bus terminal. n Firmware Version WORD Contains the firmware version. Corresponds to register 9 of the bus terminal. s Description STRING Terminal name and firmware version as string (e.g. 'Terminal KL6811 / Firmware 2H') Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2 DUTs 4.2.1 Enums 4.2.1.1 E_DALIV2Addr Type TYPE E_DALIV2Addr Type : ( e DALIV2Addr Type Short := 0, e DALIV2Addr Type Group := 1, TE1000 Version: 2.2.0 461
## Page 462

Programming e DALIV2Addr Type Broadcast := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.1.2 E_DALIV2Command Priority TYPE E_DALIV2Command Priority : ( e DALIV2Command Priority High := 0, e DALIV2Command Priority Middle := 1, e DALIV2Command Priority Low := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.1.3 E_DALIV2Configuration Commands TYPE E_DALIV2Configuration Commands : ( e DALIV2Command Do Nothing := 0, e DALIV2Command Off := 1, e DALIV2Command Recall Max Level := 2, e DALIV2Command Recall Min Level := 3, e DALIV2Command Go To Scene0 := 4, e DALIV2Command Go To Scene1 := 5, e DALIV2Command Go To Scene2 := 6, e DALIV2Command Go To Scene3 := 7, e DALIV2Command Go To Scene4 := 8, e DALIV2Command Go To Scene5 := 9, e DALIV2Command Go To Scene6 := 10, e DALIV2Command Go To Scene7 := 11, e DALIV2Command Go To Scene8 := 12, e DALIV2Command Go To Scene9 := 13, e DALIV2Command Go To Scene10 := 14, e DALIV2Command Go To Scene11 := 15, e DALIV2Command Go To Scene12 := 16, e DALIV2Command Go To Scene13 := 17, e DALIV2Command Go To Scene14 := 18, e DALIV2Command Go To Scene15 := 19 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.2.1.4 E_DALIV2Current Addressing State TYPE E_DALIV2Current Addressing State : ( e DALIV2Addr State Idle := 0, e DALIV2Addr State Remove Lamp := 1, e DALIV2Addr State Reinsert Lamp := 2, e DALIV2Addr State Addressing Lamp := 3 ); END_TYPE 462 Version: 2.2.0 TE1000
## Page 463

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.1.5 E_DALIV2Data Frame Type TYPE E_ DALIV2Data Frame Type: ( e DALIV2Data Frame Type16Bit := 0, e DALIV2Data Frame Type24Bit := 3, e DALIV2Data Frame Type Osram := 6 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.1.6 E_DALIV2Dimming Curve TYPE E_DALIV2Dimming Curve : ( e DALIV2Dimming Curve Logarithmic := 0, e DALIV2Dimming Curve Linear := 1 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.2.1.7 E_DALIV2Event Scheme TYPE E_ DALIV2Event Scheme: ( e DALIV2Event Scheme Unknown := -1, e DALIV2Event Scheme Instance := 0, (* (default) Instance addressing, using instance type and number. *) e DALIV2Event Scheme Device := 1, (* Device addressing, using short address and instance type. *) e DALIV2Event Scheme Device Instance := 2, (* Device/instance addressing, using short address and instance number. *) e DALIV2Event Scheme Device Group := 3, (* Device group addressing, using device group and instance type. *) e DALIV2Event Scheme Instance Group := 4 (* Instance group addressing, using instance group and type. *) ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.2.1.8 E_DALIV2Inst Addr Type TYPE E_ DALIV2Inst Addr Type: ( e DALIV2Inst Addr Type Number := 0, (* Instance number (0-31) *) e DALIV2Inst Addr Type Group := 1, (* Instance group (0-31) *) e DALIV2Inst Addr Type Type := 2, (* Instance type (0-31) *) e DALIV2Inst Addr Type Feature Number := 3, (* Feature on instance number level (0-31) *) e DALIV2Inst Addr Type Feature Group := 4, (* Feature on instance group level (0-31) *) e DALIV2Inst Addr Type Feature Type := 5, (* Feature on instance type level (0-31) *) e DALIV2Inst Addr Type Feature Broadcast := 6, (* Feature on instance broadcast level *) TE1000 Version: 2.2.0 463
## Page 464

Programming e DALIV2Inst Addr Type Broadcast := 7, (* Instance broadcast *) e DALIV2Inst Addr Type Feature Device := 8, (* Feature on device level *) e DALIV2Inst Addr Type Device := 9 (* Device *) ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.1.9 E_DALIV2Operation Mode TYPE E_DALIV2Operation Mode : ( e DALIV2Operation Mode DALI := 0, e DALIV2Operation Mode DSI := 1 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.1.10 E_DALIV2Power Supply Mode TYPE E_ DALIV2Power Supply Mode: ( e DALIV2Power Sypply Mode On := 0, e DALIV2Power Sypply Mode Off := 1, e DALIV2Power Sypply Mode Auto := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.2.2 Structures 4.2.2.1 ST_DALIV2Change Address List TYPE ST_DALIV2Change Address List : STRUCT n Old Address : BYTE; n New Address : BYTE; n Random Address High : BYTE; n Random Address Middle : BYTE; n Random Address Low : BYTE; n Errors : DWORD; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.2.2 ST_DALIV2Control Table TYPE ST_DALIV2Control Table : STRUCT n Actual Value : UINT; n Control Value : BYTE; 464 Version: 2.2.0 TE1000
## Page 465

Programming n Switch Range : UINT; END_STRUCT END_TYPE Name Type Description n Actual Value UINT Measured brightness value. n Control Value BYTE Associated switch point/interpolation point for the control value. Valid value range: 0 or n Min Level Master Dev ... n Max Level Master Dev. n Switch Range UINT Threshold value around the interpolation point at which switching takes place. The entry "0" marks the beginning of the unused range of the table. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.2.3 ST_DALIV2Device Settings TYPE ST_DALIV2Device Settings : STRUCT n Errors : DWORD; b Present : BOOL; n Actual Level : BYTE; n Power On Level : BYTE; n System Failure Level : BYTE; n Min Level : BYTE; n Max Level : BYTE; n Fade Rate : BYTE; n Fade Time : BYTE; n Random Address : DWORD; n Groups : WORD; n Scene Levels : ARRAY [0..15] OF BYTE; n Status : BYTE; n Major Version : BYTE; n Minor Version : BYTE; n Device Type : BYTE; n Physical Min Level : BYTE; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.2.4 ST_DALIV2Device Settings Type01 TYPE ST_DALIV2Device Settings Type01 : STRUCT n Errors : DWORD; b Present : BOOL; n Battery Charge : UINT; (*0..254, 255->Error*) t Duration Test Result : TIME; (*0..510 min*) t Lamp Emergency Time : TIME; (*0..255 h*) t Lamp Total Operation Time : TIME; (*0..1024 h*) n Emergency Level : BYTE; (*0..254*) n Emergency Min Level : BYTE; (*0..254*) n Emergency Max Level : BYTE; (*0..254*) t Rated Duration : TIME; (*0..510 min*) n Next Function Test : UINT; (*0..255*) n Next Duration Test : UINT; (*0..255*) n Function Test Interval : UINT; (*0..255*) n Duration Test Interval : UINT; (*0..255*) n Test Execution Timeout : UINT; (*0..255*) n Prolong Time : UINT; (*0..255*) n Emergency Mode : BYTE; n Features : BYTE; n Failure Status : BYTE; TE1000 Version: 2.2.0 465
## Page 466

Programming n Emergency Status : BYTE; END_STRUCT END_TYPE Note: The following variables are adapted to their target presentation range when they are read. They therefore differ from the read representation of the DALI device: t Duration Test Result : TIME; (*0..510 min*) t Lamp Emergency Time : TIME; (*0..255 h*) t Lamp Total Operation Time : TIME; (*0..1024 h*) t Rated Duration : TIME; (*0..510 min*) For the other variables the conversion either makes no sense (e.g. n Emergency Level), or a presentation is not possible (e.g. n Next Duration Test), since the range of the variable type TIME is insufficient. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.2.5 ST_DALIV2File Logging TYPE ST_DALIV2File Logging : STRUCT s Timestamp : STRING(30); s Controller : STRING(20); s Line Name : STRING(10); s Address : STRING(2); s Description : STRING(20); s Location : STRING(20); s Test Duration : STRING(8); s Result : STRING(240); END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.2.6 ST_DALIV2Sequence Table TYPE ST_DALIV2Sequence Table : STRUCT n Target Value : BYTE; t Ramp Time : TIME; t Prolong Time : TIME; END_STRUCT END_TYPE Name Type Description n Target Value BYTE Target value t Ramp Time TIME Time to reach the target value. t Prolong Time TIME Dwell time at the target value. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 466 Version: 2.2.0 TE1000
## Page 467

Programming 4.2.2.7 ST_DALIV2Swap Short Address List TYPE ST_DALIV2Swap Short Address List : STRUCT b Short Address Valid : BOOL; n New Short Address : BYTE; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.2.8 ST_KL6821In Data TYPE ST_KL6821In Data : STRUCT n Status : WORD; arr Data : ARRAY [0..3] OF BYTE; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.2.2.9 ST_KL6821Out Data TYPE ST_KL6821Out Data : STRUCT n Ctrl : WORD; arr Data : ARRAY [0..3] OF BYTE; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4022.4 Tc2_DALI from v3.6.2.0 4.2.2.10 ST_KL6811In Data TYPE ST_KL6811In Data: STRUCT n Status : BYTE; n Dummy : BYTE; n Data : WORD; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.2.11 ST_KL6811Out Data TYPE ST_KL6811Out Data: STRUCT n Ctrl : BYTE; n Dummy : BYTE; n Data : WORD; END_STRUCT END_TYPE TE1000 Version: 2.2.0 467
## Page 468

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.3 [Obsolet] 4.2.3.1 ST_DALIV2In Data TYPE ST_DALIV2In Data : STRUCT n Status : BYTE; n Dummy : BYTE; n Data : WORD; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.2.3.2 ST_DALIV2Out Data TYPE ST_DALIV2Out Data : STRUCT n Ctrl : BYTE; n Dummy : BYTE; n Data : WORD; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_DALI from v3.4.3.0 4.3 Integration into Twin CAT 4.3.1 KL6821 with PC system (CX5120) This example shows how to write a simple PLC program for DALI in Twin CAT and how to link it with the hardware. The task is to control a single dimmable lamp with a button. Example: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_dali/Resources/4325884043.zip The Twin CAT project is available for download as *.zip file. This must first be unpacked locally so that the archive (*.tnzip file) is available for import into the Twin CAT project. Hardware Setting up the components • 1x Embedded PC CX5120 • 1x digital 4-channel input terminal KL1104 (for the dimming and reset functions) • 1x DALI terminal KL6821 • 1x KL9010 end terminal Set up the hardware and the DALI components as described in the documentation. 468 Version: 2.2.0 TE1000
## Page 469

Programming This example assumes that a Dim button was connected to the first KL1104 input and a Reset button to the second, and that a dimmable lamp is connected to DALI address 0. Set the initial fade rate of the control gear to 7 to achieve suitable dimming. Software Creation of the PLC program Create a new "Twin CAT XAE project" and a "Standard PLC project". Add the library Tc2_DALI in the PLC project under "References". Create the following global variables: VAR_GLOBAL b Switch AT %I* : BOOL; b Reset AT %I* : BOOL; st KL6821In Data AT %I* : ST_KL6821In Data; st KL6821Out Data AT %Q* : ST_KL6821Out Data; st Command Buffer : ST_DALIV2Command Buffer; END_VAR b Switch: Input variable for the Dim button. b Reset: Input variable for the Reset button. ST_KL6821In Data: Input variable for the DALI terminal. (ST_KL6821In Data [} 467]) ST_KL6821Out Data: Output variable for the DALI terminal. (ST_KL6821Out Data [} 467]) st Command Buffer: Required for the communication with DALI. Create a program (CFC) for the background communication with DALI. The function block FB_KL6821Communication [} 82] is called in the program. In the communication function block ensure that the structures st In Data, st Out Data and st Command Buffer are linked. Create a MAIN program (CFC) in which the function block FB_DALIV2Dimmer1Switch [} 25] is called up. Connect the input b Switch Dimm of the dimmer function block with the global variable b Switch and st Command Buffer with the global variable st Command Buffer. TE1000 Version: 2.2.0 469
## Page 470

Programming Parameters n Min Level Master Device and n Max Level Master Device Make sure that the specified parameters n Min Level Master Device and n Max Level Master Device match the minimum and maximum values of the device, in order to avoid malfunction. Navigate to the task configuration section and configure the Plc Task. By way of example, the task is assigned priority 16 and a cycle time of 6 ms. Create a further task for the background communication. Assign a higher priority (smaller number) and a lower interval time to this task than the PLCTask. Add the program for the communication to this task. Further information on task configuration can be found in the description of the function block FB_KL6821Communication [} 82]. 470 Version: 2.2.0 TE1000
## Page 471

Programming I/O configuration Select the CX as target system and initiate a search for its hardware. In the project instance within the PLC section, you can see that the input and output variables are assigned to the corresponding tasks. TE1000 Version: 2.2.0 471
## Page 472

Programming Now link the global variables of PLC program with the inputs and outputs of the Bus Terminals. Create the Solution and enable the configuration. The lamp can now be controlled by pressing or holding the dimmer button. You can use the Reset button to reset the inputs in arr Buffer Maximum Demand Meter and arr Buffer Overflow Counter. 472 Version: 2.2.0 TE1000
## Page 473

Appendix 5 Appendix 5.1 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TE1000 Version: 2.2.0 473
## Page 474

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H.
## Page 475

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
