---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.7.2"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_MDP_EN.pdf"
release_date: "2024-07-02"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc2_MDP 2024-07-02 | Version: 1.7.2
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 MDP element access options................................................................................................................... 9 4 Function blocks....................................................................................................................................... 10 4.1 Introduction..................................................................................................................................... 10 4.2 Generic............................................................................................................................................ 11 4.2.1 Advanced......................................................................................................................... 11 4.2.2 FB_MDP_Read Element................................................................................................... 14 4.2.3 FB_MDP_Read Module.................................................................................................... 15 4.2.4 FB_MDP_Read Module Content........................................................................................ 17 4.2.5 FB_MDP_Read Module Header........................................................................................ 18 4.2.6 FB_MDP_Scan Modules................................................................................................... 19 4.2.7 FB_MDP_Split Error Id....................................................................................................... 20 4.3 Specific............................................................................................................................................ 20 4.3.1 FB_MDP_CPU_Read...................................................................................................... 20 4.3.2 FB_MDP_Device_Read_Dev Name................................................................................. 21 4.3.3 FB_MDP_Identity Obj_Read............................................................................................. 22 4.3.4 FB_MDP_NIC_Read........................................................................................................ 23 4.3.5 FB_MDP_NIC_Write_IP................................................................................................... 24 4.3.6 FB_MDP_Silicon Drive_Read........................................................................................... 25 4.3.7 FB_MDP_SW_Read_Mdp Version................................................................................... 26 4.3.8 FB_MDP_Twin CAT_Read............................................................................................... 27 5 Data types................................................................................................................................................ 29 5.1 General data types.......................................................................................................................... 29 5.1.1 E_MDP_Addr Area............................................................................................................ 29 5.1.2 E_MDP_Module Type....................................................................................................... 29 5.1.3 ST_MDP_Addr................................................................................................................. 29 5.1.4 ST_MDP_Module Header................................................................................................. 30 5.2 Structures specific MDP modules................................................................................................... 30 5.2.1 ST_MDP_CPU................................................................................................................. 30 5.2.2 ST_MDP_Identity Object................................................................................................... 30 5.2.3 ST_MDP_NIC_Properties................................................................................................ 31 5.2.4 ST_MDP_Silicon Drive...................................................................................................... 31 5.2.5 ST_MDP_Twin CAT.......................................................................................................... 32 6 Global Constants..................................................................................................................................... 33 6.1 Global_Version................................................................................................................................ 33 7 Error Codes............................................................................................................................................. 34 7.1 Error codes overview...................................................................................................................... 34 7.2 E_MDP_Err Group........................................................................................................................... 34 7.3 E_MDP_Err Codes PLC.................................................................................................................... 35 TE1000 Version: 1.7.2 3
## Page 4

Table of contents 8 Samples................................................................................................................................................... 37 8.1 Querying CPU data (generic).......................................................................................................... 37 8.2 Querying CPU data (specific).......................................................................................................... 46 8.3 Querying the fan state (generic)...................................................................................................... 50 8.4 Reading IPC serial numbers........................................................................................................... 52 8.5 Setting the IP address..................................................................................................................... 54 4 Version: 1.7.2 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. For installation and commissioning of the components, it is absolutely necessary to observe the documentation and the following notes and explanations. The qualified personnel is obliged to always use the currently valid documentation. The responsible staff must ensure that the application or use of the products described satisfies all requirements for safety, including all the relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. No claims to modify products that have already been supplied may be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of designations or trademarks used in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Patents The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 and similar applications and registrations in several other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document as well as the use and communication of its contents without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. TE1000 Version: 1.7.2 5
## Page 6

Foreword Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.7.2 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.7.2 7
## Page 8

Introduction 2 Introduction Update: Tc3_IPCDiag library The Twin CAT 3 PLC library Tc2_MDP is the predecessor to Tc3_IPCDiag. With the new Tc3_IPCDiag library the number of readable parameters has been increased and the user interface has been optimized. It is recommended to use the Tc3_IPCDiag library. Future extensions will no longer be performed in the Tc2_MDP library. It is not recommended to use the Tc2_MDP library for new projects. All functionalities of the Tc2_MDP library can also be found in the new Tc3_IPCDiag library. The Twin CAT 3 PLC library Tc2_MDP is used by the Beckhoff IPC diagnostics. Details can be found in the documentation: Beckhoff Device Manager. The available IPC diagnosis data are organized in the configuration area in so-called "Modules". A module contains all the data for a particular topic. The example applies to the IPC CPU. A module can in turn contain subcategories, so-called "Tables". A table organizes the detailed information that it contains in so-called "subindices". Since the contents of the list depend on the components existing in the current IPC, the list is generated dynamically – depending on what components the current PC contains, or what types of information it supports. Example: Access to data on the mainboard requires a BIOS (and the corresponding hardware in the PC) that can supply these data. A module therefore cannot be addressed via a fixed address. You first have to determine where exactly the module is located. Restricted access at the time of system start MDP forms an interface to the hardware. This is independent of Twin CAT. MDP can be accessed from Twin CAT with the PLC library. This is done internally by means of ADS communication. The versatility of the hardware configuration justifies a different initialization phase of the MDP service. It is possible that first PLC cycles are executed while the MDP initialization is not yet completed. Either the possible error outputs as well as timeouts of the function blocks from the library can be reacted and a new query can be triggered or the queries are executed deliberately delayed after the system start. It is recommended in the PLC program not to query values from the MDP immediately after the system start, but to consider a small waiting time. How large this should be depends on various parameters (such as the performance of your control computer), and can therefore not be given as a general rule. Typically it is in the range of 10-60 seconds. 8 Version: 1.7.2 TE1000
## Page 9

MDP element access options 3 MDP element access options The Twin CAT 3 PLC Tc2_MDP library offers a wide range of function blocks to facilitate comprehensive access to MDP data. There are two basic types of function blocks in the library. Firstly the generic function blocks. They can be used to query and set arbitrary parameters in the MDP themselves by means of discrete access. Furthermore, specific function blocks offer the possibility of accessing certain data as well as groupings of several data with one call. The function blocks have a uniform appearance. All function blocks are called by a positive edge on the b Execute input. Afterwards, cyclic calling of the function block (b Execute = FALSE) returns the result of the query at the output as soon as the processing of the query has been completed (b Busy = FALSE). Each function block must be called (b Execute = FALSE) for as long as it takes for the internal processing (b Busy = FALSE) to be completed. During that time, all inputs of the function block must remain unchanged. In general, the MDP is a model that describes hardware and software components in the form of modules. Information about these modules as well as about the device itself can be queried and changed. A module consists of one or more tables. Each table consists of a fixed number of subindices. A subindex corresponds to a concrete element that can be accessed. You can find more information on the setup of MDP in the MDP Information Model (Device Manager documentation). Further options for accessing the MDP are also described there. Generic function blocks In order to be able to query or set an IPC diagnostics parameter, the dynamic module ID of the module in which the parameter is located must be known. This is determined with the aid of the function block FB_MDP_Scan Modules [} 19]. Individual parameters can now be read or written by means of FB_MDP_Read [} 11] and FB_MDP_Write [} 12]. In addition to the dynamic Module ID, the number of the selected table (Table ID), the selected subindex within the table as well as further information is thereby specified for the query. Likewise, the complete header of a module (ST_MDP_Module Header [} 30]) can be queried with the function block FB_MDP_Read Module Header [} 18]. The complete contents of a selected table within a module can be queried with the function block FB_MDP_Read Module Content [} 17]. The function block FB_MDP_Read Module [} 15] bundles the above queries. The function block implicitly determines the dynamic Module ID and queries both header and table. The function block FB_MDP_Read Element [} 14] also determines the dynamic module ID implicitly. It can be used to query any individual IPC diagnostics parameter. Accordingly, with these two function blocks it is not necessary to call FB_MDP_Scan Modules beforehand. Specific function blocks The function blocks available here offer fast access to the most important IPC diagnostic information. For example, it is sufficient to call the function block FB_MDP_NIC_Read [} 23] in order to query all important information about a Network Interface Card (see Device Manager documentation Module NIC). The module header is also queried and output in each case. The specific function blocks likewise implicitly determine the dynamic Module ID, so that a prior call of FB_MDP_Scan Modules [} 19] is superfluous. TE1000 Version: 1.7.2 9
## Page 10

Function blocks 4 Function blocks 4.1 Introduction Update: Tc3_IPCDiag library The Twin CAT 3 PLC library Tc2_MDP is the predecessor to Tc3_IPCDiag. With the new Tc3_IPCDiag library the number of readable parameters has been increased and the user interface has been optimized. It is recommended to use the Tc3_IPCDiag library. Future extensions will no longer be performed in the Tc2_MDP library. It is not recommended to use the Tc2_MDP library for new projects. All functionalities of the Tc2_MDP library can also be found in the new Tc3_IPCDiag library. Generic function blocks A generic function block can be used to access any IPC diagnostics modules. The application is more complex and the user requires a certain understanding of the MDP (Module Device Profile) information model. Sample: Accessing network card information via FB_MDP_Read Element: The generic function block FB_MDP_Read Element determines the dynamic module address internally. The user only needs to specify the module instance that he wishes to access. The system has several network cards and each network card is represented by its own module instance. Specific function blocks A specific function block only accesses information from a specific module. It is simple to use and requires no knowledge of the MDP information model used. The specific function blocks available determine the dynamic module address internally. However, specific function blocks are only available for a selection of the IPC diagnostics data. Sample: FB_MDP_CPU_Read 10 Version: 1.7.2 TE1000
## Page 11

Function blocks 4.2 Generic 4.2.1 Advanced 4.2.1.1 FB_MDP_Read The function block enables querying of an IPC diagnostics module element. VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge at t his input.*) st MDP_Dyn Addr : ST_MDP_Addr; p Dst Buf : DWORD; (* Contains the address of the buffer for the received data. * ) cb Dst Buf Len : UDINT; (* Contains the max. number of bytes to be received. *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled . *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. st MDP_Dyn Addr: The MDP addressing belonging to the selected network module is specified at this input. The structure is of the type ST_MDP_Addr [} 29]. The dynamic Module ID must already be specified with it. p Dst Buf: The memory address of the data buffer is specified at this input. The received data are stored there if the query is successful. cb Dst Buf Len: The length of the data buffer in bytes is specified at this input. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Count : UDINT; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. n Count: This output indicates the number of bytes read. TE1000 Version: 1.7.2 11
## Page 12

Function blocks Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.2.1.2 FB_MDP_Write The function block enables setting of an IPC diagnostics module element. VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge a t this input.*) st MDP_Dyn Addr : ST_MDP_Addr; p Src Buf : DWORD; (* Contains the address of the buffer for the sent data. *) cb Src Buf Len : UDINT; (* Contains the max. number of bytes to be sent. *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelle d. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. st MDP_Dyn Addr: The MDP addressing belonging to the selected network module is specified at this input. The structure is of the type ST_MDP_Addr [} 29]. The dynamic Module ID must already be specified with it. p Src Buf: The memory address of the data buffer is specified at this input. The data to be transmitted must be stored there. cb Src Buf Len: The length of the data buffer in bytes is specified at this input. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 12 Version: 1.7.2 TE1000
## Page 13

Function blocks 4.2.1.3 FB_MDP_Read Index Update: Tc3_IPCDiag library The Twin CAT 3 PLC library Tc2_MDP is the predecessor to Tc3_IPCDiag. With the new Tc3_IPCDiag library the number of readable parameters has been increased and the user interface has been optimized. It is recommended to use the Tc3_IPCDiag library. Future extensions will no longer be performed in the Tc2_MDP library. It is not recommended to use the Tc2_MDP library for new projects. All functionalities of the Tc2_MDP library can also be found in the new Tc3_IPCDiag library. The function block enables querying of any IPC diagnostics element. In addition to the Configuration Area, data from the device area are also accessible. VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge at thi s input.*) n Index : WORD; n Sub Index : BYTE; p Dst Buf : DWORD; (* Contains the address of the buffer for the received data. *) cb Dst Buf Len : UDINT; (* Contains the max. number of bytes to be received. *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. n Index: At this input the first part of the addressing for the required IPC diagnostic data is specified. n Sub Index: At this input the second part of the addressing for the required IPC diagnostic data is specified. p Dst Buf: The memory address of the data buffer is specified at this input. The received data are stored there if the query is successful. cb Dst Buf Len: The length of the data buffer in bytes is specified at this input. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Count : UDINT; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. n Count: This output indicates the number of bytes read. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4013 PC or CX (x86, x64, ARM) Tc2_MDP TE1000 Version: 1.7.2 13
## Page 14

Function blocks 4.2.2 FB_MDP_Read Element Update: Tc3_IPCDiag library The Twin CAT 3 PLC library Tc2_MDP is the predecessor to Tc3_IPCDiag. With the new Tc3_IPCDiag library the number of readable parameters has been increased and the user interface has been optimized. It is recommended to use the Tc3_IPCDiag library. Future extensions will no longer be performed in the Tc2_MDP library. It is not recommended to use the Tc2_MDP library for new projects. All functionalities of the Tc2_MDP library can also be found in the new Tc3_IPCDiag library. The function block enables querying of an individual MDP element. In this way, each element from each module of the Configuration Area can be read! Internally, the device is scanned for the selected module, and the element information is queried with the dynamic module ID. VAR_INPUT VAR_INPUT b Execute : BOOL; st MDP_Addr : ST_MDP_Addr; (* includes all address parameters without the Dynamic Module Id *) e Module Type : E_MDP_Module Type; (* chosen module type out of the module type list *) i Mod Idx : USINT; (* chosen index(0..n) of the demanded module type. E.g. second NIC(idx 1) of three found NICs. *) p Dst Buf : DWORD; (* Contains the address of the buffer for the received data. * ) cb Dst Buf Len : UDINT; (* Contains the max. number of bytes to be received. *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a positive edge on the input b Execute, if the function block is not already active. st MDP_Addr: At this input the MDP addressing relating to the selected MDP module is specified. The structure is of type ST_MDP_Addr [} 29]. The area must be specified as Configuration Area. The dynamic module ID is only added internally and must not be specified. i Mod Idx: If a MDP module is present more than once, a selection (0,...,n) can be made by means of input i Mod Idx. p Dst Buf: The memory address of the data buffer is specified at this input. The received data are stored there if the query is successful. cb Dst Buf Len: An The length of the data buffer in bytes is specified at this input. t Timeout: Specifies a maximum time duration for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. 14 Version: 1.7.2 TE1000
## Page 15

Function blocks VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; (* indicates if Read was successfull or not *) n Err ID : UDINT; n Count : UDINT; st MDP_Dyn Addr : ST_MDP_Addr; (* includes the new dynamic module type id. *) i Module Type Count : USINT; (* returns the number of found modules equal the demanded modul e type. *) i Module Count : USINT; (* returns the number of all detected MDP modules. *) END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. n Count: This output indicates the number of bytes read. st MDP_Dyn Addr: At this output the MDP addressing relating to the selected MDP module is specified. The structure is of the type ST_MDP_Addr [} 29]. The dynamic Module ID was added by the function block. i Module Type Count: The output i Module Type Count indicates the number of modules that correspond to the specified type. i Module Count: The output i Module Count indicates the entire number of modules on the device. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.2.3 FB_MDP_Read Module The function block enables an MDP module to be queried. The device is scanned internally for the selected module and the module header and the module information are queried with the dynamic Module ID. VAR_INPUT VAR_INPUT b Execute : BOOL; st MDP_Addr : ST_MDP_Addr; (* includes all address parameters without the Dynamic Module Id *) e Module Type : E_MDP_Module Type; (* chosen module type out of the module type list *) i Mod Idx : USINT; (* chosen index(0..n) of the demanded module type. E.g. secon d NIC(idx 1) of three found NICs. *) i Sub Idx Count : USINT; p Dst Buf : DWORD; (* Contains the address of the buffer for the received data. *) cb Dst Buf Len : UDINT; (* Contains the max. number of bytes to be received. *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR TE1000 Version: 1.7.2 15
## Page 16

Function blocks b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. st MDP_Addr: The MDP addressing belonging to the selected module is specified at this input. The structure is of the type ST_MDP_Addr [} 29]. The dynamic Module ID is only added internally. e Module Type: The MDP module type is specified at this input. The possible types are listed in the enumeration E_MDP_Module Type [} 29]. (General information: module types list) i Mod Idx: If several instances of an MDP module exist, a selection can be made by means of the input i Mod Idx (0,...,n). i Sub Idx Count: The input i Sub Idx Count is used to specify how many subindices of the selected Table ID are to be queried. p Dst Buf: The memory address of the data buffer is specified at this input. The received data are stored there if the query is successful. cb Dst Buf Len: The length of the data buffer in bytes is specified at this input. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; (* indicates if Read was successfull or not *) n Err ID : UDINT; i Err Pos : USINT; st MDP_Dyn Addr : ST_MDP_Addr; (* includes the new dynamic module type id. *) i Module Type Count : USINT; (* returns the number of found modules equal the demanded mo dule type. *) i Module Count : USINT; (* returns the number of all detected MDP modules. *) st MDP_Module Header : ST_MDP_Module Header; arr Start Idx : ARRAY[0..255] OF UINT; (* startindexes in bytes of each subindex element *) END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. i Err Pos: If an error occurred and this refers to an individual element, then this output indicates the position (subindex of the element) at which an error first occurred. st MDP_Dyn Addr: At this output the MDP addressing relating to the selected MDP module is specified. The structure is of the type ST_MDP_Addr [} 29]. The dynamic Module ID was added by the function block. i Module Type Count: The output i Module Type Count indicates the number of modules that correspond to the specified type. i Module Count: The output i Module Count indicates the entire number of modules on the device. st MDP_Module Header: The header information from the read MDP module is displayed at this output in the form of the structure ST_MDP_Module Header. [} 30] arr Start Idx: This array describes how the individually queried subindices have been stored in the buffer. The array index zero indicates the position in bytes at which the data of subindex zero begins in the buffer. Subsequent subindices are handled analogously. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 16 Version: 1.7.2 TE1000
## Page 17

Function blocks 4.2.4 FB_MDP_Read Module Content The function block enables querying of the content of an IPC diagnostics module. VAR_INPUT VAR_INPUT b Execute : BOOL; st MDP_Dyn Addr : ST_MDP_Addr; (* includes the dynamic module type for which the module content is requested. All subindexes of the chosen table are requested. *) i Sub Idx Count : USINT; (* the number of Sub Indexes to be requested *) p Dst Buf : DWORD; (* Contains the address of the buffer for the received data. *) cb Dst Buf Len : UDINT; (* Contains the max. number of bytes to be received. *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled . *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. st MDP_Dyn Addr: The MDP addressing belonging to the selected module is specified at this input. The structure is of the type ST_MDP_Addr [} 29]. The dynamic Module ID must already be transferred with it. i Sub Idx Count: The input i Sub Idx Count is used to specify how many subindices of the selected Table ID are to be queried. p Dst Buf: The memory address of the data buffer is specified at this input. The received data are stored there if the query is successful. cb Dst Buf Len: The length of the data buffer in bytes is specified at this input. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; (* indicates if Read was successfull or not *) n Err ID : UDINT; i Err Pos : USINT; arr Start Idx : ARRAY[0..255] OF UINT; (* startindexes in bytes of each subindex element *) END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. i Err Pos: If an error occurred and this refers to an individual element, then this output indicates the position (subindex of the element) at which an error first occurred. arr Start Idx: This array describes how the individually queried subindices have been stored in the buffer. The array index zero indicates the position in bytes at which the data of subindex zero begins in the buffer. Subsequent subindices are handled analogously. TE1000 Version: 1.7.2 17
## Page 18

Function blocks Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.2.5 FB_MDP_Read Module Header The function block enables querying of the header of an IPC diagnostics module. VAR_INPUT VAR_INPUT b Execute : BOOL; n Dyn Module Id : BYTE; (* the dynamic module id for which the module header is request ed *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. n Dyn Module Id: The dynamic module id for which the module header is requested. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; (* indicates if Read was successfull or not *) n Err ID : UDINT; st MDP_Mod Header : ST_MDP_Module Header; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. st MDP_Module Header: At this output the header information for the read IPC diagnostics modules is displayed in the form of the structure ST_MDP_Module Header [} 30]. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 18 Version: 1.7.2 TE1000
## Page 19

Function blocks 4.2.6 FB_MDP_Scan Modules Update: Tc3_IPCDiag library The Twin CAT 3 PLC library Tc2_MDP is the predecessor to Tc3_IPCDiag. With the new Tc3_IPCDiag library the number of readable parameters has been increased and the user interface has been optimized. It is recommended to use the Tc3_IPCDiag library. Future extensions will no longer be performed in the Tc2_MDP library. It is not recommended to use the Tc2_MDP library for new projects. All functionalities of the Tc2_MDP library can also be found in the new Tc3_IPCDiag library. The function block enables a device to be searched for a specific IPC diagnostics module. A selection can be made if the module type is present more than once. For the selected module type the dynamic module ID is determined by the function block. This is an important part of the MDP addressing, which is represented in the structure ST_MDP_Addr [} 29]. VAR_INPUT VAR_INPUT b Execute : BOOL; n Module Type : WORD; (* chosen module type out of the module type list *) i Mod Idx : USINT; (* chosen index(0..n) of the demanded module type. E.g. second N IC(idx 1) of three found NICs. *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. n Module Type: At this input is the IPC diagnostics module type is specified. The possible types are listed in the enumeration E_MDP_Module Type [} 29]. (general information on IPC diagnostics module types.) i Mod Idx: If several instances of an IPC diagnostics module exist, a selection can be made by means of the input i Mod Idx (0,...,n). In the case of uncertainty concerning the selection: information about which module is explicitly concerned can be queried via the function block FB_MDP_Read Module Header [} 18] after scanning. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; (* indicates if Scan was successfull or not *) n Err ID : UDINT; n Dyn Module Id : BYTE; (* Dynamic Module Id *) i Module Type Count : USINT; (* returns the number of found modules equal the demanded module type. *) i Module Count : USINT; (* returns the number of all detected MDP modules. *) END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. TE1000 Version: 1.7.2 19
## Page 20

Function blocks n Err ID: Returns an error code [} 34] if the b Error output is set. n Dyn Module Id: This output indicates the dynamic Module ID determined for the selected module. i Module Type Count: The output i Module Type Count indicates the number of modules that correspond to the specified type. i Module Count: The output i Module Count indicates the entire number of modules on the device. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.2.7 FB_MDP_Split Error Id The function block enables the n Err ID to be split into an error group [} 34] and a specific error code. Accordingly, this function block can be referred to for the simplified evaluation of n Err ID. VAR_INPUT VAR_INPUT n Err ID : UDINT; END_VAR n Err ID: n Err ID is specified as an input on the function block. This 4-byte variable corresponds to the output n Err ID on an MDP function block. VAR_OUTPUT VAR_OUTPUT e Err Group : E_MDP_Err Group; (* type of transmitted error code *) n Err Code : UINT; (* error code [see specific error type table] *) END_VAR e Err Group: The output e Err Group corresponds to a value of the enumeration E_MDP_Err Group [} 34]. It is possible with the aid of the error group to distinguish the type of error or the source of error concerned. n Err Code: The error code is specific for each error group. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.3 Specific 4.3.1 FB_MDP_CPU_Read The function block enables querying of the IPC diagnostics module CPU. 20 Version: 1.7.2 TE1000
## Page 21

Function blocks VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge at this inpu t.*) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) i Mod Idx : USINT := 0; (* Index number of chosen MDP module *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. t Timeout: Specifies a maximum length of time for the execution of the function block. i Mod Idx: If several instances of an IPC diagnostics module exist, a selection can be made by means of the input i Mod Idx (0,...,n). s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; i Err Pos : USINT; st MDP_Module Header : ST_MDP_Module Header; st MDP_Module Content : ST_MDP_CPU; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. i Err Pos: If an error occurred and this refers to an individual element, then this output indicates the position (subindex of the element) at which an error first occurred. st MDP_Module Header: At this output the header information for the read IPC diagnostics modules is displayed in the form of the structure ST_MDP_Module Header [} 30]. st MDP_Module Content: The information from Table ID 1 of the read IPC diagnostics module is displayed at this output in the form of the structure ST_MDP_CPU [} 30]. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.3.2 FB_MDP_Device_Read_Dev Name The function block enables the device name to be queried. This information can be found in the general area of the IPC diagnostics. VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge at this in put.*) TE1000 Version: 1.7.2 21
## Page 22

Function blocks t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; s Dev Name : T_Max String; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. s Dev Name: The queried name is output as a string at this output. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.3.3 FB_MDP_Identity Obj_Read Der Funktionsbaustein ermöglicht die Abfrage der Tabelle Identity Object der General Area der IPC- Diagnose. VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge at this input.*) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; 22 Version: 1.7.2 TE1000
## Page 23

Function blocks n Err ID : UDINT; i Err Pos : USINT; st MDP_Module Content : ST_MDP_Identity Object; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. i Err Pos: If an error occurred and this refers to an individual element, then this output indicates the position (subindex of the element) at which an error first occurred. st MDP_Module Content: The information from the table is displayed at this output in the form of the structure ST_MDP_Identity Object [} 30]. Serial number is no longer supported Outdated parameter leads to error situation In the Identity Object the serial number of the IPC is read from the MDP General Area. This parameter is obsolete. The parameter is no longer supported for newer Beckhoff IPC devices. This causes the function block to return an error and name the error position (i Err Pos = 4), which corresponds to the i Serial Number parameter. Alternatively, the serial number can be read from the MDP Device Area. See corresponding example [} 52]. It is recommended to use the PLC library Tc3_IPCDiag, which is the successor to the PLC library Tc2_MDP. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.3.4 FB_MDP_NIC_Read The function block enables querying of the IPC diagnostics Moduls NIC (Network Interface Card). VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge at this in put.*) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) i Mod Idx : USINT := 0; (* Index number of chosen MDP module *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. t Timeout: Specifies a maximum length of time for the execution of the function block. i Mod Idx: If several instances of an IPC diagnostics module exist, a selection can be made by means of the input i Mod Idx (0,...,n). TE1000 Version: 1.7.2 23
## Page 24

Function blocks s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; i Err Pos : USINT; st MDP_Module Header : ST_MDP_Module Header; st MDP_Module Content : ST_MDP_NIC_Properties; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. i Err Pos: If an error occurred and this refers to an individual element, then this output indicates the position (subindex of the element) at which an error first occurred. st MDP_Module Header: At this output the header information for the read IPC diagnostics modules is displayed in the form of the structure ST_MDP_Module Header [} 30]. st MDP_Module Content: The information from Table ID 1 of the read IPC diagnostics module is displayed at this output in the form of the structure ST_MDP_NIC [} 31]. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.3.5 FB_MDP_NIC_Write_IP The function block enables a new IP address to be set. This element is part of the IPC diagnostics Moduls NIC. Please note that changes of this kind affect an existing network connection to the computer. VAR_INPUT VAR_INPUT b Execute : BOOL; n Dyn Module Id : BYTE; (* the dynamic module id *) s IPAddress : T_Max String; (* IP Address *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. n Dyn Module Id: The dynamic Module ID belonging to the selected network module is specified at this input. 24 Version: 1.7.2 TE1000
## Page 25

Function blocks s IPAddress: The IP address specified at this input in the form of a string is transmitted. t Timeout: Specifies a maximum length of time for the execution of the function block. s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.3.6 FB_MDP_Silicon Drive_Read The function block enables querying of the IPC diagnostics module Silicon Drive. Obsolete functionality The Silicon Drive hardware was replaced by newer memory card types. The functionality is therefore obsolete. We recommend using the query of the IPC diagnostic module Physical Drive SMARTParameters instead. VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge at this inpu t.*) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) i Mod Idx : USINT := 0; (* Index number of chosen MDP module *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. t Timeout: Specifies a maximum length of time for the execution of the function block. i Mod Idx: If several instances of an IPC diagnostics module exist, a selection can be made by means of the input i Mod Idx (0,...,n). s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. TE1000 Version: 1.7.2 25
## Page 26

Function blocks VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; i Err Pos : USINT; st MDP_Module Header : ST_MDP_Module Header; st MDP_Module Content : ST_MDP_Silicon Drive; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. i Err Pos: If an error occurred and this refers to an individual element, then this output indicates the position (subindex of the element) at which an error first occurred. st MDP_Module Header: At this output the header information for the read IPC diagnostics modules is displayed in the form of the structure ST_MDP_Module Header [} 30]. st MDP_Module Content: The information from Table ID 1 of the read IPC diagnostics module is displayed at this output in the form of the structure ST_MDP_Silicon Drive [} 31]. Notice The querying of the IPC-diagnostics Drive module is one of the more time consuming processes. Hence, the Standard ADS Timeout can by all means be exceeded. This can be remedied by increasing the time period t Timeout applied to the input of the function block. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.3.7 FB_MDP_SW_Read_Mdp Version The function block enables querying of the MDP version. This information can be found in the software module in the configuration area of the IPC diagnostics. The MDP version is independent of the PLC library version. The constant st Lib Version_Tc2_MDP [} 33] is used to query the PLC library version. VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge at this in put.*) t Timeout : TIME :=DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. t Timeout: Specifies a maximum length of time for the execution of the function block. 26 Version: 1.7.2 TE1000
## Page 27

Function blocks s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; s Mdp Version : STRING(23); (* complete MDP version as string [e.g.: '1, 0, 4, 47'] *) i Major Nbr : UINT; (* major number [e.g.: 1] *) i Minor Nbr : UINT; (* minor number [e.g.: 4] *) i Rev Nbr : UINT; (* revision number [e.g.: 47] *) END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. s Mdp Version: At this output the queried MDP version is output as a string. i Major Nbr: The first part of the version number output is i Major Nbr. i Minor Nbr: The second part of the version number output is i Minor Nbr. i Rev Nbr: The third part of the version number output is i Rev Nbr. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 4.3.8 FB_MDP_Twin CAT_Read The function block enables querying of the IPC diagnostics module Twin CAT. VAR_INPUT VAR_INPUT b Execute : BOOL; (* Function block execution is triggered by a rising edge at this inpu t.*) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) i Mod Idx : USINT := 0; (* Index number of chosen MDP module *) s Ams Net Id : T_Ams Net Id; (* keep empty '' for the local device *) END_VAR b Execute: The function block is called by a rising edge on the input b Execute, if the block is not already active. t Timeout: Specifies a maximum length of time for the execution of the function block. i Mod Idx: If several instances of an IPC diagnostics module exist, a selection can be made by means of the input i Mod Idx (0,...,n). s Ams Net Id: To execute the query on the local device, it is not necessary to specify this input variable. Alternatively, an empty string can be specified. To direct the query to another computer, its AMS Net Id (of type T_Ams Net Id) can be specified here. TE1000 Version: 1.7.2 27
## Page 28

Function blocks VAR_OUTPUT VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; i Err Pos : USINT; st MDP_Module Header : ST_MDP_Module Header; st MDP_Module Content : ST_MDP_Twin CAT; END_VAR b Busy: This output is TRUE as long as the function block is active. b Error: Becomes TRUE as soon as an error situation occurs. n Err ID: Returns an error code [} 34] if the b Error output is set. i Err Pos: If an error occurred and this refers to an individual element, then this output indicates the position (subindex of the element) at which an error first occurred. st MDP_Module Header: At this output the header information for the read IPC diagnostics modules is displayed in the form of the structure ST_MDP_Module Header [} 30]. st MDP_Module Content: The information from Table ID 1 of the read IPC diagnostics module is displayed at this output in the form of the structure ST_MDP_Twin CAT [} 32]. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 28 Version: 1.7.2 TE1000
## Page 29

Data types 5 Data types 5.1 General data types 5.1.1 E_MDP_Addr Area TYPE E_MDP_Addr Area :( e MDP_Area_Config Area := 16#8, e MDP_Area_Service Area := 16#B, e MDP_Area_Device Area := 16#F ); END_TYPE The enumeration E_MDP_Addr Area defines constant values for the different site the IPC diagnostics. 5.1.2 E_MDP_Module Type TYPE E_MDP_Module Type :( e MDP_Mod T_NIC := 16#0002, e MDP_Mod T_Time := 16#0003, e MDP_Mod T_User Management := 16#0004, e MDP_Mod T_RAS := 16#0005, e MDP_Mod T_FTP := 16#0006, e MDP_Mod T_SMB := 16#0007, e MDP_Mod T_Twin CAT := 16#0008, e MDP_Mod T_Datastore := 16#0009, e MDP_Mod T_Software := 16#000A, e MDP_Mod T_CPU := 16#000B, e MDP_Mod T_Memory := 16#000C, e MDP_Mod T_Firewall := 16#000E, e MDP_Mod T_File System Object := 16#0010, e MDP_Mod T_PLC := 16#0012, e MDP_Mod T_Display Device := 16#0013, e MDP_Mod T_EWF := 16#0014, e MDP_Mod T_FBWF := 16#0015, e MDP_Mod T_Silicon Drive := 16#0017, e MDP_Mod T_OS := 16#0018, e MDP_Mod T_Raid := 16#0019, e MDP_Mod T_Fan := 16#001B, e MDP_Mod T_Mainboard := 16#001C, e MDP_Mod T_Disk Management := 16#001D, e MDP_Mod T_UPS := 16#001E, e MDP_Mod T_Misc := 16#0100 ); END_TYPE The enumeration E_MDP_Module Type defines constant values for the different module types in the MDP. A module type can occur several times per device. Hence, a device with two Ethernet interfaces also has two MDP NIC modules. Detailed information on the modules can be found in the documentation for the IPC diagnostics under module types. Notice: This module type is not the same as the dynamic module ID! 5.1.3 ST_MDP_Addr TYPE ST_MDP_Addr : STRUCT n Area : BYTE; (* Area [range: 0x0-0x F] *) n Module Id : BYTE; (* Dynamic Module Id [range: 0x00-0x FF] *) n Table Id : BYTE; (* Table Id [range: 0x0-0x F] *) n Flag : BYTE; (* Flags [range: 0x00-0x FF] *) n Sub Idx : BYTE; (* Sub Index [range: 0x00-0x FF] *) arr Reserved : ARRAY[0..2] OF BYTE; END_STRUCT END_TYPE The structure contains information that is required for the MDP addressing. TE1000 Version: 1.7.2 29
## Page 30

Data types n Area: Possible MDP areas are listed in E_MDP_Addr Area [} 29]. n Module Id: The Module ID is assigned dynamically. It does not correspond to the module types listed in E_MDP_Module Type. The function block FB_MDP_Scan Modules [} 19] can be used in order to determine a dynamic Module ID for a special type of module. n Table Id: This value specifies the number of the selected table of the selected module. n Flag: This parameter is used internally only. It remains at the default value of 0x00. n Sub Idx: The Subindex parameter corresponds to the subindex in a table in an MDP module. More detailed information on MDP addressing can be found in the Deive Manager documentation. 5.1.4 ST_MDP_Module Header TYPE ST_MDP_Module Header : STRUCT i Len :UINT; n Addr :DWORD; s Type :T_Max String; s Name :T_Max String; n Dev Type :DWORD; END_STRUCT END_TYPE The structure contains device information. This information always corresponds to the Table ID 0 of an MDP module. Each module possesses this module header. i Len Specifies the number of parameters in the Table ID, in this case the module header. n Addr Specifies the address of the module. s Type Specifies the type of module. Possible types are listed in the MDP module list.(Device Manager documentation). s Name Specifies the name of this MDP module. n Dev Type Specifies the type of MDP module as code. 5.2 Structures specific MDP modules 5.2.1 ST_MDP_CPU TYPE ST_MDP_CPU : STRUCT i Len : UINT; (* Length *) i CPUfrequency : UDINT; (* CPU Frequency *) i CPUusage : UINT; (* Current CPU Usage [%] *) END_STRUCT END_TYPE The structure contains information on the IPC diagnostics module CPU. This complete information can be queried by means of the function block FB_MDP_CPU_Read [} 20]. The parameters existing in this structure correspond to the subindices of the first table (Table ID 1) within the IPC-diagnostics CPU module. 5.2.2 ST_MDP_Identity Object TYPE ST_MDP_Identity Object : STRUCT i Len : UINT; (* Length *) i Vendor : UDINT; (* Vendor *) i Product Code : UDINT; (* Product Code *) (* not yet supported *) 30 Version: 1.7.2 TE1000
## Page 31

Data types i Rev Number : UDINT; (* Revision Number *) (* not yet supported *) i Serial Number : UDINT; (* Serial Number *) END_STRUCT END_TYPE The structure contains information on the ‘Identity Object’ table, which can be found in the IPC diagnostics general area. This complete information can be queried by means of the function block FB_MDP_Identity Obj_Read [} 22]. The parameters in this structure correspond to the subindices of the 'identity object' table in the IPC diagnostics general area. 5.2.3 ST_MDP_NIC_Properties TYPE ST_MDP_NIC_Properties : STRUCT i Len : UINT; (* Length *) s MACAddress : T_Max String; (* MAC Address *) s IPAddress : T_Max String; (* IP Address *) s Subnet Mask : T_Max String; (* Subnet Mask *) b DHCP : BOOL; (* DHCP *) END_STRUCT END_TYPE The structure contains information on the IPC diagnostics module NIC (Network Interface Card). This complete information can be queried by means of the function block FB_MDP_NIC_Read [} 23]. The parameters existing in this structure correspond to the subindices of the first table (Table ID 1) within the IPC-diagnostics NIC module. 5.2.4 ST_MDP_Silicon Drive TYPE ST_MDP_Silicon Drive : STRUCT i Len : UINT; (* Length *) i Total Erase Counts : UDINT; (* Total Erase Counts (lower 4 bytes) *) i Drive Usage : UINT; (* Drive Usage (%) *) i Nbr Spares : UINT; (* Number of Spares *) i Nbr Used Spares : UINT; (* Spares Used *) i Total Erase Counts High : UDINT; (* Total Erase Counts (higher 4 bytes) *) END_STRUCT END_TYPE The structure contains information on the MDP Silicon Drive module. This complete information can be queried by means of the function block FB_MDP_Silicon Drive_Read [} 25]. i Len: i Len indicates the number the MDP elements in the table in the MDP module. i Total Erase Counts: This value indicates the total number of write and delete cycles of all memory blocks of a Silicon Drive. This number is a 64-bit value. i Total Erase Counts contains the lower 32 bits. i Total Erase Counts High: This value indicates the total number of write and delete cycles of all memory blocks of a Silicon Drive. This number is a 64-bit value. i Total Erase Counts High contains the higher 32 bits. i Drive Usage: This parameter indicates the calculated wear of the Silicon Drive. The value is based on two million write cycles per block as maximum value. i Nbr Spares: Reserved blocks are used to replace worn memory blocks. i Nbr Spares indicates the number of spare blocks available on the Silicon Drive. i Nbr Used Spares: The value indicates the number of spare blocks already in use. The parameters existing in this structure correspond to the subindices of the first table (Table ID 1) within the IPC diagnostics Silicon Drive module. TE1000 Version: 1.7.2 31
## Page 32

Data types Obsolete functionality The Silicon Drive hardware was replaced by newer memory card types. The functionality is therefore obsolete. We recommend using the query of the IPC diagnostic module Physical Drive SMART Parameters instead. 5.2.5 ST_MDP_Twin CAT TYPE ST_MDP_Twin CAT : STRUCT i Len : UINT; (* Length *) i Major Version : UINT; (* Major Version *) i Minor Version : UINT; (* Minor Version *) i Build : UINT; (* Build *) s Ams NETid : T_Max String; (* Ams NET ID *) i Reg Level : UDINT; (* Twin CAT registration level *) i Status : UINT; (* Twin CAT status *) i Run As Dev : UINT; (* Run As Device *) (* available for Windows CE *) i Show Target Visu : UINT; (* show target visualization *) (* available for Windows CE *) i Log File Size : UDINT; (* log file size *) (* available for Windows CE *) s Log File Path : T_Max String; (* log file path *) (* available for Windows CE *) END_STRUCT END_TYPE The structure contains information on the MDP Twin CAT module. This complete information can be queried by means of the function block FB_MDP_Twin CAT_Read [} 27]. The parameters existing in this structure correspond to the subindices of the first table (Table ID 1) within the MDP Twin CAT module. 32 Version: 1.7.2 TE1000
## Page 33

Global Constants 6 Global Constants 6.1 Global_Version All libraries have a certain version. The version is indicated in the PLC library repository, for example. A global constant contains the information about the library version: Global_Version VAR_GLOBAL CONSTANT st Lib Version_Tc2_MDP : ST_Lib Version; END_VAR st Lib Version_Tc2_MDP: Version number of the Tc2_MDP library (type: ST_Lib Version). To check whether the version you have is the version you need, use the function F_Cmp Lib Version (defined in Tc2_System library). All other options for comparing library versions, which you may know from Twin CAT 2, are outdated! TE1000 Version: 1.7.2 33
## Page 34

Error Codes 7 Error Codes 7.1 Error codes overview The function blocks of the Tc2_MDP library have an n Err ID output. This value is 4 bytes in size and returns the error code in the event of an error. n Err ID is comprised of two parts: Error Group Error Code (MSB) 2 Byte 2 Byte (LSB) 0x EC80 E_MDP_Err Codes PLC [} 35] 0x ECA6 MDP general error 0x ECA7 MDP API error 0x ECA8 ADS error 0x ECAF MDP module specific error The function block FB_MDP_Split Error ID [} 20] enables the automatic separation of the variable n Err ID into error group and error code. Error Group The fault group describes the type of error that has occurred. The different groups are listed in the enumeration E_MDP_Err Group [} 34]. All errors generated within the PLC library have the error group 0x EC80. Error Code The error code describes the specific error. For errors within the PLC library with the error group 0x EC80, the identifiers are listed in the enumeration E_MDP_Err Codes PLC [} 35]. A description of the other error codes can be found in the documentation of the IPC diagnostics in the section on error messages. General MDP-dependent errors are output in the error group 16#ECA6 “General error codes”. These errors sometimes indicate that an element from the module element list is not available. Example: 16#ECA60105 "No data available" If, in the case of a general or specific function block (see access options), several elements are queried at the same time and one of these elements is not available or exhibits an error, then the output variable i Err Pos indicates the index position (0..n) at which the error occurred for the first time. All elements below this index were queried successfully and are indicated despite the generation of an error at the output. Example: n Err ID = 0x ECA8 0745 The error group is 0x ECA8, therefore it is an Ads error. The error code is 0x 0745, therefore it is a timeout error. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 7.2 E_MDP_Err Group TYPE E_MDP_Err Group :( e MDP_Err_No Error := 16#0000, (* Success - No Error *) e MDP_Err_PLC := 16#EC80, (* PLC library internal error codes *) e MDP_Err_Gen Err := 16#ECA6, (* General error codes *) e MDP_Err_API := 16#ECA7, (* API error codes *) e MDP_Err_ADS := 16#ECA8, (* ADS error codes *) 34 Version: 1.7.2 TE1000
## Page 35

Error Codes e MDP_Err_Module Specific := 16#ECAF (* Module specific error codes *) ); END_TYPE The enumeration E_MDP_Err Group defines constant values for the different error groups in the MDP. These indicate the type of error. The values appear in the error codes [} 34], which are output by a PLC MDP function block in the event of an error. A general description can be found in the MDP Information Model in the chapter Return Values. Individual error codes from the error groups 16#ECA6 - 16#ECAF are described there. The error codes from group 16#EC80 are generated by the PLC MDP library and are described in chapter E_MDP_Err Codes PLC [} 35]. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 7.3 E_MDP_Err Codes PLC TYPE E_MDP_Err Codes PLC :( (* list of PLC library internal error codes *) e MDP_Err PLC_No Error := 16#0000, e MDP_Err PLC_Time Out := 16#0001, e MDP_Err PLC_Module Not Found := 16#0002, e MDP_Err PLC_Buffer Too Small := 16#0003, e MDP_Err PLC_Element Not Found := 16#0004 ); END_TYPE The enumeration E_MDP_Err Codes PLC defines constant values for the different errors that can be generated internally in the library. These values appear in the error codes [} 34], which are output by a PLC MDP function block in the event of an error. e MDP_Err PLC_Time Out The error e MDP_Err PLC_Time Out is generated if the time period t Timeout applied to the input of the function block has expired. The length of the processing time can vary depending on the MDP query. Due to the internal processes, the processing time can sometimes exceed the Standard ADS Timeout. This can be remedied by increasing the time period t Timeout applied to the input of the function block. e MDP_Err PLC_Module Not Found A list of active modules exists in the MDP. The function blocks in the PLC MDP library search this list for the queried module. If the list does not contain the module, then the error e MDP_Err PLC_Module Not Found is output. This is the case when the particular module/device is not installed on the system or does not even exist. e MDP_Err PLC_Buffer Too Small If a buffer has been specified at the input of the function block by means of pointers, then it is possible that this is not large enough for the existing data. In this case the error e MDP_Err PLC_Buffer Too Small is output. e MDP_Err PLC_Element Not Found The query of a certain element was not successful. The element was not found. The respective module or element may not even be present on the system. A general description can be found in the MDP Information Model.(IPC Diagnosis) TE1000 Version: 1.7.2 35
## Page 36

Error Codes Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_MDP 36 Version: 1.7.2 TE1000
## Page 37

Samples 8 Samples Update: Tc3_IPCDiag library The Twin CAT 3 PLC library Tc2_MDP is the predecessor to Tc3_IPCDiag. With the new Tc3_IPCDiag library the number of readable parameters has been increased and the user interface has been optimized. It is recommended to use the Tc3_IPCDiag library. Future extensions will no longer be performed in the Tc2_MDP library. It is not recommended to use the Tc2_MDP library for new projects. All functionalities of the Tc2_MDP library can also be found in the new Tc3_IPCDiag library. The section Querying CPU data (generic) [} 37] describes a sample program for reading the CPU data of the IPC diagnostics via the generic function block FB_MDP_Read Element. It is designed in such a way that it can be easily extended with the basic knowledge of the MDP information model for access to other IPC diagnosis modules. The sample for Querying the fan status (generic) [} 50] is based on the sample program for querying the CPU data. The section Querying CPU data (specific) [} 46] describes a sample program for reading the CPU data of the IPC diagnostics via the specific function block FB_MDP_CPU_Read. The sample cannot be extended for access to other IPC diagnostic modules, e.g. fan data. Further sample programs are described in the sections Reading IPC serial numbers [} 52] and Setting the IP address [} 54]. 8.1 Querying CPU data (generic) This sample demonstrates access to CPU data by the IPC diagnostics via the generic function block FB_MDP_Read Element [} 14]. The program is structured in such a way that it can easily be adapted for access to other IPC diagnostics modules. Program lines, which have to be modified to adapt the program to other IPC diagnostics modules, are identified in the comment with the string //**. Following the program code of the sample you will find the textual Description of the sample program [} 38]. Sample: access via the generic function block FB_MDP_Read Element Individual CPU data can be read via a subindex in module CPU in the Configuration Area of the IPC diagnostics. The generic function block FB_MDP_Read Element is used for this purpose. Enumeration definition //** = simply adjust these lines if modifying code for own purposes // central definition of state machine states // (supports easy program modification) {attribute 'qualified_only'} TYPE E_State : ( Idle, Read CPUusage Init, //** initiate reading CPU usage Read CPUusage Process //** process reading CPU usage ); END_TYPE Variable Declaration PROGRAM MAIN VAR // internal use s Ams Net Id : STRING := ''; //** ADS Net ID (local = '') e State : E_State; // Enum with index for state machine b Start : BOOL := TRUE; // flag to trigger (re)start of statemachine n Data : UINT; // data storage for unsigned integer st MDP_Addr : ST_MDP_Addr; // structure will include all address parameters // FB instances TE1000 Version: 1.7.2 37
## Page 38

Samples fb Read MDPElement : FB_MDP_Read Element; // instance of FB for reading MDP element // results of execution b Error : BOOL; // error flag (indicator: error occured) n Err ID : UDINT; // last error ID n Cpu Usage : UINT; // buffer for CPU usage (%) END_VAR Program code // For an easy re-use of the following code for own purposes, parts of this sample program use // "general" data names (and copy the results in specific variables after processing the code). CASE e State OF E_State. Idle: IF b Start THEN b Start := FALSE; e State := E_State. Read CPUusage Init; //** initiate first state END_IF E_State. Read CPUusage Init: st MDP_Addr.n Area := INT_TO_BYTE(e MDP_Area_Config Area); // ** set area address to "Config Area" st MDP_Addr.n Table Id := 1; //** table ID in module for "cpu properties" st MDP_Addr.n Sub Idx := 2; // ** subindex in table ID for "CPU usage" fb Read MDPElement( b Execute := TRUE, // Flag: trigger execution of FB e Module Type := e MDP_Mod T_CPU, //** desired module type = CPU st MDP_Addr := st MDP_Addr, // MDP address structure. Dynamic module ID added int ernally. i Mod Idx := 0, // ** instance of desired module type (0 = first instance) p Dst Buf := ADR(n Data), // buffer for storing data cb Dst Buf Len := SIZEOF(n Data), // length of buffer s Ams Net Id := s Ams Net Id, // AMS Net ID ); //** Note: fb Read MDPElement.t Time Out must be > cycle time! e State := E_State. Read CPUusage Process; //** next state: process FB E_State. Read CPUusage Process: //** process FB: request CPU data fb Read MDPElement(b Execute := FALSE); // Flag: Get execution state of FB //** Note: fb Read MDPElement.t Time Out must be > cycle time! IF NOT fb Read MDPElement.b Busy THEN // FB executed? IF fb Read MDPElement.b Error THEN // Error? b Error := TRUE; // set error flag n Err ID := fb Read MDPElement.n Err ID; // store error id (16#ECA60105 = BIOS or HW do es // not support this data (here: mainboard data)) e State := E_State. Idle; // finish state machine ELSE // set parameters for next steps b Error := FALSE; // turn off error flag n Cpu Usage := n Data; //** store CPU usage in dedicated variable e State := E_State. Read CPUusage Init; //** next state END_IF END_IF END_CASE Description of the sample program The function block FB_MDP_Read Element requires at least the parameters listed below: 38 Version: 1.7.2 TE1000
## Page 39

Samples • A memory area for the MDP address structure • The MDP module types • The address and size of the memory area for the output data of the function block • The AMS address (AMS Net ID) The output values of the function block are described here for completeness: A very important role is played by the structure for addressing the desired information. It is described by the data type ST_MDP_Addr: TE1000 Version: 1.7.2 39
## Page 40

Samples There are two possibilities to determine the parameter "n Area": • The individual areas are stored as enumerations in the Tc2_MDP library. This entry can be used as easily readable input parameter (dashed red arrow). • The value for the area can alternatively be taken from the index of a table (left-hand 4 bits - red arrow) 40 Version: 1.7.2 TE1000
## Page 41

Samples The parameter "n Module" is NOT an input parameter. The module address (=Module ID) determined by the function block is assigned to it after it has determined the desired module instance. "n Table Id" corresponds to the right-hand 4 bits of the table index (yellow arrow). "Subindex" is the number of the entry in the table (blue arrow). The "e Module Type" parameter specifies the type of the module. There is also an enumeration for the module type that can be used for better readability of the program: TE1000 Version: 1.7.2 41
## Page 42

Samples Alternatively the value can also be taken from the module description and entered directly. Structure of the state machine The states of the state machine are defined via enumeration values in a DUT and can thus be adapted or extended centrally and easily. 42 Version: 1.7.2 TE1000
## Page 43

Samples TE1000 Version: 1.7.2 43
## Page 44

Samples Functional areas of the state machine Input and output parameters of the sample program 44 Version: 1.7.2 TE1000
## Page 45

Samples TE1000 Version: 1.7.2 45
## Page 46

Samples 8.2 Querying CPU data (specific) This sample demonstrates access to CPU data by the IPC diagnostics via the specific function block FB_MDP_CPU_Read [} 20]. This sample cannot be modified for access to other IPC diagnostics modules such as fan data. Following the program code of the sample you will find the textual Description of the sample program [} 47]. Sample: access via the specific function block FB_MDP_CPU_Read The specific function block FB_MDP_CPU_Read facilitates access to selected data of the CPU module in the Configuration Area of the IPC diagnostics. Enumeration definition //** = simply adjust these lines if modifying code for own purposes // central definition of state machine states // (supports easy program modification) {attribute 'qualified_only'} TYPE E_State : ( Idle, Read CPUData Init, //** initiate reading CPU data Read CPUData Process //** process reading CPU data ); END_TYPE Variable Declaration PROGRAM MAIN VAR // internal use s Ams Net Id : STRING := ''; //** ADS Net ID (local = '') e State : E_State; // Enum with index for state machine b Start : BOOL := TRUE; // flag to trigger (re)start of statemachine // FB instances fb Read CPUData : FB_MDP_CPU_Read; // instance of FB for reading CPU data // results of execution b Error : BOOL; // error flag (indicator: error occured) n Err ID : UDINT; // last error ID st Header Cpu Mod : ST_MDP_Module Header; // buffer for header data of CPU module st CPUData : ST_MDP_CPU; // structure which will contain CPU data END_VAR Program code // For an easy reuse of the following code for own purposes, parts of this sample program use // "general" data names (and copy the results in specific variables after processing the code). CASE e State OF E_State. Idle: IF b Start THEN b Start := FALSE; e State := E_State. Read CPUData Init; //** initiate first state END_IF E_State. Read CPUData Init: //** trigger FB: request CPU data fb Read CPUData( b Execute := TRUE, // Flag: trigger execution of FB i Mod Idx := 0, // ** Instance of desired module type (0 = first instance) s Ams Net Id := s Ams Net Id); // AMS Net ID e State := E_State. Read CPUData Process; //** next state: process FB E_State. Read CPUData Process: //** process FB: request CPU data fb Read CPUData(b Execute := FALSE); // Flag: Get execution state of FB IF NOT fb Read CPUData.b Busy THEN // FB executed? IF fb Read CPUData.b Error THEN // Error? b Error := TRUE; // set error flag 46 Version: 1.7.2 TE1000
## Page 47

Samples n Err ID := fb Read CPUData.n Err ID; // store error id e State := E_State. Idle; // finish state machine ELSE // set parameters for next steps b Error := FALSE; // turn off error flag st Header Cpu Mod := fb Read CPUData.st MDP_Module Header; // ** store CPU module header data st CPUData := fb Read CPUData.st MDP_Module Content; //** store CPU data e State := E_State. Read CPUData Init; //** read next set of CPU data END_IF END_IF END_CASE Description of the sample program The function block "FB_MDP_CPU_READ" requires a minimum of two parameters: • The AMS Net ID as input parameter for the address of the IPC (local: ‘‘) • A structure st MDP_Module Content that contains the data after calling the function block. the function block does not supply the CPU temperature; this can only be read via the generic sample program. The value "CPU temperature" is not supported by all IPCs. The parameters and the function block are used at these points in the program: TE1000 Version: 1.7.2 47
## Page 48

Samples 48 Version: 1.7.2 TE1000
## Page 49

Samples The state machine The states of the state machine are listed as constants in order to enable simple adaptation of the program. The desired "State" value thus only needs to be centrally changed once. The statuses are defined as enumeration declarations in the PLC project in subfolder "DUTs" as DUT under the name "E-State". The various areas of the state machine and their functions are explained below: TE1000 Version: 1.7.2 49
## Page 50

Samples 8.3 Querying the fan state (generic) This sample illustrates access to the fan speed data via the generic function block FB_MDP_Read Element [} 14]. It can be used to diagnose a fan failure (fan speed = 0). A prerequisite is the presence of a fan. If no fan is available in the IPC, the IPC does not support the addressed module type, and the access attempt results in the error message 16#EC800002. The contents of the FAN module are described in the Configuration Area of the IPC diagnostics. The generic function block FB_MDP_Read Element is used for the access. A description of the structure of this sample program can be found in the sample: Querying CPU data (generic) [} 37]. Sample: access via the generic function block FB_MDP_Read Element Enumeration definition //** = simply adjust these lines if modifying code for own purposes // central definition of state machine states // (supports easy program modification) {attribute 'qualified_only'} TYPE E_State : ( Idle, // idle state Read Fan Speed Init, //** initiate reading fan speed Read Fan Speed Process //** process reading fan speed ); END_TYPE 50 Version: 1.7.2 TE1000
## Page 51

Samples PROGRAM MAIN VAR // internal use s Ams Net Id : STRING := ''; //** ADS Net ID (local = '') e State : E_State; // Enum with index for state machine b Start : BOOL := TRUE; // flag to trigger restart of statemachine n Data : UINT; // data storage for unsigned integer st MDP_Addr : ST_MDP_Addr; // structure will include all address parameters n Module Index : USINT := 0; //** Fan index (no. of fan) // FB instances fb Read MDPElement : FB_MDP_Read Element; // instance of FB for reading MDP element // results of execution b Error : BOOL; // error flag (indicator: error occured) n Err ID : UDINT; // last error ID a Fan Speed : ARRAY[0..1] OF UINT; //** buffer for speed of fans END_VAR Program code // For an easy re-use of the following code for own purposes, parts of this sample program use // "general" data names (and copy the results in specific variables after processing the code). // Remark: Error 16#EC800002 means module type not supported (IPC does not provide this type of information, e.g. does not have fans) CASE e State OF E_State. Idle: IF b Start THEN b Start := FALSE; e State := E_State. Read Fan Speed Init; //** initiate first state END_IF E_State. Read Fan Speed Init: //** st MDP_Addr.n Area := INT_TO_BYTE(e MDP_Area_Config Area); //** set area address to "Config Area" st MDP_Addr.n Table Id := 1; //** table ID in module for "Fan properties" st MDP_Addr.n Sub Idx := 1; //** subindex in table ID for "Fan speed" fb Read MDPElement( b Execute := TRUE, // Flag: trigger execution of FB e Module Type := e MDP_Mod T_Fan, //** desired module type = Fan st MDP_Addr := st MDP_Addr, // MDP address structure. Dynamic module ID added internally. i Mod Idx := n Module Index, //** instance of desired module type (0 = first instance) p Dst Buf := ADR(n Data), // buffer for storing data cb Dst Buf Len := SIZEOF(n Data), // length of buffer s Ams Net Id := s Ams Net Id, // AMS Net ID ); //** Note: fb Read MDPElement.t Time Out must be > cycle time! e State := E_State. Read Fan Speed Process;//** next state: process FB E_State. Read Fan Speed Process: //** process FB: request fan data fb Read MDPElement(b Execute := FALSE); // Flag: Get execution state of FB //** Note: fb Read MDPElement.t Time Out must be > cycle time! IF NOT fb Read MDPElement.b Busy THEN // FB executed? IF fb Read MDPElement.b Error THEN // Error? b Error := TRUE; // set error flag n Err ID := fb Read MDPElement.n Err ID; // store error id (16#ECA60105 = BIOS or HW does // not support this data (here: mainboard data)) e State := E_State. Idle; // finish state machine ELSE // set parameters for next steps b Error := FALSE; // turn off error flag a Fan Speed[n Module Index] := n Data; //** store fan speed in dedicated array IF n Module Index = 0 THEN //** Current fan = fan 1? n Module Index := 1; //** Read fan 2 (= second module instance) in next loop ELSE //** n Module Index := 0; //** Read fan 1 (= first module instance) in next loop END_IF //** e State := E_State. Read Fan Speed Init; //** next state END_IF END_IF END_CASE TE1000 Version: 1.7.2 51
## Page 52

Samples 8.4 Reading IPC serial numbers This sample illustrates access to the serial number of the IPCs and the serial number of the IPC's mainboard. • The serial number of the mainboard can be read via a subindex in module Mainboard in the Configuration Area of the IPC diagnostics. The general function block FB_MDP_Read Element [} 14] is used for this purpose. • The serial number of the IPC can be read via index 0x F9F0 in the Device Area of the IPC diagnostics. The general function block FB_MDP_Read Index [} 13] is used for this purpose. Sample: querying the serial number of a Beckhoff IPC Enumeration definition //** = simply adjust these lines if modifying code for own purposes // central definition of state machine states // (supports easy program modification) {attribute 'qualified_only'} TYPE E_State : ( Idle, // idle state Read Sno Mainboard Init, //** initiate reading serial number of mainboard Read Sno Mainboard Process, //** process reading serial number of mainboard Read Sno IPCInit, //** initiate reading serial number of IPC Read Sno IPCProcess //** process reading serial number of IPC ); END_TYPE Variable Declaration PROGRAM MAIN VAR // internal use s Ams Net Id : STRING := ''; //** ADS Net ID (local = '') e State : E_State; // Enum with index for state machine b Start : BOOL := TRUE; // flag to trigger restart of statemachine s Data : STRING; // data storage for string variable st MDP_Addr : ST_MDP_Addr; // structure which will include all address parameters // FB instances fb Read MDPElement : FB_MDP_Read Element; // instance of FB for reading MDP element fb Read MDPIndex : FB_MDP_Read Index; // instance of FB for reading MDP index // results of execution b Error : BOOL; // error flag (indicator: error occured) n Err ID : UDINT; // last error ID s Serial No Mainboard : STRING; //** buffer for serial number of mainboard s Serial No IPC : STRING; //** buffer for serial number of IPC END_VAR Program code // For an easy re-use of the following code for own purposes, parts of this sample program use // "general" data names (and copy the results in specific variables after processing the code). CASE e State OF E_State. Idle: IF b Start THEN b Start := FALSE; e State := E_State. Read Sno Mainboard Init; //** initiate first state END_IF // ** read serial number of mainboard ************************************************************** E_State. Read Sno Mainboard Init: //** trigger FB: request mainboard serial number s Data := ''; // clear data buffer s Serial No Mainboard := ''; //** clear buffer for serial number of mainboard st MDP_Addr.n Area := INT_TO_BYTE(e MDP_Area_Config Area); // ** set area address to "Config Area" st MDP_Addr.n Table Id := 1; //** table ID in index for "mainboard information" st MDP_Addr.n Sub Idx := 2; // ** subindex in table ID for "serial number" 52 Version: 1.7.2 TE1000
## Page 53

Samples fb Read MDPElement( b Execute := TRUE, // Flag: trigger execution of FB e Module Type := e MDP_Mod T_Mainboard, // ** desired module type / index = Mainboard st MDP_Addr := st MDP_Addr, // MDP address structure. Dynamic module ID will be added internally. i Mod Idx := 0, // ** Instance of desired module type (default: 0 = first instance) p Dst Buf := ADR(s Data), // buffer for storing data cb Dst Buf Len := SIZEOF(s Data), // length of buffer s Ams Net Id := s Ams Net Id, // AMS Net ID ); e State := E_State. Read Sno Mainboard Process; //** next state: process FB E_State. Read Sno Mainboard Process: //** process FB: request mainboard serial number fb Read MDPElement(b Execute := FALSE); // Flag: Get execution state of FB IF NOT fb Read MDPElement.b Busy THEN // FB executed? IF fb Read MDPElement.b Error THEN // Error? b Error := TRUE; // set error flag n Err ID := fb Read MDPElement.n Err ID; // store error id (16#ECA60105 = BIOS or HW does // not support this data (here: mainboard data)) e State := E_State. Idle; // finish state machine ELSE // set parameters for next steps b Error := FALSE; // turn off error flag s Serial No Mainboard := s Data; // ** store serial number of mainboard in dedicated variable e State := E_State. Read Sno IPCInit; //** next state END_IF END_IF // ** read serial number of IPC ************************************************************** E_State. Read Sno IPCInit: // ** trigger FB: request single index in MDP Device Area, IPC serial number s Data := ''; // clear data buffer s Serial No IPC := ''; //** clear buffer for serial number of IPC fb Read MDPIndex( b Execute := TRUE, // Flag: trigger execution of FB n Index := 16#F9F0, //** index: read serial number IPC (- > see docu 'MDP device area') n Sub Index := 0, // ** first subdindex (there is only one available for index 16#F9F0) p Dst Buf := ADR(s Data), // buffer for storing serial number cb Dst Buf Len := SIZEOF(s Data), // length of buffer s Ams Net Id := s Ams Net Id, // AMS Net ID ); e State := E_State. Read Sno IPCProcess; //** next state: process FB E_State. Read Sno IPCProcess: // ** process FB:: request single index in MDP Device Area, IPC serial number fb Read MDPIndex(b Execute := FALSE); // flag: Get execution state of FB IF NOT fb Read MDPIndex.b Busy THEN // FB executed? IF fb Read MDPIndex.b Error THEN // error? b Error := TRUE; // set error flag n Err ID := fb Read MDPIndex.n Err ID; // store error id (16#ECA60105 = BIOS or HW does // not support this data (here: IPC serial number)) e State := E_State. Idle; // finish state machine ELSE // set parameters for next steps b Error := FALSE; // turn off error flag s Serial No IPC := s Data; //** store serial number of mainboard e State := E_State. Idle; // ** set here next state if expanding the state machine END_IF END_IF END_CASE Returning of the mainboard serial number instead of the IPC serial number In older BIOS version (before Q4/2013) the serial number was not stored in the IPC BIOS. In these cases the return value is the serial number of the IPC mainboard. With older Beckhoff Automation Device Driver versions, the return value is also the serial number of the IPC mainboard. The serial number of the IPC mainboard can always be read via the mainboard module TE1000 Version: 1.7.2 53
## Page 54

Samples 8.5 Setting the IP address This sample illustrates write access to IPC diagnostics data via general function blocks. In the same way all other elements of the IPC diagnostics modules can be accessed. Active network connection Changing these settings requires an active network connection for the selected Ethernet/Ether CAT adapter. Without an active network connection no parameters can be (pre-)set. Sample: setting the IP address of a Beckhoff IPC Variable Declaration PROGRAM MAIN // First DHCP is set off and then the given new IP address is set. // The program code is executed only one time. To restart the program set b Start TRUE again. VAR b Start : BOOL := TRUE; n State : INT := 100; fb Scan : FB_MDP_Scan Modules; fb Write : FB_MDP_Write; st MDPAddr : ST_MDP_Addr; b DHCP : BOOL; s IP : T_IPv4Addr := '174.18.3.154'; // the new ip address b Error : BOOL; n Err ID : UDINT; END_VAR Program code CASE n State OF 100: // idle IF b Start THEN b Start := FALSE; n State := 00; END_IF 00: (* scan MDP module list for dyn.module id of NIC module *) fb Scan( b Execute := TRUE, n Module Type := e MDP_Mod T_NIC, i Mod Idx := 0, (* index of NIC module / network port *) s Ams Net Id := '' ); n State := 01; 01: fb Scan( b Execute:= FALSE ); IF NOT fb Scan.b Busy THEN IF NOT fb Scan.b Error THEN st MDPAddr.n Area := INT_TO_BYTE(e MDP_Area_Config Area); st MDPAddr.n Module Id := fb Scan.n Dyn Module Id; st MDPAddr.n Table Id := 1; n State := 10; ELSE b Error := TRUE; n Err ID := fb Scan.n Err ID; n State := 00; END_IF END_IF 10: // set DHCP off st MDPAddr.n Sub Idx := 4; // DHCP b DHCP := FALSE; fb Write( b Execute := TRUE, st MDP_Dyn Addr := st MDPAddr, p Src Buf := ADR(b DHCP), cb Src Buf Len := SIZEOF(b DHCP), s Ams Net Id := '' ); n State:= 11; 54 Version: 1.7.2 TE1000
## Page 55

Samples 11: fb Write( b Execute:= FALSE ); IF NOT fb Write.b Busy THEN IF NOT fb Write.b Error THEN n State := 20; ELSE b Error := TRUE; n Err ID := fb Write.n Err ID; n State := 10; END_IF END_IF 20: // set new IP address st MDPAddr.n Sub Idx := 2; // IP address fb Write( b Execute := TRUE, st MDP_Dyn Addr := st MDPAddr, p Src Buf := ADR(s IP), cb Src Buf Len := LEN(s IP), s Ams Net Id := '' ); n State := 21; 21: fb Write( b Execute:= FALSE ); IF NOT fb Write.b Busy THEN IF NOT fb Write.b Error THEN n State := 100; (* NIC settings executed *) ELSE b Error := TRUE; n Err ID := fb Write.n Err ID; n State := 20; END_IF END_IF END_CASE TE1000 Version: 1.7.2 55
## Page 57

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
