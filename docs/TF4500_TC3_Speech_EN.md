---
title: "TF4500 Twin CAT 3"
product: "TF4500"
category: "Utilities"
tags: ["CAT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.6.1"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF4500_TC3_Speech_EN.pdf"
release_date: "2024-09-04"
---
Manual | EN TF4500 Twin CAT 3 | Speech 2024-09-04 | Version: 1.6.1
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation......................................................................................................................................... 9 3.3 Licensing........................................................................................................................................... 9 4 Technical introduction............................................................................................................................ 12 4.1 Available languages........................................................................................................................ 12 4.1.1 Setting Microsoft SAPI..................................................................................................... 15 4.1.2 Setting Amazon Polly....................................................................................................... 16 5 Quick start: speech input (ASR)............................................................................................................ 17 5.1 Creating a configuration.................................................................................................................. 17 5.2 Configuring speech input................................................................................................................ 18 5.3 Programming the PLC..................................................................................................................... 24 6 Quick start: speech output (TTS)........................................................................................................... 27 6.1 Creating a configuration.................................................................................................................. 27 6.2 Configuring speech output.............................................................................................................. 28 6.3 Programming the PLC..................................................................................................................... 35 7 Quick start Event Logger........................................................................................................................ 38 7.1 Creating a configuration.................................................................................................................. 38 7.2 Configuring Event-To-Speech......................................................................................................... 39 7.3 Configuring Speech-To-Event......................................................................................................... 41 8 Configuration........................................................................................................................................... 44 8.1 User interface.................................................................................................................................. 44 8.2 General Configurations................................................................................................................... 44 8.3 Testing the sound card.................................................................................................................... 50 8.4 Configuring a grammar file.............................................................................................................. 52 8.5 Microsoft SAPI: installing additional languages.............................................................................. 54 9 SPS API.................................................................................................................................................... 56 9.1 Data Types...................................................................................................................................... 56 9.1.1 Enums.............................................................................................................................. 56 9.2 Function Blocks............................................................................................................................... 57 9.2.1 License Overview............................................................................................................. 57 9.2.2 FB_Play............................................................................................................................ 58 9.2.3 FB_Set Rule State............................................................................................................. 59 9.2.4 FB_Speech Recognition................................................................................................... 61 9.2.5 FB_Text To Speech........................................................................................................... 63 10 Samples................................................................................................................................................... 65 10.1 Sample 01: Simple ASR and TTS sample...................................................................................... 66 TF4500 Version: 1.6.1 3
## Page 4

Table of contents 10.2 Sample 02: Complex ASR.............................................................................................................. 66 10.3 Sample 03: Event Logger................................................................................................................. 67 10.4 Sample 04: File Playback................................................................................................................ 67 10.5 Sample 05: Activation/deactivation of individual recognition tags................................................... 68 10.6 Sample 06: Twin CAT HMI with Twin CAT Speech Integration........................................................ 68 11 FAQ........................................................................................................................................................... 69 12 Appendix.................................................................................................................................................. 70 12.1 Error List.......................................................................................................................................... 70 12.2 Third-party Components................................................................................................................. 71 12.3 Support and Service........................................................................................................................ 71 4 Version: 1.6.1 TF4500
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. For installation and commissioning of the components, it is absolutely necessary to observe the documentation and the following notes and explanations. The qualified personnel is obliged to always use the currently valid documentation. The responsible staff must ensure that the application or use of the products described satisfies all requirements for safety, including all the relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. No claims to modify products that have already been supplied may be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of designations or trademarks used in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Patents The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 and similar applications and registrations in several other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document as well as the use and communication of its contents without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. TF4500 Version: 1.6.1 5
## Page 6

Foreword Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.6.1 TF4500
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF4500 Version: 1.6.1 7
## Page 8

Overview 2 Overview Twin CAT Speech enables people and machines to interact via speech input and output. The interaction with Twin CAT takes place in different languages and can be used across industries in many applications from mechanical engineering to building automation. For example, the operating or maintenance staff can be informed about or influence the state of the controller. Twin CAT Speech provides the following functions: • Communication via the audio output of the PC-based controller (sound card with speakers, headset, etc.) • Speech input and output in the languages supported by Microsoft SAPI. • Speech output in the languages that Amazon Polly provides. • Caching of generated speech outputs Through the use of Microsoft SAPI and the caching of speech outputs that may be generated online, you can achieve offline use. Twin CAT Speech is based on the two components Automatic Speech Recognition (ASR) and Text-to- Speech (TTS). ASR is the speech recognition and is responsible for ensuring that speech input, which is recorded via a microphone, is usable in the PLC. TTS is the text-to-speech output and enables the machine to output speech. Twin CAT Speech has an online function that is provided with the aid of the Amazon text-to-speech service Polly. It is possible to set different voices and to cache the audio files generated online. The speech input has an offline function, which is realized by the built-in functions of the Windows operating system. 8 Version: 1.6.1 TF4500
## Page 9

Installation 3 Installation 3.1 System requirements Technical data Description Operating system Windows 10 Target platform x64 Minimum Twin CAT version 3.1 Build 4024.12 | 3.1 Build 4026.10 Twin CAT licenses TC1200, TF4500 on the XAR Engineering Xae Shell, Xae Shell64 or Visual Studio 2017/ 2019/2022 Audio devices Windows compatible Minimum Twin CAT HMI version 1.12.744.0 A Twin CAT HMI Client license is required for the Twin CAT Speech connection. 3.2 Installation Twin CAT Package Manager: Installation (Twin CAT 3.1 Build 4026) Detailed instructions on installing products can be found in the chapter Installing workloads in the Twin CAT 3.1 Build 4026 installation instructions. Install the following workload to be able to use the product: • TF4500 | Twin CAT 3 Speech Twin CAT setup: Installation (Twin CAT 3.1 Build 4024 and earlier) A separate installer is used for the installation. Installation is required on both Engineering (XAE) and Runtime (XAR). 1. To install Twin CAT Speech, open the .exe file. 2. Select the required language. 3. Follow the instructions in the setup wizard. ð You will receive a message when the installation is complete. Twin CAT HMI Server Extension . NET Core Runtime must be installed on the Twin CAT HMI Server side in order to use the Twin CAT HMI Server Extension. 3.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". TF4500 Version: 1.6.1 9
## Page 10

Installation Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 10 Version: 1.6.1 TF4500
## Page 11

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. TF4500 Version: 1.6.1 11
## Page 12

Technical introduction 4 Technical introduction Twin CAT Speech uses the sound cards of the Windows operating system for speech input and output. These are typically connected via USB. Other sound cards can also be used as long as Windows recognizes them as sound devices. With the configuration project, Twin CAT Speech represents a dedicated project system in the engineering in order to enable the selection of sound cards and languages as well as further connections to the Twin CAT HMI or Twin CAT Event Logger. The configuration is loaded to the corresponding target system by activation and is available for use from the next start of Twin CAT. A Twin CAT HMI client can be used as a virtual sound card. This client can run on the same or another computers or indeed a mobile device, for example. All you need is an HTML5-compatible browser. However, an HMI user interface can also be directly voice-operated. The following graphic illustrates the architecture of Twin CAT Speech: See also: Twin CAT HMI Twin CAT Event Logger 4.1 Available languages Twin CAT Speech uses two subordinated components to realize speech recognition and speech output: Microsoft SAPI for ASR and TTS, and Amazon Polly for TTS only. This allows a variety of languages to be provided. The following tables provide an overview of the languages that are available. 12 Version: 1.6.1 TF4500
## Page 13

Technical introduction Microsoft SAPI - speech recognition (ASR) Language Lang ID Microsoft SAPI – ASR German 1031 de-DE English 1033 en-US 2057 en-GB French 1036 fr-FR Japanese 1041 ja-JP Spanish 1034 es-ES Chinese 2052 zh-cn 3076 zh-hk Note that the appropriate Windows language packs must be installed in order to be used. This is described here. Microsoft SAPI - speech output (TTS) Language Lang ID Microsoft SAPI – TTS German 1031 Hedda English 1033 Zira, David 2057 Hazel French 1036 Hortense Italian 1040 Elsa Japanese 1041 Haruka Spanish 3082 Helena 2058 Sabina Korean 1042 Heami Polish 1045 Paulina Portuguese 1046 Maria Russian 1049 Irina Chinese 2052 Huihui 3076 Tracy 1028 Hanhan Please note that the appropriate Windows language packs must be installed in order to be used. This is described here [} 54]. Other languages may be available, but have not been tested with Twin CAT Speech. Some of these are reserved for Cortana and Twin CAT Speech cannot use them via the SAPI: https://support.microsoft.com/ en-us/help/22805/windows-10-supported-narrator-languages-voices The basic compatibility can be checked as follows. 1. Install the desired language. TF4500 Version: 1.6.1 13
## Page 14

Technical introduction 2. Open the Text-to-Speech menu from the "Control Panel". ð If languages are displayed here, they should also be usable with Twin CAT Speech. 14 Version: 1.6.1 TF4500
## Page 15

Technical introduction Amazon Polly - speech output (TTS) Language Lang ID Amazon Polly – TTSTTS German 1031 Hans, Marlene, Vicki English 1033 Ivy, Joanna, Kendra, Kimberly, Salli, Joey, Justin, Kevin, Matthew 3081 Nicole, Russell 2057 Amy, Emma, Brian 16393 Aditi, Raveena Danish 1030 Naja, Mads Dutch 1043 Ruben, Lotte French 1036 Celine, Léa, Mathieu 3084 Chantal Icelandic 1039 Dora, Karl Italian 1040 Carla, Bianca, Giorgio Japanese 1041 Mizuki, Takumi Norwegian 1044 Liv Korean 1042 Seoyeon Polish 1045 Ewa, Maja, Jacek, Jan Portuguese 1046 Camila, Vitória/Vitoria, Ricardo 2070 Inês/Ines, Cristiano Romanian 1048 Carmen Russian 1049 Tatyana, Maxim Spanish 1034 Conchita, Lucia, Enrique 2058 Mia Swedish 1053 Astrid Turkish 1055 Filiz Welsh 1106 Gwyneth Further information on Amazon Polly can be found here: https://docs.aws.amazon.com/polly/latest/dg/ voicelist.html To support new languages, you need to update Twin CAT Speech. See also: Microsoft SAPI: installing additional languages [} 54] Also see about this 2 Microsoft SAPI: installing additional languages [} 54] 4.1.1 Setting Microsoft SAPI Microsoft's SAPI speech synthesis service is usable without an active Internet connection. In the basic version, it provides the languages of the language packs installed on the computer and one voice per language. The configuration of the SAPI takes place during the configuration of the respective sound card. If you cannot select the desired language, you must install it; see Installing additional languages. TF4500 Version: 1.6.1 15
## Page 16

Technical introduction 4.1.2 Setting Amazon Polly The speech synthesis service Polly works on the basis of a cloud system and each query placed via Polly costs money. For this reason, you can only use Polly with an active Internet connection and an AWS account. You create an account to use Polly via AWS Identity and Access Management (IAM). 1. Create an account on the website www.aws.amazon.com/de/polly. 2. Place the access key to use Polly in the Twin CAT Speech configuration. 3. If you configure Polly as a speech recognition service in the TTS Configuration Wizard, you must enter your access key. 16 Version: 1.6.1 TF4500
## Page 17

Quick start: speech input (ASR) 5 Quick start: speech input (ASR) The following chapter is intended to simplify the configuration of Twin CAT Speech for speech input. The instructions do not address more complex configurations at this point. These can be found in the chapter Configuration [} 44]. 5.1 Creating a configuration Twin CAT Speech is parameterized via its own configuration project in Twin CAT Engineering. New Twin CAT Speech configurations are created as follows: 1. Open Twin CAT Engineering and create a new project. 2. Select an empty Twin CAT Controller project, name it, and click OK. ð The new Twin CAT Controller project opens. 3. Right-click the new Twin CAT Controller project. TF4500 Version: 1.6.1 17
## Page 18

Quick start: speech input (ASR) 4. Select Add>New Item. ð The Add New Item window opens. 5. Select Twin CAT Speech Configurator, name the configuration, and click Add. ð The start window for the Twin CAT Speech configuration opens. 6. Select the desired target system. ð Assignment to a target system is important for Twin CAT Speech, because the hardware configuration of the sound cards is individual. ð A new Twin CAT Speech configuration has now been created. 5.2 Configuring speech input A configuration wizard is available for the configuration of the speech input (ASR). This guides you through the ASR configuration. 18 Version: 1.6.1 TF4500
## Page 19

Quick start: speech input (ASR) 1. To open the ASR Configuration Wizard, right click Twin CAT Speech Configurator in the Solution Explorer. 2. Select Start ASR Wizard from the context menu. ð The ASR Configuration Wizard opens. In the lower section you will see a list of all already configured microphones, which is empty in the case of a new project. A selected microphone is listed in the upper section. In the first part of the configuration, the wizard guides you through the configuration of the microphone input of the sound card. 3. To add a new microphone input, click the + button. TF4500 Version: 1.6.1 19
## Page 20

Quick start: speech input (ASR) ð The Device Wizard opens. 4. In the Select Device drop-down list, select the appropriate microphone input. If you select the Default Windows Input Device here, the default sound card set in the operating system will always be used. 5. Click the Save button. ð The Device Wizard closes. 6. If necessary, mark the newly created microphone input and click Select. ð The microphone input is added to the list Selected Device for ASR. 7. Click the Next button. 20 Version: 1.6.1 TF4500
## Page 21

Quick start: speech input (ASR) ð The second part of the configuration opens, which is where you configure the actual speech recognition service. As in the first step, a list of services that have already been configured is shown below. The selected service is in the list Selected Service for ASR Configuration. 8. To add a speech recognition service, click the + button. ð The ASR Service Wizard opens and guides you through the configuration of a speech recognition service and an SRGS file. 9. Now configure a speech recognition service. 10. Select the desired provider from the ASR Service drop-down list. 11. You can give the speech recognition service its own name in the ASR Service Name input field. 12. Configure a grammar file with the sentences to be recognized. 13. To add a grammar file, click the + button. TF4500 Version: 1.6.1 21
## Page 22

Quick start: speech input (ASR) 14. Create a new grammar file by clicking Create new Grammar File. 15. Name the file in the Grammar Name input field. 16. Select the desired default language from the Language drop-down list. You can store several languages in the SRGS Editor and switch between them later, for example from the PLC or HMI. 17. Click the + button. ð A new row is added. 18. Click the Save button. ð The configured grammar file appears in the Grammar File drop-down list and the selected language is shown in the Language box. 19. If you want to save the speech inputs, check the Retain Audio check box. 20. In the Folder Path input box, enter the location where you want to store the speech inputs. 21. Click the Save button. 22 Version: 1.6.1 TF4500
## Page 23

Quick start: speech input (ASR) ð The ASR Service Wizard closes. 22. If speech recognition services have already been created, select the newly created speech recognition service and click Select. ð The speech recognition service is added to the list in the section Selected Service for ASR Configuration. 23. Click the Finish button. ð At the end of the configuration, Twin CAT Speech creates an identification number for it. This can be found in the list of ASR configurations under Configuration Id and you need it for the PLC programming of the Twin CAT Speech project. 24. Activate the Twin CAT Speech configuration on the target system. ð The Twin CAT Speech configuration is activated on the target system and can be used by the PLC. TF4500 Version: 1.6.1 23
## Page 24

Quick start: speech input (ASR) 5.3 Programming the PLC A PLC project must be programmed in order to use Twin CAT Speech. For a quick start, this is explained below on the basis of this sample [} 66]. 1. Create a new PLC project. 2. Add the Tc3_Speech library. 24 Version: 1.6.1 TF4500
## Page 25

Quick start: speech input (ASR) 3. Insert the following code from Sample01 into Main ASR. Declaration part: PROGRAM Main ASR VAR // ASR Trigger Variables b Listen Trigger : BOOL := FALSE; b Listen Stop Trigger : BOOL := FALSE; // TTS Command Configuration n Config Id TTS : UINT := 200; // ASR Command Configuration n Config Id ASR : UINT := 100; // Language Id for TTS Output n Language Id : UINT := 1033; // fb TTS is required for providing TTS responses upon successful recognitions in this sample. fb TTS : FB_Text To Speech := (n Configuration Id := n Config Id TTS); fb ASR : FB_Speech Recognition:= (n Configuration Id := n Config Id ASR); fb Retrieve Utterance : FB_Retrieve Utterance; // Update Code before Release // TTS Variables (required for TTS responses upon recognition) b Speak : BOOL := FALSE; {attribute 'Tc Encoding':= 'UTF-8'} s Text2Speech : STRING(4096) := '<speak> Tc Speech beta demo project is greeting you </speak>'; // ASR Variables b Listen : BOOL := FALSE; n Last Reco Id : ULINT := 0; s Last Recognition : STRING(4096) := ''; f Confidence Threshold : REAL := 0.7; // Tc Speech will inform PLC if recognition confidence is larger than this threshold b Init : BOOL := FALSE; Process part: IF NOT binit THEN fb TTS. Set Ams Net Addr(GVL_Speech Demo.s Ams Net Id); fb ASR. Set Ams Net Addr(GVL_Speech Demo.s Ams Net Id); binit := TRUE; END_IF // ASR - Automatic Speech Recognition // Trigger Start/Stop Listening IF b Listen Trigger THEN b Listen Trigger:=FALSE; b Listen := TRUE; END_IF IF b Speak THEN // for answering a recognized ASR command ... fb TTS(s Utterance := s Text2Speech,b Speak := TRUE, n Configuration Id:= n Config Id TTS, n Language Id:=n Language Id); IF NOT fb TTS.b Busy THEN fb TTS(s Utterance := s Text2Speech,b Speak := FALSE, n Configuration Id:= n Config Id TTS); b Speak := FALSE; END_IF END_IF IF b Listen THEN IF b Listen Stop Trigger THEN fb ASR(b Listen := FALSE,n Configuration Id:= n Config Id ASR); ELSE fb ASR(b Listen := TRUE,n Configuration Id:= n Config Id ASR); END_IF IF NOT fb ASR.b Busy THEN fb ASR(b Listen:= FALSE,n Configuration Id:= n Config Id ASR); blisten := FALSE; b Listen Stop Trigger := FALSE; END_IF END_IF // Check if new Recognition is available IF n Last Reco Id <> fb ASR.n Recognition Id THEN IF NOT b Speak THEN IF fb Asr.f Recognition Confidence > f Confidence Threshold THEN // if recognition better than treshhold, answer via TTS. Next cycle will process via FB_Switch Language // Check if Recognition Confidence is high enough n Last Reco Id := fb ASR.n Recognition Id; fb Retrieve Utterance(n Language Id := n Language Id, s Recognition Tag := fb ASR.s Recognition Tag,f Recognition Confidence := fb Asr.f Recognition Confidence, s Text2Speech => s Text2Speech); b Speak := TRUE; END_IF END_IF END_IF END_VAR TF4500 Version: 1.6.1 25
## Page 26

Quick start: speech input (ASR) 4. Set "b Listen" to TRUE to make a speech input. The Twin CAT configuration must have been activated beforehand. The identification number for the ASR configuration to be used is present in the code as Config Id ASR. 26 Version: 1.6.1 TF4500
## Page 27

Quick start: speech output (TTS) 6 Quick start: speech output (TTS) The following chapter is intended to illustrate the configuration of Twin CAT Speech for speech output. The instructions do not address more complex configurations at this point. These can be found in the chapter Configuration [} 44]. 6.1 Creating a configuration Twin CAT Speech is parameterized via its own configuration project in Twin CAT Engineering. New Twin CAT Speech configurations are created as follows: 1. Open Twin CAT Engineering and create a new project. 2. Select an empty Twin CAT Controller project, name it, and click OK. ð The new Twin CAT Controller project opens. 3. Right-click the new Twin CAT Controller project. TF4500 Version: 1.6.1 27
## Page 28

Quick start: speech output (TTS) 4. Select Add>New Item. ð The Add New Item window opens. 5. Select Twin CAT Speech Configurator, name the configuration, and click Add. ð The start window for the Twin CAT Speech configuration opens. 6. Select the desired target system. ð Assignment to a target system is important for Twin CAT Speech, because the hardware configuration of the sound cards is individual. ð A new Twin CAT Speech configuration has now been created. 6.2 Configuring speech output A configuration wizard is available for the configuration of the speech output (TTS). This guides you through the TTS configuration 28 Version: 1.6.1 TF4500
## Page 29

Quick start: speech output (TTS) 1. To open the TTS Configuration Wizard, right-click the Twin CAT Speech configuration in the Solution Explorer. 2. In the context menu, select Start TTS Wizard ð The TTS Configuration Wizard opens. In the lower section you will see a list of all already configured playback devices, which is empty in the case of a new project. A selected playback device is listed in the upper section. In the first part, the wizard guides you through the configuration of the playback device of a sound card. 3. To add a new playback device, click the + button. TF4500 Version: 1.6.1 29
## Page 30

Quick start: speech output (TTS) ð The Device Wizard opens. 4. In the Select Device drop-down list, select the appropriate playback device. If you select the "Default Windows Output Device" here, the default sound card set in the operating system will always be used. 5. Click the Save button. ð The Device Wizard closes. 6. If necessary, mark the desired playback device and click the Select button. ð The playback device is added to the list in the upper section Selected Playback Device for TTS Configuration. 30 Version: 1.6.1 TF4500
## Page 31

Quick start: speech output (TTS) 7. Click on Next. ð The second part of the configuration opens, where you configure the actual speech generation service (Text-To-Speech). As in the first step, a list of services that have already been configured is shown below. The selected service is displayed above. 8. To add a speech service, click the + button. ð The TTS Service Wizard opens. TF4500 Version: 1.6.1 31
## Page 32

Quick start: speech output (TTS) 9. Select the desired provider from the drop-down list TTS Synthesis Service. For Amazon Polly, the access key is then queried, which is stored in the solution and also on the target system. 10. You can give the speech recognition service its own name in the TTS Service Name input field. 11. Now set a language and voice for the speech output. 12. You can use the Magic Wand button to automatically generate the available languages and voices. 13. Alternatively, select the desired language in the first drop-down list Select Language and an available voice in the second drop-down list Select Voice. 14. Click the + button. 15. In the third drop-down list Default Language, select a default language. If you cannot select the desired language, install it on Windows SAPI. See 16. Click the Save button. 32 Version: 1.6.1 TF4500
## Page 33

Quick start: speech output (TTS) 17. If speech recognition services have already been created, mark the desired speech recognition service in the list and click the Select button. 18. Click the Next button to save the TTS configuration. 19. To save and stop the configuration at this point, click the Finish button. ð When you click the Next button, the third part of the configuration opens. In the optional third part of the configuration, the wizard concludes by guiding you through the local saving of the generated TTS outputs on the target system. This allows you to reuse them at any time. 20. To determine whether the TTS outputs should be saved, click the + button. TF4500 Version: 1.6.1 33
## Page 34

Quick start: speech output (TTS) ð The TTS Storage Wizard opens. 21. In the Storage Name input box, enter a name for the file to be saved. 22. In the Folder Path box, determine a memory location for the file to be saved. 23. In the Memory Usage area, you determine whether all TTS outputs are stored or whether the memory space should be limited. Select the appropriate radio button for this. 24. In the Max. Size input box, enter how much memory space should be allocated for the saved speech outputs. 25. Click the Save button. 26. If memory locations have already been created, mark the desired memory location in the list and click the Select button. 27. Click the Finish button. 34 Version: 1.6.1 TF4500
## Page 35

Quick start: speech output (TTS) ð At the end of the configuration, Twin CAT Speech creates an identification number for it. This can be found in the list of TTS configurations under Configuration Id and you need it for the PLC programming of the Twin CAT Speech project. 28. Activate the Twin CAT Speech configuration on the target system by clicking the Activate Configuration button. ð The Twin CAT Speech configuration is activated on the target system and can be used by the PLC. Also see about this 2 Microsoft SAPI: installing additional languages [} 54] 6.3 Programming the PLC A PLC project must be programmed in order to use Twin CAT Speech. For a quick start, this is explained below on the basis of this sample [} 66]. TF4500 Version: 1.6.1 35
## Page 36

Quick start: speech output (TTS) 1. Create a new PLC project. 2. Add the Tc3_Speech library. 3. Insert the following code from Sample01 into Main TTS. Declaration part: 36 Version: 1.6.1 TF4500
## Page 37

Quick start: speech output (TTS) PROGRAM Main TTS VAR // TTS Trigger Variables b Speak Trigger : BOOL := FALSE; b Speak Stop Trigger : BOOL := FALSE; // TTS Command Configuration n Config Id TTS : UINT := 200; // Language Id for TTS Output n Language Id : UINT := 1033; //Update Code before Release fb TTS : FB_Text To Speech := (n Configuration Id := n Config Id TTS); fb Retrieve Utterance : FB_Retrieve Utterance; // TTS Variables b Speak : BOOL := FALSE; {attribute 'Tc Encoding':= 'UTF-8'} s Text2Speech : STRING(4095) := '<speak>Tc Speech beta demo project is greeting you.</ speak>'; b Init : BOOL := FALSE; {attribute 'hide'} n Language Id Old : UINT := 1033; END_VAR Process part: IF NOT binit THEN fb TTS. Set Ams Net Addr(GVL_Speech Demo.s Ams Net Id); binit := TRUE; END_IF // TTS - Text To Speech // Trigger Start/Stop Text Output IF b Speak Trigger THEN b Speak Trigger :=FALSE; b Speak := TRUE; END_IF IF (n Language Id Old <> n Language Id) THEN fb Retrieve Utterance(n Language Id := n Language Id, s Text2Speech => s Text2Speech, n Old Language Id := n Language Id Old, s Old Text2Speech := s Text2Speech); n Language Id Old := n Language Id; END_IF IF b Speak THEN // if set manually via b Speak Trigger OR for answering a recognized ASR command ... IF b Speak Stop Trigger THEN fb TTS(s Utterance := s Text2Speech,b Speak := FALSE, n Configuration Id:= n Config Id TTS); ELSE fb TTS(s Utterance := s Text2Speech,b Speak := TRUE, n Configuration Id:= n Config Id TTS, n Language Id:=n Language Id); END_IF IF NOT fb TTS.b Busy THEN fb TTS(s Utterance := s Text2Speech,b Speak := FALSE, n Configuration Id:= n Config Id TTS); b Speak := FALSE; b Speak Stop Trigger:=FALSE; END_IF END_IF 4. Set "b Speak" to TRUE to trigger a speech output via the default device. The Twin CAT configuration must have been activated beforehand. The identification number for the TTS configuration that is to be used is present in the code as Config Id TTS. TF4500 Version: 1.6.1 37
## Page 38

Quick start Event Logger 7 Quick start Event Logger The following chapter is intended to simplify the configuration of the interface between Twin CAT Speech and the Twin CAT Event Logger. Both a speech input to trigger a Twin CAT event (Speech-To-Event) and a speech output on occurrence of a Twin CAT event (Event-To-Speech) are enabled. Also see about this 2 Configuring Event-To-Speech [} 39] 2 Configuring Speech-To-Event [} 41] 7.1 Creating a configuration Twin CAT Speech is parameterized via its own configuration project in Twin CAT Engineering. New Twin CAT Speech configurations are created as follows: 1. Open Twin CAT Engineering and create a new project. 2. Select an empty Twin CAT Controller project, name it, and click OK. ð The new Twin CAT Controller project opens. 3. Right-click the new Twin CAT Controller project. 38 Version: 1.6.1 TF4500
## Page 39

Quick start Event Logger 4. Select Add>New Item. ð The Add New Item window opens. 5. Select Twin CAT Speech Configurator, name the configuration, and click Add. ð The start window for the Twin CAT Speech configuration opens. 6. Select the desired target system. ð Assignment to a target system is important for Twin CAT Speech, because the hardware configuration of the sound cards is individual. ð A new Twin CAT Speech configuration has now been created. 7.2 Configuring Event-To-Speech A configuration wizard is available for the configuration of the speech output of events. This guides you through the Event-To-Speech configuration. ü A speech output should be configured beforehand, as it will be used here. To do this, start with the chapter Quick start: speech output (TTS) [} 27]. TF4500 Version: 1.6.1 39
## Page 40

Quick start Event Logger 1. In order to open the Event-To-Speech wizard, right-click the Event Logger configuration in the Solution Explorer. 2. Select Start Event-To-Speech Wizard from the context menu. ð The Event-To-Speech wizard starts. 3. Select the respective Twin CAT project under Main Configuration. 40 Version: 1.6.1 TF4500
## Page 41

Quick start Event Logger 4. Add a new event by selecting the event class, the event and the TTS configuration from the respective drop-down list. 5. Click the Add button. 6. Click the Save button. ð The configuration is created. 7. Activate the Twin CAT Speech configuration as usual. ð On occurrence of an event, the text of the event will be output via the selected speech output service using the default language stored there. ð The associated sample [} 67] provides a PLC project for triggering events in a simple way. 7.3 Configuring Speech-To-Event A configuration wizard is available for the configuration of the speech recognition with subsequent triggering of events. This guides you through the Speech-To-Events configuration. TF4500 Version: 1.6.1 41
## Page 42

Quick start Event Logger 1. In order to open the Speech-To-Event wizard, right-click the Event Logger configuration in the Solution Explorer. 2. Select Start Speech-To-Event Wizard from the context menu. ð The Speech-To-Event wizard starts. 3. Select the respective Twin CAT project under Main Configuration. 42 Version: 1.6.1 TF4500
## Page 43

Quick start Event Logger 4. Add a new event by selecting the event class, the event and the Speech-To-Event configuration from the respective drop-down list. 5. Click the Add button. 6. Click the Save button. ð The configuration is created. ð The Twin CAT event is triggered when the corresponding speech recognition takes place. The associated sample [} 67] provides a PLC project for triggering events in a simple way. TF4500 Version: 1.6.1 43
## Page 44

Configuration 8 Configuration The dialogs of the Twin CAT Speech Configurator project are described in this chapter. Quickstart instructions can be used to understand the process. 8.1 User interface If you have created the Twin CAT Speech project, the window looks like this: 1 Solution Explorer The Twin CAT Speech Configurator is mapped as its own project type below a Twin CAT Controller project. Tabs of the Twin CAT Speech Configurator 2 General Configuration Selection of the target system as well as activation and logging settings 3 ASR Configuration Combines a microphone with an ASR service. The configuration IDs are used, for example, in the PLC. 4 TTS Configuration Combines a playback device with a TTS service. The configuration IDs are used, for example, in the PLC. Below the Twin CAT Speech Configurator 5 Devices Configuration of microphones and playback devices These are used in the ASR and TTS configurations. They are usually created by the ASR / TTS wizards. 6 ASR Configuration of the speech recognition services These are used in the ASR configurations. They are usually created by the ASR wizard. 7 TTS Configuration of the speech output services These are used in the TTS configuration. They are usually created by the TTS wizard. 8 Event Logger Speech input and output based on Twin CAT Events 9 HMI Speech input and output in combination with the Twin CAT HMI 8.2 General Configurations The General Configurations window provides the possibility to make various settings. 44 Version: 1.6.1 TF4500
## Page 45

Configuration "Activate Configuration": This transfers the configuration to the target system and restarts it for activation upon request. Notice Every change in the Twin CAT Speech Configurator has to be activated first! Reload available targets. Target Target system for which the configuration is intended. The configuration is transferred to this System system with "Activate Configuration". The device configuration dialogs also obtain the available sound cards from this device. The status of the currently connected target system is also displayed in the top right-hand corner. When selecting a target system, it is important that the hardware requirements of the target system match the Twin CAT Speech configuration. For example, if the configured audio devices do not match the audio devices on the target system, the configuration will not work on the target system. In addition, a warning is displayed if the target system is changed. Log Log Level (default setting: 3) describes the level of detail with which a log file is written. The file is Level used to diagnose problems and is located at C:\Twin CAT\Functions\TF4500- Speech\Boot\Tc Speech Log.txt The higher the log level, the more disk space the file uses. An archive of older logs is created, which can be used for long-term analysis if necessary. ASR Configurations Add a microphone. Delete a microphone. Edit the configuration of a microphone. List The list of currently configured speech recognitions: this combines an ASR service with a microphone and is used, for example, by the PLC to perform speech recognition TF4500 Version: 1.6.1 45
## Page 46

Configuration TTS Configurations Add a playback device. Delete a playback device. Edit the configuration of a playback device. List The list of currently configured speech outputs: this combines a TTS service with a playback device and is used, for example, by the PLC to perform a speech output. Devices Add a recording device. Delete a recording device. Edit the configuration of a recording device. List List of currently configured microphones (recording devices): these are usually created by the ASR wizard, but can also be created directly. They are combined with ASR services in the ASR configuration. 46 Version: 1.6.1 TF4500
## Page 47

Configuration Add a playback device. Delete a playback device. Edit the configuration of a playback device. List List of currently configured playback devices: these are usually created by the TTS wizard, but can also be created directly. They are combined with TTS services in the TTS configuration ASR Add a speech recognition service. Delete a speech recognition service. Edit the configuration of a speech recognition service. List List of currently configured speech recognition services: these are usually created by the ASR wizard, but can also be created directly. They are combined with microphones (recording devices) in the ASR configuration TTS Add a playback service. Delete a playback service. Edit the configuration of a playback service. List List of currently configured playback services: these are usually created by the TTS wizard, but can also be created directly. They are combined with playback devices in the TTS configuration. Event Logger The exact process for the use of the event logger integration is explained in the chapter Quickstart: Event Logger [} 38]. TF4500 Version: 1.6.1 47
## Page 48

Configuration Add an event. Delete an event. Edit the configuration of an event. Event-To- The events that should be output via speech output on occurrence are defined on the "Event-to- Speech Speech" tab. A TTS configuration is used to reference the TTS service and playback device to be used . The default language of the TTS service is used. Add an event. Delete an event. Edit the configuration of an event. Speech- The recognition tags that should trigger an event on recognition are defined on the "Speech-To- To-Event Event" tab. An ASR configuration is used to reference the ASR (with the associated recognition tags and languages) and microphone to be used. 48 Version: 1.6.1 TF4500
## Page 49

Configuration HMI A Twin CAT HMI client license is required for the Twin CAT Speech connection. The HMI integration is based on the previously created ASR and TTS services. In this case, the device used is the HMI client (browser), which grants access to the sound cards that exist there. This client can run on the same or another computers or indeed a mobile device, for example. All you need is an HTML5- compatible browser. The Twin CAT HMI is always loaded by the browser from a Twin CAT HMI server. A Twin CAT HMI server extension is required as an intermediary for using Twin CAT Speech. Since the extension must necessarily run on the same HMI server, little preparation is required in the HMI project itself. The Twin CAT Speech extension must be loaded into the project via Nuget. See the corresponding Twin CAT HMI documentation. Twin CAT Speech requires a Twin CAT HMI server user account, which must be created there. Since the login data in the Twin CAT Speech configuration are stored unencrypted on the target system, it is recommended to restrict access to these required symbols for the account: • Speech. Client Configs. List • Speech. Client Configs. Register • Speech. Clients. List • Speech. Clients. Register • Speech. Event. Raise • Heartbeat Notice The user "__Speech Core" is used for communication between Twin CAT Speech and the Twin CAT HMI server. This user is not suitable for logging in via the browser. Twin CAT Speech must be notified of the host name of the HMI server and the selected user name in the general configuration (see screenshot). Please note that the host name must be valid on the target system at runtime. Twin CAT HMI automatically reports the current language to Twin CAT Speech. To ensure that this language also changes in the speech recognition when switching to the HMI, an SRGS must be created that recognizes multiple languages. This is described under Configuring a grammar file [} 52]. Note that only SRGS files created by the Simple SRGS Editor can be used for language switching. The Recognition Tags defined in the SRGS file can trigger any actions in the HMI. See the Twin CAT HMI documentation. TF4500 Version: 1.6.1 49
## Page 50

Configuration 8.3 Testing the sound card The Twin CAT Speech Configurator allows you to test and identify sound cards from the target system for later use as a microphone for ASR or as a playback device for TTS. The devices are detected and also identified via the Windows operating system, so the configuration must normally be specific to a target system. An exception to this is the default sound card configured in Windows, which can also be used. Testing the microphone 1. Go to the ASR node in the Twin CAT Speech project. 2. Start the ASR wizard by right-clicking the ASR node or double-clicking a microphone in the "ASR" list. 3. Click the + button or use the button for an existing device. ð The device wizard opens. 4. In the drop-down box, select the microphone that you want to test. 5. To test the microphone, click the button. 50 Version: 1.6.1 TF4500
## Page 51

Configuration ð On clicking the button, the recording is started and played back immediately afterwards. Testing the playback device 1. Click the TTS node in the Twin CAT Speech project. 2. Start the TTS wizard by right-clicking the TTS node or double-clicking a playback device in the "TTS" list. 3. Click the + button. ð The device wizard opens. 4. In the drop-down box, select the desired device. 5. Click on . ð A test playback is output. TF4500 Version: 1.6.1 51
## Page 52

Configuration 8.4 Configuring a grammar file For speech recognition, it is necessary to store a grammar file. The required grammar files are stored in the format Speech Recognition Grammar Specification (SRGS). SRGS is a standard that describes how the grammars for speech recognition are specified. SRGS is a powerful format. Twin CAT Speech supports this standard on 2 levels: On the one hand, a "Simple SRGS Editor" is offered directly in the Twin CAT Speech Configurator when an ASR service is created. This essentially provides an assignment of tag and text, and the text can be stored in several languages. On the other hand, external SRGSs, which are created with other editors and are more complex, can also be imported. An example of this use is Sample 03: Event Logger [} 67]. Some functions, such as FB_Set Rule State [} 59] cannot work in this case because they place special demands on the SRGS, which are ensured by the Simple SRGS Editor. This also affects the Twin CAT HMI connection, so that here too only SRGS created by the Simple SRGS Editor can be used in multiple languages. The opening of complex files in the Simple SRGS Editor is denied. Simple SRGS Editor The SRGS file is provided with the ASR service, which is typically created by the ASR wizard. Here you can either use the Simple SRGS Editor to edit a local SRGS file or reference an externally provided SRGS. In the Simple SRGS Editor, "Recognition Texts" are assigned to the "Recognition Tags". These texts can also be arranged in groups, "Recognition Group", in order to enable or disable them via FB_Set Rule State [} 59]. Procedure with the Simple SRGS Editor 1. Click Create new Grammar File while creating or modifying an ASR service. ð The Simple SRGS Editor opens. 52 Version: 1.6.1 TF4500
## Page 53

Configuration 2. Name the SRGS file and select a default language. This language is used if no other language is specified. This is also used for the Speech-To-Event [} 38] integration. 3. Under Recognition Tag, enter a tag that is provided in the PLC upon recognition and can be reacted to accordingly. This Recognition Tag is also configured for a response within the HMI. See Twin CAT HMI documentation. 4. Under Recognition Text, enter a text to be recognized by ASR. 5. If necessary, enter a group under Recognition Group. 6. Click the Save button. ð The SRGS file is fully configured. ð The SRGS file is transferred to the target by activating the Twin CAT Speech Configurator project. Entering voice commands in different languages The Simple SRGS Editor can be used to recognize multilingual texts. This is used in particular in connection with the Twin CAT HMI to switch between different languages. Switching does not work simultaneously; the language must always be switched first before a different language can be recognized. TF4500 Version: 1.6.1 53
## Page 54

Configuration 1. To open the SRGS Grammar Translation Editor, click the button. ð When the editor is opened, all Recognition Tags already defined are displayed. 2. Click the button to add a new language. 3. The tab selected on the left defines the language that belongs to the recognition texts. Previewing the SRGS file By clicking on the button, you can preview the code of the SRGS file in your default Windows editor for XML files. 8.5 Microsoft SAPI: installing additional languages To use both speech input (ASR) and speech output (TTS), you must install the appropriate language packs when using Microsoft SAPI in order to be able to use them with Twin CAT Speech. 54 Version: 1.6.1 TF4500
## Page 55

Configuration Not all languages that Windows offers are compatible. See Available languages [} 12] for a list of tested languages. Proceed as follows to install a language: ü The controller must be able to communicate with the Microsoft server via the network. 1. Open Windows Settings>Time and Language>Language. 2. Click the Add Preferred Language button. 3. Select a language and click Next. 4. Select whether you only want to install the language pack or also set it as the display language. 5. Click Install. ð The language pack is installed. 6. Click the installed language. 7. Click on Settings. ð In this settings window you can make all settings that affect speech recognition via MS-SAPI. If the Language option is missing, you must temporarily enable the Windows Update: TF4500 Version: 1.6.1 55
## Page 56

SPS API 9 SPS API 9.1 Data Types 9.1.1 Enums 9.1.1.1 ETcs Recognition Engine State State of the speech recognition engine. Syntax Definition: TYPE ETcs Recognition Engine State : ( TCS_ENGINE_UNKNOWN := 0, TCS_ENGINE_STARTING := 1, TCS_ENGINE_STARTED := 2, TCS_ENGINE_STOPPING := 3, TCS_ENGINE_STOPPED := 4, TCS_ENGINE_FAILURE := 5, TCS_ENGINE_PAUSED := 6, TCS_ENGINE_INACTIVE := 7 )UDINT; END_TYPE Values Name Description TCS_ENGINE_UNKNOWN ASR-Engine in unknown state. TCS_ENGINE_STARTING ASR-Engine is starting up. TCS_ENGINE_STARTED ASR-Engine is started. TCS_ENGINE_STOPPING ASR-Engine is stopping. TCS_ENGINE_STOPPED ASR-Engine is stopped. TCS_ENGINE_FAILURE ASR-Engine is in failure state. See Error Id for details. TCS_ENGINE_PAUSED ASR-Engine is paused. TCS_ENGINE_INACTIVE ASR-Engine is inactive. 9.1.1.2 ETcs Speech Command Exit Code Speech command exit code. Syntax Definition: TYPE ETcs Speech Command Exit Code : ( TCS_CMD_SUCCEEDED := 0, TCS_CMD_REQUIRED_SERVICE_NOT_FOUND := 10000, TCS_CMD_REQUIRED_SERVICE_NOT_INITIALIZED := 10001, TCS_CMD_INSUFFICIENT_PARAMETERS := 10100, TCS_CMD_ASR_RULES_SETFAILED := 20000, TCS_CMD_ASR_INSTANTIATION_FAILURE := 20010, TCS_CMD_ASR_STOP_FAILURE := 20020, TCS_CMD_ASR_START_FAILURE := 20030, TCS_CMD_ASR_PAUSE_FAILURE := 20040, TCS_CMD_TTS_STATUS_REQUEST_FAILURE := 30010, TCS_CMD_TTS_STOP_REQUEST_FAILURE := 30020, TCS_CMD_TTS_SYNTH_ERROR := 30030, TCS_CMD_TTS_SYNTH_ERROR_CONFIGURATION_DETAILS := 30040, TCS_CMD_TTS_SYNTH_ERROR_CONFIGURATION_DETAILS_LANGUAGEID_MISSING := 30050, TCS_CMD_TTS_SYNTH_ERROR_CONFIGURATION_DETAILS_LANGUAGEID_NOTSUPPORTED := 30060, 56 Version: 1.6.1 TF4500
## Page 57

SPS API TCS_CMD_TTS_SYNTH_ERROR_CONFIGURATION_DETAILS_INCOMPLETE := 30070, TCS_CMD_TTS_SYNTH_ERROR_UTTERANCE_EMPTY := 30080, TCS_CMD_TTS_SYNTH_ERROR_UTTERANCE_AND_PATH_EMPTY := 30090, TCS_CMD_TTS_SYNTH_ERROR_SAPI_ := 31000, TCS_CMD_TTS_SYNTH_ERROR_AWSPOLLY_ := 32000, TCS_CMD_AUDIO_PLAYBACK_START_FAILURE := 40010, TCS_CMD_AUDIO_PLAYBACK_START_FAILURE_INVALIDFORMAT := 40011, TCS_CMD_AUDIO_PLAYBACK_START_FAILURE_FILENOTFOUND := 40012 )UDINT; END_TYPE Values Name Description TCS_CMD_SUCCEEDED Speech command succeeded. TCS_CMD_REQUIRED_SERVICE_NOT_FOUND Referenced service not found. Wrong Id configured? TCS_CMD_REQUIRED_SERVICE_NOT_INITIALIZE Referenced service not initialized. D TCS_CMD_INSUFFICIENT_PARAMETERS Speech command with insufficient parameters. TCS_CMD_ASR_RULES_SETFAILED Speech command Set Rule State failed. TCS_CMD_ASR_INSTANTIATION_FAILURE Speech engine could not be instantiated. TCS_CMD_ASR_STOP_FAILURE Speech engine could not be stopped. TCS_CMD_ASR_START_FAILURE Speech engine could not be started. TCS_CMD_ASR_PAUSE_FAILURE Speech engine could not be paused. TCS_CMD_TTS_STATUS_REQUEST_FAILURE Speech engine's status request failed. TCS_CMD_TTS_STOP_REQUEST_FAILURE Speech engine's stop request failed. TCS_CMD_TTS_SYNTH_ERROR Generic speech synthesis related error. TCS_CMD_TTS_SYNTH_ERROR_CONFIGURATIO Speech synthesis configuration related error. N_DETAILS TCS_CMD_TTS_SYNTH_ERROR_CONFIGURATIO Language Id is missing. N_DETAILS_LANGUAGEID_MISSING TCS_CMD_TTS_SYNTH_ERROR_CONFIGURATIO Language Id is not supported. N_DETAILS_LANGUAGEID_NOTSUPPORTED TCS_CMD_TTS_SYNTH_ERROR_CONFIGURATIO Speech synthesis configuration is incomplete. N_DETAILS_INCOMPLETE TCS_CMD_TTS_SYNTH_ERROR_UTTERANCE_E No utterance is specified. MPTY TCS_CMD_TTS_SYNTH_ERROR_UTTERANCE_A No utterance or path is specified. ND_PATH_EMPTY TCS_CMD_TTS_SYNTH_ERROR_SAPI_ Speech synthesis with error of underlying SAPI engine. TCS_CMD_TTS_SYNTH_ERROR_AWSPOLLY_ Speech synthesis with error of underlying Amazon Polly engine. TCS_CMD_AUDIO_PLAYBACK_START_FAILURE Audio playback could not be started. TCS_CMD_AUDIO_PLAYBACK_START_FAILURE_ Audio playback could not be started. Invalid audio INVALIDFORMAT format. TCS_CMD_AUDIO_PLAYBACK_START_FAILURE_ Audio playback could not be started. File not found on FILENOTFOUND target system. 9.2 Function Blocks 9.2.1 License Overview TC3 Speech FB_Play [} 58] TF4500 Version: 1.6.1 57
## Page 58

SPS API FB_Set Rule State [} 59] FB_Speech Recognition [} 61] FB_Text To Speech [} 63] 9.2.2 FB_Play FB_Play b Play BOOL BOOL b Busy s Path STRING BOOL b Error n Configuration Id UINT ETcs Speech Command Exit Code n Error Id UINT n Last Command Exit Code ULINT n Playback Position ULINT n Playback Total Playback function block Syntax Definition: FUNCTION_BLOCK FB_Play VAR_INPUT b Play : BOOL; s Path : STRING; n Configuration Id : UINT; END_VAR VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : ETcs Speech Command Exit Code; n Last Command Exit Code : UINT; n Playback Position : ULINT; n Playback Total : ULINT; END_VAR Inputs Name Type Description b Play BOOL Rising edge starts the playback. s Path STRING File path to the audio file. 16 k Hz sample rate, 16 bit sample size, 1 channel. n Configuration I UINT Configuration ID to be used for audio output. d Outputs Name Type Description b Busy BOOL Function block is busy. b Error BOOL Function block is in error state. n Error Id ETcs Speech Command Exit Error Id, which indicates the exact reason for the error. Code [} 56] n Last Comman UINT Return value of the last call. d Exit Code n Playback Posit ULINT Current position of the speech output. ion n Playback Total ULINT Total length of the speech output. 58 Version: 1.6.1 TF4500
## Page 59

SPS API Methods Name Description Set Ams Net Addr [} 59] Method to specify a different Ams Net Adr for the Tc Speech service. Only needs to be called up once. Required License TC3 Speech 9.2.2.1 Set Ams Net Addr Set Ams Net Addr s Ams Net Id STRING HRESULT Set Ams Net Addr Method to be called once to specifiy the Ams Net Id of destination Tc Speech service. Syntax Definition: METHOD Set Ams Net Addr : HRESULT VAR_INPUT s Ams Net Id : STRING; END_VAR Inputs Name Type Description s Ams Net Id STRING Ams Net Id of destination Tc Speech service. Return value HRESULT 9.2.3 FB_Set Rule State FB_Set Rule State b Execute BOOL BOOL b Busy n Configuration Id UINT BOOL b Error s Grammar File STRING ETcs Speech Command Exit Code n Error Id s Grammar Rule STRING UINT n Last Command Exit Code b Grammar Activate BOOL Set Rule State function block. Syntax Definition: FUNCTION_BLOCK FB_Set Rule State VAR_INPUT b Execute : BOOL; n Configuration Id : UINT; s Grammar File : STRING; s Grammar Rule : STRING; b Grammar Activate : BOOL; END_VAR VAR_OUTPUT b Busy : BOOL; b Error : BOOL; TF4500 Version: 1.6.1 59
## Page 60

SPS API n Error Id : ETcs Speech Command Exit Code; n Last Command Exit Code : UINT; END_VAR Inputs Name Type Description b Execute BOOL Rising edge sets the given Rule Id. n Configuration I UINT Configuration ID to be used (see Tc Speech Configurator). d s Grammar File STRING Path to the SRGS file on the target that is to be used. If not specified, the SRGS from the Configuration Id is used s Grammar Rule STRING Rule Id that is to be set. b Grammar Acti BOOL Defines whether the Rule Id should be switched on or off. vate Outputs Name Type Description b Busy BOOL Function block is busy. b Error BOOL Function block is in error state. n Error Id ETcs Speech Command Exit Error Id, which indicates the exact reason for the error. Code [} 56] n Last Comman UINT Return value of the last call. d Exit Code Methods Name Description Set Ams Net Addr [} 60] Method to specify a different Ams Net Adr for the Tc Speech service. Only needs to be called up once. Required License TC3 Speech 9.2.3.1 Set Ams Net Addr Set Ams Net Addr s Ams Net Id STRING HRESULT Set Ams Net Addr Method to be called once to specifiy the Ams Net Id of destination Tc Speech service. Syntax Definition: METHOD Set Ams Net Addr : HRESULT VAR_INPUT s Ams Net Id : STRING; END_VAR Inputs Name Type Description s Ams Net Id STRING Ams Net Id of destination Tc Speech service. 60 Version: 1.6.1 TF4500
## Page 61

SPS API Return value HRESULT 9.2.4 FB_Speech Recognition FB_Speech Recognition b Listen BOOL BOOL b Busy n Configuration Id UINT BOOL b Error ETcs Speech Command Exit Code n Error Id ETcs Recognition Engine State e Recognition Engine State ULINT n Recognition Id REAL f Recognition Confidence UINT n Last Command Exit Code STRING(255) s Recognition Tag STRING(255) s Recognition Rule STRING(4095) s Recognition Utterance Automatic Speech Recognition function block Syntax Definition: FUNCTION_BLOCK FB_Speech Recognition VAR_INPUT b Listen : BOOL; n Configuration Id : UINT; END_VAR VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : ETcs Speech Command Exit Code; e Recognition Engine State : ETcs Recognition Engine State; n Recognition Id : ULINT; f Recognition Confidence : REAL; n Last Command Exit Code : UINT; s Recognition Tag : STRING(255); s Recognition Rule : STRING(255); s Recognition Utterance : STRING(4095); END_VAR Inputs Name Type Description b Lists BOOL Rising edge starts speech recognition. n Configuration I UINT Configuration ID to be used for speech recognition. d TF4500 Version: 1.6.1 61
## Page 62

SPS API Outputs Name Type Description b Busy BOOL Function block is busy. b Error BOOL Function block is in error state. n Error Id ETcs Speech Command Exit Error Id, which indicates the exact reason for the error. Code [} 56] e Recognition E ETcs Recognition Engine Sta State of the ASR engine. ngine State te [} 56] n Recognition Id ULINT Last recognized speech recognition (Recognition Id). f Recognition Co REAL Recognition reliability of the last speech recognition nfidence n Last Comman UINT Return value of the last call d Exit Code s Recognition T STRING(255) Last Recognition tag ag s Recognition R STRING(255) Last rule that was recognized. ule s Recognition Ut STRING(4095) Last Utterance that was recognized. terance Methods Name Description Set Ams Net Addr [} 62] Method to specify a different Ams Net Adr for the Tc Speech service. Only needs to be called up once. Required License TC3 Speech 9.2.4.1 Set Ams Net Addr Set Ams Net Addr s Ams Net Id STRING HRESULT Set Ams Net Addr Method to be called once to specifiy the Ams Net Id of destination Tc Speech service. Syntax Definition: METHOD Set Ams Net Addr : HRESULT VAR_INPUT s Ams Net Id : STRING; END_VAR Inputs Name Type Description s Ams Net Id STRING Ams Net Id of destination Tc Speech service. Return value HRESULT 62 Version: 1.6.1 TF4500
## Page 63

SPS API 9.2.5 FB_Text To Speech FB_Text To Speech b Speak BOOL BOOL b Busy s Utterance STRING BOOL b Error n Configuration Id UINT ETcs Speech Command Exit Code n Error Id n Language Id UINT UINT n Last Command Exit Code ULINT n Playback Position ULINT n Playback Total Text to Speech function block. Syntax Definition: FUNCTION_BLOCK FB_Text To Speech VAR_INPUT b Speak : BOOL; s Utterance : STRING; n Configuration Id : UINT; n Language Id : UINT; END_VAR VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : ETcs Speech Command Exit Code; n Last Command Exit Code : UINT; n Playback Position : ULINT; n Playback Total : ULINT; END_VAR Inputs Name Type Description b Speak BOOL Rising edge starts a speech command. s Utterance STRING Utterance for the speech command n Configuration I UINT Configuration ID to be used for output (see Tc Speech d Configurator) n Language Id UINT Language Id which is to be used. '0' for configured default language. Outputs Name Type Description b Busy BOOL Function block is busy. b Error BOOL Function block is in error state. n Error Id ETcs Speech Command Exit Error Id, which indicates the exact reason for the error. Code [} 56] n Last Comman UINT Return value of the last call. d Exit Code n Playback Posit ULINT Current position of the speech output. ion n Playback Total ULINT Total length of the speech output. Methods Name Description Set Ams Net Addr [} 64] Method to specify a different Ams Net Adr for the Tc Speech service. Only needs to be called up once. TF4500 Version: 1.6.1 63
## Page 64

SPS API Required License TC3 Speech 9.2.5.1 Set Ams Net Addr Set Ams Net Addr s Ams Net Id STRING HRESULT Set Ams Net Addr Method to be called once to specifiy the Ams Net Id of destination Tc Speech service. Syntax Definition: METHOD Set Ams Net Addr : HRESULT VAR_INPUT s Ams Net Id : STRING; END_VAR Inputs Name Type Description s Ams Net Id STRING Ams Net Id of destination Tc Speech service. Return value HRESULT 64 Version: 1.6.1 TF4500
## Page 65

Samples 10 Samples You will find several samples in this chapter. The samples are independent of each other. Each sample has a focus, based on which it is listed below. Sample code and configurations for this product can be obtained from the corresponding repository on Git Hub: https://github.com/Beckhoff/TF4500_Samples. There you have the option to clone the repository or download a ZIP file containing the sample. Commissioning the samples Opening and configuring is the same for all samples. The procedure is explained below on the basis of an example. 1. Unpack the downloaded ZIP file. 2. Open the ZIP file that it contains in Twin CAT 3 by clicking on Open Project. 3. Select your target system. 4. Activate your configuration on the Twin CAT Speech Configuration Solution by clicking . TF4500 Version: 1.6.1 65
## Page 66

Samples 5. Activate the configuration by clicking . ð The sample is ready for operation. 10.1 Sample 01: Simple ASR and TTS sample Description Sample of PLC programming for ASR and TTS Two simple programs show how to handle FB_Text To Speech or FB_Speech Recognition. In the configuration for the speech recognition, the text "Hello Twin CAT" is recognized, transmitted to the PLC and evaluated by the Main ASR program. Successful recognition is displayed for one second by "b Recognition := TRUE". For the speech output, a greeting word is output as soon as the variable "b Speak" in Main TTS is set to TRUE. With all Twin CAT Speech samples, a configuration is stored that uses the operating system's default sound card. Notice Activate the Twin CAT Speech configuration. Sample project https://github.com/Beckhoff/TF4500_Samples/tree/main/ Tc Speech_Samples_ASR-TTS_simple Further information Quick start: speech output (TTS) [} 27] Quick start: speech input (ASR) [} 17] 10.2 Sample 02: Complex ASR Description The sample illustrates the use of an SRGS that wasn't created with the Simple SRGS Editor. Two SRGS files are configured in the Twin CAT Speech configurator for this. After starting the PLC, set the variable Main ASR.b Listen Trigger to TRUE. This starts the speech recognition. These commands are then recognized and saved in n Value. Set value to <Number> Increment value by <Number> Decrement value by <Number> Note: the sample is based on a file named en-US.grxml from Microsoft, which you can download from https:// www.microsoft.com/en-us/download/confirmation.aspx? id=14373. Then add the file to the PLC project in the subfolder SRGS using "Add existing Item". The file is transferred to the target system when the Twin CAT Speech configuration is activated, as the Twin CAT Speech configuration references this file. With all Twin CAT Speech samples, a configuration is stored that uses the operating system's default sound card. Notice Activate the Twin CAT Speech configuration. Sample project https://github.com/Beckhoff/TF4500_Samples/tree/main/ Tc Speech_Samples_ASRComplex Further information Configuring a grammar file [} 52] 66 Version: 1.6.1 TF4500
## Page 67

Samples 10.3 Sample 03: Event Logger Description This sample illustrates the integration of the Twin CAT Event Logger with Twin CAT Speech. An event class "Event Speech Test Class" is defined in the sample. This has 2 events, one for triggering on recognizing speech and one with which the speech output takes place. The PLC program is only used to send the corresponding event to the speech output. An event is triggered if the speech recognition recognizes "Hello Twin CAT". You control the Twin CAT events as usual in the "Logged Events" window. With all Twin CAT Speech samples, a configuration is stored that uses the operating system's default sound card. Notice Activate the Twin CAT Speech configuration. Sample project https://github.com/Beckhoff/TF4500_Samples/tree/main/ Tc Speech_Sample_Eventlogger Further information Quickstart Eventlogger 10.4 Sample 04: File Playback Description This sample shows you how to play back a simple file by means of FB_Play. The file to be played back is transferred as a file path. A sample file called 16bit_16khz_mono_Sample Sound.wav is located in the PLC project and must be placed on the target system beforehand with the correct path. With all Twin CAT Speech samples, a configuration is stored that uses the operating system's default sound card. Notice Activate the Twin CAT Speech configuration. Sample project https://github.com/Beckhoff/TF4500_Samples/tree/main/ Tc Speech_Samples_Fb Play Further information FB_Play [} 58] TF4500 Version: 1.6.1 67
## Page 68

Samples 10.5 Sample 05: Activation/deactivation of individual recognition tags Description This sample shows how individual recognition tags, which are stored as rules in the SRGS, can be enabled or disabled at runtime. This can increase the recognition accuracy in particular with similar speech commands. The SRGS contains a recognition tag "HELLO". This is enabled or disabled by the FB_Set Rule State in the PLC program depending on b Set Rule State. Recognitions are displayed in b Recognition. With all Twin CAT Speech samples, a configuration is stored that uses the operating system's default sound card. Notice Activate the Twin CAT Speech configuration. Sample project https://github.com/Beckhoff/TF4500_Samples/tree/main/ Tc Speech_ASR_Set Rule State Further information FB_Set Rule State 10.6 Sample 06: Twin CAT HMI with Twin CAT Speech Integration Description This sample shows how Twin CAT Speech can be used in Twin CAT HMI. For this purpose, a Twin CAT HMI server is entered in the Twin CAT Speech configuration. The speech recognition and speech output then take place via the HMI client, i.e. the browser, for which the latter requests and needs the corresponding access rights. The Twin CAT HMI project included offers some speech commands that are displayed in the HMI itself. During commissioning, especially for local engineering, the end point in the HMI and the Twin CAT Speech configuration may need to be changed. The sample is prepared for activation on a Twin CAT HMI server (port 1010). Notice Activate the Twin CAT Speech configuration. Sample project https://github.com/Beckhoff/TF4500_Samples/tree/main/ Tc Speech_Samples_HMI Further information Twin CAT Speech of the Twin CAT HMI 68 Version: 1.6.1 TF4500
## Page 69

FAQ 11 FAQ Sound card is not working Probably the wrong device was configured. 1. Check the Configuration Id and assignment to the sound card 2. Take advantage of the testing possibilities of the Twin CAT Speech Configurator project 3. If in doubt, check the function of the sound card at the operating system level. The Twin CAT Speech Configurator displays all sound cards that the operating system of the target system has also detected CX2500-0020 (CX2000 extension module) 1. Enable the BUS used by the BIOS module: Chipset->PCH I-Configuration->PCH Azalia Configuration->Azalia -> “Enabled” Too many false recognitions Twin CAT Speech provides the PLC with all voice commands that have been recognized. The PLC project must then filter by confidence thresholds. The sample suggests filtering on two levels: 1. Main.f Confidence Threshold: ◦ Confidence levels that are too low are directly discarded. 2. FB_Retrieve Utterance.f Reco Threshold: ◦ searches for repetitions. XAE error message Error messages are displayed in the Twin CAT XAE Error window. An additional and detailed view of errors can be found in the log file: Tc Speech Log_0.txt under C:\Twin CAT\Functions\TF4500-Speech\Boot TF4500 Version: 1.6.1 69
## Page 70

Appendix 12 Appendix 12.1 Error List The following errors are returned by the function blocks. Hex Dec Description Reason 0 SUCCEEDED The call was successful 1 GENERIC_ERROR The call ended in a generic error that is not specified in more detail. Details in the Log File. 100 ASR_NO_RECOGNITION The ASR did not find any recognition. 200 TTS_SYNTH_WARNING_VOICENOTF The configured language could not be used. OUND 10000 REQUIRED_SERVICE_NOT_FOUND Twin CAT Speech internal: A required service could not be found. 10001 REQUIRED_SERVICE_NOT_INITIALIZ Twin CAT Speech internal: A required service is ED not initialized. 10100 INSUFFICIENT_PARAMETERS Twin CAT Speech internal: A call was made with incorrect parameters 20000 ASR_RULES_SETFAILED The ASR was unable to activate the rules created in the SRGS. 20010 ASR_INSTANTIATION_FAILURE An ASR could not be initialized. There may be a configuration error. 20020 ASR_STOP_FAILURE An ASR could not be stopped. 20030 ASR_START_FAILURE An ASR could not be started. 30010 TTS_STATUS_REQUEST_FAILURE A TTS call failed. 30020 TTS_STOP_REQUEST_FAILURE A TTS call could not be interrupted. 30030 TTS_SYNTH_ERROR A TTS call could not be synthesized. 30040 TTS_SYNTH_ERROR_ A TTS call could not be synthesized because a CONFIGURATION_DETAILS configuration is faulty. 30050 TTS_SYNTH_ERROR_CONFIGURATI A TTS call could not be synthesized because ON_DETAILS_ the configuration includes an incorrect language LANGUAGEID_MISSING ID. 30060 TTS_SYNTH_ERROR_CONFIGURATI A TTS call could not be synthesized because ON_DETAILS_ the configuration includes an unsupported LANGUAGEID_NOTSUPPORTED language ID. 30070 TTS_SYNTH_ERROR_CONFIGURATI A TTS call could not be synthesized because ON_DETAILS_ the configuration is incomplete. INCOMPLETE 30080 TTS_SYNTH_ERROR_UTTERANCE_E A TTS call could not be synthesized because MPTY the input is empty. 31000 TTS_SYNTH_ERROR_SAPI A TTS call could not be synthesized because the underlying Microsoft SAPI reported an error. Details in the Log File 32000 TTS_SYNTH_ERROR_AWSPOLLY A TTS call could not be synthesized because the underlying AWS Polly interface reported an error. Details in the Log File 40010 AUDIO_PLAYBACK_START_ Playback could not be started. Another FAILURE playback may have just started. 70 Version: 1.6.1 TF4500
## Page 71

Appendix 12.2 Third-party Components This software contains third-party components (OSS components). Please refer to the license file provided in the following folder for further information: C:\Program Files (x86)\Beckhoff\Legal 12.3 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany TF4500 Version: 1.6.1 71
## Page 72

Appendix Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 72 Version: 1.6.1 TF4500
## Page 74

More Information: www.beckhoff.com/tf4500 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
