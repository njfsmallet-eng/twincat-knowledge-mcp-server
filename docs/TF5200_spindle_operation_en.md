---
title: "TF5200_spindle_operation_en"
product: "TF5200"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.04"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5200_spindle_operation_en.pdf"
release_date: "2025-06-06"
---
Functional description | EN TF5200 | Twin CAT 3 CNC Spindle operation mode 6/6/2025 | Version: 1.04
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5200 | Twin CAT 3 CNC Version: 1.04 3 Spindle operation mode
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.04 TF5200 | Twin CAT 3 CNC Spindle operation mode
## Page 5

Table of contents Table of contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Description................................................................................................................................................ 9 2.1 Drives with position control in the drive........................................................................................... 10 2.2 Drives with position control in the CNC........................................................................................... 12 2.3 Properties........................................................................................................................................ 13 3 Example................................................................................................................................................... 16 4 Parameter................................................................................................................................................. 17 4.1 Overview......................................................................................................................................... 17 4.2 Description...................................................................................................................................... 17 Index......................................................................................................................................................... 20 TF5200 | Twin CAT 3 CNC Version: 5 Spindle operation mode
## Page 6

Table of contents 6 Version: TF5200 | Twin CAT 3 CNC Spindle operation mode
## Page 7

List of figures List of figures Fig. 1 Positioning at specified speed and reversal................................................................................. 14 Fig. 2 Positioning at 500 rpm despite changeover speed of 200 rpm.................................................... 15 TF5200 | Twin CAT 3 CNC Version: 1.04 7 Spindle operation mode
## Page 8

Overview 1 Overview Task When a spindle drive is operated at current limit, it may result in an excessive position lag at high speeds, causing error messages in the drive and/or the CNC. To avoid this, it is necessary at high speeds to change to controlled operation (no position control) and to only operate the spindles position-controlled for positioning movements. Properties Automatic changeover by the CNC with position control in the drive is only available for SERCOS and CANopen drives. A change between the two operation modes can take place automatically during the movement. This function is available for CANopen drives as of CNC Build v3.1.3079.13. Parameter definition Automatic changeover and switch-back can be specified by using the appropriate parameters. They are: • P-AXIS-00264: antr.sercos.op_mode_for_velocity_control • P-AXIS-00267: antr.sai_op_mode_change.v_velocity_control_on • P-AXIS-00268: antr.sai_op_mode_change.v_position_control_on The section Parameters [} 17] contains a detailed description of the commands. Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. 8 Version: 1.04 TF5200 | Twin CAT 3 CNC Spindle operation mode
## Page 9

Description 2 Description Boundary condition Basically a spindle can be operated position-controlled or speed-controlled. The operation mode is defined statically in most cases, whereby all the parameters required for each operation mode must be configured in the drive telegram for SERCOS and CANopen drives. If a modulo transition takes place in the drive positions in position-controlled mode (position control in the drive), the maximum speed is limited to 180° per tracing cycle for spindles. Otherwise, the drive controller cannot determine the rotation direction from the specified path change. For example, for a tracing cycle of 2 ms, this results in a maximum speed of 15,000 rpm. When a spindle drive is operated at current limit, it may result in an excessive position lag at high speeds, causing error messages in the drive and/or the CNC. This may make it necessary to change to controlled operation (no position control) at high speeds and to only operate the spindle position-controlled for positioning movements. Functionality To permit higher speeds, the spindle is operated • speed-controlled with speed-only programming and • position-controlled when a position is specified. A change between the two operation modes can take place automatically during the movement. • With CNC position-controlled drive, an operation mode changeover takes place internally in the controller. • With speed-only programming, the position control loop is opened automatically and a speed command value is sent to the drive. If position control takes place in the drive, the changeover between position and speed control is al- ways supported by the drive. Automatic changeover by the CNC with position control in the drive is only available for SERCOS and CANopen drives. The drive needs no special requirements for automatic changeover for drives with position control in the CNC: Changeover of operation mode %spindle-position N30 S200 M4 N40 M19 S. POS=180 S1000 M4 N50 S200 M3 N60 M19 S. POS=180 S1000 M4 N70 S200 M4 N80 M19 S. POS=180 S1000 M3 M30 TF5200 | Twin CAT 3 CNC Version: 1.04 9 Spindle operation mode
## Page 10

Description 2.1 Drives with position control in the drive Parameterising the drive Control with digital drives takes place in the drive itself. The CNC specifies a position/speed command value for the drive per tracing interval. The current actual value (position and speed) can be used in the CNC for display functions and monitoring. In addition, the CNC sends the required operation mode cyclically to the drive. SERCOS parameters The following parameters are essential for a SERCOS drive for the position/speed control operation modes: Main operation mode S-0-0032 = 3 (position actual value with encoder 1) • S-0-0051 position actual value (encoder 1) / S-0-0053 position actual value (encoder 2) • S-0-0047 position command value Auxiliary operation mode 1 S-0-0033 = 2 (speed control) • S-0-0040 speed value • S-0-0036 speed command value In addition to the auxiliary operation mode 1, other auxiliary operation modes 2 and 3 are provided. What are also important are the scaling type settings.. Weighting should always be set to rotary weighting for spindles. • S-0-0076 position scaling type (bit 2-0) • S-0-0044 speed scaling type (bit 2-0) • S-0-00160 acceleration scaling type (bit 2-0) Parameter: (000) unscaled (001) translatory scaling (010) rotary scaling The operation mode for velocity control is specified for SERCOS drives in the para- meter P-AXIS-00264 [} 17]. Normally, this is the 1st auxiliary operation mode (antr.sercos.op_mode_for_velo- city_control 1). 10 Version: 1.04 TF5200 | Twin CAT 3 CNC Spindle operation mode
## Page 11

Description CANopen parameters The objects below are essential for the position control operation mode with a CANopen drive: Object 6060 (Modes of operation) = P-AXIS-00463 [} 17] h • Object 607A Target position h • Object 6064 Position actual value h After DS402 the following applies to Object 6060 in the position control operation modeby default: h Object 6060 = Cyclic_synchronous_position_mode_CSP(8) h After the changeover speed is exceeded, the CNC changes automatically to speed control. Object 6060 (Modes of operation) = P-AXIS-00464 [} 18] h The following object is required for this operation mode: • Object 60FF Target velocity h • Object 606C Velocity actual value h After DS402 the following applies to Object 6060 in the speed control operation modeby default: h Object 6060 = Cyclic_synchronous_position_mode_CSP(9) h In addition, the CNC requires feedback from the drive regarding which operation mode is currently active., Object 6061 (Modes of operation display) h The operation modes for position and velocity control are specified for CANopen drives in the parameters P-AXIS-00463 [} 17] and P-AXIS-00464 [} 18]. Normally, they refer to "Cyclic synchronous position mode" (8) and “Cyclic synchronous velo- city mode“ (9). TF5200 | Twin CAT 3 CNC Version: 1.04 11 Spindle operation mode
## Page 12

Description 2.2 Drives with position control in the CNC To change between position and speed control in CNC-controlled drives, the scaling of the manipu- lated variable (P-AXIS-00129, P-AXIS-00128) must be set correctly. Parameterising the drive For drives where position control is executed in the CNC, the drive must be in the ‘speed control’ operation mode. Otherwise, no special settings are required in the drive since a command speed is sent to the drive both in position-controlled and speed-controlled mode. Settings in the CNC For drives where position control can be executed both in the drive and in the CNC, e.g. with SERCOS, the operation mode “antr.operation_mode“ CNC-position control “CNC_POSITION_CONTROL” must be selected for the spindle (P-AXIS-00320). To switch over to controlled mode, the scaling of the speed manipulated variable getriebe[i].multi_gain_z / getriebe[i].multi_gain_n (P-AXIS-00129, P-AXIS-00128, CMS-A1] must be set correctly. This can be checked by checking the displayed position lag at a constant endless motion M3 or M4 of the spindle and when feedforward control is inactive. When scaling is correct, the position lag value of the spindle speed caused by the proportional gain of the position control loop (see P-AXIS-00099) equals: Position lag[°] = speed[°/s] / P-AXIS-00099 * 0.01[1/s] The parameters antr.sercos.op_mode_for_velocity_control (P-AXIS-00264) for 'velocity control’ operation mode, antr.canopen.cyclic_position_op_mode (P-AXIS-00463 [} 17]), antr.canopen.cyclic_velocity_op_mode(P-AXIS-00464 [} 18]) and antr.sai_op_mode_change.feed_forward_v_weighting (P-AXIS-00766 [} 18]) have no meaning for CNC- controlled drives. 12 Version: 1.04 TF5200 | Twin CAT 3 CNC Spindle operation mode
## Page 13

Description 2.3 Properties Changeover to speed control If a speed (S word) is programmed with M3 or M4 and it is higher than the specified changeover parameter, the system changes over automatically to speed control. Switch back to position control A switch-back to position control takes place under the following conditions: • Positioning was programmed with M19. • A CNC reset was triggered. • A spindle axis was issued from the spindle interpolator (NC command S[PUTAX]). • Homing was started (G74). If a previous speed programming was changed over to speed control, no switch-back to position control takes place if an additional speed below the switch-back speed is programmed. Effect of switch-back speed The command position is not considered during speed control. When a changeover occur to position control, the CNC determines the theoretical command position of the next cycle using: • the current speed • the Kv factor (of the drive or the controller position control) and • the bus run time The axis can then be switched back to position control without standstill. The switch-back speed indicates the speed at which switch-back to position control may take place. Since the actual speed may fluctuate slightly, especially at high speeds, a slight jerk may occur in the drive at high speeds on switch-back to position control. For this reason, do not select a switch-back speed that is too high. TF5200 | Twin CAT 3 CNC Version: 1.04 13 Spindle operation mode
## Page 14

Description Effect of switch-back speed %spindle-position N10 M3 S1000 N20 M19 S. POS=180 M4 S50 M30 Fig. 1: Positioning at specified speed and reversal 14 Version: 1.04 TF5200 | Twin CAT 3 CNC Spindle operation mode
## Page 15

Description Special case If the positioning speed is above the changeover speed with M19, positioning still takes place in position- controlled mode. Depending on the distance traversed, it is therefore possible to traverse above the changeover speed for a short time in position-controlled mode. %spindle-position (antr.sai_op_mode_change.v_velocity_control_on 1200000 ( -> 200 rpm (antr.sai_op_mode_change.v_position_control_on 600000 ( -> 100 rpm N10 M4 S1000 N20 M19 S. POS=180 M4 S500 M30 Fig. 2: Positioning at 500 rpm despite changeover speed of 200 rpm TF5200 | Twin CAT 3 CNC Version: 1.04 15 Spindle operation mode
## Page 16

Example 3 Example SERCOS drive with position control in the drive As of a speed of 200 rpm, the system should change over to speed control. Switch-back may occur as of 50 rpm. In position control, the drive should run at a speed feedforward control of 50%. The drive has a Kv factor of 20/s and the path resolution is 220 incr./rev. In addition, the drive expects 10E-4 rpm at the speed interface. The following settings are required in the axis list in addition to the drive telegram # [10-3degrees/s] -> 1200000 10-3degrees/s = 200 rpm antr.sai_op_mode_change.v_velocity_control_on 1200000 # [10-3degrees/s] -> 300000 10-3degrees/s = 50 rpm antr.sai_op_mode_change.v_position_control_on 300000 # Consideration of speed feedforward control antr.sai_op_mode_change.feed_forward_v_weighting 500 antr.nbr_delay_cycles 4 # CANopen Kv : 0x30C0:01 [1/s] # CNC Kv : [0.01/s] getriebe[0].kv 2000 #Path resolution of drive [incr./rev.] #Path resolution CNC [incr./0.0001°] getriebe[0].wegaufz 1048576 getriebe[0].wegaufn 3600000 #Normalisation of speed CNC [incr./0.001°] antr.v_time_base 0 (0=min,1=sec,2=ta) antr.v_reso_num 1 antr.v_reso_denom 36 SERCOS drive with position control in the drive As of a speed of 200 rpm, the system should change over to speed control. Switch-back may occur as of 50 rpm. The drive has a Kv factor of 4000/min. The following settings are required in the axis list in addition to the drive telegram: # 0-main mode, 1-1st auxiliary, 2-2nd auxiliary, 3-3rd auxiliary antr.sai_op_mode_change.v_velocity_control_on 1 # [10-3degrees/s] -> 1200000 10-3degrees/s = 200 rpm antr.sai_op_mode_change.v_position_control_on 1200000 # [10-3degrees/s] -> 300000 10-3degrees/s = 50 rpm antr.velocity_position_control_off 300000 # default is 1 antr.nbr_delay_cycles 4 # CNC Kv : [0.01/s] getriebe[0].kv 6666 SERCOS drive with position control in the CNC As of a speed of 200 rpm, the system should change over to speed control. Switch-back may occur as of 50 rpm. A Kc factor of 100/s is set in the CNC:Scaling of the speed command value in the drive is 10-4 rpm. The following settings are required in the axis list in addition to the drive telegram: # Position control mode in the CNC antr.operation_mode CNC_POSITION_CONTROL # [10-3degrees/s] -> 1200000 10-3degrees/s = 200 rpm antr.sai_op_mode_change.v_velocity_control_on 1200000 # [10-3degrees/s] -> 300000 10-3degrees/s = 50 rpm antr.sai_op_mode_change.v_position_control_on 300000 # CNC Kv : [0.01/s] getriebe[0].kv 10000 # Manipulated variable scaling [°/min]: # 1000°/min = 10000000°/360° * 10^-4 rpm getriebe[0].multi_gain_z 10000000 getriebe[0].multi_gain_n 360 16 Version: 1.04 TF5200 | Twin CAT 3 CNC Spindle operation mode
## Page 17

Parameter 4 Parameter 4.1 Overview ID Parameter Description P-AXIS-00264 antr.sercos.op_mode_f Operation mode for velocity control or_velocity_control P-AXIS-00463 antr.canopen.cyclic_po Operation mode for drive position control (CANopen) sition_op_mode P-AXIS-00464 antr.canopen.cyclic_vel Operation mode for drive velocity control (CANopen) ocity_op_mode P-AXIS-00766 antr.sai_op_mode_cha Weighting of speed feedforward control set in the drive nge.feed_forward_v_w eighting P-AXIS-00767 antr.sai_op_mode_cha Changeover speed in speed-controlled mode nge.v_velocity_control _on P-AXIS-00768 antr.sai_op_mode_cha Change-back speed in position-controlled mode nge.v_position_control _on 4.2 Description P-AXIS-00264 Operation mode for velocity control (SERCOS) Description This parameter defines the required operation mode during switching to velocity control. Parameter antr.sercos.op_mode_for_velocity_control Data type UNS16 Data range 0 ≤ op_mode_for_velocity_control ≤ 3 where: 0: Main operation mode S-0-0032 1: Auxiliary operation mode 1, S-0-0033 2: Auxiliary operation mode 2, S-0-0034 3: Auxiliary operation mode 3, S-0-0035 Axis types S Dimension S: ---- Default value 0 drive types. SERCOS Remarks The main mode can also be used for speed control. P-AXIS-00463 Operation mode for drive position control (CANopen) Description Parameter is used if the transmission of the drive operation mode (CANopen object 0x6060) is configured in the cyclic process data. Enter the value to be transferred after controller and fieldbus start-up for the operation mode ‘cyclic synchronous position mode’. Parameter antr.canopen.cyclic_position_op_mode Data type SGN16 Data range MIN(SGN16) … MAX(SGN16) Axis types T, R, S Dimension T: ---- R,S: ---- Default value 8 drive types. CANopen TF5200 | Twin CAT 3 CNC Version: 1.04 17 Spindle operation mode
## Page 18

Parameter Remarks P-AXIS-00464 Operation mode for drive velocity control (CANopen) Description Parameter is used if the transmission of the drive operation mode (CANopen object 0x6060) is configured in the cyclic process data. Enter the value to be transferred after controller and fieldbus start-up for the operation mode ‘cyclic synchronous position mode’. Parameter antr.canopen.cyclic_velocity_op_mode Data type SGN16 Data range MIN(SGN16) … MAX(SGN16) Axis types T, R, S Dimension T: ---- R,S: ---- Default value 9 drive types. CANopen Remarks P-AXIS-00766 Weighting of velocity feedforward control Description To allow smooth switching between position- and speed-controlled mode, the weighting of the velocity feedforward control set in the drive must be considered. This weighting can be set with this parameter. Parameter antr.sai_op_mode_change.feed_forward_v_weighting Data type UNS16 Data range 0 <= P-AXIS-00766 <= 1200 Axis types S Dimension S:0.1% Default value 0 drive types. SERCOS, CANopen Remarks The weighting of velocity feedforward control is configured for CANopen drives by the object 3062h. With SERCOS drives, velocity feedforward control is weighted by the parameter S-0-0296. P-AXIS-00767 Velocity limit for switching to velocity controlled mode Description This parameter specifies a limit speed. The limit speed only acts if a speed greater than the changeover speed is specified. It is then switched over to speed-controlled mode. Parameter antr.sai_op_mode_change.v_velocity_control_on Data type SGN32 Data range 0 ≤ P-AXIS-00767 ≤ MAX(SGN32) Axis types S Dimension S: 0.001°/s Default value 2000000000 drive types. SERCOS, CANopen Remarks Only a speed of 0 is practical for a sensorless spindle. Therefore the command velocity of the interpolator is always output and not the setpoint velocity of the position controller. P-AXIS-00767 replaces the parameter P-AXIS-00265 as of v3.1.3079.13. However, the latter retains its functionality. P-AXIS-00768 Velocity limit for switching back to position control Description This parameter specifies the limit speed for switching back to position control. 18 Version: 1.04 TF5200 | Twin CAT 3 CNC Spindle operation mode
## Page 19

Parameter The limit speed P-AXIS-00768 only acts if the current speed is greater than P-AXIS-00768 for positioning with M19. It is first decelerated to P-AXIS-00768 before position control is switched on. Parameter antr.sai_op_mode_change.v_position_control_on Data type SGN32 Data range 0 ≤ P-AXIS-00768 ≤ MAX(SGN32) Axis types S Dimension S: 0.001°/s Default value 0 drive types. SERCOS, CANopen Remarks Only a speed of 0 is practical for a sensorless spindle. Therefore the command velocity of the interpolator is always output and not the setpoint velocity of the position controller. P-AXIS-00768 replaces the parameter P-AXIS-00265 as of v3.1.3079.13. However, the latter retains its functionality. TF5200 | Twin CAT 3 CNC Version: 1.04 19 Spindle operation mode
## Page 20

Index Index P P-AXIS-00264 17 P-AXIS-00463 17 P-AXIS-00464 18 P-AXIS-00766 18 P-AXIS-00767 18 P-AXIS-00768 18 20 Version: 1.04 TF5200 | Twin CAT 3 CNC Spindle operation mode
## Page 22

More Information: www.beckhoff.com/TF5200 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
