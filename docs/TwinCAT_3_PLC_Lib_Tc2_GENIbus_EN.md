---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.6.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_GENIbus_EN.pdf"
release_date: "2025-05-15"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc2_GENIbus 2025-05-15 | Version: 1.6.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 GENIbus..................................................................................................................................................... 9 3.1 Device addressing............................................................................................................................. 9 3.2 Wiring................................................................................................................................................ 9 4 Programming........................................................................................................................................... 13 4.1 POUs............................................................................................................................................... 13 4.1.1 Base................................................................................................................................. 13 4.1.2 Basic commands.............................................................................................................. 15 4.1.3 Pumps.............................................................................................................................. 22 4.1.4 Error codes....................................................................................................................... 25 4.2 DUTs............................................................................................................................................... 27 4.2.1 Enums.............................................................................................................................. 27 4.2.2 Structures......................................................................................................................... 31 4.3 Integration into Twin CAT................................................................................................................. 40 4.3.1 KL6041 with CX5120....................................................................................................... 40 5 Appendix.................................................................................................................................................. 45 5.1 Support and Service........................................................................................................................ 45 TE1000 Version: 1.6.0 3
## Page 4

Table of contents 4 Version: 1.6.0 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1000 Version: 1.6.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.6.0 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.6.0 7
## Page 8

Introduction 2 Introduction The user of this library requires basic knowledge of the following: • Twin CAT XAE • PC and network knowledge • Structure and properties of the Beckhoff Embedded PC and its Bus Terminal system • Serial communication (RS485) and GENIbus protocol • Relevant safety regulations for building technical equipment This software library is intended for building automation system partners of Beckhoff Automation Gmb H & Co. KG. The system partners operate in the field of building automation and are concerned with the installation, commissioning, expansion, maintenance and service of measurement, control and regulating systems for the technical equipment of buildings. The Tc2_GENIbus library is usable on all hardware platforms that support Twin CAT 3.1 or higher. Hardware documentation KL6021, KL6031_KL6041 and EL6021 in the Beckhoff Information System. 8 Version: 1.6.0 TE1000
## Page 9

GENIbus 3 GENIbus The Twin CAT PLC library contains communication function blocks for the GENIbus master/slave communication from the Twin CAT PLC. GENIbus (Grundfos Electronic Network Intercommunications bus) is a protocol specially developed by the Grundfos company for the exchange of data with its devices. Several Grundfos devices can be connected via GENIbus to form a network and integrated into an automation system. GENIbus is based on the RS485 hardware interface. Data exchange takes place at 9600 baud. In most cases a GENIbus network consists of a master and up to 200 slaves. Further documentation • GENIbus Protocol Specification • Grundfos: Operating the MAGNA3 and MGE model H/I via the GENIpro interface 3.1 Device addressing In principle, the GENIbus protocol knows only two types of addressing: Individual addressing and broadcast or group commands. The addresses are to be assigned as follows: • 0 - 31 : master addresses, i.e. the Twin CAT controllers • 32 - 231 : slave addresses, e.g. pumps • 255 : broadcast addressing to all slaves At function-block level in the library the address range of the slaves is set to 1 – 200, i.e. 31 fewer than in the serial network. The reason for this is that the Grundfos parameterization devices also operate with an address range of 1 - 200. 31 is internally added to the slave address again for the serial communication. 3.2 Wiring The GENIbus-communication is based on the RS485-standard running in half duplex-mode. Therefore a 2- wire-communication with a plus (A) and a minus (B) cable must be set up. The serial-communication-terminals KL6021, KL6041 and EL6021 and the serial bus of the CX9020 can handle the half duplex-, but also and the fullduplex-mode. In this mode the plus and the minus channel exists both for the sending (Transmit-Data, Tx D) and receiving-channel (Receive-Data, Rx D). To use the half duplex-mode correctly, you must connect Rx- to Tx- as well as Rx+ to Tx+. The serial bus of the CX8080 can only handle the half duplex-mode, so no direct connection between any bus-inputs is neccessary. NOTICE The described plus- and minus-connection to the GENIbus-module (port A for plus and port B for minus) only applies for the CIM 050, which was used for the tests. Before connecting the Beckhoff-terminals to the Grundfos-hardware, please read the documentation of the Grundfos-module, which terminals are the right ones. Furthermore, this chapter only describes the serial-bus-connections. For long wirings a shielding of the cable will be unenviable. TE1000 Version: 1.6.0 9
## Page 10

GENIbus Wiring diagrams: KL6021, KL6041 and EL6021 10 Version: 1.6.0 TE1000
## Page 11

GENIbus CX9020 (this configuration is not available as a program-example) TE1000 Version: 1.6.0 11
## Page 12

GENIbus CX8080 12 Version: 1.6.0 TE1000
## Page 13

Programming 4 Programming 4.1 POUs 4.1.1 Base 4.1.1.1 FB_GENIbus Communication The function blocks for the GENIbus commands do not directly access the process image of the selected serial interface; instead, they place the individual GENIbus commands into three different buffers. The function block FB_GENIbus Communication() sequentially reads the GENIbus commands from these three buffers and forwards the GENIbus commands to the serial interface. This prevents multiple function blocks accessing the process image of the serial interface at the same time. Each of these three buffers is processed with a different priority (high, medium or low). The parameter e Command Priority [} 28], which is available for most function blocks, can be used to specify the priority with which the respective GENIbus command is processed by the function block FB_GENIbus Communication(). The buffers in which the GENIbus commands are placed are all contained in a variable of the type ST_GENIbus Command Buffer [} 31]. There is one instance of the function block FB_GENIbus Communication() and one variable of the type ST_GENIbus Command Buffer per serial interface. If possible, the function block FB_GENIbus Communication() should be called in a separate, faster task. The extent to which the buffers are utilized can be determined from the outputs of the function block. Three arrays are output for this in which each element (0, 1 or 2) represents one of the three buffers (high, middle or low). If you detect regular overflow for one of the three buffers, you should consider the following: • How heavily are the individual PLC tasks utilized? Twin CAT XAE provides suitable analysis tools. • Try reducing the cycle time of the task in which the function block FB_GENIbus Communication() is called. The value should not exceed 6 ms. Ideally it should be 2 ms. • Check the cycle time of the PLC task in which the function blocks for the individual GENIbus commands are called. This value should be between 10 ms and 60 ms. • If possible avoid polling (regular reading) of values. Only read values when they are actually required. Inputs VAR_INPUT b Reset Maximum Demand Counter : BOOL; b Reset Overflow Counter : BOOL; by Master Addr : BYTE; dw Options : DWORD := 0; e Com Mode : E_GENIbus Com Mode; END_VAR TE1000 Version: 1.6.0 13
## Page 14

Programming Name Type Description b Reset Maximum De BOOL A rising edge resets the stored value of the maximum mand Counter command buffer utilization, arr Buffer Maximum Demand Meter (0 - 100%, see VAR_OUTPUT). b Reset Overflow Cou BOOL A rising edge resets the stored value of the number of nter command buffer overflows, arr Buffer Overflow Counter (see VAR_OUTPUT). by Master Addr BYTE Specifies the address that the Twin CAT controller should have within the GENIbus line. Possible input range: 0 - 31. dw Options DWORD Reserved for future applications. e Com Mode E_GENIbus Com Mode The selection of the serial communication interface must be entered at this parameter. If a KL terminal or an [} 28] Ether CAT Terminal is in use, then a configuration of the connection parameters is internally and automatically started: Baud Rate: 9600 Data Bits: 8 Parity: None Stop Bits: 1 Unfortunately this is not possible for PC-based interfaces; in this case the parameters must be directly entered in the Twin CAT XAE. Inputs/outputs VAR_IN_OUT st In Data : ST_GENIbus In Data; st Out Data : ST_GENIbus Out Data; st Command Buffer : ST_GENIbus Command Buffer; END_VAR Name Type Description st In Data ST_GENIbus In Data [} 32] Reference to the structure which contains the input process image for communication with the serial interface. st Out Data ST_GENIbus Out Data Reference to the structure which contains the output process image for communication with the serial interface. [} 36] st Command Buffer ST_GENIbus Command Buff Reference to the structure for communication (buffer) with er [} 31] the FB_GENIbus Communication() [} 13] function block Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; udi Error Arg : UDINT; arr Buffer Demand Meter : ARRAY[0..2] OF BYTE; arr Buffer Maximum Demand Meter : ARRAY[0..2] OF BYTE; arr Buffer Overflow Counter : ARRAY[0..2] OF UINT; b Line Is Busy : BOOL; b Line Is Initialized : BOOL; b Line Is Configured : BOOL; END_VAR Name Type Description b Busy BOOL Starting with the edge at b Start, this output remains TRUE until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. 14 Version: 1.6.0 TE1000
## Page 15

Programming Name Type Description udi Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 25]). It is set back to 0 by the reactivation of the function block via the b Start input. udi Error Arg UDINT If applicable, contains an extended description of the error code. arr Buffer Demand Me ARRAY OF BYTE Demand of the respective buffer (0 - 100%). ter arr Buffer Maximum D ARRAY OF BYTE Previous maximum demand of the respective buffer (0 - emand Meter 100%). arr Buffer Overflow Co ARRAY OF UINT Number of buffer overflows to date. unter b Line Is Busy BOOL This output is set as long as the serial communication is active. b Line Is Initialized BOOL If the function block is called up for the first time (e.g. when starting the controller), initialization is carried out. No GENIbus commands can be processed during this time. b Line Is Configured BOOL This output indicates with TRUE that the terminal has been successfully configured with the above-mentioned serial parameters. This output is automatically set if the interface is a PC interface, since the user has to enter the parameters himself in the Twin CAT XAE. Since an error may not interrupt the execution of the function block, b Error, udi Error Id and udi Error Arg are initially reset in every PLC cycle and then re-evaluated. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.1.2 Basic commands 4.1.2.1 FB_GENIbus Get This function block reads a value from a GENIbus device. Inputs VAR_INPUT b Start : BOOL; by Addr : BYTE := 0; by Class : BYTE := 2; by IDCode : BYTE := 0; e Command Priority : E_GENIbus Command Priority := e GENIbus Command Priority Middle; END_VAR TE1000 Version: 1.6.0 15
## Page 16

Programming Name Type Description b Start BOOL The reading process is initiated by a rising edge at this input. by Adress BYTE Address of the GENIbus device to be addressed: valid entries: 1 - 200. This corresponds to the setting as is made directly on the GENIbus device. Conversion to the actual address range 32 - 231 takes place within the function block (see GENIbus standard). A broadcast command via address 255 is naturally not permitted. by Class/by IDCode BYTE Class and ID code of the storage space to be read. GET commands are permissible only for classes 2, 4, 5 and 7 – an error is output for all other entries. Conversely, there is no restriction of the ID code entry, since these ranges are not without gaps and may possibly be extended. e Command Priority E_GENIbus Command Priori Priority (high, medium or low) with which the command is processed by the PLC library. ty [} 28] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_GENIbus Command Buffer; END_VAR Name Type Description st Command Buffer ST_GENIbus Command Buff Reference to the structure for communication (buffer) with er [} 31] the FB_GENIbus Communication() [} 13] function block Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; udi Error Arg : UDINT; by Value : BYTE; END_VAR Name Type Description b Busy BOOL Starting with the edge at b Start, this output remains TRUE until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. udi Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 25]). It is set back to 0 by the reactivation of the function block via the b Start input. udi Error Arg UDINT If applicable, contains an extended description of the error code. by Value BYTE Output of the read value. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 16 Version: 1.6.0 TE1000
## Page 17

Programming 4.1.2.2 FB_GENIbus Set This function block writes a value in a GENIbus device or executes a command (Class-3 IDs). Inputs VAR_INPUT b Start : BOOL; by Addr : BYTE := 0; by Class : BYTE := 2; by IDCode : BYTE := 0; by Value : BYTE; e Command Priority : E_GENIbus Command Priority := e GENIbus Command Priority Middle; END_VAR Name Type Description b Start BOOL A rising edge at this input starts the setting process. by Adress BYTE Address of the GENIbus device to be addressed: valid entries: 1 - 200. This corresponds to the setting as is made directly on the GENIbus device. Conversion to the actual address range 32 - 231 takes place within the function block (see GENIbus standard). by Class/by IDCode BYTE Class and ID code of the storage space to be read. SET commands are permissible only for classes 3, 4 and 5 – an error is output for all other entries. Conversely, there is no restriction of the ID code entry, since these ranges are not without gaps and may possibly be extended. by Value BYTE Value to be written. In the case of Class-3 command IDs this entry is ignored. e Command Priority E_GENIbus Command Priori Priority (high, medium or low) with which the command is processed by the PLC library. ty [} 28] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_GENIbus Command Buffer; END_VAR Name Type Description st Command Buffer ST_GENIbus Command Buff Reference to the structure for communication (buffer) with er [} 31] the FB_GENIbus Communication() [} 13] function block Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; udi Error Arg : UDINT; END_VAR TE1000 Version: 1.6.0 17
## Page 18

Programming Name Type Description b Busy BOOL Starting with the edge at b Start, this output remains TRUE until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. udi Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 25]). It is set back to 0 by the reactivation of the function block via the b Start input. udi Error Arg UDINT If applicable, contains an extended description of the error code. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.1.2.3 FB_GENIbus Info This function block reads the information area of an ID. Inputs VAR_INPUT b Start : BOOL; by Addr : BYTE := 0; by Class : BYTE := 2; by IDCode : BYTE := 0; e Command Priority : E_GENIbus Command Priority := e GENIbus Command Priority Middle; END_VAR Name Type Description b Start BOOL The reading process is initiated by a rising edge at this input. by Adress BYTE Address of the GENIbus device to be addressed: valid entries: 1 - 200. This corresponds to the setting as is made directly on the GENIbus device. Conversion to the actual address range 32 - 231 takes place within the function block (see GENIbus standard). A broadcast command via address 255 is naturally not permitted. by Class/by IDCode BYTE Class and ID code of the storage space to be read. INFO commands are permissible only for classes 2, 3, 4 and 5 – an error is output for all other entries. Conversely, there is no restriction of the ID code entry, since these ranges are not without gaps and may possibly be extended. 18 Version: 1.6.0 TE1000
## Page 19

Programming Name Type Description e Command Priority E_GENIbus Command Priori Priority (high, medium or low) with which the command is processed by the PLC library. ty [} 28] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_GENIbus Command Buffer; END_VAR Name Type Description st Command Buffer ST_GENIbus Command Buff Reference to the structure for communication (buffer) with er [} 31] the FB_GENIbus Communication() [} 13] function block Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; udi Error Arg : UDINT; by Info Head : BYTE; by Unit Index : BYTE; by Zero H : BYTE; by Range Zero L : BYTE; END_VAR Name Type Description b Busy BOOL Starting with the edge at b Start, this output remains TRUE until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. udi Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 25]). It is set back to 0 by the reactivation of the function block via the b Start input. udi Error Arg UDINT If applicable, contains an extended description of the error code. by Info Head BYTE Scaling information by Unit Index BYTE Sign and unit – coded. by Zero H BYTE Zero point in the case of normal range zero-point scaling OR high-byte zero point in the case of extended scaling. by Range Zero L BYTE Range in the case of normal range zero-point scaling OR low-byte zero point in the case of extended scaling. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 TE1000 Version: 1.6.0 19
## Page 20

Programming 4.1.2.4 FB_GENIbus Get MValue This function block reads a measured value from a GENIbus device. The operation is limited exclusively to values of class 2. Only the ID code of the high-byte and the length of the measured value need to be specified; the type of scaling and the unit of the measured value are determined by an internal INFO query. A structure at the st MValue output provides all important information about the value. Inputs VAR_INPUT b Start : BOOL; by Addr : BYTE := 0; by IDCode : BYTE := 0; e Data Size : E_GENIBus MData Size; e Command Priority : E_GENIbus Command Priority := e GENIbus Command Priority Middle; END_VAR Name Type Description b Start BOOL The reading process is initiated by a rising edge at this input. by Adress BYTE Address of the GENIbus device to be addressed: valid entries: 1 - 200. This corresponds to the setting as is made directly on the GENIbus device. Conversion to the actual address range 32 - 231 takes place within the function block (see GENIbus standard). A broadcast command via address 255 is naturally not permitted. by IDCode BYTE ID code of the value to be read. In the case of 16, 24 and 32-bit values, the ID of the high-byte must be specified here and the following order is always assumed: ID = hi, ID+1 = lo1, ID+2 = lo2, ID+3 = lo3. e Data Size E_GENIBus MData Size Data size of the measured value: 8, 16, 24 or 32 bit. [} 29] e Command Priority E_GENIbus Command Priori Priority (high, medium or low) with which the command is processed by the PLC library. ty [} 28] Example: Read the total volume of water pumped. For this case is: • by Id Code = 121 • e Data Size = e GENIbus MSize32Bit 20 Version: 1.6.0 TE1000
## Page 21

Programming Source: Grundfos documentation "Operating the MAGNA3 and MGE model H/I via the GENIpro interface - Edition 01.00.35 - April 2015". Inputs/outputs VAR_IN_OUT st Command Buffer : ST_GENIbus Command Buffer; END_VAR Name Type Description st Command Buffer ST_GENIbus Command Buff Reference to the structure for communication (buffer) with er [} 31] the FB_GENIbus Communication() [} 13] function block Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; udi Error Arg : UDINT; st MValue : ST_GENIbus MValue; END_VAR Name Type Description b Busy BOOL Starting with the edge at b Start, this output remains TRUE until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. udi Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 25]). It is set back to 0 by the reactivation of the function block via the b Start input. udi Error Arg UDINT If applicable, contains an extended description of the error code. st MValue ST_GENIbus MValue Output of the read value. [} 35] Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 TE1000 Version: 1.6.0 21
## Page 22

Programming 4.1.3 Pumps 4.1.3.1 FB_GENIbus Magna Pump This function block represents a universal application for a Grundfos Magna pump. The fundamental operating modes can be set and important parameters read out. The values shown below in bold and in square brackets represent the class and ID with which the commands are executed or the information is obtained. These values are listed in the Grundfos documentation "Operating the MAGNA3 and MGE model H/I via the GENIpro interface - Edition 01.00.35 - April 2015". Inputs VAR_INPUT b Enable : BOOL; by Addr : BYTE; t Info Cycle : TIME; lr Setpoint : LREAL; b Set Setpoint : BOOL; e Set Op Mode : E_GENIbus Op Mode := e GENIbus Op Mode Stop; b Set Op Mode : BOOL; e Set Ctrl Mode : E_GENIbus Ctrl Mode := e GENIbus Ctrl Mode Const Freq; b Set Ctrl Mode : BOOL; e Set Night Reduction Mode : E_GENIbus Night Reduction Mode := e GENIbus Night Reduction Mode Off; b Set Night Reduction Mode : BOOL; e Set Key Mode : E_GENIbus Key Mode := e GENIbus Key Mode Unlocked; b Set Key Mode : BOOL; b Reset Alarm : BOOL; b Reset Counters : BOOL; e Command Priority : E_GENIbus Command Priority := e GENIbus Command Priority Middle; END_VAR 22 Version: 1.6.0 TE1000
## Page 23

Programming Name Type Description b Enable BOOL The function block is enabled by setting this input. by Adress BYTE Address of the GENIbus device to be addressed: valid entries: 1 - 200. This corresponds to the setting as is made directly on the GENIbus device. A conversion to the actual address range of 32 - 231, see GENIbus standard, takes place internally in the function block. A broadcast or collective command to several pumps is also possible. The value at this input must then be 255. The value queries are disabled in the case of the broadcast command. t Info Cycle TIME Specifies the interval at which the value-query commands are to be output. This entry is limited to a minimum of 1 s. Conversely, the entry "0s" is permitted and means that no query takes place. lr Setpoint LREAL Setpoint entry [5, 1] . The entry is in percent and refers to the specified limits, depending on the method of control. A more precise description is given in the respective documentation from the Grundfos company. b Set Setpoint BOOL A rising edge at this input transmits the set setpoint. e Set Op Mode E_GENIbus Op Mode This input is used to select one of the following operating modes: [} 30] Stop [3, 5] Start [3, 6] Minimum curve [3, 25] Maximum curve [3, 26] b Set Op Mode BOOL A rising edge at this input transmits the set operating mode. e Set Ctrl Mode E_GENIbus Ctrl Mode This input is used to set one of the following control modes: [} 29] Constant frequency [3, 22] Proportional pressure [3, 23] Constant pressure [3, 24] Auto-adapting [3, 52] b Set Ctrl Mode BOOL A rising edge at this input transmits the set control mode. e Set Night Reduction E_GENIbus Night Reduction This input is used to select or deselect the night reduction Mode mode [4, 170] Mode [} 29] b Set Night Reduction BOOL A rising edge at this input transmits the set selection. Mode e Set Key Mode E_GENIbus Key Mode Locking of the manual operation on the pump can be selected with the aid of this input. The lock only blocks the [} 29] parameterization menu, not the keys themselves. [3, 30/31] b Set Key Mode BOOL A rising edge at this input transmits the set selection. b Reset Alarm BOOL A rising edge at this input resets the currently pending alarm on the device. [3, 2] b Reset Counters BOOL A rising edge at this input resets counters, such as operating hours or energy. [3, 36] e Command Priority E_GENIbus Command Priori Priority (high, medium or low) with which the command is processed by the PLC library. ty [} 28] TE1000 Version: 1.6.0 23
## Page 24

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_GENIbus Command Buffer; END_VAR Name Type Description st Command Buffer ST_GENIbus Command Buff Reference to the structure for communication (buffer) with er [} 31] the FB_GENIbus Communication() [} 13] function block Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; udi Error Arg : UDINT; e Actual Op Mode : E_GENIbus Act Op Mode; e Actual Ctrl Mode : E_GENIbus Act Ctrl Mode; b Night Reduction : BOOL; b Warning : BOOL; by Warn Code : BYTE; b Alarm : BOOL; by Alarm Code : BYTE; b Keys Locked : BOOL; st Actual Setpoint : ST_GENIbus MValue; st Normalized Setpoint : ST_GENIbus MValue; st Pump Flow : ST_GENIbus MValue; st Power Consumption : ST_GENIbus MValue; st Rotational Speed : ST_GENIbus MValue; st Pump Head : ST_GENIbus MValue; st Engery Consumption : ST_GENIbus MValue; st Operating Hours : ST_GENIbus MValue; st Medium Temperature : ST_GENIbus MValue; END_VAR Name Type Description b Busy BOOL Starting with the edge at b Start, this output remains TRUE until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. udi Error Id UDINT Contains the command-specific error code of the most recently executed command (see error codes [} 25]). It is set back to 0 by the reactivation of the function block via the b Start input. udi Error Arg UDINT If applicable, contains an extended description of the error code. e Actual Op Mode E_GENIbus Act Op Mode Currently valid operating mode [2, 81] [} 27] e Actual Ctrl Mode E_GENIbus Act Ctrl Mode Currently valid control mode [2, 81] [} 27] b Night Reduction BOOL Night reduction is selected. [2, 84] b Warning BOOL A warning message is pending. by Warn Code BYTE Code of the current warning message. [2, 156] b Alarm BOOL An alarm is pending. by Alarm Code BYTE Code of the current alarm. [2, 158] b Keys Locked BOOL Locking of manual operation on the pump is enabled. [4, 170] st Actual Setpoint ST_GENIbus MValue Currently set setpoint; the unit displayed depends on the control mode [2, 48] [} 35] 24 Version: 1.6.0 TE1000
## Page 25

Programming Name Type Description st Normalized Setpoin ST_GENIbus MValue Current normalized setpoint [2, 49] t [} 35] st Pump Flow ST_GENIbus MValue Flow rate [2, 39] [} 35] st Power Consumptio ST_GENIbus MValue Power consumption [2, 34] n [} 35] st Rotational Speed ST_GENIbus MValue Rotational speed [2, 35/36] [} 35] st Pump Head ST_GENIbus MValue Pump head [2, 37] [} 35] st Engery Consumptio ST_GENIbus MValue Energy consumption [2, 152/153] n [} 35] st Operating Hours ST_GENIbus MValue Operating hours counter [2, 24/25] [} 35] st Medium Temperatu ST_GENIbus MValue Water (medium) temperature [2, 58] re [} 35] Since an error may not interrupt the execution of the function block, b Error, udi Error Id and udi Error Arg are initially reset in every PLC cycle and then re-evaluated. For the determination of sporadically occurring errors, an error memory must therefore be programmed external to the function block. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.1.4 Error codes Err Id (hex) Err Id (dec) Err Arg Description 0x0000 0 n/a No error. 0x8001 32769 n/a Internal error: no AMS-Net ID is read out. The process image is possibly not correctly linked. 0x8002 32770 n/a Incorrect baud rate entry. 0x8003 32771 Sub-function- Internal error while writing the configuration data. block error udi Error Arg contains the error number of the write function number block FB_Ec Co ESdo Write() of the internally used library Tc Ether CAT.lib. 0x8004 32772 n/a Internal error: Incorrect pointer assignment p Reg Com In/ p Reg Com Out. One of the two pointers points to the address 0. 0x8005 32773 n/a Timeout error during the register communication. 0x8019 32793 n/a Invalid master address. Valid range: 0 - 31. 0x8020 32800 Sub-function- Error while configuring a KL6xxx (5 bytes of data). block error udi Error Arg contains the error number of the internal number configuration function block. 0x8021 32801 Sub-function- Error while configuring a KL6xxx (22 bytes of data). block error udi Error Arg contains the error number of the internal number configuration function block. 0x8022 32802 Sub-function- Error while configuring a KL6xxx (22 bytes of data). block error udi Error Arg contains the error number of the internal number configuration function block. TE1000 Version: 1.6.0 25
## Page 26

Programming Err Id (hex) Err Id (dec) Err Arg Description 0x8023 32803 1 Incorrect communication type (e GENIbus Com Mode input). 2 Incorrect pointer assignment. One of the two addresses of the selected input/output variable (st GENIbus In Data/ st GENIbus Out Data) points to the address 0. 3 Communication via an Ether CAT Terminal is selected. However, the EL6xxx terminal is not in the “OP state”. 4 The EL6xxx terminal contains incorrect data. This is signaled by the fact that the input variable “WC State” is set to 1. 0x8024 32804 Sub-function- Error during the creation of the serial telegram. udi Error Arg block error contains the error number of the internal function block. number 0x8025 32805 Sub-function- Error during the serial data transmission. udi Error Arg block error contains the error number of the internal function block. number 0x8026 32806 Sub-function- Error during the evaluation of the serial telegram. block error udi Error Arg contains the error number of the internal number function block. 0x8027 32807 n/a Timeout error during the transmit-receive cycle. 0x8030 32816 n/a Index error while transmitting the telegram. 0x8031 32817 n/a Index error while receiving the telegram. 0x8032 32818 n/a Incorrect data length while receiving the telegram. 0x8033 32819 n/a Timeout error while receiving the telegram. 0x8040 32832 Incorrect OS The response telegram contains an unknown “Operation Specifier” (OS), see GENIbus Protocol Specification. 0x8041 32833 n/a Telegram length error. 0x8042 32834 n/a Telegram CRC check error. 0x8045 32837 Maximum Error during the conversion to a telegram: too many APDU number of entries. udi Error Arg shows the maximum possible number APDUs of APDU entries. 0x8049 32841 n/a Invalid device (slave) address. Valid range: 1 - 200. 0x8050 32848 n/a Incorrect class entry by Class. 0x8051 32849 n/a Incorrect entry e Command Priority. 0x8052 32850 n/a Incorrect entry e Set Op Mode. 0x8053 32851 n/a Incorrect entry e Set Ctrl Mode. 0x8054 32852 n/a Incorrect entry e Set Night Reduction Mode. 0x8055 32853 n/a Incorrect entry e Set Key Mode. 0x8056 32854 n/a Command buffer overflow (st Command Buffer): Not all previously transmitted commands have been processed. 0x8057 32855 n/a Timeout error (runtime monitoring) with the response telegram. 0x8058 32856 n/a The response telegram of the GENIbus device reports “Data Class Unknown”, see GENIbus Protocol Specification, feedback entry “ACK”. 0x8059 32857 n/a The response telegram of the GENIbus device reports “Data Item ID Unknown”, see GENIbus Protocol Specification, feedback entry “ACK”. 0x805A 32858 n/a The response telegram of the GENIbus device reports “Invalid command or Data Class write buffer is full”, see GENIbus Protocol Specification, feedback entry “ACK”. 0x805B 32859 n/a Unknown ACK entry in response telegram. 26 Version: 1.6.0 TE1000
## Page 27

Programming Err Id (hex) Err Id (dec) Err Arg Description 0x805C 32860 transferred The FB_GENIbus Communication() function block has error number already detected an error and entered it in the response structure st Response Table Item. udi Error Arg contains the error number of the FB_GENIbus Communication() function block. 0x805D 32861 transferred An internal error has occurred during the scaling. error number udi Error Arg contains the internal error number. 0x8060 32864 n/a Data size (e Data Size) invalid. 0x8061 32865 n/a Invalid Scale-Info parameter in the telegram (e SIF), see GENIbus Protocol Specification, feedback entry “SIF”. 0x8062 32866 n/a Invalid combination of data size and Scale-Info. 0x8063 32867 n/a No info data available. 0x8064 32868 n/a The read-out unit index is not assigned to any unit, i.e. it doesn’t exist in the internal tables. 4.2 DUTs 4.2.1 Enums 4.2.1.1 E_GENIbus ACK ACK (Acknowledge-Code) from the response telegram. TYPE E_GENIbus ACK : ( e GENIbus ACKOk := 0, e GENIbus ACKUnknown Class := 1, e GENIbus ACKUnknown Id := 2, e GENIbus ACKIllegal Op := 3 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.2 E_GENIbus Act Ctrl Mode The read-out current control mode. TYPE E_GENIbus Act Ctrl Mode : ( e GENIbus Act Ctrl Mode Unknown := 0, e GENIbus Act Ctrl Mode Const Freq := 1, e GENIbus Act Ctrl Mode Const Press := 2, e GENIbus Act Ctrl Mode Prop Press := 3, e GENIbus Act Ctrl Mode Auto Adapt := 4 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.3 E_GENIbus Act Op Mode The read-out current operating mode. TE1000 Version: 1.6.0 27
## Page 28

Programming TYPE E_GENIbus Act Op Mode : ( e GENIbus Act Op Mode Unknown := 0, e GENIbus Act Op Mode Stop := 1, e GENIbus Act Op Mode Start := 2, e GENIbus Act Op Mode Min := 3, e GENIbus Act Op Mode Max := 4, e GENIbus Act Op Mode Hand := 5, e GENIbus Act Op User Def := 6 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.4 E_GENIbus Addr Type Addressing type. TYPE E_GENIbus Addr Type : ( e GENIbus Addr Type Single := 0, e GENIbus Addr Type Multi := 1, e GENIbus Addr Type Broadcast := 2 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.5 E_GENIbus Command Priority Command priority. TYPE E_GENIbus Command Priority : ( e GENIbus Command Priority High := 0, e GENIbus Command Priority Middle := 1, e GENIbus Command Priority Low := 2 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.6 E_GENIbus Com Mode Selection of the serial communication interface. TYPE E_GENIbus Com Mode : ( e GENIbus Com Mode_Unknown := 0, e GENIbus Com Mode_KL6_5B := 1, e GENIbus Com Mode_KL6_22B := 2, e GENIbus Com Mode_EL6_22B := 3, e GENIbus Com Mode_PC_64B := 4 ); END_TYPE 28 Version: 1.6.0 TE1000
## Page 29

Programming Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.7 E_GENIbus Ctrl Mode Adjustable control modes. TYPE E_GENIbus Ctrl Mode : ( e GENIbus Ctrl Mode Unknown := 0, e GENIbus Ctrl Mode Const Freq := 1, e GENIbus Ctrl Mode Const Press := 2, e GENIbus Ctrl Mode Prop Press := 3, e GENIbus Ctrl Mode Auto Adapt := 4 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.8 E_GENIbus Key Mode Disablement of the parameterization option on the GENIbus device. TYPE E_GENIbus Key Mode : ( e GENIbus Key Mode Locked := 0, e GENIbus Key Mode Unlocked := 1 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.9 E_GENIBus MData Size Bit size of the value to be read from the GENIbus device. TYPE E_GENIBus MData Size : ( e GENIbus MSize8Bit := 0, e GENIbus MSize16Bit := 1, e GENIbus MSize24Bit := 2, e GENIbus MSize32Bit := 3 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.10 E_GENIbus Night Reduction Mode Night setback mode on/off. TYPE E_GENIbus Night Reduction Mode : ( e GENIbus Night Reduction Mode Off := 0, TE1000 Version: 1.6.0 29
## Page 30

Programming e GENIbus Night Reduction Mode On := 1 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.11 E_GENIbus Op Mode Adjustable control modes. TYPE E_GENIbus Op Mode : ( e GENIbus Op Mode Unknown := 0, e GENIbus Op Mode Stop := 1, e GENIbus Op Mode Start := 2, e GENIbus Op Mode Min := 3, e GENIbus Op Mode Max := 4 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.12 E_GENIbus OS OS (Operation-Specifier) in the command telegram. TYPE E_GENIbus OS : ( e GENIbus GET := 0, e GENIbus SET := 1, e GENIbus INFO := 2 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.13 E_GENIbus SD SD (Start Delimiter) in the command or response telegram. TYPE E_GENIbus SD : ( e GENIbus Null := 16#0, e GENIbus Datareply := 16#24, e GENIbus Datamessage := 16#26, e GENIbus Datarequest := 16#27 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.1.14 E_GENIbus SIF SIF (Scale Information Format) in the response telegram. 30 Version: 1.6.0 TE1000
## Page 31

Programming TYPE E_GENIbus SIF : ( e GENIbus No Scale Info := 0, e GENIbus Bit Wise Scaled := 1, e GENIbus Scaled816 := 2, e GENIbus Scaled Ext := 3 ); END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2 Structures 4.2.2.1 ST_GENIbus Command Buffer Global command buffer for commands and their responses. TYPE ST_GENIbus Command Buffer : STRUCT arr Message Queue : ARRAY[0..2] OF ST_GENIbus Message Queue; st Response Table : ST_GENIbus Response Table; udi Message Handle : UDINT; END_STRUCT END_TYPE Name Type Description arr Message Queue ARRAY OF Input buffer for the commands. The field declaration offers ST_GENIbus Message Queu a choice of 3 different buffers: for high, medium and low priority. e [} 34] st Response Table ST_GENIbus Response Tabl Buffer for the command response. e [} 38] udi Message Handle UDINT Pointer to the current buffer element. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.2 ST_GENIbus Com Register Data Register address and contents for the parameterization of terminals. TYPE ST_GENIbus Com Register Data : STRUCT by Register : BYTE; w Value : WORD; END_STRUCT END_TYPE Name Type Description by Register BYTE Register address w Value WORD Register contents Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 TE1000 Version: 1.6.0 31
## Page 32

Programming 4.2.2.3 ST_GENIbus EL6AMSAddress Structure for linking in the input process image. The structure should be used for communication of an EL6xxx terminal. TYPE ST_GENIbus EL6AMSAddress : STRUCT arr Net Id : ARRAY[0..5] OF USINT; ui Port : UINT; END_STRUCT END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.4 ST_GENIbus EL6Device In22B Structure for linking in the input process image. The structure must be used for communication of an EL6xxx terminal. TYPE ST_GENIbus EL6Device In22B : STRUCT w Status : WORD; arr Data : ARRAY[0..21] OF BYTE; st Ads Addr : ST_GENIbus EL6AMSAddress; ui State : UINT; b Wc State : BOOL; END_STRUCT END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.5 ST_GENIbus EL6Device Out22B Structure for linking in the output process image. The structure must be used for communication of an EL6xxx terminal. TYPE ST_GENIbus EL6Device Out22B : STRUCT w Ctrl : WORD; arr Data : ARRAY[0..21] OF BYTE; END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.6 ST_GENIbus In Data Structure for linking the input image of the process variables. There is a choice of four different possible structures, of which finally only one is to be linked: TYPE ST_GENIbus In Data : STRUCT st KL6Device In5B : ST_GENIbus KL6Device In5B; st KL6Device In22B : ST_GENIbus KL6Device In22B; st EL6Device In22B : ST_GENIbus EL6Device In22B; st Pc Com Device In : ST_GENIbus Pc Com Device In64B; END_STRUCT END_TYPE 32 Version: 1.6.0 TE1000
## Page 33

Programming Name Type Description st KL6Device In5B ST_GENIbus KL6Device In5B Input process image of a 5-byte data terminal with standard communication bus, e.g. KL6021. [} 33] st KL6Device In22B ST_GENIbus KL6Device In22 Input process image of a 22-byte data terminal with standard communication bus, e.g. KL6041. B [} 33] st EL6Device In22B ST_GENIbus EL6Device In22 Input process image of a 22-byte Ether CAT data terminal, e.g. EL6021. B [} 32] st Pc Com Device In ST_GENIbus Pc Com Device I Input process image of a serial PC interface. n64B [} 36] Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.7 ST_GENIbus KL6Device In22B Structure for linking in the input process image. The structure must be used for communication of a KL6xxx terminal with 22-byte process image. TYPE ST_GENIbus KL6Device In22B : STRUCT w Status : WORD; arr Data : ARRAY[0..21] OF BYTE; END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.8 ST_GENIbus KL6Device In5B Structure for linking in the input process image. The structure must be used for communication of a KL6xxx terminal with 5-byte process image. TYPE ST_GENIbus KL6Device In5B : STRUCT by Status : BYTE; arr Data : ARRAY[0..4] OF BYTE; END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.9 ST_GENIbus KL6Device Out22B Structure for linking in the output process image. The structure must be used for communication of a KL6xxx terminal with 22-byte process image. TYPE ST_GENIbus KL6Device Out22B : STRUCT w Ctrl : WORD; arr Data : ARRAY[0..21] OF BYTE; END_TYPE TE1000 Version: 1.6.0 33
## Page 34

Programming Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.10 ST_GENIbus KL6Device Out5B Structure for linking in the output process image. The structure must be used for communication of a KL6xxx terminal with 5-byte process image. TYPE ST_GENIbus KL6Device Out5B : STRUCT by Ctrl : BYTE; arr Data : ARRAY[0..4] OF BYTE; END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.11 ST_GENIbus Message Queue Command buffer. TYPE ST_GENIbus Message Queue : STRUCT arr Buffer : ARRAY[1.. GENIBUS_COMMAND_BUFFER_ENTRIES] OF ST_GENIbus Message Queue I tem; by Buffer Read Pointer : BYTE; by Buffer Write Pointer : BYTE; by Buffer Demand Counter : BYTE; by Buffer Maximum Demand Counter : BYTE; ui Buffer Overflow Counter : UINT; b Lock Semaphore : BOOL; END_STRUCT END_TYPE Name Type Description arr Buffer ARRAY OF Command buffer ST_GENIbus Message Queu e Item [} 34] by Buffer Read Pointer BYTE Pointer to the current buffer element of the command memory. by Buffer Write Pointer BYTE Pointer to the current buffer element of the receive memory. by Buffer Demand Co BYTE Current buffer demand. unter by Buffer Maximum D BYTE Maximum buffer demand. emand Counter. ui Buffer Overflow Cou UINT Number of buffer overflows. nter b Lock Semaphore BOOL Write protection during the processing of a command. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.12 ST_GENIbus Message Queue Item Individual element in the command buffer. 34 Version: 1.6.0 TE1000
## Page 35

Programming TYPE ST_GENIbus Message Queue Item : STRUCT by Addr : BYTE; e Addr Type : E_GENIbus Addr Type; e SD : E_GENIbus SD; arr APDUs : ARRAY[1.. GENIBUS_MAX_APDU_NUMBER] OF ST_GENIbus Request Class Entry; by RFS : BYTE; udi Message Handle : UDINT; END_STRUCT END_TYPE Name Type Description by Addr BYTE Device destination address e Addr Type E_GENIbus Addr Type Single, multiple or collective command [} 28] e SD E_GENIbus SD [} 30] Start delimiter of the telegram arr APDUs ARRAY OF Collection of the APDUs (Application Program Data Units) ST_GENIbus Request Class E to be transmitted. ntry [} 38] by RFS BYTE Not yet used: "Request from slave". udi Message Handle UDINT Pointer to the current buffer element. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.13 ST_GENIbus MValue Structure with the contents of a read device value, e.g. flow rate or rotational speed. TYPE ST_GENIbus MValue : STRUCT lr Value : LREAL; lr Prefix : LREAL; s Unit : STRING(8); e Data Size : E_GENIBus MData Size; by Value H : BYTE; by Value L1 : BYTE; by Value L2 : BYTE; by Value L3 : BYTE; by Info Head : BYTE; by Unit Index : BYTE; by Zero H : BYTE; by Range Zero L : BYTE; END_STRUCT END_TYPE Name Type Description lr Value LREAL Final value determined from the raw data. lr Prefix LREAL Sign and division (+/- and e.g. 0.1). s Unit STRING Unit. e Data Size E_GENIBus MData Size Size of the measured value (8, 16, 24 or 32 bytes). [} 29] by Value H BYTE High-byte of the measured value. by Value L1 BYTE Low-Byte by Value L2 BYTE Low-Byte by Value L3 BYTE Low-Byte by Info Head BYTE Scaling information by Unit Index BYTE Sign and unit – coded. by Zero H BYTE Zero point in the case of normal range zero-point scaling OR high-byte zero point in the case of extended scaling. TE1000 Version: 1.6.0 35
## Page 36

Programming Name Type Description by Range Zero L BYTE Range in the case of normal range zero-point scaling OR low-byte zero point in the case of extended scaling. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.14 ST_GENIbus Out Data Structure for linking the output image of the process variables. There is a choice of four different possible structures, of which finally only one is to be linked: TYPE ST_GENIbus Out Data : STRUCT st KL6Device Out5B : ST_GENIbus KL6Device Out5B; st KL6Device Out22B : ST_GENIbus KL6Device Out22B; st EL6Device Out22B : ST_GENIbus EL6Device Out22B; st Pc Com Device Out : ST_GENIbus Pc Com Device Out64B; END_STRUCT END_TYPE Name Type Description st KL6Device Out5B ST_GENIbus KL6Device Out Output process image of a 5-byte data terminal with standard communication bus, e.g. KL6021. 5B [} 34] st KL6Device Out22B ST_GENIbus KL6Device Out Output process image of a 22-byte data terminal with standard communication bus, e.g. KL6041. 22B [} 33] st EL6Device Out22B ST_GENIbus EL6Device Out Output process image of a 22-byte Ether CAT data terminal, e.g. EL6021 22B [} 32] st Pc Com Device Out ST_GENIbus Pc Com Device Output process image of a serial PC interface. Out64B [} 36] Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.15 ST_GENIbus Pc Com Device In64B Structure for linking in the input process image. The structure must be used for communication of a serial PC interface. TYPE ST_GENIbus Pc Com Device In64B : STRUCT w Status : WORD; arr Data : ARRAY[0..63] OF BYTE; END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.16 ST_GENIbus Pc Com Device Out64B Structure for linking in the input process image. The structure must be used for communication of a serial PC interface. 36 Version: 1.6.0 TE1000
## Page 37

Programming TYPE ST_GENIbus Pc Com Device Out64B : STRUCT w Ctrl : WORD; arr Data : ARRAY[0..63] OF BYTE; END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.17 ST_GENIbus Reply Class Entry Response structure containing the data of a response APDU for processing within the library. TYPE ST_GENIbus Reply Class Entry : STRUCT by Class : BYTE; e ACK : E_GENIbus ACK; e OS : E_GENIbus OS; i Entry Count : INT; arr Entry : ARRAY[0.. GENIBUS_MAX_APDU_LENGTH] OF ST_GENIbus Reply Data Entry; s ASCIIString : STRING(64); END_STRUCT END_TYPE Name Type Description by Class BYTE Data class e ACK E_GENIbus ACK [} 27] Acknowledgement of the GENIbus device. e OS E_GENIbus OS [} 30] Operation display (GET/SET/INFO). i Entry Count INT Number of data points (ID codes) used within the APDU. arr Entry ARRAY OF Contents of the data points (ID codes). ST_GENIbus Reply Data Entr y [} 37] s ASCIIString STRING String evaluation for data class 7. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.18 ST_GENIbus Reply Data Entry Contents of an element of a response APDU: value and information. TYPE ST_GENIbus Reply Data Entry : STRUCT by Value : BYTE; by Info Head : BYTE; by Unit Index : BYTE; by Zero H : BYTE; by Range Zero L : BYTE; END_STRUCT END_TYPE Name Type Description by Value BYTE Raw value. by Info Head BYTE Information head containing among other things the scaling information. by Unit Index BYTE Sign and unit code by Zero H BYTE Zero point in the case of normal range zero-point scaling OR high-byte zero point in the case of extended scaling. TE1000 Version: 1.6.0 37
## Page 38

Programming Name Type Description by Range Zero L BYTE Range in the case of normal range zero-point scaling OR low-byte zero point in the case of extended scaling. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.19 ST_GENIbus Request Class Entry Command or query structure containing the data of a request APDU for processing within the library. TYPE ST_GENIbus Request Class Entry : STRUCT by Class : BYTE; e OS : E_GENIbus OS; by Entry Count : BYTE; arr Entry : ARRAY[0.. GENIBUS_MAX_APDU_LENGTH] OF ST_GENIbus Request Data Entry; END_STRUCT END_TYPE Name Type Description by Class BYTE Data class e OS E_GENIbus OS [} 30] Operation display (GET/SET/INFO) by Entry Count BYTE Number of data points (ID codes) used within the APDU. arr Entry ARRAY OF Field with addresses of the data points (ID codes) and, if ST_GENIbus Request Data E applicable, the values to be written. ntry [} 38] Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.20 ST_GENIbus Request Data Entry Address and, if applicable, the value to be written within a request APDU. TYPE ST_GENIbus Request Data Entry : STRUCT by IDCode : BYTE; by Value : BYTE; END_STRUCT END_TYPE Name Type Description by IDCode BYTE Address by Value BYTE Value to be written Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.21 ST_GENIbus Response Table Response buffer. TYPE ST_GENIbus Response Table : STRUCT arr Response Table Item : ARRAY[1.. GENIBUS_COMMAND_BUFFER_ENTRIES] OF ST_GENIbus Response Tab 38 Version: 1.6.0 TE1000
## Page 39

Programming le Item; by Response Table Counter : BYTE; by Response Table Max Counter : BYTE; ui Response Table Overflow Counter : UINT; b Lock Semaphore : BOOL; END_STRUCT END_TYPE Name Type Description arr Response Table It ARRAY OF Response buffer em ST_GENIbus Response Tabl e Item [} 39] by Response Table C BYTE Current buffer demand ounter by Response Table M BYTE Maximum buffer demand ax Counter ui Response Table Ov UINT Number of buffer overflows erflow Counter b Lock Semaphore BOOL Write protection during the processing of a command. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.2.2.22 ST_GENIbus Response Table Item Individual element in the response buffer. TYPE ST_GENIbus Response Table Item : STRUCT by Addr : BYTE; by Length : BYTE; e SD : E_GENIbus SD; arr APDUs : ARRAY[1.. GENIBUS_MAX_APDU_NUMBER] OF ST_GENIbus Reply Class Entry; by RFS : BYTE; udi Message Handle : UDINT; udi Error Id : UDINT; END_STRUCT END_TYPE Name Type Description by Addr BYTE Device destination address e Addr Type BYTE Single, multiple or collective command e SD E_GENIbus SD [} 30] Start delimiter of the telegram. arr APDUs ARRAY OF Collection of the APDUs (Application Program Data Units) ST_GENIbus Reply Class Entr to be transmitted. y [} 37] by RFS BYTE Not yet used: "Request from slave". udi Message Handle UDINT Pointer to the current buffer element. udi Error Id UDINT If an error has occurred in the function block FB_GENIbus Communication(), the corresponding error code will be saved here for further evaluation. Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 TE1000 Version: 1.6.0 39
## Page 40

Programming 4.2.2.23 ST_GENIbus Ser Com Buffer Serial communication buffer – for transmission and reception alike. TYPE ST_GENIbus Ser Com Buffer : STRUCT arr Buffer : ARRAY[0.. GENIBUS_MAX_TELEGRAM_LENGTH] OF BYTE; ui Data Length : UINT; b Blocked : BOOL; END_STRUCT END_TYPE Requirements Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_GENIbus from v3.3.0.0 4.3 Integration into Twin CAT 4.3.1 KL6041 with CX5120 The program illustrates the application of the individual function blocks, based on 5 samples. The communication runs via a K-bus terminal. Sample: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_genibus/Resources/6190631563.zip The Twin CAT project is available for download as *.zip file. This must first be unpacked locally so that the archive (*.tnzip file) is available for import into the Twin CAT project. Hardware Setting up the components • 1x CX5120 Embedded PC • 1x KL1408 four-channel digital input terminal for the execution of the individual tests. • 1x KL6041 serial RS485 terminal • 1x KL9010 end terminal Configure the hardware as described in the corresponding documentation. Software Creation of the PLC program The respective test program section can be selected by setting the i Test variable in the MAIN program to values from 1 to 5. 40 Version: 1.6.0 TE1000
## Page 41

Programming The respective program parts contain pre-configured function blocks, which you can address through the test inputs b1 to b8: VAR_GLOBAL b1 AT %I* : BOOL; b2 AT %I* : BOOL; b3 AT %I* : BOOL; b4 AT %I* : BOOL; b5 AT %I* : BOOL; b6 AT %I* : BOOL; b7 AT %I* : BOOL; b8 AT %I* : BOOL; st In Data AT %I* : ST_GENIbus In Data; st Out Data AT %Q* : ST_GENIbus Out Data; st Command Buffer : ST_GENIbus Command Buffer; END_VAR b1..b8: Switching inputs for the test programs. st In Data: Structure with the input variables (see ST_GENIbus In Data [} 32]) for various terminal types. st Out Data: Structure with the output variables (see ST_GENIbus Out Data [} 36]) for various terminal types. st Command Buffer: Reference to the structure for communication (see ST_GENIbus Command Buffer [} 31]) with the function block FB_GENIbus Communication [} 13] I/O configuration The requirement for the linking of the process image is that the terminal is preset to 22 bytes in advance. In contrast to the PC interface, this cannot be configured in the I/O section, but only via the KS2000 software. The communication parameters • Baud Rate: 9600 bits/s • Data bits: 8 • Parity: None • Stop bits: 1 are automatically set by the PLC application, so that following the exchange of a terminal and a subsequent restart, this terminal is correctly set. TE1000 Version: 1.6.0 41
## Page 42

Programming The linking of the process image to the PLC input and output variables can be accomplished most simply from the hardware side, since multi-links are possible from there. To this end, the variables must show up in the I/O section on the right: First of all, just the status is linked with the status variable of the communication input. Note that when doing so the structure for KL communication must be selected. 42 Version: 1.6.0 TE1000
## Page 43

Programming After that the data bytes can be conveniently linked to the corresponding variables by multi-link. The selection of several variables can be achieved by clicking on “Data1” and pressing the ↓ key with the Shift key pressed. TE1000 Version: 1.6.0 43
## Page 44

Programming The output variables must be linked in the same way. 44 Version: 1.6.0 TE1000
## Page 45

Appendix 5 Appendix 5.1 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TE1000 Version: 1.6.0 45
## Page 46

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H.
## Page 47

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
