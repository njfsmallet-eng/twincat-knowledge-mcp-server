---
title: "TwinCAT_3_PLC_Lib_Tc2_EtherCAT_EN"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "ETHER", "EtherCAT", "LIB", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.9.3"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_EtherCAT_EN.pdf"
release_date: "2025-08-27"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc2_Ether CAT 2025-08-27 | Version: 1.9.3
## Page 3

Table of Contents Table of Contents 1 Foreword.................................................................................................................................................... 7 1.1 Notes on the documentation............................................................................................................. 7 1.2 For your safety.................................................................................................................................. 7 1.3 Notes on information security............................................................................................................ 9 2 Overview.................................................................................................................................................. 10 3 Ether CAT Commands............................................................................................................................. 11 3.1 FB_Ec Physical Read Cmd................................................................................................................ 11 3.2 FB_Ec Physical Write Cmd................................................................................................................ 13 3.3 FB_Ec Logical Read Cmd.................................................................................................................. 15 3.4 FB_Ec Logical Write Cmd.................................................................................................................. 16 4 Ether CAT Diagnostic.............................................................................................................................. 18 4.1 FB_Ec Get All Masters....................................................................................................................... 18 4.2 FB_Ec Get All Slave Abnormal State Changes.................................................................................... 19 4.3 FB_Ec Get All Slave Addr................................................................................................................... 20 4.4 FB_Ec Get All Slave Crc Errors........................................................................................................... 21 4.5 FB_Ec Get All Slave Present State Changes....................................................................................... 23 4.6 FB_Ec Get All Sync Unit Slave Addr..................................................................................................... 24 4.7 FB_Ec Get Conf Slaves..................................................................................................................... 25 4.8 FB_Ec Get Last Prot Err Info............................................................................................................... 26 4.9 FB_Ec Get Master Dev State.............................................................................................................. 27 4.10 FB_Ec Get Scanned Slaves............................................................................................................... 28 4.11 FB_Ec Get Slave Count..................................................................................................................... 29 4.12 FB_Ec Get Slave Crc Error................................................................................................................. 30 4.13 FB_Ec Get Slave Crc Error Ex............................................................................................................. 31 4.14 FB_Ec Get Slave Identity................................................................................................................... 32 4.15 FB_Ec Get Slave Topology Info.......................................................................................................... 33 4.16 FB_Ec Master Frame Count.............................................................................................................. 34 4.17 FB_Ec Master Frame Statistic........................................................................................................... 35 4.18 FB_Ec Master Frame Statistic Clear CRC........................................................................................... 36 4.19 FB_Ec Master Frame Statistic Clear Frames....................................................................................... 37 4.20 FB_Ec Master Frame Statistic Clear Tx Rx Err...................................................................................... 38 4.21 F_Check Vendor Id........................................................................................................................... 39 4.22 F_Ec Get Linked Task Of Sync Unit..................................................................................................... 39 4.23 F_Ec Get Sync Unit Name.................................................................................................................. 40 5 Ether CAT State Machine........................................................................................................................ 42 5.1 FB_Ec Get All Slave States................................................................................................................ 42 5.2 FB_Ec Get Master State.................................................................................................................... 43 5.3 FB_Ec Get Slave State...................................................................................................................... 44 5.4 FB_Ec Req Master State................................................................................................................... 45 5.5 FB_Ec Req Slave State..................................................................................................................... 47 5.6 FB_Ec Set Master State..................................................................................................................... 48 5.7 FB_Ec Set Slave State....................................................................................................................... 49 6 ADS Interface........................................................................................................................................... 52 TE1000 Version: 1.9.3 3
## Page 4

Table of Contents 6.1 FB_Ec Read BIC............................................................................................................................... 52 6.2 FB_Ec Read BTN.............................................................................................................................. 53 7 Co E interface........................................................................................................................................... 55 7.1 FB_Ec Coe Sdo Read........................................................................................................................ 55 7.2 FB_Ec Coe Sdo Read Ex.................................................................................................................... 56 7.3 FB_Ec Coe Sdo Write........................................................................................................................ 57 7.4 FB_Ec Coe Sdo Write Ex.................................................................................................................... 59 7.5 FB_Co ERead_By Drive Ref.............................................................................................................. 60 7.6 FB_Co EWrite_By Drive Ref.............................................................................................................. 62 7.7 FB_Ec Coe Read BIC........................................................................................................................ 63 7.8 FB_Ec Coe Read BTN....................................................................................................................... 65 7.9 FB_Ec Co ESdo Abort Code............................................................................................................... 66 8 Fo E interface........................................................................................................................................... 68 8.1 FB_Ec Foe Access............................................................................................................................ 68 8.2 FB_Ec Foe Close.............................................................................................................................. 69 8.3 FB_Ec Foe Load............................................................................................................................... 70 8.4 FB_Ec Foe Open.............................................................................................................................. 71 8.5 FB_Ec Foe Read File......................................................................................................................... 73 8.6 FB_Ec Foe Write File......................................................................................................................... 75 9 So E interface........................................................................................................................................... 77 9.1 FB_Ec Soe Read.............................................................................................................................. 77 9.2 FB_Ec Soe Write............................................................................................................................... 79 9.3 FB_So ERead_By Drive Ref.............................................................................................................. 81 9.4 FB_So EWrite_By Drive Ref.............................................................................................................. 82 10 Conversion Functions............................................................................................................................ 84 10.1 F_Conv BK1120Coupler State To String............................................................................................ 84 10.2 F_Conv Master Dev State To String.................................................................................................... 84 10.3 F_Conv Product Code To String......................................................................................................... 85 10.4 F_Conv Slave State To String............................................................................................................. 85 10.5 F_Conv Slave State To Bits................................................................................................................ 86 10.6 F_Conv Slave State To Bits Ex............................................................................................................ 86 10.7 F_Conv State To String...................................................................................................................... 87 11 Distributed Clocks.................................................................................................................................. 88 11.1 DCTIME32...................................................................................................................................... 88 11.1.1 Convert Dc Time To Pos...................................................................................................... 88 11.1.2 Convert Pos To Dc Time...................................................................................................... 89 11.1.3 Convert Dc Time To Path Pos.............................................................................................. 90 11.1.4 Convert Path Pos To Dc Time.............................................................................................. 91 11.2 DCTIME64...................................................................................................................................... 92 11.2.1 DCTIME_TO_DCTIME64................................................................................................. 92 11.2.2 DCTIME64_TO_DCTIME................................................................................................. 92 11.2.3 DCTIME64_TO_DCTIMESTRUCT.................................................................................. 93 11.2.4 DCTIME64_TO_FILETIME64.......................................................................................... 93 11.2.5 DCTIME64_TO_STRING................................................................................................. 94 11.2.6 DCTIME64_TO_SYSTEMTIME....................................................................................... 95 4 Version: 1.9.3 TE1000
## Page 5

Table of Contents 11.2.7 DCTIMESTRUCT_TO_DCTIME64.................................................................................. 95 11.2.8 FILETIME64_TO_DCTIME64.......................................................................................... 96 11.2.9 STRING_TO_DCTIME64................................................................................................. 96 11.2.10 SYSTEMTIME_TO_DCTIME64....................................................................................... 97 11.2.11 FB_Ec Dc Time Ctrl64........................................................................................................ 98 11.3 DCTIME64 and ULINT.................................................................................................................... 99 11.3.1 F_Conv Ext Time To Dc Time64........................................................................................... 99 11.3.2 F_Conv Tc Time To Dc Time64.......................................................................................... 100 11.3.3 F_Conv Tc Time To Ext Time64......................................................................................... 100 11.3.4 F_Get Actual Dc Time64................................................................................................... 101 11.3.5 F_Get Cur Dc Task Time64............................................................................................... 101 11.3.6 F_Get Cur Dc Tick Time64................................................................................................ 102 11.3.7 F_Get Cur Ext Time64...................................................................................................... 102 11.3.8 FB_Ec Ext Sync Calc Time Diff64....................................................................................... 103 11.3.9 FB_Ec Ext Sync Check64................................................................................................. 104 11.4 [obsolete]....................................................................................................................................... 105 11.4.1 [outdated DCTIME]........................................................................................................ 105 11.4.2 [outdated DCTIME and T_LARGE_INTEGER].............................................................. 112 11.4.3 DCTIME64_TO_FILETIME............................................................................................ 118 11.4.4 FILETIME_TO_DCTIME64............................................................................................ 119 12 [Obsolete].............................................................................................................................................. 120 12.1 F_Get Version Tc Ether CAT............................................................................................................ 120 13 Data types.............................................................................................................................................. 121 13.1 E_Ec Adressing Type...................................................................................................................... 121 13.2 E_Ec Foe Mode.............................................................................................................................. 121 13.3 E_Ec Mbx Prot Type........................................................................................................................ 121 13.4 ST_Ec Crc Error.............................................................................................................................. 121 13.5 ST_Ec Crc Error Ex.......................................................................................................................... 122 13.6 ST_Ec Last Prot Err Info................................................................................................................... 122 13.7 ST_Ec Master Statistic.................................................................................................................... 123 13.8 ST_Ec Slave Config Data................................................................................................................ 123 13.9 ST_Ec Slave Identity....................................................................................................................... 124 13.10 ST_Ec Slave Scanned Data............................................................................................................. 124 13.11 ST_Ec Slave State.......................................................................................................................... 126 13.12 ST_Ec Slave State Bits.................................................................................................................... 127 13.13 ST_Ec Slave State Bits Ex................................................................................................................ 127 13.14 ST_Ec Abort Code.......................................................................................................................... 128 13.15 ST_Port Addr................................................................................................................................. 128 13.16 ST_Topology Data Ex..................................................................................................................... 129 13.17 DCTIMESTRUCT.......................................................................................................................... 129 13.18 T_DCTIME32................................................................................................................................ 130 13.19 T_DCTIME64................................................................................................................................ 130 13.20 T_DCTIME.................................................................................................................................... 131 13.21 T_HFoe......................................................................................................................................... 131 14 Constants............................................................................................................................................... 133 TE1000 Version: 1.9.3 5
## Page 6

Table of Contents 14.1 Global constants........................................................................................................................... 133 14.2 Library version............................................................................................................................... 134 14.3 Ether CAT mailbox protocol error codes........................................................................................ 134 15 Sample................................................................................................................................................... 136 6 Version: 1.9.3 TE1000
## Page 7

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1000 Version: 1.9.3 7
## Page 8

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 8 Version: 1.9.3 TE1000
## Page 9

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.9.3 9
## Page 10

Overview 2 Overview The PLC library Tc2_Ether CAT contains function blocks for executing services or functions on an Ether CAT master device and/or its slave devices. 10 Version: 1.9.3 TE1000
## Page 11

Ether CAT Commands 3 Ether CAT Commands 3.1 FB_Ec Physical Read Cmd The function block FB_Ec Physical Read Cmd can be used to send an Ether CAT read command (FPRD, APRD, BRD) to a particular Ether CAT slave or to all Ether CAT slaves. This command can be used by the PLC to read a register or the DPRAM of the Ether CAT slave controller. Inputs VAR_INPUT s Net Id : T_Ams Net Id; adp : UINT; ado : UINT; len : UDINT; e Type : E_Ec Adressing Type := e Adressing Type_Fixed; p Dst Buf : PVOID; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) adp UINT This value determines which Ether CAT slave is to be addressed with this command. The meaning of this value depends on the addressing mode selected with e Type. (See adp value) ado UINT Physical memory (DPRAM) or register to be read. len UDINT Number of bytes to be read. e Type E_Ec Adressing Type Different Ether CAT commands are sent, depending on value of e Type. (See e Type) p Dst Buf PVOID The address (pointer) of the receive buffer. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. adp value This value determines which Ether CAT slave is to be addressed with this command. The meaning of this value depends on the addressing mode selected with e Type: TE1000 Version: 1.9.3 11
## Page 12

Ether CAT Commands e Type Description e Adressing Type_Fixed The slave is addressed by means of its configured Ether CAT address. These Ether CAT addresses can be read via the function block FB_Ec Get All Slave Addr. e Adressing Type_Auto Inc The slave is addressed based on its position in the ring. The first device has the address 0 (adp=0); adp is decremented by one for all subsequent slaves: 1. Slave adp = 0 2. Slave adp = 16#ffff (-1) 3. Slave adp = 16#fffe(-2) 4. Slave adp = 16#fffd(-3) etc. e Adressing Type_Broad CAST All slaves are addressed by this command. adp can be set to 0. e Type Different Ether CAT commands are sent, depending on value of e Type: e Type Command e Adressing Type_Fixed Configured Address Physical Read ( FPRD) e Adressing Type_Auto Inc Auto Increment Physical Read ( APRD) e Adressing Type_Broad CAST Broadcast Read ( BRD) The individual commands differ in terms of addressing mode (see adp). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; wkc : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. wkc UINT The working counter is incremented by each Ether CAT slave that has processed this command successfully. If only one Ether CAT slave was addressed by this command, this value should therefore be 1. Example of an implementation in ST: PROGRAM TEST_Physical Read Cmd VAR fb Read Cmd : FB_Ec Physical Read Cmd; b Execute : BOOL; value : UINT; adp : UINT:=16#3E9; ado : UINT:=16#1100; e Type : E_Ec Adressing Type := e Adressing Type_Fixed; s Net Id : T_Ams Net Id:='192.168.1.5.3.1'; wkc : UINT; b Error : BOOL; n Err Id : UDINT; END_VAR fb Read Cmd (s Net Id:=s Net ID, ado:=ado, adp:=adp, e Type:=e Type, LEN := SIZEOF(value), p Dst Buf:=ADR(valu e), b Execute:=b Execute); 12 Version: 1.9.3 TE1000
## Page 13

Ether CAT Commands wkc := fb Read Cmd.wkc; b Error:= fb Read Cmd.b Error; n Err Id:= fb Read Cmd.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 3.2 FB_Ec Physical Write Cmd The function block FB_Ec Physical Write Cmd can be used to send an Ether CAT write command (FPWR, APWR, BWR) to a particular Ether CAT slave or to all Ether CAT slaves. This command can be used by the PLC to write to a register or the DPRAM of the Ether CAT slave controller. Inputs VAR_INPUT s Net Id : T_Ams Net Id; adp : UINT; ado : UINT; len : UDINT; e Type : E_Ec Adressing Type := e Adressing Type_Fixed; p Src Buf : PVOID; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) adp UINT This value determines which Ether CAT slave is to be addressed with this command. The meaning of this value depends on the addressing mode selected with e Type. (See adp value) ado UINT Physical memory (DPRAM) or register to be read. len UDINT Number of bytes to be written. e Type E_Ec Adressing Type Different Ether CAT commands are sent, depending on the value of e Type: (See e Type) p Src Buf PVOID Address (pointer) of the transmit buffer. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. adp value This value determines which Ether CAT slave is to be addressed with this command. The meaning of this value depends on the addressing mode selected with e Type: TE1000 Version: 1.9.3 13
## Page 14

Ether CAT Commands e Type Description e Adressing Type_Fixed The slave is addressed by means of its configured Ether CAT address. These Ether CAT addresses can be read via the function block FB_Ec Get All Slave Addr. e Adressing Type_Auto Inc The slave is addressed based on its position in the ring. The first device has the address 0 (adp=0); adp is decremented by one for all subsequent slaves: 1. Slave adp = 0 2. Slave adp = 16#ffff (-1) 3. Slave adp = 16#fffe(-2) 4. Slave adp = 16#fffd(-3) etc. e Adressing Type_Broad CAST All slaves are addressed by this command. adp should be set to 0. e Type Different Ether CAT commands are sent, depending on the value of e Type: e Type Command e Adressing Type_Fixed Configured Address Physical Write ( FPWR) e Adressing Type_Auto Inc Auto Increment Physical Write ( APWR) e Adressing Type_Broad CAST Broadcast Write ( BWR) The individual commands differ in terms of addressing mode (see adp). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; wkc : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. wkc UINT The working counter is incremented by each Ether CAT slave that has processed this command successfully. If only one Ether CAT slave was addressed by this command, this value should therefore be 1. Example of an implementation in ST: PROGRAM Test_Physical Write Cmd VAR fb Write Cmd : FB_Ec Physical Write Cmd; b Execute : BOOL; value : UINT :=16#5555; adp : UINT:=16#3E9; ado : UINT:=16#1100; e Type : E_Ec Adressing Type := e Adressing Type_Fixed; s Net Id : T_Ams Net Id:='192.168.1.5.3.1'; wkc : UINT; b Error : BOOL; n Err Id : UDINT; END_VAR fb Write Cmd (s Net Id:=s Net ID, ado:=ado, adp:=adp, e Type:=e Type, LEN := SIZEOF(value), p Src Buf:=ADR(val ue), b Execute:=b Execute); 14 Version: 1.9.3 TE1000
## Page 15

Ether CAT Commands wkc := fb Write Cmd.wkc; b Error:= fb Write Cmd.b Error; n Err Id:= fb Write Cmd.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 3.3 FB_Ec Logical Read Cmd The master sends a logical Ether CAT read command (LRD) with the function block FB_Ec Logical Read Cmd. In each slave, local address ranges (DPRAM) can be mapped to global logical address ranges. This command therefore addresses all Ether CAT slaves, which have mapping configured for the selected logical address range. Inputs VAR_INPUT s Net Id : T_Ams Net Id; log Addr : UDINT; len : UDINT; p Dst Buf : PVOID; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) log Addr UDINT Logical address len UDINT Number of bytes to be read p Dst Buf PVOID Address (pointer) to the receive buffer b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; wkc : UINT; END_VAR TE1000 Version: 1.9.3 15
## Page 16

Ether CAT Commands Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. wkc UINT The working counter is incremented by each Ether CAT slave that has processed this command successfully. If only one Ether CAT slave was addressed by this command, this value should therefore be 1. Example of an implementation in ST: PROGRAM Test_Logical Read Cmd VAR fb Read Cmd : FB_Ec Logical Read Cmd; b Execute : BOOL; value : USINT; log Addr : UDINT :=16#10000; s Net Id : T_Ams Net Id:='192.168.1.5.3.1'; wkc : UINT; b Error : BOOL; n Err Id : UDINT; END_VAR fb Read Cmd (s Net Id:=s Net ID, log Addr:=log Addr, LEN := SIZEOF(value), p Dst Buf:=ADR(value), b Execute:=b E xecute); wkc := fb Read Cmd.wkc; b Error:= fb Read Cmd.b Error; n Err Id:= fb Read Cmd.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 3.4 FB_Ec Logical Write Cmd The master sends a logical Ether CAT write command (LWR) with the function block FB_Ec Logical Write Cmd. In each slave, local address ranges (DPRAM) can be mapped to global logical address ranges. This command therefore addresses all Ether CAT slaves, which have mapping configured for the selected logical address range. Inputs VAR_INPUT s Net Id : T_Ams Net Id; log Addr : UDINT; len : UDINT; p Src Buf : PVOID; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR 16 Version: 1.9.3 TE1000
## Page 17

Ether CAT Commands Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) log Addr UDINT Logical address len UDINT Number of bytes to be written p Src Buf PVOID Address (pointer) to the transmit buffer b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; wkc : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. wkc UINT The working counter is incremented by each Ether CAT slave that has processed this command successfully. If only one Ether CAT slave was addressed by this command, this value should therefore be 1. Example of an implementation in ST: PROGRAM Test_Logical Write Cmd VAR fb Write Cmd : FB_Ec Logical Write Cmd; b Execute : BOOL; value : USINT :=16#55; log Addr : UDINT :=16#10000; s Net Id : T_Ams Net Id:='192.168.1.5.3.1'; wkc : UINT; b Error : BOOL; n Err Id : UDINT; END_VAR fb Write Cmd (s Net Id:=s Net ID, log Addr:=log Addr, LEN := SIZEOF(value), p Src Buf:=ADR(value), b Execute:=b Execute); wkc := fb Write Cmd.wkc; b Error :=fb Write Cmd.b Error; n Err Id :=fb Write Cmd.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT TE1000 Version: 1.9.3 17
## Page 18

Ether CAT Diagnostic 4 Ether CAT Diagnostic 4.1 FB_Ec Get All Masters The function block FB_Ec Get All Masters can be used to read information from all Ether CAT masters. If the call is successful, the buffer transferred in the p Addr Buf parameter contains the information (Device ID, AMS Net ID, name) of all masters as an array of ST_Ec Device Info. If the buffer is too small for the information of all existing masters, the buffer is filled up to the specified size and the output n Masters outputs the total number of all existing masters. Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; p Addr Buf : POINTER TO ARRAY[0.. EC_MAX_DEVICES] OF ST_Ec Device Info; cb Buf Len : UDINT; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the IPC on which the Ether CAT masters are to be read. default = local host b Execute BOOL The function block is enabled by a positive edge at this input. p Addr Buf POINTER TO ARRAY Address of an array of ST_Ec Device Info, in which the [0.. EC_MAX_DEVICES] OF S information of the individual masters is to be written. T_Ec Device Info ST_Ec Device Info contains the Device ID, AMS Net ID and the name of an Ether CAT master. cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read. The size of the array of ST_Ec Device Info assigned to p Addr Buf must be specified here. t Timeout TIME Maximum time that must not be exceeded during the execution of the ADS calls. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Masters : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Example: Error 1798 (0x706) indicates a null pointer at the buffer address. n Masters UINT Number of Ether CAT masters present. 18 Version: 1.9.3 TE1000
## Page 19

Ether CAT Diagnostic Prerequisites Development environment Target platform PLC libraries to include Twin CAT >= v3.1.4024.62 PC or CX (x86, x64, Arm®) Tc2_Ether CAT >= v3.6.1.0 4.2 FB_Ec Get All Slave Abnormal State Changes The function block FB_Ec Get All Slave Abnormal State Changes can be used to read the unexpected Ether CAT state changes of all the slaves connected to the master. If the call is successful, the buffer transferred in the parameter p Buf Addr contains the number of unexpected state changes of all slaves as an array of UDINTs. Ether CAT state changes are unexpected if they were not requested by the Ether CAT master, e.g. if an Ether CAT slave spontaneously switches from OP state to SAFEOP state. Inputs VAR_INPUT s Net Id : T_Ams Net Id; (*Ams Net Id of the Ether CAT master device*) p Addr Buf : POINTER TO ARRAY [0.. EC_MAX_SLAVES] OF UDINT; (*Contains the address of the buffer the counters for the state changes f.i. Op to Safe Op- Err are copied to.*) cb Buf Len : UDINT; (*Size of the buffer p Addr Buf. The size of the buffer must be at least n S lave *4 Bytes *) b Execute : BOOL; (*Function Block execution is triggered by a rising edge at this input*) t Timeout : TIME; (*States the time before the function is cancelled.*) END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) p Addr Buf POINTER TO ARRAY Address of an array of UDINTs, into which the number of [0.. EC_MAX_SLAVES] OF U unexpected state changes of the individual slaves is to be DINT written. cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; END_VAR TE1000 Version: 1.9.3 19
## Page 20

Ether CAT Diagnostic Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Error 1798 (0x706) indicates a null pointer at the buffer address. Error 1797 (0x705) indicates inadequate buffer size. n Slaves UINT The number of slaves connected to the master. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.3 FB_Ec Get All Slave Addr The FB_Ec Get All Slave Addr function block allows the addresses of all the slaves connected to the master to be read. When the call is successful, the buffer passed in the parameter p Addr Buf contains the addresses of all the slaves as an array of UINTs. Inputs VAR_INPUT s Net Id : T_Ams Net Id; p Addr Buf : POINTER TO ARRAY[0.. EC_MAX_SLAVES] OF UINT; cb Buf Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) p Addr Buf POINTER TO ARRAY Address of an array of UINTs into which the addresses of [0.. EC_MAX_SLAVES] OF UI the individual slaves are to be written. NT cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; END_VAR 20 Version: 1.9.3 TE1000
## Page 21

Ether CAT Diagnostic Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Error 1798 (0x706) indicates a null pointer at the buffer address. Error 1797 (0x705) indicates inadequate buffer size. n Slaves UINT The number of slaves connected to the master. Example of an implementation in ST: PROGRAM TEST_Get All Slave Addresses VAR fb Get All Slave Addr : FB_Ec Get All Slave Addr; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL; slave Addresses : ARRAY[0..255] OF UINT; n Slaves : UINT := 0; b Error : BOOL; n Err Id : UDINT; END_VAR fb Get All Slave Addr(s Net Id:= s Net Id,p Addr Buf := ADR(slave Addresses), cb Buf Len:= SIZEOF(slave Addresses) , b Execute:=b Execute); n Slaves := fb Get All Slave Addr.n Slaves; b Error := fb Get All Slave Addr.b Error; n Err Id := fb Get All Slave Addr.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.4 FB_Ec Get All Slave Crc Errors The FB_Ec Get All Slave Crc Errors function block allows the CRC error counters of all the slaves connected to the master to be read. The CRC errors at the individual ports of a slave are added. In order to read the CRC errors of the individual ports (A, B and C) of a slave, it is necessary to call the FB_Ec Get Slave Crc Error [} 30] function block. In order to read the CRC errors of the individual ports (A, B, C and D) of a slave, it is necessary to call the FB_Ec Get Slave Crc Error Ex [} 31] function block. Inputs VAR_INPUT s Net Id : T_Ams Net Id; p Crc Error Buf : POINTER TO ARRAY[0.. EC_MAX_SLAVES] OF DWORD; cb Buf Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TE1000 Version: 1.9.3 21
## Page 22

Ether CAT Diagnostic Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) p Crc Error Buf POINTER TO ARRAY The address of an array of DWORDs into which the CRC [0.. EC_MAX_SLAVES] OF D error counter is to be written. WORD cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Error 1798 (0x706) indicates a null pointer at the buffer address. Error 1797 (0x705) indicates inadequate buffer size. n Slaves UINT The number of slaves connected to the master. Example of an implementation in ST: PROGRAM TEST_Get All Slave Crc Errors VAR fb Get All Slave Crc Errors : FB_Ec Get All Slave Crc Errors; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL; crc Errors : ARRAY[0..255] OF DWORD; n Slaves : UINT := 0; b Error : BOOL; n Err Id : UDINT; END_VAR fb Get All Slave Crc Errors(s Net Id:= s Net Id, p Crc Error Buf := ADR(crc Errors), cb Buf Len:= SIZEOF(crc Errors) , b Execute:=b Execute); n Slaves := fb Get All Slave Crc Errors.n Slaves; b Error := fb Get All Slave Crc Errors.b Error; n Err Id := fb Get All Slave Crc Errors.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 22 Version: 1.9.3 TE1000
## Page 23

Ether CAT Diagnostic 4.5 FB_Ec Get All Slave Present State Changes The function block FB_Ec Get All Slave Present State Changes can be used to read the Ether CAT state changes from state “slave is present” to “INIT_NO_COMM” of all slaves connected to the master. If the call is successful, the buffer transferred in the parameter p Buf Addr contains the number of state changes of all slaves as an array of UDINTs. The Ether CAT state change from state “slave is present” to “INIT_NO_COMM” means that the connection to the slave has been interrupted. For example by disconnecting the Ether CAT cable. Inputs VAR_INPUT s Net Id : T_Ams Net Id; (*Ams Net Id of the Ether CAT master device*) p Addr Buf : POINTER TO ARRAY [0.. EC_MAX_SLAVES] OF UDINT; (*Contains the address of the buffer the counters for the state changes from Present to INIT_NO_COMM are copied to.*) cb Buf Len : UDINT; (*Size of the buffer p Addr Buf. The size of the buffer must be at least n Slav e *4 Bytes *) b Execute : BOOL; (*Function Block execution is triggered by a rising edge at this input*) t Timeout : TIME; (*States the time before the function is cancelled.*) END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) p Addr Buf POINTER TO ARRAY Address of an array of UDINTs, into which the number of [0.. EC_MAX_SLAVES]OF UD state changes from "slave is present" to INIT_NO_COMM INT for the individual slaves is to be written. b Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Error 1798 (0x706) indicates a null pointer at the buffer address. Error 1797 (0x705) indicates inadequate buffer size. n Slaves UINT The number of slaves connected to the master. TE1000 Version: 1.9.3 23
## Page 24

Ether CAT Diagnostic Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.6 FB_Ec Get All Sync Unit Slave Addr The FB_Ec Get All Sync Unit Slave Addr function block allows the addresses of all the slaves connected to the master to be read. When the call is successful, the buffer passed in the parameter p Addr Buf contains the addresses of all the slaves as an array of UINTs. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Object Id : OTCID; p Addr Buf : POINTER TO ARRAY[0.. EC_MAX_SLAVES] OF UINT; cb Buf Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id The network address of the Twin CAT computer on which the function block is to be executed can be specified here. An empty string may be specified for the local computer. n Object Id OTCID Object Id of the Sync Unit to be used, see Sync Unit p Addr Buf POINTER TO ARRAY Address of an array of UINTs into which the addresses of [0.. EC_MAX_SLAVES] OF UI the individual slaves are to be written. NT cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read. b Execute BOOL The function block is enabled by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; END_VAR 24 Version: 1.9.3 TE1000
## Page 25

Ether CAT Diagnostic Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Error 1798 (0x706) indicates a null pointer at the buffer address. Error 1797 (0x705) indicates inadequate buffer size. n Slaves UINT The number of slaves connected to the master. Requirements Development Environment Target platform PLC libraries to include Twin CAT v3.2.4024.14 PC or CX (x86, x64, Arm®) Tc2_Ether CAT >= 3.3.17.0 4.7 FB_Ec Get Conf Slaves The function block FB_Ec Get Conf Slaves can be used to read a list of configured slaves from the Ether CAT master object directory. Inputs VAR_INPUT s Net Id : T_Ams Net Id; p Arr Ec Conf Slave Info : POINTER TO ARRAY[0.. EC_MAX_SLAVES] OF ST_Ec Slave Config Data; cb Buf Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) p Arr Ec Conf POINTER TO ARRAY Address of an array of structures of type Slave Info [0.. EC_MAX_SLAVES] OF ST_ ST_Ec Slave Config Data [} 123], into which data of each Ec Slave Config Data configured slave are to be written. cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; END_VAR TE1000 Version: 1.9.3 25
## Page 26

Ether CAT Diagnostic Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Error 1798 (0x706) indicates a null pointer at the buffer address. Error 1797 (0x705) indicates inadequate buffer size. n Slaves UINT Returns the number of configured slaves. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.8 FB_Ec Get Last Prot Err Info The function block FB_Ec Get Last Prot Err Info can be used to read additional error information relating to the most recent mailbox protocol error. An error-free mailbox command resets the last error every time. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; e Protocol : E_Ec Mbx Prot Type := e Ec Mbx Prot_Fo E; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave, whose error information is to be read. e Protocol E_Ec Mbx Prot Type Ether CAT mailbox protocol type [} 121] b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; info : ST_Ec Last Prot Err Info; END_VAR 26 Version: 1.9.3 TE1000
## Page 27

Ether CAT Diagnostic Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. info ST_Ec Last Prot Err Structure with additional error information [} 122] Info Sample in ST: A rising edge at b Get triggers reading of additional error information relating to the most recent mailbox protocol error. PROGRAM MAIN VAR fb Get Info : FB_Ec Get Last Prot Err Info := ( s Net ID := '172.16.6.195.2.1', n Slave Addr := 1004, e Protocol := e Ec Mbx Prot_Fo E, t Timeout := DEFAULT_ADS_TIMEOUT ); b Get : BOOL; b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; s Info : T_Max String; END_VAR fb Get Info( b Execute:= b Get, b Busy=>b Busy, b Error=>b Error, n Err Id=>n Err Id ); s Info := BYTEARR_TO_MAXSTRING( fb Get Info.info.bin Desc ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.9 FB_Ec Get Master Dev State The function block FB_Ec Get Master Dev State can be used to read the current state of the Ether CAT master. Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TE1000 Version: 1.9.3 27
## Page 28

Ether CAT Diagnostic Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Dev State : WORD; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. n Dev State WORD Current state of the master device Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.10 FB_Ec Get Scanned Slaves The function block FB_Ec Get Scanned Slaves can be used to read a list of the currently available (scanned) slaves from the Ether CAT master object directory. To this end an online scan is executed, during which the EEPROMs of the Ether CAT slaves are read. The scanning process may take some time, depending on the number of connected slaves. Inputs VAR_INPUT b Execute : BOOL; s Net Id : T_Ams Net Id; p Arr Ec Scanned Slave Info : POINTER TO ARRAY[0.. EC_MAX_SLAVES] OF ST_Ec Slave Scanned Data; cb Buf Len : UDINT; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR 28 Version: 1.9.3 TE1000
## Page 29

Ether CAT Diagnostic Name Type Description b Execute BOOL The function block is activated by a positive edge at this input. s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) p Arr Ec Scanned Slav POINTER TO ARRAY[0.. E Address of an array of structures of type e Info C_MAX_SLAVES] OF ST_ ST_Ec Slave Scanned Data [} 124], to which the data for Ec Slave Scanned Data each scanned slave are to be written. cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; ND_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Error 1798 (0x706) indicates a null pointer at the buffer address. Error 1797 (0x705) indicates inadequate buffer size. n Slaves UINT Returns the number of scanned slaves. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.11 FB_Ec Get Slave Count The function block FB_Ec Get Slave Count can be used to determine the number of slaves that are connected to the master. Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TE1000 Version: 1.9.3 29
## Page 30

Ether CAT Diagnostic Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. n Slaves UINT The number of slaves connected to the master Example of an implementation in ST: PROGRAM TEST_Get Slave Count VAR fb Get Slave Count : FB_Ec Get Slave Count; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL; n Slaves : UINT; b Error : BOOL; n Err Id : UDINT; END_VAR fb Get Slave Count(s Net Id:= s Net Id, b Execute:=b Execute); n Slaves := fb Get Slave Count.n Slaves; b Error := fb Get Slave Count.b Error; n Err Id := fb Get Slave Count.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.12 FB_Ec Get Slave Crc Error The function block FB_Ec Get Slave Crc Error allows the CRC error counters of the individual ports (A, B and C) of a slave to be read. If the call is successful, the output variable crc Error, whose type is ST_Ec Crc Error, contains the requested CRC error counter. The function block FB_Ec Get Slave Crc Error can only be used with slaves with up to 3 ports (e.g. EK1100). The function block FB_Ec Get Slave Crc Error Ex can also be used with slaves with up to 4 ports (e.g. EK1122). 30 Version: 1.9.3 TE1000
## Page 31

Ether CAT Diagnostic Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave whose CRC error counter is to be read. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; crc Error : ST_Ec Crc Error; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. crc Error ST_Ec Crc Error CRC error [} 121] counters for the individual ports Example of an implementation in ST: PROGRAM TEST_Get Slave Crc Error VAR fb Get Slave Crc Error : FB_Ec Get Slave Crc Error; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL; crc Error : ST_Ec Crc Error; n Slave Addr : UINT := 1001; b Error : BOOL; n Err Id : UDINT; END_VAR fb Get Slave Crc Error(s Net Id:= s Net Id, n Slave Addr:= n Slave Addr, b Execute:=b Execute); crc Error := fb Get Slave Crc Error.crc Error; b Error := fb Get Slave Crc Error.b Error; n Err Id := fb Get Slave Crc Error.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.13 FB_Ec Get Slave Crc Error Ex TE1000 Version: 1.9.3 31
## Page 32

Ether CAT Diagnostic The function block FB_Ec Get Slave Crc Error Ex allows the CRC error counters of the individual ports (A, D, B and C) of a slave to be read. If the call is successful, the output variable crc Error, whose type is ST_Ec Crc Error Ex, contains the requested CRC error counter. The function block FB_Ec Get Slave Crc Error Ex can also be used with slaves with up to 4 ports (e.g. EK1122). The function block FB_Ec Get Slave Crc Error can only be used with slaves with up to 3 ports (e.g. EK1100). Inputs VAR_INPUT s Net Id : T_Ams Net Id; (*Ams Net Id of the Ether CAT master device*) n Slave Addr : UINT; (*Address of the slave device*) b Execute : BOOL; (*Function block execution is triggered by a rising edge at this input.*) t Timeout : TIME; (*States the time before the function is cancelled.*) END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device (type: T_Ams Net Id). n Slave Addr UINT Fixed address of the Ether CAT slaves whose CRC error counter is to be read. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; Crc Error : ST_Ec Crc Error Ex; (*Crc error of the Ether CAT slave device*) END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Crc Error ST_Ec Crc Error Ex CRC error counter of the individual ports (type: ST_Ec Crc Error Ex [} 122]) Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.14 FB_Ec Get Slave Identity The function block FB_Ec Get Slave Identity can be used to read the CANopen identity of an individual Ether CAT slave device. If the call is successful, the output variable identity, whose type is ST_Ec Slave Identity, contains the requested identity information. 32 Version: 1.9.3 TE1000
## Page 33

Ether CAT Diagnostic Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; identity : ST_Ec Slave Identity; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. identity ST_Ec Slave Identity CANopen Identity [} 124] of the Ether CAT device Example of an implementation in ST: PROGRAM TEST_Get Slave Identity VAR fb Get Slave Identity : FB_Ec Get Slave Identity; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL; identity : ST_Ec Slave Identity; n Slave Addr : UINT := 1001; b Error : BOOL; n Err Id : UDINT; END_VAR fb Get Slave Identity(s Net Id:= s Net Id, n Slave Addr:= n Slave Addr, b Execute:=b Execute); identity := fb Get Slave Identity.identity; b Error := fb Get Slave Identity.b Error; n Err Id := fb Get Slave Identity.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.15 FB_Ec Get Slave Topology Info The function block FB_Ec Get Slave Topolgy Info can be used to determine topology information. TE1000 Version: 1.9.3 33
## Page 34

Ether CAT Diagnostic Inputs VAR_INPUT s Net Id : T_Ams Net Id; (*Ams Net Id of the Ether CAT master device*) p Addr Buf : POINTER TO ARRAY [0.. EC_MAX_SLAVES] OF ST_Topology Data Ex; (*Contains the address of the buffer the topology data are copied to.*) cb Buf Len : UDINT; (*Size of the buffer p Addr Buf. The size of the buffer must be at least n Slav e * 64 Bytes*) b Execute : BOOL; (*Function block execution is triggered by a rising edge at this input*) t Timeout : TIME; (*States the time before the function is cancelled*) END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) p Addr Buf POINTER TO ARRAY Address of an array of structures of type [0.. EC_MAX_SLAVES] OF ST ST_Topology Data Ex [} 129], which contains the topology _Topology Data Ex data. cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Error 1798 (0x706) indicates a null pointer at the buffer address. Error 1797 (0x705) indicates inadequate buffer size. n Slaves UINT The number of slaves connected to the master. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.16 FB_Ec Master Frame Count The function block FB_Ec Master Frame Count can be used to determine the number of Ether CAT frames configured in the master. 34 Version: 1.9.3 TE1000
## Page 35

Ether CAT Diagnostic Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Frames : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. n Frames UDINT Number of Ether CAT frames Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.17 FB_Ec Master Frame Statistic The function block FB_Ec Master Frame Statistic can be used to read the frame statistics of the Ether CAT master. A distinction is made between cyclic and acyclic (queued) frames. Acyclic frames are used for the initialization or for parameter access to Ether CAT slaves. Frames are regarded as lost if they fail to return to the master or are invalid. The number of lost frames (i.e. lost or invalid cyclic frames), the number of cyclic frames per second, the number of lost queued frames (i.e. lost or invalid acyclic frames) and the number of queued frames per second is provided at the function block output. TE1000 Version: 1.9.3 35
## Page 36

Ether CAT Diagnostic Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Lost Frames : UDINT; f Frames Per Second : LREAL; n Lost Queued Frames : UDINT; f Queued Frames Per Second : LREAL; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. n Lost Frames UDINT Returns the current number of lost or invalid cyclic frames. f Frames Per LREAL Returns the current number of cyclic frames per second. Second n Lost Queued Fra UDINT Returns the current number of lost or invalid queued mes (acyclic) frames. f Queued Frames P LREAL Returns the current number of queued (acyclic) frames er Second per second. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.18 FB_Ec Master Frame Statistic Clear CRC The function block FB_Ec Master Frame Statistic Clear CRC can be used to delete the CRC error counters of all Ether CAT slaves. 36 Version: 1.9.3 TE1000
## Page 37

Ether CAT Diagnostic Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.19 FB_Ec Master Frame Statistic Clear Frames The function block FB_Ec Master Frame Statistic Clear Frames can be used to delete the lost frame counters. Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TE1000 Version: 1.9.3 37
## Page 38

Ether CAT Diagnostic Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.20 FB_Ec Master Frame Statistic Clear Tx Rx Err The function block FB_Ec Master Frame Statistic Clear Tx Rx Err can be used to delete the error counters of the miniport driver of the network card. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Ec Master Dev ID : INT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the CPU (PC). (Type: T_AMSNet Id) n Ec Master Dev ID INT Device ID of the Ether CAT master. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. 38 Version: 1.9.3 TE1000
## Page 39

Ether CAT Diagnostic Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.21 F_Check Vendor Id The function F_Check Vendor Id returns TRUE if the Vendor ID is Beckhoff, otherwise it returns FALSE. Return value METHOD F_Check Vendor Id : BOOL Name Type Description F_Check Vendor Id BOOL TRUE if the Vendor ID is Beckhoff, otherwise FALSE. Inputs VAR_INPUT st Slave Identity : ST_Ec Slave Identity; END_VAR Name Type Description st Slave Identity ST_Ec Slave Identity Slave Identity, which can be read with FB_Ec Get Slave Identity [} 32]. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 4.22 F_Ec Get Linked Task Of Sync Unit TE1000 Version: 1.9.3 39
## Page 40

Ether CAT Diagnostic The name and object ID of the linked task of an Ether CAT Sync Unit can be read with this function. The return value of the function signals whether the call was successful and outputs the corresponding error code in case of an error. Return value METHOD F_Ec Get Linked Task Of Sync Unit : HRESULT Name Type Description F_Ec Get Linked Task HRESULT Signals whether the call was successful and outputs the corresponding Of Sync Unit error code in the event of an error. Inputs VAR_INPUT oid Sync Unit : OTCID; // object ID of sync unit END_VAR Name Type Description oid Sync Unit OTCID The object ID of the Sync Unit is specified at this input. This can be found in the process image of the Ether CAT master. Outputs VAR_OUTPUT s Linked Task : STRING; oid Linked Task : OTCID; // object ID of linked task END_VAR Name Type Description s Linked Task STRING Returns the name of the linked task. oid Linked Task OTCID Returns the object ID of the linked task. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.22 PC or CX (x86, x64, Arm®) Tc2_Ether CAT >= 3.3.17.0 4.23 F_Ec Get Sync Unit Name The name of an Ether CAT Sync Unit can be read via its object ID using this function. The return value of the function signals whether the call was successful and outputs the relevant error code in the event of an error. Return value METHOD F_Ec Get Sync Unit Name : HRESULT Name Type Description F_Ec Get Sync Unit Na HRESULT Signals whether the call was successful and outputs the relevant error me code in the event of an error. Inputs VAR_INPUT oid Sync Unit : OTCID; // object ID of sync unit END_VAR 40 Version: 1.9.3 TE1000
## Page 41

Ether CAT Diagnostic Name Type Description oid Sync Unit OTCID The object ID of the Sync Unit is specified at this input. This can be found in the process image of the Ether CAT master. Outputs VAR_OUTPUT s Sync Unit Name : STRING(63); END_VAR Name Type Description s Sync Unit Name STRING Returns the name of the sync unit. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.48 PC or CX (x86, x64, Arm®) Tc2_Ether CAT >= 3.4.2.0 TE1000 Version: 1.9.3 41
## Page 42

Ether CAT State Machine 5 Ether CAT State Machine 5.1 FB_Ec Get All Slave States The FB_Ec Get All Slave States function block allows the Ether CAT status and the Link status of all the slaves connected to the master to be read. When the call is successful, the buffer passed in the parameter p State Buf contains the requested status information as an array of ST_Ec Slave State. Inputs VAR_INPUT s Net Id : T_Ams Net Id; p State Buf : POINTER TO ARRAY[0.. EC_MAX_SLAVES] OF ST_Ec Slave State; cb Buf Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) p State Buf POINTER TO ARRAY[0.. E The address of an array of ST_Ec Slave States [} 126] into which C_MAX_SLAVES] OF ST_ the slave states are to be written. Ec Slave State cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Slaves : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Error 1798 (0x706) indicates a null pointer at the buffer address. Error 1797 (0x705) indicates inadequate buffer size. n Slaves UINT The number of slaves connected to the master Example of an implementation in ST: PROGRAM TEST_Get All Slave States VAR fb Get All Slave States : FB_Ec Get All Slave States; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL; dev States : ARRAY[0..255] OF ST_Ec Slave State; 42 Version: 1.9.3 TE1000
## Page 43

Ether CAT State Machine n Slaves : UINT := 0; b Error : BOOL; n Err Id : UDINT; END_VAR fb Get All Slave States(s Net Id:= s Net Id, p State Buf := ADR(dev States), cb Buf Len:=SIZEOF(dev States), b Exec ute:=b Execute); n Slaves := fb Get All Slave States.n Slaves; b Error := fb Get All Slave States.b Error; n Err Id := fb Get All Slave States.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 5.2 FB_Ec Get Master State The function block FB_Ec Get Master State can be used to read the Ether CAT state of the master. If the call is successful, the State output variable of type WORD contains the requested status information. Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; state : WORD; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. state WORD Current Ether CAT state of the master. (See State) state Current Ether CAT state of the master. The possible values are: TE1000 Version: 1.9.3 43
## Page 44

Ether CAT State Machine Constant Value Description EC_DEVICE_STATE_INIT 0x01 Master is in Init state EC_DEVICE_STATE_PREOP 0x02 Master is in Pre-operational state EC_DEVICE_STATE_SAFEOP 0x04 Master is Safe-operational state EC_DEVICE_STATE_OP 0x08 Master is Operational state Example of an implementation in ST: PROGRAM TEST_Get Master State VAR fb Get Master State : FB_Ec Get Master State; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL; state : WORD; b Error : BOOL; n Err Id : UDINT; END_VAR fb Get Master State(s Net Id:= s Net Id, b Execute:=b Execute); state := fb Get Master State.state; b Error := fb Get Master State.b Error; n Err Id := fb Get Master State.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 5.3 FB_Ec Get Slave State The function block FB_Ec Get Slave State allows the Ether CAT status and the Link status of an individual Ether CAT slave to be read. If the call is successful, the output variable state, whose type is ST_Ec Slave State, contains the requested status information. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave whose state is to be read. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; state : ST_Ec Slave State; END_VAR 44 Version: 1.9.3 TE1000
## Page 45

Ether CAT State Machine Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. state ST_Ec Slave State Structure that contains the Ether CAT status and the Link status of the slave. (Type: ST_Ec Slave State [} 126]) Example of an implementation in ST: PROGRAM TEST_Get Slave State VAR fb Get Slave State : FB_Ec Get Slave State; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL; state : ST_Ec Slave State; n Slave Addr : UINT := 1001; b Error : BOOL; n Err Id : UDINT; END_VAR fb Get Slave State(s Net Id:= s Net Id, n Slave Addr:= n Slave Addr, b Execute:=b Execute); state := fb Get Slave State.state; b Error := fb Get Slave State.b Error; n Err Id := fb Get Slave State.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 5.4 FB_Ec Req Master State With this function block the Ether CAT state of a master device can be requested and set. The requested Ether CAT state is transferred in the state variable. The function block becomes inactive as soon as it has requested the Ether CAT state. Unlike the function block FB_Ec Set Master State it does not wait until the new state is set. See also: FB_Ec Set Master State [} 48] Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; state : WORD; END_VAR TE1000 Version: 1.9.3 45
## Page 46

Ether CAT State Machine Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. state WORD Ether CAT state requested from the master. (See state) State Ether CAT state requested from the master. The possible State values are: Constant Value Description EC_DEVICE_STATE_INIT 0x01 Request Init state from master EC_DEVICE_STATE_PREOP 0x02 Request Pre-operational state from master EC_DEVICE_STATE_SAFEOP 0x04 Request Safe-operational state from master EC_DEVICE_STATE_OP 0x08 Request Operational state from master Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Example of an implementation in ST: PROGRAM TEST_Req Master State VAR fb Req Master State : FB_Ec Req Master State; s Net Id : T_Ams Net Id:= '172.16.2.131.2.1'; b Execute : BOOL; state : WORD :=EC_DEVICE_STATE_INIT; b Error : BOOL; n Err Id : UDINT; END_VAR fb Req Master State(s Net Id:= s Net Id, b Execute:=b Execute, state:=state); b Error := fb Get Master State.b Error; n Err Id := fb Get Master State.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 46 Version: 1.9.3 TE1000
## Page 47

Ether CAT State Machine 5.5 FB_Ec Req Slave State With this function block a slave can be set to a specified Ether CAT state. The requested Ether CAT state is transferred in the state variable. The function block becomes inactive as soon as it has sent the command to change state. Unlike the function block FB_Ec Set Slave State it does not wait until the Ether CAT slave has attained the new state. See also: FB_Ec Set Slave State [} 49] Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; state : WORD; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave whose Ether CAT state is to be set. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. state WORD Ether CAT state requested from the master. (See State) State Ether CAT state to which the slave is to be set. The possible State values are: Constant Value Description EC_DEVICE_STATE_INIT 0x01 Set slave to Init state EC_DEVICE_STATE_PREOP 0x02 Set slave to Pre-operational state EC_DEVICE_STATE_BOOTSTRA 0x03 Set slave to Bootstrap state. This P state is used for firmware downloads. EC_DEVICE_STATE_SAFEOP 0x04 Set slave to Safe-operational state EC_DEVICE_STATE_OP 0x08 Set slave to Operational state EC_DEVICE_STATE_ERROR 0x10 If the error bit in the status byte is set in the Ether CAT slave (state.device State & EC_DEVICE_STATE_ERROR = TRUE), the error bit can be reset by setting EC_DEVICE_STATE_ERROR. TE1000 Version: 1.9.3 47
## Page 48

Ether CAT State Machine Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Example of an implementation in ST: PROGRAM TEST_Req Slave State VAR fb Get Slave State : FB_Ec Req Slave State; s Net Id : T_Ams Net Id:= '172.16.2.131.2.1'; b Execute : BOOL; state : WORD := EC_DEVICE_STATE_INIT; n Slave Addr : UINT := 1001; b Error : BOOL; n Err Id : UDINT; END_VAR fb Get Slave State(s Net Id:= s Net Id, n Slave Addr:= n Slave Addr, b Execute:=b Execute, state:=state); b Error := fb Get Slave State.b Error; n Err Id := fb Get Slave State.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 5.6 FB_Ec Set Master State With this function block the Ether CAT state of a master device can be requested and set. The requested Ether CAT state is transferred with the req State variable. The function block requests the Ether CAT state and, unlike the function block FB_Ec Req Master State, remains active until the new state is set or the maximum time t Timeout is exceeded. The current state is output in the curr State variable. See also: FB_Ec Req Master State [} 45] Inputs VAR_INPUT s Net Id : T_Ams Net Id; b Execute : BOOL; t Timeout : TIME := T#10s; req State : WORD; END_VAR 48 Version: 1.9.3 TE1000
## Page 49

Ether CAT State Machine Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. req State WORD (See req State) req State Ether CAT state requested from the master. The possible values for req State are: Constant Value Description EC_DEVICE_STATE_INIT 0x01 Request Init state from master EC_DEVICE_STATE_PREOP 0x02 Request Pre-operational state from master EC_DEVICE_STATE_SAFEOP 0x04 Request Safe-operational state from master EC_DEVICE_STATE_OP 0x08 Request Operational state from master Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; curr State : WORD; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. curr State WORD Current Ether CAT state of the master Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 5.7 FB_Ec Set Slave State With this function block a slave can be set to a specified Ether CAT state. The requested Ether CAT state is transferred with the req State variable. The function block sends the command to change state and, unlike the function block FB_Ec Reg Slave State, remains active until the Ether CAT slave has attained the new state or the maximum time t Timeout is exceeded. The current state is output in the curr State variable. TE1000 Version: 1.9.3 49
## Page 50

Ether CAT State Machine See also: FB_Ec Req Slave State [} 47] Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := T#10s; req State : WORD; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave whose Ether CAT state is to be set. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. req State WORD Ether CAT state to which the slave is to be set. (See req State) req State Ether CAT state to which the slave is to be set. The possible values for req State are: Constant Value Description EC_DEVICE_STATE_INIT 0x01 Set slave to Init state EC_DEVICE_STATE_PREOP 0x02 Set slave to Pre-operational state EC_DEVICE_STATE_BOOTSTRA 0x03 Set slave to Bootstrap state. This P state is used for firmware downloads. EC_DEVICE_STATE_SAFEOP 0x04 Set slave to Safe-operational state EC_DEVICE_STATE_OP 0x08 Set slave to Operational state EC_DEVICE_STATE_ERROR 0x10 If the error bit in the status byte is set in the Ether CAT slave (curr State.device State AND EC_DEVICE_STATE_ERROR = TRUE), the error bit can be reset by setting EC_DEVICE_STATE_ERROR. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; curr State : ST_Ec Slave State; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. curr State ST_Ec Slave Current Ether CAT state [} 126] of the slave State 50 Version: 1.9.3 TE1000
## Page 51

Ether CAT State Machine Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT TE1000 Version: 1.9.3 51
## Page 52

ADS Interface 6 ADS Interface 6.1 FB_Ec Read BIC The function block FB_Ec Read BIC can be used to read the BIC from the EEPROM of an Ether CAT slave via ADS. For this the slave must contain the BIC in the EEPROM. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave to which the SDO upload command should be sent. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; s BICValue : STRING(1023); st MSID : ST_Splitted BIC; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. s BICValue STRING(1023) This output contains (after an error-free run) the BIC of the Ether CAT slave after the b Busy output has been reset, e.g. "„1P193995SBTN0002agdw1KEL7411 Q1 2P112104020018". st MSID ST_Splitted BIC This output contains (after an error-free run) the substrings of the BIC of the Ether CAT slave after the b Busy output has been reset. The following substrings are assigned for the above BIC: s Item No = "193995" s BTN = "0002agdw" s Description = "EL7411" s Quantity = "1" s Batch No = "112104020018" 52 Version: 1.9.3 TE1000
## Page 53

ADS Interface Sample of an implementation in ST PROGRAM TEST_Ec Read BIC VAR fb Ec BIC : FB_Ec Read BIC; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL := TRUE; n Slave Addr : UINT := 1006; s ECBIC : STRING(1023); st Ec BIC : ST_Splitted BIC; b Error : BOOL; n Err Id : UDINT; END_VAR fb Ec BIC(s Net Id:= s Net ID, n Slave Addr:= n Port, b Execute:= b Execute, t Timeout:= T#5s); IF NOT fb Ec BIC.b Busy THEN b Execute := FALSE; IF NOT fb Ec BIC.b Error THEN st Ec BIC := fb Ec BIC.st MSID; s ECBIC := fb Ec BIC.s BICValue; END_IF fb Ec BIC (b Execute:= b Execute); END_IF Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 6.2 FB_Ec Read BTN The function block FB_Ec Read BTN can be used to read the BTN from the EEPROM of an Ether CAT slave via ADS. For this the slave must contain the BIC in the EEPROM. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type♠ Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave to which the SDO upload command should be sent. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; s BTN : STRING(9); END_VAR TE1000 Version: 1.9.3 53
## Page 54

ADS Interface Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. s BTN STRING(9) This output contains (after an error-free run) the BTN of the Ether CAT slave after the b Busy output has been reset, e.g. "0002agdw". Sample of an implementation in ST PROGRAM TEST_Ec Read BTN VAR fb Ec BTN : FB_Ec Read BTN; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL := TRUE; n Slave Addr : UINT := 1006; s Ec BTN : STRING; b Error : BOOL; n Err Id : UDINT; END_VAR fb Ec BTN(s Net Id:= s Net ID, n Slave Addr:= n Port, b Execute:= b Execute, t Timeout:= T#5S); IF NOT fb Ec BTN.b Busy THEN b Execute := FALSE; IF NOT fb Ec BTN.b Error THEN s Ec BTN := fb Ec BTN.s BTN; END_IF fb Ec BTN(b Execute:= b Execute); END_IF Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 54 Version: 1.9.3 TE1000
## Page 55

Co E interface 7 Co E interface 7.1 FB_Ec Coe Sdo Read The function block FB_Ec Coe Sdo Read allows data to be read from an object directory of an Ether CAT slave via SDO (Service Data Object) access. This requires the slave to have a mailbox and to support the “CANopen over Ether CAT” (Co E) protocol. The n Sub Index and n Index parameters allow the object that is to be read to be selected. The function block FB_Ec Coe Sdo Read Ex [} 56] must be used for access to the complete parameter, including subelements. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; n Sub Index : BYTE; n Index : WORD; p Dst Buf : PVOID; cb Buf Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave to which the SDO upload command should be sent. n Sub Index BYTE Subindex of the object that is to be read. n Index WORD Index of the object that is to be read. p Dst Buf PVOID Address (pointer) to the receive buffer. cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Read : UDINT; END_VAR TE1000 Version: 1.9.3 55
## Page 56

Co E interface Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. cb Read UDINT Number of successfully read data bytes Example of an implementation in ST: PROGRAM TEST_Sdo Read VAR fb Sdo Read : FB_Ec Co ESdo Read; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL; n Slave Addr : UINT := 1006; n Index : WORD := 16#1018; n Sub Index : BYTE :=1; vendor Id : UDINT; b Error : BOOL; n Err Id : UDINT; END_VAR fb Sdo Read(s Net Id:= s Net Id,n Slave Addr :=n Slave Addr, n Index:=n Index, n Sub Index :=n Sub Index, p Dst Buf:= ADR(vendor Id), cb Buf Len:=SIZEOF(vendor Id),b Execute:=b Execute); b Error:=fb Sdo Read.b Error; n Err Id:=fb Sdo Read.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 7.2 FB_Ec Coe Sdo Read Ex The function block FB_Ec Coe Sdo Read Ex allows data to be read from an object directory of an Ether CAT slave via SDO (Service Data Object) access. This requires the slave to have a mailbox and to support the “CANopen over Ether CAT” (Co E) protocol. The n Sub Index and n Index parameters allow the object that is to be read to be selected. Via b Complete Access := TRUE the parameter can be read with subelements. Inputs VAR_INPUT s Net Id : T_Ams Net Id; (* Ams Net Id of the Ether CAT master device.*) n Slave Addr : UINT; (* Address of the slave device.*) n Sub Index : BYTE; (* CANopen Sdo subindex.*) n Index : WORD; (* CANopen Sdo index.*) p Dst Buf : PVOID; (* Contains the address of the buffer for the received data. *) cb Buf Len : UDINT; (* Contains the max. number of bytes to be received. *) b Execute : BOOL; (* Function block execution is triggered by a rising edge at this input. *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; 56 Version: 1.9.3 TE1000
## Page 57

Co E interface (* States the time before the function is cancelled. *) b Complete Access : BOOL; (* access complete object*) END_VAR Name Type Description s Net Id T_Ams String containing the AMS network ID of the Ether CAT master device. (Type: Net Id T_Ams Net Id) n Slave UINT Fixed address of the Ether CAT slave to which the SDO upload command Addr should be sent. n Sub Index BYTE Subindex of the object that is to be read. n Index WORD Index of the object that is to be read. p Dst Buf PVOID Address (pointer) to the receive buffer cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. b Complete BOOL If b Complete Access is set, the whole parameter can be read in a single Access access. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Read : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. cb Read UDINT Number of successfully read data bytes Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 7.3 FB_Ec Coe Sdo Write The FB_Ec Coe Sdo Write function block permits an object from the object directory of an Ether CAT slave to be written by means of an SDO download. This requires the slave to have a mailbox and to support the “CANopen over Ether CAT” (Co E) protocol. The n Sub Index and n Index parameters allow the object that is to be written to be selected. The function block FB_Ec Coe Sdo Write Ex [} 59] must be used for access to the complete parameter, including subelements. TE1000 Version: 1.9.3 57
## Page 58

Co E interface Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; n Sub Index : BYTE; n Index : WORD; p Src Buf : PVOID; cb Buf Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams String containing the AMS network ID of the Ether CAT master device. (Type: Net Id T_Ams Net Id) n Slave UINT Fixed address of the Ether CAT slave to which the SDO download command Addr should be sent. n Sub Index BYTE Subindex of the object that is supposed to be written. n Index WORD Index of the object that is supposed to be written. p Src Buf PVOID Address (pointer) to the transmit buffer cb Buf Len UDINT Number of date to be sent in bytes b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Example of an implementation in ST: PROGRAM TEST_Sdo Write VAR fb Sdo Write : FB_Ec Co ESdo Write; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; (* Net Id of Ether CAT Master *) n Slave Addr : UINT := 1005; (* Port Number of Ether CAT Slave *) n Index : WORD := 16#4062; (* Co E Object Index *) n Sub Index : BYTE := 1; (* Subindex of Co E Object *) n Value : UINT := 2; (* variable to be written to the Co E Object *) b Execute : BOOL; (* rising edge starts writing to the Co E Object *) b Error : BOOL; n Err Id : UDINT; END_VAR fb Sdo Write( s Net Id := s Net Id, n Slave Addr := n Slave Addr, n Index := n Index, n Sub Index := n Sub Index, p Src Buf := ADR(n Value), cb Buf Len := SIZEOF(n Value), b Execute := b Execute ); 58 Version: 1.9.3 TE1000
## Page 59

Co E interface IF NOT fb Sdo Write.b Busy THEN b Execute := FALSE; IF NOT fb Sdo Write.b Error THEN (* write successful *) b Error := FALSE; n Err Id := 0; ELSE (* write failed *) b Error := fb Sdo Write.b Error; n Err Id := fb Sdo Write.n Err Id; END_IF fb Sdo Write(b Execute := FALSE); END_IF Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 7.4 FB_Ec Coe Sdo Write Ex The FB_Ec Coe Sdo Write Ex function block permits an object from the object directory of an Ether CAT slave to be written by means of an SDO download. This requires the slave to have a mailbox and to support the “CANopen over Ether CAT” (Co E) protocol. The n Sub Index and n Index parameters allow the object that is to be written to be selected. Via b Complete Access := TRUE the parameter can be written with sub- elements. Inputs VAR_INPUT s Net Id : T_Ams Net Id; (* Ams Net Id of the Ether CAT master device.*) n Slave Addr : UINT; (* Address of the slave device.*) n Sub Index : BYTE; (* CANopen Sdo subindex.*) n Index : WORD; (* CANopen Sdo index.*) p Src Buf : PVOID; (* Contains the address of the buffer containing the data to be send. * ) cb Buf Len : UDINT; (* Contains the max. number of bytes to be received. *) b Execute : BOOL; (* Function block execution is triggered by a rising edge at this input. *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; (* States the time before the function is cancelled. *) b Complete Access : BOOL; (* access complete object*) END_VAR TE1000 Version: 1.9.3 59
## Page 60

Co E interface Name Type Description s Net Id T_Ams String containing the AMS network ID of the Ether CAT master device. (Type: Net Id T_Ams Net Id) n Slave UINT Fixed address of the Ether CAT slave to which the SDO download command Addr should be sent. n Sub Index BYTE Subindex of the object that is supposed to be written. n Index WORD Index of the object that is supposed to be written. p Src Buf PVOID Address (pointer) to the transmit buffer cb Buf Len UDINT Number of date to be sent in bytes b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. b Complete Ac BOOL If b Complete Access is set, the whole parameter can be written in a single cess access. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 7.5 FB_Co ERead_By Drive Ref The function block FB_Co ERead_By Drive Ref can be used to read drive parameters by means of the "CANopen over Ether CAT (Co E)" protocol. This requires the slave to have a mailbox and to support the “CANopen over Ether CAT” (Co E) protocol. The n Sub Index and n Index parameters allow the object that is to be read to be selected. Via b Complete Access := TRUE the parameter can be read with subelements. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; (*Contains s Net ID of Ec Master, n Slave Addr of Ec Drive, n Drive No of Ec Drive, either preset or read from NC*) n Index : WORD; (*So E IDN: e.g. ҅S_0_IDN+1҆ for S-0-0001 or ҅P_0_IDN+23҆ for P-0-0023*) n Sub Index : BYTE; p Dst Buf : PVOID; (*Contains the address of the buffer for the received data*) 60 Version: 1.9.3 TE1000
## Page 61

Co E interface cb Buf Len : UDINT; (*Contains the max. number of bytes to be received*) b Execute : BOOL; (*Function block execution is triggered by a rising edge at this input*) t Timeout : TIME; (*States the time before the function is cancelled*) b Complete Access : BOOL; END_VAR Name Type Description st Drive Ref ST_Drive R Structure containing the AMS network ID of the Ether CAT master device ef and the address of the slave device. The reference to the drive can be linked directly to the PLC in the System Manager. To this end an instance of ST_Plc Drive Ref must be used and the NEt ID of the Byte array converted to a string. n Index WORD Index of the object that is to be read. n Sub Index BYTE Subindex of the object that is to be read. p Dst Buf PVOID Address (pointer) to the receive buffer. cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. b Complete BOOL If b Complete Access is set, the whole parameter can be read in a single Access access. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i CANopen Err Id : UINT; cb Read : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT Returns the ADS error code of the last executed command when the b Error output is set. i CANopen Err Id UINT Returns the CANopen error code if the b Error output is set. cb Read UDINT Number of successfully read data bytes Example of an implementation in ST: PROGRAM MAIN VAR fb Co ERead : FB_Co ERead_By Drive Ref; st Drive Ref : ST_Drive Ref; n Index : WORD := 16#1018; n Sub Index : BYTE := 1; b Execute : BOOL := TRUE; t Timeout : TIME := T#5S; b Complete Access : BOOL := TRUE; vendor Id : UDINT; b Error : BOOL; n Ads Err Id : UDINT; n CANopen Err Id : UDINT; END_VAR fb Co ERead( st Drive Ref:= st Drive Ref, n Index:= n Index, n Sub Index:= n Sub Index, p Dst Buf:= ADR(vendor Id), cb Buf Len:= SIZEOF(vendor Id), b Execute:= b Execute, t Timeout:= t Timeout, TE1000 Version: 1.9.3 61
## Page 62

Co E interface b Complete Access:= b Complete Access ); IF NOT fb Co ERead.b Busy THEN b Error:=fb Co ERead.b Error; n Ads Err Id:=fb Co ERead.i Ads Err Id; n CANopen Err Id:=fb Co ERead.i CANopen Err Id; b Execute := FALSE; fb Co ERead(b Execute := b Execute); END_IF Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 7.6 FB_Co EWrite_By Drive Ref The function block FB_Co EWrite_By Drive Ref can be used to write drive parameters based on the “CANopen over Ether CAT (Co E)” protocol. This requires the slave to have a mailbox and to support the “CANopen over Ether CAT” (Co E) protocol. The n Sub Index and n Index parameters allow the object that is to be written to be selected. Via b Complete Access := TRUE the parameter can be written with sub- elements. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; (*Contains s Net ID of Ec Master, n Slave Addr Ec Drive, n Drive No of Ec Drive, either preset or read from NC*) n Index : WORD; (*So E IDN: e.g. ҅S_0_IDN+1҆ for S-0-0001 or ҅P_0_IDN+23҆ for P-0-0023*) n Sub Index : BYTE; (*So E element*) p Src Buf : PVOID; (*Contains the address of the buffer containing the data to be sent*) cb Buf Len : UDINT; (*Contains the max. number of bytes to be received*) b Execute : BOOL; (*Function block execution is triggered by a rising edge at this input*) t Timeout : TIME; (*States the time before the function is cancelled*) b Complete Access : BOOL; END_VAR Name Type Description st Drive Ref ST_Drive Ref Structure containing the AMS network ID of the Ether CAT master device and the address of the slave device. The reference to the drive can be linked directly to the PLC in the System Manager. To this end an instance of ST_Plc Drive Ref must be used and the NEt ID of the Byte array converted to a string. n Index WORD Index of the object that is supposed to be written. n Sub Index BYTE Subindex of the object that is supposed to be written. p Src Buf PVOID Address (pointer) to the transmit buffer cb Buf Len UDINT Maximum available buffer size for the data to be sent in bytes. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. b Complete BOOL If b Complete Access is set, the whole parameter can be read in a single Access access. 62 Version: 1.9.3 TE1000
## Page 63

Co E interface Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i CANopen Err Id : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT Returns the ADS error code of the last executed command when the b Error output is set. i CANopen Err Id UINT Returns the CANopen error code if the b Error output is set. Example of an implementation in ST: PROGRAM MAIN VAR fb Co EWrite : FB_Co EWrite_By Drive Ref; st Drive Ref : ST_Drive Ref; n Index : WORD := 16#1018; n Sub Index : BYTE := 1; b Execute : BOOL := TRUE; t Timeout : TIME := T#5S; b Complete Access : BOOL := TRUE; vendor Id : UDINT := 2; b Error : BOOL; n Ads Err Id : UDINT; n CANopen Err Id : UDINT; END_VAR fb Co EWrite( st Drive Ref:= st Drive Ref, n Index:= n Index, n Sub Index:= n Sub Index, p Src Buf:= ADR(vendor Id), cb Buf Len:= SIZEOF(vendor Id), b Execute:= b Execute, t Timeout:= t Timeout, b Complete Access:= b Complete Access ); IF NOT fb Co EWrite.b Busy THEN b Error:= fb Co EWrite.b Error; n Ads Err Id:= fb Co EWrite.i Ads Err Id; n CANopen Err Id:= fb Co EWrite.i CANopen Err Id; b Execute := FALSE; fb Co EWrite(b Execute := b Execute); END_IF Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 7.7 FB_Ec Coe Read BIC TE1000 Version: 1.9.3 63
## Page 64

Co E interface The function block FB_Ec Coe Read BIC can be used to read the BIC from the object directory of an Ether CAT slave via SDO (Service Data Object) access. For this the slave must have a mailbox and support the "CANopen over Ether CAT (Co E)" protocol and the object directory must contain an object 0x10E2:01 with the BIC. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave to which the SDO upload command should be sent. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; s BICValue : STRING st MSID : ST_Splitted BIC; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. s BICValue STRING(1023) This output contains (after an error-free run) the BIC of the Ether CAT slave after the b Busy output has been reset, e.g. "„1P193995SBTN0002agdw1KEL7411 Q1 2P112104020018". st MSID ST_Splitted BIC This output contains (after an error-free run) the substrings of the BIC of the Ether CAT slave after the b Busy output has been reset. The following substrings are assigned for the above BIC: s Item No = "193995" s BTN = "0002agdw" s Description = "EL7411" s Quantity = "1" s Batch No = "112104020018" Sample of an implementation in ST PROGRAM TEST_Ec Co ERead BIC VAR fb Co EBIC : FB_Ec Co ERead BIC; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL := TRUE; n Slave Addr : UINT := 1006; s Co EBIC : STRING(1023); st Co EBIC : ST_Splitted BIC; b Error : BOOL; n Err Id : UDINT; END_VAR 64 Version: 1.9.3 TE1000
## Page 65

Co E interface fb Co EBIC(s Net Id:= s Net ID, n Slave Addr:= n Port, b Execute:= b Execute, t Timeout:= T#5s); IF NOT fb Co EBIC.b Busy THEN b Execute := FALSE; IF NOT fb Co EBIC.b Error THEN st Co EBIC := fb Co EBIC.st MSID; s Co EBIC := fb Co EBIC.s BICValue; END_IF fb Co EBIC(b Execute:= b Execute); END_IF Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 7.8 FB_Ec Coe Read BTN The function block FB_Ec Coe Read BTN can be used to read the BTN from the object directory of an Ether CAT slave via SDO (Service Data Object) access. For this the slave must have a mailbox and support the "CANopen over Ether CAT (Co E)" protocol and the object directory must contain an object 0x F083 with the BTN. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave to which the SDO upload command should be sent. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; s BTN : STRING(9) END_VAR TE1000 Version: 1.9.3 65
## Page 66

Co E interface Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. s BTN STRING This output contains (after an error-free run) the BTN of the Ether CAT slave after the b Busy output has been reset, e.g. "0002agdw". Sample of an implementation in ST PROGRAM TEST_ Ec Co ERead Btn VAR fb Co EBTN : FB_Ec Co ERead Btn; s Net Id : T_Ams Net Id := '172.16.2.131.2.1'; b Execute : BOOL := TRUE; n Slave Addr : UINT := 1006; s Co EBTN : STRING; b Error : BOOL; n Err Id : UDINT; END_VAR fb Co EBTN(s Net Id:= s Net ID, n Slave Addr:= n Port, b Execute:= b Execute, t Timeout:= T#5S); IF NOT fb Co EBTN.b Busy THEN b Execute := FALSE; IF NOT fb Co EBTN.b Error THEN s Co EBTN := fb Co EBTN.s BTN; END_IF fb Co EBTN(b Execute:= b Execute); END_IF Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 7.9 FB_Ec Co ESdo Abort Code The function block Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. n Slave UINT Fixed address of the Ether CAT slave to which the SDO download command Addr should be sent. b Execute BOOL The function block is enabled by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. 66 Version: 1.9.3 TE1000
## Page 67

Co E interface Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; st Abort Code : ST_Ec Abort Code; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. st Abort Code ST_Ec Abort Abort code Code TE1000 Version: 1.9.3 67
## Page 68

Fo E interface 8 Fo E interface 8.1 FB_Ec Foe Access This function block writes or reads data via the communication port of the “File access over Ether CAT” mailbox protocol. Inputs VAR_INPUT h Foe : T_HFoe; p Buffer : DWORD; cb Buffer : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description h Foe T_HFoe "File access over Ether CAT" handle [} 131] p Buffer DWORD Contains the address of the buffer into which the data are to be read (read access) or the address of buffer containing the data to be written (write access). The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. cb Buffer UDINT Contains the number of data bytes to be written or read. b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Done : UDINT; b EOF : BOOL; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. cb Done UDINT Number of the most recent successfully written or read data bytes b EOF BOOL End of File, this variable becomes TRUE if the end of the file is reached during read access. For write access this variable has no purpose. 68 Version: 1.9.3 TE1000
## Page 69

Fo E interface Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 8.2 FB_Ec Foe Close This function block closes the communication port for the “File access over Ether CAT” mailbox protocol. Inputs VAR_INPUT h Foe : T_HFoe; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description h Foe T_HFoe "File access over Ether CAT" handle [} 131] b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT TE1000 Version: 1.9.3 69
## Page 70

Fo E interface 8.3 FB_Ec Foe Load The function block FB_Ec Foe Load can be used to download or upload files to or from an Ether CAT device via the “File access over Ether CAT” mailbox protocol. The file path can only point to the local file system on the computer. This means that network paths cannot be used here. To upload or download files via the Fo E protocol, the function block automatically resets the Ether CAT device to BOOTSTRAP mode. Finally, the function block tries to reset the device to the original state. Inputs VAR_INPUT s Net Id : T_Ams Net Id ; n Slave Addr : UINT; s Path Name : T_Max String; dw Pass : DWORD := 0; e Mode : E_Ec Foe Mode := e Foe Mode_Write; b Execute : BOOL; t Timeout : TIME := T#200s; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. n Slave Addr UINT Fixed address of the Ether CAT slave whose file is to be uploaded or downloaded. s Path Name T_Max String Contains the path and filenames of the file to be written or read. (e.g.: 'C:\FOE_Test\EL6751\ECATFW__EL6751_C6_V0030.efw') dw Pass DWORD Password (default: 0) e Mode E_Ec Foe Mode "File access over Ether CAT" access mode (default: write access) [} 121] b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time that must not be exceeded when the function block is executed (default: 200 s). Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Load : UDINT; n Progress : UDINT; s Info : T_Max String; END_VAR 70 Version: 1.9.3 TE1000
## Page 71

Fo E interface Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. cb Load UDINT Number of successfully written or read data bytes n Progress UDINT Write access progress (range: 0 - 100%). This variable is currently not used for read access, in which case it is always 0. s Info T_Max String Additional command information as string (reserved) Sample in ST: A rising edge at the b Load variable triggers the firmware download via the “File access over Ether CAT” mailbox protocol. PROGRAM MAIN VAR fb Download : FB_Ec Foe Load := ( s Net ID := '5.0.34.38.3.1', n Slave Addr := 1004, s Path Name := 'C:\FOE_Test\EL6751\ECATFW__EL6751_C6_V0030.efw', dw Pass := 0, e Mode := e Foe Mode_Write ); b Load : BOOL; b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; n Bytes Written : UDINT; n Percent : UDINT; END_VAR fb Download( b Execute := b Load, b Busy => b Busy, b Error => b Error, n Err Id => n Err ID, cb Load => n Bytes Written, n Progress => n Percent ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 8.4 FB_Ec Foe Open This function block is used to open the communication port for the “File access over Ether CAT” mailbox protocol. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Port : UINT; TE1000 Version: 1.9.3 71
## Page 72

Fo E interface s Path Name : T_Max String; dw Pass : DWORD; e Mode : E_Ec Foe Mode; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. n Port UINT Fixed address of the Ether CAT device s Path Name T_Max String File path name ( e.g.: 'c:\Twin CAT\FOE\Data.fwp' ) (See below for further explanations of s Path Name.) dw Pass DWORD Password e Mode E_Ec Foe Mode Access mode (write/read access) [} 121] b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. s Path Name By default, only the filename (without filename extension) is extracted from the file path (e.g. 'c: \Twin CAT\FOE\Data.fwp') that was entered and used as the filename for the Fo E protocol (in our example: 'Data'). From library version 3.3.12.0, filenames including the filename extension can also be used (in our example: 'Data.fwp'). Via the global boolean variable Tc2_Ether CAT.b Ec Foe Open File Name With File Ext the use of the filename extension can be enabled or disabled for all instances of the FB_Ec Foe Open function block. By default, the variable has the value FALSE (no filename extension). If you set the value to TRUE then the use of filename extensions is enabled. Note that the Fo E function blocks were originally used for firmware updates where no filename extension was used. If you want to update the firmware, you may have to make sure that the global variable has its original default value, i.e. FALSE. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; h Foe : T_HFoe; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. h Foe T_HFoe [} 131] "File access over Ether CAT" handle Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 72 Version: 1.9.3 TE1000
## Page 73

Fo E interface 8.5 FB_Ec Foe Read File The FB_Ec Foe Read File function block can be used to download files from an Ether CAT device to the local data carrier via the "File access over Ether CAT" mailbox protocol. The file path can only point to the local file system on the computer. This means that network paths cannot be used here. Inputs VAR_INPUT s FSrv Net Id : T_Ams Net Id := ''; s FSrv Path Name : T_Max String; s Ec Net Id : T_Ams Net Id; n Slave Addr : UINT; s Fo EPath Name : T_Max String; dw Pass : DWORD := 0; b Execute : BOOL; t Timeout : TIME := T#200s; END_VAR Name Type Description s FSrv Net Id T_Ams Net Id AMS network ID of the computer on which the file that was read is to be written. (Default: local computer) s FSrv Path Nam T_Max String Contains the path and filename of the file to be written (e.g. 'C: e \Data\Log Data.csv'). s Ec Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. n Slave Addr UINT Address of the Ether CAT slave s Fo EPath Nam T_Max String Name of the file on the Ether CAT slave (e.g. 'Log Data') e dw Pass DWORD Password b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. (Default: 200 s.) Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Read : UDINT; s Info : T_Max String; END_VAR TE1000 Version: 1.9.3 73
## Page 74

Fo E interface Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. cb Read UDINT Number of successfully read data bytes s Info T_Max String Additional Fo E error information (reserved) Sample in ST: A rising edge at the b Execute variable triggers reading of the specified file via the "File access over Ether CAT" mailbox protocol. The file named in s Fo EPath Name is read by the selected Ether CAT slave (s Ec Net Id & n Slave Addr). The file is stored on the selected computer (s FSrv Net ID) under the name specified in s FSrv Path Name. If a password is required for reading the file from the Ether CAT slave, this can be specified via dw Pass. The read and write operation is not completed until b Busy switches to FALSE. Only then can the error information or the number of bytes read be evaluated. PROGRAM MAIN VAR fb Ec Read File : FB_Ec Foe Read File := ( s FSrv Net ID := '5.0.34.38.1.1', (* Net ID for target file *) s FSrv Path Name := 'C:\Data\Log Data.csv', (* Pathname for target file *) s Ec Net Id := '5.0.34.38.3.1', (* Net ID of Ether CAT master *) n Slave Addr := 1004, (* Ether CAT slave address *) s Fo EPath Name := 'Log Data', (* Name of source file *) dw Pass := 0 ); b Execute : BOOL := TRUE; b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; n Bytes Read : UDINT; END_VAR fb Ec Read File ( b Execute := b Execute, b Busy => b Busy, b Error => b Error, n Err Id => n Err ID ); IF NOT b Busy THEN b Execute := FALSE; IF NOT b Error THEN (* done, no error *) n Bytes Read := fb Ec Read File.cb Read; ELSE (* evaluate error *) n Bytes Read := 0; END_IF fb Ec Read File (b Execute := FALSE); END_IF Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT >= 3.3.14 74 Version: 1.9.3 TE1000
## Page 75

Fo E interface 8.6 FB_Ec Foe Write File The function block FB_Ec Foe Write File can be used to write files from a local data carrier to an Ether CAT device via the "File access over Ether CAT" mailbox protocol. The file path can only point to the local file system on the computer. This means that network paths cannot be used here. Inputs VAR_INPUT s FSrv Net Id : T_Ams Net Id := ''; s FSrv Path Name : T_Max String; s Ec Net Id : T_Ams Net Id; n Slave Addr : UINT; s Fo EPath Name : T_Max String; dw Pass : DWORD := 0; b Execute : BOOL; t Timeout : TIME := T#200s; END_VAR Name Type Description s FSrv Net Id T_Ams Net Id AMS network ID of the computer from which the file to be written is to be read. (Default: local computer) s FSrv Path Nam T_Max String Contains the path and filename of the file to be read (e.g.: 'C: e \Data\Log Data.csv'). s Ec Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. n Slave Addr UINT Address of the Ether CAT slave s Fo EPath Nam T_Max String Name of the file on the Ether CAT slave (e.g. 'Log Data') e dw Pass DWORD Password b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. (Default: 200 s.) Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Written : UDINT; n Progress : UDINT; s Info : T_Max String; END_VAR TE1000 Version: 1.9.3 75
## Page 76

Fo E interface Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. cb Written UDINT Number of successfully written data bytes n Progress UDINT Write access progress (range: 0 - 100%). s Info T_Max String Additional Fo E error information (reserved) Sample in ST: A rising edge at the b Execute variable triggers writing of the specified file via the "File access over Ether CAT" mailbox protocol. The file named in s FSrv Path Name is read from the selected computer (s FSrv Net ID). The file is stored on the selected Ether CAT slave (s Ec Net Id & n Slave Addr) under the name specified in s Fo EPath Name. If a password is required for writing the file to the Ether CAT slave, this can be specified via dw Pass. The read and write operation is not completed until b Busy switches to FALSE. Only then can the error information or the number of bytes read be evaluated. PROGRAM MAIN VAR fb Ec Write File : FB_Ec Foe Write File := ( s FSrv Net ID := '5.0.34.38.1.1', (* Net ID for source file *) s FSrv Path Name := 'C:\Data\Log Data.csv', (* Pathname for source file *) s Ec Net Id := '5.0.34.38.3.1', (* Net ID of Ether CAT master *) n Slave Addr := 1004, (* Ether CAT slave address *) s Fo EPath Name := 'Log Data', (* Name of target file *) dw Pass := 0 ); b Execute : BOOL := TRUE; b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; n Bytes Written : UDINT; END_VAR fb Ec Write File ( b Execute := b Execute, b Busy => b Busy, b Error => b Error, n Err Id => n Err ID ); IF NOT b Busy THEN b Execute := FALSE; IF NOT b Error THEN (* done, no error *) n Bytes Written := fb Ec Write File.cb Written; ELSE (* evaluate error *) n Bytes Written := 0; END_IF fb Ec Write File (b Execute := FALSE); END_IF Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.56 PC or CX (x86, x64, Arm®) Tc2_Ether CAT >= 3.5.1.0 76 Version: 1.9.3 TE1000
## Page 77

So E interface 9 So E interface 9.1 FB_Ec Soe Read The function block FB_Ec Soe Read can be used to read drive parameters by means of the “Sercos over Ether CAT (So E)” protocol. To this end the slave must have a mailbox and support the So E protocol. The drive parameter to be read is specified with the parameters n Idn (identification number), n Element and n Drive No. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; n Idn : WORD; n Element : BYTE; n Drive No : BYTE; b Command : BOOL p Dst Buf : PVOID; cb Buf Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave to which the So E read command is to be sent. n Idn WORD Identification number of the parameter to be read n Element BYTE Element number of the parameter to be read (See n Element) n Drive No BYTE Drive number b Command BOOL This parameter should be set if internal command execution is to be used. p Dst Buf PVOID Address (pointer) to the receive buffer cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. n Element Element number of the parameter to be read. The following values are permitted: TE1000 Version: 1.9.3 77
## Page 78

So E interface Value Description 0x01 Data status 0x02 Name (read only) 0x04 Attribute 0x08 Unit 0x10 Minimum 0x20 Maximum 0x40 Value 0x80 Default Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Read : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. cb Read UDINT Number of successfully read data bytes Example of an implementation in ST: PROGRAM TEST_So ERead VAR fb So ERead : FB_Ec So ERead; s Net Id : T_Ams Net Id:= '172.16.2.131.2.1'; b Execute : BOOL; n Slave Addr : UINT := 1006; n Idn : WORD := 15; n Element : BYTE := 0; n Drive No : BYTE := 0; b Command : BOOL := FALSE; val : UINT; b Error : BOOL; n Err Id : UDINT; END_VAR fb So ERead(s Net Id:= s Net Id,n Slave Addr :=n Slave Addr, n Idn := n Idn, n Element:=n Element, n Drive No := n Dr ive No, b Command:=b Command, p Dst Buf:= ADR(val), cb Buf Len:=SIZEOF(val),b Execute:=b Execute); b Error := fb So ERead.b Error; n Err Id := fb So ERead.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 78 Version: 1.9.3 TE1000
## Page 79

So E interface 9.2 FB_Ec Soe Write The function block FB_Ec Soe Write can be used to write drive parameters by means of the “Sercos over Ether CAT (So E)” protocol. To this end the slave must have a mailbox and support the So E protocol. The drive parameter to be written is specified with the parameters n Idn (identification number), n Element and n Drive No. Inputs VAR_INPUT s Net Id : T_Ams Net Id; n Slave Addr : UINT; n Idn : WORD; n Element : BYTE; n Drive No : BYTE; p Command : BOOL; p Src Buf : PVOID; cb Buf Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the Ether CAT master device. (Type: T_Ams Net Id) n Slave Addr UINT Fixed address of the Ether CAT slave to which the So E write command is to be sent. n Idn WORD Identification number of the parameter to be written. n Element BYTE Element number of the parameter to be written (See n Element) n Drive No BYTE Drive number b Command BOOL This parameter should be set if internal command execution is to be used. p Src Buf PVOID Address (pointer) to the transmit buffer cb Buf Len UDINT Number of date to be sent in bytes b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. n Element Element number of the parameter to be written. The following values are permitted: TE1000 Version: 1.9.3 79
## Page 80

So E interface Value Description 0x01 Data status 0x02 Name (read only) 0x04 Attribute 0x08 Unit 0x10 Minimum 0x20 Maximum 0x40 Value 0x80 Default Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. n Err Id UDINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. Example of an implementation in ST: PROGRAM TEST_So EWrite VAR fb Soe Write : FB_Ec So EWrite; s Net Id : T_Ams Net Id:= '172.16.2.131.2.1'; b Execute : BOOL; n Slave Addr : UINT := 1006; n Idn : WORD := 15; n Element : BYTE := 0; n Drive No : BYTE := 0; b Command : BOOL := FALSE; val : UINT; b Error : BOOL; n Err Id : UDINT; END_VAR fb So EWrite(s Net Id:= s Net Id,n Slave Addr :=n Slave Addr, n Idn := n Idn, n Element:=n Element, n Drive No := n D rive No,b Command:=b Command, p Src Buf:= ADR(val), cb Buf Len:=SIZEOF(val),b Execute:=b Execute); b Error := fb So EWrite.b Error; n Err Id := fb So EWrite.n Err Id; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 80 Version: 1.9.3 TE1000
## Page 81

So E interface 9.3 FB_So ERead_By Drive Ref The FB_Soe Read_By Ref function block can be used to read drive parameters by means of the “Sercos over Ether CAT (So E)” protocol. To this end the slave must have a mailbox and support the So E protocol. The drive parameter to be read is specified with the parameters n Idn (identification number), n Element and st Drive Ref. The global variable b Seq Read Drv Attr And Value := TRUE from the Tc2_Ether CAT library can be used to enforce sequential access to attribute and value. The default value of this variable is FALSE. Devices of the AX5xxx series enable parallel and sequential access to attribute and value. For third-party devices it may be necessary to separate access to attribute and value, which overall slows down access by several cycles. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; (* contains s Net ID of Ec Master, n Slave Addr of Ec Drive, n Drive No of Ec D rive, either preset or read from NC *) n Idn : WORD; (* So E IDN: e.g. "S_0_IDN + 1" for S-0-0001 or "P_0_IDN + 23" for P-0-0023*) n Element : BYTE; (* So E element.*) p Dst Buf : PVOID; (* Contains the address of the buffer for the received data. *) cb Buf Len : UDINT; (* Contains the max. number of bytes to be received. *) b Execute : BOOL; (* Function block execution is triggered by a rising edge at this input.*) t Timeout : TIME := DEFAULT_ADS_TIMEOUT;(* States the time before the function is cancelled. *) END_VAR Name Type Description st Drive Ref ST_Drive Ref The reference to the drive can be linked directly to the PLC in the System Manager. To this end an instance of ST_Plc Drive Ref must be used and the Net ID of the Byte array converted to a string. n Idn WORD Identification number of the parameter to be read n Element BYTE Element number of the parameter to be read (See n Element) p Dst Buf PVOID Address (pointer) to the read buffer cb Buf Len UDINT Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. n Element Element number of the parameter to be read. The following values are permitted: Value Description 0x01 Data status 0x02 Name (read only) 0x04 Attribute 0x08 Unit 0x10 Minimum 0x20 Maximum 0x40 Value 0x80 Default TE1000 Version: 1.9.3 81
## Page 82

So E interface Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; cb Read : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT Returns the ADS error code of the last executed command when the b Error output is set. i Sercos Err Id UINT Returns the Sercos error of the last executed command in the event of a set b Error output. dw Attribute DWORD Returns the attributes of the Sercos parameter. cb Read UDINT Number of successfully read data bytes Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 9.4 FB_So EWrite_By Drive Ref The function block FB_Soe Write_By Ref can be used to write drive parameters by means of the “Sercos over Ether CAT (So E)” protocol. To this end the slave must have a mailbox and support the So E protocol. The drive parameter to be written is specified with the parameters n Idn (identification number), n Element and st Drive Ref. The global variable b Seq Read Drv Attr And Value := TRUE from the Tc2_Ether CAT library can be used to enforce sequential access to attribute and value. The default value of this variable is FALSE. Devices of the AX5xxx series enable parallel and sequential access to attribute and value. For third-party devices it may be necessary to separate access to attribute and value, which overall slows down access by several cycles. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; (* contains s Net ID of Ec Master, n Slave Addr of Ec Drive, n Drive No of Ec D rive, either preset or read from NC *) n Idn : WORD; (* So E IDN: e.g. "S_0_IDN + 1" for S-0-0001 or "P_0_IDN + 23" for P-0-0023*) n Element : BYTE; (* So E element.*) p Src Buf : PVOID; (* Contains the address of the buffer containing the data to be send. *) cb Buf Len : UDINT; (* Contains the max. number of bytes to be received. *) b Execute : BOOL; (* Function block execution is triggered by a rising edge at this input.*) t Timeout : TIME := DEFAULT_ADS_TIMEOUT;(* States the time before the function is cancelled. *) END_VAR 82 Version: 1.9.3 TE1000
## Page 83

So E interface Name Type Description st Drive Ref ST_Drive Ref The reference to the drive can be linked directly to the PLC in the System Manager. To this end an instance of ST_Plc Drive Ref must be used and the Net ID of the Byte array converted to a string. n Idn WORD Identification number of the parameter to be read n Element BYTE Element number of the parameter to be read (See n Element) p Src Buf Address (pointer) to the send buffer cb Buf Len Maximum available buffer size (in bytes) for the data to be read b Execute BOOL The function block is activated by a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. n Element Element number of the parameter to be read. The following values are permitted: Value Description 0x01 Data status 0x02 Name (read only) 0x04 Attribute 0x08 Unit 0x10 Minimum 0x20 Maximum 0x40 Value 0x80 Default Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT Supplies the ADS error code associated with the most recently executed command if the b Error output is set. i Sercos UINT Returns the Sercos error of the last executed command when the b Error Err Id output is set. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT TE1000 Version: 1.9.3 83
## Page 84

Conversion Functions 10 Conversion Functions 10.1 F_Conv BK1120Coupler State To String The function F_Conv BK1120Coupler State To String returns the coupler state of the BK1120/BK1150/ BK1250 as string. For n State = 0 'No error' is returned, otherwise 'K-bus error' is returned, e.g. for n State = 1. If several errors are pending, they are separated by commas. Inputs VAR_INPUT n State : WORD; END_VAR Name Type Description n State WORD Coupler state; can be linked in the System Manager from the inputs of the BK1120/ BK1250 to the PLC. 0x0000 = ҅No error҆ 0x0001 = ҅K-Bus error҆ 0x0002 = ҅Configuration error҆ 0x0010 = ҅Outputs disabled҆ 0x0020 = ҅K-Bus overrun҆ 0x0040 = ҅Communication error (Inputs)҆ 0x0080 = ҅Communication error (Outputs)҆ Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 10.2 F_Conv Master Dev State To String The function F_Conv Master Dev State To String converts the device status of the Ether CAT master to string. For n State = 0 'OK' is returned, otherwise, 'Not OK – Link error', e.g. for n State = 1. If several errors are pending, they are separated by hyphens. Inputs VAR_INPUT n State : WORD; END_VAR 84 Version: 1.9.3 TE1000
## Page 85

Conversion Functions Name Type Description n State WORD Device state of the Ether CAT master; can be linked as Dev State in the System Manager from the inputs of the Ether CAT master to the PLC. 0x0001 = ҅Link error҆ 0x0002 = ҅I/O locked after link error (I/O reset required)҆ 0x0004 = ҅Link error (redundancy adapter)҆ 0x0008 = ҅Missing one frame (redundancy mode)҆ 0x0010 = ҅Out of send resources (I/O reset required)҆ 0x0020 = ҅Watchdog triggered҆ 0x0040 = ҅Ethernet driver (miniport) not found҆ 0x0080 = ҅I/O reset active҆ 0x0100 = ҅At least one device in ҅INIT҆ state҆ 0x0200 = ҅At least one device in ҅PRE-OP҆ state҆ 0x0400 = ҅At least one device in ҅SAFE-OP҆ state҆ 0x0800 = ҅At least one device indicates an error state҆ 0x1000 = ҅DC not in sync҆ Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 10.3 F_Conv Product Code To String The function F_Conv Product To String returns the product code as string, e.g. 'EL6731-0000-0017'. From version 3.3.8.0 of the Tc2_Ether CAT library this function also supports ELM and EPP slaves such as 'EPP4374-0002-0018' and 'ELM3704-0001-0016'. Inputs VAR_INPUT st Slave Identity : ST_Ec Slave Identity; END_VAR Name Type Description st Slave Identity ST_Ec Slave Identity Slave Identity as it can be read with the FB_Ec Get Slave Identity [} 32]. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 10.4 F_Conv Slave State To String The function F_Conv Slave State To String returns the Ether CAT slave state as string. For conversion to the string see F_Conv State To String [} 87]. TE1000 Version: 1.9.3 85
## Page 86

Conversion Functions Inputs VAR_INPUT state : ST_Ec Slave State; END_VAR Name Type Description state ST_Ec Slave State Ether CAT slave state structure (consisting of: device State : BYTE; link State : BYTE;) Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 10.5 F_Conv Slave State To Bits The function F_Conv Slave State To Bits returns the Ether CAT slave state as structure TYPE ST_Ec Slave State Bits [} 127]. Inputs VAR_INPUT st Ec Slave State : ST_Ec Slave State; END_VAR Name Type Description st Ec Slave State ST_Ec Slave State Ether CAT slave state structure (consisting of: device State : BYTE; link State : BYTE;) Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 10.6 F_Conv Slave State To Bits Ex The function F_Conv Slave State To Bits Ex returns the Ether CAT slave state as structure ST_Ec Slave State Bits Ex [} 127]. Inputs VAR_INPUT st Ec Slave State : ST_Ec Slave State; END_VAR Name Type Description st Ec Slave State ST_Ec Slave State Ether CAT slave state structure (consisting of: device State : BYTE; link State : BYTE;) 86 Version: 1.9.3 TE1000
## Page 87

Conversion Functions Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 10.7 F_Conv State To String The function F_Conv State To String returns the Ether CAT slave state as string. For n State = 0 ‘ ‘ is returned, otherwise, ‘INIT ‘ is returned, e.g. for n State = 1. If several messages are pending, they are separated by spaces. Inputs VAR_INPUT n State : WORD; END_VAR Name Type Description n State WORD Ether CAT slave state as WORD 0x___1 = 'INIT' 0x___2 = 'PREOP' 0x___3 = 'BOOT' 0x___4 = 'SAFEOP' 0x___8 = 'OP' 0x001_ = 'Slave signals error' 0x002_ = 'Invalid vendor Id, product Code... read' 0x004_ = 'Initialization error occurred' 0x008_ = 'Slave disabled' 0x010_ = 'Slave not present' 0x020_ = 'Slave signals link error' 0x040_ = 'Slave signals missing link' 0x080_ = 'Slave Slave signals unexpected link' 0x100_ = 'Communication port A' 0x200_ = 'Communication port B' 0x400_ = 'Communication port C' 0x800_ = 'Communication port D' Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT TE1000 Version: 1.9.3 87
## Page 88

Distributed Clocks 11 Distributed Clocks 11.1 DCTIME32 11.1.1 Convert Dc Time To Pos This function block converts a 32-bit distributed clock system time variable of type T_DCTIME32 [} 130] to a corresponding NC axis position (i.e. the NC axis position at precisely this time). Inputs VAR_INPUT n Axis Id : UDINT; n Sub Idx : UDINT; dc Time : T_DCTIME32;(* 32 bit distributed clock time *) END_VAR Name Type Description n Axis Id UDINT ID of the NC axis n Sub Idx UDINT This 32-bit input variable contains two different items of information, and is therefore divided into two 16-bit values: • The Low Word (the least significant 16 bits) contains the subindex for relative addressing of an encoder subelement at an axis. The subindex is counted upwards from zero. For the typical case of an axis that has just one encoder, the null subindex is correct. • The High Word (the most significant 16 bits) contains a control word (bit mask) that affects the way in which the position is calculated (e.g. the type of interpolation or extrapolation). A bit mask value of 0x0001 means that the set acceleration of the axis is to be included in the calculation. dc Time T_DCTIME32 32-bit "Distributed Clock System Time" variable. This input variable is converted into the corresponding NC axis position. The 32-bit time may only be used in the narrow range of ± 2,147 seconds around the current system time, to ensure that it is unambiguous. Within the function block this prerequisite cannot be checked. Outputs VAR_OUTPUT f Position : LREAL; i Err : UDINT; END_VAR Name Type Description f Position LREAL Supplies the NC axis position corresponding to dc Time. This is an NC axis position that has been scaled and provided with an offset, having, for instance, physical units of degrees or of millimeters. i Err UDINT Returns the error number if an error occurs, e.g. error 0x4012 (axis ID is not allowed, or axis does not exist within the system). 88 Version: 1.9.3 TE1000
## Page 89

Distributed Clocks Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.1.2 Convert Pos To Dc Time This function block converts an NC axis position to a corresponding 32-bit distributed clock system time variable of type T_DCTIME32 [} 130] (i.e. the time which precisely this NC axis position was or will be reached). Inputs VAR_INPUT n Axis Id : UDINT; n Sub Idx : UDINT; f Position : LREAL; END_VAR Name Type Description n Axis Id UDINT ID of the NC axis n Sub Idx UDINT This 32-bit input magnitude is composed of two different items of information, and is divided into two 16-bit values: • The Low Word (the least significant 16 bits) contains the subindex for relative addressing of an encoder subelement at an axis. The subindex is counted upwards from zero. For the typical case of an axis that has just one encoder, the null subindex is correct. • The High Word (the most significant 16 bits) contains a control word (bit mask) that affects the way in which the position is calculated (e.g. the type of interpolation or extrapolation). A bit mask value of 0x0001 means that the set acceleration of the axis is to be included in the calculation. f Position LREAL NC axis position that is converted to the corresponding 32-bit "Distributed Clock System Time" variable. If the "Distributed Clock System Time" associated with the position is outside the expected time window of ± 2.147 seconds, this conversion is rejected with an error number. Outputs VAR_OUTPUT dc Time : T_DCTIME32;(* 32 bit distributed clock time *) i Err : UDINT; END_VAR TE1000 Version: 1.9.3 89
## Page 90

Distributed Clocks Name Type Description dc Time T_DCTIME32 Returns the 32-bit "Distributed Clock System Time" variable that corresponds to input f Position. i Err UDINT Supplies an error number if an error occurs, e.g. • Error 0x4012: axis ID is not allowed, or axis is not present in the system. • Error 0x4361: time range exceeded (future) • Error 0x4362: time range exceeded (past) • Error 0x4363: position cannot be determined mathematically. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.1.3 Convert Dc Time To Path Pos This function block converts a 32-bit distributed clock system time variable of type T_DCTIME32 [} 130] to a relative Nci path distance on the contour of the currently active Nci program (i.e. the function block returns a positive or negative relative interval, depending on the timing). Inputs VAR_INPUT n Grp Id : UDINT; n Sub Idx : UDINT; dc Time : T_DCTIME32;(* 32 bit distributed clock time *) END_VAR Name Type Description n Grp Id UDINT Group ID of the corresponding Nci channel n Sub Idx UDINT This 32-bit input variable contains two different items of information, and is therefore divided into two 16-bit values: • The Low Word (the least significant 16 bits) contains the subindex for relative addressing of an encoder subelement at an axis. The subindex is counted upwards from zero. For the typical case of an axis that has just one encoder, the null subindex is correct. • The High Word (the most significant 16 bits) contains a control word (bit mask) that affects the way in which the position is calculated (e.g. the type of interpolation or extrapolation). The bit mask 0x0001 means that the set acceleration of the axis is to be included in the calculation. Bit mask 0x0010 means that the calculation is relative and is currently mandatory. Otherwise the call is rejected with an error. dc Time T_DCTIME32 32-bit "Distributed Clock System Time" variable. This input variable is converted to the corresponding relative Nci path distance on the contour. The 32-bit time may only be used in the narrow range of ± 2,147 seconds around the current system time, to ensure that it is unambiguous. Within the function block this prerequisite cannot be checked. 90 Version: 1.9.3 TE1000
## Page 91

Distributed Clocks Outputs VAR_OUTPUT f Position : LREAL; i Err : UDINT; END_VAR Name Type Description f Position LREAL Returns the relative Nci path distance on the contour that corresponds to the dc Time. i Err UDINT Returns an error number in the event of an error Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.1.4 Convert Path Pos To Dc Time This function block converts a relative Nci path distance to a corresponding 32-bit distributed clock system time variable of type T_DCTIME32 [} 130] (i.e. the time that corresponds or corresponded to the relative Nci path distance). Inputs VAR_INPUT n Grp Id : UDINT; n Sub Idx : UDINT; f Position : LREAL; END_VAR Name Type Description n Grp Id UDINT Group ID of the corresponding Nci channel n Sub Idx UDINT This 32-bit input variable contains two different items of information, and is therefore divided into two 16-bit values: • The Low Word (the least significant 16 bits) contains the subindex for relative addressing of an encoder subelement at an axis. The subindex is counted upwards from zero. For the typical case of an axis that has just one encoder, the null subindex is correct. • The High Word (the most significant 16 bits) contains a control word (bit mask) that affects the way in which the position is calculated (e.g. the type of interpolation or extrapolation). The bit mask 0x0001 means that the set acceleration of the axis is to be included in the calculation. Bit mask 0x0010 means that the calculation is relative and is currently mandatory. Otherwise the call is rejected with an error. f Position LREAL Relative Nci path distance converted to the corresponding 32-bit "Distributed Clock System Time". If the "Distributed Clock System Time" associated with the relative Nci path distance is outside the expected time window of ± 2.147 seconds, this conversion is rejected with an error number. TE1000 Version: 1.9.3 91
## Page 92

Distributed Clocks Outputs VAR_OUTPUT dc Time : T_DCTIME32;(* 32 bit distributed clock time *) i Err : UDINT; END_VAR Name Type Description dc Time T_DCTIME32 Returns the 32-bit "Distributed Clock System Time" variable that corresponds to input f Position. i Err UDINT Supplies an error number if an error occurs, e.g. • Error 0x4361: time range exceeded (future) • Error 0x4362: time range exceeded (past) • Error 0x4363: position cannot be determined mathematically Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.2 DCTIME64 11.2.1 DCTIME_TO_DCTIME64 The function converts a distributed clock system time variable of type T_DCTIME [} 131] to a 64-bit distributed clock system time variable of type T_DCTIME64 [} 130]. FUNCTION DCTIME_TO_DCTIME64: T_DCTIME64 Inputs VAR_INPUT in : T_DCTIME; END_VAR Name Type Description in T_DCTIME The "Distributed Clock System Time" variable to be converted Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.2.2 DCTIME64_TO_DCTIME The function converts a distributed clock system time variable of type T_DCTIME [} 130] to a 64-bit distributed clock system time variable of type T_DCTIME64 [} 131]. 92 Version: 1.9.3 TE1000
## Page 93

Distributed Clocks FUNCTION DCTIME64_TO_DCTIME: T_DCTIME Inputs VAR_INPUT in : T_DCTIME64; END_VAR Name Type Description in T_DCTIME64 The "Distributed Clock System Time" variable to be converted Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.2.3 DCTIME64_TO_DCTIMESTRUCT The function converts a 64-bit distributed clock system time variable of type T_DCTIME64 [} 130] to a structured variable of type DCTIMESTRUCT [} 129]. FUNCTION DCTIME64_TO_DCTIMESTRUCT Inputs VAR_INPUT in : T_DCTIME64; END_VAR Name Type Description in T_DCTIME64 The "Distributed Clock System Time" variable to be converted Sample: PROGRAM P_TEST VAR dc Struct : DCTIMESTRUCT; dc Time : T_DCTIME64; END_VAR dc Time : F_Get Cur Dc Tick Time64(); dc Struct := DCTIME64_TO_DCTIMESTRUCT (dc TIME); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.2.4 DCTIME64_TO_FILETIME64 The function converts a 64-bit "Distributed Clock System Time" variable of type T_DCTIME64 [} 130] to a 64- bit "Windows File Time" variable of type T_FILETIME64. TE1000 Version: 1.9.3 93
## Page 94

Distributed Clocks FUNCTION DCTIME64_TO_FILETIME64: T_FILETIME64 Inputs VAR_INPUT in : T_DCTIME64: END_VAR; Name Type Description in T_DCTIME64 The "Distributed Clock System Time" variable to be converted Sample: PROGRAM P_TEST VAR ft : T_FILETIME64; dct : T_DCTIME64; END_VAR dct := F_Get Cur Dc Tick Time64(); ft := DCTIME64_TO_FILETIME64(dct); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.4024 PC or CX (x86, x64, Arm®) Tc2_Ether CAT >= 3.3.16.0 11.2.5 DCTIME64_TO_STRING The function converts a 64-bit distributed clock system time variable of type T_DCTIME64 [} 130] to a string. The string resulting the conversion has the following format: ‘YYYY-MM-DD-hh:mm:ss.nnnnnnnnn‘ • YYYY: year; • MM: month; • DD: day; • hh: hour; • mm: minute; • ss: second; • nnnnnnnnn: nanoseconds FUNCTION DCTIME64_TO_STRING: STRING (29) Inputs VAR_INPUT in : T_DCTIME64; (*Distributed Clock Time*) END_VAR Name Type Description in T_DCTIME64 The "Distributed Clock System Time" variable to be converted Example: See description of the function: F_Get Cur Dc Tick Time64 [} 102]. 94 Version: 1.9.3 TE1000
## Page 95

Distributed Clocks Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.2.6 DCTIME64_TO_SYSTEMTIME The function converts a 64-bit distributed clock system time variable of type T_DCTIME64 [} 130] to a structured Windows system time variable of type TIMESTRUCT. DCTIME64_TO_SYSTEMTIME: TIMESTRUCT Inputs VAR_INPUT in : T_DCTIME64; END_VAR Name Type Description in T_DCTIME64 The "Distributed Clock System Time" variable to be converted Sample: PROGRAM P_TEST VAR syst : TIMESTRUCT; END_VAR syst := DCTIME64_TO_SYSTEMTIME ( F_Get Cur Dc Tick Time64() ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.2.7 DCTIMESTRUCT_TO_DCTIME64 The function converts a structured variable of type of type DCTIMESTRUCT [} 129] to a 64-bit distributed clock system time variable T_DCTIME64 [} 130]. The structure components w Dayof Week is ignored in the conversion. The structure components w Year must be greater than or equal to 2000 and less than 2584. For invalid values of the structure components the function returns the value zero. FUNCTION DCTIMESTRUCT_TO_DCTIME64: T_DCTIME64 Inputs VAR_INPUT in : DCTIMESTRUCT; END_VAR Name Type Description in DCTIMESTRUCT The structured variable to be converted Sample: TE1000 Version: 1.9.3 95
## Page 96

Distributed Clocks PROGRAM P_TEST VAR dc Struct : DCTIMESTRUCT := ( w Year := 2008, w Month := 3, w Day := 13, w Hour := 1, w Minute := 2, w Second :=3, w Milliseconds := 123, w Microseconds := 456, w Nanoseconds := 789 ); dc64 : T_DCTIME64; END_VAR dc64 := DCTIMESTRUCT_TO_DCTIME64( dc Struct ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.2.8 FILETIME64_TO_DCTIME64 The function converts a 64-bit "Windows File Time" variable of type T_FILETIME64 to a 64-bit "Distributed Clock System Time" variable of type T_DCTIME64 [} 130]. In the event of a conversion error the function returns the value zero. FUNCTION FILETIME64_TO_DCTIME64: T_DCTIME64 Inputs VAR_INPUT in : T_FILETIME64; END_VAR Name Type Description in T_FILETIME64 The "Windows File Time" variable to be converted Sample: PROGRAM P_TEST VAR ft : T_FILETIME64; dct : T_DCTIME64; END_VAR ft := F_Get System Time(); dct := FILETIME64_TO_DCTIME64(ft); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.4024 PC or CX (x86, x64, Arm®) Tc2_Ether CAT >= 3.3.16.0 11.2.9 STRING_TO_DCTIME64 The function converts a string to a distributed clock system time variable of type T_DCTIME64 [} 130]. 96 Version: 1.9.3 TE1000
## Page 97

Distributed Clocks FUNCTION STRING_TO_DCTIME64: T_DCTIME64 Inputs VAR_INPUT in : STRING(29); END_VAR Name Type Description in STRING The string to be converted The string must have the following format: 'YYYY-MM-DD- hh:mm:ss:nnnnnnnnn' • YYYY: year; • MM: month; • DD: day; • hh: hour; • mm: minute; • ss: second; • nnnnnnnnn: nanoseconds Sample: See description of the function F_Get Cur Dc Tick Time64 [} 102]. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.2.10 SYSTEMTIME_TO_DCTIME64 The function converts a structured Windows system time variable of type TIMESTRUCT to a 64-bit distributed clock system time variable of type T_DCTIME64 [} 130]. In the event of a conversion error the function returns the value zero. FUNCTION SYSTEMTIME_TO_DCTIME64: T_DCTIME64 Inputs VAR_INPUT in : TIMESTRUCT; micro : WORD(0..999); (* Microseconds: 0..999 *) nano : WORD(0..999); (* Nanoseconds: 0..999 *) END_VAR Name Type Description in TIMESTRUCT The "Windows System Time" variable to be converted micro WORD Microseconds nano WORD Nanoseconds Sample: PROGRAM P_TEST VAR syst : TIMESTRUCT := ( w Year := 2009, w Month := 9, w Day := 16, w Hour := 12, w Minute := 22, w Seco TE1000 Version: 1.9.3 97
## Page 98

Distributed Clocks nd := 44, w Milliseconds := 123 ); END_VAR dct := SYSTEMTIME_TO_DCTIME64( syst, 456, 789 ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.2.11 FB_Ec Dc Time Ctrl64 This function block can be used to read the individual components such as year, month, day etc. of a 64-bit "Distributed Clock System Time" variable of type T_DCTIME64 [} 130]. The function block has several A_GETXYZ actions. Once the required action has been called, the value of the XYZ component is available in the “get” output variable. The “put” input variable is currently not used. The function block features the following tasks: • A_Get Year • A_Get Month • A_Get Day • A_Get Day Of Week • A_Get Hour • A_Get Minute • A_Get Second • A_Get Milli • A_Get Micro • A_Get Nano Inputs VAR_INPUT put : WORD; END_VAR Name Type Description put WORD Input parameter (currently not used) Inputs/outputs VAR_IN_OUT in : T_DCTIME64; END_VAR Name Type Description in T_DCTIME64 The "Distributed Clock System Time" variable to be converted Outputs VAR_OUTPUT b Error : BOOL; get : WORD; END_VAR 98 Version: 1.9.3 TE1000
## Page 99

Distributed Clocks Name Type Description b Error BOOL This output is set if an error has occurred during the action call. get WORD Output parameter (year, month, day, etc.) Example of an implementation in ST: PROGRAM P_TEST VAR dc Struct : DCTIMESTRUCT; dc Time : T_DCTIME64; fb Ctrl : FB_Ec Dc Time Ctrl; w Year : WORD; w Month : WORD; w Day : WORD; w Day Of Week : WORD; w Hour : WORD; w Minute : WORD; w Second : WORD; w Milli : WORD; w Micro : WORD; w Nano : WORD; END_VAR dc Time := F_Get Cur Dc Tick Time64(); fb Ctrl. A_Get Year( in := dc Time, get => w Year ); fb Ctrl. A_Get Month( in := dc Time, get => w Month ); fb Ctrl. A_Get Day( in := dc Time, get => w Day ); fb Ctrl. A_Get Day Of Week( in := dc Time, get => w Day Of Week ); fb Ctrl. A_Get Hour( in := dc Time, get => w Hour ); fb Ctrl. A_Get Minute( in := dc Time, get => w Minute ); fb Ctrl. A_Get Second( in := dc Time, get => w Second ); fb Ctrl. A_Get Milli( in := dc Time, get => w Milli ); fb Ctrl. A_Get Micro( in := dc Time, get => w Micro ); fb Ctrl. A_Get Nano( in := dc Time, get => w Nano ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.3 DCTIME64 and ULINT 11.3.1 F_Conv Ext Time To Dc Time64 The function F_Conv Ext Time To Dc Time64 converts an external time to the Twin CAT distributed clock system time. FUNCTION F_Conv Ext Time To Dc Time64: T_DCTIME64 Inputs VAR_INPUT Ext Time : T_DCTIME64; Dc To Ext Time Offset : ULINT; END_VAR Name Type Description Ext Time T_DCTIME64 External time in Twin CAT "Distributed Clock" system time format Dc To Ext Time ULINT Time offset between the Twin CAT "Distributed Clock" system time Offset and an external time TE1000 Version: 1.9.3 99
## Page 100

Distributed Clocks Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.3.2 F_Conv Tc Time To Dc Time64 The function F_Conv Tc Time To Dc Time64 converts the Twin CAT system time to the Twin CAT distributed clock system time. FUNCTION F_Conv Tc Time To Dc Time64: T_DCTIME64 Inputs VAR_INPUT Tc Time : T_DCTIME64; Dc To Tc Time Offset : ULINT; END_VAR Name Type Description Tc Time T_DCTIME64 Twin CAT system time in Twin CAT "Distributed Clock" system time format Dc To Tc Time Offs ULINT Time offset between the Twin CAT "Distributed Clock" system time et and the Twin CAT system time Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.3.3 F_Conv Tc Time To Ext Time64 The function F_Conv Tc Time To Ext Time64 converts the Twin CAT distributed clock system time to an external time. FUNCTION F_Conv Tc Time To Ext Time64: T_DCTIME64 Inputs VAR_INPUT Tc Time : T_DCTIME64; Dc To Tc Time Offset : ULINT; Dc To Ext Time Offset : ULINT; END_VAR Name Type Description Tc Time T_DCTIME64 Twin CAT system time in "Distributed Clock" format Dc To Tc Time Offset ULINT Time offset between the Twin CAT "Distributed Clock" system time and the Twin CAT system time Dc To Ext Time Offs ULINT Time offset between the Twin CAT "Distributed Clock" system time et and an external time 100 Version: 1.9.3 TE1000
## Page 101

Distributed Clocks Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.3.4 F_Get Actual Dc Time64 This function returns the current time in Twin CAT distributed clock system time format (T_DCTIME64 [} 130]). FUNCTION F_Get Actaul DCTime: T_DCTIME64 Inputs VAR_INPUT (*none*) END_VAR Sample in ST: PROGRAM MAIN VAR act DC : T_DCTIME64; s Act : STRING; END_VAR act DC := F_Get Actual Dc Time64(); s Act := DCTIME64_TO_STRING( act DC ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.3.5 F_Get Cur Dc Task Time64 This function returns the task start time, the time at which the task should start, in Twin CAT "Distributed Clock" system time format (T_DCTIME64 [} 130]). The function always returns the start time of the task in which it was called. FUNCTION F_Get Cur Dc Task Time64: T_DCTIME64 Inputs VAR_INPUT (*none*) END_VAR Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT TE1000 Version: 1.9.3 101
## Page 102

Distributed Clocks 11.3.6 F_Get Cur Dc Tick Time64 The function returns the time of the current (last) tick in Twin CAT distributed clock system time format (T_DCTIME64 [} 130]). FUNCTION F_Get Cur Dc Tick Time64: T_DCTIME64 Inputs VAR_INPUT (*none*) END_VAR Sample: PROGRAM MAIN VAR t DC : T_DCTIME64; s DC : STRING; t DCBack : T_DCTIME64; s DCZero : STRING;(* DCTIME64 = zero time starts on 01.01.2000 *) t DCBack From Zero : T_DCTIME64; t DCFrom String : T_DCTIME64; s DCBack From String : STRING; END_VAR t DC := F_Get Cur Dc Tick Time64(); s DC := DCTIME64_TO_STRING( t DC ); t DCBack := STRING_TO_DCTIME64( s DC ); s DCZero := DCTIME64_TO_STRING( ULARGE_INTEGER(0, 0) ); t DCBack From Zero := STRING_TO_DCTIME64( s DCZero ); t DCFrom String := STRING_TO_DCTIME64( '2007-03-09-11:31:09.223456789' ); s DCBack From String := DCTIME64_TO_STRING( t DCFrom String ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.3.7 F_Get Cur Ext Time64 The function returns the external time in Twin CAT distributed clock system time format (T_DCTIME64 [} 130]). FUNCTION F_Get Cur Ext Time64: T_DCTIME64 Inputs VAR_INPUT Dc To Ext Time Offset : ULINT; Dc To Tc Time Offset : ULINT; END_VAR 102 Version: 1.9.3 TE1000
## Page 103

Distributed Clocks Name Type Description Dc To Ext Time ULINT Time offset between the Twin CAT "Distributed Clock" system time Offset and an external time Dc To Tc Time ULINT Time offset between the Twin CAT "Distributed Clock" system time Offset and the Twin CAT system time Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.3.8 FB_Ec Ext Sync Calc Time Diff64 The function block FB_Ec Ext Sync Calc Time Diff64 calculates the difference between external and internal time, taking into account the time offsets. Inputs/outputs VAR_IN_OUT Dc To Tc Time Offset : ULINT; Dc To Ext Time Offset : ULINT; Ext Time : T_DCTIME64; Int Time : T_DCTIME64; END_VAR Name Type Description Dc To Tc Time Offset ULINT Time offset between the Twin CAT "Distributed Clock" system time and the Twin CAT system time Dc To Ext Time Offs ULINT Time offset between the Twin CAT "Distributed Clock" system time et and an external time Ext Time T_DCTIME64 External time in Twin CAT "Distributed Clock" system time format Int Time T_DCTIME64 Internal time in Twin CAT "Distributed Clock" system time format Outputs VAR_OUTPUT n Time Diff : UDINT; (*with difference greater than 32 bit time Diff = 0xfffffff*) n Offset From Sync Master : DINT; (*less than 32 bit int Offset = 0x80000000, greater than 32 bit int Offset = 0x7FFFFFFF*) END_VAR Name Type Description n Time Diff UDINT If the difference is less than 32 bits, the time difference is returned. If the difference is greater than 32 bits, 16#FFFFFFFF is returned. n Offset From DINT If the difference is greater than 32 bits and the offset between Sync Master internal and DC Time is less than 32 bits, then 16#80000000 is returned. If the difference is greater than 32 bits and the offset between internal and DC Time is greater than 32 bits, then 16#7FFFFFFF is returned. TE1000 Version: 1.9.3 103
## Page 104

Distributed Clocks Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.3.9 FB_Ec Ext Sync Check64 The function block FB_Ec Ext Sync Check64 checks whether the internal and external clocks are synchronous. See function block FB_Ec Ext Sync Calc Time Diff64 [} 103]. Inputs VAR_INPUT n Sync Window : UDINT; b Not Connected : BOOL; END_VAR Name Type Description n Sync Window UDINT Time window within which the internal and external clock are regarded as synchronous. b Not Connected BOOL TRUE = connection to external clock is interrupted. Inputs/outputs VAR_IN_OUT Dc To Tc Time Offset : T_LARGE_INTEGER; Dc To Ext Time Offset : T_LARGE_INTEGER; Ext Time : T_DCTIME64; Int Time : T_DCTIME64; END_VAR Name Type Description Dc To Tc Time T_LARGE_INTEG Time offset between the Twin CAT "Distributed Clock" system time Offset ER and the Twin CAT system time Dc To Ext Time T_LARGE_INTEG Time offset between the Twin CAT "Distributed Clock" system time Offset ER and an external time Ext Time T_DCTIME64 External time in Twin CAT "Distributed Clock" system time format Int Time T_DCTIME64 Internal time in Twin CAT "Distributed Clock" system time format Outputs VAR_OUTPUT b Synchronized : BOOL; n Time Diff : UDINT; n Offset From Sync Master : DINT; END_VAR Name Type Description b Synchronized BOOL TRUE = external and internal clock are synchronous n Time Diff UDINT Current time difference between the two clocks n Offset From DINT Offset to sync master Sync Master 104 Version: 1.9.3 TE1000
## Page 105

Distributed Clocks Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4 [obsolete] 11.4.1 [outdated DCTIME] 11.4.1.1 DCTIME_TO_DCTIMESTRUCT Outdated function This function is outdated. Use the function DCTIME64_TO_DCTIMESTRUCT [} 93] instead. The function converts a 64-bit distributed clock system time variable of type T_DCTIME [} 131] to a structured variable of type DCTIMESTRUCT [} 129]. FUNCTION DCTIME_TO_DCTIMESTRUCT: DCTIMESTRUCT Inputs VAR_INPUT in : T_DCTIME; END_VAR Name Type Description in T_DCTIME The "Distributed Clock System Time" variable to be converted. Sample: PROGRAM P_TEST VAR dc Struct : DCTIMESTRUCT; dc Time : T_DCTIME; END_VAR dc Time := F_Get Cur Dc Tick Time(); dc Struct := DCTIME_TO_DCTIMESTRUCT(dc Time); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.1.2 DCTIME_TO_FILETIME TE1000 Version: 1.9.3 105
## Page 106

Distributed Clocks Outdated function This function is outdated. Use the function DCTIME64_TO_FILETIME [} 118] instead. The function converts a 64-bit distributed clock system time variable of type T_DCTIME [} 131] to a 64-bit Windows file time variable of type T_FILETIME. FUNCTION DCTIME_TO_FILETIME: T_FILETIME Inputs VAR_INPUT in : T_DCTIME; END_VAR Name Type Description in T_DCTIME The "Distributed Clock System Time" variable to be converted Sample: PROGRAM P_TEST VAR ft : T_FILETIME; dct : T_DCTIME; END_VAR dct := F_Get Cur Dc Tick Time(); ft := DCTIME_TO_FILETIME(dct); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.1.3 DCTIME_TO_STRING Outdated function This function is outdated. Use the function DCTIME64_TO_STRING [} 94] instead. The function converts a string to a distributed clock system time variable of type T_DCTIME [} 131]. The string resulting the conversion has the following format: 'YYYY-MM-DD-hh:mm:ss.nnnnnnnnn' • YYYY: year; • MM: month; • DD: day; • hh: hour; • mm: minute; • ss: second; • nnnnnnnnn: nanoseconds; 106 Version: 1.9.3 TE1000
## Page 107

Distributed Clocks FUNCTION DCTIME_TO_STRING: STRING(29) Inputs VAR_INPUT in : T_DCTIME; END_VAR Name Type Description in T_DCTIME The "Distributed Clock System Time" variable to be converted Sample: See description of the function: F_Get Cur Dc Tick Time [} 115]. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.1.4 DCTIME_TO_SYSTEMTIME Outdated function This function is outdated. Use the function DCTIME64_TO_SYSTEMTIME [} 95] instead. The function converts a 64-bit distributed clock system time variable of type T_DCTIME [} 131] to a structured Windows system time variable of type TIMESTRUCT. FUNCTION DCTIME_TO_SYSTEMTIME: TIMESTRUCT Inputs VAR_INPUT in : T_DCTIME; END_VAR Name Type Description in T_DCTIME The "Distributed Clock System Time" variable to be converted Sample: PROGRAM P_TEST VAR syst : TIMESTRUCT; END_VAR syst := DCTIME_TO_SYSTEMTIME( F_Get Cur Dc Tick Time() ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT TE1000 Version: 1.9.3 107
## Page 108

Distributed Clocks 11.4.1.5 DCTIMESTRUCT_TO_DCTIME Outdated function This function is outdated. Use the function DCTIMESTRUCT_TO_DCTIME64 [} 95] instead. The function converts a structured variable of type DCTIMESTRUCT [} 129] to a 64-bit distributed clock system time variable of type T_DCTIME [} 131]. The structure components w Dayof Week is ignored in the conversion. The structure components w Year must be greater than or equal to 2000 and less than 2584. For invalid values of the structure components the function returns the value zero. FUNCTION DCTIMESTRUCT_TO_DCTIME: T_DCTIME Inputs VAR_INPUT in : DCTIMESTRUCT; END_VAR Name Type Description in DCTIMESTRUCT The structured variable to be converted Sample: PROGRAM P_TEST VAR dc Struct : DCTIMESTRUCT := ( w Year := 2008, w Month := 3, w Day := 13, w Hour := 1, w Minute := 2, w Second :=3, w Milliseconds := 123, w Microseconds := 456, w Nanoseconds := 789 ); dc64 : T_DCTIME; END_VAR dc64 := DCTIMESTRUCT_TO_DCTIME( dc Struct ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.1.6 FILETIME_TO_DCTIME Outdated function The function is outdated. Use the function FILETIME_TO_DCTIME64 [} 119] instead. The function converts a 64-bit Windows file time variable of type T_FILETIME to a 64-bit distributed clock system time variable of type T_DCTIME [} 131]. In the event of a conversion error the function returns the value zero. 108 Version: 1.9.3 TE1000
## Page 109

Distributed Clocks FUNCTION FILETIME_TO_DCTIME: T_DCTIME Inputs VAR_INPUT in : T_FILETIME; END_VAR Name Type Description in T_FILETIME The "Windows File Time" variable to be converted Sample: PROGRAM P_TEST VAR fb Sys File Time : GETSYSTEMTIME; ft : T_FILETIME; dct : T_DCTIME; END_VAR fb Sys File Time(time Lo DW=>ft.dw Low Date Time, time Hi DW=>ft.dw High Date Time); dct := FILETIME_TO_DCTIME(ft); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.1.7 STRING_TO_DCTIME Outdated function This function is outdated. Use the function STRING_TO_DCTIME64 [} 96] instead. The function converts a string to a distributed clock system time variable of type T_DCTIME [} 131]. FUNCTION STRING_TO_DCTIME: T_DCTIME Inputs VAR_INPUT in : STRING(29); END_VAR Name Type Description in STRING The string to be converted The string must have the following format: 'YYYY-MM-DD- hh:mm:ss:nnnnnnnnn' • YYYY: year; • MM: month; • DD: day; • hh: hour; • mm: minute; • ss: second; • nnnnnnnnn: nanoseconds; TE1000 Version: 1.9.3 109
## Page 110

Distributed Clocks See description of the function: F_Get Cur Dc Tick Time [} 115]. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.1.8 SYSTEMTIME_TO_DCTIME Outdated function This function is outdated. Use the function SYSTEMTIME_TO_DCTIME64 [} 97] instead. The function converts a structured Windows system time variable of type TIMESTRUCT to a 64-bit distributed clock system time variable of type T_DCTIME [} 131]. In the event of a conversion error the function returns the value zero. FUNCTION SYSTEMTIME_TO_DCTIME: T_DCTIME Inputs VAR_INPUT in : TIMESTRUCT; micro : WORD(0..999); (* Microseconds: 0..999 *) nano : WORD(0..999); (* Nanoseconds: 0..999 *) END_VAR Name Type Description in TIMESTRUCT The "Windows System Time" variable to be converted Micro WORD Microseconds nano WORD Nanoseconds Sample: PROGRAM P_TEST VAR syst : TIMESTRUCT := ( w Year := 2009, w Month := 9, w Day := 16, w Hour := 12, w Minute := 22, w Seco nd := 44, w Milliseconds := 123 ); END_VAR dct := SYSTEMTIME_TO_DCTIME( syst, 456, 789 ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.1.9 FB_Ec Dc Time Ctrl 110 Version: 1.9.3 TE1000
## Page 111

Distributed Clocks Outdated function This function is outdated. Use the function block FB_Ec Dc Time Ctrl64 [} 98] instead. This function block can be used to read the individual components such as year, month, day etc. of a 64-bit "Distributed Clock System Time" variable of type T_DCTIME [} 131]. The function block has several A_Get XYZ actions. Once the required action has been called, the value of the XYZ component is available in the “get” output variable. The “put” input variable is currently not used. The function block currently has the following actions: • A_Get Year; • A_Get Month; • A_Get Day; • A_Get Day Of Week; • A_Get Hour; • A_Get Minute; • A_Get Second; • A_Get Milli; • A_Get Micro; • A_Get Nano; Inputs VAR_INPUT put : WORD; END_VAR Name Type Description put WORD Input parameter (currently not used) Inputs/outputs VAR_IN_OUT in : T_DCTIME; END_VAR Name Type Description in T_DCTIME Twin CAT "Distributed Clock System Time" variable Outputs VAR_OUTPUT b Error : BOOL; get : WORD; END_VAR Name Type Description b Error BOOL This output is set if an error has occurred during the action call. get WORD Output parameter (year, month, day, etc.) Example of an implementation in ST: PROGRAM P_TEST VAR dc Struct : DCTIMESTRUCT; dc Time : T_DCTIME; fb Ctrl : FB_Ec Dc Time Ctrl; w Year : WORD; w Month : WORD; w Day : WORD; TE1000 Version: 1.9.3 111
## Page 112

Distributed Clocks w Day Of Week : WORD; w Hour : WORD; w Minute : WORD; w Second : WORD; w Milli : WORD; w Micro : WORD; w Nano : WORD; END_VAR dc Time := F_Get Cur Dc Tick Time(); fb Ctrl. A_Get Year( in := dc Time, get => w Year ); fb Ctrl. A_Get Month( in := dc Time, get => w Month ); fb Ctrl. A_Get Day( in := dc Time, get => w Day ); fb Ctrl. A_Get Day Of Week( in := dc Time, get => w Day Of Week ); fb Ctrl. A_Get Hour( in := dc Time, get => w Hour ); fb Ctrl. A_Get Minute( in := dc Time, get => w Minute ); fb Ctrl. A_Get Second( in := dc Time, get => w Second ); fb Ctrl. A_Get Milli( in := dc Time, get => w Milli ); fb Ctrl. A_Get Micro( in := dc Time, get => w Micro ); fb Ctrl. A_Get Nano( in := dc Time, get => w Nano ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.2 [outdated DCTIME and T_LARGE_INTEGER] 11.4.2.1 F_Conv Ext Time To Dc Time Outdated function This function is outdated. Use the function F_Conv Ext Time To Dc Time64 [} 99] instead. The function F_Conv Ext Time To Dc Time converts an external time to the Twin CAT distributed clock system time. FUNCTION F_Conv Ext Time To Dc Time: T_DCTIME Inputs VAR_INPUT Ext Time : T_DCTIME; Dc To Ext Time Offset : T_LARGE_INTEGER; END_VAR Name Type Description Ext Time T_DCTIME External time in Twin CAT "Distributed Clock" system time format Dc To Ext Time T_LARGE_ Time offset between the Twin CAT "Distributed Clock" system time Offset INTEGER and an external time Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 112 Version: 1.9.3 TE1000
## Page 113

Distributed Clocks 11.4.2.2 F_Conv Tc Time To Dc Time Outdated function This function is outdated. Use the function F_Conv Tc Time To Dc Time64 [} 100] instead. The function F_Conv Tc Time To Dc Time64 converts the Twin CAT system time to the Twin CAT distributed clock system time. FUNCTION F_Conv Tc Time To Dc Time: T_DCTIME Inputs VAR_INPUT Tc Time : T_DCTIME; Dc To Tc Time Offset : T_LARGE_INTEGER; END_VAR Name Type Description Tc Time T_DCTIME Twin CAT system time in Twin CAT "Distributed Clock" system time format Dc To Tc Time T_LARGE_ Time offset between the Twin CAT "Distributed Clock" system time Offset INTEGER and the Twin CAT system time Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.2.3 F_Conv Tc Time To Ext Time Outdated function This function is outdated. Use the function F_Conv Tc Time To Ext Time64 [} 100] instead. The function F_Conc Tc Time To Ext Time converts the Twin CAT distributed clock system time to an external time. FUNCTION F_Conv Tc Time To Ext Time: T_DCTIME Inputs VAR_INPUT Tc Time : T_DCTIME; Dc To Tc Time Offset : T_LARGE_INTEGER; Dc To Ext Time Offset : T_LARGE_INTEGER; END_VAR TE1000 Version: 1.9.3 113
## Page 114

Distributed Clocks Name Type Description Tc Time T_DCTIME Twin CAT system time in "Distributed Clock" format Dc To Tc Time T_LARGE_ Time offset between the Twin CAT "Distributed Clock" system time Offset INTEGER and the Twin CAT system time Dc To Ext Time T_LARGE_ Time offset between the Twin CAT "Distributed Clock" system time Offset INTEGER and an external time Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.2.4 F_Get Actual Dc Time Outdated function This function is outdated. Use the function F_Get Actual Dc Time64 [} 101] instead. This function returns the current time in Twin CAT distributed clock system time format (T_DCTIME [} 131]). FUNCTION F_Get Actual Dc Time: T_DCTIME Inputs VAR_INPUT (*none*) END_VAR Sample: PROGRAM MAIN VAR act DC : T_DCTIME; s Act : STRING; END_VAR act DC := F_Get Actual Dc Time(); s Act := DCTIME_TO_STRING( act DC ); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.2.5 F_Get Cur Dc Task Time Outdated function This function is outdated. Use the function F_Get Cur Dc Task Time64 [} 101] instead. 114 Version: 1.9.3 TE1000
## Page 115

Distributed Clocks This function returns the task start time (time at which the task should start) in Twin CAT distributed clock system time format (T_DCTIME [} 131]). The function always returns the start time of the task in which it was called. FUNCTION F_Get Cur Dc Task Time: T_DCTIME Inputs VAR_INPUT (*none*) END_VAR Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.2.6 F_Get Cur Dc Tick Time Outdated function The function is outdated. Use the function F_Get Cur Dc Tick Time64 [} 102] instead. The function returns the time of the current (last) tick in Twin CAT distributed clock system time format (T_DCTIME [} 131]). FUNCTION F_Get Cur Dc Tick Time: T_DCTIME Inputs VAR_INPUT (*none*) END_VAR Sample: PROGRAM MAIN VAR t DC : T_DCTIME; s DC : STRING; t DCBack : T_DCTIME; s DCZero : STRING;(* DCTIME = zero time starts on 01.01.2000 *) t DCBack From Zero : T_DCTIME; t DCFrom String : T_DCTIME; s DCBack From String : STRING; END_VAR t DC := F_Get Cur Dc Tick Time(); s DC := DCTIME_TO_STRING( t DC ); t DCBack := STRING_TO_DCTIME( s DC ); s DCZero := DCTIME_TO_STRING( ULARGE_INTEGER(0, 0) ); t DCBack From Zero := STRING_TO_DCTIME( s DCZero ); t DCFrom String := STRING_TO_DCTIME( '2007-03-09-11:31:09.223456789' ); s DCBack From String := DCTIME_TO_STRING( t DCFrom String ); TE1000 Version: 1.9.3 115
## Page 116

Distributed Clocks Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.2.7 F_Get Cur Ext Time Outdated function This function is outdated. Use the function F_Get Cur Ext Time64 [} 102] instead. The function returns the external time in Twin CAT distributed clock system time format (T_DCTIME [} 131]). FUNCTION F_Get Cur Ext Time: T_DCTIME Inputs VAR_INPUT Dc To Ext Time Offset : T_LARGE_INTEGER; Dc To Tc Time Offset : T_LARGE_INTEGER; END_VAR Name Type Description Dc To Ext Time T_LARGE_ Time offset between the Twin CAT "Distributed Clock" system time Offset INTEGER and an external time Dc To Tc Time T_LARGE_ Time offset between the Twin CAT "Distributed Clock" system time Offset INTEGER and the Twin CAT system time Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.2.8 FB_Ec Ext Sync Calc Time Diff Outdated function block This function block is outdated. Use the function block FB_Ec Ext Sync Calc Time Diff64 [} 103] instead. The function block FB_Ec Ext Sync Calc Time Diff calculates the difference between external and internal time, taking into account the time offsets. Inputs/outputs VAR_IN_OUT Dc To Tc Time Offset : T_LARGE_INTEGER; Dc To Ext Time Offset : T_LARGE_INTEGER; Ext Time : T_DCTIME; Int Time : T_DCTIME; END_VAR 116 Version: 1.9.3 TE1000
## Page 117

Distributed Clocks Name Type Description Dc To Tc Time T_LARGE_ Time offset between the Twin CAT "Distributed Clock" system time Offset INTEGER and the Twin CAT system time Dc To Ext Time T_LARGE_ Time offset between the Twin CAT "Distributed Clock" system time Offset INTEGER and an external time Ext Time T_DCTIME External time in Twin CAT "Distributed Clock" system time format Int Time T_DCTIME Internal time in Twin CAT "Distributed Clock" system time format Outputs VAR_OUTPUT n Time Diff : UDINT; (*with difference greater than 32 bit time Diff = 0xfffffff*) n Offset From Sync Master : DINT; (*less than 32 bit int Offset = 0x80000000, greater than 32 bit int Offset = 0x7FFFFFFF*) END_VAR Name Type Description n Time Diff UDINT If the difference is less than 32 bits, the time difference is returned. If the difference is greater than 32 bits, 16#FFFFFFFF is returned. n Offset From DINT If the difference is greater than 32 bits and the offset between Sync Master internal and DC Time is less than 32 bits, then 16#80000000 is returned. If the difference is greater than 32 bits and the offset between internal and DC Time is greater than 32 bits, then 16#7FFFFFFF is returned. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.2.9 FB_Ec Ext Sync Check Outdated function block This function block is outdated. Use the function block FB_Ec Ext Sync Check64 [} 104] instead. The function block FB_Ec Ext Sync Check checks whether the internal and external clocks are synchronous. See function block FB_Ec Ext Sync Calc Time Diff [} 116]. Inputs VAR_INPUT n Sync Window : UDINT; b Not Connected : BOOL; END_VAR Name Type Description n Sync Window UDINT Time window within which the internal and external clock are regarded as synchronous. b Not Connected BOOL TRUE = connection to external clock is interrupted. TE1000 Version: 1.9.3 117
## Page 118

Distributed Clocks Inputs/outputs VAR_IN_OUT Dc To Tc Time Offset : T_LARGE_INTEGER; Dc To Ext Time Offset : T_LARGE_INTEGER; Ext Time : T_DCTIME; Int Time : T_DCTIME; END_VAR Name Type Description Dc To Tc Time Offset T_LARGE_INTEG Time offset between the Twin CAT "Distributed Clock" system time ER and the Twin CAT system time Dc To Ext Time Offset T_LARGE_INTEG Time offset between the Twin CAT "Distributed Clock" system time ER and an external time Ext Time T_DCTIME External time in Twin CAT "Distributed Clock" system time format Int Time T_DCTIME Internal time in Twin CAT "Distributed Clock" system time format Outputs VAR_OUTPUT b Synchronized : BOOL; n Time Diff : UDINT; n Offset From Sync Master : DINT; END_VAR Name Type Description b Synchronized BOOL TRUE = external and internal clock are synchronous n Time Diff UDINT Current time difference between the two clocks n Offset From DINT Offset to sync master Sync Master Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.3 DCTIME64_TO_FILETIME The function converts a 64-bit distributed clock system time variable of type T_DCTIME64 [} 130] to a 64-bit Windows file time variable of type T_FILETIME. FUNCTION DCTIME64_TO_FILETIME: T_FILETIME Inputs VAR_INPUT in : T_DCTIME64: END_VAR; Name Type Description in T_DCTIME64 The "Distributed Clock System Time" variable to be converted Sample: PROGRAM P_TEST VAR ft : T_FILETIME; dct : T_DCTIME64; 118 Version: 1.9.3 TE1000
## Page 119

Distributed Clocks END_VAR dct := F_Get Cur Dc Tick Time64(); ft := DCTIME64_TO_FILETIME(dct); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 11.4.4 FILETIME_TO_DCTIME64 The function converts a 64-bit Windows file time variable of type T_FILETIME to a 64-bit distributed clock system time variable of type T_DCTIME64 [} 130]. In the event of a conversion error the function returns the value zero. FUNCTION FILETIME_TO_DCTIME64: T_DCTIME64 Inputs VAR_INPUT in : T_FILETIME; END_VAR Name Type Description in T_FILETIME The "Windows File Time" variable to be converted Sample: PROGRAM P_TEST VAR fb Sys File Time : GETSYSTEMTIME; ft : T_FILETIME; dct : T_DCTIME64; END_VAR fb Sys File Time(time Lo DW=>ft.dw Low Date Time, time Hi DW=>ft.dw High Date Time); dct := FILETIME_TO_DCTIME64(ft); Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT TE1000 Version: 1.9.3 119
## Page 120

[Obsolete] 12 [Obsolete] 12.1 F_Get Version Tc Ether CAT Outdated function This function is outdated. Use the global structure instance st Lib Version_Tc2_Ether CAT instead This function can be used to read PLC library version information. FUNCTION F_Get Version Tc Ether CAT : UINT Inputs VAR_INPUT n Version Element : INT; END_VAR Name Type Description n Version Element INT Version element to be read. Possible parameters: • 1 : major number; • 2 : minor number; • 3 : revision number; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 120 Version: 1.9.3 TE1000
## Page 121

Data types 13 Data types 13.1 E_Ec Adressing Type Addressing in Ether CAT is either position-dependent (e Adressing Type_Auto Inc), based on a fixed, configured address (e Adressing Type_Fixed) or applies to all slaves (e Adressing Type_Broadcast). TYPE E_Ec Adressing Type : ( e Adressing Type_Auto Inc:=1, (* Adress slave by it's position. (adp = 1- position, 1. Slave = 0, 2. Slave = 0xffff(-1) etc) *) (* Ether CAT commands: APRD, APWR, APRW *) e Adressing Type_Fixed, (* Adress slave by configured ethercat slave address (adp = configured address ) *) (* Ether CAT commands: FPRD, FPWR, FPRW *) e Adressing Type_Broadcast (* Adress all slaves. *) (* Ether CAT commands: BRD, BWR, BRW *) ); END_TYPE Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.2 E_Ec Foe Mode Access mode for the “File access over Ether CAT” mailbox protocol. TYPE E_Ec Foe Mode : ( e Foe Mode_Write := 1, e Foe Mode_Read ); END_TYPE Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.3 E_Ec Mbx Prot Type Supported Ether CAT mailbox protocol types. TYPE E_Ec Mbx Prot Type: ( e Ec Mbx Prot_Co E := 3,(* CANopen over Ether CAT *) e Ec Mbx Prot_Fo E := 4,(* File over Ether CAT *) e Ec Mbx Prot_So E := 5 (* Servo Drive Profile over Ether CAT *) ); END_TYPE Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.4 ST_Ec Crc Error Structure containing the CRC error counters of the individual ports (A, B and C) of an Ether CAT slave device. TE1000 Version: 1.9.3 121
## Page 122

Data types TYPE ST_Ec Crc Error : STRUCT port A : UDINT; port B : UDINT; port C : UDINT; END_STRUCT END_TYPE Name Type Description port A UDINT CRC error counter of Port A port B UDINT CRC error counter of Port B port C UDINT CRC error counter of Port C Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.5 ST_Ec Crc Error Ex Structure containing the CRC error counters of the individual ports (A, B, C and D) of an Ether CAT slave device. TYPE ST_Ec Crc Error Ex : STRUCT port A : UDINT; port B : UDINT; port C : UDINT; port D : UDINT; END_STRUCT END_TYPE Name Type Description port A UDINT CRC error counter of Port A port B UDINT CRC error counter of Port B port C UDINT CRC error counter of Port C port D UDINT CRC error counter of Port D Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.6 ST_Ec Last Prot Err Info The structure ST_Ec Last Prot Err Info contains additional error information relating to the most recent Ether CAT mailbox protocol error. TYPE ST_Ec Slave State: STRUCT own Addr : ST_Ams Addr; org Addr : ST_Ams Addr; err Code : UDINT; bin Desc : ARRAY[0.. MAX_STRING_LENGTH] OF BYTE; END_STRUCT END_TYPE 122 Version: 1.9.3 TE1000
## Page 123

Data types Name Type Description own Addr ST_Ams Addr Own AMS address (address of the communication device that queries the error information) org Addr ST_Ams Addr AMS address of the error originator (address of communication device that has triggered or caused the protocol error) err Code UDINT Mailbox protocol error number [} 134] (So E, Co E, Fo E error code) bin Desc ARRAY[0.. MAX_ Additional error information as binary data. The additional error STRING_LENGTH] OF B information is device-specific and can include a string or binary YTE data, for example. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.7 ST_Ec Master Statistic TYPE ST_Ec Master Statistic : STRUCT n Sys Time : UDINT; n Cyc Frame Cnt : UDINT; n Cyc Frame Missed Cnt : UDINT; n Queued Frame Cnt : UDINT; n Queued Frame Missed Cnt : UDINT; END_STRUCT END_TYPE Name Type Description n Sys Time UDINT System time in µs n Cyc Frame Cnt UDINT Number of cyclic Ether CAT frames n Cyc Frame Missed C UDINT Number of lost cyclic Ether CAT frames nt n Queued Frame Cnt UDINT Number of acyclic Ether CAT frames n Queued Frame Miss UDINT Number of lost acyclic Ether CAT frames ed Cnt Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.8 ST_Ec Slave Config Data The structure ST_Ec Slave Config Data contains the Ether CAT configuration data for an Ether CAT slave device. TYPE ST_Ec Slave Config Data: STRUCT n Entries : WORD; n Addr : WORD; s Type : STRING[15]; s Name : STRING[31]; n Dev Type : DWORD; st Slave Identity : ST_Ec Slave Identity; n Mailbox Out Size : WORD; n Mailbox In Size : WORD; n Link Status : BYTE; END_STRUCT END_TYPE TE1000 Version: 1.9.3 123
## Page 124

Data types Name Type Description n Entries WORD Used internally n Addr WORD Address of an Ether CAT slave s Type STRING Ether CAT type of a slave s Name STRING Name of an Ether CAT slave n Dev Type DWORD Ether CAT device type of a slave st Slave Identity ST_Ec Slave Ident Identity of an Ether CAT slave (see ST_Ec Slave Identity [} 124]) ity n Mailbox Out Size WORD Mailbox Out Size of an Ether CAT slave n Mailbox In Size WORD Mailbox In Size of an Ether CAT slave n Link Status BYTE Link status of an Ether CAT slave Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.9 ST_Ec Slave Identity The structure ST_Ec Slave Identity contains the Ether CAT identity data for an Ether CAT slave device. TYPE ST_Ec Slave Identity : STRUCT vendor Id : UDINT; product Code : UDINT; revision No : UDINT; serial No : UDINT; END_STRUCT END_TYPE Name Type Description vendor Id UDINT Vendor-ID of the slave device product Code UDINT Product code of the slave device revision No UDINT Indicates the revision number of the slave device. serial No UDINT Indicates the serial number of the slave device. Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.10 ST_Ec Slave Scanned Data The ST_Ec Slave Scanned Data structure contains the Ether CAT configuration data of a scanned Ether CAT slave device. TYPE ST_Ec Slave Scanned Data: STRUCT n Entries : WORD; n Addr : WORD; st Slave Identity : ST_Ec Slave Identity; ndl Status Reg : WORD; END_STRUCT END_TYPE 124 Version: 1.9.3 TE1000
## Page 125

Data types Name Type Description n Entries WORD Used internally n Addr WORD Address of an Ether CAT slave st Slave Identity ST_Ec Slave Identity Identity of an Ether CAT slave (see ST_Ec Slave Identity [} 124]) ndl Status Reg WORD Link status of an Ether CAT slave from ESC register 0110/0111 or 272/273 . Status 0 is displayed if the slave hex dec cannot be reached or is offline. The "port number <=> socket/Ebus contact" assignment can be found in the respective device documentation. Unless described otherwise, port 0 is the left-hand Ebus contact of an EL/ES terminal or the RJ45 socket of an EP box, port 1 is the right-hand outgoing Ebus contact/RJ45 socket. The bit meanings of ndl Status Reg are: Bit Meaning 0 internal use 1 Internal use 2 internal use 3 internal use 4 physical link on Port 0 0: no link, 1: Link detected 5 physical link on Port 1 0: no link, 1: Link detected 6 physical link on Port 2 0: no link, 1: Link detected 7 physical link on Port 3 0: no link, 1: Link detected 8 Loop Port 0 0: Open, 1: Closed 9 Communication on Port 0 0: no stable communication, 1: Communication established 10 Loop Port 1 0: Open, 1: Closed 11 Communication on Port 1 0: no stable communication, 1: Communication established 12 Loop Port 2 0: Open, 1: Closed 13 Communication on Port 2 0: no stable communication, 1: Communication established 14 Loop Port 3 0: Open, 1: Closed 15 Communication on Port 3 0: no stable communication, 1: Communication established TE1000 Version: 1.9.3 125
## Page 126

Data types Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.11 ST_Ec Slave State The structure ST_Ec Slave State contains the Ether CAT state and the link state of an Ether CAT slave device. TYPE ST_Ec Slave State: STRUCT device State :BYTE; link State :BYTE; END_STRUCT END_TYPE Name Type Description device State BYTE Ether CAT state of a slave (See device State) link State BYTE Link state of an Ether CAT slave (see link State) device State Ether CAT state of a slave. The status can adopt one of the following values: Constant Value Description EC_DEVICE_STATE_INIT 0x01 Init state EC_DEVICE_STATE_PREOP 0x02 Pre-operational state EC_DEVICE_STATE_BOOTSTRA 0x03 Bootstrap state P EC_DEVICE_STATE_SAFEOP 0x04 Safe-operational state EC_DEVICE_STATE_OP 0x08 Operational state In addition, the following bits can be set: Constant Value Description EC_DEVICE_STATE_ERROR 0x10 State machine error in the Ether CAT slave EC_DEVICE_STATE_INVALID_V 0x20 Invalid vendor ID, product code, PRS revision number or serial number EC_DEVICE_STATE_INITCMD_E 0x40 Error during sending of initialization RROR commands. EC_DEVICE_STATE_DISABLED 0x80 Slave is disabled link State Link status of an Ether CAT slave. The Link state can consist of an ORing of the following bits: 126 Version: 1.9.3 TE1000
## Page 127

Data types Constant Value Description EC_LINK_STATE_OK 0x00 EC_LINK_STATE_NOT_PRESEN 0x01 No Ether CAT communication with T the Ether CAT slave EC_LINK_STATE_LINK_WITHOU 0x02 Error at port X (specified through T_COMM EC_LINK_STATE_PORT_A/B/C/ D). The port has a link, but no communication is possible via this port. EC_LINK_STATE_MISSING_LINK 0x04 Missing link at port X (specified through EC_LINK_STATE_PORT_A/B/C/ D). EC_LINK_STATE_ADDITIONAL_L 0x08 Additional link at port X (specified INK through EC_LINK_STATE_PORT_A/B/C/ D). EC_LINK_STATE_PORT_A 0x10 Port 0 EC_LINK_STATE_PORT_B 0x20 Port 1 EC_LINK_STATE_PORT_C 0x40 Port 2 EC_LINK_STATE_PORT_D 0x80 Port 3 Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.12 ST_Ec Slave State Bits The structure ST_Ec Slave State Bits contains the Ether CAT state and the link state of an Ether CAT slave device. TYPE ST_Ec Slave State Bits: STRUCT b Init : BOOL; b Preop : BOOL; b Boot Strap : BOOL; b Safe Op : BOOL; b Op : BOOL; b Error : BOOL; b Inv VPRS : BOOL; b Init Cmd Error : BOOL; b Link Not Present : BOOL; b Link Without Comm : BOOL; b Link Missing : BOOL; b Additional Link : BOOL; b Port A : BOOL; b Port B : BOOL; b Port C : BOOL; b Port D : BOOL; END_STRUCT END_TYPE Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.13 ST_Ec Slave State Bits Ex The structure ST_Ec Slave State Bits Ex contains the Ether CAT state and the link state of an Ether CAT slave device. TE1000 Version: 1.9.3 127
## Page 128

Data types TYPE ST_Ec Slave State Bits Ex: STRUCT b Init : BOOL; b Preop : BOOL; b Boot Strap : BOOL; b Safe Op : BOOL; b Op : BOOL; b Error : BOOL; b Inv VPRS : BOOL; b Init Cmd Error : BOOL; b Disabled : BOOL; b Link Not Present : BOOL; b Link Without Comm : BOOL; b Link Missing : BOOL; b Additional Link : BOOL; b Port A : BOOL; b Port B : BOOL; b Port C : BOOL; b Port D : BOOL; END_STRUCT END_TYPE Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.14 ST_Ec Abort Code TYPE ST_Ec Slave Scanned Data: STRUCT s Net Id : T_Ams Net Id Arr; n Port : UINT; n Abort Code : UDINT; END_STRUCT END_TYPE Name Type Description s Net Id T_Ams Net Id Arr Ams Net Id of the sender who aborted the command. n Port UINT Port of the sender who aborted the command. n Abort Code UDINT Abort code 13.15 ST_Port Addr The structure ST_Port Addr contains Ether CAT topology information for Ether CAT slave device. Ether CAT slave devices typically have 2 to 4 ports. TYPE ST_Port Addr: STRUCT port A : UINT; port B : UINT; port C : UINT; port D : UINT; END_STRUCT END_TYPE Name Type Description port A UINT Address of the previous Ether CAT slave at port A of the current Ether CAT slave port B UINT Address of the optional subsequent Ether CAT slave at port B of the current Ether CAT slave port C UINT Address of the optional subsequent Ether CAT slave at port C of the current Ether CAT slave port D UINT Address of the optional subsequent Ether CAT slave at port D of the current Ether CAT slave 128 Version: 1.9.3 TE1000
## Page 129

Data types 13.16 ST_Topology Data Ex The structure ST_Topology Data Ex contains information on Ether CAT topology and hot-connect groups. TYPE ST_Topology Data Ex: STRUCT n Own Physical Addr : UINT; n Own Auto Inc Addr : UINT; st Physical Addr : ST_Port Addr; st Auto Inc Addr : ST_Port Addr; a Reserved1 : ARRAY [0..3] OF UDINT; n Status Bits : DWORD; n HCSlave Count Cfg : UINT; (*n Status Bits.0 = TRUE: Dc Supprt;.1 = TRUE: DC64Supprt; .2=TRUE: Slave Present following hot connect info requires runtime >= TC 2.11 R3 B2246 n Status Bits.3 = TRUE: Hot Con nect Group Start; .4 = Hot Connect Slave; .5 = TRUE: Hot COnnect Invalid B; .6 = TRUE: Hot Connect Invalid C; .7 = TRUE: Hot Connect Invalid D*) n HCSlave Count Act : UINT; a Reserved2 : ARRAY [0..4] OF UDINT; END_STRUCT END_TYPE Name Type Description n Own Physical Addr UINT Dedicated physical Ether CAT address of the Ether CAT slave device n Own Auto Inc Addr UINT Dedicated auto-increment Ether CAT address of the Ether CAT slave device st Physical Addr ST_Port Addr Physical address information of the Ether CAT slave devices at port A…D st Auto Inc Addr ST_Port Addr Auto-increment address information of the Ether CAT slave devices at port A…D a Reserved1 ARRAY [0..3] OF Reserved UDINT n Status Bits DWORD n Status Bits.0 = TRUE: Distributed clock is supported n Status Bits.1 = TRUE: Distributed Clock is supported (64-bit) n Status Bits.2 = TRUE: slave is present n Status Bits.3 = TRUE: slave is start node of a Hot Connect group n Status Bits.4 = TRUE: slave is in a Hot Connect group n Status Bits.5 = TRUE: Hot Connect is invalid at port B n Status Bits.6 = TRUE: Hot Connect is invalid at port C n Status Bits.7 = TRUE: Hot Connect is invalid at port D n HCSlave Count Cfg UINT Configured number of Hot Connect group devices n HCSlave Count Act UINT Found number of Hot Connect group devices a Reserved2 ARRAY [0..4] OF Reserved UDINT Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.17 DCTIMESTRUCT Structured Twin CAT "Distributed Clock System Time" format. The smallest unit is a nanosecond. This data type represents the number of nanoseconds since 01.01.2000 (GMT). TYPE DCTIMESTRUCT : STRUCT w Year : WORD; w Month : WORD; w Day Of Week : WORD; w Day : WORD; w Hour : WORD; w Minute : WORD; w Second : WORD; TE1000 Version: 1.9.3 129
## Page 130

Data types w Milliseconds : WORD; w Microseconds : WORD; w Nanoseconds : WORD; END_STRUCT END_TYPE Name Type Description w Year WORD Year: 2000 ~ 2584 w Month WORD Month: 1 ~ 12 (January = 1, February = 2 etc.) w Day Of Week WORD Day of the week: 0 ~ 6 (Sunday = 0, Monday = 1 etc.) w Day WORD Day of the month: 1 ~ 31 w Hour WORD Hour: 0 ~ 23 w Minute WORD Minute: 0 ~ 59 w Second WORD Second: 0 ~ 59 w Milliseconds WORD Millisecond: 0 ~ 999 w Microseconds WORD Microsecond: 0 ~ 999 w Nanoseconds WORD Nanosecond: 0 ~ 999 Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.18 T_DCTIME32 32-bit Twin CAT distributed clock system time format. The smallest unit is a nanosecond. This 32-bit DC system time is formed from the full absolute 64-bit DC system time (T_DCTIME [} 131]) by using only the lowest-order 32 bits. This means the property of an absolute unique time is lost, and it is assumed that this 32-bit time is only used within a narrow time window of ± 2,147 seconds around the current system time, to ensure that it is unambiguous. There are many applications in which this assumption is possible. If this assumption is violated, errors may occur in the interpretation and further processing of this time. TYPE T_DCTIME32 : UDINT; END_TYPE Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.19 T_DCTIME64 The data type T_DCTIME64 represents the distributed clock system time (abbreviated as DC time) as a linear 64-bit integer value. The time is expressed in nanoseconds since 1/1/2000 UTC. The smallest unit is a nanosecond. TYPE T_DCTIME64 : ULINT; END_TYPE 130 Version: 1.9.3 TE1000
## Page 131

Data types Useful distributed clock system time constants Description EC_DCTIME_DELTA_OFFSET64 Number of 100-nanosecond ticks between 1601-01-01 and 2000-01-01. This is the difference between the "Windows File Time" and the "Distributed Clock System Time". EC_DCTIME_DATEDELTA_OFFSET Number of days that have passed between the year zero and January 1, 2000 EC_DCTIME_TICKSPERMSEC64 Number of distributed clock system time nanoseconds per millisecond EC_DCTIME_TICKSPERSEC64 Number of distributed clock system time nanoseconds per second EC_DCTIME_TICKSPERDAY64 Number of distributed clock system time nanoseconds per day Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.20 T_DCTIME Outdated data type This data type is outdated. Use the data type T_DCTIME64 [} 130] instead. The data type T_DCTIME represents the distributed clock system time (abbreviated as DC time) as a linear 64-bit integer value. The time is expressed in nanoseconds since 1.1.2000 UTC. The data type is represented as two 32-bit DWORD variables, so that it can easily be processed in the PLC. Operations (addition and subtraction of times) can be executed with ui64 functions from the Tc2_Utilities library. TYPE T_DCTIME : T_ULARGE_INTEGER; END_TYPE Useful distributed clock system time constants Description EC_DCTIME_DELTA_OFFSET Number of 100-nanosecond ticks between 01.01.1601 and 01.01.2000. This is the difference between the Windows file time and the distributed clock system time. EC_DCTIME_DATEDELTA_OFFSET Number of days that have passed between the year zero and 1 January 2000 EC_DCTIME_TICKSPERMSEC Number of distributed clock system time nanoseconds per millisecond EC_DCTIME_TICKSPERSEC Number of distributed clock system time nanoseconds per second EC_DCTIME_TICKSPERDAY Number of distributed clock system time nanoseconds per day Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 13.21 T_HFoe “File access over Ether CAT” handle. Before the handle can be used, it must be initialized once with the function block FB_Ec Foe Open [} 71]. The variables of this structured type must not be written directly. TE1000 Version: 1.9.3 131
## Page 132

Data types TYPE T_HFoe : STRUCT s Net ID : T_Ams Net Id := ''; n Port : T_Ams Port := 0; handle : UDINT := 0; e Mode : E_Ec Foe Mode := e Foe Mode_Write; END_STRUCT END_TYPE Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 132 Version: 1.9.3 TE1000
## Page 133

Constants 14 Constants 14.1 Global constants VAR_GLOBAL CONSTANT EC_AMSPORT_MASTER :UINT :=16#FFFF; EC_MAX_SLAVES :UINT :=16#FFFF; (*ethercat commands*) EC_CMD_TYPE_APRD :BYTE :=1; EC_CMD_TYPE_APWR :BYTE :=2; EC_CMD_TYPE_APRW :BYTE :=3; EC_CMD_TYPE_FPRD :BYTE :=4; EC_CMD_TYPE_FPWR :BYTE :=5; EC_CMD_TYPE_FPRW :BYTE :=6; EC_CMD_TYPE_BRD :BYTE :=7; EC_CMD_TYPE_BWR :BYTE :=8; EC_CMD_TYPE_BRW :BYTE :=9; EC_CMD_TYPE_LRD :BYTE :=10; EC_CMD_TYPE_LWR :BYTE :=11; EC_CMD_TYPE_LRW :BYTE :=12; (* Device states *) EC_DEVICE_STATE_MASK :BYTE :=16#0F; EC_DEVICE_STATE_INIT :BYTE :=16#01; EC_DEVICE_STATE_PREOP :BYTE :=16#02; EC_DEVICE_STATE_BOOTSTRAP :BYTE :=16#03; EC_DEVICE_STATE_SAFEOP :BYTE :=16#04; EC_DEVICE_STATE_OP :BYTE :=16#08; EC_DEVICE_STATE_ERROR :BYTE :=16#10; EC_DEVICE_STATE_INVALID_VPRS :BYTE :=16#20; EC_DEVICE_STATE_INITCMD_ERROR :BYTE :=16#40; (* Link states *) EC_LINK_STATE_OK :BYTE :=16#00; EC_LINK_STATE_NOT_PRESENT :BYTE :=16#01; EC_LINK_STATE_LINK_WITHOUT_COMM :BYTE :=16#02; EC_LINK_STATE_MISSING_LINK :BYTE :=16#04; EC_LINK_STATE_ADDITIONAL_LINK :BYTE :=16#08; EC_LINK_STATE_PORT_A :BYTE :=16#10; EC_LINK_STATE_PORT_B :BYTE :=16#20; EC_LINK_STATE_PORT_C :BYTE :=16#40; EC_LINK_STATE_PORT_D :BYTE :=16#80; (* Device/Link state IG/IO *) EC_ADS_IGRP_MASTER_STATEMACHINE :UDINT :=16#00000003; EC_ADS_IOFFS_MASTER_CURSTATE :UDINT :=16#00000100; EC_ADS_IOFFS_MASTER_REQSTATE :UDINT :=16#00000101; EC_ADS_IOFFS_MASTER_INTERNALSTATE :UDINT :=16#00000102; EC_ADS_IGRP_MASTER_COUNT_SLAVE :UDINT :=16#00000006; EC_ADS_IOFFS_MASTER_COUNT_SLAVE :UDINT :=16#00000000; EC_ADS_IOFFS_MASTER_COUNT_PORT :UDINT :=16#00000001; EC_ADS_IOFFS_MASTER_COUNT_ROUTER :UDINT :=16#00000002; EC_ADS_IGRP_MASTER_SLAVE_ADDRESSES :UDINT :=16#00000007; EC_ADS_IGRP_MASTER_SENDCMD :UDINT :=16#00000008; EC_ADS_IGRP_SLAVE_STATEMACHINE :UDINT :=16#00000009; EC_ADS_IGRP_MASTER_SLAVE_IDENTITY :UDINT :=16#00000011; EC_ADS_IGRP_MASTER_SLAVE_CRC :UDINT :=16#00000012; EC_ADS_IGRP_MASTER_SLAVE_ABNORMAL_STATE_CHANGES :UDINT :=16#00000013; EC_ADS_IGRP_MASTER_SLAVE_SETPRESENT_CHANGES :UDINT :=16#00000016; EC_ADS_IGRP_MASTER_DEVICESTATE :UDINT :=16#00000045; EC_ADS_IGRP_MASTER_COUNT_FRAME :UDINT :=16#00000048; (* So E IG/IO *) EC_ADS_IGRP_ECAT_SOE :UDINT :=16#0000F420; EC_ADS_IGRP_ECAT_SOE_LASTERROR :UDINT :=16#0000F421; EC_SOE_ELEMENT_DATASTATE :BYTE :=16#01; EC_SOE_ELEMENT_NAME :BYTE :=16#02; EC_SOE_ELEMENT_ATTRIBUTE :BYTE :=16#04; EC_SOE_ELEMENT_UNIT :BYTE :=16#08; EC_SOE_ELEMENT_MIN :BYTE :=16#10; TE1000 Version: 1.9.3 133
## Page 134

Constants EC_SOE_ELEMENT_MAX :BYTE :=16#20; EC_SOE_ELEMENT_VALUE :BYTE :=16#40; EC_SOE_ELEMENT_DEFAULT :BYTE :=16#80; (* Fo E IG/IO *) EC_ADS_IGRP_FOE_FOPENREAD :UDINT :=16#0000F401; EC_ADS_IGRP_FOE_FOPENWRITE :UDINT :=16#0000F402; EC_ADS_IGRP_FOE_FCLOSE :UDINT :=16#0000F403; EC_ADS_IGRP_FOE_FREAD :UDINT :=16#0000F404; EC_ADS_IGRP_FOE_FWRITE :UDINT :=16#0000F405; EC_ADS_IGRP_FOE_PROGRESSINFO :UDINT :=16#0000F406; EC_ADS_IGRP_FOE_LASTERROR :UDINT :=16#0000F407; (* Co E IG/IO *) EC_ADS_IGRP_CANOPEN_SDO :UDINT :=16#0000F302; EC_ADS_IGRP_CANOPEN_SDO_LASTERROR :UDINT :=16#0000F303; EC_DCTIME_DATEDELTA_OFFSET : DWORD := 730120; (* Number of past days since year zero until 1 January 2000 *) EC_DCTIME_DELTA_OFFSET : T_ULARGE_INTEGER := ( dw High Part := 16#01BF53EB, dw Low Part := 16#256D4000 ) ; (* Number of 100ns ticks between 1.1.1601 and 1.1.2000 *) EC_DCTIME_TICKSPERMSEC : T_ULARGE_INTEGER := ( dw High Part := 16#00000000, dw Low Part := 16#000F4240); (* Number of nanosecond ticks per millisecond *) EC_DCTIME_TICKSPERSEC : T_ULARGE_INTEGER := ( dw High Part := 16#00000000, dw Low Part := 16#3B9ACA00); (* Number of nanosecond ticks per second *) EC_DCTIME_TICKSPERDAY : T_ULARGE_INTEGER := ( dw High Part := 16#00004E94, dw Low Part := 16#914F0000); (* Number of nanosecond ticks per day *) EC_DCTIME_DELTA_OFFSET64 : ULINT := ULINT#16#01BF53EB_256D4000; (* Number of 100ns ticks between 1.1.1601 and 1.1.2000 *) EC_DCTIME_TICKSPERMSEC64 : ULINT := ULINT#16#00000000_000F4240; (* Number of nanosecond ticks per millisecond *) EC_DCTIME_TICKSPERSEC64 : ULINT := ULINT#16#00000000_3B9ACA00; (* Number of nanosecond ticks per second *) EC_DCTIME_TICKSPERDAY64 : ULINT := ULINT#16#00004E94_914F0000; (* Number of nanosecond ticks per day *) b Seq Read Drv Attr And Value : BOOL := FALSE; Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT 14.2 Library version All libraries have a certain version. The version is indicated in the PLC library repository, for example. A global constant contains the information about the library version: Global_Version VAR_GLOBAL CONSTANT st Lib Version_Tc2_Ether CAT : ST_Lib Version; END_VAR st Lib Version_Tc2_Ether CAT: Version information of the Tc2_Ether CAT library (type: ST_Lib Version) To check whether the version you have is the version you need, use the function F_Cmp Lib Version (defined in the Tc2_System library). All other options for comparing library versions, which you may know from Twin CAT 2, are outdated! 14.3 Ether CAT mailbox protocol error codes VAR_GLOBAL CONSTANT (* Fo E mailbox protocol error codes *) EC_FOE_PROTERR_NOTDEFINED : UDINT := 0; EC_FOE_PROTERR_NOTFOUND : UDINT := 1; 134 Version: 1.9.3 TE1000
## Page 135

Constants EC_FOE_PROTERR_ACCESS : UDINT := 2; EC_FOE_PROTERR_DISKFULL : UDINT := 3; EC_FOE_PROTERR_ILLEAGAL : UDINT := 4; EC_FOE_PROTERR_PACKENO : UDINT := 5; EC_FOE_PROTERR_EXISTS : UDINT := 6; EC_FOE_PROTERR_NOUSER : UDINT := 7; EC_FOE_PROTERR_BOOTSTRAPONLY : UDINT := 8; EC_FOE_PROTERR_NOTINBOOTSTRAP : UDINT := 9; EC_FOE_PROTERR_INVALIDPASSWORD : UDINT := 10; (* Co E mailbox protocol error codes *) EC_COE_PROTERR_TOGGLE : UDINT := 16#05030000; (* Toggle bit not alternated. *) EC_COE_PROTERR_TIMEOUT : UDINT := 16#05040000; (* SDO protocol timed out. *) EC_COE_PROTERR_CCS_SCS : UDINT := 16#05040001; (* Client/ server command specifier not valid or unknown. *) EC_COE_PROTERR_BLK_SIZE : UDINT := 16#05040002; (* Invalid block size (block mode only). *) EC_COE_PROTERR_SEQNO : UDINT := 16#05040003; (* Invalid sequence number (block mode only). *) EC_COE_PROTERR_CRC : UDINT := 16#05040004; (* CRC error (block mode only). *) EC_COE_PROTERR_MEMORY : UDINT := 16#05040005; (* Out of memory. *) EC_COE_PROTERR_ACCESS : UDINT := 16#06010000; (* Unsupported access to an object. *) EC_COE_PROTERR_WRITEONLY : UDINT := 16#06010001; (* Attempt to read a write only object. *) EC_COE_PROTERR_READONLY : UDINT := 16#06010002; (* Attempt to write a read only object. *) EC_COE_PROTERR_INDEX : UDINT := 16#06020000; (* Object does not exist in the object dictionary. *) EC_COE_PROTERR_PDO_MAP : UDINT := 16#06040041; (* Object cannot be mapped to the PDO. *) EC_COE_PROTERR_PDO_LEN : UDINT := 16#06040042; (* The number and length of the objects to be mapped would exceed PDO length. *) EC_COE_PROTERR_P_INCOMP : UDINT := 16#06040043; (* General parameter incompatibility reason. *) EC_COE_PROTERR_I_INCOMP : UDINT := 16#06040047; (* General internal incompatibility in the device. * ) EC_COE_PROTERR_HARDWARE : UDINT := 16#06060000; (* Access failed due to an hardware error. *) EC_COE_PROTERR_DATA_SIZE : UDINT := 16#06070010; (* Data type does not match, length of service para meter does not match *) EC_COE_PROTERR_DATA_SIZE1 : UDINT := 16#06070012; (* Data type does not match, length of service par ameter too high *) EC_COE_PROTERR_DATA_SIZE2 : UDINT := 16#06070013; (* Data type does not match, length of service par ameter too low *) EC_COE_PROTERR_OFFSET : UDINT := 16#06090011; (* Sub-index does not exist. *) EC_COE_PROTERR_DATA_RANGE : UDINT := 16#06090030; (* Value range of parameter exceeded (only for wri te access). *) EC_COE_PROTERR_DATA_RANGE1 : UDINT := 16#06090031; (* Value of parameter written too high. *) EC_COE_PROTERR_DATA_RANGE2 : UDINT := 16#06090032; (* Value of parameter written too low. *) EC_COE_PROTERR_MINMAX : UDINT := 16#06090036; (* Maximum value is less than minimum value. *) EC_COE_PROTERR_GENERAL : UDINT := 16#08000000; (* general error *) EC_COE_PROTERR_TRANSFER : UDINT := 16#08000020; (* Data cannot be transferred or stored to the appli cation. *) EC_COE_PROTERR_TRANSFER1 : UDINT := 16#08000021; (* Data cannot be transferred or stored to the appl ication because of local control. *) EC_COE_PROTERR_TRANSFER2 : UDINT := 16#08000022; (* Data cannot be transferred or stored to the appl ication because of the present device state. *) EC_COE_PROTERR_DICTIONARY : UDINT := 16#08000023; (* Object dictionary dynamic generation fails or n o object dictionary is present (e.g. object dictionary is generated from file and generation fails b ecause of an file error). *) Prerequisites Development environment Target platform PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_Ether CAT TE1000 Version: 1.9.3 135
## Page 136

Sample 15 Sample Sample project and sample configuration for diagnostics See https://infosys.beckhoff.com/content/1033/tcplclib_tc2_ethercat/Resources/2364613387.zip 136 Version: 1.9.3 TE1000
## Page 137

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Arm, Arm9 and Cortex are trademarks or registered trademarks of Arm Limited (or its subsidiaries or affiliates) in the US and/or elsewhere. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 138

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
